"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventHub=void 0;const event_emitter_1=require("./event-emitter");class EventHub extends event_emitter_1.EventEmitter{constructor(e){super(),this._layoutManager=e,this._childEventListener=(e=>this.onEventFromChild(e)),this._dontPropagateToParent=null,this._childEventSource=null,this.on(event_emitter_1.EventEmitter.ALL_EVENT,(e,...t)=>this.onEventFromThis(e,t)),globalThis.addEventListener(EventHub.ChildEventName,this._childEventListener,{passive:!0})}destroy(){globalThis.removeEventListener(EventHub.ChildEventName,this._childEventListener)}onEventFromParent(e,...t){this._dontPropagateToParent=e,this.emitUnknown(e,t)}onEventFromThis(e,...t){this._layoutManager.isSubWindow&&t[0]!==this._dontPropagateToParent&&this.propagateToParent(e,t),this.propagateToChildren(e,t),this._dontPropagateToParent=null,this._childEventSource=null}onEventFromChild(e){const t=e.detail;this._childEventSource=t.layoutManager,this.emitUnknown(t.eventName,t.args)}propagateToParent(e,t){const n={bubbles:!0,cancelable:!0,detail:{layoutManager:this._layoutManager,eventName:e,args:t}},o=new CustomEvent(EventHub.ChildEventName,n);globalThis.opener.dispatchEvent(o)}propagateToChildren(e,t){for(let n=0;n<this._layoutManager.openPopouts.length;n++){const o=this._layoutManager.openPopouts[n].getGlInstance();o&&o!==this._childEventSource&&o.eventHub.onEventFromParent(e,t)}}}exports.EventHub=EventHub,function(e){e.ChildEventName="gl_child_event"}(EventHub=exports.EventHub||(exports.EventHub={}));