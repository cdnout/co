"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Header=void 0;const internal_error_1=require("../errors/internal-error"),event_emitter_1=require("../utils/event-emitter"),types_1=require("../utils/types"),utils_1=require("../utils/utils"),header_button_1=require("./header-button"),tabs_container_1=require("./tabs-container");class Header extends event_emitter_1.EventEmitter{constructor(t,e,n,i,o,s,a,r,l,h,_,d,m,c){super(),this._layoutManager=t,this._parent=e,this._configClosable=i,this._getActiveComponentItemEvent=o,this._dockEvent=a,this._popoutEvent=r,this._maximiseToggleEvent=l,this._clickEvent=h,this._touchStartEvent=_,this._componentRemoveEvent=d,this._componentFocusEvent=m,this._componentDragStartEvent=c,this._clickListener=(t=>this.onClick(t)),this._touchStartListener=(t=>this.onTouchStart(t)),this._rowColumnClosable=!0,this._closeButton=null,this._dockButton=null,this._popoutButton=null,this._tabsContainer=new tabs_container_1.TabsContainer(this._layoutManager,t=>this.handleTabInitiatedComponentRemoveEvent(t),t=>this.handleTabInitiatedComponentFocusEvent(t),(t,e,n,i)=>this.handleTabInitiatedDragStartEvent(t,e,n,i),()=>this.processTabDropdownActiveChanged()),this._show=n.show,this._popoutEnabled=n.popoutEnabled,this._popoutLabel=n.popoutLabel,this._dockEnabled=n.dockEnabled,this._dockLabel=n.dockLabel,this._maximiseEnabled=n.maximiseEnabled,this._maximiseLabel=n.maximiseLabel,this._minimiseEnabled=n.minimiseEnabled,this._minimiseLabel=n.minimiseLabel,this._closeEnabled=n.closeEnabled,this._closeLabel=n.closeLabel,this._tabDropdownEnabled=n.tabDropdownEnabled,this._tabDropdownLabel=n.tabDropdownLabel,this.setSide(n.side),this._canRemoveComponent=this._configClosable,this._element=document.createElement("section"),this._element.classList.add("lm_header"),this._controlsContainerElement=document.createElement("section"),this._controlsContainerElement.classList.add("lm_controls"),this._element.appendChild(this._tabsContainer.element),this._element.appendChild(this._controlsContainerElement),this._element.appendChild(this._tabsContainer.dropdownElement),this._element.addEventListener("click",this._clickListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartListener,{passive:!0}),this._documentMouseUpListener=(()=>this._tabsContainer.hideAdditionalTabsDropdown()),globalThis.document.addEventListener("mouseup",this._documentMouseUpListener,{passive:!0}),this._tabControlOffset=this._layoutManager.layoutConfig.settings.tabControlOffset,this._tabDropdownButton=new header_button_1.HeaderButton(this,this._tabDropdownLabel,"lm_tabdropdown",()=>this._tabsContainer.showAdditionalTabsDropdown()),this._dockEnabled&&(this._dockButton=new header_button_1.HeaderButton(this,this._dockLabel,"lm_dock",()=>this.handleButtonDockEvent())),this._popoutEnabled&&(this._popoutButton=new header_button_1.HeaderButton(this,this._popoutLabel,"lm_popout",()=>this.handleButtonPopoutEvent())),this._maximiseEnabled&&(this._maximiseButton=new header_button_1.HeaderButton(this,this._maximiseLabel,"lm_maximise",t=>this.handleButtonMaximiseToggleEvent(t))),this._configClosable&&(this._closeButton=new header_button_1.HeaderButton(this,this._closeLabel,"lm_close",()=>s())),this.processTabDropdownActiveChanged()}get show(){return this._show}get side(){return this._side}get leftRightSided(){return this._leftRightSided}get dockEnabled(){return this._dockEnabled}get layoutManager(){return this._layoutManager}get parent(){return this._parent}get tabs(){return this._tabsContainer.tabs}get activeContentItem(){const t=this._getActiveComponentItemEvent();return void 0===t?null:t}get element(){return this._element}get tabsContainer(){return this._tabsContainer.element}get tabsContainerElement(){return this._tabsContainer.element}get controlsContainerElement(){return this._controlsContainerElement}get controlsContainer(){return this._controlsContainerElement}destroy(){this.emit("destroy"),this._dockEvent=void 0,this._popoutEvent=void 0,this._maximiseToggleEvent=void 0,this._clickEvent=void 0,this._touchStartEvent=void 0,this._componentRemoveEvent=void 0,this._componentFocusEvent=void 0,this._componentDragStartEvent=void 0,this._tabsContainer.destroy(),globalThis.document.removeEventListener("mouseup",this._documentMouseUpListener),this._element.remove()}createTab(t,e){this._tabsContainer.createTab(t,e)}removeTab(t){this._tabsContainer.removeTab(t)}processActiveComponentChanged(t){this._tabsContainer.processActiveComponentChanged(t),this.updateTabSizes()}setSide(t){this._side=t,this._leftRightSided=[types_1.Side.right,types_1.Side.left].includes(this._side)}setRowColumnClosable(t){this._rowColumnClosable=t,this.updateClosability()}updateClosability(){let t;if(this._configClosable){if(this._rowColumnClosable){t=!0;const e=this.tabs.length;for(let n=0;n<e;n++){if(!this._tabsContainer.tabs[n].componentItem.isClosable){t=!1;break}}}else t=!1;null!==this._closeButton&&utils_1.setElementDisplayVisibility(this._closeButton.element,t)}else t=!1;this._canRemoveComponent=t||this._tabsContainer.tabCount>1}setDockable(t){return!(null===this._dockButton||!this._dockEnabled)&&(utils_1.setElementDisplayVisibility(this._dockButton.element,t),!0)}applyFocusedValue(t){t?this._element.classList.add("lm_focused"):this._element.classList.remove("lm_focused")}processMaximised(){if(void 0===this._maximiseButton)throw new internal_error_1.UnexpectedUndefinedError("HPMAX16997");this._maximiseButton.element.setAttribute("title",this._minimiseLabel)}processMinimised(){if(void 0===this._maximiseButton)throw new internal_error_1.UnexpectedUndefinedError("HPMIN16997");this._maximiseButton.element.setAttribute("title",this._maximiseLabel)}updateTabSizes(){if(this._tabsContainer.tabCount>0){const t=this._show?this._layoutManager.layoutConfig.dimensions.headerHeight:0;let e;this._leftRightSided?(this._element.style.height="",this._element.style.width=utils_1.numberToPixels(t)):(this._element.style.width="",this._element.style.height=utils_1.numberToPixels(t)),e=this._leftRightSided?this._element.offsetHeight-this._controlsContainerElement.offsetHeight-this._tabControlOffset:this._element.offsetWidth-this._controlsContainerElement.offsetWidth-this._tabControlOffset,this._tabsContainer.updateTabSizes(e,this._getActiveComponentItemEvent())}}handleTabInitiatedComponentRemoveEvent(t){if(this._canRemoveComponent){if(void 0===this._componentRemoveEvent)throw new internal_error_1.UnexpectedUndefinedError("HHTCE22294");this._componentRemoveEvent(t)}}handleTabInitiatedComponentFocusEvent(t){if(void 0===this._componentFocusEvent)throw new internal_error_1.UnexpectedUndefinedError("HHTAE22294");this._componentFocusEvent(t)}handleTabInitiatedDragStartEvent(t,e,n,i){if(this._canRemoveComponent){if(void 0===this._componentDragStartEvent)throw new internal_error_1.UnexpectedUndefinedError("HHTDSE22294");this._componentDragStartEvent(t,e,n,i)}else n.cancelDrag()}processTabDropdownActiveChanged(){utils_1.setElementDisplayVisibility(this._tabDropdownButton.element,this._tabsContainer.dropdownActive)}handleButtonDockEvent(){if(void 0===this._dockEvent)throw new internal_error_1.UnexpectedUndefinedError("HHBDE17834");this._dockEvent()}handleButtonPopoutEvent(){if(this._layoutManager.layoutConfig.settings.popoutWholeStack){if(void 0===this._popoutEvent)throw new internal_error_1.UnexpectedUndefinedError("HHBPOE17834");this._popoutEvent()}else{const t=this._getActiveComponentItemEvent();if(null===t)throw new internal_error_1.UnexpectedNullError("HOPC70222");t.popout()}}handleButtonMaximiseToggleEvent(t){if(void 0===this._maximiseToggleEvent)throw new internal_error_1.UnexpectedUndefinedError("HHBMTE16834");this._maximiseToggleEvent()}onClick(t){t.target===this._element&&this.notifyClick(t)}onTouchStart(t){t.target===this._element&&this.notifyTouchStart(t)}notifyClick(t){if(void 0===this._clickEvent)throw new internal_error_1.UnexpectedUndefinedError("HNHC46834");this._clickEvent(t)}notifyTouchStart(t){if(void 0===this._touchStartEvent)throw new internal_error_1.UnexpectedUndefinedError("HNHTS46834");this._touchStartEvent(t)}}exports.Header=Header;