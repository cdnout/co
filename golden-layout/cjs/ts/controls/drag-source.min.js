"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DragSource=void 0;const config_1=require("../config/config"),resolved_config_1=require("../config/resolved-config"),internal_error_1=require("../errors/internal-error"),component_item_1=require("../items/component-item"),ground_item_1=require("../items/ground-item"),drag_listener_1=require("../utils/drag-listener"),drag_proxy_1=require("./drag-proxy");class DragSource{constructor(e,r,t,n){this._element=e,this._extraAllowableChildTargets=r,this._itemConfigOrFtn=t,this._layoutManager=n,this._dragListener=null,this._dummyGroundContainer=document.createElement("div"),this._dummyGroundContentItem=new ground_item_1.GroundItem(this._layoutManager,this._layoutManager.layoutConfig.root,this._dummyGroundContainer),this.createDragListener()}destroy(){this.removeDragListener()}createDragListener(){this.removeDragListener(),this._dragListener=new drag_listener_1.DragListener(this._element,this._extraAllowableChildTargets),this._dragListener.on("dragStart",(e,r)=>this.onDragStart(e,r)),this._dragListener.on("dragStop",()=>this.onDragStop())}onDragStart(e,r){let t;t="function"==typeof this._itemConfigOrFtn?this._itemConfigOrFtn():this._itemConfigOrFtn;const n=config_1.ItemConfig.resolve(t),i=resolved_config_1.ResolvedItemConfig.createCopy(n),o=new component_item_1.ComponentItem(this._layoutManager,i,this._dummyGroundContentItem);if(null===this._dragListener)throw new internal_error_1.UnexpectedNullError("DSODSD66746");{const t=new drag_proxy_1.DragProxy(e,r,this._dragListener,this._layoutManager,o,this._dummyGroundContentItem),n=this._layoutManager.transitionIndicator;if(null===n)throw new internal_error_1.UnexpectedNullError("DSODST66746");n.transitionElements(this._element,t.element)}}onDragStop(){this.createDragListener()}removeDragListener(){null!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=null)}}exports.DragSource=DragSource;