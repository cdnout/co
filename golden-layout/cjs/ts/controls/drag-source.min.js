"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DragSource=void 0;const config_1=require("../config/config"),internal_error_1=require("../errors/internal-error"),component_item_1=require("../items/component-item"),ground_item_1=require("../items/ground-item"),drag_listener_1=require("../utils/drag-listener"),drag_proxy_1=require("./drag-proxy");class DragSource{constructor(e,t,r,n,o,i){this._layoutManager=e,this._element=t,this._extraAllowableChildTargets=r,this._componentTypeOrFtn=n,this._componentState=o,this._title=i,this._dragListener=null,this._dummyGroundContainer=document.createElement("div"),this._dummyGroundContentItem=new ground_item_1.GroundItem(this._layoutManager,this._layoutManager.layoutConfig.root,this._dummyGroundContainer),this.createDragListener()}destroy(){this.removeDragListener()}createDragListener(){this.removeDragListener(),this._dragListener=new drag_listener_1.DragListener(this._element,this._extraAllowableChildTargets),this._dragListener.on("dragStart",(e,t)=>this.onDragStart(e,t)),this._dragListener.on("dragStop",()=>this.onDragStop())}onDragStart(e,t){let r,n,o;if("function"==typeof this._componentTypeOrFtn){const e=this._componentTypeOrFtn();r=e.type,n=e.state,o=e.title}else r=this._componentTypeOrFtn,n=this._componentState,o=this._title;const i={type:"component",componentType:r,componentState:n,title:o},s=config_1.ComponentItemConfig.resolve(i),a=new component_item_1.ComponentItem(this._layoutManager,s,this._dummyGroundContentItem);if(this._dummyGroundContentItem.contentItems.push(a),null===this._dragListener)throw new internal_error_1.UnexpectedNullError("DSODSD66746");{const r=new drag_proxy_1.DragProxy(e,t,this._dragListener,this._layoutManager,a,this._dummyGroundContentItem),n=this._layoutManager.transitionIndicator;if(null===n)throw new internal_error_1.UnexpectedNullError("DSODST66746");n.transitionElements(this._element,r.element)}}onDragStop(){this.createDragListener()}removeDragListener(){null!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=null)}}exports.DragSource=DragSource;