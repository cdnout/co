"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tab=void 0;const internal_error_1=require("../errors/internal-error"),drag_listener_1=require("../utils/drag-listener"),utils_1=require("../utils/utils");class Tab{constructor(t,e,s,i,n){var r;this._layoutManager=t,this._componentItem=e,this._closeEvent=s,this._focusEvent=i,this._dragStartEvent=n,this._isActive=!1,this._tabClickListener=(t=>this.onTabClickDown(t)),this._tabTouchStartListener=(t=>this.onTabTouchStart(t)),this._closeClickListener=(()=>this.onCloseClick()),this._closeTouchStartListener=(()=>this.onCloseTouchStart()),this._dragStartListener=((t,e)=>this.onDragStart(t,e)),this._contentItemDestroyListener=(()=>this.onContentItemDestroy()),this._tabTitleChangedListener=(t=>this.setTitle(t)),this._element=document.createElement("div"),this._element.classList.add("lm_tab"),this._titleElement=document.createElement("span"),this._titleElement.classList.add("lm_title"),this._closeElement=document.createElement("div"),this._closeElement.classList.add("lm_close_tab"),this._element.appendChild(this._titleElement),this._element.appendChild(this._closeElement),e.isClosable?this._closeElement.style.display="":this._closeElement.style.display="none",this.setTitle(e.title),this._componentItem.on("titleChanged",this._tabTitleChangedListener),(null!==(r=e.reorderEnabled)&&void 0!==r?r:this._layoutManager.layoutConfig.settings.reorderEnabled)&&(this._dragListener=new drag_listener_1.DragListener(this._element,[this._titleElement]),this._dragListener.on("dragStart",this._dragStartListener),this._componentItem.on("destroy",this._contentItemDestroyListener)),this._element.addEventListener("click",this._tabClickListener,{passive:!0}),this._element.addEventListener("touchstart",this._tabTouchStartListener,{passive:!0}),this._componentItem.isClosable?(this._closeElement.addEventListener("click",this._closeClickListener,{passive:!0}),this._closeElement.addEventListener("touchstart",this._closeTouchStartListener,{passive:!0})):(this._closeElement.remove(),this._closeElement=void 0),this._componentItem.setTab(this),this._layoutManager.emit("tabCreated",this)}get isActive(){return this._isActive}get componentItem(){return this._componentItem}get contentItem(){return this._componentItem}get element(){return this._element}get titleElement(){return this._titleElement}get closeElement(){return this._closeElement}setTitle(t){this._element.title=utils_1.stripTags(t),this._titleElement.innerText=t}setActive(t){t!==this._isActive&&(this._isActive=t,t?this._element.classList.add("lm_active"):this._element.classList.remove("lm_active"))}destroy(){var t,e;this._closeEvent=void 0,this._focusEvent=void 0,this._dragStartEvent=void 0,this._element.removeEventListener("click",this._tabClickListener),this._element.removeEventListener("touchstart",this._tabTouchStartListener),null===(t=this._closeElement)||void 0===t||t.removeEventListener("click",this._closeClickListener),null===(e=this._closeElement)||void 0===e||e.removeEventListener("touchstart",this._closeTouchStartListener),this._componentItem.off("titleChanged",this._tabTitleChangedListener),void 0!==this._dragListener&&(this._componentItem.off("destroy",this._contentItemDestroyListener),this._dragListener.off("dragStart",this._dragStartListener),this._dragListener=void 0),this._element.remove()}setBlurred(){this._element.classList.remove("lm_focused"),this._titleElement.classList.remove("lm_focused")}setFocused(){this._element.classList.add("lm_focused"),this._titleElement.classList.add("lm_focused")}onDragStart(t,e){if(void 0===this._dragListener)throw new internal_error_1.UnexpectedUndefinedError("TODSDLU10093");if(void 0===this._dragStartEvent)throw new internal_error_1.UnexpectedUndefinedError("TODS23309");this._dragStartEvent(t,e,this._dragListener,this.componentItem)}onContentItemDestroy(){void 0!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=void 0)}onTabClickDown(t){const e=t.target;e!==this._element&&e!==this._titleElement||(0===t.button?this.notifyFocus():1===t.button&&this._componentItem.isClosable&&this.notifyClose())}onTabTouchStart(t){t.target===this._element&&this.notifyFocus()}onCloseClick(){this.notifyClose()}onCloseTouchStart(){this.notifyClose()}notifyClose(){if(void 0===this._closeEvent)throw new internal_error_1.UnexpectedUndefinedError("TNC15007");this._closeEvent(this._componentItem)}notifyFocus(){if(void 0===this._focusEvent)throw new internal_error_1.UnexpectedUndefinedError("TNA15007");this._focusEvent(this._componentItem)}}exports.Tab=Tab;