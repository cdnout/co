"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GroundItem=void 0;const config_1=require("../config/config"),resolved_config_1=require("../config/resolved-config"),internal_error_1=require("../errors/internal-error"),types_1=require("../utils/types"),utils_1=require("../utils/utils"),component_item_1=require("./component-item"),component_parentable_item_1=require("./component-parentable-item"),content_item_1=require("./content-item"),row_or_column_1=require("./row-or-column");class GroundItem extends component_parentable_item_1.ComponentParentableItem{constructor(e,t,n){super(e,resolved_config_1.ResolvedGroundItemConfig.create(t),null,GroundItem.createElement(document)),this.isGround=!0,this._childElementContainer=this.element,this._containerElement=n,this._containerElement.appendChild(this.element)}init(){if(!0!==this.isInitialised){this.updateNodeSize();for(let e=0;e<this.contentItems.length;e++)this._childElementContainer.appendChild(this.contentItems[e].element);super.init(),this.initContentItems()}}loadRoot(e){if(this.clearRoot(),void 0!==e){const t=this.layoutManager.createAndInitContentItem(e,this);this.addChild(t,0)}}addItem(e,t){this.layoutManager.checkMinimiseMaximisedStack();const n=config_1.ItemConfig.resolve(e);let o;if((o=this.contentItems.length>0?this.contentItems[0]:this).isComponent)throw new Error("Cannot add item as child to ComponentItem");{const e=this.layoutManager.createAndInitContentItem(n,o);return t=o.addChild(e,t),o===this?-1:t}}loadComponentAsRoot(e){this.clearRoot();const t=config_1.ItemConfig.resolve(e);if(t.maximised)throw new Error("Root Component cannot be maximised");{const e=new component_item_1.ComponentItem(this.layoutManager,t,this);e.init(),this.addChild(e,0)}}addChild(e,t){if(this.contentItems.length>0)throw new Error("Ground node can only have a single child");return this._childElementContainer.appendChild(e.element),t=super.addChild(e,t),this.updateSize(),this.emitBaseBubblingEvent("stateChanged"),t}calculateConfigContent(){const e=this.contentItems,t=e.length,n=new Array(t);for(let o=0;o<t;o++){const t=e[o].toConfig();if(!resolved_config_1.ResolvedRootItemConfig.isRootItemConfig(t))throw new internal_error_1.AssertError("RCCC66832");n[o]=t}return n}setSize(e,t){void 0===e||void 0===t?this.updateSize():(utils_1.setElementWidth(this.element,e),utils_1.setElementHeight(this.element,t),this.contentItems.length>0&&(utils_1.setElementWidth(this.contentItems[0].element,e),utils_1.setElementHeight(this.contentItems[0].element,t)),this.updateContentItemsSize())}updateSize(){this.updateNodeSize(),this.updateContentItemsSize()}createSideAreas(){const e=GroundItem.Area.oppositeSides,t=new Array(Object.keys(e).length);let n=0;for(const o in e){const i=o,s=this.getElementArea();if(null===s)throw new internal_error_1.UnexpectedNullError("RCSA77553");s.side=i,"2"===e[i][1]?s[i]=s[e[i]]-50:s[i]=s[e[i]]+50,s.surface=(s.x2-s.x1)*(s.y2-s.y1),t[n++]=s}return t}highlightDropZone(e,t,n){this.layoutManager.tabDropPlaceholder.remove(),super.highlightDropZone(e,t,n)}onDrop(e,t){if(e.isComponent){const t=resolved_config_1.ResolvedStackItemConfig.createDefault(),n=e;t.header=resolved_config_1.ResolvedHeaderedItemConfig.Header.createCopy(n.headerConfig);const o=this.layoutManager.createAndInitContentItem(t,this);o.addChild(e),e=o}if(0===this.contentItems.length)this.addChild(e);else{if(e.type===types_1.ItemType.row||e.type===types_1.ItemType.column){const t=resolved_config_1.ResolvedStackItemConfig.createDefault(),n=this.layoutManager.createContentItem(t,this);n.addChild(e),e=n}const n="x"==t.side[0]?types_1.ItemType.row:types_1.ItemType.column,o="x"==t.side[0]?"width":"height",i="2"==t.side[1],s=this.contentItems[0];if(s instanceof row_or_column_1.RowOrColumn&&s.type===n){const t=s.contentItems[i?0:s.contentItems.length-1];s.addChild(e,i?0:void 0,!0),t[o]*=.5,e[o]=t[o],s.updateSize()}else{const t=resolved_config_1.ResolvedItemConfig.createDefault(n),r=this.layoutManager.createContentItem(t,this);this.replaceChild(s,r),r.addChild(e,i?0:void 0,!0),r.addChild(s,i?void 0:0,!0),s[o]=50,e[o]=50,r.updateSize()}}}dock(){throw new internal_error_1.AssertError("GID87731")}validateDocking(){throw new internal_error_1.AssertError("GIVD87732")}getAllContentItems(){const e=[this];return this.deepGetAllContentItems(this.contentItems,e),e}getConfigMaximisedItems(){const e=[];return this.deepFilterContentItems(this.contentItems,e,e=>!(!content_item_1.ContentItem.isStack(e)||!e.initialWantMaximise)||!(!content_item_1.ContentItem.isComponentItem(e)||!e.initialWantMaximise)),e}getItemsByPopInParentId(e){const t=[];return this.deepFilterContentItems(this.contentItems,t,t=>t.popInParentIds.includes(e)),t}toConfig(){throw new Error("Cannot generate GroundItem config")}setActiveComponentItem(e,t,n){}updateNodeSize(){const{width:e,height:t}=utils_1.getElementWidthAndHeight(this._containerElement);utils_1.setElementWidth(this.element,e),utils_1.setElementHeight(this.element,t),this.contentItems.length>0&&(utils_1.setElementWidth(this.contentItems[0].element,e),utils_1.setElementHeight(this.contentItems[0].element,t))}clearRoot(){const e=this.contentItems;switch(e.length){case 0:return;case 1:return void e[0].remove();default:throw new internal_error_1.AssertError("GILR07721")}}deepGetAllContentItems(e,t){for(let n=0;n<e.length;n++){const o=e[n];t.push(o),this.deepGetAllContentItems(o.contentItems,t)}}deepFilterContentItems(e,t,n){for(let o=0;o<e.length;o++){const i=e[o];n(i)&&t.push(i),this.deepFilterContentItems(i.contentItems,t,n)}}}exports.GroundItem=GroundItem,function(e){let t;!function(e){e.oppositeSides={y2:"y1",x2:"x1",y1:"y2",x1:"x2"}}(t=e.Area||(e.Area={})),e.createElement=function(e){const t=e.createElement("div");return t.classList.add("lm_goldenlayout"),t.classList.add("lm_item"),t.classList.add("lm_root"),t}}(GroundItem=exports.GroundItem||(exports.GroundItem={}));