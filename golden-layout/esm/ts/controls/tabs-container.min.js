import{AssertError}from"../errors/internal-error";import{numberToPixels,pixelsToNumber}from"../utils/utils";import{Tab}from"./tab";export class TabsContainer{constructor(t,e,s,n,i){this._layoutManager=t,this._componentRemoveEvent=e,this._componentFocusEvent=s,this._componentDragStartEvent=n,this._dropdownActiveChangedEvent=i,this._tabs=[],this._lastVisibleTabIndex=-1,this._dropdownActive=!1,this._element=document.createElement("section"),this._element.classList.add("lm_tabs"),this._dropdownElement=document.createElement("section"),this._dropdownElement.classList.add("lm_tabdropdown_list"),this._dropdownElement.style.display="none"}get tabs(){return this._tabs}get tabCount(){return this._tabs.length}get element(){return this._element}get dropdownElement(){return this._dropdownElement}get dropdownActive(){return this._dropdownActive}destroy(){for(let t=0;t<this._tabs.length;t++)this._tabs[t].destroy()}createTab(t,e){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t)return;const s=new Tab(this._layoutManager,t,t=>this.handleTabCloseEvent(t),t=>this.handleTabFocusEvent(t),(t,e,s,n)=>this.handleTabDragStartEvent(t,e,s,n));0===this._tabs.length?(this._tabs.push(s),this._element.appendChild(s.element)):(void 0===e&&(e=this._tabs.length),e>0?this._tabs[e-1].element.insertAdjacentElement("afterend",s.element):this._tabs[0].element.insertAdjacentElement("beforebegin",s.element),this._tabs.splice(e,0,s))}removeTab(t){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t){return this._tabs[e].destroy(),void this._tabs.splice(e,1)}throw new Error("contentItem is not controlled by this header")}processActiveComponentChanged(t){let e=-1;for(let s=0;s<this._tabs.length;s++){const n=this._tabs[s].componentItem===t;this._tabs[s].setActive(n),n&&(e=s)}if(e<0)throw new AssertError("HSACI56632");if(this._layoutManager.layoutConfig.settings.reorderOnTabMenuClick&&-1!==this._lastVisibleTabIndex&&e>this._lastVisibleTabIndex){const t=this._tabs[e];for(let t=e;t>0;t--)this._tabs[t]=this._tabs[t-1];this._tabs[0]=t}}updateTabSizes(t,e){let s=!1;this.tryUpdateTabSizes(s,t,e)||(s=!0,this.tryUpdateTabSizes(s,t,e)),s!==this._dropdownActive&&(this._dropdownActive=s,this._dropdownActiveChangedEvent())}tryUpdateTabSizes(t,e,s){if(this._tabs.length>0){let n=0,i=!1;const a=this._layoutManager.layoutConfig.settings.tabOverlapAllowance,o=this._tabs.indexOf(s.tab),l=this._tabs[o];this._lastVisibleTabIndex=-1;for(let s=0;s<this._tabs.length;s++){const r=this._tabs[s].element;r.parentElement!==this._element&&this._element.appendChild(r);const h=getComputedStyle(l.element).marginRight,d=pixelsToNumber(h);n+=r.offsetWidth+d;let m=0;if(o<=s)m=n;else{const t=getComputedStyle(l.element).marginRight,e=pixelsToNumber(t);m=n+l.element.offsetWidth+e}if(m>e){if(i)s===o&&(r.style.zIndex="auto",r.style.marginLeft="",r.parentElement!==this._element&&this._element.appendChild(r));else{let t;if((t=o>0&&o<=s?(m-e)/(s-1):(m-e)/s)<a){for(let e=0;e<=s;e++){const n=e!==o&&0!==e?"-"+numberToPixels(t):"";this._tabs[e].element.style.zIndex=numberToPixels(s-e),this._tabs[e].element.style.marginLeft=n}this._lastVisibleTabIndex=s,r.parentElement!==this._element&&this._element.appendChild(r)}else i=!0}if(i&&s!==o){if(!t)return!1;r.style.zIndex="auto",r.style.marginLeft="",r.parentElement!==this._dropdownElement&&this._dropdownElement.appendChild(r)}}else this._lastVisibleTabIndex=s,r.style.zIndex="auto",r.style.marginLeft="",r.parentElement!==this._element&&this._element.appendChild(r)}}return!0}showAdditionalTabsDropdown(){this._dropdownElement.style.display=""}hideAdditionalTabsDropdown(){this._dropdownElement.style.display="none"}handleTabCloseEvent(t){this._componentRemoveEvent(t)}handleTabFocusEvent(t){this._componentFocusEvent(t)}handleTabDragStartEvent(t,e,s,n){this._componentDragStartEvent(t,e,s,n)}};