import{UnexpectedNullError,UnexpectedUndefinedError}from"../errors/internal-error";import{EventEmitter}from"../utils/event-emitter";import{Side}from"../utils/types";import{numberToPixels,setElementDisplayVisibility}from"../utils/utils";import{HeaderButton}from"./header-button";import{TabsContainer}from"./tabs-container";export class Header extends EventEmitter{constructor(t,e,i,n,o,s,a,h,l,r,d,m,_,c){super(),this._layoutManager=t,this._parent=e,this._configClosable=n,this._getActiveComponentItemEvent=o,this._dockEvent=a,this._popoutEvent=h,this._maximiseToggleEvent=l,this._clickEvent=r,this._touchStartEvent=d,this._componentRemoveEvent=m,this._componentFocusEvent=_,this._componentDragStartEvent=c,this._clickListener=(t=>this.onClick(t)),this._touchStartListener=(t=>this.onTouchStart(t)),this._rowColumnClosable=!0,this._closeButton=null,this._dockButton=null,this._popoutButton=null,this._tabsContainer=new TabsContainer(this._layoutManager,t=>this.handleTabInitiatedComponentRemoveEvent(t),t=>this.handleTabInitiatedComponentFocusEvent(t),(t,e,i,n)=>this.handleTabInitiatedDragStartEvent(t,e,i,n),()=>this.processTabDropdownActiveChanged()),this._show=i.show,this._popoutEnabled=i.popoutEnabled,this._popoutLabel=i.popoutLabel,this._dockEnabled=i.dockEnabled,this._dockLabel=i.dockLabel,this._maximiseEnabled=i.maximiseEnabled,this._maximiseLabel=i.maximiseLabel,this._minimiseEnabled=i.minimiseEnabled,this._minimiseLabel=i.minimiseLabel,this._closeEnabled=i.closeEnabled,this._closeLabel=i.closeLabel,this._tabDropdownEnabled=i.tabDropdownEnabled,this._tabDropdownLabel=i.tabDropdownLabel,this.setSide(i.side),this._canRemoveComponent=this._configClosable,this._element=document.createElement("section"),this._element.classList.add("lm_header"),this._controlsContainerElement=document.createElement("section"),this._controlsContainerElement.classList.add("lm_controls"),this._element.appendChild(this._tabsContainer.element),this._element.appendChild(this._controlsContainerElement),this._element.appendChild(this._tabsContainer.dropdownElement),this._element.addEventListener("click",this._clickListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartListener,{passive:!0}),this._documentMouseUpListener=(()=>this._tabsContainer.hideAdditionalTabsDropdown()),globalThis.document.addEventListener("mouseup",this._documentMouseUpListener,{passive:!0}),this._tabControlOffset=this._layoutManager.layoutConfig.settings.tabControlOffset,this._tabDropdownButton=new HeaderButton(this,this._tabDropdownLabel,"lm_tabdropdown",()=>this._tabsContainer.showAdditionalTabsDropdown()),this._dockEnabled&&(this._dockButton=new HeaderButton(this,this._dockLabel,"lm_dock",()=>this.handleButtonDockEvent())),this._popoutEnabled&&(this._popoutButton=new HeaderButton(this,this._popoutLabel,"lm_popout",()=>this.handleButtonPopoutEvent())),this._maximiseEnabled&&(this._maximiseButton=new HeaderButton(this,this._maximiseLabel,"lm_maximise",t=>this.handleButtonMaximiseToggleEvent(t))),this._configClosable&&(this._closeButton=new HeaderButton(this,this._closeLabel,"lm_close",()=>s())),this.processTabDropdownActiveChanged()}get show(){return this._show}get side(){return this._side}get leftRightSided(){return this._leftRightSided}get dockEnabled(){return this._dockEnabled}get layoutManager(){return this._layoutManager}get parent(){return this._parent}get tabs(){return this._tabsContainer.tabs}get activeContentItem(){const t=this._getActiveComponentItemEvent();return void 0===t?null:t}get element(){return this._element}get tabsContainer(){return this._tabsContainer.element}get tabsContainerElement(){return this._tabsContainer.element}get controlsContainerElement(){return this._controlsContainerElement}get controlsContainer(){return this._controlsContainerElement}destroy(){this.emit("destroy"),this._dockEvent=void 0,this._popoutEvent=void 0,this._maximiseToggleEvent=void 0,this._clickEvent=void 0,this._touchStartEvent=void 0,this._componentRemoveEvent=void 0,this._componentFocusEvent=void 0,this._componentDragStartEvent=void 0,this._tabsContainer.destroy(),globalThis.document.removeEventListener("mouseup",this._documentMouseUpListener),this._element.remove()}createTab(t,e){this._tabsContainer.createTab(t,e)}removeTab(t){this._tabsContainer.removeTab(t)}processActiveComponentChanged(t){this._tabsContainer.processActiveComponentChanged(t),this.updateTabSizes()}setSide(t){this._side=t,this._leftRightSided=[Side.right,Side.left].includes(this._side)}setRowColumnClosable(t){this._rowColumnClosable=t,this.updateClosability()}updateClosability(){let t;if(this._configClosable){if(this._rowColumnClosable){t=!0;const e=this.tabs.length;for(let i=0;i<e;i++){if(!this._tabsContainer.tabs[i].componentItem.isClosable){t=!1;break}}}else t=!1;null!==this._closeButton&&setElementDisplayVisibility(this._closeButton.element,t)}else t=!1;this._canRemoveComponent=t||this._tabsContainer.tabCount>1}setDockable(t){return!(null===this._dockButton||!this._dockEnabled)&&(setElementDisplayVisibility(this._dockButton.element,t),!0)}applyFocusedValue(t){t?this._element.classList.add("lm_focused"):this._element.classList.remove("lm_focused")}processMaximised(){if(void 0===this._maximiseButton)throw new UnexpectedUndefinedError("HPMAX16997");this._maximiseButton.element.setAttribute("title",this._minimiseLabel)}processMinimised(){if(void 0===this._maximiseButton)throw new UnexpectedUndefinedError("HPMIN16997");this._maximiseButton.element.setAttribute("title",this._maximiseLabel)}updateTabSizes(){if(this._tabsContainer.tabCount>0){const t=this._show?this._layoutManager.layoutConfig.dimensions.headerHeight:0;let e;this._leftRightSided?(this._element.style.height="",this._element.style.width=numberToPixels(t)):(this._element.style.width="",this._element.style.height=numberToPixels(t)),e=this._leftRightSided?this._element.offsetHeight-this._controlsContainerElement.offsetHeight-this._tabControlOffset:this._element.offsetWidth-this._controlsContainerElement.offsetWidth-this._tabControlOffset,this._tabsContainer.updateTabSizes(e,this._getActiveComponentItemEvent())}}handleTabInitiatedComponentRemoveEvent(t){if(this._canRemoveComponent){if(void 0===this._componentRemoveEvent)throw new UnexpectedUndefinedError("HHTCE22294");this._componentRemoveEvent(t)}}handleTabInitiatedComponentFocusEvent(t){if(void 0===this._componentFocusEvent)throw new UnexpectedUndefinedError("HHTAE22294");this._componentFocusEvent(t)}handleTabInitiatedDragStartEvent(t,e,i,n){if(this._canRemoveComponent){if(void 0===this._componentDragStartEvent)throw new UnexpectedUndefinedError("HHTDSE22294");this._componentDragStartEvent(t,e,i,n)}else i.cancelDrag()}processTabDropdownActiveChanged(){setElementDisplayVisibility(this._tabDropdownButton.element,this._tabsContainer.dropdownActive)}handleButtonDockEvent(){if(void 0===this._dockEvent)throw new UnexpectedUndefinedError("HHBDE17834");this._dockEvent()}handleButtonPopoutEvent(){if(this._layoutManager.layoutConfig.settings.popoutWholeStack){if(void 0===this._popoutEvent)throw new UnexpectedUndefinedError("HHBPOE17834");this._popoutEvent()}else{const t=this._getActiveComponentItemEvent();if(null===t)throw new UnexpectedNullError("HOPC70222");t.popout()}}handleButtonMaximiseToggleEvent(t){if(void 0===this._maximiseToggleEvent)throw new UnexpectedUndefinedError("HHBMTE16834");this._maximiseToggleEvent()}onClick(t){t.target===this._element&&this.notifyClick(t)}onTouchStart(t){t.target===this._element&&this.notifyTouchStart(t)}notifyClick(t){if(void 0===this._clickEvent)throw new UnexpectedUndefinedError("HNHC46834");this._clickEvent(t)}notifyTouchStart(t){if(void 0===this._touchStartEvent)throw new UnexpectedUndefinedError("HNHTS46834");this._touchStartEvent(t)}};