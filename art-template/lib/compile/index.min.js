"use strict";var Compiler=require("./compiler"),defaults=require("./defaults"),TemplateError=require("./error"),debugRender=function(e,r){r.onerror(e,r);function t(){return"{Template Error}"}return t.mappings=[],t.sourcesContent=[],t},compile=function n(e,r){var i=1<arguments.length&&void 0!==r?r:{};"string"!=typeof e?i=e:i.source=e,e=(i=defaults.$extend(i)).source,!0===i.debug&&(i.cache=!1,i.minimize=!1,i.compileDebug=!0),i.compileDebug&&(i.minimize=!1),i.filename&&(i.filename=i.resolveFilename(i.filename,i));var t=i.filename,o=i.cache,a=i.caches;if(o&&t){var u=a.get(t);if(u)return u}if(!e)try{e=i.loader(t,i),i.source=e}catch(e){var c=new TemplateError({name:"CompileError",path:t,message:"template not found: "+e.message,stack:e.stack});if(i.bail)throw c;return debugRender(c,i)}var l=void 0,m=new Compiler(i);try{l=m.build()}catch(c){if(c=new TemplateError(c),i.bail)throw c;return debugRender(c,i)}function p(r,t){try{return l(r,t)}catch(e){if(!i.compileDebug)return i.cache=!1,i.compileDebug=!0,n(i)(r,t);if(e=new TemplateError(e),i.bail)throw e;return debugRender(e,i)()}}return p.mappings=l.mappings,p.sourcesContent=l.sourcesContent,p.toString=function(){return l.toString()},o&&t&&a.set(t,p),p};compile.Compiler=Compiler,module.exports=compile;