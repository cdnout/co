"use strict";var artRule={test:/{{([@#]?)[ \t]*(\/?)([\w\W]*?)[ \t]*}}/,use:function(a,e,t,i){function n(e,t){console.warn((u.filename||"anonymous")+":"+(a.line+1)+":"+(a.start+1)+"\nTemplate upgrade: {{"+e+"}} -> {{"+t+"}}")}var r,u=this.options,s=this.getEsTokens(i),c=s.map(function(e){return e.value}),l={},o=void 0,f=!!e&&"raw",p=t+c.shift();switch("#"===e&&n("#value","@value"),p){case"set":i="var "+c.join("").trim();break;case"if":i="if("+c.join("").trim()+"){";break;case"else":var h=c.indexOf("if");i=~h?(c.splice(0,h+1),"}else if("+c.join("").trim()+"){"):"}else{";break;case"/if":i="}";break;case"each":(o=artRule._split(s)).shift(),"as"===o[1]&&(n("each object as value index","each object value index"),o.splice(1,1)),i="$each("+(o[0]||"$data")+",function("+(o[1]||"$value")+","+(o[2]||"$index")+"){";break;case"/each":i="})";break;case"block":(o=artRule._split(s)).shift(),i="block("+o.join(",").trim()+",function(){";break;case"/block":i="})";break;case"echo":p="print",n("echo value","value");case"print":case"include":case"extend":if(0!==c.join("").trim().indexOf("(")){(o=artRule._split(s)).shift(),i=p+"("+o.join(",")+")";break}default:~c.indexOf("|")&&(i=(r=s.reduce(function(e,t){var a=t.value,i=t.type;return"|"===a?e.push([]):"whitespace"!==i&&"comment"!==i&&(e.length||e.push([]),":"===a&&1===e[e.length-1].length?n("value | filter: argv","value | filter argv"):e[e.length-1].push(t)),e},[]).map(function(e){return artRule._split(e)})).reduce(function(e,t){var a=t.shift();return t.unshift(e),"$imports."+a+"("+t.join(",")+")"},r.shift().join(" ").trim())),f=f||"escape"}return l.code=i,l.output=f,l},_split:function(e){for(var t=0,a=(e=e.filter(function(e){var t=e.type;return"whitespace"!==t&&"comment"!==t})).shift(),i="punctuator",n=/\]|\)/,r=[[a]];t<e.length;){var u=e[t];u.type===i||a.type===i&&!n.test(a.value)?r[r.length-1].push(u):r.push([u]),a=u,t++}return r.map(function(e){return e.map(function(e){return e.value}).join("")})}};module.exports=artRule;