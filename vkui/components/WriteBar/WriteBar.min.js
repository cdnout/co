import _extends from"@babel/runtime/helpers/extends";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["className","style","before","inlineAfter","after","value","onChange","getRootRef","getRef","onHeightChange"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{usePlatform}from"../../hooks/usePlatform";import{useExternRef}from"../../hooks/useExternRef";import{hasReactNode,isFunction}from"../../lib/utils";import{useDOM}from"../../lib/dom";import{getClassName}from"../../helpers/getClassName";var WriteBar=function(e){var t=usePlatform(),r=e.className,a=e.style,o=e.before,i=e.inlineAfter,s=e.after,n=e.value,l=e.onChange,u=e.getRootRef,c=e.getRef,m=e.onHeightChange,e=_objectWithoutProperties(e,_excluded),f=null!=n,p=useDOM().window,d=useExternRef(c),h=React.useRef(null),g=React.useCallback(function(){var e,t,r,a,o=d.current;o&&(e=o.offsetHeight,r=o.scrollHeight,t=p.getComputedStyle(o),a=parseInt(t.paddingTop),t=parseInt(t.paddingBottom),null===h.current&&(h.current=e),r+(r=a+t+10)<=e&&(r=0),o.style.height="0px",a=o.scrollHeight-r/4,o.style.height=String(Math.max(a,h.current))+"px",isFunction(m)&&m())},[m,d,p]);return React.useEffect(function(){g()},[g,n]),createScopedElement("div",{ref:u,vkuiClass:getClassName("WriteBar",t),className:r,style:a},createScopedElement("form",{vkuiClass:"WriteBar__form",onSubmit:function(e){return e.preventDefault()}},hasReactNode(o)&&createScopedElement("div",{vkuiClass:"WriteBar__before"},o),createScopedElement("div",{vkuiClass:"WriteBar__formIn"},createScopedElement("textarea",_extends({},e,{vkuiClass:"WriteBar__textarea",onChange:function(e){isFunction(l)&&l(e),f||g()},ref:d,value:n})),hasReactNode(i)&&createScopedElement("div",{vkuiClass:"WriteBar__inlineAfter"},i)),hasReactNode(s)&&createScopedElement("div",{vkuiClass:"WriteBar__after"},s)))};export{WriteBar};