import _objectSpread from"@babel/runtime/helpers/objectSpread2";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _extends from"@babel/runtime/helpers/extends";import _defineProperty from"@babel/runtime/helpers/defineProperty";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["name","min","max","dayPlaceholder","monthPlaceholder","yearPlaceholder","popupDirection","defaultValue","hasMouse","monthNames","day","month","year","onDateChange","disabled"],_excluded2=["min","max","dayPlaceholder","monthPlaceholder","yearPlaceholder","popupDirection","defaultValue","hasMouse","day","month","year","onDateChange"],_excluded3=["hasMouse","defaultValue"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{Input}from"../Input/Input";import{withAdaptivity}from"../../hoc/withAdaptivity";import{leadingZero}from"../../lib/utils";import{CustomSelect}from"../CustomSelect/CustomSelect";var DefaultMonths=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"];function convertToInputFormat(e){var t=e.day,t=void 0===t?0:t,a=e.month,a=void 0===a?0:a,e=e.year;return"".concat(void 0===e?0:e,"-").concat(leadingZero(a),"-").concat(leadingZero(t))}function parseInputDate(e){e=e.split("-");return{day:Number(e[2]),month:Number(e[1]),year:Number(e[0])}}function getMonthMaxDay(e,t){return e?new Date(t||2016,e,0).getDate():31}var range=function(e,t){for(var a=t<e,o=[],r=Math.min(e,t);r<=Math.max(e,t);r++)o.push(r);return a?o.reverse():o},DatePickerCustom=function(e){function t(e){null!=s&&s(_defineProperty({day:m,month:p,year:h},e.target.name,Number(e.target.value)))}var a=e.name,o=e.min,o=void 0===o?{day:0,month:0,year:0}:o,r=e.max,r=void 0===r?{day:31,month:12,year:2100}:r,n=e.dayPlaceholder,i=e.monthPlaceholder,l=e.yearPlaceholder,u=e.popupDirection,d=(e.defaultValue,e.hasMouse,e.monthNames),c=e.day,m=void 0===c?0:c,c=e.month,p=void 0===c?0:c,c=e.year,h=void 0===c?0:c,s=e.onDateChange,c=e.disabled,e=_objectWithoutProperties(e,_excluded),y=range(1,getMonthMaxDay(p,h)).map(function(e){return{label:String(e),value:e}}),d=(d||DefaultMonths).map(function(e,t){return{label:e,value:t+1}}),r=range(r.year,o.year).map(function(e){return{label:String(e),value:e}});return createScopedElement("div",_extends({vkuiClass:"DatePicker"},e),createScopedElement("div",{vkuiClass:"DatePicker__container"},createScopedElement("div",{vkuiClass:"DatePicker__day"},createScopedElement(CustomSelect,{name:"day",value:m,options:y,placeholder:n,popupDirection:u,onChange:t,disabled:c})),createScopedElement("div",{vkuiClass:"DatePicker__month"},createScopedElement(CustomSelect,{vkuiClass:"DatePicker__monthSelect",name:"month",value:p,options:d,placeholder:i,popupDirection:u,onChange:t,disabled:c})),createScopedElement("div",{vkuiClass:"DatePicker__year"},createScopedElement(CustomSelect,{name:"year",value:h,options:r,placeholder:l,popupDirection:u,onChange:t,disabled:c}))),createScopedElement("input",{type:"hidden",name:a,value:convertToInputFormat({day:m,month:p,year:h})}))},DatePickerNative=function(e){var t=e.min,t=void 0===t?{day:0,month:0,year:0}:t,a=e.max,a=void 0===a?{day:31,month:12,year:2100}:a,o=(e.dayPlaceholder,e.monthPlaceholder,e.yearPlaceholder,e.popupDirection,e.defaultValue,e.hasMouse,e.day),r=e.month,n=e.year,i=e.onDateChange,e=_objectWithoutProperties(e,_excluded2),o=o&&r&&n?{defaultValue:convertToInputFormat({day:o,month:r,year:n})}:{},r=React.useCallback(function(e){null!=i&&i(parseInputDate(e.currentTarget.value))},[i]);return createScopedElement(Input,_extends({},e,{type:"date",onChange:r,min:convertToInputFormat(t),max:convertToInputFormat(a)},o))},DatePicker=function(e){var t=e.hasMouse,a=e.defaultValue,o=_objectWithoutProperties(e,_excluded3),e=React.useState(function(){return{day:(null==a?void 0:a.day)||0,month:(null==a?void 0:a.month)||0,year:(null==a?void 0:a.year)||0}}),e=_slicedToArray(e,2),r=e[0],n=e[1],e=React.useCallback(function(e){n(e),o.onDateChange&&o.onDateChange(_objectSpread({},e))},[o]);return createScopedElement(t?DatePickerCustom:DatePickerNative,_extends({},o,r,{onDateChange:e}))};export default withAdaptivity(DatePicker,{hasMouse:!0});