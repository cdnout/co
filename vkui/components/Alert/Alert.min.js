import _extends from"@babel/runtime/helpers/extends";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inherits from"@babel/runtime/helpers/inherits";import _createSuper from"@babel/runtime/helpers/createSuper";import _defineProperty from"@babel/runtime/helpers/defineProperty";var _excluded=["actions","actionsLayout","children","className","style","platform","viewWidth","text","header"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import Tappable from"../Tappable/Tappable";import{PopoutWrapper}from"../PopoutWrapper/PopoutWrapper";import{getClassName}from"../../helpers/getClassName";import{classNames}from"../../lib/classNames";import{transitionEvent}from"../../lib/supportEvents";import{ANDROID,VKCOM,IOS}from"../../lib/platform";import{withPlatform}from"../../hoc/withPlatform";import{withAdaptivity,ViewWidth}from"../../hoc/withAdaptivity";import{Button}from"../Button/Button";import{hasReactNode}from"../../lib/utils";import Headline from"../Typography/Headline/Headline";import{Title}from"../Typography/Title/Title";import{Caption}from"../Typography/Caption/Caption";import ModalDismissButton from"../ModalDismissButton/ModalDismissButton";import{FocusTrap}from"../FocusTrap/FocusTrap";var AlertComponent=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var o;return _classCallCheck(this,i),o=t.call(this,e),_defineProperty(_assertThisInitialized(o),"element",void 0),_defineProperty(_assertThisInitialized(o),"transitionFinishTimeout",void 0),_defineProperty(_assertThisInitialized(o),"onItemClick",function(e){return function(){var i=e.action,r=e.autoclose;r?(o.setState({closing:!0}),o.waitTransitionFinish(function(e){var t;e&&"opacity"!==e.propertyName||(r&&null!=(t=(e=o.props).onClose)&&t.call(e),i&&i())})):i&&i()}}),_defineProperty(_assertThisInitialized(o),"onClose",function(){o.setState({closing:!0}),o.waitTransitionFinish(function(e){var t;e&&"opacity"!==e.propertyName||null!=(t=(e=o.props).onClose)&&t.call(e)})}),_defineProperty(_assertThisInitialized(o),"stopPropagation",function(e){e.stopPropagation()}),_defineProperty(_assertThisInitialized(o),"renderAction",function(e,t){var i=o.props.platform;if(i===IOS)return r=e.Component,createScopedElement(Tappable,{Component:e.href?"a":void 0===r?"button":r,vkuiClass:classNames("Alert__action","Alert__action--".concat(e.mode)),onClick:o.onItemClick(e),href:e.href,key:"alert-action-".concat(t),target:e.target},e.title);var r="cancel"===e.mode?"secondary":"primary";return i===ANDROID&&(r="tertiary",o.props.viewWidth===ViewWidth.DESKTOP&&"destructive"===e.mode&&(r="destructive")),createScopedElement(Button,{vkuiClass:classNames("Alert__button","Alert__button--".concat(e.mode)),mode:r,size:"m",onClick:o.onItemClick(e),Component:e.Component,href:e.href,key:"alert-action-".concat(t),target:e.target},e.title)}),o.element=React.createRef(),o.state={closing:!1},o}return _createClass(i,[{key:"timeout",get:function(){return this.props.platform===ANDROID||this.props.platform===VKCOM?200:300}},{key:"waitTransitionFinish",value:function(e){transitionEvent.supported&&this.element.current?(this.element.current.removeEventListener(transitionEvent.name,e),this.element.current.addEventListener(transitionEvent.name,e)):(this.transitionFinishTimeout&&clearTimeout(this.transitionFinishTimeout),this.transitionFinishTimeout=setTimeout(e.bind(this),this.timeout))}},{key:"renderHeader",value:function(e){switch(this.props.platform){case VKCOM:return createScopedElement(Headline,{vkuiClass:"Alert__header",weight:"medium"},e);case IOS:return createScopedElement(Title,{vkuiClass:"Alert__header",weight:"1",level:"3"},e);case ANDROID:return createScopedElement(Title,{vkuiClass:"Alert__header",weight:"2",level:"2"},e);default:return}}},{key:"renderText",value:function(e){switch(this.props.platform){case VKCOM:return createScopedElement(Caption,{vkuiClass:"Alert__text"},e);case IOS:return createScopedElement(Caption,{vkuiClass:"Alert__text",level:"2"},e);case ANDROID:return createScopedElement(Headline,{vkuiClass:"Alert__text",weight:"regular"},e);default:return}}},{key:"render",value:function(){var e=this.props,t=e.actions,i=e.actionsLayout,r=e.children,o=e.className,a=e.style,n=e.platform,s=e.viewWidth,l=e.text,p=e.header,e=_objectWithoutProperties(e,_excluded),c=this.state.closing,i=n===VKCOM?"horizontal":i,m=n===VKCOM||n===ANDROID&&s>=ViewWidth.SMALL_TABLET,s=s>=ViewWidth.SMALL_TABLET;return createScopedElement(PopoutWrapper,{className:o,closing:c,style:a,onClick:this.onClose},createScopedElement(FocusTrap,_extends({},e,{getRootRef:this.element,onClick:this.stopPropagation,onClose:this.onClose,timeout:this.timeout,vkuiClass:classNames(getClassName("Alert",n),{"Alert--v":"vertical"===i,"Alert--h":"horizontal"===i,"Alert--closing":c,"Alert--desktop":s})}),m&&createScopedElement(ModalDismissButton,{onClick:this.onClose}),createScopedElement("div",{vkuiClass:"Alert__content"},hasReactNode(p)&&this.renderHeader(p),hasReactNode(l)&&this.renderText(l),r),createScopedElement("footer",{vkuiClass:"Alert__actions"},null==t?void 0:t.map(this.renderAction))))}}]),i}(React.Component),Alert=(_defineProperty(AlertComponent,"defaultProps",{actionsLayout:"horizontal",actions:[]}),withPlatform(withAdaptivity(AlertComponent,{viewWidth:!0})));export{Alert};