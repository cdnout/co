import _extends from"@babel/runtime/helpers/extends";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectSpread from"@babel/runtime/helpers/objectSpread2";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{ModalType}from"./types";import{warnOnce}from"../../lib/warnOnce";import{getNavId}from"../../lib/getNavId";import{useIsomorphicLayoutEffect}from"../../lib/useIsomorphicLayoutEffect";import{noop,isFunction}from"../../lib/utils";function getModals(e){return React.Children.toArray(e)}var warn=warnOnce("ModalRoot");function modalTransitionReducer(e,o){var n,t,i,a;return"setActive"===o.type&&o.id!==e.activeModal?(n=o.id,t=e.exitingModal||e.activeModal,i=e.history?_toConsumableArray(e.history):[],a=Boolean(n&&i.includes(n)),null===n?i=[]:a?i=i.splice(0,i.indexOf(n)+1):i.push(n),{activeModal:n,enteringModal:null,exitingModal:t,history:i,isBack:a}):"entered"===o.type&&o.id===e.enteringModal?_objectSpread(_objectSpread({},e),{},{enteringModal:null}):"exited"===o.type&&o.id===e.exitingModal?_objectSpread(_objectSpread({},e),{},{exitingModal:null}):"inited"===o.type&&o.id===e.activeModal?_objectSpread(_objectSpread({},e),{},{enteringModal:o.id}):e}function useModalManager(e,o){function n(e){return null!=e&&(null==(e=d[e])?void 0:e.type)===ModalType.CARD}var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:noop,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:noop,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:noop,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:noop,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:noop,d=React.useRef({}).current,c=(getModals(o).forEach(function(e){var o=e.props,n=getNavId(o,warn),n=void 0!==n&&d[n]||{id:null!=n?n:null};n.onOpen=e.props.onOpen,n.onOpened=e.props.onOpened,n.onClose=e.props.onClose,n.onClosed=e.props.onClosed,n.dynamicContentHeight=!!o.dynamicContentHeight,"number"==typeof o.settlingHeight&&(n.settlingHeight=o.settlingHeight),null!==n.id&&(d[n.id]=n)}),e&&!d[e]),u=c?null:e,s=React.useReducer(modalTransitionReducer,{activeModal:u,enteringModal:null,exitingModal:null,history:u?[u]:[],isBack:!1}),s=_slicedToArray(s,2),p=s[0],m=s[1],s=(useIsomorphicLayoutEffect(function(){"development"===process.env.NODE_ENV&&c&&warn("Can't transition - modal ".concat(e," not found"),"error"),m({type:"setActive",id:null!=u?u:null})},[e]),useIsomorphicLayoutEffect(function(){p.activeModal&&(l(d[p.activeModal]),m({type:"inited",id:p.activeModal}))},[p.activeModal]),React.useCallback(function(e){var o;e&&(o=d[e],isFunction(o.onOpened)?o.onOpened():isFunction(i)&&i(e)),m({type:"entered",id:e})},[d,i])),M=React.useCallback(function(e){var o;e&&(o=d[e],isFunction(o.onClosed)?o.onClosed():isFunction(r)&&r(e)),m({type:"exited",id:e})},[d,r]),f=Boolean(p.exitingModal&&(n(e)||n(p.exitingModal))),v=React.useCallback(function(e){return d[e]},[d]);return _objectSpread(_objectSpread({onEnter:function(){var e=p.activeModal&&d[p.activeModal];e&&(isFunction(e.onOpen)?e.onOpen():isFunction(t)&&t(e.id))},onEntered:s,onExit:function(){var e=p.activeModal&&d[p.activeModal];e&&(isFunction(e.onClose)?e.onClose():isFunction(a)&&a(e.id))},onExited:M},p),{},{delayEnter:f,getModalState:v})}function withModalManager(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:noop;return function(n){return function(e){var o=useModalManager(e.activeModal,e.children,e.onOpen,e.onOpened,e.onClose,e.onClosed,t);return createScopedElement(n,_extends({},e,o))}}}export{modalTransitionReducer,useModalManager,withModalManager};