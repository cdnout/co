import _extends from"@babel/runtime/helpers/extends";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["Component","onClose","restoreFocus","timeout","getRootRef","children"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{useExternRef}from"../../hooks/useExternRef";import{useGlobalEventListener}from"../../hooks/useGlobalEventListener";import{useTimeout}from"../../hooks/useTimeout";import{FOCUSABLE_ELEMENTS_LIST,Keys,pressedKey}from"../../lib/accessibility";import{useDOM}from"../../lib/dom";import{useIsomorphicLayoutEffect}from"../../lib/useIsomorphicLayoutEffect";import{noop}from"../../lib/utils";import{AppRootContext}from"../AppRoot/AppRootContext";var FOCUSABLE_ELEMENTS=FOCUSABLE_ELEMENTS_LIST.join(),FocusTrap=function(e){var t=e.Component,t=void 0===t?"div":t,o=e.onClose,n=void 0===o?noop:o,o=e.restoreFocus,r=void 0===o||o,o=e.timeout,o=void 0===o?0:o,i=e.getRootRef,u=e.children,e=_objectWithoutProperties(e,_excluded),s=useExternRef(i),i=useDOM(),c=i.document,l=i.window,i=React.useState(null),i=_slicedToArray(i,2),p=i[0],m=i[1],i=React.useState(null),i=_slicedToArray(i,2),f=i[0],a=i[1],E=React.useContext(AppRootContext).keyboardInput,d=useTimeout(function(){var e;!E||null!=(e=s.current)&&e.contains(c.activeElement)||null==p||!p.length||p[0].focus()},o),y=(useIsomorphicLayoutEffect(function(){d.set()},[]),useIsomorphicLayoutEffect(function(){if(!s.current)return noop();var r=[];return Array.prototype.forEach.call(s.current.querySelectorAll(FOCUSABLE_ELEMENTS),function(e){var t=l.getComputedStyle(e),o=t.display,t=t.visibility;"none"!==o&&"hidden"!==t&&r.push(e)}),null!=r&&r.length&&m(r),noop()},[u]),useTimeout(function(){f&&f.focus()},o));useIsomorphicLayoutEffect(function(){return r&&c.activeElement?(a(c.activeElement),function(){y.set()}):noop()},[r]);return useGlobalEventListener(c,"keydown",function(t){if(pressedKey(t)===Keys.TAB&&null!=p&&p.length){var e=p.length-1,o=p.findIndex(function(e){return e===t.target}),r=-1===o||o===e&&!t.shiftKey;if(r||0===o&&t.shiftKey)return t.preventDefault(),(o=p[r?0:e])!==c.activeElement&&o.focus(),!1}return pressedKey(t)===Keys.ESCAPE&&n(),!0},{capture:!0}),createScopedElement(t,_extends({ref:s},e),u)};export{FocusTrap};