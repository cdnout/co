import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _extends from"@babel/runtime/helpers/extends";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["platform","children"],_excluded2=["before","className","defaultValue","placeholder","after","getRef","platform","icon","onIconClick","style"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{classNames}from"../../lib/classNames";import{withPlatform}from"../../hoc/withPlatform";import{getClassName}from"../../helpers/getClassName";import{Icon16SearchOutline,Icon16Clear,Icon24Cancel}from"@vkontakte/icons";import{IOS,VKCOM,ANDROID}from"../../lib/platform";import{Touch}from"../Touch/Touch";import{noop}from"../../lib/utils";import Text from"../Typography/Text/Text";import{Title}from"../Typography/Title/Title";import Headline from"../Typography/Headline/Headline";import Separator from"../Separator/Separator";import{useExternRef}from"../../hooks/useExternRef";import{useEnsuredControl}from"../../hooks/useEnsuredControl";var SearchPlaceholderTypography=function(e){var r=e.platform,t=e.children,a=_objectWithoutProperties(e,_excluded);switch(r){case IOS:return createScopedElement(Title,_extends({},a,{level:"3",weight:"3"}),t);case VKCOM:return createScopedElement(Text,_extends({},a,{weight:"regular"}),t);default:return createScopedElement(Headline,_extends({},a,{weight:"regular"}),t)}},Search=function(e){var r=e.before,t=e.className,a=e.defaultValue,o=e.placeholder,l=e.after,c=e.getRef,n=e.platform,i=e.icon,s=e.onIconClick,u=void 0===s?noop:s,s=e.style,p=_objectWithoutProperties(e,_excluded2),d=useExternRef(c),e=React.useState(!1),c=_slicedToArray(e,2),e=c[0],m=c[1],c=useEnsuredControl(p,{defaultValue:a}),a=_slicedToArray(c,2),c=a[0],a=a[1],h=React.useCallback(function(){var e,r=null==(r=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"))?void 0:r.set,r=(null!=r&&r.call(d.current,""),new Event("input",{bubbles:!0}));null!=(e=d.current)&&e.dispatchEvent(r)},[d]),f=React.useCallback(function(e){return u(e.originalEvent)},[u]),S=React.useCallback(function(e){e.originalEvent.preventDefault(),null!=(e=d.current)&&e.focus(),h()},[d,h]);return createScopedElement("div",{vkuiClass:classNames(getClassName("Search",n),{"Search--focused":e,"Search--has-value":!!c,"Search--has-after":!!l,"Search--has-icon":!!i}),className:t,style:s},createScopedElement("div",{vkuiClass:"Search__in"},createScopedElement("div",{vkuiClass:"Search__width"}),createScopedElement("label",{vkuiClass:"Search__control"},createScopedElement("input",_extends({type:"search"},p,{ref:d,vkuiClass:"Search__input",onFocus:function(e){m(!0),p.onFocus&&p.onFocus(e)},onBlur:function(e){m(!1),p.onBlur&&p.onBlur(e)},onChange:a,value:c})),n===IOS&&l&&createScopedElement("div",{vkuiClass:"Search__after-width"},l),createScopedElement("div",{vkuiClass:"Search__placeholder"},createScopedElement("div",{vkuiClass:"Search__placeholder-in"},r,createScopedElement(SearchPlaceholderTypography,{vkuiClass:"Search__placeholder-text",platform:n},o)),e&&n===IOS&&l&&createScopedElement("div",{vkuiClass:"Search__after-width"},l))),createScopedElement("div",{vkuiClass:"Search__after",onClick:h},createScopedElement("div",{vkuiClass:"Search__icons"},i&&createScopedElement(Touch,{onStart:f,vkuiClass:"Search__icon"},i),!!c&&createScopedElement(Touch,{onStart:S,vkuiClass:"Search__icon"},createScopedElement(n===IOS?Icon16Clear:Icon24Cancel,null))),n===IOS&&l&&createScopedElement("div",{vkuiClass:"Search__after-in"},l))),n===VKCOM&&createScopedElement(Separator,{vkuiClass:"Search__separator",wide:!0}))};Search.defaultProps={autoComplete:"off",defaultValue:"",placeholder:"Поиск",after:"Отмена",before:createScopedElement(Icon16SearchOutline,null)};export default withPlatform(Search);