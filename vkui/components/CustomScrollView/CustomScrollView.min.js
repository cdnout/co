import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inherits from"@babel/runtime/helpers/inherits";import _createSuper from"@babel/runtime/helpers/createSuper";import _defineProperty from"@babel/runtime/helpers/defineProperty";import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{withDOM}from"../../lib/dom";import{multiRef,setRef}from"../../lib/utils";var CustomScrollView=function(e){_inherits(o,e);var i=_createSuper(o);function o(){var s;_classCallCheck(this,o);for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return s=i.call.apply(i,[this].concat(r)),_defineProperty(_assertThisInitialized(s),"ratio",NaN),_defineProperty(_assertThisInitialized(s),"lastTrackerTop",0),_defineProperty(_assertThisInitialized(s),"clientHeight",0),_defineProperty(_assertThisInitialized(s),"trackerHeight",0),_defineProperty(_assertThisInitialized(s),"scrollHeight",0),_defineProperty(_assertThisInitialized(s),"transformProp",""),_defineProperty(_assertThisInitialized(s),"startY",0),_defineProperty(_assertThisInitialized(s),"trackerTop",0),_defineProperty(_assertThisInitialized(s),"box",multiRef(function(e){return setRef(e,s.props.boxRef)})),_defineProperty(_assertThisInitialized(s),"barY",React.createRef()),_defineProperty(_assertThisInitialized(s),"trackerY",React.createRef()),_defineProperty(_assertThisInitialized(s),"resize",function(){var e,r,t,i;s.box.current&&s.barY.current&&s.trackerY.current&&(t=(e=s.box.current.clientHeight)/(r=s.box.current.scrollHeight),i=Math.max(e*t,40),s.ratio=t,s.clientHeight=e,s.scrollHeight=r,s.trackerHeight=i,1<=t?s.barY.current.style.display="none":(s.barY.current.style.display="",s.trackerY.current.style.height="".concat(i,"px"),s.setTrackerPositionFromScroll(s.box.current.scrollTop)))}),_defineProperty(_assertThisInitialized(s),"scroll",function(){1<=s.ratio||!s.box.current||s.setTrackerPositionFromScroll(s.box.current.scrollTop)}),_defineProperty(_assertThisInitialized(s),"onDragStart",function(e){e.preventDefault(),s.startY=e.clientY,s.trackerTop=s.lastTrackerTop,s.props.document.addEventListener("mousemove",s.onMove),s.props.document.addEventListener("mouseup",s.onUp)}),_defineProperty(_assertThisInitialized(s),"onMove",function(e){e.preventDefault();e=e.clientY-s.startY,e=Math.min(Math.max(s.trackerTop+e,0),s.clientHeight-s.trackerHeight);s.setScrollPositionFromTracker(e)}),_defineProperty(_assertThisInitialized(s),"onUp",function(e){e.preventDefault(),s.props.document.removeEventListener("mousemove",s.onMove),s.props.document.removeEventListener("mouseup",s.onUp)}),s}return _createClass(o,[{key:"componentDidMount",value:function(){this.chooseTransformProp(),this.resize(),this.props.windowResize&&this.props.window.addEventListener("resize",this.resize)}},{key:"componentDidUpdate",value:function(){this.resize()}},{key:"componentWillUnmount",value:function(){this.props.window.removeEventListener("resize",this.resize)}},{key:"chooseTransformProp",value:function(){var e=null==(e=this.trackerY.current)?void 0:e.style,r="";void 0!==e&&("transform"in e?r="transform":"webkitTransform"in e&&(r="webkitTransform")),this.transformProp=r}},{key:"setTrackerPosition",value:function(e){this.lastTrackerTop=e,null!==this.trackerY.current&&(this.trackerY.current.style[this.transformProp]="translate(0, ".concat(e,"px)"))}},{key:"setTrackerPositionFromScroll",value:function(e){e/=this.scrollHeight-this.clientHeight;this.setTrackerPosition((this.clientHeight-this.trackerHeight)*e)}},{key:"setScrollPositionFromTracker",value:function(e){e/=this.clientHeight-this.trackerHeight;null!==this.box.current&&(this.box.current.scrollTop=(this.scrollHeight-this.clientHeight)*e)}},{key:"render",value:function(){var e=this.props,r=e.children,e=e.className;return createScopedElement("div",{vkuiClass:"CustomScrollView",className:e},createScopedElement("div",{vkuiClass:"CustomScrollView__barY",ref:this.barY},createScopedElement("div",{vkuiClass:"CustomScrollView__trackerY",ref:this.trackerY,onMouseDown:this.onDragStart})),createScopedElement("div",{vkuiClass:"CustomScrollView__box",tabIndex:-1,ref:this.box,onScroll:this.scroll},r))}}]),o}(React.Component);export default withDOM(CustomScrollView);