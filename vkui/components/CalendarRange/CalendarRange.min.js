import _extends from"@babel/runtime/helpers/extends";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["value","onChange","disablePast","disableFuture","shouldDisableDate","onClose","weekStartsOn","getRootRef","disablePickers","prevMonthAriaLabel","nextMonthAriaLabel","changeMonthAriaLabel","changeYearAriaLabel","changeDayAriaLabel"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{addMonths,isSameMonth,isSameDay,isBefore,isAfter,startOfDay,endOfDay,isWithinInterval}from"../../lib/date";import{CalendarHeader}from"../CalendarHeader/CalendarHeader";import{CalendarDays}from"../CalendarDays/CalendarDays";import{navigateDate,setTimeEqual,isLastDay,isFirstDay}from"../../lib/calendar";import{useCalendar}from"../../hooks/useCalendar";var getIsDaySelected=function(e,a){return!(null==a||!a[0]||!a[1])&&Boolean(isWithinInterval(e,startOfDay(a[0]),endOfDay(a[1])))},CalendarRange=function(e){var n=e.value,a=e.onChange,t=e.disablePast,i=e.disableFuture,r=e.shouldDisableDate,l=(e.onClose,e.weekStartsOn),l=void 0===l?1:l,o=e.getRootRef,s=e.disablePickers,d=e.prevMonthAriaLabel,c=e.nextMonthAriaLabel,u=e.changeMonthAriaLabel,D=e.changeYearAriaLabel,y=e.changeDayAriaLabel,y=void 0===y?"Изменить день":y,e=_objectWithoutProperties(e,_excluded),i=useCalendar({value:n,disableFuture:i,disablePast:t,shouldDisableDate:r}),b=i.viewDate,h=i.setViewDate,t=i.setPrevMonth,r=i.setNextMonth,m=i.focusedDay,v=i.setFocusedDay,C=i.isDayFocused,S=i.isDayDisabled,i=i.resetSelectedDay,f=React.useState(),f=_slicedToArray(f,2),p=f[0],g=f[1],f=addMonths(b,1),A=React.useCallback(function(e){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&e.preventDefault();e=navigateDate(null!=m?m:null==n?void 0:n[1],e.key);!e||isSameMonth(e,b)||isSameMonth(e,addMonths(b,1))||h(e),v(e)},[m,v,h,n,b]),k=React.useCallback(function(e){if(!n)return[e,null];var a=n[0],t=n[1];return a&&isSameDay(e,a)||t&&isSameDay(e,t)?[setTimeEqual(e,a),setTimeEqual(e,t)]:a&&isBefore(e,a)?[setTimeEqual(e,a),t]:a&&isAfter(e,a)?[a,setTimeEqual(e,t)]:n},[n]),R=React.useCallback(function(e){null!=a&&a(k(e)),g(void 0)},[a,k]),L=React.useCallback(function(e){return getIsDaySelected(e,n)},[n]),M=React.useCallback(function(e){return Boolean((null==n?void 0:n[0])&&isSameDay(e,n[0])||(null==n?void 0:n[1])&&isSameDay(e,n[1]))},[n]),E=React.useCallback(function(e,a){return Boolean(isLastDay(e,a)||(null==n?void 0:n[1])&&isSameDay(e,n[1]))},[n]),w=React.useCallback(function(e,a){return Boolean(isLastDay(e,a)||(null==p?void 0:p[1])&&isSameDay(e,p[1]))},[p]),_=React.useCallback(function(e,a){return Boolean(isFirstDay(e,a)||(null==n?void 0:n[0])&&isSameDay(e,n[0]))},[n]),x=React.useCallback(function(e,a){return Boolean(isFirstDay(e,a)||(null==p?void 0:p[0])&&isSameDay(e,p[0]))},[p]),P=React.useCallback(function(e){return g(k(e))},[g,k]),H=React.useCallback(function(){return g(void 0)},[g]),F=React.useCallback(function(e){return getIsDaySelected(e,p)},[p]);return createScopedElement("div",_extends({},e,{ref:o,vkuiClass:"CalendarRange"}),createScopedElement("div",{vkuiClass:"CalendarRange__inner"},createScopedElement(CalendarHeader,{viewDate:b,onChange:h,nextMonth:!1,onPrevMonth:t,disablePickers:s,vkuiClass:"CalendarRange__header",prevMonthAriaLabel:d,nextMonthAriaLabel:c,changeMonthAriaLabel:u,changeYearAriaLabel:D}),createScopedElement(CalendarDays,{viewDate:b,value:n,weekStartsOn:l,onKeyDown:A,isDayFocused:C,onDayChange:R,isDaySelected:L,isDayActive:M,isDaySelectionEnd:E,isDaySelectionStart:_,isDayHinted:F,onDayEnter:P,onDayLeave:H,isHintedDaySelectionEnd:w,isHintedDaySelectionStart:x,isDayDisabled:S,"aria-label":y})),createScopedElement("div",{vkuiClass:"CalendarRange__inner"},createScopedElement(CalendarHeader,{viewDate:f,onChange:h,prevMonth:!1,onNextMonth:r,disablePickers:s,vkuiClass:"CalendarRange__header",prevMonthAriaLabel:d,nextMonthAriaLabel:c,changeMonthAriaLabel:u,changeYearAriaLabel:D}),createScopedElement(CalendarDays,{viewDate:f,value:n,weekStartsOn:l,"aria-label":y,onKeyDown:A,isDayFocused:C,onDayChange:R,isDaySelected:L,isDayActive:M,isDaySelectionEnd:E,isDaySelectionStart:_,isDayHinted:F,onDayEnter:P,onDayLeave:H,isHintedDaySelectionEnd:w,isHintedDaySelectionStart:x,isDayDisabled:S,tabIndex:0,onBlur:i})))};export{CalendarRange};