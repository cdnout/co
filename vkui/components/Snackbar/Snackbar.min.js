import _extends from"@babel/runtime/helpers/extends";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["children","layout","action","before","after","viewWidth","duration","onActionClick","onClose"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{Touch}from"../Touch/Touch";import{classNames}from"../../lib/classNames";import{getClassName}from"../../helpers/getClassName";import{ANDROID,VKCOM}from"../../lib/platform";import{rubber}from"../../lib/touch";import{withAdaptivity,ViewWidth}from"../../hoc/withAdaptivity";import Text from"../Typography/Text/Text";import{Button}from"../Button/Button";import{AppRootPortal}from"../AppRoot/AppRootPortal";import{useWaitTransitionFinish}from"../../hooks/useWaitTransitionFinish";import{usePlatform}from"../../hooks/usePlatform";import{useTimeout}from"../../hooks/useTimeout";var SnackbarComponent=function(e){function t(){h(!0),f(C.current,function(){m()},y)}function o(e){null!==T.current&&cancelAnimationFrame(T.current),T.current=requestAnimationFrame(function(){_.current&&(_.current.style.transform="translate3d(".concat(e,"%, 0, 0)"))})}var r=e.children,a=e.layout,n=e.action,i=e.before,c=e.after,u=e.viewWidth,s=e.duration,s=void 0===s?0:s,l=e.onActionClick,m=e.onClose,e=_objectWithoutProperties(e,_excluded),p=usePlatform(),f=useWaitTransitionFinish().waitTransitionFinish,d=React.useState(!1),d=_slicedToArray(d,2),b=d[0],h=d[1],d=React.useState(!1),d=_slicedToArray(d,2),k=d[0],S=d[1],v=React.useRef(0),R=React.useRef(0),_=React.useRef(null),C=React.useRef(null),T=React.useRef(null),A=u>=ViewWidth.SMALL_TABLET,y=p===ANDROID||p===VKCOM?400:320,E=useTimeout(t,s),d=E.clear,u=(React.useEffect(function(){return E.set()},[E]),c||A?"vertical":a);return createScopedElement(AppRootPortal,null,createScopedElement("div",_extends({},e,{vkuiClass:classNames(getClassName("Snackbar",p),"Snackbar--l-".concat(u),{"Snackbar--closing":b,"Snackbar--touched":k,"Snackbar--desktop":A})}),createScopedElement(Touch,{vkuiClass:"Snackbar__in",getRootRef:C,onStart:d,onMoveX:function(e){var t=e.shiftX;e.originalEvent.preventDefault(),k||S(!0),v.current=t/(null!=(t=null==(e=_.current)?void 0:e.offsetWidth)?t:0)*100,R.current=rubber(v.current,72,1.2,p===ANDROID||p===VKCOM),o(R.current)},onEnd:function(e){var t,r;k?(r=R.current,r+=r/e.duration*240*.6,A&&r<=-50?(E.clear(),f(_.current,function(){m()},y),o(-120)):!A&&50<=r?(E.clear(),f(_.current,function(){m()},y),o(120)):t=function(){E.set(),o(0)}):E.set(),S(!1),t&&requestAnimationFrame(t)}},createScopedElement("div",{vkuiClass:"Snackbar__body",ref:_},i&&createScopedElement("div",{vkuiClass:"Snackbar__before"},i),createScopedElement("div",{vkuiClass:"Snackbar__content"},createScopedElement(Text,{weight:"regular",vkuiClass:"Snackbar__content-text"},r),n&&createScopedElement(Button,{align:"left",hasHover:!1,mode:"tertiary",size:"s",vkuiClass:"Snackbar__action",onClick:function(e){t(),n&&"function"==typeof l&&l(e)}},n)),c&&createScopedElement("div",{vkuiClass:"Snackbar__after"},c)))))},Snackbar=(SnackbarComponent.displayName="Snackbar",SnackbarComponent.defaultProps={duration:4e3,layout:"horizontal"},withAdaptivity(SnackbarComponent,{viewWidth:!0}));export{Snackbar};