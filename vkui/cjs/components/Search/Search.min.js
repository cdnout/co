"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("../../lib/jsxRuntime")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_classNames=require("../../lib/classNames"),_withPlatform=require("../../hoc/withPlatform"),_getClassName=require("../../helpers/getClassName"),_icons=require("@vkontakte/icons"),_platform=require("../../lib/platform"),_Touch=require("../Touch/Touch"),_utils=require("../../lib/utils"),_Text=_interopRequireDefault(require("../Typography/Text/Text")),_Title=require("../Typography/Title/Title"),_Headline=_interopRequireDefault(require("../Typography/Headline/Headline")),_Separator=_interopRequireDefault(require("../Separator/Separator")),_useExternRef=require("../../hooks/useExternRef"),_useEnsuredControl3=require("../../hooks/useEnsuredControl"),_excluded=["platform","children"],_excluded2=["before","className","defaultValue","placeholder","after","getRef","platform","icon","onIconClick","style"],SearchPlaceholderTypography=function(e){var t=e.platform,r=e.children,a=(0,_objectWithoutProperties2.default)(e,_excluded);switch(t){case _platform.IOS:return(0,_jsxRuntime.createScopedElement)(_Title.Title,(0,_extends2.default)({},a,{level:"3",weight:"3"}),r);case _platform.VKCOM:return(0,_jsxRuntime.createScopedElement)(_Text.default,(0,_extends2.default)({},a,{weight:"regular"}),r);default:_platform.ANDROID;return(0,_jsxRuntime.createScopedElement)(_Headline.default,(0,_extends2.default)({},a,{weight:"regular"}),r)}},Search=function(e){var t=e.before,r=e.className,a=e.defaultValue,l=e.placeholder,u=e.after,i=e.getRef,o=e.platform,n=e.icon,c=e.onIconClick,s=void 0===c?_utils.noop:c,c=e.style,_=(0,_objectWithoutProperties2.default)(e,_excluded2),d=(0,_useExternRef.useExternRef)(i),e=React.useState(!1),i=(0,_slicedToArray2.default)(e,2),e=i[0],p=i[1],i=(0,_useEnsuredControl3.useEnsuredControl)(_,{defaultValue:a}),a=(0,_slicedToArray2.default)(i,2),i=a[0],a=a[1],m=React.useCallback(function(){var e,t=null==(t=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"))?void 0:t.set,t=(null!=t&&t.call(d.current,""),new Event("input",{bubbles:!0}));null!=(e=d.current)&&e.dispatchEvent(t)},[d]),f=React.useCallback(function(e){return s(e.originalEvent)},[s]),h=React.useCallback(function(e){e.originalEvent.preventDefault(),null!=(e=d.current)&&e.focus(),m()},[d,m]);return(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:(0,_classNames.classNames)((0,_getClassName.getClassName)("Search",o),{"Search--focused":e,"Search--has-value":!!i,"Search--has-after":!!u,"Search--has-icon":!!n}),className:r,style:c},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__in"},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__width"}),(0,_jsxRuntime.createScopedElement)("label",{vkuiClass:"Search__control"},(0,_jsxRuntime.createScopedElement)("input",(0,_extends2.default)({type:"search"},_,{ref:d,vkuiClass:"Search__input",onFocus:function(e){p(!0),_.onFocus&&_.onFocus(e)},onBlur:function(e){p(!1),_.onBlur&&_.onBlur(e)},onChange:a,value:i})),o===_platform.IOS&&u&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__after-width"},u),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__placeholder"},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__placeholder-in"},t,(0,_jsxRuntime.createScopedElement)(SearchPlaceholderTypography,{vkuiClass:"Search__placeholder-text",platform:o},l)),e&&o===_platform.IOS&&u&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__after-width"},u))),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__after",onClick:m},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__icons"},n&&(0,_jsxRuntime.createScopedElement)(_Touch.Touch,{onStart:f,vkuiClass:"Search__icon"},n),!!i&&(0,_jsxRuntime.createScopedElement)(_Touch.Touch,{onStart:h,vkuiClass:"Search__icon"},o===_platform.IOS?(0,_jsxRuntime.createScopedElement)(_icons.Icon16Clear,null):(0,_jsxRuntime.createScopedElement)(_icons.Icon24Cancel,null))),o===_platform.IOS&&u&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Search__after-in"},u))),o===_platform.VKCOM&&(0,_jsxRuntime.createScopedElement)(_Separator.default,{vkuiClass:"Search__separator",wide:!0}))},_default=(Search.defaultProps={autoComplete:"off",defaultValue:"",placeholder:"Поиск",after:"Отмена",before:(0,_jsxRuntime.createScopedElement)(_icons.Icon16SearchOutline,null)},(0,_withPlatform.withPlatform)(Search));exports.default=_default;