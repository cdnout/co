"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("../../lib/jsxRuntime")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_createSuper2=_interopRequireDefault(require("@babel/runtime/helpers/createSuper")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),React=_interopRequireWildcard(require("react")),_dom=require("../../lib/dom"),_utils=require("../../lib/utils"),CustomScrollView=function(e){(0,_inherits2.default)(s,e);var i=(0,_createSuper2.default)(s);function s(){var a;(0,_classCallCheck2.default)(this,s);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return a=i.call.apply(i,[this].concat(t)),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"ratio",NaN),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"lastTrackerTop",0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"clientHeight",0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"trackerHeight",0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"scrollHeight",0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"transformProp",""),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"startY",0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"trackerTop",0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"box",(0,_utils.multiRef)(function(e){return(0,_utils.setRef)(e,a.props.boxRef)})),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"barY",React.createRef()),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"trackerY",React.createRef()),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"resize",function(){var e,t,r,i;a.box.current&&a.barY.current&&a.trackerY.current&&(r=(e=a.box.current.clientHeight)/(t=a.box.current.scrollHeight),i=Math.max(e*r,40),a.ratio=r,a.clientHeight=e,a.scrollHeight=t,a.trackerHeight=i,1<=r?a.barY.current.style.display="none":(a.barY.current.style.display="",a.trackerY.current.style.height="".concat(i,"px"),a.setTrackerPositionFromScroll(a.box.current.scrollTop)))}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"scroll",function(){1<=a.ratio||!a.box.current||a.setTrackerPositionFromScroll(a.box.current.scrollTop)}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"onDragStart",function(e){e.preventDefault(),a.startY=e.clientY,a.trackerTop=a.lastTrackerTop,a.props.document.addEventListener("mousemove",a.onMove),a.props.document.addEventListener("mouseup",a.onUp)}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"onMove",function(e){e.preventDefault();e=e.clientY-a.startY,e=Math.min(Math.max(a.trackerTop+e,0),a.clientHeight-a.trackerHeight);a.setScrollPositionFromTracker(e)}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"onUp",function(e){e.preventDefault(),a.props.document.removeEventListener("mousemove",a.onMove),a.props.document.removeEventListener("mouseup",a.onUp)}),a}return(0,_createClass2.default)(s,[{key:"componentDidMount",value:function(){this.chooseTransformProp(),this.resize(),this.props.windowResize&&this.props.window.addEventListener("resize",this.resize)}},{key:"componentDidUpdate",value:function(){this.resize()}},{key:"componentWillUnmount",value:function(){this.props.window.removeEventListener("resize",this.resize)}},{key:"chooseTransformProp",value:function(){var e=null==(e=this.trackerY.current)?void 0:e.style,t="";void 0!==e&&("transform"in e?t="transform":"webkitTransform"in e&&(t="webkitTransform")),this.transformProp=t}},{key:"setTrackerPosition",value:function(e){this.lastTrackerTop=e,null!==this.trackerY.current&&(this.trackerY.current.style[this.transformProp]="translate(0, ".concat(e,"px)"))}},{key:"setTrackerPositionFromScroll",value:function(e){e/=this.scrollHeight-this.clientHeight;this.setTrackerPosition((this.clientHeight-this.trackerHeight)*e)}},{key:"setScrollPositionFromTracker",value:function(e){e/=this.clientHeight-this.trackerHeight;null!==this.box.current&&(this.box.current.scrollTop=(this.scrollHeight-this.clientHeight)*e)}},{key:"render",value:function(){var e=this.props,t=e.children,e=e.className;return(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"CustomScrollView",className:e},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"CustomScrollView__barY",ref:this.barY},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"CustomScrollView__trackerY",ref:this.trackerY,onMouseDown:this.onDragStart})),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"CustomScrollView__box",tabIndex:-1,ref:this.box,onScroll:this.scroll},t))}}]),s}(React.Component),_default=(0,_dom.withDOM)(CustomScrollView);exports.default=_default;