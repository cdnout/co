"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Snackbar=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_Touch=require("../Touch/Touch"),_classNames=require("../../lib/classNames"),_getClassName=require("../../helpers/getClassName"),_platform=require("../../lib/platform"),_touch=require("../../lib/touch"),_withAdaptivity=require("../../hoc/withAdaptivity"),_Text=_interopRequireDefault(require("../Typography/Text/Text")),_Button=require("../Button/Button"),_AppRootPortal=require("../AppRoot/AppRootPortal"),_useWaitTransitionFinish=require("../../hooks/useWaitTransitionFinish"),_usePlatform=require("../../hooks/usePlatform"),_useTimeout=require("../../hooks/useTimeout"),_excluded=["children","layout","action","before","after","viewWidth","duration","onActionClick","onClose"],SnackbarComponent=function(e){function t(){b(!0),p(q.current,function(){_()},A)}function a(e){null!==T.current&&cancelAnimationFrame(T.current),T.current=requestAnimationFrame(function(){S.current&&(S.current.style.transform="translate3d(".concat(e,"%, 0, 0)"))})}var r=e.children,i=e.layout,n=e.action,o=e.before,u=e.after,c=e.viewWidth,s=e.duration,s=void 0===s?0:s,l=e.onActionClick,_=e.onClose,e=(0,_objectWithoutProperties2.default)(e,_excluded),d=(0,_usePlatform.usePlatform)(),p=(0,_useWaitTransitionFinish.useWaitTransitionFinish)().waitTransitionFinish,f=React.useState(!1),f=(0,_slicedToArray2.default)(f,2),m=f[0],b=f[1],f=React.useState(!1),f=(0,_slicedToArray2.default)(f,2),h=f[0],R=f[1],k=React.useRef(0),v=React.useRef(0),S=React.useRef(null),q=React.useRef(null),T=React.useRef(null),x=c>=_withAdaptivity.ViewWidth.SMALL_TABLET,A=d===_platform.ANDROID||d===_platform.VKCOM?400:320,C=(0,_useTimeout.useTimeout)(t,s),f=C.clear,c=(React.useEffect(function(){return C.set()},[C]),u||x?"vertical":i);return(0,_jsxRuntime.createScopedElement)(_AppRootPortal.AppRootPortal,null,(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({},e,{vkuiClass:(0,_classNames.classNames)((0,_getClassName.getClassName)("Snackbar",d),"Snackbar--l-".concat(c),{"Snackbar--closing":m,"Snackbar--touched":h,"Snackbar--desktop":x})}),(0,_jsxRuntime.createScopedElement)(_Touch.Touch,{vkuiClass:"Snackbar__in",getRootRef:q,onStart:f,onMoveX:function(e){var t=e.shiftX;e.originalEvent.preventDefault(),h||R(!0),k.current=t/(null!=(t=null==(e=S.current)?void 0:e.offsetWidth)?t:0)*100,v.current=(0,_touch.rubber)(k.current,72,1.2,d===_platform.ANDROID||d===_platform.VKCOM),a(v.current)},onEnd:function(e){var t,r;h?(r=v.current,r+=r/e.duration*240*.6,x&&r<=-50?(C.clear(),p(S.current,function(){_()},A),a(-120)):!x&&50<=r?(C.clear(),p(S.current,function(){_()},A),a(120)):t=function(){C.set(),a(0)}):C.set(),R(!1),t&&requestAnimationFrame(t)}},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Snackbar__body",ref:S},o&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Snackbar__before"},o),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Snackbar__content"},(0,_jsxRuntime.createScopedElement)(_Text.default,{weight:"regular",vkuiClass:"Snackbar__content-text"},r),n&&(0,_jsxRuntime.createScopedElement)(_Button.Button,{align:"left",hasHover:!1,mode:"tertiary",size:"s",vkuiClass:"Snackbar__action",onClick:function(e){t(),n&&"function"==typeof l&&l(e)}},n)),u&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Snackbar__after"},u)))))},Snackbar=(SnackbarComponent.displayName="Snackbar",SnackbarComponent.defaultProps={duration:4e3,layout:"horizontal"},(0,_withAdaptivity.withAdaptivity)(SnackbarComponent,{viewWidth:!0}));exports.Snackbar=Snackbar;