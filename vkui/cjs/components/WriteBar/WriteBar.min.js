"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.WriteBar=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_usePlatform=require("../../hooks/usePlatform"),_useExternRef=require("../../hooks/useExternRef"),_utils=require("../../lib/utils"),_dom=require("../../lib/dom"),_getClassName=require("../../helpers/getClassName"),_excluded=["className","style","before","inlineAfter","after","value","onChange","getRootRef","getRef","onHeightChange"],WriteBar=function(e){var t=(0,_usePlatform.usePlatform)(),r=e.className,i=e.style,a=e.before,u=e.inlineAfter,s=e.after,l=e.value,n=e.onChange,o=e.getRootRef,c=e.getRef,_=e.onHeightChange,e=(0,_objectWithoutProperties2.default)(e,_excluded),f=null!=l,d=(0,_dom.useDOM)().window,m=(0,_useExternRef.useExternRef)(c),p=React.useRef(null),R=React.useCallback(function(){var e,t,r,i,a=m.current;a&&(e=a.offsetHeight,r=a.scrollHeight,t=d.getComputedStyle(a),i=parseInt(t.paddingTop),t=parseInt(t.paddingBottom),null===p.current&&(p.current=e),r+(r=i+t+10)<=e&&(r=0),a.style.height="0px",i=a.scrollHeight-r/4,a.style.height=String(Math.max(i,p.current))+"px",(0,_utils.isFunction)(_)&&_())},[_,m,d]);return React.useEffect(function(){R()},[R,l]),(0,_jsxRuntime.createScopedElement)("div",{ref:o,vkuiClass:(0,_getClassName.getClassName)("WriteBar",t),className:r,style:i},(0,_jsxRuntime.createScopedElement)("form",{vkuiClass:"WriteBar__form",onSubmit:function(e){return e.preventDefault()}},(0,_utils.hasReactNode)(a)&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"WriteBar__before"},a),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"WriteBar__formIn"},(0,_jsxRuntime.createScopedElement)("textarea",(0,_extends2.default)({},e,{vkuiClass:"WriteBar__textarea",onChange:function(e){(0,_utils.isFunction)(n)&&n(e),f||R()},ref:m,value:l})),(0,_utils.hasReactNode)(u)&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"WriteBar__inlineAfter"},u)),(0,_utils.hasReactNode)(s)&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"WriteBar__after"},s)))};exports.WriteBar=WriteBar;