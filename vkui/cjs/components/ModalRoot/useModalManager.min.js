"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.modalTransitionReducer=modalTransitionReducer,exports.useModalManager=useModalManager,exports.withModalManager=withModalManager,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread2")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),React=_interopRequireWildcard(require("react")),_types=require("./types"),_warnOnce=require("../../lib/warnOnce"),_getNavId=require("../../lib/getNavId"),_useIsomorphicLayoutEffect=require("../../lib/useIsomorphicLayoutEffect"),_utils=require("../../lib/utils");function getModals(e){return React.Children.toArray(e)}var warn=(0,_warnOnce.warnOnce)("ModalRoot");function modalTransitionReducer(e,t){var n,i,o,a;return"setActive"===t.type&&t.id!==e.activeModal?(n=t.id,i=e.exitingModal||e.activeModal,o=e.history?(0,_toConsumableArray2.default)(e.history):[],a=Boolean(n&&o.includes(n)),null===n?o=[]:a?o=o.splice(0,o.indexOf(n)+1):o.push(n),{activeModal:n,enteringModal:null,exitingModal:i,history:o,isBack:a}):"entered"===t.type&&t.id===e.enteringModal?(0,_objectSpread2.default)((0,_objectSpread2.default)({},e),{},{enteringModal:null}):"exited"===t.type&&t.id===e.exitingModal?(0,_objectSpread2.default)((0,_objectSpread2.default)({},e),{},{exitingModal:null}):"inited"===t.type&&t.id===e.activeModal?(0,_objectSpread2.default)((0,_objectSpread2.default)({},e),{},{enteringModal:t.id}):e}function useModalManager(e,t){function n(e){return null!=e&&(null==(e=u[e])?void 0:e.type)===_types.ModalType.CARD}var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:_utils.noop,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:_utils.noop,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:_utils.noop,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:_utils.noop,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:_utils.noop,u=React.useRef({}).current,d=(getModals(t).forEach(function(e){var t=e.props,n=(0,_getNavId.getNavId)(t,warn),n=void 0!==n&&u[n]||{id:null!=n?n:null};n.onOpen=e.props.onOpen,n.onOpened=e.props.onOpened,n.onClose=e.props.onClose,n.onClosed=e.props.onClosed,n.dynamicContentHeight=!!t.dynamicContentHeight,"number"==typeof t.settlingHeight&&(n.settlingHeight=t.settlingHeight),null!==n.id&&(u[n.id]=n)}),e&&!u[e]),s=d?null:e,t=React.useReducer(modalTransitionReducer,{activeModal:s,enteringModal:null,exitingModal:null,history:s?[s]:[],isBack:!1}),t=(0,_slicedToArray2.default)(t,2),c=t[0],p=t[1],t=((0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){"development"===process.env.NODE_ENV&&d&&warn("Can't transition - modal ".concat(e," not found"),"error"),p({type:"setActive",id:null!=s?s:null})},[e]),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){c.activeModal&&(l(u[c.activeModal]),p({type:"inited",id:c.activeModal}))},[c.activeModal]),React.useCallback(function(e){var t;e&&(t=u[e],(0,_utils.isFunction)(t.onOpened)?t.onOpened():(0,_utils.isFunction)(o)&&o(e)),p({type:"entered",id:e})},[u,o])),f=React.useCallback(function(e){var t;e&&(t=u[e],(0,_utils.isFunction)(t.onClosed)?t.onClosed():(0,_utils.isFunction)(r)&&r(e)),p({type:"exited",id:e})},[u,r]),_=Boolean(c.exitingModal&&(n(e)||n(c.exitingModal))),M=React.useCallback(function(e){return u[e]},[u]);return(0,_objectSpread2.default)((0,_objectSpread2.default)({onEnter:function(){var e=c.activeModal&&u[c.activeModal];e&&((0,_utils.isFunction)(e.onOpen)?e.onOpen():(0,_utils.isFunction)(i)&&i(e.id))},onEntered:t,onExit:function(){var e=c.activeModal&&u[c.activeModal];e&&((0,_utils.isFunction)(e.onClose)?e.onClose():(0,_utils.isFunction)(a)&&a(e.id))},onExited:f},c),{},{delayEnter:_,getModalState:M})}function withModalManager(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:_utils.noop;return function(n){return function(e){var t=useModalManager(e.activeModal,e.children,e.onOpen,e.onOpened,e.onClose,e.onClosed,i);return(0,_jsxRuntime.createScopedElement)(n,(0,_extends2.default)({},e,t))}}}