"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Popper=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread2")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_reactPopper=require("react-popper"),_AppRootPortal=require("../AppRoot/AppRootPortal"),_usePlatform=require("../../hooks/usePlatform"),_getClassName=require("../../helpers/getClassName"),_useExternRef=require("../../hooks/useExternRef"),_useIsomorphicLayoutEffect=require("../../lib/useIsomorphicLayoutEffect"),_excluded=["targetRef","children","getRef","placement","onPlacementChange","arrow","arrowClassName","sameWidth","offsetDistance","offsetSkidding","forcePortal","style"],ARROW_PADDING=8,ARROW_WIDTH=20,ARROW_HEIGHT=8,Popper=function(e){var r=e.targetRef,t=e.children,o=e.getRef,a=e.placement,a=void 0===a?"bottom-start":a,i=e.onPlacementChange,l=e.arrow,s=e.arrowClassName,u=e.sameWidth,n=e.offsetDistance,p=void 0===n?8:n,n=e.offsetSkidding,c=void 0===n?0:n,n=e.forcePortal,n=void 0===n||n,d=e.style,e=(0,_objectWithoutProperties2.default)(e,_excluded),f=React.useState(null),f=(0,_slicedToArray2.default)(f,2),m=f[0],f=f[1],_=React.useState(0),_=(0,_slicedToArray2.default)(_,2),R=_[0],h=_[1],_=(0,_usePlatform.usePlatform)(),o=(0,_useExternRef.useExternRef)(o,f),f=React.useMemo(function(){var e=[{name:"preventOverflow"},{name:"offset",options:{offset:[l?c-R:c,l?p+ARROW_HEIGHT:p]}},{name:"flip"}];return l&&e.push({name:"arrow",options:{padding:ARROW_PADDING}}),u&&e.push({name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){e=e.state;e.styles.popper.width="".concat(e.rects.reference.width,"px")},effect:function(e){e=e.state;e.elements.popper.style.width="".concat(e.elements.reference.offsetWidth,"px")}}),e},[l,u,R,c,p]),m=(0,_reactPopper.usePopper)(r.current,m,{placement:a,modifiers:f}),a=m.styles,f=m.state,m=m.attributes,P=null==f?void 0:f.placement,v=!!P&&P.includes("-"),e=((0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var e,t;l&&v?(null!=(t="vertical"==(e=null!=P&&P.startsWith("bottom")||null!=P&&P.startsWith("top")?"vertical":"horizontal")?null==(t=r.current)?void 0:t.offsetWidth:null==(t=r.current)?void 0:t.offsetHeight)?t:0)<(t="vertical"==e?ARROW_WIDTH:ARROW_HEIGHT)+2*ARROW_PADDING&&h(ARROW_PADDING+t/2):h(0)},[l,v]),React.useEffect(function(){P&&i&&i({placement:P})},[i,P]),(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({},e,m.popper,{vkuiClass:(0,_getClassName.getClassName)("Popper",_),ref:o,style:(0,_objectSpread2.default)((0,_objectSpread2.default)((0,_objectSpread2.default)({},d),a.popper),{},{minWidth:!u||null==(f=r.current)?void 0:f.scrollWidth})}),l&&(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({},m.arrow,{vkuiClass:"Popper__arrow","data-popper-arrow":!0,style:a.arrow}),(0,_jsxRuntime.createScopedElement)("svg",{vkuiClass:"Popper__arrow-in",className:s,width:"20",height:"8",viewBox:"0 0 20 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,_jsxRuntime.createScopedElement)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 0C13 0 15.9999 8 20 8H0C3.9749 8 7 0 10 0Z",fill:"currentColor"}))),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Popper__content"},t)));return(0,_jsxRuntime.createScopedElement)(_AppRootPortal.AppRootPortal,{forcePortal:n,vkuiClass:"PopperPortal"},e)};exports.Popper=Popper;