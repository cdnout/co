"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_classNames=require("../../lib/classNames"),_getClassName=require("../../helpers/getClassName"),_platform=require("../../lib/platform"),_ConfigProviderContext=require("../ConfigProvider/ConfigProviderContext"),_SplitCol=require("../SplitCol/SplitCol"),_AppRootPortal=require("../AppRoot/AppRootPortal"),_ScrollContext=require("../AppRoot/ScrollContext"),_NavTransitionContext=require("../NavTransitionContext/NavTransitionContext"),_getNavId=require("../../lib/getNavId"),_warnOnce=require("../../lib/warnOnce"),_dom=require("../../lib/dom"),_useIsomorphicLayoutEffect=require("../../lib/useIsomorphicLayoutEffect"),_useTimeout=require("../../hooks/useTimeout"),_usePlatform=require("../../hooks/usePlatform"),_excluded=["popout","modal","children","activeView","onTransition","nav"],warn=(0,_warnOnce.warnOnce)("Root"),Root=function(e){function i(e){["vkui-root-android-animation-hide-back","vkui-root-android-animation-show-forward","vkui-root-ios-animation-hide-back","vkui-root-ios-animation-show-forward"].includes(e.animationName)&&h()}var t=e.popout,t=void 0===t?null:t,o=e.modal,r=e.children,a=e.activeView,n=e.onTransition,e=(e.nav,(0,_objectWithoutProperties2.default)(e,_excluded)),u=React.useContext(_ScrollContext.ScrollContext),s=(0,_usePlatform.usePlatform)(),l=(0,_dom.useDOM)().document,c=React.useRef({}).current,d=React.useRef({}).current,p=React.useContext(_ConfigProviderContext.ConfigProviderContext).transitionMotionEnabled,p=void 0===p||p,_=React.useContext(_SplitCol.SplitColContext).animate,m=!p||!_,f=React.Children.toArray(r),p=React.useState({activeView:a,transition:!1}),_=(0,_slicedToArray2.default)(p,2),r=_[0],v=r.prevView,R=r.activeView,C=r.transition,x=r.isBack,w=_[1],h=React.useCallback(function(){return w({activeView:R,prevView:v,isBack:x,transition:!1})},[R,x,v]),q=((0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){l.activeElement.blur()},[!!t,R]),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var e,t;(e=a)!==R&&(t=(t=f.map(function(e){return(0,_getNavId.getNavId)(e.props,warn)})).indexOf(e)<t.indexOf(R),c[R]=u.getScroll().y,w({activeView:e,prevView:R,transition:!m,isBack:t}))},[a]),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){!C&&v&&(u.scrollTo(0,x?c[R]:0),n&&n({isBack:Boolean(x),from:v,to:R}))},[C,v]),(0,_useTimeout.useTimeout)(h,s===_platform.IOS?600:300));React.useEffect(function(){C?q.set():q.clear()},[q,C]);return"development"===process.env.NODE_ENV&&(t&&warn("Свойство popout устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout."),o&&warn("Свойство modal устарело и будет удалено в 5.0.0. Используйте одноименное свойство у SplitLayout.")),(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({},e,{vkuiClass:(0,_classNames.classNames)((0,_getClassName.getClassName)("Root",s),{"Root--transition":C})}),f.map(function(e){var t=(0,_getNavId.getNavId)(e.props,warn);if(t!==R&&(!C||t!==v))return null;var o=C&&(t===v||x&&t===R);return(0,_jsxRuntime.createScopedElement)("div",{key:t,ref:function(e){return t&&(d[t]=e)},onAnimationEnd:C&&t===(x?v:R)?i:void 0,vkuiClass:(0,_classNames.classNames)("Root__view",{"Root__view--hide-back":C&&t===v&&x,"Root__view--hide-forward":C&&t===v&&!x,"Root__view--show-back":C&&t===R&&x,"Root__view--show-forward":C&&t===R&&!x,"Root__view--active":!C&&t===R})},(0,_jsxRuntime.createScopedElement)(_NavTransitionContext.NavTransitionProvider,{entering:C&&t===R},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Root__scrollCompensation",style:{marginTop:o?t&&-(null!=(o=c[t])?o:0):void 0}},e)))}),(0,_jsxRuntime.createScopedElement)(_AppRootPortal.AppRootPortal,null,!!t&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Root__popout"},t),!!o&&(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Root__modal"},o)))},_default=Root;exports.default=_default;