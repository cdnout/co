"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("../../lib/jsxRuntime")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),React=_interopRequireWildcard(require("react")),_vkBridge=_interopRequireDefault(require("@vkontakte/vk-bridge")),_dom=require("../../lib/dom"),_ConfigProviderContext=require("./ConfigProviderContext"),_useIsomorphicLayoutEffect=require("../../lib/useIsomorphicLayoutEffect"),_useObjectMemo=require("../../hooks/useObjectMemo"),_utils=require("../../lib/utils"),_warnOnce=require("../../lib/warnOnce"),_scheme2=require("../../helpers/scheme"),_AppearanceProvider=require("../AppearanceProvider/AppearanceProvider"),_LocaleProviderContext=require("../LocaleProviderContext/LocaleProviderContext"),_platform=require("../../lib/platform"),warn=(0,_warnOnce.warnOnce)("ConfigProvider");function useSchemeDetector(r,e){var t="inherit"===e,i=React.useCallback(function(){if(t&&_dom.canUseDOM&&r)return r.getAttribute("scheme")},[t,r]),o=React.useState(i()),o=(0,_slicedToArray2.default)(o,2),n=o[0],a=o[1];return React.useEffect(function(){if(!t||!r)return _utils.noop;a(i());var e=new MutationObserver(function(){return a(i())});return e.observe(r,{attributes:!0,attributeFilter:["scheme"]}),function(){return e.disconnect()}},[i,t,r]),"inherit"===e?n:e}var deriveAppearance=function(e){return e===_scheme2.Scheme.SPACE_GRAY||e===_scheme2.Scheme.VKCOM_DARK?"dark":"light"},ConfigProvider=function(e){var r=e.children,t=e.webviewType,t=void 0===t?_ConfigProviderContext.WebviewType.VKAPPS:t,i=e.isWebView,i=void 0===i?_vkBridge.default.isWebView():i,o=e.transitionMotionEnabled,o=void 0===o||o,n=e.platform,a=void 0===n?(0,_platform.platform)():n,n=e.hasNewTokens,n=void 0!==n&&n,u=e.appearance,c=e.scheme,e=e.locale,e=void 0===e?"ru":e,s=(0,_scheme2.normalizeScheme)({scheme:c,platform:a,appearance:u}),l=(0,_dom.useDOM)().document,d=null==l?void 0:l.body,l=((0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){return"inherit"===s?_utils.noop:("development"===process.env.NODE_ENV&&null!=d&&d.hasAttribute("scheme")&&warn('<body scheme> was set before VKUI mount - did you forget scheme="inherit"?'),null!=d&&d.setAttribute("scheme",s),function(){return null==d?void 0:d.removeAttribute("scheme")})},[s]),useSchemeDetector(d,s)),p=deriveAppearance(l),l=((0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var e=(0,_AppearanceProvider.generateVKUITokensClassName)(a,p);return null!=d&&d.classList.add(e),function(){null!=d&&d.classList.remove(e)}},[a,p]),(0,_useObjectMemo.useObjectMemo)({webviewType:t,isWebView:i,transitionMotionEnabled:o,hasNewTokens:n,platform:a,scheme:c,appearance:u||p}));return(0,_jsxRuntime.createScopedElement)(_ConfigProviderContext.ConfigProviderContext.Provider,{value:l},(0,_jsxRuntime.createScopedElement)(_LocaleProviderContext.LocaleProviderContext.Provider,{value:e},(0,_jsxRuntime.createScopedElement)(_AppearanceProvider.AppearanceProvider,{appearance:l.appearance},r)))},_default=ConfigProvider;exports.default=_default;