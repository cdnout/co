"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.DateInput=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_date=require("../../lib/date"),_icons=require("@vkontakte/icons"),_Calendar=require("../Calendar/Calendar"),_Popper=require("../Popper/Popper"),_utils=require("../../lib/utils"),_IconButton=_interopRequireDefault(require("../IconButton/IconButton")),_classNames=require("../../lib/classNames"),_FormField=require("../FormField/FormField"),_useDateInput2=require("../../hooks/useDateInput"),_InputLike=require("../InputLike/InputLike"),_InputLikeDivider=require("../InputLike/InputLikeDivider"),_useAdaptivity2=require("../../hooks/useAdaptivity"),_callMultiple=require("../../lib/callMultiple"),_excluded=["enableTime","shouldDisableDate","disableFuture","disablePast","value","onChange","calendarPlacement","style","className","doneButtonText","closeOnChange","disablePickers","getRootRef","name","autoFocus","disabled","onClick","onFocus","prevMonthAriaLabel","nextMonthAriaLabel","showNeighboringMonth","size","changeMonthAriaLabel","changeYearAriaLabel","changeDayAriaLabel","changeHoursAriaLabel","changeMinutesAriaLabel","clearFieldAriaLabel","showCalendarAriaLabel"],elementsConfig=function(e){var t=2,a=1,n=0;switch(e){case 0:n=31;break;case 1:n=12;break;case 2:n=2100,a=1900,t=4;break;case 3:n=23;break;case 4:n=59}return{length:t,min:a,max:n}},getInternalValue=function(e){var t=["","","","",""];return e&&(t[0]=String(e.getDate()).padStart(2,"0"),t[1]=String(e.getMonth()+1).padStart(2,"0"),t[2]=String(e.getFullYear()).padStart(4,"0"),t[3]=String(e.getHours()).padStart(2,"0"),t[4]=String(e.getMinutes()).padStart(2,"0")),t},DateInput=function(e){var i=e.enableTime,t=e.shouldDisableDate,a=e.disableFuture,n=e.disablePast,l=e.value,r=e.onChange,u=e.calendarPlacement,u=void 0===u?"bottom-start":u,o=e.style,s=e.className,c=e.doneButtonText,d=e.closeOnChange,p=void 0===d||d,d=e.disablePickers,m=e.getRootRef,b=e.name,_=e.autoFocus,h=e.disabled,y=e.onClick,N=e.onFocus,w=e.prevMonthAriaLabel,B=e.nextMonthAriaLabel,H=e.showNeighboringMonth,T=e.size,R=e.changeMonthAriaLabel,R=void 0===R?"Изменить месяц":R,g=e.changeYearAriaLabel,g=void 0===g?"Изменить год":g,v=e.changeDayAriaLabel,v=void 0===v?"Изменить день":v,L=e.changeHoursAriaLabel,L=void 0===L?"Изменить час":L,I=e.changeMinutesAriaLabel,I=void 0===I?"Изменить минуту":I,f=e.clearFieldAriaLabel,f=void 0===f?"Очистить поле":f,D=e.showCalendarAriaLabel,D=void 0===D?"Показать календарь":D,e=(0,_objectWithoutProperties2.default)(e,_excluded),k=React.useRef(null),x=React.useRef(null),M=React.useRef(null),S=React.useRef(null),C=React.useRef(null),A=i?4:2,F=React.useCallback(function(e){for(var t=0;t<=A;t+=1)if(e[t].length<elementsConfig(t).length)return;var a="".concat(e[0],".").concat(e[1],".").concat(e[2]),n="DD.MM.YYYY";i&&(a+=" ".concat(e[3],":").concat(e[4]),n+=" HH:mm"),(0,_date.isMatch)(a,n)&&null!=r&&r((0,_date.parse)(a,n,null!=l?l:new Date))},[i,A,r,l]),q=React.useMemo(function(){return[k,x,M,S,C]},[k,x,M,S,C]),q=(0,_useDateInput2.useDateInput)({maxElement:A,refs:q,autoFocus:_,disabled:h,elementsConfig:elementsConfig,onChange:r,onInternalValueChange:F,getInternalValue:getInternalValue,value:l}),_=q.rootRef,F=q.calendarRef,W=q.open,z=q.openCalendar,V=q.closeCalendar,E=q.internalValue,O=q.handleKeyDown,j=q.setFocusedElement,Y=q.handleFieldEnter,K=q.clear,P=q.removeFocusFromField,q=(0,_useAdaptivity2.useAdaptivity)().sizeY,G=React.useCallback(function(e){null!=r&&r(e),p&&!i&&P()},[r,P,p,i]);return(0,_jsxRuntime.createScopedElement)(_FormField.FormField,(0,_extends2.default)({vkuiClass:(0,_classNames.classNames)("DateInput","DateInput--sizeY-".concat(q)),style:o,className:s,getRootRef:(0,_utils.multiRef)(_,m),after:l?(0,_jsxRuntime.createScopedElement)(_IconButton.default,{hoverMode:"opacity","aria-label":f,onClick:K},(0,_jsxRuntime.createScopedElement)(_icons.Icon16Clear,null)):(0,_jsxRuntime.createScopedElement)(_IconButton.default,{hoverMode:"opacity","aria-label":D,onClick:z},(0,_jsxRuntime.createScopedElement)(_icons.Icon20CalendarOutline,null)),disabled:h,onClick:(0,_callMultiple.callMultiple)(Y,y),onFocus:(0,_callMultiple.callMultiple)(Y,N)},e),(0,_jsxRuntime.createScopedElement)("input",{type:"hidden",name:b,value:l?(0,_date.format)(l,i?"DD.MM.YYYYTHH:mm":"DD.MM.YYYY"):""}),(0,_jsxRuntime.createScopedElement)("span",{vkuiClass:"DateInput__input",onKeyDown:O},(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{tabIndex:1,length:2,getRootRef:k,index:0,onElementSelect:j,value:E[0],"aria-label":v}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null,"."),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:2,getRootRef:x,index:1,onElementSelect:j,value:E[1],"aria-label":R}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null,"."),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:4,getRootRef:M,index:2,onElementSelect:j,value:E[2],"aria-label":g}),i&&(0,_jsxRuntime.createScopedElement)(React.Fragment,null,(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,{vkuiClass:"DateInput__input-time-divider"}," "),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:2,getRootRef:S,index:3,onElementSelect:j,value:E[3],"aria-label":L}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null,":"),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:2,getRootRef:C,index:4,onElementSelect:j,value:E[4],"aria-label":I}))),W&&(0,_jsxRuntime.createScopedElement)(_Popper.Popper,{targetRef:_,offsetDistance:8,placement:u},(0,_jsxRuntime.createScopedElement)(_Calendar.Calendar,{value:l,onChange:G,enableTime:i,disablePast:n,disableFuture:a,shouldDisableDate:t,onClose:V,getRootRef:F,doneButtonText:c,disablePickers:d,changeHoursAriaLabel:L,changeMinutesAriaLabel:I,prevMonthAriaLabel:w,nextMonthAriaLabel:B,changeMonthAriaLabel:R,changeYearAriaLabel:g,changeDayAriaLabel:v,showNeighboringMonth:H,size:T})))};exports.DateInput=DateInput;