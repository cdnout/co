"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppRoot=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_dom=require("../../lib/dom"),_classNames=require("../../lib/classNames"),_AppRootContext=require("./AppRootContext"),_withAdaptivity=require("../../hoc/withAdaptivity"),_useIsomorphicLayoutEffect=require("../../lib/useIsomorphicLayoutEffect"),_classScopingMode=require("../../lib/classScopingMode"),_icons=require("@vkontakte/icons"),_ScrollContext=require("./ScrollContext"),_utils=require("../../lib/utils"),_warnOnce=require("../../lib/warnOnce"),_useKeyboardInputTracker=require("../../hooks/useKeyboardInputTracker"),_useInsets=require("../../hooks/useInsets"),_excluded=["children","mode","embedded","sizeX","hasMouse","noLegacyClasses","scroll"],warn=(0,_warnOnce.warnOnce)("AppRoot"),AppRoot=(0,_withAdaptivity.withAdaptivity)(function(e){var r=e.children,t=e.mode,o=e.embedded,i=e.sizeX,n=e.hasMouse,a=e.noLegacyClasses,a=void 0!==a&&a,s=e.scroll,u=void 0===s?"global":s,s=(0,_objectWithoutProperties2.default)(e,_excluded),l=t||(o?"embedded":"full"),e=(0,_useKeyboardInputTracker.useKeyboardInputTracker)(),c=React.useRef(null),d=React.useState(null),d=(0,_slicedToArray2.default)(d,2),p=d[0],m=d[1],d=(0,_dom.useDOM)(),_=d.window,f=d.document,b=(0,_useInsets.useInsets)(),d=React.useRef(!1),d=(d.current||(f&&"full"===l&&f.documentElement.classList.add("vkui"),_classScopingMode.classScopingMode.noConflict=a,d.current=!0),"development"===process.env.NODE_ENV&&("global"!==u&&"embedded"!==l&&warn("Scroll modes only supported in embedded mode","error"),t&&o&&warn('mode="'.concat(l,'" overrides embedded'))),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var r=f.createElement("div");return r.classList.add("vkui__portal-root"),f.body.appendChild(r),m(r),function(){var e;null!=(e=r.parentElement)&&e.removeChild(r)}},[]),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var e;if("partial"===l)return _utils.noop;var r=null==(e=c.current)?void 0:e.parentElement,t=["vkui__root"].concat("embedded"===l?"vkui__root--embedded":[]);return null!=r&&(e=r.classList).add.apply(e,(0,_toConsumableArray2.default)(t)),function(){var e;null!=r&&(e=r.classList).remove.apply(e,(0,_toConsumableArray2.default)(t)),"full"===l&&null!=f&&f.documentElement.classList.remove("vkui")}},[]),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var e;if("partial"===l||null==(e=c.current)||!e.parentElement)return _utils.noop;var r,t,o=c.current.parentElement;for(r in b)b.hasOwnProperty(r)&&"number"==typeof b[r]&&(t=b[r],o.style.setProperty("--safe-area-inset-".concat(r),"".concat(t,"px")),p&&p.style.setProperty("--safe-area-inset-".concat(r),"".concat(t,"px")));return function(){for(var e in b)b.hasOwnProperty(e)&&(o.style.removeProperty("--safe-area-inset-".concat(e)),p&&p.style.removeProperty("--safe-area-inset-".concat(e)))}},[b,p]),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var e;if("partial"===l||i!==_withAdaptivity.SizeType.REGULAR)return _utils.noop;var r="embedded"===l?null==(e=c.current)?void 0:e.parentElement:f.body;return null!=r&&r.classList.add("vkui--sizeX-regular"),function(){return null==r?void 0:r.classList.remove("vkui--sizeX-regular")}},[i]),React.useMemo(function(){return"contain"===u?(0,_ScrollContext.elementScrollController)(c):(0,_ScrollContext.globalScrollController)(_,f)},[f,u,_])),t=(0,_jsxRuntime.createScopedElement)(_AppRootContext.AppRootContext.Provider,{value:{appRoot:c,portalRoot:p,embedded:"embedded"===l,keyboardInput:e,mode:l}},(0,_jsxRuntime.createScopedElement)(_ScrollContext.ScrollContext.Provider,{value:d},(0,_jsxRuntime.createScopedElement)(_icons.IconSettingsProvider,{classPrefix:"vkui",globalClasses:!a},r)));return"partial"===l?t:(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({ref:c,vkuiClass:(0,_classNames.classNames)("AppRoot",{"AppRoot--no-mouse":!n})},s),t)},{sizeX:!0,hasMouse:!0});exports.AppRoot=AppRoot;