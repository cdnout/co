"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Touch=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread2")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_touch=require("../../lib/touch"),_dom=require("../../lib/dom"),_useExternRef=require("../../hooks/useExternRef"),_useEventListener=require("../../hooks/useEventListener"),_useIsomorphicLayoutEffect=require("../../lib/useIsomorphicLayoutEffect"),_excluded=["onStart","onStartX","onStartY","onMove","onMoveX","onMoveY","onLeave","onEnter","onEnd","onEndX","onEndY","onClickCapture","usePointerHover","slideThreshold","useCapture","Component","getRootRef","noSlideClick","stopPropagation"],Touch=function(e){var r=e.onStart,n=e.onStartX,o=e.onStartY,c=e.onMove,d=e.onMoveX,l=e.onMoveY,i=e.onLeave,t=e.onEnter,u=e.onEnd,s=e.onEndX,a=e.onEndY,f=e.onClickCapture,p=e.usePointerHover,v=e.slideThreshold,h=void 0===v?5:v,v=e.useCapture,v=void 0!==v&&v,_=e.Component,_=void 0===_?"div":_,E=e.getRootRef,b=e.noSlideClick,S=void 0!==b&&b,b=e.stopPropagation,m=void 0!==b&&b,b=(0,_objectWithoutProperties2.default)(e,_excluded),R=(0,_dom.useDOM)().document,e=React.useMemo(_touch.getSupportedEvents,[]),X=React.useRef(!1),Y=React.useRef(null),q=function(r,e){m&&r.stopPropagation(),e.forEach(function(e){var t=Date.now()-(null!=(t=null==(t=Y.current)||null==(t=t.startT)?void 0:t.getTime())?t:0);e&&e((0,_objectSpread2.default)((0,_objectSpread2.default)({},Y.current),{},{duration:t,originalEvent:r}))})},L=(0,_useEventListener.useEventListener)(p?"pointerenter":"mouseenter",t),g=(0,_useEventListener.useEventListener)(p?"pointerleave":"mouseleave",i),x=(0,_useEventListener.useEventListener)(e[0],function(e){var t;Y.current=initGesture((0,_touch.coordX)(e),(0,_touch.coordY)(e)),q(e,[r,n,o]),(t=(0,_touch.touchEnabled)()?e.target:R)&&C.forEach(function(e){return e.add(t)})},{capture:v,passive:!1}),j=(0,_useExternRef.useExternRef)(E);function P(e){var t=null!=(t=Y.current)?t:{},r=t.isPressed,n=t.isSlide,o=t.isSlideX,t=t.isSlideY;r&&q(e,[u,t&&a,o&&s]),X.current=Boolean(n),Y.current={},(0,_touch.touchEnabled)()&&i&&i(e),C.forEach(function(e){return e.remove()})}(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){var e=j.current;e&&(L.add(e),g.add(e),x.add(e))},[_]);var t={capture:v,passive:!1},C=[(0,_useEventListener.useEventListener)(e[1],function(e){var t=(i=null!=(i=Y.current)?i:{}).isPressed,r=i.isX,n=i.isY,o=void 0===(o=i.startX)?0:o,i=void 0===(i=i.startY)?0:i;if(t){var u,s,t=(0,_touch.coordX)(e)-o,o=(0,_touch.coordY)(e)-i,i=Math.abs(t),a=Math.abs(o);if(e.touches&&1<e.touches.length)return P(e);r||n||(n=(r=h<=i&&a<i)&&(!!d||!!c),s=(u=h<=a&&i<a)&&(!!l||!!c),Object.assign(Y.current,{isY:u,isX:r,isSlideX:n,isSlideY:s,isSlide:n||s})),null!=(u=Y.current)&&u.isSlide&&(Object.assign(Y.current,{shiftX:t,shiftY:o,shiftXAbs:i,shiftYAbs:a}),q(e,[c,Y.current.isSlideX&&d,Y.current.isSlideY&&l]))}},t),(0,_useEventListener.useEventListener)(e[2],P,t),(0,_useEventListener.useEventListener)(e[3],P,t)];return(0,_jsxRuntime.createScopedElement)(_,(0,_extends2.default)({},b,{onDragStart:function(e){var t=e.target;"A"!==t.tagName&&"IMG"!==t.tagName||e.preventDefault()},onClickCapture:function(e){if(!X.current)return f&&f(e);e.target.closest("a")&&e.preventDefault(),S?e.stopPropagation():f&&f(e),X.current=!1},ref:j}))};function initGesture(e,t){return{startX:e,startY:t,startT:new Date,duration:0,isPressed:!0,isY:!1,isX:!1,isSlideX:!1,isSlideY:!1,isSlide:!1,shiftX:0,shiftY:0,shiftXAbs:0,shiftYAbs:0}}exports.Touch=Touch;