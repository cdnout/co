"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.HorizontalScroll=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_withAdaptivity=require("../../hoc/withAdaptivity"),_HorizontalScrollArrow=_interopRequireDefault(require("./HorizontalScrollArrow")),_fx=require("../../lib/fx"),_useEventListener=require("../../hooks/useEventListener"),_useExternRef=require("../../hooks/useExternRef"),_classNames2=require("../../lib/classNames"),_excluded=["children","getScrollToLeft","getScrollToRight","showArrows","scrollAnimationDuration","hasMouse","getRef"];function now(){return(performance&&performance.now?performance:Date).now()}var SCROLL_ONE_FRAME_TIME=250;function doScroll(e){var t,o,l,i=e.scrollElement,r=e.getScrollPosition,n=e.animationQueue,u=e.onScrollToRightBorder,c=e.onScrollEnd,a=e.onScrollStart,s=e.initialScrollWidth,e=e.scrollAnimationDuration,f=void 0===e?SCROLL_ONE_FRAME_TIME:e;i&&r&&(e=s-i.offsetWidth,t=i.scrollLeft,o=r(t),a(),e<=o&&(u(),o=e),l=now(),function e(){var r;i?(r=now(),r=Math.min((r-l)/f,1),r=(0,_fx.easeInOutSine)(r),r=t+(o-t)*r,i.scrollLeft=Math.ceil(r),i.scrollLeft!==Math.max(0,o)?requestAnimationFrame(e):(c(),n.shift(),0<n.length&&n[0]())):c()}())}var HorizontalScrollComponent=function(e){var r=e.children,t=e.getScrollToLeft,o=e.getScrollToRight,l=e.showArrows,i=void 0===l||l,l=e.scrollAnimationDuration,n=void 0===l?SCROLL_ONE_FRAME_TIME:l,u=e.hasMouse,l=e.getRef,e=(0,_objectWithoutProperties2.default)(e,_excluded),c=React.useState(!1),c=(0,_slicedToArray2.default)(c,2),a=c[0],s=c[1],c=React.useState(!1),c=(0,_slicedToArray2.default)(c,2),f=c[0],d=c[1],_=React.useRef(!1),R=(0,_useExternRef.useExternRef)(l),h=React.useRef([]),p=React.useCallback(function(r){var t=R.current;h.current.push(function(){var e;return doScroll({scrollElement:t,getScrollPosition:r,animationQueue:h.current,onScrollToRightBorder:function(){return d(!1)},onScrollEnd:function(){return _.current=!1},onScrollStart:function(){return _.current=!0},initialScrollWidth:(null==t||null==(e=t.firstElementChild)?void 0:e.scrollWidth)||0,scrollAnimationDuration:n})}),1===h.current.length&&h.current[0]()},[n,R]),c=React.useCallback(function(){p(null!=t?t:function(e){return e-R.current.offsetWidth})},[t,p,R]),l=React.useCallback(function(){p(null!=o?o:function(e){return e+R.current.offsetWidth})},[o,p,R]),S=React.useCallback(function(){var e;i&&u&&R.current&&!_.current&&(e=R.current,s(0<e.scrollLeft),d(e.scrollLeft+e.offsetWidth<e.scrollWidth))},[u,R,i]),m=(0,_useEventListener.useEventListener)("scroll",S);return React.useEffect(function(){R.current&&m.add(R.current)},[m,R]),React.useEffect(S,[R,r,S]),(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({},e,{vkuiClass:(0,_classNames2.classNames)("HorizontalScroll",(0,_defineProperty2.default)({},"HorizontalScroll--withConstArrows","always"===i))}),i&&u&&a&&(0,_jsxRuntime.createScopedElement)(_HorizontalScrollArrow.default,{direction:"left",onClick:c}),i&&u&&f&&(0,_jsxRuntime.createScopedElement)(_HorizontalScrollArrow.default,{direction:"right",onClick:l}),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"HorizontalScroll__in",ref:R},(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"HorizontalScroll__in-wrapper"},r)))},HorizontalScroll=(0,_withAdaptivity.withAdaptivity)(HorizontalScrollComponent,{hasMouse:!0});exports.HorizontalScroll=HorizontalScroll;