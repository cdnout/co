"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_defineProperty2=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"))),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_jsxRuntime=require("../../lib/jsxRuntime"),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_classNames=require("../../lib/classNames"),_getClassName=require("../../helpers/getClassName"),_Subhead=require("../Typography/Subhead/Subhead"),_NavTransitionContext=require("../NavTransitionContext/NavTransitionContext"),_reactPopper=require("react-popper"),_TooltipContainer=require("./TooltipContainer"),_useExternRef=require("../../hooks/useExternRef"),_dom=require("../../lib/dom"),_warnOnce=require("../../lib/warnOnce"),_utils=require("../../lib/utils"),_useGlobalEventListener=require("../../hooks/useGlobalEventListener"),_excluded=["children","isShown","offsetX","offsetY","alignX","alignY","onClose","cornerOffset","cornerAbsoluteOffset"],isDOMTypeElement=function(e){return React.isValidElement(e)&&"string"==typeof e.type},baseClassName=(0,_getClassName.getClassName)("Tooltip"),warn=(0,_warnOnce.warnOnce)("Tooltip"),IS_DEV="development"===process.env.NODE_ENV,SimpleTooltip=React.forwardRef(function(e,t){var r=e.mode,o=e.header,i=e.text,a=e.arrowRef,n=e.style,n=void 0===n?{}:n,e=e.attributes;return(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:(0,_classNames.classNames)(baseClassName,"Tooltip--".concat(void 0===r?"accent":r))},(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({vkuiClass:"Tooltip__container",ref:t,style:n.container},null==e?void 0:e.container),(0,_jsxRuntime.createScopedElement)("div",(0,_extends2.default)({vkuiClass:"Tooltip__corner",style:n.arrow},null==e?void 0:e.arrow,{ref:a})),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Tooltip__content"},o&&(0,_jsxRuntime.createScopedElement)(_Subhead.Subhead,{weight:"1",vkuiClass:"Tooltip__title"},o),i&&(0,_jsxRuntime.createScopedElement)(_Subhead.Subhead,{vkuiClass:"Tooltip__text"},i))))});function mapAlignX(e){switch(e){case"left":return"start";case"right":return"end";default:return""}}function getPlacement(e,t){return[t||"bottom",mapAlignX(e||"left")].filter(function(e){return!!e}).join("-")}function isVerticalPlacement(e){return e.startsWith("top")||e.startsWith("bottom")}var Tooltip=function(e){var t=e.children,r=e.isShown,o=e.offsetX,o=void 0===o?0:o,i=e.offsetY,i=void 0===i?15:i,a=e.alignX,n=e.alignY,l=e.onClose,s=e.cornerOffset,u=void 0===s?0:s,c=e.cornerAbsoluteOffset,s=(0,_objectWithoutProperties2.default)(e,_excluded),e=(0,_NavTransitionContext.useNavTransition)().entering,r=r&&!e,e=React.useState(null),e=(0,_slicedToArray2.default)(e,2),d=e[0],f=e[1],e=React.useState(null),e=(0,_slicedToArray2.default)(e,2),p=e[0],m=e[1],e=React.useState(),e=(0,_slicedToArray2.default)(e,2),_=e[0],e=e[1],R=(IS_DEV&&(R=1<React.Children.count(t),b=(0,_utils.hasReactNode)(t)&&"object"!==(0,_typeof2.default)(t),(R||b)&&warn(["children must be a single React element, got",R&&"multiple",b&&JSON.stringify(t)].filter(Boolean).join(" "),"error")),React.useMemo(function(){return null==_?void 0:_.closest("[".concat(_TooltipContainer.tooltipContainerAttr,"]"))},[_])),b=React.useMemo(function(){return"fixed"===(null==_?void 0:_.style.position)?"fixed":"absolute"},[_]);if(IS_DEV&&_&&!R)throw new Error("Use TooltipContainer for Tooltip outside Panel (see docs)");var v=React.useMemo(function(){return{name:"arrowOffset",enabled:!0,phase:"main",fn:function(e){var t,e=e.state;e.modifiersData.arrow&&(isVerticalPlacement(e.placement)?void 0!==c?e.modifiersData.arrow.x=c:void 0!==(null==(t=e.modifiersData.arrow)?void 0:t.x)&&(e.modifiersData.arrow.x+=u):void 0!==c?e.modifiersData.arrow.y=c:void 0!==(null==(t=e.modifiersData.arrow)?void 0:t.y)&&(e.modifiersData.arrow.y+=u))}}},[u,c]),a=getPlacement(a,n),n=(0,_reactPopper.usePopper)(_,d,{strategy:b,placement:a,modifiers:[{name:"offset",options:{offset:[o,i]}},{name:"arrow",options:{element:p,padding:14}},{name:"preventOverflow"},{name:"flip"},v]}),d=n.styles,b=n.attributes,a=(0,_dom.useDOM)().document,o=((0,_useGlobalEventListener.useGlobalEventListener)(a,"click",r&&l,{passive:!0}),React.isValidElement(t)&&(isDOMTypeElement(t)?t.ref:t.props.getRootRef)),i=(0,_useExternRef.useExternRef)(e,o),p=React.isValidElement(t)?React.cloneElement(t,(0,_defineProperty2.default)({},isDOMTypeElement(t)?"ref":"getRootRef",i)):t;return(0,_jsxRuntime.createScopedElement)(React.Fragment,null,p,r&&null!=_&&_reactDom.default.createPortal((0,_jsxRuntime.createScopedElement)(SimpleTooltip,(0,_extends2.default)({},s,{ref:function(e){return f(e)},arrowRef:function(e){return m(e)},style:{arrow:d.arrow,container:d.popper},attributes:{arrow:null!=(v=b.arrow)?v:null,container:null!=(n=b.popper)?n:null}})),R))},_default=(Tooltip.defaultProps={offsetX:0,offsetY:15,cornerOffset:0,isShown:!0,mode:"accent"},Tooltip);exports.default=_default;