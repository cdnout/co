"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.DateRangeInput=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_date=require("../../lib/date"),_icons=require("@vkontakte/icons"),_CalendarRange=require("../CalendarRange/CalendarRange"),_Popper=require("../Popper/Popper"),_IconButton=_interopRequireDefault(require("../IconButton/IconButton")),_useDateInput2=require("../../hooks/useDateInput"),_useAdaptivity2=require("../../hooks/useAdaptivity"),_classNames=require("../../lib/classNames"),_utils=require("../../lib/utils"),_FormField=require("../FormField/FormField"),_InputLike=require("../InputLike/InputLike"),_InputLikeDivider=require("../InputLike/InputLikeDivider"),_callMultiple=require("../../lib/callMultiple"),_excluded=["shouldDisableDate","disableFuture","disablePast","value","onChange","calendarPlacement","style","className","closeOnChange","disablePickers","getRootRef","name","autoFocus","disabled","onClick","onFocus","prevMonthAriaLabel","nextMonthAriaLabel","changeDayAriaLabel","changeMonthAriaLabel","changeYearAriaLabel","changeStartDayAriaLabel","changeStartMonthAriaLabel","changeStartYearAriaLabel","changeEndDayAriaLabel","changeEndMonthAriaLabel","changeEndYearAriaLabel","clearFieldAriaLabel","showCalendarAriaLabel"],elementsConfig=function(e){var a=2,t=1,n=0;switch(e){case 0:case 3:n=31;break;case 1:case 4:n=12;break;case 2:case 5:n=2100,t=1900,a=4}return{length:a,min:t,max:n}},getInternalValue=function(e){var a=["","","","","",""];return null!=e&&e[0]&&(a[0]=String(e[0].getDate()).padStart(2,"0"),a[1]=String(e[0].getMonth()+1).padStart(2,"0"),a[2]=String(e[0].getFullYear()).padStart(4,"0")),null!=e&&e[1]&&(a[3]=String(e[1].getDate()).padStart(2,"0"),a[4]=String(e[1].getMonth()+1).padStart(2,"0"),a[5]=String(e[1].getFullYear()).padStart(4,"0")),a},DateRangeInput=function(e){var a=e.shouldDisableDate,t=e.disableFuture,n=e.disablePast,s=e.value,d=e.onChange,l=e.calendarPlacement,l=void 0===l?"bottom-start":l,i=e.style,r=e.className,u=e.closeOnChange,o=void 0===u||u,u=e.disablePickers,c=e.getRootRef,p=e.name,m=e.autoFocus,g=e.disabled,R=e.onClick,P=e.onFocus,N=e.prevMonthAriaLabel,w=e.nextMonthAriaLabel,W=e.changeDayAriaLabel,B=e.changeMonthAriaLabel,V=e.changeYearAriaLabel,_=e.changeStartDayAriaLabel,_=void 0===_?"Изменить день начала":_,b=e.changeStartMonthAriaLabel,b=void 0===b?"Изменить месяц начала":b,h=e.changeStartYearAriaLabel,h=void 0===h?"Изменить год начала":h,L=e.changeEndDayAriaLabel,L=void 0===L?"Изменить день окончания":L,v=e.changeEndMonthAriaLabel,v=void 0===v?"Изменить месяц окончания":v,f=e.changeEndYearAriaLabel,f=void 0===f?"Изменить год окончания":f,D=e.clearFieldAriaLabel,D=void 0===D?"Очистить поле":D,I=e.showCalendarAriaLabel,I=void 0===I?"Показать календарь":I,e=(0,_objectWithoutProperties2.default)(e,_excluded),k=React.useRef(null),S=React.useRef(null),x=React.useRef(null),A=React.useRef(null),E=React.useRef(null),C=React.useRef(null),M=React.useCallback(function(e){for(var a=!0,t=!0,n=0;n<=2;n+=1)e[n].length<elementsConfig(n).length&&(a=!1);for(var l=3;l<=5;l+=1)e[l].length<elementsConfig(l).length&&(t=!1);var i,r,u="".concat(e[0],".").concat(e[1],".").concat(e[2]),o="".concat(e[3],".").concat(e[4],".").concat(e[5]),c="dd.MM.yyyy";(0,_date.isMatch)(u,c)||(a=!1),(0,_date.isMatch)(o,c)||(t=!1),(a||t)&&(i=Array.isArray(s),r=new Date,u=a?(0,_date.parse)(u,c,i&&(null==s?void 0:s[0])||r):null,o=t?(0,_date.parse)(o,c,i&&(null==s?void 0:s[1])||r):null,u&&o&&(0,_date.isAfter)(o,u)&&null!=d&&d([u,o]))},[d,s]),F=React.useMemo(function(){return[k,S,x,A,E,C]},[k,S,x,A,E,C]),F=(0,_useDateInput2.useDateInput)({maxElement:5,refs:F,autoFocus:m,disabled:g,elementsConfig:elementsConfig,onChange:d,onInternalValueChange:M,getInternalValue:getInternalValue,value:s}),m=F.rootRef,M=F.calendarRef,O=F.open,z=F.openCalendar,K=F.closeCalendar,q=F.internalValue,G=F.handleKeyDown,j=F.setFocusedElement,y=F.handleFieldEnter,H=F.clear,Y=F.removeFocusFromField,F=(0,_useAdaptivity2.useAdaptivity)().sizeY,J=React.useCallback(function(e){null!=d&&d(e),o&&null!=e&&e[1]&&e[1]!==(null==s?void 0:s[1])&&Y()},[d,o,s,Y]);return(0,_jsxRuntime.createScopedElement)(_FormField.FormField,(0,_extends2.default)({vkuiClass:(0,_classNames.classNames)("DateRangeInput","DateRangeInput--sizeY-".concat(F)),style:i,className:r,getRootRef:(0,_utils.multiRef)(m,c),after:s?(0,_jsxRuntime.createScopedElement)(_IconButton.default,{hoverMode:"opacity","aria-label":D,onClick:H},(0,_jsxRuntime.createScopedElement)(_icons.Icon16Clear,null)):(0,_jsxRuntime.createScopedElement)(_IconButton.default,{hoverMode:"opacity","aria-label":I,onClick:z},(0,_jsxRuntime.createScopedElement)(_icons.Icon20CalendarOutline,null)),disabled:g,onClick:(0,_callMultiple.callMultiple)(y,R),onFocus:(0,_callMultiple.callMultiple)(y,P)},e),(0,_jsxRuntime.createScopedElement)("input",{type:"hidden",name:p,value:s?"".concat(s[0]?(0,_date.format)(s[0],"DD.MM.YYYY"):""," - ").concat(s[1]?(0,_date.format)(s[1],"DD.MM.YYYY"):""):""}),(0,_jsxRuntime.createScopedElement)("span",{vkuiClass:"DateInput__input",onKeyDown:G},(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:2,getRootRef:k,index:0,onElementSelect:j,value:q[0],"aria-label":_}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null,"."),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:2,getRootRef:S,index:1,onElementSelect:j,value:q[1],"aria-label":b}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null,"."),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:4,getRootRef:x,index:2,onElementSelect:j,value:q[2],"aria-label":h}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null," — "),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:2,getRootRef:A,index:3,onElementSelect:j,value:q[3],"aria-label":L}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null,"."),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:2,getRootRef:E,index:4,onElementSelect:j,value:q[4],"aria-label":v}),(0,_jsxRuntime.createScopedElement)(_InputLikeDivider.InputLikeDivider,null,"."),(0,_jsxRuntime.createScopedElement)(_InputLike.InputLike,{length:4,getRootRef:C,index:5,onElementSelect:j,value:q[5],"aria-label":f})),O&&(0,_jsxRuntime.createScopedElement)(_Popper.Popper,{targetRef:m,offsetDistance:8,placement:l},(0,_jsxRuntime.createScopedElement)(_CalendarRange.CalendarRange,{value:s,onChange:J,disablePast:n,disableFuture:t,shouldDisableDate:a,onClose:K,getRootRef:M,disablePickers:u,prevMonthAriaLabel:N,nextMonthAriaLabel:w,changeMonthAriaLabel:B,changeYearAriaLabel:V,changeDayAriaLabel:W})))};exports.DateRangeInput=DateRangeInput;