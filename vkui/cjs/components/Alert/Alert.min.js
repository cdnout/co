"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_extends2=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.Alert=void 0,_interopRequireDefault(require("@babel/runtime/helpers/extends"))),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_jsxRuntime=require("../../lib/jsxRuntime"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_createSuper2=_interopRequireDefault(require("@babel/runtime/helpers/createSuper")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),React=_interopRequireWildcard(require("react")),_Tappable=_interopRequireDefault(require("../Tappable/Tappable")),_PopoutWrapper=require("../PopoutWrapper/PopoutWrapper"),_getClassName=require("../../helpers/getClassName"),_classNames=require("../../lib/classNames"),_supportEvents=require("../../lib/supportEvents"),_platform=require("../../lib/platform"),_withPlatform=require("../../hoc/withPlatform"),_withAdaptivity=require("../../hoc/withAdaptivity"),_Button=require("../Button/Button"),_utils=require("../../lib/utils"),_Headline=_interopRequireDefault(require("../Typography/Headline/Headline")),_Title=require("../Typography/Title/Title"),_Caption=require("../Typography/Caption/Caption"),_ModalDismissButton=_interopRequireDefault(require("../ModalDismissButton/ModalDismissButton")),_FocusTrap=require("../FocusTrap/FocusTrap"),_excluded=["actions","actionsLayout","children","className","style","platform","viewWidth","text","header"],AlertComponent=function(e){(0,_inherits2.default)(i,e);var t=(0,_createSuper2.default)(i);function i(e){var a;return(0,_classCallCheck2.default)(this,i),a=t.call(this,e),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"element",void 0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"transitionFinishTimeout",void 0),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"onItemClick",function(e){return function(){var i=e.action,r=e.autoclose;r?(a.setState({closing:!0}),a.waitTransitionFinish(function(e){var t;e&&"opacity"!==e.propertyName||(r&&null!=(t=(e=a.props).onClose)&&t.call(e),i&&i())})):i&&i()}}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"onClose",function(){a.setState({closing:!0}),a.waitTransitionFinish(function(e){var t;e&&"opacity"!==e.propertyName||null!=(t=(e=a.props).onClose)&&t.call(e)})}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"stopPropagation",function(e){e.stopPropagation()}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(a),"renderAction",function(e,t){var i=a.props.platform;if(i===_platform.IOS)return r=e.Component,(0,_jsxRuntime.createScopedElement)(_Tappable.default,{Component:e.href?"a":void 0===r?"button":r,vkuiClass:(0,_classNames.classNames)("Alert__action","Alert__action--".concat(e.mode)),onClick:a.onItemClick(e),href:e.href,key:"alert-action-".concat(t),target:e.target},e.title);var r="cancel"===e.mode?"secondary":"primary";return i===_platform.ANDROID&&(r="tertiary",a.props.viewWidth===_withAdaptivity.ViewWidth.DESKTOP&&"destructive"===e.mode&&(r="destructive")),(0,_jsxRuntime.createScopedElement)(_Button.Button,{vkuiClass:(0,_classNames.classNames)("Alert__button","Alert__button--".concat(e.mode)),mode:r,size:"m",onClick:a.onItemClick(e),Component:e.Component,href:e.href,key:"alert-action-".concat(t),target:e.target},e.title)}),a.element=React.createRef(),a.state={closing:!1},a}return(0,_createClass2.default)(i,[{key:"timeout",get:function(){return this.props.platform===_platform.ANDROID||this.props.platform===_platform.VKCOM?200:300}},{key:"waitTransitionFinish",value:function(e){_supportEvents.transitionEvent.supported&&this.element.current?(this.element.current.removeEventListener(_supportEvents.transitionEvent.name,e),this.element.current.addEventListener(_supportEvents.transitionEvent.name,e)):(this.transitionFinishTimeout&&clearTimeout(this.transitionFinishTimeout),this.transitionFinishTimeout=setTimeout(e.bind(this),this.timeout))}},{key:"renderHeader",value:function(e){switch(this.props.platform){case _platform.VKCOM:return(0,_jsxRuntime.createScopedElement)(_Headline.default,{vkuiClass:"Alert__header",weight:"medium"},e);case _platform.IOS:return(0,_jsxRuntime.createScopedElement)(_Title.Title,{vkuiClass:"Alert__header",weight:"1",level:"3"},e);case _platform.ANDROID:return(0,_jsxRuntime.createScopedElement)(_Title.Title,{vkuiClass:"Alert__header",weight:"2",level:"2"},e);default:return}}},{key:"renderText",value:function(e){switch(this.props.platform){case _platform.VKCOM:return(0,_jsxRuntime.createScopedElement)(_Caption.Caption,{vkuiClass:"Alert__text"},e);case _platform.IOS:return(0,_jsxRuntime.createScopedElement)(_Caption.Caption,{vkuiClass:"Alert__text",level:"2"},e);case _platform.ANDROID:return(0,_jsxRuntime.createScopedElement)(_Headline.default,{vkuiClass:"Alert__text",weight:"regular"},e);default:return}}},{key:"render",value:function(){var e=this.props,t=e.actions,i=e.actionsLayout,r=e.children,a=e.className,o=e.style,l=e.platform,n=e.viewWidth,s=e.text,u=e.header,e=(0,_objectWithoutProperties2.default)(e,_excluded),p=this.state.closing,i=l===_platform.VKCOM?"horizontal":i,c=l===_platform.VKCOM||l===_platform.ANDROID&&n>=_withAdaptivity.ViewWidth.SMALL_TABLET,n=n>=_withAdaptivity.ViewWidth.SMALL_TABLET;return(0,_jsxRuntime.createScopedElement)(_PopoutWrapper.PopoutWrapper,{className:a,closing:p,style:o,onClick:this.onClose},(0,_jsxRuntime.createScopedElement)(_FocusTrap.FocusTrap,(0,_extends2.default)({},e,{getRootRef:this.element,onClick:this.stopPropagation,onClose:this.onClose,timeout:this.timeout,vkuiClass:(0,_classNames.classNames)((0,_getClassName.getClassName)("Alert",l),{"Alert--v":"vertical"===i,"Alert--h":"horizontal"===i,"Alert--closing":p,"Alert--desktop":n})}),c&&(0,_jsxRuntime.createScopedElement)(_ModalDismissButton.default,{onClick:this.onClose}),(0,_jsxRuntime.createScopedElement)("div",{vkuiClass:"Alert__content"},(0,_utils.hasReactNode)(u)&&this.renderHeader(u),(0,_utils.hasReactNode)(s)&&this.renderText(s),r),(0,_jsxRuntime.createScopedElement)("footer",{vkuiClass:"Alert__actions"},null==t?void 0:t.map(this.renderAction))))}}]),i}(React.Component),Alert=((0,_defineProperty2.default)(AlertComponent,"defaultProps",{actionsLayout:"horizontal",actions:[]}),(0,_withPlatform.withPlatform)((0,_withAdaptivity.withAdaptivity)(AlertComponent,{viewWidth:!0})));exports.Alert=Alert;