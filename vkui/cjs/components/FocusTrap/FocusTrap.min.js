"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_jsxRuntime=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.FocusTrap=void 0,require("../../lib/jsxRuntime")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_useExternRef=require("../../hooks/useExternRef"),_useGlobalEventListener=require("../../hooks/useGlobalEventListener"),_useTimeout=require("../../hooks/useTimeout"),_accessibility=require("../../lib/accessibility"),_dom=require("../../lib/dom"),_useIsomorphicLayoutEffect=require("../../lib/useIsomorphicLayoutEffect"),_utils=require("../../lib/utils"),_AppRootContext=require("../AppRoot/AppRootContext"),_excluded=["Component","onClose","restoreFocus","timeout","getRootRef","children"],FOCUSABLE_ELEMENTS=_accessibility.FOCUSABLE_ELEMENTS_LIST.join(),FocusTrap=function(e){var t=e.Component,t=void 0===t?"div":t,r=e.onClose,i=void 0===r?_utils.noop:r,r=e.restoreFocus,o=void 0===r||r,r=e.timeout,r=void 0===r?0:r,u=e.getRootRef,s=e.children,e=(0,_objectWithoutProperties2.default)(e,_excluded),n=(0,_useExternRef.useExternRef)(u),u=(0,_dom.useDOM)(),l=u.document,c=u.window,u=React.useState(null),u=(0,_slicedToArray2.default)(u,2),a=u[0],p=u[1],u=React.useState(null),u=(0,_slicedToArray2.default)(u,2),f=u[0],d=u[1],_=React.useContext(_AppRootContext.AppRootContext).keyboardInput,m=(0,_useTimeout.useTimeout)(function(){var e;!_||null!=(e=n.current)&&e.contains(l.activeElement)||null==a||!a.length||a[0].focus()},r),E=((0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){m.set()},[]),(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){if(!n.current)return(0,_utils.noop)();var o=[];return Array.prototype.forEach.call(n.current.querySelectorAll(FOCUSABLE_ELEMENTS),function(e){var t=c.getComputedStyle(e),r=t.display,t=t.visibility;"none"!==r&&"hidden"!==t&&o.push(e)}),null!=o&&o.length&&p(o),(0,_utils.noop)()},[s]),(0,_useTimeout.useTimeout)(function(){f&&f.focus()},r));(0,_useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function(){return o&&l.activeElement?(d(l.activeElement),function(){E.set()}):(0,_utils.noop)()},[o]);return(0,_useGlobalEventListener.useGlobalEventListener)(l,"keydown",function(t){if((0,_accessibility.pressedKey)(t)===_accessibility.Keys.TAB&&null!=a&&a.length){var e=a.length-1,r=a.findIndex(function(e){return e===t.target}),o=-1===r||r===e&&!t.shiftKey;if(o||0===r&&t.shiftKey)return t.preventDefault(),(r=a[o?0:e])!==l.activeElement&&r.focus(),!1}return(0,_accessibility.pressedKey)(t)===_accessibility.Keys.ESCAPE&&i(),!0},{capture:!0}),(0,_jsxRuntime.createScopedElement)(t,(0,_extends2.default)({ref:n},e),s)};exports.FocusTrap=FocusTrap;