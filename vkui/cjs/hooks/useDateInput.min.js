"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default,_toConsumableArray2=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.useDateInput=useDateInput,_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"))),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),React=_interopRequireWildcard(require("react")),_useBooleanState2=require("./useBooleanState"),_useGlobalEventListener=require("./useGlobalEventListener"),_dom=require("../lib/dom");function useDateInput(e){var n=e.maxElement,a=e.refs,t=e.autoFocus,l=e.disabled,r=e.elementsConfig,u=e.onChange,o=e.onInternalValueChange,i=e.getInternalValue,s=e.value,e=(0,_dom.useDOM)().document,c=(0,_useBooleanState2.useBooleanState)(!1),f=c.value,d=c.setTrue,R=c.setFalse,b=React.useRef(null),y=React.useRef(null),c=React.useState([]),c=(0,_slicedToArray2.default)(c,2),m=c[0],k=c[1],c=React.useState(null),c=(0,_slicedToArray2.default)(c,2),p=c[0],g=c[1],v=(0,_dom.useDOM)().window,_=React.useCallback(function(){var e;f&&(g(null),R(),null!=(e=v.getSelection())&&e.removeAllRanges(),k(i(s)))},[R,i,f,s,v]),c=React.useCallback(function(e){var t;null!=(t=b.current)&&t.contains(e.target)||null!=(t=y.current)&&t.contains(e.target)||_()},[_]),h=React.useCallback(function(){g(0)},[]),e=((0,_useGlobalEventListener.useGlobalEventListener)(e,"click",c,{capture:!0}),React.useEffect(function(){k(i(s))},[i,s]),React.useEffect(function(){t&&h()},[t,h]),React.useEffect(function(){var e,t;l||null===p||(e=v.document.createRange(),(t=a[p].current)&&(t.focus(),d(),e.selectNodeContents(t),null!=(t=v.getSelection())&&t.removeAllRanges(),null!=t&&t.addRange(e)))},[l,p,d,a,v]),React.useCallback(function(){null!=u&&u(void 0),h()},[u,h])),c=React.useCallback(function(){f||h()},[f,h]),q=React.useCallback(function(e){if(null!==p){var t=(0,_toConsumableArray2.default)(m),a=r(p);if(/^\d+$/.test(e.key))t[p].length>=a.length?t[p]=e.key:(t[p]+=e.key,t[p].length>=a.length&&p<n&&g(p+1));else if("Backspace"===e.key)t[p]?t[p]=t[p].slice(0,-1):g(p<=0?n:p-1);else if("ArrowDown"===e.key||"Down"===e.key){var l=Number(t[p]);t[p]=String(l<=a.min?a.max:l-1).padStart(a.length,"0")}else if("ArrowUp"===e.key||"Up"===e.key){l=Number(t[p]);t[p]=String(l>=a.max?a.min:l+1).padStart(a.length,"0")}else{if("Enter"===e.key||"Tab"===e.key&&p===n||"Tab"===e.key&&e.shiftKey&&0===p)return void _();if("ArrowLeft"===e.key||"Left"===e.key||"Tab"===e.key&&e.shiftKey)g(p<=0?n:p-1);else if("ArrowRight"===e.key||"Right"===e.key||"Tab"===e.key)g(n<=p?0:p+1);else{if("Delete"!==e.key&&"Del"!==e.key)return;t[p]=""}}e.preventDefault(),k(t),o(t)}},[r,p,m,n,o,_]);return{rootRef:b,calendarRef:y,open:f,openCalendar:d,closeCalendar:R,internalValue:m,focusedElement:p,setFocusedElement:g,handleKeyDown:q,clear:e,handleFieldEnter:c,removeFocusFromField:_}}