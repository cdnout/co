import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import*as React from"react";import{useBooleanState}from"./useBooleanState";import{useGlobalEventListener}from"./useGlobalEventListener";import{useDOM}from"../lib/dom";function useDateInput(e){var l=e.maxElement,n=e.refs,t=e.autoFocus,a=e.disabled,r=e.elementsConfig,o=e.onChange,u=e.onInternalValueChange,s=e.getInternalValue,c=e.value,e=useDOM().document,i=useBooleanState(!1),f=i.value,m=i.setTrue,y=i.setFalse,d=React.useRef(null),k=React.useRef(null),i=React.useState([]),i=_slicedToArray(i,2),b=i[0],R=i[1],i=React.useState(null),i=_slicedToArray(i,2),g=i[0],p=i[1],v=useDOM().window,h=React.useCallback(function(){var e;f&&(p(null),y(),null!=(e=v.getSelection())&&e.removeAllRanges(),R(s(c)))},[y,s,f,c,v]),i=React.useCallback(function(e){var t;null!=(t=d.current)&&t.contains(e.target)||null!=(t=k.current)&&t.contains(e.target)||h()},[h]),C=React.useCallback(function(){p(0)},[]),e=(useGlobalEventListener(e,"click",i,{capture:!0}),React.useEffect(function(){R(s(c))},[s,c]),React.useEffect(function(){t&&C()},[t,C]),React.useEffect(function(){var e,t;a||null===g||(e=v.document.createRange(),(t=n[g].current)&&(t.focus(),m(),e.selectNodeContents(t),null!=(t=v.getSelection())&&t.removeAllRanges(),null!=t&&t.addRange(e)))},[a,g,m,n,v]),React.useCallback(function(){null!=o&&o(void 0),C()},[o,C])),i=React.useCallback(function(){f||C()},[f,C]),A=React.useCallback(function(e){if(null!==g){var t=_toConsumableArray(b),n=r(g);if(/^\d+$/.test(e.key))t[g].length>=n.length?t[g]=e.key:(t[g]+=e.key,t[g].length>=n.length&&g<l&&p(g+1));else if("Backspace"===e.key)t[g]?t[g]=t[g].slice(0,-1):p(g<=0?l:g-1);else if("ArrowDown"===e.key||"Down"===e.key){var a=Number(t[g]);t[g]=String(a<=n.min?n.max:a-1).padStart(n.length,"0")}else if("ArrowUp"===e.key||"Up"===e.key){a=Number(t[g]);t[g]=String(a>=n.max?n.min:a+1).padStart(n.length,"0")}else{if("Enter"===e.key||"Tab"===e.key&&g===l||"Tab"===e.key&&e.shiftKey&&0===g)return void h();if("ArrowLeft"===e.key||"Left"===e.key||"Tab"===e.key&&e.shiftKey)p(g<=0?l:g-1);else if("ArrowRight"===e.key||"Right"===e.key||"Tab"===e.key)p(l<=g?0:g+1);else{if("Delete"!==e.key&&"Del"!==e.key)return;t[g]=""}}e.preventDefault(),R(t),u(t)}},[r,g,b,l,u,h]);return{rootRef:d,calendarRef:k,open:f,openCalendar:m,closeCalendar:y,internalValue:b,focusedElement:g,setFocusedElement:p,handleKeyDown:A,clear:e,handleFieldEnter:i,removeFocusFromField:h}}export{useDateInput};