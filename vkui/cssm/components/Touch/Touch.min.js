import _extends from"@babel/runtime/helpers/extends";import _objectSpread from"@babel/runtime/helpers/objectSpread2";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["onStart","onStartX","onStartY","onMove","onMoveX","onMoveY","onLeave","onEnter","onEnd","onEndX","onEndY","onClickCapture","usePointerHover","slideThreshold","useCapture","Component","getRootRef","noSlideClick","stopPropagation"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{getSupportedEvents,coordX,coordY,touchEnabled}from"../../lib/touch";import{useDOM}from"../../lib/dom";import{useExternRef}from"../../hooks/useExternRef";import{useEventListener}from"../../hooks/useEventListener";import{useIsomorphicLayoutEffect}from"../../lib/useIsomorphicLayoutEffect";var Touch=function(e){var r=e.onStart,o=e.onStartX,n=e.onStartY,c=e.onMove,d=e.onMoveX,l=e.onMoveY,i=e.onLeave,t=e.onEnter,s=e.onEnd,u=e.onEndX,a=e.onEndY,p=e.onClickCapture,f=e.usePointerHover,v=e.slideThreshold,m=void 0===v?5:v,v=e.useCapture,v=void 0!==v&&v,h=e.Component,h=void 0===h?"div":h,E=e.getRootRef,S=e.noSlideClick,b=void 0!==S&&S,S=e.stopPropagation,X=void 0!==S&&S,S=_objectWithoutProperties(e,_excluded),Y=useDOM().document,e=React.useMemo(getSupportedEvents,[]),g=React.useRef(!1),R=React.useRef(null),L=function(r,e){X&&r.stopPropagation(),e.forEach(function(e){var t=Date.now()-(null!=(t=null==(t=R.current)||null==(t=t.startT)?void 0:t.getTime())?t:0);e&&e(_objectSpread(_objectSpread({},R.current),{},{duration:t,originalEvent:r}))})},C=useEventListener(f?"pointerenter":"mouseenter",t),M=useEventListener(f?"pointerleave":"mouseleave",i),P=useEventListener(e[0],function(e){var t;R.current=initGesture(coordX(e),coordY(e)),L(e,[r,o,n]),(t=touchEnabled()?e.target:Y)&&_.forEach(function(e){return e.add(t)})},{capture:v,passive:!1}),j=useExternRef(E);function x(e){var t=null!=(t=R.current)?t:{},r=t.isPressed,o=t.isSlide,n=t.isSlideX,t=t.isSlideY;r&&L(e,[s,t&&a,n&&u]),g.current=Boolean(o),R.current={},touchEnabled()&&i&&i(e),_.forEach(function(e){return e.remove()})}useIsomorphicLayoutEffect(function(){var e=j.current;e&&(C.add(e),M.add(e),P.add(e))},[h]);var t={capture:v,passive:!1},_=[useEventListener(e[1],function(e){var t=(i=null!=(i=R.current)?i:{}).isPressed,r=i.isX,o=i.isY,n=void 0===(n=i.startX)?0:n,i=void 0===(i=i.startY)?0:i;if(t){var s,u,t=coordX(e)-n,n=coordY(e)-i,i=Math.abs(t),a=Math.abs(n);if(e.touches&&1<e.touches.length)return x(e);r||o||(o=(r=m<=i&&a<i)&&(!!d||!!c),u=(s=m<=a&&i<a)&&(!!l||!!c),Object.assign(R.current,{isY:s,isX:r,isSlideX:o,isSlideY:u,isSlide:o||u})),null!=(s=R.current)&&s.isSlide&&(Object.assign(R.current,{shiftX:t,shiftY:n,shiftXAbs:i,shiftYAbs:a}),L(e,[c,R.current.isSlideX&&d,R.current.isSlideY&&l]))}},t),useEventListener(e[2],x,t),useEventListener(e[3],x,t)];return createScopedElement(h,_extends({},S,{onDragStart:function(e){var t=e.target;"A"!==t.tagName&&"IMG"!==t.tagName||e.preventDefault()},onClickCapture:function(e){if(!g.current)return p&&p(e);e.target.closest("a")&&e.preventDefault(),b?e.stopPropagation():p&&p(e),g.current=!1},ref:j}))};function initGesture(e,t){return{startX:e,startY:t,startT:new Date,duration:0,isPressed:!0,isY:!1,isX:!1,isSlideX:!1,isSlideY:!1,isSlide:!1,shiftX:0,shiftY:0,shiftXAbs:0,shiftYAbs:0}}export{Touch};