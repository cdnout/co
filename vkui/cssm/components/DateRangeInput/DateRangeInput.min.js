import _extends from"@babel/runtime/helpers/extends";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["shouldDisableDate","disableFuture","disablePast","value","onChange","calendarPlacement","style","className","closeOnChange","disablePickers","getRootRef","name","autoFocus","disabled","onClick","onFocus","prevMonthAriaLabel","nextMonthAriaLabel","changeDayAriaLabel","changeMonthAriaLabel","changeYearAriaLabel","changeStartDayAriaLabel","changeStartMonthAriaLabel","changeStartYearAriaLabel","changeEndDayAriaLabel","changeEndMonthAriaLabel","changeEndYearAriaLabel","clearFieldAriaLabel","showCalendarAriaLabel"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{format,isMatch,parse,isAfter}from"../../lib/date";import{Icon16Clear,Icon20CalendarOutline}from"@vkontakte/icons";import{CalendarRange}from"../CalendarRange/CalendarRange";import{Popper}from"../Popper/Popper";import IconButton from"../IconButton/IconButton";import{useDateInput}from"../../hooks/useDateInput";import{useAdaptivity}from"../../hooks/useAdaptivity";import{classNames}from"../../lib/classNames";import{multiRef}from"../../lib/utils";import{FormField}from"../FormField/FormField";import{InputLike}from"../InputLike/InputLike";import{InputLikeDivider}from"../InputLike/InputLikeDivider";import{callMultiple}from"../../lib/callMultiple";import"./DateRangeInput.css";var elementsConfig=function(e){var a=2,t=1,n=0;switch(e){case 0:case 3:n=31;break;case 1:case 4:n=12;break;case 2:case 5:n=2100,t=1900,a=4}return{length:a,min:t,max:n}},getInternalValue=function(e){var a=["","","","","",""];return null!=e&&e[0]&&(a[0]=String(e[0].getDate()).padStart(2,"0"),a[1]=String(e[0].getMonth()+1).padStart(2,"0"),a[2]=String(e[0].getFullYear()).padStart(4,"0")),null!=e&&e[1]&&(a[3]=String(e[1].getDate()).padStart(2,"0"),a[4]=String(e[1].getMonth()+1).padStart(2,"0"),a[5]=String(e[1].getFullYear()).padStart(4,"0")),a},DateRangeInput=function(e){var a=e.shouldDisableDate,t=e.disableFuture,n=e.disablePast,s=e.value,d=e.onChange,l=e.calendarPlacement,l=void 0===l?"bottom-start":l,o=e.style,r=e.className,i=e.closeOnChange,c=void 0===i||i,i=e.disablePickers,u=e.getRootRef,p=e.name,m=e.autoFocus,g=e.disabled,h=e.onClick,N=e.onFocus,B=e.prevMonthAriaLabel,V=e.nextMonthAriaLabel,j=e.changeDayAriaLabel,O=e.changeMonthAriaLabel,W=e.changeYearAriaLabel,b=e.changeStartDayAriaLabel,b=void 0===b?"Изменить день начала":b,f=e.changeStartMonthAriaLabel,f=void 0===f?"Изменить месяц начала":f,v=e.changeStartYearAriaLabel,v=void 0===v?"Изменить год начала":v,R=e.changeEndDayAriaLabel,R=void 0===R?"Изменить день окончания":R,L=e.changeEndMonthAriaLabel,L=void 0===L?"Изменить месяц окончания":L,S=e.changeEndYearAriaLabel,S=void 0===S?"Изменить год окончания":S,D=e.clearFieldAriaLabel,D=void 0===D?"Очистить поле":D,I=e.showCalendarAriaLabel,I=void 0===I?"Показать календарь":I,e=_objectWithoutProperties(e,_excluded),A=React.useRef(null),E=React.useRef(null),k=React.useRef(null),C=React.useRef(null),M=React.useRef(null),F=React.useRef(null),y=React.useCallback(function(e){for(var a=!0,t=!0,n=0;n<=2;n+=1)e[n].length<elementsConfig(n).length&&(a=!1);for(var l=3;l<=5;l+=1)e[l].length<elementsConfig(l).length&&(t=!1);var o,r,i="".concat(e[0],".").concat(e[1],".").concat(e[2]),c="".concat(e[3],".").concat(e[4],".").concat(e[5]),u="dd.MM.yyyy";isMatch(i,u)||(a=!1),isMatch(c,u)||(t=!1),(a||t)&&(o=Array.isArray(s),r=new Date,i=a?parse(i,u,o&&(null==s?void 0:s[0])||r):null,c=t?parse(c,u,o&&(null==s?void 0:s[1])||r):null,i&&c&&isAfter(c,i)&&null!=d&&d([i,c]))},[d,s]),Y=React.useMemo(function(){return[A,E,k,C,M,F]},[A,E,k,C,M,F]),Y=useDateInput({maxElement:5,refs:Y,autoFocus:m,disabled:g,elementsConfig:elementsConfig,onChange:d,onInternalValueChange:y,getInternalValue:getInternalValue,value:s}),m=Y.rootRef,y=Y.calendarRef,z=Y.open,K=Y.openCalendar,q=Y.closeCalendar,x=Y.internalValue,G=Y.handleKeyDown,P=Y.setFocusedElement,_=Y.handleFieldEnter,H=Y.clear,w=Y.removeFocusFromField,Y=useAdaptivity().sizeY,J=React.useCallback(function(e){null!=d&&d(e),c&&null!=e&&e[1]&&e[1]!==(null==s?void 0:s[1])&&w()},[d,c,s,w]);return createScopedElement(FormField,_extends({vkuiClass:classNames("DateRangeInput","DateRangeInput--sizeY-".concat(Y)),style:o,className:r,getRootRef:multiRef(m,u),after:s?createScopedElement(IconButton,{hoverMode:"opacity","aria-label":D,onClick:H},createScopedElement(Icon16Clear,null)):createScopedElement(IconButton,{hoverMode:"opacity","aria-label":I,onClick:K},createScopedElement(Icon20CalendarOutline,null)),disabled:g,onClick:callMultiple(_,h),onFocus:callMultiple(_,N)},e),createScopedElement("input",{type:"hidden",name:p,value:s?"".concat(s[0]?format(s[0],"DD.MM.YYYY"):""," - ").concat(s[1]?format(s[1],"DD.MM.YYYY"):""):""}),createScopedElement("span",{vkuiClass:"DateInput__input",onKeyDown:G},createScopedElement(InputLike,{length:2,getRootRef:A,index:0,onElementSelect:P,value:x[0],"aria-label":b}),createScopedElement(InputLikeDivider,null,"."),createScopedElement(InputLike,{length:2,getRootRef:E,index:1,onElementSelect:P,value:x[1],"aria-label":f}),createScopedElement(InputLikeDivider,null,"."),createScopedElement(InputLike,{length:4,getRootRef:k,index:2,onElementSelect:P,value:x[2],"aria-label":v}),createScopedElement(InputLikeDivider,null," — "),createScopedElement(InputLike,{length:2,getRootRef:C,index:3,onElementSelect:P,value:x[3],"aria-label":R}),createScopedElement(InputLikeDivider,null,"."),createScopedElement(InputLike,{length:2,getRootRef:M,index:4,onElementSelect:P,value:x[4],"aria-label":L}),createScopedElement(InputLikeDivider,null,"."),createScopedElement(InputLike,{length:4,getRootRef:F,index:5,onElementSelect:P,value:x[5],"aria-label":S})),z&&createScopedElement(Popper,{targetRef:m,offsetDistance:8,placement:l},createScopedElement(CalendarRange,{value:s,onChange:J,disablePast:n,disableFuture:t,shouldDisableDate:a,onClose:q,getRootRef:y,disablePickers:i,prevMonthAriaLabel:B,nextMonthAriaLabel:V,changeMonthAriaLabel:O,changeYearAriaLabel:W,changeDayAriaLabel:j})))};export{DateRangeInput};