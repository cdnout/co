import _extends from"@babel/runtime/helpers/extends";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["enableTime","shouldDisableDate","disableFuture","disablePast","value","onChange","calendarPlacement","style","className","doneButtonText","closeOnChange","disablePickers","getRootRef","name","autoFocus","disabled","onClick","onFocus","prevMonthAriaLabel","nextMonthAriaLabel","showNeighboringMonth","size","changeMonthAriaLabel","changeYearAriaLabel","changeDayAriaLabel","changeHoursAriaLabel","changeMinutesAriaLabel","clearFieldAriaLabel","showCalendarAriaLabel"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{format,isMatch,parse}from"../../lib/date";import{Icon16Clear,Icon20CalendarOutline}from"@vkontakte/icons";import{Calendar}from"../Calendar/Calendar";import{Popper}from"../Popper/Popper";import{multiRef}from"../../lib/utils";import IconButton from"../IconButton/IconButton";import{classNames}from"../../lib/classNames";import{FormField}from"../FormField/FormField";import{useDateInput}from"../../hooks/useDateInput";import{InputLike}from"../InputLike/InputLike";import{InputLikeDivider}from"../InputLike/InputLikeDivider";import{useAdaptivity}from"../../hooks/useAdaptivity";import{callMultiple}from"../../lib/callMultiple";import"./DateInput.css";var elementsConfig=function(e){var t=2,a=1,n=0;switch(e){case 0:n=31;break;case 1:n=12;break;case 2:n=2100,a=1900,t=4;break;case 3:n=23;break;case 4:n=59}return{length:t,min:a,max:n}},getInternalValue=function(e){var t=["","","","",""];return e&&(t[0]=String(e.getDate()).padStart(2,"0"),t[1]=String(e.getMonth()+1).padStart(2,"0"),t[2]=String(e.getFullYear()).padStart(4,"0"),t[3]=String(e.getHours()).padStart(2,"0"),t[4]=String(e.getMinutes()).padStart(2,"0")),t},DateInput=function(e){var l=e.enableTime,t=e.shouldDisableDate,a=e.disableFuture,n=e.disablePast,o=e.value,i=e.onChange,r=e.calendarPlacement,r=void 0===r?"bottom-start":r,c=e.style,u=e.className,s=e.doneButtonText,d=e.closeOnChange,m=void 0===d||d,d=e.disablePickers,p=e.getRootRef,b=e.name,h=e.autoFocus,g=e.disabled,N=e.onClick,B=e.onFocus,H=e.prevMonthAriaLabel,T=e.nextMonthAriaLabel,z=e.showNeighboringMonth,V=e.size,f=e.changeMonthAriaLabel,f=void 0===f?"Изменить месяц":f,v=e.changeYearAriaLabel,v=void 0===v?"Изменить год":v,L=e.changeDayAriaLabel,L=void 0===L?"Изменить день":L,I=e.changeHoursAriaLabel,I=void 0===I?"Изменить час":I,R=e.changeMinutesAriaLabel,R=void 0===R?"Изменить минуту":R,k=e.clearFieldAriaLabel,k=void 0===k?"Очистить поле":k,D=e.showCalendarAriaLabel,D=void 0===D?"Показать календарь":D,e=_objectWithoutProperties(e,_excluded),S=React.useRef(null),C=React.useRef(null),M=React.useRef(null),A=React.useRef(null),E=React.useRef(null),F=l?4:2,x=React.useCallback(function(e){for(var t=0;t<=F;t+=1)if(e[t].length<elementsConfig(t).length)return;var a="".concat(e[0],".").concat(e[1],".").concat(e[2]),n="DD.MM.YYYY";l&&(a+=" ".concat(e[3],":").concat(e[4]),n+=" HH:mm"),isMatch(a,n)&&null!=i&&i(parse(a,n,null!=o?o:new Date))},[l,F,i,o]),Y=React.useMemo(function(){return[S,C,M,A,E]},[S,C,M,A,E]),Y=useDateInput({maxElement:F,refs:Y,autoFocus:h,disabled:g,elementsConfig:elementsConfig,onChange:i,onInternalValueChange:x,getInternalValue:getInternalValue,value:o}),h=Y.rootRef,x=Y.calendarRef,j=Y.open,O=Y.openCalendar,W=Y.closeCalendar,P=Y.internalValue,K=Y.handleKeyDown,y=Y.setFocusedElement,_=Y.handleFieldEnter,q=Y.clear,w=Y.removeFocusFromField,Y=useAdaptivity().sizeY,G=React.useCallback(function(e){null!=i&&i(e),m&&!l&&w()},[i,w,m,l]);return createScopedElement(FormField,_extends({vkuiClass:classNames("DateInput","DateInput--sizeY-".concat(Y)),style:c,className:u,getRootRef:multiRef(h,p),after:o?createScopedElement(IconButton,{hoverMode:"opacity","aria-label":k,onClick:q},createScopedElement(Icon16Clear,null)):createScopedElement(IconButton,{hoverMode:"opacity","aria-label":D,onClick:O},createScopedElement(Icon20CalendarOutline,null)),disabled:g,onClick:callMultiple(_,N),onFocus:callMultiple(_,B)},e),createScopedElement("input",{type:"hidden",name:b,value:o?format(o,l?"DD.MM.YYYYTHH:mm":"DD.MM.YYYY"):""}),createScopedElement("span",{vkuiClass:"DateInput__input",onKeyDown:K},createScopedElement(InputLike,{tabIndex:1,length:2,getRootRef:S,index:0,onElementSelect:y,value:P[0],"aria-label":L}),createScopedElement(InputLikeDivider,null,"."),createScopedElement(InputLike,{length:2,getRootRef:C,index:1,onElementSelect:y,value:P[1],"aria-label":f}),createScopedElement(InputLikeDivider,null,"."),createScopedElement(InputLike,{length:4,getRootRef:M,index:2,onElementSelect:y,value:P[2],"aria-label":v}),l&&createScopedElement(React.Fragment,null,createScopedElement(InputLikeDivider,{vkuiClass:"DateInput__input-time-divider"}," "),createScopedElement(InputLike,{length:2,getRootRef:A,index:3,onElementSelect:y,value:P[3],"aria-label":I}),createScopedElement(InputLikeDivider,null,":"),createScopedElement(InputLike,{length:2,getRootRef:E,index:4,onElementSelect:y,value:P[4],"aria-label":R}))),j&&createScopedElement(Popper,{targetRef:h,offsetDistance:8,placement:r},createScopedElement(Calendar,{value:o,onChange:G,enableTime:l,disablePast:n,disableFuture:a,shouldDisableDate:t,onClose:W,getRootRef:x,doneButtonText:s,disablePickers:d,changeHoursAriaLabel:I,changeMinutesAriaLabel:R,prevMonthAriaLabel:H,nextMonthAriaLabel:T,changeMonthAriaLabel:f,changeYearAriaLabel:v,changeDayAriaLabel:L,showNeighboringMonth:z,size:V})))};export{DateInput};