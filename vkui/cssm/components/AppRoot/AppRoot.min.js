import _extends from"@babel/runtime/helpers/extends";import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["children","mode","embedded","sizeX","hasMouse","noLegacyClasses","scroll"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{useDOM}from"../../lib/dom";import{classNames}from"../../lib/classNames";import{AppRootContext}from"./AppRootContext";import{withAdaptivity,SizeType}from"../../hoc/withAdaptivity";import{useIsomorphicLayoutEffect}from"../../lib/useIsomorphicLayoutEffect";import{classScopingMode}from"../../lib/classScopingMode";import{IconSettingsProvider}from"@vkontakte/icons";import{elementScrollController,globalScrollController,ScrollContext}from"./ScrollContext";import{noop}from"../../lib/utils";import{warnOnce}from"../../lib/warnOnce";import{useKeyboardInputTracker}from"../../hooks/useKeyboardInputTracker";import{useInsets}from"../../hooks/useInsets";import"./AppRoot.css";var warn=warnOnce("AppRoot"),AppRoot=withAdaptivity(function(e){var o=e.children,r=e.mode,t=e.embedded,n=e.sizeX,l=e.hasMouse,a=e.noLegacyClasses,a=void 0!==a&&a,s=e.scroll,i=void 0===s?"global":s,s=_objectWithoutProperties(e,_excluded),c=r||(t?"embedded":"full"),e=useKeyboardInputTracker(),u=React.useRef(null),p=React.useState(null),p=_slicedToArray(p,2),m=p[0],d=p[1],p=useDOM(),f=p.window,v=p.document,b=useInsets(),p=React.useRef(!1),p=(p.current||(v&&"full"===c&&v.documentElement.classList.add("vkui"),classScopingMode.noConflict=a,p.current=!0),"development"===process.env.NODE_ENV&&("global"!==i&&"embedded"!==c&&warn("Scroll modes only supported in embedded mode","error"),r&&t&&warn('mode="'.concat(c,'" overrides embedded'))),useIsomorphicLayoutEffect(function(){var o=v.createElement("div");return o.classList.add("vkui__portal-root"),v.body.appendChild(o),d(o),function(){var e;null!=(e=o.parentElement)&&e.removeChild(o)}},[]),useIsomorphicLayoutEffect(function(){var e;if("partial"===c)return noop;var o=null==(e=u.current)?void 0:e.parentElement,r=["vkui__root"].concat("embedded"===c?"vkui__root--embedded":[]);return null!=o&&(e=o.classList).add.apply(e,_toConsumableArray(r)),function(){var e;null!=o&&(e=o.classList).remove.apply(e,_toConsumableArray(r)),"full"===c&&null!=v&&v.documentElement.classList.remove("vkui")}},[]),useIsomorphicLayoutEffect(function(){var e;if("partial"===c||null==(e=u.current)||!e.parentElement)return noop;var o,r,t=u.current.parentElement;for(o in b)b.hasOwnProperty(o)&&"number"==typeof b[o]&&(r=b[o],t.style.setProperty("--safe-area-inset-".concat(o),"".concat(r,"px")),m&&m.style.setProperty("--safe-area-inset-".concat(o),"".concat(r,"px")));return function(){for(var e in b)b.hasOwnProperty(e)&&(t.style.removeProperty("--safe-area-inset-".concat(e)),m&&m.style.removeProperty("--safe-area-inset-".concat(e)))}},[b,m]),useIsomorphicLayoutEffect(function(){var e;if("partial"===c||n!==SizeType.REGULAR)return noop;var o="embedded"===c?null==(e=u.current)?void 0:e.parentElement:v.body;return null!=o&&o.classList.add("vkui--sizeX-regular"),function(){return null==o?void 0:o.classList.remove("vkui--sizeX-regular")}},[n]),React.useMemo(function(){return"contain"===i?elementScrollController(u):globalScrollController(f,v)},[v,i,f])),r=createScopedElement(AppRootContext.Provider,{value:{appRoot:u,portalRoot:m,embedded:"embedded"===c,keyboardInput:e,mode:c}},createScopedElement(ScrollContext.Provider,{value:p},createScopedElement(IconSettingsProvider,{classPrefix:"vkui",globalClasses:!a},o)));return"partial"===c?r:createScopedElement("div",_extends({ref:u,vkuiClass:classNames("AppRoot",{"AppRoot--no-mouse":!l})},s),r)},{sizeX:!0,hasMouse:!0});export{AppRoot};