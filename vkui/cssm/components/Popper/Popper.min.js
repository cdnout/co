import _extends from"@babel/runtime/helpers/extends";import _objectSpread from"@babel/runtime/helpers/objectSpread2";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["targetRef","children","getRef","placement","onPlacementChange","arrow","arrowClassName","sameWidth","offsetDistance","offsetSkidding","forcePortal","style"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{usePopper}from"react-popper";import{AppRootPortal}from"../AppRoot/AppRootPortal";import{usePlatform}from"../../hooks/usePlatform";import{getClassName}from"../../helpers/getClassName";import{useExternRef}from"../../hooks/useExternRef";import{useIsomorphicLayoutEffect}from"../../lib/useIsomorphicLayoutEffect";import"./Popper.css";var ARROW_PADDING=8,ARROW_WIDTH=20,ARROW_HEIGHT=8,Popper=function(e){var r=e.targetRef,t=e.children,o=e.getRef,a=e.placement,a=void 0===a?"bottom-start":a,s=e.onPlacementChange,p=e.arrow,l=e.arrowClassName,i=e.sameWidth,n=e.offsetDistance,c=void 0===n?8:n,n=e.offsetSkidding,m=void 0===n?0:n,n=e.forcePortal,n=void 0===n||n,f=e.style,e=_objectWithoutProperties(e,_excluded),d=React.useState(null),d=_slicedToArray(d,2),u=d[0],d=d[1],h=React.useState(0),h=_slicedToArray(h,2),R=h[0],v=h[1],h=usePlatform(),o=useExternRef(o,d),d=React.useMemo(function(){var e=[{name:"preventOverflow"},{name:"offset",options:{offset:[p?m-R:m,p?c+ARROW_HEIGHT:c]}},{name:"flip"}];return p&&e.push({name:"arrow",options:{padding:ARROW_PADDING}}),i&&e.push({name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){e=e.state;e.styles.popper.width="".concat(e.rects.reference.width,"px")},effect:function(e){e=e.state;e.elements.popper.style.width="".concat(e.elements.reference.offsetWidth,"px")}}),e},[p,i,R,m,c]),u=usePopper(r.current,u,{placement:a,modifiers:d}),a=u.styles,d=u.state,u=u.attributes,P=null==d?void 0:d.placement,_=!!P&&P.includes("-"),e=(useIsomorphicLayoutEffect(function(){var e,t;p&&_?(null!=(t="vertical"==(e=null!=P&&P.startsWith("bottom")||null!=P&&P.startsWith("top")?"vertical":"horizontal")?null==(t=r.current)?void 0:t.offsetWidth:null==(t=r.current)?void 0:t.offsetHeight)?t:0)<(t="vertical"==e?ARROW_WIDTH:ARROW_HEIGHT)+2*ARROW_PADDING&&v(ARROW_PADDING+t/2):v(0)},[p,_]),React.useEffect(function(){P&&s&&s({placement:P})},[s,P]),createScopedElement("div",_extends({},e,u.popper,{vkuiClass:getClassName("Popper",h),ref:o,style:_objectSpread(_objectSpread(_objectSpread({},f),a.popper),{},{minWidth:!i||null==(d=r.current)?void 0:d.scrollWidth})}),p&&createScopedElement("div",_extends({},u.arrow,{vkuiClass:"Popper__arrow","data-popper-arrow":!0,style:a.arrow}),createScopedElement("svg",{vkuiClass:"Popper__arrow-in",className:l,width:"20",height:"8",viewBox:"0 0 20 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},createScopedElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 0C13 0 15.9999 8 20 8H0C3.9749 8 7 0 10 0Z",fill:"currentColor"}))),createScopedElement("div",{vkuiClass:"Popper__content"},t)));return createScopedElement(AppRootPortal,{forcePortal:n,vkuiClass:"PopperPortal"},e)};export{Popper};