import _extends from"@babel/runtime/helpers/extends";import _defineProperty from"@babel/runtime/helpers/defineProperty";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["children","getScrollToLeft","getScrollToRight","showArrows","scrollAnimationDuration","hasMouse","getRef"];import{createScopedElement}from"../../lib/jsxRuntime";import*as React from"react";import{withAdaptivity}from"../../hoc/withAdaptivity";import HorizontalScrollArrow from"./HorizontalScrollArrow";import{easeInOutSine}from"../../lib/fx";import{useEventListener}from"../../hooks/useEventListener";import{useExternRef}from"../../hooks/useExternRef";import{classNames}from"../../lib/classNames";import"./HorizontalScroll.css";function now(){return(performance&&performance.now?performance:Date).now()}var SCROLL_ONE_FRAME_TIME=250;function doScroll(e){var t,o,l,n=e.scrollElement,r=e.getScrollPosition,i=e.animationQueue,c=e.onScrollToRightBorder,a=e.onScrollEnd,s=e.onScrollStart,u=e.initialScrollWidth,e=e.scrollAnimationDuration,f=void 0===e?SCROLL_ONE_FRAME_TIME:e;n&&r&&(e=u-n.offsetWidth,t=n.scrollLeft,o=r(t),s(),e<=o&&(c(),o=e),l=now(),function e(){var r;n?(r=now(),r=Math.min((r-l)/f,1),r=easeInOutSine(r),r=t+(o-t)*r,n.scrollLeft=Math.ceil(r),n.scrollLeft!==Math.max(0,o)?requestAnimationFrame(e):(a(),i.shift(),0<i.length&&i[0]())):a()}())}var HorizontalScrollComponent=function(e){var r=e.children,t=e.getScrollToLeft,o=e.getScrollToRight,l=e.showArrows,n=void 0===l||l,l=e.scrollAnimationDuration,i=void 0===l?SCROLL_ONE_FRAME_TIME:l,c=e.hasMouse,l=e.getRef,e=_objectWithoutProperties(e,_excluded),a=React.useState(!1),a=_slicedToArray(a,2),s=a[0],u=a[1],a=React.useState(!1),a=_slicedToArray(a,2),f=a[0],m=a[1],d=React.useRef(!1),S=useExternRef(l),h=React.useRef([]),p=React.useCallback(function(r){var t=S.current;h.current.push(function(){var e;return doScroll({scrollElement:t,getScrollPosition:r,animationQueue:h.current,onScrollToRightBorder:function(){return m(!1)},onScrollEnd:function(){return d.current=!1},onScrollStart:function(){return d.current=!0},initialScrollWidth:(null==t||null==(e=t.firstElementChild)?void 0:e.scrollWidth)||0,scrollAnimationDuration:i})}),1===h.current.length&&h.current[0]()},[i,S]),a=React.useCallback(function(){p(null!=t?t:function(e){return e-S.current.offsetWidth})},[t,p,S]),l=React.useCallback(function(){p(null!=o?o:function(e){return e+S.current.offsetWidth})},[o,p,S]),R=React.useCallback(function(){var e;n&&c&&S.current&&!d.current&&(e=S.current,u(0<e.scrollLeft),m(e.scrollLeft+e.offsetWidth<e.scrollWidth))},[c,S,n]),E=useEventListener("scroll",R);return React.useEffect(function(){S.current&&E.add(S.current)},[E,S]),React.useEffect(R,[S,r,R]),createScopedElement("div",_extends({},e,{vkuiClass:classNames("HorizontalScroll",_defineProperty({},"HorizontalScroll--withConstArrows","always"===n))}),n&&c&&s&&createScopedElement(HorizontalScrollArrow,{direction:"left",onClick:a}),n&&c&&f&&createScopedElement(HorizontalScrollArrow,{direction:"right",onClick:l}),createScopedElement("div",{vkuiClass:"HorizontalScroll__in",ref:S},createScopedElement("div",{vkuiClass:"HorizontalScroll__in-wrapper"},r)))},HorizontalScroll=withAdaptivity(HorizontalScrollComponent,{hasMouse:!0});export{HorizontalScroll};