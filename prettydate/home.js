/*!
 * Pretty Date v0.1.0
 * https://github.com/fengyuanchen/prettydate
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){d=a.isPlainObject(d)?d:{},this.$element=a(c),this.defaults=a.extend({},b.defaults,this.$element.data(),d),this.init()},c=Math.floor,d=1e3,e=60*d,f=60*e,g=24*f,h=7*g,i=31*g,j=365*g;b.prototype={constructor:b,init:function(){var a=this.$element,c=this.defaults,d=a.is("input"),e=d?a.val():a.text();this.isInput=d,this.originalDate=e,this.format=b.fn.parseFormat(c.dateFormat),this.setDate(c.date||e),this.active=!0,this.date&&(this.prettify(),c.autoUpdate&&this.update())},setDate:function(a){a&&(this.date=b.fn.parseDate(a,this.format))},prettify:function(){var a,b=(new Date).getTime()-this.date.getTime(),k=b>0?!0:!1,l=this.defaults.messages,m=this.$element;this.active&&(b=0>b?d-b:b,a=2*d>b?l.second:e>b?l.seconds.replace("%s",c(b/d)):2*e>b?l.minute:f>b?l.minutes.replace("%s",c(b/e)):2*f>b?l.hour:g>b?l.hours.replace("%s",c(b/f)):2*g>b?k?l.yesterday:l.tomorrow:3*g>b?k?l.beforeYesterday:l.afterTomorrow:h>b?l.days.replace("%s",c(b/g)):2*h>b?l.week:4*h>b?l.weeks.replace("%s",c(b/h)):2*i>b?l.month:j>b?l.months.replace("%s",c(b/i)):2*j>b?l.year:l.years.replace("%s",c(b/j)),a=a.replace("%s",k?this.defaults.beforeSuffix:this.defaults.afterSuffix),this.isInput?m.val(a):m.text(a),this.prettyDate=a)},destroy:function(){var a=this.$element,b=this.originalDate;this.active&&(this.defaults.autoUpdate&&this.autoUpdate&&clearInterval(this.autoUpdate),this.isInput?a.val(b):a.text(b),a.removeData("prettydate"),this.active=!1)},update:function(){var a=this.defaults.duration,b=this;"number"==typeof a&&a>0&&(this.autoUpdate=setInterval(function(){b.prettify()},a))}},b.fn={parseFormat:function(b){var c="string"==typeof b?b.match(/(\w+)/g):[],d=!1;if(!c||0===c.length)throw new Error("Invalid date format.");return b=a.map(c,function(a){var b=a.substr(0,1);switch(b){case"S":case"s":b="s";break;case"m":b=d?"m":"M",d=!0;break;case"H":case"h":b="h";break;case"D":case"d":b="D";break;case"M":b="M",d=!0;break;case"Y":case"y":b="Y"}return b})},parseDate:function(b,c){var d="string"==typeof b?b.match(/(\d+)/g):[],e={Y:0,M:0,D:0,h:0,m:0,s:0};return a.isArray(d)&&a.isArray(c)&&d.length===c.length?(a.each(c,function(a,b){e[b]=parseInt(d[a],10)||0}),e.Y+=e.Y>0&&e.Y<100?2e3:0,b=new Date(e.Y,e.M-1,e.D,e.h,e.m,e.s)):b=new Date(b),b.getTime()?b:null}},b.defaults={afterSuffix:"later",beforeSuffix:"ago",autoUpdate:!1,date:null,dateFormat:"YYYY-MM-DD hh:mm:ss",duration:6e4,messages:{second:"Just now",seconds:"%s seconds %s",minute:"One minute %s",minutes:"%s minutes %s",hour:"One hour %s",hours:"%s hours %s",day:"One day %s",days:"%s days %s",week:"One week %s",weeks:"%s weeks %s",month:"One month %s",months:"%s months %s",year:"One year %s",years:"%s years %s",yesterday:"Yesterday",beforeYesterday:"The day before yesterday",tomorrow:"Tomorrow",afterTomorrow:"The day after tomorrow"}},b.setDefaults=function(c){a.extend(b.defaults,c)},a.fn.prettydate=function(c,d){return this.each(function(){var e=a(this),f=e.data("prettydate");f||e.data("prettydate",f=new b(this,c)),"string"==typeof c&&a.isFunction(f[c])&&f[c](d)})},a.fn.prettydate.constructor=b,a.fn.prettydate.setDefaults=b.setDefaults,a(function(){a("[prettydate]").prettydate()})});