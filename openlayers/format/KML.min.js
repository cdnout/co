var __extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();import Feature from"../Feature.js";import{extend,includes}from"../array.js";import{assert}from"../asserts.js";import{asArray}from"../color.js";import{transformGeometryWithOptions}from"./Feature.js";import XMLFeature from"./XMLFeature.js";import{readDecimal,readBoolean,readString,writeStringTextNode,writeCDATASection,writeDecimalTextNode,writeBooleanTextNode}from"./xsd.js";import GeometryCollection from"../geom/GeometryCollection.js";import GeometryLayout from"../geom/GeometryLayout.js";import GeometryType from"../geom/GeometryType.js";import LineString from"../geom/LineString.js";import MultiLineString from"../geom/MultiLineString.js";import MultiPoint from"../geom/MultiPoint.js";import MultiPolygon from"../geom/MultiPolygon.js";import Point from"../geom/Point.js";import Polygon from"../geom/Polygon.js";import{toRadians}from"../math.js";import{get as getProjection}from"../proj.js";import Fill from"../style/Fill.js";import Icon from"../style/Icon.js";import IconAnchorUnits from"../style/IconAnchorUnits.js";import IconOrigin from"../style/IconOrigin.js";import Stroke from"../style/Stroke.js";import Style from"../style/Style.js";import Text from"../style/Text.js";import{createElementNS,getAllTextContent,isDocument,makeArrayExtender,makeArrayPusher,makeChildAppender,makeObjectPropertySetter,makeReplacer,makeSequence,makeSimpleNodeFactory,makeStructureNS,OBJECT_PROPERTY_NODE_FACTORY,parse,parseNode,pushParseAndPop,pushSerializeAndPop,XML_SCHEMA_INSTANCE_URI}from"../xml.js";var DEFAULT_COLOR,DEFAULT_IMAGE_STYLE_ANCHOR,DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,DEFAULT_IMAGE_STYLE_SIZE,DEFAULT_IMAGE_STYLE_SRC,DEFAULT_IMAGE_SCALE_MULTIPLIER,GX_NAMESPACE_URIS=["http://www.google.com/kml/ext/2.2"],NAMESPACE_URIS=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],SCHEMA_LOCATION="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ICON_ANCHOR_UNITS_MAP={fraction:IconAnchorUnits.FRACTION,pixels:IconAnchorUnits.PIXELS,insetPixels:IconAnchorUnits.PIXELS},PLACEMARK_PARSERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,MultiGeometry:makeObjectPropertySetter(readMultiGeometry,"geometry"),LineString:makeObjectPropertySetter(readLineString,"geometry"),LinearRing:makeObjectPropertySetter(readLinearRing,"geometry"),Point:makeObjectPropertySetter(readPoint,"geometry"),Polygon:makeObjectPropertySetter(readPolygon,"geometry"),Style:makeObjectPropertySetter(readStyle),StyleMap:placemarkStyleMapParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readURI),visibility:makeObjectPropertySetter(readBoolean)},makeStructureNS(GX_NAMESPACE_URIS,{MultiTrack:makeObjectPropertySetter(readGxMultiTrack,"geometry"),Track:makeObjectPropertySetter(readGxTrack,"geometry")})),NETWORK_LINK_PARSERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,Link:linkParser,address:makeObjectPropertySetter(readString),description:makeObjectPropertySetter(readString),name:makeObjectPropertySetter(readString),open:makeObjectPropertySetter(readBoolean),phoneNumber:makeObjectPropertySetter(readString),visibility:makeObjectPropertySetter(readBoolean)}),LINK_PARSERS=makeStructureNS(NAMESPACE_URIS,{href:makeObjectPropertySetter(readURI)}),REGION_PARSERS=makeStructureNS(NAMESPACE_URIS,{LatLonAltBox:latLonAltBoxParser,Lod:lodParser}),KML_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["Document","Placemark"]),KML_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Document:makeChildAppender(writeDocument),Placemark:makeChildAppender(writePlacemark)}),DEFAULT_FILL_STYLE=null;function getDefaultFillStyle(){return DEFAULT_FILL_STYLE}var DEFAULT_NO_IMAGE_STYLE,DEFAULT_IMAGE_STYLE=null;function getDefaultImageStyle(){return DEFAULT_IMAGE_STYLE}var DEFAULT_TEXT_STROKE_STYLE,DEFAULT_STROKE_STYLE=null;function getDefaultStrokeStyle(){return DEFAULT_STROKE_STYLE}var DEFAULT_TEXT_STYLE=null;function getDefaultTextStyle(){return DEFAULT_TEXT_STYLE}var DEFAULT_STYLE=null;function getDefaultStyle(){return DEFAULT_STYLE}var DEFAULT_STYLE_ARRAY=null;function getDefaultStyleArray(){return DEFAULT_STYLE_ARRAY}function createStyleDefaults(){DEFAULT_FILL_STYLE=new Fill({color:DEFAULT_COLOR=[255,255,255,1]}),DEFAULT_IMAGE_STYLE_ANCHOR=[20,2],DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS=IconAnchorUnits.PIXELS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS=IconAnchorUnits.PIXELS,DEFAULT_IMAGE_STYLE_SIZE=[64,64],DEFAULT_IMAGE_STYLE_SRC="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",DEFAULT_IMAGE_SCALE_MULTIPLIER=.5,DEFAULT_IMAGE_STYLE=new Icon({anchor:DEFAULT_IMAGE_STYLE_ANCHOR,anchorOrigin:IconOrigin.BOTTOM_LEFT,anchorXUnits:DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,anchorYUnits:DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,crossOrigin:"anonymous",rotation:0,scale:DEFAULT_IMAGE_SCALE_MULTIPLIER,size:DEFAULT_IMAGE_STYLE_SIZE,src:DEFAULT_IMAGE_STYLE_SRC}),DEFAULT_NO_IMAGE_STYLE="NO_IMAGE",DEFAULT_STROKE_STYLE=new Stroke({color:DEFAULT_COLOR,width:1}),DEFAULT_TEXT_STROKE_STYLE=new Stroke({color:[51,51,51,1],width:2}),DEFAULT_TEXT_STYLE=new Text({font:"bold 16px Helvetica",fill:DEFAULT_FILL_STYLE,stroke:DEFAULT_TEXT_STROKE_STYLE,scale:.8}),DEFAULT_STYLE=new Style({fill:DEFAULT_FILL_STYLE,image:DEFAULT_IMAGE_STYLE,text:DEFAULT_TEXT_STYLE,stroke:DEFAULT_STROKE_STYLE,zIndex:0}),DEFAULT_STYLE_ARRAY=[DEFAULT_STYLE]}var KML=function(r){function e(e){var t=r.call(this)||this,e=e||{};return DEFAULT_STYLE_ARRAY||createStyleDefaults(),t.dataProjection=getProjection("EPSG:4326"),t.defaultStyle_=e.defaultStyle||DEFAULT_STYLE_ARRAY,t.extractStyles_=void 0===e.extractStyles||e.extractStyles,t.writeStyles_=void 0===e.writeStyles||e.writeStyles,t.sharedStyles_={},t.showPointNames_=void 0===e.showPointNames||e.showPointNames,t}return __extends(e,r),e.prototype.readDocumentOrFolder_=function(e,t){var r=makeStructureNS(NAMESPACE_URIS,{Document:makeArrayExtender(this.readDocumentOrFolder_,this),Folder:makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=pushParseAndPop([],r,e,t,this);if(r)return r},e.prototype.readPlacemark_=function(e,t){var r,a=pushParseAndPop({geometry:null},PLACEMARK_PARSERS,e,t);if(a)return r=new Feature,e=e.getAttribute("id"),null!==e&&r.setId(e),e=t[0],t=a.geometry,t&&transformGeometryWithOptions(t,!1,e),r.setGeometry(t),delete a.geometry,this.extractStyles_&&(e=createFeatureStyleFunction(a.Style,a.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_),r.setStyle(e)),delete a.Style,r.setProperties(a,!0),r},e.prototype.readSharedStyle_=function(e,t){var r,a=e.getAttribute("id");null!==a&&(t=readStyle(e,t))&&(r=void 0,r=(e=(e=e.baseURI)&&"about:blank"!=e?e:window.location.href)?new URL("#"+a,e).href:"#"+a,this.sharedStyles_[r]=t)},e.prototype.readSharedStyleMap_=function(e,t){var r=e.getAttribute("id");null!==r&&(t=readStyleMapValue(e,t))&&(e=(e=(e=e.baseURI)&&"about:blank"!=e?e:window.location.href)?new URL("#"+r,e).href:"#"+r,this.sharedStyles_[e]=t)},e.prototype.readFeatureFromNode=function(e,t){if(!includes(NAMESPACE_URIS,e.namespaceURI))return null;e=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return e||null},e.prototype.readFeaturesFromNode=function(e,t){if(!includes(NAMESPACE_URIS,e.namespaceURI))return[];var r,a=e.localName;if("Document"==a||"Folder"==a)return(o=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]))||[];if("Placemark"==a)return(r=this.readPlacemark_(e,[this.getReadOptions(e,t)]))?[r]:[];if("kml"!=a)return[];for(var o=[],n=e.firstElementChild;n;n=n.nextElementSibling){var i=this.readFeaturesFromNode(n,t);i&&extend(o,i)}return o},e.prototype.readName=function(e){var t;if(e)return"string"==typeof e?(t=parse(e),this.readNameFromDocument(t)):isDocument(e)?this.readNameFromDocument(e):this.readNameFromNode(e)},e.prototype.readNameFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){var r=this.readNameFromNode(t);if(r)return r}},e.prototype.readNameFromNode=function(e){for(var t=e.firstElementChild;t;t=t.nextElementSibling)if(includes(NAMESPACE_URIS,t.namespaceURI)&&"name"==t.localName)return readString(t);for(t=e.firstElementChild;t;t=t.nextElementSibling){var r=t.localName;if(includes(NAMESPACE_URIS,t.namespaceURI)&&("Document"==r||"Folder"==r||"Placemark"==r||"kml"==r)){r=this.readNameFromNode(t);if(r)return r}}},e.prototype.readNetworkLinks=function(e){var t,r=[];return"string"==typeof e?(t=parse(e),extend(r,this.readNetworkLinksFromDocument(t))):isDocument(e)?extend(r,this.readNetworkLinksFromDocument(e)):extend(r,this.readNetworkLinksFromNode(e)),r},e.prototype.readNetworkLinksFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&extend(t,this.readNetworkLinksFromNode(r));return t},e.prototype.readNetworkLinksFromNode=function(e){for(var t,r=[],a=e.firstElementChild;a;a=a.nextElementSibling)includes(NAMESPACE_URIS,a.namespaceURI)&&"NetworkLink"==a.localName&&(t=pushParseAndPop({},NETWORK_LINK_PARSERS,a,[]),r.push(t));for(a=e.firstElementChild;a;a=a.nextElementSibling){var o=a.localName;!includes(NAMESPACE_URIS,a.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||extend(r,this.readNetworkLinksFromNode(a))}return r},e.prototype.readRegion=function(e){var t,r=[];return"string"==typeof e?(t=parse(e),extend(r,this.readRegionFromDocument(t))):isDocument(e)?extend(r,this.readRegionFromDocument(e)):extend(r,this.readRegionFromNode(e)),r},e.prototype.readRegionFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&extend(t,this.readRegionFromNode(r));return t},e.prototype.readRegionFromNode=function(e){for(var t,r=[],a=e.firstElementChild;a;a=a.nextElementSibling)includes(NAMESPACE_URIS,a.namespaceURI)&&"Region"==a.localName&&(t=pushParseAndPop({},REGION_PARSERS,a,[]),r.push(t));for(a=e.firstElementChild;a;a=a.nextElementSibling){var o=a.localName;!includes(NAMESPACE_URIS,a.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||extend(r,this.readRegionFromNode(a))}return r},e.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=createElementNS(NAMESPACE_URIS[4],"kml"),a="http://www.w3.org/2000/xmlns/",a=(r.setAttributeNS(a,"xmlns:gx",GX_NAMESPACE_URIS[0]),r.setAttributeNS(a,"xmlns:xsi",XML_SCHEMA_INSTANCE_URI),r.setAttributeNS(XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION),{node:r}),o={},e=(1<e.length?o.Document=e:1==e.length&&(o.Placemark=e[0]),KML_SEQUENCE[r.namespaceURI]),o=makeSequence(o,e);return pushSerializeAndPop(a,KML_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,o,[t],e,this),r},e}(XMLFeature);function createNameStyleFunction(e,t){var r,a,o=null,n=[0,0],i="start";return e.getImage()&&2==(r=null===(r=e.getImage().getImageSize())?DEFAULT_IMAGE_STYLE_SIZE:r).length&&(a=e.getImage().getScale(),n[0]=a*r[0]/2,n[1]=-a*r[1]/2,i="left"),null!==e.getText()?((o=(a=e.getText()).clone()).setFont(a.getFont()||DEFAULT_TEXT_STYLE.getFont()),o.setScale(a.getScale()||DEFAULT_TEXT_STYLE.getScale()),o.setFill(a.getFill()||DEFAULT_TEXT_STYLE.getFill()),o.setStroke(a.getStroke()||DEFAULT_TEXT_STROKE_STYLE)):o=DEFAULT_TEXT_STYLE.clone(),o.setText(t),o.setOffsetX(n[0]),o.setOffsetY(n[1]),o.setTextAlign(i),new Style({text:o})}function createFeatureStyleFunction(i,S,l,E,A){return function(e,t){var r,a,o=A,n="";return(o=o&&(a=e.getGeometry())?a.getType()===GeometryType.POINT:o)&&(n=e.get("name"),o=o&&!!n),i?o?(r=createNameStyleFunction(i[0],n),i.concat(r)):i:S?(a=findStyle(S,l,E),o?(r=createNameStyleFunction(a[0],n),a.concat(r)):a):o?(r=createNameStyleFunction(l[0],n),l.concat(r)):l}}function findStyle(e,t,r){return Array.isArray(e)?e:"string"==typeof e?findStyle(r[e=!(e in r)&&"#"+e in r?"#"+e:e],t,r):t}function readColor(e){var e=getAllTextContent(e,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(e)return e=e[1],[parseInt(e.substr(6,2),16),parseInt(e.substr(4,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(0,2),16)/255]}function readFlatCoordinates(e){for(var t,r=getAllTextContent(e,!1),a=[],o=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;t=o.exec(r);){var n=parseFloat(t[1]),i=parseFloat(t[2]),S=t[3]?parseFloat(t[3]):0;a.push(n,i,S),r=r.substr(t[0].length)}if(""===r)return a}function readURI(e){var t=getAllTextContent(e,!1).trim(),e=e.baseURI;return(e=e&&"about:blank"!=e?e:window.location.href)?new URL(t,e).href:t}function readVec2(e){var t=e.getAttribute("xunits"),r=e.getAttribute("yunits"),a="insetPixels"!==t?"insetPixels"!==r?IconOrigin.BOTTOM_LEFT:IconOrigin.TOP_LEFT:"insetPixels"!==r?IconOrigin.BOTTOM_RIGHT:IconOrigin.TOP_RIGHT;return{x:parseFloat(e.getAttribute("x")),xunits:ICON_ANCHOR_UNITS_MAP[t],y:parseFloat(e.getAttribute("y")),yunits:ICON_ANCHOR_UNITS_MAP[r],origin:a}}function readScale(e){return readDecimal(e)}var STYLE_MAP_PARSERS=makeStructureNS(NAMESPACE_URIS,{Pair:pairDataParser});function readStyleMapValue(e,t){return pushParseAndPop(void 0,STYLE_MAP_PARSERS,e,t)}var ICON_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{Icon:makeObjectPropertySetter(readIcon),heading:makeObjectPropertySetter(readDecimal),hotSpot:makeObjectPropertySetter(readVec2),scale:makeObjectPropertySetter(readScale)});function iconStyleParser(e,t){var r,a,o,n,i,S,l,E,A,d,s,_,e=pushParseAndPop({},ICON_STYLE_PARSERS,e,t);e&&(t=t[t.length-1],d="Icon"in e?e.Icon:{},r=!("Icon"in e)||0<Object.keys(d).length,(S=d.href)?a=S:r&&(a=DEFAULT_IMAGE_STYLE_SRC),S=IconOrigin.BOTTOM_LEFT,(s=e.hotSpot)?(o=[s.x,s.y],n=s.xunits,i=s.yunits,S=s.origin):a===DEFAULT_IMAGE_STYLE_SRC?(o=DEFAULT_IMAGE_STYLE_ANCHOR,n=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,i=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(o=[.5,0],n=IconAnchorUnits.FRACTION,i=IconAnchorUnits.FRACTION),s=d.x,_=d.y,void 0!==s&&void 0!==_&&(l=[s,_]),s=d.w,_=d.h,void 0!==s&&void 0!==_&&(E=[s,_]),void 0!==(d=e.heading)&&(A=toRadians(d)),s=e.scale,r?(a==DEFAULT_IMAGE_STYLE_SRC&&(E=DEFAULT_IMAGE_STYLE_SIZE,void 0===s&&(s=DEFAULT_IMAGE_SCALE_MULTIPLIER)),_=new Icon({anchor:o,anchorOrigin:S,anchorXUnits:n,anchorYUnits:i,crossOrigin:"anonymous",offset:l,offsetOrigin:IconOrigin.BOTTOM_LEFT,rotation:A,scale:s,size:E,src:a}),t.imageStyle=_):t.imageStyle=DEFAULT_NO_IMAGE_STYLE)}var LABEL_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),scale:makeObjectPropertySetter(readScale)});function labelStyleParser(e,t){var e=pushParseAndPop({},LABEL_STYLE_PARSERS,e,t);e&&(t=t[t.length-1],e=new Text({fill:new Fill({color:"color"in e?e.color:DEFAULT_COLOR}),scale:e.scale}),t.textStyle=e)}var LINE_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),width:makeObjectPropertySetter(readDecimal)});function lineStyleParser(e,t){var e=pushParseAndPop({},LINE_STYLE_PARSERS,e,t);e&&(t=t[t.length-1],e=new Stroke({color:"color"in e?e.color:DEFAULT_COLOR,width:"width"in e?e.width:1}),t.strokeStyle=e)}var POLY_STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{color:makeObjectPropertySetter(readColor),fill:makeObjectPropertySetter(readBoolean),outline:makeObjectPropertySetter(readBoolean)});function polyStyleParser(e,t){var r,e=pushParseAndPop({},POLY_STYLE_PARSERS,e,t);e&&(t=t[t.length-1],r=new Fill({color:"color"in e?e.color:DEFAULT_COLOR}),t.fillStyle=r,void 0!==(r=e.fill)&&(t.fill=r),void 0!==(r=e.outline)&&(t.outline=r))}var FLAT_LINEAR_RING_PARSERS=makeStructureNS(NAMESPACE_URIS,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatLinearRing(e,t){return pushParseAndPop(null,FLAT_LINEAR_RING_PARSERS,e,t)}function gxCoordParser(e,t){var r,a,t=t[t.length-1].flatCoordinates,e=getAllTextContent(e,!1),e=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(e);e?(r=parseFloat(e[1]),a=parseFloat(e[2]),e=parseFloat(e[3]),t.push(r,a,e,0)):t.push(0,0,0,0)}var GX_MULTITRACK_GEOMETRY_PARSERS=makeStructureNS(GX_NAMESPACE_URIS,{Track:makeArrayPusher(readGxTrack)});function readGxMultiTrack(e,t){e=pushParseAndPop([],GX_MULTITRACK_GEOMETRY_PARSERS,e,t);if(e)return new MultiLineString(e)}var GX_TRACK_PARSERS=makeStructureNS(NAMESPACE_URIS,{when:whenParser},makeStructureNS(GX_NAMESPACE_URIS,{coord:gxCoordParser}));function readGxTrack(e,t){e=pushParseAndPop({flatCoordinates:[],whens:[]},GX_TRACK_PARSERS,e,t);if(e){for(var r=e.flatCoordinates,a=e.whens,o=0,n=Math.min(r.length,a.length);o<n;++o)r[4*o+3]=a[o];return new LineString(r,GeometryLayout.XYZM)}}var ICON_PARSERS=makeStructureNS(NAMESPACE_URIS,{href:makeObjectPropertySetter(readURI)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeObjectPropertySetter(readDecimal),y:makeObjectPropertySetter(readDecimal),w:makeObjectPropertySetter(readDecimal),h:makeObjectPropertySetter(readDecimal)}));function readIcon(e,t){e=pushParseAndPop({},ICON_PARSERS,e,t);return e||null}var GEOMETRY_FLAT_COORDINATES_PARSERS=makeStructureNS(NAMESPACE_URIS,{coordinates:makeReplacer(readFlatCoordinates)});function readFlatCoordinatesFromNode(e,t){return pushParseAndPop(null,GEOMETRY_FLAT_COORDINATES_PARSERS,e,t)}var EXTRUDE_AND_ALTITUDE_MODE_PARSERS=makeStructureNS(NAMESPACE_URIS,{extrude:makeObjectPropertySetter(readBoolean),tessellate:makeObjectPropertySetter(readBoolean),altitudeMode:makeObjectPropertySetter(readString)});function readLineString(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),e=readFlatCoordinatesFromNode(e,t);if(e)return(t=new LineString(e,GeometryLayout.XYZ)).setProperties(r,!0),t}function readLinearRing(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),e=readFlatCoordinatesFromNode(e,t);if(e)return(t=new Polygon(e,GeometryLayout.XYZ,[e.length])).setProperties(r,!0),t}var MULTI_GEOMETRY_PARSERS=makeStructureNS(NAMESPACE_URIS,{LineString:makeArrayPusher(readLineString),LinearRing:makeArrayPusher(readLinearRing),MultiGeometry:makeArrayPusher(readMultiGeometry),Point:makeArrayPusher(readPoint),Polygon:makeArrayPusher(readPolygon)});function readMultiGeometry(e,t){var r,a=pushParseAndPop([],MULTI_GEOMETRY_PARSERS,e,t);if(!a)return null;if(0===a.length)return new GeometryCollection(a);for(var o,n=!0,i=a[0].getType(),S=1,l=a.length;S<l;++S)if((o=a[S]).getType()!=i){n=!1;break}if(n)if(i==GeometryType.POINT){for(var e=a[0],t=e.getLayout(),E=e.getFlatCoordinates(),S=1,l=a.length;S<l;++S)o=a[S],extend(E,o.getFlatCoordinates());setCommonGeometryProperties(r=new MultiPoint(E,t),a)}else i==GeometryType.LINE_STRING?setCommonGeometryProperties(r=new MultiLineString(a),a):i==GeometryType.POLYGON?setCommonGeometryProperties(r=new MultiPolygon(a),a):i==GeometryType.GEOMETRY_COLLECTION?r=new GeometryCollection(a):assert(!1,37);else r=new GeometryCollection(a);return r}function readPoint(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),e=readFlatCoordinatesFromNode(e,t);if(e)return(t=new Point(e,GeometryLayout.XYZ)).setProperties(r,!0),t}var FLAT_LINEAR_RINGS_PARSERS=makeStructureNS(NAMESPACE_URIS,{innerBoundaryIs:innerBoundaryIsParser,outerBoundaryIs:outerBoundaryIsParser});function readPolygon(e,t){var r=pushParseAndPop({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=pushParseAndPop([null],FLAT_LINEAR_RINGS_PARSERS,e,t);if(a&&a[0]){for(var o=a[0],n=[o.length],i=1,S=a.length;i<S;++i)extend(o,a[i]),n.push(o.length);e=new Polygon(o,GeometryLayout.XYZ,n);return e.setProperties(r,!0),e}}var STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{IconStyle:iconStyleParser,LabelStyle:labelStyleParser,LineStyle:lineStyleParser,PolyStyle:polyStyleParser});function readStyle(e,t){e=pushParseAndPop({},STYLE_PARSERS,e,t);if(!e)return null;var r,t="fillStyle"in e?e.fillStyle:DEFAULT_FILL_STYLE,a=e.fill,a=(void 0===a||a||(t=null),"imageStyle"in e?e.imageStyle!=DEFAULT_NO_IMAGE_STYLE&&(r=e.imageStyle):r=DEFAULT_IMAGE_STYLE,"textStyle"in e?e.textStyle:DEFAULT_TEXT_STYLE),o="strokeStyle"in e?e.strokeStyle:DEFAULT_STROKE_STYLE,e=e.outline;return[new Style({fill:t,image:r,stroke:o=void 0===e||e?o:null,text:a,zIndex:void 0})]}function setCommonGeometryProperties(e,t){for(var r,a,o=t.length,n=new Array(t.length),i=new Array(t.length),S=new Array(t.length),l=r=a=!1,E=0;E<o;++E){var A=t[E];n[E]=A.get("extrude"),i[E]=A.get("tessellate"),S[E]=A.get("altitudeMode"),l=l||void 0!==n[E],r=r||void 0!==i[E],a=a||S[E]}l&&e.set("extrude",n),r&&e.set("tessellate",i),a&&e.set("altitudeMode",S)}var DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{displayName:makeObjectPropertySetter(readString),value:makeObjectPropertySetter(readString)});function dataParser(e,t){var r=e.getAttribute("name"),a=(parseNode(DATA_PARSERS,e,t),t[t.length-1]);r&&a.displayName?a[r]={value:a.value,displayName:a.displayName,toString:function(){return a.value}}:null!==r?a[r]=a.value:null!==a.displayName&&(a[a.displayName]=a.value),delete a.value}var EXTENDED_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{Data:dataParser,SchemaData:schemaDataParser});function extendedDataParser(e,t){parseNode(EXTENDED_DATA_PARSERS,e,t)}function regionParser(e,t){parseNode(REGION_PARSERS,e,t)}var PAIR_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertySetter(readStyle),key:makeObjectPropertySetter(readString),styleUrl:makeObjectPropertySetter(readURI)});function pairDataParser(e,t){var r,e=pushParseAndPop({},PAIR_PARSERS,e,t);!e||(r=e.key)&&"normal"==r&&((r=e.styleUrl)&&(t[t.length-1]=r),(r=e.Style)&&(t[t.length-1]=r))}function placemarkStyleMapParser(e,t){e=readStyleMapValue(e,t);e&&(t=t[t.length-1],Array.isArray(e)?t.Style=e:"string"==typeof e?t.styleUrl=e:assert(!1,38))}var SCHEMA_DATA_PARSERS=makeStructureNS(NAMESPACE_URIS,{SimpleData:simpleDataParser});function schemaDataParser(e,t){parseNode(SCHEMA_DATA_PARSERS,e,t)}function simpleDataParser(e,t){var r=e.getAttribute("name");null!==r&&(e=readString(e),t[t.length-1][r]=e)}var LAT_LON_ALT_BOX_PARSERS=makeStructureNS(NAMESPACE_URIS,{altitudeMode:makeObjectPropertySetter(readString),minAltitude:makeObjectPropertySetter(readDecimal),maxAltitude:makeObjectPropertySetter(readDecimal),north:makeObjectPropertySetter(readDecimal),south:makeObjectPropertySetter(readDecimal),east:makeObjectPropertySetter(readDecimal),west:makeObjectPropertySetter(readDecimal)});function latLonAltBoxParser(e,t){var r,e=pushParseAndPop({},LAT_LON_ALT_BOX_PARSERS,e,t);e&&(t=t[t.length-1],r=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)],t.extent=r,t.altitudeMode=e.altitudeMode,t.minAltitude=parseFloat(e.minAltitude),t.maxAltitude=parseFloat(e.maxAltitude))}var LOD_PARSERS=makeStructureNS(NAMESPACE_URIS,{minLodPixels:makeObjectPropertySetter(readDecimal),maxLodPixels:makeObjectPropertySetter(readDecimal),minFadeExtent:makeObjectPropertySetter(readDecimal),maxFadeExtent:makeObjectPropertySetter(readDecimal)});function lodParser(e,t){e=pushParseAndPop({},LOD_PARSERS,e,t);e&&((t=t[t.length-1]).minLodPixels=parseFloat(e.minLodPixels),t.maxLodPixels=parseFloat(e.maxLodPixels),t.minFadeExtent=parseFloat(e.minFadeExtent),t.maxFadeExtent=parseFloat(e.maxFadeExtent))}var INNER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeReplacer(readFlatLinearRing)});function innerBoundaryIsParser(e,t){e=pushParseAndPop(void 0,INNER_BOUNDARY_IS_PARSERS,e,t);e&&t[t.length-1].push(e)}var OUTER_BOUNDARY_IS_PARSERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeReplacer(readFlatLinearRing)});function outerBoundaryIsParser(e,t){e=pushParseAndPop(void 0,OUTER_BOUNDARY_IS_PARSERS,e,t);e&&(t[t.length-1][0]=e)}function linkParser(e,t){parseNode(LINK_PARSERS,e,t)}function whenParser(e,t){t=t[t.length-1].whens,e=getAllTextContent(e,!1),e=Date.parse(e);t.push(isNaN(e)?0:e)}function writeColorTextNode(e,t){for(var t=asArray(t),r=[255*(4==t.length?t[3]:1),t[2],t[1],t[0]],a=0;a<4;++a){var o=Math.floor(r[a]).toString(16);r[a]=1==o.length?"0"+o:o}writeStringTextNode(e,r.join(""))}function writeCoordinatesTextNode(e,t,r){var a,r=r[r.length-1],o=r.layout,n=r.stride,i=(o==GeometryLayout.XY||o==GeometryLayout.XYM?a=2:o==GeometryLayout.XYZ||o==GeometryLayout.XYZM?a=3:assert(!1,34),t.length),S="";if(0<i){S+=t[0];for(var l=1;l<a;++l)S+=","+t[l];for(var E=n;E<i;E+=n){S+=" "+t[E];for(l=1;l<a;++l)S+=","+t[E+l]}}writeStringTextNode(e,S)}var EXTENDEDDATA_NODE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Data:makeChildAppender(writeDataNode),value:makeChildAppender(writeDataNodeValue),displayName:makeChildAppender(writeDataNodeName)});function writeDataNode(e,t,r){e.setAttribute("name",t.name);e={node:e},t=t.value;"object"==typeof t?(null!==t&&t.displayName&&pushSerializeAndPop(e,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[t.displayName],r,["displayName"]),null!==t&&t.value&&pushSerializeAndPop(e,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[t.value],r,["value"])):pushSerializeAndPop(e,EXTENDEDDATA_NODE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,[t],r,["value"])}function writeDataNodeName(e,t){writeCDATASection(e,t)}function writeDataNodeValue(e,t){writeStringTextNode(e,t)}var DOCUMENT_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Placemark:makeChildAppender(writePlacemark)}),DOCUMENT_NODE_FACTORY=function(e,t,r){t=t[t.length-1].node;return createElementNS(t.namespaceURI,"Placemark")};function writeDocument(e,t,r){pushSerializeAndPop({node:e},DOCUMENT_SERIALIZERS,DOCUMENT_NODE_FACTORY,t,r,void 0,this)}var DATA_NODE_FACTORY=makeSimpleNodeFactory("Data");function writeExtendedData(e,t,r){for(var a={node:e},o=t.names,n=t.values,i=o.length,S=0;S<i;S++)pushSerializeAndPop(a,EXTENDEDDATA_NODE_SERIALIZERS,DATA_NODE_FACTORY,[{name:o[S],value:n[S]}],r)}var ICON_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["href"],makeStructureNS(GX_NAMESPACE_URIS,["x","y","w","h"])),ICON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{href:makeChildAppender(writeStringTextNode)},makeStructureNS(GX_NAMESPACE_URIS,{x:makeChildAppender(writeDecimalTextNode),y:makeChildAppender(writeDecimalTextNode),w:makeChildAppender(writeDecimalTextNode),h:makeChildAppender(writeDecimalTextNode)})),GX_NODE_FACTORY=function(e,t,r){return createElementNS(GX_NAMESPACE_URIS[0],"gx:"+r)};function writeIcon(e,t,r){var e={node:e},a=r[r.length-1].node,a=ICON_SEQUENCE[a.namespaceURI],o=makeSequence(t,a);pushSerializeAndPop(e,ICON_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,o,r,a),a=ICON_SEQUENCE[GX_NAMESPACE_URIS[0]],o=makeSequence(t,a),pushSerializeAndPop(e,ICON_SERIALIZERS,GX_NODE_FACTORY,o,r,a)}var ICON_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["scale","heading","Icon","hotSpot"]),ICON_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{Icon:makeChildAppender(writeIcon),heading:makeChildAppender(writeDecimalTextNode),hotSpot:makeChildAppender(writeVec2),scale:makeChildAppender(writeScaleTextNode)});function writeIconStyle(e,t,r){var e={node:e},a={},o=t.getSrc(),n=t.getSize(),i=t.getImageSize(),o={href:o},S=(n&&(o.w=n[0],o.h=n[1],l=t.getAnchor(),(S=t.getOrigin())&&i&&0!==S[0]&&S[1]!==n[1]&&(o.x=S[0],o.y=i[1]-(S[1]+n[1])),!l||l[0]===n[0]/2&&l[1]===n[1]/2||(i={x:l[0],xunits:IconAnchorUnits.PIXELS,y:n[1]-l[1],yunits:IconAnchorUnits.PIXELS},a.hotSpot=i)),a.Icon=o,t.getScale()),n=(1!==S&&(a.scale=S),t.getRotation()),l=(0!==n&&(a.heading=n),r[r.length-1].node),i=ICON_STYLE_SEQUENCE[l.namespaceURI],o=makeSequence(a,i);pushSerializeAndPop(e,ICON_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,o,r,i)}var LABEL_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","scale"]),LABEL_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),scale:makeChildAppender(writeScaleTextNode)});function writeLabelStyle(e,t,r){var e={node:e},a={},o=t.getFill(),o=(o&&(a.color=o.getColor()),t.getScale()),t=(o&&1!==o&&(a.scale=o),r[r.length-1].node),o=LABEL_STYLE_SEQUENCE[t.namespaceURI],t=makeSequence(a,o);pushSerializeAndPop(e,LABEL_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,t,r,o)}var LINE_STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["color","width"]),LINE_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode),width:makeChildAppender(writeDecimalTextNode)});function writeLineStyle(e,t,r){var e={node:e},t={color:t.getColor(),width:t.getWidth()},a=r[r.length-1].node,a=LINE_STYLE_SEQUENCE[a.namespaceURI],t=makeSequence(t,a);pushSerializeAndPop(e,LINE_STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,t,r,a)}var GEOMETRY_TYPE_TO_NODENAME={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},GEOMETRY_NODE_FACTORY=function(e,t,r){if(e)return t=t[t.length-1].node,createElementNS(t.namespaceURI,GEOMETRY_TYPE_TO_NODENAME[e.getType()])},POINT_NODE_FACTORY=makeSimpleNodeFactory("Point"),LINE_STRING_NODE_FACTORY=makeSimpleNodeFactory("LineString"),LINEAR_RING_NODE_FACTORY=makeSimpleNodeFactory("LinearRing"),POLYGON_NODE_FACTORY=makeSimpleNodeFactory("Polygon"),MULTI_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{LineString:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),GeometryCollection:makeChildAppender(writeMultiGeometry)});function writeMultiGeometry(e,t,r){var a,o,e={node:e},n=t.getType();n==GeometryType.GEOMETRY_COLLECTION?(a=t.getGeometries(),o=GEOMETRY_NODE_FACTORY):n==GeometryType.MULTI_POINT?(a=t.getPoints(),o=POINT_NODE_FACTORY):n==GeometryType.MULTI_LINE_STRING?(a=t.getLineStrings(),o=LINE_STRING_NODE_FACTORY):n==GeometryType.MULTI_POLYGON?(a=t.getPolygons(),o=POLYGON_NODE_FACTORY):assert(!1,39),pushSerializeAndPop(e,MULTI_GEOMETRY_SERIALIZERS,o,a,r)}var BOUNDARY_IS_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{LinearRing:makeChildAppender(writePrimitiveGeometry)});function writeBoundaryIs(e,t,r){pushSerializeAndPop({node:e},BOUNDARY_IS_SERIALIZERS,LINEAR_RING_NODE_FACTORY,[t],r)}var PLACEMARK_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{ExtendedData:makeChildAppender(writeExtendedData),MultiGeometry:makeChildAppender(writeMultiGeometry),LineString:makeChildAppender(writePrimitiveGeometry),LinearRing:makeChildAppender(writePrimitiveGeometry),Point:makeChildAppender(writePrimitiveGeometry),Polygon:makeChildAppender(writePolygon),Style:makeChildAppender(writeStyle),address:makeChildAppender(writeStringTextNode),description:makeChildAppender(writeStringTextNode),name:makeChildAppender(writeStringTextNode),open:makeChildAppender(writeBooleanTextNode),phoneNumber:makeChildAppender(writeStringTextNode),styleUrl:makeChildAppender(writeStringTextNode),visibility:makeChildAppender(writeBooleanTextNode)}),PLACEMARK_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),EXTENDEDDATA_NODE_FACTORY=makeSimpleNodeFactory("ExtendedData");function writePlacemark(e,t,r){var a={node:e},e=(t.getId()&&e.setAttribute("id",t.getId()),t.getProperties()),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1},n=(o[t.getGeometryName()]=1,Object.keys(e||{}).sort().filter(function(e){return!o[e]})),i=t.getStyleFunction(),i=(!i||(i=i(t,0))&&(i=Array.isArray(i)?i[0]:i,this.writeStyles_&&(e.Style=i),(i=i.getText())&&(e.name=i.getText())),r[r.length-1].node),i=PLACEMARK_SEQUENCE[i.namespaceURI],S=makeSequence(e,i),i=(pushSerializeAndPop(a,PLACEMARK_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,S,r,i),0<n.length&&(S=makeSequence(e,n),pushSerializeAndPop(a,PLACEMARK_SERIALIZERS,EXTENDEDDATA_NODE_FACTORY,[{names:n,values:S}],r)),r[0]),e=(e=t.getGeometry())&&transformGeometryWithOptions(e,!0,i);pushSerializeAndPop(a,PLACEMARK_SERIALIZERS,GEOMETRY_NODE_FACTORY,[e],r)}var PRIMITIVE_GEOMETRY_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["extrude","tessellate","altitudeMode","coordinates"]),PRIMITIVE_GEOMETRY_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{extrude:makeChildAppender(writeBooleanTextNode),tessellate:makeChildAppender(writeBooleanTextNode),altitudeMode:makeChildAppender(writeStringTextNode),coordinates:makeChildAppender(writeCoordinatesTextNode)});function writePrimitiveGeometry(e,t,r){var a=t.getFlatCoordinates(),e={node:e},t=(e.layout=t.getLayout(),e.stride=t.getStride(),t.getProperties()),a=(t.coordinates=a,r[r.length-1].node),a=PRIMITIVE_GEOMETRY_SEQUENCE[a.namespaceURI],t=makeSequence(t,a);pushSerializeAndPop(e,PRIMITIVE_GEOMETRY_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,t,r,a)}var POLYGON_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{outerBoundaryIs:makeChildAppender(writeBoundaryIs),innerBoundaryIs:makeChildAppender(writeBoundaryIs)}),INNER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("innerBoundaryIs"),OUTER_BOUNDARY_NODE_FACTORY=makeSimpleNodeFactory("outerBoundaryIs");function writePolygon(e,t,r){var t=t.getLinearRings(),a=t.shift(),e={node:e};pushSerializeAndPop(e,POLYGON_SERIALIZERS,INNER_BOUNDARY_NODE_FACTORY,t,r),pushSerializeAndPop(e,POLYGON_SERIALIZERS,OUTER_BOUNDARY_NODE_FACTORY,[a],r)}var POLY_STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{color:makeChildAppender(writeColorTextNode)}),COLOR_NODE_FACTORY=makeSimpleNodeFactory("color");function writePolyStyle(e,t,r){pushSerializeAndPop({node:e},POLY_STYLE_SERIALIZERS,COLOR_NODE_FACTORY,[t.getColor()],r)}function writeScaleTextNode(e,t){writeDecimalTextNode(e,Math.round(1e6*t)/1e6)}var STYLE_SEQUENCE=makeStructureNS(NAMESPACE_URIS,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),STYLE_SERIALIZERS=makeStructureNS(NAMESPACE_URIS,{IconStyle:makeChildAppender(writeIconStyle),LabelStyle:makeChildAppender(writeLabelStyle),LineStyle:makeChildAppender(writeLineStyle),PolyStyle:makeChildAppender(writePolyStyle)});function writeStyle(e,t,r){var e={node:e},a={},o=t.getFill(),n=t.getStroke(),i=t.getImage(),t=t.getText(),i=(i&&"function"==typeof i.getSrc&&(a.IconStyle=i),t&&(a.LabelStyle=t),n&&(a.LineStyle=n),o&&(a.PolyStyle=o),r[r.length-1].node),t=STYLE_SEQUENCE[i.namespaceURI],n=makeSequence(a,t);pushSerializeAndPop(e,STYLE_SERIALIZERS,OBJECT_PROPERTY_NODE_FACTORY,n,r,t)}function writeVec2(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)}export default KML;export{getDefaultFillStyle,getDefaultImageStyle,getDefaultStrokeStyle,getDefaultTextStyle,getDefaultStyle,getDefaultStyleArray,readFlatCoordinates};