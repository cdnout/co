var __extends=this&&this.__extends||function(){var a=function(e,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)};return function(e,r){function t(){this.constructor=e}a(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}();import{boundingExtent}from"../extent.js";import OWS from"./OWS.js";import{readHref}from"./XLink.js";import XML from"./XML.js";import{readString,readNonNegativeInteger,readDecimal}from"./xsd.js";import{pushParseAndPop,makeStructureNS,makeObjectPropertySetter,makeObjectPropertyPusher,makeArrayPusher}from"../xml.js";var NAMESPACE_URIS=[null,"http://www.opengis.net/wmts/1.0"],OWS_NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS=makeStructureNS(NAMESPACE_URIS,{Contents:makeObjectPropertySetter(readContents)}),WMTSCapabilities=function(r){function e(){var e=r.call(this)||this;return e.owsParser_=new OWS,e}return __extends(e,r),e.prototype.readFromDocument=function(e){for(var r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readFromNode(r);return null},e.prototype.readFromNode=function(e){var r=e.getAttribute("version").trim(),t=this.owsParser_.readFromNode(e);return t?(t.version=r,(t=pushParseAndPop(t,PARSERS,e,[]))||null):null},e}(XML),CONTENTS_PARSERS=makeStructureNS(NAMESPACE_URIS,{Layer:makeObjectPropertyPusher(readLayer),TileMatrixSet:makeObjectPropertyPusher(readTileMatrixSet)}),LAYER_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertyPusher(readStyle),Format:makeObjectPropertyPusher(readString),TileMatrixSetLink:makeObjectPropertyPusher(readTileMatrixSetLink),Dimension:makeObjectPropertyPusher(readDimensions),ResourceURL:makeObjectPropertyPusher(readResourceUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),WGS84BoundingBox:makeObjectPropertySetter(readWgs84BoundingBox),Identifier:makeObjectPropertySetter(readString)})),STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{LegendURL:makeObjectPropertyPusher(readLegendUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TMS_LINKS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixSet:makeObjectPropertySetter(readString),TileMatrixSetLimits:makeObjectPropertySetter(readTileMatrixLimitsList)}),TMS_LIMITS_LIST_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixLimits:makeArrayPusher(readTileMatrixLimits)}),TMS_LIMITS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrix:makeObjectPropertySetter(readString),MinTileRow:makeObjectPropertySetter(readNonNegativeInteger),MaxTileRow:makeObjectPropertySetter(readNonNegativeInteger),MinTileCol:makeObjectPropertySetter(readNonNegativeInteger),MaxTileCol:makeObjectPropertySetter(readNonNegativeInteger)}),DIMENSION_PARSERS=makeStructureNS(NAMESPACE_URIS,{Default:makeObjectPropertySetter(readString),Value:makeObjectPropertyPusher(readString)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)})),WGS84_BBOX_READERS=makeStructureNS(OWS_NAMESPACE_URIS,{LowerCorner:makeArrayPusher(readCoordinates),UpperCorner:makeArrayPusher(readCoordinates)}),TMS_PARSERS=makeStructureNS(NAMESPACE_URIS,{WellKnownScaleSet:makeObjectPropertySetter(readString),TileMatrix:makeObjectPropertyPusher(readTileMatrix)},makeStructureNS(OWS_NAMESPACE_URIS,{SupportedCRS:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TM_PARSERS=makeStructureNS(NAMESPACE_URIS,{TopLeftCorner:makeObjectPropertySetter(readCoordinates),ScaleDenominator:makeObjectPropertySetter(readDecimal),TileWidth:makeObjectPropertySetter(readNonNegativeInteger),TileHeight:makeObjectPropertySetter(readNonNegativeInteger),MatrixWidth:makeObjectPropertySetter(readNonNegativeInteger),MatrixHeight:makeObjectPropertySetter(readNonNegativeInteger)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)}));function readContents(e,r){return pushParseAndPop({},CONTENTS_PARSERS,e,r)}function readLayer(e,r){return pushParseAndPop({},LAYER_PARSERS,e,r)}function readTileMatrixSet(e,r){return pushParseAndPop({},TMS_PARSERS,e,r)}function readStyle(e,r){r=pushParseAndPop({},STYLE_PARSERS,e,r);if(r)return e="true"===e.getAttribute("isDefault"),r.isDefault=e,r}function readTileMatrixSetLink(e,r){return pushParseAndPop({},TMS_LINKS_PARSERS,e,r)}function readDimensions(e,r){return pushParseAndPop({},DIMENSION_PARSERS,e,r)}function readResourceUrl(e,r){var t=e.getAttribute("format"),a=e.getAttribute("template"),e=e.getAttribute("resourceType"),S={};return t&&(S.format=t),a&&(S.template=a),e&&(S.resourceType=e),S}function readWgs84BoundingBox(e,r){e=pushParseAndPop([],WGS84_BBOX_READERS,e,r);if(2==e.length)return boundingExtent(e)}function readLegendUrl(e,r){var t={};return t.format=e.getAttribute("format"),t.href=readHref(e),t}function readCoordinates(e,r){e=readString(e).split(/\s+/);if(e&&2==e.length){var t=+e[0],e=+e[1];if(!isNaN(t)&&!isNaN(e))return[t,e]}}function readTileMatrix(e,r){return pushParseAndPop({},TM_PARSERS,e,r)}function readTileMatrixLimitsList(e,r){return pushParseAndPop([],TMS_LIMITS_LIST_PARSERS,e,r)}function readTileMatrixLimits(e,r){return pushParseAndPop({},TMS_LIMITS_PARSERS,e,r)}export default WMTSCapabilities;