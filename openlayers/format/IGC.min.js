var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();import Feature from"../Feature.js";import{transformGeometryWithOptions}from"./Feature.js";import TextFeature from"./TextFeature.js";import GeometryLayout from"../geom/GeometryLayout.js";import LineString from"../geom/LineString.js";import{get as getProjection}from"../proj.js";var IGCZ={BAROMETRIC:"barometric",GPS:"gps",NONE:"none"},B_RECORD_RE=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,H_RECORD_RE=/^H.([A-Z]{3}).*?:(.*)/,HFDTE_RECORD_RE=/^HFDTE(\d{2})(\d{2})(\d{2})/,NEWLINE_RE=/\r\n|\r|\n/,IGC=function(r){function t(t){var e=r.call(this)||this,t=t||{};return e.dataProjection=getProjection("EPSG:4326"),e.altitudeMode_=t.altitudeMode||IGCZ.NONE,e}return __extends(t,r),t.prototype.readFeatureFromText=function(t,e){for(var r=this.altitudeMode_,o=t.split(NEWLINE_RE),n={},a=[],i=2e3,s=0,p=1,u=-1,_=0,E=o.length;_<E;++_){var d,m,c,f,I,R=o[_],y=void 0;"B"==R.charAt(0)?(y=B_RECORD_RE.exec(R))&&(d=parseInt(y[1],10),m=parseInt(y[2],10),c=parseInt(y[3],10),I=parseInt(y[4],10)+parseInt(y[5],10)/6e4,"S"==y[6]&&(I=-I),f=parseInt(y[7],10)+parseInt(y[8],10)/6e4,"W"==y[9]&&(f=-f),a.push(f,I),r!=IGCZ.NONE&&(f=void 0,f=r==IGCZ.GPS?parseInt(y[11],10):r==IGCZ.BAROMETRIC?parseInt(y[12],10):0,a.push(f)),(I=Date.UTC(i,s,p,d,m,c))<u&&(I=Date.UTC(i,s,p+1,d,m,c)),a.push(I/1e3),u=I):"H"==R.charAt(0)&&((y=HFDTE_RECORD_RE.exec(R))?(p=parseInt(y[1],10),s=parseInt(y[2],10)-1,i=2e3+parseInt(y[3],10)):(y=H_RECORD_RE.exec(R))&&(n[y[1]]=y[2].trim()))}if(0===a.length)return null;t=r==IGCZ.NONE?GeometryLayout.XYM:GeometryLayout.XYZM,t=new LineString(a,t),t=new Feature(transformGeometryWithOptions(t,!1,e));return t.setProperties(n,!0),t},t.prototype.readFeaturesFromText=function(t,e){t=this.readFeatureFromText(t,e);return t?[t]:[]},t}(TextFeature);export default IGC;