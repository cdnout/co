var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import{extend}from"../array.js";import{closestSquaredDistanceXY,getCenter}from"../extent.js";import GeometryLayout from"./GeometryLayout.js";import GeometryType from"./GeometryType.js";import LinearRing from"./LinearRing.js";import Point from"./Point.js";import SimpleGeometry from"./SimpleGeometry.js";import{offset as sphereOffset}from"../sphere.js";import{linearRings as linearRingsArea}from"./flat/area.js";import{assignClosestArrayPoint,arrayMaxSquaredDelta}from"./flat/closest.js";import{linearRingsContainsXY}from"./flat/contains.js";import{deflateCoordinatesArray}from"./flat/deflate.js";import{inflateCoordinatesArray}from"./flat/inflate.js";import{getInteriorPointOfArray}from"./flat/interiorpoint.js";import{intersectsLinearRingArray}from"./flat/intersectsextent.js";import{linearRingsAreOriented,orientLinearRings}from"./flat/orient.js";import{quantizeArray}from"./flat/simplify.js";import{modulo}from"../math.js";var Polygon=function(n){function r(t,e,i){var r=n.call(this)||this;return r.ends_=[],r.flatInteriorPointRevision_=-1,r.flatInteriorPoint_=null,r.maxDelta_=-1,r.maxDeltaRevision_=-1,r.orientedRevision_=-1,r.orientedFlatCoordinates_=null,void 0!==e&&i?(r.setFlatCoordinates(e,t),r.ends_=i):r.setCoordinates(t,e),r}return __extends(r,n),r.prototype.appendLinearRing=function(t){this.flatCoordinates?extend(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},r.prototype.closestPointXY=function(t,e,i,r){return r<closestSquaredDistanceXY(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))},r.prototype.containsXY=function(t,e){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},r.prototype.getArea=function(){return linearRingsArea(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},r.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),orientLinearRings(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,inflateCoordinatesArray(e,0,this.ends_,this.stride)},r.prototype.getEnds=function(){return this.ends_},r.prototype.getFlatInteriorPoint=function(){var t;return this.flatInteriorPointRevision_!=this.getRevision()&&(t=getCenter(this.getExtent()),this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()),this.flatInteriorPoint_},r.prototype.getInteriorPoint=function(){return new Point(this.getFlatInteriorPoint(),GeometryLayout.XYM)},r.prototype.getLinearRingCount=function(){return this.ends_.length},r.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new LinearRing(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},r.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[],n=0,o=0,s=i.length;o<s;++o){var a=i[o],l=new LinearRing(e.slice(n,a),t);r.push(l),n=a}return r},r.prototype.getOrientedFlatCoordinates=function(){var t;return this.orientedRevision_!=this.getRevision()&&(t=this.flatCoordinates,linearRingsAreOriented(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()),this.orientedFlatCoordinates_},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];return e.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new r(e,GeometryLayout.XY,i)},r.prototype.getType=function(){return GeometryType.POLYGON},r.prototype.intersectsExtent=function(t){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);e=deflateCoordinatesArray(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===e.length?0:e[e.length-1],this.changed()},r}(SimpleGeometry);export default Polygon;function circular(t,e,i,r){for(var n=i||32,o=[],s=0;s<n;++s)extend(o,sphereOffset(t,e,2*Math.PI*s/n,r));return o.push(o[0],o[1]),new Polygon(o,GeometryLayout.XY,[o.length])}function fromExtent(t){var e=t[0],i=t[1],r=t[2],t=t[3],t=[e,i,e,t,r,t,r,i,e,i];return new Polygon(t,GeometryLayout.XY,[t.length])}function fromCircle(t,e,i){for(var e=e||32,r=t.getStride(),n=t.getLayout(),o=t.getCenter(),s=r*(e+1),a=new Array(s),l=0;l<s;l+=r){a[l]=0,a[l+1]=0;for(var h=2;h<r;h++)a[l+h]=o[h]}e=[a.length],n=new Polygon(a,n,e);return makeRegular(n,o,t.getRadius(),i),n}function makeRegular(t,e,i,r){for(var n=t.getFlatCoordinates(),o=t.getStride(),s=n.length/o-1,a=r||0,l=0;l<=s;++l){var h=l*o,d=a+2*modulo(l,s)*Math.PI/s;n[h]=e[0]+i*Math.cos(d),n[1+h]=e[1]+i*Math.sin(d)}t.changed()}export{circular,fromExtent,fromCircle,makeRegular};