import{binarySearch}from"../../array.js";import{lerp}from"../../math.js";function interpolatePoint(r,n,e,t,i,l){var a=NaN,o=NaN,u=(e-n)/t;if(1==u)a=r[n],o=r[n+1];else if(2==u)a=(1-i)*r[n]+i*r[n+t],o=(1-i)*r[n+1]+i*r[n+t+1];else if(0!=u){for(var f=r[n],s=r[n+1],p=0,c=[0],h=n+t;h<e;h+=t){var g=r[h],v=r[h+1];p+=Math.sqrt((g-f)*(g-f)+(v-s)*(v-s)),c.push(p),f=g,s=v}var S,u=i*p,i=binarySearch(c,u);o=i<0?(u=(u-c[-i-2])/(c[-i-1]-c[-i-2]),a=lerp(r[S=n+(-i-2)*t],r[S+t],u),lerp(r[S+1],r[S+t+1],u)):(a=r[n+i*t],r[n+i*t+1])}return l?(l[0]=a,l[1]=o,l):[a,o]}function lineStringCoordinateAtM(r,n,e,t,i,l){if(e==n)return null;if(i<r[n+t-1])return l?((s=r.slice(n,n+t))[t-1]=i,s):null;if(r[e-1]<i)return l?((s=r.slice(e-t,e))[t-1]=i,s):null;if(i==r[n+t-1])return r.slice(n,n+t);for(var a=n/t,o=e/t;a<o;){var u=a+o>>1;i<r[(1+u)*t-1]?o=u:a=1+u}l=r[a*t-1];if(i==l)return r.slice((a-1)*t,(a-1)*t+t);for(var f=(i-l)/(r[(a+1)*t-1]-l),s=[],p=0;p<t-1;++p)s.push(lerp(r[(a-1)*t+p],r[a*t+p],f));return s.push(i),s}function lineStringsCoordinateAtM(r,n,e,t,i,l,a){if(a)return lineStringCoordinateAtM(r,n,e[e.length-1],t,i,l);var o;if(i<r[t-1])return l?((o=r.slice(0,t))[t-1]=i,o):null;if(r[r.length-1]<i)return l?((o=r.slice(r.length-t))[t-1]=i,o):null;for(var u=0,f=e.length;u<f;++u){var s=e[u];if(n!=s){if(i<r[n+t-1])return null;if(i<=r[s-1])return lineStringCoordinateAtM(r,n,s,t,i,!1);n=s}}return null}export{interpolatePoint,lineStringCoordinateAtM,lineStringsCoordinateAtM};