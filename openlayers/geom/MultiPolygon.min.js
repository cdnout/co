var __extends=this&&this.__extends||function(){var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import{extend}from"../array.js";import{closestSquaredDistanceXY}from"../extent.js";import GeometryLayout from"./GeometryLayout.js";import GeometryType from"./GeometryType.js";import MultiPoint from"./MultiPoint.js";import Polygon from"./Polygon.js";import SimpleGeometry from"./SimpleGeometry.js";import{linearRingss as linearRingssArea}from"./flat/area.js";import{linearRingss as linearRingssCenter}from"./flat/center.js";import{assignClosestMultiArrayPoint,multiArrayMaxSquaredDelta}from"./flat/closest.js";import{linearRingssContainsXY}from"./flat/contains.js";import{deflateMultiCoordinatesArray}from"./flat/deflate.js";import{inflateMultiCoordinatesArray}from"./flat/inflate.js";import{getInteriorPointsOfMultiArray}from"./flat/interiorpoint.js";import{intersectsLinearRingMultiArray}from"./flat/intersectsextent.js";import{linearRingssAreOriented,orientLinearRingsArray}from"./flat/orient.js";import{quantizeMultiArray}from"./flat/simplify.js";var MultiPolygon=function(p){function s(t,e,i){var s=p.call(this)||this;if(s.endss_=[],s.flatInteriorPointsRevision_=-1,s.flatInteriorPoints_=null,s.maxDelta_=-1,s.maxDeltaRevision_=-1,s.orientedRevision_=-1,s.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){for(var n=s.getLayout(),r=t,o=[],a=[],l=0,h=r.length;l<h;++l){for(var d=r[l],f=(0===l&&(n=d.getLayout()),o.length),u=d.getEnds(),g=0,y=u.length;g<y;++g)u[g]+=f;extend(o,d.getFlatCoordinates()),a.push(u)}e=n,t=o,i=a}return void 0!==e&&i?(s.setFlatCoordinates(e,t),s.endss_=i):s.setCoordinates(t,e),s}return __extends(s,p),s.prototype.appendPolygon=function(t){if(this.flatCoordinates){var e=this.flatCoordinates.length;extend(this.flatCoordinates,t.getFlatCoordinates());for(var i,s=0,n=(i=t.getEnds().slice()).length;s<n;++s)i[s]+=e}else this.flatCoordinates=t.getFlatCoordinates().slice(),i=t.getEnds().slice(),this.endss_.push();this.endss_.push(i),this.changed()},s.prototype.clone=function(){for(var t=this.endss_.length,e=new Array(t),i=0;i<t;++i)e[i]=this.endss_[i].slice();return new s(this.flatCoordinates.slice(),this.layout,e)},s.prototype.closestPointXY=function(t,e,i,s){return s<closestSquaredDistanceXY(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))},s.prototype.containsXY=function(t,e){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},s.prototype.getArea=function(){return linearRingssArea(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},s.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),orientLinearRingsArray(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,inflateMultiCoordinatesArray(e,0,this.endss_,this.stride)},s.prototype.getEndss=function(){return this.endss_},s.prototype.getFlatInteriorPoints=function(){var t;return this.flatInteriorPointsRevision_!=this.getRevision()&&(t=linearRingssCenter(this.flatCoordinates,0,this.endss_,this.stride),this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()),this.flatInteriorPoints_},s.prototype.getInteriorPoints=function(){return new MultiPoint(this.getFlatInteriorPoints().slice(),GeometryLayout.XYM)},s.prototype.getOrientedFlatCoordinates=function(){var t;return this.orientedRevision_!=this.getRevision()&&(t=this.flatCoordinates,linearRingssAreOriented(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()),this.orientedFlatCoordinates_},s.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];return e.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new s(e,GeometryLayout.XY,i)},s.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;e=0===t?0:(s=this.endss_[t-1])[s.length-1];var e,i=this.endss_[t].slice(),s=i[i.length-1];if(0!==e)for(var n=0,r=i.length;n<r;++n)i[n]-=e;return new Polygon(this.flatCoordinates.slice(e,s),this.layout,i)},s.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[],n=0,r=0,o=i.length;r<o;++r){var a=i[r].slice(),l=a[a.length-1];if(0!==n)for(var h=0,d=a.length;h<d;++h)a[h]-=n;var f=new Polygon(e.slice(n,l),t,a);s.push(f),n=l}return s},s.prototype.getType=function(){return GeometryType.MULTI_POLYGON},s.prototype.intersectsExtent=function(t){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},s.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);e=deflateMultiCoordinatesArray(this.flatCoordinates,0,t,this.stride,this.endss_);0===e.length?this.flatCoordinates.length=0:(t=e[e.length-1],this.flatCoordinates.length=0===t.length?0:t[t.length-1]),this.changed()},s}(SimpleGeometry);export default MultiPolygon;