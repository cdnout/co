var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();import ImageCanvas from"../../ImageCanvas.js";import ViewHint from"../../ViewHint.js";import{getHeight,getWidth,isEmpty,scaleFromCenter}from"../../extent.js";import{assign}from"../../obj.js";import CanvasImageLayerRenderer from"./ImageLayer.js";import CanvasVectorLayerRenderer from"./VectorLayer.js";import EventType from"../../events/EventType.js";import ImageState from"../../ImageState.js";import{renderDeclutterItems}from"../../render.js";var CanvasVectorImageLayerRenderer=function(a){function e(e){var t=a.call(this,e)||this;return t.vectorRenderer_=new CanvasVectorLayerRenderer(e),t.layerImageRatio_=e.getImageRatio(),t}return __extends(e,a),e.prototype.disposeInternal=function(){this.vectorRenderer_.dispose(),a.prototype.disposeInternal.call(this)},e.prototype.handleFontsChanged=function(){this.vectorRenderer_.handleFontsChanged()},e.prototype.prepareFrame=function(e){var t,r,n=e.pixelRatio,o=e.viewState.resolution,a=e.viewHints,i=this.vectorRenderer_,s=e.extent;return 1!==this.layerImageRatio_&&(s=s.slice(0),scaleFromCenter(s,this.layerImageRatio_)),a[ViewHint.ANIMATING]||a[ViewHint.INTERACTING]||isEmpty(s)||(i.useContainer(null,null,1),a=i.context,t=assign({},e,{declutterItems:[],size:[getWidth(s)/o,getHeight(s)/o],viewState:assign({},e.viewState,{rotation:0})}),(r=new ImageCanvas(s,o,n,a.canvas,function(e){i.prepareFrame(t)&&i.replayGroupChanged&&(i.renderFrame(t,null),renderDeclutterItems(t,null),e())})).addEventListener(EventType.CHANGE,function(){r.getState()===ImageState.LOADED&&(this.image_=r)}.bind(this)),r.load()),this.image_&&(s=(e=this.image_).getResolution(),o=e.getPixelRatio(),this.renderedResolution=s*n/o),!!this.image_},e.prototype.preRender=function(){},e.prototype.postRender=function(){},e.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,o){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,r,n,o):a.prototype.forEachFeatureAtCoordinate.call(this,e,t,r,n,o)},e}(CanvasImageLayerRenderer);export default CanvasVectorImageLayerRenderer;