var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();import{CLASS_UNSELECTABLE}from"../css.js";import{inView}from"../layer/Layer.js";import RenderEvent from"../render/Event.js";import RenderEventType from"../render/EventType.js";import MapRenderer from"./Map.js";import SourceState from"../source/State.js";import{replaceChildren}from"../dom.js";import{labelCache}from"../render/canvas.js";import EventType from"../events/EventType.js";import{listen,unlistenByKey}from"../events.js";var CompositeMapRenderer=function(d){function e(e){var t=d.call(this,e)||this,r=(t.labelCacheKey_=listen(labelCache,EventType.CLEAR,e.redrawText.bind(e)),t.element_=document.createElement("div"),t.element_.style),r=(r.position="absolute",r.width="100%",r.height="100%",r.zIndex="0",t.element_.className=CLASS_UNSELECTABLE+" ol-layers",e.getViewport());return r.insertBefore(t.element_,r.firstChild||null),t.children_=[],t.renderedVisible_=!0,t}return __extends(e,d),e.prototype.dispatchRenderEvent=function(e,t){var r=this.getMap();r.hasListener(e)&&(e=new RenderEvent(e,void 0,t),r.dispatchEvent(e))},e.prototype.disposeInternal=function(){unlistenByKey(this.labelCacheKey_),d.prototype.disposeInternal.call(this)},e.prototype.renderFrame=function(e){if(e){this.calculateMatrices2D(e),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,e);for(var t=e.layerStatesArray.sort(function(e,t){return e.zIndex-t.zIndex}),r=e.viewState,n=!1,i=null,o=this.children_.length=0,s=t.length;o<s;++o){var a,l=t[o],n=n||l.hasOverlay;e.layerIndex=o,!inView(l,r)||l.sourceState!=SourceState.READY&&l.sourceState!=SourceState.UNDEFINED||(l=l.layer.render(e,i))&&(a=l.childElementCount,l===i&&o!=s-1||2!==a||n||l.removeChild(l.lastElementChild),l!==i&&(this.children_.push(l),n=2===a,i=l))}d.prototype.renderFrame.call(this,e),replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},e.prototype.forEachLayerAtPixel=function(e,t,r,n,i){for(var o=t.viewState,s=t.layerStatesArray,a=s.length-1;0<=a;--a){var l=s[a],d=l.layer;if(d.hasRenderer()&&inView(l,o)&&i(d)){l=d.getRenderer().getDataAtPixel(e,t,r);if(l){d=n(d,l);if(d)return d}}}},e}(MapRenderer);export default CompositeMapRenderer;