var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();import{getUid}from"../util.js";import Collection from"../Collection.js";import CollectionEventType from"../CollectionEventType.js";import{getChangeEventType}from"../Object.js";import ObjectEventType from"../ObjectEventType.js";import{assert}from"../asserts.js";import{listen,unlistenByKey}from"../events.js";import EventType from"../events/EventType.js";import{getIntersection}from"../extent.js";import BaseLayer from"./Base.js";import{assign,clear}from"../obj.js";import SourceState from"../source/State.js";var Property={LAYERS:"layers"},LayerGroup=function(r){function e(e){var t=this,e=e||{},n=assign({},e),e=(delete n.layers,e.layers);return(t=r.call(this,n)||this).layersListenerKeys_=[],t.listenerKeys_={},t.addEventListener(getChangeEventType(Property.LAYERS),t.handleLayersChanged_),e?Array.isArray(e)?e=new Collection(e.slice(),{unique:!0}):assert("function"==typeof e.getArray,43):e=new Collection(void 0,{unique:!0}),t.setLayers(e),t}return __extends(e,r),e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;var e,t=this.getLayers();for(e in this.layersListenerKeys_.push(listen(t,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(t,CollectionEventType.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[e].forEach(unlistenByKey);clear(this.listenerKeys_);for(var n=t.getArray(),r=0,o=n.length;r<o;r++){var s=n[r];this.listenerKeys_[getUid(s)]=[listen(s,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(s,EventType.CHANGE,this.handleLayerChange_,this)]}this.changed()},e.prototype.handleLayersAdd_=function(e){e=e.element;this.listenerKeys_[getUid(e)]=[listen(e,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(e,EventType.CHANGE,this.handleLayerChange_,this)],this.changed()},e.prototype.handleLayersRemove_=function(e){e=e.element,e=getUid(e);this.listenerKeys_[e].forEach(unlistenByKey),delete this.listenerKeys_[e],this.changed()},e.prototype.getLayers=function(){return this.get(Property.LAYERS)},e.prototype.setLayers=function(e){this.set(Property.LAYERS,e)},e.prototype.getLayersArray=function(e){var t=void 0!==e?e:[];return this.getLayers().forEach(function(e){e.getLayersArray(t)}),t},e.prototype.getLayerStatesArray=function(e){for(var t=void 0!==e?e:[],e=t.length,n=(this.getLayers().forEach(function(e){e.getLayerStatesArray(t)}),this.getLayerState()),r=e,o=t.length;r<o;r++){var s=t[r];s.opacity*=n.opacity,s.visible=s.visible&&n.visible,s.maxResolution=Math.min(s.maxResolution,n.maxResolution),s.minResolution=Math.max(s.minResolution,n.minResolution),s.minZoom=Math.max(s.minZoom,n.minZoom),s.maxZoom=Math.min(s.maxZoom,n.maxZoom),void 0!==n.extent&&(void 0!==s.extent?s.extent=getIntersection(s.extent,n.extent):s.extent=n.extent)}return t},e.prototype.getSourceState=function(){return SourceState.READY},e}(BaseLayer);export default LayerGroup;