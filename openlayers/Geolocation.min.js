var __extends=this&&this.__extends||function(){var r=function(t,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(t,o)};return function(t,o){function e(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}();import BaseObject,{getChangeEventType}from"./Object.js";import BaseEvent from"./events/Event.js";import EventType from"./events/EventType.js";import{circular as circularPolygon}from"./geom/Polygon.js";import{toRadians}from"./math.js";import{get as getProjection,getTransformFromProjections,identityTransform}from"./proj.js";var Property={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},GeolocationError=function(e){function t(t){var o=e.call(this,EventType.ERROR)||this;return o.code=t.code,o.message=t.message,o}return __extends(t,e),t}(BaseEvent),Geolocation=function(e){function t(t){var o=e.call(this)||this,t=t||{};return o.position_=null,o.transform_=identityTransform,o.watchId_=void 0,o.addEventListener(getChangeEventType(Property.PROJECTION),o.handleProjectionChanged_),o.addEventListener(getChangeEventType(Property.TRACKING),o.handleTrackingChanged_),void 0!==t.projection&&o.setProjection(t.projection),void 0!==t.trackingOptions&&o.setTrackingOptions(t.trackingOptions),o.setTracking(void 0!==t.tracking&&t.tracking),o}return __extends(t,e),t.prototype.disposeInternal=function(){this.setTracking(!1),e.prototype.disposeInternal.call(this)},t.prototype.handleProjectionChanged_=function(){var t=this.getProjection();t&&(this.transform_=getTransformFromProjections(getProjection("EPSG:4326"),t),this.position_&&this.set(Property.POSITION,this.transform_(this.position_)))},t.prototype.handleTrackingChanged_=function(){var t;"geolocation"in navigator&&((t=this.getTracking())&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):t||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0))},t.prototype.positionChange_=function(t){var t=t.coords,o=(this.set(Property.ACCURACY,t.accuracy),this.set(Property.ALTITUDE,null===t.altitude?void 0:t.altitude),this.set(Property.ALTITUDE_ACCURACY,null===t.altitudeAccuracy?void 0:t.altitudeAccuracy),this.set(Property.HEADING,null===t.heading?void 0:toRadians(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude],this.transform_(this.position_)),o=(this.set(Property.POSITION,o),this.set(Property.SPEED,null===t.speed?void 0:t.speed),circularPolygon(this.position_,t.accuracy));o.applyTransform(this.transform_),this.set(Property.ACCURACY_GEOMETRY,o),this.changed()},t.prototype.positionError_=function(t){this.setTracking(!1),this.dispatchEvent(new GeolocationError(t))},t.prototype.getAccuracy=function(){return this.get(Property.ACCURACY)},t.prototype.getAccuracyGeometry=function(){return this.get(Property.ACCURACY_GEOMETRY)||null},t.prototype.getAltitude=function(){return this.get(Property.ALTITUDE)},t.prototype.getAltitudeAccuracy=function(){return this.get(Property.ALTITUDE_ACCURACY)},t.prototype.getHeading=function(){return this.get(Property.HEADING)},t.prototype.getPosition=function(){return this.get(Property.POSITION)},t.prototype.getProjection=function(){return this.get(Property.PROJECTION)},t.prototype.getSpeed=function(){return this.get(Property.SPEED)},t.prototype.getTracking=function(){return this.get(Property.TRACKING)},t.prototype.getTrackingOptions=function(){return this.get(Property.TRACKING_OPTIONS)},t.prototype.setProjection=function(t){this.set(Property.PROJECTION,getProjection(t))},t.prototype.setTracking=function(t){this.set(Property.TRACKING,t)},t.prototype.setTrackingOptions=function(t){this.set(Property.TRACKING_OPTIONS,t)},t}(BaseObject);export default Geolocation;