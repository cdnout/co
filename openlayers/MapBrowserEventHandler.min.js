var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();import"@openlayers/pepjs";import{DEVICE_PIXEL_RATIO}from"./has.js";import MapBrowserEventType from"./MapBrowserEventType.js";import MapBrowserPointerEvent from"./MapBrowserPointerEvent.js";import{listen,unlistenByKey}from"./events.js";import EventTarget from"./events/Target.js";import PointerEventType from"./pointer/EventType.js";var MapBrowserEventHandler=function(i){function e(e,t){var n=i.call(this)||this,e=(n.map_=e,n.clickTimeoutId_,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=t?t*DEVICE_PIXEL_RATIO:DEVICE_PIXEL_RATIO,n.down_=null,n.map_.getViewport());return e.setAttribute("touch-action","none"),n.activePointers_=0,n.trackedTouches_={},n.element_=e,n.pointerdownListenerKey_=listen(e,PointerEventType.POINTERDOWN,n.handlePointerDown_,n),n.relayedListenerKey_=listen(e,PointerEventType.POINTERMOVE,n.relayEvent_,n),n}return __extends(e,i),e.prototype.emulateClick_=function(t){var e=new MapBrowserPointerEvent(MapBrowserEventType.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new MapBrowserPointerEvent(MapBrowserEventType.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var e=new MapBrowserPointerEvent(MapBrowserEventType.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}.bind(this),250)},e.prototype.updateActivePointers_=function(e){e.type==MapBrowserEventType.POINTERUP||e.type==MapBrowserEventType.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==MapBrowserEventType.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var t=new MapBrowserPointerEvent(MapBrowserEventType.POINTERUP,this.map_,e);this.dispatchEvent(t),t.propagationStopped||this.dragging_||!this.isMouseActionButton_(e)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},e.prototype.isMouseActionButton_=function(e){return 0===e.button},e.prototype.handlePointerDown_=function(e){this.updateActivePointers_(e);var t=new MapBrowserPointerEvent(MapBrowserEventType.POINTERDOWN,this.map_,e);this.dispatchEvent(t),this.down_=e,0===this.dragListenerKeys_.length&&this.dragListenerKeys_.push(listen(document,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(document,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this))},e.prototype.handlePointerMove_=function(e){this.isMoving_(e)&&(this.dragging_=!0,e=new MapBrowserPointerEvent(MapBrowserEventType.POINTERDRAG,this.map_,e,this.dragging_),this.dispatchEvent(e))},e.prototype.relayEvent_=function(e){var t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new MapBrowserPointerEvent(e.type,this.map_,e,t))},e.prototype.isMoving_=function(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,i.prototype.disposeInternal.call(this)},e}(EventTarget);export default MapBrowserEventHandler;