var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();import TileState from"./TileState.js";import EventType from"./events/EventType.js";import PriorityQueue from"./structs/PriorityQueue.js";var TileQueue=function(n){function e(t,e){var i=n.call(this,function(e){return t.apply(null,e)},function(e){return e[0].getKey()})||this;return i.boundHandleTileChange_=i.handleTileChange.bind(i),i.tileChangeCallback_=e,i.tilesLoading_=0,i.tilesLoadingKeys_={},i}return __extends(e,n),e.prototype.enqueue=function(e){var t=n.prototype.enqueue.call(this,e);return t&&e[0].addEventListener(EventType.CHANGE,this.boundHandleTileChange_),t},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(e){var e=e.target,t=e.getState();(e.hifi&&t===TileState.LOADED||t===TileState.ERROR||t===TileState.EMPTY||t===TileState.ABORT)&&(e.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_),(t=e.getKey())in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_())},e.prototype.loadMoreTiles=function(e,t){for(var i,n,o,r=0,a=!1;this.tilesLoading_<e&&r<t&&0<this.getCount();)o=(n=this.dequeue()[0]).getKey(),(i=n.getState())===TileState.ABORT?a=!0:i!==TileState.IDLE||o in this.tilesLoadingKeys_||(n.load(),n.getState()===TileState.LOADING&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++r));0===r&&a&&this.tileChangeCallback_()},e}(PriorityQueue);export default TileQueue;