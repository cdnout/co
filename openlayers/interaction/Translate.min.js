var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();import Collection from"../Collection.js";import{getChangeEventType}from"../Object.js";import Event from"../events/Event.js";import{TRUE}from"../functions.js";import{includes}from"../array.js";import PointerInteraction from"./Pointer.js";import InteractionProperty from"./Property.js";var TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"},TranslateEvent=function(r){function t(t,e,n){t=r.call(this,t)||this;return t.features=e,t.coordinate=n,t}return __extends(t,r),t}(Event),Translate=function(a){function t(t){var e,n,r=this,t=t||{};return(r=a.call(this,t)||this).lastCoordinate_=null,r.features_=void 0!==t.features?t.features:null,n=t.layers?"function"==typeof t.layers?t.layers:(e=t.layers,function(t){return includes(e,t)}):TRUE,r.layerFilter_=n,r.filter_=t.filter||TRUE,r.hitTolerance_=t.hitTolerance||0,r.lastFeature_=null,r.addEventListener(getChangeEventType(InteractionProperty.ACTIVE),r.handleActiveChanged_),r}return __extends(t,a),t.prototype.handleDownEvent=function(t){var e;return this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!(this.lastCoordinate_||!this.lastFeature_)&&(this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t),e=this.features_||new Collection([this.lastFeature_]),this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATESTART,e,t.coordinate)),!0)},t.prototype.handleUpEvent=function(t){var e;return!!this.lastCoordinate_&&(this.lastCoordinate_=null,this.handleMoveEvent(t),e=this.features_||new Collection([this.lastFeature_]),this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATEEND,e,t.coordinate)),!0)},t.prototype.handleDragEvent=function(t){var n,r,e;this.lastCoordinate_&&(t=t.coordinate,n=t[0]-this.lastCoordinate_[0],r=t[1]-this.lastCoordinate_[1],(e=this.features_||new Collection([this.lastFeature_])).forEach(function(t){var e=t.getGeometry();e.translate(n,r),t.setGeometry(e)}),this.lastCoordinate_=t,this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATING,e,t)))},t.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")},t.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t,e){if(this.filter_(t,e)&&(!this.features_||includes(this.features_.getArray(),t)))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.setHitTolerance=function(t){this.hitTolerance_=t},t.prototype.setMap=function(t){var e=this.getMap();a.prototype.setMap.call(this,t),this.updateState_(e)},t.prototype.handleActiveChanged_=function(){this.updateState_(null)},t.prototype.updateState_=function(t){var e=this.getMap(),n=this.getActive();e&&n||(e=e||t)&&e.getViewport().classList.remove("ol-grab","ol-grabbing")},t}(PointerInteraction);export default Translate;export{TranslateEvent};