var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();import{FALSE}from"../functions.js";import PointerInteraction,{centroid as centroidFromPointers}from"./Pointer.js";import{disable}from"../rotationconstraint.js";var PinchRotate=function(e){function t(t){var n=this,t=t||{},o=t;return o.stopDown||(o.stopDown=FALSE),(n=e.call(this,o)||this).anchor_=null,n.lastAngle_=void 0,n.rotating_=!1,n.rotationDelta_=0,n.threshold_=void 0!==t.threshold?t.threshold:.3,n.duration_=void 0!==t.duration?t.duration:250,n}return __extends(t,e),t.prototype.handleDragEvent=function(t){var n,o=0,e=this.targetPointers[0],i=this.targetPointers[1],i=Math.atan2(i.clientY-e.clientY,i.clientX-e.clientX),e=(void 0!==this.lastAngle_&&(e=i-this.lastAngle_,this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),o=e),this.lastAngle_=i,t.map),i=e.getView();i.getConstraints().rotation!==disable&&(t=e.getViewport().getBoundingClientRect(),(n=centroidFromPointers(this.targetPointers))[0]-=t.left,n[1]-=t.top,this.anchor_=e.getCoordinateFromPixel(n),this.rotating_&&(e.render(),i.adjustRotationInternal(o,this.anchor_)))},t.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)},t.prototype.handleDownEvent=function(t){return 2<=this.targetPointers.length&&(t=t.map,this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0)},t}(PointerInteraction);export default PinchRotate;