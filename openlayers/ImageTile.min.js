var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import Tile from"./Tile.js";import TileState from"./TileState.js";import{createCanvasContext2D}from"./dom.js";import{listenImage}from"./Image.js";var ImageTile=function(r){function t(t,e,i,n,s,a){t=r.call(this,t,e,a)||this;return t.crossOrigin_=n,t.src_=i,t.image_=new Image,null!==n&&(t.image_.crossOrigin=n),t.unlisten_=null,t.tileLoadFunction_=s,t}return __extends(t,r),t.prototype.disposeInternal=function(){this.state==TileState.LOADING&&(this.unlistenImage_(),this.image_=getBlankImage()),this.interimTile&&this.interimTile.dispose(),this.state=TileState.ABORT,this.changed(),r.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.image_},t.prototype.getKey=function(){return this.src_},t.prototype.handleImageError_=function(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()},t.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(Tile);function getBlankImage(){var t=createCanvasContext2D(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}export default ImageTile;