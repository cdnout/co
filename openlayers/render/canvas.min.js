import{getFontParameters}from"../css.js";import{createCanvasContext2D}from"../dom.js";import{clear}from"../obj.js";import{create as createTransform}from"../transform.js";import LabelCache from"./canvas/LabelCache.js";var measureFont,defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,labelCache=new LabelCache,checkedFonts={},measureContext=null,textHeights={},checkFont=function(){var i,s,u=checkedFonts,f="32px ",d=["monospace","serif"],m=d.length,h="wmytzilWMYTZIL@#/&?$%10ï€“";function c(e,t,a){for(var r=getMeasureContext(),n=!0,o=0;o<m;++o){var l=d[o];r.font=e+" "+t+" "+f+l,s=r.measureText(h).width,a!=l&&(r.font=e+" "+t+" "+f+a+","+l,l=r.measureText(h).width,n=n&&l!=s)}return!!n}function x(){var e,t=!0;for(e in u)u[e]<100&&(c.apply(this,e.split("\n"))?(u[e]=100,clear(textHeights),measureContext=null,measureFont=void 0,labelCache.getCount()&&labelCache.clear()):(++u[e],t=!1));t&&(clearInterval(i),i=void 0)}return function(e){var t=getFontParameters(e);if(t)for(var a=t.families,r=0,n=a.length;r<n;++r){var o=a[r],l=t.style+"\n"+t.weight+"\n"+o;l in u||(u[l]=100,c(t.style,t.weight,o)||void(u[l]=0)===i&&(i=setInterval(x,32)))}}}();function getMeasureContext(){return measureContext=measureContext||createCanvasContext2D(1,1)}var measureTextHeight=function(){var a,r=textHeights;return function(e){var t=r[e];return null==t&&(a||((a=document.createElement("div")).innerHTML="M",a.style.margin=a.style.padding="0 !important",a.style.position="absolute !important",a.style.left="-99999px !important"),a.style.font=e,document.body.appendChild(a),t=r[e]=a.offsetHeight,document.body.removeChild(a)),t}}();function measureTextWidth(e,t){var a=getMeasureContext();return e!=measureFont&&(a.font=measureFont=e),a.measureText(t).width}function measureAndCacheTextWidth(e,t,a){return t in a?a[t]:a[t]=measureTextWidth(e,t)}function measureTextWidths(e,t,a){for(var r=t.length,n=0,o=0;o<r;++o){var l=measureTextWidth(e,t[o]),n=Math.max(n,l);a.push(l)}return n}function rotateAtOffset(e,t,a,r){0!==t&&(e.translate(a,r),e.rotate(t),e.translate(-a,-r))}var resetTransform=createTransform();function drawImage(e,t,a,r,n,o,l,i,s,u,f){var d;1!=a&&(d=e.globalAlpha,e.globalAlpha=d*a),t&&e.setTransform.apply(e,t),e.drawImage(r,n,o,l,i,s,u,l*f,i*f),1!=a&&(e.globalAlpha=d),t&&e.setTransform.apply(e,resetTransform)}export{defaultFont,defaultFillStyle,defaultLineCap,defaultLineDash,defaultLineDashOffset,defaultLineJoin,defaultMiterLimit,defaultStrokeStyle,defaultTextAlign,defaultTextBaseline,defaultPadding,defaultLineWidth,labelCache,checkedFonts,textHeights,checkFont,measureTextHeight,measureTextWidth,measureAndCacheTextWidth,measureTextWidths,rotateAtOffset,resetTransform,drawImage};