var __extends=this&&this.__extends||function(){var n=function(t,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])})(t,i)};return function(t,i){function s(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();import{snap}from"../../geom/flat/simplify.js";import{defaultFillStyle}from"../canvas.js";import CanvasInstruction,{fillInstruction,strokeInstruction,beginPathInstruction,closePathInstruction}from"./Instruction.js";import CanvasBuilder from"./Builder.js";var CanvasPolygonBuilder=function(e){function t(t,i,s,n){return e.call(this,t,i,s,n)||this}return __extends(t,e),t.prototype.drawFlatCoordinatess_=function(t,i,s,n){var e=this.state,o=void 0!==e.fillStyle,r=null!=e.strokeStyle,l=s.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(var h=0;h<l;++h){var a=s[h],u=this.coordinates.length,c=this.appendFlatCoordinates(t,i,a,n,!0,!r),u=[CanvasInstruction.MOVE_TO_LINE_TO,u,c];this.instructions.push(u),this.hitDetectionInstructions.push(u),r&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),i=a}return o&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),r&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),i},t.prototype.drawCircle=function(t,i){var s=this.state,n=s.fillStyle,e=s.strokeStyle;void 0===n&&void 0===e||(this.setFillStrokeStyles_(),this.beginGeometry(i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,s.lineDash,s.lineDashOffset]),n=t.getFlatCoordinates(),e=t.getStride(),t=this.coordinates.length,this.appendFlatCoordinates(n,0,n.length,e,!1,!1),n=[CanvasInstruction.CIRCLE,t],this.instructions.push(beginPathInstruction,n),this.hitDetectionInstructions.push(beginPathInstruction,n),this.hitDetectionInstructions.push(fillInstruction),void 0!==s.fillStyle&&this.instructions.push(fillInstruction),void 0!==s.strokeStyle&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(i))},t.prototype.drawPolygon=function(t,i){var s=this.state,n=s.fillStyle,e=s.strokeStyle;void 0===n&&void 0===e||(this.setFillStrokeStyles_(),this.beginGeometry(i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,s.lineDash,s.lineDashOffset]),n=t.getEnds(),e=t.getOrientedFlatCoordinates(),s=t.getStride(),this.drawFlatCoordinatess_(e,0,n,s),this.endGeometry(i))},t.prototype.drawMultiPolygon=function(t,i){var s=this.state,n=s.fillStyle,e=s.strokeStyle;if(void 0!==n||void 0!==e){this.setFillStrokeStyles_(),this.beginGeometry(i),void 0!==s.fillStyle&&this.hitDetectionInstructions.push([CanvasInstruction.SET_FILL_STYLE,defaultFillStyle]),void 0!==s.strokeStyle&&this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,s.lineDash,s.lineDashOffset]);for(var o=t.getEndss(),r=t.getOrientedFlatCoordinates(),l=t.getStride(),h=0,a=0,u=o.length;a<u;++a)h=this.drawFlatCoordinatess_(r,h,o[a],l);this.endGeometry(i)}},t.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(0!==t)for(var i=this.coordinates,s=0,n=i.length;s<n;++s)i[s]=snap(i[s],t);return e.prototype.finish.call(this)},t.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},t}(CanvasBuilder);export default CanvasPolygonBuilder;