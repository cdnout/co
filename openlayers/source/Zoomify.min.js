var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}();import{DEFAULT_TILE_SIZE}from"../tilegrid/common.js";import ImageTile from"../ImageTile.js";import TileState from"../TileState.js";import{expandUrl,createFromTileUrlFunctions}from"../tileurlfunction.js";import{assert}from"../asserts.js";import{createCanvasContext2D}from"../dom.js";import{getTopLeft}from"../extent.js";import{toSize}from"../size.js";import TileImage from"./TileImage.js";import TileGrid from"../tilegrid/TileGrid.js";var TierSizeCalculation={DEFAULT:"default",TRUNCATED:"truncated"},CustomTile=function(s){function e(t,e,i,r,o,n,a,l){r=s.call(this,i,r,o,n,a,l)||this;return r.zoomifyImage_=null,r.tileSize_=toSize(e.getTileSize(i[0])).map(function(e){return e*t}),r}return __extends(e,s),e.prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;var e,t=s.prototype.getImage.call(this);return this.state==TileState.LOADED?(e=this.tileSize_,t.width==e[0]&&t.height==e[1]?this.zoomifyImage_=t:((e=createCanvasContext2D(e[0],e[1])).drawImage(t,0,0),this.zoomifyImage_=e.canvas,e.canvas)):t},e}(ImageTile),Zoomify=function(d){function e(e){var t=this,e=e||{},i=e.size,r=void 0!==e.tierSizeCalculation?e.tierSizeCalculation:TierSizeCalculation.DEFAULT,o=i[0],n=i[1],i=e.extent||[0,-i[1],i[0],0],c=[],a=e.tileSize||DEFAULT_TILE_SIZE,l=e.tilePixelRatio||1,s=a;switch(r){case TierSizeCalculation.DEFAULT:for(;s<o||s<n;)c.push([Math.ceil(o/s),Math.ceil(n/s)]),s+=s;break;case TierSizeCalculation.TRUNCATED:for(var u=o,m=n;s<u||s<m;)c.push([Math.ceil(u/s),Math.ceil(m/s)]),u>>=1,m>>=1;break;default:assert(!1,53)}c.push([1,1]),c.reverse();for(var f=[1],p=[0],T=1,h=c.length;T<h;T++)f.push(1<<T),p.push(c[T-1][0]*c[T-1][1]+p[T-1]);f.reverse();var g=new TileGrid({tileSize:a,extent:i,origin:getTopLeft(i),resolutions:f}),r=e.url,a=(r&&-1==r.indexOf("{TileGroup}")&&-1==r.indexOf("{tileIndex}")&&(r+="{TileGroup}/{z}-{x}-{y}.jpg"),expandUrl(r));i=createFromTileUrlFunctions(a.map(function(s){return function(e,t,i){var r,o,n,a,l;if(e)return r=e[0],n=(o=e[1])+(e=e[2])*c[r][0],a=g.getTileSize(r),a=Array.isArray(a)?a[0]:a,l={z:r,x:o,y:e,tileIndex:n,TileGroup:"TileGroup"+((n+p[r])/a|0)},s.replace(/\{(\w+?)\}/g,function(e,t){return l[t]})}})),r=CustomTile.bind(null,l,g);return(t=d.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,tilePixelRatio:l,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:r,tileGrid:g,tileUrlFunction:i,transition:e.transition})||this).zDirection=e.zDirection,t}return __extends(e,d),e}(TileImage);export default Zoomify;export{CustomTile};