var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import{getUid}from"../util.js";import TileState from"../TileState.js";import{expandUrl,createFromTemplates,nullTileUrlFunction}from"../tileurlfunction.js";import TileSource,{TileSourceEvent}from"./Tile.js";import TileEventType from"./TileEventType.js";import{getKeyZXY}from"../tilecoord.js";var UrlTile=function(i){function t(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.generateTileUrlFunction_=!t.tileUrlFunction,e.tileLoadFunction=t.tileLoadFunction,e.tileUrlFunction=t.tileUrlFunction?t.tileUrlFunction.bind(e):nullTileUrlFunction,e.urls=null,t.urls?e.setUrls(t.urls):t.url&&e.setUrl(t.url),e.tileLoadingKeys_={},e}return __extends(t,i),t.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},t.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},t.prototype.getUrls=function(){return this.urls},t.prototype.handleTileChange=function(t){var e,t=t.target,i=getUid(t),n=t.getState();n==TileState.LOADING?(this.tileLoadingKeys_[i]=!0,e=TileEventType.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],e=n==TileState.ERROR?TileEventType.TILELOADERROR:n==TileState.LOADED||n==TileState.ABORT?TileEventType.TILELOADEND:void 0),null!=e&&this.dispatchEvent(new TileSourceEvent(e,t))},t.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},t.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},t.prototype.setUrl=function(t){t=this.urls=expandUrl(t);this.setUrls(t)},t.prototype.setUrls=function(t){var e=(this.urls=t).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(t,this.tileGrid),e):this.setKey(e)},t.prototype.useTile=function(t,e,i){t=getKeyZXY(t,e,i);this.tileCache.containsKey(t)&&this.tileCache.get(t)},t}(TileSource);export default UrlTile;