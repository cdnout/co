var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import{abstract}from"../util.js";import TileCache from"../TileCache.js";import TileState from"../TileState.js";import Event from"../events/Event.js";import{equivalent}from"../proj.js";import{toSize,scale as scaleSize}from"../size.js";import Source from"./Source.js";import{getKeyZXY,withinExtentAndZ}from"../tilecoord.js";import{wrapX,getForProjection as getTileGridForProjection}from"../tilegrid.js";var TileSource=function(c){function t(t){var e,i,o,r=c.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX})||this,n=(r.opaque_=void 0!==t.opaque&&t.opaque,r.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,r.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,t.cacheSize);return void 0===n&&(e=[256,256],(o=t.tileGrid)&&toSize(o.getTileSize(o.getMinZoom()),e),i=(o="undefined"!=typeof screen)?screen.availWidth||screen.width:1920,o=o?screen.availHeight||screen.height:1080,n=4*Math.ceil(i/e[0])*Math.ceil(o/e[1])),r.tileCache=new TileCache(n),r.tmpSize=[0,0],r.key_=t.key||"",r.tileOptions={transition:t.transition},r.zDirection=t.zDirection||0,r}return __extends(t,c),t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(t,e){t=this.getTileCacheForProjection(t);t&&t.expireCache(e)},t.prototype.forEachLoadedTile=function(t,e,i,o){var r=this.getTileCacheForProjection(t);if(!r)return!1;for(var n,c,l=!0,a=i.minX;a<=i.maxX;++a)for(var p=i.minY;p<=i.maxY;++p)n=getKeyZXY(e,a,p),c=!1,(c=r.containsKey(n)?(c=(n=r.get(n)).getState()===TileState.LOADED)&&!1!==o(n):c)||(l=!1);return l},t.prototype.getGutterForProjection=function(t){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},t.prototype.getOpaque=function(t){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},t.prototype.getTile=function(t,e,i,o,r){return abstract()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(t){return this.tileGrid||getTileGridForProjection(t)},t.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!equivalent(e,t)?null:this.tileCache},t.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(t,e,i){i=this.getTileGridForProjection(i),e=this.getTilePixelRatio(e),i=toSize(i.getTileSize(t),this.tmpSize);return 1==e?i:scaleSize(i,e,this.tmpSize)},t.prototype.getTileCoordForTileUrlFunction=function(t,e){var e=void 0!==e?e:this.getProjection(),i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=wrapX(i,t,e)),withinExtentAndZ(t,i)?t:null},t.prototype.clear=function(){this.tileCache.clear()},t.prototype.refresh=function(){this.clear(),c.prototype.refresh.call(this)},t.prototype.useTile=function(t,e,i,o){},t}(Source),TileSourceEvent=function(i){function t(t,e){t=i.call(this,t)||this;return t.tile=e,t}return __extends(t,i),t}(Event);export default TileSource;export{TileSourceEvent};