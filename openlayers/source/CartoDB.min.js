var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import{assign}from"../obj.js";import SourceState from"./State.js";import XYZ from"./XYZ.js";var CartoDB=function(i){function t(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:void 0!==t.maxZoom?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,wrapX:t.wrapX})||this;return e.account_=t.account,e.mapId_=t.map||"",e.config_=t.config||{},e.templateCache_={},e.initializeMap_(),e}return __extends(t,i),t.prototype.getConfig=function(){return this.config_},t.prototype.updateConfig=function(t){assign(this.config_,t),this.initializeMap_()},t.prototype.setConfig=function(t){this.config_=t||{},this.initializeMap_()},t.prototype.initializeMap_=function(){var t,e,i=JSON.stringify(this.config_);this.templateCache_[i]?this.applyTemplate_(this.templateCache_[i]):(t="https://"+this.account_+".carto.com/api/v1/map",this.mapId_&&(t+="/named/"+this.mapId_),(e=new XMLHttpRequest).addEventListener("load",this.handleInitResponse_.bind(this,i)),e.addEventListener("error",this.handleInitError_.bind(this)),e.open("POST",t),e.setRequestHeader("Content-type","application/json"),e.send(JSON.stringify(this.config_)))},t.prototype.handleInitResponse_=function(t,e){e=e.target;if(!e.status||200<=e.status&&e.status<300){var i=void 0;try{i=JSON.parse(e.responseText)}catch(t){return void this.setState(SourceState.ERROR)}this.applyTemplate_(i),this.templateCache_[t]=i,this.setState(SourceState.READY)}else this.setState(SourceState.ERROR)},t.prototype.handleInitError_=function(t){this.setState(SourceState.ERROR)},t.prototype.applyTemplate_=function(t){t="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)},t}(XYZ);export default CartoDB;