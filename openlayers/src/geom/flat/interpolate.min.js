import{binarySearch}from"../../array.js";import{lerp}from"../../math.js";function interpolatePoint(i,l,o,u,r,t){let a=NaN,f=NaN;var s=(o-l)/u;if(1==s)a=i[l],f=i[l+1];else if(2==s)a=(1-r)*i[l]+r*i[l+u],f=(1-r)*i[l+1]+r*i[l+u+1];else if(0!=s){let t=i[l],e=i[l+1],n=0;const g=[0];for(let r=l+u;r<o;r+=u){var c=i[r],p=i[r+1];n+=Math.sqrt((c-t)*(c-t)+(p-e)*(p-e)),g.push(n),t=c,e=p}var h,s=r*n,r=binarySearch(g,s);f=r<0?(s=(s-g[-r-2])/(g[-r-1]-g[-r-2]),h=l+(-r-2)*u,a=lerp(i[h],i[h+u],s),lerp(i[h+1],i[h+u+1],s)):(a=i[l+r*u],i[l+r*u+1])}return t?(t[0]=a,t[1]=f,t):[a,f]}function lineStringCoordinateAtM(t,r,e,n,i,l){if(e==r)return null;let o;if(i<t[r+n-1])return l?((o=t.slice(r,r+n))[n-1]=i,o):null;if(t[e-1]<i)return l?((o=t.slice(e-n,e))[n-1]=i,o):null;if(i==t[r+n-1])return t.slice(r,r+n);let u=r/n,a=e/n;for(;u<a;){var f=u+a>>1;i<t[(1+f)*n-1]?a=f:u=1+f}l=t[u*n-1];if(i==l)return t.slice((u-1)*n,(u-1)*n+n);var s=(i-l)/(t[(u+1)*n-1]-l);o=[];for(let r=0;r<n-1;++r)o.push(lerp(t[(u-1)*n+r],t[u*n+r],s));return o.push(i),o}function lineStringsCoordinateAtM(e,n,i,l,o,r,t){if(t)return lineStringCoordinateAtM(e,n,i[i.length-1],l,o,r);let u;if(o<e[l-1])return r?((u=e.slice(0,l))[l-1]=o,u):null;if(e[e.length-1]<o)return r?((u=e.slice(e.length-l))[l-1]=o,u):null;for(let r=0,t=i.length;r<t;++r){var a=i[r];if(n!=a){if(o<e[n+l-1])return null;if(o<=e[a-1])return lineStringCoordinateAtM(e,n,a,l,o,!1);n=a}}return null}export{interpolatePoint,lineStringCoordinateAtM,lineStringsCoordinateAtM};