import{getUid}from"../util.js";import ImageState from"../ImageState.js";import{assert}from"../asserts.js";import{asArray}from"../color.js";import EventType from"../events/EventType.js";import IconAnchorUnits from"./IconAnchorUnits.js";import{get as getIconImage}from"./IconImage.js";import IconOrigin from"./IconOrigin.js";import ImageStyle from"./Image.js";class Icon extends ImageStyle{constructor(i){var i=i||{},t=(super({opacity:void 0!==i.opacity?i.opacity:1,rotation:void 0!==i.rotation?i.rotation:0,scale:void 0!==i.scale?i.scale:1,rotateWithView:void 0!==i.rotateWithView&&i.rotateWithView}),this.anchor_=void 0!==i.anchor?i.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==i.anchorOrigin?i.anchorOrigin:IconOrigin.TOP_LEFT,this.anchorXUnits_=void 0!==i.anchorXUnits?i.anchorXUnits:IconAnchorUnits.FRACTION,this.anchorYUnits_=void 0!==i.anchorYUnits?i.anchorYUnits:IconAnchorUnits.FRACTION,this.crossOrigin_=void 0!==i.crossOrigin?i.crossOrigin:null,void 0!==i.img?i.img:null),n=void 0!==i.imgSize?i.imgSize:null;let o=i.src;assert(!(void 0!==o&&t),4),assert(!t||n,5),void 0!==o&&0!==o.length||!t||(o=t.src||getUid(t)),assert(void 0!==o&&0<o.length,6);var r=void 0!==i.src?ImageState.IDLE:ImageState.LOADED;this.color_=void 0!==i.color?asArray(i.color):null,this.iconImage_=getIconImage(t,o,n,this.crossOrigin_,r,this.color_),this.offset_=void 0!==i.offset?i.offset:[0,0],this.offsetOrigin_=void 0!==i.offsetOrigin?i.offsetOrigin:IconOrigin.TOP_LEFT,this.origin_=null,this.size_=void 0!==i.size?i.size:null}clone(){return new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})}getAnchor(){if(this.normalizedAnchor_)return this.normalizedAnchor_;let i=this.anchor_;var t=this.getSize();if(this.anchorXUnits_==IconAnchorUnits.FRACTION||this.anchorYUnits_==IconAnchorUnits.FRACTION){if(!t)return null;i=this.anchor_.slice(),this.anchorXUnits_==IconAnchorUnits.FRACTION&&(i[0]*=t[0]),this.anchorYUnits_==IconAnchorUnits.FRACTION&&(i[1]*=t[1])}if(this.anchorOrigin_!=IconOrigin.TOP_LEFT){if(!t)return null;i===this.anchor_&&(i=this.anchor_.slice()),this.anchorOrigin_!=IconOrigin.TOP_RIGHT&&this.anchorOrigin_!=IconOrigin.BOTTOM_RIGHT||(i[0]=-i[0]+t[0]),this.anchorOrigin_!=IconOrigin.BOTTOM_LEFT&&this.anchorOrigin_!=IconOrigin.BOTTOM_RIGHT||(i[1]=-i[1]+t[1])}return this.normalizedAnchor_=i,this.normalizedAnchor_}setAnchor(i){this.anchor_=i,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(i){return this.iconImage_.getImage(i)}getImageSize(){return this.iconImage_.getSize()}getHitDetectionImageSize(){return this.getImageSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(i){return this.iconImage_.getHitDetectionImage(i)}getOrigin(){if(this.origin_)return this.origin_;let i=this.offset_;if(this.offsetOrigin_!=IconOrigin.TOP_LEFT){var t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;i=i.slice(),this.offsetOrigin_!=IconOrigin.TOP_RIGHT&&this.offsetOrigin_!=IconOrigin.BOTTOM_RIGHT||(i[0]=n[0]-t[0]-i[0]),this.offsetOrigin_!=IconOrigin.BOTTOM_LEFT&&this.offsetOrigin_!=IconOrigin.BOTTOM_RIGHT||(i[1]=n[1]-t[1]-i[1])}return this.origin_=i,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_||this.iconImage_.getSize()}listenImageChange(i){this.iconImage_.addEventListener(EventType.CHANGE,i)}load(){this.iconImage_.load()}unlistenImageChange(i){this.iconImage_.removeEventListener(EventType.CHANGE,i)}}export default Icon;