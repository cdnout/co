import{getUid}from"../util.js";import TileState from"../TileState.js";import{expandUrl,createFromTemplates,nullTileUrlFunction}from"../tileurlfunction.js";import TileSource,{TileSourceEvent}from"./Tile.js";import TileEventType from"./TileEventType.js";import{getKeyZXY}from"../tilecoord.js";class UrlTile extends TileSource{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=!t.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,this.tileUrlFunction=t.tileUrlFunction?t.tileUrlFunction.bind(this):nullTileUrlFunction,this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target;var t=getUid(e),i=e.getState();let l;i==TileState.LOADING?(this.tileLoadingKeys_[t]=!0,l=TileEventType.TILELOADSTART):t in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[t],l=i==TileState.ERROR?TileEventType.TILELOADERROR:i==TileState.LOADED||i==TileState.ABORT?TileEventType.TILELOADEND:void 0),null!=l&&this.dispatchEvent(new TileSourceEvent(l,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){t=this.urls=expandUrl(t);this.setUrls(t)}setUrls(t){var e=(this.urls=t).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(t,this.tileGrid),e):this.setKey(e)}useTile(t,e,i){t=getKeyZXY(t,e,i);this.tileCache.containsKey(t)&&this.tileCache.get(t)}}export default UrlTile;