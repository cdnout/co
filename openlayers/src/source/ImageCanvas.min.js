import ImageCanvas from"../ImageCanvas.js";import{containsExtent,getHeight,getWidth,scaleFromCenter}from"../extent.js";import ImageSource from"./Image.js";class ImageCanvasSource extends ImageSource{constructor(t){t=t||{};super({attributions:t.attributions,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=void 0!==t.ratio?t.ratio:1.5}getImageInternal(t,e,i,s){e=this.findNearestResolution(e);let n=this.canvas_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==e&&n.getPixelRatio()==i&&containsExtent(n.getExtent(),t))return n;t=t.slice(),scaleFromCenter(t,this.ratio_);var a=getWidth(t)/e,o=getHeight(t)/e,a=this.canvasFunction_.call(this,t,e,i,[a*i,o*i],s);return a&&(n=new ImageCanvas(t,e,i,a)),this.canvas_=n,this.renderedRevision_=this.getRevision(),n}}export default ImageCanvasSource;