import{listen}from"../events.js";import EventType from"../pointer/EventType.js";import{getChangeEventType}from"../Object.js";import Control from"./Control.js";import{getTransformFromProjections,identityTransform,get as getProjection}from"../proj.js";import"@openlayers/pepjs";const PROJECTION="projection",COORDINATE_FORMAT="coordinateFormat";class MousePosition extends Control{constructor(e){e=e||{};const t=document.createElement("div");t.className=void 0!==e.className?e.className:"ol-mouse-position",super({element:t,render:e.render||render,target:e.target}),this.addEventListener(getChangeEventType(PROJECTION),this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.undefinedHTML_=void 0!==e.undefinedHTML?e.undefinedHTML:"&#160;",this.renderOnMouseOut_=!!this.undefinedHTML_,this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(COORDINATE_FORMAT)}getProjection(){return this.get(PROJECTION)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){super.setMap(e),e&&(e=e.getViewport(),this.listenerKeys.push(listen(e,EventType.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(listen(e,EventType.POINTEROUT,this.handleMouseOut,this)))}setCoordinateFormat(e){this.set(COORDINATE_FORMAT,e)}setProjection(e){this.set(PROJECTION,getProjection(e))}updateHTML_(e){let t=this.undefinedHTML_;if(e&&this.mapProjection_){var o;this.transform_||(o=this.getProjection(),this.transform_=o?getTransformFromProjections(this.mapProjection_,o):identityTransform);const n=this.getMap(),r=n.getCoordinateFromPixel(e);if(r){this.transform_(r,r);const i=this.getCoordinateFormat();t=i?i(r):r.toString()}}this.renderedHTML_&&t===this.renderedHTML_||(this.element.innerHTML=t,this.renderedHTML_=t)}}function render(e){e=e.frameState;e?this.mapProjection_!=e.viewState.projection&&(this.mapProjection_=e.viewState.projection,this.transform_=null):this.mapProjection_=null}export default MousePosition;export{render};