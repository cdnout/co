import{equals}from"../array.js";import Control from"./Control.js";import{CLASS_CONTROL,CLASS_UNSELECTABLE,CLASS_COLLAPSED}from"../css.js";import{removeChildren,replaceNode}from"../dom.js";import EventType from"../events/EventType.js";import{inView}from"../layer/Layer.js";class Attribution extends Control{constructor(e){var e=e||{},l=(super({element:document.createElement("div"),render:e.render||render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===e.collapsed||e.collapsed,this.overrideCollapsible_=void 0!==e.collapsible,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1),void 0!==e.className?e.className:"ol-attribution"),t=void 0!==e.tipLabel?e.tipLabel:"Attributions",s=void 0!==e.collapseLabel?e.collapseLabel:"Â»",s=("string"==typeof s?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s,void 0!==e.label?e.label:"i"),e=("string"==typeof s?(this.label_=document.createElement("span"),this.label_.textContent=s):this.label_=s,this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_);const i=document.createElement("button");i.setAttribute("type","button"),i.title=t,i.appendChild(e),i.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);s=l+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible");const o=this.element;o.className=s,o.appendChild(this.ulElement_),o.appendChild(i),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const s={},i=[];var o=t.layerStatesArray;for(let e=0,l=o.length;e<l;++e){const n=o[e];if(inView(n,t.viewState)){const r=n.layer.getSource();if(r){const d=r.getAttributions();if(d){var a=d(t);if(a)if(this.overrideCollapsible_||!1!==r.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(a))for(let e=0,l=a.length;e<l;++e)a[e]in s||(i.push(a[e]),s[a[e]]=!0);else a in s||(i.push(a),s[a]=!0)}}}}return i}updateElement_(e){if(e){var t=this.collectSourceAttributions_(e),e=0<t.length;if(this.renderedVisible_!=e&&(this.element.style.display=e?"":"none",this.renderedVisible_=e),!equals(t,this.renderedAttributions_)){removeChildren(this.ulElement_);for(let e=0,l=t.length;e<l;++e){const s=document.createElement("li");s.innerHTML=t[e],this.ulElement_.appendChild(s)}this.renderedAttributions_=t}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}}function render(e){this.updateElement_(e.frameState)}export default Attribution;export{render};