import{boundingExtent}from"../extent.js";import OWS from"./OWS.js";import{readHref}from"./XLink.js";import XML from"./XML.js";import{readString,readNonNegativeInteger,readDecimal}from"./xsd.js";import{pushParseAndPop,makeStructureNS,makeObjectPropertySetter,makeObjectPropertyPusher,makeArrayPusher}from"../xml.js";const NAMESPACE_URIS=[null,"http://www.opengis.net/wmts/1.0"],OWS_NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS=makeStructureNS(NAMESPACE_URIS,{Contents:makeObjectPropertySetter(readContents)});class WMTSCapabilities extends XML{constructor(){super(),this.owsParser_=new OWS}readFromDocument(r){for(let e=r.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(e){var r=e.getAttribute("version").trim();let t=this.owsParser_.readFromNode(e);return t?(t.version=r,(t=pushParseAndPop(t,PARSERS,e,[]))||null):null}}const CONTENTS_PARSERS=makeStructureNS(NAMESPACE_URIS,{Layer:makeObjectPropertyPusher(readLayer),TileMatrixSet:makeObjectPropertyPusher(readTileMatrixSet)}),LAYER_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertyPusher(readStyle),Format:makeObjectPropertyPusher(readString),TileMatrixSetLink:makeObjectPropertyPusher(readTileMatrixSetLink),Dimension:makeObjectPropertyPusher(readDimensions),ResourceURL:makeObjectPropertyPusher(readResourceUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),WGS84BoundingBox:makeObjectPropertySetter(readWgs84BoundingBox),Identifier:makeObjectPropertySetter(readString)})),STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{LegendURL:makeObjectPropertyPusher(readLegendUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TMS_LINKS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixSet:makeObjectPropertySetter(readString),TileMatrixSetLimits:makeObjectPropertySetter(readTileMatrixLimitsList)}),TMS_LIMITS_LIST_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixLimits:makeArrayPusher(readTileMatrixLimits)}),TMS_LIMITS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrix:makeObjectPropertySetter(readString),MinTileRow:makeObjectPropertySetter(readNonNegativeInteger),MaxTileRow:makeObjectPropertySetter(readNonNegativeInteger),MinTileCol:makeObjectPropertySetter(readNonNegativeInteger),MaxTileCol:makeObjectPropertySetter(readNonNegativeInteger)}),DIMENSION_PARSERS=makeStructureNS(NAMESPACE_URIS,{Default:makeObjectPropertySetter(readString),Value:makeObjectPropertyPusher(readString)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)})),WGS84_BBOX_READERS=makeStructureNS(OWS_NAMESPACE_URIS,{LowerCorner:makeArrayPusher(readCoordinates),UpperCorner:makeArrayPusher(readCoordinates)}),TMS_PARSERS=makeStructureNS(NAMESPACE_URIS,{WellKnownScaleSet:makeObjectPropertySetter(readString),TileMatrix:makeObjectPropertyPusher(readTileMatrix)},makeStructureNS(OWS_NAMESPACE_URIS,{SupportedCRS:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TM_PARSERS=makeStructureNS(NAMESPACE_URIS,{TopLeftCorner:makeObjectPropertySetter(readCoordinates),ScaleDenominator:makeObjectPropertySetter(readDecimal),TileWidth:makeObjectPropertySetter(readNonNegativeInteger),TileHeight:makeObjectPropertySetter(readNonNegativeInteger),MatrixWidth:makeObjectPropertySetter(readNonNegativeInteger),MatrixHeight:makeObjectPropertySetter(readNonNegativeInteger)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)}));function readContents(e,r){return pushParseAndPop({},CONTENTS_PARSERS,e,r)}function readLayer(e,r){return pushParseAndPop({},LAYER_PARSERS,e,r)}function readTileMatrixSet(e,r){return pushParseAndPop({},TMS_PARSERS,e,r)}function readStyle(e,r){const t=pushParseAndPop({},STYLE_PARSERS,e,r);if(t)return r="true"===e.getAttribute("isDefault"),t.isDefault=r,t}function readTileMatrixSetLink(e,r){return pushParseAndPop({},TMS_LINKS_PARSERS,e,r)}function readDimensions(e,r){return pushParseAndPop({},DIMENSION_PARSERS,e,r)}function readResourceUrl(e,r){var t=e.getAttribute("format"),S=e.getAttribute("template"),e=e.getAttribute("resourceType");const a={};return t&&(a.format=t),S&&(a.template=S),e&&(a.resourceType=e),a}function readWgs84BoundingBox(e,r){e=pushParseAndPop([],WGS84_BBOX_READERS,e,r);if(2==e.length)return boundingExtent(e)}function readLegendUrl(e,r){const t={};return t.format=e.getAttribute("format"),t.href=readHref(e),t}function readCoordinates(e,r){e=readString(e).split(/\s+/);if(e&&2==e.length){var t=+e[0],e=+e[1];if(!isNaN(t)&&!isNaN(e))return[t,e]}}function readTileMatrix(e,r){return pushParseAndPop({},TM_PARSERS,e,r)}function readTileMatrixLimitsList(e,r){return pushParseAndPop([],TMS_LIMITS_LIST_PARSERS,e,r)}function readTileMatrixLimits(e,r){return pushParseAndPop({},TMS_LIMITS_PARSERS,e,r)}export default WMTSCapabilities;