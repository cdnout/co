import{getFontParameters}from"../css.js";import{createCanvasContext2D}from"../dom.js";import{clear}from"../obj.js";import{create as createTransform}from"../transform.js";import LabelCache from"./canvas/LabelCache.js";const defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,labelCache=new LabelCache,checkedFonts={};let measureContext=null,measureFont;const textHeights={},checkFont=function(){const o=checkedFonts,s="32px ",i=["monospace","serif"],u=i.length,f="wmytzilWMYTZIL@#/&?$%10ï€“";let d,m;function c(t,a,n){const r=getMeasureContext();let l=!0;for(let e=0;e<u;++e){var o=i[e];r.font=t+" "+a+" "+s+o,m=r.measureText(f).width,n!=o&&(r.font=t+" "+a+" "+s+n+","+o,o=r.measureText(f).width,l=l&&o!=m)}return!!l}function h(){let e=!0;for(const t in o)o[t]<100&&(c.apply(this,t.split("\n"))?(o[t]=100,clear(textHeights),measureContext=null,measureFont=void 0,labelCache.getCount()&&labelCache.clear()):(++o[t],e=!1));e&&(clearInterval(d),d=void 0)}return function(e){var a=getFontParameters(e);if(a){var n=a.families;for(let e=0,t=n.length;e<t;++e){var r=n[e],l=a.style+"\n"+a.weight+"\n"+r;l in o||(o[l]=100,c(a.style,a.weight,r)||void(o[l]=0)===d&&(d=setInterval(h,32)))}}}}();function getMeasureContext(){return measureContext=measureContext||createCanvasContext2D(1,1)}const measureTextHeight=function(){let a;const n=textHeights;return function(e){let t=n[e];return null==t&&(a||((a=document.createElement("div")).innerHTML="M",a.style.margin=a.style.padding="0 !important",a.style.position="absolute !important",a.style.left="-99999px !important"),a.style.font=e,document.body.appendChild(a),t=n[e]=a.offsetHeight,document.body.removeChild(a)),t}}();function measureTextWidth(e,t){const a=getMeasureContext();return e!=measureFont&&(a.font=measureFont=e),a.measureText(t).width}function measureAndCacheTextWidth(e,t,a){return t in a?a[t]:a[t]=measureTextWidth(e,t)}function measureTextWidths(t,a,n){var r=a.length;let l=0;for(let e=0;e<r;++e){var o=measureTextWidth(t,a[e]);l=Math.max(l,o),n.push(o)}return l}function rotateAtOffset(e,t,a,n){0!==t&&(e.translate(a,n),e.rotate(t),e.translate(-a,-n))}const resetTransform=createTransform();function drawImage(e,t,a,n,r,l,o,s,i,u,f){let d;1!=a&&(d=e.globalAlpha,e.globalAlpha=d*a),t&&e.setTransform.apply(e,t),e.drawImage(n,r,l,o,s,i,u,o*f,s*f),1!=a&&(e.globalAlpha=d),t&&e.setTransform.apply(e,resetTransform)}export{defaultFont,defaultFillStyle,defaultLineCap,defaultLineDash,defaultLineDashOffset,defaultLineJoin,defaultMiterLimit,defaultStrokeStyle,defaultTextAlign,defaultTextBaseline,defaultPadding,defaultLineWidth,labelCache,checkedFonts,textHeights,checkFont,measureTextHeight,measureTextWidth,measureAndCacheTextWidth,measureTextWidths,rotateAtOffset,resetTransform,drawImage};