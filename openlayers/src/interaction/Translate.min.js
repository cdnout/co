import Collection from"../Collection.js";import{getChangeEventType}from"../Object.js";import Event from"../events/Event.js";import{TRUE}from"../functions.js";import{includes}from"../array.js";import PointerInteraction from"./Pointer.js";import InteractionProperty from"./Property.js";const TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class TranslateEvent extends Event{constructor(t,e,a){super(t),this.features=e,this.coordinate=a}}class Translate extends PointerInteraction{constructor(t){t=t||{};super(t),this.lastCoordinate_=null,this.features_=void 0!==t.features?t.features:null;let e;if(t.layers)if("function"==typeof t.layers)e=t.layers;else{const a=t.layers;e=function(t){return includes(a,t)}}else e=TRUE;this.layerFilter_=e,this.filter_=t.filter||TRUE,this.hitTolerance_=t.hitTolerance||0,this.lastFeature_=null,this.addEventListener(getChangeEventType(InteractionProperty.ACTIVE),this.handleActiveChanged_)}handleDownEvent(t){var e;return this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!(this.lastCoordinate_||!this.lastFeature_)&&(this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t),e=this.features_||new Collection([this.lastFeature_]),this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATESTART,e,t.coordinate)),!0)}handleUpEvent(t){var e;return!!this.lastCoordinate_&&(this.lastCoordinate_=null,this.handleMoveEvent(t),e=this.features_||new Collection([this.lastFeature_]),this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATEEND,e,t.coordinate)),!0)}handleDragEvent(t){if(this.lastCoordinate_){t=t.coordinate;const a=t[0]-this.lastCoordinate_[0],s=t[1]-this.lastCoordinate_[1],e=this.features_||new Collection([this.lastFeature_]);e.forEach(function(t){const e=t.getGeometry();e.translate(a,s),t.setGeometry(e)}),this.lastCoordinate_=t,this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATING,e,t))}}handleMoveEvent(t){const e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(t,e){return e.forEachFeatureAtPixel(t,function(t,e){if(this.filter_(t,e)&&(!this.features_||includes(this.features_.getArray(),t)))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(t){this.hitTolerance_=t}setMap(t){var e=this.getMap();super.setMap(t),this.updateState_(e)}handleActiveChanged_(){this.updateState_(null)}updateState_(t){let e=this.getMap();var a=this.getActive();if((!e||!a)&&(e=e||t)){const s=e.getViewport();s.classList.remove("ol-grab","ol-grabbing")}}}export default Translate;export{TranslateEvent};