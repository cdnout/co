import TileState from"./TileState.js";import{easeIn}from"./easing.js";import EventTarget from"./events/Target.js";import EventType from"./events/EventType.js";import{abstract}from"./util.js";class Tile extends EventTarget{constructor(t,i,e){super();e=e||{};this.tileCoord=t,this.state=i,this.interimTile=null,this.hifi=!0,this.key="",this.transition_=void 0===e.transition?250:e.transition,this.transitionStarts_={}}changed(){this.dispatchEvent(EventType.CHANGE)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==TileState.LOADED)return this.transition_=0,t}while(t=t.interimTile);return this}refreshInterimChain(){if(this.interimTile){let t=this.interimTile,i=this;do{if(t.getState()==TileState.LOADED){t.interimTile=null;break}}while(t.getState()!=TileState.LOADING&&t.getState()==TileState.IDLE?i.interimTile=t.interimTile:i=t,t=i.interimTile)}}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){this.state=t,this.changed()}load(){abstract()}getAlpha(t,i){if(!this.transition_)return 1;let e=this.transitionStarts_[t];if(e){if(-1===e)return 1}else e=i,this.transitionStarts_[t]=e;t=i-e+1e3/60;return t>=this.transition_?1:easeIn(t/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}export default Tile;