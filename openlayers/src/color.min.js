import{assert}from"./asserts.js";import{clamp}from"./math.js";const HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$/i;function asString(r){return"string"==typeof r?r:toString(r)}function fromNamed(r){const t=document.createElement("div");return t.style.color=r,""!==t.style.color?(document.body.appendChild(t),r=getComputedStyle(t).color,document.body.removeChild(t),r):""}const fromString=function(){const n={};let o=0;return function(r){let t;if(n.hasOwnProperty(r))t=n[r];else{if(1024<=o){let r=0;for(const e in n)0==(3&r++)&&(delete n[e],--o)}t=fromStringInternal_(r),n[r]=t,++o}return t}}();function asArray(r){return Array.isArray(r)?r:fromString(r)}function fromStringInternal_(t){let e,n,o,i,s;if(NAMED_COLOR_RE_.exec(t)&&(t=fromNamed(t)),HEX_COLOR_RE_.exec(t)){var a=t.length-1;let r;r=a<=4?1:2;a=4==a||8==a;e=parseInt(t.substr(1+0*r,r),16),n=parseInt(t.substr(+r+1,r),16),o=parseInt(t.substr(1+2*r,r),16),i=a?parseInt(t.substr(1+3*r,r),16):255,1==r&&(e=(e<<4)+e,n=(n<<4)+n,o=(o<<4)+o,a&&(i=(i<<4)+i)),s=[e,n,o,i/255]}else 0==t.indexOf("rgba(")?normalize(s=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((s=t.slice(4,-1).split(",").map(Number)).push(1),normalize(s)):assert(!1,14);return s}function normalize(r){return r[0]=clamp(r[0]+.5|0,0,255),r[1]=clamp(r[1]+.5|0,0,255),r[2]=clamp(r[2]+.5|0,0,255),r[3]=clamp(r[3],0,1),r}function toString(r){let t=r[0],e=(t!=(0|t)&&(t=t+.5|0),r[1]),n=(e!=(0|e)&&(e=e+.5|0),r[2]);n!=(0|n)&&(n=n+.5|0);r=void 0===r[3]?1:r[3];return"rgba("+t+","+e+","+n+","+r+")"}export{asString,fromString,asArray,normalize,toString};