var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import{listen}from"../events.js";import EventType from"../pointer/EventType.js";import{getChangeEventType}from"../Object.js";import Control from"./Control.js";import{getTransformFromProjections,identityTransform,get as getProjection}from"../proj.js";import"@openlayers/pepjs";var PROJECTION="projection",COORDINATE_FORMAT="coordinateFormat",MousePosition=function(n){function t(t){var e=this,t=t||{},o=document.createElement("div");return o.className=void 0!==t.className?t.className:"ol-mouse-position",(e=n.call(this,{element:o,render:t.render||render,target:t.target})||this).addEventListener(getChangeEventType(PROJECTION),e.handleProjectionChanged_),t.coordinateFormat&&e.setCoordinateFormat(t.coordinateFormat),t.projection&&e.setProjection(t.projection),e.undefinedHTML_=void 0!==t.undefinedHTML?t.undefinedHTML:"&#160;",e.renderOnMouseOut_=!!e.undefinedHTML_,e.renderedHTML_=o.innerHTML,e.mapProjection_=null,e.transform_=null,e}return __extends(t,n),t.prototype.handleProjectionChanged_=function(){this.transform_=null},t.prototype.getCoordinateFormat=function(){return this.get(COORDINATE_FORMAT)},t.prototype.getProjection=function(){return this.get(PROJECTION)},t.prototype.handleMouseMove=function(t){var e=this.getMap();this.updateHTML_(e.getEventPixel(t))},t.prototype.handleMouseOut=function(t){this.updateHTML_(null)},t.prototype.setMap=function(t){n.prototype.setMap.call(this,t),t&&(t=t.getViewport(),this.listenerKeys.push(listen(t,EventType.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(listen(t,EventType.POINTEROUT,this.handleMouseOut,this)))},t.prototype.setCoordinateFormat=function(t){this.set(COORDINATE_FORMAT,t)},t.prototype.setProjection=function(t){this.set(PROJECTION,getProjection(t))},t.prototype.updateHTML_=function(t){var e,o=this.undefinedHTML_;t&&this.mapProjection_&&(this.transform_||(e=this.getProjection(),this.transform_=e?getTransformFromProjections(this.mapProjection_,e):identityTransform),(e=this.getMap().getCoordinateFromPixel(t))&&(this.transform_(e,e),o=(t=this.getCoordinateFormat())?t(e):e.toString())),this.renderedHTML_&&o===this.renderedHTML_||(this.element.innerHTML=o,this.renderedHTML_=o)},t}(Control);function render(t){t=t.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}export default MousePosition;export{render};