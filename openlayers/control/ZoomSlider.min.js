var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import Control from"./Control.js";import{CLASS_CONTROL,CLASS_UNSELECTABLE}from"../css.js";import{easeOut}from"../easing.js";import{listen,unlistenByKey}from"../events.js";import{stopPropagation}from"../events/Event.js";import EventType from"../events/EventType.js";import{clamp}from"../math.js";import PointerEventType from"../pointer/EventType.js";import"@openlayers/pepjs";var Direction={VERTICAL:0,HORIZONTAL:1},ZoomSlider=function(o){function t(t){var e=this,t=t||{},t=((e=o.call(this,{element:document.createElement("div"),render:t.render||render})||this).dragListenerKeys_=[],e.currentResolution_=void 0,e.direction_=Direction.VERTICAL,e.dragging_,e.heightLimit_=0,e.widthLimit_=0,e.startX_,e.startY_,e.thumbSize_=null,e.sliderInitialized_=!1,e.duration_=void 0!==t.duration?t.duration:200,void 0!==t.className?t.className:"ol-zoomslider"),i=document.createElement("button"),n=(i.setAttribute("type","button"),i.className=t+"-thumb "+CLASS_UNSELECTABLE,e.element);return n.setAttribute("touch-action","none"),n.className=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,n.appendChild(i),n.addEventListener(PointerEventType.POINTERDOWN,e.handleDraggerStart_.bind(e),!1),n.addEventListener(PointerEventType.POINTERMOVE,e.handleDraggerDrag_.bind(e),!1),n.addEventListener(PointerEventType.POINTERUP,e.handleDraggerEnd_.bind(e),!1),n.addEventListener(EventType.CLICK,e.handleContainerClick_.bind(e),!1),i.addEventListener(EventType.CLICK,stopPropagation,!1),e}return __extends(t,o),t.prototype.setMap=function(t){o.prototype.setMap.call(this,t),t&&t.render()},t.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,i=t.offsetHeight,t=t.firstElementChild,n=getComputedStyle(t),o=t.offsetWidth+parseFloat(n.marginRight)+parseFloat(n.marginLeft),t=t.offsetHeight+parseFloat(n.marginTop)+parseFloat(n.marginBottom);this.thumbSize_=[o,t],i<e?(this.direction_=Direction.HORIZONTAL,this.widthLimit_=e-o):(this.direction_=Direction.VERTICAL,this.heightLimit_=i-t),this.sliderInitialized_=!0},t.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),t=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),t=this.getResolutionForPosition_(t),t=e.getConstrainedZoom(e.getZoomForResolution(t));e.animateInternal({zoom:t,duration:this.duration_,easing:easeOut})},t.prototype.handleDraggerStart_=function(t){var e;this.dragging_||t.target!==this.element.firstElementChild||(e=this.element.firstElementChild,this.getMap().getView().beginInteraction(),this.startX_=t.clientX-parseFloat(e.style.left),this.startY_=t.clientY-parseFloat(e.style.top),this.dragging_=!0,0===this.dragListenerKeys_.length&&(t=this.handleDraggerDrag_,e=this.handleDraggerEnd_,this.dragListenerKeys_.push(listen(document,PointerEventType.POINTERMOVE,t,this),listen(document,PointerEventType.POINTERUP,e,this))))},t.prototype.handleDraggerDrag_=function(t){var e;this.dragging_&&(e=t.clientX-this.startX_,t=t.clientY-this.startY_,e=this.getRelativePosition_(e,t),this.currentResolution_=this.getResolutionForPosition_(e),this.getMap().getView().setResolution(this.currentResolution_))},t.prototype.handleDraggerEnd_=function(t){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0)},t.prototype.setThumbPosition_=function(t){var t=this.getPositionForResolution_(t),e=this.element.firstElementChild;this.direction_==Direction.HORIZONTAL?e.style.left=this.widthLimit_*t+"px":e.style.top=this.heightLimit_*t+"px"},t.prototype.getRelativePosition_=function(t,e){t=this.direction_===Direction.HORIZONTAL?t/this.widthLimit_:e/this.heightLimit_;return clamp(t,0,1)},t.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)},t.prototype.getPositionForResolution_=function(t){var e=this.getMap().getView().getValueForResolutionFunction();return clamp(1-e(t),0,1)},t}(Control);function render(t){t.frameState&&(this.sliderInitialized_||this.initSlider_(),t=t.frameState.viewState.resolution,this.currentResolution_=t,this.setThumbPosition_(t))}export default ZoomSlider;export{render};