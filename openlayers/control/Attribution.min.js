var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(e,t)};return function(e,t){function l(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(l.prototype=t.prototype,new l)}}();import{equals}from"../array.js";import Control from"./Control.js";import{CLASS_CONTROL,CLASS_UNSELECTABLE,CLASS_COLLAPSED}from"../css.js";import{removeChildren,replaceNode}from"../dom.js";import EventType from"../events/EventType.js";import{inView}from"../layer/Layer.js";var Attribution=function(n){function e(e){var t=this,e=e||{},l=((t=n.call(this,{element:document.createElement("div"),render:e.render||render,target:e.target})||this).ulElement_=document.createElement("ul"),t.collapsed_=void 0===e.collapsed||e.collapsed,t.overrideCollapsible_=void 0!==e.collapsible,t.collapsible_=void 0===e.collapsible||e.collapsible,t.collapsible_||(t.collapsed_=!1),void 0!==e.className?e.className:"ol-attribution"),o=void 0!==e.tipLabel?e.tipLabel:"Attributions",i=void 0!==e.collapseLabel?e.collapseLabel:"Â»",i=("string"==typeof i?(t.collapseLabel_=document.createElement("span"),t.collapseLabel_.textContent=i):t.collapseLabel_=i,void 0!==e.label?e.label:"i"),e=("string"==typeof i?(t.label_=document.createElement("span"),t.label_.textContent=i):t.label_=i,t.collapsible_&&!t.collapsed_?t.collapseLabel_:t.label_),i=document.createElement("button"),o=(i.setAttribute("type","button"),i.title=o,i.appendChild(e),i.addEventListener(EventType.CLICK,t.handleClick_.bind(t),!1),l+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(t.collapsed_&&t.collapsible_?" "+CLASS_COLLAPSED:"")+(t.collapsible_?"":" ol-uncollapsible")),e=t.element;return e.className=o,e.appendChild(t.ulElement_),e.appendChild(i),t.renderedAttributions_=[],t.renderedVisible_=!0,t}return __extends(e,n),e.prototype.collectSourceAttributions_=function(e){for(var t={},l=[],o=e.layerStatesArray,i=0,n=o.length;i<n;++i){var r=o[i];if(inView(r,e.viewState)){r=r.layer.getSource();if(r){var s=r.getAttributions();if(s){var a=s(e);if(a)if(this.overrideCollapsible_||!1!==r.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(a))for(var p=0,c=a.length;p<c;++p)a[p]in t||(l.push(a[p]),t[a[p]]=!0);else a in t||(l.push(a),t[a]=!0)}}}}return l},e.prototype.updateElement_=function(e){if(e){var t=this.collectSourceAttributions_(e),e=0<t.length;if(this.renderedVisible_!=e&&(this.element.style.display=e?"":"none",this.renderedVisible_=e),!equals(t,this.renderedAttributions_)){removeChildren(this.ulElement_);for(var l=0,o=t.length;l<o;++l){var i=document.createElement("li");i.innerHTML=t[l],this.ulElement_.appendChild(i)}this.renderedAttributions_=t}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},e.prototype.handleToggle_=function(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e}(Control);function render(e){this.updateElement_(e.frameState)}export default Attribution;export{render};