import{toRadians,toDegrees}from"./math.js";import GeometryType from"./geom/GeometryType.js";var DEFAULT_RADIUS=6371008.8;function getDistance(e,t,a){var a=a||DEFAULT_RADIUS,r=toRadians(e[1]),n=toRadians(t[1]),o=(n-r)/2,t=toRadians(t[0]-e[0])/2,e=Math.sin(o)*Math.sin(o)+Math.sin(t)*Math.sin(t)*Math.cos(r)*Math.cos(n);return 2*a*Math.atan2(Math.sqrt(e),Math.sqrt(1-e))}function getLengthInternal(e,t){for(var a=0,r=0,n=e.length;r<n-1;++r)a+=getDistance(e[r],e[r+1],t);return a}function getLength(e,t){var a,r,n,o,s=t||{},g=s.radius||DEFAULT_RADIUS,s=s.projection||"EPSG:3857",h=e.getType(),T=(h!==GeometryType.GEOMETRY_COLLECTION&&(e=e.clone().transform(s,"EPSG:4326")),0);switch(h){case GeometryType.POINT:case GeometryType.MULTI_POINT:break;case GeometryType.LINE_STRING:case GeometryType.LINEAR_RING:T=getLengthInternal(a=e.getCoordinates(),g);break;case GeometryType.MULTI_LINE_STRING:case GeometryType.POLYGON:for(y=0,I=(a=e.getCoordinates()).length;y<I;++y)T+=getLengthInternal(a[y],g);break;case GeometryType.MULTI_POLYGON:for(y=0,I=(a=e.getCoordinates()).length;y<I;++y)for(n=0,o=(r=a[y]).length;n<o;++n)T+=getLengthInternal(r[n],g);break;case GeometryType.GEOMETRY_COLLECTION:for(var i=e.getGeometries(),y=0,I=i.length;y<I;++y)T+=getLength(i[y],t);break;default:throw new Error("Unsupported geometry type: "+h)}return T}function getAreaInternal(e,t){for(var a=0,r=e.length,n=e[r-1][0],o=e[r-1][1],s=0;s<r;s++){var g=e[s][0],h=e[s][1];a+=toRadians(g-n)*(2+Math.sin(toRadians(o))+Math.sin(toRadians(h))),n=g,o=h}return a*t*t/2}function getArea(e,t){var a,r,n,o,s=t||{},g=s.radius||DEFAULT_RADIUS,s=s.projection||"EPSG:3857",h=e.getType(),T=(h!==GeometryType.GEOMETRY_COLLECTION&&(e=e.clone().transform(s,"EPSG:4326")),0);switch(h){case GeometryType.POINT:case GeometryType.MULTI_POINT:case GeometryType.LINE_STRING:case GeometryType.MULTI_LINE_STRING:case GeometryType.LINEAR_RING:break;case GeometryType.POLYGON:for(a=e.getCoordinates(),T=Math.abs(getAreaInternal(a[0],g)),y=1,I=a.length;y<I;++y)T-=Math.abs(getAreaInternal(a[y],g));break;case GeometryType.MULTI_POLYGON:for(y=0,I=(a=e.getCoordinates()).length;y<I;++y)for(r=a[y],T+=Math.abs(getAreaInternal(r[0],g)),n=1,o=r.length;n<o;++n)T-=Math.abs(getAreaInternal(r[n],g));break;case GeometryType.GEOMETRY_COLLECTION:for(var i=e.getGeometries(),y=0,I=i.length;y<I;++y)T+=getArea(i[y],t);break;default:throw new Error("Unsupported geometry type: "+h)}return T}function offset(e,t,a,r){var r=r||DEFAULT_RADIUS,n=toRadians(e[1]),e=toRadians(e[0]),t=t/r,r=Math.asin(Math.sin(n)*Math.cos(t)+Math.cos(n)*Math.sin(t)*Math.cos(a)),e=e+Math.atan2(Math.sin(a)*Math.sin(t)*Math.cos(n),Math.cos(t)-Math.sin(n)*Math.sin(r));return[toDegrees(e),toDegrees(r)]}export{DEFAULT_RADIUS,getDistance,getLength,getArea,offset};