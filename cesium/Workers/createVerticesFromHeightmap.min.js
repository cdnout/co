define(["./Matrix2-37e55508","./AxisAlignedBoundingBox-0ddf9b79","./Transforms-dca21951","./defaultValue-81eec7ed","./RuntimeError-8952249c","./TerrainEncoding-48ceaaca","./ComponentDatatype-a15c9a19","./OrientedBoundingBox-86a6888d","./WebMercatorProjection-2839e524","./_commonjsHelpers-3aae1032-26891ab7","./createTaskProcessorWorker","./combine-3c023bda","./AttributeCompression-27507afe","./WebGLConstants-508b9636","./EllipsoidTangentPlane-06e319ef","./IntersectionTests-ee135b8e","./Plane-6ee42cab"],function(xe,we,ke,ye,n,Ie,be,Ue,Te,e,t,i,a,r,s,l,o){"use strict";var f=Object.freeze({NONE:0,LERC:1});const Me={};Me.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});const Ve=new xe.Cartesian3,ve=new xe.Matrix4,Ae=new xe.Cartesian3,Be=new xe.Cartesian3;Me.computeVertices=function(e){const l=Math.cos,o=Math.sin,f=Math.sqrt,i=Math.atan,a=Math.exp,n=be.CesiumMath.PI_OVER_TWO,u=be.CesiumMath.toRadians,c=e.heightmap,d=e.width,h=e.height,m=e.skirtHeight,t=0<m,g=ye.defaultValue(e.isGeographic,!0),p=ye.defaultValue(e.ellipsoid,xe.Ellipsoid.WGS84),x=1/p.maximumRadius,w=xe.Rectangle.clone(e.nativeRectangle),k=xe.Rectangle.clone(e.rectangle);let y,I,b,U;U=ye.defined(k)?(y=k.west,I=k.south,b=k.east,k.north):g?(y=u(w.west),I=u(w.south),b=u(w.east),u(w.north)):(y=w.west*x,I=n-2*i(a(-w.south*x)),b=w.east*x,n-2*i(a(-w.north*x)));let T=e.relativeToCenter;const M=ye.defined(T);T=M?T:xe.Cartesian3.ZERO;const V=ye.defaultValue(e.includeWebMercatorT,!1),v=ye.defaultValue(e.exaggeration,1),A=ye.defaultValue(e.exaggerationRelativeHeight,0),B=1!==v,D=ye.defaultValue(e.structure,Me.DEFAULT_STRUCTURE),S=ye.defaultValue(D.heightScale,Me.DEFAULT_STRUCTURE.heightScale),P=ye.defaultValue(D.heightOffset,Me.DEFAULT_STRUCTURE.heightOffset),E=ye.defaultValue(D.elementsPerHeight,Me.DEFAULT_STRUCTURE.elementsPerHeight),C=ye.defaultValue(D.stride,Me.DEFAULT_STRUCTURE.stride),F=ye.defaultValue(D.elementMultiplier,Me.DEFAULT_STRUCTURE.elementMultiplier),N=ye.defaultValue(D.isBigEndian,Me.DEFAULT_STRUCTURE.isBigEndian);let O=xe.Rectangle.computeWidth(w),R=xe.Rectangle.computeHeight(w);var L=O/(d-1),z=R/(h-1);g||(O*=x,R*=x);var r=p.radiiSquared,H=r.x,_=r.y,Y=r.z;let W=65536,X=-65536;var e=ke.Transforms.eastNorthUpToFixedFrame(T,p),Z=xe.Matrix4.inverseTransformation(e,ve);let j,G;V&&(j=Te.WebMercatorProjection.geodeticLatitudeToMercatorAngle(I),G=1/(Te.WebMercatorProjection.geodeticLatitudeToMercatorAngle(U)-j));const q=Ae;q.x=Number.POSITIVE_INFINITY,q.y=Number.POSITIVE_INFINITY,q.z=Number.POSITIVE_INFINITY;const Q=Be;Q.x=Number.NEGATIVE_INFINITY,Q.y=Number.NEGATIVE_INFINITY,Q.z=Number.NEGATIVE_INFINITY;let J=Number.POSITIVE_INFINITY;const K=d*h,s=K+(0<m?2*d+2*h:0),$=new Array(s),ee=new Array(s),te=new Array(s),ie=V?new Array(s):[],ae=B?new Array(s):[];let ne=0,re=h,se=0,le=d;t&&(--ne,++re,--se,++le);for(let t=ne;t<re;++t){let r=t;r<0&&(r=0),r>=h&&(r=h-1);let e=w.north-z*r;e=g?u(e):n-2*i(a(-e*x));var oe=(e-I)/(U-I),oe=be.CesiumMath.clamp(oe,0,1);const Ie=t===ne,Ue=t===re-1;0<m&&(Ie?e+=1e-5*R:Ue&&(e-=1e-5*R));const Me=l(e),ve=o(e),Ae=Y*ve;let s;V&&(s=(Te.WebMercatorProjection.geodeticLatitudeToMercatorAngle(e)-j)*G);for(let n=se;n<le;++n){let e=n;e<0&&(e=0),e>=d&&(e=d-1);const Te=r*(d*C)+e*C;let t;if(1===E)t=c[Te];else{let e;if(t=0,N)for(e=0;e<E;++e)t=t*F+c[Te+e];else for(e=E-1;0<=e;--e)t=t*F+c[Te+e]}t=t*S+P,X=Math.max(X,t),W=Math.min(W,t);let i=w.west+L*e;g?i=u(i):i*=x;var fe=(i-y)/(b-y),fe=be.CesiumMath.clamp(fe,0,1);let a=r*d+e;if(0<m){const xe=n===se,pe=n===le-1,be=Ie||Ue||xe||pe;if((Ie||Ue)&&(xe||pe))continue;be&&(t-=m,xe?(a=K+(h-r-1),i-=1e-5*O):Ue?a=K+h+(d-e-1):pe?(a=K+h+d+r,i+=1e-5*O):Ie&&(a=K+h+d+h+e))}const k=Me*l(i),I=Me*o(i),U=H*k,T=_*I,M=1/f(U*k+T*I+Ae*ve),v=U*M,A=T*M,D=Ae*M,R=new xe.Cartesian3;R.x=v+k*t,R.y=A+I*t,R.z=D+ve*t,xe.Matrix4.multiplyByPoint(Z,R,Ve),xe.Cartesian3.minimumByComponent(Ve,q,q),xe.Cartesian3.maximumByComponent(Ve,Q,Q),J=Math.min(J,t),$[a]=R,te[a]=new xe.Cartesian2(fe,oe),ee[a]=t,V&&(ie[a]=s),B&&(ae[a]=p.geodeticSurfaceNormal(R))}}r=ke.BoundingSphere.fromPoints($);let ue,ce;ye.defined(k)&&(ue=Ue.OrientedBoundingBox.fromRectangle(k,W,X,p)),M&&(ce=new Ie.EllipsoidalOccluder(p).computeHorizonCullingPointPossiblyUnderEllipsoid(T,$,W));const de=new we.AxisAlignedBoundingBox(q,Q,T),he=new Ie.TerrainEncoding(T,de,J,X,e,!1,V,B,v,A),me=new Float32Array(s*he.stride);let ge=0;for(let e=0;e<s;++e)ge=he.encode(me,ge,$[e],te[e],ee[e],void 0,ie[e],ae[e]);return{vertices:me,maximumHeight:X,minimumHeight:W,encoding:he,boundingSphere3D:r,orientedBoundingBox:ue,occludeePointInScaledSpace:ce}};var u=e.createCommonjsModule(function(i){!function(){var n,r,s,l,o,B,y,I,b,U,T,M,L,v,e,x=(n={defaultNoDataValue:-34027999387901484e22,decode:function(e,t){var i=(t=t||{}).encodedMaskData||null===t.encodedMaskData,a=o(e,t.inputOffset||0,i),e=null!==t.noDataValue?t.noDataValue:n.defaultNoDataValue,i=r(a,t.pixelType||Float32Array,t.encodedMaskData,e,t.returnMask),e={width:a.width,height:a.height,pixelData:i.resultPixels,minValue:i.minValue,maxValue:a.pixels.maxValue,noDataValue:e};return i.resultMask&&(e.maskData=i.resultMask),t.returnEncodedMask&&a.mask&&(e.encodedMaskData=a.mask.bitset||null),t.returnFileInfo&&(e.fileInfo=s(a),t.computeUsedBitDepths&&(e.fileInfo.bitDepths=l(a))),e}},r=function(e,t,i,a,n){var r,s,l,o=0,f=e.pixels.numBlocksX,u=e.pixels.numBlocksY,c=Math.floor(e.width/f),d=Math.floor(e.height/u),h=2*e.maxZError,m=Number.MAX_VALUE;i=i||(e.mask?e.mask.bitset:null),s=new t(e.width*e.height),n&&i&&(l=new Uint8Array(e.width*e.height));for(var g,p,x=new Float32Array(c*d),w=0;w<=u;w++){var k=w!==u?d:e.height%u;if(0!==k)for(var y=0;y<=f;y++){var I=y!==f?c:e.width%f;if(0!==I){var b,U,T,M,V=w*e.width*d+y*c,v=e.width-I,A=e.pixels.blocks[o];if(A.encoding<2?(b=0===A.encoding?A.rawData:(B(A.stuffedData,A.bitsPerPixel,A.numValidPixels,A.offset,h,x,e.pixels.maxValue),x),U=0):T=2===A.encoding?0:A.offset,i)for(p=0;p<k;p++){for(7&V&&(M=i[V>>3],M<<=7&V),g=0;g<I;g++)128&(M=!(7&V)?i[V>>3]:M)?(l&&(l[V]=1),m=m>(r=A.encoding<2?b[U++]:T)?r:m,s[V++]=r):(l&&(l[V]=0),s[V++]=a),M<<=1;V+=v}else if(A.encoding<2)for(p=0;p<k;p++){for(g=0;g<I;g++)m=m>(r=b[U++])?r:m,s[V++]=r;V+=v}else for(m=T<m?T:m,p=0;p<k;p++){for(g=0;g<I;g++)s[V++]=T;V+=v}if(1===A.encoding&&U!==A.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:s,resultMask:l,minValue:m}},s=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},l=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,i={},a=0;a<t;a++){var n=e.pixels.blocks[a];0===n.encoding?i.float32=!0:1===n.encoding?i[n.bitsPerPixel]=!0:i[0]=!0}return Object.keys(i)},o=function(e,t,i){var a={},n=new Uint8Array(e,t,10);if(a.fileIdentifierString=String.fromCharCode.apply(null,n),"CntZImage"!==a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;t+=10;var r=new DataView(e,t,24);if(a.fileVersion=r.getInt32(0,!0),a.imageType=r.getInt32(4,!0),a.height=r.getUint32(8,!0),a.width=r.getUint32(12,!0),a.maxZError=r.getFloat64(16,!0),t+=24,!i)if(r=new DataView(e,t,16),a.mask={},a.mask.numBlocksY=r.getUint32(0,!0),a.mask.numBlocksX=r.getUint32(4,!0),a.mask.numBytes=r.getUint32(8,!0),a.mask.maxValue=r.getFloat32(12,!0),t+=16,0<a.mask.numBytes){var s=new Uint8Array(Math.ceil(a.width*a.height/8)),l=(r=new DataView(e,t,a.mask.numBytes)).getInt16(0,!0),o=2,f=0;do{if(0<l)for(;l--;)s[f++]=r.getUint8(o++);else for(var u=r.getUint8(o++),l=-l;l--;)s[f++]=u}while(l=r.getInt16(o,!0),(o+=2)<a.mask.numBytes);if(-32768!==l||f<s.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=s,t+=a.mask.numBytes}else 0==(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(a.mask.bitset=new Uint8Array(Math.ceil(a.width*a.height/8)));r=new DataView(e,t,16),a.pixels={},a.pixels.numBlocksY=r.getUint32(0,!0),a.pixels.numBlocksX=r.getUint32(4,!0),a.pixels.numBytes=r.getUint32(8,!0),a.pixels.maxValue=r.getFloat32(12,!0),t+=16;var n=a.pixels.numBlocksX,i=a.pixels.numBlocksY,c=n+(0<a.width%n?1:0),d=i+(0<a.height%i?1:0);a.pixels.blocks=new Array(c*d);for(var h=0,m=0;m<d;m++)for(var g=0;g<c;g++){var p=0,x=e.byteLength-t,r=new DataView(e,t,Math.min(10,x)),w={};a.pixels.blocks[h++]=w;var k,x=r.getUint8(0);if(p++,w.encoding=63&x,3<w.encoding)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==x&&2!==x){if(x>>=6,2===(w.offsetType=x))w.offset=r.getInt8(1),p++;else if(1===x)w.offset=r.getInt16(1,!0),p+=2;else{if(0!==x)throw"Invalid block offset type";w.offset=r.getFloat32(1,!0),p+=4}if(1===w.encoding)if(x=r.getUint8(p),p++,w.bitsPerPixel=63&x,x>>=6,2===(w.numValidPixelsType=x))w.numValidPixels=r.getUint8(p),p++;else if(1===x)w.numValidPixels=r.getUint16(p,!0),p+=2;else{if(0!==x)throw"Invalid valid pixel count type";w.numValidPixels=r.getUint32(p,!0),p+=4}}if(t+=p,3!==w.encoding)if(0===w.encoding){var y=(a.pixels.numBytes-1)/4;if(y!==Math.floor(y))throw"uncompressed block has invalid length";k=new ArrayBuffer(4*y),new Uint8Array(k).set(new Uint8Array(e,t,4*y));var I=new Float32Array(k);w.rawData=I,t+=4*y}else 1===w.encoding&&(I=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),y=Math.ceil(I/4),k=new ArrayBuffer(4*y),new Uint8Array(k).set(new Uint8Array(e,t,I)),w.stuffedData=new Uint32Array(k),t+=I)}else t++}return a.eofOffset=t,a},B=function(e,t,i,a,n,r,s){var l,o,f,u,c=(1<<t)-1,d=0,h=0,m=Math.ceil((s-a)/n),g=4*e.length-Math.ceil(t*i/8);for(e[e.length-1]<<=8*g,l=0;l<i;l++)0===h&&(o=e[d++],h=32),t<=h?(u=o>>>h-t&c,h-=t):(u=(o&c)<<(f=t-h)&c,u+=(o=e[d++])>>>(h=32-f)),r[l]=u<m?a+u*n:s;return r},n),w=(y=function(e,t,i,a,n,r,s,l){var o,f,u,c,d,h=(1<<i)-1,m=0,g=0,p=4*e.length-Math.ceil(i*a/8);if(e[e.length-1]<<=8*p,n)for(o=0;o<a;o++)0===g&&(u=e[m++],g=32),i<=g?(f=u>>>g-i&h,g-=i):(f=(u&h)<<(c=i-g)&h,f+=(u=e[m++])>>>(g=32-c)),t[o]=n[f];else for(d=Math.ceil((l-r)/s),o=0;o<a;o++)0===g&&(u=e[m++],g=32),i<=g?(f=u>>>g-i&h,g-=i):(f=(u&h)<<(c=i-g)&h,f+=(u=e[m++])>>>(g=32-c)),t[o]=f<d?r+f*s:l},I=function(e,t,i,a,n,r){var s,l,o=(1<<t)-1,f=0,u=0,c=0,d=0,h=[],m=4*e.length-Math.ceil(t*i/8);e[e.length-1]<<=8*m;for(var g=Math.ceil((r-a)/n),u=0;u<i;u++)0===c&&(s=e[f++],c=32),t<=c?(d=s>>>c-t&o,c-=t):(d=(s&o)<<(l=t-c)&o,d+=(s=e[f++])>>>(c=32-l)),h[u]=d<g?a+d*n:r;return h.unshift(a),h},b=function(e,t,i,a,n,r,s,l){var o,f,u,c=(1<<i)-1,d=0,h=0,m=0;if(n)for(p=0;p<a;p++)0===h&&(f=e[d++],h=32,m=0),i<=h?(o=f>>>m&c,h-=i,m+=i):(o=f>>>m&c,h=32-(u=i-h),o|=((f=e[d++])&(1<<u)-1)<<i-u,m=u),t[p]=n[o];else for(var g=Math.ceil((l-r)/s),p=0;p<a;p++)0===h&&(f=e[d++],h=32,m=0),i<=h?(o=f>>>m&c,h-=i,m+=i):(o=f>>>m&c,h=32-(u=i-h),o|=((f=e[d++])&(1<<u)-1)<<i-u,m=u),t[p]=o<g?r+o*s:l;return t},U=function(e,t,i,a,n,r){for(var s,l,o=(1<<t)-1,f=0,u=0,c=0,d=0,h=0,m=[],g=Math.ceil((r-a)/n),u=0;u<i;u++)0===c&&(s=e[f++],c=32,h=0),t<=c?(d=s>>>h&o,c-=t,h+=t):(d=s>>>h&o,c=32-(l=t-c),d|=((s=e[f++])&(1<<l)-1)<<t-l,h=l),m[u]=d<g?a+d*n:r;return m.unshift(a),m},T=function(e,t,i,a){var n,r,s,l,o=(1<<i)-1,f=0,u=0,c=4*e.length-Math.ceil(i*a/8);for(e[e.length-1]<<=8*c,n=0;n<a;n++)0===u&&(s=e[f++],u=32),i<=u?(r=s>>>u-i&o,u-=i):(r=(s&o)<<(l=i-u)&o,r+=(s=e[f++])>>>(u=32-l)),t[n]=r;return t},M=function(e,t,i,a){for(var n,r,s,l=(1<<i)-1,o=0,f=0,u=0,c=0;c<a;c++)0===f&&(r=e[o++],f=32,u=0),i<=f?(n=r>>>u&l,f-=i,u+=i):(n=r>>>u&l,f=32-(s=i-f),n|=((r=e[o++])&(1<<s)-1)<<i-s,u=s),t[c]=n;return t},L={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var t=65535,i=65535,a=e.length,n=Math.floor(a/2),r=0;n;){var s=359<=n?359:n;for(n-=s;t+=e[r++]<<8,i+=t+=e[r++],--s;);t=(65535&t)+(t>>>16),i=(65535&i)+(i>>>16)}return 1&a&&(i+=t+=e[r]<<8),((i=(65535&i)+(i>>>16))<<16|(65535&t)+(t>>>16))>>>0},readHeaderInfo:function(e,t){var i=t.ptr,a=new Uint8Array(e,i,6),n={};if(n.fileIdentifierString=String.fromCharCode.apply(null,a),0!==n.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+n.fileIdentifierString;i+=6;var r=new DataView(e,i,8),a=r.getInt32(0,!0);if(i+=4,3<=(n.fileVersion=a)&&(n.checksum=r.getUint32(4,!0),i+=4),r=new DataView(e,i,12),n.height=r.getUint32(0,!0),n.width=r.getUint32(4,!0),i+=8,4<=a?(n.numDims=r.getUint32(8,!0),i+=4):n.numDims=1,r=new DataView(e,i,40),n.numValidPixel=r.getUint32(0,!0),n.microBlockSize=r.getInt32(4,!0),n.blobSize=r.getInt32(8,!0),n.imageType=r.getInt32(12,!0),n.maxZError=r.getFloat64(16,!0),n.zMin=r.getFloat64(24,!0),n.zMax=r.getFloat64(32,!0),i+=40,t.headerInfo=n,t.ptr=i,3<=a&&this.computeChecksumFletcher32(new Uint8Array(e,i-(4<=a?52:48),n.blobSize-14))!==n.checksum)throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var i=t.headerInfo,a=this.getDataTypeArray(i.imageType),n=i.numDims*this.getDataTypeSize(i.imageType),r=this.readSubArray(e,t.ptr,a,n),s=this.readSubArray(e,t.ptr+n,a,n);t.ptr+=2*n;for(var l=!0,o=0;o<i.numDims;o++)if(r[o]!==s[o]){l=!1;break}return i.minValues=r,i.maxValues=s,l},readSubArray:function(e,t,i,a){var n=i===Uint8Array?new Uint8Array(e,t,a):(n=new ArrayBuffer(a),new Uint8Array(n).set(new Uint8Array(e,t,a)),new i(n));return n},readMask:function(e,t){var i=t.ptr,a=t.headerInfo,n=a.width*a.height,a=a.numValidPixel,r=new DataView(e,i,4),s={};if(s.numBytes=r.getUint32(0,!0),i+=4,(0===a||n===a)&&0!==s.numBytes)throw"invalid mask";if(0===a)o=new Uint8Array(Math.ceil(n/8)),s.bitset=o,d=new Uint8Array(n),t.pixels.resultMask=d,i+=s.numBytes;else if(0<s.numBytes){var l,o=new Uint8Array(Math.ceil(n/8)),f=(r=new DataView(e,i,s.numBytes)).getInt16(0,!0),u=2,c=0;do{if(0<f)for(;f--;)o[c++]=r.getUint8(u++);else for(l=r.getUint8(u++),f=-f;f--;)o[c++]=l}while(f=r.getInt16(u,!0),(u+=2)<s.numBytes);if(-32768!==f||c<o.length)throw"Unexpected end of mask RLE encoding";for(var d=new Uint8Array(n),h=0,m=0,m=0;m<n;m++)7&m?(h=o[m>>3],h<<=7&m):h=o[m>>3],128&h&&(d[m]=1);t.pixels.resultMask=d,s.bitset=o,i+=s.numBytes}return t.ptr=i,t.mask=s,!0},readDataOneSweep:function(e,t,i){var a=t.ptr,n=t.headerInfo,r=n.numDims,s=n.width*n.height,l=n.imageType,n=n.numValidPixel*L.getDataTypeSize(l)*r,o=t.pixels.resultMask,f=i===Uint8Array?new Uint8Array(e,a,n):(l=new ArrayBuffer(n),new Uint8Array(l).set(new Uint8Array(e,a,n)),new i(l));if(f.length===s*r)t.pixels.resultPixels=f;else{t.pixels.resultPixels=new i(s*r);var u,c=0,d=0,h=0;if(1<r)for(h=0;h<r;h++)for(u=h*s,d=0;d<s;d++)o[d]&&(t.pixels.resultPixels[u+d]=f[c++]);else for(d=0;d<s;d++)o[d]&&(t.pixels.resultPixels[d]=f[c++])}return t.ptr=a+=n,!0},readHuffmanTree:function(e,t){var i=this.HUFFMAN_LUT_BITS_MAX,a=new DataView(e,t.ptr,16);if(t.ptr+=16,a.getInt32(0,!0)<2)throw"unsupported Huffman version";var n=a.getInt32(4,!0),r=a.getInt32(8,!0),s=a.getInt32(12,!0);if(s<=r)return!1;var l=new Uint32Array(s-r);L.decodeBits(e,t,l);for(var o,f,u,c=[],d=r;d<s;d++)c[o=d-(d<n?0:n)]={first:l[d-r],second:null};var h=e.byteLength-t.ptr,a=Math.ceil(h/4),a=new ArrayBuffer(4*a);new Uint8Array(a).set(new Uint8Array(e,t.ptr,h));var m=new Uint32Array(a),g=0,p=0,x=m[0];for(d=r;d<s;d++)0<(u=c[o=d-(d<n?0:n)].first)&&(c[o].second=x<<g>>>32-u,u<=32-g?32===(g+=u)&&(g=0,x=m[++p]):(x=m[++p],c[o].second|=x>>>32-(g+=u-32)));var w,k=0,y=new v;for(d=0;d<c.length;d++)void 0!==c[d]&&(k=Math.max(k,c[d].first));w=i<=k?i:k,30<=k&&console.log("WARning, large NUM LUT BITS IS "+k);var I,b,U,T,M,V=[];for(d=r;d<s;d++)if(0<(u=c[o=d-(d<n?0:n)].first))if(I=[u,o],u<=w)for(b=c[o].second<<w-u,U=1<<w-u,f=0;f<U;f++)V[b|f]=I;else for(b=c[o].second,M=y,T=u-1;0<=T;T--)M=b>>>T&1?(M.right||(M.right=new v),M.right):(M.left||(M.left=new v),M.left),0!==T||M.val||(M.val=I[1]);return{decodeLut:V,numBitsLUTQick:w,numBitsLUT:k,tree:y,stuffedData:m,srcPtr:p,bitPos:g}},readHuffman:function(e,t,i){var a,n,r,s,l,o,f,u,c,d=t.headerInfo,h=d.numDims,m=t.headerInfo.height,g=t.headerInfo.width,p=g*m,e=this.readHuffmanTree(e,t),x=e.decodeLut,w=e.tree,k=e.stuffedData,y=e.srcPtr,I=e.bitPos,b=e.numBitsLUTQick,U=e.numBitsLUT,T=0===t.headerInfo.imageType?128:0,M=t.pixels.resultMask,V=0;0<I&&(y++,I=0);for(var v=k[y],A=1===t.encodeMode,B=new i(p*h),D=B,S=0;S<d.numDims;S++){if(1<h&&(D=new i(B.buffer,p*S,p),V=0),t.headerInfo.numValidPixel===g*m)for(o=u=0;o<m;o++)for(f=0;f<g;f++,u++){if(n=0,l=s=v<<I>>>32-b,x[l=32-I<b?s|=k[y+1]>>>64-I-b:l])n=x[l][1],I+=x[l][0];else for(l=s=v<<I>>>32-U,32-I<U&&(l=s|=k[y+1]>>>64-I-U),a=w,c=0;c<U;c++)if(!(a=s>>>U-c-1&1?a.right:a.left).left&&!a.right){n=a.val,I=I+c+1;break}32<=I&&(I-=32,v=k[++y]),r=n-T,A?(r+=!(0<f)&&0<o?D[u-g]:V,r&=255,V=D[u]=r):D[u]=r}else for(o=u=0;o<m;o++)for(f=0;f<g;f++,u++)if(M[u]){if(n=0,l=s=v<<I>>>32-b,x[l=32-I<b?s|=k[y+1]>>>64-I-b:l])n=x[l][1],I+=x[l][0];else for(l=s=v<<I>>>32-U,32-I<U&&(l=s|=k[y+1]>>>64-I-U),a=w,c=0;c<U;c++)if(!(a=s>>>U-c-1&1?a.right:a.left).left&&!a.right){n=a.val,I=I+c+1;break}32<=I&&(I-=32,v=k[++y]),r=n-T,A?(!(0<f&&M[u-1])&&0<o&&M[u-g]?r+=D[u-g]:r+=V,r&=255,V=D[u]=r):D[u]=r}t.ptr=t.ptr+4*(y+1)+(0<I?4:0)}t.pixels.resultPixels=B},decodeBits:function(e,t,i,a,n){var r=t.headerInfo,s=r.fileVersion,l=0,o=new DataView(e,t.ptr,5),f=o.getUint8(0);l++;var u=f>>6,c=0==u?4:3-u,d=0<(32&f),u=31&f,f=0;if(1==c)f=o.getUint8(l),l++;else if(2==c)f=o.getUint16(l,!0),l+=2;else{if(4!=c)throw"Invalid valid pixel count type";f=o.getUint32(l,!0),l+=4}var h,m,g,p,x,w,k,c=2*r.maxZError,r=1<r.numDims?r.maxValues[n]:r.zMax;if(d){for(t.counter.lut++,w=o.getUint8(l),l++,p=Math.ceil((w-1)*u/8),x=Math.ceil(p/4),m=new ArrayBuffer(4*x),g=new Uint8Array(m),t.ptr+=l,g.set(new Uint8Array(e,t.ptr,p)),o=new Uint32Array(m),t.ptr+=p,k=0;w-1>>>k;)k++;p=Math.ceil(f*k/8),x=Math.ceil(p/4),m=new ArrayBuffer(4*x),(g=new Uint8Array(m)).set(new Uint8Array(e,t.ptr,p)),h=new Uint32Array(m),t.ptr+=p,o=(3<=s?U:I)(o,u,w-1,a,c,r),(3<=s?b:y)(h,i,k,f,o)}else t.counter.bitstuffer++,k=u,t.ptr+=l,0<k&&(p=Math.ceil(f*k/8),x=Math.ceil(p/4),m=new ArrayBuffer(4*x),(g=new Uint8Array(m)).set(new Uint8Array(e,t.ptr,p)),h=new Uint32Array(m),t.ptr+=p,3<=s?null==a?M(h,i,k,f):b(h,i,k,f,!1,a,c,r):null==a?T(h,i,k,f):y(h,i,k,f,!1,a,c,r))},readTiles:function(e,t,i){var a=t.headerInfo,n=a.width,r=a.height,s=a.microBlockSize,l=a.imageType,o=L.getDataTypeSize(l),f=Math.ceil(n/s),u=Math.ceil(r/s);t.pixels.numBlocksY=u,t.pixels.numBlocksX=f;for(var c,d,h,m,g,p,x,w,k,y,I,b,U,T,M=t.pixels.ptr=0,V=0,v=0,A=0,B=0,D=0,S=0,P=0,E=new i(s*s),C=r%s||s,F=n%s||s,N=a.numDims,O=t.pixels.resultMask,R=t.pixels.resultPixels,v=0;v<u;v++)for(w=v!==u-1?s:C,A=0;A<f;A++)for(B=v*n*s+A*s,U=n-(k=A!==f-1?s:F),x=0;x<N;x++){if(1<N&&(R=new i(t.pixels.resultPixels.buffer,n*r*x*o,n*r)),y=e.byteLength-t.ptr,d={},P=0,P++,b=(I=(c=new DataView(e,t.ptr,Math.min(10,y))).getUint8(0))>>6&255,(I>>2&15)!=(A*s>>3&15))throw"integrity issue";if(3<(m=3&I))throw t.ptr+=P,"Invalid block encoding ("+m+")";if(2!=m)if(0==m){if(t.counter.uncompressed++,t.ptr+=P,D=(D=w*k*o)<(T=e.byteLength-t.ptr)?D:T,g=new ArrayBuffer(D%o==0?D:D+o-D%o),new Uint8Array(g).set(new Uint8Array(e,t.ptr,D)),h=new i(g),S=0,O)for(M=0;M<w;M++){for(V=0;V<k;V++)O[B]&&(R[B]=h[S++]),B++;B+=U}else for(M=0;M<w;M++){for(V=0;V<k;V++)R[B++]=h[S++];B+=U}t.ptr+=S*o}else if(g=L.getDataTypeUsed(l,b),p=L.getOnePixel(d,P,g,c),P+=L.getDataTypeSize(g),3==m)if(t.ptr+=P,t.counter.constantoffset++,O)for(M=0;M<w;M++){for(V=0;V<k;V++)O[B]&&(R[B]=p),B++;B+=U}else for(M=0;M<w;M++){for(V=0;V<k;V++)R[B++]=p;B+=U}else if(t.ptr+=P,L.decodeBits(e,t,E,p,x),P=0,O)for(M=0;M<w;M++){for(V=0;V<k;V++)O[B]&&(R[B]=E[P++]),B++;B+=U}else for(M=0;M<w;M++){for(V=0;V<k;V++)R[B++]=E[P++];B+=U}else t.counter.constant++,t.ptr+=P}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:L.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var t,i=e.headerInfo.zMax,a=e.headerInfo.numDims,n=e.headerInfo.height*e.headerInfo.width,r=n*a,s=0,l=0,o=e.pixels.resultMask;if(o)if(1<a)for(s=0;s<a;s++)for(t=s*n,l=0;l<n;l++)o[l]&&(e.pixels.resultPixels[t+l]=i);else for(l=0;l<n;l++)o[l]&&(e.pixels.resultPixels[l]=i);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(i);else for(l=0;l<r;l++)e.pixels.resultPixels[l]=i},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:default:t=Float32Array;break;case 7:t=Float64Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:default:t="F32";break;case 7:t="F64"}return t},isValidPixelValue:function(e,t){if(null==t)return!1;var i;switch(e){case 0:i=-128<=t&&t<=127;break;case 1:i=0<=t&&t<=255;break;case 2:i=-32768<=t&&t<=32767;break;case 3:i=0<=t&&t<=65536;break;case 4:i=-2147483648<=t&&t<=2147483647;break;case 5:i=0<=t&&t<=4294967296;break;case 6:i=-34027999387901484e22<=t&&t<=34027999387901484e22;break;case 7:i=5e-324<=t&&t<=17976931348623157e292;break;default:i=!1}return i},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var i=e;switch(e){case 2:case 4:i=e-t;break;case 3:case 5:i=e-2*t;break;case 6:i=0===t?e:1===t?2:1;break;case 7:i=0===t?e:e-2*t+1;break;default:i=e}return i},getOnePixel:function(e,t,i,a){var n=0;switch(i){case 0:n=a.getInt8(t);break;case 1:n=a.getUint8(t);break;case 2:n=a.getInt16(t,!0);break;case 3:n=a.getUint16(t,!0);break;case 4:n=a.getInt32(t,!0);break;case 5:n=a.getUInt32(t,!0);break;case 6:n=a.getFloat32(t,!0);break;case 7:n=a.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return n}},v=function(e,t,i){this.val=e,this.left=t,this.right=i},{decode:function(e,t){var i=(t=t||{}).noDataValue,a=0,n={};n.ptr=t.inputOffset||0,n.pixels={},L.readHeaderInfo(e,n);var r=n.headerInfo,s=r.fileVersion,l=L.getDataTypeArray(r.imageType);L.readMask(e,n),r.numValidPixel===r.width*r.height||n.pixels.resultMask||(n.pixels.resultMask=t.maskData);var o,f=r.width*r.height;if(n.pixels.resultPixels=new l(f*r.numDims),n.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==r.numValidPixel)if(r.zMax===r.zMin)L.constructConstantSurface(n);else if(4<=s&&L.checkMinMaxRanges(e,n))L.constructConstantSurface(n);else{var u=new DataView(e,n.ptr,2),c=u.getUint8(0);if(n.ptr++,c)L.readDataOneSweep(e,n,l);else if(1<s&&r.imageType<=1&&Math.abs(r.maxZError-.5)<1e-5){u=u.getUint8(1);if(n.ptr++,2<(n.encodeMode=u)||s<4&&1<u)throw"Invalid Huffman flag "+u;u?L.readHuffman(e,n,l):L.readTiles(e,n,l)}else L.readTiles(e,n,l)}n.eofOffset=n.ptr,t.inputOffset?(o=n.headerInfo.blobSize+t.inputOffset-n.ptr,1<=Math.abs(o)&&(n.eofOffset=t.inputOffset+n.headerInfo.blobSize)):(o=n.headerInfo.blobSize-n.ptr,1<=Math.abs(o)&&(n.eofOffset=n.headerInfo.blobSize));var d={width:r.width,height:r.height,pixelData:n.pixels.resultPixels,minValue:r.zMin,maxValue:r.zMax,validPixelCount:r.numValidPixel,dimCount:r.numDims,dimStats:{minValues:r.minValues,maxValues:r.maxValues},maskData:n.pixels.resultMask};if(n.pixels.resultMask&&L.isValidPixelValue(r.imageType,i)){for(var h=n.pixels.resultMask,a=0;a<f;a++)h[a]||(d.pixelData[a]=i);d.noDataValue=i}return n.noDataValue=i,t.returnFileInfo&&(d.fileInfo=L.formatFileInfo(n)),d},getBandCount:function(e){for(var t=0,i=0,a={ptr:0,pixels:{}};i<e.byteLength-58;)L.readHeaderInfo(e,a),i+=a.headerInfo.blobSize,t++,a.ptr=i;return t}}),k=(e=new ArrayBuffer(4),t=new Uint8Array(e),(new Uint32Array(e)[0]=1)===t[0]),t={decode:function(e,t){if(!k)throw"Big endian system is not supported.";var i,a,n=(t=t||{}).inputOffset||0,r=new Uint8Array(e,n,10),r=String.fromCharCode.apply(null,r);if("CntZImage"===r.trim())i=x,a=1;else{if("Lerc2"!==r.substring(0,5))throw"Unexpected file identifier string: "+r;i=w,a=2}for(var s,l,o,f,u,c,d=0,h=e.byteLength-10,m=[],g={width:0,height:0,pixels:[],pixelType:t.pixelType,mask:null,statistics:[]};n<h;){var p=i.decode(e,{inputOffset:n,encodedMaskData:s,maskData:o,returnMask:0===d,returnEncodedMask:0===d,returnFileInfo:!0,pixelType:t.pixelType||null,noDataValue:t.noDataValue||null}),n=p.fileInfo.eofOffset;0===d&&(s=p.encodedMaskData,o=p.maskData,g.width=p.width,g.height=p.height,g.dimCount=p.dimCount||1,g.pixelType=p.pixelType||p.fileInfo.pixelType,g.mask=p.maskData),1<a&&p.fileInfo.mask&&0<p.fileInfo.mask.numBytes&&m.push(p.maskData),d++,g.pixels.push(p.pixelData),g.statistics.push({minValue:p.minValue,maxValue:p.maxValue,noDataValue:p.noDataValue,dimStats:p.dimStats})}if(1<a&&1<m.length){for(c=g.width*g.height,g.bandMasks=m,(o=new Uint8Array(c)).set(m[0]),f=1;f<m.length;f++)for(l=m[f],u=0;u<c;u++)o[u]=o[u]&l[u];g.maskData=o}return g}};i.exports?i.exports=t:this.Lerc=t}()});return t(function(t,e){if(t.encoding===f.LERC){let e;try{e=u.decode(t.heightmap)}catch(e){throw new n.RuntimeError(e)}if(e.statistics[0].minValue===Number.MAX_VALUE)throw new n.RuntimeError("Invalid tile data");t.heightmap=e.pixels[0],t.width=e.width,t.height=e.height}t.ellipsoid=xe.Ellipsoid.clone(t.ellipsoid),t.rectangle=xe.Rectangle.clone(t.rectangle);var i=Me.computeVertices(t),a=i.vertices;return e.push(a.buffer),{vertices:a.buffer,numberOfAttributes:i.encoding.stride,minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight,gridWidth:t.width,gridHeight:t.height,boundingSphere3D:i.boundingSphere3D,orientedBoundingBox:i.orientedBoundingBox,occludeePointInScaledSpace:i.occludeePointInScaledSpace,encoding:i.encoding,westIndicesSouthToNorth:i.westIndicesSouthToNorth,southIndicesEastToWest:i.southIndicesEastToWest,eastIndicesNorthToSouth:i.eastIndicesNorthToSouth,northIndicesWestToEast:i.northIndicesWestToEast}})});