define(["./AttributeCompression-27507afe","./Matrix2-37e55508","./Color-1ca27bfa","./defaultValue-81eec7ed","./IndexDatatype-f1dcdf35","./ComponentDatatype-a15c9a19","./OrientedBoundingBox-86a6888d","./createTaskProcessorWorker","./RuntimeError-8952249c","./Transforms-dca21951","./_commonjsHelpers-3aae1032-26891ab7","./combine-3c023bda","./WebGLConstants-508b9636","./EllipsoidTangentPlane-06e319ef","./AxisAlignedBoundingBox-0ddf9b79","./IntersectionTests-ee135b8e","./Plane-6ee42cab"],function(H,W,j,z,Z,q,J,e,t,n,a,r,o,i,s,c,f){"use strict";const K=new W.Cartesian3,Q=new W.Ellipsoid,X=new W.Rectangle,$={min:void 0,max:void 0,indexBytesPerElement:void 0};const ee=new W.Cartesian3,te=new W.Cartesian3,ne=new W.Cartesian3,ae=new W.Cartesian3,re=new W.Cartesian3,oe=new W.Cartographic,ie=new W.Rectangle;return e(function(e,f){let d;var t,n;t=e.packedBuffer,n=new Float64Array(t),t=0,$.indexBytesPerElement=n[t++],$.min=n[t++],$.max=n[t++],W.Cartesian3.unpack(n,3,K),t+=W.Cartesian3.packedLength,W.Ellipsoid.unpack(n,t,Q),t+=W.Ellipsoid.packedLength,W.Rectangle.unpack(n,t,X),d=new(2===$.indexBytesPerElement?Uint16Array:Uint32Array)(e.indices);const a=new Uint16Array(e.positions),l=new Uint32Array(e.counts),u=new Uint32Array(e.indexCounts),h=new Uint32Array(e.batchIds),g=new Uint32Array(e.batchTableColors),p=new Array(l.length),b=K,m=Q;let y=X;var C=$.min,I=$.max;let x,w,A,E=e.minimumHeights,N=e.maximumHeights;z.defined(E)&&z.defined(N)&&(E=new Float32Array(E),N=new Float32Array(N));const r=a.length/2,T=a.subarray(0,r),B=a.subarray(r,2*r);H.AttributeCompression.zigZagDeltaDecode(T,B);var k=new Float64Array(3*r);for(x=0;x<r;++x){const H=T[x],j=B[x],z=q.CesiumMath.lerp(y.west,y.east,H/32767),Z=q.CesiumMath.lerp(y.south,y.north,j/32767),J=W.Cartographic.fromRadians(z,Z,0,oe),Y=m.cartographicToCartesian(J,ee);W.Cartesian3.pack(Y,k,3*x)}const o=l.length,L=new Array(o),O=new Array(o);let i=0,s=0;for(x=0;x<o;++x)L[x]=i,O[x]=s,i+=l[x],s+=u[x];const U=new Float32Array(3*r*2),P=new Uint16Array(2*r),v=new Uint32Array(O.length),F=new Uint32Array(u.length);let S=[];const D={};for(x=0;x<o;++x)A=g[x],z.defined(D[A])?(D[A].positionLength+=l[x],D[A].indexLength+=u[x],D[A].batchIds.push(x)):D[A]={positionLength:l[x],indexLength:u[x],offset:0,indexOffset:0,batchIds:[x]};let R,c=0,_=0;for(A in D)if(D.hasOwnProperty(A)){R=D[A],R.offset=c,R.indexOffset=_;const H=2*R.positionLength,W=2*R.indexLength+6*R.positionLength;c+=H,_+=W,R.indexLength=W}const M=[];for(A in D)D.hasOwnProperty(A)&&(R=D[A],M.push({color:j.Color.fromRgba(parseInt(A)),offset:R.indexOffset,count:R.indexLength,batchIds:R.batchIds}));for(x=0;x<o;++x){A=g[x],R=D[A];const H=R.offset;let e=3*H,t=H;const q=L[x],Y=l[x],f=h[x];let n=C,a=I;z.defined(E)&&z.defined(N)&&(n=E[x],a=N[x]);let r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(w=0;w<Y;++w){const H=W.Cartesian3.unpack(k,3*q+3*w,ee);m.scaleToGeodeticSurface(H,H);const z=m.cartesianToCartographic(H,oe),J=z.latitude,Y=z.longitude;r=Math.min(J,r),o=Math.max(J,o),i=Math.min(Y,i),s=Math.max(Y,s);const d=m.geodeticSurfaceNormal(H,te);var G=W.Cartesian3.multiplyByScalar(d,n,ne);const u=W.Cartesian3.add(H,G,ae);G=W.Cartesian3.multiplyByScalar(d,a,G);const h=W.Cartesian3.add(H,G,re);W.Cartesian3.subtract(h,b,h),W.Cartesian3.subtract(u,b,u),W.Cartesian3.pack(h,U,e),W.Cartesian3.pack(u,U,e+3),P[t]=f,P[t+1]=f,e+=6,t+=2}y=ie,y.west=i,y.east=s,y.south=r,y.north=o,p[x]=J.OrientedBoundingBox.fromRectangle(y,C,I,m);let c=R.indexOffset;const T=O[x],B=u[x];for(v[x]=c,w=0;w<B;w+=3){const W=d[T+w]-q,j=d[T+w+1]-q,z=d[T+w+2]-q;S[c++]=2*W+H,S[c++]=2*j+H,S[c++]=2*z+H,S[c++]=2*z+1+H,S[c++]=2*j+1+H,S[c++]=2*W+1+H}for(w=0;w<Y;++w){const W=w,j=(w+1)%Y;S[c++]=2*W+1+H,S[c++]=2*j+H,S[c++]=2*W+H,S[c++]=2*W+1+H,S[c++]=2*j+1+H,S[c++]=2*j+H}R.offset+=2*Y,R.indexOffset=c,F[x]=c-v[x]}S=Z.IndexDatatype.createTypedArray(U.length/3,S);var V=M.length;for(let e=0;e<V;++e){const W=M[e].batchIds;let t=0;const z=W.length;for(let e=0;e<z;++e)t+=F[W[e]];M[e].count=t}e=function(e,t,n){const a=t.length,r=2+a*J.OrientedBoundingBox.packedLength+1+function(t){var n=t.length;let a=0;for(let e=0;e<n;++e)a+=j.Color.packedLength+3+t[e].batchIds.length;return a}(n),o=new Float64Array(r);let i=0;o[i++]=e,o[i++]=a;for(let e=0;e<a;++e)J.OrientedBoundingBox.pack(t[e],o,i),i+=J.OrientedBoundingBox.packedLength;var s=n.length;o[i++]=s;for(let e=0;e<s;++e){const t=n[e];j.Color.pack(t.color,o,i),i+=j.Color.packedLength,o[i++]=t.offset,o[i++]=t.count;const a=t.batchIds,r=a.length;o[i++]=r;for(let e=0;e<r;++e)o[i++]=a[e]}return o}(2===S.BYTES_PER_ELEMENT?Z.IndexDatatype.UNSIGNED_SHORT:Z.IndexDatatype.UNSIGNED_INT,p,M);return f.push(U.buffer,S.buffer,v.buffer,F.buffer,P.buffer,e.buffer),{positions:U.buffer,indices:S.buffer,indexOffsets:v.buffer,indexCounts:F.buffer,batchIds:P.buffer,packedBuffer:e.buffer}})});