define(["./AxisAlignedBoundingBox-0ddf9b79","./Matrix2-37e55508","./defaultValue-81eec7ed","./TerrainEncoding-48ceaaca","./IndexDatatype-f1dcdf35","./ComponentDatatype-a15c9a19","./RuntimeError-8952249c","./Transforms-dca21951","./WebMercatorProjection-2839e524","./createTaskProcessorWorker","./AttributeCompression-27507afe","./WebGLConstants-508b9636","./_commonjsHelpers-3aae1032-26891ab7","./combine-3c023bda"],function(re,ne,oe,ie,ae,se,e,ce,de,t,r,n,o,i){"use strict";function he(){e.DeveloperError.throwInstantiationError()}Object.defineProperties(he.prototype,{errorEvent:{get:e.DeveloperError.throwInstantiationError},credit:{get:e.DeveloperError.throwInstantiationError},tilingScheme:{get:e.DeveloperError.throwInstantiationError},ready:{get:e.DeveloperError.throwInstantiationError},readyPromise:{get:e.DeveloperError.throwInstantiationError},hasWaterMask:{get:e.DeveloperError.throwInstantiationError},hasVertexNormals:{get:e.DeveloperError.throwInstantiationError},availability:{get:e.DeveloperError.throwInstantiationError}});const a=[];he.getRegularGridIndices=function(e,t){let r=a[e];oe.defined(r)||(a[e]=r=[]);let n=r[t];return oe.defined(n)||(n=e*t<se.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),T(e,t,n,0)),n};const d=[];he.getRegularGridIndicesAndEdgeIndices=function(e,t){let r=d[e];oe.defined(r)||(d[e]=r=[]);let n=r[t];if(!oe.defined(n)){const oe=he.getRegularGridIndices(e,t),o=m(e,t),i=o.westIndicesSouthToNorth,a=o.southIndicesEastToWest,s=o.eastIndicesNorthToSouth,c=o.northIndicesWestToEast;n=r[t]={indices:oe,westIndicesSouthToNorth:i,southIndicesEastToWest:a,eastIndicesNorthToSouth:s,northIndicesWestToEast:c}}return n};const g=[];function m(e,t){const r=new Array(t),n=new Array(e),o=new Array(t),i=new Array(e);let a;for(a=0;a<e;++a)i[a]=a,n[a]=e*t-1-a;for(a=0;a<t;++a)o[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:i}}function T(t,r,n,o){let i=0;for(let e=0;e<r-1;++e){for(let e=0;e<t-1;++e){const r=i,a=r+t,s=a+1,c=r+1;n[o++]=r,n[o++]=a,n[o++]=c,n[o++]=c,n[o++]=a,n[o++]=s,++i}++i}}function s(t,r,n,o){let i=t[0];const a=t.length;for(let e=1;e<a;++e){const a=t[e];n[o++]=i,n[o++]=a,n[o++]=r,n[o++]=r,n[o++]=a,n[o++]=r+1,i=a,++r}return o}he.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){let r=g[e];oe.defined(r)||(g[e]=r=[]);let n=r[t];if(!oe.defined(n)){const oe=e*t,o=(e-1)*(t-1)*6,i=2*e+2*t,a=oe+i,s=o+6*Math.max(0,i-4),c=m(e,t),d=c.westIndicesSouthToNorth,h=c.southIndicesEastToWest,u=c.eastIndicesNorthToSouth,l=c.northIndicesWestToEast,I=ae.IndexDatatype.createTypedArray(a,s);T(e,t,I,0),he.addSkirtIndices(d,h,u,l,oe,I,o),n=r[t]={indices:I,westIndicesSouthToNorth:d,southIndicesEastToWest:h,eastIndicesNorthToSouth:u,northIndicesWestToEast:l,indexCountWithoutSkirts:o}}return n},he.addSkirtIndices=function(e,t,r,n,o,i,a){a=s(e,o,i,a),a=s(t,o+=e.length,i,a),a=s(r,o+=t.length,i,a),s(n,o+=r.length,i,a)},he.heightmapTerrainQuality=.25,he.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*he.heightmapTerrainQuality/(t*r)},he.prototype.requestTileGeometry=e.DeveloperError.throwInstantiationError,he.prototype.getLevelMaximumGeometricError=e.DeveloperError.throwInstantiationError,he.prototype.getTileDataAvailable=e.DeveloperError.throwInstantiationError,he.prototype.loadTileDataAvailability=e.DeveloperError.throwInstantiationError;const ue=32767,le=new ne.Cartesian3,Ie=new ne.Cartesian3,ge=new ne.Cartesian3,me=new ne.Cartographic,Te=new ne.Cartesian2;function Ee(t,r,n,o,e,i,a,s,c){let d=Number.POSITIVE_INFINITY;var h=e.north,u=e.south;let l=e.east;var I=e.west;l<I&&(l+=se.CesiumMath.TWO_PI);const g=t.length;for(let e=0;e<g;++e){const g=t[e],T=n[g],E=o[g];me.longitude=se.CesiumMath.lerp(I,l,E.x),me.latitude=se.CesiumMath.lerp(u,h,E.y),me.height=T-r;var m=i.cartographicToCartesian(me,le);ne.Matrix4.multiplyByPoint(a,m,m),ne.Cartesian3.minimumByComponent(m,s,s),ne.Cartesian3.maximumByComponent(m,c,c),d=Math.min(d,me.height)}return d}function fe(n,o,i,a,s,c,d,h,u,l,I,g,m,T){var E=oe.defined(d),f=u.north,p=u.south;let y=u.east;var N=u.west;y<N&&(y+=se.CesiumMath.TWO_PI);const w=i.length;for(let r=0;r<w;++r){const u=i[r],w=s[u],M=c[u];me.longitude=se.CesiumMath.lerp(N,y,M.x)+m,me.latitude=se.CesiumMath.lerp(p,f,M.y)+T,me.height=w-l;var S=h.cartographicToCartesian(me,le);if(E){const n=2*u;Te.x=d[n],Te.y=d[1+n]}let e,t;a.hasWebMercatorT&&(e=(de.WebMercatorProjection.geodeticLatitudeToMercatorAngle(me.latitude)-I)*g),a.hasGeodeticSurfaceNormals&&(t=h.geodeticSurfaceNormal(S)),o=a.encode(n,o,S,M,me.height,Te,e,t)}}function pe(e,t){let r;return"function"==typeof e.slice&&(r=e.slice(),"function"!=typeof r.sort&&(r=void 0)),oe.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return t(function(t,r){const e=t.quantizedVertices,n=e.length/3,o=t.octEncodedNormals,i=t.westIndices.length+t.eastIndices.length+t.southIndices.length+t.northIndices.length,a=t.includeWebMercatorT,s=t.exaggeration,c=t.exaggerationRelativeHeight,d=1!==s,h=ne.Rectangle.clone(t.rectangle),u=h.west,l=h.south,I=h.east,g=h.north,m=ne.Ellipsoid.clone(t.ellipsoid),T=t.minimumHeight,E=t.maximumHeight,f=t.relativeToCenter,p=ce.Transforms.eastNorthUpToFixedFrame(f,m),y=ne.Matrix4.inverseTransformation(p,new ne.Matrix4);let N,w;a&&(N=de.WebMercatorProjection.geodeticLatitudeToMercatorAngle(l),w=1/(de.WebMercatorProjection.geodeticLatitudeToMercatorAngle(g)-N));const S=e.subarray(0,n),M=e.subarray(n,2*n),x=e.subarray(2*n,3*n),b=oe.defined(o),A=new Array(n),v=new Array(n),C=new Array(n),W=a?new Array(n):[],P=d?new Array(n):[],D=Ie;D.x=Number.POSITIVE_INFINITY,D.y=Number.POSITIVE_INFINITY,D.z=Number.POSITIVE_INFINITY;const k=ge;k.x=Number.NEGATIVE_INFINITY,k.y=Number.NEGATIVE_INFINITY,k.z=Number.NEGATIVE_INFINITY;let F=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,_=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY;for(let e=0;e<n;++e){const oe=S[e],ie=M[e],ae=oe/ue,t=ie/ue,ce=se.CesiumMath.lerp(T,E,x[e]/ue);me.longitude=se.CesiumMath.lerp(u,I,ae),me.latitude=se.CesiumMath.lerp(l,g,t),me.height=ce,F=Math.min(me.longitude,F),H=Math.max(me.longitude,H),_=Math.min(me.latitude,_),G=Math.max(me.latitude,G);const r=m.cartographicToCartesian(me);A[e]=new ne.Cartesian2(ae,t),v[e]=ce,C[e]=r,a&&(W[e]=(de.WebMercatorProjection.geodeticLatitudeToMercatorAngle(me.latitude)-N)*w),d&&(P[e]=m.geodeticSurfaceNormal(r)),ne.Matrix4.multiplyByPoint(y,r,le),ne.Cartesian3.minimumByComponent(le,D,D),ne.Cartesian3.maximumByComponent(le,k,k)}var V=pe(t.westIndices,function(e,t){return A[e].y-A[t].y}),Y=pe(t.eastIndices,function(e,t){return A[t].y-A[e].y}),O=pe(t.southIndices,function(e,t){return A[t].x-A[e].x}),B=pe(t.northIndices,function(e,t){return A[e].x-A[t].x});let R;T<0&&(R=new ie.EllipsoidalOccluder(m).computeHorizonCullingPointPossiblyUnderEllipsoid(f,C,T));var L=Math.min(T,Ee(t.westIndices,t.westSkirtHeight,v,A,h,m,y,D,k));L=Math.min(L,Ee(t.southIndices,t.southSkirtHeight,v,A,h,m,y,D,k)),L=Math.min(L,Ee(t.eastIndices,t.eastSkirtHeight,v,A,h,m,y,D,k)),L=Math.min(L,Ee(t.northIndices,t.northSkirtHeight,v,A,h,m,y,D,k));const j=new re.AxisAlignedBoundingBox(D,k,f),U=new ie.TerrainEncoding(f,j,L,E,p,b,a,d,s,c),z=U.stride,q=new Float32Array(n*z+i*z);let Q=0;for(let e=0;e<n;++e){if(b){const ne=2*e;Te.x=o[ne],Te.y=o[1+ne]}Q=U.encode(q,Q,C[e],A[e],v[e],Te,W[e],P[e])}const K=Math.max(0,2*(i-4)),X=t.indices.length+3*K,Z=ae.IndexDatatype.createTypedArray(n+i,X);Z.set(t.indices,0);var J=1e-4*(H-F),$=1e-4*(G-_),ee=J,te=$,L=-$,$=n*z;return fe(q,$,V,U,v,A,o,m,h,t.westSkirtHeight,N,w,-J,0),fe(q,$+=t.westIndices.length*z,O,U,v,A,o,m,h,t.southSkirtHeight,N,w,0,L),fe(q,$+=t.southIndices.length*z,Y,U,v,A,o,m,h,t.eastSkirtHeight,N,w,ee,0),fe(q,$+=t.eastIndices.length*z,B,U,v,A,o,m,h,t.northSkirtHeight,N,w,0,te),he.addSkirtIndices(V,O,Y,B,n,Z,t.indices.length),r.push(q.buffer,Z.buffer),{vertices:q.buffer,indices:Z.buffer,westIndicesSouthToNorth:V,southIndicesEastToWest:O,eastIndicesNorthToSouth:Y,northIndicesWestToEast:B,vertexStride:z,center:f,minimumHeight:T,maximumHeight:E,occludeePointInScaledSpace:R,encoding:U,indexCountWithoutSkirts:t.indices.length}})});