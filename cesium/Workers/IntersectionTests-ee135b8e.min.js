define(["exports","./Matrix2-37e55508","./defaultValue-81eec7ed","./RuntimeError-8952249c","./Transforms-dca21951","./ComponentDatatype-a15c9a19"],function(t,S,O,a,l,x){"use strict";const y={};function s(t,a,e){var n=t+a;return x.CesiumMath.sign(t)!==x.CesiumMath.sign(a)&&Math.abs(n/Math.max(Math.abs(t),Math.abs(a)))<e?0:n}y.computeDiscriminant=function(t,a,e){return a*a-4*t*e},y.computeRealRoots=function(t,a,e){let n;if(0===t)return 0===a?[]:[-e/a];if(0===a){if(0===e)return[0,0];const a=Math.abs(e),i=Math.abs(t);if(a<i&&a/i<x.CesiumMath.EPSILON14)return[0,0];if(a>i&&i/a<x.CesiumMath.EPSILON14)return[];if(n=-e/t,n<0)return[];const r=Math.sqrt(n);return[-r,r]}if(0===e)return n=-a/t,n<0?[n,0]:[0,n];const i=s(a*a,-4*t*e,x.CesiumMath.EPSILON14);if(i<0)return[];const r=-.5*s(a,x.CesiumMath.sign(a)*Math.sqrt(i),x.CesiumMath.EPSILON14);return 0<a?[r/t,e/r]:[e/r,r/t]};const R={};function o(n,i,r,s){var o=n,u=i/3,c=r/3,l=s,C=o*c,M=u*l,h=u*u,m=c*c,n=o*c-h,i=o*l-u*c,r=u*l-m,s=4*n*r-i*i;let d,f;if(s<0){let t,a,e;e=C*m<=h*M?(t=o,-2*u*(a=n)+o*i):-(t=l)*i+2*c*(a=r);const S=-(e<0?-1:1)*Math.abs(t)*Math.sqrt(-s);f=-e+S;const g=f/2,p=g<0?-Math.pow(-g,1/3):Math.pow(g,1/3),w=f===S?-p:-a/p;return d=a<=0?p+w:-e/(p*p+w*w+a),C*m<=h*M?[(d-u)/o]:[-l/(d+c)]}const g=n,p=-2*u*n+o*i,w=r,t=-l*i+2*c*r,a=Math.sqrt(s),e=Math.sqrt(3)/2;M=Math.abs(Math.atan2(o*a,-p)/3);d=2*Math.sqrt(-g);n=Math.cos(M);f=d*n;let R=d*(-n/2-e*Math.sin(M));i=f+R>2*u?f-u:R-u,r=o,s=i/r,M=Math.abs(Math.atan2(l*a,-t)/3);d=2*Math.sqrt(-w),n=Math.cos(M),f=d*n,R=d*(-n/2-e*Math.sin(M));o=-l,n=f+R<2*c?f+c:R+c,M=o/n,l=-i*n-r*o,c=(c*l-i*o*u)/(-u*l+r*n*c);return s<=c?s<=M?c<=M?[s,c,M]:[s,M,c]:[M,s,c]:s<=M?[c,s,M]:c<=M?[c,M,s]:[M,c,s]}R.computeDiscriminant=function(t,a,e,n){var i=a*a,r=e*e;return 18*t*a*e*n+i*r-t*t*27*(n*n)-4*(t*r*e+i*a*n)},R.computeRealRoots=function(t,a,e,n){let i,r;if(0===t)return y.computeRealRoots(a,e,n);if(0!==a)return 0===e?0===n?(r=-a/t,r<0?[r,0,0]:[0,0,r]):o(t,a,0,n):0===n?(i=y.computeRealRoots(t,a,e),0===i.length?[0]:i[1]<=0?[i[0],i[1],0]:0<=i[0]?[0,i[0],i[1]]:[i[0],0,i[1]]):o(t,a,e,n);if(0!==e)return 0===n?(i=y.computeRealRoots(t,0,e),0===i.Length?[0]:[i[0],0,i[1]]):o(t,0,e,n);{if(0===n)return[0,0,0];r=-n/t;const a=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);return[a,a,a]}};const P={};function e(t,a){a=S.Cartesian3.clone(O.defaultValue(a,S.Cartesian3.ZERO)),S.Cartesian3.equals(a,S.Cartesian3.ZERO)||S.Cartesian3.normalize(a,a),this.origin=S.Cartesian3.clone(O.defaultValue(t,S.Cartesian3.ZERO)),this.direction=a}P.computeDiscriminant=function(t,a,e,n,i){var r=t*t,s=a*a,o=s*a,u=e*e,c=u*e,l=n*n,C=l*n,M=i*i;return s*u*l-4*o*C-4*t*c*l+18*t*a*e*C-27*r*l*l+r*t*256*(M*i)+i*(18*o*e*n-4*s*c+16*t*u*u-80*t*a*u*n-6*t*s*l+144*r*e*l)+M*(144*t*s*e-27*s*s-128*r*u-192*r*a*n)},P.computeRealRoots=function(t,a,e,n,i){if(Math.abs(t)<x.CesiumMath.EPSILON15)return R.computeRealRoots(a,e,n,i);var r=a/t,s=e/t,o=n/t,u=i/t;let c=r<0?1:0;switch(c+=s<0?c+1:c,c+=o<0?c+1:c,c+=u<0?c+1:c,c){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return function(a,e,n,i){const r=a*a,t=e-3*r/8,s=n-e*a/2+r*a/8,o=i-n*a/4+e*r/16-3*r*r/256,u=R.computeRealRoots(1,2*t,t*t-4*o,-s*s);if(0<u.length){const e=-a/4,n=u[u.length-1];if(Math.abs(n)<x.CesiumMath.EPSILON14){const a=y.computeRealRoots(1,t,o);if(2===a.length){const n=a[0],i=a[1];let t;if(0<=n&&0<=i){const a=Math.sqrt(n),r=Math.sqrt(i);return[e-r,e-a,e+a,e+r]}if(0<=n&&i<0)return t=Math.sqrt(n),[e-t,e+t];if(n<0&&0<=i)return t=Math.sqrt(i),[e-t,e+t]}return[]}if(0<n){const a=Math.sqrt(n),i=(t+n-s/a)/2,r=(t+n+s/a)/2,x=y.computeRealRoots(1,a,i),R=y.computeRealRoots(1,-a,r);return 0!==x.length?(x[0]+=e,x[1]+=e,0!==R.length?(R[0]+=e,R[1]+=e,x[1]<=R[0]?[x[0],x[1],R[0],R[1]]:R[1]<=x[0]?[R[0],R[1],x[0],x[1]]:x[0]>=R[0]&&x[1]<=R[1]?[R[0],x[0],x[1],R[1]]:R[0]>=x[0]&&R[1]<=x[1]?[x[0],R[0],R[1],x[1]]:x[0]>R[0]&&x[0]<R[1]?[R[0],x[0],R[1],x[1]]:[x[0],R[0],x[1],R[1]]):x):0!==R.length?(R[0]+=e,R[1]+=e,R):[]}}return[]}(r,s,o,u);case 1:case 2:case 5:case 8:case 11:return function(s,o,u,c){const l=s*s,C=-2*o,M=u*s+o*o-4*c,h=l*c-u*o*s+u*u,m=R.computeRealRoots(1,C,M,h);if(0<m.length){const C=m[0],R=o-C,M=R*R,h=s/2,d=R/2,f=M-4*c,g=M+4*Math.abs(c),p=l-4*C,w=l+4*Math.abs(C);let t,a,e,n,i,r;if(C<0||f*w<p*g){const o=Math.sqrt(p);t=o/2,a=0===o?0:(s*d-u)/o}else{const o=Math.sqrt(f);t=0===o?0:(s*d-u)/o,a=o/2}0==h&&0===t?(e=0,n=0):x.CesiumMath.sign(h)===x.CesiumMath.sign(t)?(e=h+t,n=C/e):(n=h-t,e=C/n),0==d&&0===a?(i=0,r=0):x.CesiumMath.sign(d)===x.CesiumMath.sign(a)?(i=d+a,r=c/i):(r=d-a,i=c/r);u=y.computeRealRoots(1,e,i),c=y.computeRealRoots(1,n,r);if(0!==u.length)return 0!==c.length?u[1]<=c[0]?[u[0],u[1],c[0],c[1]]:c[1]<=u[0]?[c[0],c[1],u[0],u[1]]:u[0]>=c[0]&&u[1]<=c[1]?[c[0],u[0],u[1],c[1]]:c[0]>=u[0]&&c[1]<=u[1]?[u[0],c[0],c[1],u[1]]:u[0]>c[0]&&u[0]<c[1]?[c[0],u[0],c[1],u[1]]:[u[0],c[0],u[1],c[1]]:u;if(0!==c.length)return c}return[]}(r,s,o,u);default:return}},e.clone=function(t,a){if(O.defined(t))return O.defined(a)?(a.origin=S.Cartesian3.clone(t.origin),a.direction=S.Cartesian3.clone(t.direction),a):new e(t.origin,t.direction)},e.getPoint=function(t,a,e){return O.defined(e)||(e=new S.Cartesian3),e=S.Cartesian3.multiplyByScalar(t.direction,a,e),S.Cartesian3.add(t.origin,e,e)};const C={rayPlane:function(t,a,e){O.defined(e)||(e=new S.Cartesian3);var n=t.origin,i=t.direction,r=a.normal,t=S.Cartesian3.dot(r,i);if(!(Math.abs(t)<x.CesiumMath.EPSILON15)){t=(-a.distance-S.Cartesian3.dot(r,n))/t;return t<0?void 0:(e=S.Cartesian3.multiplyByScalar(i,t,e),S.Cartesian3.add(n,e,e))}}},m=new S.Cartesian3,d=new S.Cartesian3,f=new S.Cartesian3,g=new S.Cartesian3,p=new S.Cartesian3;C.rayTriangleParametric=function(t,a,e,n,i){i=O.defaultValue(i,!1);var r=t.origin,s=t.direction,o=S.Cartesian3.subtract(e,a,m),t=S.Cartesian3.subtract(n,a,d),e=S.Cartesian3.cross(s,t,f),n=S.Cartesian3.dot(o,e);let u,c,l,C,M;if(i){if(n<x.CesiumMath.EPSILON6)return;if(u=S.Cartesian3.subtract(r,a,g),l=S.Cartesian3.dot(u,e),l<0||l>n)return;if(c=S.Cartesian3.cross(u,o,p),C=S.Cartesian3.dot(s,c),C<0||l+C>n)return;M=S.Cartesian3.dot(t,c)/n}else{if(Math.abs(n)<x.CesiumMath.EPSILON6)return;const h=1/n;if(u=S.Cartesian3.subtract(r,a,g),l=S.Cartesian3.dot(u,e)*h,l<0||1<l)return;if(c=S.Cartesian3.cross(u,o,p),C=S.Cartesian3.dot(s,c)*h,C<0||1<l+C)return;M=S.Cartesian3.dot(t,c)*h}return M},C.rayTriangle=function(t,a,e,n,i,r){i=C.rayTriangleParametric(t,a,e,n,i);if(O.defined(i)&&!(i<0))return O.defined(r)||(r=new S.Cartesian3),S.Cartesian3.multiplyByScalar(t.direction,i,r),S.Cartesian3.add(t.origin,r,r)};const u=new e;C.lineSegmentTriangle=function(t,a,e,n,i,r,s){var o=u;S.Cartesian3.clone(t,o.origin),S.Cartesian3.subtract(a,t,o.direction),S.Cartesian3.normalize(o.direction,o.direction);r=C.rayTriangleParametric(o,e,n,i,r);if(!(!O.defined(r)||r<0||r>S.Cartesian3.distance(t,a)))return O.defined(s)||(s=new S.Cartesian3),S.Cartesian3.multiplyByScalar(o.direction,r,s),S.Cartesian3.add(o.origin,s,s)};const r={root0:0,root1:0};function c(t,a,e){O.defined(e)||(e=new l.Interval);var n=t.origin,i=t.direction,t=a.center,a=a.radius*a.radius,t=S.Cartesian3.subtract(n,t,f),a=function(t,a,e,n){e=a*a-4*t*e;if(!(e<0)){if(0<e){const r=1/(2*t),i=Math.sqrt(e),s=(-a+i)*r,o=(-a-i)*r;return s<o?(n.root0=s,n.root1=o):(n.root0=o,n.root1=s),n}const i=-a/(2*t);return 0!==i?(n.root0=n.root1=i,n):void 0}}(S.Cartesian3.dot(i,i),2*S.Cartesian3.dot(i,t),S.Cartesian3.magnitudeSquared(t)-a,r);if(O.defined(a))return e.start=a.root0,e.stop=a.root1,e}C.raySphere=function(t,a,e){if(e=c(t,a,e),O.defined(e)&&!(e.stop<0))return e.start=Math.max(e.start,0),e};const M=new e;C.lineSegmentSphere=function(t,a,e,n){var i=M;S.Cartesian3.clone(t,i.origin);a=S.Cartesian3.subtract(a,t,i.direction),t=S.Cartesian3.magnitude(a);if(S.Cartesian3.normalize(a,a),n=c(i,e,n),!(!O.defined(n)||n.stop<0||n.start>t))return n.start=Math.max(n.start,0),n.stop=Math.min(n.stop,t),n};const h=new S.Cartesian3,w=new S.Cartesian3;function v(t,a,e){var n=t+a;return x.CesiumMath.sign(t)!==x.CesiumMath.sign(a)&&Math.abs(n/Math.max(Math.abs(t),Math.abs(a)))<e?0:n}C.rayEllipsoid=function(t,a){var e=a.oneOverRadii,a=S.Cartesian3.multiplyComponents(e,t.origin,h),e=S.Cartesian3.multiplyComponents(e,t.direction,w),t=S.Cartesian3.magnitudeSquared(a),a=S.Cartesian3.dot(a,e);let n,i,r,s,o;if(1<t){if(0<=a)return;const u=a*a;if(n=t-1,i=S.Cartesian3.magnitudeSquared(e),r=i*n,u<r)return;if(u>r){s=a*a-r,o=-a+Math.sqrt(s);const u=o/i,S=n/o;return u<S?new l.Interval(u,S):{start:S,stop:u}}const c=Math.sqrt(n/i);return new l.Interval(c,c)}return t<1?(n=t-1,i=S.Cartesian3.magnitudeSquared(e),r=i*n,s=a*a-r,o=-a+Math.sqrt(s),new l.Interval(0,o/i)):a<0?(i=S.Cartesian3.magnitudeSquared(e),new l.Interval(0,-a/i)):void 0};const N=new S.Cartesian3,b=new S.Cartesian3,q=new S.Cartesian3,L=new S.Cartesian3,I=new S.Cartesian3,E=new S.Matrix3,z=new S.Matrix3,T=new S.Matrix3,U=new S.Matrix3,W=new S.Matrix3,B=new S.Matrix3,V=new S.Matrix3,Z=new S.Cartesian3,D=new S.Cartesian3,A=new S.Cartographic;C.grazingAltitudeLocation=function(t,n){var i=t.origin,r=t.direction;if(!S.Cartesian3.equals(i,S.Cartesian3.ZERO)){const R=n.geodeticSurfaceNormal(i,N);if(0<=S.Cartesian3.dot(r,R))return i}const s=O.defined(this.rayEllipsoid(t,n)),a=n.transformPositionToScaledSpace(r,N),e=S.Cartesian3.normalize(a,a),o=S.Cartesian3.mostOrthogonalAxis(a,L),u=S.Cartesian3.normalize(S.Cartesian3.cross(o,e,b),b),c=S.Cartesian3.normalize(S.Cartesian3.cross(e,u,q),q),l=E;l[0]=e.x,l[1]=e.y,l[2]=e.z,l[3]=u.x,l[4]=u.y,l[5]=u.z,l[6]=c.x,l[7]=c.y,l[8]=c.z;const C=S.Matrix3.transpose(l,z),M=S.Matrix3.fromScale(n.radii,T),h=S.Matrix3.fromScale(n.oneOverRadii,U),m=W;m[0]=0,m[1]=-r.z,m[2]=r.y,m[3]=r.z,m[4]=0,m[5]=-r.x,m[6]=-r.y,m[7]=r.x,m[8]=0;var d=S.Matrix3.multiply(S.Matrix3.multiply(C,h,B),m,B),t=S.Matrix3.multiply(S.Matrix3.multiply(d,M,V),l,V),d=S.Matrix3.multiplyByVector(d,i,I),f=function(t,a,e){const n=0,i=t[S.Matrix3.COLUMN1ROW1]-t[S.Matrix3.COLUMN2ROW2],r=+(0*v(t[S.Matrix3.COLUMN1ROW0],t[S.Matrix3.COLUMN0ROW1],x.CesiumMath.EPSILON15)+a.y),s=t[S.Matrix3.COLUMN0ROW0]*n+ +t[S.Matrix3.COLUMN2ROW2]+0*a.x+e,o=+v(t[S.Matrix3.COLUMN2ROW1],t[S.Matrix3.COLUMN1ROW2],x.CesiumMath.EPSILON15),u=+(0*v(t[S.Matrix3.COLUMN2ROW0],t[S.Matrix3.COLUMN0ROW2])+a.z);let c;const l=[];if(0==u&&0==o){if(c=y.computeRealRoots(i,r,s),0===c.length)return l;const m=c[0],d=Math.sqrt(Math.max(1-m*m,0));if(l.push(new S.Cartesian3(0,+m,-d)),l.push(new S.Cartesian3(0,+m,+d)),2===c.length){const m=c[1],d=Math.sqrt(Math.max(1-m*m,0));l.push(new S.Cartesian3(0,+m,-d)),l.push(new S.Cartesian3(0,+m,+d))}return l}var C=u*u,M=o*o,e=u*o,t=i*i+M,a=2*(r*i+e),M=2*s*i+r*r-M+C,e=2*(s*r-e),C=s*s-C;if(0==t&&0==a&&0==M&&0==e)return l;c=P.computeRealRoots(t,a,M,e,C);var h=c.length;if(0===h)return l;for(let t=0;t<h;++t){const d=c[t],f=d*d,y=Math.max(1-f,0),n=Math.sqrt(y);const P=(x.CesiumMath.sign(i)===x.CesiumMath.sign(s)?v(i*f+s,r*d,x.CesiumMath.EPSILON12):x.CesiumMath.sign(s)===x.CesiumMath.sign(r*d)?v(i*f,r*d+s,x.CesiumMath.EPSILON12):v(i*f+r*d,s,x.CesiumMath.EPSILON12))*v(o*d,u,x.CesiumMath.EPSILON15);P<0?l.push(new S.Cartesian3(0,+d,+n)):0<P?l.push(new S.Cartesian3(0,+d,-n)):0!==n?(l.push(new S.Cartesian3(0,+d,-n)),l.push(new S.Cartesian3(0,+d,+n)),++t):l.push(new S.Cartesian3(0,+d,+n))}return l}(t,S.Cartesian3.negate(d,N),0);let g,p;var w=f.length;if(0<w){let a=S.Cartesian3.clone(S.Cartesian3.ZERO,D),e=Number.NEGATIVE_INFINITY;for(let t=0;t<w;++t){g=S.Matrix3.multiplyByVector(M,S.Matrix3.multiplyByVector(l,f[t],Z),Z);const x=S.Cartesian3.normalize(S.Cartesian3.subtract(g,i,L),L),y=S.Cartesian3.dot(x,r);y>e&&(e=y,a=S.Cartesian3.clone(g,a))}const y=n.cartesianToCartographic(a,A);return e=x.CesiumMath.clamp(e,0,1),p=S.Cartesian3.magnitude(S.Cartesian3.subtract(a,i,L))*Math.sqrt(1-e*e),p=s?-p:p,y.height=p,n.cartographicToCartesian(y,new S.Cartesian3)}};const F=new S.Cartesian3;C.lineSegmentPlane=function(t,a,e,n){O.defined(n)||(n=new S.Cartesian3);var i=S.Cartesian3.subtract(a,t,F),r=e.normal,a=S.Cartesian3.dot(r,i);if(!(Math.abs(a)<x.CesiumMath.EPSILON6)){r=S.Cartesian3.dot(r,t),a=-(e.distance+r)/a;return a<0||1<a?void 0:(S.Cartesian3.multiplyByScalar(i,a,n),S.Cartesian3.add(t,n,n),n)}},C.trianglePlaneIntersection=function(t,a,e,n){var i=n.normal,r=n.distance,s=S.Cartesian3.dot(i,t)+r<0,o=S.Cartesian3.dot(i,a)+r<0,r=S.Cartesian3.dot(i,e)+r<0;let u,c,l=0;return l+=s?1:0,l+=o?1:0,1!=(l+=r?1:0)&&2!=l||(u=new S.Cartesian3,c=new S.Cartesian3),1==l?s?(C.lineSegmentPlane(t,a,n,u),C.lineSegmentPlane(t,e,n,c),{positions:[t,a,e,u,c],indices:[0,3,4,1,2,4,1,4,3]}):o?(C.lineSegmentPlane(a,e,n,u),C.lineSegmentPlane(a,t,n,c),{positions:[t,a,e,u,c],indices:[1,3,4,2,0,4,2,4,3]}):r?(C.lineSegmentPlane(e,t,n,u),C.lineSegmentPlane(e,a,n,c),{positions:[t,a,e,u,c],indices:[2,3,4,0,1,4,0,4,3]}):void 0:2==l?s?o?r?void 0:(C.lineSegmentPlane(t,e,n,u),C.lineSegmentPlane(a,e,n,c),{positions:[t,a,e,u,c],indices:[0,1,4,0,4,3,2,3,4]}):(C.lineSegmentPlane(e,a,n,u),C.lineSegmentPlane(t,a,n,c),{positions:[t,a,e,u,c],indices:[2,0,4,2,4,3,1,3,4]}):(C.lineSegmentPlane(a,t,n,u),C.lineSegmentPlane(e,t,n,c),{positions:[t,a,e,u,c],indices:[1,2,4,1,4,3,0,3,4]}):void 0},t.IntersectionTests=C,t.Ray=e});