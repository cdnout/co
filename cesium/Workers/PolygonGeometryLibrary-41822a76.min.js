define(["exports","./ArcType-fc72c06c","./arrayRemoveDuplicates-dc2f4046","./Matrix2-37e55508","./ComponentDatatype-a15c9a19","./defaultValue-81eec7ed","./EllipsoidRhumbLine-125a8b72","./GeometryAttribute-cc3a5bc9","./GeometryAttributes-32b29525","./GeometryPipeline-20022973","./IndexDatatype-f1dcdf35","./PolygonPipeline-b6cd7820","./Transforms-dca21951"],function(e,d,m,C,y,b,g,v,T,l,w,I,f){"use strict";function x(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(x.prototype,{length:{get:function(){return this._length}}}),x.prototype.enqueue=function(e){this._array.push(e),this._length++},x.prototype.dequeue=function(){if(0!==this._length){const n=this._array;let e=this._offset;var t=n[e];return n[e]=void 0,e++,10<e&&2*e>n.length&&(this._array=n.slice(e),e=0),this._offset=e,this._length--,t}},x.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},x.prototype.contains=function(e){return-1!==this._array.indexOf(e)},x.prototype.clear=function(){this._array.length=this._offset=this._length=0},x.prototype.sort=function(e){0<this._offset&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};const E={computeHierarchyPackedLength:function(t){let e=0;const n=[t];for(;0<n.length;){const t=n.pop();if(b.defined(t)){e+=2;var i=t.positions,r=t.holes;if(b.defined(i)&&(e+=i.length*C.Cartesian3.packedLength),b.defined(r)){const t=r.length;for(let e=0;e<t;++e)n.push(r[e])}}}return e},packPolygonHierarchy:function(t,n,i){const r=[t];for(;0<r.length;){const t=r.pop();if(b.defined(t)){var o=t.positions,a=t.holes;if(n[i++]=b.defined(o)?o.length:0,n[i++]=b.defined(a)?a.length:0,b.defined(o)){const t=o.length;for(let e=0;e<t;++e,i+=3)C.Cartesian3.pack(o[e],n,i)}if(b.defined(a)){const t=a.length;for(let e=0;e<t;++e)r.push(a[e])}}}return i},unpackPolygonHierarchy:function(t,n){const i=t[n++],r=t[n++],o=new Array(i),a=0<r?new Array(r):void 0;for(let e=0;e<i;++e,n+=C.Cartesian3.packedLength)o[e]=C.Cartesian3.unpack(t,n);for(let e=0;e<r;++e)a[e]=E.unpackPolygonHierarchy(t,n),n=a[e].startingIndex,delete a[e].startingIndex;return{positions:o,holes:a,startingIndex:n}}},r=new C.Cartesian3;function c(e,t,n,i){return C.Cartesian3.subtract(t,e,r),C.Cartesian3.multiplyByScalar(r,n/i,r),C.Cartesian3.add(e,r,r),[r.x,r.y,r.z]}E.subdivideLineCount=function(e,t,n){n=C.Cartesian3.distance(e,t)/n,n=Math.max(0,Math.ceil(y.CesiumMath.log2(n)));return Math.pow(2,n)};const A=new C.Cartographic,P=new C.Cartographic,_=new C.Cartographic,G=new C.Cartesian3;E.subdivideRhumbLineCount=function(e,t,n,i){t=e.cartesianToCartographic(t,A),n=e.cartesianToCartographic(n,P),i=new g.EllipsoidRhumbLine(t,n,e).surfaceDistance/i,i=Math.max(0,Math.ceil(y.CesiumMath.log2(i)));return Math.pow(2,i)},E.subdivideLine=function(t,n,e,i){var r=E.subdivideLineCount(t,n,e),o=C.Cartesian3.distance(t,n),a=o/r;const s=i=!b.defined(i)?[]:i;s.length=3*r;let l=0;for(let e=0;e<r;e++){const C=c(t,n,e*a,o);s[l++]=C[0],s[l++]=C[1],s[l++]=C[2]}return s},E.subdivideRhumbLine=function(t,e,n,i,r){const o=t.cartesianToCartographic(e,A),a=t.cartesianToCartographic(n,P),s=new g.EllipsoidRhumbLine(o,a,t),l=s.surfaceDistance/i,c=Math.max(0,Math.ceil(y.CesiumMath.log2(l))),u=Math.pow(2,c),h=s.surfaceDistance/u,f=r=!b.defined(r)?[]:r;f.length=3*u;let p=0;for(let e=0;e<u;e++){const n=s.interpolateUsingSurfaceDistance(e*h,_),i=t.cartographicToCartesian(n,G);f[p++]=i.x,f[p++]=i.y,f[p++]=i.z}return f};const u=new C.Cartesian3,h=new C.Cartesian3,p=new C.Cartesian3,L=new C.Cartesian3;E.scaleToGeodeticHeightExtruded=function(e,t,n,i,r){i=b.defaultValue(i,C.Ellipsoid.WGS84);var o=u;let a=h;var s=p;let l=L;if(b.defined(e)&&b.defined(e.attributes)&&b.defined(e.attributes.position)){const b=e.attributes.position.values,c=b.length/2;for(let e=0;e<c;e+=3)C.Cartesian3.fromArray(b,e,s),i.geodeticSurfaceNormal(s,o),l=i.scaleToGeodeticSurface(s,l),a=C.Cartesian3.multiplyByScalar(o,n,a),a=C.Cartesian3.add(l,a,a),b[e+c]=a.x,b[e+1+c]=a.y,b[e+2+c]=a.z,r&&(l=C.Cartesian3.clone(s,l)),a=C.Cartesian3.multiplyByScalar(o,t,a),a=C.Cartesian3.add(l,a,a),b[e]=a.x,b[e+1]=a.y,b[e+2]=a.z}return e},E.polygonOutlinesFromHierarchy=function(n,i,r){const o=[],a=new x;let s,l,c;for(a.enqueue(n);0!==a.length;){const n=a.dequeue();let e=n.positions;if(i)for(c=e.length,s=0;s<c;s++)r.scaleToGeodeticSurface(e[s],e[s]);if(e=m.arrayRemoveDuplicates(e,C.Cartesian3.equalsEpsilon,!0),!(e.length<3)){var t=n.holes?n.holes.length:0;for(s=0;s<t;s++){var u=n.holes[s];let t=u.positions;if(i)for(c=t.length,l=0;l<c;++l)r.scaleToGeodeticSurface(t[l],t[l]);if(t=m.arrayRemoveDuplicates(t,C.Cartesian3.equalsEpsilon,!0),!(t.length<3)){o.push(t);let e=0;for(b.defined(u.holes)&&(e=u.holes.length),l=0;l<e;l++)a.enqueue(u.holes[l])}}o.push(e)}}return o},E.polygonsFromHierarchy=function(s,l,c,u){const t=[],h=[],f=new x;for(f.enqueue(s);0!==f.length;){const s=f.dequeue();let e=s.positions;var p=s.holes;let o,a;if(c)for(a=e.length,o=0;o<a;o++)u.scaleToGeodeticSurface(e[o],e[o]);if(e=m.arrayRemoveDuplicates(e,C.Cartesian3.equalsEpsilon,!0),!(e.length<3)){let r=l(e);if(b.defined(r)){const d=[];I.PolygonPipeline.computeWindingOrder2D(r)===I.WindingOrder.CLOCKWISE&&(r.reverse(),e=e.slice().reverse());let n=e.slice();const y=b.defined(p)?p.length:0,g=[];let i;for(o=0;o<y;o++){const s=p[o];let t=s.positions;if(c)for(a=t.length,i=0;i<a;++i)u.scaleToGeodeticSurface(t[i],t[i]);if(t=m.arrayRemoveDuplicates(t,C.Cartesian3.equalsEpsilon,!0),!(t.length<3)){const h=l(t);if(b.defined(h)){I.PolygonPipeline.computeWindingOrder2D(h)===I.WindingOrder.CLOCKWISE&&(h.reverse(),t=t.slice().reverse()),g.push(t),d.push(n.length),n=n.concat(t),r=r.concat(h);let e=0;for(b.defined(s.holes)&&(e=s.holes.length),i=0;i<e;i++)f.enqueue(s.holes[i])}}}t.push({outerRing:e,holes:g}),h.push({positions:n,positions2D:r,holes:d})}}}return{hierarchy:t,polygons:h}};const M=new C.Cartesian2,D=new C.Cartesian3,S=new f.Quaternion,R=new C.Matrix3;E.computeBoundingRectangle=function(e,t,n,i,r){var i=f.Quaternion.fromAxisAngle(e,i,S),o=C.Matrix3.fromQuaternion(i,R);let a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;var u=n.length;for(let e=0;e<u;++e){const h=C.Cartesian3.clone(n[e],D);C.Matrix3.multiplyByVector(o,h,h);const r=t(h,M);b.defined(r)&&(a=Math.min(a,r.x),s=Math.max(s,r.x),l=Math.min(l,r.y),c=Math.max(c,r.y))}return r.x=a,r.y=l,r.width=s-a,r.height=c-l,r},E.createGeometryFromPositions=function(n,e,i,t,r,o){let a=I.PolygonPipeline.triangulate(e.positions2D,e.holes);a.length<3&&(a=[0,1,2]);var s=e.positions;if(t){const n=s.length,d=new Array(3*n);let t=0;for(let e=0;e<n;e++){const n=s[e];d[t++]=n.x,d[t++]=n.y,d[t++]=n.z}const i=new v.Geometry({attributes:{position:new v.GeometryAttribute({componentDatatype:y.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:a,primitiveType:v.PrimitiveType.TRIANGLES});return r.normal?l.GeometryPipeline.computeNormal(i):i}return o===d.ArcType.GEODESIC?I.PolygonPipeline.computeSubdivision(n,s,a,i):o===d.ArcType.RHUMB?I.PolygonPipeline.computeRhumbLineSubdivision(n,s,a,i):void 0};const N=[],O=new C.Cartesian3,q=new C.Cartesian3;E.computeWallGeometry=function(n,i,r,e,o){let a,s,l,c,u,h=n.length,f=0;if(e)for(s=3*h*2,a=new Array(2*s),l=0;l<h;l++)c=n[l],u=n[(l+1)%h],a[f]=a[f+s]=c.x,++f,a[f]=a[f+s]=c.y,++f,a[f]=a[f+s]=c.z,++f,a[f]=a[f+s]=u.x,++f,a[f]=a[f+s]=u.y,++f,a[f]=a[f+s]=u.z,++f;else{const C=y.CesiumMath.chordLength(r,i.maximumRadius);let e=0;if(o===d.ArcType.GEODESIC)for(l=0;l<h;l++)e+=E.subdivideLineCount(n[l],n[(l+1)%h],C);else if(o===d.ArcType.RHUMB)for(l=0;l<h;l++)e+=E.subdivideRhumbLineCount(i,n[l],n[(l+1)%h],C);for(s=3*(e+h),a=new Array(2*s),l=0;l<h;l++){let t;c=n[l],u=n[(l+1)%h],o===d.ArcType.GEODESIC?t=E.subdivideLine(c,u,C,N):o===d.ArcType.RHUMB&&(t=E.subdivideRhumbLine(i,c,u,C,N));const r=t.length;for(let e=0;e<r;++e,++f)a[f]=t[e],a[f+s]=t[e];a[f]=u.x,a[f+s]=u.x,++f,a[f]=u.y,a[f+s]=u.y,++f,a[f]=u.z,a[f+s]=u.z,++f}}h=a.length;const t=w.IndexDatatype.createTypedArray(h/3,h-6*n.length);let p=0;for(h/=6,l=0;l<h;l++){const n=l,d=n+1,i=n+h,r=i+1;c=C.Cartesian3.fromArray(a,3*n,O),u=C.Cartesian3.fromArray(a,3*d,q),C.Cartesian3.equalsEpsilon(c,u,y.CesiumMath.EPSILON10,y.CesiumMath.EPSILON10)||(t[p++]=n,t[p++]=i,t[p++]=d,t[p++]=d,t[p++]=i,t[p++]=r)}return new v.Geometry({attributes:new T.GeometryAttributes({position:new v.GeometryAttribute({componentDatatype:y.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:a})}),indices:t,primitiveType:v.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=E});