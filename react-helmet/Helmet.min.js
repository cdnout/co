"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var PropTypes=_interopDefault(require("prop-types")),withSideEffect=_interopDefault(require("react-side-effect")),isEqual=_interopDefault(require("react-fast-compare")),React=_interopDefault(require("react")),objectAssign=_interopDefault(require("object-assign")),ATTRIBUTE_NAMES={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},TAG_NAMES={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"},VALID_TAG_NAMES=Object.keys(TAG_NAMES).map(function(e){return TAG_NAMES[e]}),TAG_PROPERTIES={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},REACT_TAG_MAP={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},HELMET_PROPS={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},HTML_TAG_MAP=Object.keys(REACT_TAG_MAP).reduce(function(e,t){return e[REACT_TAG_MAP[t]]=t,e},{}),SELF_CLOSING_TAGS=[TAG_NAMES.NOSCRIPT,TAG_NAMES.SCRIPT,TAG_NAMES.STYLE],HELMET_ATTRIBUTE="data-react-helmet",_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},objectWithoutProperties=function(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},encodeSpecialCharacters=function(e,t){return!1===(!(1<arguments.length&&void 0!==t)||t)?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},getTitleFromPropsList=function(e){var t=getInnermostProperty(e,TAG_NAMES.TITLE),r=getInnermostProperty(e,HELMET_PROPS.TITLE_TEMPLATE);if(r&&t)return r.replace(/%s/g,function(){return Array.isArray(t)?t.join(""):t});var n=getInnermostProperty(e,HELMET_PROPS.DEFAULT_TITLE);return t||n||void 0},getOnChangeClientState=function(e){return getInnermostProperty(e,HELMET_PROPS.ON_CHANGE_CLIENT_STATE)||function(){}},getAttributesFromPropsList=function(t,e){return e.filter(function(e){return void 0!==e[t]}).map(function(e){return e[t]}).reduce(function(e,t){return _extends({},e,t)},{})},getBaseTagFromPropsList=function(i,e){return e.filter(function(e){return void 0!==e[TAG_NAMES.BASE]}).map(function(e){return e[TAG_NAMES.BASE]}).reverse().reduce(function(e,t){if(!e.length)for(var r=Object.keys(t),n=0;n<r.length;n++){var o=r[n].toLowerCase();if(-1!==i.indexOf(o)&&t[o])return e.concat(t)}return e},[])},getTagsFromPropsList=function(t,T,e){var c={};return e.filter(function(e){return!!Array.isArray(e[t])||(void 0!==e[t]&&warn("Helmet: "+t+' should be of type "Array". Instead found type "'+_typeof(e[t])+'"'),!1)}).map(function(e){return e[t]}).reverse().reduce(function(t,e){var s={};e.filter(function(e){for(var t=void 0,r=Object.keys(e),n=0;n<r.length;n++){var o=r[n],i=o.toLowerCase();-1===T.indexOf(i)||t===TAG_PROPERTIES.REL&&"canonical"===e[t].toLowerCase()||i===TAG_PROPERTIES.REL&&"stylesheet"===e[i].toLowerCase()||(t=i),-1===T.indexOf(o)||o!==TAG_PROPERTIES.INNER_HTML&&o!==TAG_PROPERTIES.CSS_TEXT&&o!==TAG_PROPERTIES.ITEM_PROP||(t=o)}if(!t||!e[t])return!1;var a=e[t].toLowerCase();return c[t]||(c[t]={}),s[t]||(s[t]={}),!c[t][a]&&(s[t][a]=!0)}).reverse().forEach(function(e){return t.push(e)});for(var r=Object.keys(s),n=0;n<r.length;n++){var o=r[n],i=objectAssign({},c[o],s[o]);c[o]=i}return t},[]).reverse()},getInnermostProperty=function(e,t){for(var r=e.length-1;0<=r;r--){var n=e[r];if(n.hasOwnProperty(t))return n[t]}return null},reducePropsToState=function(e){return{baseTag:getBaseTagFromPropsList([TAG_PROPERTIES.HREF,TAG_PROPERTIES.TARGET],e),bodyAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.BODY,e),defer:getInnermostProperty(e,HELMET_PROPS.DEFER),encode:getInnermostProperty(e,HELMET_PROPS.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.HTML,e),linkTags:getTagsFromPropsList(TAG_NAMES.LINK,[TAG_PROPERTIES.REL,TAG_PROPERTIES.HREF],e),metaTags:getTagsFromPropsList(TAG_NAMES.META,[TAG_PROPERTIES.NAME,TAG_PROPERTIES.CHARSET,TAG_PROPERTIES.HTTPEQUIV,TAG_PROPERTIES.PROPERTY,TAG_PROPERTIES.ITEM_PROP],e),noscriptTags:getTagsFromPropsList(TAG_NAMES.NOSCRIPT,[TAG_PROPERTIES.INNER_HTML],e),onChangeClientState:getOnChangeClientState(e),scriptTags:getTagsFromPropsList(TAG_NAMES.SCRIPT,[TAG_PROPERTIES.SRC,TAG_PROPERTIES.INNER_HTML],e),styleTags:getTagsFromPropsList(TAG_NAMES.STYLE,[TAG_PROPERTIES.CSS_TEXT],e),title:getTitleFromPropsList(e),titleAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.TITLE,e)}},rafPolyfill=function(){var r=Date.now();return function(e){var t=Date.now();16<t-r?e(r=t):setTimeout(function(){rafPolyfill(e)},0)}}(),cafPolyfill=function(e){return clearTimeout(e)},requestAnimationFrame="undefined"!=typeof window?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||rafPolyfill:global.requestAnimationFrame||rafPolyfill,cancelAnimationFrame="undefined"!=typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||cafPolyfill:global.cancelAnimationFrame||cafPolyfill,warn=function(e){return console&&"function"==typeof console.warn&&console.warn(e)},_helmetCallback=null,handleClientStateChange=function(e){_helmetCallback&&cancelAnimationFrame(_helmetCallback),_helmetCallback=e.defer?requestAnimationFrame(function(){commitTagChanges(e,function(){_helmetCallback=null})}):(commitTagChanges(e),null)},commitTagChanges=function(e,t){var r=e.baseTag,n=e.bodyAttributes,o=e.htmlAttributes,i=e.linkTags,a=e.metaTags,s=e.noscriptTags,T=e.onChangeClientState,c=e.scriptTags,u=e.styleTags,l=e.title,p=e.titleAttributes;updateAttributes(TAG_NAMES.BODY,n),updateAttributes(TAG_NAMES.HTML,o),updateTitle(l,p);var A={baseTag:updateTags(TAG_NAMES.BASE,r),linkTags:updateTags(TAG_NAMES.LINK,i),metaTags:updateTags(TAG_NAMES.META,a),noscriptTags:updateTags(TAG_NAMES.NOSCRIPT,s),scriptTags:updateTags(TAG_NAMES.SCRIPT,c),styleTags:updateTags(TAG_NAMES.STYLE,u)},E={},f={};Object.keys(A).forEach(function(e){var t=A[e],r=t.newTags,n=t.oldTags;r.length&&(E[e]=r),n.length&&(f[e]=A[e].oldTags)}),t&&t(),T(e,E,f)},flattenArray=function(e){return Array.isArray(e)?e.join(""):e},updateTitle=function(e,t){void 0!==e&&document.title!==e&&(document.title=flattenArray(e)),updateAttributes(TAG_NAMES.TITLE,t)},updateAttributes=function(e,t){var r=document.getElementsByTagName(e)[0];if(r){for(var n=r.getAttribute(HELMET_ATTRIBUTE),o=n?n.split(","):[],i=[].concat(o),a=Object.keys(t),s=0;s<a.length;s++){var T=a[s],c=t[T]||"";r.getAttribute(T)!==c&&r.setAttribute(T,c),-1===o.indexOf(T)&&o.push(T);var u=i.indexOf(T);-1!==u&&i.splice(u,1)}for(var l=i.length-1;0<=l;l--)r.removeAttribute(i[l]);o.length===i.length?r.removeAttribute(HELMET_ATTRIBUTE):r.getAttribute(HELMET_ATTRIBUTE)!==a.join(",")&&r.setAttribute(HELMET_ATTRIBUTE,a.join(","))}},updateTags=function(o,e){var t=document.head||document.querySelector(TAG_NAMES.HEAD),r=t.querySelectorAll(o+"["+HELMET_ATTRIBUTE+"]"),i=Array.prototype.slice.call(r),a=[],s=void 0;return e&&e.length&&e.forEach(function(e){var t,r=document.createElement(o);for(var n in e){e.hasOwnProperty(n)&&(n===TAG_PROPERTIES.INNER_HTML?r.innerHTML=e.innerHTML:n===TAG_PROPERTIES.CSS_TEXT?r.styleSheet?r.styleSheet.cssText=e.cssText:r.appendChild(document.createTextNode(e.cssText)):(t=void 0===e[n]?"":e[n],r.setAttribute(n,t)))}r.setAttribute(HELMET_ATTRIBUTE,"true"),i.some(function(e,t){return s=t,r.isEqualNode(e)})?i.splice(s,1):a.push(r)}),i.forEach(function(e){return e.parentNode.removeChild(e)}),a.forEach(function(e){return t.appendChild(e)}),{oldTags:i,newTags:a}},generateElementAttributesAsString=function(n){return Object.keys(n).reduce(function(e,t){var r=void 0!==n[t]?t+'="'+n[t]+'"':""+t;return e?e+" "+r:r},"")},generateTitleAsString=function(e,t,r,n){var o=generateElementAttributesAsString(r),i=flattenArray(t);return o?"<"+e+" "+HELMET_ATTRIBUTE+'="true" '+o+">"+encodeSpecialCharacters(i,n)+"</"+e+">":"<"+e+" "+HELMET_ATTRIBUTE+'="true">'+encodeSpecialCharacters(i,n)+"</"+e+">"},generateTagsAsString=function(i,e,a){return e.reduce(function(e,n){var t=Object.keys(n).filter(function(e){return!(e===TAG_PROPERTIES.INNER_HTML||e===TAG_PROPERTIES.CSS_TEXT)}).reduce(function(e,t){var r=void 0===n[t]?t:t+'="'+encodeSpecialCharacters(n[t],a)+'"';return e?e+" "+r:r},""),r=n.innerHTML||n.cssText||"",o=-1===SELF_CLOSING_TAGS.indexOf(i);return e+"<"+i+" "+HELMET_ATTRIBUTE+'="true" '+t+(o?"/>":">"+r+"</"+i+">")},"")},convertElementAttributestoReactProps=function(r,e){var t=1<arguments.length&&void 0!==e?e:{};return Object.keys(r).reduce(function(e,t){return e[REACT_TAG_MAP[t]||t]=r[t],e},t)},convertReactPropstoHtmlAttributes=function(r,e){var t=1<arguments.length&&void 0!==e?e:{};return Object.keys(r).reduce(function(e,t){return e[HTML_TAG_MAP[t]||t]=r[t],e},t)},generateTitleAsReactComponent=function(e,t,r){var n,o=((n={key:t})[HELMET_ATTRIBUTE]=!0,n),i=convertElementAttributestoReactProps(r,o);return[React.createElement(TAG_NAMES.TITLE,i,t)]},generateTagsAsReactComponent=function(r,e){return e.map(function(n,e){var t,o=((t={key:e})[HELMET_ATTRIBUTE]=!0,t);return Object.keys(n).forEach(function(e){var t,r=REACT_TAG_MAP[e]||e;r===TAG_PROPERTIES.INNER_HTML||r===TAG_PROPERTIES.CSS_TEXT?(t=n.innerHTML||n.cssText,o.dangerouslySetInnerHTML={__html:t}):o[r]=n[e]}),React.createElement(r,o)})},getMethodsForTag=function(e,t,r){switch(e){case TAG_NAMES.TITLE:return{toComponent:function(){return generateTitleAsReactComponent(e,t.title,t.titleAttributes,r)},toString:function(){return generateTitleAsString(e,t.title,t.titleAttributes,r)}};case ATTRIBUTE_NAMES.BODY:case ATTRIBUTE_NAMES.HTML:return{toComponent:function(){return convertElementAttributestoReactProps(t)},toString:function(){return generateElementAttributesAsString(t)}};default:return{toComponent:function(){return generateTagsAsReactComponent(e,t)},toString:function(){return generateTagsAsString(e,t,r)}}}},mapStateOnServer=function(e){var t=e.baseTag,r=e.bodyAttributes,n=e.encode,o=e.htmlAttributes,i=e.linkTags,a=e.metaTags,s=e.noscriptTags,T=e.scriptTags,c=e.styleTags,u=e.title,l=void 0===u?"":u,p=e.titleAttributes;return{base:getMethodsForTag(TAG_NAMES.BASE,t,n),bodyAttributes:getMethodsForTag(ATTRIBUTE_NAMES.BODY,r,n),htmlAttributes:getMethodsForTag(ATTRIBUTE_NAMES.HTML,o,n),link:getMethodsForTag(TAG_NAMES.LINK,i,n),meta:getMethodsForTag(TAG_NAMES.META,a,n),noscript:getMethodsForTag(TAG_NAMES.NOSCRIPT,s,n),script:getMethodsForTag(TAG_NAMES.SCRIPT,T,n),style:getMethodsForTag(TAG_NAMES.STYLE,c,n),title:getMethodsForTag(TAG_NAMES.TITLE,{title:l,titleAttributes:p},n)}},Helmet=function(o){var e,t,r;return r=React.Component,inherits(n,r),n.prototype.shouldComponentUpdate=function(e){return!isEqual(this.props,e)},n.prototype.mapNestedChildrenToProps=function(e,t){if(!t)return null;switch(e.type){case TAG_NAMES.SCRIPT:case TAG_NAMES.NOSCRIPT:return{innerHTML:t};case TAG_NAMES.STYLE:return{cssText:t}}throw new Error("<"+e.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},n.prototype.flattenArrayTypeChildren=function(e){var t,r=e.child,n=e.arrayTypeChildren,o=e.newChildProps,i=e.nestedChildren;return _extends({},n,((t={})[r.type]=[].concat(n[r.type]||[],[_extends({},o,this.mapNestedChildrenToProps(r,i))]),t))},n.prototype.mapObjectTypeChildren=function(e){var t,r,n=e.child,o=e.newProps,i=e.newChildProps,a=e.nestedChildren;switch(n.type){case TAG_NAMES.TITLE:return _extends({},o,((t={})[n.type]=a,t.titleAttributes=_extends({},i),t));case TAG_NAMES.BODY:return _extends({},o,{bodyAttributes:_extends({},i)});case TAG_NAMES.HTML:return _extends({},o,{htmlAttributes:_extends({},i)})}return _extends({},o,((r={})[n.type]=_extends({},i),r))},n.prototype.mapArrayTypeChildrenToProps=function(r,e){var n=_extends({},e);return Object.keys(r).forEach(function(e){var t;n=_extends({},n,((t={})[e]=r[e],t))}),n},n.prototype.warnOnInvalidChildren=function(t,e){if("production"!==process.env.NODE_ENV){if(!VALID_TAG_NAMES.some(function(e){return t.type===e}))return"function"==typeof t.type?warn("You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information."):warn("Only elements types "+VALID_TAG_NAMES.join(", ")+" are allowed. Helmet does not support rendering <"+t.type+"> elements. Refer to our API for more information.");if(e&&"string"!=typeof e&&(!Array.isArray(e)||e.some(function(e){return"string"!=typeof e})))throw new Error("Helmet expects a string as a child of <"+t.type+">. Did you forget to wrap your children in braces? ( <"+t.type+">{``}</"+t.type+"> ) Refer to our API for more information.")}return!0},n.prototype.mapChildrenToProps=function(e,i){var a=this,s={};return React.Children.forEach(e,function(e){if(e&&e.props){var t=e.props,r=t.children,n=objectWithoutProperties(t,["children"]),o=convertReactPropstoHtmlAttributes(n);switch(a.warnOnInvalidChildren(e,r),e.type){case TAG_NAMES.LINK:case TAG_NAMES.META:case TAG_NAMES.NOSCRIPT:case TAG_NAMES.SCRIPT:case TAG_NAMES.STYLE:s=a.flattenArrayTypeChildren({child:e,arrayTypeChildren:s,newChildProps:o,nestedChildren:r});break;default:i=a.mapObjectTypeChildren({child:e,newProps:i,newChildProps:o,nestedChildren:r})}}}),i=this.mapArrayTypeChildrenToProps(s,i)},n.prototype.render=function(){var e=this.props,t=e.children,r=objectWithoutProperties(e,["children"]),n=_extends({},r);return t&&(n=this.mapChildrenToProps(t,n)),React.createElement(o,n)},createClass(n,null,[{key:"canUseDOM",set:function(e){o.canUseDOM=e}}]),t=e=n,e.propTypes={base:PropTypes.object,bodyAttributes:PropTypes.object,children:PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.node),PropTypes.node]),defaultTitle:PropTypes.string,defer:PropTypes.bool,encodeSpecialCharacters:PropTypes.bool,htmlAttributes:PropTypes.object,link:PropTypes.arrayOf(PropTypes.object),meta:PropTypes.arrayOf(PropTypes.object),noscript:PropTypes.arrayOf(PropTypes.object),onChangeClientState:PropTypes.func,script:PropTypes.arrayOf(PropTypes.object),style:PropTypes.arrayOf(PropTypes.object),title:PropTypes.string,titleAttributes:PropTypes.object,titleTemplate:PropTypes.string},e.defaultProps={defer:!0,encodeSpecialCharacters:!0},e.peek=o.peek,e.rewind=function(){return o.rewind()||mapStateOnServer({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})},t;function n(){return classCallCheck(this,n),possibleConstructorReturn(this,r.apply(this,arguments))}},NullComponent=function(){return null},HelmetSideEffects=withSideEffect(reducePropsToState,handleClientStateChange,mapStateOnServer)(NullComponent),HelmetExport=Helmet(HelmetSideEffects);HelmetExport.renderStatic=HelmetExport.rewind,exports.Helmet=HelmetExport,exports.default=HelmetExport;