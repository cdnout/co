import PropTypes from"prop-types";import withSideEffect from"react-side-effect";import isEqual from"react-fast-compare";import React from"react";import objectAssign from"object-assign";var ATTRIBUTE_NAMES={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},TAG_NAMES={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"},VALID_TAG_NAMES=Object.keys(TAG_NAMES).map(function(e){return TAG_NAMES[e]}),TAG_PROPERTIES={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},REACT_TAG_MAP={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},HELMET_PROPS={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},HTML_TAG_MAP=Object.keys(REACT_TAG_MAP).reduce(function(e,t){return e[REACT_TAG_MAP[t]]=t,e},{}),SELF_CLOSING_TAGS=[TAG_NAMES.NOSCRIPT,TAG_NAMES.SCRIPT,TAG_NAMES.STYLE],HELMET_ATTRIBUTE="data-react-helmet",_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},objectWithoutProperties=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},encodeSpecialCharacters=function(e){return!1===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},getTitleFromPropsList=function(e){var t=getInnermostProperty(e,TAG_NAMES.TITLE),r=getInnermostProperty(e,HELMET_PROPS.TITLE_TEMPLATE);if(r&&t)return r.replace(/%s/g,function(){return Array.isArray(t)?t.join(""):t});var n=getInnermostProperty(e,HELMET_PROPS.DEFAULT_TITLE);return t||n||void 0},getOnChangeClientState=function(e){return getInnermostProperty(e,HELMET_PROPS.ON_CHANGE_CLIENT_STATE)||function(){}},getAttributesFromPropsList=function(e,t){return t.filter(function(t){return void 0!==t[e]}).map(function(t){return t[e]}).reduce(function(e,t){return _extends({},e,t)},{})},getBaseTagFromPropsList=function(e,t){return t.filter(function(e){return void 0!==e[TAG_NAMES.BASE]}).map(function(e){return e[TAG_NAMES.BASE]}).reverse().reduce(function(t,r){if(!t.length)for(var n=Object.keys(r),o=0;o<n.length;o++){var i=n[o].toLowerCase();if(-1!==e.indexOf(i)&&r[i])return t.concat(r)}return t},[])},getTagsFromPropsList=function(e,t,r){var n={};return r.filter(function(t){return!!Array.isArray(t[e])||(void 0!==t[e]&&warn("Helmet: "+e+' should be of type "Array". Instead found type "'+_typeof(t[e])+'"'),!1)}).map(function(t){return t[e]}).reverse().reduce(function(e,r){var o={};r.filter(function(e){for(var r=void 0,i=Object.keys(e),a=0;a<i.length;a++){var s=i[a],T=s.toLowerCase();-1===t.indexOf(T)||r===TAG_PROPERTIES.REL&&"canonical"===e[r].toLowerCase()||T===TAG_PROPERTIES.REL&&"stylesheet"===e[T].toLowerCase()||(r=T),-1===t.indexOf(s)||s!==TAG_PROPERTIES.INNER_HTML&&s!==TAG_PROPERTIES.CSS_TEXT&&s!==TAG_PROPERTIES.ITEM_PROP||(r=s)}if(!r||!e[r])return!1;var c=e[r].toLowerCase();return n[r]||(n[r]={}),o[r]||(o[r]={}),!n[r][c]&&(o[r][c]=!0,!0)}).reverse().forEach(function(t){return e.push(t)});for(var i=Object.keys(o),a=0;a<i.length;a++){var s=i[a],T=objectAssign({},n[s],o[s]);n[s]=T}return e},[]).reverse()},getInnermostProperty=function(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r];if(n.hasOwnProperty(t))return n[t]}return null},reducePropsToState=function(e){return{baseTag:getBaseTagFromPropsList([TAG_PROPERTIES.HREF,TAG_PROPERTIES.TARGET],e),bodyAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.BODY,e),defer:getInnermostProperty(e,HELMET_PROPS.DEFER),encode:getInnermostProperty(e,HELMET_PROPS.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.HTML,e),linkTags:getTagsFromPropsList(TAG_NAMES.LINK,[TAG_PROPERTIES.REL,TAG_PROPERTIES.HREF],e),metaTags:getTagsFromPropsList(TAG_NAMES.META,[TAG_PROPERTIES.NAME,TAG_PROPERTIES.CHARSET,TAG_PROPERTIES.HTTPEQUIV,TAG_PROPERTIES.PROPERTY,TAG_PROPERTIES.ITEM_PROP],e),noscriptTags:getTagsFromPropsList(TAG_NAMES.NOSCRIPT,[TAG_PROPERTIES.INNER_HTML],e),onChangeClientState:getOnChangeClientState(e),scriptTags:getTagsFromPropsList(TAG_NAMES.SCRIPT,[TAG_PROPERTIES.SRC,TAG_PROPERTIES.INNER_HTML],e),styleTags:getTagsFromPropsList(TAG_NAMES.STYLE,[TAG_PROPERTIES.CSS_TEXT],e),title:getTitleFromPropsList(e),titleAttributes:getAttributesFromPropsList(ATTRIBUTE_NAMES.TITLE,e)}},rafPolyfill=function(){var e=Date.now();return function(t){var r=Date.now();r-e>16?(e=r,t(r)):setTimeout(function(){rafPolyfill(t)},0)}}(),cafPolyfill=function(e){return clearTimeout(e)},requestAnimationFrame="undefined"!=typeof window?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||rafPolyfill:global.requestAnimationFrame||rafPolyfill,cancelAnimationFrame="undefined"!=typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||cafPolyfill:global.cancelAnimationFrame||cafPolyfill,warn=function(e){return console&&"function"==typeof console.warn&&console.warn(e)},_helmetCallback=null,handleClientStateChange=function(e){_helmetCallback&&cancelAnimationFrame(_helmetCallback),e.defer?_helmetCallback=requestAnimationFrame(function(){commitTagChanges(e,function(){_helmetCallback=null})}):(commitTagChanges(e),_helmetCallback=null)},commitTagChanges=function(e,t){var r=e.baseTag,n=e.bodyAttributes,o=e.htmlAttributes,i=e.linkTags,a=e.metaTags,s=e.noscriptTags,T=e.onChangeClientState,c=e.scriptTags,u=e.styleTags,l=e.title,p=e.titleAttributes;updateAttributes(TAG_NAMES.BODY,n),updateAttributes(TAG_NAMES.HTML,o),updateTitle(l,p);var A={baseTag:updateTags(TAG_NAMES.BASE,r),linkTags:updateTags(TAG_NAMES.LINK,i),metaTags:updateTags(TAG_NAMES.META,a),noscriptTags:updateTags(TAG_NAMES.NOSCRIPT,s),scriptTags:updateTags(TAG_NAMES.SCRIPT,c),styleTags:updateTags(TAG_NAMES.STYLE,u)},E={},f={};Object.keys(A).forEach(function(e){var t=A[e],r=t.newTags,n=t.oldTags;r.length&&(E[e]=r),n.length&&(f[e]=A[e].oldTags)}),t&&t(),T(e,E,f)},flattenArray=function(e){return Array.isArray(e)?e.join(""):e},updateTitle=function(e,t){void 0!==e&&document.title!==e&&(document.title=flattenArray(e)),updateAttributes(TAG_NAMES.TITLE,t)},updateAttributes=function(e,t){var r=document.getElementsByTagName(e)[0];if(r){for(var n=r.getAttribute(HELMET_ATTRIBUTE),o=n?n.split(","):[],i=[].concat(o),a=Object.keys(t),s=0;s<a.length;s++){var T=a[s],c=t[T]||"";r.getAttribute(T)!==c&&r.setAttribute(T,c),-1===o.indexOf(T)&&o.push(T);var u=i.indexOf(T);-1!==u&&i.splice(u,1)}for(var l=i.length-1;l>=0;l--)r.removeAttribute(i[l]);o.length===i.length?r.removeAttribute(HELMET_ATTRIBUTE):r.getAttribute(HELMET_ATTRIBUTE)!==a.join(",")&&r.setAttribute(HELMET_ATTRIBUTE,a.join(","))}},updateTags=function(e,t){var r=document.head||document.querySelector(TAG_NAMES.HEAD),n=r.querySelectorAll(e+"["+HELMET_ATTRIBUTE+"]"),o=Array.prototype.slice.call(n),i=[],a=void 0;return t&&t.length&&t.forEach(function(t){var r=document.createElement(e);for(var n in t)if(t.hasOwnProperty(n))if(n===TAG_PROPERTIES.INNER_HTML)r.innerHTML=t.innerHTML;else if(n===TAG_PROPERTIES.CSS_TEXT)r.styleSheet?r.styleSheet.cssText=t.cssText:r.appendChild(document.createTextNode(t.cssText));else{var s=void 0===t[n]?"":t[n];r.setAttribute(n,s)}r.setAttribute(HELMET_ATTRIBUTE,"true"),o.some(function(e,t){return a=t,r.isEqualNode(e)})?o.splice(a,1):i.push(r)}),o.forEach(function(e){return e.parentNode.removeChild(e)}),i.forEach(function(e){return r.appendChild(e)}),{oldTags:o,newTags:i}},generateElementAttributesAsString=function(e){return Object.keys(e).reduce(function(t,r){var n=void 0!==e[r]?r+'="'+e[r]+'"':""+r;return t?t+" "+n:n},"")},generateTitleAsString=function(e,t,r,n){var o=generateElementAttributesAsString(r),i=flattenArray(t);return o?"<"+e+" "+HELMET_ATTRIBUTE+'="true" '+o+">"+encodeSpecialCharacters(i,n)+"</"+e+">":"<"+e+" "+HELMET_ATTRIBUTE+'="true">'+encodeSpecialCharacters(i,n)+"</"+e+">"},generateTagsAsString=function(e,t,r){return t.reduce(function(t,n){var o=Object.keys(n).filter(function(e){return!(e===TAG_PROPERTIES.INNER_HTML||e===TAG_PROPERTIES.CSS_TEXT)}).reduce(function(e,t){var o=void 0===n[t]?t:t+'="'+encodeSpecialCharacters(n[t],r)+'"';return e?e+" "+o:o},""),i=n.innerHTML||n.cssText||"",a=-1===SELF_CLOSING_TAGS.indexOf(e);return t+"<"+e+" "+HELMET_ATTRIBUTE+'="true" '+o+(a?"/>":">"+i+"</"+e+">")},"")},convertElementAttributestoReactProps=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[REACT_TAG_MAP[r]||r]=e[r],t},t)},convertReactPropstoHtmlAttributes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce(function(t,r){return t[HTML_TAG_MAP[r]||r]=e[r],t},t)},generateTitleAsReactComponent=function(e,t,r){var n,o=((n={key:t})[HELMET_ATTRIBUTE]=!0,n),i=convertElementAttributestoReactProps(r,o);return[React.createElement(TAG_NAMES.TITLE,i,t)]},generateTagsAsReactComponent=function(e,t){return t.map(function(t,r){var n,o=((n={key:r})[HELMET_ATTRIBUTE]=!0,n);return Object.keys(t).forEach(function(e){var r=REACT_TAG_MAP[e]||e;if(r===TAG_PROPERTIES.INNER_HTML||r===TAG_PROPERTIES.CSS_TEXT){var n=t.innerHTML||t.cssText;o.dangerouslySetInnerHTML={__html:n}}else o[r]=t[e]}),React.createElement(e,o)})},getMethodsForTag=function(e,t,r){switch(e){case TAG_NAMES.TITLE:return{toComponent:function(){return generateTitleAsReactComponent(e,t.title,t.titleAttributes,r)},toString:function(){return generateTitleAsString(e,t.title,t.titleAttributes,r)}};case ATTRIBUTE_NAMES.BODY:case ATTRIBUTE_NAMES.HTML:return{toComponent:function(){return convertElementAttributestoReactProps(t)},toString:function(){return generateElementAttributesAsString(t)}};default:return{toComponent:function(){return generateTagsAsReactComponent(e,t)},toString:function(){return generateTagsAsString(e,t,r)}}}},mapStateOnServer=function(e){var t=e.baseTag,r=e.bodyAttributes,n=e.encode,o=e.htmlAttributes,i=e.linkTags,a=e.metaTags,s=e.noscriptTags,T=e.scriptTags,c=e.styleTags,u=e.title,l=void 0===u?"":u,p=e.titleAttributes;return{base:getMethodsForTag(TAG_NAMES.BASE,t,n),bodyAttributes:getMethodsForTag(ATTRIBUTE_NAMES.BODY,r,n),htmlAttributes:getMethodsForTag(ATTRIBUTE_NAMES.HTML,o,n),link:getMethodsForTag(TAG_NAMES.LINK,i,n),meta:getMethodsForTag(TAG_NAMES.META,a,n),noscript:getMethodsForTag(TAG_NAMES.NOSCRIPT,s,n),script:getMethodsForTag(TAG_NAMES.SCRIPT,T,n),style:getMethodsForTag(TAG_NAMES.STYLE,c,n),title:getMethodsForTag(TAG_NAMES.TITLE,{title:l,titleAttributes:p},n)}},Helmet=function(e){var t,r;return r=t=function(t){function r(){return classCallCheck(this,r),possibleConstructorReturn(this,t.apply(this,arguments))}return inherits(r,t),r.prototype.shouldComponentUpdate=function(e){return!isEqual(this.props,e)},r.prototype.mapNestedChildrenToProps=function(e,t){if(!t)return null;switch(e.type){case TAG_NAMES.SCRIPT:case TAG_NAMES.NOSCRIPT:return{innerHTML:t};case TAG_NAMES.STYLE:return{cssText:t}}throw new Error("<"+e.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},r.prototype.flattenArrayTypeChildren=function(e){var t,r=e.child,n=e.arrayTypeChildren,o=e.newChildProps,i=e.nestedChildren;return _extends({},n,((t={})[r.type]=[].concat(n[r.type]||[],[_extends({},o,this.mapNestedChildrenToProps(r,i))]),t))},r.prototype.mapObjectTypeChildren=function(e){var t,r,n=e.child,o=e.newProps,i=e.newChildProps,a=e.nestedChildren;switch(n.type){case TAG_NAMES.TITLE:return _extends({},o,((t={})[n.type]=a,t.titleAttributes=_extends({},i),t));case TAG_NAMES.BODY:return _extends({},o,{bodyAttributes:_extends({},i)});case TAG_NAMES.HTML:return _extends({},o,{htmlAttributes:_extends({},i)})}return _extends({},o,((r={})[n.type]=_extends({},i),r))},r.prototype.mapArrayTypeChildrenToProps=function(e,t){var r=_extends({},t);return Object.keys(e).forEach(function(t){var n;r=_extends({},r,((n={})[t]=e[t],n))}),r},r.prototype.warnOnInvalidChildren=function(e,t){if("production"!==process.env.NODE_ENV){if(!VALID_TAG_NAMES.some(function(t){return e.type===t}))return"function"==typeof e.type?warn("You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information."):warn("Only elements types "+VALID_TAG_NAMES.join(", ")+" are allowed. Helmet does not support rendering <"+e.type+"> elements. Refer to our API for more information.");if(t&&"string"!=typeof t&&(!Array.isArray(t)||t.some(function(e){return"string"!=typeof e})))throw new Error("Helmet expects a string as a child of <"+e.type+">. Did you forget to wrap your children in braces? ( <"+e.type+">{``}</"+e.type+"> ) Refer to our API for more information.")}return!0},r.prototype.mapChildrenToProps=function(e,t){var r=this,n={};return React.Children.forEach(e,function(e){if(e&&e.props){var o=e.props,i=o.children,a=objectWithoutProperties(o,["children"]),s=convertReactPropstoHtmlAttributes(a);switch(r.warnOnInvalidChildren(e,i),e.type){case TAG_NAMES.LINK:case TAG_NAMES.META:case TAG_NAMES.NOSCRIPT:case TAG_NAMES.SCRIPT:case TAG_NAMES.STYLE:n=r.flattenArrayTypeChildren({child:e,arrayTypeChildren:n,newChildProps:s,nestedChildren:i});break;default:t=r.mapObjectTypeChildren({child:e,newProps:t,newChildProps:s,nestedChildren:i})}}}),t=this.mapArrayTypeChildrenToProps(n,t)},r.prototype.render=function(){var t=this.props,r=t.children,n=objectWithoutProperties(t,["children"]),o=_extends({},n);return r&&(o=this.mapChildrenToProps(r,o)),React.createElement(e,o)},createClass(r,null,[{key:"canUseDOM",set:function(t){e.canUseDOM=t}}]),r}(React.Component),t.propTypes={base:PropTypes.object,bodyAttributes:PropTypes.object,children:PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.node),PropTypes.node]),defaultTitle:PropTypes.string,defer:PropTypes.bool,encodeSpecialCharacters:PropTypes.bool,htmlAttributes:PropTypes.object,link:PropTypes.arrayOf(PropTypes.object),meta:PropTypes.arrayOf(PropTypes.object),noscript:PropTypes.arrayOf(PropTypes.object),onChangeClientState:PropTypes.func,script:PropTypes.arrayOf(PropTypes.object),style:PropTypes.arrayOf(PropTypes.object),title:PropTypes.string,titleAttributes:PropTypes.object,titleTemplate:PropTypes.string},t.defaultProps={defer:!0,encodeSpecialCharacters:!0},t.peek=e.peek,t.rewind=function(){var t=e.rewind();return t||(t=mapStateOnServer({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),t},r},NullComponent=function(){return null},HelmetSideEffects=withSideEffect(reducePropsToState,handleClientStateChange,mapStateOnServer)(NullComponent),HelmetExport=Helmet(HelmetSideEffects);HelmetExport.renderStatic=HelmetExport.rewind;export default HelmetExport;export{HelmetExport as Helmet};