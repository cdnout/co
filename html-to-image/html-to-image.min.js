!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).htmlToImage={})}(this,function(t){"use strict";function a(t,u,c,s){return new(c=c||Promise)(function(n,e){function r(t){try{i(s.next(t))}catch(t){e(t)}}function o(t){try{i(s.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):((e=t.value)instanceof c?e:new c(function(t){t(e)})).then(r,o)}i((s=s.apply(t,u||[])).next())})}function f(n,r){var o,i,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(u=2&e[0]?i.return:e[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,e[1])).done)return u;switch(i=0,(e=u?[2&e[0],u.value]:e)[0]){case 0:case 1:u=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,i=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!((u=0<(u=c.trys).length&&u[u.length-1])||6!==e[0]&&2!==e[0])){c=0;continue}if(3===e[0]&&(!u||e[1]>u[0]&&e[1]<u[3])){c.label=e[1];break}if(6===e[0]&&c.label<u[1]){c.label=u[1],u=e;break}if(u&&c.label<u[2]){c.label=u[2],c.ops.push(e);break}u[2]&&c.ops.pop(),c.trys.pop();continue}e=r.call(n,c)}catch(t){e=[6,t],i=0}finally{o=u=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var e="application/font-woff",n="image/jpeg",r={woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:n,jpeg:n,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function l(t){t=((t=/\.([^./]*?)$/g.exec(t))?t[1]:"").toLowerCase();return r[t]||""}function u(t){return-1!==t.search(/^(data:)/)}function h(t,e){return"data:"+e+";base64,"+t}var o,s=(o=0,function(){return o+=1,"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+o});function d(t){for(var e=[],n=0,r=t.length;n<r;n+=1)e.push(t[n]);return e}function i(t,e){e=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(e.replace("px",""))}function c(i){return i.toBlob?new Promise(function(t){return i.toBlob(t)}):new Promise(function(t){for(var e=window.atob(i.toDataURL().split(",")[1]),n=e.length,r=new Uint8Array(n),o=0;o<n;o+=1)r[o]=e.charCodeAt(o);t(new Blob([r],{type:"image/png"}))})}function v(r){return new Promise(function(t,e){var n=new Image;n.onload=function(){return t(n)},n.onerror=e,n.crossOrigin="anonymous",n.decoding="sync",n.src=r})}var p={};function g(r,o){var t=(e=r.replace(/\?.*/,""),e=/ttf|otf|eot|woff2?/i.test(e)?e.replace(/.*\//,""):e);if(null!=p[t])return p[t];o.cacheBust&&(r+=(/\?/.test(r)?"&":"?")+(new Date).getTime());var e=window.fetch(r).then(function(e){return e.blob().then(function(t){return{blob:t,contentType:e.headers.get("Content-Type")||""}})}).then(function(t){var r=t.blob,o=t.contentType;return new Promise(function(t,e){var n=new FileReader;n.onloadend=function(){return t({contentType:o,blob:n.result})},n.onerror=e,n.readAsDataURL(r)})}).then(function(t){var e=t.blob;return{contentType:t.contentType,blob:e.split(/,/)[1]}}).catch(function(t){var e="";!o.imagePlaceholder||(n=o.imagePlaceholder.split(/,/))&&n[1]&&(e=n[1]);var n="Failed to fetch resource: "+r;return(n=t?"string"==typeof t?t:t.message:n)&&console.error(n),{blob:e,contentType:""}});return p[t]=e}function m(t,e,n){var r,o=window.getComputedStyle(t,n),i=o.getPropertyValue("content");if(""!==i&&"none"!==i){var u=s();try{e.className=e.className+" "+u}catch(t){return}var c=document.createElement("style");c.appendChild((n="."+(i=u)+":"+(u=n),o=(o=o).cssText?(u=(i=o).getPropertyValue("content"),i.cssText+" content: '"+u.replace(/'|"/g,"")+"';"):d(r=o).map(function(t){return t+": "+r.getPropertyValue(t)+(r.getPropertyPriority(t)?" !important":"")+";"}).join(" "),document.createTextNode(n+"{"+o+"}"))),e.appendChild(c)}}function w(r,o){return a(this,void 0,void 0,function(){return f(this,function(t){return o instanceof Element?[2,Promise.resolve().then(function(){var t,e,n;t=o,e=window.getComputedStyle(r),(n=t.style)&&(e.cssText?n.cssText=e.cssText:d(e).forEach(function(t){n.setProperty(t,e.getPropertyValue(t),e.getPropertyPriority(t))}))}).then(function(){var t,e;m(t=r,e=o,":before"),m(t,e,":after")}).then(function(){return e=o,(t=r)instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),void(t instanceof HTMLInputElement&&e.setAttribute("value",t.value));var t,e}).then(function(){return o})]:[2,Promise.resolve(o)]})})}function y(e,n,r){return a(this,void 0,void 0,function(){return f(this,function(t){return r||!n.filter||n.filter(e)?[2,Promise.resolve(e).then(function(t){return function(e,n){return a(this,void 0,void 0,function(){return f(this,function(t){return e instanceof HTMLCanvasElement?[2,function(n){return a(this,void 0,void 0,function(){var e;return f(this,function(t){return"data:,"===(e=n.toDataURL())?[2,Promise.resolve(n.cloneNode(!1))]:[2,v(e)]})})}(e)]:e instanceof HTMLVideoElement&&e.poster?[2,function(e,n){return a(this,void 0,void 0,function(){return f(this,function(t){return[2,Promise.resolve(e.poster).then(function(t){return g(t,n)}).then(function(t){return h(t.blob,l(e.poster)||t.contentType)}).then(v)]})})}(e,n)]:[2,Promise.resolve(e.cloneNode(!1))]})})}(t,n)}).then(function(t){return function(n,r,o){var i;return a(this,void 0,void 0,function(){var e;return f(this,function(t){return 0===(e=null!=n.tagName&&"SLOT"===n.tagName.toUpperCase()&&n.assignedNodes?d(n.assignedNodes()):d((null!==(i=n.shadowRoot)&&void 0!==i?i:n).childNodes)).length||n instanceof HTMLVideoElement?[2,Promise.resolve(r)]:[2,e.reduce(function(t,e){return t.then(function(){return y(e,o)}).then(function(t){t&&r.appendChild(t)})},Promise.resolve()).then(function(){return r})]})})}(e,t,n)}).then(function(t){return w(e,t)})]:[2,Promise.resolve(null)]})})}var b=/url\((['"]?)([^'"]+?)\1\)/g,P=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,S=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function x(t){var r=[];return t.replace(b,function(t,e,n){return r.push(n),t}),r.filter(function(t){return!u(t)})}function E(t){return-1!==t.search(b)}function T(o,c,s){return a(this,void 0,void 0,function(){var n;return f(this,function(t){return E(o)?(e=o,r=s.preferredFontFormat,n=r?e.replace(S,function(t){for(;;){var e=P.exec(t)||[],n=e[0],e=e[2];if(!e)return"";if(e===r)return"src: "+n+";"}}):e,[2,Promise.resolve(n).then(x).then(function(t){return t.reduce(function(t,u){return t.then(function(t){return n=t,r=u,e=s,i=(t=c)?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;var n=document.implementation.createHTMLDocument(),r=n.createElement("base"),o=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(o),e&&(r.href=e),o.href=t,o.href}(r,t):r,Promise.resolve(i).then(function(t){return o?o(t):g(t,e)}).then(function(t){return"string"==typeof t?h(t,l(r)):h(t.blob,l(r)||t.contentType)}).then(function(t){return n.replace((e=r.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),new RegExp("(url\\(['\"]?)("+e+")(['\"]?\\))","g")),"$1"+t+"$3");var e}).then(function(t){return t},function(){return i});var n,r,e,o,i})},Promise.resolve(n))})]):[2,Promise.resolve(o)];var e,r})})}var C={};function R(e){var t=C[e];if(null!=t)return t;t=window.fetch(e).then(function(t){return{url:e,cssText:t.text()}});return C[e]=t}function L(n){return a(this,void 0,void 0,function(){return f(this,function(t){return[2,n.cssText.then(function(t){var i=t,e=/url\(["']?([^"')]+)["']?\)/g,t=(i.match(/url\([^)]+\)/g)||[]).map(function(o){var t=o.replace(e,"$1");return t.startsWith("https://")||(t=new URL(t,n.url).href),window.fetch(t).then(function(t){return t.blob()}).then(function(r){return new Promise(function(t,e){var n=new FileReader;n.onloadend=function(){i=i.replace(o,"url("+n.result+")"),t([o,n.result])},n.onerror=e,n.readAsDataURL(r)})})});return Promise.all(t).then(function(){return i})})]})})}function N(t){if(null==t)return[];for(var e=[],n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,""),r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");null!==(o=r.exec(n));)e.push(o[0]);for(var o,n=n.replace(r,""),i=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,u=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){if(null===(o=i.exec(n))){if(null===(o=u.exec(n)))break;i.lastIndex=u.lastIndex}else u.lastIndex=i.lastIndex;e.push(o[0])}return e}function k(t){return t.filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return E(t.style.getPropertyValue("src"))})}function A(e,n){return a(this,void 0,void 0,function(){return f(this,function(t){return[2,function(n){return a(this,void 0,void 0,function(){return f(this,function(t){return[2,new Promise(function(t,e){null==n.ownerDocument&&e(new Error("Provided element is not within a Document")),t(d(n.ownerDocument.styleSheets))}).then(function(t){return function(i){return a(this,void 0,void 0,function(){var n,o;return f(this,function(t){return n=[],o=[],i.forEach(function(r){if("cssRules"in r)try{d(r.cssRules).forEach(function(t,e){var n;t.type===CSSRule.IMPORT_RULE&&(n=e+1,t=R(t.href).then(function(t){return t?L(t):""}).then(function(t){return N(t).forEach(function(e){try{r.insertRule(e,e.startsWith("@import")?n+=1:r.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:e,error:t})}})}).catch(function(t){console.error("Error loading remote css",t.toString())}),o.push(t))})}catch(t){var e=i.find(function(t){return null==t.href})||document.styleSheets[0];null!=r.href&&o.push(R(r.href).then(function(t){return t?L(t):""}).then(function(t){return N(t).forEach(function(t){e.insertRule(t,r.cssRules.length)})}).catch(function(t){console.error("Error loading remote stylesheet",t.toString())})),console.error("Error inlining remote css file",t.toString())}}),[2,Promise.all(o).then(function(){return i.forEach(function(e){if("cssRules"in e)try{d(e.cssRules).forEach(function(t){n.push(t)})}catch(t){console.error("Error while reading CSS rules from "+e.href,t.toString())}}),n})]})})}(t)}).then(k)]})})}(e).then(function(t){return Promise.all(t.map(function(t){var e=t.parentStyleSheet?t.parentStyleSheet.href:null;return T(t.cssText,e,n)}))}).then(function(t){return t.join("\n")})]})})}function I(t,e){var n,r,o;return{width:(e=void 0===e?{}:e).width||(r=i(n=t,"border-left-width"),o=i(n,"border-right-width"),n.clientWidth+r+o),height:e.height||(e=i(o=t,"border-top-width"),t=i(o,"border-bottom-width"),o.clientHeight+e+t)}}function M(o,i){return void 0===i&&(i={}),a(this,void 0,void 0,function(){var e,n,r;return f(this,function(t){return e=I(o,i),n=e.width,r=e.height,[2,Promise.resolve(o).then(function(t){return y(t,i,!0)}).then(function(t){return function(n,e){return a(this,void 0,void 0,function(){return f(this,function(t){return[2,(null!=e.fontEmbedCSS?Promise.resolve(e.fontEmbedCSS):A(n,e)).then(function(t){var e=document.createElement("style"),t=document.createTextNode(t);return e.appendChild(t),n.firstChild?n.insertBefore(e,n.firstChild):n.appendChild(e),n})]})})}(t,i)}).then(function(t){return function o(e,n){return a(this,void 0,void 0,function(){return f(this,function(t){return e instanceof Element?[2,Promise.resolve(e).then(function(t){return function(n,r){var o;return a(this,void 0,void 0,function(){var e;return f(this,function(t){return(e=null===(o=n.style)||void 0===o?void 0:o.getPropertyValue("background"))?[2,Promise.resolve(e).then(function(t){return T(t,null,r)}).then(function(t){return n.style.setProperty("background",t,n.style.getPropertyPriority("background")),n})]:[2,Promise.resolve(n)]})})}(t,n)}).then(function(t){return function(r,n){return a(this,void 0,void 0,function(){var e;return f(this,function(t){return r instanceof HTMLImageElement&&!u(r.src)||r instanceof SVGImageElement&&!u(r.href.baseVal)?(e=r instanceof HTMLImageElement?r.src:r.href.baseVal,[2,Promise.resolve(e).then(function(t){return g(t,n)}).then(function(t){return h(t.blob,l(e)||t.contentType)}).then(function(n){return new Promise(function(t,e){r.onload=t,r.onerror=e,r instanceof HTMLImageElement?(r.srcset="",r.src=n):r.href.baseVal=n})}).then(function(){return r},function(){return r})]):[2,Promise.resolve(r)]})})}(t,n)}).then(function(t){return function(n,r){return a(this,void 0,void 0,function(){var e;return f(this,function(t){return e=(e=d(n.childNodes)).map(function(t){return o(t,r)}),[2,Promise.all(e).then(function(){return n})]})})}(t,n)})]:[2,Promise.resolve(e)]})})}(t,i)}).then(function(t){return function(t,e){var n=t.style;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=e.width+"px"),e.height&&(n.height=e.height+"px");var r=e.style;return null!=r&&Object.keys(r).forEach(function(t){n[t]=r[t]}),t}(t,i)}).then(function(t){return function(r,o,i){return a(this,void 0,void 0,function(){var e,n;return f(this,function(t){return n="http://www.w3.org/2000/svg",e=document.createElementNS(n,"svg"),n=document.createElementNS(n,"foreignObject"),e.setAttribute("width",""+o),e.setAttribute("height",""+i),e.setAttribute("viewBox","0 0 "+o+" "+i),n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("externalResourcesRequired","true"),e.appendChild(n),n.appendChild(r),[2,function(e){return a(this,void 0,void 0,function(){return f(this,function(t){return[2,Promise.resolve().then(function(){return(new XMLSerializer).serializeToString(e)}).then(encodeURIComponent).then(function(t){return"data:image/svg+xml;charset=utf-8,"+t})]})})}(e)]})})}(t,n,r)})]})})}var D=16384;function V(u,c){return void 0===c&&(c={}),a(this,void 0,void 0,function(){return f(this,function(t){return[2,M(u,c).then(v).then(function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=c.pixelRatio||function(){var t;try{e=process}catch(t){}var e=e&&e.env?e.env.devicePixelRatio:null;return e&&(t=parseInt(e,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),o=I(u,c),i=o.width,o=o.height,i=c.canvasWidth||i,o=c.canvasHeight||o;return e.width=i*r,e.height=o*r,c.skipAutoScale||((r=e).width>D||r.height>D)&&(r.width>D&&r.height>D?r.width>r.height?(r.height*=D/r.width,r.width=D):(r.width*=D/r.height,r.height=D):r.width>D?(r.height*=D/r.width,r.width=D):(r.width*=D/r.height,r.height=D)),e.style.width=""+i,e.style.height=""+o,c.backgroundColor&&(n.fillStyle=c.backgroundColor,n.fillRect(0,0,e.width,e.height)),n.drawImage(t,0,0,e.width,e.height),e})]})})}t.getFontEmbedCSS=function(e,n){return void 0===n&&(n={}),a(this,void 0,void 0,function(){return f(this,function(t){return[2,A(e,n)]})})},t.toBlob=function(e,n){return void 0===n&&(n={}),a(this,void 0,void 0,function(){return f(this,function(t){return[2,V(e,n).then(c)]})})},t.toCanvas=V,t.toJpeg=function(e,n){return void 0===n&&(n={}),a(this,void 0,void 0,function(){return f(this,function(t){return[2,V(e,n).then(function(t){return t.toDataURL("image/jpeg",n.quality||1)})]})})},t.toPixelData=function(o,i){return void 0===i&&(i={}),a(this,void 0,void 0,function(){var e,n,r;return f(this,function(t){return e=I(o,i),n=e.width,r=e.height,[2,V(o,i).then(function(t){return t.getContext("2d").getImageData(0,0,n,r).data})]})})},t.toPng=function(e,n){return void 0===n&&(n={}),a(this,void 0,void 0,function(){return f(this,function(t){return[2,V(e,n).then(function(t){return t.toDataURL()})]})})},t.toSvg=M,Object.defineProperty(t,"__esModule",{value:!0})});