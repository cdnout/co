/*! Qoopido.js library 3.7.4, 2015-08-14 | https://github.com/dlueth/qoopido.js | (c) 2015 Dirk Lueth */
!function(e,t){t.qoopido.register("pool",e,["./base","./function/merge","./function/unique/uuid"])}(function(e,t,i,n){"use strict";function o(){var e,t,i,n=this,o=n.metrics,u=n._settings,r=n._queue,s=n._variables,a=1;if(r.length>0&&(s.durationAverage>0&&(a=~~((a=u.frameBudget/s.durationAverage)<1?1:a)),(e=Math.min(r.length,(t=r.splice(0,a)).length))>0))if(o.inPool+e<=u.maxPoolsize){i=(new Date).getTime();for(var l=0;e>l;l++){var c=t[l],d=c._puid,_=c.dispose;c=n._dispose(c),c._puid=d,c.dispose=_,n._getPool.call(n,c).push(c)}o.inPool+=e,o.inQueue-=e,s.durationSamples+=e,s.durationTotal+=(new Date).getTime()-i,s.durationAverage=s.durationTotal/s.durationSamples}else{if("function"==typeof n._destroy)for(var p=0;e>p;p++)n._destroy(t[p]);t.length=0,o.inQueue-=e,o.destroyed+=e}}var u,r={interval:1e3/60,frameBudget:.5,maxPoolsize:1e3};return u=e.base.extend({metrics:null,_settings:null,_pool:null,_queue:null,_variables:null,_constructor:function(t){var i=this;return i.metrics={total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},i._settings=e["function/merge"]({},r,t),i._pool=i._initPool(),i._queue=[],i._variables={durationSamples:0,durationTotal:0,durationAverage:0},setInterval(function(){o.call(i)},i._settings.interval),i},_initPool:function(){return[]},_initElement:function(t){var i=this;return t._puid=e["function/unique/uuid"](),t.dispose=function(){i.dispose(t)},i.metrics.total++,t},_getPool:function(){return this._pool},obtain:function(){var e=this,t=e._getPool.apply(e,arguments).pop();return t?(e.metrics.inPool--,e.metrics.recycled++):t=e._initElement(e._obtain.apply(e,arguments)),"function"==typeof t._obtain&&t._obtain.apply(t,arguments),e.metrics.inUse++,t},dispose:function(e){var t=this,i=t._queue;return e._puid||(e=t._initElement(e),t.metrics.inUse++),"function"==typeof e._dispose&&e._dispose(),i.push(e),t.metrics.inUse--,t.metrics.inQueue++,null}})},this);