/*! Qoopido.js library 3.7.4, 2015-08-14 | https://github.com/dlueth/qoopido.js | (c) 2015 Dirk Lueth */
!function(t,e){var n=["../element","../../proxy","../../function/merge","../../url","../../support","../../support/capability/datauri","../../support/element/canvas/todataurl/png","../../transport/xhr"];e.qoopido.register("dom/element/shrinkimage",t,n)}(function(t,e,n,i){"use strict";function a(e,n){e=t.url.resolve(b.exec(e)[1]),n=n===!0;var i=this,a=t["function/merge"]({},i._settings,t.url.getParameter(e)),o=a.target||(e=e.split("?")[0]).replace(y,"".concat(".q",a.quality,".shrunk"));n||i.removeAttribute(i._settings.attribute).hide(),v.then(function(){if(a.debug===!0)throw new Error("[Qoopido.js] Debug enabled");switch(typeof m[o]){case"object":m[o].one(_,function(t){r.call(i,t.data,n)}),i.emit(w);break;case"string":r.call(i,m[o],n);break;default:m[o]=s.create(o,n?null:i.element).one(I,function(t,a){t.type===_?(m[o]=a,i.emit(x),r.call(i,a,n)):(m[o]=e,r.call(i,e,n))},!1)}})["catch"](function(){m[o]=e,r.call(i,e,n)})}function r(t,e){var n=this;e?(n.setStyle("backgroundImage","url("+t+")"),n.emit(_)):n.one(E,function(){n.show(),n.emit(_)}).setAttribute("src",t)}function o(t){var e=this;t.get(e._url).then(function(t){try{var n=d.parse(t.data);n.width=parseInt(n.width,10),n.height=parseInt(n.height,10),c.call(e,n)}catch(i){e.emit(k)}},function(){e.emit(k)})}function c(t){var e,n,i=this,a=function(a){return e=g&&g.obtain("canvas")||h.createElement("canvas"),e.style.display="none",e.width=t.width,e.height=t.height,n=e.getContext("2d"),n.clearRect(0,0,t.width,t.height),n.drawImage(i.element,0,0,t.width,t.height),i.one(E,r).setAttribute("src",t.alpha),l(a)},r=function(a){var r;return n.globalCompositeOperation="xor",n.drawImage(i.element,0,0,t.width,t.height),r=e.toDataURL("image/png"),o(),i.emit(_,r),l(a)},o=function(){e&&e.dispose&&e.dispose(),i.element.dispose&&i.element.dispose()};i.one(A,function(t){t.type===E?a.call(this,t):(o(),i.emit(k))},!1).setAttribute("src",t.main)}function l(t){return t.preventDefault(),t.stopPropagation(),!1}var u,s,h=n.document,d=n.JSON,p={attribute:"data-shrinkimage",quality:80,debug:!1},g=e.pool&&e.pool.dom||null,m={},f=new RegExp('^url\\x28"{0,1}data:image/shrink,(.+?)"{0,1}\\x29$',"i"),b=new RegExp('^(?:url\\x28"{0,1}|)(?:data:image/shrink,|)(.+?)(?:"{0,1}\\x29|)$',"i"),y=new RegExp("\\.png$","i"),v=t.support.testMultiple("/capability/datauri","/element/canvas/todataurl/png"),w="queued",x="cached",_="loaded",k="failed",I="".concat(_," ",k),E="load",q="error",A="".concat(E," ",q);return u=t["dom/element"].extend({_constructor:function(e,n){var i,r,o=u._parent._constructor.call(this,e);return o._settings=n=t["function/merge"]({},p,n),i=o.getAttribute(n.attribute),r=o.getStyle("backgroundImage"),"IMG"===o.type&&a.call(o,i),"none"!==r&&f.test(r)&&a.call(o,r,!0),o},hide:function(){this.setStyles({visibility:"hidden",opacity:0})},show:function(){this.setStyles({visibility:"",opacity:""})}}),s=t["dom/element"].extend({_url:null,_constructor:function(e,n){var i;return n||(n=g&&g.obtain("img")||h.createElement("img")),i=s._parent._constructor.call(this,n),i._url=e,o.call(i,t["transport/xhr"]),i}}),u},this);