/*! Qoopido.js library 3.7.4, 2015-08-14 | https://github.com/dlueth/qoopido.js | (c) 2015 Dirk Lueth */
!function(e,o){o.qoopido.register("asset",e,["./emitter","./transport/xhr","./promise/defer","./function/unique/uuid"])}(function(e,o,t,r){"use strict";function i(e){p.push(e),1===p.length&&n()}function n(){u(p[0]).then(function(){p.splice(0,1)&&p.length>=1&&n()},function(){p.splice(0,1)&&p.length>=1&&n()})}function u(e){var o=l[e._uuid],t=o.dfd,r=o.url;return s.get(r,null,d).then(function(i){var n=i.data,u=o.id,a=o.version,l=o.storage;e.emit("loaded",r,u,a,n),l&&(c.cookie=o.cookie+"="+encodeURIComponent(a)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/",localStorage[l.version]=a,localStorage[l.value]=n,e.emit("stored",r,u,a,n,l.version,l.value)),t.resolve(localStorage[l.value])},function(){t.reject()})}var a,c=t.document,l={},s=e["transport/xhr"],d={cache:!0},v=e["promise/defer"],f=e["function/unique/uuid"],g=new RegExp("/","g"),p=[];return a=e.emitter.extend({_uuid:null,_constructor:function(e,o,t){var r=a._parent._constructor.call(this),i=f(),n=l[i]={dfd:new v,url:e};return r._uuid=i,o&&t&&(n.id=o,n.version=t,n.cookie=encodeURIComponent("qoopido[asset]["+o.replace(g,"][")+"]"),n.storage={version:"@"+o,value:"Â©"+o}),r},fetch:function(){var e=this,o=l[e._uuid],t=o.dfd,r=o.url,n=o.id,u=o.version,a=o.storage,c=a&&a.version&&localStorage[a.version];if(c&&c>=u){var s=localStorage[o.storage.value];e.emit("hit",r,n,u,s),t.resolve(s)}else e.emit("miss",r,n,u),i(e);return t.promise},clear:function(){var e=this,o=l[e._uuid],t=o.storage;return t&&(c.cookie=o.cookie+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",delete localStorage[t.version],delete localStorage[t.value],e.emit("cleared",o.url,o.id,o.version)),e}})},this);