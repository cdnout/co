{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 87506f6a3a7d049311c0","webpack:///./src/clappr-dash-shaka-playback.js","webpack:///external \"Clappr\"","webpack:///external \"shaka\""],"names":[],"mappings":"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","file":"dash-shaka-playback.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"Clappr\"), require(\"shaka\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"Clappr\", \"shaka\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DashShakaPlayback\"] = factory(require(\"Clappr\"), require(\"shaka\"));\n\telse\n\t\troot[\"DashShakaPlayback\"] = factory(root[\"Clappr\"], root[\"shaka\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 87506f6a3a7d049311c0","import {HTML5Video, Log, Events} from 'clappr'\nimport shaka from 'shaka-player'\n\nconst SEND_STATS_INTERVAL_MS = 30 * 1e3\nconst DEFAULT_LEVEL_AUTO = -1\n\nclass DashShakaPlayback extends HTML5Video {\n  static get Events () {\n    return {\n      SHAKA_READY: 'shaka:ready'\n    }\n  }\n\n  static canPlay (resource, mimeType = '') {\n    shaka.polyfill.installAll()\n    var browserSupported = shaka.Player.isBrowserSupported()\n    var resourceParts = resource.split('?')[0].match(/.*\\.(.*)$/) || []\n    return browserSupported && ((resourceParts[1] === 'mpd') || mimeType.indexOf('application/dash+xml') > -1)\n  }\n\n  get name () {\n    return 'dash_shaka_playback'\n  }\n\n  get shakaVersion () {\n    return shaka.player.Player.version\n  }\n\n  get shakaPlayerInstance () {\n    return this._player\n  }\n\n  get levels () {\n    return this._levels\n  }\n\n  set currentLevel (id) {\n    this._currentLevelId = id\n    var isAuto = this._currentLevelId === DEFAULT_LEVEL_AUTO\n\n    this._player.configure({abr: {enable: !isAuto}})\n    this.trigger(Events.PLAYBACK_LEVEL_SWITCH_START)\n    if (!isAuto) {\n      this.selectTrack(this.videoTracks.filter((t) => t.id === this._currentLevelId)[0])\n    }\n    this.trigger(Events.PLAYBACK_LEVEL_SWITCH_END)\n  }\n\n  get currentLevel () {\n    return this._currentLevelId || DEFAULT_LEVEL_AUTO\n  }\n\n  constructor (options) {\n    super(options)\n    this._levels = []\n    options.autoPlay && this.play()\n  }\n\n  play () {\n    if (!this._player) {\n      this._setup()\n    }\n\n    if (!this.isReady) {\n      this.once(DashShakaPlayback.Events.SHAKA_READY, this.play)\n      return\n    }\n\n    this._src = this.el.src\n    super.play()\n  }\n\n  // skipping setup `setupSrc` on tag video\n  setupSrc () {}\n\n  // skipping ready event on video tag in favor of ready on shaka\n  _ready () {}\n\n  get isReady () {\n    return this._isShakaReadyState\n  }\n\n  // skipping error handling on video tag in favor of error on shaka\n  error (event) {\n    Log.error('an error was raised by the video tag', event, this.el.error)\n  }\n\n  isHighDefinitionInUse () {\n    return !!this.highDefinition\n  }\n\n  stop () {\n    clearInterval(this.sendStatsId)\n    this._sendStats()\n\n    this._player.unload().then(() => {\n      super.stop()\n      this._player = null\n      this._isShakaReadyState = false\n    }).catch(() => {\n      Log.error('shaka could not be unloaded')\n    })\n  }\n\n  get textTracks () {\n    return this._player && this._player.getTextTracks()\n  }\n\n  get audioTracks () {\n    return this._player && this._player.getVariantTracks().filter((t) => t.mimeType.startsWith('audio/'))\n  }\n\n  get videoTracks () {\n    return this._player && this._player.getVariantTracks().filter((t) => t.mimeType.startsWith('video/'))\n  }\n\n  getPlaybackType () {\n    return (this._player && this._player.isLive() ? 'live' : 'vod') || ''\n  }\n\n  selectTrack (track) {\n    this._player.selectTrack(track)\n    this._onAdaptation()\n  }\n\n  destroy () {\n    clearInterval(this.sendStatsId)\n\n    if (this._player) {\n      this._destroy()\n    } else {\n      this._player.destroy()\n        .then(() => this._destroy())\n        .catch(() => {\n          this._destroy()\n          Log.error('shaka could not be destroyed')\n        })\n    }\n  }\n\n  _setup () {\n    this._isShakaReadyState = false\n    this._player = this._createPlayer()\n    this._options.shakaConfiguration && this._player.configure(this._options.shakaConfiguration)\n    this._options.shakaOnBeforeLoad && this._options.shakaOnBeforeLoad(this._player)\n\n    var playerLoaded = this._player.load(this._options.src)\n    playerLoaded.then(() => this._loaded())\n      .catch((e) => this._setupError(e))\n  }\n\n  _createPlayer () {\n    var player = new shaka.Player(this.el)\n    player.addEventListener('error', this._onError.bind(this))\n    player.addEventListener('adaptation', this._onAdaptation.bind(this))\n    player.addEventListener('buffering', this._onBuffering.bind(this))\n    return player\n  }\n\n  _onBuffering (e) {\n    var event = e.buffering ? Events.PLAYBACK_BUFFERING : Events.PLAYBACK_BUFFERFULL\n    this.trigger(event)\n  }\n\n  _loaded () {\n    this._isShakaReadyState = true\n    this.trigger(DashShakaPlayback.Events.SHAKA_READY)\n    super._ready()\n    this._startToSendStats()\n    this._fillLevels()\n  }\n\n  _fillLevels () {\n    if (this._levels.length === 0) {\n      this._levels = this.videoTracks.map((videoTrack) => { return {id: videoTrack.id, label: `${videoTrack.height}p`} }).reverse()\n      this.trigger(Events.PLAYBACK_LEVELS_AVAILABLE, this.levels)\n    }\n  }\n\n  _startToSendStats () {\n    const intervalMs = this._options.shakaSendStatsInterval || SEND_STATS_INTERVAL_MS\n    this.sendStatsId = setInterval(() => this._sendStats(), intervalMs)\n  }\n\n  _sendStats () {\n    this.trigger(Events.PLAYBACK_STATS_ADD, this._player.getStats())\n  }\n\n  _setupError (err) {\n    this._onError(err)\n  }\n\n  _onError (err) {\n    Log.error('Shaka error event:', err)\n    this.trigger(Events.PLAYBACK_ERROR, err, this.name)\n  }\n\n  _onAdaptation () {\n    var activeVideo = this.videoTracks.filter((t) => t.active === true)[0]\n\n    this._fillLevels()\n\n    Log.debug('an adaptation has happened:', activeVideo)\n    this.highDefinition = (activeVideo.height >= 720)\n    this.trigger(Events.PLAYBACK_HIGHDEFINITIONUPDATE, this.highDefinition)\n    this.trigger(Events.PLAYBACK_BITRATE, {\n      bandwidth: activeVideo.bandwidth,\n      width: activeVideo.width,\n      height: activeVideo.height,\n      level: activeVideo.id\n    })\n  }\n\n  _destroy () {\n    super.destroy()\n    this._isShakaReadyState = false\n    Log.debug('shaka was destroyed')\n  }\n}\n\nexport default DashShakaPlayback\n\n\n\n// WEBPACK FOOTER //\n// ./src/clappr-dash-shaka-playback.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Clappr\"\n// module id = 1\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shaka\"\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}