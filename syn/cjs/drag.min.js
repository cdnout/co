var syn=require("./synthetic.js"),elementFromPoint=function(e,t){var n,r=e.clientX,o=e.clientY;return null==e?null:(syn.support.elementFromPage&&(r+=(n=syn.helpers.scrollOffset(t)).left,o+=n.top),t.document.elementFromPoint(Math.round(r),Math.round(o)))},DragonDrop={html5drag:!1,focusWindow:null,dragAndDrop:function(e,t,n,r,o){this.currentDataTransferItem=null,this.focusWindow=e,this._mouseOver(t),this._mouseEnter(t),this._mouseMove(t),this._mouseDown(t),this._dragStart(t),this._drag(t),this._dragEnter(t),this._dragOver(t),DragonDrop.startMove(t,n,r,function(){DragonDrop._dragLeave(t),DragonDrop._dragEnd(t),DragonDrop._mouseOut(t),DragonDrop._mouseLeave(t),DragonDrop._drop(n),DragonDrop._dragEnd(n),DragonDrop._mouseOver(n),DragonDrop._mouseEnter(n),DragonDrop._mouseMove(n),DragonDrop._mouseOut(n),DragonDrop._mouseLeave(n),o(),DragonDrop.cleanup()})},_dragStart:function(e){this.createAndDispatchEvent(e,"dragstart",{bubbles:!1,cancelable:!1})},_drag:function(e){this.createAndDispatchEvent(e,"drag",{bubbles:!0,cancelable:!0})},_dragEnter:function(e){this.createAndDispatchEvent(e,"dragenter",{bubbles:!0,cancelable:!0})},_dragOver:function(e){this.createAndDispatchEvent(e,"dragover",{bubbles:!0,cancelable:!0})},_dragLeave:function(e){this.createAndDispatchEvent(e,"dragleave",{bubbles:!0,cancelable:!1})},_drop:function(e){this.createAndDispatchEvent(e,"drop",{bubbles:!0,cancelable:!0,buttons:1})},_dragEnd:function(e){this.createAndDispatchEvent(e,"dragend",{bubbles:!0,cancelable:!1})},_mouseDown:function(e,t){this.createAndDispatchEvent(e,"mousedown",t)},_mouseMove:function(e,t){this.createAndDispatchEvent(e,"mousemove",t)},_mouseEnter:function(e,t){this.createAndDispatchEvent(e,"mouseenter",t)},_mouseOver:function(e,t){this.createAndDispatchEvent(e,"mouseover",t)},_mouseOut:function(e,t){this.createAndDispatchEvent(e,"mouseout",t)},_mouseLeave:function(e,t){this.createAndDispatchEvent(e,"mouseleave",t)},createAndDispatchEvent:function(e,t,n){var r;e&&(r=elementFromPoint(e,this.focusWindow),syn.trigger(r,t,n))},getDataTransferObject:function(){return this.currentDataTransferItem?this.currentDataTransferItem:this.currentDataTransferItem=this.createDataTransferObject()},cleanup:function(){this.currentDataTransferItem=null,this.focusWindow=null},createDataTransferObject:function(){return{dropEffect:"none",effectAllowed:"uninitialized",files:[],items:[],types:[],data:[],setData:function(e,t){var n={};n.dataFlavor=e,n.val=t,this.data.push(n)},getData:function(e){for(var t=0;t<this.data.length;t++){var n=this.data[t];if(n.dataFlavor===e)return n.val}}}},startMove:function(o,a,s,i){function c(){var e=new Date,t=syn.helpers.scrollOffset(d),n=(0===m?0:e-u)/s,r={clientX:p*n+o.clientX,clientY:l*n+o.clientY};m++,n<1?(syn.helpers.extend(g.style,{left:r.clientX+t.left+2+"px",top:r.clientY+t.top+2+"px"}),v=DragonDrop.mouseMove(r,v),syn.schedule(c,15)):(v=DragonDrop.mouseMove(a,v),d.document.body.removeChild(g),i())}var u=new Date,p=a.clientX-o.clientX,l=a.clientY-o.clientY,d=this.focusWindow,v=o,g=d.document.createElement("div"),m=0;syn.helpers.extend(g.style,{height:"5px",width:"5px",backgroundColor:"red",position:"absolute",zIndex:19999,fontSize:"1px"}),d.document.body.appendChild(g),c()},mouseMove:function(e,t){var n=elementFromPoint(e,this.focusWindow),r=elementFromPoint(t,this.focusWindow),o=syn.helpers.extend({},e);return n!==r&&(o.relatedTarget=n,this._dragLeave(t,o),o.relatedTarget=r,this._dragEnter(e,o)),this._dragOver(e,o),e}};function createDragEvent(e,t,n){var r=syn.create.mouse.event(e,t,n);return r.dataTransfer=DragonDrop.getDataTransferObject(),syn.dispatch(r,n,e,!1)}syn.create.dragstart={event:createDragEvent},syn.create.dragenter={event:createDragEvent},syn.create.dragover={event:createDragEvent},syn.create.dragleave={event:createDragEvent},syn.create.drag={event:createDragEvent},syn.create.drop={event:createDragEvent},syn.create.dragend={event:createDragEvent},function e(){var t;document.body?(t=document.createElement("div"),document.body.appendChild(t),syn.helpers.extend(t.style,{width:"100px",height:"10000px",backgroundColor:"blue",position:"absolute",top:"10px",left:"0px",zIndex:19999}),document.body.scrollTop=11,document.elementFromPoint&&(document.elementFromPoint(3,1)===t?syn.support.elementFromClient=!0:syn.support.elementFromPage=!0,document.body.removeChild(t),document.body.scrollTop=0)):syn.schedule(e,1)}();var mouseMove=function(e,t,n){var r,o=elementFromPoint(e,t);return n!==o&&o&&n&&((r=syn.helpers.extend({},e)).relatedTarget=o,syn.support.pointerEvents&&(syn.trigger(n,"pointerout",r),syn.trigger(n,"pointerleave",r)),syn.trigger(n,"mouseout",r),syn.trigger(n,"mouseleave",r),r.relatedTarget=n,syn.support.pointerEvents&&(syn.trigger(o,"pointerover",r),syn.trigger(o,"pointerenter",r)),syn.trigger(o,"mouseover",r),syn.trigger(o,"mouseenter",r)),syn.support.pointerEvents&&syn.trigger(o||t,"pointermove",e),syn.support.touchEvents&&syn.trigger(o||t,"touchmove",e),DragonDrop.html5drag&&syn.support.pointerEvents||syn.trigger(o||t,"mousemove",e),o},createEventAtPoint=function(e,t,n){var r=elementFromPoint(t,n);return syn.trigger(r||n,e,t),r},startMove=function(o,a,s,i,c){function u(){var e=new Date,t=syn.helpers.scrollOffset(o),n=(0===m?0:e-p)/i,r={clientX:l*n+a.clientX,clientY:d*n+a.clientY};m++,n<1?(syn.helpers.extend(g.style,{left:r.clientX+t.left+2+"px",top:r.clientY+t.top+2+"px"}),v=mouseMove(r,o,v),syn.schedule(u,15)):(v=mouseMove(s,o,v),o.document.body.removeChild(g),c())}var p=new Date,l=s.clientX-a.clientX,d=s.clientY-a.clientY,v=elementFromPoint(a,o),g=o.document.createElement("div"),m=0;syn.helpers.extend(g.style,{height:"5px",width:"5px",backgroundColor:"red",position:"absolute",zIndex:19999,fontSize:"1px"}),o.document.body.appendChild(g),u()},startDrag=function(e,t,n,r,o){syn.support.pointerEvents&&(createEventAtPoint("pointerover",t,e),createEventAtPoint("pointerenter",t,e)),createEventAtPoint("mouseover",t,e),createEventAtPoint("mouseenter",t,e),syn.support.pointerEvents&&createEventAtPoint("pointermove",t,e),createEventAtPoint("mousemove",t,e),syn.support.pointerEvents&&createEventAtPoint("pointerdown",t,e),syn.support.touchEvents&&createEventAtPoint("touchstart",t,e),createEventAtPoint("mousedown",t,e),startMove(e,t,n,r,function(){syn.support.pointerEvents&&createEventAtPoint("pointerup",n,e),syn.support.touchEvents&&createEventAtPoint("touchend",n,e),createEventAtPoint("mouseup",n,e),syn.support.pointerEvents&&createEventAtPoint("pointerleave",n,e),createEventAtPoint("mouseleave",n,e),o()})},center=function(e){var t=syn.jquery()(e),n=t.offset();return{pageX:n.left+t.outerWidth()/2,pageY:n.top+t.outerHeight()/2}},convertOption=function(e,t,n){var r,o,a,s=/(\d+)[x ](\d+)/,i=/(\d+)X(\d+)/,c=/([+-]\d+)[xX ]([+-]\d+)/;return"string"==typeof e&&c.test(e)&&n&&(r=center(n),o=e.match(c),e={pageX:r.pageX+parseInt(o[1]),pageY:r.pageY+parseInt(o[2])}),"string"==typeof e&&s.test(e)&&(o=e.match(s),e={pageX:parseInt(o[1]),pageY:parseInt(o[2])}),"string"==typeof e&&i.test(e)&&(o=e.match(i),e={clientX:parseInt(o[1]),clientY:parseInt(o[2])}),"string"==typeof e&&(e=syn.jquery()(e,t.document)[0]),e.nodeName&&(e=center(e)),null!=e.pageX&&(a=syn.helpers.scrollOffset(t),e={clientX:e.pageX-a.left,clientY:e.pageY-a.top}),e},adjust=function(e,t,n){var r,o,a;e.clientY<0&&(a=(o=(r=syn.helpers.scrollOffset(n)).top+e.clientY-100)-r.top,0<o||(o=0,a=-r.top),e.clientY=e.clientY-a,t.clientY=t.clientY-a,syn.helpers.scrollOffset(n,{top:o,left:r.left}))};syn.helpers.extend(syn.init.prototype,{_move:function(e,t,n){var r=syn.helpers.getWindow(e),o=convertOption(t.from||e,r,e),a=convertOption(t.to||t,r,e);DragonDrop.html5drag=syn.support.pointerEvents,!1!==t.adjust&&adjust(o,a,r),startMove(r,o,a,t.duration||500,n)},_drag:function(e,t,n){var r=syn.helpers.getWindow(e),o=convertOption(t.from||e,r,e),a=convertOption(t.to||t,r,e);!1!==t.adjust&&adjust(o,a,r),DragonDrop.html5drag=e.draggable,DragonDrop.html5drag?DragonDrop.dragAndDrop(r,o,a,t.duration||500,n):startDrag(r,o,a,t.duration||500,n)}});