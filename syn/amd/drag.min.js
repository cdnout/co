define(["require","exports","module","./synthetic"],function(e,t,n){function m(e,t){var n,r=e.clientX,o=e.clientY;return null==e?null:(f.support.elementFromPage&&(r+=(n=f.helpers.scrollOffset(t)).left,o+=n.top),t.document.elementFromPoint(Math.round(r),Math.round(o)))}var f=e("./synthetic"),b={html5drag:!1,focusWindow:null,dragAndDrop:function(e,t,n,r,o){this.currentDataTransferItem=null,this.focusWindow=e,this._mouseOver(t),this._mouseEnter(t),this._mouseMove(t),this._mouseDown(t),this._dragStart(t),this._drag(t),this._dragEnter(t),this._dragOver(t),b.startMove(t,n,r,function(){b._dragLeave(t),b._dragEnd(t),b._mouseOut(t),b._mouseLeave(t),b._drop(n),b._dragEnd(n),b._mouseOver(n),b._mouseEnter(n),b._mouseMove(n),b._mouseOut(n),b._mouseLeave(n),o(),b.cleanup()})},_dragStart:function(e){this.createAndDispatchEvent(e,"dragstart",{bubbles:!1,cancelable:!1})},_drag:function(e){this.createAndDispatchEvent(e,"drag",{bubbles:!0,cancelable:!0})},_dragEnter:function(e){this.createAndDispatchEvent(e,"dragenter",{bubbles:!0,cancelable:!0})},_dragOver:function(e){this.createAndDispatchEvent(e,"dragover",{bubbles:!0,cancelable:!0})},_dragLeave:function(e){this.createAndDispatchEvent(e,"dragleave",{bubbles:!0,cancelable:!1})},_drop:function(e){this.createAndDispatchEvent(e,"drop",{bubbles:!0,cancelable:!0,buttons:1})},_dragEnd:function(e){this.createAndDispatchEvent(e,"dragend",{bubbles:!0,cancelable:!1})},_mouseDown:function(e,t){this.createAndDispatchEvent(e,"mousedown",t)},_mouseMove:function(e,t){this.createAndDispatchEvent(e,"mousemove",t)},_mouseEnter:function(e,t){this.createAndDispatchEvent(e,"mouseenter",t)},_mouseOver:function(e,t){this.createAndDispatchEvent(e,"mouseover",t)},_mouseOut:function(e,t){this.createAndDispatchEvent(e,"mouseout",t)},_mouseLeave:function(e,t){this.createAndDispatchEvent(e,"mouseleave",t)},createAndDispatchEvent:function(e,t,n){var r;e&&(r=m(e,this.focusWindow),f.trigger(r,t,n))},getDataTransferObject:function(){return this.currentDataTransferItem?this.currentDataTransferItem:this.currentDataTransferItem=this.createDataTransferObject()},cleanup:function(){this.currentDataTransferItem=null,this.focusWindow=null},createDataTransferObject:function(){return{dropEffect:"none",effectAllowed:"uninitialized",files:[],items:[],types:[],data:[],setData:function(e,t){var n={};n.dataFlavor=e,n.val=t,this.data.push(n)},getData:function(e){for(var t=0;t<this.data.length;t++){var n=this.data[t];if(n.dataFlavor===e)return n.val}}}},startMove:function(o,a,s,i){function c(){var e=new Date,t=f.helpers.scrollOffset(p),n=(0===g?0:e-u)/s,r={clientX:l*n+o.clientX,clientY:d*n+o.clientY};g++,n<1?(f.helpers.extend(v.style,{left:r.clientX+t.left+2+"px",top:r.clientY+t.top+2+"px"}),h=b.mouseMove(r,h),f.schedule(c,15)):(h=b.mouseMove(a,h),p.document.body.removeChild(v),i())}var u=new Date,l=a.clientX-o.clientX,d=a.clientY-o.clientY,p=this.focusWindow,h=o,v=p.document.createElement("div"),g=0;f.helpers.extend(v.style,{height:"5px",width:"5px",backgroundColor:"red",position:"absolute",zIndex:19999,fontSize:"1px"}),p.document.body.appendChild(v),c()},mouseMove:function(e,t){var n=m(e,this.focusWindow),r=m(t,this.focusWindow),o=f.helpers.extend({},e);return n!==r&&(o.relatedTarget=n,this._dragLeave(t,o),o.relatedTarget=r,this._dragEnter(e,o)),this._dragOver(e,o),e}};function r(e,t,n){var r=f.create.mouse.event(e,t,n);return r.dataTransfer=b.getDataTransferObject(),f.dispatch(r,n,e,!1)}f.create.dragstart={event:r},f.create.dragenter={event:r},f.create.dragover={event:r},f.create.dragleave={event:r},f.create.drag={event:r},f.create.drop={event:r},f.create.dragend={event:r},function e(){var t;document.body?(t=document.createElement("div"),document.body.appendChild(t),f.helpers.extend(t.style,{width:"100px",height:"10000px",backgroundColor:"blue",position:"absolute",top:"10px",left:"0px",zIndex:19999}),document.body.scrollTop=11,document.elementFromPoint&&(document.elementFromPoint(3,1)===t?f.support.elementFromClient=!0:f.support.elementFromPage=!0,document.body.removeChild(t),document.body.scrollTop=0)):f.schedule(e,1)}();function E(e,t,n){var r,o=m(e,t);return n!==o&&o&&n&&((r=f.helpers.extend({},e)).relatedTarget=o,f.support.pointerEvents&&(f.trigger(n,"pointerout",r),f.trigger(n,"pointerleave",r)),f.trigger(n,"mouseout",r),f.trigger(n,"mouseleave",r),r.relatedTarget=n,f.support.pointerEvents&&(f.trigger(o,"pointerover",r),f.trigger(o,"pointerenter",r)),f.trigger(o,"mouseover",r),f.trigger(o,"mouseenter",r)),f.support.pointerEvents&&f.trigger(o||t,"pointermove",e),f.support.touchEvents&&f.trigger(o||t,"touchmove",e),b.html5drag&&f.support.pointerEvents||f.trigger(o||t,"mousemove",e),o}function d(e,t,n){var r=m(t,n);return f.trigger(r||n,e,t),r}function p(o,a,s,i,c){function u(){var e=new Date,t=f.helpers.scrollOffset(o),n=(0===g?0:e-l)/i,r={clientX:d*n+a.clientX,clientY:p*n+a.clientY};g++,n<1?(f.helpers.extend(v.style,{left:r.clientX+t.left+2+"px",top:r.clientY+t.top+2+"px"}),h=E(r,o,h),f.schedule(u,15)):(h=E(s,o,h),o.document.body.removeChild(v),c())}var l=new Date,d=s.clientX-a.clientX,p=s.clientY-a.clientY,h=m(a,o),v=o.document.createElement("div"),g=0;f.helpers.extend(v.style,{height:"5px",width:"5px",backgroundColor:"red",position:"absolute",zIndex:19999,fontSize:"1px"}),o.document.body.appendChild(v),u()}function u(e){var t=f.jquery()(e),n=t.offset();return{pageX:n.left+t.outerWidth()/2,pageY:n.top+t.outerHeight()/2}}function h(e,t,n){var r,o,a,s=/(\d+)[x ](\d+)/,i=/(\d+)X(\d+)/,c=/([+-]\d+)[xX ]([+-]\d+)/;return"string"==typeof e&&c.test(e)&&n&&(r=u(n),o=e.match(c),e={pageX:r.pageX+parseInt(o[1]),pageY:r.pageY+parseInt(o[2])}),"string"==typeof e&&s.test(e)&&(o=e.match(s),e={pageX:parseInt(o[1]),pageY:parseInt(o[2])}),"string"==typeof e&&i.test(e)&&(o=e.match(i),e={clientX:parseInt(o[1]),clientY:parseInt(o[2])}),"string"==typeof e&&(e=f.jquery()(e,t.document)[0]),e.nodeName&&(e=u(e)),null!=e.pageX&&(a=f.helpers.scrollOffset(t),e={clientX:e.pageX-a.left,clientY:e.pageY-a.top}),e}function v(e,t,n){var r,o,a;e.clientY<0&&(a=(o=(r=f.helpers.scrollOffset(n)).top+e.clientY-100)-r.top,0<o||(o=0,a=-r.top),e.clientY=e.clientY-a,t.clientY=t.clientY-a,f.helpers.scrollOffset(n,{top:o,left:r.left}))}f.helpers.extend(f.init.prototype,{_move:function(e,t,n){var r=f.helpers.getWindow(e),o=h(t.from||e,r,e),a=h(t.to||t,r,e);b.html5drag=f.support.pointerEvents,!1!==t.adjust&&v(o,a,r),p(r,o,a,t.duration||500,n)},_drag:function(e,t,n){var r,o,a,s,i,c=f.helpers.getWindow(e),u=h(t.from||e,c,e),l=h(t.to||t,c,e);!1!==t.adjust&&v(u,l,c),b.html5drag=e.draggable,b.html5drag?b.dragAndDrop(c,u,l,t.duration||500,n):(r=c,o=u,a=l,s=t.duration||500,i=n,f.support.pointerEvents&&(d("pointerover",o,r),d("pointerenter",o,r)),d("mouseover",o,r),d("mouseenter",o,r),f.support.pointerEvents&&d("pointermove",o,r),d("mousemove",o,r),f.support.pointerEvents&&d("pointerdown",o,r),f.support.touchEvents&&d("touchstart",o,r),d("mousedown",o,r),p(r,o,a,s,function(){f.support.pointerEvents&&d("pointerup",a,r),f.support.touchEvents&&d("touchend",a,r),d("mouseup",a,r),f.support.pointerEvents&&d("pointerleave",a,r),d("mouseleave",a,r),i()}))}})});