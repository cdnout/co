goog.provide("i18n.phonenumbers.ShortNumberInfo"),goog.require("goog.array"),goog.require("goog.proto2.PbLiteSerializer"),goog.require("i18n.phonenumbers.PhoneMetadata"),goog.require("i18n.phonenumbers.PhoneNumber"),goog.require("i18n.phonenumbers.PhoneNumberDesc"),goog.require("i18n.phonenumbers.PhoneNumberUtil"),goog.require("i18n.phonenumbers.metadata"),goog.require("i18n.phonenumbers.shortnumbermetadata"),i18n.phonenumbers.ShortNumberInfo=function(){this.regionToMetadataMap={}},goog.addSingletonGetter(i18n.phonenumbers.ShortNumberInfo),i18n.phonenumbers.ShortNumberInfo.REGIONS_WHERE_EMERGENCY_NUMBERS_MUST_BE_EXACT_=["BR","CL","NI"],i18n.phonenumbers.ShortNumberInfo.ShortNumberCost={TOLL_FREE:0,STANDARD_RATE:1,PREMIUM_RATE:2,UNKNOWN_COST:3},i18n.phonenumbers.ShortNumberInfo.prototype.getRegionCodesForCountryCode_=function(e){e=i18n.phonenumbers.metadata.countryCodeToRegionCodeMap[e];return e||[]},i18n.phonenumbers.ShortNumberInfo.prototype.regionDialingFromMatchesNumber_=function(e,r){e=this.getRegionCodesForCountryCode_(e.getCountryCodeOrDefault());return goog.array.contains(e,r)},i18n.phonenumbers.ShortNumberInfo.prototype.isPossibleShortNumberForRegion=function(e,r){if(!this.regionDialingFromMatchesNumber_(e,r))return!1;r=this.getMetadataForRegion_(r);if(!r)return!1;e=this.getNationalSignificantNumber_(e).length;return goog.array.contains(r.getGeneralDesc().possibleLengthArray(),e)},i18n.phonenumbers.ShortNumberInfo.prototype.isPossibleShortNumber=function(e){for(var r=this.getRegionCodesForCountryCode_(e.getCountryCodeOrDefault()),t=this.getNationalSignificantNumber_(e).length,n=0;n<r.length;n++){var o=r[n],o=this.getMetadataForRegion_(o);if(o){o=o.getGeneralDesc().possibleLengthArray();if(goog.array.contains(o,t))return!0}}return!1},i18n.phonenumbers.ShortNumberInfo.prototype.isValidShortNumberForRegion=function(e,r){if(!this.regionDialingFromMatchesNumber_(e,r))return!1;var t=this.getMetadataForRegion_(r);if(!t)return!1;r=this.getNationalSignificantNumber_(e),e=t.getGeneralDesc();if(!this.matchesPossibleNumberAndNationalNumber_(r,e))return!1;t=t.getShortCode();return this.matchesPossibleNumberAndNationalNumber_(r,t)},i18n.phonenumbers.ShortNumberInfo.prototype.isValidShortNumber=function(e){var r=this.getRegionCodesForCountryCode_(e.getCountryCodeOrDefault()),t=this.getRegionCodeForShortNumberFromRegionList_(e,r);return 1<r.length&&null!=t||this.isValidShortNumberForRegion(e,t)},i18n.phonenumbers.ShortNumberInfo.prototype.getExpectedCostForRegion=function(e,r){var t=i18n.phonenumbers.ShortNumberInfo.ShortNumberCost;if(!this.regionDialingFromMatchesNumber_(e,r))return t.UNKNOWN_COST;var n=this.getMetadataForRegion_(r);if(!n)return t.UNKNOWN_COST;e=this.getNationalSignificantNumber_(e);return goog.array.contains(n.getGeneralDesc().possibleLengthArray(),e.length)?this.matchesPossibleNumberAndNationalNumber_(e,n.getPremiumRate())?t.PREMIUM_RATE:this.matchesPossibleNumberAndNationalNumber_(e,n.getStandardRate())?t.STANDARD_RATE:this.matchesPossibleNumberAndNationalNumber_(e,n.getTollFree())||this.isEmergencyNumber(e,r)?t.TOLL_FREE:t.UNKNOWN_COST:t.UNKNOWN_COST},i18n.phonenumbers.ShortNumberInfo.prototype.getExpectedCost=function(e){var r=i18n.phonenumbers.ShortNumberInfo.ShortNumberCost,t=this.getRegionCodesForCountryCode_(e.getCountryCodeOrDefault());if(0===t.length)return r.UNKNOWN_COST;if(1===t.length)return this.getExpectedCostForRegion(e,t[0]);for(var n=r.TOLL_FREE,o=0;o<t.length;o++){var i=t[o],i=this.getExpectedCostForRegion(e,i);switch(i){case r.PREMIUM_RATE:return r.PREMIUM_RATE;case r.UNKNOWN_COST:n=r.UNKNOWN_COST;break;case r.STANDARD_RATE:n!==r.UNKNOWN_COST&&(n=r.STANDARD_RATE);break;case r.TOLL_FREE:break;default:throw new Error("Unrecognized cost for region: "+i)}}return n},i18n.phonenumbers.ShortNumberInfo.prototype.getRegionCodeForShortNumberFromRegionList_=function(e,r){if(0===r.length)return null;if(1===r.length)return r[0];for(var t=this.getNationalSignificantNumber_(e),n=0;n<r.length;n++){var o=r[n],i=this.getMetadataForRegion_(o);if(i&&this.matchesPossibleNumberAndNationalNumber_(t,i.getShortCode()))return o}return null},i18n.phonenumbers.ShortNumberInfo.prototype.getSupportedRegions=function(){return goog.array.filter(Object.keys(i18n.phonenumbers.shortnumbermetadata.countryToMetadata),function(e){return isNaN(e)})},i18n.phonenumbers.ShortNumberInfo.prototype.getExampleShortNumber=function(e){e=this.getMetadataForRegion_(e);if(!e)return"";e=e.getShortCode();return e.hasExampleNumber()&&e.getExampleNumber()||""},i18n.phonenumbers.ShortNumberInfo.prototype.getExampleShortNumberForCost=function(e,r){var t=this.getMetadataForRegion_(e);if(!t)return"";var n=i18n.phonenumbers.ShortNumberInfo.ShortNumberCost,e=null;switch(r){case n.TOLL_FREE:e=t.getTollFree();break;case n.STANDARD_RATE:e=t.getStandardRate();break;case n.PREMIUM_RATE:e=t.getPremiumRate()}return e&&e.hasExampleNumber()&&e.getExampleNumber()||""},i18n.phonenumbers.ShortNumberInfo.prototype.connectsToEmergencyNumber=function(e,r){return this.matchesEmergencyNumberHelper_(e,r,!0)},i18n.phonenumbers.ShortNumberInfo.prototype.isEmergencyNumber=function(e,r){return this.matchesEmergencyNumberHelper_(e,r,!1)},i18n.phonenumbers.ShortNumberInfo.prototype.getMetadataForRegion_=function(e){if(!e)return null;e=e.toUpperCase();var r=this.regionToMetadataMap[e];if(null==r){var t=new goog.proto2.PbLiteSerializer,n=i18n.phonenumbers.shortnumbermetadata.countryToMetadata[e];if(null==n)return null;r=t.deserialize(i18n.phonenumbers.PhoneMetadata.getDescriptor(),n),this.regionToMetadataMap[e]=r}return r},i18n.phonenumbers.ShortNumberInfo.prototype.matchesEmergencyNumberHelper_=function(e,r,t){var n=i18n.phonenumbers.PhoneNumberUtil.extractPossibleNumber(e);if(i18n.phonenumbers.PhoneNumberUtil.LEADING_PLUS_CHARS_PATTERN.test(n))return!1;e=this.getMetadataForRegion_(r);if(null==e||!e.hasEmergency())return!1;n=i18n.phonenumbers.PhoneNumberUtil.normalizeDigitsOnly(n),r=t&&!goog.array.contains(i18n.phonenumbers.ShortNumberInfo.REGIONS_WHERE_EMERGENCY_NUMBERS_MUST_BE_EXACT_,r),e=e.getEmergency().getNationalNumberPatternOrDefault();return i18n.phonenumbers.PhoneNumberUtil.matchesEntirely(e,n)||r&&i18n.phonenumbers.PhoneNumberUtil.matchesPrefix(e,n)},i18n.phonenumbers.ShortNumberInfo.prototype.isCarrierSpecific=function(e){var r=this.getRegionCodesForCountryCode_(e.getCountryCodeOrDefault()),r=this.getRegionCodeForShortNumberFromRegionList_(e,r),e=this.getNationalSignificantNumber_(e),r=this.getMetadataForRegion_(r);return!!r&&this.matchesPossibleNumberAndNationalNumber_(e,r.getCarrierSpecific())},i18n.phonenumbers.ShortNumberInfo.prototype.isCarrierSpecificForRegion=function(e,r){if(!this.regionDialingFromMatchesNumber_(e,r))return!1;e=this.getNationalSignificantNumber_(e),r=this.getMetadataForRegion_(r);return!!r&&this.matchesPossibleNumberAndNationalNumber_(e,r.getCarrierSpecific())},i18n.phonenumbers.ShortNumberInfo.prototype.isSmsServiceForRegion=function(e,r){if(!this.regionDialingFromMatchesNumber_(e,r))return!1;r=this.getMetadataForRegion_(r),e=this.getNationalSignificantNumber_(e);return!!r&&this.matchesPossibleNumberAndNationalNumber_(e,r.getSmsServices())},i18n.phonenumbers.ShortNumberInfo.prototype.getNationalSignificantNumber_=function(e){if(!e.hasNationalNumber())return"";var r=""+e.getNationalNumber();return e.hasItalianLeadingZero()&&e.getItalianLeadingZero()&&0<e.getNumberOfLeadingZerosOrDefault()?Array(e.getNumberOfLeadingZerosOrDefault()+1).join("0")+r:r},i18n.phonenumbers.ShortNumberInfo.prototype.matchesPossibleNumberAndNationalNumber_=function(e,r){return!(0<r.possibleLengthArray().length&&!goog.array.contains(r.possibleLengthArray(),e.length))&&i18n.phonenumbers.PhoneNumberUtil.matchesEntirely(r.getNationalNumberPatternOrDefault(),e.toString())};