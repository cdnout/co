!function(e,l){"use strict";var u=1,p=3,n=11,f=1,g="​",t=e.defaultView,o=navigator.userAgent,i=(/Android/.test(o),/Mac OS X/.test(o)),c=/Windows NT/.test(o),r=/iP(?:ad|hone|od)/.test(o)||i&&!!navigator.maxTouchPoints,N=/Gecko\//.test(o),S=/Edge\//.test(o),a=!S&&/WebKit\//.test(o),s=/Trident\/[4567]\./.test(o),d=i?"meta-":"ctrl-",m=a,h="undefined"!=typeof MutationObserver,v="undefined"!=typeof WeakMap,C=/[^ \t\r\n]/,y=Array.prototype.indexOf,_={1:1,2:2,3:4,8:128,9:256,11:1024},T=function(){return!0};function E(e,t,n){this.root=this.currentNode=e,this.nodeType=t,this.filter=n||T}E.prototype.nextNode=function(){for(var e,t=this.currentNode,n=this.root,o=this.nodeType,i=this.filter;;){for(e=t.firstChild;!e&&t&&t!==n;)(e=t.nextSibling)||(t=t.parentNode);if(!e)return null;if(_[e.nodeType]&o&&i(e))return this.currentNode=e;t=e}},E.prototype.previousNode=function(){for(var e,t=this.currentNode,n=this.root,o=this.nodeType,i=this.filter;;){if(t===n)return null;if(e=t.previousSibling)for(;t=e.lastChild;)e=t;else e=t.parentNode;if(!e)return null;if(_[e.nodeType]&o&&i(e))return this.currentNode=e;t=e}},E.prototype.previousPONode=function(){for(var e,t=this.currentNode,n=this.root,o=this.nodeType,i=this.filter;;){for(e=t.lastChild;!e&&t&&t!==n;)(e=t.previousSibling)||(t=t.parentNode);if(!e)return null;if(_[e.nodeType]&o&&i(e))return this.currentNode=e;t=e}};var L=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,b={BR:1,HR:1,IFRAME:1,IMG:1,INPUT:1},k=0,x=1,O=2,A=3,B=v?new WeakMap:null;function D(e){return e.nodeType===u&&b[e.nodeName]}function R(e){switch(e.nodeType){case p:return x;case u:case n:if(v&&B.has(e))return B.get(e);break;default:return k}var t=function(e,t){for(var n=e.length;n--;)if(!t(e[n]))return;return 1}(e.childNodes,P)?L.test(e.nodeName)?x:O:A;return v&&B.set(e,t),t}function P(e){return R(e)===x}function U(e){return R(e)===O}function I(e){return R(e)===A}function F(e,t){t=new E(t,f,U);return t.currentNode=e,t}function w(e,t){return(e=F(e,t).previousNode())!==t?e:null}function M(e,t){return(e=F(e,t).nextNode())!==t?e:null}function H(e){return!e.textContent&&!e.querySelector("IMG")}function z(e,t){return!D(e)&&e.nodeType===t.nodeType&&e.nodeName===t.nodeName&&"A"!==e.nodeName&&e.className===t.className&&(!e.style&&!t.style||e.style.cssText===t.style.cssText)}function W(e,t,n){if(e.nodeName!==t)return!1;for(var o in n)if(e.getAttribute(o)!==n[o])return!1;return!0}function q(e,t,n,o){for(;e&&e!==t;){if(W(e,n,o))return e;e=e.parentNode}return null}function K(e,t){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function G(e){var t=e.nodeType;return t===u||t===n?e.childNodes.length:e.length||0}function Z(e){var t=e.parentNode;return t&&t.removeChild(e),e}function Q(e,t){var n=e.parentNode;n&&n.replaceChild(t,e)}function $(e){for(var t=e.ownerDocument.createDocumentFragment(),n=e.childNodes,o=n?n.length:0;o--;)t.appendChild(e.firstChild);return t}function j(e,t,n,o){var i,r,a,s,d=e.createElement(t);if(n instanceof Array&&(o=n,n=null),n)for(i in n)(r=n[i])!==l&&d.setAttribute(i,r);if(o)for(a=0,s=o.length;a<s;a+=1)d.appendChild(o[a]);return d}function V(e,t){var n,o,i=t.__squire__,r=e.ownerDocument,a=e;if(e===t&&((o=e.firstChild)&&"BR"!==o.nodeName||(n=i.createDefaultBlock(),o?e.replaceChild(n,o):e.appendChild(n),e=n,n=null)),e.nodeType===p)return a;if(P(e)){for(o=e.firstChild;m&&o&&o.nodeType===p&&!o.data;)e.removeChild(o),o=e.firstChild;o||(m?(n=r.createTextNode(g),i._didAddZWS()):n=r.createTextNode(""))}else if(!e.querySelector("BR"))for(n=j(r,"BR");(o=e.lastElementChild)&&!P(o);)e=o;if(n)try{e.appendChild(n)}catch(t){i.didError({name:"Squire: fixCursor – "+t,message:"Parent: "+e.nodeName+"/"+e.innerHTML+" appendChild: "+n.nodeName})}return a}function Y(e,t){for(var n,o,i=e.childNodes,r=e.ownerDocument,a=null,s=0,d=i.length;s<d;s+=1)!(o="BR"===(n=i[s]).nodeName)&&P(n)?((a=a||j(r,"div")).appendChild(n),--s,--d):(o||a)&&(V(a=a||j(r,"div"),t),o?e.replaceChild(a,n):(e.insertBefore(a,n),s+=1,d+=1),a=null),I(n)&&Y(n,t);return a&&e.appendChild(V(a,t)),e}function X(e,t,n,o){var i,r,a=e.nodeType;if(a===p&&e!==n)return X(e.parentNode,e.splitText(t),n,o);if(a!==u)return t;if("number"==typeof t&&(t=t<e.childNodes.length?e.childNodes[t]:null),e===n)return t;for(a=e.parentNode,i=e.cloneNode(!1);t;)r=t.nextSibling,i.appendChild(t),t=r;return"OL"===e.nodeName&&q(e,o,"BLOCKQUOTE")&&(i.start=(+e.start||1)+e.childNodes.length-1),V(e,o),V(i,o),(r=e.nextSibling)?a.insertBefore(i,r):a.appendChild(i),X(a,i,n,o)}function J(e,t){e.nodeType===p&&(e=e.parentNode),e.nodeType===u&&(function e(t,n){for(var o,i,r,a=t.childNodes,s=a.length,d=[];s--;)if(o=a[s],i=s&&a[s-1],s&&P(o)&&z(o,i)&&!b[o.nodeName])n.startContainer===o&&(n.startContainer=i,n.startOffset+=G(i)),n.endContainer===o&&(n.endContainer=i,n.endOffset+=G(i)),n.startContainer===t&&(n.startOffset>s?--n.startOffset:n.startOffset===s&&(n.startContainer=i,n.startOffset=G(i))),n.endContainer===t&&(n.endOffset>s?--n.endOffset:n.endOffset===s&&(n.endContainer=i,n.endOffset=G(i))),Z(o),o.nodeType===p?i.appendData(o.data):d.push($(o));else if(o.nodeType===u){for(r=d.length;r--;)o.appendChild(d.pop());e(o,n)}}(e,e={startContainer:t.startContainer,startOffset:t.startOffset,endContainer:t.endContainer,endOffset:t.endOffset}),t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset))}function ee(e,t,n,o){for(var i,r,a,s=t;(i=s.parentNode)&&i!==o&&i.nodeType===u&&1===i.childNodes.length;)s=i;Z(s),a=e.childNodes.length,(r=e.lastChild)&&"BR"===r.nodeName&&(e.removeChild(r),--a),e.appendChild($(t)),n.setStart(e,a),n.collapse(!0),J(e,n)}function te(e,t){var n,o=e.previousSibling,i=e.firstChild,r=e.ownerDocument,a="LI"===e.nodeName;if(!a||i&&/^[OU]L$/.test(i.nodeName))if(o&&z(o,e)){if(!I(o)){if(!a)return;(n=j(r,"DIV")).appendChild($(o)),o.appendChild(n)}Z(e),n=!I(e),o.appendChild($(e)),n&&Y(o,t),i&&te(i,t)}else a&&(o=j(r,"DIV"),e.insertBefore(o,i),V(o,t))}function ne(e,t){for(var n=e.childNodes;t&&e.nodeType===u;)t=(n=(e=n[t-1]).childNodes).length;return e}function oe(e,t){if(e.nodeType===u){var n=e.childNodes;if(t<n.length)e=n[t];else{for(;e&&!e.nextSibling;)e=e.parentNode;e=e&&e.nextSibling}}return e}function ie(e,t){var n,o,i,r=e.startContainer,a=e.startOffset,s=e.endContainer,d=e.endOffset;r.nodeType===p?(n=(o=r.parentNode).childNodes,a===r.length?(a=y.call(n,r)+1,e.collapsed&&(s=o,d=a)):(a&&(i=r.splitText(a),s===r?(d-=a,s=i):s===o&&(d+=1),r=i),a=y.call(n,r)),r=o):n=r.childNodes,a===(o=n.length)?r.appendChild(t):r.insertBefore(t,n[a]),r===s&&(d+=n.length-o),e.setStart(r,a),e.setEnd(s,d)}function re(e,t,n){var o=e.startContainer,i=e.startOffset,r=e.endContainer,a=e.endOffset;(t=t||e.commonAncestorContainer).nodeType===p&&(t=t.parentNode);for(var s,d,l,c=X(r,a,t,n),h=X(o,i,t,n),f=t.ownerDocument.createDocumentFragment();h!==c;)s=h.nextSibling,f.appendChild(h),h=s;return o=t,i=c?y.call(t.childNodes,c):t.childNodes.length,(d=(l=t.childNodes[i])&&l.previousSibling)&&d.nodeType===p&&l.nodeType===p&&(i=(o=d).length,r=d.data,a=l.data," "===r.charAt(r.length-1)&&" "===a.charAt(0)&&(a=" "+a.slice(1)),d.appendData(a),Z(l)),e.setStart(o,i),e.collapse(!0),V(t,n),f}function ae(e,t){var n,o=_e(e,t),i=Ne(e,t),r=o!==i;return ve(e),Ce(e,o,i,t),n=re(e,null,t),ve(e),r&&(i=Ne(e,t),o&&i&&o!==i&&ee(o,i,e,t)),o&&V(o,t),(o=t.firstChild)&&"BR"!==o.nodeName?e.collapse(!0):(V(t,t),e.selectNodeContents(t.firstChild)),n}function se(e,t,n){var o,i,r,a,s,d,l,c,h=t.firstChild&&P(t.firstChild);for(Y(t,n),o=t;o=M(o,n);)V(o,n);if(e.collapsed||ae(e,n),ve(e),e.collapse(!1),r=q(e.endContainer,n,"BLOCKQUOTE")||n,c=_e(e,n),d=M(t,t),h=!h&&!!c&&H(c),c&&d&&!h&&!q(d,t,"PRE")&&!q(d,t,"TABLE")){if(Ce(e,c,c,n),e.collapse(!0),a=e.endContainer,s=e.endOffset,Me(c,n,!1),P(a)&&(a=(l=X(a,s,w(a,n),n)).parentNode,s=y.call(a.childNodes,l)),s!==G(a))for(i=n.ownerDocument.createDocumentFragment();o=a.childNodes[s];)i.appendChild(o);ee(a,d,e,n),s=y.call(a.parentNode.childNodes,a)+1,a=a.parentNode,e.setEnd(a,s)}G(t)&&(h&&(e.setEndBefore(c),e.collapse(!1),Z(c)),Ce(e,r,r,n),h=(l=X(e.endContainer,e.endOffset,r,n))?l.previousSibling:r.lastChild,r.insertBefore(t,l),l?e.setEndBefore(l):e.setEnd(r,G(r)),c=Ne(e,n),ve(e),a=e.endContainer,s=e.endOffset,l&&I(l)&&te(l,n),(l=h&&h.nextSibling)&&I(l)&&te(l,n),e.setEnd(a,s)),i&&(ee(c,i,c=e.cloneRange(),n),e.setEnd(c.endContainer,c.endOffset)),ve(e)}function de(e,t,n){var o=t.ownerDocument.createRange();if(o.selectNode(t),n){var n=-1<e.compareBoundaryPoints(3,o),i=e.compareBoundaryPoints(1,o)<1;return!n&&!i}return i=e.compareBoundaryPoints(0,o)<1,o=-1<e.compareBoundaryPoints(2,o),i&&o}function le(e,t,n){var o,i=q(e.endContainer,n,"A");return i&&(o=e.cloneRange(),i=i.parentNode,Ce(o,i,i,n),o.endContainer===i&&(e.setStart(o.endContainer,o.endOffset),e.setEnd(o.endContainer,o.endOffset))),e}function ce(e,t){var n,o=e.startContainer,i=e.startOffset;if(Se.root=null,o.nodeType===p){if(i)return!1;n=o}else if((n=oe(o,i))&&!K(t,n)&&(n=null),!n&&(n=ne(o,i)).nodeType===p&&n.length)return!1;return Se.currentNode=n,Se.root=_e(e,t),!Se.previousNode()}function he(e,t){var n,o=e.endContainer,i=e.endOffset;if(Se.root=null,o.nodeType===p){if((n=o.data.length)&&i<n)return!1;Se.currentNode=o}else Se.currentNode=ne(o,i);return Se.root=Ne(e,t),!Se.nextNode()}function fe(e,t){var n=_e(e,t),o=Ne(e,t);n&&o&&(t=n.parentNode,e.setStart(t,y.call(t.childNodes,n)),t=o.parentNode,e.setEnd(t,y.call(t.childNodes,o)+1))}function ue(e){var t=e.keyCode,n=ye[t],o="",i=this.getSelection();e.defaultPrevented||(n||(n=String.fromCharCode(t).toLowerCase(),/^[A-Za-z0-9]$/.test(n)||(n="")),111<t&&t<124&&(n="f"+(t-111)),"backspace"!==n&&"delete"!==n&&(e.altKey&&(o+="alt-"),e.ctrlKey&&(o+="ctrl-"),e.metaKey&&(o+="meta-"),e.shiftKey&&(o+="shift-")),c&&e.shiftKey&&"delete"===n&&(o+="shift-"),n=o+n,this._keyHandlers[n]?this._keyHandlers[n](this,e,i):i.collapsed||e.isComposing||e.ctrlKey||e.metaKey||1!==(e.key||n).length||(this.saveUndoState(i),ae(i,this._root),this._ensureBottomLine(),this.setSelection(i),this._updatePath(i,!0)))}function pe(e,t){try{var n,o=(t=t||e.getSelection()).startContainer;for(o.nodeType===p&&(o=o.parentNode),n=o;P(n)&&(!n.textContent||n.textContent===g);)n=(o=n).parentNode;o!==n&&(t.setStart(n,y.call(n.childNodes,o)),t.collapse(!0),n.removeChild(o),U(n)||(n=w(n,e._root)),V(n,e._root),ve(t)),o===e._root&&(o=o.firstChild)&&"BR"===o.nodeName&&Z(o),e._ensureBottomLine(),e.setSelection(t),e._updatePath(t,!0)}catch(t){e.didError(t)}}function ge(e,t){for(var n;(n=e.parentNode)&&n!==t&&!n.isContentEditable;)e=n;Z(e)}function me(e,t,n){var o,i,r,a,s,d=e._root;if(e._recordUndoState(n),e._config.addLinks&&rt(n.startContainer,d,e),e._removeZWS(),e._getRangeAndRemoveBookmark(n),n.collapsed||ae(n,d),(o=_e(n,d))&&(i=q(o,d,"PRE")))return ve(n),r=n.startContainer,a=n.startOffset,r.nodeType!==p&&(r=e._doc.createTextNode(""),i.insertBefore(r,i.firstChild)),t||"\n"!==r.data.charAt(a-1)&&!ce(n,d)||"\n"!==r.data.charAt(a)&&!he(n,d)?(r.insertData(a,"\n"),V(i,d),r.length===a+1?n.setStartAfter(r):n.setStart(r,a+1)):(r.deleteData(a&&a-1,a?2:1),(r=(s=X(r,a&&a-1,d,d)).previousSibling).textContent||Z(r),r=e.createDefaultBlock(),s.parentNode.insertBefore(r,s),s.textContent||Z(s),n.setStart(r,0)),n.collapse(!0),e.setSelection(n),e._updatePath(n,!0),e._docWasChanged(),0;if(!o||t||/^T[HD]$/.test(o.nodeName))return le(n,0,d),ie(n,e.createElement("BR")),n.collapse(!1),e.setSelection(n),e._updatePath(n,!0),0;if((i=q(o,d,"LI"))&&(o=i),H(o)){if(q(o,d,"UL")||q(o,d,"OL"))return e.decreaseListLevel(n);if(q(o,d,"BLOCKQUOTE"))return e.modifyBlocks(it,n)}for(s=et(e,o,n.startContainer,n.startOffset),Ye(o),we(o),V(o,d);s.nodeType===u;){var l,c=s.firstChild;if("A"===s.nodeName&&(!s.textContent||s.textContent===g)){Q(s,c=e._doc.createTextNode("")),s=c;break}for(;c&&c.nodeType===p&&!c.data&&(l=c.nextSibling)&&"BR"!==l.nodeName;)Z(c),c=l;if(!c||"BR"===c.nodeName||c.nodeType===p)break;s=c}n=e.createRange(s,0),e.setSelection(n),e._updatePath(n,!0)}var ve=function(e){for(var t,n=e.startContainer,o=e.startOffset,i=e.endContainer,r=e.endOffset,a=!0;n.nodeType!==p&&(t=n.childNodes[o])&&!D(t);)n=t,o=0;if(r)for(;i.nodeType!==p;){if(!(t=i.childNodes[r-1])||D(t)){if(a&&t&&"BR"===t.nodeName){--r,a=!1;continue}break}r=G(i=t)}else for(;i.nodeType!==p&&(t=i.firstChild)&&!D(t);)i=t;e.collapsed?(e.setStart(i,r),e.setEnd(n,o)):(e.setStart(n,o),e.setEnd(i,r))},Ce=function(e,t,n,o){var i,r=e.startContainer,a=e.startOffset,s=e.endContainer,d=e.endOffset,l=!0;for(t=t||e.commonAncestorContainer,n=n||t;!a&&r!==t&&r!==o;)i=r.parentNode,a=y.call(i.childNodes,r),r=i;for(;s!==n&&s!==o&&(l&&s.nodeType!==p&&s.childNodes[d]&&"BR"===s.childNodes[d].nodeName&&(d+=1,l=!1),d===G(s));)i=s.parentNode,d=y.call(i.childNodes,s)+1,s=i;e.setStart(r,a),e.setEnd(s,d)},_e=function(e,t){var n,o=e.startContainer;return(n=P(o)?w(o,t):o!==t&&U(o)?o:M(n=ne(o,e.startOffset),t))&&de(e,n,!0)?n:null},Ne=function(e,t){var n,o,i=e.endContainer;if(P(i))n=w(i,t);else if(i!==t&&U(i))n=i;else{if(!(n=oe(i,e.endOffset))||!K(t,n))for(n=t;o=n.lastChild;)n=o;n=w(n,t)}return n&&de(e,n,!0)?n:null},Se=new E(null,4|f,function(e){return e.nodeType===p?C.test(e.data):"IMG"===e.nodeName}),ye={8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",37:"left",39:"right",46:"delete",191:"/",219:"[",220:"\\",221:"]"},Te=function(n){return function(e,t){t.preventDefault(),e[n]()}},o=function(n,o){return o=o||null,function(e,t){t.preventDefault();t=e.getSelection();e.hasFormat(n,null,t)?e.changeFormat(null,{tag:n},t):e.changeFormat({tag:n},o,t)}},Ee={enter:r?function(e,t,n){e._saveRangeToBookmark(n);var o=e._getHTML(),i=function(){e.removeEventListener("keyup",i),e._setHTML(o),n=e._getRangeAndRemoveBookmark(),me(e,!1,n)};e.addEventListener("keyup",i)}:function(e,t,n){t.preventDefault(),me(e,t.shiftKey,n)},"shift-enter":function(e,t,n){return e._keyHandlers.enter(e,t,n)},backspace:function(e,t,n){var o=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(ce(n,o)){t.preventDefault();var i,r=_e(n,o);if(r)if(Y(r.parentNode,o),i=w(r,o))if(i.isContentEditable){for(ee(i,r,n,o),r=i.parentNode;r!==o&&!r.nextSibling;)r=r.parentNode;r!==o&&(r=r.nextSibling)&&te(r,o),e.setSelection(n)}else ge(i,o);else if(r)return q(r,o,"UL")||q(r,o,"OL")?e.decreaseListLevel(n):q(r,o,"BLOCKQUOTE")?e.modifyBlocks(ot,n):(e.setSelection(n),void e._updatePath(n,!0))}else e.setSelection(n),setTimeout(function(){pe(e)},0);else t.preventDefault(),ae(n,o),pe(e,n)},delete:function(e,t,n){var o,i,r,a,s,d=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(he(n,d)){if(t.preventDefault(),(a=_e(n,d))&&(Y(a.parentNode,d),o=M(a,d)))if(o.isContentEditable){for(ee(a,o,n,d),o=a.parentNode;o!==d&&!o.nextSibling;)o=o.parentNode;o!==d&&(o=o.nextSibling)&&te(o,d),e.setSelection(n),e._updatePath(n,!0)}else ge(o,d)}else{if(i=n.cloneRange(),Ce(n,d,d,d),r=n.endContainer,a=n.endOffset,r.nodeType===u&&(s=r.childNodes[a])&&"IMG"===s.nodeName)return t.preventDefault(),Z(s),ve(n),void pe(e,n);e.setSelection(i),setTimeout(function(){pe(e)},0)}else t.preventDefault(),ae(n,d),pe(e,n)},tab:function(e,t,n){var o,i,r=e._root;if(e._removeZWS(),n.collapsed&&ce(n,r))for(o=_e(n,r);i=o.parentNode;){if("UL"===i.nodeName||"OL"===i.nodeName){t.preventDefault(),e.increaseListLevel(n);break}o=i}},"shift-tab":function(e,t,n){var o,i=e._root;e._removeZWS(),n.collapsed&&ce(n,i)&&(q(o=n.startContainer,i,"UL")||q(o,i,"OL"))&&(t.preventDefault(),e.decreaseListLevel(n))},space:function(e,t,n){var o,i=e._root;if(e._recordUndoState(n),e._config.addLinks&&rt(n.startContainer,i,e),e._getRangeAndRemoveBookmark(n),o=n.endContainer,n.collapsed&&n.endOffset===G(o))do{if("A"===o.nodeName){n.setStartAfter(o);break}}while(!o.nextSibling&&(o=o.parentNode)&&o!==i);n.collapsed||(ae(n,i),e._ensureBottomLine(),e.setSelection(n),e._updatePath(n,!0)),e.setSelection(n)},left:function(e){e._removeZWS()},right:function(e){e._removeZWS()}};i&&N&&(Ee["meta-left"]=function(e,t){t.preventDefault();e=Qe(e);e&&e.modify&&e.modify("move","backward","lineboundary")},Ee["meta-right"]=function(e,t){t.preventDefault();e=Qe(e);e&&e.modify&&e.modify("move","forward","lineboundary")}),i||(Ee.pageup=function(e){e.moveCursorToStart()},Ee.pagedown=function(e){e.moveCursorToEnd()});a=function(n,o){return function(e,t){t.preventDefault();t=e.getPath();/(?:^|>)BLOCKQUOTE/.test(t)||!/(?:^|>)[OU]L/.test(t)?e[n]():e[o]()}},i=function(n,o){return function(e,t){t.preventDefault();t=e.getPath();n.test(t)?e.removeList():e[o]()}};Ee[d+"b"]=o("B"),Ee[d+"i"]=o("I"),Ee[d+"u"]=o("U"),Ee[d+"shift-7"]=o("S"),Ee[d+"shift-5"]=o("SUB",{tag:"SUP"}),Ee[d+"shift-6"]=o("SUP",{tag:"SUB"}),Ee[d+"shift-8"]=i(/(?:^|>)UL/,"makeUnorderedList"),Ee[d+"shift-9"]=i(/(?:^|>)OL/,"makeOrderedList"),Ee[d+"["]=a("decreaseQuoteLevel","decreaseListLevel"),Ee[d+"]"]=a("increaseQuoteLevel","increaseListLevel"),Ee[d+"d"]=Te("toggleCode"),Ee[d+"y"]=Te("redo"),Ee[d+"z"]=Te("undo"),Ee[d+"shift-z"]=Te("redo");function Le(e,t,n){for(var o,i,r,a,s,d,l,c,h=e.childNodes,f=e;P(f);)f=f.parentNode;for(Fe.root=f,o=0,i=h.length;o<i;o+=1)if(a=(r=h[o]).nodeName,d=r.nodeType,l=Pe[a],d===u){if(s=r.childNodes.length,l)r=l(r,e,t);else{if(Ie.test(a)){e.removeChild(r),--o,--i;continue}if(!Ue.test(a)&&!P(r)){--o,i+=s-1,e.replaceChild($(r),r);continue}}s&&Le(r,t,n||"PRE"===a)}else{if(d===p){if(l=r.data,s=!C.test(l.charAt(0)),d=!C.test(l.charAt(l.length-1)),n||!s&&!d)continue;if(s){for(Fe.currentNode=r;(c=Fe.previousPONode())&&!("IMG"===(a=c.nodeName)||"#text"===a&&C.test(c.data));)if(!P(c)){c=null;break}l=l.replace(/^[ \t\r\n]+/g,c?" ":"")}if(d){for(Fe.currentNode=r;(c=Fe.nextNode())&&!("IMG"===a||"#text"===a&&C.test(c.data));)if(!P(c)){c=null;break}l=l.replace(/[ \t\r\n]+$/g,c?" ":"")}if(l){r.data=l;continue}}e.removeChild(r),--o,--i}return e}function be(e){return e.nodeType===u?"BR"===e.nodeName:C.test(e.data)}function ke(e,t){for(var n,o=e.parentNode;P(o);)o=o.parentNode;return(n=new E(o,4|f,be)).currentNode=e,!!n.nextNode()||t&&!n.previousNode()}function xe(e,t,n,o,i,r){var a,s=e.clipboardData,d=e.target.ownerDocument,l=d.body;(d=j(d,"div")).appendChild(t),t=d.innerHTML,o&&(t=o(t)),i?a=i(t):(Me(d,n,!0),d.setAttribute("style","position:fixed;overflow:hidden;bottom:100%;right:100%;"),l.appendChild(d),a=(a=d.innerText||d.textContent).replace(/ /g," "),l.removeChild(d)),c&&(a=a.replace(/\r?\n/g,"\r\n")),r||a===t||s.setData("text/html",t),s.setData("text/plain",a),e.preventDefault()}function Oe(e){var t,n,o,i,r,a=this.getSelection(),s=this._root,d=this;if(a.collapsed)e.preventDefault();else{if(this.saveUndoState(a),!S&&e.clipboardData){for(n=(t=_e(a,s))===Ne(a,s)&&t||s,o=ae(a,s),(i=a.commonAncestorContainer).nodeType===p&&(i=i.parentNode);i&&i!==n;)(r=i.cloneNode(!1)).appendChild(o),o=r,i=i.parentNode;xe(e,o,s,this._config.willCutCopy,null,!1)}else setTimeout(function(){try{d._ensureBottomLine()}catch(e){d.didError(e)}},0);this.setSelection(a)}}function Ae(e,t,n,o,i,r){var a,s,d,l,c;if(!S&&e.clipboardData){for(s=(a=_e(t,n))===Ne(t,n)&&a||n,t=t.cloneRange(),ve(t),Ce(t,s,s,n),d=t.cloneContents(),(l=t.commonAncestorContainer).nodeType===p&&(l=l.parentNode);l&&l!==s;)(c=l.cloneNode(!1)).appendChild(d),d=c,l=l.parentNode;xe(e,d,n,o,i,r)}}function Be(e){Ae(e,this.getSelection(),this._root,this._config.willCutCopy,null,!1)}var De={1:10,2:13,3:16,4:18,5:24,6:32,7:48},Re={fontWeight:{regexp:/^bold|^700/i,replace:function(e){return j(e,"B")}},fontStyle:{regexp:/^italic/i,replace:function(e){return j(e,"I")}},fontFamily:{regexp:C,replace:function(e,t,n){return j(e,"SPAN",{class:t.fontFamily,style:"font-family:"+n})}},fontSize:{regexp:C,replace:function(e,t,n){return j(e,"SPAN",{class:t.fontSize,style:"font-size:"+n})}},textDecoration:{regexp:/^underline/i,replace:function(e){return j(e,"U")}}},d=function(s){return function(e,t){for(var n,o=j(e.ownerDocument,s),i=e.attributes,r=0,a=i.length;r<a;r+=1)n=i[r],o.setAttribute(n.name,n.value);return t.replaceChild(o,e),o.appendChild($(e)),o}},Pe={SPAN:function(e,t,n){var o,i,r,a,s,d=e.style,l=e.ownerDocument;for(o in Re)if(i=Re[o],(s=d[o])&&i.regexp.test(s)){if((s=i.replace(l,n.classNames,s)).nodeName===e.nodeName&&s.className===e.className)continue;a=a||s,r&&r.appendChild(s),r=s,e.style[o]=""}return a&&(r.appendChild($(e)),e.appendChild(a)),r||e},STRONG:d("B"),EM:d("I"),INS:d("U"),STRIKE:d("S"),FONT:function(e,t,n){var o,i,r=e.face,a=e.size,s=e.color,d=e.ownerDocument,n=n.classNames;return r&&(i=o=j(d,"SPAN",{class:n.fontFamily,style:"font-family:"+r}),o=o),a&&(a=j(d,"SPAN",{class:n.fontSize,style:"font-size:"+De[a]+"px"}),i=i||a,o&&o.appendChild(a),o=a),s&&/^#?([\dA-F]{3}){1,2}$/i.test(s)&&("#"!==s.charAt(0)&&(s="#"+s),s=j(d,"SPAN",{class:n.colour,style:"color:"+s}),i=i||s,o&&o.appendChild(s),o=s),i=i||(o=j(d,"SPAN")),t.replaceChild(i,e),o.appendChild($(e)),o},TT:function(e,t,n){n=j(e.ownerDocument,"SPAN",{class:n.classNames.fontFamily,style:'font-family:menlo,consolas,"courier new",monospace'});return t.replaceChild(n,e),n.appendChild($(e)),n}},Ue=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,Ie=/^(?:HEAD|META|STYLE)/,Fe=new E(null,4|f),we=function e(t){for(var n,o=t.childNodes,i=o.length;i--;)(n=o[i]).nodeType!==u||D(n)?n.nodeType!==p||n.data||t.removeChild(n):(e(n),P(n)&&!n.firstChild&&t.removeChild(n))},Me=function(e,t,n){for(var o,i,r=e.querySelectorAll("BR"),a=[],s=r.length,d=0;d<s;d+=1)a[d]=ke(r[d],n);for(;s--;)(i=(o=r[s]).parentNode)&&(a[s]?P(i)||Y(i,t):Z(o))};function He(e){this.isShiftDown=e.shiftKey}function ze(e){var t,n,o,i,r=(u=e.clipboardData)&&u.items,a=this.isShiftDown,s=!1,d=!1,l=!1,c=null,h=null,f=this;if(r){for(t=r.length;t--;)"text/html"===(o=(n=r[t]).type)?h=n:"text/plain"===o||"text/uri-list"===o?c=n:"text/rtf"===o?d=!0:/^image\/.*/.test(o)&&(l=!0);if(l&&(!d||!h))return e.preventDefault(),this.fireEvent("dragover",{dataTransfer:u,preventDefault:function(){s=!0}}),void(s&&this.fireEvent("drop",{dataTransfer:u}));if(!S)return e.preventDefault(),void(!h||a&&c?c&&c.getAsString(function(e){f.insertPlainText(e,!0)}):h.getAsString(function(e){f.insertHTML(e,!0)}))}if(i=u&&u.types,!S&&i&&(-1<y.call(i,"text/html")||!N&&-1<y.call(i,"text/plain")&&y.call(i,"text/rtf")<0))return e.preventDefault(),void(!a&&(p=u.getData("text/html"))?this.insertHTML(p,!0):((p=u.getData("text/plain"))||(p=u.getData("text/uri-list")))&&this.insertPlainText(p,!0));this._awaitingPaste=!0;var u=this._doc.body,p=this.getSelection(),g=p.startContainer,m=p.startOffset,v=p.endContainer,C=p.endOffset,_=this.createElement("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});u.appendChild(_),p.selectNodeContents(_),this.setSelection(p),setTimeout(function(){try{f._awaitingPaste=!1;for(var e,t,n="",o=_;_=o;)o=_.nextSibling,Z(_),(e=_.firstChild)&&e===_.lastChild&&"DIV"===e.nodeName&&(_=e),n+=_.innerHTML;t=f.createRange(g,m,v,C),f.setSelection(t),n&&f.insertHTML(n,!0)}catch(e){f.didError(e)}},0)}function We(e){for(var t=e.dataTransfer.types,n=t.length,o=!1,i=!1;n--;)switch(t[n]){case"text/plain":o=!0;break;case"text/html":i=!0;break;default:return}(i||o)&&this.saveUndoState()}function qe(e,t,n){var o,i;if(e=e||{},t)for(o in t)!n&&o in e||(i=t[o],e[o]=i&&i.constructor===Object?qe(e[o],i,n):i);return e}function Ke(e,t){9===e.nodeType&&(e=e.body);var n=e.ownerDocument,o=n.defaultView;this._win=o,this._doc=n,this._root=e,this._events={},this._isFocused=!1,this._lastSelection=null,this._hasZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._willUpdatePath=!1,"onselectionchange"in n?this.addEventListener("selectionchange",this._updatePathOnEvent):(this.addEventListener("keyup",this._updatePathOnEvent),this.addEventListener("mouseup",this._updatePathOnEvent)),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,h?((o=new MutationObserver(this._docWasChanged.bind(this))).observe(e,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=o):this.addEventListener("keyup",this._keyUpDetectChange),this._restoreSelection=!1,this.addEventListener("blur",$e),this.addEventListener("mousedown",je),this.addEventListener("touchstart",je),this.addEventListener("focus",Ve),this._awaitingPaste=!1,this.addEventListener("cut",Oe),this.addEventListener("copy",Be),this.addEventListener("keydown",He),this.addEventListener("keyup",He),this.addEventListener("paste",ze),this.addEventListener("drop",We),this.addEventListener("keydown",ue),this._keyHandlers=Object.create(Ee),this.setConfig(t),e.setAttribute("contenteditable","true"),e.setAttribute("data-gramm","false");try{n.execCommand("enableObjectResizing",!1,"false"),n.execCommand("enableInlineTableEditing",!1,"false")}catch(e){}(e.__squire__=this).setHTML("")}function Ge(e,t,n){return n=n._doc,(e=e?DOMPurify.sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0}):null)?n.importNode(e,!0):n.createDocumentFragment()}Te=Ke.prototype;Te.setConfig=function(e){return(e=qe({blockTag:"DIV",blockAttributes:null,tagAttributes:{blockquote:null,ul:null,ol:null,li:null,a:null},classNames:{colour:"colour",fontFamily:"font",fontSize:"size",highlight:"highlight"},leafNodeNames:b,undo:{documentSizeThreshold:-1,undoLimit:-1},isInsertedHTMLSanitized:!0,isSetHTMLSanitized:!0,sanitizeToDOMFragment:"undefined"!=typeof DOMPurify&&DOMPurify.isSupported?Ge:null,willCutCopy:null,addLinks:!0},e,!0)).blockTag=e.blockTag.toUpperCase(),this._config=e,this},Te.createElement=function(e,t,n){return j(this._doc,e,t,n)},Te.createDefaultBlock=function(e){var t=this._config;return V(this.createElement(t.blockTag,t.blockAttributes,e),this._root)},Te.didError=function(e){console.log(e)},Te.getDocument=function(){return this._doc},Te.getRoot=function(){return this._root},Te.modifyDocument=function(e){var t=this._mutation;t&&(t.takeRecords().length&&this._docWasChanged(),t.disconnect()),this._ignoreAllChanges=!0,e(),this._ignoreAllChanges=!1,t&&(t.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1)};var Ze={pathChange:1,select:1,input:1,undoStateChange:1};Te.fireEvent=function(e,t){var n,o,i,r=this._events[e];if(/^(?:focus|blur)/.test(e))if(n=this._root===this._doc.activeElement,"focus"===e){if(!n||this._isFocused)return this;this._isFocused=!0}else{if(n||!this._isFocused)return this;this._isFocused=!1}if(r)for((t=t||{}).type!==e&&(t.type=e),o=(r=r.slice()).length;o--;){i=r[o];try{i.handleEvent?i.handleEvent(t):i.call(this,t)}catch(t){t.details="Squire: fireEvent error. Event type: "+e,this.didError(t)}}return this},Te.destroy=function(){for(var e in this._events)this.removeEventListener(e);this._mutation&&this._mutation.disconnect(),delete this._root.__squire__,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0},Te.handleEvent=function(e){this.fireEvent(e.type,e)},Te.addEventListener=function(e,t){var n=this._events[e],o=this._root;return t?(n||(n=this._events[e]=[],Ze[e]||("selectionchange"===e&&(o=this._doc),o.addEventListener(e,this,!0))),n.push(t)):this.didError({name:"Squire: addEventListener with null or undefined fn",message:"Event type: "+e}),this},Te.removeEventListener=function(e,t){var n,o=this._events[e],i=this._root;if(o){if(t)for(n=o.length;n--;)o[n]===t&&o.splice(n,1);else o.length=0;o.length||(delete this._events[e],Ze[e]||("selectionchange"===e&&(i=this._doc),i.removeEventListener(e,this,!0)))}return this},Te.createRange=function(e,t,n,o){if(e instanceof this._win.Range)return e.cloneRange();var i=this._doc.createRange();return i.setStart(e,t),n?i.setEnd(n,o):i.setEnd(e,t),i},Te.getCursorPosition=function(e){if(!e&&!(e=this.getSelection())||!e.getBoundingClientRect)return null;var t,n,o=e.getBoundingClientRect();return o&&!o.top&&(this._ignoreChange=!0,(t=this._doc.createElement("SPAN")).textContent=g,ie(e,t),o=t.getBoundingClientRect(),(n=t.parentNode).removeChild(t),J(n,e)),o},Te._moveCursorTo=function(e){var t=this._root,t=this.createRange(t,e?0:t.childNodes.length);return ve(t),this.setSelection(t),this},Te.moveCursorToStart=function(){return this._moveCursorTo(!0)},Te.moveCursorToEnd=function(){return this._moveCursorTo(!1)};var Qe=function(e){return e._win.getSelection()||null};function $e(){this._restoreSelection=!0}function je(){this._restoreSelection=!1}function Ve(){this._restoreSelection&&this.setSelection(this._lastSelection)}Te.setSelection=function(e){var t;return e&&(this._lastSelection=e,this._isFocused?(r&&this._win.focus(),(t=Qe(this))&&t.setBaseAndExtent?t.setBaseAndExtent(e.startContainer,e.startOffset,e.endContainer,e.endOffset):t&&(t.removeAllRanges(),t.addRange(e))):$e.call(this)),this},Te.getSelection=function(){var e,t,n=Qe(this),o=this._root;return this._isFocused&&n&&n.rangeCount&&(n=(e=n.getRangeAt(0).cloneRange()).startContainer,t=e.endContainer,n&&D(n)&&e.setStartBefore(n),t&&D(t)&&e.setEndBefore(t)),e&&K(o,e.commonAncestorContainer)?this._lastSelection=e:K((t=(e=this._lastSelection).commonAncestorContainer).ownerDocument,t)||(e=null),e=e||this.createRange(o.firstChild,0)},Te.getSelectedText=function(){var t=this.getSelection();if(!t||t.collapsed)return"";var e,n=new E(t.commonAncestorContainer,4|f,function(e){return de(t,e,!0)}),o=t.startContainer,i=t.endContainer,r=n.currentNode=o,a="",s=!1;for(n.filter(r)||(r=n.nextNode());r;)r.nodeType===p?(e=r.data)&&/\S/.test(e)&&(r===i&&(e=e.slice(0,t.endOffset)),r===o&&(e=e.slice(t.startOffset)),a+=e,s=!0):("BR"===r.nodeName||s&&!P(r))&&(a+="\n",s=!1),r=n.nextNode();return a},Te.getPath=function(){return this._path};var Ye=function(e,t){for(var n,o,i,r=new E(e,4);o=r.nextNode();)for(;-1<(i=o.data.indexOf(g))&&(!t||o.parentNode!==t);){if(1===o.length){for(;(n=o.parentNode).removeChild(o),o=n,r.currentNode=n,P(o)&&!G(o););break}o.deleteData(i,1)}};Te._didAddZWS=function(){this._hasZWS=!0},Te._removeZWS=function(){this._hasZWS&&(Ye(this._root),this._hasZWS=!1)},Te._updatePath=function(e,t){var n,o;e&&(n=e.startContainer,o=e.endContainer,!t&&n===this._lastAnchorNode&&o===this._lastFocusNode||(this._lastAnchorNode=n,this._lastFocusNode=o,o=n&&o?n===o?function e(t,n,o){var i,r="";return t&&t!==n&&(r=e(t.parentNode,n,o),t.nodeType===u&&(r+=(r?">":"")+t.nodeName,(n=t.id)&&(r+="#"+n),(n=t.className.trim())&&((i=n.split(/\s\s*/)).sort(),r+=".",r+=i.join(".")),(n=t.dir)&&(r+="[dir="+n+"]"),i&&(o=o.classNames,-1<y.call(i,o.highlight)&&(r+="[backgroundColor="+t.style.backgroundColor.replace(/ /g,"")+"]"),-1<y.call(i,o.colour)&&(r+="[color="+t.style.color.replace(/ /g,"")+"]"),-1<y.call(i,o.fontFamily)&&(r+="[fontFamily="+t.style.fontFamily.replace(/ /g,"")+"]"),-1<y.call(i,o.fontSize)&&(r+="[fontSize="+t.style.fontSize+"]")))),r}(o,this._root,this._config):"(selection)":"",this._path!==o&&(this._path=o,this.fireEvent("pathChange",{path:o}))),this.fireEvent(e.collapsed?"cursor":"select",{range:e}))},Te._updatePathOnEvent=function(){var e=this;e._isFocused&&!e._willUpdatePath&&(e._willUpdatePath=!0,setTimeout(function(){e._willUpdatePath=!1,e._updatePath(e.getSelection())},0))},Te.focus=function(){return this._root.focus({preventScroll:!0}),s&&this.fireEvent("focus"),this},Te.blur=function(){return this._root.blur(),s&&this.fireEvent("blur"),this};var Xe="squire-selection-end";Te._saveRangeToBookmark=function(e){var t,n=this.createElement("INPUT",{id:"squire-selection-start",type:"hidden"}),o=this.createElement("INPUT",{id:Xe,type:"hidden"});ie(e,n),e.collapse(!1),ie(e,o),2&n.compareDocumentPosition(o)&&(n.id=Xe,o.id="squire-selection-start",t=n,n=o,o=t),e.setStartAfter(n),e.setEndBefore(o)},Te._getRangeAndRemoveBookmark=function(e){var t,n,o,i=this._root,r=i.querySelector("#squire-selection-start"),a=i.querySelector("#"+Xe);return r&&a&&(t=r.parentNode,n=a.parentNode,o=y.call(t.childNodes,r),i=y.call(n.childNodes,a),t===n&&--i,Z(r),Z(a),(e=e||this._doc.createRange()).setStart(t,o),e.setEnd(n,i),J(t,e),t!==n&&J(n,e),e.collapsed&&(t=e.startContainer).nodeType===p&&((n=t.childNodes[e.startOffset])&&n.nodeType===p||(n=t.childNodes[e.startOffset-1]),n&&n.nodeType===p&&(e.setStart(n,0),e.collapse(!0)))),e||null},Te._keyUpDetectChange=function(e){var t=e.keyCode;e.ctrlKey||e.metaKey||e.altKey||!(t<16||20<t)||!(t<33||45<t)||this._docWasChanged()},Te._docWasChanged=function(){v&&(B=new WeakMap),this._ignoreAllChanges||(h&&this._ignoreChange?this._ignoreChange=!1:(this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")))},Te._recordUndoState=function(e,t){var n,o,i,r;this._isInUndoState&&!t||(n=this._undoIndex,o=this._undoStack,i=(r=this._config.undo).documentSizeThreshold,r=r.undoLimit,t||(n+=1),n<this._undoStackLength&&(o.length=this._undoStackLength=n),e&&this._saveRangeToBookmark(e),e=this._getHTML(),-1<i&&2*e.length>i&&-1<r&&r<n&&(o.splice(0,n-r),n=r,this._undoStackLength=r),o[n]=e,this._undoIndex=n,this._undoStackLength+=1,this._isInUndoState=!0)},Te.saveUndoState=function(e){return e===l&&(e=this.getSelection()),this._recordUndoState(e,this._isInUndoState),this._getRangeAndRemoveBookmark(e),this},Te.undo=function(){var e;return 0===this._undoIndex&&this._isInUndoState||(this._recordUndoState(this.getSelection(),!1),--this._undoIndex,this._setHTML(this._undoStack[this._undoIndex]),(e=this._getRangeAndRemoveBookmark())&&this.setSelection(e),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:0!==this._undoIndex,canRedo:!0}),this.fireEvent("input")),this},Te.redo=function(){var e,t=this._undoIndex,n=this._undoStackLength;return t+1<n&&this._isInUndoState&&(this._undoIndex+=1,this._setHTML(this._undoStack[this._undoIndex]),(e=this._getRangeAndRemoveBookmark())&&this.setSelection(e),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:t+2<n}),this.fireEvent("input")),this},Te.hasFormat=function(e,t,n){if(e=e.toUpperCase(),t=t||{},!n&&!(n=this.getSelection()))return!1;!n.collapsed&&n.startContainer.nodeType===p&&n.startOffset===n.startContainer.length&&n.startContainer.nextSibling&&n.setStartBefore(n.startContainer.nextSibling),!n.collapsed&&n.endContainer.nodeType===p&&0===n.endOffset&&n.endContainer.previousSibling&&n.setEndAfter(n.endContainer.previousSibling);var o,i,r=this._root,a=n.commonAncestorContainer;if(q(a,r,e,t))return!0;if(a.nodeType===p)return!1;o=new E(a,4,function(e){return de(n,e,!0)});for(var s=!1;i=o.nextNode();){if(!q(i,r,e,t))return!1;s=!0}return s},Te.getFontInfo=function(e){var t,n,o,i={color:l,backgroundColor:l,family:l,size:l},r=0;if(!e&&!(e=this.getSelection()))return i;if(t=e.commonAncestorContainer,e.collapsed||t.nodeType===p)for(t.nodeType===p&&(t=t.parentNode);r<4&&t;)(n=t.style)&&(!i.color&&(o=n.color)&&(i.color=o,r+=1),!i.backgroundColor&&(o=n.backgroundColor)&&(i.backgroundColor=o,r+=1),!i.family&&(o=n.fontFamily)&&(i.family=o,r+=1),!i.size&&(o=n.fontSize)&&(i.size=o,r+=1)),t=t.parentNode;return i},Te._addFormat=function(e,t,n){var o,i,r,a,s,d,l,c,h=this._root;if(n.collapsed){for(o=V(this.createElement(e,t),h),ie(n,o),n.setStart(o.firstChild,o.firstChild.length),n.collapse(!0),c=o;P(c);)c=c.parentNode;Ye(c,o)}else{if(i=new E(n.commonAncestorContainer,4|f,function(e){return(e.nodeType===p||"BR"===e.nodeName||"IMG"===e.nodeName)&&de(n,e,!0)}),r=n.startContainer,s=n.startOffset,a=n.endContainer,d=n.endOffset,i.currentNode=r,i.filter(r)||(r=i.nextNode(),s=0),!r)return n;for(;q(l=i.currentNode,h,e,t)||(l===a&&l.length>d&&l.splitText(d),l===r&&s&&(l=l.splitText(s),a===r&&(a=l,d-=s),r=l,s=0),Q(l,o=this.createElement(e,t)),o.appendChild(l)),i.nextNode(););a.nodeType!==p&&(d=l.nodeType===p?(a=l).length:(a=l.parentNode,1)),n=this.createRange(r,s,a,d)}return n},Te._removeFormat=function(t,n,r,e){this._saveRangeToBookmark(r);var o,i=this._doc;r.collapsed&&(m?(o=i.createTextNode(g),this._didAddZWS()):o=i.createTextNode(""),ie(r,o));for(var a=r.commonAncestorContainer;P(a);)a=a.parentNode;var s=r.startContainer,d=r.startOffset,l=r.endContainer,c=r.endOffset,h=[],f=function(e,t){if(!de(r,e,!1)){var n,o,i=e.nodeType===p;if(de(r,e,!0))if(i)e===l&&c!==e.length&&h.push([t,e.splitText(c)]),e===s&&d&&(e.splitText(d),h.push([t,e]));else for(n=e.firstChild;n;n=o)o=n.nextSibling,f(n,t);else"INPUT"===e.nodeName||i&&!e.data||h.push([t,e])}},i=Array.prototype.filter.call(a.getElementsByTagName(t),function(e){return de(r,e,!0)&&W(e,t,n)});return e||i.forEach(function(e){f(e,e)}),h.forEach(function(e){var t=e[0].cloneNode(!1),e=e[1];Q(e,t),t.appendChild(e)}),i.forEach(function(e){Q(e,$(e))}),this._getRangeAndRemoveBookmark(r),o&&r.collapse(!1),J(a,r),r},Te.changeFormat=function(e,t,n,o){return(n=n||this.getSelection())&&(this.saveUndoState(n),t&&(n=this._removeFormat(t.tag.toUpperCase(),t.attributes||{},n,o)),e&&(n=this._addFormat(e.tag.toUpperCase(),e.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0),h||this._docWasChanged()),this};var Je={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"},et=function(e,t,n,o){var i=Je[t.nodeName],r=null,o=X(n,o,t.parentNode,e._root),e=e._config;return i||(i=e.blockTag,r=e.blockAttributes),W(o,i,r)||(t=j(o.ownerDocument,i,r),o.dir&&(t.dir=o.dir),Q(o,t),t.appendChild($(o)),o=t),o};Te.forEachBlock=function(e,t,n){if(!n&&!(n=this.getSelection()))return this;t&&this.saveUndoState(n);var o=this._root,i=_e(n,o),r=Ne(n,o);if(i&&r)do{if(e(i)||i===r)break}while(i=M(i,o));return t&&(this.setSelection(n),this._updatePath(n,!0),h||this._docWasChanged()),this},Te.modifyBlocks=function(e,t){if(!t&&!(t=this.getSelection()))return this;this._recordUndoState(t,this._isInUndoState);var n,o=this._root;return fe(t,o),Ce(t,o,o,o),n=re(t,o,o),ie(t,e.call(this,n)),t.endOffset<t.endContainer.childNodes.length&&te(t.endContainer.childNodes[t.endOffset],o),te(t.startContainer.childNodes[t.startOffset],o),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),h||this._docWasChanged(),this};function tt(e,t,n){for(var o,i,r,a=F(t,e._root),s=(t=e._config.tagAttributes)[n.toLowerCase()],d=t.li;o=a.nextNode();)"LI"===o.parentNode.nodeName&&(o=o.parentNode,a.currentNode=o.lastChild),"LI"!==o.nodeName?(r=e.createElement("LI",d),o.dir&&(r.dir=o.dir),(i=o.previousSibling)&&i.nodeName===n?(i.appendChild(r),Z(o)):Q(o,e.createElement(n,s,[r])),r.appendChild($(o)),a.currentNode=r):(r=(o=o.parentNode).nodeName)!==n&&/^[OU]L$/.test(r)&&Q(o,e.createElement(n,s,[$(o)]))}function nt(e,t){for(var n=e.commonAncestorContainer,o=e.startContainer,i=e.endContainer;n&&n!==t&&!/^[OU]L$/.test(n.nodeName);)n=n.parentNode;if(!n||n===t)return null;for(o===n&&(o=o.childNodes[e.startOffset]),i===n&&(i=i.childNodes[e.endOffset]);o&&o.parentNode!==n;)o=o.parentNode;for(;i&&i.parentNode!==n;)i=i.parentNode;return[n,o,i]}var ot=function(t){var e=t.querySelectorAll("blockquote");return Array.prototype.filter.call(e,function(e){return!q(e.parentNode,t,"BLOCKQUOTE")}).forEach(function(e){Q(e,$(e))}),t},it=function(){return this.createDefaultBlock([this.createElement("INPUT",{id:"squire-selection-start",type:"hidden"}),this.createElement("INPUT",{id:Xe,type:"hidden"})])};Te.increaseListLevel=function(e){if(!e&&!(e=this.getSelection()))return this.focus();var t=this._root,n=nt(e,t);if(!n)return this.focus();var o=n[0],i=n[1],r=n[2];if(!i||i===o.firstChild)return this.focus();this._recordUndoState(e,this._isInUndoState);var a,s=o.nodeName,d=i.previousSibling;for(d.nodeName!==s&&(n=this._config.tagAttributes[s.toLowerCase()],d=this.createElement(s,n),o.insertBefore(d,i));a=i===r?null:i.nextSibling,d.appendChild(i),i=a;);return(a=d.nextSibling)&&te(a,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),h||this._docWasChanged(),this.focus()},Te.decreaseListLevel=function(e){if(!e&&!(e=this.getSelection()))return this.focus();var t=this._root,n=nt(e,t);if(!n)return this.focus();var o,i,r,a,s=n[0],d=n[1],l=n[2],d=d||s.firstChild,l=l||s.lastChild;if(this._recordUndoState(e,this._isInUndoState),d){if(o=s.parentNode,r=l.nextSibling?X(s,l.nextSibling,o,t):s.nextSibling,o!==t&&"LI"===o.nodeName){for(o=o.parentNode;r;)i=r.nextSibling,l.appendChild(r),r=i;r=s.parentNode.nextSibling}for(a=!/^[OU]L$/.test(o.nodeName);i=d===l?null:d.nextSibling,s.removeChild(d),a&&"LI"===d.nodeName&&(d=this.createDefaultBlock([$(d)])),o.insertBefore(d,r),d=i;);}return s.firstChild||Z(s),r&&te(r,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),h||this._docWasChanged(),this.focus()},Te._ensureBottomLine=function(){var e=this._root,t=e.lastElementChild;t&&t.nodeName===this._config.blockTag&&U(t)||e.appendChild(this.createDefaultBlock())},Te.setKeyHandler=function(e,t){return this._keyHandlers[e]=t,this},Te._getHTML=function(){return this._root.innerHTML},Te._setHTML=function(e){var t=this._root,n=t,o=this._config.sanitizeToDOMFragment;for("function"==typeof o?(o=o(e,!1,this),$(n),n.appendChild(o)):n.innerHTML=e;V(n,t),n=M(n,t););this._ignoreChange=!0},Te.getHTML=function(e){var t;return e&&(t=this.getSelection())&&this._saveRangeToBookmark(t),e=this._getHTML().replace(/\u200B/g,""),t&&this._getRangeAndRemoveBookmark(t),e},Te.setHTML=function(e){var t,n=this._config,o=n.isSetHTMLSanitized?n.sanitizeToDOMFragment:null,i=this._root;"function"==typeof o?a=o(e,!1,this):((o=this.createElement("DIV")).innerHTML=e,(a=this._doc.createDocumentFragment()).appendChild($(o))),Le(a,n),Me(a,i,!1),Y(a,i);for(var r=a;r=M(r,i);)V(r,i);for(this._ignoreChange=!0;t=i.lastChild;)i.removeChild(t);i.appendChild(a),V(i,i),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;var a=this._getRangeAndRemoveBookmark()||this.createRange(i.firstChild,0);return this.saveUndoState(a),this._lastSelection=a,$e.call(this),this._updatePath(a,!0),this},Te.insertElement=function(e,t){if((t=t||this.getSelection()).collapse(!0),P(e))ie(t,e),t.setStartAfter(e);else{for(var n,o=this._root,i=_e(t,o)||o;i!==o&&!i.nextSibling;)i=i.parentNode;i!==o&&(n=X(i.parentNode,i.nextSibling,o,o)),n?o.insertBefore(e,n):(o.appendChild(e),n=this.createDefaultBlock(),o.appendChild(n)),t.setStart(n,0),t.setEnd(n,0),ve(t)}return this.focus(),this.setSelection(t),this._updatePath(t),h||this._docWasChanged(),this},Te.insertImage=function(e,t){t=this.createElement("IMG",qe({src:e},t,!0));return this.insertElement(t),t},Te.linkRegExp=/\b(?:((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()\[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w\-]+\.)+[a-z]{2,}\b(?:[?][^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+)*)?))/i;var rt=function(e,t,n){var o,i,r,a,s,d,l,c=e.ownerDocument,h=new E(e,4,function(e){return!q(e,t,"A")}),f=n.linkRegExp,u=n._config.tagAttributes.a;if(f)for(;o=h.nextNode();)for(i=o.data,r=o.parentNode;a=f.exec(i);)d=(s=a.index)+a[0].length,s&&(l=c.createTextNode(i.slice(0,s)),r.insertBefore(l,o)),(l=n.createElement("A",qe({href:a[1]?/^(?:ht|f)tps?:/i.test(a[1])?a[1]:"http://"+a[1]:"mailto:"+a[0]},u,!1))).textContent=i.slice(s,d),r.insertBefore(l,o),o.data=i=i.slice(d)};Te.insertHTML=function(e,t){var n,o,i,r,a,s=this._config,d=s.isInsertedHTMLSanitized?s.sanitizeToDOMFragment:null,l=this.getSelection(),c=this._doc;"function"==typeof d?o=d(e,t,this):(t&&(d=e.indexOf("\x3c!--StartFragment--\x3e"),n=e.lastIndexOf("\x3c!--EndFragment--\x3e"),-1<d&&-1<n&&(e=e.slice(d+20,n))),/<\/td>((?!<\/tr>)[\s\S])*$/i.test(e)&&(e="<TR>"+e+"</TR>"),/<\/tr>((?!<\/table>)[\s\S])*$/i.test(e)&&(e="<TABLE>"+e+"</TABLE>"),(n=this.createElement("DIV")).innerHTML=e,(o=c.createDocumentFragment()).appendChild($(n))),this.saveUndoState(l);try{for(i=this._root,a={fragment:r=o,preventDefault:function(){this.defaultPrevented=!0},defaultPrevented:!1},rt(o,o,this),Le(o,s),Me(o,i,!1),we(o),o.normalize();r=M(r,o);)V(r,i);t&&this.fireEvent("willPaste",a),a.defaultPrevented||(se(l,a.fragment,i),h||this._docWasChanged(),l.collapse(!1),le(l,0,i),this._ensureBottomLine()),this.setSelection(l),this._updatePath(l,!0),t&&this.focus()}catch(e){this.didError(e)}return this};function at(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}Te.insertPlainText=function(e,t){var n=this.getSelection();if(n.collapsed&&q(n.startContainer,this._root,"PRE")){var o,i=n.startContainer,r=n.startOffset;return i&&i.nodeType===p||(o=this._doc.createTextNode(""),i.insertBefore(o,i.childNodes[r]),i=o,r=0),o={text:e,preventDefault:function(){this.defaultPrevented=!0},defaultPrevented:!1},t&&this.fireEvent("willPaste",o),o.defaultPrevented||(e=o.text,i.insertData(r,e),n.setStart(i,r+e.length),n.collapse(!0)),this.setSelection(n),this}var a,s,d,l,c=e.split("\n"),n=this._config,e=n.blockTag,h=n.blockAttributes,f="</"+e+">",u="<"+e;for(a in h)u+=" "+a+'="'+at(h[a])+'"';for(u+=">",s=0,d=c.length;s<d;s+=1)l=c[s],l=at(l).replace(/ (?= )/g,"&nbsp;"),s&&(l=u+(l||"<BR>")+f),c[s]=l;return this.insertHTML(c.join(""),t)};d=function(e,t,n){return function(){return this[e](t,n),this.focus()}};Te.addStyles=function(e){var t,n;return e&&(t=this._doc.documentElement.firstChild,(n=this.createElement("STYLE",{type:"text/css"})).appendChild(this._doc.createTextNode(e)),t.appendChild(n)),this},Te.bold=d("changeFormat",{tag:"B"}),Te.italic=d("changeFormat",{tag:"I"}),Te.underline=d("changeFormat",{tag:"U"}),Te.strikethrough=d("changeFormat",{tag:"S"}),Te.subscript=d("changeFormat",{tag:"SUB"},{tag:"SUP"}),Te.superscript=d("changeFormat",{tag:"SUP"},{tag:"SUB"}),Te.removeBold=d("changeFormat",null,{tag:"B"}),Te.removeItalic=d("changeFormat",null,{tag:"I"}),Te.removeUnderline=d("changeFormat",null,{tag:"U"}),Te.removeStrikethrough=d("changeFormat",null,{tag:"S"}),Te.removeSubscript=d("changeFormat",null,{tag:"SUB"}),Te.removeSuperscript=d("changeFormat",null,{tag:"SUP"}),Te.makeLink=function(e,t){var n=this.getSelection();if(n.collapsed){var o=e.indexOf(":")+1;if(o)for(;"/"===e[o];)o+=1;ie(n,this._doc.createTextNode(e.slice(o)))}return t=qe(qe({href:e},t,!0),this._config.tagAttributes.a,!1),this.changeFormat({tag:"A",attributes:t},{tag:"A"},n),this.focus()},Te.removeLink=function(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0),this.focus()},Te.setFontFace=function(e){var t=this._config.classNames.fontFamily;return this.changeFormat(e?{tag:"SPAN",attributes:{class:t,style:"font-family: "+e+", sans-serif;"}}:null,{tag:"SPAN",attributes:{class:t}}),this.focus()},Te.setFontSize=function(e){var t=this._config.classNames.fontSize;return this.changeFormat(e?{tag:"SPAN",attributes:{class:t,style:"font-size: "+("number"==typeof e?e+"px":e)}}:null,{tag:"SPAN",attributes:{class:t}}),this.focus()},Te.setTextColour=function(e){var t=this._config.classNames.colour;return this.changeFormat(e?{tag:"SPAN",attributes:{class:t,style:"color:"+e}}:null,{tag:"SPAN",attributes:{class:t}}),this.focus()},Te.setHighlightColour=function(e){var t=this._config.classNames.highlight;return this.changeFormat(e&&{tag:"SPAN",attributes:{class:t,style:"background-color:"+e}},{tag:"SPAN",attributes:{class:t}}),this.focus()},Te.setTextAlignment=function(n){return this.forEachBlock(function(e){var t=e.className.split(/\s+/).filter(function(e){return!!e&&!/^align/.test(e)}).join(" ");n?(e.className=t+" align-"+n,e.style.textAlign=n):(e.className=t,e.style.textAlign="")},!0),this.focus()},Te.setTextDirection=function(t){return this.forEachBlock(function(e){t?e.dir=t:e.removeAttribute("dir")},!0),this.focus()};function st(e){for(var t,n=this._root,o=this._doc,i=o.createDocumentFragment(),r=F(e,n);t=r.nextNode();){for(var a,s=t.querySelectorAll("BR"),d=[],l=s.length,c=0;c<l;c+=1)d[c]=ke(s[c],!1);for(;l--;)a=s[l],d[l]?Q(a,o.createTextNode("\n")):Z(a);for(l=(s=t.querySelectorAll("CODE")).length;l--;)Z(s[l]);i.childNodes.length&&i.appendChild(o.createTextNode("\n")),i.appendChild($(t))}for(r=new E(i,4);t=r.nextNode();)t.data=t.data.replace(/ /g," ");return i.normalize(),V(this.createElement("PRE",this._config.tagAttributes.pre,[i]),n)}function dt(e){for(var t,n,o,i,r,a,s=this._doc,d=this._root,l=e.querySelectorAll("PRE"),c=l.length;c--;){for(n=new E(t=l[c],4);o=n.nextNode();){for(i=(i=o.data).replace(/ (?= )/g," "),r=s.createDocumentFragment();-1<(a=i.indexOf("\n"));)r.appendChild(s.createTextNode(i.slice(0,a))),r.appendChild(s.createElement("BR")),i=i.slice(a+1);o.parentNode.insertBefore(r,o),o.data=i}Y(t,d),Q(t,$(t))}return e}Te.code=function(){var e=this.getSelection();return e.collapsed||I(e.commonAncestorContainer)?this.modifyBlocks(st,e):this.changeFormat({tag:"CODE",attributes:this._config.tagAttributes.code},null,e),this.focus()},Te.removeCode=function(){var e=this.getSelection();return q(e.commonAncestorContainer,this._root,"PRE")?this.modifyBlocks(dt,e):this.changeFormat(null,{tag:"CODE"},e),this.focus()},Te.toggleCode=function(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code(),this},Te.removeAllFormatting=function(e){if(!e&&!(e=this.getSelection())||e.collapsed)return this;for(var t=this._root,n=e.commonAncestorContainer;n&&!U(n);)n=n.parentNode;if(n||(fe(e,t),n=t),n.nodeType===p)return this;this.saveUndoState(e),Ce(e,n,n,t);for(var o,i=n.ownerDocument,r=e.startContainer,a=e.startOffset,s=e.endContainer,d=e.endOffset,l=i.createDocumentFragment(),i=i.createDocumentFragment(),c=X(s,d,n,t),h=X(r,a,n,t);h!==c;)o=h.nextSibling,l.appendChild(h),h=o;return function e(t,n,o){for(var i,r=n.firstChild;r;r=i){if(i=r.nextSibling,P(r)){if(r.nodeType===p||"BR"===r.nodeName||"IMG"===r.nodeName){o.appendChild(r);continue}}else if(U(r)){o.appendChild(t.createDefaultBlock([e(t,r,t._doc.createDocumentFragment())]));continue}e(t,r,o)}return o}(this,l,i),i.normalize(),h=i.firstChild,o=i.lastChild,t=n.childNodes,d=h?(n.insertBefore(i,c),a=y.call(t,h),y.call(t,o)+1):a=y.call(t,c),e.setStart(n,a),e.setEnd(n,d),J(n,e),ve(e),this.setSelection(e),this._updatePath(e,!0),this.focus()},Te.increaseQuoteLevel=d("modifyBlocks",function(e){return this.createElement("BLOCKQUOTE",this._config.tagAttributes.blockquote,[e])}),Te.decreaseQuoteLevel=d("modifyBlocks",ot),Te.makeUnorderedList=d("modifyBlocks",function(e){return tt(this,e,"UL"),e}),Te.makeOrderedList=d("modifyBlocks",function(e){return tt(this,e,"OL"),e}),Te.removeList=d("modifyBlocks",function(e){for(var t,n,o,i=e.querySelectorAll("UL, OL"),r=e.querySelectorAll("LI"),a=this._root,s=0,d=i.length;s<d;s+=1)Y(n=$(t=i[s]),a),Q(t,n);for(s=0,d=r.length;s<d;s+=1)U(o=r[s])?Q(o,this.createDefaultBlock([$(o)])):(Y(o,a),Q(o,$(o)));return e}),Ke.isInline=P,Ke.isBlock=U,Ke.isContainer=I,Ke.getBlockWalker=F,Ke.getPreviousBlock=w,Ke.getNextBlock=M,Ke.areAlike=z,Ke.hasTagAttributes=W,Ke.getNearest=q,Ke.isOrContains=K,Ke.detach=Z,Ke.replaceWith=Q,Ke.empty=$,Ke.getNodeBefore=ne,Ke.getNodeAfter=oe,Ke.insertNodeInRange=ie,Ke.extractContentsOfRange=re,Ke.deleteContentsOfRange=ae,Ke.insertTreeFragmentIntoRange=se,Ke.isNodeContainedInRange=de,Ke.moveRangeBoundariesDownTree=ve,Ke.moveRangeBoundariesUpTree=Ce,Ke.getStartBlockOfRange=_e,Ke.getEndBlockOfRange=Ne,Ke.contentWalker=Se,Ke.rangeDoesStartAtBlockBoundary=ce,Ke.rangeDoesEndAtBlockBoundary=he,Ke.expandRangeToBlockBoundaries=fe,Ke.onCopy=Ae,Ke.onPaste=ze,Ke.addLinks=rt,Ke.splitBlock=et,Ke.startSelectionId="squire-selection-start",Ke.endSelectionId=Xe,"object"==typeof exports?module.exports=Ke:"function"==typeof define&&define.amd?define(function(){return Ke}):(t.Squire=Ke,top!==t&&"true"===e.documentElement.getAttribute("data-squireinit")&&(t.editor=new Ke(e),t.onEditorLoad&&(t.onEditorLoad(t.editor),t.onEditorLoad=null)))}(document);