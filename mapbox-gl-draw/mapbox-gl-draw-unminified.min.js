!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).MapboxDraw=e()}(this,function(){"use strict";var d=function(t,i){function e(t,e){for(var n=a[t],o=n.length;o--;){var r=n[o];if(r.selector(e)){r.fn.call(s,e)||i.store.render(),i.ui.updateMapClasses();break}}}var a={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},s={on:function(t,e,n){if(void 0===a[t])throw new Error("Invalid event type: "+t);a[t].push({selector:e,fn:n})},render:function(t){i.store.featureChanged(t)}};return t.start.call(s),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),i.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){e("drag",t)},click:function(t){e("click",t)},mousemove:function(t){e("mousemove",t)},mousedown:function(t){e("mousedown",t)},mouseup:function(t){e("mouseup",t)},mouseout:function(t){e("mouseout",t)},keydown:function(t){e("keydown",t)},keyup:function(t){e("keyup",t)},touchstart:function(t){e("touchstart",t)},touchmove:function(t){e("touchmove",t)},touchend:function(t){e("touchend",t)},tap:function(t){e("tap",t)}}},c={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function r(t){var e=0;if(t&&0<t.length){e+=Math.abs(o(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(o(t[n]))}return e}function o(t){var e,n,o,r,i,a,s=0,u=t.length;if(2<u){for(a=0;a<u;a++)i=a===u-2?(o=u-2,r=u-1,0):a===u-1?(o=u-1,r=0,1):(r=(o=a)+1,a+2),e=t[o],n=t[r],s+=(l(t[i][0])-l(e[0]))*Math.sin(l(n[1]));s=s*c.RADIUS*c.RADIUS/2}return s}function l(t){return t*Math.PI/180}var s={geometry:function t(e){var n,o=0;switch(e.type){case"Polygon":return r(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)o+=r(e.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)o+=t(e.geometries[n]);return o}},ring:o},p={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},f={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},h={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},g={POLYGON:"polygon",LINE:"line_string",POINT:"point"},y={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},m={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},v={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},t="move",e="change_coordinates",_={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},i={ACTIVE:"true",INACTIVE:"false"},n=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],b=-85,E=85,a={Point:0,LineString:1,Polygon:2};function u(t,e){var n=a[t.geometry.type]-a[e.geometry.type];return 0==n&&t.geometry.type===y.POLYGON?t.area-e.area:n}function T(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}T.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},T.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},T.prototype.has=function(t){return("string"==typeof t||"number"==typeof t)&&(void 0!==this._items[t]||void 0!==this._nums[t])},T.prototype.values=function(){var e=this,n=[];return Object.keys(this._items).forEach(function(t){n.push({k:t,v:e._items[t]})}),Object.keys(this._nums).forEach(function(t){n.push({k:JSON.parse(t),v:e._nums[t]})}),n.sort(function(t,e){return t.v-e.v}).map(function(t){return t.k})},T.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var C=[_.FEATURE,_.MIDPOINT,_.VERTEX],I={click:function(t,e,n){return S(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return S(t,e,n,n.options.touchBuffer)}};function S(t,e,n,o){if(null===n.map)return[];var r,r=t?(r=o,[[t.point.x-(r=void 0===r?0:r),t.point.y-r],[t.point.x+r,t.point.y+r]]):e,e={};n.options.styles&&(e.layers=n.options.styles.map(function(t){return t.id}));var e=n.map.queryRenderedFeatures(r,e).filter(function(t){return-1!==C.indexOf(t.properties.meta)}),i=new T,a=[];return e.forEach(function(t){var e=t.properties.id;i.has(e)||(i.add(e),a.push(t))}),a.map(function(t){return t.geometry.type===y.POLYGON&&(t.area=s.geometry({type:y.FEATURE,property:{},geometry:t.geometry})),t}).sort(u).map(function(t){return delete t.area,t})}function O(t,e){var n=I.click(t,null,e),t={mouse:h.NONE};return n[0]&&(t.mouse=n[0].properties.active===i.ACTIVE?h.MOVE:h.POINTER,t.feature=n[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(t.mouse=h.ADD),e.ui.queueMapClasses(t),e.ui.updateMapClasses(),n[0]}function x(t,e){var n=t.x-e.x,e=t.y-e.y;return Math.sqrt(n*n+e*e)}var L=4,M=12,N=500;function P(t,e,n){var o=null!=(n=void 0===n?{}:n).fineTolerance?n.fineTolerance:L,r=null!=n.grossTolerance?n.grossTolerance:M,i=null!=n.interval?n.interval:N;t.point=t.point||e.point,t.time=t.time||e.time;n=x(t.point,e.point);return n<o||n<r&&e.time-t.time<i}var F=25,w=250;function A(t,e,n){var o=null!=(n=void 0===n?{}:n).tolerance?n.tolerance:F,n=null!=n.interval?n.interval:w;return t.point=t.point||e.point,t.time=t.time||e.time,x(t.point,e.point)<o&&e.time-t.time<n}function R(t,e){return t(e={exports:{}},e.exports),e.exports}function k(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||U(),this.type=e.geometry.type}var U=R(function(t){var s=t.exports=function(t,e){if(e=e||16,(t=void 0===t?128:t)<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),o=2;n===1/0;o*=2)n=Math.log(Math.pow(2,t/o))/Math.log(e)*o;for(var r=n-Math.floor(n),i="",o=0;o<Math.floor(n);o++)i=Math.floor(Math.random()*e).toString(e)+i;r&&(a=Math.pow(e,r),i=Math.floor(Math.random()*a).toString(e)+i);var a=parseInt(i,e);return a!==1/0&&a>=Math.pow(2,t)?s(t,e):i};s.rack=function(o,r,i){function n(t){var e=0;do{if(10<e++){if(!i)throw new Error("too many ID collisions, use more bits");o+=i}var n=s(o,r)}while(Object.hasOwnProperty.call(a,n));return a[n]=t,n}var a=n.hats={};return n.get=function(t){return n.hats[t]},n.set=function(t,e){return n.hats[t]=e,n},n.bits=o||128,n.base=r||16,n}});k.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},k.prototype.incomingCoords=function(t){this.setCoordinates(t)},k.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},k.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},k.prototype.setProperty=function(t,e){this.properties[t]=e},k.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:y.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},k.prototype.internal=function(t){var e={id:this.id,meta:_.FEATURE,"meta:type":this.type,active:i.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:y.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};function D(t,e){k.call(this,t,e)}(D.prototype=Object.create(k.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},D.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},D.prototype.getCoordinate=function(){return this.getCoordinates()};function j(t,e){k.call(this,t,e)}(j.prototype=Object.create(k.prototype)).isValid=function(){return 1<this.coordinates.length},j.prototype.addCoordinate=function(t,e,n){this.changed();t=parseInt(t,10);this.coordinates.splice(t,0,[e,n])},j.prototype.getCoordinate=function(t){t=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},j.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},j.prototype.updateCoordinate=function(t,e,n){t=parseInt(t,10);this.coordinates[t]=[e,n],this.changed()};function V(t,e){k.call(this,t,e),this.coordinates=this.coordinates.map(function(t){return t.slice(0,-1)})}(V.prototype=Object.create(k.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(t){return 2<t.length})},V.prototype.incomingCoords=function(t){this.coordinates=t.map(function(t){return t.slice(0,-1)}),this.changed()},V.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},V.prototype.addCoordinate=function(t,e,n){this.changed();t=t.split(".").map(function(t){return parseInt(t,10)});this.coordinates[t[0]].splice(t[1],0,[e,n])},V.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map(function(t){return parseInt(t,10)}),t=this.coordinates[e[0]];t&&(t.splice(e[1],1),t.length<3&&this.coordinates.splice(e[0],1))},V.prototype.getCoordinate=function(t){var e=t.split(".").map(function(t){return parseInt(t,10)}),t=this.coordinates[e[0]];return JSON.parse(JSON.stringify(t[e[1]]))},V.prototype.getCoordinates=function(){return this.coordinates.map(function(t){return t.concat([t[0]])})},V.prototype.updateCoordinate=function(t,e,n){this.changed();var o=t.split("."),t=parseInt(o[0],10),o=parseInt(o[1],10);void 0===this.coordinates[t]&&(this.coordinates[t]=[]),this.coordinates[t][o]=[e,n]};function B(t,e,n,o,r){var i=n.split("."),n=parseInt(i[0],10),i=i[1]?i.slice(1).join("."):null;return t[n][e](i,o,r)}function G(t,e){if(k.call(this,t,e),delete this.coordinates,this.model=J[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)}var J={MultiPoint:D,MultiLineString:j,MultiPolygon:V};function z(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(G.prototype=Object.create(k.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map(function(t){return new n(e.ctx,{id:U(),type:y.FEATURE,properties:{},geometry:{coordinates:t,type:e.type.replace("Multi","")}})})},G.prototype.isValid=function(){return this.features.every(function(t){return t.isValid()})},G.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},G.prototype.getCoordinate=function(t){return B(this.features,"getCoordinate",t)},G.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(t){return t.type===y.POLYGON?t.getCoordinates():t.coordinates})))},G.prototype.updateCoordinate=function(t,e,n){B(this.features,"updateCoordinate",t,e,n),this.changed()},G.prototype.addCoordinate=function(t,e,n){B(this.features,"addCoordinate",t,e,n),this.changed()},G.prototype.removeCoordinate=function(t){B(this.features,"removeCoordinate",t),this.changed()},G.prototype.getFeatures=function(){return this.features},z.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},z.prototype.setSelectedCoordinates=function(t){var n=this;this._ctx.store.setSelectedCoordinates(t),t.reduce(function(t,e){return void 0===t[e.feature_id]&&(t[e.feature_id]=!0,n._ctx.store.get(e.feature_id).changed()),t},{})},z.prototype.getSelected=function(){return this._ctx.store.getSelected()},z.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},z.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},z.prototype.getFeature=function(t){return this._ctx.store.get(t)},z.prototype.select=function(t){return this._ctx.store.select(t)},z.prototype.deselect=function(t){return this._ctx.store.deselect(t)},z.prototype.deleteFeature=function(t,e){return this._ctx.store.delete(t,e=void 0===e?{}:e)},z.prototype.addFeature=function(t){return this._ctx.store.add(t)},z.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},z.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},z.prototype.setActionableState=function(t){t={trash:(t=void 0===t?{}:t).trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(t)},z.prototype.changeMode=function(t,e,n){return this._ctx.events.changeMode(t,e=void 0===e?{}:e,n=void 0===n?{}:n)},z.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},z.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},z.prototype.featuresAt=function(t,e,n){if("click"!==(n=void 0===n?"click":n)&&"touch"!==n)throw new Error("invalid buffer type");return I[n](t,e,this._ctx)},z.prototype.newFeature=function(t){var e=t.geometry.type;return new(e===y.POINT?D:e===y.LINE_STRING?j:e===y.POLYGON?V:G)(this._ctx,t)},z.prototype.isInstanceOf=function(t,e){if(t===y.POINT)return e instanceof D;if(t===y.LINE_STRING)return e instanceof j;if(t===y.POLYGON)return e instanceof V;if("MultiFeature"===t)return e instanceof G;throw new Error("Unknown feature class: "+t)},z.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},z.prototype.onSetup=function(){},z.prototype.onDrag=function(){},z.prototype.onClick=function(){},z.prototype.onMouseMove=function(){},z.prototype.onMouseDown=function(){},z.prototype.onMouseUp=function(){},z.prototype.onMouseOut=function(){},z.prototype.onKeyUp=function(){},z.prototype.onKeyDown=function(){},z.prototype.onTouchStart=function(){},z.prototype.onTouchMove=function(){},z.prototype.onTouchEnd=function(){},z.prototype.onTap=function(){},z.prototype.onStop=function(){},z.prototype.onTrash=function(){},z.prototype.onCombineFeature=function(){},z.prototype.onUncombineFeature=function(){},z.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Y={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},$=Object.keys(Y);function q(s){var n=Object.keys(s);return function(t,e){void 0===e&&(e={});var i={},a=n.reduce(function(t,e){return t[e]=s[e],t},new z(t));return{start:function(){var r=this;i=a.onSetup(e),$.forEach(function(t){var e,n=Y[t],o=function(){return!1};s[n]&&(o=function(){return!0}),r.on(t,o,(e=n,function(t){return a[e](i,t)}))})},stop:function(){a.onStop(i)},trash:function(){a.onTrash(i)},combineFeatures:function(){a.onCombineFeatures(i)},uncombineFeatures:function(){a.onUncombineFeatures(i)},render:function(t,e){a.toDisplayFeatures(i,t,e)}}}}function W(r){var i=Object.keys(r.options.modes).reduce(function(t,e){return t[e]=q(r.options.modes[e]),t},{}),n={},o={},a={},s=null,u=null;a.drag=function(t,e){e({point:t.point,time:(new Date).getTime()})?(r.ui.queueMapClasses({mouse:h.DRAG}),u.drag(t)):t.originalEvent.stopPropagation()},a.mousedrag=function(t){a.drag(t,function(t){return!P(n,t)})},a.touchdrag=function(t){a.drag(t,function(t){return!A(o,t)})},a.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return a.mousedrag(t);var e=O(t,r);t.featureTarget=e,u.mousemove(t)},a.mousedown=function(t){n={time:(new Date).getTime(),point:t.point};var e=O(t,r);t.featureTarget=e,u.mousedown(t)},a.mouseup=function(t){var e=O(t,r);t.featureTarget=e,P(n,{point:t.point,time:(new Date).getTime()})?u.click(t):u.mouseup(t)},a.mouseout=function(t){u.mouseout(t)},a.touchstart=function(t){var e;t.originalEvent.preventDefault(),r.options.touchEnabled&&(o={time:(new Date).getTime(),point:t.point},e=I.touch(t,null,r)[0],t.featureTarget=e,u.touchstart(t))},a.touchmove=function(t){if(t.originalEvent.preventDefault(),r.options.touchEnabled)return u.touchmove(t),a.touchdrag(t)},a.touchend=function(t){var e;t.originalEvent.preventDefault(),r.options.touchEnabled&&(e=I.touch(t,null,r)[0],t.featureTarget=e,A(o,{time:(new Date).getTime(),point:t.point})?u.tap(t):u.touchend(t))};function e(t){return!(8===t||46===t||48<=t&&t<=57)}function c(t,e,n){void 0===n&&(n={}),u.stop();var o=i[t];if(void 0===o)throw new Error(t+" is not valid");s=t;e=o(r,e);u=d(e,r),n.silent||r.map.fire(v.MODE_CHANGE,{mode:t}),r.store.setDirty(),r.store.render()}a.keydown=function(t){"mapboxgl-canvas"===(t.srcElement||t.target).classList[0]&&(8!==t.keyCode&&46!==t.keyCode||!r.options.controls.trash?e(t.keyCode)?u.keydown(t):49===t.keyCode&&r.options.controls.point?c(m.DRAW_POINT):50===t.keyCode&&r.options.controls.line_string?c(m.DRAW_LINE_STRING):51===t.keyCode&&r.options.controls.polygon&&c(m.DRAW_POLYGON):(t.preventDefault(),u.trash()))},a.keyup=function(t){e(t.keyCode)&&u.keyup(t)},a.zoomend=function(){r.store.changeZoom()};var l={trash:!(a.data=function(t){var e,n,o;"style"===t.dataType&&(e=r.setup,n=r.map,o=r.options,t=r.store,o.styles.some(function(t){return n.getLayer(t.id)})||(e.addLayers(),t.setDirty(),t.render()))}),combineFeatures:!1,uncombineFeatures:!1};return{start:function(){s=r.options.defaultMode,u=d(i[s](r),r)},changeMode:c,actionable:function(e){var n=!1;Object.keys(e).forEach(function(t){if(void 0===l[t])throw new Error("Invalid action type");l[t]!==e[t]&&(n=!0),l[t]=e[t]}),n&&r.map.fire(v.ACTIONABLE,{actions:l})},currentModeName:function(){return s},currentModeRender:function(t,e){return u.render(t,e)},fire:function(t,e){a[t]&&a[t](e)},addEventListeners:function(){r.map.on("mousemove",a.mousemove),r.map.on("mousedown",a.mousedown),r.map.on("mouseup",a.mouseup),r.map.on("data",a.data),r.map.on("touchmove",a.touchmove),r.map.on("touchstart",a.touchstart),r.map.on("touchend",a.touchend),r.container.addEventListener("mouseout",a.mouseout),r.options.keybindings&&(r.container.addEventListener("keydown",a.keydown),r.container.addEventListener("keyup",a.keyup))},removeEventListeners:function(){r.map.off("mousemove",a.mousemove),r.map.off("mousedown",a.mousedown),r.map.off("mouseup",a.mouseup),r.map.off("data",a.data),r.map.off("touchmove",a.touchmove),r.map.off("touchstart",a.touchstart),r.map.off("touchend",a.touchend),r.container.removeEventListener("mouseout",a.mouseout),r.options.keybindings&&(r.container.removeEventListener("keydown",a.keydown),r.container.removeEventListener("keyup",a.keyup))},trash:function(t){u.trash(t)},combineFeatures:function(){u.combineFeatures()},uncombineFeatures:function(){u.uncombineFeatures()},getMode:function(){return s}}}function H(t){return[].concat(t).filter(function(t){return void 0!==t})}function X(t){var e,n=this;this._features={},this._featureIds=new T,this._selectedFeatureIds=new T,this._selectedCoordinates=[],this._changedFeatureIds=new T,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e=e||requestAnimationFrame(function(){e=null,function(){var n=this;if(!(n.ctx.map&&void 0!==n.ctx.map.getSource(f.HOT)))return a();var o=n.ctx.events.currentModeName();n.ctx.ui.queueMapClasses({mode:o});var e=[],t=[],t=n.isDirty?n.getAllIds():(e=n.getChangedIds().filter(function(t){return void 0!==n.get(t)}),n.sources.hot.filter(function(t){return t.properties.id&&-1===e.indexOf(t.properties.id)&&void 0!==n.get(t.properties.id)}).map(function(t){return t.properties.id}));n.sources.hot=[];var r=n.sources.cold.length;function i(t,e){t=n.get(t).internal(o);n.ctx.events.currentModeRender(t,function(t){n.sources[e].push(t)})}function a(){n.isDirty=!1,n.clearChangedIds()}n.sources.cold=n.isDirty?[]:n.sources.cold.filter(function(t){t=t.properties.id||t.properties.parent;return-1===e.indexOf(t)}),r=r!==n.sources.cold.length||0<t.length,e.forEach(function(t){return i(t,"hot")}),t.forEach(function(t){return i(t,"cold")}),r&&n.ctx.map.getSource(f.COLD).setData({type:y.FEATURE_COLLECTION,features:n.sources.cold}),n.ctx.map.getSource(f.HOT).setData({type:y.FEATURE_COLLECTION,features:n.sources.hot}),n._emitSelectionChange&&(n.ctx.map.fire(v.SELECTION_CHANGE,{features:n.getSelected().map(function(t){return t.toGeoJSON()}),points:n.getSelectedCoordinates().map(function(t){return{type:y.FEATURE,properties:{},geometry:{type:y.POINT,coordinates:t.coordinates}}})}),n._emitSelectionChange=!1),n._deletedFeaturesToEmit.length&&(r=n._deletedFeaturesToEmit.map(function(t){return t.toGeoJSON()}),n._deletedFeaturesToEmit=[],n.ctx.map.fire(v.DELETE,{features:r})),a(),n.ctx.map.fire(v.RENDER,{})}.call(n)})},this.isDirty=!1}function Z(e,t){var n=e._selectedCoordinates.filter(function(t){return e._selectedFeatureIds.has(t.feature_id)});e._selectedCoordinates.length===n.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=n}X.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,0<n&&t.render()}},X.prototype.setDirty=function(){return this.isDirty=!0,this},X.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},X.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},X.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},X.prototype.getAllIds=function(){return this._featureIds.values()},X.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},X.prototype.delete=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach(function(t){n._featureIds.has(t)&&(n._featureIds.delete(t),n._selectedFeatureIds.delete(t),e.silent||-1===n._deletedFeaturesToEmit.indexOf(n._features[t])&&n._deletedFeaturesToEmit.push(n._features[t]),delete n._features[t],n.isDirty=!0)}),Z(this,e),this},X.prototype.get=function(t){return this._features[t]},X.prototype.getAll=function(){var e=this;return Object.keys(this._features).map(function(t){return e._features[t]})},X.prototype.select=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach(function(t){n._selectedFeatureIds.has(t)||(n._selectedFeatureIds.add(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))}),this},X.prototype.deselect=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach(function(t){n._selectedFeatureIds.has(t)&&(n._selectedFeatureIds.delete(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))}),Z(this,e),this},X.prototype.clearSelected=function(t){return void 0===t&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},X.prototype.setSelected=function(e,t){var n=this;return void 0===t&&(t={}),e=H(e),this.deselect(this._selectedFeatureIds.values().filter(function(t){return-1===e.indexOf(t)}),{silent:t.silent}),this.select(e.filter(function(t){return!n._selectedFeatureIds.has(t)}),{silent:t.silent}),this},X.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},X.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},X.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},X.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map(function(t){return e.get(t)})},X.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map(function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}})},X.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},X.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},X.prototype.storeMapConfig=function(){var e=this;n.forEach(function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())})},X.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach(function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()})},X.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]};var K=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var o,r=t[n];for(o in r)Q.call(r,o)&&(e[o]=r[o])}return e},Q=Object.prototype.hasOwnProperty;var tt=["mode","feature","mouse"];function et(o){var n={},r=null,i={mode:null,feature:null,mouse:null},a={mode:null,feature:null,mouse:null};function t(t){a=K(a,t)}function e(){var t,e,n;o.container&&(e=[],n=[],tt.forEach(function(t){a[t]!==i[t]&&(e.push(t+"-"+i[t]),null!==a[t]&&n.push(t+"-"+a[t]))}),0<e.length&&(t=o.container.classList).remove.apply(t,e),0<n.length&&(t=o.container.classList).add.apply(t,n),i=K(i,a))}function s(e,n){void 0===n&&(n={});var t=document.createElement("button");return t.className=p.CONTROL_BUTTON+" "+n.className,t.setAttribute("title",n.title),n.container.appendChild(t),t.addEventListener("click",function(t){return t.preventDefault(),t.stopPropagation(),t.target===r?(u(),void n.onDeactivate()):(c(e),void n.onActivate())},!0),t}function u(){r&&(r.classList.remove(p.ACTIVE_BUTTON),r=null)}function c(t){u();var e=n[t];e&&"trash"!==t&&(e.classList.add(p.ACTIVE_BUTTON),r=e)}return{setActiveButton:c,queueMapClasses:t,updateMapClasses:e,clearMapClasses:function(){t({mode:null,feature:null,mouse:null}),e()},addButtons:function(){var t=o.options.controls,e=document.createElement("div");return e.className=p.CONTROL_GROUP+" "+p.CONTROL_BASE,t&&(t[g.LINE]&&(n[g.LINE]=s(g.LINE,{container:e,className:p.CONTROL_BUTTON_LINE,title:"LineString tool "+(o.options.keybindings?"(l)":""),onActivate:function(){return o.events.changeMode(m.DRAW_LINE_STRING)},onDeactivate:function(){return o.events.trash()}})),t[g.POLYGON]&&(n[g.POLYGON]=s(g.POLYGON,{container:e,className:p.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(o.options.keybindings?"(p)":""),onActivate:function(){return o.events.changeMode(m.DRAW_POLYGON)},onDeactivate:function(){return o.events.trash()}})),t[g.POINT]&&(n[g.POINT]=s(g.POINT,{container:e,className:p.CONTROL_BUTTON_POINT,title:"Marker tool "+(o.options.keybindings?"(m)":""),onActivate:function(){return o.events.changeMode(m.DRAW_POINT)},onDeactivate:function(){return o.events.trash()}})),t.trash&&(n.trash=s("trash",{container:e,className:p.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){o.events.trash()}})),t.combine_features&&(n.combine_features=s("combineFeatures",{container:e,className:p.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){o.events.combineFeatures()}})),t.uncombine_features&&(n.uncombine_features=s("uncombineFeatures",{container:e,className:p.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){o.events.uncombineFeatures()}}))),e},removeButtons:function(){Object.keys(n).forEach(function(t){var e=n[t];e.parentNode&&e.parentNode.removeChild(e),delete n[t]})}}}function nt(e){return function(t){t=t.featureTarget;return!!t&&(!!t.properties&&t.properties.meta===e)}}function ot(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&(t.featureTarget.properties.active===i.ACTIVE&&t.featureTarget.properties.meta===_.FEATURE))}function rt(t){return t.featureTarget&&(t.featureTarget.properties&&(t.featureTarget.properties.active===i.INACTIVE&&t.featureTarget.properties.meta===_.FEATURE))}function it(t){return void 0===t.featureTarget}function at(t){t=t.featureTarget;return t&&(t.properties&&t.properties.meta===_.VERTEX)}function st(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function ut(t){return 27===t.keyCode}function ct(t){return 13===t.keyCode}var lt=dt;function dt(t,e){this.x=t,this.y=e}function pt(t,e){var n=e.getBoundingClientRect();return new lt(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function ft(t,e,n,o){return{type:y.FEATURE,properties:{meta:_.VERTEX,parent:t,coord_path:n,active:o?i.ACTIVE:i.INACTIVE},geometry:{type:y.POINT,coordinates:e}}}function ht(n,d,o){void 0===d&&(d={}),void 0===o&&(o=null);var r,t=n.geometry,e=t.type,i=t.coordinates,p=n.properties&&n.properties.id,f=[];function a(t,u){var c="",l=null;t.forEach(function(t,e){var n,o,r,i,a=null!=u?u+"."+e:String(e),s=ft(p,t,a,h(a));d.midpoints&&l&&(n=p,r=s,i=(o=l).geometry.coordinates,a=r.geometry.coordinates,(a=i[1]>E||i[1]<b||a[1]>E||a[1]<b?null:(o=(i[0]+a[0])/2,a=(i[1]+a[1])/2,{type:y.FEATURE,properties:{meta:_.MIDPOINT,parent:n,lng:o,lat:a,coord_path:r.properties.coord_path},geometry:{type:y.POINT,coordinates:[o,a]}}))&&f.push(a)),l=s;t=JSON.stringify(t);c!==t&&f.push(s),0===e&&(c=t)})}function h(t){return!!d.selectedPaths&&-1!==d.selectedPaths.indexOf(t)}return e===y.POINT?f.push(ft(p,i,o,h(o))):e===y.POLYGON?i.forEach(function(t,e){a(t,null!==o?o+"."+e:String(e))}):e===y.LINE_STRING?a(i,o):0===e.indexOf(y.MULTI_PREFIX)&&(r=e.replace(y.MULTI_PREFIX,""),i.forEach(function(t,e){t={type:y.FEATURE,properties:n.properties,geometry:{type:r,coordinates:t}};f=f.concat(ht(t,d,e))})),f}dt.prototype={clone:function(){return new dt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,t=t.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,t=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=t,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),t=e*this.x-n*this.y,e=n*this.x+e*this.y;return this.x=t,this.y=e,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),t=e.x+n*(this.x-e.x)-o*(this.y-e.y),e=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=t,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},dt.convert=function(t){return!(t instanceof dt)&&Array.isArray(t)?new dt(t[0],t[1]):t};var gt=function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},yt=function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()},0)},mt=function(t){if(!t||!t.type)return null;var e=vt[t.type];if(!e)return null;return"geometry"===e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]}:"feature"===e?{type:"FeatureCollection",features:[t]}:"featurecollection"===e?t:void 0},vt={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function _t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce(function(t,e){return t.concat(_t(e))},[]),e;case"Feature":return e.geometry?_t(e.geometry).map(function(t){t={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return void 0!==e.id&&(t.id=e.id),t}):[e];case"MultiPoint":return e.coordinates.map(function(t){return{type:"Point",coordinates:t}});case"MultiPolygon":return e.coordinates.map(function(t){return{type:"Polygon",coordinates:t}});case"MultiLineString":return e.coordinates.map(function(t){return{type:"LineString",coordinates:t}});case"GeometryCollection":return e.geometries.map(_t).reduce(function(t,e){return t.concat(e)},[]);case"Point":case"Polygon":case"LineString":return[e]}}function bt(t){return function n(t){if(Array.isArray(t)&&t.length&&"number"==typeof t[0])return[t];return t.reduce(function(t,e){return Array.isArray(e)&&Array.isArray(e[0])?t.concat(n(e)):(t.push(e),t)},[])}(t)}var Et=R(function(t){var e=t.exports=function(t){return new o(t)};function o(t){this.value=t}function n(t,s,u){var c=[],l=[],d=!0;return function o(e){var t=u?p(e):e,r={},n=!0,i={node:t,node_:e,path:[].concat(c),parent:l[l.length-1],parents:l,key:c.slice(-1)[0],isRoot:0===c.length,level:c.length,circular:null,update:function(t,e){i.isRoot||(i.parent.node[i.key]=t),i.node=t,e&&(n=!1)},delete:function(t){delete i.parent.node[i.key],t&&(n=!1)},remove:function(t){h(i.parent.node)?i.parent.node.splice(i.key,1):delete i.parent.node[i.key],t&&(n=!1)},keys:null,before:function(t){r.before=t},after:function(t){r.after=t},pre:function(t){r.pre=t},post:function(t){r.post=t},stop:function(){d=!1},block:function(){n=!1}};if(!d)return i;function a(){if("object"==typeof i.node&&null!==i.node){i.keys&&i.node_===i.node||(i.keys=f(i.node)),i.isLeaf=0==i.keys.length;for(var t=0;t<l.length;t++)if(l[t].node_===e){i.circular=l[t];break}}else i.isLeaf=!0,i.keys=null;i.notLeaf=!i.isLeaf,i.notRoot=!i.isRoot}a();t=s.call(i,i.node);return void 0!==t&&i.update&&i.update(t),r.before&&r.before.call(i,i.node),n&&("object"!=typeof i.node||null===i.node||i.circular||(l.push(i),a(),g(i.keys,function(t,e){c.push(t),r.pre&&r.pre.call(i,i.node[t],t);var n=o(i.node[t]);u&&y.call(i.node,t)&&(i.node[t]=n.node),n.isLast=e==i.keys.length-1,n.isFirst=0==e,r.post&&r.post.call(i,n),c.pop()}),l.pop()),r.after&&r.after.call(i,i.node)),i}(t).node}function p(e){if("object"!=typeof e||null===e)return e;var t,n,o=h(e)?[]:"[object Date]"===r(e)?new Date(e.getTime?e.getTime():e):"[object RegExp]"===r(e)?new RegExp(e):"[object Error]"===r(e)?{message:e.message}:"[object Boolean]"===r(e)?new Boolean(e):"[object Number]"===r(e)?new Number(e):"[object String]"===r(e)?new String(e):Object.create&&Object.getPrototypeOf?Object.create(Object.getPrototypeOf(e)):e.constructor===Object?{}:(t=e.constructor&&e.constructor.prototype||e.__proto__||{},(n=function(){}).prototype=t,new n);return g(f(e),function(t){o[t]=e[t]}),o}o.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!y.call(e,o)){e=void 0;break}e=e[o]}return e},o.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!y.call(e,o))return!1;e=e[o]}return!0},o.prototype.set=function(t,e){for(var n=this.value,o=0;o<t.length-1;o++){var r=t[o];y.call(n,r)||(n[r]={}),n=n[r]}return n[t[o]]=e},o.prototype.map=function(t){return n(this.value,t,!0)},o.prototype.forEach=function(t){return this.value=n(this.value,t,!1),this.value},o.prototype.reduce=function(e,t){var n=1===arguments.length,o=n?this.value:t;return this.forEach(function(t){this.isRoot&&n||(o=e.call(this,o,t))}),o},o.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},o.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},o.prototype.clone=function(){var r=[],i=[];return function e(n){for(var t=0;t<r.length;t++)if(r[t]===n)return i[t];if("object"!=typeof n||null===n)return n;var o=p(n);return r.push(n),i.push(o),g(f(n),function(t){o[t]=e(n[t])}),r.pop(),i.pop(),o}(this.value)};var f=Object.keys||function(t){var e,n=[];for(e in t)n.push(e);return n};function r(t){return Object.prototype.toString.call(t)}var h=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},g=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};g(f(o.prototype),function(n){e[n]=function(t){var e=[].slice.call(arguments,1),t=new o(t);return t[n].apply(t,e)}});var y=Object.hasOwnProperty||function(t,e){return e in t}}),Tt=Ct;function Ct(t){if(!(this instanceof Ct))return new Ct(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}Ct.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},Ct.prototype.equals=function(t){t=t instanceof Ct?t.bbox():t;return this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},Ct.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Ct.prototype.union=function(t){return this._valid=!0,t=t instanceof Ct?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},Ct.prototype.bbox=function(){return this._valid?this._bbox:null},Ct.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],t=t[1];return this._bbox[0]<=e&&this._bbox[1]<=t&&this._bbox[2]>=e&&this._bbox[3]>=t},Ct.prototype.intersect=function(t){if(!this._valid)return null;t=t instanceof Ct?t.bbox():t;return!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])},Ct.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},Ct.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var It={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},St=Object.keys(It),Ot=function(t){return xt(t).bbox()};function xt(t){for(var e=Tt(),n=function(t){if(!t)return[];var t=_t(mt(t)),e=[];return t.features.forEach(function(t){t.geometry&&(e=e.concat(bt(t.geometry.coordinates)))}),e}(t),o=0;o<n.length;o++)e.include(n[o]);return e}Ot.polygon=function(t){return xt(t).polygon()},Ot.bboxify=function(t){return Et(t).map(function(e){e&&St.some(function(t){return!!e[t]&&-1!==It[t].indexOf(e.type)})&&(e.bbox=xt(e).bbox(),this.update(e))})};var Lt=-90,Mt=90,Nt=b,Pt=E,Ft=-270,wt=270;function At(t,e){var r=Lt,i=Mt,a=Lt,s=Mt,u=wt,c=Ft;t.forEach(function(t){var e=Ot(t),n=e[1],o=e[3],t=e[0],e=e[2];r<n&&(r=n),o<i&&(i=o),a<o&&(a=o),n<s&&(s=n),t<u&&(u=t),c<e&&(c=e)});return r+e.lat>Pt&&(e.lat=Pt-r),a+e.lat>Mt&&(e.lat=Mt-a),i+e.lat<Nt&&(e.lat=Nt-i),s+e.lat<Lt&&(e.lat=Lt-s),u+e.lng<=Ft&&(e.lng+=360*Math.ceil(Math.abs(e.lng)/360)),c+e.lng>=wt&&(e.lng-=360*Math.ceil(Math.abs(e.lng)/360)),e}function Rt(t,e){var i=At(t.map(function(t){return t.toGeoJSON()}),e);t.forEach(function(t){function e(t){return[t[0]+i.lng,t[1]+i.lat]}function n(t){return t.map(e)}var o,r=t.getCoordinates();t.type===y.POINT?o=e(r):t.type===y.LINE_STRING||t.type===y.MULTI_POINT?o=r.map(e):t.type===y.POLYGON||t.type===y.MULTI_LINE_STRING?o=r.map(n):t.type===y.MULTI_POLYGON&&(o=r.map(function(t){return t.map(n)})),t.incomingCoords(o)})}var kt={onSetup:function(t){var e=this,t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(function(t){return void 0!==e.getFeature(t)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t},fireUpdate:function(){this.map.fire(v.UPDATE,{action:t,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(){var e,n=this,t=this.getSelected(),o=t.filter(function(t){return n.isInstanceOf("MultiFeature",t)}),r=!1;1<t.length&&(r=!0,e=t[0].type.replace("Multi",""),t.forEach(function(t){t.type.replace("Multi","")!==e&&(r=!1)}));o=0<o.length,t=0<t.length;this.setActionableState({combineFeatures:r,uncombineFeatures:o,trash:t})},getUniqueIds:function(t){return t.length?t.map(function(t){return t.properties.id}).filter(function(t){return void 0!==t}).reduce(function(t,e){return t.add(e),t},new T).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){gt(this)},onMouseMove:function(t){return this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};kt.onTap=kt.onClick=function(t,e){return it(e)?this.clickAnywhere(t,e):nt(_.VERTEX)(e)?this.clickOnVertex(t,e):(n=e).featureTarget&&(n.featureTarget.properties&&n.featureTarget.properties.meta===_.FEATURE)?this.clickOnFeature(t,e):void 0;var n},kt.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(function(t){return e.doRender(t)})),gt(this),this.stopExtendedInteractions(t)},kt.clickOnVertex=function(t,e){this.changeMode(m.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:h.MOVE})},kt.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},kt.clickOnFeature=function(t,e){var n=this;yt(this),this.stopExtendedInteractions(t);var o=st(e),r=this.getSelectedIds(),t=e.featureTarget.properties.id,e=this.isSelected(t);if(!o&&e&&this.getFeature(t).type!==y.POINT)return this.changeMode(m.DIRECT_SELECT,{featureId:t});e&&o?(this.deselect(t),this.updateUIClasses({mouse:h.POINTER}),1===r.length&&gt(this)):!e&&o?(this.select(t),this.updateUIClasses({mouse:h.MOVE})):e||o||(r.forEach(function(t){return n.doRender(t)}),this.setSelected(t),this.updateUIClasses({mouse:h.MOVE})),this.doRender(t)},kt.onMouseDown=function(t,e){return ot(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&((n=e).originalEvent&&(n.originalEvent.shiftKey&&0===n.originalEvent.button))?this.startBoxSelect(t,e):void 0;var n},kt.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=pt(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},kt.onTouchStart=function(t,e){if(ot(e))return this.startOnActiveFeature(t,e)},kt.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},kt.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:h.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(p.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=pt(e.originalEvent,this.map.getContainer()),o=Math.min(t.boxSelectStartLocation.x,n.x),r=Math.max(t.boxSelectStartLocation.x,n.x),i=Math.min(t.boxSelectStartLocation.y,n.y),e=Math.max(t.boxSelectStartLocation.y,n.y),n="translate("+o+"px, "+i+"px)";t.boxSelectElement.style.transform=n,t.boxSelectElement.style.WebkitTransform=n,t.boxSelectElement.style.width=r-o+"px",t.boxSelectElement.style.height=e-i+"px"},kt.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Rt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},kt.onMouseUp=function(t,e){var n=this;t.dragMoving?this.fireUpdate():t.boxSelecting&&(e=[t.boxSelectStartLocation,pt(e.originalEvent,this.map.getContainer())],e=this.featuresAt(null,e,"click"),(e=this.getUniqueIds(e).filter(function(t){return!n.isSelected(t)})).length&&(this.select(e),e.forEach(function(t){return n.doRender(t)}),this.updateUIClasses({mouse:h.MOVE}))),this.stopExtendedInteractions(t)},kt.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?i.ACTIVE:i.INACTIVE,n(e),this.fireActionable(),e.properties.active===i.ACTIVE&&e.geometry.type!==y.POINT&&ht(e).forEach(n)},kt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},kt.onCombineFeatures=function(){var t=this.getSelected();if(!(0===t.length||t.length<2)){for(var e,n=[],o=[],r=t[0].type.replace("Multi",""),i=0;i<t.length;i++){var a=t[i];if(a.type.replace("Multi","")!==r)return;a.type.includes("Multi")?a.getCoordinates().forEach(function(t){n.push(t)}):n.push(a.getCoordinates()),o.push(a.toGeoJSON())}1<o.length&&(e=this.newFeature({type:y.FEATURE,properties:o[0].properties,geometry:{type:"Multi"+r,coordinates:n}}),this.addFeature(e),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([e.id]),this.map.fire(v.COMBINE_FEATURES,{createdFeatures:[e.toGeoJSON()],deletedFeatures:o})),this.fireActionable()}},kt.onUncombineFeatures=function(){var n=this,o=this.getSelected();if(0!==o.length){for(var r=[],i=[],t=0;t<o.length;t++)!function(t){var e=o[t];n.isInstanceOf("MultiFeature",e)&&(e.getFeatures().forEach(function(t){n.addFeature(t),t.properties=e.properties,r.push(t.toGeoJSON()),n.select([t.id])}),n.deleteFeature(e.id,{silent:!0}),i.push(e.toGeoJSON()))}(t);1<r.length&&this.map.fire(v.UNCOMBINE_FEATURES,{createdFeatures:r,deletedFeatures:i}),this.fireActionable()}};var Ut=nt(_.VERTEX),Dt=nt(_.MIDPOINT),jt={fireUpdate:function(){this.map.fire(v.UPDATE,{action:e,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:0<t.selectedCoordPaths.length})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,o=t.selectedCoordPaths.indexOf(n.coord_path);st(e)||-1!==o?st(e)&&-1===o&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];t=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(t)},onMidpoint:function(t,e){this.startDragging(t,e);e=e.featureTarget.properties;t.feature.addCoordinate(e.coord_path,e.lng,e.lat),this.fireUpdate(),t.selectedCoordPaths=[e.coord_path]},pathsToCoordinates:function(e,t){return t.map(function(t){return{feature_id:e,coord_path:t}})},onFeature:function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){Rt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(e,t,n){for(var o=e.selectedCoordPaths.map(function(t){return e.feature.getCoordinate(t)}),r=At(o.map(function(t){return{type:y.FEATURE,properties:{},geometry:{type:y.POINT,coordinates:t}}}),n),i=0;i<o.length;i++){var a=o[i];e.feature.updateCoordinate(e.selectedCoordPaths[i],a[0]+r.lng,a[1]+r.lat)}},clickNoTarget:function(){this.changeMode(m.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(m.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===y.POINT)throw new TypeError("direct_select mode doesn't handle point features");t={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,t.selectedCoordPaths)),this.setSelected(e),yt(this),this.setActionableState({trash:!0}),t},onStop:function(){gt(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=i.ACTIVE,n(e),ht(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=i.INACTIVE,n(e)),this.fireActionable(t)},onTrash:function(e){e.selectedCoordPaths.sort(function(t,e){return e.localeCompare(t,"en",{numeric:!0})}).forEach(function(t){return e.feature.removeCoordinate(t)}),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(m.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=ot(e),o=Ut(e),e=0===t.selectedCoordPaths.length;return n&&e||o&&!e?this.updateUIClasses({mouse:h.MOVE}):this.updateUIClasses({mouse:h.NONE}),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};jt.onTouchStart=jt.onMouseDown=function(t,e){return Ut(e)?this.onVertex(t,e):ot(e)?this.onFeature(t,e):Dt(e)?this.onMidpoint(t,e):void 0},jt.onDrag=function(t,e){var n;!0===t.canDragMove&&(t.dragMoving=!0,e.originalEvent.stopPropagation(),n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat},0<t.selectedCoordPaths.length?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat)},jt.onClick=function(t,e){return it(e)?this.clickNoTarget(t,e):ot(e)?this.clickActiveFeature(t,e):rt(e)?this.clickInactive(t,e):void this.stopDragging(t)},jt.onTap=function(t,e){return it(e)?this.clickNoTarget(t,e):ot(e)?this.clickActiveFeature(t,e):rt(e)?this.clickInactive(t,e):void 0},jt.onTouchEnd=jt.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var Vt={};function Bt(t,e){return t.lngLat&&(t.lngLat.lng===e[0]&&t.lngLat.lat===e[1])}Vt.onSetup=function(){var t=this.newFeature({type:y.FEATURE,properties:{},geometry:{type:y.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:h.ADD}),this.activateUIButton(g.POINT),this.setActionableState({trash:!0}),{point:t}},Vt.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},Vt.onTap=Vt.onClick=function(t,e){this.updateUIClasses({mouse:h.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(v.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.point.id]})},Vt.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},Vt.toDisplayFeatures=function(t,e,n){t=e.properties.id===t.point.id;if(e.properties.active=t?i.ACTIVE:i.INACTIVE,!t)return n(e)},Vt.onTrash=Vt.stopDrawingAndRemove,Vt.onKeyUp=function(t,e){if(ut(e)||ct(e))return this.stopDrawingAndRemove(t,e)};var Gt={onSetup:function(){var t=this.newFeature({type:y.FEATURE,properties:{},geometry:{type:y.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),yt(this),this.updateUIClasses({mouse:h.ADD}),this.activateUIButton(g.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(0<t.currentVertexPosition&&Bt(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:h.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),at(e)&&this.updateUIClasses({mouse:h.POINTER})}};Gt.onTap=Gt.onClick=function(t,e){return at(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},Gt.onKeyUp=function(t,e){ut(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)):ct(e)&&this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},Gt.onStop=function(t){this.updateUIClasses({mouse:h.NONE}),gt(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(v.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT,{},{silent:!0})))},Gt.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.polygon.id;if(e.properties.active=o?i.ACTIVE:i.INACTIVE,!o)return n(e);if(0!==e.geometry.coordinates.length){o=e.geometry.coordinates[0].length;if(!(o<3)){if(e.properties.meta=_.FEATURE,n(ft(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),3<o&&(r=e.geometry.coordinates[0].length-3,n(ft(t.polygon.id,e.geometry.coordinates[0][r],"0."+r,!1))),o<=4){var r=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:y.FEATURE,properties:e.properties,geometry:{coordinates:r,type:y.LINE_STRING}}),3===o)return}return n(e)}}},Gt.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)};var Jt={onSetup:function(t){var e,n,o=(t=t||{}).featureId,r="forward";if(o){if(!(e=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");o=t.from;if(!(o=(o=o&&"Feature"===o.type&&o.geometry&&"Point"===o.geometry.type?o.geometry:o)&&"Point"===o.type&&o.coordinates&&2===o.coordinates.length?o.coordinates:o)||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");t=e.coordinates.length-1;if(e.coordinates[t][0]===o[0]&&e.coordinates[t][1]===o[1])e.addCoordinate.apply(e,[n=1+t].concat(e.coordinates[t]));else{if(e.coordinates[0][0]!==o[0]||e.coordinates[0][1]!==o[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",e.addCoordinate.apply(e,[n=0].concat(e.coordinates[0]))}}else e=this.newFeature({type:y.FEATURE,properties:{},geometry:{type:y.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),yt(this),this.updateUIClasses({mouse:h.ADD}),this.activateUIButton(g.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:r}},clickAnywhere:function(t,e){if(0<t.currentVertexPosition&&Bt(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&Bt(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:h.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),at(e)&&this.updateUIClasses({mouse:h.POINTER})}};Jt.onTap=Jt.onClick=function(t,e){if(at(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},Jt.onKeyUp=function(t,e){ct(e)?this.changeMode(m.SIMPLE_SELECT,{featureIds:[t.line.id]}):ut(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT))},Jt.onStop=function(t){gt(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(v.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT,{},{silent:!0})))},Jt.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(m.SIMPLE_SELECT)},Jt.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.line.id;if(e.properties.active=o?i.ACTIVE:i.INACTIVE,!o)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=_.FEATURE,n(ft(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),n(e))};var Jt={simple_select:kt,direct_select:jt,draw_point:Vt,draw_polygon:Gt,draw_line_string:Jt},zt={defaultMode:m.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:Jt,controls:{},userProperties:!1},Yt={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},$t={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function qt(t,e){return t.map(function(t){return t.source?t:K(t,{id:t.id+"."+e,source:"hot"===e?f.HOT:f.COLD})})}var Wt=R(function(t,e){var o="__lodash_hash_undefined__",v=1,g=2,p=9007199254740991,d="[object Arguments]",f="[object Array]",n="[object AsyncFunction]",h="[object Boolean]",y="[object Date]",m="[object Error]",r="[object Function]",i="[object GeneratorFunction]",_="[object Map]",b="[object Number]",a="[object Null]",E="[object Object]",s="[object Promise]",u="[object Proxy]",T="[object RegExp]",C="[object Set]",I="[object String]",S="[object Symbol]",c="[object Undefined]",l="[object WeakMap]",O="[object ArrayBuffer]",x="[object DataView]",L=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,N={};N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N[d]=N[f]=N[O]=N[h]=N[x]=N[y]=N[m]=N[r]=N[_]=N[b]=N[E]=N[T]=N[C]=N[I]=N[l]=!1;var P="object"==typeof global&&global&&global.Object===Object&&global,F="object"==typeof self&&self&&self.Object===Object&&self,w=P||F||Function("return this")(),A=e&&!e.nodeType&&e,R=A&&t&&!t.nodeType&&t,k=R&&R.exports===A,U=k&&P.process,F=function(){try{return U&&U.binding&&U.binding("util")}catch(t){}}(),e=F&&F.isTypedArray;function D(t){var n=-1,o=Array(t.size);return t.forEach(function(t,e){o[++n]=[e,t]}),o}function j(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var V,B,R=Array.prototype,A=Function.prototype,G=Object.prototype,P=w["__core-js_shared__"],J=A.toString,z=G.hasOwnProperty,Y=(F=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+F:"",$=G.toString,q=RegExp("^"+J.call(z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),A=k?w.Buffer:void 0,P=w.Symbol,W=w.Uint8Array,H=G.propertyIsEnumerable,X=R.splice,Z=P?P.toStringTag:void 0,K=Object.getOwnPropertySymbols,F=A?A.isBuffer:void 0,Q=(V=Object.keys,B=Object,function(t){return V(B(t))}),k=It(w,"DataView"),tt=It(w,"Map"),R=It(w,"Promise"),A=It(w,"Set"),w=It(w,"WeakMap"),et=It(Object,"create"),nt=xt(k),ot=xt(tt),rt=xt(R),it=xt(A),at=xt(w),P=P?P.prototype:void 0,st=P?P.valueOf:void 0;function ut(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function ct(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function lt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function dt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new lt;++e<n;)this.add(t[e])}function pt(t){t=this.__data__=new ct(t);this.size=t.size}function ft(t,e){var n,o,r,i=Nt(t),a=!i&&Mt(t),s=!i&&!a&&Pt(t),u=!i&&!a&&!s&&Ut(t),c=i||a||s||u,l=c?function(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}(t.length,String):[],d=l.length;for(n in t)!e&&!z.call(t,n)||c&&("length"==n||s&&("offset"==n||"parent"==n)||u&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||(o=n,!!(r=null==(r=d)?p:r)&&("number"==typeof o||M.test(o))&&-1<o&&o%1==0&&o<r))||l.push(n);return l}function ht(t,e){for(var n=t.length;n--;)if(Lt(t[n][0],e))return n;return-1}function gt(t,e,n){e=e(t);return Nt(t)?e:function(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}(e,n(t))}function yt(t){return null==t?void 0===t?c:a:Z&&Z in Object(t)?function(t){var e=z.call(t,Z),n=t[Z];try{var o=!(t[Z]=void 0)}catch(t){}var r=$.call(t);o&&(e?t[Z]=n:delete t[Z]);return r}(t):$.call(t)}function mt(t){return Rt(t)&&yt(t)==d}function vt(t,e,n,o,r){return t===e||(null==t||null==e||!Rt(t)&&!Rt(e)?t!=t&&e!=e:function(t,e,n,o,r,i){var a=Nt(t),s=Nt(e),u=a?f:Ot(t),c=s?f:Ot(e),l=(u=u==d?E:u)==E,s=(c=c==d?E:c)==E,c=u==c;if(c&&Pt(t)){if(!Pt(e))return!1;l=!(a=!0)}if(c&&!l)return i=i||new pt,a||Ut(t)?Et(t,e,n,o,r,i):function(t,e,n,o,r,i,a){switch(n){case x:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case O:return t.byteLength==e.byteLength&&i(new W(t),new W(e))?!0:!1;case h:case y:case b:return Lt(+t,+e);case m:return t.name==e.name&&t.message==e.message;case T:case I:return t==e+"";case _:var s=D;case C:var u=o&v;if(s=s||j,t.size!=e.size&&!u)return!1;u=a.get(t);if(u)return u==e;o|=g,a.set(t,e);s=Et(s(t),s(e),o,r,i,a);return a.delete(t),s;case S:if(st)return st.call(t)==st.call(e)}return!1}(t,e,u,n,o,r,i);if(!(n&v)){l=l&&z.call(t,"__wrapped__"),s=s&&z.call(e,"__wrapped__");if(l||s){l=l?t.value():t,s=s?e.value():e;return i=i||new pt,r(l,s,n,o,i)}}return c&&(i=i||new pt,function(t,e,n,o,r,i){var a=n&v,s=Tt(t),u=s.length,c=Tt(e).length;if(u!=c&&!a)return!1;var l=u;for(;l--;){var d=s[l];if(!(a?d in e:z.call(e,d)))return!1}var p=i.get(t);if(p&&i.get(e))return p==e;var f=!0;i.set(t,e),i.set(e,t);var h=a;for(;++l<u;){d=s[l];var g,y=t[d],m=e[d];if(!(void 0===(g=o?a?o(m,y,d,e,t,i):o(y,m,d,t,e,i):g)?y===m||r(y,m,n,o,i):g)){f=!1;break}h=h||"constructor"==d}f&&!h&&(c=t.constructor,p=e.constructor,c!=p&&"constructor"in t&&"constructor"in e&&!("function"==typeof c&&c instanceof c&&"function"==typeof p&&p instanceof p)&&(f=!1));return i.delete(t),i.delete(e),f}(t,e,n,o,r,i))}(t,e,n,o,vt,r))}function _t(t){var e;return At(t)&&(e=t,!(Y&&Y in e))&&(Ft(t)?q:L).test(xt(t))}function bt(t){if(n="function"==typeof(n=(e=t)&&e.constructor)&&n.prototype||G,e!==n)return Q(t);var e,n,o,r=[];for(o in Object(t))z.call(t,o)&&"constructor"!=o&&r.push(o);return r}function Et(t,e,n,o,r,i){var a=n&v,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;u=i.get(t);if(u&&i.get(e))return u==e;var c=-1,l=!0,d=n&g?new dt:void 0;for(i.set(t,e),i.set(e,t);++c<s;){var p,f=t[c],h=e[c];if(void 0!==(p=o?a?o(h,f,c,e,t,i):o(f,h,c,t,e,i):p)){if(p)continue;l=!1;break}if(d){if(!function(t,e){for(var n=-1,o=null==t?0:t.length;++n<o;)if(e(t[n],n,t))return 1}(e,function(t,e){return!d.has(e)&&(f===t||r(f,t,n,o,i))&&d.push(e)})){l=!1;break}}else if(f!==h&&!r(f,h,n,o,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function Tt(t){return gt(t,Dt,St)}function Ct(t,e){var n,o=t.__data__;return("string"==(t=typeof(n=e))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function It(t,e){e=e,e=null==(t=t)?void 0:t[e];return _t(e)?e:void 0}ut.prototype.clear=function(){this.__data__=et?et(null):{},this.size=0},ut.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},ut.prototype.get=function(t){var e=this.__data__;if(et){var n=e[t];return n===o?void 0:n}return z.call(e,t)?e[t]:void 0},ut.prototype.has=function(t){var e=this.__data__;return et?void 0!==e[t]:z.call(e,t)},ut.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=et&&void 0===e?o:e,this},ct.prototype.clear=function(){this.__data__=[],this.size=0},ct.prototype.delete=function(t){var e=this.__data__;return!((t=ht(e,t))<0)&&(t==e.length-1?e.pop():X.call(e,t,1),--this.size,!0)},ct.prototype.get=function(t){var e=this.__data__;return(t=ht(e,t))<0?void 0:e[t][1]},ct.prototype.has=function(t){return-1<ht(this.__data__,t)},ct.prototype.set=function(t,e){var n=this.__data__,o=ht(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this},lt.prototype.clear=function(){this.size=0,this.__data__={hash:new ut,map:new(tt||ct),string:new ut}},lt.prototype.delete=function(t){return t=Ct(this,t).delete(t),this.size-=t?1:0,t},lt.prototype.get=function(t){return Ct(this,t).get(t)},lt.prototype.has=function(t){return Ct(this,t).has(t)},lt.prototype.set=function(t,e){var n=Ct(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this},dt.prototype.add=dt.prototype.push=function(t){return this.__data__.set(t,o),this},dt.prototype.has=function(t){return this.__data__.has(t)},pt.prototype.clear=function(){this.__data__=new ct,this.size=0},pt.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},pt.prototype.get=function(t){return this.__data__.get(t)},pt.prototype.has=function(t){return this.__data__.has(t)},pt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ct){var o=n.__data__;if(!tt||o.length<199)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new lt(o)}return n.set(t,e),this.size=n.size,this};var St=K?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var n=-1,o=null==t?0:t.length,r=0,i=[];++n<o;){var a=t[n];e(a,n,t)&&(i[r++]=a)}return i}(K(e),function(t){return H.call(e,t)}))}:function(){return[]},Ot=yt;function xt(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Lt(t,e){return t===e||t!=t&&e!=e}(k&&Ot(new k(new ArrayBuffer(1)))!=x||tt&&Ot(new tt)!=_||R&&Ot(R.resolve())!=s||A&&Ot(new A)!=C||w&&Ot(new w)!=l)&&(Ot=function(t){var e=yt(t),t=e==E?t.constructor:void 0,t=t?xt(t):"";if(t)switch(t){case nt:return x;case ot:return _;case rt:return s;case it:return C;case at:return l}return e});var Mt=mt(function(){return arguments}())?mt:function(t){return Rt(t)&&z.call(t,"callee")&&!H.call(t,"callee")},Nt=Array.isArray;var Pt=F||function(){return!1};function Ft(t){if(At(t)){t=yt(t);return t==r||t==i||t==n||t==u}}function wt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=p}function At(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Rt(t){return null!=t&&"object"==typeof t}var kt,Ut=e?(kt=e,function(t){return kt(t)}):function(t){return Rt(t)&&wt(t.length)&&!!N[yt(t)]};function Dt(t){return(null!=(e=t)&&wt(e.length)&&!Ft(e)?ft:bt)(t);var e}t.exports=function(t,e){return vt(t,e)}});var Ht={Polygon:V,LineString:j,Point:D,MultiPolygon:G,MultiLineString:G,MultiPoint:G};function Xt(r,i){return i.modes=m,i.getFeatureIdsAt=function(t){return I.click({point:t},null,r).map(function(t){return t.properties.id})},i.getSelectedIds=function(){return r.store.getSelectedIds()},i.getSelected=function(){return{type:y.FEATURE_COLLECTION,features:r.store.getSelectedIds().map(function(t){return r.store.get(t)}).map(function(t){return t.toGeoJSON()})}},i.getSelectedPoints=function(){return{type:y.FEATURE_COLLECTION,features:r.store.getSelectedCoordinates().map(function(t){return{type:y.FEATURE,properties:{},geometry:{type:y.POINT,coordinates:t.coordinates}}})}},i.set=function(t){if(void 0===t.type||t.type!==y.FEATURE_COLLECTION||!Array.isArray(t.features))throw new Error("Invalid FeatureCollection");var e=r.store.createRenderBatch(),n=r.store.getAllIds().slice(),t=i.add(t),o=new T(t);return(n=n.filter(function(t){return!o.has(t)})).length&&i.delete(n),e(),t},i.add=function(t){t=JSON.parse(JSON.stringify(mt(t))).features.map(function(t){if(t.id=t.id||U(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===r.store.get(t.id)||r.store.get(t.id).type!==t.geometry.type){var e=Ht[t.geometry.type];if(void 0===e)throw new Error("Invalid geometry type: "+t.geometry.type+".");e=new e(r,t);r.store.add(e)}else{e=r.store.get(t.id);e.properties=t.properties,Wt(e.getCoordinates(),t.geometry.coordinates)||e.incomingCoords(t.geometry.coordinates)}return t.id});return r.store.render(),t},i.get=function(t){t=r.store.get(t);if(t)return t.toGeoJSON()},i.getAll=function(){return{type:y.FEATURE_COLLECTION,features:r.store.getAll().map(function(t){return t.toGeoJSON()})}},i.delete=function(t){return r.store.delete(t,{silent:!0}),i.getMode()!==m.DIRECT_SELECT||r.store.getSelectedIds().length?r.store.render():r.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}),i},i.deleteAll=function(){return r.store.delete(r.store.getAllIds(),{silent:!0}),i.getMode()===m.DIRECT_SELECT?r.events.changeMode(m.SIMPLE_SELECT,void 0,{silent:!0}):r.store.render(),i},i.changeMode=function(t,e){return void 0===e&&(e={}),t===m.SIMPLE_SELECT&&i.getMode()===m.SIMPLE_SELECT?(n=e.featureIds||[],o=r.store.getSelectedIds(),n.length===o.length&&JSON.stringify(n.map(function(t){return t}).sort())===JSON.stringify(o.map(function(t){return t}).sort())||(r.store.setSelected(e.featureIds,{silent:!0}),r.store.render()),i):(t===m.DIRECT_SELECT&&i.getMode()===m.DIRECT_SELECT&&e.featureId===r.store.getSelectedIds()[0]||r.events.changeMode(t,e,{silent:!0}),i);var n,o},i.getMode=function(){return r.events.getMode()},i.trash=function(){return r.events.trash({silent:!0}),i},i.combineFeatures=function(){return r.events.combineFeatures({silent:!0}),i},i.uncombineFeatures=function(){return r.events.uncombineFeatures({silent:!0}),i},i.setFeatureProperty=function(t,e,n){return r.store.setFeatureProperty(t,e,n),i},i}function Zt(t,e){var n;o=K(n=void 0===(n=t)?{}:n),n.controls||(o.controls={}),!1===n.displayControlsDefault?o.controls=K($t,n.controls):o.controls=K(Yt,n.controls),(o=K(zt,o)).styles=qt(o.styles,"cold").concat(qt(o.styles,"hot"));var o={options:t=o};e=Xt(o,e),o.api=e;var i,a,s,u,o=(s=a=null,u={onRemove:function(){return i.map.off("load",u.connect),clearInterval(s),u.removeLayers(),i.store.restoreMapConfig(),i.ui.removeButtons(),i.events.removeEventListeners(),i.ui.clearMapClasses(),i.map=null,i.container=null,i.store=null,a&&a.parentNode&&a.parentNode.removeChild(a),a=null,this},connect:function(){i.map.off("load",u.connect),clearInterval(s),u.addLayers(),i.store.storeMapConfig(),i.events.addEventListeners()},onAdd:function(o){var r=o.fire;return o.fire=function(t,e){var n=arguments;return 1===r.length&&1!==arguments.length&&(n=[K({},{type:t},e)]),r.apply(o,n)},i.map=o,i.events=W(i),i.ui=et(i),i.container=o.getContainer(),i.store=new X(i),a=i.ui.addButtons(),i.options.boxSelect&&(o.boxZoom.disable(),o.dragPan.disable(),o.dragPan.enable()),o.loaded()?u.connect():(o.on("load",u.connect),s=setInterval(function(){o.loaded()&&u.connect()},16)),i.events.start(),a},addLayers:function(){i.map.addSource(f.COLD,{data:{type:y.FEATURE_COLLECTION,features:[]},type:"geojson"}),i.map.addSource(f.HOT,{data:{type:y.FEATURE_COLLECTION,features:[]},type:"geojson"}),i.options.styles.forEach(function(t){i.map.addLayer(t)}),i.store.setDirty(!0),i.store.render()},removeLayers:function(){i.options.styles.forEach(function(t){i.map.getLayer(t.id)&&i.map.removeLayer(t.id)}),i.map.getSource(f.COLD)&&i.map.removeSource(f.COLD),i.map.getSource(f.HOT)&&i.map.removeSource(f.HOT)}},(i=o).setup=u);return e.onAdd=o.onAdd,e.onRemove=o.onRemove,e.types=g,e.options=t,e}function Kt(t){Zt(t,this)}return Kt.modes=Jt,Kt});