import{voronoi}from"d3-voronoi";import{polygonCentroid,polygonArea}from"d3-polygon";import{selectAll,select}from"d3-selection";import"d3-brush";var _extendStatics=function(t,e){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");_extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function __spreadArrays(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,r++)o[r]=i[a];return o}var win="object"==typeof globalThis&&null!==globalThis&&globalThis.Object===Object&&globalThis||"object"==typeof global&&null!==global&&global.Object===Object&&global||"object"==typeof self&&null!==self&&self.Object===Object&&self||Function("return this")(),doc=win&&win.document,isDefined=function(t){return void 0!==t},isObjectType=function(t){return"object"==typeof t},isArray=function(t){return Array.isArray(t)},isObject=function(t){return t&&!t.nodeType&&isObjectType(t)&&!isArray(t)};function mergeObj(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!e.length||1===e.length&&!e[0])return t;var o=e.shift();return isObject(t)&&isObject(o)&&Object.keys(o).forEach(function(e){var n=o[e];isObject(n)?(!t[e]&&(t[e]={}),t[e]=mergeObj(t[e],n)):t[e]=isArray(n)?n.concat():n}),mergeObj.apply(void 0,__spreadArrays([t],e))}function loadConfig(t){var e,n,o,r=this.config,i=function(){var t=n.shift();return t&&e&&isObjectType(e)&&t in e?(e=e[t],i()):t?void 0:e};Object.keys(r).forEach(function(a){e=t,n=a.split("_"),o=i(),isDefined(o)&&(r[a]=o)})}(function(){try{new MouseEvent("t")}catch(t){return function(t,e,n){void 0===n&&(n={bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0});var o=doc.createEvent("MouseEvent");o.initMouseEvent(e,n.bubbles,n.cancelable,win,0,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),t.dispatchEvent(o)}}})();var Plugin=function(){function t(t){void 0===t&&(t={}),this.$$,this.options=t}var e=t.prototype;return e.$beforeInit=function(){},e.$init=function(){},e.$afterInit=function(){},e.$redraw=function(){},e.$willDestroy=function(){var t=this;Object.keys(this).forEach(function(e){t[e]=null,delete t[e]})},t}();Plugin.version="#2.2.3#";var Options=function(){return function(){return{selector:".bb-texts text",extent:1,area:0}}}(),TextOverlap=function(t){function e(e){var n=t.call(this,e)||this;return n.config=new Options,n}return __extends(e,t),e.prototype.$init=function(){loadConfig.call(this,this.options)},e.prototype.$redraw=function(){var t=selectAll(this.config.selector);!t.empty()&&this.preventLabelOverlap(t)},e.prototype.generateVoronoi=function(t){var e,n=this.$$.scale,o=["x","y"].map(function(t){return n[t].domain()}),r=o[0],i=o[1];return e=[i[0],r[1]],r[1]=e[0],i[0]=e[1],voronoi().extent([r,i]).polygons(t)},e.prototype.preventLabelOverlap=function(t){var e=this.config,n=e.extent,o=e.area,r=this.generateVoronoi(t.data().map(function(t){return[t.x,t.value]})),i=0;t.each(function(){var t=r[i++];if(t&&this){var e=t.data,a=e[0],c=e[1],l=polygonCentroid(t),s=l[0],u=l[1],f=Math.round(Math.atan2(u-c,s-a)/Math.PI*2),p=n*(0===f?1:-1),b=-1===f?-n:n+5,y=1===Math.abs(f)?"middle":0===f?"start":"end";select(this).attr("display",polygonArea(t)<o?"none":null).attr("text-anchor",y).attr("dy","0."+(1===f?71:35)+"em").attr("transform","translate("+p+", "+b+")")}})},e}(Plugin);export default TextOverlap;