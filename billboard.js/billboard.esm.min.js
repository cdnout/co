import{timeParse,utcParse,timeFormat,utcFormat}from"d3-time-format";import{event,select,mouse,namespaces,selectAll}from"d3-selection";import{brushSelection,brushY,brushX}from"d3-brush";import{csvParseRows,csvParse,tsvParseRows,tsvParse}from"d3-dsv";import{drag as drag$1}from"d3-drag";import{scaleOrdinal,scaleLinear,scaleSymlog,scaleLog,scaleTime}from"d3-scale";import{transition}from"d3-transition";import{curveBasis,curveBasisClosed,curveBasisOpen,curveBundle,curveCardinal,curveCardinalClosed,curveCardinalOpen,curveCatmullRom,curveCatmullRomClosed,curveCatmullRomOpen,curveMonotoneX,curveMonotoneY,curveNatural,curveLinearClosed,curveLinear,curveStep,curveStepAfter,curveStepBefore,pie as pie$1,arc,area as area$1,line as line$1}from"d3-shape";import{axisLeft,axisBottom,axisTop,axisRight}from"d3-axis";import{easeLinear}from"d3-ease";import{interpolate}from"d3-interpolate";import{zoomIdentity,zoomTransform,zoom as zoom$2}from"d3-zoom";import{rgb}from"d3-color";var CLASS={arc:"bb-arc",arcLabelLine:"bb-arc-label-line",arcs:"bb-arcs",area:"bb-area",areas:"bb-areas",axis:"bb-axis",axisX:"bb-axis-x",axisXLabel:"bb-axis-x-label",axisY:"bb-axis-y",axisY2:"bb-axis-y2",axisY2Label:"bb-axis-y2-label",axisYLabel:"bb-axis-y-label",bar:"bb-bar",bars:"bb-bars",brush:"bb-brush",button:"bb-button",buttonZoomReset:"bb-zoom-reset",chart:"bb-chart",chartArc:"bb-chart-arc",chartArcs:"bb-chart-arcs",chartArcsBackground:"bb-chart-arcs-background",chartArcsGaugeMax:"bb-chart-arcs-gauge-max",chartArcsGaugeMin:"bb-chart-arcs-gauge-min",chartArcsGaugeUnit:"bb-chart-arcs-gauge-unit",chartArcsTitle:"bb-chart-arcs-title",chartArcsGaugeTitle:"bb-chart-arcs-gauge-title",chartBar:"bb-chart-bar",chartBars:"bb-chart-bars",chartCircles:"bb-chart-circles",chartLine:"bb-chart-line",chartLines:"bb-chart-lines",chartRadar:"bb-chart-radar",chartRadars:"bb-chart-radars",chartText:"bb-chart-text",chartTexts:"bb-chart-texts",circle:"bb-circle",circles:"bb-circles",colorPattern:"bb-color-pattern",colorScale:"bb-colorscale",defocused:"bb-defocused",dragarea:"bb-dragarea",empty:"bb-empty",eventRect:"bb-event-rect",eventRects:"bb-event-rects",eventRectsMultiple:"bb-event-rects-multiple",eventRectsSingle:"bb-event-rects-single",focused:"bb-focused",gaugeValue:"bb-gauge-value",grid:"bb-grid",gridLines:"bb-grid-lines",legend:"bb-legend",legendBackground:"bb-legend-background",legendItem:"bb-legend-item",legendItemEvent:"bb-legend-item-event",legendItemFocused:"bb-legend-item-focused",legendItemHidden:"bb-legend-item-hidden",legendItemPoint:"bb-legend-item-point",legendItemTile:"bb-legend-item-tile",level:"bb-level",levels:"bb-levels",line:"bb-line",lines:"bb-lines",main:"bb-main",region:"bb-region",regions:"bb-regions",selectedCircle:"bb-selected-circle",selectedCircles:"bb-selected-circles",shape:"bb-shape",shapes:"bb-shapes",stanfordElements:"bb-stanford-elements",stanfordLine:"bb-stanford-line",stanfordLines:"bb-stanford-lines",stanfordRegion:"bb-stanford-region",stanfordRegions:"bb-stanford-regions",subchart:"bb-subchart",target:"bb-target",text:"bb-text",texts:"bb-texts",title:"bb-title",tooltip:"bb-tooltip",tooltipContainer:"bb-tooltip-container",tooltipName:"bb-tooltip-name",xgrid:"bb-xgrid",xgridFocus:"bb-xgrid-focus",xgridLine:"bb-xgrid-line",xgridLines:"bb-xgrid-lines",xgrids:"bb-xgrids",ygrid:"bb-ygrid",ygridFocus:"bb-ygrid-focus",ygridLine:"bb-ygrid-line",ygridLines:"bb-ygrid-lines",ygrids:"bb-ygrids",zoomBrush:"bb-zoom-brush",EXPANDED:"_expanded_",SELECTED:"_selected_",INCLUDED:"_included_",TextOverlapping:"text-overlapping"},Element=function(){return function(){return{chart:null,main:null,svg:null,axis:{x:null,y:null,y2:null,subX:null},defs:null,tooltip:null,legend:null,title:null,subchart:{main:null,bar:null,line:null,area:null},arcs:null,bar:null,line:null,area:null,circle:null,radar:null,text:null,grid:{main:null,x:null,y:null},gridLines:{main:null,x:null,y:null},region:{main:null,list:null},eventRect:null}}}(),State=function(){return function(){return{width:0,width2:0,height:0,height2:0,margin:{top:0,bottom:0,left:0,right:0},margin2:{top:0,bottom:0,left:0,right:0},margin3:{top:0,bottom:0,left:0,right:0},arcWidth:0,arcHeight:0,xAxisHeight:0,hasAxis:!1,hasRadar:!1,current:{width:0,height:0,dataMax:0,maxTickWidths:{x:{size:0,ticks:[],clipPath:0,domain:""},y:{size:0,domain:""},y2:{size:0,domain:""}},types:[]},isLegendRight:!1,isLegendInset:!1,isLegendTop:!1,isLegendLeft:!1,legendStep:0,legendItemWidth:0,legendItemHeight:0,legendHasRendered:!1,eventReceiver:{currentIdx:-1,rect:{},data:[],coords:[]},axis:{x:{padding:{left:0,right:0},tickCount:0}},rotatedPadding:{left:30,right:0,top:5},withoutFadeIn:{},inputType:"",datetimeId:"",clip:{id:"",idXAxis:"",idYAxis:"",idXAxisTickTexts:"",idGrid:"",idSubchart:"",path:"",pathXAxis:"",pathYAxis:"",pathXAxisTickTexts:"",pathGrid:""},dragStart:null,dragging:!1,flowing:!1,cancelClick:!1,mouseover:!1,rendered:!1,transiting:!1,redrawing:!1,resizing:!1,toggling:!1,zooming:!1,hasNegativeValue:!1,hasPositiveValue:!0,orgAreaOpacity:"0.2",hiddenTargetIds:[],hiddenLegendIds:[],focusedTargetIds:[],defocusedTargetIds:[],radius:0,innerRadius:0,outerRadius:void 0,innerRadiusRatio:0,gaugeArcWidth:0,radiusExpanded:0,xgridAttr:{x1:null,x2:null,y1:null,y2:null}}}}(),classes={element:Element,state:State},Store=function(){function t(){var t=this;Object.keys(classes).forEach(function(e){t[e]=new classes[e]})}return t.prototype.getStore=function(t){return this[t]},t}(),_assign=function(){return(_assign=Object.assign||function(t){for(var e,i=1,a=arguments.length;i<a;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function __spreadArrays(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var a=Array(t),n=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,o=r.length;s<o;s++,n++)a[n]=r[s];return a}var main={bindto:"#chart",background:{},clipPath:!0,svg_classname:void 0,size_width:void 0,size_height:void 0,padding_left:void 0,padding_right:void 0,padding_top:void 0,padding_bottom:void 0,resize_auto:!0,onover:void 0,onout:void 0,onresize:void 0,onresized:void 0,onbeforeinit:void 0,oninit:void 0,onafterinit:void 0,onrendered:void 0,transition_duration:350,plugins:[],render:{},regions:[]},data={data_x:void 0,data_idConverter:function(t){return t},data_names:{},data_classes:{},data_type:void 0,data_types:{},data_order:"desc",data_groups:[],data_color:void 0,data_colors:{},data_labels:{},data_labels_colors:void 0,data_labels_position:{},data_hide:!1,data_filter:void 0,data_onclick:function(){},data_onover:function(){},data_onout:function(){},data_onmin:void 0,data_onmax:void 0,data_url:void 0,data_headers:void 0,data_json:void 0,data_rows:void 0,data_columns:void 0,data_mimeType:"csv",data_keys:void 0,data_empty_label_text:""},color={color_pattern:[],color_tiles:void 0,color_threshold:{},color_onover:void 0},interaction={interaction_enabled:!0,interaction_brighten:!0,interaction_inputType_mouse:!0,interaction_inputType_touch:{}},legend={legend_show:!0,legend_hide:!1,legend_contents_bindto:void 0,legend_contents_template:void 0,legend_position:"bottom",legend_inset_anchor:"top-left",legend_inset_x:10,legend_inset_y:0,legend_inset_step:void 0,legend_item_onclick:void 0,legend_item_onover:void 0,legend_item_onout:void 0,legend_equally:!1,legend_padding:0,legend_item_tile_width:10,legend_item_tile_height:10,legend_usePoint:!1},title={title_text:void 0,title_padding:{top:0,right:0,bottom:0,left:0},title_position:"center"},tooltip={tooltip_show:!0,tooltip_doNotHide:!1,tooltip_grouped:!0,tooltip_format_title:void 0,tooltip_format_name:void 0,tooltip_format_value:void 0,tooltip_position:void 0,tooltip_contents:{},tooltip_init_show:!1,tooltip_init_x:0,tooltip_init_position:{top:"0px",left:"50px"},tooltip_linked:!1,tooltip_linked_name:"",tooltip_onshow:function(){},tooltip_onhide:function(){},tooltip_onshown:function(){},tooltip_onhidden:function(){},tooltip_order:null},win="object"==typeof globalThis&&null!==globalThis&&globalThis.Object===Object&&globalThis||"object"==typeof global&&null!==global&&global.Object===Object&&global||"object"==typeof self&&null!==self&&self.Object===Object&&self||Function("return this")(),doc=win&&win.document,isValue=function(t){return t||0===t},isFunction=function(t){return"function"==typeof t},isString=function(t){return"string"==typeof t},isNumber=function(t){return"number"==typeof t},isUndefined=function(t){return void 0===t},isDefined=function(t){return void 0!==t},isboolean=function(t){return"boolean"==typeof t},ceil10=function(t){return 10*Math.ceil(t/10)},asHalfPixel=function(t){return Math.ceil(t)+.5},diffDomain=function(t){return t[1]-t[0]},isObjectType=function(t){return"object"==typeof t},isEmpty=function(t){return isUndefined(t)||null===t||isString(t)&&0===t.length||isObjectType(t)&&!(t instanceof Date)&&0===Object.keys(t).length||isNumber(t)&&isNaN(t)},notEmpty=function(t){return!isEmpty(t)},isArray=function(t){return Array.isArray(t)},isObject=function(t){return t&&!t.nodeType&&isObjectType(t)&&!isArray(t)};function getOption(t,e,i){return isDefined(t[e])?t[e]:i}function hasValue(t,e){var i=!1;return Object.keys(t).forEach(function(a){return t[a]===e&&(i=!0)}),i}function callFn(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var a=isFunction(t);return a&&t.call.apply(t,e),a}function endall(t,e){var i=0;t.each(function(){return++i}).on("end",function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];!--i&&e.apply.apply(e,__spreadArrays([this],t))})}function sanitise(t){return isString(t)?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}function setTextValue(t,e,i,a){if(void 0===i&&(i=[-1,1]),void 0===a&&(a=!1),t&&isString(e))if(-1===e.indexOf("\n"))t.text(e);else{var n=[t.text(),e].map(function(t){return t.replace(/[\s\n]/g,"")});if(n[0]!==n[1]){var r=e.split("\n"),s=a?r.length-1:1;t.html(""),r.forEach(function(e,a){t.append("tspan").attr("x",0).attr("dy",(0===a?i[0]*s:i[1])+"em").text(e)})}}}function getRectSegList(t){var e=t.getBBox(),i=e.x,a=e.y,n=e.width,r=e.height;return[{x:i,y:a+r},{x:i,y:a},{x:i+n,y:a},{x:i+n,y:a+r}]}function getPathBox(t){var e=t.getBoundingClientRect(),i=e.width,a=e.height,n=getRectSegList(t);return{x:n[0].x,y:Math.min(n[0].y,n[1].y),width:i,height:a}}function getBrushSelection(t){var e,i=t.$el,a=event,n=i.subchart.main||i.main;return a&&"brush"===a.type?e=a.selection:n&&(e=n.select("."+CLASS.brush).node())&&(e=brushSelection(e)),e}function getBoundingRect(t){return!("rect"in t)||"rect"in t&&t.hasAttribute("width")&&t.rect.width!==+t.getAttribute("width")?t.rect=t.getBoundingClientRect():t.rect}function getRandom(t){void 0===t&&(t=!0);var e=Math.random();return t?String(e):e}function findIndex(t,e,i,a,n){if(i>a)return-1;var r=Math.floor((i+a)/2),s=t[r],o=s.x,c=s.w,l=void 0===c?0:c;return n&&(o=t[r].y,l=t[r].h),e>=o&&e<=o+l?r:e<o?findIndex(t,e,i,r-1,n):findIndex(t,e,r+1,a,n)}function brushEmpty(t){var e=getBrushSelection(t);return!e||e[0]===e[1]}function deepClone(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=function(t){if(isObject(t)&&t.constructor){var e=new t.constructor;for(var a in t)e[a]=i(t[a]);return e}return t};return t.map(function(t){return i(t)}).reduce(function(t,e){return _assign(_assign({},t),e)})}function extend(t,e){for(var i in void 0===t&&(t={}),isArray(e)&&e.forEach(function(e){return extend(t,e)}),e)/^\d+$/.test(i)||i in t||(t[i]=e[i]);return t}var capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},toArray=function(t){return[].slice.call(t)};function getCssRules(t){var e=[];return t.forEach(function(t){try{t.cssRules&&t.cssRules.length&&(e=e.concat(toArray(t.cssRules)))}catch(e){console.error("Error while reading rules from "+t.href+": "+e.toString())}}),e}var getTranslation=function(t){var e=t?t.transform:null,i=e&&e.baseVal;return i&&i.numberOfItems?i.getItem(0).matrix:{a:0,b:0,c:0,d:0,e:0,f:0}};function getUnique(t){var e=t[0]instanceof Date,i=(e?t.map(Number):t).filter(function(t,e,i){return i.indexOf(t)===e});return e?i.map(function(t){return new Date(t)}):i}function mergeArray(t){return t&&t.length?t.reduce(function(t,e){return t.concat(e)}):[]}function mergeObj(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!e.length||1===e.length&&!e[0])return t;var a=e.shift();return isObject(t)&&isObject(a)&&Object.keys(a).forEach(function(e){var i=a[e];isObject(i)?(!t[e]&&(t[e]={}),t[e]=mergeObj(t[e],i)):t[e]=isArray(i)?i.concat():i}),mergeObj.apply(void 0,__spreadArrays([t],e))}function sortValue(t,e){var i;return void 0===e&&(e=!0),t[0]instanceof Date?i=e?function(t,e){return t-e}:function(t,e){return e-t}:e&&!t.every(isNaN)?i=function(t,e){return t-e}:e||(i=function(t,e){return(t>e?-1:t<e&&1)||t===e&&0}),t.concat().sort(i)}function getMinMax(t,e){var i=e.filter(function(t){return notEmpty(t)});return i.length?isNumber(i[0])?i=Math[t].apply(Math,i):i[0]instanceof Date&&(i=sortValue(i,"min"===t)[0]):i=void 0,i}var getRange=function(t,e,i){void 0===i&&(i=1);for(var a=[],n=0|Math.max(0,Math.ceil((e-t)/i)),r=t;r<n;r++)a.push(t+r*i);return a},emulateEvent={mouse:function(){try{return new MouseEvent("t"),function(t,e,i){void 0===i&&(i={bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0}),t.dispatchEvent(new MouseEvent(e,i))}}catch(t){return function(t,e,i){void 0===i&&(i={bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0});var a=doc.createEvent("MouseEvent");a.initMouseEvent(e,i.bubbles,i.cancelable,win,0,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),t.dispatchEvent(a)}}}(),touch:function(t,e,i){var a=new Touch(mergeObj({identifier:Date.now(),target:t,radiusX:2.5,radiusY:2.5,rotationAngle:10,force:.5},i));t.dispatchEvent(new TouchEvent(e,{cancelable:!0,bubbles:!0,shiftKey:!0,touches:[a],targetTouches:[],changedTouches:[a]}))}};function tplProcess(t,e){var i=t;for(var a in e)i=i.replace(new RegExp("{="+a+"}","g"),e[a]);return i}function parseDate(t){var e;if(t instanceof Date)e=t;else if(isString(t)){var i=this.config;e=this.format.dataTime(i.data_xFormat)(t)}else isNumber(t)&&!isNaN(t)&&(e=new Date(+t));return e&&!isNaN(+e)||console&&console.error&&console.error("Failed to parse x '"+t+"' to Date object"),e}function isTabVisible(){return!doc.hidden}function convertInputType(t,e){var i=!1;if(/Mobi/.test(win.navigator.userAgent)&&e){var a=win.navigator&&"maxTouchPoints"in win.navigator&&win.navigator.maxTouchPoints>0,n="ontouchmove"in win||win.DocumentTouch&&doc instanceof win.DocumentTouch;i=a||n}return(!(!t||i)&&"onmouseover"in win?"mouse":i&&"touch")||null}var Options=function(){function t(){return deepClone(main,data,color,interaction,legend,title,tooltip,t.data)}return t.setOptions=function(t){this.data=t.reduce(function(t,e){return _assign(_assign({},t),e)},this.data)},t.data={},t}(),KEY={bubbleBaseLength:"$baseLength",colorPattern:"__colorPattern__",dataMinMax:"$dataMinMax",dataTotalSum:"$dataTotalSum",dataTotalPerIndex:"$totalPerIndex",legendItemTextBox:"legendItemTextBox",radarPoints:"$radarPoints",setOverOut:"setOverOut",callOverOutForTouch:"callOverOutForTouch",textRect:"textRect"},Cache=function(){function t(){this.cache={}}return t.prototype.add=function(t,e,i){return void 0===i&&(i=!1),this.cache[t]=i?this.cloneTarget(e):e,this.cache[t]},t.prototype.remove=function(t){var e=this;toArray(t).forEach(function(t){return delete e.cache[t]})},t.prototype.get=function(t,e){if(void 0===e&&(e=!1),e){for(var i=[],a=0,n=void 0;n=t[a];a++)n in this.cache&&i.push(this.cloneTarget(this.cache[n]));return i}var r=this.cache[t];return isValue(r)?r:null},t.prototype.reset=function(t){for(var e in this.cache)(t||/^\$/.test(e))&&(this.cache[e]=null)},t.prototype.cloneTarget=function(t){return{id:t.id,id_org:t.id_org,values:t.values.map(function(t){return{x:t.x,value:t.value,id:t.id}})}},t}(),setTimeout$1=win.setTimeout,clearTimeout$1=win.clearTimeout;function generateResize(){var t,e=[],i=function(){i.clear(),t=setTimeout$1(function(){e.forEach(function(t){return t()})},200)};return i.clear=function(){t&&(clearTimeout$1(t),t=null)},i.add=function(t){return e.push(t)},i.remove=function(t){return e.splice(e.indexOf(t),1)},i}function generateWait(){var t=[],e=function(e,i){var a;!function e(){for(var n,r=0,s=0;n=t[s];s++)if(!0===n||n.empty&&n.empty())r++;else try{n.transition()}catch(t){r++}a&&clearTimeout$1(a),r===t.length?i&&i():a=setTimeout$1(e,50)}()};return e.add=function(e){isArray(e)?t=t.concat(e):t.push(e)},e}var dataConvert={convertData:function(t,e){var i;if(t.bindto?(i={},["url","mimeType","headers","keys","json","keys","rows","columns"].forEach(function(e){var a="data_"+e;a in t&&(i[e]=t[a])})):i=t,i.url&&e)this.convertUrlToData(i.url,i.mimeType,i.headers,i.keys,e);else if(i.json)i=this.convertJsonToData(i.json,i.keys);else if(i.rows)i=this.convertRowsToData(i.rows);else if(i.columns)i=this.convertColumnsToData(i.columns);else if(t.bindto)throw Error("url or json or rows or columns is required.");return isArray(i)&&i},convertUrlToData:function(t,e,i,a,n){var r=this;void 0===e&&(e="csv");var s=new XMLHttpRequest;s.open("GET",t),i&&Object.keys(i).forEach(function(t){s.setRequestHeader(t,i[t])}),s.onreadystatechange=function(){if(4===s.readyState){if(200!==s.status)throw new Error(t+": Something went wrong loading!");var i=s.responseText;i&&n.call(r,r["convert"+capitalize(e)+"ToData"]("json"===e?JSON.parse(i):i,a))}},s.send()},convertCsvTsvToData:function(t,e){var i,a=t.rows(e);return 1===a.length?(i=[{}],a[0].forEach(function(t){i[0][t]=null})):i=t.parse(e),i},convertCsvToData:function(t){return this.convertCsvTsvToData({rows:csvParseRows,parse:csvParse},t)},convertTsvToData:function(t){return this.convertCsvTsvToData({rows:tsvParseRows,parse:tsvParse},t)},convertJsonToData:function(t,e){var i,a,n=this,r=this.config,s=[];if(isArray(t)){var o=e||r.data_keys;o.x?(i=o.value.concat(o.x),r.data_x=o.x):i=o.value,s.push(i),t.forEach(function(t){var e=i.map(function(e){var i=n.findValueInJson(t,e);return isUndefined(i)&&(i=null),i});s.push(e)}),a=this.convertRowsToData(s)}else Object.keys(t).forEach(function(e){var i=t[e].concat();i.unshift(e),s.push(i)}),a=this.convertColumnsToData(s);return a},findValueInJson:function(t,e){if(void 0!==t[e])return t[e];var i=e.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split("."),a=t;return i.some(function(t){return!(a=a&&t in a?a[t]:void 0)}),a},convertRowsToData:function(t){var e=t[0],i=[];return t.forEach(function(t,a){if(a>0){var n={};t.forEach(function(t,i){if(isUndefined(t))throw new Error("Source data is missing a component at ("+a+", "+i+")!");n[e[i]]=t}),i.push(n)}}),i},convertColumnsToData:function(t){var e=[];return t.forEach(function(t,i){var a=t[0];t.forEach(function(t,n){if(n>0){if(isUndefined(e[n-1])&&(e[n-1]={}),isUndefined(t))throw new Error("Source data is missing a component at ("+i+", "+n+")!");e[n-1][a]=t}})}),e},convertDataToTargets:function(t,e){var i=this,a=this,n=a.axis,r=a.config,s=a.state,o=!1,c=!1,l=!1;n&&(o=n.isCategorized(),c=n.isTimeSeries(),l=n.isCustomX());var u,d=Object.keys(t[0]||{}),h=d.length?d.filter(a.isNotX,a):[],g=d.length?d.filter(a.isX,a):[];h.forEach(function(n){var s=i.getXKey(n);l||c?g.indexOf(s)>=0?u=(e&&a.data.xs[n]||[]).concat(t.map(function(t){return t[s]}).filter(isValue).map(function(t,e){return a.generateTargetX(t,n,e)})):r.data_x?u=i.getOtherTargetXs():notEmpty(r.data_xs)&&(u=a.getXValuesOfXKey(s,a.data.targets)):u=t.map(function(t,e){return e}),u&&(i.data.xs[n]=u)}),h.forEach(function(t){if(!i.data.xs[t])throw new Error('x is not defined for id = "'+t+'".')});var f=h.map(function(e,i){var n=r.data_idConverter.bind(a.api)(e),c=a.getXKey(e),u=l&&o,d=u&&t.map(function(t){return t.x}).every(function(t){return r.axis_x_categories.indexOf(t)>-1});return{id:n,id_org:e,values:t.map(function(t,o){var l,h=t[c],g=t[e];return g=null===g||isNaN(g)||isObject(g)?isArray(g)||isObject(g)?g:null:+g,!u&&!s.hasRadar||0!==i||isUndefined(h)?l=a.generateTargetX(h,e,o):(d||0!==i||0!==o||(r.axis_x_categories=[]),-1===(l=r.axis_x_categories.indexOf(h))&&(l=r.axis_x_categories.length,r.axis_x_categories.push(h))),(isUndefined(g)||a.data.xs[e].length<=o)&&(l=void 0),{x:l,value:g,id:n}}).filter(function(t){return isDefined(t.x)})}});return f.forEach(function(t){r.data_xSort&&(t.values=t.values.sort(function(t,e){return(t.x||0===t.x?t.x:1/0)-(e.x||0===e.x?e.x:1/0)})),t.values.forEach(function(t,e){return t.index=e}),a.data.xs[t.id].sort(function(t,e){return t-e})}),s.hasNegativeValue=a.hasNegativeValueInTargets(f),s.hasPositiveValue=a.hasPositiveValueInTargets(f),r.data_type&&a.setTargetType(a.mapToIds(f).filter(function(t){return!(t in r.data_types)}),r.data_type),f.forEach(function(t){return a.cache.add(t.id_org,t,!0)}),f}},data$1={isX:function(t){var e=this.config,i=e.data_x&&t===e.data_x,a=notEmpty(e.data_xs)&&hasValue(e.data_xs,t);return i||a},isNotX:function(t){return!this.isX(t)},isStackNormalized:function(){var t=this.config;return!(!t.data_stack_normalize||!t.data_groups.length)},isGrouped:function(t){var e=this.config.data_groups;return t?e.some(function(e){return e.indexOf(t)>=0&&e.length>1}):e.length>0},getXKey:function(t){var e=this.config;return e.data_x?e.data_x:notEmpty(e.data_xs)?e.data_xs[t]:null},getXValuesOfXKey:function(t,e){var i,a=this;return(e&&notEmpty(e)?a.mapToIds(e):[]).forEach(function(e){a.getXKey(e)===t&&(i=a.data.xs[e])}),i},getIndexByX:function(t,e){return e?e.indexOf(isString(t)?t:+t):(this.filterByX(this.data.targets,t)[0]||{index:null}).index},getXValue:function(t,e){return t in this.data.xs&&this.data.xs[t]&&isValue(this.data.xs[t][e])?this.data.xs[t][e]:e},getOtherTargetXs:function(){var t=Object.keys(this.data.xs);return t.length?this.data.xs[t[0]]:null},getOtherTargetX:function(t){var e=this.getOtherTargetXs();return e&&t<e.length?e[t]:null},addXs:function(t){var e=this.config;Object.keys(t).forEach(function(i){e.data_xs[i]=t[i]})},isMultipleX:function(){return notEmpty(this.config.data_xs)||!this.config.data_xSort||this.hasType("bubble")||this.hasType("scatter")},addName:function(t){var e,i=this.config;return t&&(e=i.data_names[t.id],t.name=void 0!==e?e:t.id),t},getAllValuesOnIndex:function(t,e){void 0===e&&(e=!1);var i=this,a=i.filterTargetsToShow(i.data.targets).map(function(e){return i.addName(i.getValueOnIndex(e.values,t))});return e&&(a=a.filter(function(t){return isValue(t.value)})),a},getValueOnIndex:function(t,e){var i=t.filter(function(t){return t.index===e});return i.length?i[0]:null},updateTargetX:function(t,e){var i=this;t.forEach(function(t){t.values.forEach(function(a,n){a.x=i.generateTargetX(e[n],t.id,n)}),i.data.xs[t.id]=e})},updateTargetXs:function(t,e){var i=this;t.forEach(function(t){e[t.id]&&i.updateTargetX([t],e[t.id])})},generateTargetX:function(t,e,i){var a=this.axis,n=a&&a.isCategorized()?i:t||i;if(a&&a.isTimeSeries()){var r=parseDate.bind(this);n=r(t||this.getXValue(e,i))}else a&&a.isCustomX()&&!a.isCategorized()&&(n=isValue(t)?+t:this.getXValue(e,i));return n},updateXs:function(t){t.length&&(this.axis.xs=t.map(function(t){return t.x}))},getPrevX:function(t){var e=this.axis.xs[t-1];return isDefined(e)?e:null},getNextX:function(t){var e=this.axis.xs[t+1];return isDefined(e)?e:null},getBaseValue:function(t){var e=this,i=e.state.hasAxis,a=t.value;return a&&i&&(e.isAreaRangeType(t)?a=e.getAreaRangeData(t,"mid"):e.isBubbleZType(t)&&(a=e.getBubbleZData(a,"y"))),a},getMinMaxValue:function(t){var e,i,a=this.getBaseValue.bind(this);return(t||this.data.targets.map(function(t){return t.values})).forEach(function(t,n){var r=t.map(a).filter(isNumber);e=Math.min.apply(Math,__spreadArrays([n?e:1/0],r)),i=Math.max.apply(Math,__spreadArrays([n?i:-1/0],r))}),{min:e,max:i}},getMinMaxData:function(){var t=this,e=KEY.dataMinMax,i=t.cache.get(e);if(!i){var a=t.data.targets.map(function(t){return t.values}),n=t.getMinMaxValue(a),r=[],s=[];a.forEach(function(e){var i=t.getFilteredDataByValue(e,n.min),a=t.getFilteredDataByValue(e,n.max);i.length&&(r=r.concat(i)),a.length&&(s=s.concat(a))}),t.cache.add(e,i={min:r,max:s})}return i},getTotalPerIndex:function(){var t=KEY.dataTotalPerIndex,e=this.cache.get(t);return this.isStackNormalized()&&!e&&(e=[],this.data.targets.forEach(function(t){t.values.forEach(function(t,i){e[i]||(e[i]=0),e[i]+=isNumber(t.value)?t.value:0})})),e},getTotalDataSum:function(t){var e=KEY.dataTotalSum,i=this.cache.get(e);if(!isNumber(i)){var a=mergeArray(this.data.targets.map(function(t){return t.values})).map(function(t){return t.value}).reduce(function(t,e){return t+e});this.cache.add(e,i=a)}return t&&(i-=this.getHiddenTotalDataSum()),i},getHiddenTotalDataSum:function(){var t=this.api,e=this.state.hiddenTargetIds,i=0;return e.length&&(i=t.data.values.bind(t)(e).reduce(function(t,e){return t+e})),i},getFilteredDataByValue:function(t,e){var i=this;return t.filter(function(t){return i.getBaseValue(t)===e})},getMaxDataCount:function(){return Math.max.apply(Math,this.data.targets.map(function(t){return t.values.length}))},getMaxDataCountTarget:function(){var t=this.filterTargetsToShow()||[],e=t.length;return e>1?t=sortValue(getUnique(t=t.map(function(t){return t.values}).reduce(function(t,e){return t.concat(e)}).map(function(t){return t.x}))).map(function(t,e){return{x:t,index:e}}):e&&(t=t[0].values),t},mapToIds:function(t){return t.map(function(t){return t.id})},mapToTargetIds:function(t){return t?isArray(t)?t.concat():[t]:this.mapToIds(this.data.targets)},hasTarget:function(t,e){for(var i=this.mapToIds(t),a=0,n=void 0;n=i[a];a++)if(n===e)return!0;return!1},isTargetToShow:function(t){return this.state.hiddenTargetIds.indexOf(t)<0},isLegendToShow:function(t){return this.state.hiddenLegendIds.indexOf(t)<0},filterTargetsToShow:function(t){var e=this;return(t||e.data.targets).filter(function(t){return e.isTargetToShow(t.id)})},mapTargetsToUniqueXs:function(t){var e=this.axis,i=[];return t&&t.length&&(i=getUnique(mergeArray(t.map(function(t){return t.values.map(function(t){return+t.x})}))),i=e&&e.isTimeSeries()?i.map(function(t){return new Date(+t)}):i.map(function(t){return+t})),sortValue(i)},addHiddenTargetIds:function(t){this.state.hiddenTargetIds=this.state.hiddenTargetIds.concat(t)},removeHiddenTargetIds:function(t){this.state.hiddenTargetIds=this.state.hiddenTargetIds.filter(function(e){return t.indexOf(e)<0})},addHiddenLegendIds:function(t){this.state.hiddenLegendIds=this.state.hiddenLegendIds.concat(t)},removeHiddenLegendIds:function(t){this.state.hiddenLegendIds=this.state.hiddenLegendIds.filter(function(e){return t.indexOf(e)<0})},getValuesAsIdKeyed:function(t){var e=this,i=e.state.hasAxis,a={},n=e.isMultipleX(),r=n?e.mapTargetsToUniqueXs(t).map(function(t){return isString(t)?t:+t}):null;return t.forEach(function(t){var s=[];t.values.forEach(function(t){var a=t.value;isArray(a)?s.push.apply(s,a):isObject(a)&&"high"in a?s.push.apply(s,Object.values(a)):e.isBubbleZType(t)?s.push(i&&e.getBubbleZData(a,"y")):n?s[e.getIndexByX(t.x,r)]=a:s.push(a)}),a[t.id]=s}),a},checkValueInTargets:function(t,e){for(var i,a=Object.keys(t),n=0;n<a.length;n++){i=t[a[n]].values;for(var r=0;r<i.length;r++)if(e(i[r].value))return!0}return!1},hasMultiTargets:function(){return this.filterTargetsToShow().length>1},hasNegativeValueInTargets:function(t){return this.checkValueInTargets(t,function(t){return t<0})},hasPositiveValueInTargets:function(t){return this.checkValueInTargets(t,function(t){return t>0})},_checkOrder:function(t){var e=this.config.data_order;return isString(e)&&e.toLowerCase()===t},isOrderDesc:function(){return this._checkOrder("desc")},isOrderAsc:function(){return this._checkOrder("asc")},orderTargets:function(t){var e=__spreadArrays(t),i=this.getSortCompareFn();return i&&e.sort(i),e},getSortCompareFn:function(t){void 0===t&&(t=!1);var e,i=this.config,a=this.isOrderAsc(),n=this.isOrderDesc();return a||n?e=function(e,i){var n=function(t,e){return t+Math.abs(e.value)},r=e.values.reduce(n,0),s=i.values.reduce(n,0);return t?a?r-s:s-r:a?s-r:r-s}:isFunction(i.data_order)&&(e=i.data_order.bind(this.api)),e||null},filterByX:function(t,e){return mergeArray(t.map(function(t){return t.values})).filter(function(t){return t.x-e==0})},filterRemoveNull:function(t){var e=this;return t.filter(function(t){return isValue(e.getBaseValue(t))})},filterByXDomain:function(t,e){return t.map(function(t){return{id:t.id,id_org:t.id_org,values:t.values.filter(function(t){return e[0]<=t.x&&t.x<=e[1]})}})},hasDataLabel:function(){var t=this.config.data_labels;return isboolean(t)&&t||isObjectType(t)&&notEmpty(t)},getDataIndexFromEvent:function(t){var e=this.config,i=this.state,a=i.inputType,n=i.eventReceiver,r=n.coords,s=n.rect,o=e.axis_rotated,c="touch"===a&&t.changedTouches?t.changedTouches[0]:t;return findIndex(r,o?c.clientY-s.top:c.clientX-s.left,0,r.length-1,o)},getDataLabelLength:function(t,e,i){var a=this,n=[0,0];return a.$el.chart.select("svg").selectAll(".dummy").data([t,e]).enter().append("text").text(function(t){return a.dataLabelFormat(t.id)(t)}).each(function(t,e){n[e]=1.3*this.getBoundingClientRect()[i]}).remove(),n},isNoneArc:function(t){return this.hasTarget(this.data.targets,t.id)},isArc:function(t){return"data"in t&&this.hasTarget(this.data.targets,t.data.id)},findSameXOfValues:function(t,e){var i,a=t[e].x,n=[];for(i=e-1;i>=0&&a===t[i].x;i--)n.push(t[i]);for(i=e;i<t.length&&a===t[i].x;i++)n.push(t[i]);return n},findClosestFromTargets:function(t,e){var i=this,a=t.map(function(t){return i.findClosest(t.values,e)});return i.findClosest(a,e)},findClosest:function(t,e){var i,a=this,n=a.config,r=a.$el.main,s=t.filter(function(t){return t&&isValue(t.value)}),o=n.point_sensitivity;return s.filter(function(t){return a.isBarType(t.id)}).forEach(function(t){var e=r.select("."+CLASS.bars+a.getTargetSelectorSuffix(t.id)+" ."+CLASS.bar+"-"+t.index).node();!i&&a.isWithinBar(e)&&(i=t)}),s.filter(function(t){return!a.isBarType(t.id)}).forEach(function(t){var n=a.dist(t,e);n<o&&(o=n,i=t)}),i},dist:function(t,e){var i=this.config.axis_rotated,a=this.scale,n=i?1:0,r=i?0:1,s=this.circleY(t,t.index),o=(a.zoom||a.x)(t.x);return Math.sqrt(Math.pow(o-e[n],2)+Math.pow(s-e[r],2))},convertValuesToStep:function(t){var e=this.axis,i=this.config.line_step_type,a=!!e&&e.isCategorized(),n=isArray(t)?t.concat():[t];if(!a&&!/step\-(after|before)/.test(i))return t;var r=n[0],s=n[n.length-1],o=r.id,c=r.x;return n.unshift({x:--c,value:r.value,id:o}),a&&"step-after"===i&&n.unshift({x:--c,value:r.value,id:o}),c=s.x,n.push({x:++c,value:s.value,id:o}),a&&"step-before"===i&&n.push({x:++c,value:s.value,id:o}),n},convertValuesToRange:function(t){var e=isArray(t)?t.concat():[t],i=[];return e.forEach(function(t){var e=t.x,a=t.id;i.push({x:e,id:a,value:t.value[0]}),i.push({x:e,id:a,value:t.value[2]})}),i},updateDataAttributes:function(t,e){var i=this.config["data_"+t];return isUndefined(e)?i:(Object.keys(e).forEach(function(t){i[t]=e[t]}),this.redraw({withLegend:!0}),i)},getAreaRangeData:function(t,e){var i=t.value;if(isArray(i)){var a=["high","mid","low"].indexOf(e);return-1===a?null:i[a]}return i[e]},getRatio:function(t,e,i){var a=this,n=a.config,r=a.state,s=a.api,o=0;if(e&&s.data.shown().length)if(o=e.ratio||e.value,"arc"===t)if(a.pie.padAngle()())o=e.value/a.getTotalDataSum(!0);else{var c=n.gauge_fullCircle?a.getArcLength():-2*a.getStartAngle(),l=a.hasType("gauge")?c:2*Math.PI;o=(e.endAngle-e.startAngle)/l}else if("index"===t){var u=s.data.values.bind(s),d=this.getTotalPerIndex();if(r.hiddenTargetIds.length){var h=u(r.hiddenTargetIds,!1);h.length&&(h=h.reduce(function(t,e){return t.map(function(t,i){return(isNumber(t)?t:0)+e[i]})}),d=d.map(function(t,e){return t-h[e]}))}e.ratio=isNumber(e.value)&&d&&d[e.index]>0?e.value/d[e.index]:0,o=e.ratio}else if("radar"===t)o=parseFloat(String(Math.max(e.value,0)))/r.current.dataMax*n.radar_size_ratio;else if("bar"===t){var g=a.getYScaleById.bind(a)(e.id).domain().reduce(function(t,e){return e-t});o=Math.abs(e.value)/g}return i&&o?100*o:o},updateDataIndexByX:function(t){var e=t.reduce(function(t,e,i){return t[Number(e.x)]=i,t},{});this.data.targets.forEach(function(t){t.values.forEach(function(t,i){var a=e[Number(t.x)];void 0===a&&(a=i),t.index=a})})},isBubbleZType:function(t){return this.isBubbleType(t)&&(isObject(t.value)&&("z"in t.value||"y"in t.value)||isArray(t.value)&&2===t.value.length)},getDataById:function(t){var e=this.cache.get(t)||this.api.data(t);return isArray(e)?e[0]:e}},dataLoad={load:function(t,e){var i=this,a=t;a&&(e.filter&&(a=a.filter(e.filter)),(e.type||e.types)&&a.forEach(function(t){var a=e.types&&e.types[t.id]||e.type;i.setTargetType(t.id,a)}),i.data.targets.forEach(function(t){for(var e=0;e<a.length;e++)if(t.id===a[e].id){t.values=a[e].values,a.splice(e,1);break}}),i.data.targets=i.data.targets.concat(a)),i.updateTargets(i.data.targets),i.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),i.updateTypesElements(),e.done&&e.done.call(i.api)},loadFromArgs:function(t){var e=this;if(e.config){e.cache.reset();var i=t.data||e.convertData(t,function(i){return e.load(e.convertDataToTargets(i),t)});i&&e.load(e.convertDataToTargets(i),t)}},unload:function(t,e){var i=this,a=i.state,n=i.$el,r=e,s=t;i.cache.reset(),r||(r=function(){}),(s=s.filter(function(t){return i.hasTarget(i.data.targets,t)}))&&0!==s.length?(n.svg.selectAll(s.map(function(t){return i.selectorTarget(t)})).transition().style("opacity","0").remove().call(endall,r),s.forEach(function(t){a.withoutFadeIn[t]=!1,n.legend&&n.legend.selectAll("."+CLASS.legendItem+i.getTargetSelectorSuffix(t)).remove(),i.data.targets=i.data.targets.filter(function(e){return e.id!==t})}),i.updateTypesElements()):r()}},interaction$1={selectRectForSingle:function(t,e,i){var a=this,n=a.config,r=a.$el.main,s=n.data_selection_enabled,o=n.data_selection_grouped,c=n.data_selection_isselectable,l=n.tooltip_grouped,u=a.getAllValuesOnIndex(i);l&&(a.showTooltip(u,t),a.showGridFocus&&a.showGridFocus(u),!s||o)||r.selectAll("."+CLASS.shape+"-"+i).each(function(){select(this).classed(CLASS.EXPANDED,!0),s&&e.style("cursor",o?"pointer":null),l||(a.hideGridFocus&&a.hideGridFocus(),a.hideTooltip(),!o&&a.expandCirclesBars(i))}).filter(function(t){return a.isWithinShape(this,t)}).call(function(n){var r=n.data();s&&(o||c&&c.bind(a.api)(r))&&e.style("cursor","pointer"),l||(a.showTooltip(r,t),a.showGridFocus&&a.showGridFocus(r),a.unexpandCircles&&a.unexpandCircles(),n.each(function(t){return a.expandCirclesBars(i,t.id)}))})},expandCirclesBars:function(t,e,i){var a=this.config,n=this.$el,r=n.bar;n.circle&&a.point_focus_expand_enabled&&this.expandCircles(t,e,i),r&&this.expandBars(t,e,i)},setOverOut:function(t,e){var i=this,a=i.config,n=i.state.hasRadar,r=i.$el.main,s=isObject(e);if(s||-1!==e){var o=a[t?"data_onover":"data_onout"].bind(i.api);if(a.color_onover&&i.setOverColor(t,e,s),s)o(e,r.select("."+CLASS.arc+i.getTargetSelectorSuffix(e.id)).node());else if(a.tooltip_grouped)t&&(a.point_focus_only&&n?i.showCircleFocus(i.getAllValuesOnIndex(e,!0)):i.expandCirclesBars(e,null,!0)),!i.isMultipleX()&&r.selectAll("."+CLASS.shape+"-"+e).each(function(t){o(t,this)});else{var c=i.cache.get(KEY.setOverOut)||[],l=r.selectAll("."+CLASS.shape+"-"+e).filter(function(t){return i.isWithinShape(this,t)});l.each(function(t){var e=this;(0===c.length||c.every(function(t){return t!==e}))&&(o(t,this),c.push(this))}),c.length>0&&l.empty()&&(o=a.data_onout.bind(i.api),c.forEach(function(t){return o(select(t).datum(),t)}),c=[]),i.cache.add(KEY.setOverOut,c)}}},callOverOutForTouch:function(t){var e=this.cache.get(KEY.callOverOutForTouch);(isObject(t)&&e?t.id!==e.id:t!==e)&&((e||isNumber(e))&&this.setOverOut(!1,e),(t||isNumber(t))&&this.setOverOut(!0,t),this.cache.add(KEY.callOverOutForTouch,t))},getDraggableSelection:function(){var t=this,e=t.config;return e.interaction_enabled&&e.data_selection_draggable&&t.drag?drag$1().on("drag",function(){t.drag(mouse(this))}).on("start",function(){t.dragstart(mouse(this))}).on("end",function(){t.dragend()}):function(){}},dispatchEvent:function(t,e,i){var a=this.config,n=this.state,r=n.eventReceiver,s=n.hasAxis,o=n.hasRadar,c=this.$el,l=c.eventRect,u=c.arcs,d=c.radar,h=this.isMultipleX(),g=(o?d.axes.select("."+CLASS.axis+"-"+e+" text"):l||u.selectAll("."+CLASS.target+" path").filter(function(t,i){return i===e})).node(),f=g.getBoundingClientRect(),p=f.width,x=f.left,v=f.top;if(s&&!o&&!h){var m=r.coords[e];p=m.w,x+=m.x,v+=m.y}var _=x+(i?i[0]:0)+(h||a.axis_rotated?0:p/2),y=v+(i?i[1]:0),b={screenX:_,screenY:y,clientX:_,clientY:y};emulateEvent[/^(mouse|click)/.test(t)?"mouse":"touch"](g,t,b)},setDragStatus:function(t){this.state.dragging=t}},classModule={generateClass:function(t,e){return" "+t+" "+(t+this.getTargetSelectorSuffix(e))},getClass:function(t,e){var i=this,a=/s$/.test(t),n=/^(area|arc|line)s?$/.test(t),r=a?"id":"index";return function(s){var o=s.data||s;return(e?i.generateClass(CLASS[a?"shapes":"shape"],o[r]):"")+i.generateClass(CLASS[t],o[n?"id":r])}},getChartClass:function(t){var e=this;return function(i){return CLASS["chart"+t]+e.classTarget((i.data?i.data:i).id)}},generateExtraLineClass:function(){var t=this.config.line_classes||[],e=[];return function(i){var a=i.id||i.data&&i.data.id||i;return e.indexOf(a)<0&&e.push(a),t[e.indexOf(a)%t.length]}},classRegion:function(t,e){return this.generateClass(CLASS.region,e)+" "+("class"in t?t.class:"")},classTarget:function(t){var e=this.config.data_classes[t],i="";return e&&(i=" "+CLASS.target+"-"+e),this.generateClass(CLASS.target,t)+i},classFocus:function(t){return this.classFocused(t)+this.classDefocused(t)},classFocused:function(t){return" "+(this.state.focusedTargetIds.indexOf(t.id)>=0?CLASS.focused:"")},classDefocused:function(t){return" "+(this.state.defocusedTargetIds.indexOf(t.id)>=0?CLASS.defocused:"")},getTargetSelectorSuffix:function(t){return t||0===t?("-"+t).replace(/[\s?!@#$%^&*()_=+,.<>'":;\[\]\/|~`{}\\]/g,"-"):""},selectorTarget:function(t,e){var i=e||"",a=this.getTargetSelectorSuffix(t);return i+"."+(CLASS.target+a)+", "+i+"."+(CLASS.circles+a)},selectorTargets:function(t,e){var i=this,a=t||[];return a.length?a.map(function(t){return i.selectorTarget(t,e)}):null},selectorLegend:function(t){return"."+(CLASS.legendItem+this.getTargetSelectorSuffix(t))},selectorLegends:function(t){var e=this;return t&&t.length?t.map(function(t){return e.selectorLegend(t)}):null}},category={categoryName:function(t){var e=this.config.axis_x_categories;return e&&t<e.length?e[t]:t}},colorizePattern=function(t,e,i){var a=select(t.cloneNode(!0));return a.attr("id",i).insert("rect",":first-child").attr("width",a.attr("width")).attr("height",a.attr("height")).style("fill",e),{id:i,node:a.node()}},schemeCategory10=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],color$1={getColorFromCss:function(){var t=KEY.colorPattern,e=doc.body,i=e[t];if(!i){var a=doc.createElement("span");a.className=CLASS.colorPattern,a.style.display="none",e.appendChild(a);var n=win.getComputedStyle(a).backgroundImage;a.parentNode.removeChild(a),n.indexOf(";")>-1&&(i=n.replace(/url[^#]*|["'()]|(\s|%20)/g,"").split(";").map(function(t){return t.trim().replace(/[\"'\s]/g,"")}).filter(Boolean),e[t]=i)}return i},generateColor:function(){var t=this,e=t.config,i=e.data_colors,a=e.data_color,n=[],r=notEmpty(e.color_pattern)?e.color_pattern:scaleOrdinal(t.getColorFromCss()||schemeCategory10).range(),s=r;if(isFunction(e.color_tiles)){var o=e.color_tiles.bind(t.api)(),c=r.map(function(e,i){var a=e.replace(/[#\(\)\s,]/g,""),n=t.state.datetimeId+"-pattern-"+a+"-"+i;return colorizePattern(o[i%o.length],e,n)});r=c.map(function(t){return"url(#"+t.id+")"}),t.patterns=c}return function(o){var c,l=o.id||o.data&&o.data.id||o,u=t.isTypeOf(l,["line","spline","step"])||!e.data_types[l];return isFunction(i[l])?c=i[l].bind(t.api)(o):i[l]?c=i[l]:(n.indexOf(l)<0&&n.push(l),c=u?s[n.indexOf(l)%s.length]:r[n.indexOf(l)%r.length],i[l]=c),isFunction(a)?a.bind(t.api)(c,o):c}},generateLevelColor:function(){var t=this.config,e=t.color_pattern,i=t.color_threshold,a="value"===i.unit,n=i.max||100,r=i.values&&i.values.length?i.values:[];return notEmpty(i)?function(t){for(var i=a?t:100*t/n,s=e[e.length-1],o=0,c=r.length;o<c;o++)if(i<=r[o]){s=e[o];break}return s}:null},setOverColor:function(t,e){var i=this,a=i.config,n=i.$el.main,r=a.color_onover,s=t?r:i.color;isObject(s)?s=function(t){var e=t.id;return e in r?r[e]:i.color(e)}:isString(s)?s=function(){return r}:isFunction(r)&&(s=s.bind(i.api)),n.selectAll(isObject(e)?"."+CLASS.arc+i.getTargetSelectorSuffix(e.id):"."+CLASS.shape+"-"+e).style("fill",s)}},TYPE={AREA:"area",AREA_LINE_RANGE:"area-line-range",AREA_SPLINE:"area-spline",AREA_SPLINE_RANGE:"area-spline-range",AREA_STEP:"area-step",BAR:"bar",BUBBLE:"bubble",DONUT:"donut",GAUGE:"gauge",LINE:"line",PIE:"pie",RADAR:"radar",SCATTER:"scatter",SPLINE:"spline",STEP:"step"},TYPE_BY_CATEGORY={Area:[TYPE.AREA,TYPE.AREA_SPLINE,TYPE.AREA_SPLINE_RANGE,TYPE.AREA_LINE_RANGE,TYPE.AREA_STEP],AreaRange:[TYPE.AREA_SPLINE_RANGE,TYPE.AREA_LINE_RANGE],Arc:[TYPE.PIE,TYPE.DONUT,TYPE.GAUGE,TYPE.RADAR],Line:[TYPE.LINE,TYPE.SPLINE,TYPE.AREA,TYPE.AREA_SPLINE,TYPE.AREA_SPLINE_RANGE,TYPE.AREA_LINE_RANGE,TYPE.STEP,TYPE.AREA_STEP],Step:[TYPE.STEP,TYPE.AREA_STEP],Spline:[TYPE.SPLINE,TYPE.AREA_SPLINE,TYPE.AREA_SPLINE_RANGE]},domain={getYDomainMinMax:function(t,e){var i=this,a=i.axis,n=i.config,r="min"===e,s=n.data_groups,o=i.mapToIds(t),c=i.getValuesAsIdKeyed(t);if(s.length>0)for(var l,u=i["has"+(r?"Negative":"Positive")+"ValueInTargets"](t),d=function(t,e){if(0===(e=e.filter(function(t){return o.indexOf(t)>=0})).length)return l=e,"continue";var i=e[0],n=a.getId(i);u&&c[i]&&(c[i]=c[i].map(function(t){return(r?t<0:t>0)?t:0}));for(var s=function(t,e){if(!c[e])return"continue";var s=a.getId(e);c[e].forEach(function(t,e){var a=+t;s!==n||u&&(r?a>0:a<0)||(c[i][e]+=a)})},d=1,h=void 0;h=e[d];d++)s(0,h);l=e},h=0,g=void 0;g=s[h];h++)d(0,g),g=l;return getMinMax(e,Object.keys(c).map(function(t){return getMinMax(e,c[t])}))},getYDomainMin:function(t){return this.getYDomainMinMax(t,"min")},getYDomainMax:function(t){return this.getYDomainMinMax(t,"max")},isHiddenTargetWithYDomain:function(t){var e=this;return e.state.hiddenTargetIds.some(function(i){return e.axis.getId(i)===t})},getYDomain:function(t,e,i){var a=this,n=a.axis,r=a.config,s=a.scale,o="axis_"+e;if(a.isStackNormalized())return[0,100];var c=s&&s[e]&&"log"===s[e].type,l=t.filter(function(t){return n.getId(t.id)===e}),u=i?a.filterByXDomain(l,i):l;if(0===u.length)return a.isHiddenTargetWithYDomain(e)?s[e].domain():"y2"===e?s.y.domain():a.getYDomain(t,"y2",i);var d=r[o+"_min"],h=r[o+"_max"],g=a.getYDomainMin(u),f=a.getYDomainMax(u),p=r[o+"_center"],x=__spreadArrays([TYPE.BAR,TYPE.BUBBLE,TYPE.SCATTER],TYPE_BY_CATEGORY.Line).some(function(t){var e=t.indexOf("area")>-1?"area":t;return a.hasType(t,u)&&r[e+"_zerobased"]}),v=r[o+"_inverted"],m=a.hasDataLabel()&&r.axis_rotated,_=a.hasDataLabel()&&!r.axis_rotated;g=isValue(d)?d:isValue(h)?g<h?g:h-10:g,f=isValue(h)?h:isValue(d)?d<f?f:d+10:f,isNaN(g)&&(g=0),isNaN(f)&&(f=g),g===f&&(g<0?f=0:g=0);var y=g>=0&&f>=0,b=g<=0&&f<=0;(isValue(d)&&y||isValue(h)&&b)&&(x=!1),x&&(y&&(g=0),b&&(f=0));var T=Math.abs(f-g),S={top:.1*T,bottom:.1*T};if(isDefined(p)){var A=Math.max(Math.abs(g),Math.abs(f));f=p+A,g=p-A}if(m){var L=diffDomain(s.y.range()),C=a.getDataLabelLength(g,f,"width").map(function(t){return t/L});["bottom","top"].forEach(function(t,e){S[t]+=T*(C[e]/(1-C[0]-C[1]))})}else if(_){var w=a.getDataLabelLength(g,f,"height");["bottom","top"].forEach(function(t,e){S[t]+=n.convertPixelsToAxisPadding(w[e],T)})}var E=r[o+"_padding"];notEmpty(E)&&["bottom","top"].forEach(function(t){S[t]=n.getPadding(E,t,S[t],T)}),x&&(y&&(S.bottom=g),b&&(S.top=-f));var R=c?[g,f].map(function(t){return t<0?0:t}):[g-S.bottom,f+S.top];return v?R.reverse():R},getXDomainMinMax:function(t,e){var i=this.config["axis_x_"+e],a=getMinMax(e,t.map(function(t){return getMinMax(e,t.values.map(function(t){return t.x}))})),n=isObject(i)?i.value:i;return n=isDefined(n)&&this.axis.isTimeSeries()?parseDate(n):n,isObject(i)&&i.fit&&("min"===e&&n<a||"max"===e&&n>a)&&(n=void 0),isDefined(n)?n:a},getXDomainMin:function(t){return this.getXDomainMinMax(t,"min")},getXDomainMax:function(t){return this.getXDomainMinMax(t,"max")},getXDomainPadding:function(t){var e,i,a=this.axis,n=this.config,r=t[1]-t[0],s=n.axis_x_padding,o=i=a.isCategorized()?0:this.hasType("bar")?(e=this.getMaxDataCount())>1?r/(e-1)/2:.5:.01*r,c=i;return isObject(s)&&notEmpty(s)?(o=isValue(s.left)?s.left:i,c=isValue(s.right)?s.right:i):isNumber(n.axis_x_padding)&&(o=s,c=s),{left:o,right:c}},getXDomain:function(t){var e=this,i="log"===e.scale.x.type,a=[e.getXDomainMin(t),e.getXDomainMax(t)],n=0,r=0;if(i)n=a[0],r=a[1];else{var s=e.axis.isCategorized(),o=e.axis.isTimeSeries(),c=e.getXDomainPadding(a),l=a[0],u=a[1];l-u!=0||s||(o?(l=new Date(.5*l.getTime()),u=new Date(1.5*u.getTime())):(l=0===l?1:.5*l,u=0===u?-1:1.5*u)),(l||0===l)&&(n=o?new Date(l.getTime()-c.left):l-c.left),(u||0===u)&&(r=o?new Date(u.getTime()+c.right):u+c.right)}return[n,r]},updateXDomain:function(t,e,i,a,n){var r=this,s=r.config,o=r.org,c=r.scale,l=c.x,u=c.subX,d=s.zoom_enabled;if(i&&(l.domain(n||sortValue(r.getXDomain(t))),o.xDomain=l.domain(),d&&r.zoom.updateScaleExtent(),u.domain(l.domain()),r.brush&&r.brush.scale(u)),e){var h=n||!r.brush||brushEmpty(r)?o.xDomain:getBrushSelection(r).map(u.invert);l.domain(h),d&&r.zoom.updateScaleExtent()}return a&&l.domain(r.trimXDomain(l.orgDomain())),l.domain()},trimXDomain:function(t){var e=this.getZoomDomain(),i=e[0],a=e[1];return t[0]<=i&&(t[1]=+t[1]+(i-t[0]),t[0]=i),a<=t[1]&&(t[0]=+t[0]-(t[1]-a),t[1]=a),t},getZoomDomain:function(){var t=this.config,e=this.org.xDomain,i=e[0],a=e[1];return isDefined(t.zoom_x_min)&&(i=getMinMax("min",[i,t.zoom_x_min])),isDefined(t.zoom_x_max)&&(a=getMinMax("max",[a,t.zoom_x_max])),[i,a]}};function getFormat(t,e,i){var a=t.config,n="axis_"+e+"_tick_format";return(a[n]?a[n]:t.defaultValueFormat)(i)}var format={getYFormat:function(t){var e=this,i=e.yFormat,a=e.y2Format;return t&&!e.hasType("gauge")&&(i=e.defaultArcValueFormat,a=e.defaultArcValueFormat),function(t,n,r){return(e.axis&&"y2"===e.axis.getId(r)?a:i).call(e,t,n)}},yFormat:function(t){return getFormat(this,"y",t)},y2Format:function(t){return getFormat(this,"y2",t)},defaultValueFormat:function(t){return isValue(t)?+t:""},defaultArcValueFormat:function(t,e){return(100*e).toFixed(1)+"%"},dataLabelFormat:function(t){var e=this.config.data_labels,i=function(t){return isValue(t)?+t:""},a=i;return isFunction(e.format)?a=e.format:isObjectType(e.format)&&(a=e.format[t]?!0===e.format[t]?i:e.format[t]:function(){return""}),a.bind(this.api)}},legend$1={initLegend:function(){var t=this,e=t.config,i=t.$el;t.legendItemTextBox={},t.state.legendHasRendered=!1,e.legend_show?(e.legend_contents_bindto||(i.legend=t.$el.svg.append("g").classed(CLASS.legend,!0).attr("transform",t.getTranslate("legend"))),t.updateLegend()):t.state.hiddenLegendIds=t.mapToIds(t.data.targets)},updateLegend:function(t,e,i){var a=this,n=a.config,r=a.state,s=a.scale,o=a.$el,c=e||{withTransform:!1,withTransitionForTransform:!1,withTransition:!1};c.withTransition=getOption(c,"withTransition",!0),c.withTransitionForTransform=getOption(c,"withTransitionForTransform",!0),n.legend_contents_bindto&&n.legend_contents_template?a.updateLegendTemplate():a.updateLegendElement(t||a.mapToIds(a.data.targets),c,i),o.legend.selectAll("."+CLASS.legendItem).classed(CLASS.legendItemHidden,function(t){return!a.isTargetToShow(t)}),a.updateScales(!1,!s.zoom),a.updateSvgSize(),a.transformAll(c.withTransitionForTransform,i),r.legendHasRendered=!0},updateLegendTemplate:function(){var t=this,e=t.config,i=t.$el,a=select(e.legend_contents_bindto),n=e.legend_contents_template;if(!a.empty()){var r=t.mapToIds(t.data.targets),s=[],o="";r.forEach(function(e){var i=isFunction(n)?n.bind(t.api)(e,t.color(e),t.api.data(e)[0].values):tplProcess(n,{COLOR:t.color(e),TITLE:e});i&&(s.push(e),o+=i)});var c=a.html(o).selectAll(function(){return this.childNodes}).data(s);t.setLegendItem(c),i.legend=a}},updateSizeForLegend:function(t){var e=this,i=e.config,a=e.state,n=a.isLegendTop,r=a.isLegendLeft,s=a.isLegendRight,o=a.isLegendInset,c=a.current,l=t.width,u=t.height,d={top:n?e.getCurrentPaddingTop()+i.legend_inset_y+5.5:c.height-u-e.getCurrentPaddingBottom()-i.legend_inset_y,left:r?e.getCurrentPaddingLeft()+i.legend_inset_x+.5:c.width-l-e.getCurrentPaddingRight()-i.legend_inset_x+.5};e.state.margin3={top:s?0:o?d.top:c.height-u,right:NaN,bottom:0,left:s?c.width-l:o?d.left:0}},transformLegend:function(t){var e=this.$el.legend;(t?e.transition():e).attr("transform",this.getTranslate("legend"))},updateLegendStep:function(t){this.state.legendStep=t},updateLegendItemWidth:function(t){this.state.legendItemWidth=t},updateLegendItemHeight:function(t){this.state.legendItemHeight=t},updateLegendItemColor:function(t,e){var i=this.$el.legend;i&&i.select("."+CLASS.legendItem+"-"+t+" line").style("stroke",e)},getLegendWidth:function(){var t=this.state,e=t.current.width,i=t.isLegendRight,a=t.isLegendInset,n=t.legendItemWidth,r=t.legendStep;return this.config.legend_show?i||a?n*(r+1):e:0},getLegendHeight:function(){var t=this.state,e=t.current,i=t.isLegendRight,a=t.legendItemHeight,n=t.legendStep;return this.config.legend_show?i?e.height:Math.max(20,a)*(n+1):0},opacityForLegend:function(t){return t.classed(CLASS.legendItemHidden)?null:"1"},opacityForUnfocusedLegend:function(t){return t.classed(CLASS.legendItemHidden)?null:"0.3"},toggleFocusLegend:function(t,e){var i=this,a=i.$el.legend,n=i.mapToTargetIds(t);a&&a.selectAll("."+CLASS.legendItem).filter(function(t){return n.indexOf(t)>=0}).classed(CLASS.legendItemFocused,e).transition().duration(100).style("opacity",function(){return(e?i.opacityForLegend:i.opacityForUnfocusedLegend).call(i,select(this))})},revertLegend:function(){var t=this,e=t.$el.legend;e&&e.selectAll("."+CLASS.legendItem).classed(CLASS.legendItemFocused,!1).transition().duration(100).style("opacity",function(){return t.opacityForLegend(select(this))})},showLegend:function(t){var e=this,i=e.config,a=e.$el;i.legend_show||(i.legend_show=!0,a.legend?a.legend.style("visibility","visible"):e.initLegend(),!e.state.legendHasRendered&&e.updateLegend()),e.removeHiddenLegendIds(t),a.legend.selectAll(e.selectorLegends(t)).style("visibility","visible").transition().style("opacity",function(){return e.opacityForLegend(select(this))})},hideLegend:function(t){var e=this.config,i=this.$el.legend;e.legend_show&&isEmpty(t)&&(e.legend_show=!1,i.style("visibility","hidden")),this.addHiddenLegendIds(t),i.selectAll(this.selectorLegends(t)).style("opacity","0").style("visibility","hidden")},getLegendItemTextBox:function(t,e){var i,a=this.cache,n=this.state,r=KEY.legendItemTextBox;return t&&((i=!n.redrawing&&a.get(r)||{})[t]||(i[t]=this.getTextRect(e,CLASS.legendItem),a.add(r,i)),i=i[t]),i},setLegendItem:function(t){var e=this,i=e.api,a=e.config,n=e.state,r="touch"===n.inputType,s=e.hasType("gauge");t.attr("class",function(t){var i=select(this);return(!i.empty()&&i.attr("class")||"")+e.generateClass(CLASS.legendItem,t)}).style("visibility",function(t){return e.isLegendToShow(t)?"visible":"hidden"}),a.interaction_enabled&&(t.style("cursor","pointer").on("click",function(t){callFn(a.legend_item_onclick,i,t)||(event.altKey?(i.hide(),i.show(t)):(i.toggle(t),select(this).classed(CLASS.legendItemFocused,!1).style("opacity",null))),r&&e.hideTooltip()}),!r&&t.on("mouseout",function(t){callFn(a.legend_item_onout,i,t)||(select(this).classed(CLASS.legendItemFocused,!1),s&&e.undoMarkOverlapped(e,"."+CLASS.gaugeValue),e.api.revert())}).on("mouseover",function(t){callFn(a.legend_item_onover,i,t)||(select(this).classed(CLASS.legendItemFocused,!0),s&&e.markOverlapped(t,e,"."+CLASS.gaugeValue),!n.transiting&&e.isTargetToShow(t)&&i.focus(t))}))},updateLegendElement:function(t,e){var i,a,n,r=this,s=r.config,o=r.state,c=r.$el.legend,l=s.legend_item_tile_width+5,u=0,d=0,h=0,g={},f={},p={},x=[0],v={},m=0,_=o.isLegendRight||o.isLegendInset,y=t.filter(function(t){return!isDefined(s.data_names[t])||null!==s.data_names[t]}),b=e.withTransition,T=function(t,e,i){var a,n=0===i,c=i===y.length-1,b=r.getLegendItemTextBox(e,t),T=b.width+l+(c&&!_?0:10)+s.legend_padding,S=b.height+4,A=_?S:T,L=_?r.getLegendHeight():r.getLegendWidth(),C=function(t,e){e||(a=(L-h-A)/2)<10&&(a=(L-A)/2,h=0,m++),v[t]=m,x[m]=o.isLegendInset?10:a,g[t]=h,h+=A};if(n&&(h=0,m=0,u=0,d=0),s.legend_show&&!r.isLegendToShow(e))return f[e]=0,p[e]=0,v[e]=0,void(g[e]=0);f[e]=T,p[e]=S,(!u||T>=u)&&(u=T),(!d||S>=d)&&(d=S);var w=_?d:u;s.legend_equally?(Object.keys(f).forEach(function(t){return f[t]=u}),Object.keys(p).forEach(function(t){return p[t]=d}),(a=(L-w*y.length)/2)<10?(h=0,m=0,y.forEach(function(t){return C(t)})):C(e,!0)):C(e)};o.isLegendInset&&(m=s.legend_inset_step?s.legend_inset_step:y.length,r.updateLegendStep(m)),o.isLegendRight?(i=function(t){return u*v[t]},a=function(t){return x[v[t]]+g[t]}):o.isLegendInset?(i=function(t){return u*v[t]+10},a=function(t){return x[v[t]]+g[t]}):(i=function(t){return x[v[t]]+g[t]},a=function(t){return d*v[t]});var S=function(t,e){return i(t,e)+4+s.legend_item_tile_width},A=function(t,e){return i(t,e)},L=function(t,e){return i(t,e)-2},C=function(t,e){return i(t,e)-2+s.legend_item_tile_width},w=function(t,e){return a(t,e)+9},E=function(t,e){return a(t,e)-5},R=function(t,e){return a(t,e)+4},k=c.selectAll("."+CLASS.legendItem).data(y).enter().append("g");r.setLegendItem(k),k.append("text").text(function(t){return isDefined(s.data_names[t])?s.data_names[t]:t}).each(function(t,e){T(this,t,e)}).style("pointer-events","none").attr("x",_?S:-200).attr("y",_?-200:w),k.append("rect").attr("class",CLASS.legendItemEvent).style("fill-opacity","0").attr("x",_?A:-200).attr("y",_?-200:E);var O=function(t){var e=r.getDataById(t);return r.levelColor?r.levelColor(e.values[0].value):r.color(e)},D=s.legend_usePoint;if(D){var P=[];k.append(function(t){var e=notEmpty(s.point_pattern)?s.point_pattern:[s.point_type];-1===P.indexOf(t)&&P.push(t);var i=e[P.indexOf(t)%e.length];return"rectangle"===i&&(i="rect"),doc.createElementNS(namespaces.svg,"hasValidPointType"in r&&r.hasValidPointType(i)?i:"use")}).attr("class",CLASS.legendItemPoint).style("fill",O).style("pointer-events","none").attr("href",function(t,e,i){return"use"===i[e].nodeName.toLowerCase()?"#"+o.datetimeId+"-point-"+t:void 0})}else k.append("line").attr("class",CLASS.legendItemTile).style("stroke",O).style("pointer-events","none").attr("x1",_?L:-200).attr("y1",_?-200:R).attr("x2",_?C:-200).attr("y2",_?-200:R).attr("stroke-width",s.legend_item_tile_height);n=c.select("."+CLASS.legendBackground+" rect"),o.isLegendInset&&u>0&&0===n.size()&&(n=c.insert("g","."+CLASS.legendItem).attr("class",CLASS.legendBackground).append("rect"));var F=c.selectAll("text").data(y).text(function(t){return isDefined(s.data_names[t])?s.data_names[t]:t}).each(function(t,e){T(this,t,e)});(b?F.transition():F).attr("x",S).attr("y",w);var I=c.selectAll("rect."+CLASS.legendItemEvent).data(y);if((b?I.transition():I).attr("width",function(t){return f[t]}).attr("height",function(t){return p[t]}).attr("x",A).attr("y",E),D){var M=c.selectAll("."+CLASS.legendItemPoint).data(y);(b?M.transition():M).each(function(){var t,e,i,a=this.nodeName.toLowerCase(),n=s.point_r,r="x",o="y",c=2,l=2.5;if("circle"===a)r="cx",o="cy",t=n+(u=.2*n),c=2*n,l=-u;else if("rect"===a){var u;e=u=2.5*n,i=u,l=3}select(this).attr(r,function(t){return L(t)+c}).attr(o,function(t){return R(t)-l}).attr("r",t).attr("width",e).attr("height",i)})}else{M=c.selectAll("line."+CLASS.legendItemTile).data(y);(b?M.transition():M).style("stroke",O).attr("x1",L).attr("y1",R).attr("x2",C).attr("y2",R)}n&&(b?n.transition():n).attr("height",r.getLegendHeight()-12).attr("width",u*(m+1)+10),r.updateLegendItemWidth(u),r.updateLegendItemHeight(d),r.updateLegendStep(m)}},redraw={redraw:function(t,e){void 0===t&&(t={});var i=this,a=i.config,n=i.state,r=i.$el,s=r.main;n.redrawing=!0;var o=i.filterTargetsToShow(i.data.targets),c=t.initializing,l=t.flow,u=i.getWithOption(t),d=u.Transition?a.transition_duration:0,h=u.TransitionForExit?d:0,g=u.TransitionForAxis?d:0,f=e||i.axis&&i.axis.generateTransitions(g);i.updateSizes(c),u.Legend&&a.legend_show?i.updateLegend(i.mapToIds(i.data.targets),t,f):u.Dimension&&i.updateDimension(!0),i.hasArcType()&&!n.hasRadar||i.updateCircleY&&i.updateCircleY(),n.hasAxis?(i.axis.redrawAxis(o,u,f,l,c),a.data_empty_label_text&&s.select("text."+CLASS.text+"."+CLASS.empty).attr("x",n.width/2).attr("y",n.height/2).text(a.data_empty_label_text).style("display",o.length?"none":null),i.hasGrid()&&i.updateGrid(d),a.regions.length&&i.updateRegion(d),i.hasType("bar")&&i.updateBar(h),i.hasTypeOf("Line")&&i.updateLine(h),i.hasTypeOf("Area")&&i.updateArea(h),r.text&&s.selectAll("."+CLASS.selectedCircles).filter(i.isBarType.bind(i)).selectAll("circle").remove(),a.interaction_enabled&&!l&&u.EventRect&&(i.redrawEventRect(),i.bindZoomEvent&&i.bindZoomEvent())):(r.arcs&&i.redrawArc(d,h,u.Transform),r.radar&&i.redrawRadar(h)),n.resizing||!i.hasPointType()&&!n.hasRadar||i.updateCircle(),i.hasDataLabel()&&!i.hasArcType(null,["radar"])&&i.updateText(h),i.redrawTitle&&i.redrawTitle(),c&&i.updateTypesElements(),i.generateRedrawList(o,l,d,u.Subchart),i.callPluginHook("$redraw",t,d)},generateRedrawList:function(t,e,i,a){var n=this,r=n.config,s=n.state,o=n.getDrawShape();s.hasAxis&&r.subchart_show&&n.redrawSubchart(a,i,o);var c=e&&n.generateFlow({targets:t,flow:e,duration:e.duration,shape:o,xv:n.xv.bind(n)}),l=(i||c)&&isTabVisible(),u=n.getRedrawList(o,e,c,l),d=e||r.onrendered?function(){c&&c(),s.redrawing=!1,callFn(r.onrendered,n.api)}:null;if(d)if(l&&u.length){var h=generateWait();transition().duration(i).each(function(){u.reduce(function(t,e){return t.concat(e)},[]).forEach(function(t){return h.add(t)})}).call(h,d)}else s.transiting||d();n.mapToIds(n.data.targets).forEach(function(t){s.withoutFadeIn[t]=!0})},getRedrawList:function(t,e,i,a){var n=this,r=n.config,s=n.state,o=s.hasAxis,c=s.hasRadar,l=n.$el.grid,u=t.pos,d=u.cx,h=u.cy,g=u.xForText,f=u.yForText,p=[];if(o){var x=t.type,v=x.area,m=x.bar,_=x.line;(r.grid_x_lines.length||r.grid_y_lines.length)&&p.push(n.redrawGrid(a)),r.regions.length&&p.push(n.redrawRegion(a)),n.hasTypeOf("Line")&&p.push(n.redrawLine(_,a)),n.hasTypeOf("Area")&&p.push(n.redrawArea(v,a)),n.hasType("bar")&&p.push(n.redrawBar(m,a)),!e&&l.main&&p.push(n.updateGridFocus())}return n.hasArcType()&&!c||notEmpty(r.data_labels)&&!1!==r.data_labels&&p.push(n.redrawText(g,f,e,a)),!n.hasPointType()&&!c||r.point_focus_only||n.redrawCircle&&p.push(n.redrawCircle(d,h,a,i)),p},updateAndRedraw:function(t){void 0===t&&(t={});var e,i=this,a=i.config,n=i.state;t.withTransition=getOption(t,"withTransition",!0),t.withTransform=getOption(t,"withTransform",!1),t.withLegend=getOption(t,"withLegend",!1),t.withUpdateXDomain=!0,t.withUpdateOrgXDomain=!0,t.withTransitionForExit=!1,t.withTransitionForTransform=getOption(t,"withTransitionForTransform",t.withTransition),t.withLegend&&a.legend_show||(n.hasAxis&&(e=i.axis.generateTransitions(t.withTransitionForAxis?a.transition_duration:0)),i.updateScales(),i.updateSvgSize(),i.transformAll(t.withTransitionForTransform,e)),i.redraw(t,e)},redrawWithoutRescale:function(){this.redraw({withY:!1,withSubchart:!1,withEventRect:!1,withTransitionForAxis:!1})}};function getScale(t,e,i){void 0===t&&(t="linear"),void 0===e&&(e=0),void 0===i&&(i=1);var a={linear:scaleLinear,log:scaleSymlog,_log:scaleLog,time:scaleTime}[t]();return a.type=t,/_?log/.test(t)&&a.clamp(!0),a.range([e,i])}var scale={getXScale:function(t,e,i,a){var n=this.scale.zoom||getScale(this.axis.getAxisType("x"),t,e);return this.getCustomizedScale(i?n.domain(i):n,a)},getYScale:function(t,e,i,a){var n=getScale(this.axis.getAxisType(t),e,i);return a&&n.domain(a),n},getYScaleById:function(t,e){void 0===e&&(e=!1);var i="y2"===this.axis.getId(t),a=e?i?"subY2":"subY":i?"y2":"y";return this.scale[a]},getCustomizedScale:function(t,e){var i=this,a=e||function(){return i.axis.x.tickOffset()},n=function(e,i){var n=t(e)+a();return i?n:Math.ceil(n)};for(var r in t)n[r]=t[r];return n.orgDomain=function(){return t.domain()},n.orgScale=function(){return t},i.axis.isCategorized()&&(n.domain=function(e){var i=e;return arguments.length?(t.domain(i),n):[(i=this.orgDomain())[0],i[1]+1]}),n},updateScales:function(t,e){void 0===e&&(e=!0);var i=this,a=i.axis,n=i.config,r=i.format,s=i.org,o=i.scale,c=i.state,l=c.width,u=c.height,d=c.width2,h=c.height2;if(c.hasAxis){var g=n.axis_rotated,f={x:g?1:0,y:g?0:u,subX:g?1:0,subY:g?0:h},p={x:g?u:l,y:g?l:1,subX:g?u:l,subY:g?d:1},x=e&&o.x&&o.x.orgDomain(),v=e&&s.xDomain;o.x=i.getXScale(f.x,p.x,x,function(){return a.x.tickOffset()}),o.subX=i.getXScale(f.x,p.x,v,function(t){return t%1?0:a.subX.tickOffset()}),r.xAxisTick=a.getXAxisTickFormat(),a.setAxis("x",o.x,n.axis_x_tick_outer,t),n.subchart_show&&a.setAxis("subX",o.subX,n.axis_x_tick_outer,t),o.y=i.getYScale("y",f.y,p.y,o.y?o.y.domain():n.axis_y_default),o.subY=i.getYScale("y",f.subY,p.subY,o.subY?o.subY.domain():n.axis_y_default),a.setAxis("y",o.y,n.axis_y_tick_outer,t),n.axis_y2_show&&(o.y2=i.getYScale("y2",f.y,p.y,o.y2?o.y2.domain():n.axis_y2_default),o.subY2=i.getYScale("y2",f.subY,p.subY,o.subY2?o.subY2.domain():n.axis_y2_default),a.setAxis("y2",o.y2,n.axis_y2_tick_outer,t))}else i.updateArc&&i.updateArc()},xx:function(t){var e=this.config,i=this.scale,a=i.x,n=i.zoom,r=e.zoom_enabled&&n?n:a;return t?r(isValue(t.x)?t.x:t):null},xv:function(t){var e=this,i=e.axis,a=e.config,n=e.scale.x,r=e.getBaseValue(t);return i.isTimeSeries()?r=parseDate.call(e,r):i.isCategorized()&&isString(r)&&(r=a.axis_x_categories.indexOf(r)),Math.ceil(n(r))},yv:function(t){var e=this.scale,i=e.y,a=e.y2,n=t.axis&&"y2"===t.axis?a:i;return Math.ceil(n(this.getBaseValue(t)))},subxx:function(t){return t?this.scale.subX(t.x):null}},shape={getDrawShape:function(){var t=this,e=t.config.axis_rotated,i=t.state.hasRadar,a={type:{},indices:{},pos:{}};if(t.hasTypeOf("Line")||t.hasType("bubble")||t.hasType("scatter")){var n=t.getShapeIndices(t.isLineType);if(a.indices.line=n,a.type.line=t.generateDrawLine?t.generateDrawLine(n,!1):void 0,t.hasTypeOf("Area")){var r=t.getShapeIndices(t.isAreaType);a.indices.area=r,a.type.area=t.generateDrawArea?t.generateDrawArea(r,!1):void 0}}if(t.hasType("bar")){n=t.getShapeIndices(t.isBarType);a.indices.bar=n,a.type.bar=t.generateDrawBar?t.generateDrawBar(n):void 0}if(!t.hasArcType()||i){var s=i?t.radarCircleX:e?t.circleY:t.circleX,o=i?t.radarCircleY:e?t.circleX:t.circleY;a.pos={xForText:t.generateXYForText(a.indices,!0),yForText:t.generateXYForText(a.indices,!1),cx:(s||function(){}).bind(t),cy:(o||function(){}).bind(t)}}return a},getShapeIndices:function(t){var e=this.config,i=e.data_xs,a=notEmpty(i),n={},r=a?{}:0;return a&&getUnique(Object.keys(i).map(function(t){return i[t]})).forEach(function(t){r[t]=0,n[t]={}}),this.filterTargetsToShow(this.data.targets.filter(t,this)).forEach(function(t){for(var a=(t.id in i?i[t.id]:""),s=a?n[a]:n,o=0,c=void 0;c=e.data_groups[o];o++)if(!(c.indexOf(t.id)<0))for(var l=0,u=void 0;u=c[l];l++)if(u in s){s[t.id]=s[u];break}isUndefined(s[t.id])&&(s[t.id]=a?r[a]++:r++,s.__max__=(a?r[a]:r)-1)}),n},getIndices:function(t,e){var i=this.config.data_xs;return notEmpty(i)?t[i[e]]:t},getIndicesMax:function(t){return notEmpty(this.config.data_xs)?Object.keys(t).map(function(e){return t[e].__max__||0}).reduce(function(t,e){return t+e}):t.__max__},getShapeX:function(t,e,i){var a=this,n=a.config,r=a.scale,s=i?r.subX:r.zoom||r.x,o=n.bar_padding,c=function(t,e){return t+e},l=isObjectType(t)&&(t._$total.length?t._$total.reduce(c)/2:0);return function(i){var n=a.getIndices(e,i.id),r=i.id in n?n[i.id]:0,u=(n.__max__||0)+1,d=0;if(notEmpty(i.x)){var h=s(i.x,!0);d=l?h-(t[i.id]||t._$width)+t._$total.slice(0,r+1).reduce(c)-l:h-(isNumber(t)?t:t._$width)*(u/2-r)}return t&&d&&u>1&&o&&(r&&(d+=o*r),u>2?d-=(u-1)*o/2:2===u&&(d-=o/2)),d}},getShapeY:function(t){var e=this,i=e.isStackNormalized();return function(a){var n=i?e.getRatio("index",a,!0):e.isBubbleZType(a)?e.getBubbleZData(a.value,"y"):a.value;return e.getYScaleById(a.id,t)(n)}},getShapeYMin:function(t){var e=this.scale[this.axis.getId(t)].domain()[0];return!this.isGrouped(t)&&e>0?e:0},getShapeOffsetData:function(t){var e=this,i=e.orderTargets(e.filterTargetsToShow(e.data.targets.filter(t,e))),a=e.isStackNormalized(),n=i.map(function(t){var i=t.values,n={};e.isStepType(t)&&(i=e.convertValuesToStep(i));var r=i.reduce(function(t,i){var r=Number(i.x);return t[r]=i,n[r]=a?e.getRatio("index",i,!0):i.value,t},{});return{id:t.id,rowValues:i,rowValueMapByXValue:r,values:n}});return{indexMapByTargetId:i.reduce(function(t,e,i){return t[e.id]=i,t},{}),shapeOffsetTargets:n}},getShapeOffset:function(t,e,i){var a=this,n=a.getShapeOffsetData(t),r=n.shapeOffsetTargets,s=n.indexMapByTargetId;return function(t,n){var o=a.getIndices(e,t.id),c=a.getYScaleById(t.id,i),l=c(a.getShapeYMin(t.id)),u=Number(t.x),d=l;return r.filter(function(e){return e.id!==t.id}).forEach(function(e){if(o[e.id]===o[t.id]&&s[e.id]<s[t.id]){var i=e.rowValues[n];i&&Number(i.x)===u||(i=e.rowValueMapByXValue[u]),i&&i.value*t.value>=0&&(d+=c(e.values[u])-l)}}),d}},isWithinShape:function(t,e){var i,a=this,n=select(t);return a.isTargetToShow(e.id)?"hasValidPointType"in a&&a.hasValidPointType(t.nodeName)?i=a.isStepType(e)?a.isWithinStep(t,a.getYScaleById(e.id)(e.value)):a.isWithinCircle(t,a.isBubbleType(e)?1.5*a.pointSelectR(e):0):"path"===t.nodeName&&(i=!n.classed(CLASS.bar)||a.isWithinBar(t)):i=!1,i},getInterpolate:function(t){var e=this.getInterpolateType(t);return{basis:curveBasis,"basis-closed":curveBasisClosed,"basis-open":curveBasisOpen,bundle:curveBundle,cardinal:curveCardinal,"cardinal-closed":curveCardinalClosed,"cardinal-open":curveCardinalOpen,"catmull-rom":curveCatmullRom,"catmull-rom-closed":curveCatmullRomClosed,"catmull-rom-open":curveCatmullRomOpen,"monotone-x":curveMonotoneX,"monotone-y":curveMonotoneY,natural:curveNatural,"linear-closed":curveLinearClosed,linear:curveLinear,step:curveStep,"step-after":curveStepAfter,"step-before":curveStepBefore}[e]},getInterpolateType:function(t){var e=this.config,i=e.spline_interpolation_type,a=this.isInterpolationType(i)?i:"cardinal";return this.isSplineType(t)?a:this.isStepType(t)?e.line_step_type:"linear"}},size={setContainerSize:function(){var t=this.state;t.current.width=this.getCurrentWidth(),t.current.height=this.getCurrentHeight()},getCurrentWidth:function(){return this.config.size_width||this.getParentWidth()},getCurrentHeight:function(){var t=this.config,e=t.size_height||this.getParentHeight();return e>0?e:320/(this.hasType("gauge")&&!t.gauge_fullCircle?2:1)},getCurrentPaddingTop:function(){var t=this,e=t.config,i=t.state.hasAxis,a=t.$el,n=i?e.axis_y2_axes.length:0,r=isValue(e.padding_top)?e.padding_top:0;return a.title&&a.title.node()&&(r+=t.getTitlePadding()),n&&e.axis_rotated&&(r+=t.getHorizontalAxisHeight("y2")*n),r},getCurrentPaddingBottom:function(){var t=this.config,e=this.state.hasAxis,i=t.axis_rotated?"y":"x",a=e?t["axis_"+i+"_axes"].length:0;return(isValue(t.padding_bottom)?t.padding_bottom:0)+(a?this.getHorizontalAxisHeight(i)*a:0)},getCurrentPaddingLeft:function(t){var e=this.config,i=this.state.hasAxis,a=e.axis_rotated,n=a?"x":"y",r=i?e["axis_"+n+"_axes"].length:0,s=i?this.getAxisWidthByAxisId(n,t):0;return(isValue(e.padding_left)?e.padding_left:i&&a?e.axis_x_show?Math.max(ceil10(s),40):1:!i||e.axis_y_show&&!e.axis_y_inner?ceil10(s):this.axis.getAxisLabelPosition("y").isOuter?30:1)+s*r},getCurrentPaddingRight:function(t){void 0===t&&(t=!1);var e=this,i=e.config,a=e.state.hasAxis,n=e.state.isLegendRight?e.getLegendWidth()+20:0,r=a?i.axis_y2_axes.length:0,s=a?e.getAxisWidthByAxisId("y2"):0,o=t?e.axis.getXAxisTickTextY2Overflow(10):0;return(isValue(i.padding_right)?i.padding_right+1:e.axis&&i.axis_rotated?10+n:!e.axis||i.axis_y2_show&&!i.axis_y2_inner?Math.max(ceil10(s)+n,o):Math.max(2+n+(e.axis.getAxisLabelPosition("y2").isOuter?20:0),o))+s*r},getParentRectValue:function(t){for(var e,i="offset"+capitalize(t),a=this.$el.chart.node();!e&&a&&"BODY"!==a.tagName;){try{e=a.getBoundingClientRect()[t]}catch(t){i in a&&(e=a[i])}a=a.parentNode}if("width"===t){var n=doc.body.offsetWidth;e>n&&(e=n)}return e},getParentWidth:function(){return this.getParentRectValue("width")},getParentHeight:function(){var t=this.$el.chart.style("height");return t.indexOf("px")>0?parseInt(t,10):0},getSvgLeft:function(t){var e=this.config,i=this.$el,a=e.axis_rotated||!e.axis_rotated&&!e.axis_y_inner,n=e.axis_rotated?CLASS.axisX:CLASS.axisY,r=i.main.select("."+n).node(),s=r&&a?r.getBoundingClientRect():{right:0},o=i.chart.node().getBoundingClientRect(),c=this.hasArcType(),l=s.right-o.left-(c?0:this.getCurrentPaddingLeft(t));return l>0?l:0},updateDimension:function(t){var e=this,i=e.config,a=e.state.hasAxis,n=e.$el;a&&!t&&(e.axis.x&&i.axis_rotated?(e.axis.x.create(n.axis.x),e.axis.subX&&e.axis.subX.create(n.axis.subX)):(e.axis.y&&e.axis.y.create(n.axis.y),e.axis.y2&&e.axis.y2.create(n.axis.y2))),e.updateScales(t),e.updateSvgSize(),e.transformAll(!1)},updateSvgSize:function(){var t=this,e=t.state,i=e.clip,a=e.current,n=e.hasAxis,r=e.width,s=e.height,o=t.$el.svg;if(o.attr("width",a.width).attr("height",a.height),n){var c=o.select("."+CLASS.brush+" .overlay"),l={width:0,height:0};c.size()&&(l.width=+c.attr("width"),l.height=+c.attr("height")),o.selectAll(["#"+i.id,"#"+i.idGrid]).select("rect").attr("width",r).attr("height",s),o.select("#"+i.idXAxis).select("rect").call(t.setXAxisClipPath.bind(t)),o.select("#"+i.idYAxis).select("rect").call(t.setYAxisClipPath.bind(t)),i.idSubchart&&o.select("#"+i.idSubchart).select("rect").attr("width",r).attr("height",l.height)}},updateSizes:function(t){var e=this,i=e.config,a=e.state,n=e.$el.legend,r=i.axis_rotated,s=e.hasArcType();!t&&e.setContainerSize();var o={width:n?e.getLegendWidth():0,height:n?e.getLegendHeight():0};!s&&i.axis_x_show&&i.axis_x_tick_autorotate&&e.updateXAxisTickClip();var c=a.isLegendRight||a.isLegendInset?0:o.height,l=r||s?0:e.getHorizontalAxisHeight("x"),u=i.subchart_axis_x_show&&i.subchart_axis_x_tick_text_show?l:30,d=i.subchart_show&&!s?i.subchart_size_height+u:0;a.margin=!s&&r?{top:e.getHorizontalAxisHeight("y2")+e.getCurrentPaddingTop(),right:s?0:e.getCurrentPaddingRight(!0),bottom:e.getHorizontalAxisHeight("y")+c+e.getCurrentPaddingBottom(),left:d+(s?0:e.getCurrentPaddingLeft())}:{top:4+e.getCurrentPaddingTop(),right:s?0:e.getCurrentPaddingRight(!0),bottom:l+d+c+e.getCurrentPaddingBottom(),left:s?0:e.getCurrentPaddingLeft()},a.margin2=r?{top:a.margin.top,right:NaN,bottom:20+c,left:e.state.rotatedPadding.left}:{top:a.current.height-d-c,right:NaN,bottom:u+c,left:a.margin.left},a.margin3={top:0,right:NaN,bottom:0,left:0},e.updateSizeForLegend&&e.updateSizeForLegend(o),a.width=a.current.width-a.margin.left-a.margin.right,a.height=a.current.height-a.margin.top-a.margin.bottom,a.width<0&&(a.width=0),a.height<0&&(a.height=0),a.width2=r?a.margin.left-a.rotatedPadding.left-a.rotatedPadding.right:a.width,a.height2=r?a.height:a.current.height-a.margin2.top-a.margin2.bottom,a.width2<0&&(a.width2=0),a.height2<0&&(a.height2=0);var h=e.hasType("gauge"),g=i.legend_show&&a.isLegendRight;a.arcWidth=a.width-(g?o.width+10:0),a.arcHeight=a.height-(g&&!h?0:10),h&&!i.gauge_fullCircle&&(a.arcHeight+=a.height-e.getPaddingBottomForGauge()),e.updateRadius&&e.updateRadius(),a.isLegendRight&&s&&(a.margin3.left=a.arcWidth/2+1.1*a.radiusExpanded)}},text={opacityForText:function(t){return this.isBarType(t)&&!this.meetsLabelThreshold(Math.abs(this.getRatio("bar",t)),"bar")?"0":this.hasDataLabel?"1":"0"},initText:function(){this.$el.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartTexts)},updateTargetsForText:function(t){var e=this,i=e.getChartClass("Text"),a=e.getClass("texts","id"),n=e.classFocus.bind(e);e.$el.main.select("."+CLASS.chartTexts).selectAll("."+CLASS.chartText).data(t).attr("class",function(t){return i(t)+n(t)}).enter().append("g").style("opacity","0").attr("class",i).style("pointer-events","none").append("g").attr("class",a)},updateText:function(t){var e=this,i=e.config,a=e.$el,n=e.labelishData.bind(e),r=e.getClass("text","index");a.text=a.main.selectAll("."+CLASS.texts).selectAll("."+CLASS.text).data(function(t){return e.isRadarType(t)?t.values:n(t)}),a.text.exit().transition().duration(t).style("fill-opacity","0").remove(),a.text=a.text.enter().append("text").merge(e.$el.text).attr("class",r).attr("text-anchor",function(t){return i.axis_rotated?t.value<0?"end":"start":"middle"}).style("fill",e.updateTextColor.bind(e)).style("fill-opacity","0").call(function(t){t.each(function(t,i,a){var n=e.isBubbleZType(t)?e.getBubbleZData(t.value,"z"):t.value;n=e.dataLabelFormat(t.id)(n,t.id,i,a),isNumber(n)?this.textContent=n:setTextValue(select(this),n)})})},updateTextColor:function(t){var e,i=this,a=i.config.data_labels_colors,n=i.isArcType(t)&&!i.isRadarType(t)?null:i.color(t);if(isString(a))e=a;else if(isObject(a)){e=a[(t.data||t).id]}else isFunction(a)&&(e=a.bind(i.api)(n,t));return e||n},redrawText:function(t,e,i,a){var n=this,r=getRandom(),s=i?0:n.opacityForText.bind(n);return n.$el.text.each(function(i,o){var c=select(this);(a&&c.attr("x")?c.transition(r):c).call(function(i){i.each(function(i){select(this).style("fill",n.updateTextColor.bind(n)).style("fill-opacity",s);var a=t.bind(this)(i,o),r=e.bind(this)(i,o);this.childElementCount?this.setAttribute("transform","translate("+a+" "+r+")"):(this.setAttribute("x",a),this.setAttribute("y",r))})})}),!0},getTextRect:function(t,e){var i=t.node?t.node():t;/text/i.test(i.tagName)||(i=i.querySelector("text"));var a=i.textContent,n=KEY.textRect+"-"+a.replace(/\W/g,"_"),r=this.cache.get(n);return r||(this.$el.svg.append("text").style("visibility","hidden").style("font",select(i).style("font")).classed(e,!0).text(a).call(function(t){r=getBoundingRect(t.node())}).remove(),this.cache.add(n,r)),r},generateXYForText:function(t,e){var i=this,a=Object.keys(t),n={},r=e?i.getXForText:i.getYForText;return i.hasType("radar")&&a.push("radar"),a.forEach(function(e){n[e]=i["generateGet"+capitalize(e)+"Points"](t[e],!1)}),function(t,e){var a=(i.isAreaType(t)?"area":i.isBarType(t)&&"bar")||i.isRadarType(t)&&"radar"||"line";return r.call(i,n[a](t,e),t,this)}},getCenteredTextPos:function(t,e,i){var a=this.config,n=a.axis_rotated;if(a.data_labels.centered&&this.isBarType(t)){var r=getBoundingRect(i),s=t.value>=0;if(n){var o=(s?e[1][1]-e[0][1]:e[0][1]-e[1][1])/2+r.width/2;return s?-o-3:o+2}var c=(s?e[0][1]-e[1][1]:e[1][1]-e[0][1])/2+r.height/2;return s?c:-c-2}return 0},getTextPos:function(t,e){var i=this.config.data_labels_position;return(t in i?i[t]:i)[e]||0},getXForText:function(t,e,i){var a,n,r=this,s=r.config,o=r.state,c=s.axis_rotated;if(c?(n=r.isBarType(e)?4:6,a=t[2][1]+n*(e.value<0?-1:1)):a=r.hasType("bar")?(t[2][0]+t[0][0])/2:t[0][0],null===e.value)if(a>o.width){var l=getBoundingRect(i).width;a=o.width-l}else a<0&&(a=4);return c&&(a+=r.getCenteredTextPos(e,t,i)),a+r.getTextPos(e.id,"x")},getYForText:function(t,e,i){var a,n=this,r=n.config,s=n.state,o=r.axis_rotated,c=r.point_r,l=getBoundingRect(i),u=3;if(o)a=(t[0][0]+t[2][0]+.6*l.height)/2;else if(a=t[2][1],isNumber(c)&&c>5&&(n.isLineType(e)||n.isScatterType(e))&&(u+=r.point_r/2.3),e.value<0||0===e.value&&!s.hasPositiveValue&&s.hasNegativeValue)a+=l.height+(n.isBarType(e)?-u:u);else{var d=2*-u;n.isBarType(e)?d=-u:n.isBubbleType(e)&&(d=u),a+=d}if(null===e.value&&!o){var h=l.height;a<h?a=h:a>s.height&&(a=s.height-4)}return o||(a+=n.getCenteredTextPos(e,t,i)),a+n.getTextPos(e.id,"y")},markOverlapped:function(t,e,i){var a=e.$el.arcs.selectAll(i),n=a.filter(function(e){return e.data.id!==t}),r=a.filter(function(e){return e.data.id===t}),s=getTranslation(r.node()),o=function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))};r.node()&&n.each(function(){var t=getTranslation(this),e=select(this),i=o(s.e,s.f)>o(t.e,t.f)?r:e,a=Math.ceil(Math.abs(s.e-t.e))<Math.ceil(i.node().getComputedTextLength()),n=Math.ceil(Math.abs(s.f-t.f))<parseInt(r.style("font-size"),10);e.classed(CLASS.TextOverlapping,a&&n)})},undoMarkOverlapped:function(t,e){t.$el.arcs.selectAll(e).each(function(){selectAll([this,this.previousSibling]).classed(CLASS.TextOverlapping,!1)})},meetsLabelThreshold:function(t,e){void 0===t&&(t=0);return t>=(this.config[e+"_label_threshold"]||0)}};function getTextPos(t,e){void 0===t&&(t="left");var i=isNumber(e);return t.indexOf("center")>-1?i?e/2:"middle":t.indexOf("right")>-1?i?e:"end":i?0:"start"}var title$1={initTitle:function(){var t=this.config,e=this.$el;t.title_text&&(e.title=e.svg.append("g"),setTextValue(e.title.append("text").style("text-anchor",getTextPos(t.title_position)).attr("class",CLASS.title),t.title_text,[.3,1.5]))},redrawTitle:function(){var t=this,e=t.config,i=t.state.current,a=t.$el.title;if(a){var n=t.yForTitle.call(t);/g/i.test(a.node().tagName)?a.attr("transform","translate("+getTextPos(e.title_position,i.width)+", "+n+")"):a.attr("x",t.xForTitle.call(t)).attr("y",n)}},xForTitle:function(){var t,e=this.config,i=this.state.current,a=e.title_position||"left",n=this.getTextRect(this.$el.title,CLASS.title).width;return/(right|center)/.test(a)?(t=i.width-n,a.indexOf("right")>=0?t=i.width-n-e.title_padding.right:a.indexOf("center")>=0&&(t=(i.width-n)/2)):t=e.title_padding.left||0,t},yForTitle:function(){return(this.config.title_padding.top||0)+this.getTextRect(this.$el.title,CLASS.title).height},getTitlePadding:function(){return this.yForTitle()+(this.config.title_padding.bottom||0)}},tooltip$1={initTooltip:function(){var t=this.config,e=this.$el;e.tooltip=select(t.tooltip_contents.bindto),e.tooltip.empty()&&(e.tooltip=e.chart.style("position","relative").append("div").attr("class",CLASS.tooltipContainer).style("position","absolute").style("pointer-events","none").style("display","none")),this.bindTooltipResizePos()},initShowTooltip:function(){var t=this,e=t.config,i=t.$el,a=t.state,n=a.hasAxis,r=a.hasRadar;if(e.tooltip_init_show){var s=!(n&&r);if(t.axis&&t.axis.isTimeSeries()&&isString(e.tooltip_init_x)){var o=t.data.targets[0],c=void 0,l=void 0;for(e.tooltip_init_x=parseDate.call(t,e.tooltip_init_x),c=0;(l=o.values[c])&&l.x-e.tooltip_init_x!=0;c++);e.tooltip_init_x=c}var u=t.data.targets.map(function(i){var a=s?0:e.tooltip_init_x;return t.addName(i.values[a])});s&&(u=[u[e.tooltip_init_x]]),i.tooltip.html(t.getTooltipHTML(u,t.axis&&t.axis.getXAxisTickFormat(),t.getYFormat(t.hasArcType(null,["radar"])),t.color)),e.tooltip_contents.bindto||i.tooltip.style("top",e.tooltip_init_position.top).style("left",e.tooltip_init_position.left).style("display","block")}},getTooltipHTML:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.api,a=this.config;return isFunction(a.tooltip_contents)?a.tooltip_contents.bind(i).apply(void 0,t):this.getTooltipContent.apply(this,t)},getTooltipContent:function(t,e,i,a){var n=this,r=n.api,s=n.config,o=n.state,c=["title","name","value"].map(function(t){var e=s["tooltip_format_"+t];return isFunction(e)?e.bind(r):e}),l=c[0],u=c[1],d=c[2];l=l||e,u=u||function(t){return t},d=d||(n.isStackNormalized()?function(t,e){return(100*e).toFixed(2)+"%"}:i);var h=s.tooltip_order,g=function(t){return n.axis&&n.isBubbleZType(t)?n.getBubbleZData(t.value,"z"):n.getBaseValue(t)},f=n.levelColor?function(t){return n.levelColor(t.value)}:function(t){return a(t)},p=s.tooltip_contents,x=p.template,v=n.mapToTargetIds();if(null===h&&s.data_groups.length){var m=n.orderTargets(n.data.targets).map(function(t){return t.id}).reverse();t.sort(function(t,e){var i=t?t.value:null,a=e?e.value:null;return i>0&&a>0&&(i=t.id?m.indexOf(t.id):null,a=e.id?m.indexOf(e.id):null),i-a})}else if(/^(asc|desc)$/.test(h)){var _="asc"===h;t.sort(function(t,e){var i=t?g(t):null,a=e?g(e):null;return _?i-a:a-i})}else isFunction(h)&&t.sort(h.bind(r));var y,b,T,S,A,L=n.getTooltipContentTemplate(x),C=t.length,w=function(){if(!(b=t[A])||!g(b)&&0!==g(b))return"continue";if(isUndefined(y)){var e=(o.hasAxis||o.hasRadar)&&sanitise(l?l(b.x):b.x);y=tplProcess(L[0],{CLASS_TOOLTIP:CLASS.tooltip,TITLE:isValue(e)?x?e:'<tr><th colspan="2">'+e+"</th></tr>":""})}if(!b.ratio&&n.$el.arcs&&(b.ratio=n.getRatio("arc",n.$el.arcs.select("path."+CLASS.arc+"-"+b.id).data()[0])),T=[b.ratio,b.id,b.index,t],S=sanitise(d.apply(void 0,__spreadArrays([g(b)],T))),n.isAreaRangeType(b)){var i=["high","low"].map(function(t){return sanitise(d.apply(void 0,__spreadArrays([n.getAreaRangeData(b,t)],T)))}),a=i[0],r=i[1];S="<b>Mid:</b> "+S+" <b>High:</b> "+a+" <b>Low:</b> "+r}if(void 0!==S){if(null===b.name)return"continue";var s=sanitise(u.apply(void 0,__spreadArrays([b.name],T))),c=f(b),h={CLASS_TOOLTIP_NAME:CLASS.tooltipName+n.getTargetSelectorSuffix(b.id),COLOR:x||!n.patterns?c:'<svg><rect style="fill:'+c+'" width="10" height="10"></rect></svg>',NAME:s,VALUE:S};if(x&&isObject(p.text)){var m=v.indexOf(b.id);Object.keys(p.text).forEach(function(t){h[t]=p.text[t][m]})}y+=tplProcess(L[1],h)}};for(A=0;A<C;A++)w();return y+"</table>"},getTooltipContentTemplate:function(t){return(t||'<table class="{=CLASS_TOOLTIP}"><tbody>\n\t\t\t\t{=TITLE}\n\t\t\t\t{{<tr class="{=CLASS_TOOLTIP_NAME}">\n\t\t\t\t\t<td class="name">'+(this.patterns?"{=COLOR}":'<span style="background-color:{=COLOR}"></span>')+'{=NAME}</td>\n\t\t\t\t\t<td class="value">{=VALUE}</td>\n\t\t\t\t</tr>}}\n\t\t\t</tbody></table>').replace(/(\r?\n|\t)/g,"").split(/{{(.*)}}/)},tooltipPosition:function(t,e,i,a){var n=this,r=n.config,s=n.scale,o=n.state,c=o.width,l=o.height,u=o.current,d=o.isLegendRight,h=o.inputType,g=n.hasType("gauge")&&!r.gauge_fullCircle,f=n.getSvgLeft(!0),p=mouse(a),x=p[0],v=p[1],m=f+u.width-n.getCurrentPaddingRight(),_=n.getCurrentPaddingLeft(!0);if(n.hasArcType()){"touch"===h||n.hasType("radar")||(v+=g?l:l/2,x+=(c-(d?n.getLegendWidth():0))/2)}else{var y=s.x(t[0].x);r.axis_rotated?(v=y+20,x+=f+100,m-=f):(v-=5,x=f+_+20+(n.zoomScale?x:y))}x+e+15>m&&(x-=e+_),v+i>u.height&&(v-=g?3*i:i+30);var b={top:v,left:x};return Object.keys(b).forEach(function(t){b[t]<0&&(b[t]=0)}),b},showTooltip:function(t,e){var i=this,a=i.config,n=i.state,r=i.$el.tooltip,s=a.tooltip_contents.bindto,o=i.hasArcType(null,["radar"]),c=t.filter(function(t){return t&&isValue(i.getBaseValue(t))});if(r&&0!==c.length&&a.tooltip_show){var l=r.datum(),u=l||{},d=u.width,h=void 0===d?0:d,g=u.height,f=void 0===g?0:g,p=JSON.stringify(t);if(!l||l.current!==p){var x=t.concat().sort()[0].index;callFn(a.tooltip_onshow,i.api,t),r.html(i.getTooltipHTML(t,i.axis?i.axis.getXAxisTickFormat():i.categoryName.bind(i),i.getYFormat(o),i.color)).style("display",null).style("visibility",null).datum(l={index:x,current:p,width:h=r.property("offsetWidth"),height:f=r.property("offsetHeight")}),callFn(a.tooltip_onshown,i.api,t),i._handleLinkedCharts(!0,x)}if(!s){var v=(a.tooltip_position||i.tooltipPosition).call(this,c,h,f,e);["top","left"].forEach(function(t){var e=v[t];r.style(t,e+"px"),"left"!==t||l.xPosInPercent||(l.xPosInPercent=e/n.current.width*100)})}}},bindTooltipResizePos:function(){var t=this.resizeFunction,e=this.state,i=this.$el.tooltip;t.add(function(){if("block"===i.style("display")){var t=e.current,a=i.datum(),n=a.width,r=a.xPosInPercent,s=t.width/100*r,o=t.width-(s+n);o<0&&(s+=o),i.style("left",s+"px")}})},hideTooltip:function(t){var e=this.api,i=this.config,a=this.$el.tooltip;if(a&&"none"!==a.style("display")&&(!i.tooltip_doNotHide||t)){var n=JSON.parse(a.datum().current);callFn(i.tooltip_onhide,e,n),a.style("display","none").style("visibility","hidden").datum(null),callFn(i.tooltip_onhidden,e,n)}},_handleLinkedCharts:function(t,e){var i=this,a=i.charts,n=i.config;if(n.tooltip_linked&&a.length>1){var r=n.tooltip_linked_name;a.filter(function(t){return t!==i.api}).forEach(function(i){var a=i.internal,n=a.config,s=a.$el,o=n.tooltip_linked,c=n.tooltip_linked_name,l=doc.body.contains(s.chart.node());if(o&&r===c&&l){var u=s.tooltip.data()[0],d=e!==(u&&u.index);try{t&&d?i.tooltip.show({index:e}):t||i.tooltip.hide()}catch(t){}}})}}},transform={getTranslate:function(t,e){void 0===e&&(e=0);var i,a,n=this.config,r=this.state,s=n.axis_rotated,o=0;if(e&&/^(x|y2?)$/.test(t)&&(o=this.getAxisSize(t)*e),"main"===t)i=asHalfPixel(r.margin.left),a=asHalfPixel(r.margin.top);else if("context"===t)i=asHalfPixel(r.margin2.left),a=asHalfPixel(r.margin2.top);else if("legend"===t)i=r.margin3.left,a=r.margin3.top;else if("x"===t)i=s?-o:0,a=s?0:r.height+o;else if("y"===t)i=s?0:-o,a=s?r.height+o:0;else if("y2"===t)i=s?0:r.width+o,a=s?1-o:0;else if("subX"===t)i=0,a=s?0:r.height2;else if("arc"===t)i=r.arcWidth/2,a=r.arcHeight/2;else if("radar"===t){var c=this.getRadarSize()[0];i=r.width/2-c,a=asHalfPixel(r.margin.top)}return"translate("+i+", "+a+")"},transformMain:function(t,e){var i,a,n,r=this,s=r.$el.main;e&&e.axisX?i=e.axisX:(i=s.select("."+CLASS.axisX),t&&(i=i.transition())),e&&e.axisY?a=e.axisY:(a=s.select("."+CLASS.axisY),t&&(a=a.transition())),e&&e.axisY2?n=e.axisY2:(n=s.select("."+CLASS.axisY2),t&&(n=n.transition())),(t?s.transition():s).attr("transform",r.getTranslate("main")),i.attr("transform",r.getTranslate("x")),a.attr("transform",r.getTranslate("y")),n.attr("transform",r.getTranslate("y2")),s.select("."+CLASS.chartArcs).attr("transform",r.getTranslate("arc"))},transformAll:function(t,e){var i=this,a=i.config,n=i.state.hasAxis,r=i.$el;i.transformMain(t,e),n&&a.subchart_show&&i.transformContext(t,e),r.legend&&i.transformLegend(t)}},type={setTargetType:function(t,e){var i=this.config,a=this.state.withoutFadeIn;this.mapToTargetIds(t).forEach(function(t){a[t]=e===i.data_types[t],i.data_types[t]=e}),t||(i.data_type=e)},updateTypesElements:function(){var t=this,e=t.state.current;Object.keys(TYPE).forEach(function(i){var a=TYPE[i],n=t.hasType(a,null,!0),r=e.types.indexOf(a);-1===r&&n?e.types.push(a):r>-1&&!n&&e.types.splice(r,1)}),t.setChartElements()},hasType:function(t,e,i){void 0===i&&(i=!1);var a=this.config,n=this.state.current,r=a.data_types,s=e||this.data.targets,o=!1;return!i&&n.types.length&&n.types.indexOf(t)>-1?o=!0:s&&s.length?s.forEach(function(e){var i=r[e.id];(i===t||!i&&"line"===t)&&(o=!0)}):Object.keys(r).length?Object.keys(r).forEach(function(e){r[e]===t&&(o=!0)}):o=a.data_type===t,o},hasTypeOf:function(t,e,i){var a=this;return void 0===i&&(i=[]),!TYPE_BY_CATEGORY[t].filter(function(t){return-1===i.indexOf(t)}).every(function(t){return!a.hasType(t,e)})},isTypeOf:function(t,e){var i=isString(t)?t:t.id,a=this.config.data_types[i]||this.config.data_type;return isArray(e)?e.indexOf(a)>=0:a===e},hasPointType:function(){return this.hasTypeOf("Line")||this.hasType("bubble")||this.hasType("scatter")},hasArcType:function(t,e){return this.hasTypeOf("Arc",t,e)},hasMultiArcGauge:function(){return this.hasType("gauge")&&"multi"===this.config.gauge_type},isLineType:function(t){var e=isString(t)?t:t.id;return!this.config.data_types[e]||this.isTypeOf(e,TYPE_BY_CATEGORY.Line)},isStepType:function(t){return this.isTypeOf(t,TYPE_BY_CATEGORY.Step)},isSplineType:function(t){return this.isTypeOf(t,TYPE_BY_CATEGORY.Spline)},isAreaType:function(t){return this.isTypeOf(t,TYPE_BY_CATEGORY.Area)},isAreaRangeType:function(t){return this.isTypeOf(t,TYPE_BY_CATEGORY.AreaRange)},isBarType:function(t){return this.isTypeOf(t,"bar")},isBubbleType:function(t){return this.isTypeOf(t,"bubble")},isScatterType:function(t){return this.isTypeOf(t,"scatter")},isPieType:function(t){return this.isTypeOf(t,"pie")},isGaugeType:function(t){return this.isTypeOf(t,"gauge")},isDonutType:function(t){return this.isTypeOf(t,"donut")},isRadarType:function(t){return this.isTypeOf(t,"radar")},isArcType:function(t){return this.isPieType(t)||this.isDonutType(t)||this.isGaugeType(t)||this.isRadarType(t)},isCirclePoint:function(t){var e=this.config,i=e.point_pattern;return!(!t||"circle"!==t.tagName)||"circle"===e.point_type&&(!i||isArray(i)&&0===i.length)},lineData:function(t){return this.isLineType(t)?[t]:[]},arcData:function(t){return this.isArcType(t.data)?[t]:[]},barData:function(t){return this.isBarType(t)?t.values:[]},labelishData:function(t){return this.isBarType(t)||this.isLineType(t)||this.isScatterType(t)||this.isBubbleType(t)||this.isRadarType(t)?t.values:[]},barLineBubbleData:function(t){return this.isBarType(t)||this.isLineType(t)||this.isBubbleType(t)?t.values:[]},isInterpolationType:function(t){return["basis","basis-closed","basis-open","bundle","cardinal","cardinal-closed","cardinal-open","catmull-rom","catmull-rom-closed","catmull-rom-open","linear","linear-closed","monotone-x","monotone-y","natural"].indexOf(t)>=0}},ChartInternal=function(){function t(t){this.data={xs:{},targets:[]},this.scale={x:null,y:null,y2:null,subX:null,subY:null,subY2:null,zoom:null},this.org={xScale:null,xDomain:null},this.format={extraLineClasses:null,xAxisTick:null,dataTime:null,defaultAxisTime:null,axisTime:null};var e=this;e.api=t,e.config=new Options,e.cache=new Cache;var i=new Store;e.$el=i.getStore("element"),e.state=i.getStore("state")}return t.prototype.beforeInit=function(){this.callPluginHook("$beforeInit"),callFn(this.config.onbeforeinit,this.api)},t.prototype.afterInit=function(){this.callPluginHook("$afterInit"),callFn(this.config.onafterinit,this.api)},t.prototype.init=function(){var t=this,e=t.config,i=t.state,a=t.$el;i.hasAxis=!t.hasArcType(),i.hasRadar=!i.hasAxis&&t.hasType("radar"),t.initParams();var n={element:e.bindto,classname:"bb"};isObject(e.bindto)&&(n.element=e.bindto.element||"#chart",n.classname=e.bindto.classname||n.classname),a.chart=isFunction(n.element.node)?e.bindto.element:select(n.element||[]),a.chart.empty()&&(a.chart=select(doc.body.appendChild(doc.createElement("div")))),a.chart.html("").classed(n.classname,!0),t.initToRender()},t.prototype.initToRender=function(t){var e=this,i=e.config,a=e.state,n=e.$el.chart,r=function(){return"none"===n.style("display")||"hidden"===n.style("visibility")},s=i.render.lazy||r(),o=win.MutationObserver;if(s&&o&&!1!==i.render.observe&&!t&&new o(function(t,i){r()||(i.disconnect(),!a.rendered&&e.initToRender(!0))}).observe(n.node(),{attributes:!0,attributeFilter:["class","style"]}),!s||t){var c=e.convertData(i,e.initWithData);c&&e.initWithData(c),e.afterInit()}},t.prototype.initParams=function(){var t=this,e=t,i=e.config,a=e.format,n=e.state,r=i.axis_rotated;if(n.datetimeId="bb-"+ +new Date,t.color=t.generateColor(),t.levelColor=t.generateLevelColor(),t.hasPointType()&&(t.point=t.generatePoint()),n.hasAxis){t.initClip(),a.extraLineClasses=t.generateExtraLineClass(),a.dataTime=i.data_xLocaltime?timeParse:utcParse,a.axisTime=i.axis_x_localtime?timeFormat:utcFormat;var s=t.config.zoom_enabled&&"drag"===t.config.zoom_type;a.defaultAxisTime=function(e){var i=t.scale,n=i.x,r=i.zoom,o=s?r:r&&n.orgDomain().toString()!==r.domain().toString(),c=(e.getMilliseconds()?".%L":e.getSeconds()&&".:%S")||e.getMinutes()&&"%I:%M"||e.getHours()&&"%I %p"||1!==e.getDate()&&"%b %d"||o&&1===e.getDate()&&"%b'%y"||e.getMonth()&&"%-m/%-d"||"%Y";return a.axisTime(c)(e)}}n.isLegendRight="right"===i.legend_position,n.isLegendInset="inset"===i.legend_position,n.isLegendTop="top-left"===i.legend_inset_anchor||"top-right"===i.legend_inset_anchor,n.isLegendLeft="top-left"===i.legend_inset_anchor||"bottom-left"===i.legend_inset_anchor,n.rotatedPaddingRight=r&&!i.axis_x_show?0:30,n.inputType=convertInputType(i.interaction_inputType_mouse,i.interaction_inputType_touch)},t.prototype.initWithData=function(t){var e=this,i=e.config,a=e.scale,n=e.state,r=e.$el,s=e.org,o=n.hasAxis,c=i.interaction_enabled;o&&(e.axis=e.getAxisInstance(),i.zoom_enabled&&e.initZoom()),e.data.xs={},e.data.targets=e.convertDataToTargets(t),i.data_filter&&(e.data.targets=e.data.targets.filter(i.data_filter.bind(e.api))),i.data_hide&&e.addHiddenTargetIds(!0===i.data_hide?e.mapToIds(e.data.targets):i.data_hide),i.legend_hide&&e.addHiddenLegendIds(!0===i.legend_hide?e.mapToIds(e.data.targets):i.legend_hide),e.updateSizes(),e.updateScales(!0);var l=a.x,u=a.y,d=a.y2,h=a.subX,g=a.subY,f=a.subY2;if(l&&(l.domain(sortValue(e.getXDomain(e.data.targets))),h.domain(l.domain()),s.xDomain=l.domain()),u&&(u.domain(e.getYDomain(e.data.targets,"y")),g.domain(u.domain())),d&&(d.domain(e.getYDomain(e.data.targets,"y2")),f&&f.domain(d.domain())),r.svg=r.chart.append("svg").style("overflow","hidden").style("display","block"),c&&n.inputType){var p="touch"===n.inputType;r.svg.on(p?"touchstart":"mouseenter",function(){return callFn(i.onover,e.api)}).on(p?"touchend":"mouseleave",function(){return callFn(i.onout,e.api)})}i.svg_classname&&r.svg.attr("class",i.svg_classname);var x=isFunction(i.color_tiles)&&e.patterns;(o||x)&&(r.defs=r.svg.append("defs"),o&&["id","idXAxis","idYAxis","idGrid"].forEach(function(t){e.appendClip(r.defs,n.clip[t])}),x&&e.patterns.forEach(function(t){return r.defs.append(function(){return t.node})})),e.updateSvgSize(),e.bindResize();var v=r.svg.append("g").classed(CLASS.main,!0).attr("transform",e.getTranslate("main"));if(r.main=v,i.subchart_show&&e.initSubchart(),i.tooltip_show&&e.initTooltip(),i.title_text&&e.initTitle(),i.legend_show&&e.initLegend(),i.data_empty_label_text&&v.append("text").attr("class",CLASS.text+" "+CLASS.empty).attr("text-anchor","middle").attr("dominant-baseline","middle"),o&&(i.regions.length&&e.initRegion(),!i.clipPath&&e.axis.init()),v.append("g").attr("class",CLASS.chart).attr("clip-path",n.clip.path),e.callPluginHook("$init"),o&&(c&&e.initEventRect&&e.initEventRect(),e.initGrid(),i.clipPath&&e.axis&&e.axis.init()),e.initChartElements(),e.updateTargets(e.data.targets),e.updateDimension(),callFn(i.oninit,e.api),e.setBackground(),e.redraw({withTransition:!1,withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withTransitionForAxis:!1,initializing:!0}),i.data_onmin||i.data_onmax){var m=e.getMinMaxData();callFn(i.data_onmin,e.api,m.min),callFn(i.data_onmax,e.api,m.max)}i.tooltip_show&&e.initShowTooltip(),n.rendered=!0},t.prototype.initChartElements=function(){var t=this,e=t.state,i=e.hasAxis,a=e.hasRadar,n=[];i?(t.hasType("bar")&&n.push("Bar"),t.hasType("bubble")&&n.push("Bubble"),t.hasTypeOf("Line")&&n.push("Line")):(a||n.push("Arc","Pie"),t.hasType("gauge")?n.push("Gauge"):a&&n.push("Radar")),n.forEach(function(e){t["init"+e]()}),notEmpty(t.config.data_labels)&&!t.hasArcType(null,["radar"])&&t.initText()},t.prototype.setChartElements=function(){var t=this.$el,e=t.chart,i=t.svg,a=t.defs,n=t.main,r=t.tooltip,s=t.legend,o=t.title,c=t.grid,l=t.arcs,u=t.circle,d=t.bar,h=t.line,g=t.area,f=t.text;this.api.$={chart:e,svg:i,defs:a,main:n,tooltip:r,legend:s,title:o,grid:c,arc:l,circles:u,bar:{bars:d},line:{lines:h,areas:g},text:{texts:f}}},t.prototype.setBackground=function(){var t=this.config.background,e=this.state,i=this.$el.svg;if(notEmpty(t)){var a=i.select("g").insert(t.imgUrl?"image":"rect",":first-child");t.imgUrl?a.attr("href",t.imgUrl):t.color&&a.style("fill",t.color).attr("clip-path",e.clip.path),a.attr("class",t.class||null).attr("width","100%").attr("height","100%")}},t.prototype.updateTargets=function(t){var e=this,i=e.state,a=i.hasAxis,n=i.hasRadar;e.updateTargetsForText(t),a?(e.hasType("bar")&&e.updateTargetsForBar(t),e.hasTypeOf("Line")&&e.updateTargetsForLine(t),e.updateTargetsForSubchart&&e.updateTargetsForSubchart(t)):e.hasArcType(t)&&(n?e.updateTargetsForRadar(t):e.updateTargetsForArc(t)),(e.hasType("bubble")||e.hasType("scatter"))&&e.updateTargetForCircle&&e.updateTargetForCircle(),e.showTargets()},t.prototype.showTargets=function(){var t=this,e=t.config;t.$el.svg.selectAll("."+CLASS.target).filter(function(e){return t.isTargetToShow(e.id)}).transition().duration(e.transition_duration).style("opacity","1")},t.prototype.getWithOption=function(t){var e={Y:!0,Subchart:!0,Transition:!0,EventRect:!0,Dimension:!0,TrimXDomain:!0,Transform:!1,UpdateXDomain:!1,UpdateOrgXDomain:!1,Legend:!1,UpdateXAxis:"UpdateXDomain",TransitionForExit:"Transition",TransitionForAxis:"Transition"};return Object.keys(e).forEach(function(i){var a=e[i];isString(a)&&(a=e[a]),e[i]=getOption(t,"with"+i,a)}),e},t.prototype.initialOpacity=function(t){var e=this.state.withoutFadeIn;return null!==this.getBaseValue(t)&&e[t.id]?"1":"0"},t.prototype.bindResize=function(){var t=this,e=t.config,i=t.state,a=generateResize(),n=[];n.push(function(){return callFn(e.onresize,t,t.api)}),e.resize_auto&&n.push(function(){i.resizing=!0,t.api.flush(!1)}),n.push(function(){callFn(e.onresized,t,t.api),i.resizing=!1}),n.forEach(function(t){return a.add(t)}),t.resizeFunction=a,win.addEventListener("resize",t.resizeFunction=a)},t.prototype.callPluginHook=function(t){for(var e=this,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];this.config.plugins.forEach(function(a){"$beforeInit"===t&&(a.$$=e,e.api.plugins.push(a)),a[t].apply(a,i)})},t}();function loadConfig(t){var e,i,a,n=this.config,r=function(){var t=i.shift();return t&&e&&isObjectType(e)&&t in e?(e=e[t],r()):t?void 0:e};Object.keys(n).forEach(function(s){e=t,i=s.split("_"),a=r(),isDefined(a)&&(n[s]=a)})}extend(ChartInternal.prototype,[dataConvert,data$1,dataLoad,category,classModule,color$1,domain,interaction$1,format,legend$1,redraw,scale,shape,size,text,title$1,tooltip$1,transform,type]);var apiChart={resize:function(t){var e=this.internal,i=e.config,a=e.state;a.rendered&&(i.size_width=t?t.width:null,i.size_height=t?t.height:null,a.resizing=!0,this.flush(!1,!0),e.resizeFunction())},flush:function(t){var e=this.internal,i=e.state;i.rendered?(i.resizing?e.brush&&e.brush.updateResize():e.axis&&e.axis.setOrient(),e.scale.zoom=null,t?e.redraw({withTransform:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withLegend:!0}):e.updateAndRedraw({withLegend:!0,withTransition:!1,withTransitionForTransform:!1}),!i.resizing&&e.brush&&(e.brush.getSelection().call(e.brush.move),e.unselectRect())):e.initToRender(!0)},destroy:function(){var t=this,e=this.internal,i=e.$el,a=i.chart,n=i.svg;if(notEmpty(e))for(var r in e.callPluginHook("$willDestroy"),e.charts.splice(e.charts.indexOf(this),1),n.select("*").interrupt(),e.resizeFunction.clear(),win.removeEventListener("resize",e.resizeFunction),a.classed("bb",!1).html(""),Object.keys(this).forEach(function(i){"internal"===i&&Object.keys(e).forEach(function(t){e[t]=null}),t[i]=null,delete t[i]}),this)this[r]=function(){};return null},config:function(t,e,i){var a,n=this.internal.config,r=t&&t.replace(/\./g,"_");return r in n&&(isDefined(e)?(n[r]=e,a=e,i&&this.flush()):a=n[r]),a}},apiColor={color:function(t){return this.internal.color(t)}};function data$2(t){var e=this.internal.data.targets;if(!isUndefined(t)){var i=isArray(t)?t:[t];return e.filter(function(t){return i.some(function(e){return e===t.id})})}return e}extend(data$2,{shown:function(t){return this.internal.filterTargetsToShow(this.data(t))},values:function(t,e){void 0===e&&(e=!0);var i=null;if(t){var a=this.data(t);a&&isArray(a)&&(i=[],a.forEach(function(t){var a=t.values.map(function(t){return t.value});e?i=i.concat(a):i.push(a)}))}return i},names:function(t){return this.internal.updateDataAttributes("names",t)},colors:function(t){return this.internal.updateDataAttributes("colors",t)},axes:function(t){return this.internal.updateDataAttributes("axes",t)},min:function(){return this.internal.getMinMaxData().min},max:function(){return this.internal.getMinMaxData().max}});var apiData={data:data$2},b64EncodeUnicode=function(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(Number("0x"+e))}))};function nodeToSvgDataUrl(t,e){var i=new XMLSerializer,a=t.cloneNode(!0),n=getCssRules(toArray(doc.styleSheets)).filter(function(t){return t.cssText}).map(function(t){return t.cssText});a.setAttribute("xmlns",namespaces.xhtml);var r=i.serializeToString(a),s=doc.createElement("style");s.appendChild(doc.createTextNode(n.join("\n")));var o=i.serializeToString(s),c=('<svg xmlns="'+namespaces.svg+'" width="'+e.width+'" height="'+e.height+'">\n\t\t\t<foreignObject width="100%" height="100%">\n\t\t\t\t'+o+"\n\t\t\t\t"+r.replace(/(url\()[^#]+/g,"$1")+"\n\t\t\t</foreignObject></svg>").replace("/\n/g","%0A");return"data:image/svg+xml;base64,"+b64EncodeUnicode(c)}var apiExport={export:function(t,e){var i=this,a=this.internal,n=a.state,r=a.$el.chart,s=n.current,o=s.width,c=s.height,l=nodeToSvgDataUrl(r.node(),{width:o,height:c});if(e&&isFunction(e)){var u=new Image;u.crossOrigin="Anonymous",u.onload=function(){var a=doc.createElement("canvas"),n=a.getContext("2d");a.width=o,a.height=c,n.drawImage(u,0,0),e.bind(i)(a.toDataURL(t))},u.src=l}return l}},apiFocus={focus:function(t){var e=this.internal,i=e.state,a=e.mapToTargetIds(t),n=e.$el.svg.selectAll(e.selectorTargets(a.filter(e.isTargetToShow,e)));this.revert(),this.defocus(),n.classed(CLASS.focused,!0).classed(CLASS.defocused,!1),e.hasArcType()&&!i.hasRadar&&(e.expandArc(a),e.hasType("gauge")&&e.markOverlapped(t,e,"."+CLASS.gaugeValue)),e.toggleFocusLegend(a,!0),i.focusedTargetIds=a,i.defocusedTargetIds=i.defocusedTargetIds.filter(function(t){return a.indexOf(t)<0})},defocus:function(t){var e=this.internal,i=e.state,a=e.mapToTargetIds(t);e.$el.svg.selectAll(e.selectorTargets(a.filter(e.isTargetToShow,e))).classed(CLASS.focused,!1).classed(CLASS.defocused,!0),e.hasArcType()&&(e.unexpandArc(a),e.hasType("gauge")&&e.undoMarkOverlapped(e,"."+CLASS.gaugeValue)),e.toggleFocusLegend(a,!1),i.focusedTargetIds=i.focusedTargetIds.filter(function(t){return a.indexOf(t)<0}),i.defocusedTargetIds=a},revert:function(t){var e=this.internal,i=e.config,a=e.state,n=e.$el,r=e.mapToTargetIds(t);n.svg.selectAll(e.selectorTargets(r)).classed(CLASS.focused,!1).classed(CLASS.defocused,!1),e.hasArcType()&&e.unexpandArc(r),i.legend_show&&(e.showLegend(r.filter(e.isLegendToShow.bind(e))),n.legend.selectAll(e.selectorLegends(r)).filter(function(){return select(this).classed(CLASS.legendItemFocused)}).classed(CLASS.legendItemFocused,!1)),a.focusedTargetIds=[],a.defocusedTargetIds=[]}},legend$2={show:function(t){var e=this.internal;e.showLegend(e.mapToTargetIds(t)),e.updateAndRedraw({withLegend:!0})},hide:function(t){var e=this.internal;e.hideLegend(e.mapToTargetIds(t)),e.updateAndRedraw({withLegend:!0})}},apiLegend={legend:legend$2},apiLoad={load:function(t){var e=this.internal,i=e.config;t.xs&&e.addXs(t.xs),"names"in t&&this.data.names(t.names),"classes"in t&&Object.keys(t.classes).forEach(function(e){i.data_classes[e]=t.classes[e]}),"categories"in t&&e.axis.isCategorized()&&(i.axis_x_categories=t.categories),"axes"in t&&Object.keys(t.axes).forEach(function(e){i.data_axes[e]=t.axes[e]}),"colors"in t&&Object.keys(t.colors).forEach(function(e){i.data_colors[e]=t.colors[e]}),"unload"in t&&!1!==t.unload?e.unload(e.mapToTargetIds(!0===t.unload?null:t.unload),function(){return e.loadFromArgs(t)}):e.loadFromArgs(t)},unload:function(t){var e=this,i=this.internal,a=t||{};isArray(a)?a={ids:a}:isString(a)&&(a={ids:[a]});var n=i.mapToTargetIds(a.ids);i.unload(n,function(){i.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),i.cache.remove(n),a.done&&a.done.call(e)})}};function showHide(t,e,i){var a=this.internal,n=a.mapToTargetIds(e);a.state.toggling=!0,a[(t?"remove":"add")+"HiddenTargetIds"](n);var r=a.$el.svg.selectAll(a.selectorTargets(n)),s=t?"1":"0";t&&r.style("display",null),r.transition().style("opacity",s,"important").call(endall,function(){!t&&r.style("display","none"),r.style("opacity",s)}),i.withLegend&&a[(t?"show":"hide")+"Legend"](n),a.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0,withLegend:!0}),a.state.toggling=!1}var apiShow={show:function(t,e){void 0===e&&(e={}),showHide.call(this,!0,t,e)},hide:function(t,e){void 0===e&&(e={}),showHide.call(this,!1,t,e)},toggle:function(t,e){var i=this;void 0===e&&(e={});var a=this.internal,n={show:[],hide:[]};a.mapToTargetIds(t).forEach(function(t){return n[a.isTargetToShow(t)?"hide":"show"].push(t)}),n.show.length&&this.show(n.show,e),n.hide.length&&setTimeout(function(){return i.hide(n.hide,e)},0)}},tooltip$2={show:function(t){var e,i,a=this.internal,n=a.config,r=a.state.inputType;if(t.mouse&&(i=t.mouse),t.data){var s=t.data,o=a.getYScaleById(s.id)(s.value);a.isMultipleX()?i=[a.scale.x(s.x),o]:(n.tooltip_grouped||(i=[0,o]),e=isValue(s.index)?s.index:a.getIndexByX(s.x))}else isDefined(t.x)?e=a.getIndexByX(t.x):isDefined(t.index)&&(e=t.index);("mouse"===r?["mouseover","mousemove"]:["touchstart"]).forEach(function(t){a.dispatchEvent(t,e,i)})},hide:function(){var t=this.internal,e=t.state.inputType,i=t.$el.tooltip,a=i&&i.datum();if(a){var n=JSON.parse(a.current)[0].index;("mouse"===e?["mouseout"]:["touchend"]).forEach(function(e){t.dispatchEvent(e,n)})}"touch"===e&&t.callOverOutForTouch(),t.hideTooltip(!0),t.hideGridFocus(),t.unexpandCircles&&t.unexpandCircles(),t.unexpandBars&&t.unexpandBars()}},apiTooltip={tooltip:tooltip$2},Chart=function(){return function t(e){this.plugins=[];var i=new ChartInternal(this);this.internal=i,function t(e,i,a){Object.keys(e).forEach(function(n){var r=isFunction(e[n]),s=i!==a,o=Object.keys(e[n]).length>0;r&&(!s&&o||s)?i[n]=e[n].bind(a):r||(i[n]={}),o&&t(e[n],i[n],a)})}(t.prototype,this,this),loadConfig.call(i,e),i.beforeInit(),i.init()}}();function setMinMax(t,e,i){var a=t.config,n="axis_x_"+e,r="axis_y_"+e,s="axis_y2_"+e;isDefined(i)&&(isObjectType(i)?(isValue(i.x)&&(a[n]=i.x),isValue(i.y)&&(a[r]=i.y),isValue(i.y2)&&(a[s]=i.y2)):(a[r]=i,a[s]=i),t.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0}))}function getMinMax$1(t,e){var i=t.config;return{x:i["axis_x_"+e],y:i["axis_y_"+e],y2:i["axis_y2_"+e]}}extend(Chart.prototype,[apiChart,apiColor,apiData,apiExport,apiFocus,apiLegend,apiLoad,apiShow,apiTooltip]);var axis={labels:function(t){var e,i=this.internal;return t&&(Object.keys(t).forEach(function(e){i.axis.setLabelText(e,t[e])}),i.axis.updateLabels()),["x","y","y2"].forEach(function(t){var a=i.axis.getLabelText(t);a&&(!e&&(e={}),e[t]=a)}),e},min:function(t){var e=this.internal;return isValue(t)?setMinMax(e,"min",t):getMinMax$1(e,"min")},max:function(t){var e=this.internal;return arguments.length?setMinMax(e,"max",t):getMinMax$1(e,"max")},range:function(t){var e=this.axis;if(!arguments.length)return{max:e.max(),min:e.min()};isDefined(t.max)&&e.max(t.max),isDefined(t.min)&&e.min(t.min)}},apiAxis={axis:axis},apiCategory={category:function(t,e){var i=this.internal,a=i.config;return arguments.length>1&&(a.axis_x_categories[t]=e,i.redraw()),a.axis_x_categories[t]},categories:function(t){var e=this.internal,i=e.config;return arguments.length?(i.axis_x_categories=t,e.redraw(),i.axis_x_categories):i.axis_x_categories}};function xgrids(t){var e=this.internal,i=e.config;return t?(i.grid_x_lines=t,e.redrawWithoutRescale(),i.grid_x_lines):i.grid_x_lines}extend(xgrids,{add:function(t){return this.xgrids(this.internal.config.grid_x_lines.concat(t||[]))},remove:function(t){this.internal.removeGridLines(t,!0)}});var apiXGrid={xgrids:xgrids};function ygrids(t){var e=this.internal,i=e.config;return t?(i.grid_y_lines=t,e.redrawWithoutRescale(),i.grid_y_lines):i.grid_y_lines}extend(ygrids,{add:function(t){return this.ygrids(this.internal.config.grid_y_lines.concat(t||[]))},remove:function(t){this.internal.removeGridLines(t,!1)}});var apiYGrid={ygrids:ygrids},apiGroup={groups:function(t){var e=this.internal,i=e.config;return isUndefined(t)?i.data_groups:(i.data_groups=t,e.redraw(),i.data_groups)}};function regions(t){var e=this.internal,i=e.config;return t?(i.regions=t,e.redrawWithoutRescale(),t):i.regions}extend(regions,{add:function(t){var e=this.internal,i=e.config;return t?(i.regions=i.regions.concat(t),e.redrawWithoutRescale(),i.regions):i.regions},remove:function(t){var e=this.internal,i=e.config,a=t||{},n=getOption(a,"duration",i.transition_duration),r=getOption(a,"classes",[CLASS.region]),s=e.$el.main.select("."+CLASS.regions).selectAll(r.map(function(t){return"."+t}));return(n?s.transition().duration(n):s).style("opacity","0").remove(),s=i.regions,Object.keys(a).length?(s=s.filter(function(t){var e=!1;return!t.class||(t.class.split(" ").forEach(function(t){r.indexOf(t)>=0&&(e=!0)}),!e)}),i.regions=s):i.regions=[],s}});var apiRegion={regions:regions},apiX={x:function(t){var e=this.internal,i=e.axis,a=e.data,n=i.isCustomX()&&i.isCategorized();return isArray(t)&&(n?this.categories(t):(e.updateTargetX(a.targets,t),e.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0}))),n?this.categories():a.xs},xs:function(t){var e=this.internal;return isObject(t)&&(e.updateTargetXs(e.data.targets,t),e.redraw({withUpdateOrgXDomain:!0,withUpdateXDomain:!0})),e.data.xs}},apiFlow={flow:function(t){var e,i,a,n,r=this.internal,s=0,o=0;if((t.json||t.rows||t.columns)&&(e=r.convertData(t)),e&&isTabVisible()){var c=[],l=r.getMaxDataCount(),u=r.convertDataToTargets(e,!0),d=r.axis.isTimeSeries();r.data.targets.forEach(function(t){for(var e=!1,i=0;i<u.length;i++)if(t.id===u[i].id){e=!0,t.values[t.values.length-1]&&(o=t.values[t.values.length-1].index+1),s=u[i].values.length;for(var a=0;a<s;a++)u[i].values[a].index=o+a,d||(u[i].values[a].x=o+a);t.values=t.values.concat(u[i].values),u.splice(i,1);break}!e&&c.push(t.id)}),r.data.targets.forEach(function(t){for(var e=0;e<c.length;e++)if(t.id===c[e]){o=t.values[t.values.length-1].index+1;for(var i=0;i<s;i++)t.values.push({id:t.id,index:o+i,x:d?r.getOtherTargetX(o+i):o+i,value:null})}}),r.data.targets.length&&u.forEach(function(t){for(var e=[],i=r.data.targets[0].values[0].index;i<o;i++)e.push({id:t.id,index:i,x:d?r.getOtherTargetX(i):i,value:null});t.values.forEach(function(t){t.index+=o,d||(t.x+=o)}),t.values=e.concat(t.values)}),r.data.targets=r.data.targets.concat(u);var h=r.data.targets[0],g=h.values[0];isDefined(t.to)?(s=0,n=d?parseDate.call(r,t.to):t.to,h.values.forEach(function(t){t.x<n&&s++})):isDefined(t.length)&&(s=t.length),l?1===l&&d&&(a=(h.values[h.values.length-1].x-g.x)/2,i=[new Date(+g.x-a),new Date(+g.x+a)]):(a=d?h.values.length>1?h.values[h.values.length-1].x-g.x:g.x-r.getXDomain(r.data.targets)[0]:1,i=[g.x-a,g.x]),i&&r.updateXDomain(null,!0,!0,!1,i),r.updateTargets(r.data.targets),r.redraw({flow:{index:g.index,length:s,duration:isValue(t.duration)?t.duration:r.config.transition_duration,done:t.done,orgDataCount:l},withLegend:!0,withTransition:l>1,withTrimXDomain:!1,withUpdateXAxis:!0})}}},AxisRendererHelper=function(){function t(t){var e=getScale(),i=t.config,a=t.params;this.owner=t,this.config=i,this.scale=e,!i.noTransition&&a.config.transition_duration||(i.withoutTransition=!0),i.range=this.scaleExtent((a.orgXScale||e).range())}return t.getSizeFor1Char=function(t){var e={w:5.5,h:11.5};return!t.empty()&&t.select("text").text("0").call(function(t){try{var i=t.node().getBBox(),a=i.width,n=i.height;a&&n&&(e.w=a,e.h=n)}catch(t){}finally{t.text("")}}),this.getSizeFor1Char=function(){return e},e},t.prototype.getTickTransformSetter=function(t){var e=this.config,i="x"===t?function(t){return"translate("+(t+e.tickOffset)+",0)"}:function(t){return"translate(0,"+t+")"};return function(t,e){t.attr("transform",function(t){return i(Math.ceil(e(t)))})}},t.prototype.scaleExtent=function(t){var e=t[0],i=t[t.length-1];return e<i?[e,i]:[i,e]},t.prototype.generateTicks=function(t,e){var i=this.owner.params.tickStepSize,a=t.domain(),n=a[0],r=a[1],s=[];if(e&&i)for(var o=n;o<=r;)s.push(o),o+=i;else if(t.ticks){var c=this.config.tickArguments;if("log"!==t.type||c)s=t.ticks.apply(t,this.config.tickArguments||[]);else{var l=getScale("_log").domain([n>0?n:1,r]).range(t.range());s=l.ticks();for(var u=r.toFixed().length;s.length>15;u--)s=l.ticks(u);s.splice(0,1,n),s.splice(s.length-1,1,r)}s=s.map(function(t){return isString(t)&&isNumber(t)&&!isNaN(t)&&Math.round(10*t)/10||t})}else{for(var d=Math.ceil(n);d<r;d++)s.push(d);s.length>0&&s[0]>0&&s.unshift(s[0]-(s[1]-s[0]))}return s},t.prototype.copyScale=function(){var t=this.scale.copy();return t.domain().length||t.domain(this.scale.domain()),t.type=this.scale.type,t},t.prototype.textFormatted=function(t){var e=this.config.tickFormat,i=/\d+\.\d+0{5,}\d$/.test(t)?+String(t).replace(/0+\d$/,""):t,a=e?e(i):i;return isDefined(a)?a:""},t.prototype.transitionise=function(t){var e=this.config;return e.withoutTransition?t.interrupt():t.transition(e.transition)},t}(),AxisRenderer=function(){function t(t){void 0===t&&(t={});var e={innerTickSize:6,outerTickSize:t.outerTick?6:0,orient:"bottom",range:[],tickArguments:null,tickCentered:null,tickCulling:!0,tickFormat:null,tickLength:9,tickOffset:0,tickPadding:3,tickValues:null,transition:null,noTransition:t.noTransition};e.tickLength=Math.max(e.innerTickSize,0)+e.tickPadding,this.config=e,this.params=t,this.helper=new AxisRendererHelper(this)}return t.prototype.create=function(t){var e=this,i=this.config,a=this.helper,n=this.params,r=a.scale,s=i.orient,o=this.splitTickText.bind(this),c=/^(left|right)$/.test(s),l=/^(top|bottom)$/.test(s),u=a.getTickTransformSetter(l?"x":"y"),d=u===a.axisX?"y":"x",h=/^(top|left)$/.test(s)?-1:1,g=n.tickTextRotate;this.config.range=r.rangeExtent?r.rangeExtent():a.scaleExtent((n.orgXScale||r).range());var f,p=i.innerTickSize,x=i.tickLength,v=i.range,m=n.id,_=m&&/^(x|y|y2)$/.test(m)?n.config["axis_"+m+"_tick_text_position"]:{x:0,y:0},y="subX"===m?"subchart_axis_x":"axis_"+m,b=n.config[y+"_show"],T=!!b&&n.config[y+"_tick_show"],S=!!b&&n.config[y+"_tick_text_show"];t.each(function(){var t=select(this),m=this.__chart__||r,y=a.copyScale();f=t,this.__chart__=y,i.tickOffset=n.isCategory?Math.ceil((y(1)-y(0))/2):0;var b,A=t.selectAll(".domain").data([0]);if(A.enter().append("path").attr("class","domain").merge(a.transitionise(A)).attr("d",function(){var t=i.outerTickSize*h;return l?"M"+v[0]+","+t+"V0H"+v[1]+"V"+t:"M"+t+","+v[0]+"H0V"+v[1]+"H"+t}),T||S){var L=i.tickValues||a.generateTicks(y,c),C=t.selectAll(".tick").data(L,y),w=C.enter().insert("g",".domain").attr("class","tick").style("opacity","1"),E=C.exit().remove();C=w.merge(C),T&&w.append("line"),S&&w.append("text");var R=AxisRendererHelper.getSizeFor1Char(C),k=[],O=C.select("text").selectAll("tspan").data(function(t,e){var i=n.tickMultiline?o(t,y,L,c,R.w):isArray(a.textFormatted(t))?a.textFormatted(t).concat():[a.textFormatted(t)];return k[e]=i.length,i.map(function(t){return{index:e,splitted:t}})});O.exit().remove(),(O=O.enter().append("tspan").merge(O).text(function(t){return t.splitted})).attr("x",l?0:x*h).attr("dx",(b=0,/(top|bottom)/.test(s)&&g&&(b=8*Math.sin(Math.PI*(g/180))*("top"===s?-1:1)),b+(_.x||0))).attr("dy",function(t,e){var i=0;return"top"!==s&&(i=R.h,0===e&&(i=c?-((k[t.index]-1)*(R.h/2)-3):0===_.y?".71em":0)),isNumber(i)&&_.y?i+_.y:i||".71em"});var D=C.select("line"),P=C.select("text");if(w.select("line").attr(d+"2",p*h),w.select("text").attr(d,x*h),e.setTickLineTextPosition(D,P),n.tickTitle){var F=P.select("title");(F.empty()?P.append("title"):F).text(function(t){return n.tickTitle[t]})}if(y.bandwidth){var I=y,M=I.bandwidth()/2;y=m=function(t){return I(t)+M}}else m.bandwidth?m=y:u(E,y);u(w,m),u(a.transitionise(C).style("opacity","1"),y)}}),this.g=f},t.prototype.getTickXY=function(){var t=this.config,e={x:0,y:0};return this.params.isCategory&&(e.x=t.tickCentered?0:t.tickOffset,e.y=t.tickCentered?t.tickOffset:0),e},t.prototype.getTickSize=function(t){var e=this.helper.scale,i=this.config,a=i.innerTickSize,n=i.range,r=e(t)+(i.tickCentered?0:i.tickOffset);return n[0]<r&&r<n[1]?a:0},t.prototype.setTickLineTextPosition=function(t,e){var i=this.getTickXY(),a=this.config,n=a.innerTickSize,r=a.orient,s=a.tickLength,o=a.tickOffset,c=this.params.tickTextRotate,l=function(t){var e=["start","end"];return"top"===r&&e.reverse(),t?t>0?e[0]:e[1]:"middle"},u=function(t){return t?"rotate("+t+")":null},d=function(t){return t?11.5-2.5*(t/("bottom"===r?15:23))*(t>0?1:-1):s};switch(r){case"bottom":t.attr("x1",i.x).attr("x2",i.x).attr("y2",this.getTickSize.bind(this)),e.attr("x",0).attr("y",d(c)).style("text-anchor",l(c)).attr("transform",u(c));break;case"top":t.attr("x2",0).attr("y2",-n),e.attr("x",0).attr("y",2*-d(c)).style("text-anchor",l(c)).attr("transform",u(c));break;case"left":t.attr("x2",-n).attr("y1",i.y).attr("y2",i.y),e.attr("x",-s).attr("y",o).style("text-anchor","end");break;case"right":t.attr("x2",n).attr("y2",0),e.attr("x",s).attr("y",0).style("text-anchor","start")}},t.prototype.splitTickText=function(t,e,i,a,n){var r=this.params,s=this.helper.textFormatted(t),o=isString(s)&&s.indexOf("\n")>-1?s.split("\n"):[];if(o.length)return o;if(isArray(s))return s;var c=r.tickWidth;return(!c||c<=0)&&(c=a?95:r.isCategory?Math.ceil(e(i[1])-e(i[0]))-12:110),function t(e,i){for(var a,r,s,o=1;o<i.length;o++)if(" "===i.charAt(o)&&(r=o),a=i.substr(0,o+1),s=n*a.length,c<s)return t(e.concat(i.substr(0,r||o)),i.slice(r?r+1:o));return e.concat(i)}(o,String(s))},t.prototype.scale=function(t){return arguments.length?(this.helper.scale=t,this):this.helper.scale},t.prototype.orient=function(t){return arguments.length?(this.config.orient=t in{top:1,right:1,bottom:1,left:1}?String(t):"bottom",this):this.config.orient},t.prototype.tickFormat=function(t){var e=this.config;return arguments.length?(e.tickFormat=t,this):e.tickFormat},t.prototype.tickCentered=function(t){var e=this.config;return arguments.length?(e.tickCentered=t,this):e.tickCentered},t.prototype.tickOffset=function(){return this.config.tickOffset},t.prototype.tickInterval=function(t){var e,i=this;if(this.params.isCategory)e=2*this.config.tickOffset;else{e=(this.g.select("path.domain").node().getTotalLength()-2*this.config.outerTickSize)/(t||this.g.selectAll("line").size());var a=this.config.tickValues.map(function(t,e,a){var n=e+1;return n<a.length?i.helper.scale(a[n])-i.helper.scale(t):null}).filter(Boolean);e=Math.min.apply(Math,__spreadArrays(a,[e]))}return e===1/0?0:e},t.prototype.ticks=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.config;return t.length?(i.tickArguments=toArray(t),this):i.tickArguments},t.prototype.tickCulling=function(t){var e=this.config;return arguments.length?(e.tickCulling=t,this):e.tickCulling},t.prototype.tickValues=function(t){var e=this,i=this.config;if(isFunction(t))i.tickValues=function(){return t(e.helper.scale.domain())};else{if(!arguments.length)return i.tickValues;i.tickValues=t}return this},t.prototype.setTransition=function(t){return this.config.transition=t,this},t}(),axis$1={getAxisInstance:function(){return this.axis||new Axis(this)}},Axis=function(){function t(t){this.axesList={},this.tick={x:null,y:null,y2:null},this.xs=[],this.orient={x:"bottom",y:"left",y2:"right",subX:"bottom"},this.owner=t,this.setOrient()}return t.prototype.getAxisClassName=function(t){return CLASS.axis+" "+CLASS["axis"+capitalize(t)]},t.prototype.isHorizontal=function(t,e){var i=t.config.axis_rotated;return e?i:!i},t.prototype.isCategorized=function(){var t=this.owner,e=t.config,i=t.state;return e.axis_x_type.indexOf("category")>=0||i.hasRadar},t.prototype.isCustomX=function(){var t=this.owner.config;return!this.isTimeSeries()&&(t.data_x||notEmpty(t.data_xs))},t.prototype.isTimeSeries=function(t){return void 0===t&&(t="x"),"timeseries"===this.owner.config["axis_"+t+"_type"]},t.prototype.isLog=function(t){return void 0===t&&(t="x"),"log"===this.owner.config["axis_"+t+"_type"]},t.prototype.isTimeSeriesY=function(){return this.isTimeSeries("y")},t.prototype.getAxisType=function(t){void 0===t&&(t="x");var e="linear";return this.isTimeSeries(t)?e="time":this.isLog(t)&&(e="log"),e},t.prototype.init=function(){var t=this,e=this.owner,i=e.config,a=e.$el,n=a.main,r=a.axis,s=e.state.clip,o=i.axis_rotated,c=["x","y"];i.axis_y2_show&&c.push("y2"),c.forEach(function(a){var c=t.getAxisClassName(a),l=CLASS["axis"+a.toUpperCase()+"Label"];r[a]=n.append("g").attr("class",c).attr("clip-path",function(){var t=null;return"x"===a?t=s.pathXAxis:"y"===a&&(t=s.pathYAxis),t}).attr("transform",e.getTranslate(a)).style("visibility",i["axis_"+a+"_show"]?"visible":"hidden"),r[a].append("text").attr("class",l).attr("transform",["rotate(-90)",null]["x"===a?+!o:+o]).style("text-anchor",function(){return t.textAnchorForAxisLabel(a)}),t.generateAxes(a)})},t.prototype.setOrient=function(){var t=this.owner.config,e=t.axis_rotated,i=t.axis_y_inner,a=t.axis_y2_inner;this.orient={x:e?"left":"bottom",y:e?i?"top":"bottom":i?"right":"left",y2:e?a?"bottom":"top":a?"left":"right",subX:e?"left":"bottom"}},t.prototype.generateAxes=function(t){var e,i=this.owner,a=i.config,n=[],r=a["axis_"+t+"_axes"],s=a.axis_rotated;"x"===t?e=s?axisLeft:axisBottom:"y"===t?e=s?axisBottom:axisLeft:"y2"===t&&(e=s?axisTop:axisRight),r.length&&r.forEach(function(a){var r=a.tick||{},s=i.scale[t].copy();a.domain&&s.domain(a.domain),n.push(e(s).ticks(r.count).tickFormat(isFunction(r.format)?r.format.bind(i.api):function(t){return t}).tickValues(r.values).tickSizeOuter(!1===r.outer?0:6))}),this.axesList[t]=n},t.prototype.updateAxes=function(){var t=this,e=this.owner,i=e.config,a=e.$el.main;Object.keys(this.axesList).forEach(function(n){var r=i["axis_"+n+"_axes"],s=e.scale[n].copy(),o=s.range();t.axesList[n].forEach(function(c,l){var u=c.scale().range();o.every(function(t,e){return t===u[e]})||c.scale().range(o);var d=t.getAxisClassName(n)+"-"+(l+1),h=a.select("."+d.replace(/\s/,"."));h.empty()?h=a.append("g").attr("class",d).style("visibility",i["axis_"+n+"_show"]?"visible":"hidden").call(c):(r[l].domain&&s.domain(r[l].domain),t.x.helper.transitionise(h).call(c.scale(s))),h.attr("transform",e.getTranslate(n,l+1))})})},t.prototype.setAxis=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];"subX"!==t&&(this.tick[t]=this.getTickValues(t)),this[t]=this.getAxis.apply(this,__spreadArrays([t],e))},t.prototype.getAxis=function(t,e,i,a,n){var r,s=this.owner,o=s.config,c=/^(x|subX)$/.test(t),l=c?"x":t,u=c&&this.isCategorized(),d=this.orient[t],h=n?0:s.getAxisTickRotate(l);if(c)r=s.format.xAxisTick;else{var g=o["axis_"+t+"_tick_format"];isFunction(g)&&(r=g.bind(s.api))}var f=this.tick[l],p=mergeObj({outerTick:i,noTransition:a,config:o,id:t,tickTextRotate:h},c&&{isCategory:u,tickMultiline:o.axis_x_tick_multiline,tickWidth:o.axis_x_tick_width,tickTitle:u&&o.axis_x_tick_tooltip&&s.api.categories(),orgXScale:s.scale.x});c||(p.tickStepSize=o["axis_"+l+"_tick_stepSize"]);var x=new AxisRenderer(p).scale(c&&s.scale.zoom||e).orient(d);if(c&&this.isTimeSeries()&&f&&!isFunction(f)){var v=parseDate.bind(s);f=f.map(function(t){return v(t)})}else!c&&this.isTimeSeriesY()&&(x.ticks(o.axis_y_tick_time_value),f=null);f&&x.tickValues(f),x.tickFormat(r||!c&&s.isStackNormalized()&&function(t){return t+"%"}),u&&(x.tickCentered(o.axis_x_tick_centered),isEmpty(o.axis_x_tick_culling)&&(o.axis_x_tick_culling=!1));var m=o["axis_"+l+"_tick_count"];return m&&x.ticks(m),x},t.prototype.updateXAxisTickValues=function(t,e){var i,a=this.owner,n=a.config,r=n.axis_x_tick_fit,s=n.axis_x_tick_count;return(r||s&&r)&&(i=a.mapTargetsToUniqueXs(t),this.isCategorized()&&s>i.length&&(s=i.length),i=this.generateTickValues(i,s,this.isTimeSeries())),e?e.tickValues(i):this.x&&(this.x.tickValues(i),this.subX&&this.subX.tickValues(i)),i},t.prototype.getId=function(t){var e=this.owner,i=e.config,a=e.scale,n=i.data_axes[t];return n&&a[n]||(n="y"),n},t.prototype.getXAxisTickFormat=function(){var t,e=this.owner,i=e.config,a=e.format,n=i.axis_x_tick_format,r=this.isTimeSeries(),s=this.isCategorized();return n?isFunction(n)?t=n.bind(e.api):r&&(t=function(t){return t?a.axisTime(n)(t):""}):t=r?a.defaultAxisTime:s?e.categoryName:function(t){return t<0?t.toFixed(0):t},isFunction(t)?function(i){return t.apply(e,s?[i,e.categoryName(i)]:[i])}:t},t.prototype.getTickValues=function(t){var e=this.owner,i=e.config["axis_"+t+"_tick_values"],a=e[t+"Axis"];return(isFunction(i)?i.call(e.api):i)||(a?a.tickValues():void 0)},t.prototype.getLabelOptionByAxisId=function(t){return this.owner.config["axis_"+t+"_label"]},t.prototype.getLabelText=function(t){var e=this.getLabelOptionByAxisId(t);return isString(e)?e:e?e.text:null},t.prototype.setLabelText=function(t,e){var i=this.owner.config,a=this.getLabelOptionByAxisId(t);isString(a)?i["axis_"+t+"_label"]=e:a&&(a.text=e)},t.prototype.getLabelPosition=function(t,e){var i=this.owner.config.axis_rotated,a=this.getLabelOptionByAxisId(t),n=isObjectType(a)&&a.position?a.position:e[+!i],r=function(t){return!!~n.indexOf(t)};return{isInner:r("inner"),isOuter:r("outer"),isLeft:r("left"),isCenter:r("center"),isRight:r("right"),isTop:r("top"),isMiddle:r("middle"),isBottom:r("bottom")}},t.prototype.getAxisLabelPosition=function(t){return this.getLabelPosition(t,"x"===t?["inner-top","inner-right"]:["inner-right","inner-top"])},t.prototype.getLabelPositionById=function(t){return this.getAxisLabelPosition(t)},t.prototype.xForAxisLabel=function(t){var e=this.owner,i=e.state,a=i.width,n=i.height,r=this.getAxisLabelPosition(t),s=r.isMiddle?-n/2:0;return this.isHorizontal(e,"x"!==t)?s=r.isLeft?0:r.isCenter?a/2:a:r.isBottom&&(s=-n),s},t.prototype.dxForAxisLabel=function(t){var e=this.owner,i=this.getAxisLabelPosition(t),a=i.isBottom?"0.5em":"0";return this.isHorizontal(e,"x"!==t)?a=i.isLeft?"0.5em":i.isRight?"-0.5em":"0":i.isTop&&(a="-0.5em"),a},t.prototype.textAnchorForAxisLabel=function(t){var e=this.owner,i=this.getAxisLabelPosition(t),a=i.isMiddle?"middle":"end";return this.isHorizontal(e,"x"!==t)?a=i.isLeft?"start":i.isCenter?"middle":"end":i.isBottom&&(a="start"),a},t.prototype.dyForAxisLabel=function(t){var e,i=this.owner,a=i.config,n=a.axis_rotated,r=this.getAxisLabelPosition(t).isInner,s=a["axis_"+t+"_tick_rotate"]?i.getHorizontalAxisHeight(t):0,o=this.getMaxTickWidth(t);if("x"===t){var c=a.axis_x_height;e=n?r?"1.2em":-25-o:r?"-0.5em":c?c-10:s?s-10:"3em"}else e={y:["-0.5em",10,"3em","1.2em",10],y2:["1.2em",-20,"-2.2em","-0.5em",15]}[t],e=n?r?e[0]:s?s*("y2"===t?-1:1)-e[1]:e[2]:r?e[3]:(e[4]+(a["axis_"+t+"_inner"]?0:o+e[4]))*("y"===t?-1:1);return e},t.prototype.getMaxTickWidth=function(t,e){var i=this.owner,a=i.config,n=i.state.current,r=i.$el,s=r.svg,o=r.chart,c=n.maxTickWidths[t],l=0;if(e||!a["axis_"+t+"_show"]||0===i.filterTargetsToShow().length)return c.size;if(s){var u=/^y2?$/.test(t),d=i.filterTargetsToShow(i.data.targets),h=i.scale[t].copy().domain(i["get"+(u?"Y":"X")+"Domain"](d,t)),g=h.domain(),f=g[0]===g[1]&&g.every(function(t){return t>0}),p=isArray(c.domain)&&c.domain[0]===c.domain[1]&&c.domain.every(function(t){return t>0});if(f||p)return c.size;c.domain=g,u||c.ticks.splice(0);var x=this.getAxis(t,h,!1,!1,!0),v=a["axis_"+t+"_tick_count"];!a["axis_"+t+"_tick_values"]&&v&&x.tickValues(this.generateTickValues(g,v,u?this.isTimeSeriesY():this.isTimeSeries())),!u&&this.updateXAxisTickValues(d,x);var m=o.append("svg").style("visibility","hidden").style("position","fixed").style("top","0px").style("left","0px");x.create(m),m.selectAll("text").each(function(t,e){var i=this.getBoundingClientRect().width;l=Math.max(l,i),u||(c.ticks[e]=i)}),m.remove()}return l>0&&(c.size=l),c.size},t.prototype.getXAxisTickTextY2Overflow=function(t){var e=this.owner,i=e.axis,a=e.config,n=e.state,r=e.getAxisTickRotate("x"),s=r>0&&r<90;if((i.isCategorized()||i.isTimeSeries())&&a.axis_x_tick_fit&&!a.axis_x_tick_culling&&!a.axis_x_tick_multiline&&s){var o=n.current.width-e.getCurrentPaddingLeft(),c=this.getXAxisTickMaxOverflow(r,o-t),l=Math.max(0,c)+t;return Math.min(l,o/2)}return 0},t.prototype.getXAxisTickMaxOverflow=function(t,e){for(var i=this.owner,a=i.axis,n=i.config,r=i.state,s=a.isTimeSeries(),o=r.current.maxTickWidths.x.ticks,c=o.length,l=r.axis.x.padding,u=l.left,d=l.right,h=0,g=c-(s&&n.axis_x_tick_fit?.5:0),f=0;f<c;f++){var p=f+1,x=Math.cos(Math.PI*t/180)*o[f],v=p-(s?1:.5)+u;if(!(v<=0)){var m=(e-x)/v,_=x-m/2-((g-p)*m+d*m);h=Math.max(h,_)}}var y=i.filterTargetsToShow(i.data.targets),b=0;if(!s&&n.axis_x_tick_count<=y.length&&y[0].values.length){var T=getScale(i.axis.getAxisType("x"),0,e-h).domain([-1*u,i.getXDomainMax(i.data.targets)+1+d]);b=Math.ceil((T(1)-T(0))/2)}return h+b},t.prototype.getXAxisPadding=function(t){var e=this.owner,i=e.config.axis_x_padding;if(isEmpty(i)?i={left:0,right:0}:(i.left=i.left||0,i.right=i.right||0),e.axis.isTimeSeries()){var a=+e.getXDomainMin(e.data.targets),n=+e.getXDomainMax(e.data.targets)-a,r=n+i.left+i.right,s=0,o=0;if(t&&r){var c=n/t/r;s=i.left/r/c,o=i.right/r/c}i={left:s,right:o}}return i},t.prototype.updateLabels=function(t){var e=this,i=this.owner.$el.main,a={x:i.select("."+CLASS.axisX+" ."+CLASS.axisXLabel),y:i.select("."+CLASS.axisY+" ."+CLASS.axisYLabel),y2:i.select("."+CLASS.axisY2+" ."+CLASS.axisY2Label)};Object.keys(a).filter(function(t){return!a[t].empty()}).forEach(function(i){var n=a[i];(t?n.transition():n).attr("x",function(){return e.xForAxisLabel(i)}).attr("dx",function(){return e.dxForAxisLabel(i)}).attr("dy",function(){return e.dyForAxisLabel(i)}).text(function(){return e.getLabelText(i)})})},t.prototype.getPadding=function(t,e,i,a){var n=isNumber(t)?t:t[e];return isValue(n)?this.convertPixelsToAxisPadding(n,a):i},t.prototype.convertPixelsToAxisPadding=function(t,e){var i=this.owner,a=i.config,n=i.state,r=n.width,s=n.height;return e*(t/(a.axis_rotated?r:s))},t.prototype.generateTickValues=function(t,e,i){var a=t;if(e){var n=isFunction(e)?e():e;if(1===n)a=[t[0]];else if(2===n)a=[t[0],t[t.length-1]];else if(n>2){var r=this.isCategorized(),s=n-2,o=t[0],c=t[t.length-1],l=(c-o)/(s+1),u=void 0;a=[o];for(var d=0;d<s;d++)u=+o+l*(d+1),a.push(i?new Date(u):r?Math.round(u):u);a.push(c)}}return i||(a=a.sort(function(t,e){return t-e})),a},t.prototype.generateTransitions=function(t){var e=this.owner.$el.axis,i=["x","y","y2","subX"].map(function(i){var a=e[i];return a&&t&&(a=a.transition().duration(t)),a});return{axisX:i[0],axisY:i[1],axisY2:i[2],axisSubX:i[3]}},t.prototype.redraw=function(t,e,i){var a=this,n=this.owner,r=n.config,s=n.$el,o=e?"0":"1";["x","y","y2","subX"].forEach(function(e){var n=a[e],c=s.axis[e];n&&c&&(i||(n.config.withoutTransition=!r.transition_duration),c.style("opacity",o),n.create(t["axis"+capitalize(e)]))}),this.updateAxes()},t.prototype.redrawAxis=function(t,e,i,a,n){var r,s=this,o=this.owner,c=o.config,l=o.scale,u=o.$el,d=!!l.zoom;!d&&this.isCategorized()&&0===t.length&&l.x.domain([0,u.axis.x.selectAll(".tick").size()]),l.x&&t.length?(!d&&o.updateXDomain(t,e.UpdateXDomain,e.UpdateOrgXDomain,e.TrimXDomain),c.axis_x_tick_values||this.updateXAxisTickValues(t)):this.x&&(this.x.tickValues([]),this.subX&&this.subX.tickValues([])),c.zoom_rescale&&!a&&(r=l.x.orgDomain()),["y","y2"].forEach(function(e){var i=l[e];if(i){var a=c["axis_"+e+"_tick_values"],n=c["axis_"+e+"_tick_count"];if(i.domain(o.getYDomain(t,e,r)),!a&&n){var u=o.axis[e],d=i.domain();u.tickValues(s.generateTickValues(d,d.every(function(t){return 0===t})?1:n,s.isTimeSeriesY()))}}}),this.redraw(i,o.hasArcType(),n),this.updateLabels(e.Transition),(e.UpdateXDomain||e.UpdateXAxis||e.Y)&&t.length&&this.setCulling(),e.Y&&(l.subY&&l.subY.domain(o.getYDomain(t,"y")),l.subY2&&l.subY2.domain(o.getYDomain(t,"y2")))},t.prototype.setCulling=function(){var t=this.owner,e=t.config,i=t.state,a=i.clip,n=i.current,r=t.$el;["subX","x","y","y2"].forEach(function(t){var i=r.axis[t],s="subX"===t?"x":t,o=e["axis_"+s+"_tick_culling"];if(i&&o){var c,l=i.selectAll(".tick text"),u=sortValue(l.data()),d=u.length,h=e["axis_"+s+"_tick_culling_max"];if(d){for(var g=1;g<d;g++)if(d/g<h){c=g;break}l.each(function(t){this.style.display=u.indexOf(t)%c?"none":"block"})}else l.style("display","block");if("x"===t){var f=n.maxTickWidths.x.clipPath?a.pathXAxisTickTexts:null;r.svg.selectAll("."+CLASS.axisX+" .tick text").attr("clip-path",f)}}})},t}(),eventrect={initEventRect:function(){this.$el.main.select("."+CLASS.chart).append("g").attr("class",CLASS.eventRects).style("fill-opacity","0")},redrawEventRect:function(){var t=this,e=t.config,i=t.state,a=t.$el,n=t.isMultipleX();if(a.eventRect)t.updateEventRect(a.eventRect,!0);else{var r=t.$el.main.select("."+CLASS.eventRects).style("cursor",e.zoom_enabled&&"drag"!==e.zoom_type?e.axis_rotated?"ns-resize":"ew-resize":null).classed(CLASS.eventRectsMultiple,n).classed(CLASS.eventRectsSingle,!n).selectAll("."+CLASS.eventRect).data([0]).enter().append("rect");t.updateEventRect(r),n?t.generateEventRectsForMultipleXs(r):t.generateEventRectsForSingleX(r),r.call(t.getDraggableSelection()),a.eventRect=r,"touch"!==t.state.inputType||a.svg.on("touchstart.eventRect")||t.hasArcType()||t.bindTouchOnEventRect(n)}if(!n){var s=t.getMaxDataCountTarget();t.updateDataIndexByX(s),t.updateXs(s),t.updatePointClass&&t.updatePointClass(!0),i.eventReceiver.data=s}t.updateEventRectData()},bindTouchOnEventRect:function(t){var e,i=this,a=i.config,n=i.state,r=i.$el,s=r.eventRect,o=r.svg,c=function(){i.unselectRect(),i.callOverOutForTouch()},l=a.interaction_inputType_touch.preventDefault,u=isboolean(l)&&l||!1,d=!isNaN(l)&&l||null;s.on("touchstart",function(){return i.updateEventRect()}).on("touchstart.eventRect touchmove.eventRect",function(){var r=event;if(!s.empty()&&s.classed(CLASS.eventRect)){if(n.dragging||n.flowing||i.hasArcType()||r.touches.length>1)return;!function(t){var i=t.type,n=t.changedTouches[0]["client"+(a.axis_rotated?"Y":"X")];"touchstart"===i?u?t.preventDefault():null!==d&&(e=n):"touchmove"===i&&(u||!0===e||null!==d&&Math.abs(e-n)>=d)&&(e=!0,t.preventDefault())}(r),function(e){if(t)i.selectRectForMultipleXs(e);else{var a=i.getDataIndexFromEvent(event);i.callOverOutForTouch(a),-1===a?i.unselectRect():i.selectRectForSingle(e,s,a)}}(s.node())}else c()},!0).on("touchend.eventRect",function(){!s.empty()&&s.classed(CLASS.eventRect)&&(i.hasArcType()||!i.toggleShape||n.cancelClick)&&n.cancelClick&&(n.cancelClick=!1)},!0),o.on("touchstart",function(){var t=event.target;t&&t!==s.node()&&c()})},updateEventRect:function(t,e){void 0===e&&(e=!1);var i=this.state,a=this.$el,n=i.eventReceiver,r=i.width,s=i.height,o=i.rendered,c=i.resizing,l=t||a.eventRect;(!o||c||e)&&(l.attr("x",0).attr("y",0).attr("width",r).attr("height",s),o||l.attr("class",CLASS.eventRect)),n&&(n.rect=l.node().getBoundingClientRect())},updateEventRectData:function(){var t,e,i,a,n=this,r=n.config,s=n.scale,o=n.state,c=s.zoom||s.x,l=r.axis_rotated;if(n.isMultipleX())t=0,e=0,i=o.width,a=o.height;else{var u,d=void 0;if(n.axis.isCategorized())u=n.getEventRectWidth(),d=function(t){return c(t.x)-u/2};else{var h=function(t){var e=t.index;return{prev:n.getPrevX(e),next:n.getNextX(e)}};u=function(t){var e=h(t);return null===e.prev&&null===e.next?l?o.height:o.width:(null===e.prev&&(e.prev=c.domain()[0]),null===e.next&&(e.next=c.domain()[1]),Math.max(0,(c(e.next)-c(e.prev))/2))},d=function(t){var e=h(t),i=t.x;return null===e.prev&&null===e.next?0:(null===e.prev&&(e.prev=c.domain()[0]),(c(i)+c(e.prev))/2)}}t=l?0:d,e=l?d:0,i=l?o.width:u,a=l?u:o.height}var g=o.eventReceiver,f=function(t,e){return isFunction(t)?t(e):t};g.coords.splice(g.data.length),g.data.forEach(function(n,r){g.coords[r]={x:f(t,n),y:f(e,n),w:f(i,n),h:f(a,n)}})},selectRectForMultipleXs:function(t){var e=this,i=e.config,a=e.state,n=e.filterTargetsToShow(e.data.targets);if(!a.dragging&&!e.hasArcType(n)){var r=mouse(t),s=e.findClosestFromTargets(n,r);if(!a.mouseover||s&&s.id===a.mouseover.id||(i.data_onout.call(e.api,a.mouseover),a.mouseover=void 0),s){var o=(e.isBubbleType(s)||e.isScatterType(s)||!i.tooltip_grouped?[s]:e.filterByX(n,s.x)).map(function(t){return e.addName(t)});e.showTooltip(o,t),e.expandCirclesBars(s.index,s.id,!0),e.showGridFocus(o),(e.isBarType(s.id)||e.dist(s,r)<i.point_sensitivity)&&(e.$el.svg.select("."+CLASS.eventRect).style("cursor","pointer"),a.mouseover||(i.data_onover.call(e.api,s),a.mouseover=s))}else e.unselectRect()}},unselectRect:function(){var t=this,e=t.config,i=t.$el,a=i.bar,n=i.circle,r=i.tooltip;t.$el.svg.select("."+CLASS.eventRect).style("cursor",null),t.hideGridFocus(),r&&(t.hideTooltip(),t._handleLinkedCharts(!1)),n&&!e.point_focus_only&&t.unexpandCircles(),a&&t.unexpandBars()},generateEventRectsForSingleX:function(t){var e=this,i=e.config,a=e.state,n=a.eventReceiver,r=t.style("cursor",i.data_selection_enabled&&i.data_selection_grouped?"pointer":null).on("click",function(){var t=n.currentIdx,i=n.data[-1===t?e.getDataIndexFromEvent(event):t];e.clickHandlerForSingleX.bind(this)(i,e)});if("mouse"===a.inputType){r.on("mouseover",function(){return e.updateEventRect()}).on("mousemove",function(){var t=function(){var t=event?e.getDataIndexFromEvent(event):n.currentIdx;return t>-1?n.data[t]:null}();if(!(a.dragging||a.flowing||e.hasArcType()||!t||i.tooltip_grouped&&t&&t.index===n.currentIdx)){var s=t.index;e.isStepType(t)&&"step-after"===i.line_step_type&&mouse(this)[0]<e.scale.x(e.getXValue(t.id,s))&&(s-=1),s!==n.currentIdx&&(e.setOverOut(!1,n.currentIdx),n.currentIdx=s),-1===s?e.unselectRect():e.selectRectForSingle(this,r,s),e.setOverOut(-1!==s,s)}}).on("mouseout",function(){i&&!e.hasArcType()&&-1!==n.currentIdx&&(e.unselectRect(),e.setOverOut(!1,n.currentIdx),n.currentIdx=-1)})}return r},clickHandlerForSingleX:function(t,e){var i=e,a=i.config,n=i.state,r=i.$el.main;if(!t||i.hasArcType()||n.cancelClick)n.cancelClick&&(n.cancelClick=!1);else{var s=t.index;r.selectAll("."+CLASS.shape+"-"+s).each(function(t){(a.data_selection_grouped||i.isWithinShape(this,t))&&(i.toggleShape&&i.toggleShape(this,t,s),a.data_onclick.bind(i.api)(t,this))})}},generateEventRectsForMultipleXs:function(t){var e=this,i=e.state.inputType;t.on("click",function(){e.clickHandlerForMultipleXS.bind(this)(e)}),"mouse"===i&&t.on("mouseover mousemove",function(){e.selectRectForMultipleXs(this)}).on("mouseout",function(){e.config&&!e.hasArcType()&&e.unselectRect()})},clickHandlerForMultipleXS:function(t){var e=t,i=e.config,a=e.filterTargetsToShow(e.data.targets);if(!e.hasArcType(a)){var n=mouse(this),r=e.findClosestFromTargets(a,n);r&&(e.isBarType(r.id)||e.dist(r,n)<i.point_sensitivity)&&e.$el.main.selectAll("."+CLASS.shapes+e.getTargetSelectorSuffix(r.id)).selectAll("."+CLASS.shape+"-"+r.index).each(function(){(i.data_selection_grouped||e.isWithinShape(this,r))&&(e.toggleShape&&e.toggleShape(this,r,r.index),i.data_onclick.bind(e.api)(r,this))})}}},flow={generateFlow:function(t){var e=this,i=e.data,a=e.state,n=e.$el;return function(){var r=t.flow.length;a.flowing=!0,i.targets.forEach(function(t){t.values.splice(0,r)}),e.updateXGrid&&e.updateXGrid(!0);var s={};["axis.x","grid.x","gridLines.x","region.list","text","bar","line","area","circle"].forEach(function(t){var e=t.split("."),i=n[e[0]];i&&e.length>1&&(i=i[e[1]]),i&&i.size()&&(s[t]=i)}),e.hideGridFocus(),e.setFlowList(s,t)}},setFlowList:function(t,e){var i=this,a=e.flow,n=e.targets,r=a.duration,s=void 0===r?e.duration:r,o=a.index,c=a.length,l=a.orgDataCount,u=i.getFlowTransform(n,l,o,c),d=generateWait(),h=transition().ease(easeLinear).duration(s);d.add(Object.keys(t).map(function(e){var a=t[e];return a="axis.x"===e?a.transition(h).call(function(t){return i.axis.x.setTransition(h).create(t)}):"region.list"===e?a.filter(i.isRegionOnX).transition(h).attr("transform",u):a.transition(h).attr("transform",u)})),h.call(d,function(){i.cleanUpFlow(t,e)})},cleanUpFlow:function(t,e){var i=this,a=i.config,n=i.state,r=i.$el.svg,s=a.axis_rotated,o=e.flow,c=e.shape,l=e.xv,u=c.pos,d=u.cx,h=u.cy,g=u.xForText,f=u.yForText,p=o.done,x=void 0===p?function(){}:p,v=o.length;v&&(["circle","text","shape","eventRect"].forEach(function(t){for(var e=[],i=0;i<v;i++)e.push("."+CLASS[t]+"-"+i);r.selectAll("."+CLASS[t+"s"]).selectAll(e).remove()}),r.select("."+CLASS.xgrid).remove()),Object.keys(t).forEach(function(e){var r=t[e];if("axis.x"!==e&&r.attr("transform",null),"grid.x"===e)r.attr(n.xgridAttr);else if("gridLines.x"===e)r.attr("x1",s?0:l).attr("x2",s?n.width:l);else if("gridLines.x"===e)r.select("line").attr("x1",s?0:l).attr("x2",s?n.width:l),r.select("text").attr("x",s?n.width:0).attr("y",l);else if(/^(area|bar|line)$/.test(e))r.attr("d",c.type[e]);else if("text"===e)r.attr("x",g).attr("y",f).style("fill-opacity",i.opacityForText.bind(i));else if("circle"===e)if(i.isCirclePoint())r.attr("cx",d).attr("cy",h);else{r.attr("x",function(t){return d(t)-a.point_r}).attr("y",function(t){return h(t)-a.point_r}).attr("cx",d).attr("cy",h)}else"region.list"===e&&r.select("rect").filter(i.isRegionOnX).attr("x",i.regionX.bind(i)).attr("width",i.regionWidth.bind(i))}),a.interaction_enabled&&i.redrawEventRect(),x.call(i.api),n.flowing=!1},getFlowTransform:function(t,e,i,a){var n,r=this,s=r.data,o=r.scale.x,c=s.targets[0].values,l=r.getValueOnIndex(c,i),u=r.getValueOnIndex(c,i+a),d=o.domain(),h=r.updateXDomain(t,!0,!0);return e?n=1===e||(l&&l.x)===(u&&u.x)?o(d[0])-o(h[0]):r.axis.isTimeSeries()?o(d[0])-o(h[0]):o(l.x)-o(u.x):1!==c.length?n=o(d[0])-o(h[0]):r.axis.isTimeSeries()?(l=r.getValueOnIndex(c,0),u=r.getValueOnIndex(c,c.length-1),n=o(l.x)-o(u.x)):n=diffDomain(h)/2,"translate("+n+",0) scale("+diffDomain(d)/diffDomain(h)+",1)"}},clip={initClip:function(){var t=this,e=t.state.clip;e.id=t.state.datetimeId+"-clip",e.idXAxis=e.id+"-xaxis",e.idYAxis=e.id+"-yaxis",e.idGrid=e.id+"-grid",e.path=t.getClipPath(e.id),e.pathXAxis=t.getClipPath(e.idXAxis),e.pathYAxis=t.getClipPath(e.idYAxis),e.pathGrid=t.getClipPath(e.idGrid)},getClipPath:function(t){var e=this.config;return!e.clipPath&&/-clip$/.test(t)||!e.axis_x_clipPath&&/-clip-xaxis$/.test(t)||!e.axis_y_clipPath&&/-clip-yaxis$/.test(t)?null:"url("+(!!win.navigator&&win.navigator.appVersion.toLowerCase().indexOf("msie 9.")>=0?"":doc.URL.split("#")[0])+"#"+t+")"},appendClip:function(t,e){e&&t.append("clipPath").attr("id",e).append("rect")},setXAxisClipPath:function(t){var e=this.config,i=this.state,a=i.margin,n=i.width,r=i.height,s=e.axis_rotated,o=Math.max(30,a.left)-(s?0:20),c=s?-(1+o):-(o-1),l=-Math.max(15,a.top),u=s?a.left+20:n+10+o,d=(s?a.top+r+10:a.bottom)+20;t.attr("x",c).attr("y",l).attr("width",u).attr("height",d)},setYAxisClipPath:function(t){var e=this.config,i=this.state,a=i.margin,n=i.width,r=i.height,s=e.axis_rotated,o=Math.max(30,a.left)-(s?20:0),c=e.axis_y_inner,l=c?-1:s?-(1+o):-(o-1),u=-(s?20:a.top),d=(s?n+15+o:a.left+20)+(c?20:0),h=(s?a.bottom:a.top+r)+10;t.attr("x",l).attr("y",u).attr("width",d).attr("height",h)},updateXAxisTickClip:function(){var t=this,e=t.config,i=t.state,a=i.clip,n=i.xAxisHeight,r=t.$el.defs,s=t.getHorizontalAxisHeight("x");if(r&&!a.idXAxisTickTexts){var o=a.id+"-xaxisticktexts";t.appendClip(r,o),a.pathXAxisTickTexts=t.getClipPath(a.idXAxisTickTexts),a.idXAxisTickTexts=o}!e.axis_x_tick_multiline&&t.getAxisTickRotate("x")&&s!==n&&(t.setXAxisTickClipWidth(),t.setXAxisTickTextClipPathWidth()),t.state.xAxisHeight=s},setXAxisTickClipWidth:function(){var t=this.config,e=this.state.current.maxTickWidths,i=this.getAxisTickRotate("x");if(!t.axis_x_tick_multiline&&i){var a=Math.sin(Math.PI/180*Math.abs(i));e.x.clipPath=(this.getHorizontalAxisHeight("x")-20)/a}else e.x.clipPath=null},setXAxisTickTextClipPathWidth:function(){var t=this.state,e=t.clip,i=t.current,a=this.$el.svg;a&&a.select("#"+e.idXAxisTickTexts+" rect").attr("width",i.maxTickWidths.x.clipPath).attr("height",30)}},getGridTextAnchor=function(t){return isValue(t.position)||"end"},getGridTextDx=function(t){return"start"===t.position?4:"middle"===t.position?0:-4};function getGridTextX(t,e,i){return function(a){var n=t?0:e;return"start"===a.position?n=t?-i:0:"middle"===a.position&&(n=(t?-i:e)/2),n}}function smoothLines(t,e){"grid"===e&&t.each(function(){var t=select(this);["x1","x2","y1","y2"].forEach(function(e){return t.attr(e,Math.ceil(+t.attr(e)))})})}var grid={hasGrid:function(){var t=this.config;return["x","y"].some(function(e){return t["grid_"+e+"_show"]||t["grid_"+e+"_lines"].length})},initGrid:function(){this.hasGrid()&&this.initGridLines(),this.initFocusGrid()},initGridLines:function(){var t=this.config,e=this.state.clip,i=this.$el;(t.grid_x_lines.length||t.grid_y_lines.length)&&(i.gridLines.main=i.main.insert("g","."+CLASS.chart+(t.grid_lines_front?" + *":"")).attr("clip-path",e.pathGrid).attr("class",CLASS.grid+" "+CLASS.gridLines),i.gridLines.main.append("g").attr("class",CLASS.xgridLines),i.gridLines.main.append("g").attr("class",CLASS.ygridLines),i.gridLines.x=selectAll([]))},updateXGrid:function(t){var e=this,i=e.config,a=e.scale,n=e.state,r=e.$el,s=r.main,o=r.grid,c=i.axis_rotated,l=e.generateGridData(i.grid_x_type,a.x),u=e.axis.isCategorized()?e.axis.x.tickOffset():0,d=function(t){return(a.zoom||a.x)(t)+u*(c?-1:1)};n.xgridAttr=c?{x1:0,x2:n.width,y1:d,y2:d}:{x1:d,x2:d,y1:0,y2:n.height},o.x=s.select("."+CLASS.xgrids).selectAll("."+CLASS.xgrid).data(l),o.x.exit().remove(),o.x=o.x.enter().append("line").attr("class",CLASS.xgrid).merge(o.x),t||o.x.each(function(){var t=select(this);Object.keys(n.xgridAttr).forEach(function(e){t.attr(e,n.xgridAttr[e]).style("opacity",function(){return t.attr(c?"y1":"x1")===(c?n.height:0)?"0":"1"})})})},updateYGrid:function(){var t=this,e=t.config,i=t.state,a=t.$el,n=a.grid,r=a.main,s=e.axis_rotated,o=t.axis.y.tickValues()||t.scale.y.ticks(e.grid_y_ticks),c=function(e){return Math.ceil(t.scale.y(e))};n.y=r.select("."+CLASS.ygrids).selectAll("."+CLASS.ygrid).data(o),n.y.exit().remove(),n.y=n.y.enter().append("line").attr("class",CLASS.ygrid).merge(n.y),n.y.attr("x1",s?c:0).attr("x2",s?c:i.width).attr("y1",s?0:c).attr("y2",s?i.height:c),smoothLines(n.y,"grid")},updateGrid:function(t){var e=this,i=e.$el,a=i.grid;!i.gridLines.main&&e.initGridLines(),a.main.style("visibility",e.hasArcType()?"hidden":"visible"),e.hideGridFocus(),e.updateXGridLines(t),e.updateYGridLines(t)},updateXGridLines:function(t){var e=this.config,i=this.$el,a=i.gridLines,n=i.main,r=e.axis_rotated;e.grid_x_show&&this.updateXGrid();var s=n.select("."+CLASS.xgridLines).selectAll("."+CLASS.xgridLine).data(e.grid_x_lines);s.exit().transition().duration(t).style("opacity","0").remove();var o=s.enter().append("g");o.append("line").style("opacity","0"),o.append("text").attr("transform",r?"":"rotate(-90)").attr("dy",-5).style("opacity","0"),(s=o.merge(s)).attr("class",function(t){return(CLASS.xgridLine+" "+(t.class||"")).trim()}).select("text").attr("text-anchor",getGridTextAnchor).attr("dx",getGridTextDx).transition().duration(t).text(function(t){return t.text}).transition().style("opacity","1"),a.x=s},updateYGridLines:function(t){var e=this,i=e.config,a=e.state,n=a.width,r=a.height,s=e.$el,o=i.axis_rotated;i.grid_y_show&&e.updateYGrid();var c=s.main.select("."+CLASS.ygridLines).selectAll("."+CLASS.ygridLine).data(i.grid_y_lines);c.exit().transition().duration(t).style("opacity","0").remove();var l=c.enter().append("g");l.append("line").style("opacity","0"),l.append("text").attr("transform",o?"rotate(-90)":"").style("opacity","0"),c=l.merge(c);var u=e.yv.bind(e);c.attr("class",function(t){return(CLASS.ygridLine+" "+(t.class||"")).trim()}).select("line").transition().duration(t).attr("x1",o?u:0).attr("x2",o?u:n).attr("y1",o?0:u).attr("y2",o?r:u).transition().style("opacity","1"),c.select("text").attr("text-anchor",getGridTextAnchor).attr("dx",getGridTextDx).transition().duration(t).attr("dy",-5).attr("x",getGridTextX(o,n,r)).attr("y",u).text(function(t){return t.text}).transition().style("opacity","1"),s.gridLines.y=c},redrawGrid:function(t){var e=this,i=e.config.axis_rotated,a=e.state,n=a.width,r=a.height,s=e.$el.gridLines,o=e.xv.bind(e),c=s.x.select("line"),l=s.x.select("text");return c=(t?c.transition():c).attr("x1",i?0:o).attr("x2",i?n:o).attr("y1",i?o:0).attr("y2",i?o:r),l=(t?l.transition():l).attr("x",getGridTextX(!i,n,r)).attr("y",o).text(function(t){return t.text}),[c.style("opacity","1"),l.style("opacity","1")]},initFocusGrid:function(){var t=this.config,e=this.state.clip,i=this.$el,a=t.grid_front,n="."+CLASS[a&&i.gridLines.main?"gridLines":"chart"]+(a?" + *":""),r=i.main.insert("g",n).attr("clip-path",e.pathGrid).attr("class",CLASS.grid);i.grid.main=r,t.grid_x_show&&r.append("g").attr("class",CLASS.xgrids),t.grid_y_show&&r.append("g").attr("class",CLASS.ygrids),t.interaction_enabled&&t.grid_focus_show&&(r.append("g").attr("class",CLASS.xgridFocus).append("line").attr("class",CLASS.xgridFocus),t.grid_focus_y&&!t.tooltip_grouped&&r.append("g").attr("class",CLASS.ygridFocus).append("line").attr("class",CLASS.ygridFocus))},showGridFocus:function(t){var e=this,i=e.config,a=e.state,n=a.width,r=a.height,s=i.axis_rotated,o=e.$el.main.selectAll("line."+CLASS.xgridFocus+", line."+CLASS.ygridFocus),c=(t||[o.datum()]).filter(function(t){return t&&isValue(e.getBaseValue(t))});if(i.tooltip_show&&0!==c.length&&!e.hasType("bubble")&&!e.hasArcType()){var l=i.grid_focus_edge&&!i.tooltip_grouped,u=e.xx.bind(e);o.style("visibility","visible").data(c.concat(c)).each(function(t){var i,a=select(this),o={x:u(t),y:e.getYScaleById(t.id)(t.value)};if(a.classed(CLASS.xgridFocus))i=s?[null,o.x,l?o.y:n,o.x]:[o.x,l?o.y:null,o.x,r];else{var c="y2"===e.axis.getId(t.id);i=s?[o.y,l&&!c?o.x:null,o.y,l&&c?o.x:r]:[l&&c?o.x:null,o.y,l&&!c?o.x:n,o.y]}["x1","y1","x2","y2"].forEach(function(t,e){return a.attr(t,i[e])})}),smoothLines(o,"grid"),e.showCircleFocus&&e.showCircleFocus(t)}},hideGridFocus:function(){var t=this.state,e=t.inputType,i=t.resizing,a=this.$el.main;"mouse"!==e&&i||(a.selectAll("line."+CLASS.xgridFocus+", line."+CLASS.ygridFocus).style("visibility","hidden"),this.hideCircleFocus&&this.hideCircleFocus())},updateGridFocus:function(){var t=this,e=t.state,i=e.inputType,a=e.width,n=e.height,r=e.resizing,s=t.$el.grid.main.select("line."+CLASS.xgridFocus);if("touch"===i)s.empty()?r&&t.showCircleFocus():t.showGridFocus();else{var o=t.config.axis_rotated;s.attr("x1",o?0:-10).attr("x2",o?a:-10).attr("y1",o?-10:0).attr("y2",o?-10:n)}return!0},generateGridData:function(t,e){var i=this.$el.main.select("."+CLASS.axisX).selectAll(".tick").size(),a=[];if("year"===t)for(var n=this.getXDomain(),r=n[0].getFullYear(),s=n[1].getFullYear(),o=r;o<=s;o++)a.push(new Date(o+"-01-01 00:00:00"));else(a=e.ticks(10)).length>i&&(a=a.filter(function(t){return String(t).indexOf(".")<0}));return a},getGridFilterToRemove:function(t){return t?function(e){var i=!1;return(isArray(t)?t.concat():[t]).forEach(function(t){("value"in t&&e.value===t.value||"class"in t&&e.class===t.class)&&(i=!0)}),i}:function(){return!0}},removeGridLines:function(t,e){var i=this.config,a=this.getGridFilterToRemove(t),n=e?CLASS.xgridLines:CLASS.ygridLines,r=e?CLASS.xgridLine:CLASS.ygridLine;this.$el.main.select("."+n).selectAll("."+r).filter(a).transition().duration(i.transition_duration).style("opacity","0").remove();var s="grid_"+(e?"x":"y")+"_lines";i[s]=i[s].filter(function(t){return!a(t)})}},region={initRegion:function(){var t=this.$el;t.region.main=t.main.append("g").attr("clip-path",this.state.clip.path).attr("class",CLASS.regions)},updateRegion:function(t){var e=this,i=e.config,a=e.$el;a.region.main||e.initRegion(),a.region.main.style("visibility",e.hasArcType()?"hidden":"visible");var n=a.main.select("."+CLASS.regions).selectAll("."+CLASS.region).data(i.regions);n.exit().transition().duration(t).style("opacity","0").remove(),(n=n.enter().append("g").merge(n).attr("class",e.classRegion.bind(e))).append("rect").style("fill-opacity","0"),a.region.list=n},redrawRegion:function(t){var e=this,i=e.$el.region.list.select("rect");return i=(t?i.transition():i).attr("x",e.regionX.bind(e)).attr("y",e.regionY.bind(e)).attr("width",e.regionWidth.bind(e)).attr("height",e.regionHeight.bind(e)),[(t?i.transition():i).style("fill-opacity",function(t){return isValue(t.opacity)?t.opacity:"0.1"}).on("end",function(){select(this.parentNode).selectAll("rect:not([x])").remove()})]},getRegionXY:function(t,e){var i=this.config,a=this.scale,n=i.axis_rotated,r="x"===t,s="start",o=0;return"y"===e.axis||"y2"===e.axis?(r||(s="end"),(r?n:!n)&&s in e&&(o=(0,a[e.axis])(e[s]))):(r?!n:n)&&s in e&&(o=(a.zoom||a.x)(this.axis.isTimeSeries()?parseDate.call(this,e[s]):e[s])),o},regionX:function(t){return this.getRegionXY("x",t)},regionY:function(t){return this.getRegionXY("y",t)},getRegionSize:function(t,e){var i=this,a=i.config,n=i.scale,r=i.state,s=a.axis_rotated,o="width"===t,c=i[o?"regionX":"regionY"](e),l="end",u=r[t];return"y"===e.axis||"y2"===e.axis?(o||(l="start"),(o?s:!s)&&l in e&&(u=(0,n[e.axis])(e[l]))):(o?!s:s)&&l in e&&(u=(n.zoom||n.x)(i.axis.isTimeSeries()?parseDate.call(i,e[l]):e[l])),u<c?0:u-c},regionWidth:function(t){return this.getRegionSize("width",t)},regionHeight:function(t){return this.getRegionSize("height",t)},isRegionOnX:function(t){return!t.axis||"x"===t.axis}},sizeAxis={getAxisSize:function(t){var e=this.config.axis_rotated;return e&&"x"===t||!e&&/y2?/.test(t)?this.getAxisWidthByAxisId(t,!0):this.getHorizontalAxisHeight(t)},getAxisWidthByAxisId:function(t,e){if(this.axis){var i=this.axis&&this.axis.getLabelPositionById(t);return this.axis.getMaxTickWidth(t,e)+(i.isInner?20:40)}return 40},getHorizontalAxisHeight:function(t){var e=this,i=e.config,a=e.state,n=a.current,r=a.rotatedPadding,s=a.isLegendRight,o=a.isLegendInset,c=i.axis_rotated,l=30;if("x"===t&&!i.axis_x_show)return 8;if("x"===t&&i.axis_x_height)return i.axis_x_height;if("y"===t&&!i.axis_y_show)return!i.legend_show||s||o?1:10;if("y2"===t&&!i.axis_y2_show)return r.top;var u=e.getAxisTickRotate(t);return("x"===t&&!c||/y2?/.test(t)&&c)&&u&&(l=30+e.axis.getMaxTickWidth(t)*Math.cos(Math.PI*(90-u)/180),!i.axis_x_tick_multiline&&n.height&&l>n.height/2&&(l=n.height/2)),l+(e.axis.getLabelPositionById(t).isInner?0:10)+("y2"!==t||c?0:-10)},getEventRectWidth:function(){return Math.max(0,this.axis.x.tickInterval())},getAxisTickRotate:function(t){var e=this,i=e.axis,a=e.config,n=e.state,r=e.$el,s=a["axis_"+t+"_tick_rotate"];if("x"===t){var o=i.isCategorized()||i.isTimeSeries();if(a.axis_x_tick_fit&&o){var c=a.axis_x_tick_count,l=n.current.maxTickWidths.x.ticks.length,u=0;c?u=c>l?l:c:l&&(u=l),u!==n.axis.x.tickCount&&(n.axis.x.padding=e.axis.getXAxisPadding(u)),n.axis.x.tickCount=u}r.svg&&a.axis_x_tick_fit&&!a.axis_x_tick_multiline&&!a.axis_x_tick_culling&&a.axis_x_tick_autorotate&&o&&(s=e.needToRotateXAxisTickTexts()?a.axis_x_tick_rotate:0)}return s},needToRotateXAxisTickTexts:function(){var t=this.state,e=t.axis,i=t.current.width-this.getCurrentPaddingLeft(!1)-this.getCurrentPaddingRight(),a=e.x.tickCount+e.x.padding.left+e.x.padding.right;return this.axis.getMaxTickWidth("x")>(a?i/a:0)}},optDataAxis={data_xs:{},data_xFormat:"%Y-%m-%d",data_xLocaltime:!0,data_xSort:!0,data_axes:{},data_regions:{},data_stack_normalize:!1},x={axis_x_clipPath:!0,axis_x_show:!0,axis_x_type:"indexed",axis_x_localtime:!0,axis_x_categories:[],axis_x_tick_centered:!1,axis_x_tick_format:void 0,axis_x_tick_culling:{},axis_x_tick_culling_max:10,axis_x_tick_count:void 0,axis_x_tick_show:!0,axis_x_tick_text_show:!0,axis_x_tick_text_position:{x:0,y:0},axis_x_tick_fit:!0,axis_x_tick_values:null,axis_x_tick_autorotate:!1,axis_x_tick_rotate:0,axis_x_tick_outer:!0,axis_x_tick_multiline:!0,axis_x_tick_width:null,axis_x_tick_tooltip:!1,axis_x_max:void 0,axis_x_min:void 0,axis_x_padding:{},axis_x_height:void 0,axis_x_extent:void 0,axis_x_label:{},axis_x_axes:[]},y={axis_y_clipPath:!0,axis_y_show:!0,axis_y_type:"indexed",axis_y_max:void 0,axis_y_min:void 0,axis_y_inverted:!1,axis_y_center:void 0,axis_y_inner:!1,axis_y_label:{},axis_y_tick_format:void 0,axis_y_tick_culling:!1,axis_y_tick_culling_max:5,axis_y_tick_outer:!0,axis_y_tick_values:null,axis_y_tick_rotate:0,axis_y_tick_count:void 0,axis_y_tick_show:!0,axis_y_tick_stepSize:null,axis_y_tick_text_show:!0,axis_y_tick_text_position:{x:0,y:0},axis_y_tick_time_value:void 0,axis_y_padding:{},axis_y_default:void 0,axis_y_axes:[]},y2={axis_y2_show:!1,axis_y2_type:"indexed",axis_y2_max:void 0,axis_y2_min:void 0,axis_y2_inverted:!1,axis_y2_center:void 0,axis_y2_inner:!1,axis_y2_label:{},axis_y2_tick_format:void 0,axis_y2_tick_culling:!1,axis_y2_tick_culling_max:5,axis_y2_tick_outer:!0,axis_y2_tick_values:null,axis_y2_tick_rotate:0,axis_y2_tick_count:void 0,axis_y2_tick_show:!0,axis_y2_tick_stepSize:null,axis_y2_tick_text_show:!0,axis_y2_tick_text_position:{x:0,y:0},axis_y2_padding:{},axis_y2_default:void 0,axis_y2_axes:[]},optAxis=_assign(_assign(_assign({axis_rotated:!1},x),y),y2),optGrid={grid_x_show:!1,grid_x_type:"tick",grid_x_lines:[],grid_y_show:!1,grid_y_lines:[],grid_y_ticks:10,grid_focus_edge:!1,grid_focus_show:!0,grid_focus_y:!1,grid_front:!1,grid_lines_front:!0},api=[apiAxis,apiCategory,apiXGrid,apiYGrid,apiFlow,apiGroup,apiRegion,apiX],internal=[axis$1,clip,eventrect,flow,grid,region,sizeAxis],options=[optDataAxis,optAxis,optGrid],shapeArc={initPie:function(){var t=this,e=t.config,i=e.data_type,a=e.pie_padding,n=e[i+"_startingAngle"]||0,r=(t.hasType("pie")&&a?.01*a:e[i+"_padAngle"])||0;t.pie=pie$1().startAngle(n).endAngle(n+2*Math.PI).padAngle(r).value(function(t){return t.values.reduce(function(t,e){return t+e.value},0)}).sort(t.getSortCompareFn.bind(t)(!0))},updateRadius:function(){var t=this,e=t.config,i=t.state,a=e.pie_padding,n=e.gauge_width||e.donut_width,r=t.filterTargetsToShow(t.data.targets).length*e.gauge_arcs_minWidth;i.radiusExpanded=Math.min(i.arcWidth,i.arcHeight)/2*(t.hasMultiArcGauge()?.85:1),i.radius=.95*i.radiusExpanded,i.innerRadiusRatio=n?(i.radius-n)/i.radius:.6,i.gaugeArcWidth=n||(r<=i.radius-i.innerRadius?i.radius-i.innerRadius:r<=i.radius?r:i.radius);var s=e.pie_innerRadius||(a?a*(i.innerRadiusRatio+.1):0);i.outerRadius=e.pie_outerRadius,i.innerRadius=t.hasType("donut")||t.hasType("gauge")?i.radius*i.innerRadiusRatio:s},getRadius:function(t){var e=t&&t.data,i=this.state,a=i.innerRadius,n=i.outerRadius;return!isNumber(a)&&e&&(a=a[e.id]||0),isObject(n)&&e&&e.id in n?n=n[e.id]:isNumber(n)||(n=this.state.radius),{innerRadius:a,outerRadius:n}},updateArc:function(){var t=this;t.updateRadius(),t.svgArc=t.getSvgArc(),t.svgArcExpanded=t.getSvgArcExpanded()},getArcLength:function(){var t=3.6*this.config.gauge_arcLength,e=t/360*2;return t<-360?e=-2:t>360&&(e=2),e*Math.PI},getStartAngle:function(){var t=this.config,e=t.gauge_fullCircle,i=-1*Math.PI/2,a=Math.PI/2,n=t.gauge_startingAngle;return!e&&n<=i?n=i:!e&&n>=a?n=a:(n>Math.PI||n<-1*Math.PI)&&(n=Math.PI),n},updateAngle:function(t){var e=this,i=e.config,a=e.state,n=e.pie,r=t,s=!1;if(!i)return null;var o=e.getStartAngle(),c=i.gauge_fullCircle?e.getArcLength():-2*o;if(r.data&&e.isGaugeType(r.data)&&!e.hasMultiArcGauge()){var l=c*(e.getTotalDataSum(a.rendered)/(i.gauge_max-i.gauge_min));n=n.startAngle(o).endAngle(l+o)}if(n(e.filterTargetsToShow()).forEach(function(t,e){s||t.data.id!==r.data.id||(s=!0,(r=t).index=e)}),isNaN(r.startAngle)&&(r.startAngle=0),isNaN(r.endAngle)&&(r.endAngle=r.startAngle),r.data&&e.hasMultiArcGauge()){var u=i.gauge_min,d=i.gauge_max,h=c/(d-u),g=r.value<u?0:r.value<d?r.value-u:d-u;r.startAngle=o,r.endAngle=o+h*g}return s?r:null},getSvgArc:function(){var t=this,e=t.state,i=e.gaugeArcWidth/t.filterTargetsToShow(t.data.targets).length,a=t.hasMultiArcGauge(),n=arc().innerRadius(function(n){var r=t.getRadius(n).innerRadius;return a?e.radius-i*(n.index+1):isNumber(r)?r:0}).outerRadius(function(n){var r=t.getRadius(n).outerRadius;return a?e.radius-i*n.index:r}),r=function(e,i){var a="M 0 0";if(e.value||e.data){var r=!i&&t.updateAngle(e);i?a=n(e):r&&(a=n(r))}return a};return r.centroid=n.centroid,r},getSvgArcExpanded:function(t){var e=this,i=e.state,a=t||1,n=i.gaugeArcWidth/e.filterTargetsToShow(e.data.targets).length,r=e.hasMultiArcGauge(),s=Math.min(i.radiusExpanded*a-i.radius,.8*n-100*(1-a)),o=arc().innerRadius(function(t){return r?i.radius-n*(t.index+1):e.getRadius(t).innerRadius}).outerRadius(function(t){var o;if(r)o=i.radius-n*t.index+s;else{var c=e.getRadius(t).outerRadius,l=i.radiusExpanded;i.radius!==c&&(l-=Math.abs(i.radius-c)),o=l*a}return o});return function(t){var i=e.updateAngle(t);return i?o(i):"M 0 0"}},getArc:function(t,e,i){return i||this.isArcType(t.data)?this.svgArc(t,e):"M 0 0"},transformForArcLabel:function(t){var e=this,i=e.config,a=e.state.radiusExpanded,n=e.updateAngle(t),r="";if(n)if(e.hasMultiArcGauge()){var s=Math.sin(n.endAngle-Math.PI/2);r="translate("+(l=Math.cos(n.endAngle-Math.PI/2)*(a+25))+","+(u=s*(a+15-Math.abs(10*s))+3)+")"}else if(!e.hasType("gauge")||e.data.targets.length>1){var o=e.getRadius(t).outerRadius,c=this.svgArc.centroid(n),l=isNaN(c[0])?0:c[0],u=isNaN(c[1])?0:c[1],d=Math.sqrt(l*l+u*u),h=e.hasType("donut")&&i.donut_label_ratio||e.hasType("pie")&&i.pie_label_ratio;r="translate("+l*(h=h?isFunction(h)?h.bind(e.api)(t,o,d):h:o&&(d?(36/o>.375?1.175-36/o:.8)*o/d:0))+","+u*h+")"}return r},convertToArcData:function(t){return this.addName({id:t.data?t.data.id:t.id,value:t.value,ratio:this.getRatio("arc",t),index:t.index})},textForArcLabel:function(t){var e=this,i=e.hasType("gauge");e.shouldShowArcLabel()&&t.style("fill",e.updateTextColor.bind(e)).each(function(t){var a=select(this),n=e.updateAngle(t),r=e.getRatio("arc",n);if(e.meetsLabelThreshold(r,(e.hasType("donut")?"donut":e.hasType("gauge")&&"gauge")||e.hasType("pie")&&"pie")){var s=(n||t).value;setTextValue(a,(e.getArcLabelFormat()||e.defaultArcValueFormat)(s,r,t.data.id).toString(),[-1,1],i)}else a.text("")})},expandArc:function(t){var e=this,i=e.state.transiting,a=e.$el;if(i)var n=setInterval(function(){i||(clearInterval(n),a.legend.selectAll("."+CLASS.legendItemFocused).size()>0&&e.expandArc(t))},10);else{var r=e.mapToTargetIds(t);a.svg.selectAll(e.selectorTargets(r,"."+CLASS.chartArc)).each(function(t){if(e.shouldExpand(t.data.id)){var i=e.getExpandConfig(t.data.id,"duration"),a=e.getSvgArcExpanded(e.getExpandConfig(t.data.id,"rate"));select(this).selectAll("path").transition().duration(i).attr("d",e.svgArcExpanded).transition().duration(2*i).attr("d",a)}})}},unexpandArc:function(t){var e=this,i=e.state.transiting,a=e.$el.svg;if(!i){var n=e.mapToTargetIds(t);a.selectAll(e.selectorTargets(n,"."+CLASS.chartArc)).selectAll("path").transition().duration(function(t){return e.getExpandConfig(t.data.id,"duration")}).attr("d",e.svgArc),a.selectAll(""+CLASS.arc).style("opacity","1")}},getExpandConfig:function(t,e){var i,a=this.config;return this.isDonutType(t)?i="donut":this.isGaugeType(t)?i="gauge":this.isPieType(t)&&(i="pie"),i?a[i+"_expand_"+e]:{duration:50,rate:.98}[e]},shouldExpand:function(t){var e=this.config;return this.isDonutType(t)&&e.donut_expand||this.isGaugeType(t)&&e.gauge_expand||this.isPieType(t)&&e.pie_expand},shouldShowArcLabel:function(){var t=this,e=t.config;return["pie","donut","gauge"].some(function(i){return t.hasType(i)&&e[i+"_label_show"]})},getArcLabelFormat:function(){var t=this.config,e=t.pie_label_format;return this.hasType("gauge")?e=t.gauge_label_format:this.hasType("donut")&&(e=t.donut_label_format),isFunction(e)?e.bind(this.api):e},getArcTitle:function(){var t=this.hasType("donut")?"donut":this.hasType("gauge")&&"gauge";return t?this.config[t+"_title"]:""},updateTargetsForArc:function(t){var e=this,i=e.$el,a=e.hasType("gauge"),n=e.getChartClass("Arc"),r=e.getClass("arcs",!0),s=e.classFocus.bind(e),o=i.main.select("."+CLASS.chartArcs),c=o.selectAll("."+CLASS.chartArc).data(e.pie(t)).attr("class",function(t){return n(t)+s(t.data)}),l=c.enter().append("g").attr("class",n);l.append("g").attr("class",r).merge(c),l.append("text").attr("dy",a&&!e.hasMultiTargets()?"-.1em":".35em").style("opacity","0").style("text-anchor","middle").style("pointer-events","none"),i.text=o.selectAll("."+CLASS.target+" text")},initArc:function(){var t=this.$el;t.arcs=t.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartArcs).attr("transform",this.getTranslate("arc")),this.setArcTitle()},setArcTitle:function(){var t=this.getArcTitle(),e=this.hasType("gauge");if(t){var i=this.$el.arcs.append("text").attr("class",CLASS[e?"chartArcsGaugeTitle":"chartArcsTitle"]).style("text-anchor","middle");e&&i.attr("dy","-0.3em").style("font-size","27px"),setTextValue(i,t,e?void 0:[-.6,1.35],!0)}},redrawArc:function(t,e,i){var a=this,n=a.config,r=a.state,s=a.$el.main,o=n.interaction_enabled,c=o&&n.data_selection_isselectable,l=s.selectAll("."+CLASS.arcs).selectAll("."+CLASS.arc).data(a.arcData.bind(a));l.exit().transition().duration(e).style("opacity","0").remove(),l=l.enter().append("path").attr("class",a.getClass("arc",!0)).style("fill",function(t){return a.color(t.data)}).style("cursor",function(t){return c&&c.bind(a.api)(t)?"pointer":null}).style("opacity","0").each(function(t){a.isGaugeType(t.data)&&(t.startAngle=n.gauge_startingAngle,t.endAngle=n.gauge_startingAngle),this._current=t}).merge(l),a.hasType("gauge")&&(a.updateGaugeMax(),a.hasMultiArcGauge()&&a.redrawMultiArcGauge()),l.attr("transform",function(t){return!a.isGaugeType(t.data)&&i?"scale(0)":""}).style("opacity",function(t){return t===this._current?"0":"1"}).each(function(){r.transiting=!0}).transition().duration(t).attrTween("d",function(t){var e=a.updateAngle(t);if(!e)return function(){return"M 0 0"};isNaN(this._current.startAngle)&&(this._current.startAngle=0),isNaN(this._current.endAngle)&&(this._current.endAngle=this._current.startAngle);var i=interpolate(this._current,e);return this._current=i(0),function(e){var n=i(e);return n.data=t.data,a.getArc(n,!0)}}).attr("transform",i?"scale(1)":"").style("fill",function(t){var e;return a.levelColor?(e=a.levelColor(t.data.values[0].value),n.data_colors[t.data.id]=e):e=a.color(t.data),e}).style("opacity","1").call(endall,function(){if(a.levelColor){var t=select(this),e=t.datum();a.updateLegendItemColor(e.data.id,t.style("fill"))}r.transiting=!1,callFn(n.onrendered,a.api)}),o&&a.bindArcEvent(l),a.hasType("gauge")&&a.redrawBackgroundArcs(),a.redrawArcText(t)},redrawBackgroundArcs:function(){var t=this,e=t.config,i=t.state,a=t.hasMultiArcGauge(),n=e.gauge_fullCircle,r=t.getStartAngle(),s=n?r+t.getArcLength():-1*r,o=t.$el.arcs.select((a?"g":"")+"."+CLASS.chartArcsBackground);if(a){var c=0;(o=o.selectAll("path."+CLASS.chartArcsBackground).data(t.data.targets)).enter().append("path").attr("class",function(t,e){return CLASS.chartArcsBackground+" "+CLASS.chartArcsBackground+"-"+e}).merge(o).style("fill",e.gauge_background||null).attr("d",function(a){var n=a.id;if(i.hiddenTargetIds.indexOf(n)>=0)return"M 0 0";var o={data:[{value:e.gauge_max}],startAngle:r,endAngle:s,index:c++};return t.getArc(o,!0,!0)}),o.exit().remove()}else o.attr("d",function(){var i={data:[{value:e.gauge_max}],startAngle:r,endAngle:s};return t.getArc(i,!0,!0)})},bindArcEvent:function(t){var e=this,i=e.config,a=e.state,n="touch"===a.inputType,r="mouse"===a.inputType;function s(t,i,a){e.expandArc(a),e.api.focus(a),e.toggleFocusLegend(a,!0),e.showTooltip([i],t)}function o(t){var i=t&&t.id||void 0;e.unexpandArc(i),e.api.revert(),e.revertLegend(),e.hideTooltip()}if(t.on("click",function(t,a){var n,r=e.updateAngle(t);r&&(n=e.convertToArcData(r),e.toggleShape&&e.toggleShape(this,n,a),i.data_onclick.bind(e.api)(n,this))}),r&&t.on("mouseover",function(t){if(!a.transiting){var i=e.updateAngle(t),n=i?e.convertToArcData(i):null;s(this,n,n&&n.id||void 0),e.setOverOut(!0,n)}}).on("mouseout",function(t){if(!a.transiting){var i=e.updateAngle(t),n=i?e.convertToArcData(i):null;o(),e.setOverOut(!1,n)}}).on("mousemove",function(t){var i=e.updateAngle(t),a=i?e.convertToArcData(i):null;e.showTooltip([a],this)}),n&&e.hasArcType()&&!e.radars){var c=function(){if(!a.transiting){var t,i=(t=event.changedTouches[0],select(doc.elementFromPoint(t.clientX,t.clientY))).datum(),n=i&&i.data&&i.data.id?e.updateAngle(i):null,r=n?e.convertToArcData(n):null,c=r&&r.id||void 0;e.callOverOutForTouch(r),isUndefined(c)?o():s(this,r,c)}};e.$el.svg.on("touchstart",c).on("touchmove",c)}},redrawArcText:function(t){var e,i=this,a=i.config,n=i.state,r=i.$el,s=r.main,o=r.arcs,c=i.hasType("gauge"),l=i.hasMultiArcGauge();if(c&&1===i.data.targets.length&&a.gauge_title||(e=s.selectAll("."+CLASS.chartArc).select("text").style("opacity","0").attr("class",function(t){return i.isGaugeType(t.data)?CLASS.gaugeValue:null}).call(i.textForArcLabel.bind(i)).attr("transform",i.transformForArcLabel.bind(i)).style("font-size",function(t){return i.isGaugeType(t.data)&&1===i.data.targets.length&&!l?Math.round(n.radius/5)+"px":null}).transition().duration(t).style("opacity",function(t){return i.isTargetToShow(t.data.id)&&i.isArcType(t.data)?"1":"0"}),l&&e.attr("dy","-.1em")),s.select("."+CLASS.chartArcsTitle).style("opacity",i.hasType("donut")||c?"1":"0"),c){var u=a.gauge_fullCircle;u&&e&&e.attr("dy",""+(l?0:Math.round(n.radius/14))),a.gauge_label_show&&(o.select("."+CLASS.chartArcsGaugeUnit).attr("dy",(u?1.5:.75)+"em").text(a.gauge_units),o.select("."+CLASS.chartArcsGaugeMin).attr("dx",-1*(n.innerRadius+(n.radius-n.innerRadius)/(u?1:2))+"px").attr("dy","1.2em").text(i.textForGaugeMinMax(a.gauge_min,!1)),!u&&o.select("."+CLASS.chartArcsGaugeMax).attr("dx",n.innerRadius+(n.radius-n.innerRadius)/2+"px").attr("dy","1.2em").text(i.textForGaugeMinMax(a.gauge_max,!0)))}}},shapeArea={initArea:function(t){var e=this.config;t.insert("g","."+CLASS[e.area_front?"circles":"lines"]).attr("class",this.getClass("areas",!0))},updateAreaGradient:function(){var t=this,e=t.config,i=t.state.datetimeId,a=t.$el.defs;t.data.targets.forEach(function(n){var r=i+"-areaGradient"+t.getTargetSelectorSuffix(n.id);if(t.isAreaType(n)&&a.select("#"+r).empty()){var s=t.color(n),o=e.area_linearGradient,c=o.x,l=void 0===c?[0,0]:c,u=o.y,d=void 0===u?[0,1]:u,h=o.stops,g=void 0===h?[[0,s,1],[1,s,0]]:h,f=a.append("linearGradient").attr("id",""+r).attr("x1",l[0]).attr("x2",l[1]).attr("y1",d[0]).attr("y2",d[1]);g.forEach(function(e){var i=isFunction(e[1])?e[1].bind(t.api)(n.id):e[1];f.append("stop").attr("offset",e[0]).attr("stop-color",i||s).attr("stop-opacity",e[2])})}})},updateAreaColor:function(t){return this.config.area_linearGradient?"url(#"+this.state.datetimeId+"-areaGradient"+this.getTargetSelectorSuffix(t.id)+")":this.color(t)},updateArea:function(t){var e=this,i=e.config,a=e.state,n=e.$el;i.area_linearGradient&&e.updateAreaGradient(),n.area=n.main.selectAll("."+CLASS.areas).selectAll("."+CLASS.area).data(e.lineData.bind(e)),n.area.exit().transition().duration(t).style("opacity","0").remove(),n.area=n.area.enter().append("path").attr("class",e.getClass("area",!0)).style("fill",e.updateAreaColor.bind(e)).style("opacity",function(){return a.orgAreaOpacity=select(this).style("opacity"),"0"}).merge(n.area),n.area.style("opacity",a.orgAreaOpacity)},redrawArea:function(t,e){var i=this,a=i.state.orgAreaOpacity;return[(e?i.$el.area.transition(getRandom()):i.$el.area).attr("d",t).style("fill",i.updateAreaColor.bind(i)).style("opacity",function(t){return String(i.isAreaRangeType(t)?a/1.75:a)})]},generateDrawArea:function(t,e){var i=this,a=i.config,n=a.line_connectNull,r=a.axis_rotated,s=i.generateGetAreaPoints(t,e),o=i.getYScaleById.bind(i),c=function(t){return(e?i.subxx:i.xx).call(i,t)},l=function(t,a){return i.isGrouped(t.id)?s(t,a)[0][1]:o(t.id,e)(i.isAreaRangeType(t)?i.getAreaRangeData(t,"high"):i.getShapeYMin(t.id))},u=function(t,a){return i.isGrouped(t.id)?s(t,a)[1][1]:o(t.id,e)(i.isAreaRangeType(t)?i.getAreaRangeData(t,"low"):t.value)};return function(t){var e,s=n?i.filterRemoveNull(t.values):t.values,o=0,d=0;if(i.isAreaType(t)){var h=area$1();h=r?h.y(c).x0(l).x1(u):h.x(c).y0(a.area_above?0:l).y1(u),n||(h=h.defined(function(t){return null!==i.getBaseValue(t)})),i.isStepType(t)&&(s=i.convertValuesToStep(s)),e=h.curve(i.getCurve(t))(s)}else s[0]&&(o=i.scale.x(s[0].x),d=i.getYScaleById(t.id)(s[0].value)),e=r?"M "+d+" "+o:"M "+o+" "+d;return e||"M 0 0"}},generateGetAreaPoints:function(t,e){var i=this,a=i.config,n=i.getShapeX(0,t,e),r=i.getShapeY(!!e),s=i.getShapeOffset(i.isAreaType,t,e),o=i.getYScaleById.bind(i);return function(t,c){var l=o.call(i,t.id,e)(i.getShapeYMin(t.id)),u=s(t,c)||l,d=n(t),h=r(t);return a.axis_rotated&&(t.value>0&&h<l||t.value<0&&l<h)&&(h=l),[[d,u],[d,h-(l-u)],[d,h-(l-u)],[d,u]]}}},shapeBar={initBar:function(){var t=this.$el;t.bar=t.main.select("."+CLASS.chart).insert("g",":first-child").attr("class",CLASS.chartBars)},updateTargetsForBar:function(t){var e=this,i=e.config,a=e.$el,n=e.getChartClass("Bar"),r=e.getClass("bars",!0),s=e.classFocus.bind(e),o=i.interaction_enabled&&i.data_selection_isselectable;a.bar||e.initBar(),e.$el.main.select("."+CLASS.chartBars).selectAll("."+CLASS.chartBar).data(t).attr("class",function(t){return n(t)+s(t)}).enter().append("g").attr("class",n).style("opacity","0").style("pointer-events","none").append("g").attr("class",r).style("cursor",function(t){return o&&o.bind(e.api)(t)?"pointer":null})},updateBar:function(t){var e=this,i=e.$el,a=e.barData.bind(e),n=e.getClass("bar",!0),r=e.initialOpacity.bind(e);i.bar=i.main.selectAll("."+CLASS.bars).selectAll("."+CLASS.bar).data(a),i.bar.exit().transition().duration(t).style("opacity","0").remove(),i.bar=i.bar.enter().append("path").attr("class",n).style("fill",e.color).merge(i.bar).style("opacity",r)},redrawBar:function(t,e){var i=this.$el.bar;return[(e?i.transition(getRandom()):i).attr("d",t).style("fill",this.color).style("opacity","1")]},getBarW:function(t,e){var i=this,a=i.config,n=i.org,r=i.scale,s=i.getMaxDataCount(),o=a.data_groups.length,c=r.zoom&&!i.axis.isCategorized()?n.xDomain.map(function(t){return r.zoom(t)}).reduce(function(t,e){return Math.abs(t)+e})/s:t.tickInterval(s),l=function(t){var i=t?a.bar_width[t]:a.bar_width,n=t?i.ratio:a.bar_width_ratio,r=t?i.max:a.bar_width_max,s=isNumber(i)?i:e?c*n/e:0;return r&&s>r?r:s},u=l();return!o&&isObjectType(a.bar_width)&&(u={_$width:u,_$total:[]},i.filterTargetsToShow(i.data.targets).forEach(function(t){a.bar_width[t.id]&&(u[t.id]=l(t.id),u._$total.push(u[t.id]||u._$width))})),u},getBars:function(t,e){var i=this.$el.main,a=isValue(t)?"-"+t:"";return(e?i.selectAll("."+CLASS.bars+this.getTargetSelectorSuffix(e)):i).selectAll("."+CLASS.bar+a)},expandBars:function(t,e,i){i&&this.unexpandBars(),this.getBars(t,e).classed(CLASS.EXPANDED,!0)},unexpandBars:function(t){this.getBars(t).classed(CLASS.EXPANDED,!1)},generateDrawBar:function(t,e){var i=this.config,a=this.generateGetBarPoints(t,e),n=i.axis_rotated,r=i.data_groups.length,s=i.bar_radius,o=i.bar_radius_ratio,c=isNumber(s)&&s>0?function(){return s}:isNumber(o)?function(t){return t*o}:null;return function(t,e){var i=a(t,e),s=+n,o=+!s,l=t.value<0,u=["",""],d=0;if(c&&!r){var h=n?o:s,g=i[2][h]-i[0][h],f="a"+(d=c(g))+","+d+" "+(l?"1 0 0":"0 0 1")+" ";u[+!n]=""+f+d+","+d,u[+n]=""+f+[-d,d][n?"sort":"reverse"](),l&&u.reverse()}var p=n?"H"+(i[1][s]-d)+" "+u[0]+"V"+(i[2][o]-d)+" "+u[1]+"H"+i[3][s]:"V"+(i[1][o]+(l?-d:d))+" "+u[0]+"H"+(i[2][s]-d)+" "+u[1]+"V"+i[3][o];return"M"+i[0][s]+","+i[0][o]+p+"z"}},generateGetBarPoints:function(t,e){var i=this,a=i.config,n=e?i.axis.subX:i.axis.x,r=i.getIndicesMax(t)+1,s=i.getBarW(n,r),o=i.getShapeX(s,t,!!e),c=i.getShapeY(!!e),l=i.getShapeOffset(i.isBarType,t,!!e),u=i.getYScaleById.bind(i);return function(t,n){var r=u.call(i,t.id,e)(i.getShapeYMin(t.id)),d=l(t,n)||r,h=isNumber(s)?s:s[t.id]||s._$width,g=o(t),f=c(t);a.axis_rotated&&(t.value>0&&f<r||t.value<0&&r<f)&&(f=r);var p=g+h;return[[g,d],[g,f-=r-d],[p,f],[p,d]]}},isWithinBar:function(t){var e=mouse(t),i=getRectSegList(t),a=i[0],n=i[1],r=Math.min(a.x,n.x),s=Math.min(a.y,n.y),o=this.config.bar_sensitivity,c=t.getBBox(),l=r+c.width+o,u=s+c.height+o,d=s-o;return r-o<e[0]&&e[0]<l&&d<e[1]&&e[1]<u}},shapeGauge={initGauge:function(){var t=this.config,e=this.$el.arcs,i=function(t){e.append("text").attr("class",t).style("text-anchor","middle").style("pointer-events","none")};if(this.hasType("gauge")){var a=this.hasMultiArcGauge();e.append(a?"g":"path").attr("class",CLASS.chartArcsBackground).style("fill",!a&&t.gauge_background||null),t.gauge_units&&i(CLASS.chartArcsGaugeUnit),t.gauge_label_show&&(i(CLASS.chartArcsGaugeMin),!t.gauge_fullCircle&&i(CLASS.chartArcsGaugeMax))}},updateGaugeMax:function(){var t=this,e=t.config,i=t.state,a=t.hasMultiArcGauge()?t.getMinMaxData().max[0].value:t.getTotalDataSum(i.rendered);a>e.gauge_max&&(e.gauge_max=a)},redrawMultiArcGauge:function(){var t=this,e=t.config,i=t.state,a=t.$el,n=t.state.hiddenTargetIds,r=a.main.selectAll("."+CLASS.arcs).selectAll("."+CLASS.arcLabelLine).data(t.arcData.bind(t));r.enter().append("rect").attr("class",function(t){return CLASS.arcLabelLine+" "+CLASS.target+" "+CLASS.target+"-"+t.data.id}).merge(r).style("fill",function(e){return t.levelColor?t.levelColor(e.data.values[0].value):t.color(e.data)}).style("display",e.gauge_label_show?"":"none").each(function(e){var a=0,r=0,s=0,o="";if(n.indexOf(e.data.id)<0){var c=t.updateAngle(e),l=i.gaugeArcWidth/t.filterTargetsToShow(t.data.targets).length*(c.index+1),u=c.endAngle-Math.PI/2,d=i.radius-l,h=u-(0===d?0:1/d);a=i.radiusExpanded-i.radius+l,r=Math.cos(h)*d,s=Math.sin(h)*d,o="rotate("+180*u/Math.PI+", "+r+", "+s+")"}select(this).attr("x",r).attr("y",s).attr("width",a).attr("height",2).attr("transform",o).style("stroke-dasharray","0, "+(a+2)+", 0")})},textForGaugeMinMax:function(t,e){var i=this.config.gauge_label_extents;return isFunction(i)?i.bind(this.api)(t,e):t},getGaugeLabelHeight:function(){var t=this.config;return this.config.gauge_label_show&&!t.gauge_fullCircle?20:0},getPaddingBottomForGauge:function(){return this.getGaugeLabelHeight()*(this.config.gauge_label_show?2:2.5)}},shapeBubble={initBubble:function(){var t=this.config;this.hasType("bubble")&&(t.point_show=!0,t.point_type="circle",t.point_sensitivity=25)},getBaseLength:function(){var t=this.state,e=t.width,i=t.height,a=KEY.bubbleBaseLength,n=this.cache.get(a);return n||this.cache.add(a,n=getMinMax("min",[e,i])),n},getBubbleR:function(t){var e=this,i=e.config.bubble_maxR;isFunction(i)?i=i.bind(e.api)(t):isNumber(i)||(i=e.getBaseLength()/(2*e.getMaxDataCount())+12);var a=getMinMax("max",e.getMinMaxData().max.map(function(t){return e.isBubbleZType(t)?e.getBubbleZData(t.value,"y"):isObject(t.value)?t.value.mid:t.value})),n=i*i*Math.PI,r=(e.isBubbleZType(t)?e.getBubbleZData(t.value,"z"):t.value)*(n/a);return Math.sqrt(r/Math.PI)},getBubbleZData:function(t,e){return isObject(t)?t[e]:t["y"===e?0:1]}},shapeLine={initLine:function(){var t=this.$el;t.line=t.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartLines)},updateTargetsForLine:function(t){var e=this,i=e.$el,a=i.area,n=i.line,r=i.main,s=e.getChartClass("Line"),o=e.getClass("lines",!0),c=e.classFocus.bind(e);n||e.initLine();var l=t.filter(function(t){return!(e.isScatterType(t)||e.isBubbleType(t))}),u=r.select("."+CLASS.chartLines).selectAll("."+CLASS.chartLine).data(l).attr("class",function(t){return s(t)+c(t)}),d=u.enter().append("g").attr("class",s).style("opacity","0").style("pointer-events","none");d.append("g").attr("class",o),e.hasTypeOf("Area")&&e.initArea(!a&&d.empty()?u:d),e.updateTargetForCircle(l,d)},updateLine:function(t){var e=this,i=e.format.extraLineClasses,a=e.$el;a.line=a.main.selectAll("."+CLASS.lines).selectAll("."+CLASS.line).data(e.lineData.bind(e)),a.line.exit().transition().duration(t).style("opacity","0").remove(),a.line=a.line.enter().append("path").attr("class",function(t){return e.getClass("line",!0)(t)+" "+(i(t)||"")}).style("stroke",e.color).merge(a.line).style("opacity",e.initialOpacity.bind(e)).style("shape-rendering",function(t){return e.isStepType(t)?"crispEdges":""}).attr("transform",null)},redrawLine:function(t,e){var i=this.$el.line;return[(e?i.transition(getRandom()):i).attr("d",t).style("stroke",this.color).style("opacity","1")]},getCurve:function(t){var e=this;return e.config.axis_rotated&&e.isStepType(t)?function(i){var a=e.getInterpolate(t)(i);return a.orgPoint=a.point,a.pointRotated=function(t,e){1===this._point&&(this._point=2);var i=this._y*(1-this._t)+e*this._t;this._context.lineTo(this._x,i),this._context.lineTo(t,i),this._x=t,this._y=e},a.point=function(t,e){0===this._point?this.orgPoint(t,e):this.pointRotated(t,e)},a}:e.getInterpolate(t)},generateDrawLine:function(t,e){var i=this,a=i.config,n=i.scale,r=a.line_connectNull,s=a.axis_rotated,o=i.generateGetLinePoints(t,e),c=i.getYScaleById.bind(i),l=function(t){return(e?i.subxx:i.xx).call(i,t)},u=function(t,a){return i.isGrouped(t.id)?o(t,a)[0][1]:c(t.id,e)(i.getBaseValue(t))},d=line$1();d=s?d.x(u).y(l):d.x(l).y(u),r||(d=d.defined(function(t){return null!==i.getBaseValue(t)}));var h=e?n.subX:n.x;return function(t){var n,o=c(t.id,e),l=r?i.filterRemoveNull(t.values):t.values,u=0,g=0;if(i.isLineType(t)){var f=a.data_regions[t.id];f?n=i.lineWithRegions(l,h,o,f):(i.isStepType(t)&&(l=i.convertValuesToStep(l)),n=d.curve(i.getCurve(t))(l))}else l[0]&&(u=h(l[0].x),g=o(l[0].value)),n=s?"M "+g+" "+u:"M "+u+" "+g;return n||"M 0 0"}},lineWithRegions:function(t,e,i,a){var n,r,s,o,c=this,l=c.config.axis_rotated,u=c.axis.isTimeSeries(),d=c.axis.isCategorized()?.5:0,h=[],g=function(t,e){for(var i=0,a=void 0;a=e[i];i++)if(a.start<t&&t<=a.end)return a.style;return!1};if(isDefined(a))for(var f=function(t,e){return isUndefined(t)?e:u?parseDate.call(c,t):t},p=0,x=void 0;x=a[p];p++){var v=f(x.start,t[0].x),m=f(x.end,t[t.length-1].x),_=x.style||{dasharray:"2 2"};h[p]={start:v,end:m,style:_}}for(var y=l?function(t){return i(t.value)}:function(t){return e(t.x)},b=l?function(t){return e(t.x)}:function(t){return i(t.value)},T=function(t){return"M"+t[0][0]+","+t[0][1]+"L"+t[1][0]+","+t[1][1]},S=u?function(t,a,n,o){var c=t.x.getTime(),u=a.x-t.x,d=new Date(c+u*n),h=new Date(c+u*(n+o)),g=l?[[i(r(n)),e(d)],[i(r(n+s)),e(h)]]:[[e(d),i(r(n))],[e(h),i(r(n+s))]];return T(g)}:function(t,a,s,o){var c=l?[[i(r(s),!0),e(n(s))],[i(r(s+o),!0),e(n(s+o))]]:[[e(n(s),!0),i(r(s))],[e(n(s+o),!0),i(r(s+o))]];return T(c)},A={x:c.axis.getAxisType("x"),y:c.axis.getAxisType("y")},L="",C=(p=0,void 0);C=t[p];p++){var w=t[p-1],E=w&&isValue(w.value);_=g(C.x,h);if(isValue(C.value))if(!isUndefined(h)&&_&&E){if(E){try{_=_.dasharray.split(" ")}catch(t){_="2 2".split(" ")}n=getScale(A.x,w.x+d,C.x+d),r=getScale(A.y,w.value,C.value);var R=e(C.x)-e(w.x),k=i(C.value)-i(w.value),O=Math.sqrt(Math.pow(R,2)+Math.pow(k,2));o=(s=_[0]/O)*_[1];for(var D=s;D<=1;D+=o)L+=S(w,C,D,s),D+o>=1&&(L+=S(w,C,1,0))}}else L+=(p&&E?"L":"M")+y(C)+","+b(C)}return L},isWithinStep:function(t,e){return Math.abs(e-mouse(t)[1])<30},shouldDrawPointsForLine:function(t){var e=this.config.line_point;return!0===e||isArray(e)&&-1!==e.indexOf(t.id)}},getTransitionName=function(){return getRandom()},shapePoint={hasValidPointType:function(t){return/^(circle|rect(angle)?|polygon|ellipse|use)$/i.test(t||this.config.point_type)},hasValidPointDrawMethods:function(t){var e=t||this.config.point_type;return isObjectType(e)&&isFunction(e.create)&&isFunction(e.update)},initialOpacityForCircle:function(t){var e=this.config,i=this.state.withoutFadeIn,a=e.point_opacity;return isUndefined(a)&&(a=null!==this.getBaseValue(t)&&i[t.id]?this.opacityForCircle(t):"0"),a},opacityForCircle:function(t){var e=this.config,i=e.point_opacity;return isUndefined(i)&&(i=e.point_show&&!e.point_focus_only?"1":"0",i=isValue(this.getBaseValue(t))?this.isBubbleType(t)||this.isScatterType(t)?"0.5":i:"0"),i},initCircle:function(){var t=this,e=t.$el.main;t.point=t.generatePoint(),(t.hasType("bubble")||t.hasType("scatter"))&&e.select("."+CLASS.chartCircles).empty()&&e.select("."+CLASS.chart).append("g").attr("class",CLASS.chartCircles)},updateTargetForCircle:function(t,e){var i=this,a=this,n=a.config,r=a.data,s=a.$el,o=n.interaction_enabled&&n.data_selection_enabled,c=o&&n.data_selection_isselectable,l=a.getClass("circles",!0);if(n.point_show){!s.circle&&a.initCircle();var u=t,d=e;if(!u){u=r.targets.filter(function(t){return i.isScatterType(t)||i.isBubbleType(t)});var h=s.main.select("."+CLASS.chartCircles).style("pointer-events","none").selectAll("."+CLASS.circles).data(u).attr("class",l);h.exit().remove(),d=h.enter()}o&&d.append("g").attr("class",function(t){return a.generateClass(CLASS.selectedCircles,t.id)}),d.append("g").attr("class",l).style("cursor",function(t){return c&&c(t)?"pointer":null}),o&&u.forEach(function(t){s.main.selectAll("."+CLASS.selectedCircles+a.getTargetSelectorSuffix(t.id)).selectAll(""+CLASS.selectedCircle).each(function(e){e.value=t.values[e.index].value})})}},updateCircle:function(){var t=this,e=t.config,i=t.state,a=t.$el,n=e.point_focus_only;if(e.point_show&&!i.toggling){var r=a.main.selectAll("."+CLASS.circles).selectAll("."+CLASS.circle).data(function(e){return t.isLineType(e)&&t.shouldDrawPointsForLine(e)||t.isBubbleType(e)||t.isRadarType(e)||t.isScatterType(e)?n?[e.values[0]]:e.values:[]});r.exit().remove(),r.enter().filter(Boolean).append(t.point("create",this,t.pointR.bind(t),t.color)),a.circle=a.main.selectAll("."+CLASS.circles+" ."+CLASS.circle).style("stroke",t.color).style("opacity",t.initialOpacityForCircle.bind(t))}},redrawCircle:function(t,e,i,a){var n=this,r=n.state.rendered,s=n.$el,o=s.circle,c=s.main.selectAll("."+CLASS.selectedCircle);if(!n.config.point_show)return[];var l=n.point("update",n,t,e,n.color,i,a,c),u=n.isCirclePoint()?"c":"",d=getRandom(),h=n.opacityForCircle.bind(n),g=[];return o.each(function(t){var e=l.bind(this)(t);e=(i||!r?e.transition(d):e).style("opacity",h),g.push(e)}),[g,(i?c.transition():c).attr(u+"x",t).attr(u+"y",e)]},showCircleFocus:function(t){var e=this,i=e.config,a=e.state,n=a.hasRadar,r=a.resizing,s=a.toggling,o=a.transiting,c=e.$el.circle;if(!1===o&&i.point_focus_only&&c){var l=(n?e.radarCircleX:e.circleX).bind(e),u=(n?e.radarCircleY:e.circleY).bind(e),d=s||isUndefined(t),h=e.point("update",e,l,u,e.color,!r&&d);t&&(c=c.filter(function(e){var i=t.filter(function(t){return t.id===e.id});return!!i.length&&select(this).datum(i[0])})),c.attr("class",this.updatePointClass.bind(this)).style("opacity","1").each(function(t){var i=t.id,a=t.index,n=t.value,r="hidden";isValue(n)&&(h.bind(this)(t),e.expandCircles(a,i),r=""),this.style.visibility=r})}},hideCircleFocus:function(){var t=this.config,e=this.$el.circle;t.point_focus_only&&e&&(this.unexpandCircles(),e.style("visibility","hidden"))},circleX:function(t){return this.xx(t)},updateCircleY:function(){var t=this,e=t.generateGetLinePoints(t.getShapeIndices(t.isLineType),!1);t.circleY=function(i,a){var n=i.id;return t.isGrouped(n)?e(i,a)[0][1]:t.getYScaleById(n)(t.getBaseValue(i))}},getCircles:function(t,e){var i=isValue(t)?"-"+t:"";return(e?this.$el.main.selectAll("."+CLASS.circles+this.getTargetSelectorSuffix(e)):this.$el.main).selectAll("."+CLASS.circle+i)},expandCircles:function(t,e,i){var a=this,n=a.pointExpandedR.bind(a);i&&a.unexpandCircles();var r=a.getCircles(t,e).classed(CLASS.EXPANDED,!0),s=n(r)/a.config.point_r,o=1-s;a.isCirclePoint()?r.attr("r",n):r.each(function(){var t=select(this);if("circle"===this.tagName)t.attr("r",n);else{var e=this.getBBox(),i=e.width,a=e.height,r=o*(+t.attr("x")+i/2),c=o*(+t.attr("y")+a/2);t.attr("transform","translate("+r+" "+c+") scale("+s+")")}})},unexpandCircles:function(t){var e=this,i=e.pointR.bind(e),a=e.getCircles(t).filter(function(){return select(this).classed(CLASS.EXPANDED)}).classed(CLASS.EXPANDED,!1);a.attr("r",i),!e.isCirclePoint()&&a.attr("transform","scale("+i(a)/e.config.point_r+")")},pointR:function(t){var e=this.config.point_r,i=e;return this.isBubbleType(t)?i=this.getBubbleR(t):isFunction(e)&&(i=e.bind(this.api)(t)),i},pointExpandedR:function(t){var e=this.config,i=this.isBubbleType(t)?1.15:1.75;return e.point_focus_expand_enabled?e.point_focus_expand_r||this.pointR(t)*i:this.pointR(t)},pointSelectR:function(t){var e=this.config.point_select_r;return isFunction(e)?e(t):e||4*this.pointR(t)},isWithinCircle:function(t,e){var i=mouse(t),a=select(t),n=this.isCirclePoint(t)?"c":"",r=+a.attr(n+"x"),s=+a.attr(n+"y");if(!r&&!s&&1===t.nodeType){var o=getBoundingRect(t);r=o.x,s=o.y}return Math.sqrt(Math.pow(r-i[0],2)+Math.pow(s-i[1],2))<(e||this.config.point_sensitivity)},insertPointInfoDefs:function(t,e){var i=function(t,e){for(var i,a=t.attributes,n=0;i=a[n];n++)i=i.name,e.setAttribute(i,t.getAttribute(i))},a=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement,n=doc.createElementNS(namespaces.svg,a.nodeName.toLowerCase());if(n.id=e,n.style.fill="inherit",n.style.stroke="inherit",i(a,n),a.childNodes&&a.childNodes.length){var r=select(n);"innerHTML"in n?r.html(a.innerHTML):toArray(a.childNodes).forEach(function(t){i(t,r.append(t.tagName).node())})}this.$el.defs.node().appendChild(n)},pointFromDefs:function(t){return this.$el.defs.select("#"+t)},updatePointClass:function(t){var e=this,i=e.$el.circle,a=!1;return(isObject(t)||i)&&(a=!0===t?i.each(function(t){var i=e.getClass("circle",!0)(t);this.getAttribute("class").indexOf(CLASS.EXPANDED)>-1&&(i+=" "+CLASS.EXPANDED),this.setAttribute("class",i)}):e.getClass("circle",!0)(t)),a},generateGetLinePoints:function(t,e){var i=this,a=i.config,n=i.getShapeX(0,t,e),r=i.getShapeY(e),s=i.getShapeOffset(i.isLineType,t,e),o=i.getYScaleById.bind(i);return function(t,c){var l=o.call(i,t.id,e)(i.getShapeYMin(t.id)),u=s(t,c)||l,d=n(t),h=r(t);a.axis_rotated&&(t.value>0&&h<l||t.value<0&&l<h)&&(h=l);var g=[d,h-(l-u)];return[g,g,g,g]}},generatePoint:function(){var t=this,e=t.config,i=t.state.datetimeId,a=[],n=notEmpty(e.point_pattern)?e.point_pattern:[e.point_type];return function(e,r){for(var s=[],o=2;o<arguments.length;o++)s[o-2]=arguments[o];return function(o){var c=t.getTargetSelectorSuffix(o.id||o.data&&o.data.id||o),l=select(this);a.indexOf(c)<0&&a.push(c);var u=n[a.indexOf(c)%n.length];if(t.hasValidPointType(u))u=t[u];else if(!t.hasValidPointDrawMethods(u)){var d=i+"-point"+c;if(t.pointFromDefs(d).size()<1&&t.insertPointInfoDefs(u,d),"create"===e)return t.custom.create.bind(r).apply(void 0,__spreadArrays([l,d],s));if("update"===e)return t.custom.update.bind(r).apply(void 0,__spreadArrays([l],s))}return u[e].bind(r).apply(void 0,__spreadArrays([l],s))}}},custom:{create:function(t,e,i,a){return t.append("use").attr("xlink:href","#"+e).attr("class",this.updatePointClass.bind(this)).style("fill",a).node()},update:function(t,e,i,a,n,r,s){var o=t.node().getBBox(),c=o.width,l=o.height,u=function(t){return e(t)-c/2},d=t;if(n){var h=getTransitionName();r&&d.attr("x",u),d=d.transition(h),s&&s.transition(getTransitionName())}return d.attr("x",u).attr("y",function(t){return i(t)-l/2}).style("fill",a)}},circle:{create:function(t,e,i){return t.append("circle").attr("class",this.updatePointClass.bind(this)).attr("r",e).style("fill",i).node()},update:function(t,e,i,a,n,r,s){var o=t;if(this.hasType("bubble")&&o.attr("r",this.pointR.bind(this)),n){var c=getTransitionName();r&&o.attr("cx",e),o.attr("cx")&&(o=o.transition(c)),s&&s.transition(getTransitionName())}return o.attr("cx",e).attr("cy",i).style("fill",a)}},rectangle:{create:function(t,e,i){var a=function(t){return 2*e(t)};return t.append("rect").attr("class",this.updatePointClass.bind(this)).attr("width",a).attr("height",a).style("fill",i).node()},update:function(t,e,i,a,n,r,s){var o=this.config.point_r,c=function(t){return e(t)-o},l=t;if(n){var u=getTransitionName();r&&l.attr("x",c),l=l.transition(u),s&&s.transition(getTransitionName())}return l.attr("x",c).attr("y",function(t){return i(t)-o}).style("fill",a)}}};function getPosition(t,e,i,a,n,r){var s=t&&a>0?i-a:a,o=2*Math.PI;return n*(1-r*("x"===e?Math.sin:Math.cos)(s*o/i))}var cacheKey=KEY.radarPoints,shapeRadar={initRadar:function(){var t=this,e=t.config,i=t.state.current,a=t.$el;t.hasType("radar")&&(a.radar=a.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartRadars),a.radar.levels=a.radar.append("g").attr("class",CLASS.levels),a.radar.axes=a.radar.append("g").attr("class",CLASS.axis),a.radar.shapes=a.radar.append("g").attr("class",CLASS.shapes),i.dataMax=e.radar_axis_max||t.getMinMaxData().max[0].value)},getRadarSize:function(){var t=this.config,e=this.state,i=e.arcWidth,a=e.arcHeight,n=t.axis_x_categories.length<4?-20:10,r=(Math.min(i,a)-n)/2;return[r,r]},updateTargetsForRadar:function(t){var e=this.config;isEmpty(e.axis_x_categories)&&(e.axis_x_categories=getRange(0,getMinMax("max",t.map(function(t){return t.values.length})))),this.generateRadarPoints()},getRadarPosition:function(t,e,i,a){var n=this.config,r=this.getRadarSize(),s=r[0],o=r[1],c=n.axis_x_categories.length,l=n.radar_direction_clockwise,u=toArray(t).map(function(r){return getPosition(l,r,c,e,isDefined(i)?i:"x"===t?s:o,isNumber(a)?a:n.radar_size_ratio)});return 1===u.length?u[0]:u},generateRadarPoints:function(){var t=this,e=t.data.targets,i=t.getRadarSize(),a=i[0],n=i[1],r=t.cache.get(cacheKey)||{},s=r._size;(!s||s.width!==a&&s.height!==n)&&(e.forEach(function(e){r[e.id]=e.values.map(function(e,i){return t.getRadarPosition(["x","y"],i,void 0,t.getRatio("radar",e))})}),r._size={width:a,height:n},t.cache.add(cacheKey,r))},redrawRadar:function(t){var e=this,i=e.$el,a=i.radar,n=i.main,r=e.getTranslate("radar");r&&(a.attr("transform",r),n.select("."+CLASS.chartTexts).attr("transform",r),e.generateRadarPoints(),e.updateRadarLevel(),e.updateRadarAxes(),e.updateRadarShape(t))},generateGetRadarPoints:function(){var t=this.cache.get(cacheKey);return function(e,i){var a=t[e.id][i];return[a,a,a,a]}},updateRadarLevel:function(){var t=this,e=t.config,i=t.state,a=t.$el.radar,n=t.getRadarSize(),r=n[0],s=n[1],o=e.radar_level_depth,c=e.axis_x_categories.length,l=e.radar_level_text_show,u=a.levels,d=getRange(0,o),h=e.radar_size_ratio*Math.min(r,s),g=d.map(function(t){return h*((t+1)/o)}),f=(e.radar_level_text_format||function(){}).bind(t.api),p=d.map(function(e){var i=g[e];return getRange(0,c).map(function(e){return t.getRadarPosition(["x","y"],e,i,1).join(",")}).join(" ")}),x=u.selectAll("."+CLASS.level).data(d);x.exit().remove();var v=x.enter().append("g").attr("class",function(t,e){return CLASS.level+" "+CLASS.level+"-"+e});v.append("polygon").style("visibility",e.radar_level_show?null:"hidden"),l&&(u.select("text").empty()&&u.append("text").attr("dx","-.5em").attr("dy","-.7em").style("text-anchor","end").text(function(){return f(0)}),v.append("text").attr("dx","-.5em").style("text-anchor","end").text(function(t){return f(i.current.dataMax/d.length*(t+1))})),v.merge(x).attr("transform",function(t){return"translate("+(r-g[t])+", "+(s-g[t])+")"}).selectAll("polygon").attr("points",function(t){return p[t]}),l&&u.selectAll("text").attr("x",function(t){return isUndefined(t)?r:p[t].split(",")[0]}).attr("y",function(t){return isUndefined(t)?s:0})},updateRadarAxes:function(){var t=this,e=t.config,i=t.$el.radar,a=t.getRadarSize(),n=a[0],r=a[1],s=e.axis_x_categories,o=i.axes.selectAll("g").data(s);o.exit().remove();var c=o.enter().append("g").attr("class",function(t,e){return CLASS.axis+"-"+e});if(e.radar_axis_line_show&&c.append("line"),e.radar_axis_text_show&&c.append("text"),o=c.merge(o),e.radar_axis_line_show&&o.select("line").attr("x1",n).attr("y1",r).attr("x2",function(e,i){return t.getRadarPosition("x",i)}).attr("y2",function(e,i){return t.getRadarPosition("y",i)}),e.radar_axis_text_show){var l=e.radar_axis_text_position,u=l.x,d=void 0===u?0:u,h=l.y,g=void 0===h?0:h;o.select("text").style("text-anchor","middle").attr("dy",".5em").call(function(t){t.each(function(t){setTextValue(select(this),String(t),[-.6,1.2])})}).datum(function(t,e){return{index:e}}).attr("transform",function(e){isUndefined(this.width)&&(this.width=this.getBoundingClientRect().width/2);var i=t.getRadarPosition("x",e.index,void 0,1),a=Math.round(t.getRadarPosition("y",e.index,void 0,1));return i>n?i+=this.width+d:Math.round(i)<n&&(i-=this.width+d),a>r?(a/2===r&&"tspan"===this.firstChild.tagName&&this.firstChild.setAttribute("dy","0em"),a+=g):a<r&&(a-=g),"translate("+i+" "+a+")"})}t.bindEvent()},bindEvent:function(){var t=this,e=t.config,i=t.state,a=i.inputType,n=i.transiting,r=t.$el,s=r.radar,o=r.svg,c=e.point_focus_only;if(e.interaction_enabled){var l="mouse"===a,u=function(){var t=event.target;/tspan/i.test(t.tagName)&&(t=t.parentNode);var e=select(t).datum();return e&&1===Object.keys(e).length?e.index:void 0},d=function(){var e=u(),i=isUndefined(e);(l||i)&&(t.hideTooltip(),c?t.hideCircleFocus():t.unexpandCircles(),l?t.setOverOut(!1,e):i&&t.callOverOutForTouch())};s.axes.selectAll("text").on(l?"mouseover ":"touchstart",function(){if(!n){var e=u();t.selectRectForSingle(o.node(),null,e),l?t.setOverOut(!0,e):t.callOverOutForTouch(e)}}).on("mouseout",l?d:null),l||o.on("touchstart",d)}},updateRadarShape:function(t){var e=this,i=e.data.targets.filter(function(t){return e.isRadarType(t)}),a=e.cache.get(cacheKey),n=e.$el.radar.shapes.selectAll("polygon").data(i),r=n.enter().append("g").attr("class",e.getChartClass("Radar"));n.exit().transition().duration(t).remove(),r.append("polygon").merge(n).style("fill",e.color).style("stroke",e.color).attr("points",function(t){return a[t.id].join(" ")}),e.updateTargetForCircle(i,r)},radarCircleX:function(t){return this.cache.get(cacheKey)[t.id][t.index][0]},radarCircleY:function(t){return this.cache.get(cacheKey)[t.id][t.index][1]}},optPoint={point_show:!0,point_r:2.5,point_sensitivity:10,point_focus_expand_enabled:!0,point_focus_expand_r:void 0,point_focus_only:!1,point_opacity:void 0,point_pattern:[],point_select_r:void 0,point_type:"circle"},optArea={area_above:!1,area_front:!0,area_linearGradient:!1,area_zerobased:!0},optBar={bar_label_threshold:0,bar_padding:0,bar_radius:void 0,bar_radius_ratio:void 0,bar_sensitivity:2,bar_width:void 0,bar_width_ratio:.6,bar_width_max:void 0,bar_zerobased:!0},optBubble={bubble_maxR:35,bubble_zerobased:!1},optLine={line_connectNull:!1,line_step_type:"step",line_zerobased:!1,line_classes:void 0,line_point:!0},optScatter={scatter_zerobased:!1},optSpline={spline_interpolation_type:"cardinal"},optDonut={donut_label_show:!0,donut_label_format:void 0,donut_label_threshold:.05,donut_label_ratio:void 0,donut_width:void 0,donut_title:"",donut_expand:{},donut_expand_rate:.98,donut_expand_duration:50,donut_padAngle:0,donut_startingAngle:0},optGauge={gauge_background:"",gauge_fullCircle:!1,gauge_label_show:!0,gauge_label_format:void 0,gauge_label_extents:void 0,gauge_label_threshold:0,gauge_min:0,gauge_max:100,gauge_type:"single",gauge_startingAngle:-1*Math.PI/2,gauge_arcLength:100,gauge_title:"",gauge_units:void 0,gauge_width:void 0,gauge_arcs_minWidth:5,gauge_expand:{},gauge_expand_rate:.98,gauge_expand_duration:50},optPie={pie_label_show:!0,pie_label_format:void 0,pie_label_threshold:.05,pie_label_ratio:void 0,pie_expand:{},pie_expand_rate:.98,pie_expand_duration:50,pie_innerRadius:0,pie_outerRadius:void 0,pie_padAngle:0,pie_padding:0,pie_startingAngle:0},optRadar={radar_axis_max:void 0,radar_axis_line_show:!0,radar_axis_text_show:!0,radar_axis_text_position:{},radar_level_depth:3,radar_level_show:!0,radar_level_text_format:function(t){return t%1==0?t:t.toFixed(2)},radar_level_text_show:!0,radar_size_ratio:.87,radar_direction_clockwise:!1};function extendAxis(t,e){extend(ChartInternal.prototype,internal.concat(t)),extend(Chart.prototype,api),Options.setOptions(options.concat(e||[]))}function extendLine(t,e){extendAxis([shapePoint,shapeLine].concat(t||[])),Options.setOptions([optPoint,optLine].concat(e||[]))}function extendArc(t,e){extend(ChartInternal.prototype,[shapeArc].concat(t||[])),Options.setOptions(e)}var area=function(){return extendLine(shapeArea,[optArea]),(area=function(){return TYPE.AREA})()},areaLineRange=function(){return extendLine(shapeArea,[optArea]),(areaLineRange=function(){return TYPE.AREA_LINE_RANGE})()},areaSpline=function(){return extendLine(shapeArea,[optArea,optSpline]),(areaSpline=function(){return TYPE.AREA_SPLINE})()},areaSplineRange=function(){return extendLine(shapeArea,[optArea,optSpline]),(areaSplineRange=function(){return TYPE.AREA_SPLINE_RANGE})()},areaStep=function(){return extendLine(shapeArea,[optArea]),(areaStep=function(){return TYPE.AREA_STEP})()},line=function(){return extendLine(),(line=function(){return TYPE.LINE})()},spline=function(){return extendLine(void 0,[optSpline]),(spline=function(){return TYPE.SPLINE})()},step=function(){return extendLine(),(step=function(){return TYPE.STEP})()},donut=function(){return extendArc(void 0,[optDonut]),(donut=function(){return TYPE.DONUT})()},gauge=function(){return extendArc([shapeGauge],[optGauge]),(gauge=function(){return TYPE.GAUGE})()},pie=function(){return extendArc(void 0,[optPie]),(pie=function(){return TYPE.PIE})()},radar=function(){return extendArc([shapePoint,shapeRadar],[optPoint,optRadar]),(radar=function(){return TYPE.RADAR})()},bar=function(){return extendAxis([shapeBar],optBar),(bar=function(){return TYPE.BAR})()},bubble=function(){return extendAxis([shapePoint,shapeBubble],[optBubble,optPoint]),(bubble=function(){return TYPE.BUBBLE})()},scatter=function(){return extendAxis([shapePoint],[optPoint,optScatter]),(scatter=function(){return TYPE.SCATTER})()},apiSelection={selected:function(t){var e=this.internal,i=[];return e.$el.main.selectAll("."+(CLASS.shapes+e.getTargetSelectorSuffix(t))).selectAll("."+CLASS.shape).filter(function(){return select(this).classed(CLASS.SELECTED)}).each(function(t){return i.push(t)}),i},select:function(t,e,i){var a=this.internal,n=a.config,r=a.$el;n.data_selection_enabled&&r.main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).each(function(r,s){var o=select(this),c=r.data?r.data.id:r.id,l=a.getToggle(this,r).bind(a),u=n.data_selection_grouped||!t||t.indexOf(c)>=0,d=!e||e.indexOf(s)>=0,h=o.classed(CLASS.SELECTED);o.classed(CLASS.line)||o.classed(CLASS.area)||(u&&d?n.data_selection_isselectable.bind(a.api)(r)&&!h&&l(!0,o.classed(CLASS.SELECTED,!0),r,s):isDefined(i)&&i&&h&&l(!1,o.classed(CLASS.SELECTED,!1),r,s))})},unselect:function(t,e){var i=this.internal,a=i.config,n=i.$el;a.data_selection_enabled&&n.main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).each(function(n,r){var s=select(this),o=n.data?n.data.id:n.id,c=i.getToggle(this,n).bind(i),l=a.data_selection_grouped||!t||t.indexOf(o)>=0,u=!e||e.indexOf(r)>=0,d=s.classed(CLASS.SELECTED);s.classed(CLASS.line)||s.classed(CLASS.area)||l&&u&&a.data_selection_isselectable.bind(i.api)(n)&&d&&c(!1,s.classed(CLASS.SELECTED,!1),n,r)})}};function withinRange(t,e){var i=e[0],a=e[1];return t.every(function(t,e){return 0===e?t>=i:t<=a})}var zoom=function(t){var e,i=this.internal,a=i.config,n=i.scale,r=t;if(a.zoom_enabled&&r){if(i.axis.isTimeSeries()&&(r=r.map(function(t){return parseDate.bind(i)(t)})),withinRange(r,i.getZoomDomain())){if(i.api.tooltip.hide(),a.subchart_show){var s=n.zoom||n.x;i.brush.getSelection().call(i.brush.move,[s(r[0]),s(r[1])]),e=r}else n.x.domain(r),n.zoom=n.x,i.axis.x.scale(n.zoom),e=n.zoom.orgDomain();i.redraw({withTransition:!0,withY:a.zoom_rescale,withDimension:!1}),i.setZoomResetButton(),callFn(a.zoom_onzoom,i.api,e)}}else e=n.zoom?n.zoom.domain():n.x.orgDomain();return e};extend(zoom,{enable:function(t){var e=this.internal,i=e.config;/^(drag|wheel)$/.test(t)&&(i.zoom_type=t),i.zoom_enabled=!!t,e.zoom?!1===t&&e.bindZoomEvent(!1):(e.initZoom(),e.bindZoomEvent()),e.updateAndRedraw()},max:function(t){var e=this.internal,i=e.config,a=e.org.xDomain;return(0===t||t)&&(i.zoom_x_max=getMinMax("max",[a[1],t])),i.zoom_x_max},min:function(t){var e=this.internal,i=e.config,a=e.org.xDomain;return(0===t||t)&&(i.zoom_x_min=getMinMax("min",[a[0],t])),i.zoom_x_min},range:function(t){var e=this.zoom;if(isObject(t)){var i=t.min,a=t.max;isDefined(i)&&e.min(i),isDefined(a)&&e.max(a)}return{min:e.min(),max:e.max()}}});var apiZoom={zoom:zoom,unzoom:function(){var t=this.internal,e=t.config;if(t.scale.zoom){e.subchart_show?t.brush.getSelection().call(t.brush.move,null):t.zoom.updateTransformScale(zoomIdentity),t.updateZoom(!0),t.zoom.resetBtn&&t.zoom.resetBtn.style("display","none");var i=t.$el.main.select("."+CLASS.eventRects);zoomTransform(i.node())!==zoomIdentity&&t.zoom.transform(i,zoomIdentity),t.redraw({withTransition:!0,withUpdateXDomain:!0,withUpdateOrgXDomain:!0,withY:e.zoom_rescale})}}},drag={drag:function(t){var e=this,i=e.config,a=e.state,n=e.$el.main,r=i.data_selection_grouped,s=i.interaction_enabled&&i.data_selection_isselectable;if(!e.hasArcType()&&i.data_selection_enabled&&(!i.zoom_enabled||e.zoom.altDomain)&&i.data_selection_multiple){var o=a.dragStart||[0,0],c=o[0],l=o[1],u=t[0],d=t[1],h=Math.min(c,u),g=Math.max(c,u),f=r?a.margin.top:Math.min(l,d),p=r?a.height:Math.max(l,d);n.select("."+CLASS.dragarea).attr("x",h).attr("y",f).attr("width",g-h).attr("height",p-f),n.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).filter(function(t){return s&&s.bind(e.api)(t)}).each(function(t,i){var a,n=select(this),r=n.classed(CLASS.SELECTED),s=n.classed(CLASS.INCLUDED),o=!1;if(n.classed(CLASS.circle)){var c=1*+n.attr("cx"),l=1*+n.attr("cy");a=e.togglePoint,o=h<c&&c<g&&f<l&&l<p}else{if(!n.classed(CLASS.bar))return;var u=getPathBox(this),d=(c=u.x,l=u.y,u.width),x=u.height;a=e.togglePath,o=!(g<c||c+d<h||p<l||l+x<f)}o^s&&(n.classed(CLASS.INCLUDED,!s),n.classed(CLASS.SELECTED,!r),a.call(e,!r,n,t,i))})}},dragstart:function(t){var e=this,i=e.config,a=e.state,n=e.$el.main;!e.hasArcType()&&i.data_selection_enabled&&(a.dragStart=t,n.select("."+CLASS.chart).append("rect").attr("class",CLASS.dragarea).style("opacity","0.1"),e.setDragStatus(!0))},dragend:function(){var t=this.config,e=this.$el.main;!this.hasArcType()&&t.data_selection_enabled&&(e.select("."+CLASS.dragarea).transition().duration(100).style("opacity","0").remove(),e.selectAll("."+CLASS.shape).classed(CLASS.INCLUDED,!1),this.setDragStatus(!1))}},selection=_assign(_assign({},drag),{selectPoint:function(t,e,i){var a=this,n=a.config,r=a.$el.main,s=n.axis_rotated,o=(s?a.circleY:a.circleX).bind(a),c=(s?a.circleX:a.circleY).bind(a),l=a.pointSelectR.bind(a);callFn(n.data_onselected,a.api,e,t.node()),r.select("."+CLASS.selectedCircles+a.getTargetSelectorSuffix(e.id)).selectAll("."+CLASS.selectedCircle+"-"+i).data([e]).enter().append("circle").attr("class",function(){return a.generateClass(CLASS.selectedCircle,i)}).attr("cx",o).attr("cy",c).attr("stroke",a.color).attr("r",function(t){return 1.4*a.pointSelectR(t)}).transition().duration(100).attr("r",l)},unselectPoint:function(t,e,i){var a=this.config,n=this.$el;callFn(a.data_onunselected,this.api,e,t.node()),n.main.select("."+CLASS.selectedCircles+this.getTargetSelectorSuffix(e.id)).selectAll("."+CLASS.selectedCircle+"-"+i).transition().duration(100).attr("r",0).remove()},togglePoint:function(t,e,i,a){this[(t?"":"un")+"selectPoint"](e,i,a)},selectPath:function(t,e){var i=this,a=i.config;callFn(a.data_onselected,i.api,e,t.node()),a.interaction_brighten&&t.transition().duration(100).style("fill",function(){return rgb(i.color(e)).brighter(.75)})},unselectPath:function(t,e){var i=this,a=i.config;callFn(a.data_onunselected,i.api,e,t.node()),a.interaction_brighten&&t.transition().duration(100).style("fill",function(){return i.color(e)})},togglePath:function(t,e,i,a){this[(t?"":"un")+"selectPath"](e,i,a)},getToggle:function(t,e){return"path"===t.nodeName?this.togglePath:this.isStepType(e)?function(){}:this.togglePoint},toggleShape:function(t,e,i){var a,n=this,r=n.config,s=n.$el.main,o=select(t),c=o.classed(CLASS.SELECTED),l=n.getToggle(t,e).bind(n);if(r.data_selection_enabled&&r.data_selection_isselectable.bind(n.api)(e)){if(!r.data_selection_multiple){var u="."+CLASS.shapes;r.data_selection_grouped&&(u+=n.getTargetSelectorSuffix(e.id)),s.selectAll(u).selectAll("."+CLASS.shape).each(function(t,e){var i=select(this);i.classed(CLASS.SELECTED)&&(a=i,l(!1,i.classed(CLASS.SELECTED,!1),t,e))})}a&&a.node()===o.node()||(o.classed(CLASS.SELECTED,!c),l(!c,o,e,i))}}}),subchart={initBrush:function(){var t=this,e=t.config,i=t.scale,a=t.$el.subchart,n=e.axis_rotated;t.brush=n?brushY():brushX();var r,s,o=function(){t.redrawForBrush()};t.brush.on("start",function(){"touch"===t.state.inputType&&t.hideTooltip(),o()}).on("brush",o).on("end",function(){r=i.x.orgDomain()}),t.brush.updateResize=function(){var t=this;s&&clearTimeout(s),s=setTimeout(function(){var e=t.getSelection();r&&brushSelection(e.node())&&t.move(e,r.map(i.subX.orgScale()))},0)},t.brush.update=function(){return 0===this.extent()()[1].filter(function(t){return isNaN(t)}).length&&a.main&&a.main.select("."+CLASS.brush).call(this),this},t.brush.scale=function(i){var a,r,s=e.subchart_size_height||(a=t.$el.svg.select("."+CLASS.brush+" .overlay"),r={width:0,height:0},a.size()&&(r.width=+a.attr("width"),r.height=+a.attr("height")),r[n?"width":"height"]),o=t.getExtent();!o&&i.range?o=[[0,0],[i.range()[1],s]]:isArray(o)&&(o=o.map(function(t,e){return[t,e>0?s:e]})),n&&o[1].reverse(),this.extent(o),this.update()},t.brush.getSelection=function(){return a.main?a.main.select("."+CLASS.brush):select([])}},initSubchart:function(){var t=this,e=t.config,i=t.state,a=i.clip,n=i.hasAxis,r=t.$el,s=r.defs,o=r.svg,c=r.subchart,l=r.axis;if(n){var u=e.subchart_show?"visible":"hidden",d=a.id+"-subchart",h=t.getClipPath(d);a.idSubchart=d,t.appendClip(s,d),t.initBrush(),c.main=o.append("g").classed(CLASS.subchart,!0).attr("transform",t.getTranslate("context"));var g=c.main;g.style("visibility",u),g.append("g").attr("clip-path",h).attr("class",CLASS.chart),t.hasType("bar")&&g.select("."+CLASS.chart).append("g").attr("class",CLASS.chartBars),g.select("."+CLASS.chart).append("g").attr("class",CLASS.chartLines),g.append("g").attr("clip-path",h).attr("class",CLASS.brush).call(t.brush),l.subX=g.append("g").attr("class",CLASS.axisX).attr("transform",t.getTranslate("subX")).attr("clip-path",e.axis_rotated?"":a.pathXAxis).style("visibility",e.subchart_axis_x_show?u:"hidden")}},updateTargetsForSubchart:function(t){var e=this,i=e.config,a=e.state,n=e.$el.subchart.main,r=e.getChartClass("Bar"),s=e.getClass("bars",!0),o=e.getChartClass("Line"),c=e.getClass("lines",!0),l=e.getClass("areas",!0);if(i.subchart_show){var u=n.select("."+CLASS.chartBars).selectAll("."+CLASS.chartBar).data(t).attr("class",r);u.enter().append("g").style("opacity","0").attr("class",r).merge(u).append("g").attr("class",s);var d=n.select("."+CLASS.chartLines).selectAll("."+CLASS.chartLine).data(t).attr("class",o),h=d.enter().append("g").style("opacity","0").attr("class",o).merge(d);h.append("g").attr("class",c),e.hasTypeOf("Area")&&h.append("g").attr("class",l),n.selectAll("."+CLASS.brush+" rect").attr(i.axis_rotated?"width":"height",i.axis_rotated?a.width2:a.height2)}},updateBarForSubchart:function(t){var e=this,i=e.$el.subchart;i.bar=i.main.selectAll("."+CLASS.bars).selectAll("."+CLASS.bar).data(e.barData.bind(e)),i.bar.exit().transition().duration(t).style("opacity","0").remove(),i.bar=i.bar.enter().append("path").attr("class",e.getClass("bar",!0)).style("stroke","none").style("fill",e.color).merge(i.bar).style("opacity",e.initialOpacity.bind(e))},redrawBarForSubchart:function(t,e,i){var a=this.$el.subchart.bar;(e?a.transition(getRandom()).duration(i):a).attr("d",t).style("opacity","1")},updateLineForSubchart:function(t){var e=this,i=e.$el.subchart;i.line=i.main.selectAll("."+CLASS.lines).selectAll("."+CLASS.line).data(e.lineData.bind(e)),i.line.exit().transition().duration(t).style("opacity","0").remove(),i.line=i.line.enter().append("path").attr("class",e.getClass("line",!0)).style("stroke",e.color).merge(i.line).style("opacity",e.initialOpacity.bind(e))},redrawLineForSubchart:function(t,e,i){var a=this.$el.subchart.line;(e?a.transition(getRandom()).duration(i):a).attr("d",t).style("opacity","1")},updateAreaForSubchart:function(t){var e=this,i=e.$el.subchart;i.area=i.main.selectAll("."+CLASS.areas).selectAll("."+CLASS.area).data(e.lineData.bind(e)),i.area.exit().transition().duration(t).style("opacity","0").remove(),i.area=i.area.enter().append("path").attr("class",e.getClass("area",!0)).style("fill",e.color).style("opacity",function(){return e.state.orgAreaOpacity=select(this).style("opacity"),"0"}).merge(i.area).style("opacity","0")},redrawAreaForSubchart:function(t,e,i){var a=this.$el.subchart.area;(e?a.transition(getRandom()).duration(i):a).attr("d",t).style("fill",this.color).style("opacity",this.state.orgAreaOpacity)},redrawSubchart:function(t,e,i){var a=this,n=a.config;a.$el.subchart.main.style("visibility",n.subchart_show?"visible":"hidden"),n.subchart_show&&(event&&"zoom"===event.type&&a.brush.update(),t&&(!brushEmpty(a)&&a.brush.update(),Object.keys(i.type).forEach(function(t){var n=capitalize(t),r=a["generateDraw"+n](i.indices[t],!0);a["update"+n+"ForSubchart"](e),a["redraw"+n+"ForSubchart"](r,e,e)})))},redrawForBrush:function(){var t=this.config,e=t.subchart_onbrush,i=t.zoom_rescale,a=this.scale;this.redraw({withTransition:!1,withY:i,withSubchart:!1,withUpdateXDomain:!0,withDimension:!1}),e.bind(this.api)(a.x.orgDomain())},transformContext:function(t,e){var i,a=this.$el.subchart.main;e&&e.axisSubX?i=e.axisSubX:(i=a.select("."+CLASS.axisX),t&&(i=i.transition())),a.attr("transform",this.getTranslate("context")),i.attr("transform",this.getTranslate("subX"))},getExtent:function(){var t=this,e=t.config,i=t.scale,a=e.axis_x_extent;if(a)if(isFunction(a))a=a.bind(t.api)(t.getXDomain(t.data.targets),i.subX);else if(t.axis.isTimeSeries()&&a.every(isNaN)){var n=parseDate.bind(t);a=a.map(function(t){return i.subX(n(t))})}return a}},zoom$1={initZoom:function(){this.scale.zoom=null,this.generateZoom(),this.initZoomBehaviour()},bindZoomEvent:function(t){void 0===t&&(t=!0);var e=this.config,i=this.$el.main,a=e.zoom_enabled,n=i.select("."+CLASS.eventRects);a&&t?!e.subchart_show&&this.bindZoomOnEventRect(n,e.zoom_type):!1===t&&(this.api.unzoom(),n.on(".zoom",null).on(".drag",null))},generateZoom:function(){var t=this,e=t.config,i=t.org,a=t.scale,n=zoom$2().duration(0).on("start",t.onZoomStart.bind(t)).on("zoom",t.onZoom.bind(t)).on("end",t.onZoomEnd.bind(t));n.orgScaleExtent=function(){var i=e.zoom_extent||[1,10];return[i[0],Math.max(t.getMaxDataCount()/i[1],i[1])]},n.updateScaleExtent=function(){var e=diffDomain(t.scale.x.orgDomain())/diffDomain(t.getZoomDomain()),i=this.orgScaleExtent();return this.scaleExtent([i[0]*e,i[1]*e]),this},n.updateTransformScale=function(n){i.xScale&&i.xScale.range(a.x.range());var r=n[e.axis_rotated?"rescaleY":"rescaleX"](i.xScale||a.x),s=t.trimXDomain(r.domain()),o=e.zoom_rescale;r.domain(s,i.xDomain),a.zoom=t.getCustomizedScale(r),t.axis.x.scale(a.zoom),o&&(!i.xScale&&(i.xScale=a.x.copy()),a.x.domain(s))},t.zoom=n},onZoomStart:function(){var t=event.sourceEvent;t&&(this.zoom.startEvent=t,this.state.zooming=!0,callFn(this.config.zoom_onzoomstart,this.api,t))},onZoom:function(){var t=this,e=t.config,i=t.scale,a=t.org,n=event,r=n.sourceEvent;if(e.zoom_enabled&&n.sourceEvent&&0!==t.filterTargetsToShow(t.data.targets).length&&(i.zoom||!(r.type.indexOf("touch")>-1)||1!==r.touches.length)){var s="mousemove"===r.type,o=r.wheelDelta<0,c=n.transform;!s&&o&&i.x.domain().every(function(t,e){return t!==a.xDomain[e]})&&i.x.domain(a.xDomain),t.zoom.updateTransformScale(c),t.axis.isCategorized()&&i.x.orgDomain()[0]===a.xDomain[0]&&i.x.domain([a.xDomain[0]-1e-10,i.x.orgDomain()[1]]),t.redraw({withTransition:!1,withY:e.zoom_rescale,withSubchart:!1,withEventRect:!1,withDimension:!1}),t.state.cancelClick=s,callFn(e.zoom_onzoom,t.api,i.zoom.domain())}},onZoomEnd:function(){var t=this,e=t.config,i=t.scale,a=t.zoom.startEvent,n=event&&event.sourceEvent;a&&a.type.indexOf("touch")>-1&&(a=a.changedTouches[0],n=n.changedTouches[0]),!a||n&&a.clientX===n.clientX&&a.clientY===n.clientY||(t.redrawEventRect(),t.updateZoom(),t.state.zooming=!1,callFn(e.zoom_onzoomend,t.api,i[i.zoom?"zoom":"subX"].domain()))},getZoomDomain:function(){var t=this.config,e=this.org.xDomain,i=e[0],a=e[1];return isDefined(t.zoom_x_min)&&(i=getMinMax("min",[i,t.zoom_x_min])),isDefined(t.zoom_x_max)&&(a=getMinMax("max",[a,t.zoom_x_max])),[i,a]},updateZoom:function(t){var e=this.scale,i=e.subX,a=e.x,n=e.zoom;if(n){var r=n.domain(),s=i.domain(),o=(r[0]<=s[0]||r[0]-.015<=s[0])&&(s[1]<=r[1]||s[1]<=r[1]-.015);(t||o)&&(this.axis.x.scale(i),a.domain(i.orgDomain()),this.scale.zoom=null)}},bindZoomOnEventRect:function(t,e){var i="drag"===e?this.zoomBehaviour:this.zoom;t.call(i).on("dblclick.zoom",null)},initZoomBehaviour:function(){var t,e=this,i=e.config,a=e.state,n=i.axis_rotated,r=0,s=0,o={axis:n?"y":"x",attr:n?"height":"width",index:n?1:0};e.zoomBehaviour=drag$1().clickDistance(4).on("start",function(){e.setDragStatus(!0),e.unselectRect(),t||(t=e.$el.main.append("rect").attr("clip-path",a.clip.path).attr("class",CLASS.zoomBrush).attr("width",n?a.width:0).attr("height",n?0:a.height)),r=mouse(this)[o.index],s=r,t.attr(o.axis,r).attr(o.attr,0),e.onZoomStart()}).on("drag",function(){s=mouse(this)[o.index],t.attr(o.axis,Math.min(r,s)).attr(o.attr,Math.abs(s-r))}).on("end",function(){var i,a=e.scale.zoom||e.scale.x;if(e.setDragStatus(!1),t.attr(o.axis,0).attr(o.attr,0),r>s&&(r=(i=[s,r])[0],s=i[1]),r<0&&(s+=Math.abs(r),r=0),r!==s)e.api.zoom([r,s].map(function(t){return a.invert(t)})),e.onZoomEnd();else if(e.isMultipleX())e.clickHandlerForMultipleXS.bind(this)(e);else{var n=event.sourceEvent||event,c="clientX"in n?[n.clientX,n.clientY]:[n.x,n.y],l=c[0],u=c[1],d=doc.elementFromPoint(l,u);e.clickHandlerForSingleX.bind(d)(select(d).datum(),e)}})},setZoomResetButton:function(){var t=this,e=t.config,i=e.zoom_resetButton;i&&"drag"===e.zoom_type&&(t.zoom.resetBtn?t.zoom.resetBtn.style("display",null):t.zoom.resetBtn=t.$el.chart.append("div").classed(CLASS.button,!0).append("span").on("click",function(){isFunction(i.onclick)&&i.onclick.bind(t.api)(this),t.api.unzoom()}).classed(CLASS.buttonZoomReset,!0).text(i.text||"Reset Zoom"))}},optDataSelection={data_selection_enabled:!1,data_selection_grouped:!1,data_selection_isselectable:function(){return!0},data_selection_multiple:!0,data_selection_draggable:!1,data_onselected:function(){},data_onunselected:function(){}},optSubchart={subchart_show:!1,subchart_size_height:60,subchart_axis_x_show:!0,subchart_axis_x_tick_show:!0,subchart_axis_x_tick_text_show:!0,subchart_onbrush:function(){}},optZoom={zoom_enabled:!1,zoom_type:"wheel",zoom_extent:void 0,zoom_privileged:!1,zoom_rescale:!1,zoom_onzoom:void 0,zoom_onzoomstart:void 0,zoom_onzoomend:void 0,zoom_resetButton:!0,zoom_x_min:void 0,zoom_x_max:void 0},selectionModule=function(){return extend(ChartInternal.prototype,selection),extend(Chart.prototype,apiSelection),Options.setOptions([optDataSelection]),(selectionModule=function(){return!0})()},subchartModule=function(){return extend(ChartInternal.prototype,subchart),Options.setOptions([optSubchart]),(subchartModule=function(){return!0})()},zoomModule=function(){return extend(ChartInternal.prototype,zoom$1),extend(Chart.prototype,apiZoom),Options.setOptions([optZoom]),(zoomModule=function(){return!0})()},defaults={},bb={version:"2.2.3",generate:function(t){var e=mergeObj({},defaults,t),i=new Chart(e);return i.internal.charts=this.instance,this.instance.push(i),i},defaults:function(t){return isObject(t)&&(defaults=t),defaults},instance:[],plugin:{}};export default bb;export{area,areaLineRange,areaSpline,areaSplineRange,areaStep,bar,bb,bubble,donut,gauge,line,pie,radar,scatter,selectionModule as selection,spline,step,subchartModule as subchart,zoomModule as zoom};