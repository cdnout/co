!function(e,n,t,r){"function"==typeof define&&define.amd?(t=Object.values(t),define(e,t,r)):"undefined"!=typeof module&&module.exports?(t=Object.keys(t).map(e=>require(e)),module.exports=r(...t)):(t=Object.values(t).map(e=>n[e]),n[e]=r(...t))}("IOEventStream","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:new Function("return this")(),{"./lib/util.js":"MonioUtil","./io.js":"IO"},function(e,n){"use strict";var{isFunction:t,curry:r}=e;let i={};function u(e,r,i={}){var{bufferSize:u=100,throwBufferOverflow:l=!1,evtOpts:o={}}=i;return n(()=>{var n,i,f=Symbol("force closed"),{pr:a,next:c}=s(),d=async function*(){n=[],i=[],t(e.addEventListener)?e.addEventListener(r,v,o):t(e.addListener)?e.addListener(r,v):t(e.on)&&e.on(r,v);try{for(;;){if(0==n.length){let{pr:e,next:t}=s();n.push(e),i.push(t)}let e=await Promise.race([a,n.shift()]);if(e==f)return;yield e}}finally{t(e.removeEventListener)?e.removeEventListener(r,v,o):t(e.removeListener)?e.removeListener(r,v):t(e.off)&&e.off(r,v),n.length=i.length=0}}(),y=d.return;return d.return=function(...e){var n=y.apply(d,e);return c(f),d.return=y,n},d;function v(e){if(i.length>0)i.shift()(e);else if(n.length<u){let{pr:t,next:r}=s();n.push(t),r(e)}else if(l){let n=new Error("Event stream buffer overflow");throw n.evt=e,n}}})}function l(...e){return n(()=>(async function*(){try{for(;;){let n=f(e);if(!(n.length>0))return;try{if(1==n.length){let[t,r,i]=await n[0];if(i.done)return void(e[t]=null);e[t]=r,yield i.value}else{let[t,r,i]=await Promise.race(n);e[t]=null,i.done||(e.push(r),yield i.value)}}catch(e){return Promise.reject(e)}}}finally{await a(e)}})())}function o(...e){return n(()=>(async function*(){try{for(;;){let n=f(e);if(!(n.length>0))return;try{let t=(await Promise.all(n)).reduce(function(n,t){var[r,i,u]=t;return u.done?(e[r]=null,n):(e[r]=i,[...n,u.value])},[]);if(!(t.length>0))return;yield t}catch(e){return Promise.reject(e)}}}finally{await a(...e).run()}})())}function f(e){return e.map(function(n,r){return n&&t(n.next)?(e[r]=async function(){var t=n.next();try{let i=await t;return e[r]=[r,n,i]}catch(n){return e[r]=null,t}}(),e[r]):n}).filter(Boolean)}function a(...e){return n(()=>Promise.all(e.map(async function(e){if(e&&t(e.return))try{return await e.return()}catch(e){}})))}function s(){var e;return{pr:new Promise(n=>e=n),next:e}}return(i=u=Object.assign(r(u,2),{merge:l,zip:o,close:a})).merge=l,i.zip=o,i.close=a,i});