/*! Monio: async-either.mjs
    v0.15.0 (c) 2021 Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
import{isFunction,isPromise}from"./lib/util.mjs";import Either from"./either.mjs";var brand={};export default Object.assign(AsyncEither,{Left:AsyncLeft,Right:AsyncRight,of:AsyncRight,pure:AsyncRight,unit:AsyncRight,is:is,fromFoldable:fromFoldable,fromPromise:fromPromise});function AsyncLeft(r){return AsyncEither(Either.Left(r))}function AsyncRight(r){return AsyncEither(Either.Right(r))}function AsyncEither(r){return fromPromise(isPromise(r)?r:Either.Left.is(r)?Promise.reject(r):Promise.resolve(r))}function fromPromise(r){r=splitPromise(r);var i={map:function map(i){var handle=r=>{var _doMap=i=>{var t=r.chain(i);return isPromise(t)?splitPromise(t):r._is_right()?t:Promise.reject(t)};return isPromise(i)?i.then(_doMap):_doMap(i)};return AsyncEither(r.then(handle,handle))},chain:chain,flatMap:chain,bind:chain,ap:function ap(i){return i.map(r)},concat:function concat(i){return i.map((i=>r.then((r=>r.concat(i)))))},fold:function fold(i,t){var handle=r=>i=>i.fold((i=>Promise.reject(r(i))),r);return r.then(handle(t),handle(i))},_inspect:function _inspect(){return`${i[Symbol.toStringTag]}(Promise)`},_is:function _is(r){return r===brand},[Symbol.toStringTag]:"AsyncEither"};return i;function chain(i){var handle=r=>{var _doChain=i=>{var t=r.chain(i);return is(t)?t.fold((r=>r),(r=>r)):Either.is(t)?t.fold((r=>Promise.reject(r)),(r=>r)):t};return isPromise(i)?i.then(_doChain):_doChain(i)};return AsyncEither(r.then(handle,handle))}}function is(r){return r&&isFunction(r._is)&&r._is(brand)}function fromFoldable(r){return r.fold(AsyncEither.Left,AsyncEither.Right)}function splitPromise(r){return r.then((r=>Either.is(r)?r:Either.Right(r)),(r=>Promise.reject(Either.is(r)?r:Either.Left(r))))}function toPromise(r){return new Promise(((i,t)=>r.fold((r=>t(Either.Left(r))),(r=>i(Either.Right(r))))))}