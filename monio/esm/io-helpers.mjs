/*! Monio: io-helpers.mjs
    v0.24.2 (c) 2021 Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
import{isFunction,isPromise,isMonad,liftM,curry}from"./lib/util.mjs";import IO from"./io.mjs";import Maybe from"./maybe.mjs";import Either from"./either.mjs";var returnedValues=new WeakSet;export default{log:log,getReader:getReader,waitAll:waitAll,applyIO:applyIO,doIO:doIO,doEIO:doEIO,doIOBind:doIOBind,doEIOBind:doEIOBind,listFilterInIO:listFilterInIO,listFilterOutIO:listFilterOutIO,listConcatIO:listConcatIO,iif:iif,elif:elif,els:els,iNot:iNot,iReturn:iReturn,wasReturned:wasReturned,ifReturned:ifReturned,getPropIO:getPropIO,assignPropIO:assignPropIO};export{log};export{getReader};export{waitAll};export{applyIO};export{doIO};export{doEIO};export{doIOBind};export{doEIOBind};export{listFilterInIO};export{listFilterOutIO};export{listConcatIO};export{iif};export{elif};export{els};export{iNot};export{iReturn};export{wasReturned};export{ifReturned};export{getPropIO};export{assignPropIO};function log(...t){return IO((()=>console.log(...t)))}function getReader(){return IO((t=>t))}function waitAll(...t){return IO((r=>Promise.all(t.map((t=>liftIO(r,t).run(r))))))}function applyIO(t,r){return IO((()=>t.run(r)))}function doIO(t,...r){return r.length>0?IO((e=>IO.do(t(e,...r)).run(e))):IO.do(t)}function doEIO(t,...r){return r.length>0?IO((e=>IO.doEither(t(e,...r)).run(e))):IO.doEither(t)}function doIOBind(t,r){var e=IO((()=>IO.do(t).run(r)));return(...n)=>n.length>0?IO((()=>IO.do(t(r,...n)).run(r))):e}function doEIOBind(t,r){var e=IO((()=>IO.doEither(t).run(r)));return(...n)=>n.length>0?IO((()=>IO.doEither(t(r,...n)).run(r))):e}function listFilterInIO(t,r){return listConcatIO(r.map((r=>t(r).map((t=>t?[r]:[])))))}function listFilterOutIO(t,r){return listFilterInIO((r=>iNot(t(r))),r)}function listConcatIO(t){return t.reduce(((t,r)=>t.concat(r)),IO.of([]))}function iif(t,r,...e){return IO((n=>liftIO(n,t).chain((function doThens(t){return t?(r=isFunction(r)?r():r,(r=Array.isArray(r)?r:[r]).reduce(((t,r)=>t.chain((t=>liftIO(n,t).chain((t=>returnedValues.has(t)?IO.of(t):liftIO(n,r)))))),IO.of()).chain((r=>liftIO(n,r).chain((r=>IO.of(returnedValues.has(r)?r:t)))))):IO.of(t)})).chain(function doNextElse(t){return r=>!r&&t.length>0?liftIO(n,t[0]).chain(doNextElse(t.slice(1))):IO.of(r)}(e)).run(n)))}function elif(t,r){return iif(t,r)}function els(t){return iif(!0,t)}function iReturn(t){return IO((r=>liftIO(r,t).map((t=>{var r={returned:t};return returnedValues.add(r),r})).run(r)))}function iNot(t){return IO((r=>liftIO(r,t).map((t=>!t)).run(r)))}function wasReturned(t){return returnedValues.has(t)}function ifReturned(t){return t.map((t=>wasReturned(t)?t.returned:void 0))}function getPropIO(t,r){return liftM(r).chain((r=>IO((()=>r[t]))))}function assignPropIO(t,r,e){return liftM(r).chain((r=>liftM(e).chain((e=>IO((()=>e[t]=r))))))}function liftIO(t,r){if(isMonad(r)){if(IO.is(r))return r;if(Either.Left.is(r)||Maybe.Nothing.is(r)){let t={returned:r};return returnedValues.add(t),IO.of(t)}{let t=r.chain(IO.of);return IO.is(t)?t:IO.of(r)}}return isFunction(r)?liftIO(t,r(t)):r&&"object"==typeof r&&isFunction(r.next)?IO.do(r):IO.of(r)}