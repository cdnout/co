/*! Monio: io-helpers.mjs
    v0.15.0 (c) 2021 Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
import{isFunction,isPromise,isMonad}from"./lib/util.mjs";import IO from"./io.mjs";import Maybe from"./maybe.mjs";import Either from"./either.mjs";var returnedValues=new WeakSet;export{applyIO};export{doIO};export{doIOBind};export{filterIOList};export{concatIOList};export{iif};export{elif};export{els};export{iNot};export{iReturn};export{wasReturned};function applyIO(r,t){return IO((()=>r.run(t)))}function doIO(r,...t){return t.length>0?IO((e=>IO.do(r(e,...t)).run(e))):IO.do(r)}function doIOBind(r,t){var e=IO((()=>IO.do(r).run(t)));return(...n)=>n.length>0?IO((()=>IO.do(r(t,...n)).run(t))):e}function filterIOList(r,t){return t.reduce(((t,e)=>t.chain((t=>r(e).map((r=>r?[...t,e]:t))))),IO.of([]))}function concatIOList(r){return r.reduce(((r,t)=>r.map((r=>[...r,t]))),IO.of([]))}function iif(r,t,...e){return IO((n=>liftIO(n,r).chain((function doThens(r){return r?(Array.isArray(t)?t:[t]).reduce(((r,t)=>r.chain((r=>liftIO(n,r).chain((r=>returnedValues.has(r)?IO.of(r):liftIO(n,t)))))),IO.of()).chain((t=>liftIO(n,t).chain((t=>IO.of(returnedValues.has(t)?t:r))))):IO.of(r)})).chain(function doNextElse(r){return t=>!t&&r.length>0?liftIO(n,r[0]).chain(doNextElse(r.slice(1))):IO.of(t)}(e)).run(n)))}function elif(r,t){return iif(r,t)}function els(r){return iif(!0,r)}function iReturn(r){return IO((t=>liftIO(t,r).map((r=>{var t={returned:r};return returnedValues.add(t),t})).run(t)))}function iNot(r){return IO((t=>liftIO(t,r).map((r=>!r)).run(t)))}function wasReturned(r){return returnedValues.has(r)}function liftIO(r,t){if(isMonad(t)){if(IO.is(t))return t;if(Either.Left.is(t)||Maybe.Nothing.is(t)){let r={returned:t};return returnedValues.add(r),IO.of(r)}{let r=t.chain(IO.of);return IO.is(r)?r:IO.of(t)}}return isFunction(t)?liftIO(r,t(r)):t&&"object"==typeof t&&isFunction(t.next)?IO.do(t):IO.of(t)}