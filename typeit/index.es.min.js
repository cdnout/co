var isArray=e=>Array.isArray(e),asArray=e=>isArray(e)?e:[e];let Queue=function(e){function t(e){return asArray(e).forEach(e=>r.set(Symbol(e.char?.innerText),{...e})),this}let n=()=>Array.from(r.values());let r=new Map;return t(e),{add:t,set:function(e,t){var n=r.keys();r.set(n[e],t)},wipe:function(){r=new Map,t(e)},reset:function(){r.forEach(e=>delete e.done)},destroy:e=>r.delete(e),done:(e,t=!1)=>t?r.delete(e):r.get(e).done=!0,getItems:(e=!1)=>e?n():n().filter(e=>!e.done),getQueue:()=>r,getTypeable:()=>n().filter(e=>e.typeable)}};var toArray=e=>Array.from(e),createTextNode=e=>document.createTextNode(e);let expandTextNodes=e=>([...e.childNodes].forEach(t=>{if(t.nodeValue)return[...t.nodeValue].forEach(e=>{t.parentNode.insertBefore(createTextNode(e),t)}),void t.remove();expandTextNodes(t)}),e);var getParsedBody=e=>{let t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,expandTextNodes(t.body)};const DATA_ATTRIBUTE="data-typeit-id",CURSOR_CLASS="ti-cursor",END="END",DEFAULT_STATUSES={started:!1,completed:!1,frozen:!1,destroyed:!1},DEFAULT_OPTIONS={breakLines:!0,cursor:!0,cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:!0,lifeLike:!0,loop:!1,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:!1,strings:[],waitUntilVisible:!1,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}},PLACEHOLDER_CSS=`[${DATA_ATTRIBUTE}]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}`;function walkElementNodes(e,t=!1){let n=document.createTreeWalker(e,NodeFilter.SHOW_ALL,{acceptNode:e=>e.classList?.contains(CURSOR_CLASS)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),r,a=[];for(;r=n.nextNode();)r.originalParent=r.parentNode,a.push(r);return t?a.reverse():a}function chunkStringAsHtml(e){return walkElementNodes(getParsedBody(e))}function maybeChunkStringAsHtml(e,t=!0){return t?chunkStringAsHtml(e):toArray(e).map(createTextNode)}var createElement=e=>document.createElement(e),appendStyleBlock=(e,t="")=>{let n=createElement("style");n.id=t,n.appendChild(createTextNode(e)),document.head.appendChild(n)},calculateDelay=e=>e=isArray(e)?e:[e/2,e/2],randomInRange=(e,t)=>Math.abs(Math.random()*(e+t-(e-t))+(e-t));let range=e=>e/2;function calculatePace(e){let{speed:t,deleteSpeed:n,lifeLike:r}=e;return n=null!==n?n:t/3,r?[randomInRange(t,range(t)),randomInRange(n,range(n))]:[t,n]}var destroyTimeouts=e=>(e.forEach(clearTimeout),[]),generateHash=()=>Math.random().toString().substring(2,9),isInput=e=>"value"in e;let getAllChars=e=>isInput(e)?toArray(e.value):walkElementNodes(e,!0).filter(e=>!(0<e.childNodes.length));var fireWhenVisible=(n,r)=>{let e=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(r(),t.unobserve(n))})},{threshold:1});e.observe(n)};let handleFunctionalArg=e=>"function"==typeof e?e():e;var isNumber=e=>Number.isInteger(e);let select=(e,t=document,n=!1)=>t["querySelector"+(n?"All":"")](e),isBodyElement=e=>"BODY"===e?.tagName,insertIntoElement=(t,n)=>{if(isInput(t))t.value=""+t.value+n.textContent;else{n.innerHTML="";let e=!isBodyElement(n.originalParent)&&n.originalParent||t;e.insertBefore(n,select("."+CURSOR_CLASS,e)||null)}},updateCursorPosition=(e,t,n)=>Math.min(Math.max(t+e,0),n.length);var merge=(e,t)=>Object.assign({},e,t),removeNode=t=>{if(t){var n=t.parentNode;let e=1<n.childNodes.length?t:n;e.remove()}},repositionCursor=(e,t,n)=>{t=t[n-1],n=select("."+CURSOR_CLASS,e);(e=t?.parentNode||e).insertBefore(n,t||null)};function selectorToElement(e){return"string"==typeof e?select(e):e}var isNonVoidElement=e=>/<(.+)>(.*?)<\/(.+)>/.test(e.outerHTML);let wait=async(t,n,r)=>new Promise(e=>{r.push(setTimeout(async()=>{await t(),e()},n||0))}),cursorFontStyles={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"","margin-left":"-.125em","margin-right":".125em"},setCursorStyles=(e,t,n)=>{var r=`[${DATA_ATTRIBUTE}='${e}']`+" ."+CURSOR_CLASS;let a=getComputedStyle(n);n=Object.entries(cursorFontStyles).reduce((e,[t,n])=>`${e} ${t}: var(--ti-cursor-${t}, ${n||a[t]});`,"");appendStyleBlock(`@keyframes blink-${e} { 0% {opacity: 0} 49% {opacity: 0} 50% {opacity: 1} } ${r} { display: inline; letter-spacing: -1em; ${n} animation: blink-${e} ${t.cursorSpeed/1e3}s infinite; } ${r}.with-delay { animation-delay: 500ms; } ${r}.disabled { animation: none; }`,e)};var duplicate=(e,t)=>new Array(t).fill(e);const countStepsToSelector=({queueItems:e,selector:r,cursorPosition:t,to:n})=>{if(isNumber(r))return-1*r;let a=new RegExp(END,"i").test(n),i=r?[...e].reverse().findIndex(({char:e})=>{let t=e.parentElement;var n=t.matches(r);return!(!a||!n)||n&&t.firstChild.isSameNode(e)}):-1;i<0&&(i=a?0:e.length-1);n=a?0:1;return i-t+n};let fireItem=async(e,t)=>{let n=async()=>e.func?.call(globalThis);e.delay?await t(async()=>{await n()},e.delay):await n()};const TypeIt=function(e,t={}){let a=async(e,t,n=!1)=>{b.frozen&&await new Promise(e=>{this.unfreeze=()=>{b.frozen=!1,e()}}),n||await N.beforeStep(this),await wait(e,t,A),n||await N.afterStep(this)},n=()=>isInput(T),o=(e=0)=>calculatePace(N)[e],r=()=>getAllChars(T),s=(e,t)=>{L.add(e);var[e={}]=[t];return(e=e.delay)&&L.add({delay:e}),this},u=()=>E??v,c=(e={})=>[{func:()=>m(e)},{func:()=>m(N)}],i=e=>{var t=N.nextStringDelay;L.add([{delay:t[0]},...e,{delay:t[1]}])};let l=async()=>{!n()&&D&&T.appendChild(D),w&&setCursorStyles(C,N,T)},d=e=>{w&&D&&(D.classList.toggle("disabled",e),D.classList.toggle("with-delay",!e))};var y=()=>{let n=N.strings.filter(e=>!!e);n.forEach((e,t)=>{this.type(e),t+1!==n.length&&(e=N.breakLines?[{func:()=>p(createElement("BR")),typeable:!0}]:duplicate({func:S,delay:o(1)},L.getTypeable().length),i(e))})};let h=async(e=!0)=>{b.started=!0;try{for(var[t,n]of L.getQueue())n.done||(n.typeable&&!b.frozen&&d(!0),await fireItem(n,a),d(!1),L.done(t,!e));if(!e)return this;if(b.completed=!0,await N.afterComplete(this),!N.loop)throw"";let r=N.loopDelay;a(async()=>{var e,t=r[0],n=u();n&&await f({value:n});for(e of L.getTypeable())await a(S,o(1));L.reset(),L.set(0,{delay:t}),await 0,h()},r[1])}catch(e){}return this},f=async e=>{v=updateCursorPosition(e,v,r()),repositionCursor(T,r(),v)},p=e=>insertIntoElement(T,e),m=async e=>N=merge(N,e),g=async()=>{n()?T.value="":r().forEach(removeNode)},S=()=>{var e=r();e.length&&(n()?T.value=T.value.slice(0,-1):removeNode(e[v]))},T=(this.break=function(e){return s({func:()=>p(createElement("BR")),typeable:!0},e)},this.delete=function(e=null,t={}){e=handleFunctionalArg(e);var n=c(t);let r=e,{instant:a,to:i}=t,l=L.getTypeable();e=null===r?l.length:isNumber(r)?r:countStepsToSelector({queueItems:l,selector:r,cursorPosition:u(),to:i});return s([n[0],...duplicate({func:S,delay:a?0:o(1)},e),n[1]],t)},this.empty=function(e={}){return s({func:g},e)},this.exec=function(e,t={}){var n=c(t);return s([n[0],{func:()=>e(this)},n[1]],t)},this.move=function(e,t={}){e=handleFunctionalArg(e);var n=c(t),{instant:r,to:a}=t,e=countStepsToSelector({queueItems:L.getTypeable(),selector:null===e?"":e,to:a,cursorPosition:u()});let i=e<0?-1:1;return E=u()+e,s([n[0],...duplicate({func:()=>f(i),delay:r?0:o()},Math.abs(e)),n[1]],t)},this.options=function(e,t={}){return e=handleFunctionalArg(e),m(e),s({},t)},this.pause=function(e,t={}){return s({delay:handleFunctionalArg(e)},t)},this.type=function(e,t={}){e=handleFunctionalArg(e);let n=t["instant"];var r=c(t);let a=maybeChunkStringAsHtml(e,N.html);var i=a.map(e=>({func:()=>p(e),char:e,delay:n||isNonVoidElement(e)?0:o(),typeable:e.nodeType===Node.TEXT_NODE})),i=[r[0],{func:async()=>N.beforeString(e,this)},...i,{func:async()=>N.afterString(e,this)},r[1]];return s(i,t)},this.is=function(e){return b[e]},this.destroy=function(e=!0){A=destroyTimeouts(A),handleFunctionalArg(e)&&D&&removeNode(D),b.destroyed=!0},this.freeze=function(){b.frozen=!0},this.unfreeze=()=>{},this.reset=function(e){for(var t in this.is("destroyed")||this.destroy(),e?(L.wipe(),e(this)):L.reset(),v=0,b)b[t]=!1;return T[n()?"value":"innerHTML"]="",this},this.go=function(){return b.started?this:(l(),N.waitUntilVisible?fireWhenVisible(T,h.bind(this)):h(),this)},this.flush=function(e=()=>{}){return l(),h(!1).then(e),this},this.getQueue=()=>L,this.getOptions=()=>N,this.updateOptions=e=>m(e),this.getElement=()=>T,selectorToElement(e)),A=[],v=0,E=null,b=merge({},DEFAULT_STATUSES),N=merge(DEFAULT_OPTIONS,t),C=(N=merge(N,{html:!n()&&N.html,nextStringDelay:calculateDelay(N.nextStringDelay),loopDelay:calculateDelay(N.loopDelay)}),generateHash()),L=Queue([{func:()=>{},delay:N.startDelay}]),w=(T.dataset.typeitId=C,appendStyleBlock(PLACEHOLDER_CSS),N.cursor&&!n()),D=(()=>{if(!n()){let e=createElement("span");return(e.className=CURSOR_CLASS,w)?(e.innerHTML=getParsedBody(N.cursorChar).innerHTML,e):(e.style.visibility="hidden",e)}})();N.strings=(e=>{let t=T.innerHTML;if(!t)return e;if(T.innerHTML="",N.startDelete)return T.innerHTML=t,expandTextNodes(T),i([{func:S}]),e;let n=t.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/);return n.concat(e)})(asArray(N.strings)),N.strings.length&&y()};export{TypeIt as default};