!function(e){var t,r={init:function(){},start:function(){},complete:function(){},progress:function(e,t,r){t.css({height:e+"%","line-height":r.height()*e/100+"px","vertical-align":"middle"}),t.find(".bar").html(e+"%")},before:function(e,t,r){return!0},error:function(e,t,r){return console.error("Error:",e),0},traverse:function(e,t,a){if("undefined"!=typeof e){r.fileCnt=e.length;for(var n=0,o=e.length;o>n;n++)r.control(e[n],t,a)}else a.html(nosupport)},control:function(a,n,o){var i=a.name.toLowerCase().split(/\./);i=i[i.length-1];var s=e(o).data("type")&&e(o).data("type").split(/,/)||[];return n.data("type")&&!s.indexOf(a.type)?(t.error({error:"only image files: "+n.data("type")},n,o),!1):a.size>1048576*t.maxsize?(t.error({error:"max upload size: "+t.maxsize+"Mb"},n,o),!1):t.before(a,n,o)===!1?void console.warn("doparea upload cancelled by `before` filter"):void(/image/i.test(a.type)&&n.data("canvas")?r.resize(a,n,o):r.upload(a,n,o))},resize:function(a,n,o){var i=a.name,s=document.createElement("canvas"),d=document.createElement("img"),l=0|n.data("width"),p=0|n.data("height"),u=new FileReader;u.onloadend=function(u){d.src=u.target.result;var c=d.width,v=d.height,f=n.data("crop");(l&&c>l||p&&v>p)&&(ratio=c/v,(ratio>=1||0==p)&&l&&!f?(c=l,v=l/ratio):f&&ratio<=l/p?(c=l,v=l/ratio):(c=p*ratio,v=p)),s.width=c,s.height=v;var h=s.getContext("2d");h.drawImage(d,0,0,c,v);var m=s.toDataURL("image/jpeg");return m.length<=6?(t.error({error:"Image did not created. Please, try again."},n,o),0):(a=r.dataURItoBlob(m),a.name=i,n.data("post")?r.upload(a,n,o):(e(s).appendTo(o),n.attr("disabled","disabled"),e("<input>").attr("name",n.attr("name")).val(m).insertAfter(n)),void 0)},u.readAsDataURL(a)},upload:function(r,a,n){this.fileCnt>1?n.empty():n.children("div").empty();var o=e('<div class="progress"><div class="bar"></div></div>');n.append(o);var i=new XMLHttpRequest;i.open("post",a.data("post"),!0);var s=e('meta[name="csrf-token"]').attr("content");s&&i.setRequestHeader("X-CSRF-Token",s),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var r=Math.ceil(e.loaded/e.total*100);t.progress?t.progress(r,o,n):o.html(r+"%")}},!1),i.addEventListener("load",function(e){if("200"!=e.target.status)return void t.error({error:e.target.statusText},a,n);var i=jQuery.parseJSON(e.target.responseText);t.complete(i,r,a,n),o.addClass("uploaded"),o.html(t.uploaded).fadeOut("slow")},!1);var d=new FormData;for(var l in a.data())"object"!=typeof a.data(l)&&d.append(l,a.data(l));d.append(a.attr("name"),r),i.send(d)},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(t.length),n=new Uint8Array(a),o=0;o<t.length;o++)n[o]=t.charCodeAt(o);var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);return i.append(a),i.getBlob(r)}};e.fn.droparea=function(a){return t={init:r.init,start:r.start,complete:r.complete,error:r.error,before:r.before,instructions:"drop a file to here",over:"drop file here!",nosupport:"No support for the File API in this web browser",noimage:"Unsupported file type!",uploaded:"Uploaded",maxsize:"10",wrap_container:!1,handle_click:!1},a&&e.extend(t,a),this.each(function(){var a=e(this),n=e(this).children("input")||e(this),o=e('<div class="instructions"></div>');a.prepend(o),1==t.wrap_container&&(a=e("<div"+(e(this).attr("class")?' class="'+e(this).attr("class")+'"':"")+">").insertAfter(e(this)),o=e("<div>").appendTo(a),n=e(this).appendTo(a)),t.init(e(this)),n.data("value")&&n.data("value").length?e('<img src="'+n.data("value")+'">').appendTo(a):o.addClass("instructions").html(t.instructions),t.handle_click===!0&&n.css({position:"absolute",top:"-1000px"}),e(document).bind({dragleave:function(e){e.preventDefault(),n.data("value")||a.find("img").length?o.removeClass("over").empty():o.removeClass("over").html(t.instructions)},drop:function(e){e.preventDefault(),n.data("value")||a.find("img").length?o.removeClass("over").empty():o.removeClass("over").html(t.instructions)},dragenter:function(e){e.preventDefault(),o.addClass("instructions over").html(t.over)},dragover:function(e){e.preventDefault(),o.addClass("instructions over").html(t.over)}}),this.addEventListener("drop",function(i){i.preventDefault(),t.start(e(this)),r.traverse(i.dataTransfer.files,n,a),o.removeClass("over").empty(),n.val("")},!1),this.addEventListener("click",function(e){n.click()}),n.change(function(e){r.traverse(e.target.files,n,a),n.val("")})}),this}}(jQuery);
//# sourceMappingURL=droparea.min.js.map