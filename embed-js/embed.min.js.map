{"version":3,"file":"embed.min.js","sources":["../../../node_modules/just-extend/index.js","../src/index.js","../../../node_modules/p-reduce/index.js","../../../node_modules/is-dom/index.js","../../../node_modules/is-in-browser/dist/module.js","../../../node_modules/p-waterfall/index.js"],"sourcesContent":["module.exports = extend;\n\n/*\n  var obj = {a: 3, b: 5};\n  extend(obj, {a: 4, c: 8}); // {a: 4, b: 5, c: 8}\n  obj; // {a: 4, b: 5, c: 8}\n\n  var obj = {a: 3, b: 5};\n  extend({}, obj, {a: 4, c: 8}); // {a: 4, b: 5, c: 8}\n  obj; // {a: 3, b: 5}\n\n  var arr = [1, 2, 3];\n  var obj = {a: 3, b: 5};\n  extend(obj, {c: arr}); // {a: 3, b: 5, c: [1, 2, 3]}\n  arr.push(4);\n  obj; // {a: 3, b: 5, c: [1, 2, 3, 4]}\n\n  var arr = [1, 2, 3];\n  var obj = {a: 3, b: 5};\n  extend(true, obj, {c: arr}); // {a: 3, b: 5, c: [1, 2, 3]}\n  arr.push(4);\n  obj; // {a: 3, b: 5, c: [1, 2, 3]}\n\n  extend({a: 4, b: 5}); // {a: 4, b: 5}\n  extend({a: 4, b: 5}, 3); {a: 4, b: 5}\n  extend({a: 4, b: 5}, true); {a: 4, b: 5}\n  extend('hello', {a: 4, b: 5}); // throws\n  extend(3, {a: 4, b: 5}); // throws\n*/\n\nfunction extend(/* [deep], obj1, obj2, [objn] */) {\n  var args = [].slice.call(arguments);\n  var deep = false;\n  if (typeof args[0] == 'boolean') {\n    deep = args.shift();\n  }\n  var result = args[0];\n  if (!result || (typeof result != 'object' && typeof result != 'function')) {\n    throw new Error('extendee must be an object');\n  }\n  var extenders = args.slice(1);\n  var len = extenders.length;\n  for (var i = 0; i < len; i++) {\n    var extender = extenders[i];\n    for (var key in extender) {\n      if (extender.hasOwnProperty(key)) {\n        var value = extender[key];\n        if (deep && isCloneable(value)) {\n          var base = Array.isArray(value) ? [] : {};\n          result[key] = extend(true, result.hasOwnProperty(key) ? result[key] : base, value);\n        } else {\n          result[key] = value;\n        }\n      }\n    }\n  }\n  return result;\n}\n\nfunction isCloneable(obj) {\n  return Array.isArray(obj) || {}.toString.call(obj) == '[object Object]';\n}\n","import extend from \"just-extend\"\nimport pWaterfall from \"p-waterfall\"\nimport isDom from \"is-dom\"\nimport isBrowser from \"is-in-browser\"\n\n/**\n * Returns the embed code to be added at the end of original string.\n * @param embeds\n * @returns {string}\n */\nfunction combineEmbedsText(embeds) {\n  return embeds\n    .sort((a, b) => a.index - b.index)\n    .map(({ content }) => content)\n    .join(\" \")\n}\n\n/**\n * Add the embed code at the end of string and return the new string\n * @param text - original string\n * @param _embeds - Array of embed code\n * @returns {string}\n */\nfunction appendEmbedsAtEnd({ result, _embeds }) {\n  return `${result} ${combineEmbedsText(_embeds)}`\n}\n\nfunction isElementPresent({ input, target }) {\n  return isDom(input) || (target && isDom(target))\n}\n\nexport default class EmbedJS {\n  constructor(options) {\n    const defaultOptions = {\n      plugins: [],\n      preset: null,\n\n      // By default this plugin supports client side. If you want to use this\n      // on both client and server side, you need to pass a custom isomorphic\n      // implementation of fetch.\n      // Eg: fetch: require('isomorphic-unfetch')\n\n      // This hasn't been included as part of the plugin so that the browser build is small.\n      fetch: isBrowser && (window.fetch || window.unfetch),\n\n      inlineEmbed: true,\n      replaceUrl: false,\n      _embeds: [],\n      _services: []\n    }\n\n    let { input, plugins = [], preset } = options\n    if (!input) {\n      throw new Error(\n        \"You need to pass input element or string in the options object.\"\n      )\n    }\n\n    const inputString = isDom(input) ? input.innerHTML : input\n\n    this.options = extend({}, defaultOptions, options, {\n      result: inputString,\n      plugins: preset ? plugins.concat(preset) : plugins,\n      inputString\n    })\n  }\n\n  text() {\n    const options = this.resetOptions()\n    const transformers = options.plugins.map(p => p.transform)\n    return pWaterfall(transformers, options)\n  }\n\n  resetOptions() {\n    return extend({}, this.options, {\n      _embeds: []\n    })\n  }\n\n  load() {\n    this.options.plugins.forEach(p => p.onLoad && p.onLoad(this.options))\n  }\n\n  async render() {\n    const { input, target, inlineEmbed } = this.options\n    if (!isElementPresent(this.options)) {\n      throw new Error(\"You haven't passed the input as an element.\")\n    }\n\n    let options\n    if (isDom(input) && input.classList.contains(\"ejs-applied\")) {\n      options = this.options\n    } else {\n      options = await this.text()\n\n      const element = target || input\n      element.innerHTML = inlineEmbed\n        ? options.result\n        : appendEmbedsAtEnd(options)\n      element.classList.add(\"ejs-applied\")\n    }\n\n    this.load()\n    return options\n  }\n\n  destroy() {\n    const { inputString, input, target } = this.options\n    if (!isElementPresent(this.options)) {\n      throw new Error(\"You haven't passed the input as an element.\")\n    }\n    const element = target || input\n    element.innerHTML = inputString\n    element.classList.remove(\"ejs-applied\")\n    return this.options\n  }\n}\n","'use strict';\nmodule.exports = (iterable, reducer, initVal) => new Promise((resolve, reject) => {\n\tconst iterator = iterable[Symbol.iterator]();\n\tlet i = 0;\n\n\tconst next = total => {\n\t\tconst el = iterator.next();\n\n\t\tif (el.done) {\n\t\t\tresolve(total);\n\t\t\treturn;\n\t\t}\n\n\t\tPromise.all([total, el.value])\n\t\t\t.then(value => {\n\t\t\t\tnext(reducer(value[0], value[1], i++));\n\t\t\t})\n\t\t\t.catch(reject);\n\t};\n\n\tnext(initVal);\n});\n","module.exports = isNode\n\nfunction isNode (val) {\n  return (!val || typeof val !== 'object')\n    ? false\n    : (typeof window === 'object' && typeof window.Node === 'object')\n      ? (val instanceof window.Node)\n      : (typeof val.nodeType === 'number') &&\n        (typeof val.nodeName === 'string')\n}\n","var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexport var isBrowser = (typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\" && (typeof document === \"undefined\" ? \"undefined\" : _typeof(document)) === 'object' && document.nodeType === 9;\n\nexport default isBrowser;\n","'use strict';\nconst pReduce = require('p-reduce');\n\nmodule.exports = (iterable, initVal) => pReduce(iterable, (prev, fn) => fn(prev), initVal);\n"],"names":["extend","args","slice","call","arguments","deep","shift","result","Error","extenders","len","length","i","extender","key","hasOwnProperty","value","obj","Array","isArray","toString","isCloneable","base","isElementPresent","ref","input","target","isDom","module","iterable","reducer","initVal","Promise","resolve","reject","const","iterator","Symbol","next","total","el","done","all","then","catch","val","window","Node","nodeType","nodeName","_typeof","constructor","prototype","isBrowser","document","EmbedJS","options","defaultOptions","fetch","unfetch","preset","inputString","innerHTML","plugins","concat","text","this","resetOptions","pReduce","prev","fn","pWaterfall","map","p","transform","load","forEach","onLoad","render","inlineEmbed","classList","contains","$await_2","sort","a","b","index","join","appendEmbedsAtEnd","add","destroy","element","remove"],"mappings":"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"}