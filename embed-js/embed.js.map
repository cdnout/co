{"version":3,"file":"embed.js","sources":["../../../node_modules/just-extend/index.js","../../../node_modules/p-reduce/index.js","../../../node_modules/p-waterfall/index.js","../../../node_modules/is-dom/index.js","../../../node_modules/is-in-browser/dist/module.js","../src/index.js"],"sourcesContent":["module.exports = extend;\n\n/*\n  var obj = {a: 3, b: 5};\n  extend(obj, {a: 4, c: 8}); // {a: 4, b: 5, c: 8}\n  obj; // {a: 4, b: 5, c: 8}\n\n  var obj = {a: 3, b: 5};\n  extend({}, obj, {a: 4, c: 8}); // {a: 4, b: 5, c: 8}\n  obj; // {a: 3, b: 5}\n\n  var arr = [1, 2, 3];\n  var obj = {a: 3, b: 5};\n  extend(obj, {c: arr}); // {a: 3, b: 5, c: [1, 2, 3]}\n  arr.push(4);\n  obj; // {a: 3, b: 5, c: [1, 2, 3, 4]}\n\n  var arr = [1, 2, 3];\n  var obj = {a: 3, b: 5};\n  extend(true, obj, {c: arr}); // {a: 3, b: 5, c: [1, 2, 3]}\n  arr.push(4);\n  obj; // {a: 3, b: 5, c: [1, 2, 3]}\n\n  extend({a: 4, b: 5}); // {a: 4, b: 5}\n  extend({a: 4, b: 5}, 3); {a: 4, b: 5}\n  extend({a: 4, b: 5}, true); {a: 4, b: 5}\n  extend('hello', {a: 4, b: 5}); // throws\n  extend(3, {a: 4, b: 5}); // throws\n*/\n\nfunction extend(/* [deep], obj1, obj2, [objn] */) {\n  var args = [].slice.call(arguments);\n  var deep = false;\n  if (typeof args[0] == 'boolean') {\n    deep = args.shift();\n  }\n  var result = args[0];\n  if (!result || (typeof result != 'object' && typeof result != 'function')) {\n    throw new Error('extendee must be an object');\n  }\n  var extenders = args.slice(1);\n  var len = extenders.length;\n  for (var i = 0; i < len; i++) {\n    var extender = extenders[i];\n    for (var key in extender) {\n      if (extender.hasOwnProperty(key)) {\n        var value = extender[key];\n        if (deep && isCloneable(value)) {\n          var base = Array.isArray(value) ? [] : {};\n          result[key] = extend(true, result.hasOwnProperty(key) ? result[key] : base, value);\n        } else {\n          result[key] = value;\n        }\n      }\n    }\n  }\n  return result;\n}\n\nfunction isCloneable(obj) {\n  return Array.isArray(obj) || {}.toString.call(obj) == '[object Object]';\n}\n","'use strict';\nmodule.exports = (iterable, reducer, initVal) => new Promise((resolve, reject) => {\n\tconst iterator = iterable[Symbol.iterator]();\n\tlet i = 0;\n\n\tconst next = total => {\n\t\tconst el = iterator.next();\n\n\t\tif (el.done) {\n\t\t\tresolve(total);\n\t\t\treturn;\n\t\t}\n\n\t\tPromise.all([total, el.value])\n\t\t\t.then(value => {\n\t\t\t\tnext(reducer(value[0], value[1], i++));\n\t\t\t})\n\t\t\t.catch(reject);\n\t};\n\n\tnext(initVal);\n});\n","'use strict';\nconst pReduce = require('p-reduce');\n\nmodule.exports = (iterable, initVal) => pReduce(iterable, (prev, fn) => fn(prev), initVal);\n","module.exports = isNode\n\nfunction isNode (val) {\n  return (!val || typeof val !== 'object')\n    ? false\n    : (typeof window === 'object' && typeof window.Node === 'object')\n      ? (val instanceof window.Node)\n      : (typeof val.nodeType === 'number') &&\n        (typeof val.nodeName === 'string')\n}\n","var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexport var isBrowser = (typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\" && (typeof document === \"undefined\" ? \"undefined\" : _typeof(document)) === 'object' && document.nodeType === 9;\n\nexport default isBrowser;\n","import extend from \"just-extend\"\nimport pWaterfall from \"p-waterfall\"\nimport isDom from \"is-dom\"\nimport isBrowser from \"is-in-browser\"\n\n/**\n * Returns the embed code to be added at the end of original string.\n * @param embeds\n * @returns {string}\n */\nfunction combineEmbedsText(embeds) {\n  return embeds\n    .sort((a, b) => a.index - b.index)\n    .map(({ content }) => content)\n    .join(\" \")\n}\n\n/**\n * Add the embed code at the end of string and return the new string\n * @param text - original string\n * @param _embeds - Array of embed code\n * @returns {string}\n */\nfunction appendEmbedsAtEnd({ result, _embeds }) {\n  return `${result} ${combineEmbedsText(_embeds)}`\n}\n\nfunction isElementPresent({ input, target }) {\n  return isDom(input) || (target && isDom(target))\n}\n\nexport default class EmbedJS {\n  constructor(options) {\n    const defaultOptions = {\n      plugins: [],\n      preset: null,\n\n      // By default this plugin supports client side. If you want to use this\n      // on both client and server side, you need to pass a custom isomorphic\n      // implementation of fetch.\n      // Eg: fetch: require('isomorphic-unfetch')\n\n      // This hasn't been included as part of the plugin so that the browser build is small.\n      fetch: isBrowser && (window.fetch || window.unfetch),\n\n      inlineEmbed: true,\n      replaceUrl: false,\n      _embeds: [],\n      _services: []\n    }\n\n    let { input, plugins = [], preset } = options\n    if (!input) {\n      throw new Error(\n        \"You need to pass input element or string in the options object.\"\n      )\n    }\n\n    const inputString = isDom(input) ? input.innerHTML : input\n\n    this.options = extend({}, defaultOptions, options, {\n      result: inputString,\n      plugins: preset ? plugins.concat(preset) : plugins,\n      inputString\n    })\n  }\n\n  text() {\n    const options = this.resetOptions()\n    const transformers = options.plugins.map(p => p.transform)\n    return pWaterfall(transformers, options)\n  }\n\n  resetOptions() {\n    return extend({}, this.options, {\n      _embeds: []\n    })\n  }\n\n  load() {\n    this.options.plugins.forEach(p => p.onLoad && p.onLoad(this.options))\n  }\n\n  async render() {\n    const { input, target, inlineEmbed } = this.options\n    if (!isElementPresent(this.options)) {\n      throw new Error(\"You haven't passed the input as an element.\")\n    }\n\n    let options\n    if (isDom(input) && input.classList.contains(\"ejs-applied\")) {\n      options = this.options\n    } else {\n      options = await this.text()\n\n      const element = target || input\n      element.innerHTML = inlineEmbed\n        ? options.result\n        : appendEmbedsAtEnd(options)\n      element.classList.add(\"ejs-applied\")\n    }\n\n    this.load()\n    return options\n  }\n\n  destroy() {\n    const { inputString, input, target } = this.options\n    if (!isElementPresent(this.options)) {\n      throw new Error(\"You haven't passed the input as an element.\")\n    }\n    const element = target || input\n    element.innerHTML = inputString\n    element.classList.remove(\"ejs-applied\")\n    return this.options\n  }\n}\n"],"names":["const","let","extend","this"],"mappings":"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"}