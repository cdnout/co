(function(){"use strict";function t(t,r){for(var e in r)t[e]=r[e];return t}function r(e,n,i){e=t(n?N(n):{},e),e.parentState=n,e.stateName=i;for(var a in e)e.hasOwnProperty(a)&&"parentState"!==a&&"stateName"!==a&&"object"==typeof e[a]&&(e[a]=r(e[a],e,i+"."+a));return e}function e(t,r,e){T(t,"isDeleted")||(t._internalModel._attributes[r]=e,t.send("becomeDirty"))}function n(t,r){delete t._internalModel._attributes[r],T(t,"isNew")||t.send("propertyWasReset",r)}function i(t,r,e){var n=t[r];t[r]=function(){var t=n.apply(this,arguments);return e.call(this,t,arguments)}}function a(t,r,e){var n=t._registry||t.registry||t,i="transform:"+e,a=e.match(/^-mf-(fragment|fragment-array|array)(?:\$([^$]+))?(?:\$(.+))?$/),o=a[1],s=a[2],u=a[3];if(!n.has(i)){var c=t.lookupFactory("transform:"+o);n.register(i,c.extend({store:r,type:s,polymorphicTypeProp:u}))}return t.lookup(i)}function o(t,r,e){if(!r.polymorphic||!e)return t;var n=r.typeKey||"type",i=e[n];return i||t}function s(t){var r=t._internalModel;return r._fragments||(r._fragments=U(null)),r}function u(t,r,e){var n=s(t);return n._owner=r,n._name=e,Q(t.constructor,"fragmentOwnerProperties").forEach(function(r){t.notifyPropertyChange(r)}),t}function c(t,r){s(t).setupData({attributes:r})}function f(t,r,e,n,i,a){var s=o(r,i,a),f=t.createFragment(s);return u(f,e,n),c(f,a),f}function l(t){return t&&t._isFragment}function h(t,r,e){return t.map?t.map(r,e):p.call(t,r,e)}function p(t){if(void 0===this||null===this||"function"!=typeof t)throw new TypeError;for(var r=Object(this),e=r.length>>>0,n=new Array(e),i=arguments[1],a=0;a<e;a++)a in r&&(n[a]=t.call(i,r[a],a,r));return n}function d(t,r,e,n){var i,a=rt(t,"owner"),o=rt(a,"store"),h=rt(t,"type"),p=rt(t,"options"),d=rt(t,"name");return tt(e,function(t,e){if(l(t)){i=t;var m=s(i)._owner;m||u(i,a,d)}else i=r[e],i?n?c(i,t):et(i,t):i=f(o,h,a,d,p,t);return i})}function m(t,r,e){var n="-mf-"+t;return r&&(n+="$"+r),e&&e.polymorphic&&(n+="$"+(e.typeKey||"type")),n}function y(t,r){function i(e,n,i){var a=s(n),o=A(a,i,r,"object"),u=a._fragments[i];return!u&&l(o)?u=o:o&&o!==u?(u?c(u,o):u=f(e,t,n,i,r,o),a._data[i]=u):u=o,u}function a(i,a,o,c){var h=i.store,p=s(i);if(c)if(l(c))o=u(c,i,a);else{if(o)return ft(o,c),o;o=f(h,t,i,a,r,c)}else o=null;return p._data[a]!==o?e(i,a,o):n(i,a),o}r=r||{};var o=m("fragment",t,r);return v(o,r,i,a)}function g(t,r){r||(r={});var e=m("fragment-array",t,r);return b(e,r,function(e,n){return at.create({type:t,options:r,name:n,owner:e})})}function _(t,r){"object"==typeof t?(r=t,t=void 0):r||(r={});var e=m("array",t);return b(e,r,function(t,e){return B.create({options:r,name:e,owner:t})})}function v(t,r,e,n){r=r||{};var i={type:t,isAttribute:!0,isFragment:!0,options:r};return ut({get:function(t){var r=s(this),n=e(this.store,this,t);return r._fragments[t]=n},set:function(t,r){var i=s(this),a=e(this.store,this,t);return a=n(this,t,a,r),i._fragments[t]=a}}).meta(i)}function b(t,r,i){function a(t,e,n){var a=s(e),o=A(a,n,r,"array"),u=a._fragments[n]||null;return o instanceof B&&!u?u=o:o&&o!==u?(u||(u=i(e,n)),a._data[n]=u,u.setupData(o)):u=o,u}function o(t,r,a,o){var u=s(t);return lt(o)?(a||(a=i(t,r)),a.setObjects(o)):null===o&&(a=null),u._data[r]!==a||ct(a,"hasDirtyAttributes")?e(t,r,a):n(t,r),a}return v(t,r,a,o)}function D(){return pt(function(){return s(this)._owner}).meta({isFragmentOwner:!0}).readOnly()}function S(t,r,e){var n;if("function"==typeof r.defaultValue)n=r.defaultValue();else if("defaultValue"in r)n=r.defaultValue;else{if("array"!==e)return null;n=[]}return ht(n,!0)}function A(t,r,e,n){return r in t._data?t._data[r]:S(t,e,n)}var w=Ember,F=(DS,DS.JSONAPISerializer,DS.JSONSerializer),z=DS.InternalModel,E=DS.RootState,C=DS.Model,O=(DS.Snapshot,DS.Store),k=DS.Transform,T=w.get,N=Object.create||w.create,P=E.loaded.saved.didSetProperty,j=E.loaded.updated.uncommitted.propertyWasReset,x=function(t){var r=t._owner,n=t._name;r&&e(r,n,t)},M={isEmpty:!1,isLoading:!1,isLoaded:!1,isDirty:!1,isSaving:!1,isDeleted:!1,isNew:!1,isValid:!0,didSetProperty:P,propertyWasReset:w.K,becomeDirty:w.K,rolledBack:w.K,empty:{isEmpty:!0,loadedData:function(t){t.transitionTo("loaded.created")},pushedData:function(t){t.transitionTo("loaded.saved")}},loaded:{pushedData:function(t){t.transitionTo("saved")},saved:{setup:function(t){var r=t._owner,e=t._name;r._internalModel._fragments[e]&&(T(r,e+".hasDirtyAttributes")||n(r,e,t))},pushedData:w.K,didCommit:w.K,becomeDirty:function(t){t.transitionTo("updated")}},created:{isDirty:!0,isNew:!0,setup:x,didCommit:function(t){t.transitionTo("saved")}},updated:{isDirty:!0,setup:x,propertyWasReset:j,didCommit:function(t){t.transitionTo("saved")},rolledBack:function(t){t.transitionTo("saved")}}}};M=r(M,null,"root");var R=M,K=w.get,V=w.set,$=w.computed,W=w.copy,I=w.makeArray,L=w.ArrayProxy.extend(w.Copyable,{owner:null,name:null,init:function(){this._super(),this._pendingData=void 0,V(this,"_originalState",[])},content:$(function(){return w.A()}),copy:function(){return this.map(W)},setupData:function(t){if(this._pendingData!==t){this._pendingData=t;var r=this._normalizeData(I(t)),e=K(this,"content");V(this,"_originalState",r),e.replace(0,K(e,"length"),r),this._pendingData=void 0}},_normalizeData:function(t){return t},_createSnapshot:function(){return this.toArray()},_flushChangedAttributes:function(){},_adapterDidCommit:function(t){t?this.setupData(t):V(this,"_originalState",this.toArray())},_adapterDidError:function(){},hasDirtyAttributes:$("[]","_originalState",function(){return 0!==w.compare(this.toArray(),K(this,"_originalState"))}),rollbackAttributes:function(){this.setObjects(K(this,"_originalState"))},serialize:function(){return this.toArray()},arrayContentDidChange:function(){this._super.apply(this,arguments);var t=K(this,"owner"),r=K(this,"name");K(this,"hasDirtyAttributes")?e(t,r,this):n(t,r)},toStringExtension:function(){return"owner("+K(this,"owner.id")+")"}}),B=L,J=Object.keys||Ember.keys,q=Object.create||Ember.create;O.reopen({createFragment:function(t,r){var e=this.modelFor(t);Ember.assert("The '"+e+"' model must be a subclass of MF.Fragment",Z.detect(e));var n=new z(e,null,this,this.container);n.currentState=R.empty,n._name=null,n._owner=null,n.loadedData();var i=n.getRecord();return r&&i.setProperties(r),i._isFragment=!0,i},serializerFor:function(t){var r;r="string"==typeof t?t:t.modelName;var e=this.modelFactoryFor(r);if(e&&Z.detect(e)){var n=["-fragment","-default"];return this.lookupSerializer(r,n)}return this._super(t)}}),C.reopen({changedAttributes:function(){var t=this._super(),r=s(this);return J(r._fragments).forEach(function(e){e in r._attributes&&(t[e]=!0)},this),t},willDestroy:function(){this._super.apply(this,arguments);var t,r,e=s(this);for(t in e._fragments)(r=e._fragments[t])&&r.destroy();for(t in e._data)(r=e._data[t])&&(r instanceof Z||r instanceof at)&&r.destroy()}});var G=z.prototype;i(G,"createSnapshot",function(t){var r=t._attributes;return J(r).forEach(function(t){var e=r[t];e&&"function"==typeof e._createSnapshot&&(r[t]=e._createSnapshot())}),t}),i(G,"rollbackAttributes",function(){for(var t in this._fragments)this._fragments[t]&&this._fragments[t].rollbackAttributes()}),i(G,"flushChangedAttributes",function(){var t;for(var r in this._fragments)(t=this._fragments[r])&&t._flushChangedAttributes()}),i(G,"adapterDidCommit",function(t,r){var e,n=r[0]&&r[0].attributes||q(null);for(var i in this._fragments)(e=this._fragments[i])&&e._adapterDidCommit(n[i])}),i(G,"adapterDidError",function(t,r){var e,n=r[0]||q(null);for(var i in this._fragments)(e=this._fragments[i])&&e._adapterDidError(n)}),F.reopen({transformFor:function(t){return 0===t.indexOf("-mf-")?a(this.container,this.store,t):this._super.apply(this,arguments)}});var H,Q=w.get,U=Object.create||w.create,X=w.copy,Y=C.extend(w.Comparable,w.Copyable,{compare:function(t,r){return t===r?0:1},copy:function(){var t=this.constructor,r=U(null);return t.eachAttribute(function(t){r[t]=X(Q(this,t))},this),this.store.createFragment(t.modelName,r)},_flushChangedAttributes:function(){s(this).flushChangedAttributes()},_adapterDidCommit:function(t){s(this).adapterDidCommit({attributes:t||U(null)})},_adapterDidError:function(){s(this)._saveWasRejected()},toStringExtension:function(){var t=s(this),r=t&&t._owner;return r?"owner("+Q(r,"id")+")":""}}).reopenClass({fragmentOwnerProperties:w.computed(function(){var t=[];return this.eachComputedProperty(function(r,e){e.isFragmentOwner&&t.push(r)}),t}).readOnly()}),Z=Y,tt=h,rt=w.get,et=w.setProperties,nt=w.computed,it=(w.typeOf,B.extend({type:null,options:null,_normalizeData:function(t){var r=rt(this,"content");return d(this,r,t,!0)},_createSnapshot:function(){return this.map(function(t){return t._createSnapshot()})},_flushChangedAttributes:function(){this.map(function(t){t._flushChangedAttributes()})},_adapterDidCommit:function(t){this._super(t),this.forEach(function(r,e){r._adapterDidCommit(t&&t[e])})},_adapterDidError:function(t){this._super(t),this.forEach(function(r){r._adapterDidError(t)})},hasDirtyAttributes:nt("@each.hasDirtyAttributes","_originalState",function(){return this._super()||this.isAny("hasDirtyAttributes")}),rollbackAttributes:function(){this._super(),this.invoke("rollbackAttributes")},serialize:function(){return this.invoke("serialize")},replaceContent:function(t,r,e){var n=rt(this,"content"),i=n.slice(t,t+r),a=d(this,i,e);return n.replace(t,r,a)},addFragment:function(t){return this.addObject(t)},removeFragment:function(t){return this.removeObject(t)},createFragment:function(t){var r=rt(this,"owner"),e=rt(r,"store"),n=rt(this,"type"),i=e.createFragment(n,t);return this.pushObject(i)},willDestroy:function(){this._super.apply(this,arguments),this.forEach(function(t){t.destroy()}),this._originalState.forEach(function(t){t.destroy()})}})),at=it,ot=window.Ember,st=ot.computed;try{ot.computed({set:function(){},get:function(){}}),H=!0}catch(t){H=!1}var ut=function(){var t=[],r=arguments[arguments.length-1];if("function"==typeof r||H)return st.apply(this,arguments);for(var e=0,n=arguments.length-1;e<n;e++)t.push(arguments[e]);var i;return i=r.set?function(t,e){return arguments.length>1?r.set.call(this,t,e):r.get.call(this,t)}:function(t){return r.get.call(this,t)},t.push(i),st.apply(this,t)},ct=w.get,ft=w.setProperties,lt=w.isArray,ht=(w.typeOf,w.copy),pt=w.computed,dt=w.get,mt=w.makeArray,yt=w.computed,gt=k.extend({store:null,type:null,deserialize:function(t){if(null==t)return null;var r=dt(this,"transform");return t=mt(t),r?tt(t,r.deserialize,r):t},serialize:function(t){if(null==t)return null;var r=dt(this,"transform");return t=t.toArray?t.toArray():t,r?tt(t,r.serialize,r):t},transform:yt("type",function(){var t=this.get("type");if(!t)return null;var r=dt(this,"store").container.lookup("transform:"+t);return r})}),_t=gt,vt=w.get,bt=k.extend({store:null,type:null,polymorphicTypeProp:null,deserialize:function(t){return null==t?null:this.deserializeSingle(t)},serialize:function(t){if(!t)return null;var r=this.store,e=r.serializerFor(t.modelName);return e.serialize(t)},modelNameFor:function(t){var r=vt(this,"type"),e=vt(this,"polymorphicTypeProp");return t&&e&&t[e]&&(r=t[e]),r},deserializeSingle:function(t){var r=this.store,e=this.modelNameFor(t),n=r.serializerFor(e),i=r.modelFor(e),a=n.normalize(i,t);return vt(a,"data.attributes")}}),Dt=bt,St=Dt.extend({deserialize:function(t){return null==t?null:tt(t,function(t){return this.deserializeSingle(t)},this)},serialize:function(t){if(!t)return null;var r=this.store;return tt(t,function(t){var e=r.serializerFor(t.modelName);return e.serialize(t)})}}),At=St,wt=[{name:"fragmentTransform",before:"store",initialize:function(t){t.register("transform:fragment",Dt),t.register("transform:fragment-array",At),t.register("transform:array",_t)}}],Ft=wt,zt=w.Namespace.create({VERSION:"2.1.2",Fragment:Z,FragmentArray:at,FragmentTransform:Dt,FragmentArrayTransform:At,ArrayTransform:_t,fragment:y,fragmentArray:g,array:_,fragmentOwner:D});w.onLoad("Ember.Application",function(t){Ft.forEach(t.initializer,t)}),w.libraries&&w.libraries.register("Model Fragments",zt.VERSION),w.lookup.MF=zt}).call(this);
//# sourceMappingURL=ember-data-model-fragments.prod.min.js.map