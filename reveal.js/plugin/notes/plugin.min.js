import speakerViewHTML from"./speaker-view.html";import marked from"marked";const Plugin=()=>{let e,t=null;function n(){function n(n){let a=e.getCurrentSlide(),o=a.querySelector("aside.notes"),r=a.querySelector(".current-fragment"),s={namespace:"reveal-notes",type:"state",notes:"",markdown:!1,whitespace:"normal",state:e.getState()};if(a.hasAttribute("data-notes")&&(s.notes=a.getAttribute("data-notes"),s.whitespace="pre-wrap"),r){let e=r.querySelector("aside.notes");e?o=e:r.hasAttribute("data-notes")&&(s.notes=r.getAttribute("data-notes"),s.whitespace="pre-wrap",o=null)}o&&(s.notes=o.innerHTML,s.markdown="string"==typeof o.getAttribute("data-markdown")),t.postMessage(JSON.stringify(s),"*")}!t||t.closed?((t=window.open("about:blank","reveal.js - Notes","width=1100,height=700")).marked=marked,t.document.write(speakerViewHTML),t?function(){let a=setInterval(function(){t.postMessage(JSON.stringify({namespace:"reveal-notes",type:"connect",url:window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,state:e.getState()}),"*")},500);window.addEventListener("message",function(o){let r=JSON.parse(o.data);r&&"reveal-notes"===r.namespace&&"connected"===r.type&&(clearInterval(a),e.on("slidechanged",n),e.on("fragmentshown",n),e.on("fragmenthidden",n),e.on("overviewhidden",n),e.on("overviewshown",n),e.on("paused",n),e.on("resumed",n),n()),r&&"reveal-notes"===r.namespace&&"call"===r.type&&function(n,a,o){let r=e[n].apply(e,a);t.postMessage(JSON.stringify({namespace:"reveal-notes",type:"return",result:r,callId:o}),"*")}(r.methodName,r.arguments,r.callId)})}():alert("Speaker view popup failed to open. Please make sure popups are allowed and reopen the speaker view.")):t.focus()}return{id:"notes",init:function(t){e=t,/receiver/i.test(window.location.search)||(null!==window.location.search.match(/(\?|\&)notes/gi)&&n(),e.addKeyBinding({keyCode:83,key:"S",description:"Speaker notes view"},function(){n()}))},open:n}};export default Plugin;