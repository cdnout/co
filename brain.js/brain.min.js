"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var gpu=_interopDefault(require("gpu.js")),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}function activate(t){return 0<t?t:.01*t}function measure(t,e){return 0<t?e:.01*e}var leakyRelu={activate:activate,measure:measure};function activate$1(t){return Math.max(0,t)}function measure$1(t,e){return t<=0?0:e}var relu={activate:activate$1,measure:measure$1};function activate$2(t){return 1/(1+Math.exp(-t))}function measure$2(t,e){return t*(1-t)*e}var sigmoid={activate:activate$2,measure:measure$2},check=function(t){return t&&t.Math==Math&&t},global_1=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof commonjsGlobal&&commonjsGlobal)||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},descriptors=!fails(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),nativePropertyIsEnumerable={}.propertyIsEnumerable,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor&&!nativePropertyIsEnumerable.call({1:2},1),f=NASHORN_BUG?function(t){var e=getOwnPropertyDescriptor(this,t);return!!e&&e.enumerable}:nativePropertyIsEnumerable,objectPropertyIsEnumerable={f:f},createPropertyDescriptor=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},toString={}.toString,classofRaw=function(t){return toString.call(t).slice(8,-1)},split="".split,indexedObject=fails(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==classofRaw(t)?split.call(t,""):Object(t)}:Object,requireObjectCoercible=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},toIndexedObject=function(t){return indexedObject(requireObjectCoercible(t))},isObject=function(t){return"object"==typeof t?null!==t:"function"==typeof t},toPrimitive=function(t,e){if(!isObject(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!isObject(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!isObject(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!isObject(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},hasOwnProperty={}.hasOwnProperty,has=function(t,e){return hasOwnProperty.call(t,e)},document$1=global_1.document,EXISTS=isObject(document$1)&&isObject(document$1.createElement),documentCreateElement=function(t){return EXISTS?document$1.createElement(t):{}},ie8DomDefine=!descriptors&&!fails(function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a}),nativeGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,f$1=descriptors?nativeGetOwnPropertyDescriptor:function(t,e){if(t=toIndexedObject(t),e=toPrimitive(e,!0),ie8DomDefine)try{return nativeGetOwnPropertyDescriptor(t,e)}catch(t){}if(has(t,e))return createPropertyDescriptor(!objectPropertyIsEnumerable.f.call(t,e),t[e])},objectGetOwnPropertyDescriptor={f:f$1},anObject=function(t){if(!isObject(t))throw TypeError(String(t)+" is not an object");return t},nativeDefineProperty=Object.defineProperty,f$2=descriptors?nativeDefineProperty:function(t,e,r){if(anObject(t),e=toPrimitive(e,!0),anObject(r),ie8DomDefine)try{return nativeDefineProperty(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t},objectDefineProperty={f:f$2},createNonEnumerableProperty=descriptors?function(t,e,r){return objectDefineProperty.f(t,e,createPropertyDescriptor(1,r))}:function(t,e,r){return t[e]=r,t},setGlobal=function(e,r){try{createNonEnumerableProperty(global_1,e,r)}catch(t){global_1[e]=r}return r},SHARED="__core-js_shared__",store=global_1[SHARED]||setGlobal(SHARED,{}),sharedStore=store,functionToString=Function.toString;"function"!=typeof sharedStore.inspectSource&&(sharedStore.inspectSource=function(t){return functionToString.call(t)});var store$1,wmget,wmhas,wmset,set,get,has$1,STATE,inspectSource=sharedStore.inspectSource,WeakMap=global_1.WeakMap,nativeWeakMap="function"==typeof WeakMap&&/native code/.test(inspectSource(WeakMap)),shared=createCommonjsModule(function(t){(t.exports=function(t,e){return sharedStore[t]||(sharedStore[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})}),id=0,postfix=Math.random(),uid=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++id+postfix).toString(36)},keys=shared("keys"),sharedKey=function(t){return keys[t]||(keys[t]=uid(t))},hiddenKeys={},WeakMap$1=global_1.WeakMap,enforce=function(t){return has$1(t)?get(t):set(t,{})},getterFor=function(r){return function(t){var e;if(!isObject(t)||(e=get(t)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return e}};has$1=nativeWeakMap?(store$1=new WeakMap$1,wmget=store$1.get,wmhas=store$1.has,wmset=store$1.set,set=function(t,e){return wmset.call(store$1,t,e),e},get=function(t){return wmget.call(store$1,t)||{}},function(t){return wmhas.call(store$1,t)}):(STATE=sharedKey("state"),hiddenKeys[STATE]=!0,set=function(t,e){return createNonEnumerableProperty(t,STATE,e),e},get=function(t){return has(t,STATE)?t[STATE]:{}},function(t){return has(t,STATE)});var internalState={set:set,get:get,has:has$1,enforce:enforce,getterFor:getterFor},redefine=createCommonjsModule(function(t){var e=internalState.get,s=internalState.enforce,u=String(String).split("String");(t.exports=function(t,e,r,n){var i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,o=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof e||has(r,"name")||createNonEnumerableProperty(r,"name",e),s(r).source=u.join("string"==typeof e?e:"")),t!==global_1?(i?!o&&t[e]&&(a=!0):delete t[e],a?t[e]=r:createNonEnumerableProperty(t,e,r)):a?t[e]=r:setGlobal(e,r)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||inspectSource(this)})}),path=global_1,aFunction=function(t){return"function"==typeof t?t:void 0},getBuiltIn=function(t,e){return arguments.length<2?aFunction(path[t])||aFunction(global_1[t]):path[t]&&path[t][e]||global_1[t]&&global_1[t][e]},ceil=Math.ceil,floor=Math.floor,toInteger=function(t){return isNaN(t=+t)?0:(0<t?floor:ceil)(t)},min=Math.min,toLength=function(t){return 0<t?min(toInteger(t),9007199254740991):0},max=Math.max,min$1=Math.min,toAbsoluteIndex=function(t,e){var r=toInteger(t);return r<0?max(r+e,0):min$1(r,e)},createMethod=function(s){return function(t,e,r){var n,i=toIndexedObject(t),a=toLength(i.length),o=toAbsoluteIndex(r,a);if(s&&e!=e){for(;o<a;)if((n=i[o++])!=n)return!0}else for(;o<a;o++)if((s||o in i)&&i[o]===e)return s||o||0;return!s&&-1}},arrayIncludes={includes:createMethod(!0),indexOf:createMethod(!1)},indexOf=arrayIncludes.indexOf,objectKeysInternal=function(t,e){var r,n=toIndexedObject(t),i=0,a=[];for(r in n)!has(hiddenKeys,r)&&has(n,r)&&a.push(r);for(;e.length>i;)has(n,r=e[i++])&&(~indexOf(a,r)||a.push(r));return a},enumBugKeys=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hiddenKeys$1=enumBugKeys.concat("length","prototype"),f$3=Object.getOwnPropertyNames||function(t){return objectKeysInternal(t,hiddenKeys$1)},objectGetOwnPropertyNames={f:f$3},f$4=Object.getOwnPropertySymbols,objectGetOwnPropertySymbols={f:f$4},ownKeys=getBuiltIn("Reflect","ownKeys")||function(t){var e=objectGetOwnPropertyNames.f(anObject(t)),r=objectGetOwnPropertySymbols.f;return r?e.concat(r(t)):e},copyConstructorProperties=function(t,e){for(var r=ownKeys(e),n=objectDefineProperty.f,i=objectGetOwnPropertyDescriptor.f,a=0;a<r.length;a++){var o=r[a];has(t,o)||n(t,o,i(e,o))}},replacement=/#|\.prototype\./,isForced=function(t,e){var r=data[normalize(t)];return r==POLYFILL||r!=NATIVE&&("function"==typeof e?fails(e):!!e)},normalize=isForced.normalize=function(t){return String(t).replace(replacement,".").toLowerCase()},data=isForced.data={},NATIVE=isForced.NATIVE="N",POLYFILL=isForced.POLYFILL="P",isForced_1=isForced,getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,_export=function(t,e){var r,n,i,a,o=t.target,s=t.global,u=t.stat,l=s?global_1:u?global_1[o]||setGlobal(o,{}):(global_1[o]||{}).prototype;if(l)for(r in e){if(i=e[r],n=t.noTargetGet?(a=getOwnPropertyDescriptor$1(l,r))&&a.value:l[r],!isForced_1(s?r:o+(u?".":"#")+r,t.forced)&&void 0!==n){if(typeof i==typeof n)continue;copyConstructorProperties(i,n)}(t.sham||n&&n.sham)&&createNonEnumerableProperty(i,"sham",!0),redefine(l,r,i,t)}},nativeExpm1=Math.expm1,exp=Math.exp,mathExpm1=!nativeExpm1||22025.465794806718<nativeExpm1(10)||nativeExpm1(10)<22025.465794806718||-2e-17!=nativeExpm1(-2e-17)?function(t){return 0==(t=+t)?t:-1e-6<t&&t<1e-6?t+t*t/2:exp(t)-1}:nativeExpm1,exp$1=Math.exp;function activate$3(t){return Math.tanh(t)}function measure$3(t,e){return(1-t*t)*e}_export({target:"Math",stat:!0},{tanh:function(t){var e=mathExpm1(t=+t),r=mathExpm1(-t);return e==1/0?1:r==1/0?-1:(e-r)/(exp$1(t)+exp$1(-t))}});var match,version,tanh={activate:activate$3,measure:measure$3},activation={leakyRelu:leakyRelu,relu:relu,sigmoid:sigmoid,tanh:tanh},isArray=Array.isArray||function(t){return"Array"==classofRaw(t)},toObject=function(t){return Object(requireObjectCoercible(t))},createProperty=function(t,e,r){var n=toPrimitive(e);n in t?objectDefineProperty.f(t,n,createPropertyDescriptor(0,r)):t[n]=r},nativeSymbol=!!Object.getOwnPropertySymbols&&!fails(function(){return!String(Symbol())}),useSymbolAsUid=nativeSymbol&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,WellKnownSymbolsStore=shared("wks"),Symbol$1=global_1.Symbol,createWellKnownSymbol=useSymbolAsUid?Symbol$1:Symbol$1&&Symbol$1.withoutSetter||uid,wellKnownSymbol=function(t){return has(WellKnownSymbolsStore,t)||(nativeSymbol&&has(Symbol$1,t)?WellKnownSymbolsStore[t]=Symbol$1[t]:WellKnownSymbolsStore[t]=createWellKnownSymbol("Symbol."+t)),WellKnownSymbolsStore[t]},SPECIES=wellKnownSymbol("species"),arraySpeciesCreate=function(t,e){var r;return isArray(t)&&("function"==typeof(r=t.constructor)&&(r===Array||isArray(r.prototype))||isObject(r)&&null===(r=r[SPECIES]))&&(r=void 0),new(void 0===r?Array:r)(0===e?0:e)},engineUserAgent=getBuiltIn("navigator","userAgent")||"",process=global_1.process,versions=process&&process.versions,v8=versions&&versions.v8;v8?version=(match=v8.split("."))[0]+match[1]:engineUserAgent&&(!(match=engineUserAgent.match(/Edge\/(\d+)/))||74<=match[1])&&(match=engineUserAgent.match(/Chrome\/(\d+)/))&&(version=match[1]);var engineV8Version=version&&+version,SPECIES$1=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(e){return 51<=engineV8Version||!fails(function(){var t=[];return(t.constructor={})[SPECIES$1]=function(){return{foo:1}},1!==t[e](Boolean).foo})},IS_CONCAT_SPREADABLE=wellKnownSymbol("isConcatSpreadable"),MAX_SAFE_INTEGER=9007199254740991,MAXIMUM_ALLOWED_INDEX_EXCEEDED="Maximum allowed index exceeded",IS_CONCAT_SPREADABLE_SUPPORT=51<=engineV8Version||!fails(function(){var t=[];return t[IS_CONCAT_SPREADABLE]=!1,t.concat()[0]!==t}),SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!isObject(t))return!1;var e=t[IS_CONCAT_SPREADABLE];return void 0!==e?!!e:isArray(t)},FORCED=!IS_CONCAT_SPREADABLE_SUPPORT||!SPECIES_SUPPORT;_export({target:"Array",proto:!0,forced:FORCED},{concat:function(t){for(var e,r,n,i=toObject(this),a=arraySpeciesCreate(i,0),o=0,s=-1,u=arguments.length;s<u;s++)if(isConcatSpreadable(n=-1===s?i:arguments[s])){if(r=toLength(n.length),MAX_SAFE_INTEGER<o+r)throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);for(e=0;e<r;e++,o++)e in n&&createProperty(a,o,n[e])}else{if(MAX_SAFE_INTEGER<=o)throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);createProperty(a,o++,n)}return a.length=o,a}});var aFunction$1=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},functionBindContext=function(n,i,t){if(aFunction$1(n),void 0===i)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,e){return n.call(i,t,e)};case 3:return function(t,e,r){return n.call(i,t,e,r)}}return function(){return n.apply(i,arguments)}},push=[].push,createMethod$1=function(f){var d=1==f,y=2==f,g=3==f,m=4==f,v=6==f,w=5==f||v;return function(t,e,r,n){for(var i,a,o=toObject(t),s=indexedObject(o),u=functionBindContext(e,r,3),l=toLength(s.length),h=0,c=n||arraySpeciesCreate,p=d?c(t,l):y?c(t,0):void 0;h<l;h++)if((w||h in s)&&(a=u(i=s[h],h,o),f))if(d)p[h]=a;else if(a)switch(f){case 3:return!0;case 5:return i;case 6:return h;case 2:push.call(p,i)}else if(m)return!1;return v?-1:g||m?m:p}},arrayIteration={forEach:createMethod$1(0),map:createMethod$1(1),filter:createMethod$1(2),some:createMethod$1(3),every:createMethod$1(4),find:createMethod$1(5),findIndex:createMethod$1(6)},arrayMethodIsStrict=function(t,e){var r=[][t];return!!r&&fails(function(){r.call(null,e||function(){throw 1},1)})},defineProperty=Object.defineProperty,cache={},thrower=function(t){throw t},arrayMethodUsesToLength=function(t,e){if(has(cache,t))return cache[t];var r=[][t],n=!!has(e=e||{},"ACCESSORS")&&e.ACCESSORS,i=has(e,0)?e[0]:thrower,a=has(e,1)?e[1]:void 0;return cache[t]=!!r&&!fails(function(){if(n&&!descriptors)return!0;var t={length:-1};n?defineProperty(t,1,{enumerable:!0,get:thrower}):t[1]=1,r.call(t,i,a)})},$forEach=arrayIteration.forEach,STRICT_METHOD=arrayMethodIsStrict("forEach"),USES_TO_LENGTH=arrayMethodUsesToLength("forEach"),arrayForEach=STRICT_METHOD&&USES_TO_LENGTH?[].forEach:function(t,e){return $forEach(this,t,1<arguments.length?e:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=arrayForEach},{forEach:arrayForEach});var createMethod$2=function(l){return function(t,e,r,n){aFunction$1(e);var i=toObject(t),a=indexedObject(i),o=toLength(i.length),s=l?o-1:0,u=l?-1:1;if(r<2)for(;;){if(s in a){n=a[s],s+=u;break}if(s+=u,l?s<0:o<=s)throw TypeError("Reduce of empty array with no initial value")}for(;l?0<=s:s<o;s+=u)s in a&&(n=e(n,a[s],s,i));return n}},arrayReduce={left:createMethod$2(!1),right:createMethod$2(!0)},$reduce=arrayReduce.left,STRICT_METHOD$1=arrayMethodIsStrict("reduce"),USES_TO_LENGTH$1=arrayMethodUsesToLength("reduce",{1:0});_export({target:"Array",proto:!0,forced:!STRICT_METHOD$1||!USES_TO_LENGTH$1},{reduce:function(t,e){return $reduce(this,t,arguments.length,1<arguments.length?e:void 0)}});var HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("slice"),USES_TO_LENGTH$2=arrayMethodUsesToLength("slice",{ACCESSORS:!0,0:0,1:2}),SPECIES$2=wellKnownSymbol("species"),nativeSlice=[].slice,max$1=Math.max;_export({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT||!USES_TO_LENGTH$2},{slice:function(t,e){var r,n,i,a=toIndexedObject(this),o=toLength(a.length),s=toAbsoluteIndex(t,o),u=toAbsoluteIndex(void 0===e?o:e,o);if(isArray(a)&&(("function"==typeof(r=a.constructor)&&(r===Array||isArray(r.prototype))||isObject(r)&&null===(r=r[SPECIES$2]))&&(r=void 0),r===Array||void 0===r))return nativeSlice.call(a,s,u);for(n=new(void 0===r?Array:r)(max$1(u-s,0)),i=0;s<u;s++,i++)s in a&&createProperty(n,i,a[s]);return n.length=i,n}});var HAS_SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport("splice"),USES_TO_LENGTH$3=arrayMethodUsesToLength("splice",{ACCESSORS:!0,0:0,1:2}),max$2=Math.max,min$2=Math.min,MAX_SAFE_INTEGER$1=9007199254740991,MAXIMUM_ALLOWED_LENGTH_EXCEEDED="Maximum allowed length exceeded";_export({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$1||!USES_TO_LENGTH$3},{splice:function(t,e){var r,n,i,a,o,s,u=toObject(this),l=toLength(u.length),h=toAbsoluteIndex(t,l),c=arguments.length;if(0===c?r=n=0:n=1===c?(r=0,l-h):(r=c-2,min$2(max$2(toInteger(e),0),l-h)),MAX_SAFE_INTEGER$1<l+r-n)throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);for(i=arraySpeciesCreate(u,n),a=0;a<n;a++)(o=h+a)in u&&createProperty(i,a,u[o]);if(r<(i.length=n)){for(a=h;a<l-n;a++)s=a+r,(o=a+n)in u?u[s]=u[o]:delete u[s];for(a=l;l-n+r<a;a--)delete u[a-1]}else if(n<r)for(a=l-n;h<a;a--)s=a+r-1,(o=a+n-1)in u?u[s]=u[o]:delete u[s];for(a=0;a<r;a++)u[a+h]=arguments[a+2];return u.length=l-n+r,i}});var objectKeys=Object.keys||function(t){return objectKeysInternal(t,enumBugKeys)},nativeAssign=Object.assign,defineProperty$1=Object.defineProperty,objectAssign=!nativeAssign||fails(function(){if(descriptors&&1!==nativeAssign({b:1},nativeAssign(defineProperty$1({},"a",{enumerable:!0,get:function(){defineProperty$1(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol(),n="abcdefghijklmnopqrst";return t[r]=7,n.split("").forEach(function(t){e[t]=t}),7!=nativeAssign({},t)[r]||objectKeys(nativeAssign({},e)).join("")!=n})?function(t,e){for(var r=toObject(t),n=arguments.length,i=1,a=objectGetOwnPropertySymbols.f,o=objectPropertyIsEnumerable.f;i<n;)for(var s,u=indexedObject(arguments[i++]),l=a?objectKeys(u).concat(a(u)):objectKeys(u),h=l.length,c=0;c<h;)s=l[c++],descriptors&&!o.call(u,s)||(r[s]=u[s]);return r}:nativeAssign;_export({target:"Object",stat:!0,forced:Object.assign!==objectAssign},{assign:objectAssign});var FAILS_ON_PRIMITIVES=fails(function(){objectKeys(1)});_export({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES},{keys:function(t){return objectKeys(toObject(t))}});var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var COLLECTION_NAME in domIterables){var Collection=global_1[COLLECTION_NAME],CollectionPrototype=Collection&&Collection.prototype;if(CollectionPrototype&&CollectionPrototype.forEach!==arrayForEach)try{createNonEnumerableProperty(CollectionPrototype,"forEach",arrayForEach)}catch(t){CollectionPrototype.forEach=arrayForEach}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ownKeys$1(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}_export({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var activeXDocument,CrossValidate=function(){function r(t,e){_classCallCheck(this,r),this.Classifier=t,this.options=e,this.json=null}return _createClass(r,[{key:"testPartition",value:function(t,e,r){var n=new this.Classifier(this.options),i=Date.now(),a=n.train(e,t),o=Date.now(),s=n.test(r),u=Date.now();return Object.assign({},s,{trainTime:o-i,testTime:u-o,iterations:a.iterations,error:a.error,total:s.total,learningRate:n.trainOpts.learningRate,hiddenLayers:n.hiddenLayers,network:n.toJSON()})}},{key:"shuffleArray",value:function(t){for(var e=t.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}},{key:"train",value:function(e,t,r){var n=1<arguments.length&&void 0!==t?t:{},i=2<arguments.length&&void 0!==r?r:4;if(e.length<i)throw new Error("Training set size is too small for ".concat(e.length," k folds of ").concat(i));var a,o=e.length/i;e.constructor===Array?this.shuffleArray(e):(a={},this.shuffleArray(Object.keys(e)).forEach(function(t){a[t]=e[t]}),e=a);for(var s,u={trainTime:0,testTime:0,iterations:0,error:0},l={total:0},h={total:0,truePos:0,trueNeg:0,falsePos:0,falseNeg:0},c=[],p=null,f=0;f<i;f++){var d=e.slice(0),y=d.splice(f*o,o),g=this.testPartition(n,d,y);for(s in null===p&&(p=g.hasOwnProperty("falseNeg")&&g.hasOwnProperty("falsePos")&&g.hasOwnProperty("trueNeg")&&g.hasOwnProperty("truePos"))&&Object.assign(l,h),u)s in u&&(u[s]+=g[s]);for(s in l)s in l&&(l[s]+=g[s]);c.push(g)}for(s in u)s in u&&(u[s]/=i);return p&&(l.precision=l.truePos/(l.truePos+l.falsePos),l.recall=l.truePos/(l.truePos+l.falseNeg),l.accuracy=(l.trueNeg+l.truePos)/l.total),l.testSize=o,l.trainSize=e.length-o,this.json={avgs:u,stats:l,sets:c}}},{key:"toNeuralNetwork",value:function(){return this.fromJSON(this.json)}},{key:"toJSON",value:function(){return this.json}},{key:"fromJSON",value:function(t){var e=this.Classifier,r=t.sets.reduce(function(t,e){return t.error<e.error?t:e},{error:1/0}).network;if(e.fromJSON)return e.fromJSON(r);var n=new e;return n.fromJSON(r),n}}]),r}(),crossValidate=CrossValidate,arrayFill=function(t,e,r){for(var n=toObject(this),i=toLength(n.length),a=arguments.length,o=toAbsoluteIndex(1<a?e:void 0,i),s=2<a?r:void 0,u=void 0===s?i:toAbsoluteIndex(s,i);o<u;)n[o++]=t;return n},objectDefineProperties=descriptors?Object.defineProperties:function(t,e){anObject(t);for(var r,n=objectKeys(e),i=n.length,a=0;a<i;)objectDefineProperty.f(t,r=n[a++],e[r]);return t},html=getBuiltIn("document","documentElement"),GT=">",LT="<",PROTOTYPE="prototype",SCRIPT="script",IE_PROTO=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return LT+SCRIPT+GT+t+LT+"/"+SCRIPT+GT},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var e=t.parentWindow.Object;return t=null,e},NullProtoObjectViaIFrame=function(){var t,e=documentCreateElement("iframe"),r="java"+SCRIPT+":";return e.style.display="none",html.appendChild(e),e.src=String(r),(t=e.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F},NullProtoObject=function(){try{activeXDocument=document.domain&&new ActiveXObject("htmlfile")}catch(t){}NullProtoObject=activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame();for(var t=enumBugKeys.length;t--;)delete NullProtoObject[PROTOTYPE][enumBugKeys[t]];return NullProtoObject()};hiddenKeys[IE_PROTO]=!0;var objectCreate=Object.create||function(t,e){var r;return null!==t?(EmptyConstructor[PROTOTYPE]=anObject(t),r=new EmptyConstructor,EmptyConstructor[PROTOTYPE]=null,r[IE_PROTO]=t):r=NullProtoObject(),void 0===e?r:objectDefineProperties(r,e)},UNSCOPABLES=wellKnownSymbol("unscopables"),ArrayPrototype=Array.prototype;null==ArrayPrototype[UNSCOPABLES]&&objectDefineProperty.f(ArrayPrototype,UNSCOPABLES,{configurable:!0,value:objectCreate(null)});var addToUnscopables=function(t){ArrayPrototype[UNSCOPABLES][t]=!0};_export({target:"Array",proto:!0},{fill:arrayFill}),addToUnscopables("fill");var IteratorPrototype,PrototypeOfArrayIteratorPrototype,arrayIterator,iterators={},correctPrototypeGetter=!fails(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),IE_PROTO$1=sharedKey("IE_PROTO"),ObjectPrototype=Object.prototype,objectGetPrototypeOf=correctPrototypeGetter?Object.getPrototypeOf:function(t){return t=toObject(t),has(t,IE_PROTO$1)?t[IE_PROTO$1]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ObjectPrototype:null},ITERATOR=wellKnownSymbol("iterator"),BUGGY_SAFARI_ITERATORS=!1,returnThis=function(){return this};[].keys&&("next"in(arrayIterator=[].keys())?(PrototypeOfArrayIteratorPrototype=objectGetPrototypeOf(objectGetPrototypeOf(arrayIterator)))!==Object.prototype&&(IteratorPrototype=PrototypeOfArrayIteratorPrototype):BUGGY_SAFARI_ITERATORS=!0),null==IteratorPrototype&&(IteratorPrototype={}),has(IteratorPrototype,ITERATOR)||createNonEnumerableProperty(IteratorPrototype,ITERATOR,returnThis);var iteratorsCore={IteratorPrototype:IteratorPrototype,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS},defineProperty$2=objectDefineProperty.f,TO_STRING_TAG=wellKnownSymbol("toStringTag"),setToStringTag=function(t,e,r){t&&!has(t=r?t:t.prototype,TO_STRING_TAG)&&defineProperty$2(t,TO_STRING_TAG,{configurable:!0,value:e})},IteratorPrototype$1=iteratorsCore.IteratorPrototype,returnThis$1=function(){return this},createIteratorConstructor=function(t,e,r){var n=e+" Iterator";return t.prototype=objectCreate(IteratorPrototype$1,{next:createPropertyDescriptor(1,r)}),setToStringTag(t,n,!1),iterators[n]=returnThis$1,t},aPossiblePrototype=function(t){if(!isObject(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t},objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var r,n=!1,t={};try{(r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),n=t instanceof Array}catch(t){}return function(t,e){return anObject(t),aPossiblePrototype(e),n?r.call(t,e):t.__proto__=e,t}}():void 0),IteratorPrototype$2=iteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS$1=iteratorsCore.BUGGY_SAFARI_ITERATORS,ITERATOR$1=wellKnownSymbol("iterator"),KEYS="keys",VALUES="values",ENTRIES="entries",returnThis$2=function(){return this},defineIterator=function(t,e,r,n,i,a,o){createIteratorConstructor(r,e,n);function s(t){if(t===i&&y)return y;if(!BUGGY_SAFARI_ITERATORS$1&&t in f)return f[t];switch(t){case KEYS:case VALUES:case ENTRIES:return function(){return new r(this,t)}}return function(){return new r(this)}}var u,l,h,c=e+" Iterator",p=!1,f=t.prototype,d=f[ITERATOR$1]||f["@@iterator"]||i&&f[i],y=!BUGGY_SAFARI_ITERATORS$1&&d||s(i),g="Array"==e&&f.entries||d;if(g&&(u=objectGetPrototypeOf(g.call(new t)),IteratorPrototype$2!==Object.prototype&&u.next&&(objectGetPrototypeOf(u)!==IteratorPrototype$2&&(objectSetPrototypeOf?objectSetPrototypeOf(u,IteratorPrototype$2):"function"!=typeof u[ITERATOR$1]&&createNonEnumerableProperty(u,ITERATOR$1,returnThis$2)),setToStringTag(u,c,!0))),i==VALUES&&d&&d.name!==VALUES&&(p=!0,y=function(){return d.call(this)}),f[ITERATOR$1]!==y&&createNonEnumerableProperty(f,ITERATOR$1,y),iterators[e]=y,i)if(l={values:s(VALUES),keys:a?y:s(KEYS),entries:s(ENTRIES)},o)for(h in l)!BUGGY_SAFARI_ITERATORS$1&&!p&&h in f||redefine(f,h,l[h]);else _export({target:e,proto:!0,forced:BUGGY_SAFARI_ITERATORS$1||p},l);return l},ARRAY_ITERATOR="Array Iterator",setInternalState=internalState.set,getInternalState=internalState.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator(Array,"Array",function(t,e){setInternalState(this,{type:ARRAY_ITERATOR,target:toIndexedObject(t),index:0,kind:e})},function(){var t=getInternalState(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?{value:t.target=void 0,done:!0}:"keys"==r?{value:n,done:!1}:"values"==r?{value:e[n],done:!1}:{value:[n,e[n]],done:!1}},"values");iterators.Arguments=iterators.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries");var $map=arrayIteration.map,HAS_SPECIES_SUPPORT$2=arrayMethodHasSpeciesSupport("map"),USES_TO_LENGTH$4=arrayMethodUsesToLength("map");_export({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$2||!USES_TO_LENGTH$4},{map:function(t,e){return $map(this,t,1<arguments.length?e:void 0)}});var arrayBufferNative="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,redefineAll=function(t,e,r){for(var n in e)redefine(t,n,e[n],r);return t},anInstance=function(t,e,r){if(!(t instanceof e))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return t},toIndex=function(t){if(void 0===t)return 0;var e=toInteger(t),r=toLength(e);if(e!==r)throw RangeError("Wrong length or index");return r},Infinity$1=1/0,abs=Math.abs,pow=Math.pow,floor$1=Math.floor,log=Math.log,LN2=Math.LN2,pack=function(t,e,r){var n,i,a,o=new Array(r),s=8*r-e-1,u=(1<<s)-1,l=u>>1,h=23===e?pow(2,-24)-pow(2,-77):0,c=t<0||0===t&&1/t<0?1:0,p=0;for((t=abs(t))!=t||t===Infinity$1?(i=t!=t?1:0,n=u):(n=floor$1(log(t)/LN2),t*(a=pow(2,-n))<1&&(n--,a*=2),2<=(t+=1<=n+l?h/a:h*pow(2,1-l))*a&&(n++,a/=2),u<=n+l?(i=0,n=u):1<=n+l?(i=(t*a-1)*pow(2,e),n+=l):(i=t*pow(2,l-1)*pow(2,e),n=0));8<=e;o[p++]=255&i,i/=256,e-=8);for(n=n<<e|i,s+=e;0<s;o[p++]=255&n,n/=256,s-=8);return o[--p]|=128*c,o},unpack=function(t,e){var r,n=t.length,i=8*n-e-1,a=(1<<i)-1,o=a>>1,s=i-7,u=n-1,l=t[u--],h=127&l;for(l>>=7;0<s;h=256*h+t[u],u--,s-=8);for(r=h&(1<<-s)-1,h>>=-s,s+=e;0<s;r=256*r+t[u],u--,s-=8);if(0===h)h=1-o;else{if(h===a)return r?NaN:l?-Infinity$1:Infinity$1;r+=pow(2,e),h-=o}return(l?-1:1)*r*pow(2,h-e)},ieee754={pack:pack,unpack:unpack},getOwnPropertyNames=objectGetOwnPropertyNames.f,defineProperty$3=objectDefineProperty.f,getInternalState$1=internalState.get,setInternalState$1=internalState.set,ARRAY_BUFFER="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE$1="prototype",WRONG_LENGTH="Wrong length",WRONG_INDEX="Wrong index",NativeArrayBuffer=global_1[ARRAY_BUFFER],$ArrayBuffer=NativeArrayBuffer,$DataView=global_1[DATA_VIEW],$DataViewPrototype=$DataView&&$DataView[PROTOTYPE$1],ObjectPrototype$1=Object.prototype,RangeError$1=global_1.RangeError,packIEEE754=ieee754.pack,unpackIEEE754=ieee754.unpack,packInt8=function(t){return[255&t]},packInt16=function(t){return[255&t,t>>8&255]},packInt32=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},unpackInt32=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},packFloat32=function(t){return packIEEE754(t,23,4)},packFloat64=function(t){return packIEEE754(t,52,8)},addGetter=function(t,e){defineProperty$3(t[PROTOTYPE$1],e,{get:function(){return getInternalState$1(this)[e]}})},get$1=function(t,e,r,n){var i=toIndex(r),a=getInternalState$1(t);if(i+e>a.byteLength)throw RangeError$1(WRONG_INDEX);var o=getInternalState$1(a.buffer).bytes,s=i+a.byteOffset,u=o.slice(s,s+e);return n?u:u.reverse()},set$1=function(t,e,r,n,i,a){var o=toIndex(r),s=getInternalState$1(t);if(o+e>s.byteLength)throw RangeError$1(WRONG_INDEX);for(var u=getInternalState$1(s.buffer).bytes,l=o+s.byteOffset,h=n(+i),c=0;c<e;c++)u[l+c]=h[a?c:e-c-1]};if(arrayBufferNative){if(!fails(function(){NativeArrayBuffer(1)})||!fails(function(){new NativeArrayBuffer(-1)})||fails(function(){return new NativeArrayBuffer,new NativeArrayBuffer(1.5),new NativeArrayBuffer(NaN),NativeArrayBuffer.name!=ARRAY_BUFFER})){for(var key,ArrayBufferPrototype=($ArrayBuffer=function(t){return anInstance(this,$ArrayBuffer),new NativeArrayBuffer(toIndex(t))})[PROTOTYPE$1]=NativeArrayBuffer[PROTOTYPE$1],keys$1=getOwnPropertyNames(NativeArrayBuffer),j=0;keys$1.length>j;)(key=keys$1[j++])in $ArrayBuffer||createNonEnumerableProperty($ArrayBuffer,key,NativeArrayBuffer[key]);ArrayBufferPrototype.constructor=$ArrayBuffer}objectSetPrototypeOf&&objectGetPrototypeOf($DataViewPrototype)!==ObjectPrototype$1&&objectSetPrototypeOf($DataViewPrototype,ObjectPrototype$1);var testView=new $DataView(new $ArrayBuffer(2)),nativeSetInt8=$DataViewPrototype.setInt8;testView.setInt8(0,2147483648),testView.setInt8(1,2147483649),!testView.getInt8(0)&&testView.getInt8(1)||redefineAll($DataViewPrototype,{setInt8:function(t,e){nativeSetInt8.call(this,t,e<<24>>24)},setUint8:function(t,e){nativeSetInt8.call(this,t,e<<24>>24)}},{unsafe:!0})}else $ArrayBuffer=function(t){anInstance(this,$ArrayBuffer,ARRAY_BUFFER);var e=toIndex(t);setInternalState$1(this,{bytes:arrayFill.call(new Array(e),0),byteLength:e}),descriptors||(this.byteLength=e)},$DataView=function(t,e,r){anInstance(this,$DataView,DATA_VIEW),anInstance(t,$ArrayBuffer,DATA_VIEW);var n=getInternalState$1(t).byteLength,i=toInteger(e);if(i<0||n<i)throw RangeError$1("Wrong offset");if(n<i+(r=void 0===r?n-i:toLength(r)))throw RangeError$1(WRONG_LENGTH);setInternalState$1(this,{buffer:t,byteLength:r,byteOffset:i}),descriptors||(this.buffer=t,this.byteLength=r,this.byteOffset=i)},descriptors&&(addGetter($ArrayBuffer,"byteLength"),addGetter($DataView,"buffer"),addGetter($DataView,"byteLength"),addGetter($DataView,"byteOffset")),redefineAll($DataView[PROTOTYPE$1],{getInt8:function(t){return get$1(this,1,t)[0]<<24>>24},getUint8:function(t){return get$1(this,1,t)[0]},getInt16:function(t,e){var r=get$1(this,2,t,1<arguments.length?e:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(t,e){var r=get$1(this,2,t,1<arguments.length?e:void 0);return r[1]<<8|r[0]},getInt32:function(t,e){return unpackInt32(get$1(this,4,t,1<arguments.length?e:void 0))},getUint32:function(t,e){return unpackInt32(get$1(this,4,t,1<arguments.length?e:void 0))>>>0},getFloat32:function(t,e){return unpackIEEE754(get$1(this,4,t,1<arguments.length?e:void 0),23)},getFloat64:function(t,e){return unpackIEEE754(get$1(this,8,t,1<arguments.length?e:void 0),52)},setInt8:function(t,e){set$1(this,1,t,packInt8,e)},setUint8:function(t,e){set$1(this,1,t,packInt8,e)},setInt16:function(t,e,r){set$1(this,2,t,packInt16,e,2<arguments.length?r:void 0)},setUint16:function(t,e,r){set$1(this,2,t,packInt16,e,2<arguments.length?r:void 0)},setInt32:function(t,e,r){set$1(this,4,t,packInt32,e,2<arguments.length?r:void 0)},setUint32:function(t,e,r){set$1(this,4,t,packInt32,e,2<arguments.length?r:void 0)},setFloat32:function(t,e,r){set$1(this,4,t,packFloat32,e,2<arguments.length?r:void 0)},setFloat64:function(t,e,r){set$1(this,8,t,packFloat64,e,2<arguments.length?r:void 0)}});setToStringTag($ArrayBuffer,ARRAY_BUFFER),setToStringTag($DataView,DATA_VIEW);var arrayBuffer={ArrayBuffer:$ArrayBuffer,DataView:$DataView},SPECIES$3=wellKnownSymbol("species"),speciesConstructor=function(t,e){var r,n=anObject(t).constructor;return void 0===n||null==(r=anObject(n)[SPECIES$3])?e:aFunction$1(r)},ArrayBuffer$1=arrayBuffer.ArrayBuffer,DataView$1=arrayBuffer.DataView,nativeArrayBufferSlice=ArrayBuffer$1.prototype.slice,INCORRECT_SLICE=fails(function(){return!new ArrayBuffer$1(2).slice(1,void 0).byteLength});_export({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:INCORRECT_SLICE},{slice:function(t,e){if(void 0!==nativeArrayBufferSlice&&void 0===e)return nativeArrayBufferSlice.call(anObject(this),t);for(var r=anObject(this).byteLength,n=toAbsoluteIndex(t,r),i=toAbsoluteIndex(void 0===e?r:e,r),a=new(speciesConstructor(this,ArrayBuffer$1))(toLength(i-n)),o=new DataView$1(this),s=new DataView$1(a),u=0;n<i;)s.setUint8(u++,o.getUint8(n++));return a}});var TO_STRING_TAG$1=wellKnownSymbol("toStringTag"),test={};test[TO_STRING_TAG$1]="z";var toStringTagSupport="[object z]"===String(test),TO_STRING_TAG$2=wellKnownSymbol("toStringTag"),CORRECT_ARGUMENTS="Arguments"==classofRaw(function(){return arguments}()),tryGet=function(t,e){try{return t[e]}catch(t){}},classof=toStringTagSupport?classofRaw:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=tryGet(e=Object(t),TO_STRING_TAG$2))?r:CORRECT_ARGUMENTS?classofRaw(e):"Object"==(n=classofRaw(e))&&"function"==typeof e.callee?"Arguments":n},objectToString=toStringTagSupport?{}.toString:function(){return"[object "+classof(this)+"]"};toStringTagSupport||redefine(Object.prototype,"toString",objectToString,{unsafe:!0});var ITERATOR$2=wellKnownSymbol("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR$2]=function(){return this},Array.from(iteratorWithReturn,function(){throw 2})}catch(t){}var NAME,checkCorrectnessOfIteration=function(t,e){if(!e&&!SAFE_CLOSING)return!1;var r=!1;try{var n={};n[ITERATOR$2]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},defineProperty$4=objectDefineProperty.f,Int8Array$1=global_1.Int8Array,Int8ArrayPrototype=Int8Array$1&&Int8Array$1.prototype,Uint8ClampedArray=global_1.Uint8ClampedArray,Uint8ClampedArrayPrototype=Uint8ClampedArray&&Uint8ClampedArray.prototype,TypedArray=Int8Array$1&&objectGetPrototypeOf(Int8Array$1),TypedArrayPrototype=Int8ArrayPrototype&&objectGetPrototypeOf(Int8ArrayPrototype),ObjectPrototype$2=Object.prototype,isPrototypeOf=ObjectPrototype$2.isPrototypeOf,TO_STRING_TAG$3=wellKnownSymbol("toStringTag"),TYPED_ARRAY_TAG=uid("TYPED_ARRAY_TAG"),NATIVE_ARRAY_BUFFER_VIEWS=arrayBufferNative&&!!objectSetPrototypeOf&&"Opera"!==classof(global_1.opera),TYPED_ARRAY_TAG_REQIRED=!1,TypedArrayConstructorsList={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},isView=function(t){var e=classof(t);return"DataView"===e||has(TypedArrayConstructorsList,e)},isTypedArray=function(t){return isObject(t)&&has(TypedArrayConstructorsList,classof(t))},aTypedArray=function(t){if(isTypedArray(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor=function(t){if(objectSetPrototypeOf){if(isPrototypeOf.call(TypedArray,t))return t}else for(var e in TypedArrayConstructorsList)if(has(TypedArrayConstructorsList,NAME)){var r=global_1[e];if(r&&(t===r||isPrototypeOf.call(r,t)))return t}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod=function(t,e,r){if(descriptors){if(r)for(var n in TypedArrayConstructorsList){var i=global_1[n];i&&has(i.prototype,t)&&delete i.prototype[t]}TypedArrayPrototype[t]&&!r||redefine(TypedArrayPrototype,t,!r&&NATIVE_ARRAY_BUFFER_VIEWS&&Int8ArrayPrototype[t]||e)}},exportTypedArrayStaticMethod=function(t,e,r){var n,i;if(descriptors){if(objectSetPrototypeOf){if(r)for(n in TypedArrayConstructorsList)(i=global_1[n])&&has(i,t)&&delete i[t];if(TypedArray[t]&&!r)return;try{return redefine(TypedArray,t,!r&&NATIVE_ARRAY_BUFFER_VIEWS&&Int8Array$1[t]||e)}catch(t){}}for(n in TypedArrayConstructorsList)!(i=global_1[n])||i[t]&&!r||redefine(i,t,e)}};for(NAME in TypedArrayConstructorsList)global_1[NAME]||(NATIVE_ARRAY_BUFFER_VIEWS=!1);if((!NATIVE_ARRAY_BUFFER_VIEWS||"function"!=typeof TypedArray||TypedArray===Function.prototype)&&(TypedArray=function(){throw TypeError("Incorrect invocation")},NATIVE_ARRAY_BUFFER_VIEWS))for(NAME in TypedArrayConstructorsList)global_1[NAME]&&objectSetPrototypeOf(global_1[NAME],TypedArray);if((!NATIVE_ARRAY_BUFFER_VIEWS||!TypedArrayPrototype||TypedArrayPrototype===ObjectPrototype$2)&&(TypedArrayPrototype=TypedArray.prototype,NATIVE_ARRAY_BUFFER_VIEWS))for(NAME in TypedArrayConstructorsList)global_1[NAME]&&objectSetPrototypeOf(global_1[NAME].prototype,TypedArrayPrototype);if(NATIVE_ARRAY_BUFFER_VIEWS&&objectGetPrototypeOf(Uint8ClampedArrayPrototype)!==TypedArrayPrototype&&objectSetPrototypeOf(Uint8ClampedArrayPrototype,TypedArrayPrototype),descriptors&&!has(TypedArrayPrototype,TO_STRING_TAG$3))for(NAME in TYPED_ARRAY_TAG_REQIRED=!0,defineProperty$4(TypedArrayPrototype,TO_STRING_TAG$3,{get:function(){return isObject(this)?this[TYPED_ARRAY_TAG]:void 0}}),TypedArrayConstructorsList)global_1[NAME]&&createNonEnumerableProperty(global_1[NAME],TYPED_ARRAY_TAG,NAME);var arrayBufferViewCore={NATIVE_ARRAY_BUFFER_VIEWS:NATIVE_ARRAY_BUFFER_VIEWS,TYPED_ARRAY_TAG:TYPED_ARRAY_TAG_REQIRED&&TYPED_ARRAY_TAG,aTypedArray:aTypedArray,aTypedArrayConstructor:aTypedArrayConstructor,exportTypedArrayMethod:exportTypedArrayMethod,exportTypedArrayStaticMethod:exportTypedArrayStaticMethod,isView:isView,isTypedArray:isTypedArray,TypedArray:TypedArray,TypedArrayPrototype:TypedArrayPrototype},NATIVE_ARRAY_BUFFER_VIEWS$1=arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS,ArrayBuffer$2=global_1.ArrayBuffer,Int8Array$2=global_1.Int8Array,typedArrayConstructorsRequireWrappers=!NATIVE_ARRAY_BUFFER_VIEWS$1||!fails(function(){Int8Array$2(1)})||!fails(function(){new Int8Array$2(-1)})||!checkCorrectnessOfIteration(function(t){new Int8Array$2,new Int8Array$2(null),new Int8Array$2(1.5),new Int8Array$2(t)},!0)||fails(function(){return 1!==new Int8Array$2(new ArrayBuffer$2(2),1,void 0).length}),toPositiveInteger=function(t){var e=toInteger(t);if(e<0)throw RangeError("The argument can't be less than 0");return e},toOffset=function(t,e){var r=toPositiveInteger(t);if(r%e)throw RangeError("Wrong offset");return r},ITERATOR$3=wellKnownSymbol("iterator"),getIteratorMethod=function(t){if(null!=t)return t[ITERATOR$3]||t["@@iterator"]||iterators[classof(t)]},ITERATOR$4=wellKnownSymbol("iterator"),ArrayPrototype$1=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(iterators.Array===t||ArrayPrototype$1[ITERATOR$4]===t)},aTypedArrayConstructor$1=arrayBufferViewCore.aTypedArrayConstructor,typedArrayFrom=function(t,e,r){var n,i,a,o,s,u,l=toObject(t),h=arguments.length,c=1<h?e:void 0,p=void 0!==c,f=getIteratorMethod(l);if(null!=f&&!isArrayIteratorMethod(f))for(u=(s=f.call(l)).next,l=[];!(o=u.call(s)).done;)l.push(o.value);for(p&&2<h&&(c=functionBindContext(c,r,2)),i=toLength(l.length),a=new(aTypedArrayConstructor$1(this))(i),n=0;n<i;n++)a[n]=p?c(l[n],n):l[n];return a},SPECIES$4=wellKnownSymbol("species"),setSpecies=function(t){var e=getBuiltIn(t),r=objectDefineProperty.f;descriptors&&e&&!e[SPECIES$4]&&r(e,SPECIES$4,{configurable:!0,get:function(){return this}})},inheritIfRequired=function(t,e,r){var n,i;return objectSetPrototypeOf&&"function"==typeof(n=e.constructor)&&n!==r&&isObject(i=n.prototype)&&i!==r.prototype&&objectSetPrototypeOf(t,i),t},typedArrayConstructor=createCommonjsModule(function(t){function d(t,e){for(var r=0,n=e.length,i=new(o(t))(n);r<n;)i[r]=e[r++];return i}function e(t,e){v(t,e,{get:function(){return g(this)[e]}})}function y(t){var e;return t instanceof k||"ArrayBuffer"==(e=classof(t))||"SharedArrayBuffer"==e}function n(t,e){return A(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)}function r(t,e){return n(t,e=toPrimitive(e,!0))?createPropertyDescriptor(2,t[e]):a(t,e)}function i(t,e,r){return!(n(t,e=toPrimitive(e,!0))&&isObject(r)&&has(r,"value"))||has(r,"get")||has(r,"set")||r.configurable||has(r,"writable")&&!r.writable||has(r,"enumerable")&&!r.enumerable?v(t,e,r):(t[e]=r.value,t)}var u=objectGetOwnPropertyNames.f,l=arrayIteration.forEach,g=internalState.get,m=internalState.set,v=objectDefineProperty.f,a=objectGetOwnPropertyDescriptor.f,w=Math.round,b=global_1.RangeError,k=arrayBuffer.ArrayBuffer,$=arrayBuffer.DataView,S=arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS,_=arrayBufferViewCore.TYPED_ARRAY_TAG,E=arrayBufferViewCore.TypedArray,T=arrayBufferViewCore.TypedArrayPrototype,o=arrayBufferViewCore.aTypedArrayConstructor,A=arrayBufferViewCore.isTypedArray,O="BYTES_PER_ELEMENT",I="Wrong length";descriptors?(S||(objectGetOwnPropertyDescriptor.f=r,objectDefineProperty.f=i,e(T,"buffer"),e(T,"byteOffset"),e(T,"byteLength"),e(T,"length")),_export({target:"Object",stat:!0,forced:!S},{getOwnPropertyDescriptor:r,defineProperty:i}),t.exports=function(t,e,a){function h(t,i){v(t,i,{get:function(){return t=i,(e=g(this)).view[r](t*c+e.byteOffset,!0);var t,e},set:function(t){return e=i,r=t,n=g(this),a&&(r=(r=w(r))<0?0:255<r?255:255&r),void n.view[o](e*c+n.byteOffset,r,!0);var e,r,n},enumerable:!0})}var c=t.match(/\d+$/)[0]/8,p=t+(a?"Clamped":"")+"Array",r="get"+t,o="set"+t,i=global_1[p],f=i,n=f&&f.prototype,s={};S?typedArrayConstructorsRequireWrappers&&(f=e(function(t,e,r,n){return anInstance(t,f,p),inheritIfRequired(isObject(e)?y(e)?void 0!==n?new i(e,toOffset(r,c),n):void 0!==r?new i(e,toOffset(r,c)):new i(e):A(e)?d(f,e):typedArrayFrom.call(f,e):new i(toIndex(e)),t,f)}),objectSetPrototypeOf&&objectSetPrototypeOf(f,E),l(u(i),function(t){t in f||createNonEnumerableProperty(f,t,i[t])}),f.prototype=n):(f=e(function(t,e,r,n){anInstance(t,f,p);var i,a,o,s=0,u=0;if(isObject(e)){if(!y(e))return A(e)?d(f,e):typedArrayFrom.call(f,e);i=e,u=toOffset(r,c);var l=e.byteLength;if(void 0===n){if(l%c)throw b(I);if((a=l-u)<0)throw b(I)}else if(l<(a=toLength(n)*c)+u)throw b(I);o=a/c}else o=toIndex(e),i=new k(a=o*c);for(m(t,{buffer:i,byteOffset:u,byteLength:a,length:o,view:new $(i)});s<o;)h(t,s++)}),objectSetPrototypeOf&&objectSetPrototypeOf(f,E),n=f.prototype=objectCreate(T)),n.constructor!==f&&createNonEnumerableProperty(n,"constructor",f),_&&createNonEnumerableProperty(n,_,p),s[p]=f,_export({global:!0,forced:f!=i,sham:!S},s),O in f||createNonEnumerableProperty(f,O,c),O in n||createNonEnumerableProperty(n,O,c),setSpecies(p)}):t.exports=function(){}});typedArrayConstructor("Float32",function(n){return function(t,e,r){return n(this,t,e,r)}});var min$3=Math.min,arrayCopyWithin=[].copyWithin||function(t,e,r){var n=toObject(this),i=toLength(n.length),a=toAbsoluteIndex(t,i),o=toAbsoluteIndex(e,i),s=2<arguments.length?r:void 0,u=min$3((void 0===s?i:toAbsoluteIndex(s,i))-o,i-a),l=1;for(o<a&&a<o+u&&(l=-1,o+=u-1,a+=u-1);0<u--;)o in n?n[a]=n[o]:delete n[a],a+=l,o+=l;return n},aTypedArray$1=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$1=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$1("copyWithin",function(t,e,r){return arrayCopyWithin.call(aTypedArray$1(this),t,e,2<arguments.length?r:void 0)});var $every=arrayIteration.every,aTypedArray$2=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$2=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$2("every",function(t,e){return $every(aTypedArray$2(this),t,1<arguments.length?e:void 0)});var aTypedArray$3=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$3=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$3("fill",function(t){return arrayFill.apply(aTypedArray$3(this),arguments)});var $filter=arrayIteration.filter,aTypedArray$4=arrayBufferViewCore.aTypedArray,aTypedArrayConstructor$2=arrayBufferViewCore.aTypedArrayConstructor,exportTypedArrayMethod$4=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$4("filter",function(t,e){for(var r=$filter(aTypedArray$4(this),t,1<arguments.length?e:void 0),n=speciesConstructor(this,this.constructor),i=0,a=r.length,o=new(aTypedArrayConstructor$2(n))(a);i<a;)o[i]=r[i++];return o});var $find=arrayIteration.find,aTypedArray$5=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$5=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$5("find",function(t,e){return $find(aTypedArray$5(this),t,1<arguments.length?e:void 0)});var $findIndex=arrayIteration.findIndex,aTypedArray$6=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$6=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$6("findIndex",function(t,e){return $findIndex(aTypedArray$6(this),t,1<arguments.length?e:void 0)});var $forEach$1=arrayIteration.forEach,aTypedArray$7=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$7=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$7("forEach",function(t,e){$forEach$1(aTypedArray$7(this),t,1<arguments.length?e:void 0)});var $includes=arrayIncludes.includes,aTypedArray$8=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$8=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$8("includes",function(t,e){return $includes(aTypedArray$8(this),t,1<arguments.length?e:void 0)});var $indexOf=arrayIncludes.indexOf,aTypedArray$9=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$9=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$9("indexOf",function(t,e){return $indexOf(aTypedArray$9(this),t,1<arguments.length?e:void 0)});var ITERATOR$5=wellKnownSymbol("iterator"),Uint8Array$1=global_1.Uint8Array,arrayValues=es_array_iterator.values,arrayKeys=es_array_iterator.keys,arrayEntries=es_array_iterator.entries,aTypedArray$a=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$a=arrayBufferViewCore.exportTypedArrayMethod,nativeTypedArrayIterator=Uint8Array$1&&Uint8Array$1.prototype[ITERATOR$5],CORRECT_ITER_NAME=!!nativeTypedArrayIterator&&("values"==nativeTypedArrayIterator.name||null==nativeTypedArrayIterator.name),typedArrayValues=function(){return arrayValues.call(aTypedArray$a(this))};exportTypedArrayMethod$a("entries",function(){return arrayEntries.call(aTypedArray$a(this))}),exportTypedArrayMethod$a("keys",function(){return arrayKeys.call(aTypedArray$a(this))}),exportTypedArrayMethod$a("values",typedArrayValues,!CORRECT_ITER_NAME),exportTypedArrayMethod$a(ITERATOR$5,typedArrayValues,!CORRECT_ITER_NAME);var aTypedArray$b=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$b=arrayBufferViewCore.exportTypedArrayMethod,$join=[].join;exportTypedArrayMethod$b("join",function(t){return $join.apply(aTypedArray$b(this),arguments)});var min$4=Math.min,nativeLastIndexOf=[].lastIndexOf,NEGATIVE_ZERO=!!nativeLastIndexOf&&1/[1].lastIndexOf(1,-0)<0,STRICT_METHOD$2=arrayMethodIsStrict("lastIndexOf"),USES_TO_LENGTH$5=arrayMethodUsesToLength("indexOf",{ACCESSORS:!0,1:0}),FORCED$1=NEGATIVE_ZERO||!STRICT_METHOD$2||!USES_TO_LENGTH$5,arrayLastIndexOf=FORCED$1?function(t,e){if(NEGATIVE_ZERO)return nativeLastIndexOf.apply(this,arguments)||0;var r=toIndexedObject(this),n=toLength(r.length),i=n-1;for(1<arguments.length&&(i=min$4(i,toInteger(e))),i<0&&(i=n+i);0<=i;i--)if(i in r&&r[i]===t)return i||0;return-1}:nativeLastIndexOf,aTypedArray$c=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$c=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$c("lastIndexOf",function(t){return arrayLastIndexOf.apply(aTypedArray$c(this),arguments)});var $map$1=arrayIteration.map,aTypedArray$d=arrayBufferViewCore.aTypedArray,aTypedArrayConstructor$3=arrayBufferViewCore.aTypedArrayConstructor,exportTypedArrayMethod$d=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$d("map",function(t,e){return $map$1(aTypedArray$d(this),t,1<arguments.length?e:void 0,function(t,e){return new(aTypedArrayConstructor$3(speciesConstructor(t,t.constructor)))(e)})});var $reduce$1=arrayReduce.left,aTypedArray$e=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$e=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$e("reduce",function(t,e){return $reduce$1(aTypedArray$e(this),t,arguments.length,1<arguments.length?e:void 0)});var $reduceRight=arrayReduce.right,aTypedArray$f=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$f=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$f("reduceRight",function(t,e){return $reduceRight(aTypedArray$f(this),t,arguments.length,1<arguments.length?e:void 0)});var aTypedArray$g=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$g=arrayBufferViewCore.exportTypedArrayMethod,floor$2=Math.floor;exportTypedArrayMethod$g("reverse",function(){for(var t,e=this,r=aTypedArray$g(e).length,n=floor$2(r/2),i=0;i<n;)t=e[i],e[i++]=e[--r],e[r]=t;return e});var aTypedArray$h=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$h=arrayBufferViewCore.exportTypedArrayMethod,FORCED$2=fails(function(){new Int8Array(1).set({})});exportTypedArrayMethod$h("set",function(t,e){aTypedArray$h(this);var r=toOffset(1<arguments.length?e:void 0,1),n=this.length,i=toObject(t),a=toLength(i.length),o=0;if(n<a+r)throw RangeError("Wrong length");for(;o<a;)this[r+o]=i[o++]},FORCED$2);var aTypedArray$i=arrayBufferViewCore.aTypedArray,aTypedArrayConstructor$4=arrayBufferViewCore.aTypedArrayConstructor,exportTypedArrayMethod$i=arrayBufferViewCore.exportTypedArrayMethod,$slice=[].slice,FORCED$3=fails(function(){new Int8Array(1).slice()});exportTypedArrayMethod$i("slice",function(t,e){for(var r=$slice.call(aTypedArray$i(this),t,e),n=speciesConstructor(this,this.constructor),i=0,a=r.length,o=new(aTypedArrayConstructor$4(n))(a);i<a;)o[i]=r[i++];return o},FORCED$3);var $some=arrayIteration.some,aTypedArray$j=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$j=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$j("some",function(t,e){return $some(aTypedArray$j(this),t,1<arguments.length?e:void 0)});var aTypedArray$k=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$k=arrayBufferViewCore.exportTypedArrayMethod,$sort=[].sort;exportTypedArrayMethod$k("sort",function(t){return $sort.call(aTypedArray$k(this),t)});var aTypedArray$l=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$l=arrayBufferViewCore.exportTypedArrayMethod;exportTypedArrayMethod$l("subarray",function(t,e){var r=aTypedArray$l(this),n=r.length,i=toAbsoluteIndex(t,n);return new(speciesConstructor(r,r.constructor))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,toLength((void 0===e?n:toAbsoluteIndex(e,n))-i))});var Int8Array$3=global_1.Int8Array,aTypedArray$m=arrayBufferViewCore.aTypedArray,exportTypedArrayMethod$m=arrayBufferViewCore.exportTypedArrayMethod,$toLocaleString=[].toLocaleString,$slice$1=[].slice,TO_LOCALE_STRING_BUG=!!Int8Array$3&&fails(function(){$toLocaleString.call(new Int8Array$3(1))}),FORCED$4=fails(function(){return[1,2].toLocaleString()!=new Int8Array$3([1,2]).toLocaleString()})||!fails(function(){Int8Array$3.prototype.toLocaleString.call([1,2])});exportTypedArrayMethod$m("toLocaleString",function(){return $toLocaleString.apply(TO_LOCALE_STRING_BUG?$slice$1.call(aTypedArray$m(this)):aTypedArray$m(this),arguments)},FORCED$4);var exportTypedArrayMethod$n=arrayBufferViewCore.exportTypedArrayMethod,Uint8Array$2=global_1.Uint8Array,Uint8ArrayPrototype=Uint8Array$2&&Uint8Array$2.prototype||{},arrayToString=[].toString,arrayJoin=[].join;fails(function(){arrayToString.call({})})&&(arrayToString=function(){return arrayJoin.call(this)});var IS_NOT_ARRAY_METHOD=Uint8ArrayPrototype.toString!=arrayToString;exportTypedArrayMethod$n("toString",arrayToString,IS_NOT_ARRAY_METHOD);var GPU=gpu.GPU,input=gpu.input,gpuInstance=null;function setup(t){gpuInstance=t}function teardown(){gpuInstance&&gpuInstance.destroy(),gpuInstance=null}function makeKernel(t,e){return null===gpuInstance&&setup(new GPU({mode:"gpu"})),e.hasOwnProperty("map")?gpuInstance.createKernelMap(e.map,t,e).setPipeline(!0):gpuInstance.createKernel(t,e).setPipeline(!0)}function makeDevKernel(t,e){if(e&&e.map)throw new Error("map kernels are not supported by dev kernels");return new GPU({mode:"dev"}).createKernel(t,e)}function kernelInput(t,e){return input(t,e)}function release(t){t&&t.delete&&t.delete()}function clear(t){if(t.clear)t.clear();else if(t instanceof Float32Array)t.fill(0);else if(t[0]instanceof Float32Array)for(var e=0;e<t.length;e++)t[e].fill(0);else if(t[0][0]instanceof Float32Array)for(var r=0;r<t.length;r++)for(var n=t[r],i=0;i<n.length;i++)n[i].fill(0)}function clone(t){if(t.clone)return t.clone();if("number"==typeof t[0])return t.slice(0);if("number"==typeof t[0][0]){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=t[r].slice(0);return e}if("number"!=typeof t[0][0][0])throw new Error("unknown state!");for(var n=new Array(t.length),i=0;i<t.length;i++)for(var a=t[i],o=new Array(a.length),s=0;s<a.length;s++)o[s]=a[s].slice(0);return n}var kernel={setup:setup,teardown:teardown,makeKernel:makeKernel,makeDevKernel:makeDevKernel,kernelInput:kernelInput,release:release,clone:clone,clear:clear},zeros=function(t){return new Float32Array(t)},zeros2d=function(t,e){for(var r=new Array(e),n=0;n<e;n++)r[n]=zeros(t);return r};function checkSameSize(t,e){if(t.width!==e.width)throw new Error("Layer width mismatch of ".concat(t.width," and ").concat(e.width));if(t.height!==e.height)throw new Error("Layer height mismatch of ".concat(t.height," and ").concat(e.height))}var layerSize={checkSameSize:checkSameSize},defineProperty$5=objectDefineProperty.f,FunctionPrototype=Function.prototype,FunctionPrototypeToString=FunctionPrototype.toString,nameRE=/^\s*function ([^ (]*)/,NAME$1="name";!descriptors||NAME$1 in FunctionPrototype||defineProperty$5(FunctionPrototype,NAME$1,{configurable:!0,get:function(){try{return FunctionPrototypeToString.call(this).match(nameRE)[1]}catch(t){return""}}});var whitespaces="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",whitespace="["+whitespaces+"]",ltrim=RegExp("^"+whitespace+whitespace+"*"),rtrim=RegExp(whitespace+whitespace+"*$"),createMethod$3=function(r){return function(t){var e=String(requireObjectCoercible(t));return 1&r&&(e=e.replace(ltrim,"")),2&r&&(e=e.replace(rtrim,"")),e}},stringTrim={start:createMethod$3(1),end:createMethod$3(2),trim:createMethod$3(3)},getOwnPropertyNames$1=objectGetOwnPropertyNames.f,getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f,defineProperty$6=objectDefineProperty.f,trim=stringTrim.trim,NUMBER="Number",NativeNumber=global_1[NUMBER],NumberPrototype=NativeNumber.prototype,BROKEN_CLASSOF=classofRaw(objectCreate(NumberPrototype))==NUMBER,toNumber=function(t){var e,r,n,i,a,o,s,u,l=toPrimitive(t,!1);if("string"==typeof l&&2<l.length)if(43===(e=(l=trim(l)).charCodeAt(0))||45===e){if(88===(r=l.charCodeAt(2))||120===r)return NaN}else if(48===e){switch(l.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+l}for(o=(a=l.slice(2)).length,s=0;s<o;s++)if((u=a.charCodeAt(s))<48||i<u)return NaN;return parseInt(a,n)}return+l};if(isForced_1(NUMBER,!NativeNumber(" 0o1")||!NativeNumber("0b1")||NativeNumber("+0x1"))){for(var key$1,NumberWrapper=function(t){var e=arguments.length<1?0:t,r=this;return r instanceof NumberWrapper&&(BROKEN_CLASSOF?fails(function(){NumberPrototype.valueOf.call(r)}):classofRaw(r)!=NUMBER)?inheritIfRequired(new NativeNumber(toNumber(e)),r,NumberWrapper):toNumber(e)},keys$2=descriptors?getOwnPropertyNames$1(NativeNumber):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),j$1=0;keys$2.length>j$1;j$1++)has(NativeNumber,key$1=keys$2[j$1])&&!has(NumberWrapper,key$1)&&defineProperty$6(NumberWrapper,key$1,getOwnPropertyDescriptor$2(NativeNumber,key$1));(NumberWrapper.prototype=NumberPrototype).constructor=NumberWrapper,redefine(global_1,NUMBER,NumberWrapper)}_export({target:"Number",stat:!0},{isNaN:function(t){return t!=t}});var release$1=kernel.release,clear$1=kernel.clear,Base=function(){function s(t){_classCallCheck(this,s),this.width=null,this.height=null,this.depth=null,this.deltas=null,this.weights=null,this.praxis=null,this.praxisOpts=null,this.constructor!==s&&Object.assign(this,s.defaults,t),Object.assign(this,this.constructor.defaults,t),this.setupPraxis(t)}return _createClass(s,null,[{key:"defaults",get:function(){return{width:1,height:1,depth:null,weights:null,deltas:null,name:null,praxisOpts:null}}}]),_createClass(s,[{key:"setupPraxis",value:function(t){t&&t.hasOwnProperty("praxis")&&("function"==typeof t.praxis?this.praxis=t.praxis(this,t.praxisOpts):this.praxis=t.praxis)}},{key:"validate",value:function(){if(Number.isNaN(this.height))throw new Error("".concat(this.constructor.name," layer height is not a number"));if(Number.isNaN(this.width))throw new Error("".concat(this.constructor.name," layer width is not a number"));if(this.height<1)throw new Error("".concat(this.constructor.name," layer height is less than 1"));if(this.width<1)throw new Error("".concat(this.constructor.name," layer width is less than 1"))}},{key:"setupKernels",value:function(){}},{key:"reuseKernels",value:function(t){if(t.width!==this.width)throw new Error("".concat(this.constructor.name," kernel width mismatch ").concat(t.width," is not ").concat(this.width));if(t.height!==this.height)throw new Error("".concat(this.constructor.name," kernel width mismatch ").concat(t.height," is not ").concat(this.height));if(t.hasOwnProperty("predictKernel")){if(!t.predictKernel.immutable)throw new Error("".concat(t.constructor.name,".predictKernel is not reusable, set kernel.immutable = true"));this.predictKernel=t.predictKernel}if(t.hasOwnProperty("compareKernel")){if(!t.compareKernel.immutable)throw new Error("".concat(t.constructor.name,".compareKernel is not reusable, set kernel.immutable = true"));this.compareKernel=t.compareKernel}this.praxis=t.praxis}},{key:"predict",value:function(){}},{key:"compare",value:function(){}},{key:"learn",value:function(t,e,r){var n=this.weights;this.weights=this.praxis.run(this,t,e,r),release$1(n),clear$1(this.deltas)}},{key:"toArray",value:function(){return this.weights.toArray()}},{key:"toJSON",value:function(){var t={},e=this.constructor,r=e.defaults,n=e.name;this.constructor!==s&&Object.assign(r,s.defaults,r);for(var i=Object.keys(r),a=0;a<i.length;a++){var o=i[a];"deltas"!==o&&("name"===o&&null===this[o]||(t[o]=this[o]))}return t.type=n,t}}]),s}(),base={Base:Base},zeros3d=function(t,e,r){for(var n=new Array(r),i=0;i<r;i++)n[i]=zeros2d(t,e);return n},Base$1=base.Base,Activation=function(){_inherits(s,Base$1);var o=_createSuper(s);function s(t,e){var r;_classCallCheck(this,s);var n=((r=o.call(this)).inputLayer=t).width,i=t.height,a=t.depth;return r.predictKernel=null,r.compareKernel=null,r.width=n,r.height=i,r.validate(),0<a?(r.depth=a,r.weights=zeros3d(n,i,a),r.deltas=zeros3d(n,i,a)):(r.weights=zeros2d(n,i),r.deltas=zeros2d(n,i)),r.setupPraxis(e),r}return s}(),activation$1={Activation:Activation},Base$2=base.Base,Activation$1=activation$1.Activation,Internal=function t(){_classCallCheck(this,t)},InternalModel=function t(){_classCallCheck(this,t)},EntryPoint=function(){_inherits(e,Base$2);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return e}(),Filter=function(){_inherits(e,Base$2);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return e}(),Model=function(){_inherits(e,Base$2);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return e}(),Modifier=function(){_inherits(e,Base$2);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return e}(),Operator=function(){_inherits(e,Base$2);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return e}(),types={Activation:Activation$1,Internal:Internal,InternalModel:InternalModel,EntryPoint:EntryPoint,Filter:Filter,Model:Model,Modifier:Modifier,Operator:Operator},makeKernel$1=kernel.makeKernel,release$2=kernel.release,clone$1=kernel.clone,clear$2=kernel.clear,checkSameSize$1=layerSize.checkSameSize,Operator$1=types.Operator;function predict(t,e){return t[this.thread.y][this.thread.x]+e[this.thread.y][this.thread.x]}var Add=function(){_inherits(a,Operator$1);var i=_createSuper(a);function a(t,e,r){var n;return _classCallCheck(this,a),(n=i.call(this)).inputLayer1=t,n.inputLayer2=e,n.width=n.inputLayer1.width,n.height=n.inputLayer1.height,n.validate(),n.weights=zeros2d(n.width,n.height),n.deltas=zeros2d(n.width,n.height),n.setupPraxis(r),n}return _createClass(a,[{key:"validate",value:function(){_get(_getPrototypeOf(a.prototype),"validate",this).call(this),checkSameSize$1(this.inputLayer1,this.inputLayer2)}},{key:"setupKernels",value:function(){this.predictKernel=makeKernel$1(predict,{output:[this.width,this.height],immutable:!0})}},{key:"predict",value:function(){release$2(this.weights),this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights),clear$2(this.deltas)}},{key:"compare",value:function(){release$2(this.inputLayer1.deltas),release$2(this.inputLayer2.deltas),this.inputLayer1.deltas=clone$1(this.deltas),this.inputLayer2.deltas=clone$1(this.deltas)}},{key:"learn",value:function(){}}]),a}();function add(t,e,r){return new Add(t,e,r)}var add_1={Add:Add,add:add,predict:predict},Base$3=function(){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,r),this.layerTemplate=t,this.width=t.width||null,this.height=t.height||null,this.depth=t.depth||null,Object.assign(this,this.constructor.defaults,e)}return _createClass(r,null,[{key:"defaults",get:function(){return{}}}]),_createClass(r,[{key:"setupKernels",value:function(){}},{key:"reuseKernels",value:function(t){if(t.width!==this.width)throw new Error("".concat(this.constructor.name," kernel width mismatch ").concat(t.width," is not ").concat(this.width));if(t.height!==this.height)throw new Error("".concat(this.constructor.name," kernel width mismatch ").concat(t.height," is not ").concat(this.height));t.hasOwnProperty("kernel")&&(this.kernel=t.kernel)}},{key:"run",value:function(){}}]),r}(),base$1={Base:Base$3},makeKernel$2=kernel.makeKernel,Base$4=base$1.Base;function updateChange(t){return t}function update(t,e,r,n){var i=t[this.thread.y][this.thread.x],a=n[this.thread.y][0],o=e[this.thread.y][this.thread.x],s=r[this.thread.x][0];return o+(this.constants.learningRate*a*s+this.constants.momentum*i)}var ArthurDeviationWeights=function(){_inherits(i,Base$4);var n=_createSuper(i);function i(t,e){var r;return _classCallCheck(this,i),(r=n.call(this,t,e)).weightsLayer=null,r.incomingLayer=null,r.deltaLayer=null,e&&(e.weightsLayer&&(r.weightsLayer=e.weightsLayer),e.incomingLayer&&(r.incomingLayer=e.incomingLayer),e.deltaLayer&&(r.deltaLayer=e.deltaLayer)),r.changes=zeros2d(t.width,t.height),r}return _createClass(i,null,[{key:"defaults",get:function(){return{learningRate:.3,momentum:.1}}}]),_createClass(i,[{key:"run",value:function(){var t=this.kernel(this.changes,this.weightsLayer.weights,this.incomingLayer.weights,this.deltaLayer.deltas);return this.changes=t.changes,t.result}},{key:"setupKernels",value:function(){this.kernel=makeKernel$2(update,{map:{changes:updateChange},output:[this.width,this.height],constants:{learningRate:this.learningRate,momentum:this.momentum}})}}]),i}();function arthurDeviationWeights(t,e){return new ArthurDeviationWeights(t,e)}var arthurDeviationWeights_1={ArthurDeviationWeights:ArthurDeviationWeights,arthurDeviationWeights:arthurDeviationWeights,update:update,updateChange:updateChange},makeKernel$3=kernel.makeKernel,Base$5=base$1.Base;function update$1(t,e){return t[this.thread.y][this.thread.x]+this.constants.learningRate*e[this.thread.y][this.thread.x]}var ArthurDeviationBiases=function(){_inherits(i,Base$5);var n=_createSuper(i);function i(t,e){var r;return _classCallCheck(this,i),(r=n.call(this,t,e)).kernel=null,r}return _createClass(i,null,[{key:"defaults",get:function(){return{learningRate:.3}}}]),_createClass(i,[{key:"run",value:function(t){return this.kernel(t.weights,t.deltas)}},{key:"setupKernels",value:function(){this.kernel=makeKernel$3(update$1,{output:[this.width,this.height],constants:{learningRate:this.learningRate}})}}]),i}();function arthurDeviationBiases(t,e){return new ArthurDeviationBiases(t,e)}var arthurDeviationBiases_1={ArthurDeviationBiases:ArthurDeviationBiases,arthurDeviationBiases:arthurDeviationBiases,update:update$1},randomWeight=function(){return.4*Math.random()-.2};function randomFloat(t,e){return Math.random()*(e-t)+t}function gaussRandom(){if(gaussRandom.returnV)return gaussRandom.returnV=!1,gaussRandom.vVal;var t=2*Math.random()-1,e=2*Math.random()-1,r=t*t+e*e;if(0==r||1<r)return gaussRandom();var n=Math.sqrt(-2*Math.log(r)/r);return gaussRandom.vVal=e*n,gaussRandom.returnV=!0,t*n}function randomInteger(t,e){return Math.floor(Math.random()*(e-t)+t)}function randomN(t,e){return t+gaussRandom()*e}gaussRandom.returnV=!1,gaussRandom.vVal=0;var random={randomFloat:randomFloat,randomInteger:randomInteger,randomN:randomN},randomFloat$1=random.randomFloat,randos=function(t,e){var r=new Float32Array(t);if(e)for(var n=0;n<t;n++)r[n]=randomFloat$1(-e,e);else for(var i=0;i<t;i++)r[i]=randomWeight();return r},randos2d=function(t,e,r){for(var n=2<arguments.length&&void 0!==r?r:null,i=new Array(e),a=0;a<e;a++)i[a]=randos(t,n);return i},Model$1=types.Model,Random=function(){_inherits(n,Model$1);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this,t)).validate(),e.weights||(e.weights=t.std?randos2d(e.width,e.height,t.std):randos2d(e.width,e.height)),e.deltas||(e.deltas=zeros2d(e.width,e.height)),e}return _createClass(n,null,[{key:"defaults",get:function(){return{std:null}}}]),_createClass(n,[{key:"predict",value:function(){}},{key:"compare",value:function(){}}]),n}();function random$1(t){return new Random(t)}var random_1={Random:Random,random:random$1},makeKernel$4=kernel.makeKernel,release$3=kernel.release,clear$3=kernel.clear,Operator$2=types.Operator;function predict$1(t,e){for(var r=0,n=0;n<this.constants.size;n++)r+=t[this.thread.y][n]*e[n][this.thread.x];return r}function compareFromX(t,e,r){for(var n=e[this.thread.y][this.thread.x],i=0;i<this.constants.size;i++)n+=t[this.thread.y][i]*r[this.thread.x][i];return n}function compareFromY(t,e,r){for(var n=e[this.thread.y][this.thread.x],i=0;i<this.constants.size;i++)n+=t[i][this.thread.x]*r[i][this.thread.y];return n}var Multiply=function(){_inherits(a,Operator$2);var i=_createSuper(a);function a(t,e){var r,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,a),(r=i.call(this)).inputLayer1=t,r.inputLayer2=e,r.compareKernel1=null,r.compareKernel2=null,r.width=e.width,r.height=t.height,r.validate(),r.weights=zeros2d(r.width,r.height),r.deltas=zeros2d(r.width,r.height),n&&n.name&&(r.name=n.name),r.setupPraxis(n),r}return _createClass(a,[{key:"validate",value:function(){if(_get(_getPrototypeOf(a.prototype),"validate",this).call(this),this.inputLayer1.width!==this.inputLayer2.height)throw new Error("Layer width mismatch of ".concat(this.inputLayer1.width," and ").concat(this.inputLayer2.height))}},{key:"setupKernels",value:function(){this.predictKernel=makeKernel$4(predict$1,{output:[this.width,this.height],constants:{size:this.inputLayer2.height},immutable:!0}),this.compareKernel1=makeKernel$4(compareFromX,{output:[this.inputLayer1.width,this.inputLayer1.height],constants:{size:this.inputLayer2.width},immutable:!0}),this.compareKernel2=makeKernel$4(compareFromY,{output:[this.inputLayer2.width,this.inputLayer2.height],constants:{size:this.inputLayer1.height},immutable:!0})}},{key:"reuseKernels",value:function(t){_get(_getPrototypeOf(a.prototype),"reuseKernels",this).call(this,t),this.compareKernel1=t.compareKernel1,this.compareKernel2=t.compareKernel2}},{key:"predict",value:function(){release$3(this.weights),this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights),clear$3(this.deltas)}},{key:"compare",value:function(){var t=this.inputLayer1.deltas,e=this.inputLayer2.deltas,r=this.compareKernel1(this.deltas,this.inputLayer1.deltas,this.inputLayer2.weights),n=this.compareKernel2(this.deltas,this.inputLayer2.deltas,this.inputLayer1.weights);this.inputLayer2.deltas=n,this.inputLayer1.deltas=r,release$3(t),release$3(e)}},{key:"learn",value:function(){}}]),a}();function multiply(t,e,r){return new Multiply(t,e,r)}var multiply_1={Multiply:Multiply,multiply:multiply,predict:predict$1,compareFromX:compareFromX,compareFromY:compareFromY},Activation$2=types.Activation,makeKernel$5=kernel.makeKernel,release$4=kernel.release,clear$4=kernel.clear,activate$4=sigmoid.activate,measure$4=sigmoid.measure;function predict2D(t){return 1/(1+Math.exp(-t[this.thread.y][this.thread.x]))}function predict3D(t){return 1/(1+Math.exp(-t[this.thread.z][this.thread.y][this.thread.x]))}function compare2D(t,e){var r=t[this.thread.y][this.thread.x];return r*(1-r)*e[this.thread.y][this.thread.x]}function compare3D(t,e){var r=t[this.thread.z][this.thread.y][this.thread.x];return r*(1-r)*e[this.thread.z][this.thread.y][this.thread.x]}var Sigmoid=function(){_inherits(e,Activation$2);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"setupKernels",value:function(){0<this.depth?(this.predictKernel=makeKernel$5(predict3D,{output:[this.width,this.height,this.depth],functions:[activate$4],immutable:!0}),this.compareKernel=makeKernel$5(compare3D,{output:[this.width,this.height,this.depth],functions:[measure$4],immutable:!0})):(this.predictKernel=makeKernel$5(predict2D,{output:[this.width,this.height],functions:[activate$4],immutable:!0}),this.compareKernel=makeKernel$5(compare2D,{output:[this.width,this.height],functions:[measure$4],immutable:!0}))}},{key:"predict",value:function(){release$4(this.weights),this.weights=this.predictKernel(this.inputLayer.weights),clear$4(this.deltas)}},{key:"compare",value:function(){release$4(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}}]),e}();function sigmoid$1(t,e){return new Sigmoid(t,e)}var sigmoid_1={Sigmoid:Sigmoid,sigmoid:sigmoid$1,predict2D:predict2D,predict3D:predict3D,compare2D:compare2D,compare3D:compare3D},arthurDeviationWeights$1=arthurDeviationWeights_1.arthurDeviationWeights,arthurDeviationBiases$1=arthurDeviationBiases_1.arthurDeviationBiases,add$1=add_1.add,random$2=random_1.random,multiply$1=multiply_1.multiply,sigmoid$2=sigmoid_1.sigmoid;function arthurFeedForward(t,e){var r=t.height;var n=random$2({name:"weights",height:r,width:e.height,praxis:function(t,e){var r=arthurDeviationWeights$1(t,e);return r.setupKernels(),r}}),i=random$2({name:"biases",height:r,praxis:function(t,e){var r=arthurDeviationBiases$1(t,e);return r.setupKernels(),r}}),a=multiply$1(n,e),o=add$1(a,i),s=sigmoid$2(o);return(n.praxis.weightsLayer=n).praxis.incomingLayer=e,n.praxis.deltaLayer=s}var arthurFeedForward_1={arthurFeedForward:arthurFeedForward};function setStride(t,e){var r=t.constructor.defaults;e.hasOwnProperty("stride")?(t.strideX=e.stride,t.strideY=e.stride):(e.hasOwnProperty("strideX")?t.strideX=e.strideX:t.strideX=r.stride,e.hasOwnProperty("strideY")?t.strideY=e.strideY:t.strideY=r.stride)}function setPadding(t,e){var r=t.constructor.defaults;e.hasOwnProperty("padding")?(t.paddingX=e.padding,t.paddingY=e.padding):(e.hasOwnProperty("paddingX")?t.paddingX=e.paddingX:t.paddingX=r.padding,e.hasOwnProperty("paddingY")?t.paddingY=e.paddingY:t.paddingY=r.padding)}var layerSetup={setStride:setStride,setPadding:setPadding},randos3d=function(t,e,r){for(var n=new Array(r),i=0;i<r;i++)n[i]=randos2d(t,e);return n},values=function(t,e){return new Float32Array(t).fill(e)},makeKernel$6=kernel.makeKernel,release$5=kernel.release,clone$2=kernel.clone,clear$5=kernel.clear,setStride$1=layerSetup.setStride,setPadding$1=layerSetup.setPadding,Filter$1=types.Filter;function predict$2(t,e,r){for(var n=this.constants.paddingX-this.thread.x*this.constants.strideX,i=this.thread.x*this.constants.strideX-this.constants.paddingX,a=Math.min(this.constants.filterWidth,n+this.constants.inputWidth),o=this.constants.paddingY-this.thread.y*this.constants.strideY,s=this.thread.y*this.constants.strideY-this.constants.paddingY,u=Math.min(this.constants.filterHeight,o+this.constants.inputHeight),l=0,h=0;h<this.constants.inputDepth;h++)for(var c=Math.max(0,o),p=Math.max(0,s);c<u;c++,p++)for(var f=Math.max(0,n),d=Math.max(0,i);f<a;f++,d++)l+=e[h][c][f]*t[h][p][d];return l+r[this.thread.z]}function compareFilterDeltas(t,e,r){for(var n=Math.max(0,Math.ceil((this.constants.paddingX-this.thread.x)/this.constants.strideX)),i=n*this.constants.strideX+this.thread.x-this.constants.paddingX,a=Math.min(this.constants.deltaWidth,Math.floor((this.constants.inputWidth-1-this.thread.x+this.constants.paddingX)/this.constants.strideX)+1),o=Math.max(0,Math.ceil((this.constants.paddingY-this.thread.y)/this.constants.strideY)),s=o*this.constants.strideY+this.thread.y-this.constants.paddingY,u=Math.min(this.constants.deltaHeight,Math.floor((this.constants.inputHeight-1-this.thread.y+this.constants.paddingY)/this.constants.strideY)+1),l=t[this.thread.z][this.thread.y][this.thread.x],h=o,c=s;h<u;h++,c+=this.constants.strideY)for(var p=n,f=i;p<a;p++,f+=this.constants.strideX)l+=e[this.thread.z][c][f]*r[this.constants.deltaZ][h][p];return l}function compareInputDeltas(t,e,r){for(var n=this.thread.x+this.constants.paddingX,i=n<this.constants.filterWidth?0:Math.floor((n-this.constants.filterWidth+this.constants.strideX)/this.constants.strideX),a=n-i*this.constants.strideX,o=Math.min(i+Math.floor(a/this.constants.strideX)+1,this.constants.deltaWidth),s=this.thread.y+this.constants.paddingY,u=s<this.constants.filterHeight?0:Math.floor((s-this.constants.filterHeight+this.constants.strideY)/this.constants.strideY),l=s-u*this.constants.strideY,h=Math.min(u+Math.floor(l/this.constants.strideY)+1,this.constants.deltaHeight),c=t[this.thread.z][this.thread.y][this.thread.x],p=u,f=l;p<h;f-=this.constants.strideY,p++)for(var d=i,y=a;d<o;y-=this.constants.strideX,d++)c+=e[this.thread.z][f][y]*r[this.constants.deltaZ][p][d];return c}function compareBiases(t,e){for(var r=0,n=0;n<this.constants.deltaHeight;n++)for(var i=0;i<this.constants.deltaWidth;i++)r+=e[this.thread.z][n][i];return t[this.thread.z][this.thread.y][this.thread.x]+r}var Convolution=function(){_inherits(i,Filter$1);var n=_createSuper(i);function i(t,e){var r;return _classCallCheck(this,i),(r=n.call(this,t)).stride=null,r.strideX=null,r.strideY=null,setStride$1(_assertThisInitialized(r),t),r.padding=null,r.paddingX=null,r.paddingY=null,setPadding$1(_assertThisInitialized(r),t),r.filterCount=t.filterCount,r.filterWidth=t.filterWidth,r.filterHeight=t.filterHeight,r.width=Math.floor((e.width+2*r.paddingX-r.filterWidth)/r.strideX+1),r.height=Math.floor((e.height+2*r.paddingY-r.filterHeight)/r.strideY+1),r.depth=r.filterCount,r.weights=randos3d(r.width,r.height,r.depth),r.deltas=zeros3d(r.width,r.height,r.depth),r.biases=values(r.depth,r.bias),r.biasDeltas=randos(r.depth),r.filters=randos3d(r.filterWidth,r.filterHeight,r.filterCount),r.filterDeltas=zeros3d(r.filterWidth,r.filterHeight,r.filterCount),r.learnFilters=null,r.learnInputs=null,r.inputLayer=e,r.validate(),r}return _createClass(i,null,[{key:"defaults",get:function(){return{stride:0,padding:0,bias:.1,filterCount:1,filterWidth:0,filterHeight:0}}}]),_createClass(i,[{key:"setupKernels",value:function(){this.predictKernel=makeKernel$6(predict$2,{constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,inputDepth:this.inputLayer.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight},output:[this.width,this.height,this.depth],immutable:!0}),this.compareFilterDeltasKernel=makeKernel$6(compareFilterDeltas,{constants:{deltasWidth:this.width,deltasHeight:this.height,deltasDepth:this.depth,inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,inputDepth:this.inputLayer.depth,strideX:this.strideX,strideY:this.strideY,paddingX:this.paddingX,paddingY:this.paddingY,filterWidth:this.filterWidth,filterHeight:this.filterHeight},output:[this.width,this.height,this.depth],immutable:!0}),this.compareInputDeltasKernel=makeKernel$6(compareInputDeltas,{constants:{filterCount:this.filterCount},output:[this.inputLayer.width,this.inputLayer.height,this.inputLayer.depth],immutable:!0}),this.compareBiasesKernel=makeKernel$6(compareBiases,{output:[1,1,this.depth],constants:{deltaWidth:this.width,deltaHeight:this.height},immutable:!0})}},{key:"predict",value:function(){this.weights=this.predictKernel(this.inputLayer.weights,this.filters,this.biases)}},{key:"compare",value:function(){var t=this.filterDeltas,e=this.biasDeltas;this.filterDeltas=this.compareFilterDeltasKernel(t,this.inputLayer.weights,this.deltas),release$5(t),this.biasDeltas=this.compareBiasesKernel(e,this.deltas),release$5(e),release$5(this.deltas),this.deltas=this.compareInputDeltasKernel(this.filters,this.inputLayer.deltas),release$5(this.inputLayer.deltas),this.inputLayer.deltas=clone$2(this.deltas)}},{key:"learn",value:function(t,e,r){var n=this.weights;this.weights=this.praxis.run(this,t,e,r),release$5(n),clear$5(this.deltas)}}]),i}();function convolution(t,e){return new Convolution(t,e)}var convolution_1={Convolution:Convolution,convolution:convolution,predict:predict$2,compareFilterDeltas:compareFilterDeltas,compareInputDeltas:compareInputDeltas,compareBiases:compareBiases},Filter$2=types.Filter,makeKernel$7=kernel.makeKernel,release$6=kernel.release;function setDropout(t){return t}function trainingPredict(t){return setDropout(Math.random())<this.constants.probability?0:t[this.thread.y][this.thread.x]}function predict$3(t){return t[this.thread.y][this.thread.x]*this.constants.probability}function compare(t,e){return 0===t[this.thread.y][this.thread.x]?0:e[this.thread.y][this.thread.x]}var Dropout=function(){_inherits(i,Filter$2);var n=_createSuper(i);function i(t,e){var r;return _classCallCheck(this,i),(r=n.call(this,e)).inputLayer=t,r.height=t.height,r.width=t.width,r.dropouts=null,r.validate(),r}return _createClass(i,null,[{key:"defaults",get:function(){return{width:1,height:1,depth:null,probability:.5}}}]),_createClass(i,[{key:"setupKernels",value:function(t){var e=[this.width,this.height];t?(this.predictKernel=makeKernel$7(trainingPredict,{output:e,map:{dropouts:setDropout},immutable:!0}),this.compareKernel=makeKernel$7(compare,{output:e,immutable:!0})):this.predictKernel=makeKernel$7(predict$3,{output:e,immutable:!0})}},{key:"predict",value:function(){release$6(this.weights),release$6(this.dropouts);var t=this.predictKernel(this.inputLayer.weights),e=t.result,r=t.dropouts;this.weights=e,this.dropouts=r}},{key:"compare",value:function(){release$6(this.deltas),this.deltas=this.compareKernel(this.dropouts,this.inputLayer.deltas)}}]),i}();function dropout(t,e){return new Dropout(t,e)}var dropout_1={Dropout:Dropout,dropout:dropout,setDropout:setDropout,trainingPredict:trainingPredict,predict:predict$3,compare:compare},random$3=random_1.random,add$2=add_1.add,multiply$2=multiply_1.multiply,sigmoid$3=sigmoid_1.sigmoid;function feedForward(t,e){var r=t.height,n=t.praxisOpts,i=random$3({name:"weights",height:r,width:e.height,praxisOpts:n}),a=random$3({name:"biases",height:r,praxisOpts:n});return sigmoid$3(add$2(multiply$2(i,e,{praxisOpts:n}),a,{praxisOpts:n}),{praxisOpts:n})}var feedForward_1={feedForward:feedForward},Filter$3=types.Filter,makeKernel$8=kernel.makeKernel,release$7=kernel.release;function predict$4(t,e,r){for(var n=0,i=0,a=0;a<this.constants.inputHeight;a++)for(var o=0;o<this.constants.inputWidth;o++)n+=t[a][o]*e[this.thread.x][i],i++;return n+r[this.thread.x]}function predict3D$1(t,e,r){for(var n=0,i=0,a=0;a<this.constants.inputDepth;a++)for(var o=0;o<this.constants.inputHeight;o++)for(var s=0;s<this.constants.inputWidth;s++)n+=t[a][o][s]*e[this.thread.x][i],i++;return n+r[this.thread.x]}function compareInputDeltas$1(t,e,r){for(var n=0,i=this.thread.x+this.thread.y*this.output.x,a=0;a<this.constants.filterCount;a++)n+=r[a][i]*e[0][a];return n+t[this.thread.y][this.thread.x]}function compareInputDeltas3D(t,e,r){for(var n=0,i=this.thread.x+this.thread.y*this.output.x,a=0;a<this.constants.filterCount;a++)n+=r[a][i]*e[0][a];return n+t[this.thread.z][this.thread.y][this.thread.x]}function compareBiases$1(t,e){return t[this.thread.x]+e[this.thread.y][this.thread.x]}function compareFilterDeltas$1(t,e,r){return t[this.thread.y][this.thread.x]+e[this.thread.y][this.thread.x]*r[this.constants.deltaY][this.constants.deltaX]}function compareFilterDeltas3D(t,e,r){var n=Math.floor(this.thread.x/(this.constants.inputWidth*this.constants.inputHeight)),i=Math.floor((this.thread.x-n*this.constants.inputWidth*this.constants.inputHeight)/this.constants.inputWidth),a=this.thread.x-this.constants.inputWidth*(i+this.constants.inputHeight*n);return t[this.thread.y][this.thread.x]+e[n][i][a]*r[0][this.thread.y]}var FullyConnected=function(){_inherits(a,Filter$3);var i=_createSuper(a);function a(t,e){var r;_classCallCheck(this,a),(r=i.call(this,t)).inputLayer=e,r.validate(),r.compareFilterDeltasKernel=null,r.compareInputDeltasKernel=null,r.compareBiasesKernel=null;var n=e.width*e.height*e.depth;return r.biases=values(r.height,r.bias),r.biasDeltas=zeros(r.height),r.filters=randos2d(n,r.height),r.filterDeltas=zeros2d(n,r.height),0<r.depth?(r.weights=randos3d(r.width,r.height),r.deltas=zeros3d(r.width,r.height)):0<r.height&&(r.weights=randos2d(r.width,r.height),r.deltas=zeros2d(r.width,r.height)),r}return _createClass(a,null,[{key:"defaults",get:function(){return{bias:.1}}}]),_createClass(a,[{key:"validate",value:function(){if(_get(_getPrototypeOf(a.prototype),"validate",this).call(this),0<this.depth)throw new Error("depth not supported")}},{key:"setupKernels",value:function(){var t=this.inputLayer,e=t.width*t.height*t.depth;0<t.depth?(this.predictKernel=makeKernel$8(predict3D$1,{output:[this.width,this.height],constants:{inputHeight:t.height,inputWidth:t.width,inputDepth:t.depth}}),this.compareFilterDeltasKernel=makeKernel$8(compareFilterDeltas3D,{output:[e,this.height],constants:{inputWidth:t.width,inputHeight:t.height},immutable:!0}),this.compareInputDeltasKernel=makeKernel$8(compareInputDeltas3D,{output:[t.width,t.height,t.depth],constants:{filterCount:this.height},immutable:!0})):(this.predictKernel=makeKernel$8(predict$4,{output:[this.width,this.height],constants:{inputHeight:t.height,inputWidth:t.width}}),this.compareFilterDeltasKernel=makeKernel$8(compareFilterDeltas$1,{output:[e,this.height],constants:{inputWidth:t.width}}),this.compareInputDeltasKernel=makeKernel$8(compareInputDeltas$1,{output:[t.width,t.height],constants:{filterCount:this.height}})),this.compareBiasesKernel=makeKernel$8(compareBiases$1,{output:[this.width,this.height]})}},{key:"predict",value:function(){this.weights=this.predictKernel(this.inputLayer.weights,this.filters,this.biases)}},{key:"compare",value:function(){var t=this.inputLayer.deltas;this.inputLayer.deltas=this.compareInputDeltasKernel(t,this.deltas,this.filters),release$7(t);var e=this.biasDeltas,r=this.filterDeltas;this.biasDeltas=this.compareBiasesKernel(this.biases,this.deltas),this.filterDeltas=this.compareFilterDeltasKernel(r,this.inputLayer.weights,this.deltas),release$7(e),release$7(r)}}]),a}();function fullyConnected(t,e){return new FullyConnected(t,e)}var fullyConnected_1={FullyConnected:FullyConnected,fullyConnected:fullyConnected,predict:predict$4,predict3D:predict3D$1,compareInputDeltas:compareInputDeltas$1,compareInputDeltas3D:compareInputDeltas3D,compareBiases:compareBiases$1,compareFilterDeltas:compareFilterDeltas$1,compareFilterDeltas3D:compareFilterDeltas3D},makeKernel$9=kernel.makeKernel,Modifier$1=types.Modifier;function predict$5(t){return-t[this.thread.y][this.thread.x]}var Negative=function(){_inherits(i,Modifier$1);var n=_createSuper(i);function i(t,e){var r;return _classCallCheck(this,i),(r=n.call(this,t)).inputLayer=e,r.validate(),r}return _createClass(i,[{key:"setupKernels",value:function(){this.predictKernel=makeKernel$9(predict$5,{output:[this.width,this.height]})}},{key:"predict",value:function(){this.weights=this.predictKernel(this.inputLayer.weights)}}]),i}();function negative(t,e){return new Negative(t,e)}var negative_1={Negative:Negative,negative:negative,predict:predict$5},makeKernel$a=kernel.makeKernel,release$8=kernel.release,clear$6=kernel.clear,Operator$3=types.Operator,checkSameSize$2=layerSize.checkSameSize;function predict$6(t,e){return t[this.thread.y][this.thread.x]*e[this.thread.y][this.thread.x]}function compare$1(t,e){return t[this.thread.y][this.thread.x]*e[this.thread.y][this.thread.x]}var MultiplyElement=function(){_inherits(i,Operator$3);var n=_createSuper(i);function i(t,e){var r;return _classCallCheck(this,i),(r=n.call(this)).inputLayer1=t,r.inputLayer2=e,r.width=t.width,r.height=t.height,r.validate(),r.weights=zeros2d(r.width,r.height),r.deltas=zeros2d(r.width,r.height),r}return _createClass(i,[{key:"validate",value:function(){_get(_getPrototypeOf(i.prototype),"validate",this).call(this),checkSameSize$2(this.inputLayer1,this.inputLayer2)}},{key:"setupKernels",value:function(){this.predictKernel=makeKernel$a(predict$6,{output:[this.width,this.height],immutable:!0}),this.compareKernel=makeKernel$a(compare$1,{output:[this.width,this.height],immutable:!0})}},{key:"predict",value:function(){release$8(this.weights),this.weights=this.predictKernel(this.inputLayer1.weights,this.inputLayer2.weights),clear$6(this.deltas)}},{key:"compare",value:function(){release$8(this.inputLayer1.deltas),release$8(this.inputLayer2.deltas),this.inputLayer1.deltas=this.compareKernel(this.inputLayer2.weights,this.deltas),this.inputLayer2.deltas=this.compareKernel(this.inputLayer1.weights,this.deltas)}}]),i}();function multiplyElement(t,e){return new MultiplyElement(t,e)}var multiplyElement_1={MultiplyElement:MultiplyElement,multiplyElement:multiplyElement,predict:predict$6,compare:compare$1},ones=function(t){return new Float32Array(t).fill(1)},ones2d=function(t,e){for(var r=new Array(e),n=0;n<e;n++)r[n]=ones(t);return r},Model$2=types.Model,Ones=function(){_inherits(n,Model$2);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this,t)).validate(),e.weights=ones2d(e.width,e.height),e.deltas=zeros2d(e.width,e.height),e}return n}();function ones$1(t){return new Ones(t)}var ones_1={Ones:Ones,ones:ones$1},Activation$3=activation$1.Activation,makeKernel$b=kernel.makeKernel,activate$5=tanh.activate,measure$5=tanh.measure,release$9=kernel.release,clear$7=kernel.clear;function predict2D$1(t){return activate$5(t[this.thread.y][this.thread.x])}function predict3D$2(t){return activate$5(t[this.thread.z][this.thread.y][this.thread.x])}function compare2D$1(t,e){return measure$5(t[this.thread.y][this.thread.x],e[this.thread.y][this.thread.x])}function compare3D$1(t,e){return measure$5(t[this.thread.z][this.thread.y][this.thread.x],e[this.thread.z][this.thread.y][this.thread.x])}var Tanh=function(){_inherits(e,Activation$3);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"setupKernels",value:function(){0<this.depth?(this.predictKernel=makeKernel$b(predict3D$2,{output:[this.width,this.height,this.depth],functions:[activate$5],immutable:!0}),this.compareKernel=makeKernel$b(compare3D$1,{output:[this.width,this.height,this.depth],functions:[measure$5],immutable:!0})):(this.predictKernel=makeKernel$b(predict2D$1,{output:[this.width,this.height],functions:[activate$5],immutable:!0}),this.compareKernel=makeKernel$b(compare2D$1,{output:[this.width,this.height],functions:[measure$5],immutable:!0}))}},{key:"predict",value:function(){release$9(this.weights),this.weights=this.predictKernel(this.inputLayer.weights),clear$7(this.deltas)}},{key:"compare",value:function(){release$9(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}}]),e}();function tanh$1(t,e){return new Tanh(t,e)}var tanh_1={Tanh:Tanh,tanh:tanh$1,predict2D:predict2D$1,predict3D:predict3D$2,compare2D:compare2D$1,compare3D:compare3D$1},Model$3=types.Model,Zeros=function(){_inherits(n,Model$3);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this,t)).validate(),e.weights=zeros2d(e.width,e.height),e.deltas=zeros2d(e.width,e.height),e}return _createClass(n,[{key:"predict",value:function(){}},{key:"compare",value:function(){}}]),n}();function zeros$1(t){return new Zeros(t)}var zeros_1={Zeros:Zeros,zeros:zeros$1},add$3=add_1.add,negative$1=negative_1.negative,multiply$3=multiply_1.multiply,multiplyElement$1=multiplyElement_1.multiplyElement,ones$2=ones_1.ones,sigmoid$4=sigmoid_1.sigmoid,random$4=random_1.random,tanh$2=tanh_1.tanh,zeros$2=zeros_1.zeros;function gru(t,e,r){var n=t.height,i=random$4({height:n,width:r.height}),a=random$4({width:n,height:n}),o=zeros$2({height:n}),s=sigmoid$4(add$3(add$3(multiply$3(i,r),multiply$3(a,e)),o)),u=random$4({height:n,width:r.height}),l=random$4({width:n,height:n}),h=zeros$2({height:n}),c=sigmoid$4(add$3(add$3(multiply$3(u,r),multiply$3(l,e)),h)),p=random$4({height:n,width:r.height}),f=random$4({width:n,height:n}),d=zeros$2({height:n}),y=tanh$2(add$3(add$3(multiply$3(p,r),multiply$3(f,multiplyElement$1(c,e))),d));return add$3(multiplyElement$1(add$3(ones$2(s.rows,s.columns),negative$1(s)),y),multiplyElement$1(e,s))}var gru_1={gru:gru},EntryPoint$1=types.EntryPoint,makeKernel$c=kernel.makeKernel,release$a=kernel.release,kernelInput$1=kernel.kernelInput,clear$8=kernel.clear,clone$3=kernel.clone,Input=function(){_inherits(n,EntryPoint$1);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this,t)).validate(),e.weights=null,e.reshapeInput=null,e.deltas=zeros2d(e.width,e.height),e}return _createClass(n,[{key:"setupKernels",value:function(){1===this.width?(this.predict=this.predict1D,this.reshapeInput=makeKernel$c(function(t){return t[this.thread.y]},{output:[1,this.height],immutable:!0})):this.reshapeInput=function(t){return t}}},{key:"reuseKernels",value:function(t){_get(_getPrototypeOf(n.prototype),"reuseKernels",this).call(this,t),this.reshapeInput=t.reshapeInput}},{key:"predict",value:function(t){if("object"!==_typeof(t[0])&&t.length===this.height*this.width)release$a(this.weights),this.weights=kernelInput$1(t,[this.width,this.height]);else{if(t.length!==this.height||t[0].length!==this.width)throw new Error("Inputs are not of sized correctly");this.weights=clone$3(t)}clear$8(this.deltas)}},{key:"predict1D",value:function(t){this.weights&&release$a(this.weights),this.weights=this.reshapeInput(t),clear$8(this.deltas)}},{key:"compare",value:function(){}},{key:"toJSON",value:function(){for(var t={},e=this.constructor,r=e.defaults,n=e.name,i=Object.keys(r),a=0;a<i.length;a++){var o=i[a];"deltas"!==o&&"weights"!==o&&(t[o]=this[o])}return t.type=n,t}}]),n}();function input$1(t){return new Input(t)}var input_1={Input:Input,input:input$1},Activation$4=types.Activation,makeKernel$d=kernel.makeKernel,release$b=kernel.release,clear$9=kernel.clear,activate$6=leakyRelu.activate,measure$6=leakyRelu.measure;function predict2D$2(t){return activate$6(t[this.thread.y][this.thread.x])}function predict3D$3(t){return activate$6(t[this.thread.z][this.thread.y][this.thread.x])}function compare2D$2(t,e){return measure$6(t[this.thread.y][this.thread.x],e[this.thread.y][this.thread.x])}function compare3D$2(t,e){return measure$6(t[this.thread.z][this.thread.y][this.thread.x],e[this.thread.z][this.thread.y][this.thread.x])}var LeakyRelu=function(){_inherits(e,Activation$4);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"setupKernels",value:function(){var t=this.inputLayer,e=t.width,r=t.height,n=t.depth;0<this.depth?(this.predictKernel=makeKernel$d(predict3D$3,{output:[e,r,n],functions:[activate$6],immutable:!0}),this.compareKernel=makeKernel$d(compare3D$2,{output:[e,r,n],functions:[measure$6],immutable:!0})):(this.predictKernel=makeKernel$d(predict2D$2,{output:[e,r],functions:[activate$6],immutable:!0}),this.compareKernel=makeKernel$d(compare2D$2,{output:[e,r],functions:[measure$6],immutable:!0}))}},{key:"predict",value:function(){release$b(this.weights),this.weights=this.predictKernel(this.inputLayer.weights),clear$9(this.deltas)}},{key:"compare",value:function(){var t=this.deltas;this.deltas=this.compareKernel(this.weights,t),release$b(t)}}]),e}();function leakyRelu$1(t,e){return new LeakyRelu(t,e)}var leakyRelu_1={LeakyRelu:LeakyRelu,leakyRelu:leakyRelu$1,predict2D:predict2D$2,predict3D:predict3D$3,compare2D:compare2D$2,compare3D:compare3D$2},add$4=add_1.add,multiply$4=multiply_1.multiply,multiplyElement$2=multiplyElement_1.multiplyElement,random$5=random_1.random,sigmoid$5=sigmoid_1.sigmoid,tanh$3=tanh_1.tanh,zeros$3=zeros_1.zeros;function lstmCell(t,e,r){var n=t.height;r.setDimensions&&r.setDimensions(1,n);var i=random$5({height:n,width:e.height,std:.08}),a=random$5({width:n,height:n,std:.08}),o=zeros$3({height:n}),s=sigmoid$5(add$4(add$4(multiply$4(i,e),multiply$4(a,r)),o)),u=random$5({height:n,width:e.height,std:.08}),l=random$5({width:n,height:n,std:.08}),h=zeros$3({height:n}),c=sigmoid$5(add$4(add$4(multiply$4(u,e),multiply$4(l,r)),h)),p=random$5({height:n,width:e.height,std:.08}),f=random$5({width:n,height:n,std:.08}),d=zeros$3({height:n}),y=sigmoid$5(add$4(add$4(multiply$4(p,e),multiply$4(f,r)),d)),g=random$5({height:n,width:e.height,std:.08}),m=random$5({width:n,height:n,std:.08}),v=zeros$3({height:n}),w=tanh$3(add$4(add$4(multiply$4(g,e),multiply$4(m,r)),v)),b=multiplyElement$2(c,r),k=multiplyElement$2(s,w),$=add$4(b,k);return multiplyElement$2(y,tanh$3($))}var lstmCell_1={lstmCell:lstmCell},makeKernel$e=kernel.makeKernel,release$c=kernel.release,clone$4=kernel.clone,clear$a=kernel.clear,Filter$4=types.Filter;function compare1D(t,e){return t[this.thread.y][this.thread.x]-e[this.thread.x]}function compare2D$3(t,e){return t[this.thread.y][this.thread.x]-e[this.thread.y][this.thread.x]}var Target=function(){_inherits(i,Filter$4);var n=_createSuper(i);function i(t,e){var r;if(_classCallCheck(this,i),(r=n.call(this,t)).inputLayer=e,r.width=e.width,r.height=e.height,r.depth=e.depth,r.validate(),r.depth)throw new Error("Target layer not implemented for depth");return r.height?(r.weights=zeros2d(r.width,r.height),r.deltas=zeros2d(r.width,r.height),r.errors=zeros2d(r.width,r.height)):(r.weights=zeros(r.width),r.deltas=zeros(r.width),r.errors=zeros(r.width)),r}return _createClass(i,[{key:"setupKernels",value:function(){var t=1===this.width?compare1D:compare2D$3;this.compareKernel=makeKernel$e(t,{output:[this.width,this.height],immutable:!0})}},{key:"predict",value:function(){release$c(this.weights),this.weights=clone$4(this.inputLayer.weights),clear$a(this.deltas)}},{key:"compare",value:function(t){release$c(this.deltas),release$c(this.errors),release$c(this.inputLayer.deltas),this.deltas=this.compareKernel(this.weights,t),this.inputLayer.deltas=clone$4(this.deltas),this.errors=clone$4(this.deltas)}},{key:"setupPraxis",value:function(){}}]),i}();function target(t,e){return new Target(t,e)}var target_1={Target:Target,target:target},add$5=add_1.add,multiply$5=multiply_1.multiply,random$6=random_1.random,target$1=target_1.target;function output(t,e){var r=t.height,n=random$6({height:r,width:e.height,name:"outputGate",std:.08}),i=random$6({height:r,name:"output",std:.08}),a=multiply$5(n,e,{name:"outputGateConnected"});return target$1(_objectSpread2({name:"target"},t),add$5(a,i))}var output_1={output:output},Filter$5=types.Filter,makeKernel$f=kernel.makeKernel,release$d=kernel.release,setPadding$2=layerSetup.setPadding,setStride$2=layerSetup.setStride;function setSwitchY(t){return t}function setSwitchX(t){return t}function predict$7(t){for(var e=Math.floor(this.thread.x/this.output.x*this.constants.inputWidth-this.constants.paddingX),r=Math.floor(this.thread.y/this.output.y*this.constants.inputHeight-this.constants.paddingY),n=-1/0,i=0;i<this.constants.filterHeight;i++)for(var a=i+r,o=0;o<this.constants.filterWidth;o++){var s,u=o+e;0<=a&&a<this.constants.inputHeight&&0<=u&&u<this.constants.inputWidth&&(n<(s=t[this.thread.z][a][u])&&(n=s))}return n}function compare$2(t,e,r){for(var n=Math.floor(this.thread.x/this.output.x*this.constants.outputWidth),i=Math.floor(this.thread.y/this.output.y*this.constants.outputHeight),a=0,o=0;o<this.constants.inputHeight;o++)for(var s=0;s<this.constants.inputWidth;s++){var u=r[o][s],l=e[o][s];u===n&&l===i&&(a+=t[o][s])}return a}function compare3D$3(t,e,r){for(var n=Math.floor(this.thread.x/this.output.x*this.constants.outputWidth),i=Math.floor(this.thread.y/this.output.y*this.constants.outputHeight),a=0,o=0;o<this.constants.inputHeight;o++)for(var s=0;s<this.constants.inputWidth;s++){var u=r[this.thread.z][o][s],l=e[this.thread.z][o][s];u===n&&l===i&&(a+=t[this.thread.z][o][s])}return a}var Pool=function(){_inherits(i,Filter$5);var n=_createSuper(i);function i(t,e){var r;return _classCallCheck(this,i),(r=n.call(this,t)).stride=null,r.strideX=null,r.strideY=null,setStride$2(_assertThisInitialized(r),t),r.padding=null,r.paddingX=null,r.paddingY=null,setPadding$2(_assertThisInitialized(r),t),r.filterCount=t.filterCount,r.filterWidth=t.filterWidth,r.filterHeight=t.filterHeight,r.width=Math.floor((e.width+2*r.paddingX-r.filterWidth)/r.strideX+1),r.height=Math.floor((e.height+2*r.paddingY-r.filterHeight)/r.strideY+1),r.depth=r.filterCount,r.weights=randos3d(r.width,r.height,r.depth),r.deltas=zeros3d(r.width,r.height,r.depth),r.filters=randos3d(r.filterWidth,r.filterHeight,r.filterCount),r.filterDeltas=zeros3d(r.filterWidth,r.filterHeight,r.filterCount),r.learnFilters=null,r.learnInputs=null,r.inputLayer=e,r.validate(),r}return _createClass(i,null,[{key:"defaults",get:function(){return{padding:0,bias:0,filterWidth:0,filterHeight:0,filterCount:0}}}]),_createClass(i,[{key:"setupKernels",value:function(){this.predictKernel=makeKernel$f(predict$7,{output:[this.width,this.height,this.depth],map:{switchX:setSwitchX,switchY:setSwitchY},constants:{inputWidth:this.inputLayer.width,inputHeight:this.inputLayer.height,paddingX:this.paddingX,paddingY:this.paddingY,filterHeight:this.filterHeight,filterWidth:this.filterWidth}}),this.compareKernel=makeKernel$f(compare$2,{output:[this.inputLayer.width,this.inputLayer.height,this.inputLayer.depth],constants:{outputWidth:this.width,outputHeight:this.height,outputDepth:this.depth,paddingX:this.paddingX,paddingY:this.paddingY}})}},{key:"predict",value:function(){var t=this.predictKernel(this.inputLayer.weights),e=t.result,r=t.switchX,n=t.switchY;return this.switchX=r,this.switchY=n,this.weights=e,this.weights}},{key:"compare",value:function(){var t=this.inputLayer.deltas;this.inputLayer.deltas=this.compareKernel(this.deltas,this.switchX,this.switchY),release$d(t)}}]),i}();function pool(t,e){return new Pool(t,e)}var pool_1={Pool:Pool,pool:pool,predict:predict$7,compare:compare$2,compare3D:compare3D$3},Activation$5=types.Activation,makeKernel$g=kernel.makeKernel,release$e=kernel.release,clear$b=kernel.clear,activate$7=relu.activate,measure$7=relu.measure;function predict2D$3(t){return activate$7(t[this.thread.y][this.thread.x])}function compare2D$4(t,e){return measure$7(t[this.thread.y][this.thread.x],e[this.thread.y][this.thread.x])}function predict3D$4(t){return activate$7(t[this.thread.z][this.thread.y][this.thread.x])}function compare3D$4(t,e){return measure$7(t[this.thread.z][this.thread.y][this.thread.x],e[this.thread.z][this.thread.y][this.thread.x])}var Relu=function(){_inherits(e,Activation$5);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"setupKernels",value:function(){var t=this.inputLayer,e=t.width,r=t.height,n=t.depth;0<n?(this.predictKernel=makeKernel$g(predict3D$4,{output:[e,r,n],functions:[activate$7],immutable:!0}),this.compareKernel=makeKernel$g(compare3D$4,{output:[e,r,n],functions:[measure$7],immutable:!0})):(this.predictKernel=makeKernel$g(predict2D$3,{output:[e,r],functions:[activate$7],immutable:!0}),this.compareKernel=makeKernel$g(compare2D$4,{output:[e,r],functions:[measure$7],immutable:!0}))}},{key:"predict",value:function(){release$e(this.weights),this.weights=this.predictKernel(this.inputLayer.weights),clear$b(this.deltas)}},{key:"compare",value:function(){release$e(this.inputLayer.deltas),this.inputLayer.deltas=this.compareKernel(this.weights,this.deltas)}}]),e}();function relu$1(t,e){return new Relu(t,e)}var relu_1={Relu:Relu,relu:relu$1,predict2D:predict2D$3,compare2D:compare2D$4,predict3D:predict3D$4,compare3D:compare3D$4},relu$2=relu_1.relu,add$6=add_1.add,multiply$6=multiply_1.multiply,random$7=random_1.random,zeros$4=zeros_1.zeros;function rnnCell(t,e,r){var n=t.height;r.setDimensions&&r.setDimensions(1,n);var i=random$7({name:"weight",height:n,width:e.height,std:.08}),a=random$7({name:"transition",height:n,width:n,std:.08}),o=zeros$4({name:"bias",height:n});return relu$2(add$6(add$6(multiply$6(i,e),multiply$6(a,r)),o))}var rnnCell_1={rnnCell:rnnCell},Base$6=base.Base,Regression=function(){_inherits(n,Base$6);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this,t)).validate(),e}return _createClass(n,[{key:"predict",value:function(){this.weights=this.inputs}},{key:"learn",value:function(){}}]),n}();function learn(t,e){return t[this.thread.x]-e[this.thread.x]}function regression(t,e){return new Regression(t,e)}var regression_1={Regression:Regression,regression:regression,learn:learn},makeKernel$h=kernel.makeKernel,release$f=kernel.release,clone$5=kernel.clone,Filter$6=types.Filter;function getMaxValue(t){for(var e=-1/0,r=0;r<this.constants.inputWidth;r++){var n=t[r];e<n&&(e=n)}return e}function getMaxValue2D(t){for(var e=-1/0,r=0;r<this.constants.inputHeight;r++)for(var n=0;n<this.constants.inputWidth;n++){var i=t[r][n];e<i&&(e=i)}return e}function getMaxValue3D(t){for(var e=-1/0,r=0;r<this.constants.inputDepth;r++)for(var n=0;n<this.constants.inputHeight;n++)for(var i=0;i<this.constants.inputWidth;i++){var a=t[r][n][i];e<a&&(e=a)}return e}function getSum(t){for(var e=0,r=0;r<this.constants.inputWidth;r++)e+=t[r];return e}function getSum2D(t){for(var e=0,r=0;r<this.constants.inputHeight;r++)for(var n=0;n<this.constants.inputWidth;n++)e+=t[r][n];return e}function getSum3D(t){for(var e=0,r=0;r<this.constants.inputDepth;r++)for(var n=0;n<this.constants.inputHeight;n++)for(var i=0;i<this.constants.inputWidth;i++)e+=t[r][n][i];return e}function getExponentials(t,e){return Math.exp(t[this.thread.x]-e[0])}function getExponentials2D(t,e){return Math.exp(t[this.thread.y][this.thread.x]-e[0])}function getExponentials3D(t,e){return Math.exp(t[this.thread.z][this.thread.y][this.thread.x]-e[0])}function predict$8(t,e){return t[this.thread.x]/e[0]}function predict2D$4(t,e){return t[this.thread.y][this.thread.x]/e[0]}function predict3D$5(t,e){return t[this.thread.z][this.thread.y][this.thread.x]/e[0]}function compare$3(t,e){var r=0;return this.thread.x===t&&(r=1),-(r-e[this.thread.x])}function compare2D$5(t,e){var r=0;return this.thread.x+this.thread.y*this.output.x===t&&(r=1),-(r-e[this.thread.y][this.thread.x])}function compare3D$5(t,e){var r=0;return this.thread.x+this.thread.y*this.output.x+this.thread.z*this.output.x*this.output.y===t&&(r=1),-(r-e[this.thread.z][this.thread.y][this.thread.x])}function loss(){return-Math.log()}var SoftMax=function(){_inherits(n,Filter$6);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this)).width=t.width,e.height=t.height,e.depth=t.depth,e.getExponentialsKernel=null,e.getMaxValueKernel=null,e.getSumKernel=null,e.inputLayer=t,e.validate(),0<e.depth?(e.weights=randos3d(e.width,e.height,e.depth),e.deltas=zeros3d(e.width,e.height,e.depth)):0<e.height?(e.weights=randos2d(e.width,e.height),e.deltas=zeros2d(e.width,e.height)):(e.weights=randos(e.width),e.deltas=zeros(e.width)),e}return _createClass(n,[{key:"setupKernels",value:function(){var t=this.width,e=this.height,r=this.depth;0<r?(this.getExponentialsKernel=makeKernel$h(getExponentials3D,{output:[t,e,r]}),this.getMaxValueKernel=makeKernel$h(getMaxValue3D,{output:[1,1,1],constants:{inputWidth:t,inputHeight:e,inputDepth:r}}),this.getSumKernel=makeKernel$h(getSum3D,{output:[1,1,1],constants:{inputWidth:t,inputHeight:e,inputDepth:r}}),this.predictKernel=makeKernel$h(predict3D$5,{output:[t,e,r]}),this.compareKernel=makeKernel$h(compare3D$5,{output:[t,e,r],immutable:!0})):(this.getExponentialsKernel=makeKernel$h(getExponentials,{output:[t,e]}),this.getMaxValueKernel=makeKernel$h(getMaxValue2D,{output:[1,1],constants:{inputWidth:t,inputHeight:e}}),this.getSumKernel=makeKernel$h(getSum2D,{output:[1,1],constants:{inputWidth:t,inputHeight:e}}),this.predictKernel=makeKernel$h(predict2D$4,{output:[t,e]}),this.compareKernel=makeKernel$h(compare2D$5,{output:[t,e],immutable:!0}))}},{key:"predict",value:function(){var t=this.getMaxValueKernel(this.inputLayer.weights),e=this.getExponentialsKernel(this.inputLayer.weights,t),r=this.getSumKernel(e);this.weights=this.predictKernel(e,r)}},{key:"compare",value:function(t){var e=this.deltas,r=this.errors;this.errors=this.compareKernel(t[0],e),this.deltas=clone$5(this.errors),release$f(e),release$f(r);var n=this.inputLayer.deltas;this.inputLayer.deltas=clone$5(this.deltas),release$f(n)}}]),n}();function softMax(t,e){return new SoftMax(t,e)}var softMax_1={SoftMax:SoftMax,softMax:softMax,getMaxValue:getMaxValue,getMaxValue2D:getMaxValue2D,getMaxValue3D:getMaxValue3D,getSum:getSum,getSum2D:getSum2D,getSum3D:getSum3D,getExponentials:getExponentials,getExponentials2D:getExponentials2D,getExponentials3D:getExponentials3D,predict:predict$8,predict2D:predict2D$4,predict3D:predict3D$5,compare:compare$3,compare2D:compare2D$5,compare3D:compare3D$5,loss:loss},Base$7=base.Base,SVM=function(){_inherits(e,Base$7);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"predict",value:function(){this.weights=this.inputs,this.validate()}},{key:"learn",value:function(){}}]),e}();function svm(t,e){return new SVM(t,e)}var svm_1={SVM:SVM,svm:svm},Modifier$2=types.Modifier,makeKernel$i=kernel.makeKernel,clear$c=kernel.clear;function predict$9(t){return t[this.thread.x][this.thread.y]}var compare$4=predict$9,Transpose=function(){_inherits(n,Modifier$2);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this)).inputLayer=t,e.width=e.inputLayer.height,e.height=e.inputLayer.width,e.validate(),e}return _createClass(n,[{key:"setupKernels",value:function(){this.predictKernel=makeKernel$i(predict$9,{output:[this.height,this.width]}),this.compareKernel=makeKernel$i(compare$4,{output:[this.width,this.height]})}},{key:"predict",value:function(){this.weights=this.predictKernel(this.inputLayer.weights),clear$c(this.deltas)}},{key:"compare",value:function(){this.inputLayer.deltas=this.predictKernel(this.deltas)}}]),n}();function transpose(t){return new Transpose(t)}var transpose_1={Transpose:Transpose,transpose:transpose},Add$1=add_1.Add,add$7=add_1.add,arthurFeedForward$1=arthurFeedForward_1.arthurFeedForward,Base$8=base.Base,Convolution$1=convolution_1.Convolution,convolution$1=convolution_1.convolution,Dropout$1=dropout_1.Dropout,dropout$1=dropout_1.dropout,feedForward$1=feedForward_1.feedForward,FullyConnected$1=fullyConnected_1.FullyConnected,fullyConnected$1=fullyConnected_1.fullyConnected,gru$1=gru_1.gru,Input$1=input_1.Input,input$2=input_1.input,LeakyRelu$1=leakyRelu_1.LeakyRelu,leakyRelu$2=leakyRelu_1.leakyRelu,lstmCell$1=lstmCell_1.lstmCell,Multiply$1=multiply_1.Multiply,multiply$7=multiply_1.multiply,MultiplyElement$1=multiplyElement_1.MultiplyElement,multiplyElement$3=multiplyElement_1.multiplyElement,Negative$1=negative_1.Negative,negative$2=negative_1.negative,Ones$1=ones_1.Ones,ones$3=ones_1.ones,output$1=output_1.output,Pool$1=pool_1.Pool,pool$1=pool_1.pool,Random$1=random_1.Random,random$8=random_1.random,rnnCell$1=rnnCell_1.rnnCell,Regression$1=regression_1.Regression,regression$1=regression_1.regression,Relu$1=relu_1.Relu,relu$3=relu_1.relu,Sigmoid$1=sigmoid_1.Sigmoid,sigmoid$6=sigmoid_1.sigmoid,SoftMax$1=softMax_1.SoftMax,softMax$1=softMax_1.softMax,SVM$1=svm_1.SVM,svm$1=svm_1.svm,Tanh$1=tanh_1.Tanh,tanh$4=tanh_1.tanh,Target$1=target_1.Target,target$2=target_1.target,Transpose$1=transpose_1.Transpose,transpose$1=transpose_1.transpose,Zeros$1=zeros_1.Zeros,zeros$5=zeros_1.zeros,layer={Add:Add$1,add:add$7,arthurFeedForward:arthurFeedForward$1,Base:Base$8,Convolution:Convolution$1,convolution:convolution$1,Dropout:Dropout$1,dropout:dropout$1,feedForward:feedForward$1,FullyConnected:FullyConnected$1,fullyConnected:fullyConnected$1,gru:gru$1,Input:Input$1,input:input$2,LeakyRelu:LeakyRelu$1,leakyRelu:leakyRelu$2,lstmCell:lstmCell$1,Multiply:Multiply$1,multiply:multiply$7,MultiplyElement:MultiplyElement$1,multiplyElement:multiplyElement$3,Negative:Negative$1,negative:negative$2,Ones:Ones$1,ones:ones$3,output:output$1,Pool:Pool$1,pool:pool$1,Random:Random$1,random:random$8,Regression:Regression$1,regression:regression$1,Relu:Relu$1,relu:relu$3,rnnCell:rnnCell$1,Sigmoid:Sigmoid$1,sigmoid:sigmoid$6,SoftMax:SoftMax$1,softMax:softMax$1,SVM:SVM$1,svm:svm$1,Tanh:Tanh$1,tanh:tanh$4,Target:Target$1,target:target$2,Transpose:Transpose$1,transpose:transpose$1,Zeros:Zeros$1,zeros:zeros$5,types:types},likely=function(t,e){if(!e)throw new TypeError("Required parameter 'net' is of type ".concat(_typeof(e),". Must be of type 'brain.NeuralNetwork'"));var r=e.run(t),n=null,i=-1;return Object.keys(r).forEach(function(t){var e=r[t];i<e&&(n=t,i=e)}),n},ARRAY_BUFFER$1="ArrayBuffer",ArrayBuffer$3=arrayBuffer[ARRAY_BUFFER$1],NativeArrayBuffer$1=global_1[ARRAY_BUFFER$1];_export({global:!0,forced:NativeArrayBuffer$1!==ArrayBuffer$3},{ArrayBuffer:ArrayBuffer$3}),setSpecies(ARRAY_BUFFER$1);var exportTypedArrayStaticMethod$1=arrayBufferViewCore.exportTypedArrayStaticMethod;exportTypedArrayStaticMethod$1("from",typedArrayFrom,typedArrayConstructorsRequireWrappers);var Lookup=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"toTable",value:function(t){var e=t.reduce(function(t,e){return Object.assign(t,e)},{});return r.toHash(e)}},{key:"toTable2D",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i=t[n],a=0;a<i.length;a++){var o=i[a];for(var s in o)o.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(e[s]=r++)}return e}},{key:"toInputTable",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i in t[n].input)e.hasOwnProperty(i)||(e[i]=r++);return e}},{key:"toInputTable2D",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i=t[n].input,a=0;a<i.length;a++){var o=i[a];for(var s in o)e.hasOwnProperty(s)||(e[s]=r++)}return e}},{key:"toOutputTable",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i in t[n].output)e.hasOwnProperty(i)||(e[i]=r++);return e}},{key:"toOutputTable2D",value:function(t){for(var e={},r=0,n=0;n<t.length;n++)for(var i=t[n].output,a=0;a<i.length;a++){var o=i[a];for(var s in o)e.hasOwnProperty(s)||(e[s]=r++)}return e}},{key:"toHash",value:function(t){var e={},r=0;for(var n in t)e[n]=r++;return e}},{key:"toArray",value:function(t,e,r){var n=new Float32Array(r);for(var i in t)n[t[i]]=e.hasOwnProperty(i)?e[i]:0;return n}},{key:"toArrayShort",value:function(t,e){var r=[];for(var n in t){if(!e.hasOwnProperty(n))break;r[t[n]]=e[n]}return Float32Array.from(r)}},{key:"toArrays",value:function(t,e,r){for(var n=[],i=0;i<e.length;i++)n.push(this.toArray(t,e[i],r));return n}},{key:"toObject",value:function(t,e){var r={};for(var n in t)r[n]=e[t[n]];return r}},{key:"toObjectPartial",value:function(t,e,r,n){var i=2<arguments.length&&void 0!==r?r:0,a=3<arguments.length&&void 0!==n?n:0,o={},s=0;for(var u in t)0<i&&s++<i||0<a&&s++>=a||(o[u]=e[t[u]-i]);return o}},{key:"lookupFromArray",value:function(t){for(var e={},r=0,n=t.length;0<n--;)e[t[n]]=r++;return e}},{key:"dataShape",value:function(t){var e,r=[];for(t.input?(r.push("datum"),t=t.input):Array.isArray(t)&&(t=t[0].input?(r.push("array","datum"),t[0].input):(r.push("array"),t[0]));t;){for(e in t)break;if(!t.hasOwnProperty(e))break;if(Array.isArray(t)||t.buffer instanceof ArrayBuffer)r.push("array"),t=t[e];else{if("object"!==_typeof(t))throw new Error("unhandled signature");r.push("object"),t=t[e]}}return r.push(_typeof(t)),r}},{key:"addKeys",value:function(t,e){if(!Array.isArray(t)){e=e||{};var r=Object.keys(e).length;for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=r++));return e}}}]),r}(),lookup=Lookup,Adam=function t(){_classCallCheck(this,t)};function adam(){}var adam_1={Adam:Adam,adam:adam},makeKernel$j=kernel.makeKernel,release$g=kernel.release,Base$9=base$1.Base;function getMomentum(t,e,r){return r*e+(1-e)*t*t}function clipByValue(t,e,r){return e<t?e:t<r?r:t}function update$2(t,e,r){var n=e[this.thread.y][this.thread.x],i=clipByValue(n,this.constants.clipValue,-this.constants.clipValue),a=t[this.thread.y][this.thread.x],o=r[this.thread.y][this.thread.x],s=getMomentum(n,this.constants.decayRate,o);return a+-this.constants.learningRate*i/Math.sqrt(s+this.constants.smoothEps)-this.constants.regularizationStrength*a}function isClippedByValue(t,e,r){return e<t||t<r?1:0}var MomentumRootMeanSquaredPropagation=function(){_inherits(i,Base$9);var n=_createSuper(i);function i(t){var e,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,i),(e=n.call(this,t,r)).momenta=zeros2d(t.width,t.height),e}return _createClass(i,null,[{key:"defaults",get:function(){return{decayRate:.999,regularizationStrength:1e-4,learningRate:.01,smoothEps:1e-8,clipValue:5}}}]),_createClass(i,[{key:"run",value:function(t){var e=this.kernel(t.weights,t.deltas,this.momenta),r=e.momenta,n=e.result;return release$g(this.momenta),this.momenta=r,n}},{key:"setupKernels",value:function(){this.kernel=makeKernel$j(update$2,{output:[this.width,this.height],constants:{clipValue:this.clipValue,decayRate:this.decayRate,learningRate:this.learningRate,regularizationStrength:this.regularizationStrength,smoothEps:this.smoothEps},functions:[clipByValue],map:{momenta:getMomentum},immutable:!0})}}]),i}();function momentumRootMeanSquaredPropagation(t,e){return new MomentumRootMeanSquaredPropagation(t,e)}var MRmsProp=MomentumRootMeanSquaredPropagation,mRmsProp=momentumRootMeanSquaredPropagation,momentumRootMeanSquaredPropagation_1={MomentumRootMeanSquaredPropagation:MomentumRootMeanSquaredPropagation,momentumRootMeanSquaredPropagation:momentumRootMeanSquaredPropagation,MRmsProp:MomentumRootMeanSquaredPropagation,mRmsProp:momentumRootMeanSquaredPropagation,getMomentum:getMomentum,clipByValue:clipByValue,isClippedByValue:isClippedByValue},Adam$1=adam_1.Adam,adam$1=adam_1.adam,ArthurDeviationBiases$1=arthurDeviationBiases_1.ArthurDeviationBiases,arthurDeviationBiases$2=arthurDeviationBiases_1.arthurDeviationBiases,ArthurDeviationWeights$1=arthurDeviationWeights_1.ArthurDeviationWeights,arthurDeviationWeights$2=arthurDeviationWeights_1.arthurDeviationWeights,MomentumRootMeanSquaredPropagation$1=momentumRootMeanSquaredPropagation_1.MomentumRootMeanSquaredPropagation,momentumRootMeanSquaredPropagation$1=momentumRootMeanSquaredPropagation_1.momentumRootMeanSquaredPropagation,MRmsProp$1=momentumRootMeanSquaredPropagation_1.MRmsProp,mRmsProp$1=momentumRootMeanSquaredPropagation_1.mRmsProp,praxis={Adam:Adam$1,adam:adam$1,ArthurDeviationBiases:ArthurDeviationBiases$1,arthurDeviationBiases:arthurDeviationBiases$2,ArthurDeviationWeights:ArthurDeviationWeights$1,arthurDeviationWeights:arthurDeviationWeights$2,MomentumRootMeanSquaredPropagation:MomentumRootMeanSquaredPropagation$1,momentumRootMeanSquaredPropagation:momentumRootMeanSquaredPropagation$1,MRmsProp:MRmsProp$1,mRmsProp:mRmsProp$1},$filter$1=arrayIteration.filter,HAS_SPECIES_SUPPORT$3=arrayMethodHasSpeciesSupport("filter"),USES_TO_LENGTH$6=arrayMethodUsesToLength("filter");_export({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$3||!USES_TO_LENGTH$6},{filter:function(t,e){return $filter$1(this,t,1<arguments.length?e:void 0)}});var $indexOf$1=arrayIncludes.indexOf,nativeIndexOf=[].indexOf,NEGATIVE_ZERO$1=!!nativeIndexOf&&1/[1].indexOf(1,-0)<0,STRICT_METHOD$3=arrayMethodIsStrict("indexOf"),USES_TO_LENGTH$7=arrayMethodUsesToLength("indexOf",{ACCESSORS:!0,1:0});_export({target:"Array",proto:!0,forced:NEGATIVE_ZERO$1||!STRICT_METHOD$3||!USES_TO_LENGTH$7},{indexOf:function(t,e){return NEGATIVE_ZERO$1?nativeIndexOf.apply(this,arguments)||0:$indexOf$1(this,t,1<arguments.length?e:void 0)}});var slice=[].slice,factories={},construct=function(t,e,r){if(!(e in factories)){for(var n=[],i=0;i<e;i++)n[i]="a["+i+"]";factories[e]=Function("C,a","return new C("+n.join(",")+")")}return factories[e](t,r)},functionBind=Function.bind||function(e){var r=aFunction$1(this),n=slice.call(arguments,1),i=function(){var t=n.concat(slice.call(arguments));return this instanceof i?construct(r,t.length,t):r.apply(e,t)};return isObject(r.prototype)&&(i.prototype=r.prototype),i},nativeConstruct=getBuiltIn("Reflect","construct"),NEW_TARGET_BUG=fails(function(){function t(){}return!(nativeConstruct(function(){},[],t)instanceof t)}),ARGS_BUG=!fails(function(){nativeConstruct(function(){})}),FORCED$5=NEW_TARGET_BUG||ARGS_BUG;_export({target:"Reflect",stat:!0,forced:FORCED$5,sham:FORCED$5},{construct:function(t,e,r){aFunction$1(t),anObject(e);var n=arguments.length<3?t:aFunction$1(r);if(ARGS_BUG&&!NEW_TARGET_BUG)return nativeConstruct(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var i=[null];return i.push.apply(i,e),new(functionBind.apply(t,i))}var a=n.prototype,o=objectCreate(isObject(a)?a:Object.prototype),s=Function.apply.call(t,o,e);return isObject(s)?s:o}});var layerFromJson=function(e){if(!layer.hasOwnProperty(e.type))return null;var t=layer[e.type],r=Reflect.construct(t,arguments);return Object.keys(e).forEach(function(t){"type"!==t&&(r[t]=e[t])}),r},traverseLayersFrom=function t(e,r){e.hasOwnProperty("inputLayer")?t(e.inputLayer,r):(e.hasOwnProperty("inputLayer1")&&t(e.inputLayer1,r),e.hasOwnProperty("inputLayer2")&&t(e.inputLayer2,r)),r(e)},flattenLayers=function(t){for(var n=t.slice(0),e=function(e){var r=0;traverseLayersFrom(n[e],function(t){-1===n.indexOf(t)&&(n.splice(e+r,0,t),r++)})},r=0;r<n.length;r++)e(r);return n},makeKernel$k=kernel.makeKernel;function mse2d(t){for(var e=0,r=0;r<this.constants.height;r++)for(var n=0;n<this.constants.width;n++)e+=Math.pow(t[r][n],2);return e/this.constants.length}var MeanSquaredError=function t(e){var r=e.width,n=e.height;_classCallCheck(this,t),this.calculate=makeKernel$k(mse2d,{output:[1],constants:{width:r,height:n,length:r*n},immutable:!0}),this.addAbsolute=makeKernel$k(function(t,e){return t[0]+Math.abs(e[0][0])},{output:[1],immutable:!0}),this.add=makeKernel$k(function(t,e){return t[0]+e[0]},{output:[1],immutable:!0}),this.divide=makeKernel$k(function(t,e){var r=e[0];return 0<r?r/t:0},{output:[1],immutable:!0})},meanSquaredError={MeanSquaredError:MeanSquaredError},makeKernel$l=kernel.makeKernel,release$h=kernel.release,MeanSquaredError$1=meanSquaredError.MeanSquaredError,Model$4=types.Model,FeedForward=function(){function c(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,c),this.layers=null,this.inputLayer=null,this.hiddenLayers=null,this.outputLayer=null,this.praxisOpts=null,this.praxis=null,Object.assign(this,this.constructor.defaults,t),this.trainOpts={},this._updateTrainingOptions(_objectSpread2(_objectSpread2({},this.constructor.trainDefaults),t)),Object.assign(this,this.constructor.structure),this._inputLayer=null,this._hiddenLayers=null,this._outputLayer=null}return _createClass(c,[{key:"_setLogMethod",value:function(t){this.trainOpts.log="function"==typeof t?t:!!t&&console.log}},{key:"_updateTrainingOptions",value:function(e){var r=this;Object.keys(this.constructor.trainDefaults).forEach(function(t){r.trainOpts[t]=e.hasOwnProperty(t)?e[t]:r.trainOpts[t]}),this.constructor._validateTrainingOptions(this.trainOpts),this._setLogMethod(e.log||this.trainOpts.log),this.trainOpts.callback&&this.trainOpts.callbackPeriod!==this.trainOpts.errorCheckInterval&&console.warn("options.callbackPeriod with value of ".concat(this.trainOpts.callbackPeriod," does not match options.errorCheckInterval with value of ").concat(this.trainOpts.errorCheckInterval,", if logging error, it will repeat.  These values may need to match"))}}],[{key:"_validateTrainingOptions",value:function(e){var r={iterations:function(t){return"number"==typeof t&&0<t},errorThresh:function(t){return"number"==typeof t&&0<t&&t<1},log:function(t){return"function"==typeof t||"boolean"==typeof t},logPeriod:function(t){return"number"==typeof t&&0<t},learningRate:function(t){return"number"==typeof t&&0<t&&t<1},callback:function(t){return"function"==typeof t||null===t},callbackPeriod:function(t){return"number"==typeof t&&0<t},timeout:function(t){return"number"==typeof t&&0<t}};Object.keys(c.trainDefaults).forEach(function(t){if(r.hasOwnProperty(t)&&!r[t](e[t]))throw new Error("[".concat(t,", ").concat(e[t],"] is out of normal training range, your network will probably not train."))})}},{key:"trainDefaults",get:function(){return{iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.3,callback:null,callbackPeriod:10,errorCheckInterval:100,reinforce:!1}}},{key:"defaults",get:function(){return{learningRate:.3,binaryThresh:.5,hiddenLayers:null,inputLayer:null,outputLayer:null,praxisOpts:null,praxis:function(t,e){return praxis.momentumRootMeanSquaredPropagation(_objectSpread2({},t),t.praxisOpts||e)}}}},{key:"structure",get:function(){return{layers:null,_inputLayer:null,_outputLayer:null,_model:null}}}]),_createClass(c,[{key:"_connectLayers",value:function(){var t=[];this._inputLayer=this.inputLayer();var e=this._connectHiddenLayers(this._inputLayer);this._outputLayer=this.outputLayer(e[e.length-1],e.length),t.push(this._inputLayer),t.push.apply(t,_toConsumableArray(e)),t.push(this._outputLayer),this.layers=flattenLayers(t)}},{key:"_connectHiddenLayers",value:function(t){this._hiddenLayers=[];for(var e=[],r=0;r<this.hiddenLayers.length;r++){var n=this.hiddenLayers[r](t,r);e.push(n),this._hiddenLayers.push(n),t=n}return e}},{key:"initialize",value:function(){this._connectLayers(),this.initializeLayers(this.layers),this._model=this.layers.filter(function(t){return t instanceof Model$4})}},{key:"initializeLayers",value:function(t){for(var e=0;e<t.length;e++){var r=t[e];r.setupKernels(!0),r instanceof Model$4&&r.hasOwnProperty("praxis")&&null===r.praxis&&(r.praxis=this.praxis(r,r.praxisOpts||this.praxisOpts),r.praxis.setupKernels())}var n=t[t.length-1];this.meanSquaredError=new MeanSquaredError$1({width:n.width,height:n.height})}},{key:"run",value:function(t){this.inputLookup&&(t=lookup.toArray(this.inputLookup,t));var e=this.runInput(t);return e.toArray&&(e=e.toArray()),this.outputLookup&&(e=lookup.toHash(this.outputLookup,e)),e}},{key:"runInput",value:function(t){this.layers[0].predict(t);for(var e=1;e<this.layers.length;e++)this.layers[e].predict();return this.layers[this.layers.length-1].weights}},{key:"train",value:function(t,e){var r,n,i=1<arguments.length&&void 0!==e?e:{},a=this._prepTraining(t,i);for(t=a.data,r=a.status,n=a.endTime;this._trainingTick(t,r,n););return r}},{key:"_trainingTick",value:function(t,e,r){return!(e.iterations>=this.trainOpts.iterations||e.error<=this.trainOpts.errorThresh||Date.now()>=r)&&(this.trainOpts.log&&e.iterations%this.trainOpts.logPeriod==0?(e.error=this._calculateTrainingError(t),this.trainOpts.log("iterations: ".concat(e.iterations,", training error: ").concat(e.error))):e.iterations%this.trainOpts.errorCheckInterval==0?e.error=this._calculateTrainingError(t):this._trainPatterns(t),this.trainOpts.callback&&e.iterations%this.trainOpts.callbackPeriod==0&&this.trainOpts.callback(Object.assign(e)),e.iterations++,!0)}},{key:"_prepTraining",value:function(t,e){this._updateTrainingOptions(e);var r=this.formatData(t),n=Date.now()+this.trainOpts.timeout;return this.verifyIsInitialized(),{data:this.transferData(r),status:{error:1,iterations:0},endTime:n}}},{key:"verifyIsInitialized",value:function(){this._model||this.initialize()}},{key:"_calculateTrainingError",value:function(t){for(var e=new Float32Array([0]),r=0;r<t.length;++r){var n=e,i=this._trainPattern(t[r].input,t[r].output,!0),e=this.meanSquaredError.add(e,i);release$h(i),release$h(n)}var a=this.meanSquaredError.divide(t.length,e);if(release$h(e),a.toArray){var o=a.toArray();return release$h(a),o[0]}return a[0]}},{key:"_trainPatterns",value:function(t){for(var e=0;e<t.length;++e)this._trainPattern(t[e].input,t[e].output,!1)}},{key:"_trainPattern",value:function(t,e,r){return this.runInput(t),this._calculateDeltas(e),this.adjustWeights(),r?this.meanSquaredError.calculate(this._outputLayer.errors):null}},{key:"_calculateDeltas",value:function(t){for(var e=this.layers.length-1;-1<e;e--)this.layers[e].compare(t)}},{key:"adjustWeights",value:function(){for(var t=this._model,e=0;e<t.length;e++)t[e].learn(null,null,this.trainOpts.learningRate)}},{key:"formatData",value:function(t){var e,r=this;Array.isArray(t)||((e=[]).push(t),t=e);var n=t[0].input;Array.isArray(n)||n instanceof Float32Array||(this.inputLookup||(this.inputLookup=lookup.buildLookup(t.map(function(t){return t.input}))),t=t.map(function(t){var e=lookup.toArray(r.inputLookup,t.input);return _objectSpread2(_objectSpread2({},t),{},{input:e})},this));var i=t[0].output;return Array.isArray(i)||i instanceof Float32Array||(this.outputLookup||(this.outputLookup=lookup.buildLookup(t.map(function(t){return t.output}))),t=t.map(function(t){var e=lookup.toArray(r.outputLookup,t.output);return _objectSpread2(_objectSpread2({},t),{},{output:e})},this)),t}},{key:"transferData",value:function(t){for(var e=new Array(t.length),r=makeKernel$l(function(t){return t[this.thread.x]},{output:[t[0].input.length],immutable:!0}),n=makeKernel$l(function(t){return t[this.thread.x]},{output:[t[0].output.length],immutable:!0}),i=0;i<t.length;i++){var a=t[i];e[i]={input:r(a.input),output:n(a.output)}}return e}},{key:"test",value:function(){throw new Error("".concat(this.constructor.name,"-test is not yet implemented"))}},{key:"toJSON",value:function(){this.layers||this.initialize();for(var t=[],e=0;e<this.layers.length;e++){var r=this.layers[e],n=r.toJSON();r.hasOwnProperty("inputLayer")?n.inputLayerIndex=this.layers.indexOf(r.inputLayer):r.hasOwnProperty("inputLayer1")&&r.hasOwnProperty("inputLayer2")&&(n.inputLayer1Index=this.layers.indexOf(r.inputLayer1),n.inputLayer2Index=this.layers.indexOf(r.inputLayer2)),t.push(n)}return{type:this.constructor.name,sizes:[this._inputLayer.height].concat(this._hiddenLayers.map(function(t){return t.height})).concat([this._outputLayer.height]),layers:t}}},{key:"toFunction",value:function(){throw new Error("".concat(this.constructor.name,"-toFunction is not yet implemented"))}},{key:"createTrainStream",value:function(){throw new Error("".concat(this.constructor.name,"-createTrainStream is not yet implemented"))}}],[{key:"fromJSON",value:function(t,e){var r=t.layers,n=[],i=layerFromJson(r[0])||e(r[0]);n.push(i);for(var a=1;a<r.length;a++){var o=r[a];if(o.hasOwnProperty("inputLayerIndex")){var s=n[o.inputLayerIndex];n.push(layerFromJson(o,s)||e(o,s))}else{if(!o.hasOwnProperty("inputLayer1Index"))throw new Error("Cannot create network from provided JOSN. inputLayer1Index not defined.");if(!o.hasOwnProperty("inputLayer2Index"))throw new Error("Cannot create network from provided JOSN. inputLayer2Index not defined.");var u=n[o.inputLayer1Index],l=n[o.inputLayer2Index];if(void 0===u)throw new Error("Cannot create network from provided JOSN. layer of index ".concat(o.inputLayer1Index," not found."));if(void 0===l)throw new Error("Cannot create network from provided JOSN. layer of index ".concat(o.inputLayer2Index," not found."));n.push(layerFromJson(o,i)||e(o,u,l))}}var h=new c(t);return h.layers=n,h}}]),c}(),feedForward$2={FeedForward:FeedForward},nativeJoin=[].join,ES3_STRINGS=indexedObject!=Object,STRICT_METHOD$4=arrayMethodIsStrict("join",",");_export({target:"Array",proto:!0,forced:ES3_STRINGS||!STRICT_METHOD$4},{join:function(t){return nativeJoin.call(toIndexedObject(this),void 0===t?",":t)}});var defer,channel,port,nativePromiseConstructor=global_1.Promise,callWithSafeIterationClosing=function(e,t,r,n){try{return n?t(anObject(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&anObject(i.call(e)),t}},iterate_1=createCommonjsModule(function(t){function f(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,r,n,i){var a,o,s,u,l,h,c,p=functionBindContext(e,r,n?2:1);if(i)a=t;else{if("function"!=typeof(o=getIteratorMethod(t)))throw TypeError("Target is not iterable");if(isArrayIteratorMethod(o)){for(s=0,u=toLength(t.length);s<u;s++)if((l=n?p(anObject(c=t[s])[0],c[1]):p(t[s]))&&l instanceof f)return l;return new f(!1)}a=o.call(t)}for(h=a.next;!(c=h.call(a)).done;)if("object"==typeof(l=callWithSafeIterationClosing(a,p,c.value,n))&&l&&l instanceof f)return l;return new f(!1)}).stop=function(t){return new f(!0,t)}}),engineIsIos=/(iphone|ipod|ipad).*applewebkit/i.test(engineUserAgent),location=global_1.location,set$2=global_1.setImmediate,clear$d=global_1.clearImmediate,process$1=global_1.process,MessageChannel=global_1.MessageChannel,Dispatch=global_1.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",run=function(t){var e;queue.hasOwnProperty(t)&&(e=queue[t],delete queue[t],e())},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){global_1.postMessage(t+"",location.protocol+"//"+location.host)};set$2&&clear$d||(set$2=function(t){for(var e=[],r=1;r<arguments.length;)e.push(arguments[r++]);return queue[++counter]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},defer(counter),counter},clear$d=function(t){delete queue[t]},"process"==classofRaw(process$1)?defer=function(t){process$1.nextTick(runner(t))}:Dispatch&&Dispatch.now?defer=function(t){Dispatch.now(runner(t))}:MessageChannel&&!engineIsIos?(port=(channel=new MessageChannel).port2,channel.port1.onmessage=listener,defer=functionBindContext(port.postMessage,port,1)):!global_1.addEventListener||"function"!=typeof postMessage||global_1.importScripts||fails(post)||"file:"===location.protocol?defer=ONREADYSTATECHANGE in documentCreateElement("script")?function(t){html.appendChild(documentCreateElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)}:(defer=post,global_1.addEventListener("message",listener,!1)));var flush,head,last,notify,toggle,node,promise,then,task={set:set$2,clear:clear$d},getOwnPropertyDescriptor$3=objectGetOwnPropertyDescriptor.f,macrotask=task.set,MutationObserver=global_1.MutationObserver||global_1.WebKitMutationObserver,process$2=global_1.process,Promise$1=global_1.Promise,IS_NODE="process"==classofRaw(process$2),queueMicrotaskDescriptor=getOwnPropertyDescriptor$3(global_1,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value;queueMicrotask||(flush=function(){var t,e;for(IS_NODE&&(t=process$2.domain)&&t.exit();head;){e=head.fn,head=head.next;try{e()}catch(t){throw head?notify():last=void 0,t}}last=void 0,t&&t.enter()},notify=IS_NODE?function(){process$2.nextTick(flush)}:MutationObserver&&!engineIsIos?(toggle=!0,node=document.createTextNode(""),new MutationObserver(flush).observe(node,{characterData:!0}),function(){node.data=toggle=!toggle}):Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),then=promise.then,function(){then.call(promise,flush)}):function(){macrotask.call(global_1,flush)});var Internal$1,OwnPromiseCapability,PromiseWrapper,nativeThen,microtask=queueMicrotask||function(t){var e={fn:t,next:void 0};last&&(last.next=e),head||(head=e,notify()),last=e},PromiseCapability=function(t){var r,n;this.promise=new t(function(t,e){if(void 0!==r||void 0!==n)throw TypeError("Bad Promise constructor");r=t,n=e}),this.resolve=aFunction$1(r),this.reject=aFunction$1(n)},f$5=function(t){return new PromiseCapability(t)},newPromiseCapability={f:f$5},promiseResolve=function(t,e){if(anObject(t),isObject(e)&&e.constructor===t)return e;var r=newPromiseCapability.f(t);return(0,r.resolve)(e),r.promise},hostReportErrors=function(t,e){var r=global_1.console;r&&r.error&&(1===arguments.length?r.error(t):r.error(t,e))},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},task$1=task.set,SPECIES$5=wellKnownSymbol("species"),PROMISE="Promise",getInternalState$2=internalState.get,setInternalState$2=internalState.set,getInternalPromiseState=internalState.getterFor(PROMISE),PromiseConstructor=nativePromiseConstructor,TypeError$1=global_1.TypeError,document$2=global_1.document,process$3=global_1.process,$fetch=getBuiltIn("fetch"),newPromiseCapability$1=newPromiseCapability.f,newGenericPromiseCapability=newPromiseCapability$1,IS_NODE$1="process"==classofRaw(process$3),DISPATCH_EVENT=!!(document$2&&document$2.createEvent&&global_1.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,FORCED$6=isForced_1(PROMISE,function(){if(!(inspectSource(PromiseConstructor)!==String(PromiseConstructor))){if(66===engineV8Version)return!0;if(!IS_NODE$1&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=engineV8Version&&/native code/.test(PromiseConstructor))return!1;function t(t){t(function(){},function(){})}var e=PromiseConstructor.resolve(1);return(e.constructor={})[SPECIES$5]=t,!(e.then(function(){})instanceof t)}),INCORRECT_ITERATION=FORCED$6||!checkCorrectnessOfIteration(function(t){PromiseConstructor.all(t).catch(function(){})}),isThenable=function(t){var e;return!(!isObject(t)||"function"!=typeof(e=t.then))&&e},notify$1=function(c,p,f){var d;p.notified||(p.notified=!0,d=p.reactions,microtask(function(){for(var t=p.value,e=p.state==FULFILLED,r=0;d.length>r;){var n,i,a,o=d[r++],s=e?o.ok:o.fail,u=o.resolve,l=o.reject,h=o.domain;try{s?(e||(p.rejection===UNHANDLED&&onHandleUnhandled(c,p),p.rejection=HANDLED),!0===s?n=t:(h&&h.enter(),n=s(t),h&&(h.exit(),a=!0)),n===o.promise?l(TypeError$1("Promise-chain cycle")):(i=isThenable(n))?i.call(n,u,l):u(n)):l(t)}catch(t){h&&!a&&h.exit(),l(t)}}p.reactions=[],p.notified=!1,f&&!p.rejection&&onUnhandled(c,p)}))},dispatchEvent=function(t,e,r){var n,i;DISPATCH_EVENT?((n=document$2.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),global_1.dispatchEvent(n)):n={promise:e,reason:r},(i=global_1["on"+t])?i(n):t===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",r)},onUnhandled=function(r,n){task$1.call(global_1,function(){var t,e=n.value;if(isUnhandled(n)&&(t=perform(function(){IS_NODE$1?process$3.emit("unhandledRejection",e,r):dispatchEvent(UNHANDLED_REJECTION,r,e)}),n.rejection=IS_NODE$1||isUnhandled(n)?UNHANDLED:HANDLED,t.error))throw t.value})},isUnhandled=function(t){return t.rejection!==HANDLED&&!t.parent},onHandleUnhandled=function(t,e){task$1.call(global_1,function(){IS_NODE$1?process$3.emit("rejectionHandled",t):dispatchEvent(REJECTION_HANDLED,t,e.value)})},bind=function(e,r,n,i){return function(t){e(r,n,t,i)}},internalReject=function(t,e,r,n){e.done||(e.done=!0,n&&(e=n),e.value=r,e.state=REJECTED,notify$1(t,e,!0))},internalResolve=function(r,n,t,e){if(!n.done){n.done=!0,e&&(n=e);try{if(r===t)throw TypeError$1("Promise can't be resolved itself");var i=isThenable(t);i?microtask(function(){var e={done:!1};try{i.call(t,bind(internalResolve,r,e,n),bind(internalReject,r,e,n))}catch(t){internalReject(r,e,t,n)}}):(n.value=t,n.state=FULFILLED,notify$1(r,n,!1))}catch(t){internalReject(r,{done:!1},t,n)}}};FORCED$6&&(PromiseConstructor=function(t){anInstance(this,PromiseConstructor,PROMISE),aFunction$1(t),Internal$1.call(this);var e=getInternalState$2(this);try{t(bind(internalResolve,this,e),bind(internalReject,this,e))}catch(t){internalReject(this,e,t)}},(Internal$1=function(){setInternalState$2(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:PENDING,value:void 0})}).prototype=redefineAll(PromiseConstructor.prototype,{then:function(t,e){var r=getInternalPromiseState(this),n=newPromiseCapability$1(speciesConstructor(this,PromiseConstructor));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=IS_NODE$1?process$3.domain:void 0,r.parent=!0,r.reactions.push(n),r.state!=PENDING&&notify$1(this,r,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),OwnPromiseCapability=function(){var t=new Internal$1,e=getInternalState$2(t);this.promise=t,this.resolve=bind(internalResolve,t,e),this.reject=bind(internalReject,t,e)},newPromiseCapability.f=newPromiseCapability$1=function(t){return t===PromiseConstructor||t===PromiseWrapper?new OwnPromiseCapability(t):newGenericPromiseCapability(t)},"function"==typeof nativePromiseConstructor&&(nativeThen=nativePromiseConstructor.prototype.then,redefine(nativePromiseConstructor.prototype,"then",function(t,e){var r=this;return new PromiseConstructor(function(t,e){nativeThen.call(r,t,e)}).then(t,e)},{unsafe:!0}),"function"==typeof $fetch&&_export({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return promiseResolve(PromiseConstructor,$fetch.apply(global_1,arguments))}}))),_export({global:!0,wrap:!0,forced:FORCED$6},{Promise:PromiseConstructor}),setToStringTag(PromiseConstructor,PROMISE,!1),setSpecies(PROMISE),PromiseWrapper=getBuiltIn(PROMISE),_export({target:PROMISE,stat:!0,forced:FORCED$6},{reject:function(t){var e=newPromiseCapability$1(this);return e.reject.call(void 0,t),e.promise}}),_export({target:PROMISE,stat:!0,forced:FORCED$6},{resolve:function(t){return promiseResolve(this,t)}}),_export({target:PROMISE,stat:!0,forced:INCORRECT_ITERATION},{all:function(t){var s=this,e=newPromiseCapability$1(s),u=e.resolve,l=e.reject,r=perform(function(){var n=aFunction$1(s.resolve),i=[],a=0,o=1;iterate_1(t,function(t){var e=a++,r=!1;i.push(void 0),o++,n.call(s,t).then(function(t){r||(r=!0,i[e]=t,--o||u(i))},l)}),--o||u(i)});return r.error&&l(r.value),e.promise},race:function(t){var r=this,n=newPromiseCapability$1(r),i=n.reject,e=perform(function(){var e=aFunction$1(r.resolve);iterate_1(t,function(t){e.call(r,t).then(n.resolve,i)})});return e.error&&i(e.value),n.promise}});var thaw_1=createCommonjsModule(function(t,e){var o=commonjsGlobal&&commonjsGlobal.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.thaw=e.Thaw=void 0;var r=(Object.defineProperty(s,"isThawing",{get:function(){return s.thawing},enumerable:!1,configurable:!0}),s.stopAll=function(){for(var t=0;t<s.thaws.length;t++)s.thaws[t].stop()},s.prototype.makeReady=function(){return!!this.isStopped&&!(this.isStopped=!1)},s.prototype.add=function(t){return this.items.push(t),this.makeReady()&&this.tick(),this},s.prototype.insert=function(t){return this.items.splice(this.i,0,t),this.makeReady()&&this.tick(),this},s.prototype.addArray=function(t){return this.items=this.items.concat(t),this.makeReady()&&this.tick(),this},s.prototype.insertArray=function(t){var e=this.items.splice(0,this.i),r=this.items;return this.items=e.concat(t,r),this.makeReady()&&this.tick(),this},s.prototype.stop=function(){return this.isStopped=!0,clearTimeout(this.timeout),this.options.done&&this.options.done(),this},s.thawing=!1,s.thaws=[],s.defaultSettings={each:null,done:null},s);function s(t,e){var r=this;void 0===e&&(e={});var n=o(o({},s.defaultSettings),e),i=n.each,a=n.done;this.i=0,this.isStopped=!1,this.items=t,this.options=e,this.tick=function(){if(!r.isStopped&&(r.timeout=setTimeout(r.tick,0),!s.thawing)){var t=r.items[r.i];if(r.i>=r.items.length)return null!==a&&(s.thawing=!0,a(),s.thawing=!1),r.isStopped=!0,void clearTimeout(r.timeout);null!==i?(s.thawing=!0,i(t,r.i),s.thawing=!1):void 0!==t&&t(),r.i++}},s.thaws.push(this),e.delay||this.tick()}e.Thaw=r,e.thaw=function(t,e){return new r(t,e)}});unwrapExports(thaw_1);var thaw_2=thaw_1.thaw,thaw_3=thaw_1.Thaw,block=createCommonjsModule(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Block=void 0;var r=(n.prototype.add=function(t){return this.next().add(t),this},n.prototype.addArray=function(t){return this.next().addArray(t),this},n.prototype.insert=function(t){return this.next().insert(t),this},n.prototype.insertArray=function(t){return this.next().insertArray(t),this},n.prototype.stop=function(){for(var t=0;t<this.thaws.length;t++)this.thaws[t].stop();return this},n.prototype.next=function(){var t,e=this.thaws;return e.length<this.count?(t=new thaw_1.Thaw([],this.options),e.push(t)):t=e[this.index]||null,this.index++,this.index>=this.count&&(this.index=0),t},n);function n(t,e){void 0===e&&(e=200),this.index=0,this.thaws=[],this.count=e,this.options=t}e.Block=r});unwrapExports(block);var block_1=block.Block,dist=createCommonjsModule(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Block=e.thaw=e.Thaw=void 0,Object.defineProperty(e,"Thaw",{enumerable:!0,get:function(){return thaw_1.Thaw}}),Object.defineProperty(e,"thaw",{enumerable:!0,get:function(){return thaw_1.thaw}}),Object.defineProperty(e,"Block",{enumerable:!0,get:function(){return block.Block}}),"undefined"!=typeof window&&(window.Thaw=thaw_1.Thaw,window.thaw=thaw_1.thaw,window.Thaw.Block=block.Block)});unwrapExports(dist);var dist_1=dist.Block,dist_2=dist.thaw,dist_3=dist.Thaw,propertyIsEnumerable=objectPropertyIsEnumerable.f,createMethod$4=function(s){return function(t){for(var e,r=toIndexedObject(t),n=objectKeys(r),i=n.length,a=0,o=[];a<i;)e=n[a++],descriptors&&!propertyIsEnumerable.call(r,e)||o.push(s?[e,r[e]]:r[e]);return o}},objectToArray={entries:createMethod$4(!0),values:createMethod$4(!1)},$values=objectToArray.values;_export({target:"Object",stat:!0},{values:function(t){return $values(t)}});var toArray=function(t){return Array.isArray(t)?t:new Float32Array(Object.values(t))},max$3=function(t){return Math.max.apply(Math,_toConsumableArray(toArray(t)))},mse=function(t){for(var e=0,r=0;r<t.length;r++)e+=Math.pow(t[r],2);return e/t.length},range=function(t,e){for(var r=[];t<e;t++)r.push(t);return r};function LookupTable(t,e){if(this.length=0,e){this.prop=e;for(var r=this.table={},n=0;n<t.length;n++){var i=t[n][e];for(var a in i)r.hasOwnProperty(a)||(r[a]=this.length++)}}else if(Array.isArray(t[0]))for(var o=this.table={},s=0;s<t.length;s++)for(var u=t[s],l=0;l<u.length;l++){var h=u[l];for(var c in h)o.hasOwnProperty(c)||(o[c]=this.length++)}else for(var p=this.table={},f=0;f<t.length;f++){var d=t[f];for(var y in d)p.hasOwnProperty(y)||(p[y]=this.length++)}}var lookupTable=LookupTable;function arraysToFloat32Arrays(t){for(var e=[],r=0;r<t.length;r++)e.push(Float32Array.from(t[r]));return e}function arrayToFloat32Arrays(t){for(var e=[],r=0;r<t.length;r++)e.push(Float32Array.from([t[r]]));return e}function arrayToFloat32Array(t){return Float32Array.from(t)}function objectsToFloat32Arrays(t,e,r){for(var n=[],i=0;i<t.length;i++){var a=t[i],o=new Float32Array(r);for(var s in a)a.hasOwnProperty(s)&&(o[e[s]]=a[s]);n.push(o)}return n}function objectToFloat32Arrays(t){var e=[];for(var r in t)e.push(Float32Array.from([t[r]]));return e}function objectToFloat32Array(t,e,r){var n=new Float32Array(r);for(var i in t)t.hasOwnProperty(i)&&(n[e[i]]=t[i]);return n}var cast={arraysToFloat32Arrays:arraysToFloat32Arrays,arrayToFloat32Arrays:arrayToFloat32Arrays,arrayToFloat32Array:arrayToFloat32Array,objectsToFloat32Arrays:objectsToFloat32Arrays,objectToFloat32Arrays:objectToFloat32Arrays,objectToFloat32Array:objectToFloat32Array},Thaw=dist.Thaw,arrayToFloat32Array$1=cast.arrayToFloat32Array;function getTypedArrayFn(t,n){if(t.buffer instanceof ArrayBuffer)return null;if(Array.isArray(t))return arrayToFloat32Array$1;var i=Object.keys(n).length;return function(t){var e=new Float32Array(i);for(var r in n)e[n[r]]=t[r]||0;return e}}var NeuralNetwork=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),Object.assign(this,this.constructor.defaults,t),this.trainOpts={},this.updateTrainingOptions(_objectSpread2(_objectSpread2({},this.constructor.trainDefaults),t)),this.sizes=null,this.outputLayer=null,this.biases=null,this.weights=null,this.outputs=null,this.deltas=null,this.changes=null,this.errors=null,this.errorCheckInterval=1,this.constructor.prototype.hasOwnProperty("runInput")||(this.runInput=null),this.constructor.prototype.hasOwnProperty("calculateDeltas")||(this.calculateDeltas=null),this.inputLookup=null,this.inputLookupLength=null,this.outputLookup=null,this.outputLookupLength=null,t.inputSize&&t.hiddenLayers&&t.outputSize&&(this.sizes=[t.inputSize].concat(t.hiddenLayers).concat([t.outputSize]))}return _createClass(e,null,[{key:"trainDefaults",get:function(){return{iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.3,momentum:.1,callback:null,callbackPeriod:10,timeout:1/0,praxis:null,beta1:.9,beta2:.999,epsilon:1e-8}}},{key:"defaults",get:function(){return{leakyReluAlpha:.01,binaryThresh:.5,hiddenLayers:null,activation:"sigmoid"}}}]),_createClass(e,[{key:"initialize",value:function(){if(!this.sizes)throw new Error("Sizes must be set before initializing");this.outputLayer=this.sizes.length-1,this.biases=[],this.weights=[],this.outputs=[],this.deltas=[],this.changes=[],this.errors=[];for(var t=0;t<=this.outputLayer;t++){var e=this.sizes[t];if(this.deltas[t]=zeros(e),this.errors[t]=zeros(e),this.outputs[t]=zeros(e),0<t){this.biases[t]=randos(e),this.weights[t]=new Array(e),this.changes[t]=new Array(e);for(var r=0;r<e;r++){var n=this.sizes[t-1];this.weights[t][r]=randos(n),this.changes[t][r]=zeros(n)}}}this.setActivation(),"adam"===this.trainOpts.praxis&&this._setupAdam()}},{key:"setActivation",value:function(t){switch(this.activation=t||this.activation,this.activation){case"sigmoid":this.runInput=this.runInput||this._runInputSigmoid,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasSigmoid;break;case"relu":this.runInput=this.runInput||this._runInputRelu,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasRelu;break;case"leaky-relu":this.runInput=this.runInput||this._runInputLeakyRelu,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasLeakyRelu;break;case"tanh":this.runInput=this.runInput||this._runInputTanh,this.calculateDeltas=this.calculateDeltas||this._calculateDeltasTanh;break;default:throw new Error("Unknown activation ".concat(this.activation,". Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'"))}}},{key:"run",value:function(t){if(!this.isRunnable)return null;this.inputLookup&&(t=lookup.toArray(this.inputLookup,t,this.inputLookupLength));var e=this.runInput(t).slice(0);return this.outputLookup&&(e=lookup.toObject(this.outputLookup,e)),e}},{key:"_runInputSigmoid",value:function(t){this.outputs[0]=t;for(var e=null,r=1;r<=this.outputLayer;r++){for(var n=this.sizes[r],i=this.weights[r],a=this.biases[r],o=this.outputs[r],s=0;s<n;s++){for(var u=i[s],l=a[s],h=0;h<u.length;h++)l+=u[h]*t[h];o[s]=1/(1+Math.exp(-l))}e=t=this.outputs[r]}return e}},{key:"_runInputRelu",value:function(t){this.outputs[0]=t;for(var e=null,r=1;r<=this.outputLayer;r++){for(var n=this.sizes[r],i=this.weights[r],a=this.biases[r],o=this.outputs[r],s=0;s<n;s++){for(var u=i[s],l=a[s],h=0;h<u.length;h++)l+=u[h]*t[h];o[s]=l<0?0:l}e=t=o}return e}},{key:"_runInputLeakyRelu",value:function(t){this.outputs[0]=t;for(var e=this.leakyReluAlpha,r=null,n=1;n<=this.outputLayer;n++){for(var i=this.sizes[n],a=this.weights[n],o=this.biases[n],s=this.outputs[n],u=0;u<i;u++){for(var l=a[u],h=o[u],c=0;c<l.length;c++)h+=l[c]*t[c];s[u]=h<0?0:e*h}r=t=s}return r}},{key:"_runInputTanh",value:function(t){this.outputs[0]=t;for(var e=null,r=1;r<=this.outputLayer;r++){for(var n=this.sizes[r],i=this.weights[r],a=this.biases[r],o=this.outputs[r],s=0;s<n;s++){for(var u=i[s],l=a[s],h=0;h<u.length;h++)l+=u[h]*t[h];o[s]=Math.tanh(l)}e=t=o}return e}},{key:"verifyIsInitialized",value:function(t){var e=this;this.sizes||(this.sizes=[],this.sizes.push(t[0].input.length),this.hiddenLayers?this.hiddenLayers.forEach(function(t){e.sizes.push(t)}):this.sizes.push(Math.max(3,Math.floor(t[0].input.length/2))),this.sizes.push(t[0].output.length),this.initialize())}},{key:"updateTrainingOptions",value:function(t){var e=this.constructor.trainDefaults;for(var r in e)e.hasOwnProperty(r)&&(this.trainOpts[r]=t.hasOwnProperty(r)?t[r]:e[r]);this.validateTrainingOptions(this.trainOpts),this.setLogMethod(t.log||this.trainOpts.log),this.activation=t.activation||this.activation}},{key:"validateTrainingOptions",value:function(t){var e={iterations:function(t){return"number"==typeof t&&0<t},errorThresh:function(t){return"number"==typeof t&&0<t&&t<1},log:function(t){return"function"==typeof t||"boolean"==typeof t},logPeriod:function(t){return"number"==typeof t&&0<t},learningRate:function(t){return"number"==typeof t&&0<t&&t<1},momentum:function(t){return"number"==typeof t&&0<t&&t<1},callback:function(t){return"function"==typeof t||null===t},callbackPeriod:function(t){return"number"==typeof t&&0<t},timeout:function(t){return"number"==typeof t&&0<t}};for(var r in e)if(e.hasOwnProperty(r)&&t.hasOwnProperty(r)&&!e[r](t[r]))throw new Error("[".concat(r,", ").concat(t[r],"] is out of normal training range, your network will probably not train."))}},{key:"getTrainOptsJSON",value:function(){var r=this;return Object.keys(this.constructor.trainDefaults).reduce(function(t,e){return"timeout"===e&&r.trainOpts[e]===1/0||"callback"===e||(r.trainOpts[e]&&(t[e]=r.trainOpts[e]),"log"===e&&(t.log="function"==typeof t.log)),t},{})}},{key:"setLogMethod",value:function(t){this.trainOpts.log="function"==typeof t?t:!!t&&this.logTrainingStatus}},{key:"logTrainingStatus",value:function(t){console.log("iterations: ".concat(t.iterations,", training error: ").concat(t.error))}},{key:"calculateTrainingError",value:function(t){for(var e=0,r=0;r<t.length;++r)e+=this.trainPattern(t[r],!0);return e/t.length}},{key:"trainPatterns",value:function(t){for(var e=0;e<t.length;++e)this.trainPattern(t[e])}},{key:"trainingTick",value:function(t,e,r){var n=this.trainOpts,i=n.callback,a=n.callbackPeriod,o=n.errorThresh,s=n.iterations,u=n.log,l=n.logPeriod;return!(e.iterations>=s||e.error<=o||Date.now()>=r)&&(e.iterations++,u&&e.iterations%l==0?(e.error=this.calculateTrainingError(t),u(e)):e.iterations%this.errorCheckInterval==0?e.error=this.calculateTrainingError(t):this.trainPatterns(t),i&&e.iterations%a==0&&i({iterations:e.iterations,error:e.error}),!0)}},{key:"prepTraining",value:function(t,e){this.updateTrainingOptions(e),t=this.formatData(t);var r=Date.now()+this.trainOpts.timeout;return this.verifyIsInitialized(t),{data:t,status:{error:1,iterations:0},endTime:r}}},{key:"train",value:function(t,e){var r,n,i=1<arguments.length&&void 0!==e?e:{},a=this.prepTraining(t,_objectSpread2(_objectSpread2({},this.trainOpts),i));for(t=a.data,r=a.status,n=a.endTime;this.trainingTick(t,r,n););return r}},{key:"trainAsync",value:function(n,t){var i,a,o=this,e=1<arguments.length&&void 0!==t?t:{},r=this.prepTraining(n,e);return n=r.data,i=r.status,a=r.endTime,new Promise(function(t,e){try{var r=new Thaw(new Array(o.trainOpts.iterations),{delay:!0,each:function(){return o.trainingTick(n,i,a)||r.stop()},done:function(){return t(i)}});r.tick()}catch(t){console.log(JSON.stringify(t)),e(new Error({trainError:t,status:i}))}})}},{key:"trainPattern",value:function(t,e){return this.runInput(t.input),this.calculateDeltas(t.output),this.adjustWeights(),e?mse(this.errors[this.outputLayer]):null}},{key:"_calculateDeltasSigmoid",value:function(t){for(var e=this.outputLayer;0<=e;e--)for(var r=this.sizes[e],n=this.outputs[e],i=this.errors[e],a=this.deltas[e],o=this.weights[e+1],s=0;s<r;s++){var u=n[s],l=0;if(e===this.outputLayer)l=t[s]-u;else for(var h=this.deltas[e+1],c=0;c<h.length;c++)l+=h[c]*o[c][s];i[s]=l,a[s]=l*u*(1-u)}}},{key:"_calculateDeltasRelu",value:function(t){for(var e=this.outputLayer;0<=e;e--)for(var r=this.sizes[e],n=this.outputs[e],i=this.weights[e+1],a=this.deltas[e+1],o=this.errors[e],s=this.deltas[e],u=0;u<r;u++){var l=n[u],h=0;if(e===this.outputLayer)h=t[u]-l;else for(var c=0;c<a.length;c++)h+=a[c]*i[c][u];o[u]=h,s[u]=0<l?h:0}}},{key:"_calculateDeltasLeakyRelu",value:function(t){for(var e=this.leakyReluAlpha,r=this.outputLayer;0<=r;r--)for(var n=this.sizes[r],i=this.outputs[r],a=this.deltas[r+1],o=this.weights[r+1],s=this.errors[r],u=this.deltas[r],l=0;l<n;l++){var h=i[l],c=0;if(r===this.outputLayer)c=t[l]-h;else for(var p=0;p<a.length;p++)c+=a[p]*o[p][l];s[l]=c,u[l]=0<h?c:e*c}}},{key:"_calculateDeltasTanh",value:function(t){for(var e=this.outputLayer;0<=e;e--)for(var r=this.sizes[e],n=this.outputs[e],i=this.deltas[e+1],a=this.weights[e+1],o=this.errors[e],s=this.deltas[e],u=0;u<r;u++){var l=n[u],h=0;if(e===this.outputLayer)h=t[u]-l;else for(var c=0;c<i.length;c++)h+=i[c]*a[c][u];o[u]=h,s[u]=(1-l*l)*h}}},{key:"adjustWeights",value:function(){for(var t=this.trainOpts,e=t.learningRate,r=t.momentum,n=1;n<=this.outputLayer;n++)for(var i=this.outputs[n-1],a=this.sizes[n],o=this.deltas[n],s=this.changes[n],u=this.weights[n],l=this.biases[n],h=0;h<a;h++){for(var c=o[h],p=0;p<i.length;p++){var f=s[h][p],f=e*c*i[p]+r*f;s[h][p]=f,u[h][p]+=f}l[h]+=e*c}}},{key:"_setupAdam",value:function(){this.biasChangesLow=[],this.biasChangesHigh=[],this.changesLow=[],this.changesHigh=[];for(var t=this.iterations=0;t<=this.outputLayer;t++){var e=this.sizes[t];if(0<t){this.biasChangesLow[t]=zeros(e),this.biasChangesHigh[t]=zeros(e),this.changesLow[t]=new Array(e),this.changesHigh[t]=new Array(e);for(var r=0;r<e;r++){var n=this.sizes[t-1];this.changesLow[t][r]=zeros(n),this.changesHigh[t][r]=zeros(n)}}}this.adjustWeights=this._adjustWeightsAdam}},{key:"_adjustWeightsAdam",value:function(){this.iterations++;for(var t=this.iterations,e=this.trainOpts,r=e.beta1,n=e.beta2,i=e.epsilon,a=e.learningRate,o=1;o<=this.outputLayer;o++)for(var s=this.outputs[o-1],u=this.sizes[o],l=this.deltas[o],h=this.changesLow[o],c=this.changesHigh[o],p=this.weights[o],f=this.biases[o],d=this.biasChangesLow[o],y=this.biasChangesHigh[o],g=0;g<u;g++){for(var m=l[g],v=0;v<s.length;v++){var w=m*s[v],b=h[g][v]*r+(1-r)*w,k=c[g][v]*n+(1-n)*w*w,$=b/(1-Math.pow(r,t)),S=k/(1-Math.pow(n,t));h[g][v]=b,c[g][v]=k,p[g][v]+=a*$/(Math.sqrt(S)+i)}var _=l[g],E=d[g]*r+(1-r)*_,T=y[g]*n+(1-n)*_*_,A=d[g]/(1-Math.pow(r,t)),O=y[g]/(1-Math.pow(n,t));d[g]=E,y[g]=T,f[g]+=a*A/(Math.sqrt(O)+i)}}},{key:"formatData",value:function(t){var e,r;if(Array.isArray(t)||(t=[t]),Array.isArray(t[0].input)||(this.inputLookup?this.inputLookupLength=Object.keys(this.inputLookup).length:(e=new lookupTable(t,"input"),this.inputLookup=e.table,this.inputLookupLength=e.length)),Array.isArray(t[0].output)||(this.outputLookup?this.outputLookupLength=Object.keys(this.outputLookup).length:(r=new lookupTable(t,"output"),this.outputLookup=r.table,this.outputLookupLength=r.length)),void 0===this._formatInput&&(this._formatInput=getTypedArrayFn(t[0].input,this.inputLookup),this._formatOutput=getTypedArrayFn(t[0].output,this.outputLookup)),this._formatInput&&this._formatOutput){for(var n=[],i=0;i<t.length;i++)n.push({input:this._formatInput(t[i].input),output:this._formatOutput(t[i].output)});return n}if(this._formatInput){for(var a=[],o=0;o<t.length;o++)a.push({input:this._formatInput(t[o].input),output:t[o].output});return a}if(this._formatOutput){for(var s=[],u=0;u<t.length;u++)s.push({input:t[u].input,output:this._formatOutput(t[u].output)});return s}return t}},{key:"addFormat",value:function(t){this.inputLookup=lookup.addKeys(t.input,this.inputLookup),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length),this.outputLookup=lookup.addKeys(t.output,this.outputLookup),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length)}},{key:"test",value:function(o){var s=this,t=1===(o=this.formatData(o))[0].output.length,u=[],l=0;if(t){for(var h=0,c=0,p=0,f=0,e=function(t){var e,r=s.runInput(o[t].input),n=o[t].output,i=r[0]>s.binaryThresh?1:0,a=n[0];i!==a&&(e=o[t],u.push({input:e.input,output:e.output,actual:i,expected:a})),0==i&&0===a?f++:1==i&&1===a?p++:0==i&&1===a?c++:1==i&&0===a&&h++,l+=mse(r.map(function(t,e){return n[e]-t}))},r=0;r<o.length;r++)e(r);return{error:l/o.length,misclasses:u,total:o.length,trueNeg:f,truePos:p,falseNeg:c,falsePos:h,precision:0<p?p/(p+h):0,recall:0<p?p/(p+c):0,accuracy:(f+p)/o.length}}for(var n=function(t){var e,r=s.runInput(o[t].input),n=o[t].output,i=r.indexOf(max$3(r)),a=n.indexOf(max$3(n));i!==a&&(e=o[t],u.push({input:e.input,output:e.output,actual:i,expected:a})),l+=mse(r.map(function(t,e){return n[e]-t}))},i=0;i<o.length;i++)n(i);return{error:l/o.length,misclasses:u,total:o.length}}},{key:"toJSON",value:function(){null===this.sizes&&this.initialize();for(var t=[],e=0;e<=this.outputLayer;e++){t[e]={};for(var r=void 0,r=0===e&&this.inputLookup?Object.keys(this.inputLookup):this.outputLookup&&e===this.outputLayer?Object.keys(this.outputLookup):range(0,this.sizes[e]),n=0;n<r.length;n++){var i=r[n];if(t[e][i]={},0<e)for(var a in t[e][i].bias=this.biases[e][n],t[e][i].weights={},t[e-1]){var o=a;1===e&&this.inputLookup&&(o=this.inputLookup[a]),t[e][i].weights[a]=this.weights[e][n][o]}}}return{sizes:this.sizes.slice(0),layers:t,outputLookup:null!==this.outputLookup,inputLookup:null!==this.inputLookup,activation:this.activation,trainOpts:this.getTrainOptsJSON()}}},{key:"fromJSON",value:function(t){Object.assign(this,this.constructor.defaults,t),this.sizes=t.sizes,this.initialize();for(var e=0;e<=this.outputLayer;e++){var r=t.layers[e];if(0!==e||r[0]&&!t.inputLookup?e!==this.outputLayer||r[0]&&!t.outputLookup||(this.outputLookup=lookup.toHash(r)):(this.inputLookup=lookup.toHash(r),this.inputLookupLength=Object.keys(this.inputLookup).length),0<e){var n,i=Object.keys(r);for(var a in this.sizes[e]=i.length,i){i.hasOwnProperty(a)&&(n=i[a],this.biases[e][a]=r[n].bias,this.weights[e][a]=toArray(r[n].weights))}}}return t.hasOwnProperty("trainOpts")&&this.updateTrainingOptions(t.trainOpts),this}},{key:"toFunction",value:function(t){var o=this.activation,s=this.leakyReluAlpha,u=!1;function l(t,e,r){if(0===e)return"string"==typeof r?"(input['".concat(r,"']||0)"):"(input[".concat(r,"]||0)");var n=t[e][r],i=["(",n.bias];for(var a in n.weights)n.weights[a]<0?i.push("".concat(n.weights[a],"*").concat(l(t,e-1,a))):i.push("+".concat(n.weights[a],"*").concat(l(t,e-1,a)));switch(i.push(")"),o){case"sigmoid":return"1/(1+1/Math.exp(".concat(i.join(""),"))");case"relu":return u=!0,"((v=".concat(i.join(""),")<0?0:v)");case"leaky-relu":return u=!0,"((v=".concat(i.join(""),")<0?0:").concat(s,"*v)");case"tanh":return"Math.tanh(".concat(i.join(""),")");default:throw new Error("Unknown activation ".concat(this.activation,". Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'"))}}var e,r=this.toJSON().layers,n=[];for(var i in r[r.length-1])n.push(l(r,r.length-1,i));e=this.outputLookup?"{".concat(Object.keys(this.outputLookup).map(function(t,e){return"'".concat(t,"':").concat(n[e])}),"}"):"[".concat(n.join(","),"]");var a="".concat(u?"var v;":"","return ").concat(e,";");return new Function("input",t?t(a):a)}},{key:"isRunnable",get:function(){var e=this;if(!this.runInput)return console.error("Activation function has not been initialized, did you run train()?"),!1;var t=["sizes","outputLayer","biases","weights","outputs","deltas","changes","errors"].filter(function(t){return null===e[t]});return!(0<t.length)||(console.error("Some settings have not been initialized correctly, did you run train()? Found issues with: ".concat(t.join(", "))),!1)}}]),e}(),neuralNetwork=NeuralNetwork,arrayFrom=function(t,e,r){var n,i,a,o,s,u,l=toObject(t),h="function"==typeof this?this:Array,c=arguments.length,p=1<c?e:void 0,f=void 0!==p,d=getIteratorMethod(l),y=0;if(f&&(p=functionBindContext(p,2<c?r:void 0,2)),null==d||h==Array&&isArrayIteratorMethod(d))for(i=new h(n=toLength(l.length));y<n;y++)u=f?p(l[y],y):l[y],createProperty(i,y,u);else for(s=(o=d.call(l)).next,i=new h;!(a=s.call(o)).done;y++)u=f?callWithSafeIterationClosing(o,p,[a.value,y],!0):a.value,createProperty(i,y,u);return i.length=y,i},INCORRECT_ITERATION$1=!checkCorrectnessOfIteration(function(t){Array.from(t)});_export({target:"Array",stat:!0,forced:INCORRECT_ITERATION$1},{from:arrayFrom});var createMethod$5=function(s){return function(t,e){var r,n,i=String(requireObjectCoercible(t)),a=toInteger(e),o=i.length;return a<0||o<=a?s?"":void 0:(r=i.charCodeAt(a))<55296||56319<r||a+1===o||(n=i.charCodeAt(a+1))<56320||57343<n?s?i.charAt(a):r:s?i.slice(a,a+2):n-56320+(r-55296<<10)+65536}},stringMultibyte={codeAt:createMethod$5(!1),charAt:createMethod$5(!0)},charAt=stringMultibyte.charAt,STRING_ITERATOR="String Iterator",setInternalState$3=internalState.set,getInternalState$3=internalState.getterFor(STRING_ITERATOR);defineIterator(String,"String",function(t){setInternalState$3(this,{type:STRING_ITERATOR,string:String(t),index:0})},function(){var t,e=getInternalState$3(this),r=e.string,n=e.index;return n>=r.length?{value:void 0,done:!0}:(t=charAt(r,n),e.index+=t.length,{value:t,done:!1})});var GPU$1=gpu.GPU,alias=gpu.alias,gpuUtils=gpu.utils,release$i=kernel.release;function weightedSumSigmoid(t,e,r){for(var n=e[this.thread.x],i=0;i<this.constants.size;i++)n+=t[this.thread.x][i]*r[i];return 1/(1+Math.exp(-n))}function weightedSumRelu(t,e,r){for(var n=e[this.thread.x],i=0;i<this.constants.size;i++)n+=t[this.thread.x][i]*r[i];return n<0?0:n}function weightedSumLeakyRelu(t,e,r){for(var n=e[this.thread.x],i=0;i<this.constants.size;i++)n+=t[this.thread.x][i]*r[i];return n<0?0:.01*n}function weightedSumTanh(t,e,r){for(var n=e[this.thread.x],i=0;i<this.constants.size;i++)n+=t[this.thread.x][i]*r[i];return Math.tanh(n)}function calcErrorOutput(t,e){return e[this.thread.x]-t}function calcDeltasSigmoid(t,e){return t*e*(1-e)}function calcDeltasRelu(t,e){return 0<e?t:0}function calcDeltasLeakyRelu(t,e){return 0<e?t:.01*t}function calcDeltasTanh(t,e){return(1-e*e)*t}function calcError(t,e){for(var r=0,n=0;n<this.constants.size;n++)r+=e[n]*t[n][this.thread.x];return r}function calcChanges(t,e,r){return this.constants.learningRate*e[this.thread.y]*r[this.thread.x]+this.constants.momentum*t[this.thread.y][this.thread.x]}function addWeights(t,e){return t+e[this.thread.y][this.thread.x]}function addBiases(t,e){return t[this.thread.x]+e[this.thread.x]*this.constants.learningRate}function mse$1(t){for(var e=0,r=0;r<this.constants.size;r++)e+=Math.pow(t[r],2);return e/this.constants.size}var domain,NeuralNetworkGPU=function(){_inherits(i,neuralNetwork);var r=_createSuper(i);function i(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,i),(t=r.call(this,e)).forwardPropagate=[],t.backwardPropagate=[],t.changesPropagate=[],t.biasesPropagate=[],t.errorCheckInterval=100,t.gpu=new GPU$1({mode:e.mode}),t}return _createClass(i,[{key:"initialize",value:function(){_get(_getPrototypeOf(i.prototype),"initialize",this).call(this),this.buildRunInput(),this.buildCalculateDeltas(),this.buildGetChanges(),this.buildChangeBiases(),this.buildGetMSE()}},{key:"setActivation",value:function(){}},{key:"trainPattern",value:function(t,e){return this.runInput(t.input),this.calculateDeltas(t.output),this.adjustWeights(),e?this.getMSE(this.errors[this.outputLayer]):null}},{key:"calculateTrainingError",value:function(t){for(var e=new Float32Array([0]),r=0;r<t.length;++r){var n=e,i=this.trainPattern(t[r],!0),e=this._addMSE(e,i);release$i(i),release$i(n)}var a=this._divideMSESum(t.length,e)[0];return release$i(e),a}},{key:"adjustWeights",value:function(){this.getChanges(),this.changeBiases()}},{key:"buildRunInput",value:function(){var t=null;switch(this.activation){case"sigmoid":t=weightedSumSigmoid;break;case"relu":t=weightedSumRelu;break;case"leaky-relu":t=weightedSumLeakyRelu;break;case"tanh":t=weightedSumTanh;break;default:throw new Error("Unknown activation ".concat(this.activation,". Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'"))}for(var e=1;e<=this.outputLayer;e++)this.forwardPropagate[e]=this.gpu.createKernel(t,{output:[this.sizes[e]],pipeline:!0,constants:{size:this.sizes[e-1]},immutable:!0});this.texturizeInputData=this.gpu.createKernel(function(t){return t[this.thread.x]},{output:[this.sizes[1]],pipeline:!0,immutable:!0})}},{key:"runInput",value:function(t){var e;this.outputs[0]=t;for(var r=1;r<=this.outputLayer;r++)release$i(this.outputs[r]),this.outputs[r]=this.forwardPropagate[r](this.weights[r],this.biases[r],t),e=t=this.outputs[r];return e}},{key:"buildCalculateDeltas",value:function(){var i=null;switch(this.activation){case"sigmoid":i=calcDeltasSigmoid;break;case"relu":i=calcDeltasRelu;break;case"leaky-relu":i=calcDeltasLeakyRelu;break;case"tanh":i=calcDeltasTanh;break;default:throw new Error("Unknown activation ".concat(this.activation,". Available activations are: 'sigmoid', 'relu', 'leaky-relu', 'tanh'"))}i=alias(gpuUtils.getMinifySafeName(function(){return i}),i),this.gpu.addFunction(i);for(var t=this.outputLayer;0<t;t--)t===this.outputLayer?this.backwardPropagate[this.outputLayer]=this.gpu.createKernelMap({error:calcErrorOutput},function(t,e){var r=t[this.thread.x];return i(calcErrorOutput(r,e),r)},{output:[this.sizes[this.outputLayer]],pipeline:!0,immutable:!0}):this.backwardPropagate[t]=this.gpu.createKernelMap({error:calcError},function(t,e,r){var n=e[this.thread.x];return i(calcError(t,r),n)},{output:[this.sizes[t]],pipeline:!0,constants:{size:this.deltas[t+1].length},immutable:!0})}},{key:"calculateDeltas",value:function(t){for(var e=this.outputLayer;0<e;e--){var r=void 0;release$i(this.deltas[e]),release$i(this.errors[e]),r=e===this.outputLayer?this.backwardPropagate[e](this.outputs[e],t):this.backwardPropagate[e](this.weights[e+1],this.outputs[e],this.deltas[e+1]),this.deltas[e]=r.result,this.errors[e]=r.error}}},{key:"buildGetChanges",value:function(){for(var t=1;t<=this.outputLayer;t++)this.changesPropagate[t]=this.gpu.createKernelMap({weights:addWeights,changes:calcChanges},function(t,e,r,n){return addWeights(calcChanges(n,e,t),r)},{output:[this.sizes[t-1],this.sizes[t]],pipeline:!0,constants:{size:this.outputs[t-1].length,learningRate:this.trainOpts.learningRate,momentum:this.trainOpts.momentum},immutable:!0})}},{key:"getChanges",value:function(){for(var t=1;t<=this.outputLayer;t++){var e=this.weights[t],r=this.changes[t],n=this.changesPropagate[t](this.outputs[t-1],this.deltas[t],e,r);release$i(e),release$i(r),this.weights[t]=n.weights,this.changes[t]=n.changes,release$i(n.result)}}},{key:"buildChangeBiases",value:function(){for(var t=1;t<=this.outputLayer;t++)this.biasesPropagate[t]=this.gpu.createKernel(addBiases,{output:[this.sizes[t]],pipeline:!0,constants:{learningRate:this.trainOpts.learningRate},immutable:!0})}},{key:"changeBiases",value:function(){for(var t=1;t<=this.outputLayer;t++){var e=this.biases[t];this.biases[t]=this.biasesPropagate[t](e,this.deltas[t]),release$i(e)}}},{key:"buildGetMSE",value:function(){this.getMSE=this.gpu.createKernel(mse$1,{output:[1],constants:{size:this.sizes[this.outputLayer]},pipeline:!0,immutable:!0}),this._addMSE=this.gpu.createKernel(function(t,e){return t[0]+e[0]},{output:[1],pipeline:!0,immutable:!0}),this._divideMSESum=this.gpu.createKernel(function(t,e){var r=e[0];return 0<r?r/t:0},{output:[1]})}},{key:"run",value:function(t){if(!this.isRunnable)return null;this.inputLookup&&(t=lookup.toArray(this.inputLookup,t,this.inputLookupLength));var e=this.runInput(t),r=e.toArray?e.toArray():e;return this.outputLookup&&(r=lookup.toObject(this.outputLookup,r)),r}},{key:"prepTraining",value:function(t,e){var r=this;this.updateTrainingOptions(e),t=this.formatData(t);var n=Date.now()+this.trainOpts.timeout;this.verifyIsInitialized(t);var i=this.gpu.createKernel(function(t){return t[this.thread.x]},{output:[t[0].output.length],pipeline:!0,immutable:!0});return{data:t.map(function(t){return{input:r.texturizeInputData(t.input),output:i(t.output)}}),status:{error:1,iterations:0},endTime:n}}},{key:"toFunction",value:function(){throw new Error("".concat(this.constructor.name,"-toFunction is not yet implemented"))}},{key:"toJSON",value:function(){var t=this;if(!this.weights[1].toArray)return _get(_getPrototypeOf(i.prototype),"toJSON",this).call(this);for(var e=[],r=[],n=1;n<=this.outputLayer;n++)e[n]=Array.from(this.weights[n].toArray()),r[n]=Array.from(this.biases[n].toArray());return neuralNetwork.prototype.toJSON.call({activation:this.activation,inputLookup:this.inputLookup,outputLookup:this.outputLookup,outputLayer:this.outputLayer,sizes:this.sizes,getTrainOptsJSON:function(){return t.getTrainOptsJSON()},weights:e,biases:r})}}]),i}(),neuralNetworkGpu=NeuralNetworkGPU;function EventHandlers(){}function EventEmitter(){EventEmitter.init.call(this)}function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function emitNone(t,e,r){if(e)t.call(r);else for(var n=t.length,i=arrayClone(t,n),a=0;a<n;++a)i[a].call(r)}function emitOne(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,a=arrayClone(t,i),o=0;o<i;++o)a[o].call(r,n)}function emitTwo(t,e,r,n,i){if(e)t.call(r,n,i);else for(var a=t.length,o=arrayClone(t,a),s=0;s<a;++s)o[s].call(r,n,i)}function emitThree(t,e,r,n,i,a){if(e)t.call(r,n,i,a);else for(var o=t.length,s=arrayClone(t,o),u=0;u<o;++u)s[u].call(r,n,i,a)}function emitMany(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,a=arrayClone(t,i),o=0;o<i;++o)a[o].apply(r,n)}function _addListener(t,e,r,n){var i,a,o,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(i=t._events)?(i.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),a=i[e]):(i=t._events=new EventHandlers,t._eventsCount=0),a?("function"==typeof a?a=i[e]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),a.warned||(s=$getMaxListeners(t))&&0<s&&a.length>s&&(a.warned=!0,(o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=a.length,emitWarning(o))):(a=i[e]=r,++t._eventsCount),t}function emitWarning(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function _onceWrap(t,e,r){var n=!1;function i(){t.removeListener(e,i),n||(n=!0,r.apply(t,arguments))}return i.listener=r,i}function listenerCount(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function spliceOne(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}function arrayClone(t,e){for(var r=new Array(e);e--;)r[e]=t[e];return r}function unwrapListeners(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}EventHandlers.prototype=Object.create(null),(EventEmitter.EventEmitter=EventEmitter).usingDomains=!1,EventEmitter.prototype.domain=void 0,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.init=function(){this.domain=null,EventEmitter.usingDomains&&domain.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(t,e,r,n){var i,a,o,s,u,l="error"===t,h=this._events;if(h)l=l&&null==h.error;else if(!l)return!1;if(u=this.domain,l){if(i=e,u)return(i=i||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,i.domain=u,i.domainThrown=!1,u.emit("error",i),!1;if(i instanceof Error)throw i;var c=new Error('Uncaught, unspecified "error" event. ('+i+")");throw c.context=i,c}if(!(a=h[t]))return!1;var p,f="function"==typeof a;switch(p=arguments.length){case 1:emitNone(a,f,this);break;case 2:emitOne(a,f,this,e);break;case 3:emitTwo(a,f,this,e,r);break;case 4:emitThree(a,f,this,e,r,n);break;default:for(o=new Array(p-1),s=1;s<p;s++)o[s-1]=arguments[s];emitMany(a,f,this,o)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var r,n,i,a,o;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[t]))return this;if(r===e||r.listener&&r.listener===e)0==--this._eventsCount?this._events=new EventHandlers:(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,a=r.length;0<a--;)if(r[a]===e||r[a].listener&&r[a].listener===e){o=r[a].listener,i=a;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete n[t]}else spliceOne(r,i);n.removeListener&&this.emit("removeListener",t,o||e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,r=this._events;if(!r)return this;if(!r.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new EventHandlers:delete r[t]),this;if(0===arguments.length){for(var n,i=Object.keys(r),a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(;this.removeListener(t,e[e.length-1]),e[0];);return this},EventEmitter.prototype.listeners=function(t){var e,r=this._events,n=r&&(e=r[t])?"function"==typeof e?[e.listener||e]:unwrapListeners(e):[];return n},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};var global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},lookup$1=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,r=t.length;e<r;++e)lookup$1[e]=t[e],revLookup[t.charCodeAt(e)]=e;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(t){var e,r,n,i;inited||init();var a=t.length;if(0<a%4)throw new Error("Invalid string. Length must be a multiple of 4");n="="===t[a-2]?2:"="===t[a-1]?1:0,i=new Arr(3*a/4-n),e=0<n?a-4:a;for(var o=0,s=0;s<e;s+=4,0)r=revLookup[t.charCodeAt(s)]<<18|revLookup[t.charCodeAt(s+1)]<<12|revLookup[t.charCodeAt(s+2)]<<6|revLookup[t.charCodeAt(s+3)],i[o++]=r>>16&255,i[o++]=r>>8&255,i[o++]=255&r;return 2==n?(r=revLookup[t.charCodeAt(s)]<<2|revLookup[t.charCodeAt(s+1)]>>4,i[o++]=255&r):1==n&&(r=revLookup[t.charCodeAt(s)]<<10|revLookup[t.charCodeAt(s+1)]<<4|revLookup[t.charCodeAt(s+2)]>>2,i[o++]=r>>8&255,i[o++]=255&r),i}function tripletToBase64(t){return lookup$1[t>>18&63]+lookup$1[t>>12&63]+lookup$1[t>>6&63]+lookup$1[63&t]}function encodeChunk(t,e,r){for(var n,i=[],a=e;a<r;a+=3)n=(t[a]<<16)+(t[a+1]<<8)+t[a+2],i.push(tripletToBase64(n));return i.join("")}function fromByteArray(t){var e;inited||init();for(var r=t.length,n=r%3,i="",a=[],o=0,s=r-n;o<s;o+=16383)a.push(encodeChunk(t,o,s<o+16383?s:o+16383));return 1==n?(e=t[r-1],i+=lookup$1[e>>2],i+=lookup$1[e<<4&63],i+="=="):2==n&&(e=(t[r-2]<<8)+t[r-1],i+=lookup$1[e>>10],i+=lookup$1[e>>4&63],i+=lookup$1[e<<2&63],i+="="),a.push(i),a.join("")}function read(t,e,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,l=u>>1,h=-7,c=r?i-1:0,p=r?-1:1,f=t[e+c];for(c+=p,a=f&(1<<-h)-1,f>>=-h,h+=s;0<h;a=256*a+t[e+c],c+=p,h-=8);for(o=a&(1<<-h)-1,a>>=-h,h+=n;0<h;o=256*o+t[e+c],c+=p,h-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=l}return(f?-1:1)*o*Math.pow(2,a-n)}function write(t,e,r,n,i,a){var o,s,u,l=8*a-i-1,h=(1<<l)-1,c=h>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),2<=(e+=1<=o+c?p/u:p*Math.pow(2,1-c))*u&&(o++,u/=2),h<=o+c?(s=0,o=h):1<=o+c?(s=(e*u-1)*Math.pow(2,i),o+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,i),o=0));8<=i;t[r+f]=255&s,f+=d,s/=256,i-=8);for(o=o<<i|s,l+=i;0<l;t[r+f]=255&o,f+=d,o/=256,l-=8);t[r+f-d]|=128*y}var toString$1={}.toString,isArray$1=Array.isArray||function(t){return"[object Array]"==toString$1.call(t)},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,r);if("number"!=typeof t)return from(this,t,e,r);if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}function from(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?fromArrayBuffer(t,e,r,n):"string"==typeof e?fromString(t,e,r):fromObject(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function alloc(t,e,r,n){return assertSize(e),!(e<=0)&&void 0!==r?"string"==typeof n?createBuffer(t,e).fill(r,n):createBuffer(t,e).fill(r):createBuffer(t,e)}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function fromString(t,e,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(e,r),i=(t=createBuffer(t,n)).write(e,r);return i!==n&&(t=t.slice(0,i)),t}function fromArrayLike(t,e){var r=e.length<0?0:0|checked(e.length);t=createBuffer(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function fromArrayBuffer(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),Buffer.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Buffer.prototype:t=fromArrayLike(t,e),t}function fromObject(t,e){if(internalIsBuffer(e)){var r=0|checked(e.length);return 0===(t=createBuffer(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||isnan(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&isArray$1(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function internalIsBuffer(t){return!(null==t||!t._isBuffer)}function byteLength(t,e){if(internalIsBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(n)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),n=!0}}function slowToString(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"latin1":case"binary":return latin1Slice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function swap(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function bidirectionalIndexOf(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=Buffer.from(e,n)),internalIsBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,r,n,i);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):arrayIndexOf(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,r,n,i){var a=1,o=t.length,s=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o/=a=2,s/=2,r/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i)for(var l=-1,h=r;h<o;h++)if(u(t,h)===u(e,-1===l?0:h-l)){if(-1===l&&(l=h),h-l+1===s)return l*a}else-1!==l&&(h-=h-l),l=-1;else for(o<r+s&&(r=o-s),h=r;0<=h;h--){for(var c=!0,p=0;p<s;p++)if(u(t,h+p)!==u(e,p)){c=!1;break}if(c)return h}return-1}function hexWrite(t,e,r,n){r=Number(r)||0;var i=t.length-r;(!n||i<(n=Number(n)))&&(n=i);var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");a/2<n&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[r+o]=s}return o}function utf8Write(t,e,r,n){return blitBuffer(utf8ToBytes(e,t.length-r),t,r,n)}function asciiWrite(t,e,r,n){return blitBuffer(asciiToBytes(e),t,r,n)}function latin1Write(t,e,r,n){return asciiWrite(t,e,r,n)}function base64Write(t,e,r,n){return blitBuffer(base64ToBytes(e),t,r,n)}function ucs2Write(t,e,r,n){return blitBuffer(utf16leToBytes(e,t.length-r),t,r,n)}function base64Slice(t,e,r){return 0===e&&r===t.length?fromByteArray(t):fromByteArray(t.slice(e,r))}function utf8Slice(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var a,o,s,u,l=t[i],h=null,c=239<l?4:223<l?3:191<l?2:1;if(i+c<=r)switch(c){case 1:l<128&&(h=l);break;case 2:128==(192&(a=t[i+1]))&&127<(u=(31&l)<<6|63&a)&&(h=u);break;case 3:a=t[i+1],o=t[i+2],128==(192&a)&&128==(192&o)&&2047<(u=(15&l)<<12|(63&a)<<6|63&o)&&(u<55296||57343<u)&&(h=u);break;case 4:a=t[i+1],o=t[i+2],s=t[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&65535<(u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)&&u<1114112&&(h=u)}null===h?(h=65533,c=1):65535<h&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}return decodeCodePointsArray(n)}Buffer.TYPED_ARRAY_SUPPORT=void 0===global$1.TYPED_ARRAY_SUPPORT||global$1.TYPED_ARRAY_SUPPORT,Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,r){return from(null,t,e,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array),Buffer.alloc=function(t,e,r){return alloc(null,t,e,r)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=isBuffer,Buffer.compare=function(t,e){if(!internalIsBuffer(t)||!internalIsBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,a=Math.min(r,n);i<a;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!isArray$1(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);if(void 0===e)for(i=e=0;i<t.length;++i)e+=t[i].length;for(var r=Buffer.allocUnsafe(e),n=0,i=0;i<t.length;++i){var a=t[i];if(!internalIsBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,n),n+=a.length}return r},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function(){var t=0|this.length;return 0==t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!internalIsBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",e=INSPECT_MAX_BYTES;return 0<this.length&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t,e,r,n,i){if(!internalIsBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=e)return 0;if(i<=n)return-1;if(r<=e)return 1;if(this===t)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0),s=Math.min(a,o),u=this.slice(n,i),l=t.slice(e,r),h=0;h<s;++h)if(u[h]!==l[h]){a=u[h],o=l[h];break}return a<o?-1:o<a?1:0},Buffer.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},Buffer.prototype.indexOf=function(t,e,r){return bidirectionalIndexOf(this,t,e,r,!0)},Buffer.prototype.lastIndexOf=function(t,e,r){return bidirectionalIndexOf(this,t,e,r,!1)},Buffer.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||i<r)&&(r=i),0<t.length&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var a=!1;;)switch(n){case"hex":return hexWrite(this,t,e,r);case"utf8":case"utf-8":return utf8Write(this,t,e,r);case"ascii":return asciiWrite(this,t,e,r);case"latin1":case"binary":return latin1Write(this,t,e,r);case"base64":return base64Write(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(t){var e=t.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function latin1Slice(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function hexSlice(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||n<r)&&(r=n);for(var i="",a=e;a<r;++a)i+=toHex(t[a]);return i}function utf16leSlice(t,e,r){for(var n=t.slice(e,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function checkOffset(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,r,n,i,a){if(!internalIsBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<e||e<a)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,a=Math.min(t.length-r,2);i<a;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,a=Math.min(t.length-r,4);i<a;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function checkIEEE754(t,e,r,n,i,a){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(t,e,r,n,i){return i||checkIEEE754(t,e,r,4),write(t,e,r,n,23,4),r+4}function writeDouble(t,e,r,n,i){return i||checkIEEE754(t,e,r,8),write(t,e,r,n,52,8),r+8}Buffer.prototype.slice=function(t,e){var r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),e<t&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=Buffer.prototype;else for(var n=e-t,i=new Buffer(n,void 0),a=0;a<n;++a)i[a]=this[a+t];return i},Buffer.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n},Buffer.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t+--e],i=1;0<e&&(i*=256);)n+=this[t+--e]*i;return n},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*e)),n},Buffer.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=e,i=1,a=this[t+--n];0<n&&(i*=256);)a+=this[t+--n]*i;return(i*=128)<=a&&(a-=Math.pow(2,8*e)),a},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,e,r,n){t=+t,e|=0,r|=0,n||checkInt(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[e]=255&t;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r},Buffer.prototype.writeUIntBE=function(t,e,r,n){t=+t,e|=0,r|=0,n||checkInt(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[e+i]=255&t;0<=--i&&(a*=256);)this[e+i]=t/a&255;return e+r},Buffer.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function(t,e,r,n){var i;t=+t,e|=0,n||checkInt(this,t,e,r,(i=Math.pow(2,8*r-1))-1,-i);var a=0,o=1,s=0;for(this[e]=255&t;++a<r&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},Buffer.prototype.writeIntBE=function(t,e,r,n){var i;t=+t,e|=0,n||checkInt(this,t,e,r,(i=Math.pow(2,8*r-1))-1,-i);var a=r-1,o=1,s=0;for(this[e+a]=255&t;0<=--a&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},Buffer.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,r){return writeFloat(this,t,e,!0,r)},Buffer.prototype.writeFloatBE=function(t,e,r){return writeFloat(this,t,e,!1,r)},Buffer.prototype.writeDoubleLE=function(t,e,r){return writeDouble(this,t,e,!0,r)},Buffer.prototype.writeDoubleBE=function(t,e,r){return writeDouble(this,t,e,!1,r)},Buffer.prototype.copy=function(t,e,r,n){if(r=r||0,n||0===n||(n=this.length),e>=t.length&&(e=t.length),e=e||0,0<n&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,a=n-r;if(this===t&&r<e&&e<n)for(i=a-1;0<=i;--i)t[i+e]=this[i+r];else if(a<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+a),e);return a},Buffer.prototype.fill=function(t,e,r,n){if("string"==typeof t){var i;if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1!==t.length||(i=t.charCodeAt(0))<256&&(t=i),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(t=t||0))for(s=e;s<r;++s)this[s]=t;else for(var a=internalIsBuffer(t)?t:utf8ToBytes(new Buffer(t,n).toString()),o=a.length,s=0;s<r-e;++s)this[s+e]=a[s%o];return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(t){if((t=stringtrim(t).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){var r;e=e||1/0;for(var n=t.length,i=null,a=[],o=0;o<n;++o){if(55295<(r=t.charCodeAt(o))&&r<57344){if(!i){if(56319<r){-1<(e-=3)&&a.push(239,191,189);continue}if(o+1===n){-1<(e-=3)&&a.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(e-=3)&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&a.push(239,191,189);if(i=null,r<128){if(--e<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function asciiToBytes(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function utf16leToBytes(t,e){for(var r,n,i,a=[],o=0;o<t.length&&!((e-=2)<0);++o)n=(r=t.charCodeAt(o))>>8,i=r%256,a.push(i),a.push(n);return a}function base64ToBytes(t){return toByteArray(base64clean(t))}function blitBuffer(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function isnan(t){return t!=t}function isBuffer(t){return null!=t&&(!!t._isBuffer||isFastBuffer(t)||isSlowBuffer(t))}function isFastBuffer(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function isSlowBuffer(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&isFastBuffer(t.slice(0,0))}function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var currentQueue,queue$1=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue$1=currentQueue.concat(queue$1):queueIndex=-1,queue$1.length&&drainQueue())}function drainQueue(){if(!draining){var t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue$1.length;e;){for(currentQueue=queue$1,queue$1=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue$1.length}currentQueue=null,draining=!1,runClearTimeout(t)}}function nextTick(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];queue$1.push(new Item(t,e)),1!==queue$1.length||draining||runTimeout(drainQueue)}function Item(t,e){this.fun=t,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};var performance=global$1.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()},inherits="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;function r(){}r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t},inherits$1=inherits,formatRegExp=/%[sdj%]/g;function format(t){if(!isString(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(inspect(arguments[r]));return e.join(" ")}for(var r=1,n=arguments,i=n.length,a=String(t).replace(formatRegExp,function(t){if("%%"===t)return"%";if(i<=r)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}}),o=n[r];r<i;o=n[++r])isNull(o)||!isObject$1(o)?a+=" "+o:a+=" "+inspect(o);return a}function deprecate(t,e){if(isUndefined(global$1.process))return function(){return deprecate(t,e).apply(this,arguments)};var r=!1;return function(){return r||(console.error(e),r=!0),t.apply(this,arguments)}}var debugEnviron,debugs={};function debuglog(e){return isUndefined(debugEnviron)&&(debugEnviron=""),e=e.toUpperCase(),debugs[e]||(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)?debugs[e]=function(){var t=format.apply(null,arguments);console.error("%s %d: %s",e,0,t)}:debugs[e]=function(){}),debugs[e]}function inspect(t,e){var r={seen:[],stylize:stylizeNoColor};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),isBoolean(e)?r.showHidden=e:e&&_extend(r,e),isUndefined(r.showHidden)&&(r.showHidden=!1),isUndefined(r.depth)&&(r.depth=2),isUndefined(r.colors)&&(r.colors=!1),isUndefined(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=stylizeWithColor),formatValue(r,t,r.depth)}function stylizeWithColor(t,e){var r=inspect.styles[e];return r?"["+inspect.colors[r][0]+"m"+t+"["+inspect.colors[r][1]+"m":t}function stylizeNoColor(t,e){return t}function arrayToHash(t){var r={};return t.forEach(function(t,e){r[t]=!0}),r}function formatValue(e,r,n){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==inspect&&(!r.constructor||r.constructor.prototype!==r)){var t=r.inspect(n,e);return isString(t)||(t=formatValue(e,t,n)),t}var i=formatPrimitive(e,r);if(i)return i;var a=Object.keys(r),o=arrayToHash(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(r)),isError(r)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return formatError(r);if(0===a.length){if(isFunction(r)){var s=r.name?": "+r.name:"";return e.stylize("[Function"+s+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var u,l="",h=!1,c=["{","}"];return isArray$2(r)&&(h=!0,c=["[","]"]),isFunction(r)&&(l=" [Function"+(r.name?": "+r.name:"")+"]"),isRegExp(r)&&(l=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(l=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(l=" "+formatError(r)),0!==a.length||h&&0!=r.length?n<0?isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=h?formatArray(e,r,n,o,a):a.map(function(t){return formatProperty(e,r,n,o,t,h)}),e.seen.pop(),reduceToSingleString(u,l,c)):c[0]+l+c[1]}function formatPrimitive(t,e){if(isUndefined(e))return t.stylize("undefined","undefined");if(isString(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return isNumber(e)?t.stylize(""+e,"number"):isBoolean(e)?t.stylize(""+e,"boolean"):isNull(e)?t.stylize("null","null"):void 0}function formatError(t){return"["+Error.prototype.toString.call(t)+"]"}function formatArray(e,r,n,i,t){for(var a=[],o=0,s=r.length;o<s;++o)hasOwnProperty$1(r,String(o))?a.push(formatProperty(e,r,n,i,String(o),!0)):a.push("");return t.forEach(function(t){t.match(/^\d+$/)||a.push(formatProperty(e,r,n,i,t,!0))}),a}function formatProperty(t,e,r,n,i,a){var o,s,u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]};if(u.get?s=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(s=t.stylize("[Setter]","special")),hasOwnProperty$1(n,i)||(o="["+i+"]"),s||(t.seen.indexOf(u.value)<0?-1<(s=isNull(r)?formatValue(t,u.value,null):formatValue(t,u.value,r-1)).indexOf("\n")&&(s=a?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),isUndefined(o)){if(a&&i.match(/^\d+$/))return s;o=(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(o,"string"))}return o+": "+s}function reduceToSingleString(t,e,r){return 60<t.reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}function isArray$2(t){return Array.isArray(t)}function isBoolean(t){return"boolean"==typeof t}function isNull(t){return null===t}function isNumber(t){return"number"==typeof t}function isString(t){return"string"==typeof t}function isUndefined(t){return void 0===t}function isRegExp(t){return isObject$1(t)&&"[object RegExp]"===objectToString$1(t)}function isObject$1(t){return"object"==typeof t&&null!==t}function isDate(t){return isObject$1(t)&&"[object Date]"===objectToString$1(t)}function isError(t){return isObject$1(t)&&("[object Error]"===objectToString$1(t)||t instanceof Error)}function isFunction(t){return"function"==typeof t}function objectToString$1(t){return Object.prototype.toString.call(t)}function _extend(t,e){if(!e||!isObject$1(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}function hasOwnProperty$1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function BufferList(){this.head=null,this.tail=null,this.length=0}inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},BufferList.prototype.push=function(t){var e={data:t,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},BufferList.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r},BufferList.prototype.concat=function(t){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var e=Buffer.allocUnsafe(t>>>0),r=this.head,n=0;r;)r.data.copy(e,n),n+=r.data.length,r=r.next;return e};var isBufferEncoding=Buffer.isEncoding||function(t){switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function assertEncoding(t){if(t&&!isBufferEncoding(t))throw new Error("Unknown encoding: "+t)}function StringDecoder(t){switch(this.encoding=(t||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(t),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0}function passThroughWrite(t){return t.toString(this.encoding)}function utf16DetectIncompleteChar(t){this.charReceived=t.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(t){this.charReceived=t.length%3,this.charLength=this.charReceived?3:0}StringDecoder.prototype.write=function(t){for(var e="";this.charLength;){var r=t.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:t.length;if(t.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(t=t.slice(r,t.length),!(55296<=(i=(e=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(e.length-1))&&i<=56319)){if(this.charReceived=this.charLength=0,0===t.length)return e;break}this.charLength+=this.surrogateSize,e=""}this.detectIncompleteChar(t);var n=t.length;this.charLength&&(t.copy(this.charBuffer,0,t.length-this.charReceived,n),n-=this.charReceived);var i,n=(e+=t.toString(this.encoding,0,n)).length-1;if(55296<=(i=e.charCodeAt(n))&&i<=56319){var a=this.surrogateSize;return this.charLength+=a,this.charReceived+=a,this.charBuffer.copy(this.charBuffer,a,0,a),t.copy(this.charBuffer,0,0,a),e.substring(0,n)}return e},StringDecoder.prototype.detectIncompleteChar=function(t){for(var e=3<=t.length?3:t.length;0<e;e--){var r=t[t.length-e];if(1==e&&r>>5==6){this.charLength=2;break}if(e<=2&&r>>4==14){this.charLength=3;break}if(e<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=e},StringDecoder.prototype.end=function(t){var e,r,n,i="";return t&&t.length&&(i=this.write(t)),this.charReceived&&(e=this.charReceived,r=this.charBuffer,n=this.encoding,i+=r.slice(0,e).toString(n)),i},Readable.ReadableState=ReadableState;var debug=debuglog("stream");function prependListener(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}function listenerCount$1(t,e){return t.listeners(e).length}function ReadableState(t,e){t=t||{},this.objectMode=!!t.objectMode,e instanceof Duplex&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(this.decoder=new StringDecoder(t.encoding),this.encoding=t.encoding)}function Readable(t){if(!(this instanceof Readable))return new Readable(t);this._readableState=new ReadableState(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),EventEmitter.call(this)}function readableAddChunk(t,e,r,n,i){var a,o,s,u=chunkInvalid(e,r);return u?t.emit("error",u):null===r?(e.reading=!1,onEofChunk(t,e)):e.objectMode||r&&0<r.length?e.ended&&!i?(a=new Error("stream.push() after EOF"),t.emit("error",a)):e.endEmitted&&i?(o=new Error("stream.unshift() after end event"),t.emit("error",o)):(!e.decoder||i||n||(r=e.decoder.write(r),s=!e.objectMode&&0===r.length),i||(e.reading=!1),s||(e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,i?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&emitReadable(t))),maybeReadMore(t,e)):i||(e.reading=!1),needMoreData(e)}function needMoreData(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}inherits$1(Readable,EventEmitter),Readable.prototype.push=function(t,e){var r=this._readableState;return r.objectMode||"string"!=typeof t||(e=e||r.defaultEncoding)!==r.encoding&&(t=Buffer.from(t,e),e=""),readableAddChunk(this,r,t,e,!1)},Readable.prototype.unshift=function(t){return readableAddChunk(this,this._readableState,t,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){return this._readableState.decoder=new StringDecoder(t),this._readableState.encoding=t,this};var MAX_HWM=8388608;function computeNewHighWaterMark(t){return MAX_HWM<=t?t=MAX_HWM:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function howMuchToRead(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=computeNewHighWaterMark(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function chunkInvalid(t,e){var r=null;return isBuffer(e)||"string"==typeof e||null==e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}function onEofChunk(t,e){var r;e.ended||(!e.decoder||(r=e.decoder.end())&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length),e.ended=!0,emitReadable(t))}function emitReadable(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(debug("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?nextTick(emitReadable_,t):emitReadable_(t))}function emitReadable_(t){debug("emit readable"),t.emit("readable"),flow(t)}function maybeReadMore(t,e){e.readingMore||(e.readingMore=!0,nextTick(maybeReadMore_,t,e))}function maybeReadMore_(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(debug("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;debug("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,flow(e))}}function nReadingNextTick(t){debug("readable nexttick read 0"),t.read(0)}function resume(t,e){e.resumeScheduled||(e.resumeScheduled=!0,nextTick(resume_,t,e))}function resume_(t,e){e.reading||(debug("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),flow(t),e.flowing&&!e.reading&&t.read(0)}function flow(t){var e=t._readableState;for(debug("flow",e.flowing);e.flowing&&null!==t.read(););}function fromList(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=fromListPartial(t,e.buffer,e.decoder),r);var r}function fromListPartial(t,e,r){var n;return t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():(r?copyFromBufferString:copyFromBuffer)(t,e),n}function copyFromBufferString(t,e){var r=e.head,n=1,i=r.data;for(t-=i.length;r=r.next;){var a=r.data,o=t>a.length?a.length:t;if(o===a.length?i+=a:i+=a.slice(0,t),0===(t-=o)){o===a.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r).data=a.slice(o);break}++n}return e.length-=n,i}function copyFromBuffer(t,e){var r=Buffer.allocUnsafe(t),n=e.head,i=1;for(n.data.copy(r),t-=n.data.length;n=n.next;){var a=n.data,o=t>a.length?a.length:t;if(a.copy(r,r.length-t,0,o),0===(t-=o)){o===a.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n).data=a.slice(o);break}++i}return e.length-=i,r}function endReadable(t){var e=t._readableState;if(0<e.length)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,nextTick(endReadableNT,e,t))}function endReadableNT(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function forEach(t,e){for(var r=0,n=t.length;r<n;r++)e(t[r],r)}function indexOf$1(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function nop(){}function WriteReq(t,e,r){this.chunk=t,this.encoding=e,this.callback=r,this.next=null}function WritableState(t,e){Object.defineProperty(this,"buffer",{get:deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),t=t||{},this.objectMode=!!t.objectMode,e instanceof Duplex&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1;var i=(this.finished=!1)===t.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){onwrite(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){if(!(this instanceof Writable||this instanceof Duplex))return new Writable(t);this._writableState=new WritableState(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),EventEmitter.call(this)}function writeAfterEnd(t,e){var r=new Error("write after end");t.emit("error",r),nextTick(e,r)}function validChunk(t,e,r,n){var i=!0,a=!1;return null===r?a=new TypeError("May not write null values to stream"):Buffer.isBuffer(r)||"string"==typeof r||void 0===r||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),nextTick(n,a),i=!1),i}function decodeChunk(t,e,r){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=Buffer.from(e,r)),e}function writeOrBuffer(t,e,r,n,i){r=decodeChunk(e,r,n),Buffer.isBuffer(r)&&(n="buffer");var a=e.objectMode?1:r.length;e.length+=a;var o,s=e.length<e.highWaterMark;return s||(e.needDrain=!0),e.writing||e.corked?(o=e.lastBufferedRequest,e.lastBufferedRequest=new WriteReq(r,n,i),o?o.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1):doWrite(t,e,!1,a,r,n,i),s}function doWrite(t,e,r,n,i,a,o){e.writelen=n,e.writecb=o,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,a,e.onwrite),e.sync=!1}function onwriteError(t,e,r,n,i){--e.pendingcb,r?nextTick(i,n):i(n),t._writableState.errorEmitted=!0,t.emit("error",n)}function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function onwrite(t,e){var r,n=t._writableState,i=n.sync,a=n.writecb;onwriteStateUpdate(n),e?onwriteError(t,n,i,e,a):((r=needFinish(n))||n.corked||n.bufferProcessing||!n.bufferedRequest||clearBuffer(t,n),i?nextTick(afterWrite,t,n,r,a):afterWrite(t,n,r,a))}function afterWrite(t,e,r,n){r||onwriteDrain(t,e),e.pendingcb--,n(),finishMaybe(t,e)}function onwriteDrain(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function clearBuffer(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),a=e.corkedRequestsFree;a.entry=r;for(var o=0;r;)r=(i[o]=r).next,o+=1;doWrite(t,e,!0,e.length,i,"",a.finish),e.pendingcb++,e.lastBufferedRequest=null,a.next?(e.corkedRequestsFree=a.next,a.next=null):e.corkedRequestsFree=new CorkedRequest(e)}else{for(;r;){var s=r.chunk,u=r.encoding,l=r.callback;if(doWrite(t,e,!1,e.objectMode?1:s.length,s,u,l),r=r.next,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=r,e.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function prefinish(t,e){e.prefinished||(e.prefinished=!0,t.emit("prefinish"))}function finishMaybe(t,e){var r=needFinish(e);return r&&(0===e.pendingcb?(prefinish(t,e),e.finished=!0,t.emit("finish")):prefinish(t,e)),r}function endWritable(t,e,r){e.ending=!0,finishMaybe(t,e),r&&(e.finished?nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function CorkedRequest(n){var i=this;this.next=null,this.entry=null,this.finish=function(t){var e=i.entry;for(i.entry=null;e;){var r=e.callback;n.pendingcb--,r(t),e=e.next}n.corkedRequestsFree?n.corkedRequestsFree.next=i:n.corkedRequestsFree=i}}Readable.prototype.read=function(t){debug("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return debug("read: emitReadable",e.length,e.ended),(0===e.length&&e.ended?endReadable:emitReadable)(this),null;if(0===(t=howMuchToRead(t,e))&&e.ended)return 0===e.length&&endReadable(this),null;var n,i=e.needReadable;return debug("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&debug("length less than watermark",i=!0),e.ended||e.reading?debug("reading or ended",i=!1):i&&(debug("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=howMuchToRead(r,e))),null===(n=0<t?fromList(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&endReadable(this)),null!==n&&this.emit("data",n),n},Readable.prototype._read=function(t){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,debug("pipe count=%d opts=%j",n.pipesCount,t);var i=!t||!1!==t.end?o:l;function a(t){debug("onunpipe"),t===r&&l()}function o(){debug("onend"),e.end()}n.endEmitted?nextTick(i):r.once("end",i),e.on("unpipe",a);var s=pipeOnDrain(r);e.on("drain",s);var u=!1;function l(){debug("cleanup"),e.removeListener("close",f),e.removeListener("finish",d),e.removeListener("drain",s),e.removeListener("error",p),e.removeListener("unpipe",a),r.removeListener("end",o),r.removeListener("end",l),r.removeListener("data",c),u=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||s()}var h=!1;function c(t){debug("ondata"),(h=!1)!==e.write(t)||h||((1===n.pipesCount&&n.pipes===e||1<n.pipesCount&&-1!==indexOf$1(n.pipes,e))&&!u&&(debug("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,h=!0),r.pause())}function p(t){debug("onerror",t),y(),e.removeListener("error",p),0===listenerCount$1(e,"error")&&e.emit("error",t)}function f(){e.removeListener("finish",d),y()}function d(){debug("onfinish"),e.removeListener("close",f),y()}function y(){debug("unpipe"),r.unpipe(e)}return r.on("data",c),prependListener(e,"error",p),e.once("close",f),e.once("finish",d),e.emit("pipe",r),n.flowing||(debug("pipe resume"),r.resume()),e},Readable.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t=t||e.pipes,e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this)),this;if(!t){var r=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var i=0;i<n;i++)r[i].emit("unpipe",this);return this}var a=indexOf$1(e.pipes,t);return-1===a||(e.pipes.splice(a,1),--e.pipesCount,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this)),this},Readable.prototype.on=function(t,e){var r,n=EventEmitter.prototype.on.call(this,t,e);return"data"===t?!1!==this._readableState.flowing&&this.resume():"readable"===t&&((r=this._readableState).endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&emitReadable(this):nextTick(nReadingNextTick,this))),n},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(debug("resume"),t.flowing=!0,resume(this,t)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(e){var r=this._readableState,n=!1,i=this;for(var t in e.on("end",function(){var t;debug("wrapped end"),!r.decoder||r.ended||(t=r.decoder.end())&&t.length&&i.push(t),i.push(null)}),e.on("data",function(t){debug("wrapped data"),r.decoder&&(t=r.decoder.write(t)),r.objectMode&&null==t||(r.objectMode||t&&t.length)&&(i.push(t)||(n=!0,e.pause()))}),e)void 0===this[t]&&"function"==typeof e[t]&&(this[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t));return forEach(["error","close","destroy","pause","resume"],function(t){e.on(t,i.emit.bind(i,t))}),i._read=function(t){debug("wrapped _read",t),n&&(n=!1,e.resume())},i},Readable._fromList=fromList,Writable.WritableState=WritableState,inherits$1(Writable,EventEmitter),WritableState.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(t,e,r){var n=this._writableState,i=!1;return"function"==typeof e&&(r=e,e=null),e=Buffer.isBuffer(t)?"buffer":e||n.defaultEncoding,"function"!=typeof r&&(r=nop),n.ended?writeAfterEnd(this,r):validChunk(this,n,t,r)&&(n.pendingcb++,i=writeOrBuffer(this,n,t,e,r)),i},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Writable.prototype._write=function(t,e,r){r(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,e=t=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||endWritable(this,n,r)},inherits$1(Duplex,Readable);for(var keys$3=Object.keys(Writable.prototype),v=0;v<keys$3.length;v++){var method=keys$3[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);Readable.call(this,t),Writable.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||nextTick(onEndNT,this)}function onEndNT(t){t.end()}function TransformState(r){this.afterTransform=function(t,e){return afterTransform(r,t,e)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function afterTransform(t,e,r){var n=t._transformState;n.transforming=!1;var i=n.writecb;if(!i)return t.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,(n.writecb=null)!=r&&t.push(r),i(e);var a=t._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&t._read(a.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);Duplex.call(this,t),this._transformState=new TransformState(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(t){done(e,t)}):done(e)})}function done(t,e){if(e)return t.emit("error",e);var r=t._writableState,n=t._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);Transform.call(this,t)}function Stream(){EventEmitter.call(this)}inherits$1(Transform,Duplex),Transform.prototype.push=function(t,e){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,t,e)},Transform.prototype._transform=function(t,e,r){throw new Error("Not implemented")},Transform.prototype._write=function(t,e,r){var n,i=this._transformState;i.writecb=r,i.writechunk=t,i.writeencoding=e,i.transforming||(n=this._readableState,(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark))},Transform.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},inherits$1(PassThrough,Transform),PassThrough.prototype._transform=function(t,e,r){r(null,t)},inherits$1(Stream,EventEmitter),Stream.Readable=Readable,Stream.Writable=Writable,Stream.Duplex=Duplex,Stream.Transform=Transform,Stream.PassThrough=PassThrough,(Stream.Stream=Stream).prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",o),r.on("close",s));var a=!1;function o(){a||(a=!0,e.end())}function s(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function u(t){if(l(),0===EventEmitter.listenerCount(this,"error"))throw t}function l(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",o),r.removeListener("close",s),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",l),r.removeListener("close",l),e.removeListener("close",l)}return r.on("error",u),e.on("error",u),r.on("end",l),r.on("close",l),e.on("close",l),e.emit("pipe",r),e};var Writable$1=Stream.Writable,TrainStream=function(){_inherits(a,Writable$1);var i=_createSuper(a);function a(t){var e;if(_classCallCheck(this,a),e=i.call(this,{objectMode:!0}),!(t=t||{}).neuralNetwork)throw new Error("No neural network specified. PLease see lis of available networks types: https://github.com/BrainJS/brain.js#neural-network-types");var r=t.neuralNetwork;e.neuralNetwork=r,e.dataFormatDetermined=!1,e.i=0,e.size=0,e.count=0,e.sum=0,e.floodCallback=t.floodCallback,e.doneTrainingCallback=t.doneTrainingCallback,r.updateTrainingOptions(t);var n=r.trainOpts;return e.iterations=n.iterations,e.errorThresh=n.errorThresh,e.log=n.log,e.logPeriod=n.logPeriod,e.callbackPeriod=n.callbackPeriod,e.callback=n.callback,e.on("finish",e.finishStreamIteration.bind(_assertThisInitialized(e))),e}return _createClass(a,[{key:"endInputs",value:function(){this.write(!1)}},{key:"_write",value:function(t,e,r){if(!t)return this.emit("finish"),r();if(!this.dataFormatDetermined)return this.size++,this.neuralNetwork.addFormat(t),this.firstDatum=this.firstDatum||t,r();this.count++;var n=this.neuralNetwork.formatData(t);this.sum+=this.neuralNetwork.trainPattern(n[0],!0),r()}},{key:"finishStreamIteration",value:function(){if(this.dataFormatDetermined&&this.size!==this.count&&this.log("This iteration's data length was different from the first."),!this.dataFormatDetermined){var t=this.neuralNetwork.formatData(this.firstDatum);return this.neuralNetwork.verifyIsInitialized(t),this.dataFormatDetermined=!0,void("function"==typeof this.floodCallback&&this.floodCallback())}var e=this.sum/this.size;if(this.log&&this.i%this.logPeriod==0&&this.log("iterations: ".concat(this.i,", training error: ").concat(e)),this.callback&&this.i%this.callbackPeriod==0&&this.callback({error:e,iterations:this.i}),this.sum=0,this.count=0,this.i++,this.i<this.iterations&&e>this.errorThresh){if("function"==typeof this.floodCallback)return this.floodCallback()}else if("function"==typeof this.doneTrainingCallback)return this.doneTrainingCallback({error:e,iterations:this.i})}}]),a}(),trainStream=TrainStream,FAILS_ON_PRIMITIVES$1=fails(function(){objectGetPrototypeOf(1)});_export({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$1,sham:!correctPrototypeGetter},{getPrototypeOf:function(t){return objectGetPrototypeOf(toObject(t))}});var Internal$2=types.Internal,release$j=kernel.release,RecurrentConnection=function(){_inherits(e,Internal$2);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"predict",value:function(){}},{key:"compare",value:function(){}},{key:"learn",value:function(){throw new Error("no longer using")}},{key:"setupKernels",value:function(){}},{key:"reuseKernels",value:function(){}},{key:"width",get:function(){return this.layer.width},set:function(){throw new Error("".concat(this.constructor.name,"-width is not yet implemented"))}},{key:"height",get:function(){return this.layer.height},set:function(){throw new Error("".concat(this.constructor.name,"-height is not yet implemented"))}},{key:"deltas",get:function(){return this.layer.deltas},set:function(t){release$j(this.layer.deltas),this.layer.deltas=t}},{key:"weights",get:function(){return this.layer.weights},set:function(t){release$j(this.layer.weights),this.layer.weights=t}}]),e}(),recurrentConnection={RecurrentConnection:RecurrentConnection},Internal$3=types.Internal,Base$a=base.Base,release$k=kernel.release,RecurrentInput=function(){_inherits(n,Internal$3);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this)).recurrentInput=t,e.validate(),e}return _createClass(n,[{key:"validate",value:function(){if(Base$a.prototype.validate.call(this),this.width!==this.recurrentInput.width)throw new Error("".concat(this.constructor.name," layer width ").concat(this.width," and ").concat(this.recurrentInput.constructor.name," width (").concat(this.recurrentInput.width,") are not same"));if(this.height!==this.recurrentInput.height)throw new Error("".concat(this.constructor.name," layer height ").concat(this.height," and ").concat(this.recurrentInput.constructor.name," width (").concat(this.recurrentInput.height,") are not same"))}},{key:"setDimensions",value:function(){throw new Error("should just listen")}},{key:"predict",value:function(){}},{key:"compare",value:function(){}},{key:"learn",value:function(){}},{key:"setupKernels",value:function(){}},{key:"reuseKernels",value:function(){}},{key:"width",get:function(){return this.recurrentInput.width}},{key:"height",get:function(){return this.recurrentInput.height}},{key:"deltas",get:function(){return this.recurrentInput.deltas},set:function(t){var e=this.recurrentInput.deltas;this.recurrentInput.deltas=t,release$k(e)}},{key:"weights",get:function(){return this.recurrentInput.weights},set:function(t){var e=this.recurrentInput.weights;this.recurrentInput.weights=t,release$k(e)}}]),n}(),recurrentInput={RecurrentInput:RecurrentInput},Internal$4=types.Internal,release$l=kernel.release,clear$e=kernel.clear,RecurrentZeros=function(){_inherits(e,Internal$4);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"setDimensions",value:function(t,e){this.praxis=null,this.width=t,this.height=e,this.weights=zeros2d(t,e),this.deltas=zeros2d(t,e)}},{key:"setupKernels",value:function(){}},{key:"reuseKernels",value:function(){}},{key:"predict",value:function(){}},{key:"compare",value:function(){}},{key:"learn",value:function(t,e,r){var n=this.weights;this.weights=this.praxis.run(this,t,e,r),release$l(n),clear$e(this.deltas)}},{key:"validate",value:function(){throw new Error("".concat(this.constructor.name,"-validate is not yet implemented"))}},{key:"reset",value:function(){throw new Error("".concat(this.constructor.name,"-reset is not yet implemented"))}}]),e}();function recurrentZeros(){return new RecurrentZeros}var recurrentZeros_1={RecurrentZeros:RecurrentZeros,recurrentZeros:recurrentZeros},RecurrentConnection$1=recurrentConnection.RecurrentConnection,RecurrentInput$1=recurrentInput.RecurrentInput,RecurrentZeros$1=recurrentZeros_1.RecurrentZeros,Model$5=types.Model,InternalModel$1=types.InternalModel,FeedForward$1=feedForward$2.FeedForward,release$m=kernel.release,clone$6=kernel.clone,Recurrent=function(){_inherits(n,FeedForward$1);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"_connectLayers",value:function(){var t=this.inputLayer(),e=this._connectHiddenLayers(t);return{inputLayer:t,hiddenLayers:e,outputLayer:this.outputLayer(e[e.length-1])}}},{key:"_connectLayersDeep",value:function(){var r=[],n=this._layerSets[this._layerSets.length-1],t=0;function e(t){var e=n.indexOf(t);if(e<0)throw new Error("unable to find layer");return r[e]}function i(t){return _objectSpread2(_objectSpread2({},t),{},{weights:null,deltas:null,errors:null,praxis:null})}for(var a=0;a<n.length;a++){var o=n[a],s=null;switch(Object.getPrototypeOf(o.constructor).name){case"Activation":s=new o.constructor(e(o.inputLayer));break;case"EntryPoint":s=new o.constructor(i(o));break;case"Filter":s=new o.constructor(i(o.inputLayer),e(o.inputLayer));break;case"Internal":var u=n[this._hiddenLayerOutputIndices[t++]];switch(o.constructor.name){case"RecurrentConnection":throw new Error("unfinished");case"RecurrentInput":s=new RecurrentInput$1(u);break;case"RecurrentZeros":default:s=new RecurrentInput$1(u)}break;case"InternalModel":case"Model":s=o;break;case"Modifier":s=new o.constructor(e(o.inputLayer));break;case"Operator":s=new o.constructor(e(o.inputLayer1),e(o.inputLayer2),i(o));break;default:throw new Error("hidden layer ".concat(o.constructor.name," extends unknown hidden layer ").concat(Object.getPrototypeOf(o.constructor).name))}r.push(s)}return r}},{key:"_connectHiddenLayers",value:function(t){for(var e=[],r=0;r<this.hiddenLayers.length;r++){var n=new RecurrentZeros$1,i=this.hiddenLayers[r](t,n,r);t=i,e.push(i)}return e}},{key:"initialize",value:function(){this.layers=[],this._outputConnection=new RecurrentConnection$1;var t=this._connectLayers(),e=t.inputLayer,r=t.hiddenLayers,n=t.outputLayer,i=flattenLayers([e].concat(_toConsumableArray(r),[n]));this._hiddenLayerOutputIndices=r.map(function(t){return i.indexOf(t)}),this._layerSets=[i],this._model=i.filter(function(t){return t instanceof Model$5||t instanceof InternalModel$1}),this.initializeLayers(i)}},{key:"initializeDeep",value:function(){for(var t=this._connectLayersDeep(),e=0;e<t.length;e++){t[e].reuseKernels(this._layerSets[0][e])}this._layerSets.push(t)}},{key:"run",value:function(t){for(;this._layerSets.length<=t.length;)this.initializeDeep();return _get(_getPrototypeOf(n.prototype),"run",this).call(this,t)}},{key:"runInput",value:function(t){for(;this._layerSets.length<t.length;)this.initializeDeep();for(var e=t.length-1,r=0;r<=e;r++){var n=this._layerSets[r];n[0].predict([new Float32Array([t[r]])]);for(var i=1;i<n.length;i++)n[i].predict()}var a=this._layerSets[e],o=a[a.length-1].weights;return this.end(),o}},{key:"end",value:function(){var t=this._layerSets.length-1,e=this._layerSets[t];e[0].predict([new Float32Array([0])]);for(var r=1;r<e.length;r++)e[r].predict()}},{key:"transferData",value:function(t){return t}},{key:"_prepTraining",value:function(t,e){var r=_get(_getPrototypeOf(n.prototype),"_prepTraining",this).call(this,t,e);return this.verifyIsInitialized(t),r}},{key:"_calculateTrainingError",value:function(t){for(var e=new Float32Array(1),r=0;r<t.length;++r){var n=e,i=this._trainPattern(t[r],!0),e=this.meanSquaredError.add(e,i);release$m(i),release$m(n)}var a=this.meanSquaredError.divide(t.length,e);return release$m(e),a.toArray?a.toArray()[0]:a[0]}},{key:"formatData",value:function(t){return t}},{key:"_calculateDeltas",value:function(t){for(var e=this._layerSets[this._layerSets.length-1],r=e.length-2;0<=r;r--)e[r].compare();for(var n=t.length-2;0<=n;n--){var i=this._layerSets[n];i[i.length-1].compare(new Float32Array([t[n+1]]));for(var a=i.length-2;0<=a;a--)i[a].compare()}}},{key:"adjustWeights",value:function(){for(var t=this._model,e=0;e<t.length;e++)t[e].learn()}},{key:"_trainPatterns",value:function(t){for(var e=0;e<t.length;++e)this._trainPattern(t[e],!1)}},{key:"_trainPattern",value:function(t,e){if(this.runInput(t),this._calculateDeltas(t),this.adjustWeights(),e){for(var r=this.meanSquaredError,n=new Float32Array(1),i=0,a=t.length-1;i<a;i++){var o=this._layerSets[i],s=o[o.length-1],u=n,n=r.addAbsolute(u,s.errors);release$m(u)}return clone$6(r.divide(t.length,n))}return null}}],[{key:"structure",get:function(){return{_inputLayers:null,_hiddenLayers:null,_hiddenLayerSets:null,_layerSets:null,_hiddenLayerOutputIndices:null,_outputLayers:null,_outputConnection:null,_previousInputs:null,_model:null,_recurrentIndices:null}}}]),n}(),recurrent={Recurrent:Recurrent},regexpFlags=function(){var t=anObject(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};function RE(t,e){return RegExp(t,e)}var UNSUPPORTED_Y=fails(function(){var t=RE("a","y");return t.lastIndex=2,null!=t.exec("abcd")}),BROKEN_CARET=fails(function(){var t=RE("^r","gy");return t.lastIndex=2,null!=t.exec("str")}),regexpStickyHelpers={UNSUPPORTED_Y:UNSUPPORTED_Y,BROKEN_CARET:BROKEN_CARET},nativeExec=RegExp.prototype.exec,nativeReplace=String.prototype.replace,patchedExec=nativeExec,UPDATES_LAST_INDEX_WRONG=function(){var t=/a/,e=/b*/g;return nativeExec.call(t,"a"),nativeExec.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),UNSUPPORTED_Y$1=regexpStickyHelpers.UNSUPPORTED_Y||regexpStickyHelpers.BROKEN_CARET,NPCG_INCLUDED=void 0!==/()??/.exec("")[1],PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED||UNSUPPORTED_Y$1;PATCH&&(patchedExec=function(t){var e,r,n,i,a=this,o=UNSUPPORTED_Y$1&&a.sticky,s=regexpFlags.call(a),u=a.source,l=0,h=t;return o&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),h=String(t).slice(a.lastIndex),0<a.lastIndex&&(!a.multiline||a.multiline&&"\n"!==t[a.lastIndex-1])&&(u="(?: "+u+")",h=" "+h,l++),r=new RegExp("^(?:"+u+")",s)),NPCG_INCLUDED&&(r=new RegExp("^"+u+"$(?!\\s)",s)),UPDATES_LAST_INDEX_WRONG&&(e=a.lastIndex),n=nativeExec.call(o?r:a,h),o?n?(n.input=n.input.slice(l),n[0]=n[0].slice(l),n.index=a.lastIndex,a.lastIndex+=n[0].length):a.lastIndex=0:UPDATES_LAST_INDEX_WRONG&&n&&(a.lastIndex=a.global?n.index+n[0].length:e),NPCG_INCLUDED&&n&&1<n.length&&nativeReplace.call(n[0],r,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(n[i]=void 0)}),n});var regexpExec=patchedExec;_export({target:"RegExp",proto:!0,forced:/./.exec!==regexpExec},{exec:regexpExec});var TO_STRING="toString",RegExpPrototype=RegExp.prototype,nativeToString=RegExpPrototype[TO_STRING],NOT_GENERIC=fails(function(){return"/a/b"!=nativeToString.call({source:"a",flags:"b"})}),INCORRECT_NAME=nativeToString.name!=TO_STRING;(NOT_GENERIC||INCORRECT_NAME)&&redefine(RegExp.prototype,TO_STRING,function(){var t=anObject(this),e=String(t.source),r=t.flags;return"/"+e+"/"+String(void 0===r&&t instanceof RegExp&&!("flags"in RegExpPrototype)?regexpFlags.call(t):r)},{unsafe:!0});var SPECIES$6=wellKnownSymbol("species"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}),REPLACE_KEEPS_$0="$0"==="a".replace(/./,"$0"),REPLACE=wellKnownSymbol("replace"),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE=!!/./[REPLACE]&&""===/./[REPLACE]("a","$0"),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=!fails(function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var r="ab".split(t);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}),fixRegexpWellKnownSymbolLogic=function(r,t,e,n){var a,i,o,s,u=wellKnownSymbol(r),l=!fails(function(){var t={};return t[u]=function(){return 7},7!=""[r](t)}),h=l&&!fails(function(){var t=!1,e=/a/;return"split"===r&&((e={constructor:{}}).constructor[SPECIES$6]=function(){return e},e.flags="",e[u]=/./[u]),e.exec=function(){return t=!0,null},e[u](""),!t});l&&h&&("replace"!==r||REPLACE_SUPPORTS_NAMED_GROUPS&&REPLACE_KEEPS_$0&&!REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE)&&("split"!==r||SPLIT_WORKS_WITH_OVERWRITTEN_EXEC)||(a=/./[u],o=(i=e(u,""[r],function(t,e,r,n,i){return e.exec===regexpExec?l&&!i?{done:!0,value:a.call(e,r,n)}:{done:!0,value:t.call(r,e,n)}:{done:!1}},{REPLACE_KEEPS_$0:REPLACE_KEEPS_$0,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE}))[0],s=i[1],redefine(String.prototype,r,o),redefine(RegExp.prototype,u,2==t?function(t,e){return s.call(t,this,e)}:function(t){return s.call(t,this)})),n&&createNonEnumerableProperty(RegExp.prototype[u],"sham",!0)},charAt$1=stringMultibyte.charAt,advanceStringIndex=function(t,e,r){return e+(r?charAt$1(t,e).length:1)},regexpExecAbstract=function(t,e){var r=t.exec;if("function"==typeof r){var n=r.call(t,e);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==classofRaw(t))throw TypeError("RegExp#exec called on incompatible receiver");return regexpExec.call(t,e)},max$4=Math.max,min$5=Math.min,floor$3=Math.floor,SUBSTITUTION_SYMBOLS=/\$([$&'`]|\d\d?|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&'`]|\d\d?)/g,maybeToString=function(t){return void 0===t?t:String(t)};fixRegexpWellKnownSymbolLogic("replace",2,function(i,b,k,t){var $=t.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,S=t.REPLACE_KEEPS_$0,_=$?"$":"$0";return[function(t,e){var r=requireObjectCoercible(this),n=null==t?void 0:t[i];return void 0!==n?n.call(t,r,e):b.call(String(r),t,e)},function(t,e){if(!$&&S||"string"==typeof e&&-1===e.indexOf(_)){var r=k(b,t,this,e);if(r.done)return r.value}var n=anObject(t),i=String(this),a="function"==typeof e;a||(e=String(e));var o,s=n.global;s&&(o=n.unicode,n.lastIndex=0);for(var u=[];;){var l=regexpExecAbstract(n,i);if(null===l)break;if(u.push(l),!s)break;""===String(l[0])&&(n.lastIndex=advanceStringIndex(i,toLength(n.lastIndex),o))}for(var h="",c=0,p=0;p<u.length;p++){l=u[p];for(var f=String(l[0]),d=max$4(min$5(toInteger(l.index),i.length),0),y=[],g=1;g<l.length;g++)y.push(maybeToString(l[g]));var m,v=l.groups,w=a?(m=[f].concat(y,d,i),void 0!==v&&m.push(v),String(e.apply(void 0,m))):E(f,i,d,y,v,e);c<=d&&(h+=i.slice(c,d)+w,c=d+f.length)}return h+i.slice(c)}];function E(a,o,s,u,l,t){var h=s+a.length,c=u.length,e=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==l&&(l=toObject(l),e=SUBSTITUTION_SYMBOLS),b.call(t,e,function(t,e){var r;switch(e.charAt(0)){case"$":return"$";case"&":return a;case"`":return o.slice(0,s);case"'":return o.slice(h);case"<":r=l[e.slice(1,-1)];break;default:var n=+e;if(0==n)return t;if(c<n){var i=floor$3(n/10);return 0===i?t:i<=c?void 0===u[i-1]?e.charAt(1):u[i-1]+e.charAt(1):t}r=u[n-1]}return void 0===r?"":r})}});var MATCH=wellKnownSymbol("match"),isRegexp=function(t){var e;return isObject(t)&&(void 0!==(e=t[MATCH])?!!e:"RegExp"==classofRaw(t))},arrayPush=[].push,min$6=Math.min,MAX_UINT32=4294967295,SUPPORTS_Y=!fails(function(){return!RegExp(MAX_UINT32,"y")});fixRegexpWellKnownSymbolLogic("split",2,function(i,g,m){var v="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(t,e){var r=String(requireObjectCoercible(this)),n=void 0===e?MAX_UINT32:e>>>0;if(0===n)return[];if(void 0===t)return[r];if(!isRegexp(t))return g.call(r,t,n);for(var i,a,o,s=[],u=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),l=0,h=new RegExp(t.source,u+"g");(i=regexpExec.call(h,r))&&!(l<(a=h.lastIndex)&&(s.push(r.slice(l,i.index)),1<i.length&&i.index<r.length&&arrayPush.apply(s,i.slice(1)),o=i[0].length,l=a,s.length>=n));)h.lastIndex===i.index&&h.lastIndex++;return l===r.length?!o&&h.test("")||s.push(""):s.push(r.slice(l)),s.length>n?s.slice(0,n):s}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:g.call(this,t,e)}:g;return[function(t,e){var r=requireObjectCoercible(this),n=null==t?void 0:t[i];return void 0!==n?n.call(t,r,e):v.call(String(r),t,e)},function(t,e){var r=m(v,t,this,e,v!==g);if(r.done)return r.value;var n=anObject(t),i=String(this),a=speciesConstructor(n,RegExp),o=n.unicode,s=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(SUPPORTS_Y?"y":"g"),u=new a(SUPPORTS_Y?n:"^(?:"+n.source+")",s),l=void 0===e?MAX_UINT32:e>>>0;if(0===l)return[];if(0===i.length)return null===regexpExecAbstract(u,i)?[i]:[];for(var h=0,c=0,p=[];c<i.length;){u.lastIndex=SUPPORTS_Y?c:0;var f,d=regexpExecAbstract(u,SUPPORTS_Y?i:i.slice(c));if(null===d||(f=min$6(toLength(u.lastIndex+(SUPPORTS_Y?0:c)),i.length))===h)c=advanceStringIndex(i,c,o);else{if(p.push(i.slice(h,c)),p.length===l)return p;for(var y=1;y<=d.length-1;y++)if(p.push(d[y]),p.length===l)return p;c=h=f}}return p.push(i.slice(h)),p}]},!SUPPORTS_Y);var Matrix=function(){function l(t,e){_classCallCheck(this,l),void 0!==t&&void 0!==e&&(this.rows=t,this.columns=e,this.weights=zeros(t*e),this.deltas=zeros(t*e))}return _createClass(l,[{key:"getWeights",value:function(t,e){var r=this.columns*t+e;if(r<0&&r>=this.weights.length)throw new Error("get accessor is skewed");return this.weights[r]}},{key:"setWeight",value:function(t,e,r){var n=this.columns*t+e;if(n<0&&n>=this.weights.length)throw new Error("set accessor is skewed");this.weights[n]=r}},{key:"setDeltas",value:function(t,e,r){var n=this.columns*t+e;if(n<0&&n>=this.weights.length)throw new Error("set accessor is skewed");this.deltas[n]=r}},{key:"toJSON",value:function(){return{rows:this.rows,columns:this.columns,weights:this.weights.slice(0)}}},{key:"weightsToArray",value:function(){for(var t=[],e=0,r=0,n=0;n<this.weights.length;n++)0===r&&t.push([]),t[e].push(this.weights[n]),++r>=this.columns&&(r=0,e++);return t}},{key:"deltasToArray",value:function(){for(var t=[],e=0,r=0,n=0;n<this.deltas.length;n++)0===r&&t.push([]),t[e].push(this.deltas[n]),++r>=this.columns&&(r=0,e++);return t}}],[{key:"fromJSON",value:function(t){for(var e=new l(t.rows,t.columns),r=0,n=t.rows*t.columns;r<n;r++)e.weights[r]=t.weights[r];return e}},{key:"fromArray",value:function(t,e){var r=t.length,n=t[0].length,i=new l(r,n);e=e||t;for(var a=0;a<r;a++)for(var o=t[a],s=e[a],u=0;u<n;u++)i.setWeight(a,u,o[u]),i.setDeltas(a,u,s[u]);return i}}]),l}(),matrix=Matrix,randomFloat$2=random.randomFloat,RandomMatrix=function(){_inherits(s,matrix);var o=_createSuper(s);function s(t,e,r){var n;_classCallCheck(this,s),(n=o.call(this,t,e)).rows=t,n.columns=e,n.std=r;for(var i=0,a=n.weights.length;i<a;i++)n.weights[i]=randomFloat$2(-r,r);return n}return s}(),randomMatrix=RandomMatrix,log$1=Math.log,LN2$1=Math.LN2;_export({target:"Math",stat:!0},{log2:function(t){return log$1(t)/LN2$1}});var cloneNegative=function(t,e){t.rows=parseInt(e.rows,10),t.columns=parseInt(e.columns,10),t.weights=e.weights.slice(0),t.deltas=e.deltas.slice(0);for(var r=0;r<e.weights.length;r++)t.weights[r]=-e.weights[r],t.deltas[r]=0},add$8=function(t,e,r){for(var n=0;n<e.weights.length;n++)t.weights[n]=e.weights[n]+r.weights[n],t.deltas[n]=0},addB=function(t,e,r){for(var n=0;n<t.deltas.length;n++)e.deltas[n]=t.deltas[n],r.deltas[n]=t.deltas[n]},allOnes=function(t){for(var e=0;e<t.weights.length;e++)t.weights[e]=1,t.deltas[e]=0},multiply$8=function(t,e,r){for(var n=e.rows,i=e.columns,a=r.columns,o=0;o<n;o++)for(var s=i*o,u=a*o,l=0;l<a;l++){for(var h=0,c=0;c<i;c++){var p=s+c,f=a*c+l;h+=e.weights[p]*r.weights[f],e.deltas[p]=0,r.deltas[f]=0}t.weights[u+l]=h}},multiplyB=function(t,e,r){for(var n=e.rows,i=e.columns,a=r.columns,o=0;o<n;o++)for(var s=i*o,u=a*o,l=0;l<a;l++)for(var h=0;h<i;h++){var c=s+h,p=a*h+l,f=t.deltas[u+l];e.deltas[c]+=r.weights[p]*f,r.deltas[p]+=e.weights[c]*f}},multiplyElement$4=function(t,e,r){for(var n=e.weights,i=0;i<n.length;i++)t.weights[i]=e.weights[i]*r.weights[i],t.deltas[i]=0},multiplyElementB=function(t,e,r){for(var n=0;n<e.weights.length;n++)e.deltas[n]=r.weights[n]*t.deltas[n],r.deltas[n]=e.weights[n]*t.deltas[n]},relu$4=function(t,e){for(var r=0;r<e.weights.length;r++)t.weights[r]=Math.max(0,e.weights[r]),t.deltas[r]=0},reluB=function(t,e){for(var r=0;r<t.deltas.length;r++)e.deltas[r]=0<e.weights[r]?t.deltas[r]:0},rowPluck=function(t,e,r){for(var n=e.columns,i=n*r,a=0;a<n;a++)t.weights[a]=e.weights[i+a],t.deltas[a]=0},rowPluckB=function(t,e,r){for(var n=e.columns,i=n*r,a=0;a<n;a++)e.deltas[i+a]=t.deltas[a]},sigmoid$7=function(t,e){for(var r=0;r<e.weights.length;r++)t.weights[r]=1/(1+Math.exp(-e.weights[r])),t.deltas[r]=0},sigmoidB=function(t,e){for(var r=0;r<t.deltas.length;r++){var n=t.weights[r];e.deltas[r]=n*(1-n)*t.deltas[r]}},tanh$5=function(t,e){for(var r=0;r<e.weights.length;r++)t.weights[r]=Math.tanh(e.weights[r]),t.deltas[r]=0},tanhB=function(t,e){for(var r=0;r<t.deltas.length;r++){var n=t.weights[r];e.deltas[r]=(1-n*n)*t.deltas[r]}},softmax=function(t){for(var e=new matrix(t.rows,t.columns),r=-999999,n=0;n<t.weights.length;n++)t.weights[n]>r&&(r=t.weights[n]);for(var i=0,a=0;a<t.weights.length;a++)e.weights[a]=Math.exp(t.weights[a]-r),i+=e.weights[a];for(var o=0;o<t.weights.length;o++)e.weights[o]/=i;return e},Equation=function(){function t(){_classCallCheck(this,t),this.inputRow=0,this.inputValue=null,this.states=[]}return _createClass(t,[{key:"add",value:function(t,e){if(t.weights.length!==e.weights.length)throw new Error("misaligned matrices");var r=new matrix(t.rows,t.columns);return this.states.push({left:t,right:e,product:r,forwardFn:add$8,backpropagationFn:addB}),r}},{key:"allOnes",value:function(t,e){var r=new matrix(t,e);return this.states.push({left:r,product:r,forwardFn:allOnes}),r}},{key:"cloneNegative",value:function(t){var e=new matrix(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:cloneNegative}),e}},{key:"subtract",value:function(t,e){if(t.weights.length!==e.weights.length)throw new Error("misaligned matrices");return this.add(this.add(this.allOnes(t.rows,t.columns),this.cloneNegative(t)),e)}},{key:"multiply",value:function(t,e){if(t.columns!==e.rows)throw new Error("misaligned matrices");var r=new matrix(t.rows,e.columns);return this.states.push({left:t,right:e,product:r,forwardFn:multiply$8,backpropagationFn:multiplyB}),r}},{key:"multiplyElement",value:function(t,e){if(t.weights.length!==e.weights.length)throw new Error("misaligned matrices");var r=new matrix(t.rows,t.columns);return this.states.push({left:t,right:e,product:r,forwardFn:multiplyElement$4,backpropagationFn:multiplyElementB}),r}},{key:"relu",value:function(t){var e=new matrix(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:relu$4,backpropagationFn:reluB}),e}},{key:"input",value:function(e){var r=this;return this.states.push({product:e,forwardFn:function(t){t.weights=e.weights=r.inputValue}}),e}},{key:"inputMatrixToRow",value:function(t){var e=this,r=new matrix(t.columns,1);return this.states.push({left:t,get right(){return e.inputRow},product:r,forwardFn:rowPluck,backpropagationFn:rowPluckB}),r}},{key:"sigmoid",value:function(t){var e=new matrix(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:sigmoid$7,backpropagationFn:sigmoidB}),e}},{key:"tanh",value:function(t){var e=new matrix(t.rows,t.columns);return this.states.push({left:t,product:e,forwardFn:tanh$5,backpropagationFn:tanhB}),e}},{key:"observe",value:function(t){return this.states.push({forwardFn:function(){},backpropagationFn:function(){}}),t}},{key:"runIndex",value:function(t){var e,r=0<arguments.length&&void 0!==t?t:0;this.inputRow=r;for(var n=0,i=this.states.length;n<i;n++)(e=this.states[n]).hasOwnProperty("forwardFn")&&e.forwardFn(e.product,e.left,e.right);return e.product}},{key:"runInput",value:function(t){var e;this.inputValue=t;for(var r=0,n=this.states.length;r<n;r++)(e=this.states[r]).hasOwnProperty("forwardFn")&&e.forwardFn(e.product,e.left,e.right);return e.product}},{key:"backpropagate",value:function(){for(var t,e=this.states.length;0<e--;)(t=this.states[e]).hasOwnProperty("backpropagationFn")&&t.backpropagationFn(t.product,t.left,t.right);return t.product}},{key:"backpropagateIndex",value:function(t){var e=0<arguments.length&&void 0!==t?t:0;this.inputRow=e;for(var r,n=this.states.length;0<n--;)(r=this.states[n]).hasOwnProperty("backpropagationFn")&&r.backpropagationFn(r.product,r.left,r.right);return r.product}},{key:"predictTarget",value:function(t,e){for(var r=this.runInput(t),n=0,i=0;i<r.weights.length;i++){var a=r.weights[i]-e[i];n+=Math.abs(a),r.deltas[i]=a}return n}},{key:"predictTargetIndex",value:function(t,e){var r=this.runIndex(t),n=r,i=softmax(r);return n.deltas=i.weights.slice(0),--n.deltas[e],-Math.log2(i.weights[e])}}]),t}(),equation=Equation,randomFloat$3=random.randomFloat,sampleI=function(t){for(var e=randomFloat$3(0,1),r=0,n=0,i=t.weights;;){if(e<(r+=i[n]))return n;n++}},maxI=function(t){for(var e=t.weights,r=e[0],n=0,i=1;i<e.length;i++){var a=e[i];a<r||(n=i,r=a)}return n},copy=function(t,e){t.rows=parseInt(e.rows,10),t.columns=parseInt(e.columns,10),t.weights=e.weights.slice(0),t.deltas=e.deltas.slice(0)},freezing=!fails(function(){return Object.isExtensible(Object.preventExtensions({}))}),internalMetadata=createCommonjsModule(function(t){function r(t){e(t,n,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=objectDefineProperty.f,n=uid("meta"),i=0,a=Object.isExtensible||function(){return!0},o=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!isObject(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!has(t,n)){if(!a(t))return"F";if(!e)return"E";r(t)}return t[n].objectID},getWeakData:function(t,e){if(!has(t,n)){if(!a(t))return!0;if(!e)return!1;r(t)}return t[n].weakData},onFreeze:function(t){return freezing&&o.REQUIRED&&a(t)&&!has(t,n)&&r(t),t}};hiddenKeys[n]=!0}),internalMetadata_1=internalMetadata.REQUIRED,internalMetadata_2=internalMetadata.fastKey,internalMetadata_3=internalMetadata.getWeakData,internalMetadata_4=internalMetadata.onFreeze,collection=function(n,t,e){function r(t){var r=f[t];redefine(f,t,"add"==t?function(t){return r.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(h&&!isObject(t))&&r.call(this,0===t?0:t)}:"get"==t?function(t){return h&&!isObject(t)?void 0:r.call(this,0===t?0:t)}:"has"==t?function(t){return!(h&&!isObject(t))&&r.call(this,0===t?0:t)}:function(t,e){return r.call(this,0===t?0:t,e),this})}var i,a,o,s,u,l=-1!==n.indexOf("Map"),h=-1!==n.indexOf("Weak"),c=l?"set":"add",p=global_1[n],f=p&&p.prototype,d=p,y={};return isForced_1(n,"function"!=typeof p||!(h||f.forEach&&!fails(function(){(new p).entries().next()})))?(d=e.getConstructor(t,n,l,c),internalMetadata.REQUIRED=!0):isForced_1(n,!0)&&(a=(i=new d)[c](h?{}:-0,1)!=i,o=fails(function(){i.has(1)}),s=checkCorrectnessOfIteration(function(t){new p(t)}),u=!h&&fails(function(){for(var t=new p,e=5;e--;)t[c](e,e);return!t.has(-0)}),s||(((d=t(function(t,e){anInstance(t,d,n);var r=inheritIfRequired(new p,t,d);return null!=e&&iterate_1(e,r[c],r,l),r})).prototype=f).constructor=d),(o||u)&&(r("delete"),r("has"),l&&r("get")),(u||a)&&r(c),h&&f.clear&&delete f.clear),y[n]=d,_export({global:!0,forced:d!=p},y),setToStringTag(d,n),h||e.setStrong(d,n,l),d},defineProperty$7=objectDefineProperty.f,fastKey=internalMetadata.fastKey,setInternalState$4=internalState.set,internalStateGetterFor=internalState.getterFor,collectionStrong={getConstructor:function(t,r,n,i){function a(t,e,r){var n,i,a=s(t),o=u(t,e);return o?o.value=r:(a.last=o={index:i=fastKey(e,!0),key:e,value:r,previous:n=a.last,next:void 0,removed:!1},a.first||(a.first=o),n&&(n.next=o),descriptors?a.size++:t.size++,"F"!==i&&(a.index[i]=o)),t}var o=t(function(t,e){anInstance(t,o,r),setInternalState$4(t,{type:r,index:objectCreate(null),first:void 0,last:void 0,size:0}),descriptors||(t.size=0),null!=e&&iterate_1(e,t[i],t,n)}),s=internalStateGetterFor(r),u=function(t,e){var r,n=s(t),i=fastKey(e);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==e)return r};return redefineAll(o.prototype,{clear:function(){for(var t=s(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,descriptors?t.size=0:this.size=0},delete:function(t){var e,r,n=s(this),i=u(this,t);return i&&(e=i.next,r=i.previous,delete n.index[i.index],i.removed=!0,r&&(r.next=e),e&&(e.previous=r),n.first==i&&(n.first=e),n.last==i&&(n.last=r),descriptors?n.size--:this.size--),!!i},forEach:function(t,e){for(var r,n=s(this),i=functionBindContext(t,1<arguments.length?e:void 0,3);r=r?r.next:n.first;)for(i(r.value,r.key,this);r&&r.removed;)r=r.previous},has:function(t){return!!u(this,t)}}),redefineAll(o.prototype,n?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return a(this,0===t?0:t,e)}}:{add:function(t){return a(this,t=0===t?0:t,t)}}),descriptors&&defineProperty$7(o.prototype,"size",{get:function(){return s(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",i=internalStateGetterFor(e),a=internalStateGetterFor(n);defineIterator(t,e,function(t,e){setInternalState$4(this,{type:n,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=a(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?"keys"==e?{value:r.key,done:!1}:"values"==e?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:{value:t.target=void 0,done:!0}},r?"entries":"values",!r,!0),setSpecies(e)}},es_set=collection("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},collectionStrong),ITERATOR$6=wellKnownSymbol("iterator"),TO_STRING_TAG$4=wellKnownSymbol("toStringTag"),ArrayValues=es_array_iterator.values;for(var COLLECTION_NAME$1 in domIterables){var Collection$1=global_1[COLLECTION_NAME$1],CollectionPrototype$1=Collection$1&&Collection$1.prototype;if(CollectionPrototype$1){if(CollectionPrototype$1[ITERATOR$6]!==ArrayValues)try{createNonEnumerableProperty(CollectionPrototype$1,ITERATOR$6,ArrayValues)}catch(t){CollectionPrototype$1[ITERATOR$6]=ArrayValues}if(CollectionPrototype$1[TO_STRING_TAG$4]||createNonEnumerableProperty(CollectionPrototype$1,TO_STRING_TAG$4,COLLECTION_NAME$1),domIterables[COLLECTION_NAME$1])for(var METHOD_NAME in es_array_iterator)if(CollectionPrototype$1[METHOD_NAME]!==es_array_iterator[METHOD_NAME])try{createNonEnumerableProperty(CollectionPrototype$1,METHOD_NAME,es_array_iterator[METHOD_NAME])}catch(t){CollectionPrototype$1[METHOD_NAME]=es_array_iterator[METHOD_NAME]}}}var DataFormatter=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,i),void 0!==t&&(this.values=t,this.indexTable={},this.characterTable={},this.characters=[],this.specialIndexes=[],this.buildCharactersFromIterable(t),this.buildTables(e))}return _createClass(i,[{key:"buildCharactersFromIterable",value:function(t){for(var e={},r=0,n=t.length;r<n;r++){var i=t[r];if(i.hasOwnProperty("length"))for(var a=0,o=i.length;a<o;a++){var s=i[a];e.hasOwnProperty(s)||(e[s]=!0,this.characters.push(s))}else{var u=t[r];if(e.hasOwnProperty(u))continue;e[r]=!0,this.characters.push(u)}}}},{key:"buildTables",value:function(t){for(var e=this.characters.length,r=0;r<e;r++){var n=this.characters[r];t<=r&&(this.indexTable[n]=r,this.characterTable[r]=n)}}},{key:"toIndexes",value:function(t,e){for(var r=1<arguments.length&&void 0!==e?e:0,n=[],i=this.indexTable,a=0,o=t.length;a<o;a++){var s=t[a],u=i[s];if(void 0===u){if(!i.unrecognized)throw new Error('unrecognized character "'.concat(s,'"'));u=i.unrecognized}u<r||n.push(u)}return n}},{key:"toIndexesInputOutput",value:function(t,e,r){var n=1<arguments.length&&void 0!==e?e:null,i=2<arguments.length&&void 0!==r?r:0,a=null,a="string"==typeof t?this.toIndexes(t.split("").concat(["stop-input","start-output"]),i):"number"==typeof t?this.toIndexes(t.toString().split("").concat(["stop-input","start-output"]),i):this.toIndexes(t.concat(["stop-input","start-output"]),i);return null===n?a:"string"==typeof n?a.concat(this.toIndexes(n.split(""),i)):a.concat(this.toIndexes(n,i))}},{key:"toCharacters",value:function(t,e){for(var r=1<arguments.length&&void 0!==e?e:0,n=[],i=this.indexTable,a=this.characterTable,o=0,s=t.length;o<s;o++){var u=t[o];if(!(u<r)){var l=a[u];if(void 0===l){if(!i.unrecognized)throw new Error('unrecognized index "'.concat(u,'"'));l=a[i.unrecognized]}else null!==l&&n.push(l)}}return n}},{key:"toString",value:function(t,e){return this.toCharacters(t,e).join("")}},{key:"addInputOutput",value:function(){this.addSpecial("stop-input"),this.addSpecial("start-output")}},{key:"addUnrecognized",value:function(){this.addSpecial("unrecognized")}},{key:"addSpecial",value:function(t,e){var r=1<arguments.length&&void 0!==e?e:null,n=this.indexTable[t]=this.characters.length;this.characterTable[n]=r,this.specialIndexes.push(this.characters.length),this.characters.push(t)}},{key:"countSpecial",value:function(t){for(var e=0,r=0;r<this.specialIndexes;r++)for(var n=-1;n=-1<t.indexOf(this.specialIndexes[r],n);)e++;return e}},{key:"toFunctionString",value:function(){return"\nvar characterTable = ".concat(JSON.stringify(this.characterTable),";\nvar indexTable = ").concat(JSON.stringify(this.indexTable),";\nvar characters = ").concat(JSON.stringify(this.characters),";\nvar dataFormatter = {\n  ").concat(this.toIndexes.toString(),",\n  ").concat(this.toIndexesInputOutput.toString(),",\n  ").concat(this.toCharacters.toString(),"\n};")}}],[{key:"fromAllPrintable",value:function(t,e){for(var r=1<arguments.length&&void 0!==e?e:["\n"],n=32;n<=126;n++)r.push(String.fromCharCode(n));return new i(r,t)}},{key:"fromAllPrintableInputOutput",value:function(t,e){var r=i.fromAllPrintable(t,1<arguments.length&&void 0!==e?e:["\n"]);return r.addInputOutput(),r}},{key:"fromStringInputOutput",value:function(t,e){var r,n=new i((r=String.prototype).concat.apply(r,_toConsumableArray(new Set(t))),e);return n.addInputOutput(),n}},{key:"fromArrayInputOutput",value:function(t,e){var r=new i(t.filter(function(t,e,r){return r.indexOf(t)===e}),e);return r.addInputOutput(),r}},{key:"fromString",value:function(t,e){var r;return new i((r=String.prototype).concat.apply(r,_toConsumableArray(new Set(t))),e)}},{key:"fromJSON",value:function(t){var e=new i;return e.indexTable=t.indexTable,e.characterTable=t.characterTable,e.values=t.values,e.characters=t.characters,e.specialIndexes=t.specialIndexes,e}}]),i}();function validateAndCast(t){if("string"==typeof t)return t;if("number"==typeof t)return t.toString();if("string"==typeof t[0])return t;if("number"==typeof t[0])return t.map(function(t){return t.toString()});throw new Error("unrecognized value, expected string[], string, number[], or number")}function defaultRNNFormatter(t){if(!("string"==typeof t[0]||Array.isArray(t[0])||t[0].hasOwnProperty("input")&&t[0].hasOwnProperty("output")))return t;var e=[],r=[];if("string"==typeof t[0]||"number"==typeof t[0]||Array.isArray(t[0])){if(!this.dataFormatter){for(var n=0;n<t.length;n++)e.push(validateAndCast(t[n]));this.dataFormatter=new DataFormatter(e),this.dataFormatter.addUnrecognized()}for(var i=0,a=t.length;i<a;i++)r.push(this.formatDataIn(t[i]))}else{if(!t[0].input||!t[0].output)throw new Error("unrecognized data");if(!this.dataFormatter){for(var o=0;o<t.length;o++){var s=t[o];e.push(validateAndCast(s.input),validateAndCast(s.output))}this.dataFormatter=DataFormatter.fromArrayInputOutput(e),this.dataFormatter.addUnrecognized()}for(var u=0,l=t.length;u<l;u++)r.push(this.formatDataIn(validateAndCast(t[u].input),validateAndCast(t[u].output)))}return r}var dataFormatter={DataFormatter:DataFormatter,defaultRNNFormatter:defaultRNNFormatter},randomFloat$4=random.randomFloat,DataFormatter$1=dataFormatter.DataFormatter,defaultRNNFormatter$1=dataFormatter.defaultRNNFormatter,RNN=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,r);var e=this.constructor.defaults;Object.assign(this,e,t),this.trainOpts={},this.updateTrainingOptions(_objectSpread2(_objectSpread2({},this.constructor.trainDefaults),t)),this.stepCache={},this.runs=0,this.ratioClipped=null,this.model=null,this.inputLookup=null,this.inputLookupLength=null,this.outputLookup=null,this.outputLookupLength=null,t.json&&this.fromJSON(t.json)}return _createClass(r,[{key:"initialize",value:function(){this.model={input:null,hiddenLayers:[],output:null,equations:[],allMatrices:[],equationConnections:[],outputConnector:null},this.dataFormatter&&(this.inputSize=this.inputRange=this.outputSize=this.dataFormatter.characters.length),this.mapModel()}},{key:"createHiddenLayers",value:function(){this.model.hiddenLayers.push(this.constructor.getModel(this.hiddenLayers[0],this.inputSize));for(var t=this.hiddenLayers[0],e=1;e<this.hiddenLayers.length;e++){var r=this.hiddenLayers[e];this.model.hiddenLayers.push(this.constructor.getModel(r,t)),t=r}}},{key:"createInputMatrix",value:function(){this.model.input=new randomMatrix(this.inputRange+1,this.inputSize,.08)}},{key:"createOutputMatrix",value:function(){var t=this.model,e=this.outputSize,r=this.hiddenLayers[this.hiddenLayers.length-1];t.outputConnector=new randomMatrix(e+1,r,.08),t.output=new matrix(e+1,1)}},{key:"bindEquation",value:function(){var t=this.model,e=new equation,r=[],n=0<t.equationConnections.length?t.equationConnections[t.equationConnections.length-1]:this.initialLayerInputs,i=this.constructor.getEquation(e,e.inputMatrixToRow(t.input),n[0],t.hiddenLayers[0]);r.push(i);for(var a=1,o=this.hiddenLayers.length;a<o;a++)i=this.constructor.getEquation(e,i,n[a],t.hiddenLayers[a]),r.push(i);t.equationConnections.push(r),e.add(e.multiply(t.outputConnector,i),t.output),t.equations.push(e)}},{key:"mapModel",value:function(){var t=this.model,e=t.hiddenLayers,r=t.allMatrices;if(this.initialLayerInputs=this.hiddenLayers.map(function(t){return new matrix(t,1)}),this.createInputMatrix(),!t.input)throw new Error("net.model.input not set");if(r.push(t.input),this.createHiddenLayers(),!t.hiddenLayers.length)throw new Error("net.hiddenLayers not set");for(var n=0,i=e.length;n<i;n++){var a=e[n];for(var o in a)a.hasOwnProperty(o)&&r.push(a[o])}if(this.createOutputMatrix(),!t.outputConnector)throw new Error("net.model.outputConnector not set");if(!t.output)throw new Error("net.model.output not set");r.push(t.outputConnector),r.push(t.output)}},{key:"trainPattern",value:function(t,e){var r=this.trainInput(t);if(this.backpropagate(t),this.adjustWeights(),e)return r}},{key:"trainInput",value:function(t){this.runs++;for(var e=this.model,r=t.length,n=0;e.equations.length<=t.length+1;)this.bindEquation();for(var i=-1,a=t.length;i<a;i++){var o=i+1,s=e.equations[o],u=-1===i?0:t[i]+1,l=i===r-1?0:t[i+1]+1;n+=s.predictTargetIndex(u,l)}return Math.pow(2,n/(r-1))/100}},{key:"backpropagate",value:function(t){for(var e=t.length,r=this.model.equations;0<e;)r[e].backpropagateIndex(t[e-1]+1),e--;r[0].backpropagateIndex(0)}},{key:"adjustWeights",value:function(){for(var t=this.regc,e=this.clipval,r=this.model,n=this.decayRate,i=this.stepCache,a=this.smoothEps,o=this.trainOpts.learningRate,s=r.allMatrices,u=0,l=0,h=0;h<s.length;h++){var c=s[h],p=c.weights,f=c.deltas;h in i||(i[h]=zeros(c.rows*c.columns));for(var d=i[h],y=0;y<p.length;y++){var g=f[y],m=p[y];d[y]=d[y]*n+(1-n)*g*g,e<g&&(g=e,u++),g<-e&&(g=-e,u++),l++,p[y]=m+-o*g/Math.sqrt(d[y]+a)-t*m}}this.ratioClipped=u/l}},{key:"run",value:function(t,e,r){var n=0<arguments.length&&void 0!==t?t:[],i=1<arguments.length&&void 0!==e&&e,a=2<arguments.length&&void 0!==r?r:1,o=this.maxPredictionLength+n.length+(this.dataFormatter?this.dataFormatter.specialIndexes.length:0);if(!this.isRunnable)return null;for(var s=this.formatDataIn(n),u=this.model,l=[],h=0;;){for(var c=0===h?0:h<s.length?s[h-1]+1:l[h-1];u.equations.length<=h;)this.bindEquation();var p=u.equations[h].runIndex(c),f=new matrix(u.output.rows,u.output.columns);if(copy(f,p),1!==a&&i)for(var d=0,y=f.weights.length;d<y;d++)f.weights[d]/=a;var g=softmax(f),m=(i?sampleI:maxI)(g);if(h++,0===m)break;if(o<=h)break;l.push(m)}return this.formatDataOut(s,l.slice(s.length).map(function(t){return t-1}))}},{key:"verifyIsInitialized",value:function(){this.model||this.initialize()}},{key:"updateTrainingOptions",value:function(e){var r=this;Object.keys(this.constructor.trainDefaults).forEach(function(t){return r.trainOpts[t]=e.hasOwnProperty(t)?e[t]:r.trainOpts[t]}),this.validateTrainingOptions(this.trainOpts),this.setLogMethod(e.log||this.trainOpts.log),this.activation=e.activation||this.activation}},{key:"validateTrainingOptions",value:function(t){neuralNetwork.prototype.validateTrainingOptions.call(this,t)}},{key:"setLogMethod",value:function(t){this.trainOpts.log="function"==typeof t?t:!!t&&console.log}},{key:"prepTraining",value:function(t,e){this.updateTrainingOptions(e),t=this.formatData(t);var r=Date.now()+this.trainOpts.timeout;return this.verifyIsInitialized(t),{data:t,status:{error:1,iterations:0},endTime:r}}},{key:"train",value:function(t,e){var r=1<arguments.length&&void 0!==e?e:{};this.trainOpts=r=_objectSpread2(_objectSpread2({},this.constructor.trainDefaults),r);var n,i=r.iterations,a=r.errorThresh,o=!0===r.log?console.log:r.log,s=r.logPeriod,u=r.callback,l=r.callbackPeriod,h=1/0;for(this.hasOwnProperty("setupData")&&(t=this.setupData(t)),this.verifyIsInitialized(),n=0;n<i&&a<h;n++){for(var c=0,p=0;p<t.length;p++){c+=this.trainPattern(t[p],!0)}if(h=c/t.length,isNaN(h))throw new Error("Network error rate is unexpected NaN, check network configurations and try again. Most probably input format is not correct or training data is not enough. ");o&&n%s==0&&o("iterations: ".concat(n,", training error: ").concat(h)),u&&n%l==0&&u({error:h,iterations:n})}return{error:h,iterations:n}}},{key:"addFormat",value:function(){throw new Error("not yet implemented")}},{key:"toJSON",value:function(){var t=this.constructor.defaults;this.model||this.initialize();var e=this.model,r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=this[n]);return{type:this.constructor.name,options:r,input:e.input.toJSON(),hiddenLayers:e.hiddenLayers.map(function(t){var e={};for(var r in t)e[r]=t[r].toJSON();return e}),outputConnector:this.model.outputConnector.toJSON(),output:this.model.output.toJSON()}}},{key:"fromJSON",value:function(t){var e=this.constructor.defaults,r=t.options;this.model=null,this.hiddenLayers=null;var n=[],i=matrix.fromJSON(t.input);n.push(i);var a=[];(t.hiddenLayers||t.hiddenSizes).forEach(function(t){var e={};for(var r in t)e[r]=matrix.fromJSON(t[r]),n.push(e[r]);a.push(e)});var o=matrix.fromJSON(t.outputConnector);n.push(o);var s=matrix.fromJSON(t.output);n.push(s),Object.assign(this,e,r),r.hiddenSizes&&(this.hiddenLayers=r.hiddenSizes),r.dataFormatter&&(this.dataFormatter=DataFormatter$1.fromJSON(r.dataFormatter)),this.model={input:i,hiddenLayers:a,output:s,allMatrices:n,outputConnector:o,equations:[],equationConnections:[]},this.initialLayerInputs=this.hiddenLayers.map(function(t){return new matrix(t,1)}),this.bindEquation()}},{key:"toFunction",value:function(t){var o=this.model,a=this.model.equations,s=a[1].states,e=JSON.stringify(this.toJSON());function u(t){for(var e=o.equationConnections[0],r=a[0].states,n=0,i=r.length;n<i;n++)if(r[n].product===t)return n;return e.indexOf(t)}function r(t,e){if(!t||!t.rows||!t.columns)return"null";if(t===o.input)return"json.input";if(t===o.outputConnector)return"json.outputConnector";if(t===o.output)return"json.output";for(var r=0,n=o.hiddenLayers.length;r<n;r++){var i=o.hiddenLayers[r];for(var a in i)if(i.hasOwnProperty(a)&&i[a]===t)return"json.hiddenLayers[".concat(r,"].").concat(a)}return function(t,e){for(var r=0,n=s.length;r<n;r++){var i=s[r];if(r===e){var a=u(t);return-1<a&&(t===i.left||t===i.right)?"typeof prevStates[".concat(a,"] === 'object' ? prevStates[").concat(a,"].product : new Matrix(").concat(t.rows,", ").concat(t.columns,")"):"new Matrix(".concat(t.rows,", ").concat(t.columns,")")}if(t===i.product)return"states[".concat(r,"].product");if(t===i.right)return"states[".concat(r,"].right");if(t===i.left)return"states[".concat(r,"].left")}}(t,e)}function n(t){return(t=t.toString().split("{")).shift(),(t=(t=t.join("{")).split("}")).pop(),t.join("}").split("\n").join("\n        ").replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);","")}for(var i=[],l={},h=[],c=0,p=s.length;c<p;c++){var f=s[c];i.push("states[".concat(c,"] = {\n      name: '").concat(f.forwardFn.name,"',\n      left: ").concat(r(f.left,c),",\n      right: ").concat(r(f.right,c),",\n      product: ").concat(r(f.product,c),"\n    }"));var d=f.forwardFn.name;l[d]||(l[d]=!0,h.push("        case '".concat(d,"': //compiled from ").concat("src/recurrent/matrix/".concat(d.replace(/[A-Z]/g,function(t){return"-".concat(t.toLowerCase())}),".js"),"\n          ").concat(n(f.forwardFn.toString()),"\n          break;")))}var y="\n  if (typeof rawInput === 'undefined') rawInput = [];\n  if (typeof isSampleI === 'undefined') isSampleI = false;\n  if (typeof temperature === 'undefined') temperature = 1;\n  var json = ".concat(e,";\n  ").concat(this.dataFormatter?"".concat(this.dataFormatter.toFunctionString(),";\n  Object.assign(dataFormatter, json.options.dataFormatter);"):"","\n  ").concat(this.dataFormatter&&"function"==typeof this.formatDataIn?"const formatDataIn = function (input, output) { ".concat(n(this.formatDataIn.toString())," }.bind({ dataFormatter });"):"","\n  ").concat(null!==this.dataFormatter&&"function"==typeof this.formatDataOut?"const formatDataOut = function formatDataOut(input, output) { ".concat(n(this.formatDataOut.toString())," }.bind({ dataFormatter });"):"","\n  var input = ").concat(this.dataFormatter&&"function"==typeof this.formatDataIn?"formatDataIn(rawInput)":"rawInput",";\n  var maxPredictionLength = input.length + ").concat(this.maxPredictionLength,";\n  var _i = 0;\n  var output = [];\n  var states = [];\n  var prevStates;\n  while (true) {\n    var previousIndex = (_i === 0\n        ? 0\n        : _i < input.length\n          ? input[_i - 1] + 1\n          : output[_i - 1])\n          ;\n    var rowPluckIndex = previousIndex;\n    prevStates = states;\n    states = [];\n    ").concat(i.join(";\n    "),";\n    for (var stateIndex = 0, stateMax = ").concat(i.length,"; stateIndex < stateMax; stateIndex++) {\n      var state = states[stateIndex];\n      var product = state.product;\n      var left = state.left;\n      var right = state.right;\n      switch (state.name) {\n").concat(h.join("\n"),"\n      }\n    }\n\n    var logProbabilities = state.product;\n    if (temperature !== 1 && isSampleI) {\n      for (var q = 0, nq = logProbabilities.weights.length; q < nq; q++) {\n        logProbabilities.weights[q] /= temperature;\n      }\n    }\n\n    var probs = softmax(logProbabilities);\n    var nextIndex = isSampleI ? sampleI(probs) : maxI(probs);\n\n    _i++;\n    if (nextIndex === 0) {\n      break;\n    }\n    if (_i >= maxPredictionLength) {\n      break;\n    }\n\n    output.push(nextIndex);\n  }\n  ").concat(this.dataFormatter&&"function"==typeof this.formatDataOut?"return formatDataOut(input, output.slice(input.length).map(function(value) { return value - 1; }))":"return output.slice(input.length).map(function(value) { return value - 1; })",";\n  function Matrix(rows, columns) {\n    this.rows = rows;\n    this.columns = columns;\n    this.weights = zeros(rows * columns);\n  }\n  ").concat(zeros.toString(),"\n  ").concat(softmax.toString(),"\n  ").concat(randomFloat$4.toString(),"\n  ").concat(sampleI.toString(),"\n  ").concat(maxI.toString());return new Function("rawInput","isSampleI","temperature",t?t(y):y)}},{key:"isRunnable",get:function(){return 0!==this.model.equations.length||(console.error("No equations bound, did you run train()?"),!1)}}],[{key:"getModel",value:function(t,e){return{weight:new randomMatrix(t,e,.08),transition:new randomMatrix(t,t,.08),bias:new matrix(t,1)}}},{key:"getEquation",value:function(t,e,r,n){var i=t.relu.bind(t),a=t.add.bind(t),o=t.multiply.bind(t);return i(a(a(o(n.weight,e),o(n.transition,r)),n.bias))}}]),r}();RNN.defaults={inputSize:20,inputRange:20,hiddenLayers:[20,20],outputSize:20,decayRate:.999,smoothEps:1e-8,regc:1e-6,clipval:5,maxPredictionLength:100,setupData:defaultRNNFormatter$1,formatDataIn:function(t,e){var r=1<arguments.length&&void 0!==e?e:null;return this.dataFormatter?this.dataFormatter.indexTable.hasOwnProperty("stop-input")?this.dataFormatter.toIndexesInputOutput(t,r):this.dataFormatter.toIndexes(t):t},formatDataOut:function(t,e){return this.dataFormatter?this.dataFormatter.toCharacters(e).join(""):e},dataFormatter:null},RNN.trainDefaults={iterations:2e4,errorThresh:.005,log:!1,logPeriod:10,learningRate:.01,callback:null,callbackPeriod:10};var rnn=RNN;function ArrayLookupTable(t,e){this.length=0,this.prop=e;for(var r=this.table={},n=0;n<t.length;n++)for(var i=t[n][e],a=0;a<i.length;a++)for(var o in i[a])r.hasOwnProperty(o)||(r[o]=this.length++)}var arrayLookupTable=ArrayLookupTable,randomFloat$5=random.randomFloat,arraysToFloat32Arrays$1=cast.arraysToFloat32Arrays,arrayToFloat32Arrays$1=cast.arrayToFloat32Arrays,objectsToFloat32Arrays$1=cast.objectsToFloat32Arrays,objectToFloat32Arrays$1=cast.objectToFloat32Arrays,objectToFloat32Array$1=cast.objectToFloat32Array,RNNTimeStep=function(){_inherits(r,rnn);var e=_createSuper(r);function r(t){return _classCallCheck(this,r),e.call(this,t)}return _createClass(r,[{key:"createInputMatrix",value:function(){}},{key:"createOutputMatrix",value:function(){var t=this.model,e=this.outputSize,r=this.hiddenLayers[this.hiddenLayers.length-1];t.outputConnector=new randomMatrix(e,r,.08),t.output=new randomMatrix(e,1,.08)}},{key:"bindEquation",value:function(){var t=this.model,e=this.hiddenLayers,r=t.hiddenLayers,n=new equation,i=[],a=0<t.equationConnections.length?t.equationConnections[t.equationConnections.length-1]:this.initialLayerInputs,o=this.constructor.getEquation(n,n.input(new matrix(this.inputSize,1)),a[0],r[0]);i.push(o);for(var s=1,u=e.length;s<u;s++)o=this.constructor.getEquation(n,o,a[s],r[s]),i.push(o);t.equationConnections.push(i),n.add(n.multiply(t.outputConnector,o),t.output),t.equations.push(n)}},{key:"mapModel",value:function(){var t=this.model,e=t.hiddenLayers,r=t.allMatrices;if(this.initialLayerInputs=this.hiddenLayers.map(function(t){return new matrix(t,1)}),this.createHiddenLayers(),!t.hiddenLayers.length)throw new Error("net.hiddenLayers not set");for(var n=0,i=e.length;n<i;n++){var a=e[n];for(var o in a)a.hasOwnProperty(o)&&r.push(a[o])}if(this.createOutputMatrix(),!t.outputConnector)throw new Error("net.model.outputConnector not set");if(!t.output)throw new Error("net.model.output not set");r.push(t.outputConnector),r.push(t.output)}},{key:"backpropagate",value:function(){for(var t=this.model.equations.length-1;-1<t;t--)this.model.equations[t].backpropagate()}},{key:"run",value:function(t){return 1===this.inputSize?this.outputLookup?(this.run=this.runObject,this.runObject(t)):(this.run=this.runNumbers,this.runNumbers(t)):this.outputLookup?(this.run=this.runObjects,this.runObjects(t)):(this.run=this.runArrays,this.runArrays(t))}},{key:"forecast",value:function(t,e){return 1===this.inputSize?this.outputLookup?(this.forecast=this.runObject,this.runObject(t)):(this.forecast=this.forecastNumbers,this.forecastNumbers(t,e)):this.outputLookup?(this.forecast=this.forecastObjects,this.forecastObjects(t,e)):(this.forecast=this.forecastArrays,this.forecastArrays(t,e))}},{key:"train",value:function(t,e){var r=1<arguments.length&&void 0!==e?e:{};this.trainOpts=r=_objectSpread2(_objectSpread2({},this.constructor.trainDefaults),r);var n=r.iterations,i=r.errorThresh,a=!0===r.log?console.log:r.log,o=r.logPeriod,s=r.callback,u=r.callbackPeriod;1!==this.inputSize&&this.inputSize||this.setSize(t),t=this.formatData(t);var l,h=1/0;for(this.verifyIsInitialized(t),l=0;l<n&&i<h;l++){for(var c=0,p=0;p<t.length;p++){c+=this.trainPattern(t[p],!0)}if(h=c/t.length,isNaN(h))throw new Error("Network error rate is unexpected NaN, check network configurations and try again. Most probably input format is not correct or training data is not enough. ");a&&l%o==0&&a("iterations: ".concat(l,", training error: ").concat(h)),s&&l%u==0&&s({error:h,iterations:l})}return{error:h,iterations:l}}},{key:"verifyIsInitialized",value:function(t){t[0].input?this.trainInput=this.trainInputOutput:0<t[0].length&&(0<t[0][0].length||1<this.inputSize?this.trainInput=this.trainArrays:this.trainInput=this.trainNumbers),this.model||this.initialize()}},{key:"setSize",value:function(t){switch(lookup.dataShape(t).join(",")){case"array,array,number":case"array,object,number":case"array,datum,array,number":case"array,datum,object,number":break;case"array,array,array,number":this.inputSize=this.outputSize=t[0][0].length;break;case"array,array,object,number":this.inputSize=this.outputSize=Object.keys(lookup.toTable2D(t)).length;break;case"array,datum,array,array,number":this.inputSize=this.outputSize=t[0].input[0].length;break;case"array,datum,array,object,number":this.inputSize=Object.keys(lookup.toInputTable2D(t)).length,this.outputSize=Object.keys(lookup.toOutputTable2D(t)).length;break;default:throw new Error("unknown data shape or configuration")}}},{key:"trainNumbers",value:function(t){for(var e=this.model.equations;e.length<t.length;)this.bindEquation();for(var r=0,n=0,i=t.length-1;n<i;n++)r+=e[n].predictTarget([t[n]],[t[n+1]]);return this.end(),r/t.length}},{key:"runNumbers",value:function(t){if(!this.isRunnable)return null;var e,r=this.model.equations;for(this.inputLookup&&(t=lookup.toArray(this.inputLookup,t,this.inputLookupLength));r.length<=t.length;)this.bindEquation();for(var n=0;n<t.length;n++)e=r[n].runInput(new Float32Array([t[n]]));return this.end(),e.weights[0]}},{key:"forecastNumbers",value:function(t,e){if(!this.isRunnable)return null;for(var r,n=this.model.equations,i=t.length+e;n.length<=i;)this.bindEquation();for(var a=0,o=0;o<t.length;o++)r=n[a++].runInput([t[o]]);for(var s=[r.weights[0]],u=0,l=e-1;u<l;u++)r=n[a++].runInput(r.weights),s.push(r.weights[0]);return this.end(),s}},{key:"runObject",value:function(t){if(this.inputLookup!==this.outputLookup)return lookup.toObject(this.outputLookup,this.forecastNumbers(lookup.toArray(this.inputLookup,t,this.inputLookupLength),this.outputLookupLength));var e=lookup.toArrayShort(this.inputLookup,t);return lookup.toObjectPartial(this.outputLookup,this.forecastNumbers(e,this.outputLookupLength-e.length),e.length)}},{key:"runObjects",value:function(t){var e=this;return t=t.map(function(t){return lookup.toArray(e.inputLookup,t,e.inputLookupLength)}),this.forecastArrays(t,1).map(function(t){return lookup.toObject(e.outputLookup,t)})[0]}},{key:"forecastObjects",value:function(t,e){var r=this;return t=t.map(function(t){return lookup.toArray(r.inputLookup,t,r.inputLookupLength)}),this.forecastArrays(t,e).map(function(t){return lookup.toObject(r.outputLookup,t)})}},{key:"trainInputOutput",value:function(t){for(var e=this.model,r=t.input,n=t.output,i=r.length+n.length,a=e.equations;a.length<i;)this.bindEquation();for(var o=0,s=0,u=0,l=r.length-1;u<l;u++)o+=a[s++].predictTarget(r[u],r[u+1]);o+=a[s++].predictTarget(r[r.length-1],n[0]);for(var h=0,c=n.length-1;h<c;h++)o+=a[s++].predictTarget(n[h],n[h+1]);return this.end(),o/i}},{key:"trainArrays",value:function(t){for(var e=this.model.equations;e.length<t.length;)this.bindEquation();for(var r=0,n=0,i=t.length-1;n<i;n++)r+=e[n].predictTarget(t[n],t[n+1]);return this.end(),r/t.length}},{key:"runArrays",value:function(t){if(!this.isRunnable)return null;for(var e=this.model.equations;e.length<=t.length;)this.bindEquation();this.inputLookup&&(t=lookup.toArrays(this.inputLookup,t,this.inputLookupLength));for(var r=0;r<t.length;r++)var n=e[r].runInput(t[r]).weights;return this.end(),this.outputLookup?lookup.toObject(this.outputLookup,n):n}},{key:"forecastArrays",value:function(t,e){if(!this.isRunnable)return null;for(var r,n=this.model.equations,i=t.length+e;n.length<=i;)this.bindEquation();for(var a=0,o=0;o<t.length;o++)r=n[a++].runInput(t[o]);for(var s=[r.weights],u=0,l=e-1;u<l;u++)r=n[a++].runInput(r.weights),s.push(r.weights.slice(0));return this.end(),s}},{key:"end",value:function(){this.model.equations[this.model.equations.length-1].runInput(new Float32Array(this.outputSize))}},{key:"formatData",value:function(t){var e,r,n,i,a,o,s=[];switch(lookup.dataShape(t).join(",")){case"array,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");for(var u=0;u<t.length;u++)s.push(Float32Array.from([t[u]]));return[s];case"array,array,number":if(1===this.inputSize&&1===this.outputSize){for(var l=0;l<t.length;l++)s.push(arrayToFloat32Arrays$1(t[l]));return s}if(this.inputSize!==t[0].length)throw new Error("inputSize must match data input size");if(this.outputSize!==t[0].length)throw new Error("outputSize must match data input size");for(var h=0;h<t.length;h++)s.push(Float32Array.from(t[h]));return[s];case"array,object,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");this.inputLookup||(e=new lookupTable(t),this.inputLookup=this.outputLookup=e.table,this.inputLookupLength=this.outputLookupLength=e.length);for(var c=0;c<t.length;c++)s.push(objectToFloat32Arrays$1(t[c]));return s;case"array,datum,array,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");for(var p=0;p<t.length;p++){var f=t[p];s.push({input:arrayToFloat32Arrays$1(f.input),output:arrayToFloat32Arrays$1(f.output)})}return s;case"array,datum,object,number":if(1!==this.inputSize)throw new Error("inputSize must be 1 for this data size");if(1!==this.outputSize)throw new Error("outputSize must be 1 for this data size");this.inputLookup||(r=new lookupTable(t,"input"),this.inputLookup=r.table,this.inputLookupLength=r.length),this.outputLookup||(n=new lookupTable(t,"output"),this.outputLookup=n.table,this.outputLookupLength=n.length);for(var d=0;d<t.length;d++){var y=t[d];s.push({input:objectToFloat32Arrays$1(y.input),output:objectToFloat32Arrays$1(y.output)})}return s;case"array,array,array,number":for(var g=0;g<t.length;g++)s.push(arraysToFloat32Arrays$1(t[g]));return s;case"array,array,object,number":this.inputLookup||(i=new lookupTable(t),this.inputLookup=this.outputLookup=i.table,this.inputLookupLength=this.outputLookupLength=i.length);for(var m=0;m<t.length;m++){for(var v=[],w=0;w<t[m].length;w++)v.push(objectToFloat32Array$1(t[m][w],this.inputLookup,this.inputLookupLength));s.push(v)}return s;case"array,datum,array,array,number":if(1===this.inputSize&&1===this.outputSize)for(var b=0;b<t.length;b++){var k=t[b];s.push({input:Float32Array.from(k.input),output:Float32Array.from(k.output)})}else{if(this.inputSize!==t[0].input[0].length)throw new Error("inputSize must match data input size");if(this.outputSize!==t[0].output[0].length)throw new Error("outputSize must match data output size");for(var $=0;$<t.length;$++){var S=t[$];s.push({input:arraysToFloat32Arrays$1(S.input),output:arraysToFloat32Arrays$1(S.output)})}}return s;case"array,datum,array,object,number":this.inputLookup||(a=new arrayLookupTable(t,"input"),this.inputLookup=a.table,this.inputLookupLength=a.length),this.outputLookup||(o=new arrayLookupTable(t,"output"),this.outputLookup=o.table,this.outputLookupLength=o.length);for(var _=0;_<t.length;_++){var E=t[_];s.push({input:objectsToFloat32Arrays$1(E.input,this.inputLookup,this.inputLookupLength),output:objectsToFloat32Arrays$1(E.output,this.outputLookup,this.outputLookupLength)})}return s;default:throw new Error("unknown data shape or configuration")}}},{key:"test",value:function(t){var e=this.formatData(t),r=[],n=0;switch(lookup.dataShape(t).join(",")){case"array,array,number":if(1!==this.inputSize)throw new Error("unknown data shape or configuration");for(var i=0;i<e.length;i++){var a,o=e[i],s=this.run(o.splice(0,o.length-1)),u=o[o.length-1][0]-s,l=u*u;n+=l,Math.abs(l)>this.trainOpts.errorThresh&&(a=t[i],Object.assign(a,{value:o,actual:s}),r.push(a))}break;case"array,array,array,number":for(var h=0;h<e.length;h++){for(var c,p=e[h],f=this.run(p.splice(0,p.length-1)),d=p[p.length-1],y=0,g=0,m=0;m<f.length;m++){g++;var v=d[m]-f[m];y+=v*v}n+=y/g,Math.abs(y)>this.trainOpts.errorThresh&&(c=t[h],r.push({value:c,actual:f}))}break;case"array,object,number":for(var w=0;w<e.length;w++){var b,k=e[w],$=this.run(lookup.toObjectPartial(this.outputLookup,k,0,k.length-1)),S=0,_=k[k.length-1][w]-$[void 0];n+=S+=_*_,Math.abs(S)>this.trainOpts.errorThresh&&(b=t[w],r.push({value:b,actual:$}))}break;case"array,array,object,number":for(var E=0;E<e.length;E++){var T,A=e[E],O=this.run(A.slice(0,A.length-1)),I=t[E][A.length-1],L=0,x=0;for(var R in O){var C=I[R]-O[R];L+=C*C,x++}n+=L/x,Math.abs(L)>this.trainOpts.errorThresh&&(T=t[E],r.push({value:T,actual:O}))}break;case"array,datum,array,number":case"array,datum,object,number":for(var P=0;P<e.length;P++){for(var M,D=e[P],N=this.forecast(D.input,D.output.length),j=0,B=0,F=0;F<N.length;F++){var z=D.output[F][0]-N[F];j+=z*z,B++}n+=j/B,Math.abs(j)>this.trainOpts.errorThresh&&(M=t[P],Object.assign(M,{actual:this.outputLookup?lookup.toObject(this.outputLookup,N):N}),r.push(M))}break;case"array,datum,array,array,number":for(var K=0;K<e.length;K++){for(var U,W=e[K],G=this.forecast(W.input,W.output.length),V=0,Y=0;Y<G.length;Y++)for(var H=0;H<G[Y].length;H++){var q=W.output[Y][H]-G[Y][H];V+=q*q}n+=V,Math.abs(V)>this.trainOpts.errorThresh&&(U=t[K],r.push({input:U.input,output:U.output,actual:G}))}break;case"array,datum,array,object,number":for(var X=0;X<e.length;X++){for(var J,Z=e[X],Q=this.forecast(Z.input,Z.output.length),tt=0,et=0;et<Q.length;et++)for(var rt in Q[et]){var nt=t[X].output[et][rt]-Q[et][rt];tt+=nt*nt}n+=tt,Math.abs(tt)>this.trainOpts.errorThresh&&(J=t[X],r.push({input:J.input,output:J.output,actual:Q}))}break;default:throw new Error("unknown data shape or configuration")}return{error:n/e.length,misclasses:r,total:e.length}}},{key:"addFormat",value:function(t){switch(lookup.dataShape(t).join(",")){case"array,array,number":case"datum,array,array,number":case"array,number":case"datum,array,number":return;case"datum,object,number":this.inputLookup=lookup.addKeys(t.input,this.inputLookup),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length),this.outputLookup=lookup.addKeys(t.output,this.outputLookup),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break;case"object,number":this.inputLookup=this.outputLookup=lookup.addKeys(t,this.inputLookup),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break;case"array,object,number":for(var e=0;e<t.length;e++)this.inputLookup=this.outputLookup=lookup.addKeys(t[e],this.inputLookup),this.inputLookup&&(this.inputLookupLength=this.outputLookupLength=Object.keys(this.inputLookup).length);break;case"datum,array,object,number":for(var r=0;r<t.input.length;r++)this.inputLookup=lookup.addKeys(t.input[r],this.inputLookup),this.inputLookup&&(this.inputLookupLength=Object.keys(this.inputLookup).length);for(var n=0;n<t.output.length;n++)this.outputLookup=lookup.addKeys(t.output[n],this.outputLookup),this.outputLookup&&(this.outputLookupLength=Object.keys(this.outputLookup).length);break;default:throw new Error("unknown data shape or configuration")}}},{key:"toJSON",value:function(){var t=this.constructor.defaults;this.model||this.initialize();var e=this.model,r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=this[n]);return{type:this.constructor.name,options:r,hiddenLayers:e.hiddenLayers.map(function(t){var e={};for(var r in t)e[r]=t[r].toJSON();return e}),outputConnector:this.model.outputConnector.toJSON(),output:this.model.output.toJSON(),inputLookup:this.inputLookup,inputLookupLength:this.inputLookupLength,outputLookup:this.outputLookup,outputLookupLength:this.outputLookupLength}}},{key:"fromJSON",value:function(t){var e=this.constructor.defaults,r=t.options;this.model=null,this.hiddenLayers=null;var n=[],i=[];(t.hiddenLayers||t.hiddenSizes).forEach(function(t){var e={};for(var r in t)e[r]=matrix.fromJSON(t[r]),n.push(e[r]);i.push(e)});var a=matrix.fromJSON(t.outputConnector);n.push(a);var o=matrix.fromJSON(t.output);n.push(o),Object.assign(this,e,r),r.hiddenSizes&&(this.hiddenLayers=r.hiddenSizes),this.inputLookup=t.inputLookup,this.inputLookupLength=t.inputLookupLength,this.outputLookup=t.outputLookup,this.outputLookupLength=t.outputLookupLength,this.model={hiddenLayers:i,output:o,allMatrices:n,outputConnector:a,equations:[],equationConnections:[]},this.initialLayerInputs=this.hiddenLayers.map(function(t){return new matrix(t,1)}),this.bindEquation()}},{key:"toFunction",value:function(t){var o=this.model,a=this.model.equations,e=this.inputSize,r=this.inputLookup,n=this.inputLookupLength,i=this.outputLookup,s=this.outputLookupLength,u=a[1].states,l=JSON.stringify(this.toJSON());function h(t){for(var e=o.equationConnections[0],r=a[0].states,n=0,i=r.length;n<i;n++)if(r[n].product===t)return n;return e.indexOf(t)}function c(t,e){if(!t||!t.rows||!t.columns)return"null";if(t===o.outputConnector)return"json.outputConnector";if(t===o.output)return"json.output";for(var r=0,n=o.hiddenLayers.length;r<n;r++){var i=o.hiddenLayers[r];for(var a in i)if(i.hasOwnProperty(a)&&i[a]===t)return"json.hiddenLayers[".concat(r,"].").concat(a)}return function(t,e){for(var r=0,n=u.length;r<n;r++){var i=u[r];if(r===e){var a=h(t);switch(t){case i.left:if(-1<a)return"typeof prevStates[".concat(a,"] === 'object' ? prevStates[").concat(a,"].product : new Matrix(").concat(t.rows,", ").concat(t.columns,")");case i.right:if(-1<a)return"typeof prevStates[".concat(a,"] === 'object' ? prevStates[").concat(a,"].product : new Matrix(").concat(t.rows,", ").concat(t.columns,")");case i.product:return"new Matrix(".concat(t.rows,", ").concat(t.columns,")");default:throw Error("unknown state")}}if(t===i.product)return"states[".concat(r,"].product");if(t===i.right)return"states[".concat(r,"].right");if(t===i.left)return"states[".concat(r,"].left")}}(t,e)}for(var p,f=[],d={},y=[],g=0,m=u.length;g<m;g++){var v=u[g];f.push("states[".concat(g,"] = {\n      name: '").concat(v.forwardFn.name,"',\n      left: ").concat(c(v.left,g),",\n      right: ").concat(c(v.right,g),",\n      product: ").concat(c(v.product,g),"\n    }"));var w=v.forwardFn.name;d[w]||(d[w]=!0,y.push("        case '".concat(w,"':").concat("forwardFn"!==w?" //compiled from ".concat("src/recurrent/matrix/".concat(w.replace(/[A-Z]/g,function(t){return"-".concat(t.toLowerCase())}),".js")):"","\n          ").concat(((p=(p=v.forwardFn.toString()).toString().split("{")).shift(),(p=(p=p.join("{")).split("}")).pop(),p.join("}").split("\n").join("\n        ").replace("product.weights = input.weights = this.inputValue;",r&&1===e?"product.weights = _i < input.length ? input[_i]: prevStates[prevStates.length - 1].product.weights;":1===e?"product.weights = [input[_i]];":"product.weights = input[_i];").replace("product.deltas[i] = 0;","").replace("product.deltas[column] = 0;","").replace("left.deltas[leftIndex] = 0;","").replace("right.deltas[rightIndex] = 0;","").replace("product.deltas = left.deltas.slice(0);","")),"\n          break;")))}var b=1===this.inputSize&&this.outputLookup,k="\n  var input = ".concat(this.inputLookup?"lookupInput(rawInput)":"rawInput",";\n  var json = ").concat(l,";\n  var output = [];\n  var states = [];\n  var prevStates;\n  var state;\n  var max = ").concat(b?r===i?n:"input.length + ".concat(s-1):"input.length",";\n  for (var _i = 0; _i < max; _i++) {\n    prevStates = states;\n    states = [];\n    ").concat(f.join(";\n    "),";\n    for (var stateIndex = 0, stateMax = ").concat(f.length,"; stateIndex < stateMax; stateIndex++) {\n      state = states[stateIndex];\n      var product = state.product;\n      var left = state.left;\n      var right = state.right;\n\n      switch (state.name) {\n").concat(y.join("\n"),"\n      }\n    }\n    ").concat(1===e&&r?"if (_i >= input.length - 1) { output.push(state.product.weights); }":"output = state.product.weights;","\n  }\n  ").concat(i?i===r?"return lookupOutputPartial(output, input)":"return lookupOutput(output)":1===e?"return output[0]":"return output",";\n  ").concat(r?1===e?r===i?"function lookupInput(input) {\n            var table = ".concat(JSON.stringify(r),";\n            var result = [];\n            for (var p in table) {\n              if (!input.hasOwnProperty(p)) break;\n              result.push(Float32Array.from([input[p]]));\n            }\n            return result;\n          }"):"function lookupInput(input) {\n          var table = ".concat(JSON.stringify(r),";\n          var result = [];\n          for (var p in table) {\n            result.push(Float32Array.from([input[p]]));\n          }\n          return result;\n        }"):"function lookupInput(rawInputs) {\n        var table = ".concat(JSON.stringify(r),";\n        var result = [];\n        for (var i = 0; i < rawInputs.length; i++) {\n          var rawInput = rawInputs[i];\n          var input = new Float32Array(").concat(n,");\n          for (var p in table) {\n            input[table[p]] = rawInput.hasOwnProperty(p) ? rawInput[p] : 0;\n          }\n          result.push(input);\n        }\n        return result;\n      }"):"","\n  ").concat(i?1===e?r===i?"function lookupOutputPartial(output, input) {\n            var table = ".concat(JSON.stringify(i),";\n            var offset = input.length;\n            var result = {};\n            var i = 0;\n            for (var p in table) {\n              if (i++ < offset) continue;\n              result[p] = output[table[p] - offset][0];\n            }\n            return result;\n          }"):"function lookupOutput(output) {\n          var table = ".concat(JSON.stringify(i),";\n          var result = {};\n          for (var p in table) {\n            result[p] = output[table[p]][0];\n          }\n          return result;\n        }"):"function lookupOutput(output) {\n        var table = ".concat(JSON.stringify(i),";\n        var result = {};\n        for (var p in table) {\n          result[p] = output[table[p]];\n        }\n        return result;\n      }"):"","\n\n  function Matrix(rows, columns) {\n    this.rows = rows;\n    this.columns = columns;\n    this.weights = zeros(rows * columns);\n  }\n  ").concat(zeros.toString(),"\n  ").concat(softmax.toString().replace("_2.default","Matrix"),"\n  ").concat(randomFloat$5.toString(),"\n  ").concat(sampleI.toString(),"\n  ").concat(maxI.toString());return new Function("rawInput",t?t(k):k)}}]),r}();RNNTimeStep.defaults={inputSize:1,hiddenLayers:[20],outputSize:1,learningRate:rnn.defaults.learningRate,decayRate:rnn.defaults.decayRate,smoothEps:rnn.defaults.smoothEps,regc:rnn.defaults.regc,clipval:rnn.defaults.clipval},RNNTimeStep.trainDefaults=rnn.trainDefaults;var rnnTimeStep=RNNTimeStep,LSTM=function(){_inherits(e,rnn);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,null,[{key:"getModel",value:function(t,e){return{inputMatrix:new randomMatrix(t,e,.08),inputHidden:new randomMatrix(t,t,.08),inputBias:new matrix(t,1),forgetMatrix:new randomMatrix(t,e,.08),forgetHidden:new randomMatrix(t,t,.08),forgetBias:new matrix(t,1),outputMatrix:new randomMatrix(t,e,.08),outputHidden:new randomMatrix(t,t,.08),outputBias:new matrix(t,1),cellActivationMatrix:new randomMatrix(t,e,.08),cellActivationHidden:new randomMatrix(t,t,.08),cellActivationBias:new matrix(t,1)}}},{key:"getEquation",value:function(t,e,r,n){var i=t.sigmoid.bind(t),a=t.add.bind(t),o=t.multiply.bind(t),s=t.multiplyElement.bind(t),u=t.tanh.bind(t),l=i(a(a(o(n.inputMatrix,e),o(n.inputHidden,r)),n.inputBias)),h=i(a(a(o(n.forgetMatrix,e),o(n.forgetHidden,r)),n.forgetBias)),c=i(a(a(o(n.outputMatrix,e),o(n.outputHidden,r)),n.outputBias)),p=u(a(a(o(n.cellActivationMatrix,e),o(n.cellActivationHidden,r)),n.cellActivationBias)),f=s(h,r),d=s(l,p);return s(c,u(a(f,d)))}}]),e}(),lstm=LSTM,LSTMTimeStep=function(){_inherits(e,rnnTimeStep);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,null,[{key:"getModel",value:function(t,e){return lstm.getModel.call(this,t,e)}},{key:"getEquation",value:function(t,e,r,n){return lstm.getEquation.call(this,t,e,r,n)}}]),e}(),lstmTimeStep=LSTMTimeStep,GRU=function(){_inherits(e,rnn);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,null,[{key:"getModel",value:function(t,e){return{updateGateInputMatrix:new randomMatrix(t,e,.08),updateGateHiddenMatrix:new randomMatrix(t,t,.08),updateGateBias:new matrix(t,1),resetGateInputMatrix:new randomMatrix(t,e,.08),resetGateHiddenMatrix:new randomMatrix(t,t,.08),resetGateBias:new matrix(t,1),cellWriteInputMatrix:new randomMatrix(t,e,.08),cellWriteHiddenMatrix:new randomMatrix(t,t,.08),cellWriteBias:new matrix(t,1)}}},{key:"getEquation",value:function(t,e,r,n){var i=t.sigmoid.bind(t),a=t.add.bind(t),o=t.multiply.bind(t),s=t.multiplyElement.bind(t),u=t.tanh.bind(t),l=t.allOnes.bind(t),h=t.cloneNegative.bind(t),c=i(a(a(o(n.updateGateInputMatrix,e),o(n.updateGateHiddenMatrix,r)),n.updateGateBias)),p=i(a(a(o(n.resetGateInputMatrix,e),o(n.resetGateHiddenMatrix,r)),n.resetGateBias)),f=u(a(a(o(n.cellWriteInputMatrix,e),o(n.cellWriteHiddenMatrix,s(p,r))),n.cellWriteBias));return a(s(a(l(c.rows,c.columns),h(c)),f),s(r,c))}}]),e}(),gru$2=GRU,GRUTimeStep=function(){_inherits(e,rnnTimeStep);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,null,[{key:"getModel",value:function(t,e){return gru$2.getModel(t,e)}},{key:"getEquation",value:function(t,e,r,n){return gru$2.getEquation(t,e,r,n)}}]),e}(),gruTimeStep=GRUTimeStep,$every$1=arrayIteration.every,STRICT_METHOD$5=arrayMethodIsStrict("every"),USES_TO_LENGTH$8=arrayMethodUsesToLength("every");_export({target:"Array",proto:!0,forced:!STRICT_METHOD$5||!USES_TO_LENGTH$8},{every:function(t,e){return $every$1(this,t,1<arguments.length?e:void 0)}});var FeedForward$2=feedForward$2.FeedForward,Recurrent$1=recurrent.Recurrent,recurrentZeros$1=recurrentZeros_1.recurrentZeros,recurrentJSONTypes=["RNN","LSTM","GRU","RNNTimeStep","LSTMTimeStep","GRUTimeStep","Recurrent"];function drawInput(t){var e=t.pixelX,r=t.pixelY,n=t.radius,i=t.inputs,a=t.row,o=t.line,s=t.fontSize,u=t.fontClassName,l='<rect\n              x="'.concat(e/2-n,'"\n              y="').concat(r/2+a*r-n,'"\n              width="').concat(2*n,'"\n              height="').concat(2*n,'"\n              stroke="black"\n              stroke-width="1"\n              fill="').concat(i.color,'"\n              class="').concat(i.className,'" />\n            <line\n              x1="').concat(e/4,'"\n              y1="').concat(r/2+a*r,'"\n              x2="').concat(e/2-n,'"\n              y2="').concat(r/2+a*r,'"\n              style="stroke:').concat(o.color,";stroke-width:").concat(o.width,'"\n              class="').concat(o.className,'" />');return i.labels&&(l+='<text\n              x="'.concat(e/8,'"\n              y="').concat(r/2+a*r-5,'"\n              fill="black"\n              font-size="').concat(s,'"\n              class="').concat(u,'">').concat(i.labels[a],"</text>")),l}function drawNeuron(t){var e=t.pixelX,r=t.pixelY,n=t.row,i=t.column,a=t.radius,o=t.hidden;return'<circle\n            cx="'.concat(e/2+i*e,'"\n            cy="').concat(r/2+n*r,'"\n            r="').concat(a,'"\n            stroke="black"\n            stroke-width="1"\n            fill="').concat(o.color,'"\n            class="').concat(o.className,'" />')}function drawOutput(t){var e=t.pixelX,r=t.pixelY,n=t.row,i=t.column,a=t.line,o=t.outputs,s=t.radius;return'<circle\n            cx="'.concat(e/2+i*e,'"\n            cy="').concat(r/2+n*r,'"\n            r="').concat(s,'"\n            stroke="black"\n            stroke-width="1"\n            fill="').concat(o.color,'"\n            class="').concat(o.className,'" />\n          <line\n            x1="').concat(e/2+i*e+s,'"\n            y1="').concat(r/2+n*r,'"\n            x2="').concat(e/2+i*e+e/4,'"\n            y2="').concat(r/2+n*r,'"\n            style="stroke:').concat(a.color,";stroke-width:").concat(a.width,'"\n            class="').concat(a.className,'" />')}function drawBackwardConnections(t){var e=t.pixelX,r=t.pixelY,n=t.row,i=t.column,a=t.radius,o=t.lineY,s=t.line,u=t.previousConnectionIndex;return'<line\n            x1="'.concat(e/2+(i-1)*e+a,'"\n            y1="').concat(o/2+u*o,'"\n            x2="').concat(e/2+i*e-a,'"\n            y2="').concat(r/2+n*r,'"\n            style="stroke:').concat(s.color,";stroke-width:").concat(s.width,'"\n            class="').concat(s.className,'" />')}function neuralNetworkToSVG(t){for(var e=t.sizes,r=t.height,n="",i=t.width/e.length,a=0;a<e.length;a++)for(var o=e[a],s=r/o,u=0;u<o;u++)if(0===a)n+=drawInput(Object.assign({pixelX:i,pixelY:s,row:u,column:a},t));else{a===e.length-1?n+=drawOutput(Object.assign({pixelX:i,pixelY:s,row:u,column:a},t)):n+=drawNeuron(Object.assign({pixelX:i,pixelY:s,row:u,column:a},t));for(var l=e[a-1],h=r/l,c=0;c<l;c++)n+=drawBackwardConnections(Object.assign({pixelX:i,pixelY:s,row:u,column:a,lineY:h,previousConnectionIndex:c},t))}return n}function drawRecurrentConnections(t){var e=t.pixelX,r=t.pixelY,n=t.row,i=t.column,a=t.radius,o=t.recurrentLine,s=e/2+i*e+a+1,u=r/2+n*r,l=s-2*a-2,h=u,c=100+l,p=50+h,f=s-100,d=50+u;return'<path\n              d="M '.concat(s," ").concat(u," C ").concat(c," ").concat(p,", ").concat(f," ").concat(d,", ").concat(l," ").concat(h,'"\n              stroke="').concat(o.color,'"\n              stroke-width="').concat(o.width,'"\n              fill="transparent"\n              stroke-linecap="round"\n              marker-end="url(#arrow)"\n              class="').concat(o.className,'" />')}function rnnToSVG(t){var e=t.width,r=t.height,n=t.recurrentLine,i=t.sizes,a=t.radius,o=e/i.length,s='<defs>\n              <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">\n                <path d="M0,0 L0,6 L9,3 z" fill="'.concat(n.color,'" />\n              </marker>\n            </defs>');s+=neuralNetworkToSVG(t);for(var u=1;u<i.length;u++)for(var l=i[u],h=r/l,c=0;c<l;c++)s+=drawRecurrentConnections({pixelX:o,pixelY:h,row:c,column:u,radius:a,recurrentLine:n});return s}function getFeedForwardLayers(t){var e=t.inputLayer(),r=[];r.push(t.hiddenLayers[0](e));for(var n=1;n<t.hiddenLayers.length;n++)r.push(t.hiddenLayers[n](r[n-1]));return{inputLayer:e,hiddenLayers:r,outputLayer:t.outputLayer(r[r.length-1]),layerCount:1+r.length+1}}function getRecurrentLayers(t){var e=t.inputLayer(),r=[];r.push(t.hiddenLayers[0](e,recurrentZeros$1(),0));for(var n=1;n<t.hiddenLayers.length;n++)r.push(t.hiddenLayers[n](r[n-1],recurrentZeros$1(),n));return{inputLayer:e,hiddenLayers:r,outputLayer:t.outputLayer(r[r.length-1]),layerCount:1+r.length+1}}function wrapSVG(t,e,r){return'<svg\n            xmlns="http://www.w3.org/2000/svg"\n            xmlns:xlink="http://www.w3.org/1999/xlink"\n            version="1.1"\n            width="'.concat(e,'"\n            height="').concat(r,'">').concat(t,"</svg>")}function getSizes(t){var e=t.sizes,r=t.inputSize,n=t.outputSize,i=t.hiddenLayers;return"number"==typeof r&&Array.isArray(i)&&i.every(function(t){return"number"==typeof t})&&"number"==typeof n?[r].concat(i).concat([n]):e}function toSVG(t,e){var r,n,i,a,o,s,u,l,h=_objectSpread2(_objectSpread2({},{line:{width:.5,color:"black",className:"connection"},recurrentLine:{width:1,color:"red",className:"recurrence"},inputs:{color:"rgba(0, 128, 0, 0.5)",labels:null,className:"input"},outputs:{color:"rgba(100, 149, 237, 0.5)",className:"output"},hidden:{color:"rgba(255, 127, 80, 0.5)",className:"hidden-neuron"},fontSize:"14px",fontClassName:"label",radius:8,width:400,height:250}),e),c=h.width,p=h.height,f=h.inputs,d=t.hasOwnProperty("model")||t instanceof Recurrent$1||t.type&&-1!==recurrentJSONTypes.indexOf(t.type),y=null;if(t instanceof neuralNetwork||t instanceof rnn||t instanceof rnnTimeStep?y=getSizes(t):t.sizes?y=t.sizes:t instanceof Recurrent$1?(n=(r=getRecurrentLayers(t)).inputLayer,i=r.hiddenLayers,a=r.outputLayer,y=[n.height].concat(i.map(function(t){return t.height})).concat([a.height])):t instanceof FeedForward$2?(s=(o=getFeedForwardLayers(t)).inputLayer,u=o.hiddenLayers,l=o.outputLayer,y=[s.height].concat(u.map(function(t){return t.height})).concat([l.height])):d?t.options&&(y=getSizes(t.options)):y=getSizes(t),!y)throw new Error("sizes not set");if(f.labels&&f.labels.length!==y[0])throw new Error("not enough labels for inputs");return wrapSVG((d?rnnToSVG:neuralNetworkToSVG)(_objectSpread2(_objectSpread2({},h),{},{sizes:y})),c,p)}var toSvg=toSVG,src=createCommonjsModule(function(t){var e=feedForward$2.FeedForward,r=recurrent.Recurrent,n={activation:activation,CrossValidate:crossValidate,likely:likely,layer:layer,layerTypes:types,lookup:lookup,praxis:praxis,FeedForward:e,NeuralNetwork:neuralNetwork,NeuralNetworkGPU:neuralNetworkGpu,Recurrent:r,TrainStream:trainStream,recurrent:{RNNTimeStep:rnnTimeStep,LSTMTimeStep:lstmTimeStep,GRUTimeStep:gruTimeStep,RNN:rnn,LSTM:lstm,GRU:gru$2},utilities:{max:max$3,mse:mse,ones:ones,random:random,randomWeight:randomWeight,randos:randos,range:range,toArray:toArray,DataFormatter:dataFormatter,zeros:zeros,toSVG:toSvg}};"undefined"!=typeof window&&(window.brain=n),t.exports=n});module.exports=src;