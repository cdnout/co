!function($root){var Membrane={inject:function(e,t,n,o){var r,i=null;return o&&e?(r=Phenotype.$type(t,n),t.hasOwnProperty("$cell")&&(i=e).parentNode&&i.parentNode.replaceChild(r,i),i=r):t.$type&&("head"===t.$type||"body"===t.$type)&&$root.document.getElementsByTagName(t.$type)?i=$root.document.getElementsByTagName(t.$type)[0]:t.id&&$root.document.getElementById(t.id)&&(i=$root.document.getElementById(t.id)).nodeName.toLowerCase()!==(t.$type||"div")&&(r=Phenotype.$type(t,n),i.parentNode.replaceChild(r,i),i=r),i&&!i.Meta&&(i.Meta={}),i},add:function(e,t,n,o){var r=Phenotype.$type(t,o);return null!==n&&void 0!==n&&e.childNodes&&e.childNodes[n]?e.insertBefore(r,e.childNodes[n]):e.appendChild(r),r},build:function(e,t,n,o,r){var i=Membrane.inject(e,t,o,r);return i||Membrane.add(e,t,n,o)}},Genotype={set:function(e,t,n){-1===["$init"].indexOf(t)?e.Genotype[t]=Nucleus.bind(e,n):(n.snapshot=n,e.Genotype[t]=n)},update:function(e,t,n){Nucleus.queue(e,t,"w"),Genotype.set(e,t,n)},build:function(e,t,n){e.Genotype={},e.Inheritance=n;for(var o in t)Genotype.set(e,o,t[o])}},Gene={freeze:function(e){var t=[],n=JSON.stringify(e,function(e,n){if("function"==typeof n)return n.toString();if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return"[Circular]";t.push(n)}return n});return t=null,n},LCS:function(e,t){var n,o,r=e.length,i=t.length,u=[],p=[],c=[];for(n=0;n<r;n++)p.push(Gene.freeze(e[n]));for(o=0;o<i;o++)c.push(Gene.freeze(t[o]));for(n=0;n<=r;n++)u.push([0]);for(o=0;o<i;o++)u[0].push(0);for(n=0;n<r;n++)for(o=0;o<i;o++)u[n+1][o+1]=p[n]===c[o]?u[n][o]+1:Math.max(u[n+1][o],u[n][o+1]);return function t(n,o){return n*o==0?[]:p[n-1]===c[o-1]?t(n-1,o-1).concat([{item:e[n-1],_old:n-1,_new:o-1}]):u[n][o-1]>u[n-1][o]?t(n,o-1):t(n-1,o)}(r,i)},diff:function(e,t){var n=Gene.LCS(e,t),o=n.map(function(e){return e._old}),r=e.map(function(e,t){return{item:e,index:t}}).filter(function(e,t){return-1===o.indexOf(t)}),i=n.map(function(e){return e._new});return{"-":r,"+":t.map(function(e,t){return{item:e,index:t}}).filter(function(e,t){return-1===i.indexOf(t)})}}},Phenotype={build:function(e,t){for(var n in t)null!==t[n]&&void 0!==t[n]&&Phenotype.set(e,n,t[n]);Phenotype.$init(e)},multiline:function(e){return/\/\*!?(?:@preserve)?[ \t]*(?:\r\n|\n)([\s\S]*?)(?:\r\n|\n)[ \t]*\*\//.exec(e.toString())[1]},get:function(e){return Object.getOwnPropertyDescriptor($root.HTMLElement.prototype,e)||Object.getOwnPropertyDescriptor($root.Element.prototype,e)},set:function(e,t,n){if("$"===t[0])if("$type"===t){var o=e.tagName?e.tagName.toLowerCase():"text";if(n.toLowerCase()!==o){var r=Phenotype.$type({$type:"fragment"}).$build(e.Genotype,e.Inheritance,null,e.Meta.namespace);e.parentNode.replaceChild(r,e),e=r}}else"$text"===t?("function"==typeof n&&(n=Phenotype.multiline(n)),e.textContent=n):"$html"===t?("function"==typeof n&&(n=Phenotype.multiline(n)),e.innerHTML=n):"$components"===t&&Phenotype.$components(e,n);else if("_"===t[0]);else if("value"===t)e[t]=n;else if("style"===t&&"object"==typeof n){var i=Phenotype.get(t).get.call(e);for(var u in n)i[u]=n[u]}else if("number"==typeof n||"string"==typeof n||"boolean"==typeof n)e.setAttribute&&e.setAttribute(t,n);else if("function"==typeof n){var p=Phenotype.get(t);p&&p.set.call(e,n)}},$type:function(e,t){var n,o={};return"text"===e.$type?(e.$text&&"function"==typeof e.$text&&(e.$text=Phenotype.multiline(e.$text)),n=$root.document.createTextNode(e.$text)):"svg"===e.$type?(n=$root.document.createElementNS("http://www.w3.org/2000/svg",e.$type),o.namespace=n.namespaceURI):t?(n=$root.document.createElementNS(t,e.$type),o.namespace=n.namespaceURI):n="fragment"===e.$type?$root.document.createDocumentFragment():$root.document.createElement(e.$type||"div"),n.Meta=o,n},$components:function(e,t){t||(t=[]);var n=[].map.call(e.childNodes,function(e){return e.Genotype}).filter(function(e){return e});if(n.length>0){var o=Gene.diff(n,t);o["-"].forEach(function(t){e.childNodes[t.index].Kill=!0}),[].filter.call(e.childNodes,function(e){return e.Kill}).forEach(function(t){e.removeChild(t)}),o["+"].forEach(function(t){var n=e.Inheritance;for(var o in e.Genotype)"_"===o[0]&&(n=n.concat([o]));e.$build(t.item,n,t.index,e.Meta.namespace),e.$components[t.index]=e.childNodes[t.index].Genotype})}else{var r=Phenotype.$type({$type:"fragment"}),i=e.Inheritance;for(var u in e.Genotype)"_"===u[0]&&(i=i.concat([u]));for(;e.firstChild;)e.removeChild(e.firstChild);t.forEach(function(t){r.$build(t,i,null,e.Meta.namespace)}),e.appendChild(r),e.$components=[].map.call(e.childNodes,function(e){return e.Genotype})}},$init:function(e){Nucleus.tick.call($root,function(){e.Genotype&&e.Genotype.$init&&Nucleus.bind(e,e.Genotype.$init)()})},$update:function(e){if(e.parentNode&&!e.Meta.$updated&&e.$update){e.Meta.$updated=!0,e.$update();for(var t in e.Dirty)Phenotype.set(e,t,e.Genotype[t]);e.Meta.$updated=!1,e.Dirty=null}}},Nucleus={tick:$root.requestAnimationFrame||$root.webkitRequestAnimationFrame||$root.mozRequestAnimationFrame||$root.msRequestAnimationFrame||function(e){return $root.setTimeout(e,1e3/60)},set:function(e,t){Object.defineProperty(e,t,{configurable:!0,get:function(){if("$"!==t[0]&&"_"!==t[0])return"value"===t?Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).get.call(e):"style"===t?Phenotype.get(t).get.call(e):t in e.Genotype?e.Genotype[t]:Phenotype.get(t).get.call(e);if(t in e.Genotype)return Nucleus.queue(e,t,"r"),e.Genotype[t];if("_"!==t[0])return null;for(var n=e;n=n.parentNode;)if(n&&n.Genotype&&t in n.Genotype)return Nucleus.queue(n,t,"r"),n.Genotype[t]},set:function(n){var o=e;if(!(t in e.Genotype)&&"_"===t[0])for(;(o=o.parentNode)&&!(o&&o.Genotype&&t in o.Genotype););if(Genotype.update(o,t,n),"$"!==t[0]&&"_"!==t[0]){if("value"===t)return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).set.call(e,n);"style"===t&&"object"==typeof n?Phenotype.get(t).set.call(e,n):"number"==typeof n||"string"==typeof n||"boolean"==typeof n?e.setAttribute(t,n):"function"==typeof n&&Phenotype.get(t).set.call(e,n)}}})},build:function(e){["$type","$text","$html","$components"].forEach(function(t){t in e.Genotype||Nucleus.set(e,t)}),e.Inheritance&&e.Inheritance.forEach(function(t){Nucleus.set(e,t)});for(var t in e.Genotype)Nucleus.set(e,t)},_queue:[],bind:function(e,t){if("function"==typeof t){var n=function(){return Nucleus.tick.call($root,function(){Nucleus._queue.forEach(function(e){var t=!1;for(var n in e.Dirty)Gene.freeze(e.Genotype[n])!==e.Dirty[n]&&(Phenotype.set(e,n,e.Genotype[n]),"_"===n[0]&&(t=!0));t&&"$update"in e.Genotype&&"function"==typeof e.Genotype.$update?Phenotype.$update(e):e.Dirty=null});var t=Nucleus._queue.indexOf(e);-1!==t&&Nucleus._queue.splice(t,1)}),t.apply(e,arguments)};return n.snapshot=t,n}return t},queue:function(e,t,n){var o=e.Genotype[t];("r"!==n||"object"==typeof o||Array.isArray(o))&&(-1===Nucleus._queue.indexOf(e)&&Nucleus._queue.push(e),e.Dirty||(e.Dirty={}),t in e.Dirty||(e.Dirty[t]=Gene.freeze(e.Genotype[t])))}},God={detect:function(e){return void 0===e&&(e=this),Object.keys(e).filter(function(t){try{return!(/webkitStorageInfo|webkitIndexedDB/.test(t)||e[t]instanceof $root.Element)&&(e[t]&&Object.prototype.hasOwnProperty.call(e[t],"$cell"))}catch(e){return!1}}).map(function(t){return e[t]})},plan:function($context){void 0===$context?$context=$root:$root=$context,$context.DocumentFragment.prototype.$build=$context.Element.prototype.$build=function(e,t,n,o,r){var i=Membrane.build(this,e,n,o,r);return Genotype.build(i,e,t||[],n),Nucleus.build(i),Phenotype.build(i,i.Genotype),i},$context.DocumentFragment.prototype.$cell=$context.Element.prototype.$cell=function(e,t){return this.$build(e,[],null,t&&t.namespace||null,!0)},$context.DocumentFragment.prototype.$snapshot=$context.Element.prototype.$snapshot=function(){var json=JSON.stringify(this.Genotype,function(e,t){return"function"==typeof t&&t.snapshot?"("+t.snapshot.toString()+")":t});return JSON.parse(json,function(k,v){return"string"==typeof v&&v.indexOf("function")>=0?eval(v):v})},$root.NodeList&&!$root.NodeList.prototype.forEach&&($root.NodeList.prototype.forEach=Array.prototype.forEach)},create:function(e){return God.detect(e).map(function(t){return e.document.body.$build(t,[])})}};if("undefined"!=typeof exports){var x={Phenotype:Phenotype,Genotype:Genotype,Nucleus:Nucleus,Gene:Gene,Membrane:Membrane,God:God,plan:God.plan.bind(God),create:God.create.bind(God)};"undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports=x}else God.plan(this),this.addEventListener&&this.addEventListener("load",function(){God.create(this)})}(this);