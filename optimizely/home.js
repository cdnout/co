!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.optimizelyClient=e():t.optimizelyClient=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=66)}([function(t,e){var r=Array.isArray;t.exports=r},function(t,e){e.LOG_LEVEL={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},e.ERROR_MESSAGES={EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_KEY:"%s: Event key %s is not in datafile.",INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",JSON_SCHEMA_EXPECTED:"%s: JSON schema expected.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s."},e.LOG_MESSAGES={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_NOT_ASSOCIATED_WITH_EXPERIMENTS:"%s: Event %s is not associated with any running experiments.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",NOT_TRACKING_USER_FOR_EXPERIMENT:"%s: Not tracking user %s for experiment %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is in "Launched" state. Not activating user.',SHOULD_NOT_DISPATCH_TRACK:'%s: Experiment %s is in "Launched" state. Not tracking user for it.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",USER_ASSIGNED_TO_VARIATION_BUCKET:"%s: Assigned variation bucket %s to user %s.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned experiment bucket %s to user %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s."},e.RESERVED_EVENT_KEYWORDS={REVENUE:"revenue",VALUE:"value"},e.JAVASCRIPT_CLIENT_ENGINE="javascript-sdk",e.NEW_OPTIMIZELY_VERSION="2",e.NODE_CLIENT_ENGINE="node-sdk",e.NODE_CLIENT_VERSION="1.5.0",e.NOTIFICATION_TYPES={ACTIVATE:"ACTIVATE:experiment, user_id,attributes, variation, event",TRACK:"TRACK:event_key, user_id, attributes, event_tags, event"}},function(t,e){var r=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function e(t,e){for(var r=[];e>0;r[--e]=t);return r.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.object_stringify=function(t,e,r,i){var o="";if(null!=t)switch(typeof t){case"function":return"[Function"+(t.name?": "+t.name:"")+"]";case"object":if(t instanceof Error)return"["+t.toString()+"]";if(e>=r)return"[Object]";if(i&&(i=i.slice(0),i.push(t)),null!=t.length){o+="[";var a=[];for(var s in t)i&&i.indexOf(t[s])>=0?a.push("[Circular]"):a.push(n.object_stringify(t[s],e+1,r,i));o+=a.join(", ")+"]"}else{if("getMonth"in t)return"Date("+t+")";o+="{";var a=[];for(var u in t)t.hasOwnProperty(u)&&(i&&i.indexOf(t[u])>=0?a.push(u+": [Circular]"):a.push(u+": "+n.object_stringify(t[u],e+1,r,i)));o+=a.join(", ")+"}"}return o;case"string":return'"'+t+'"'}return""+t},n.format=function(i,o){var a,s,u,c,f,p,l,E=1,_=i.length,v="",g=[];for(s=0;s<_;s++)if("string"===(v=t(i[s])))g.push(i[s]);else if("array"===v){if(c=i[s],c[2])for(a=o[E],u=0;u<c[2].length;u++){if(!a.hasOwnProperty(c[2][u]))throw new Error(r('[sprintf] property "%s" does not exist',c[2][u]));a=a[c[2][u]]}else a=c[1]?o[c[1]]:o[E++];if(/[^sO]/.test(c[8])&&"number"!=t(a))throw new Error(r('[sprintf] expecting number but found %s "'+a+'"',t(a)));switch(c[8]){case"b":a=a.toString(2);break;case"c":a=String.fromCharCode(a);break;case"d":a=parseInt(a,10);break;case"e":a=c[7]?a.toExponential(c[7]):a.toExponential();break;case"f":a=c[7]?parseFloat(a).toFixed(c[7]):parseFloat(a);break;case"O":a=n.object_stringify(a,0,parseInt(c[7])||5);break;case"o":a=a.toString(8);break;case"s":a=(a=String(a))&&c[7]?a.substring(0,c[7]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(c[8])&&c[3]&&a>=0?"+"+a:a,p=c[4]?"0"==c[4]?"0":c[4].charAt(1):" ",l=c[6]-String(a).length,f=c[6]?e(p,l):"",g.push(c[5]?a+f:f+a)}return g.join("")},n.cache={},n.parse=function(t){for(var e=t,r=[],n=[],i=0;e;){if(null!==(r=/^[^\x25]+/.exec(e)))n.push(r[0]);else if(null!==(r=/^\x25{2}/.exec(e)))n.push("%");else{if(null===(r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosOuxX])/.exec(e)))throw new Error("[sprintf] "+e);if(r[2]){i|=1;var o=[],a=r[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw new Error("[sprintf] "+a);for(o.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))o.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw new Error("[sprintf] "+a);o.push(s[1])}r[2]=o}else i|=2;if(3===i)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n.push(r)}e=e.substring(r[0].length)}return n},n}(),n=function(t,e){var n=e.slice();return n.unshift(t),r.apply(null,n)};t.exports=r,r.sprintf=r,r.vsprintf=n},function(t,e,r){(function(e){var n=r(102),i=n("object"==typeof e&&e),o=n("object"==typeof self&&self),a=n("object"==typeof this&&this),s=i||o||a||Function("return this")();t.exports=s}).call(e,r(60))},function(t,e,r){function n(t){var e=c(t);if(!e&&!s(t))return o(t);var r=a(t),n=!!r,f=r||[],p=f.length;for(var l in t)!i(t,l)||n&&("length"==l||u(l,p))||e&&"constructor"==l||f.push(l);return f}var i=r(42),o=r(92),a=r(50),s=r(6),u=r(18),c=r(12);t.exports=n},function(t,e,r){var n=r(191);t.exports={assign:r(153),assignIn:r(154),cloneDeep:r(155),currentTimestamp:function(){return Math.round((new Date).getTime())},isArray:r(0),isEmpty:r(162),keyBy:r(164),filter:r(156),forEach:r(157),forOwn:r(56),map:r(166),reduce:r(169),uuid:function(){return n.v4()},values:r(177)}},function(t,e,r){function n(t){return null!=t&&a(i(t))&&!o(t)}var i=r(119),o=r(22),a=r(23);t.exports=n},function(t,e){function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=r},function(t,e,r){function n(t){return"function"==typeof t?t:null==t?a:"object"==typeof t?s(t)?o(t[0],t[1]):i(t):u(t)}var i=r(95),o=r(96),a=r(160),s=r(0),u=r(168);t.exports=n},function(t,e,r){function n(t,e){var r=o(t,e);return i(r)?r:void 0}var i=r(91),o=r(121);t.exports=n},function(t,e){function r(t){return!!t&&"object"==typeof t}t.exports=r},function(t,e,r){var n=r(40),i=r(114),o=i(n);t.exports=o},function(t,e){function r(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}var n=Object.prototype;t.exports=r},function(t,e,r){function n(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}var i=r(135),o=r(136),a=r(137),s=r(138),u=r(139);n.prototype.clear=i,n.prototype.delete=o,n.prototype.get=a,n.prototype.has=s,n.prototype.set=u,t.exports=n},function(t,e,r){function n(t,e,r){var n=t[e];a.call(t,e)&&i(n,r)&&(void 0!==r||e in t)||(t[e]=r)}var i=r(32),o=Object.prototype,a=o.hasOwnProperty;t.exports=n},function(t,e,r){function n(t,e){for(var r=t.length;r--;)if(i(t[r][0],e))return r;return-1}var i=r(32);t.exports=n},function(t,e,r){function n(t,e,r,n){r||(r={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=n?n(r[s],t[s],s,r,t):t[s];i(r,s,u)}return r}var i=r(14);t.exports=n},function(t,e,r){function n(t,e){var r=t.__data__;return i(e)?r["string"==typeof e?"string":"hash"]:r.map}var i=r(132);t.exports=n},function(t,e){function r(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||i.test(t))&&t>-1&&t%1==0&&t<e}var n=9007199254740991,i=/^(?:0|[1-9]\d*)$/;t.exports=r},function(t,e,r){function n(t,e){if(i(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!o(t))||(s.test(t)||!a.test(t)||null!=e&&t in Object(e))}var i=r(0),o=r(24),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;t.exports=n},function(t,e,r){var n=r(9),i=n(Object,"create");t.exports=i},function(t,e,r){function n(t){if("string"==typeof t||i(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}var i=r(24),o=1/0;t.exports=n},function(t,e,r){function n(t){var e=i(t)?u.call(t):"";return e==o||e==a}var i=r(7),o="[object Function]",a="[object GeneratorFunction]",s=Object.prototype,u=s.toString;t.exports=n},function(t,e){function r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}var n=9007199254740991;t.exports=r},function(t,e,r){function n(t){return"symbol"==typeof t||i(t)&&s.call(t)==o}var i=r(10),o="[object Symbol]",a=Object.prototype,s=a.toString;t.exports=n},function(t,e,r){function n(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}var i=r(140),o=r(141),a=r(142),s=r(143),u=r(144);n.prototype.clear=i,n.prototype.delete=o,n.prototype.get=a,n.prototype.has=s,n.prototype.set=u,t.exports=n},function(t,e,r){function n(t){this.__data__=new i(t)}var i=r(13),o=r(147),a=r(148),s=r(149),u=r(150),c=r(151);n.prototype.clear=o,n.prototype.delete=a,n.prototype.get=s,n.prototype.has=u,n.prototype.set=c,t.exports=n},function(t,e,r){var n=r(3),i=n.Symbol;t.exports=i},function(t,e){function r(t,e,r,n){var i=-1,o=t?t.length:0;for(n&&o&&(r=t[++i]);++i<o;)r=e(r,t[i],i,t);return r}t.exports=r},function(t,e,r){function n(t){var e=new t.constructor(t.byteLength);return new i(e).set(new i(t)),e}var i=r(37);t.exports=n},function(t,e,r){function n(t){return p.call(t)}var i=r(67),o=r(36),a=r(69),s=r(71),u=r(73),c=r(55),f=Object.prototype,p=f.toString,l=c(i),E=c(o),_=c(a),v=c(s),g=c(u);(i&&"[object DataView]"!=n(new i(new ArrayBuffer(1)))||o&&"[object Map]"!=n(new o)||a&&"[object Promise]"!=n(a.resolve())||s&&"[object Set]"!=n(new s)||u&&"[object WeakMap]"!=n(new u))&&(n=function(t){var e=p.call(t),r="[object Object]"==e?t.constructor:void 0,n=r?c(r):void 0;if(n)switch(n){case l:return"[object DataView]";case E:return"[object Map]";case _:return"[object Promise]";case v:return"[object Set]";case g:return"[object WeakMap]"}return e}),t.exports=n},function(t,e){function r(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}t.exports=r},function(t,e){function r(t,e){return t===e||t!==t&&e!==e}t.exports=r},function(t,e,r){function n(t){return i(t)&&s.call(t,"callee")&&(!c.call(t,"callee")||u.call(t)==o)}var i=r(161),o="[object Arguments]",a=Object.prototype,s=a.hasOwnProperty,u=a.toString,c=a.propertyIsEnumerable;t.exports=n},function(t,e,r){function n(t){return"string"==typeof t||!i(t)&&o(t)&&u.call(t)==a}var i=r(0),o=r(10),a="[object String]",s=Object.prototype,u=s.toString;t.exports=n},function(t,e,r){var n=r(5),i=r(1),o=r(2),a="PROJECT_CONFIG",s=i.ERROR_MESSAGES,u=i.LOG_MESSAGES,c=i.LOG_LEVEL;t.exports={createProjectConfig:function(t){var e=n.cloneDeep(t);n.forEach(e.audiences,function(t){t.conditions=JSON.parse(t.conditions)}),e.attributeKeyMap=n.keyBy(e.attributes,"key"),e.eventKeyMap=n.keyBy(e.events,"key"),e.groupIdMap=n.keyBy(e.groups,"id");var r;return n.forEach(e.groupIdMap,function(t,i){r=n.cloneDeep(t.experiments),n.forEach(r,function(t){e.experiments.push(n.assignIn(t,{groupId:i}))})}),e.experimentKeyMap=n.keyBy(e.experiments,"key"),e.experimentIdMap=n.keyBy(e.experiments,"id"),e.variationIdMap={},n.forEach(e.experiments,function(t){t.variationKeyMap=n.keyBy(t.variations,"key"),n.assignIn(e.variationIdMap,n.keyBy(t.variations,"id"))}),e.forcedVariationMap={},e},getExperimentId:function(t,e){var r=t.experimentKeyMap[e];if(n.isEmpty(r))throw new Error(o(s.INVALID_EXPERIMENT_KEY,a,e));return r.id},getLayerId:function(t,e){var r=t.experimentIdMap[e];if(n.isEmpty(r))throw new Error(o(s.INVALID_EXPERIMENT_ID,a,e));return r.layerId},getAttributeId:function(t,e){var r=t.attributeKeyMap[e];return r?r.id:null},getEventId:function(t,e){var r=t.eventKeyMap[e];return r?r.id:null},getExperimentStatus:function(t,e){var r=t.experimentKeyMap[e];if(n.isEmpty(r))throw new Error(o(s.INVALID_EXPERIMENT_KEY,a,e));return r.status},isActive:function(e,r){return"Running"===t.exports.getExperimentStatus(e,r)||"Launched"===t.exports.getExperimentStatus(e,r)},isRunning:function(e,r){return"Running"===t.exports.getExperimentStatus(e,r)},getAudiencesForExperiment:function(t,e){var r=t.experimentKeyMap[e];if(n.isEmpty(r))throw new Error(o(s.INVALID_EXPERIMENT_KEY,a,e));var i=r.audienceIds;return n.filter(t.audiences,function(t){return-1!==i.indexOf(t.id)})},getVariationKeyFromId:function(t,e){return t.variationIdMap.hasOwnProperty(e)?t.variationIdMap[e].key:null},getVariationIdFromExperimentAndVariationKey:function(t,e,r){var n=t.experimentKeyMap[e];return n.variationKeyMap.hasOwnProperty(r)?n.variationKeyMap[r].id:null},getExperimentFromKey:function(t,e){if(t.experimentKeyMap.hasOwnProperty(e)){var r=t.experimentKeyMap[e];if(r)return r}throw new Error(o(s.EXPERIMENT_KEY_NOT_IN_DATAFILE,a,e))},getExperimentIdsForEvent:function(t,e){var r=t.eventKeyMap[e];if(r)return r.experimentIds.length>0?r.experimentIds:null;throw new Error(o(s.INVALID_EVENT_KEY,a,e))},getTrafficAllocation:function(t,e){var r=t.experimentKeyMap[e];if(n.isEmpty(r))throw new Error(o(s.INVALID_EXPERIMENT_KEY,a,e));return r.trafficAllocation},removeForcedVariation:function(t,e,r,n,i){if(!e)throw new Error(o(s.INVALID_USER_ID,a));if(!t.forcedVariationMap.hasOwnProperty(e))throw new Error(o(s.USER_NOT_IN_FORCED_VARIATION,a,e));delete t.forcedVariationMap[e][r],i.log(c.DEBUG,o(u.VARIATION_REMOVED_FOR_USER,a,n,e))},setInForcedVariationMap:function(t,e,r,n,i){if(!e)throw new Error(o(s.INVALID_USER_ID,a));t.forcedVariationMap.hasOwnProperty(e)?t.forcedVariationMap[e][r]=n:(t.forcedVariationMap[e]={},t.forcedVariationMap[e][r]=n),i.log(c.DEBUG,o(u.USER_MAPPED_TO_FORCED_VARIATION,a,n,r,e))},getForcedVariation:function(t,e,r,n){var i=t.forcedVariationMap[r];if(!i)return n.log(c.DEBUG,o(u.USER_HAS_NO_FORCED_VARIATION,a,r)),null;var f;try{var p=this.getExperimentFromKey(t,e);if(!p.hasOwnProperty("id"))return n.log(c.ERROR,o(s.IMPROPERLY_FORMATTED_EXPERIMENT,a,e)),null;f=p.id}catch(t){return n.log(c.ERROR,t.message),null}var l=i[f];if(!l)return n.log(c.DEBUG,o(u.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,a,e,r)),null;var E=this.getVariationKeyFromId(t,l);return n.log(c.DEBUG,o(u.USER_HAS_FORCED_VARIATION,a,E,e,r)),E},setForcedVariation:function(t,e,r,n,i){var u;try{var f=this.getExperimentFromKey(t,e);if(!f.hasOwnProperty("id"))return i.log(c.ERROR,o(s.IMPROPERLY_FORMATTED_EXPERIMENT,a,e)),!1;u=f.id}catch(t){return i.log(c.ERROR,t.message),!1}if(!n)try{return this.removeForcedVariation(t,r,u,e,i),!0}catch(t){return i.log(c.ERROR,t.message),!1}var p=this.getVariationIdFromExperimentAndVariationKey(t,e,n);if(!p)return i.log(c.ERROR,o(s.NO_VARIATION_FOR_EXPERIMENT_KEY,a,n,e)),!1;try{return this.setInForcedVariationMap(t,r,u,p,i),!0}catch(t){return i.log(c.ERROR,t.message),!1}}}},function(t,e,r){var n=r(9),i=r(3),o=n(i,"Map");t.exports=o},function(t,e,r){var n=r(3),i=n.Uint8Array;t.exports=i},function(t,e){function r(t,e){for(var r=-1,n=t?t.length:0;++r<n&&!1!==e(t[r],r,t););return t}t.exports=r},function(t,e){function r(t,e){for(var r=-1,n=t?t.length:0,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}t.exports=r},function(t,e,r){function n(t,e){return t&&i(t,e,o)}var i=r(86),o=r(4);t.exports=n},function(t,e,r){function n(t,e){e=o(e,t)?[e]:i(e);for(var r=0,n=e.length;null!=t&&r<n;)t=t[a(e[r++])];return r&&r==n?t:void 0}var i=r(45),o=r(19),a=r(21);t.exports=n},function(t,e,r){function n(t,e){return null!=t&&(a.call(t,e)||"object"==typeof t&&e in t&&null===i(t))}var i=r(48),o=Object.prototype,a=o.hasOwnProperty;t.exports=n},function(t,e,r){function n(t,e,r,s,u){return t===e||(null==t||null==e||!o(t)&&!a(e)?t!==t&&e!==e:i(t,e,n,r,s,u))}var i=r(89),o=r(7),a=r(10);t.exports=n},function(t,e){function r(t){return function(e){return null==e?void 0:e[t]}}t.exports=r},function(t,e,r){function n(t){return i(t)?t:o(t)}var i=r(0),o=r(152);t.exports=n},function(t,e,r){function n(t){return o(function(e,r){var n=-1,o=r.length,a=o>1?r[o-1]:void 0,s=o>2?r[2]:void 0;for(a=t.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(r[0],r[1],s)&&(a=o<3?void 0:a,o=1),e=Object(e);++n<o;){var u=r[n];u&&t(e,u,n,a)}return e})}var i=r(131),o=r(170);t.exports=n},function(t,e,r){function n(t,e,r,n,u,c){var f=u&s,p=t.length,l=e.length;if(p!=l&&!(f&&l>p))return!1;var E=c.get(t);if(E)return E==e;var _=-1,v=!0,g=u&a?new i:void 0;for(c.set(t,e);++_<p;){var d=t[_],I=e[_];if(n)var h=f?n(I,d,_,e,t,c):n(d,I,_,t,e,c);if(void 0!==h){if(h)continue;v=!1;break}if(g){if(!o(e,function(t,e){if(!g.has(e)&&(d===t||r(d,t,n,u,c)))return g.add(e)})){v=!1;break}}else if(d!==I&&!r(d,I,n,u,c)){v=!1;break}}return c.delete(t),v}var i=r(72),o=r(80),a=1,s=2;t.exports=n},function(t,e){function r(t){return n(Object(t))}var n=Object.getPrototypeOf;t.exports=r},function(t,e,r){function n(t){return o(Object(t))}var i=r(171),o=Object.getOwnPropertySymbols;o||(n=i),t.exports=n},function(t,e,r){function n(t){var e=t?t.length:void 0;return s(e)&&(a(t)||u(t)||o(t))?i(e,String):null}var i=r(99),o=r(33),a=r(0),s=r(23),u=r(34);t.exports=n},function(t,e,r){function n(t){return t===t&&!i(t)}var i=r(7);t.exports=n},function(t,e){function r(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}t.exports=r},function(t,e){function r(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}t.exports=r},function(t,e){function r(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}t.exports=r},function(t,e){function r(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var n=Function.prototype.toString;t.exports=r},function(t,e,r){function n(t,e){return t&&i(t,o(e,3))}var i=r(40),o=r(8);t.exports=n},function(t,e,r){(function(t){var n=r(3),i=r(172),o="object"==typeof e&&e,a=o&&"object"==typeof t&&t,s=a&&a.exports===o,u=s?n.Buffer:void 0,c=u?function(t){return t instanceof u}:i;t.exports=c}).call(e,r(194)(t))},function(t,e){function r(t,e){var r=e||0,i=n;return i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]}for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=r},function(t,e,r){(function(e){var r,n=e.crypto||e.msCrypto;if(n&&n.getRandomValues){var i=new Uint8Array(16);r=function(){return n.getRandomValues(i),i}}if(!r){var o=new Array(16);r=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o}}t.exports=r}).call(e,r(60))},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){var n=r(5);t.exports={dispatchEvent:function(t,e){var r=t.url,n=t.params;if("POST"===t.httpVerb){var o=new XMLHttpRequest;o.open("POST",r,!0),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){4===o.readyState&&e&&"function"==typeof e&&e(n)},o.send(JSON.stringify(n))}else{r+="?wxhr=true",n&&(r+="&"+i(n));var o=new XMLHttpRequest;o.open("GET",r,!0),o.onreadystatechange=function(){4===o.readyState&&e&&"function"==typeof e&&e()},o.send()}}};var i=function(t){return n.map(t,function(t,e){return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&")}},function(t,e,r){function n(t){var e=t.clientEngine;if(e!==s.NODE_CLIENT_ENGINE&&e!==s.JAVASCRIPT_CLIENT_ENGINE&&(t.logger.log(d.INFO,E(I.INVALID_CLIENT_ENGINE,h,e)),e=s.NODE_CLIENT_ENGINE),this.clientEngine=e,this.clientVersion=t.clientVersion||s.NODE_CLIENT_VERSION,this.errorHandler=t.errorHandler,this.eventDispatcher=t.eventDispatcher,this.isValidInstance=t.isValidInstance,this.logger=t.logger,t.datafile){if(!0===t.skipJSONValidation)this.configObj=p.createProjectConfig(t.datafile),this.logger.log(d.INFO,E(I.SKIPPING_JSON_VALIDATION,h));else try{t.jsonSchemaValidator.validate(l,t.datafile)&&(this.configObj=p.createProjectConfig(t.datafile),this.logger.log(d.INFO,E(I.VALID_DATAFILE,h)))}catch(t){this.isValidInstance=!1,this.logger.log(d.ERROR,t.message),this.errorHandler.handleError(t)}var r=null;if(t.userProfileService)try{v.validate(t.userProfileService)&&(r=t.userProfileService,this.logger.log(d.INFO,E(I.VALID_USER_PROFILE_SERVICE,h)))}catch(t){this.logger.log(d.WARNING,t.message)}this.decisionService=a.createDecisionService({configObj:this.configObj,userProfileService:r,logger:this.logger}),this.notificationCenter=f.createNotificationCenter({logger:this.logger})}else this.logger.log(d.ERROR,E(g.NO_DATAFILE_SPECIFIED,h)),this.errorHandler.handleError(new Error(E(g.NO_DATAFILE_SPECIFIED,h))),this.isValidInstance=!1}var i=r(5),o=r(186),a=r(182),s=r(1),u=r(183),c=r(188),f=r(184),p=r(35),l=r(185),E=r(2),_=r(189),v=r(190),g=s.ERROR_MESSAGES,d=s.LOG_LEVEL,I=s.LOG_MESSAGES,h="OPTIMIZELY";n.prototype.activate=function(t,e,r){if(!this.isValidInstance)return this.logger.log(d.ERROR,E(I.INVALID_OBJECT,h,"activate")),null;try{var n=this.getVariation(t,e,r);if(null===n)return this.__notActivatingExperiment(t,e);if(!p.isRunning(this.configObj,t)){var i=E(I.SHOULD_NOT_DISPATCH_ACTIVATE,h,t);return this.logger.log(d.DEBUG,i),n}var o=p.getVariationIdFromExperimentAndVariationKey(this.configObj,t,n),a=p.getExperimentId(this.configObj,t);r=this.__filterEmptyValues(r);var c={attributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:this.configObj,experimentId:a,userId:e,variationId:o},f=u.getImpressionEvent(c),l=E(I.DISPATCH_IMPRESSION_EVENT,h,f.url,JSON.stringify(f.params));this.logger.log(d.DEBUG,l);var _=function(){var r=E(I.ACTIVATE_USER,h,e,t);this.logger.log(d.INFO,r)}.bind(this);this.__dispatchEvent(f,_);var v,g=this.configObj.experimentKeyMap[t];return g&&g.variationKeyMap&&(v=g.variationKeyMap[n]),this.notificationCenter.sendNotifications(s.NOTIFICATION_TYPES.ACTIVATE,{experiment:g,userId:e,attributes:r,variation:v,logEvent:f}),n}catch(r){this.logger.log(d.ERROR,r.message);var y=E(I.NOT_ACTIVATING_USER,h,e,t);return this.logger.log(d.INFO,y),this.errorHandler.handleError(r),null}},n.prototype.track=function(t,e,r,n){if(!this.isValidInstance)return void this.logger.log(d.ERROR,E(I.INVALID_OBJECT,h,"track"));"number"==typeof n&&isFinite(n)&&(this.logger.log(d.WARNING,E(I.DEPRECATED_EVENT_VALUE,h,"track")),n={revenue:n});try{if(!this.__validateInputs(e,r,n))return;var i=this.__getValidExperimentsForEvent(t,e,r);if(!Object.keys(i).length)return void this.logger.log(d.WARNING,E(I.EVENT_NOT_ASSOCIATED_WITH_EXPERIMENTS,h,t));r=this.__filterEmptyValues(r),n=this.__filterEmptyValues(n);var o={attributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:this.configObj,eventKey:t,eventTags:n,experimentsToVariationMap:i,logger:this.logger,userId:e},a=u.getConversionEvent(o),c=E(I.DISPATCH_CONVERSION_EVENT,h,a.url,JSON.stringify(a.params));this.logger.log(d.DEBUG,c);var f=function(){var r=E(I.TRACK_EVENT,h,t,e);this.logger.log(d.INFO,r)}.bind(this);this.__dispatchEvent(a,f),this.notificationCenter.sendNotifications(s.NOTIFICATION_TYPES.TRACK,{eventKey:t,userId:e,attributes:r,eventTags:n,logEvent:a})}catch(t){this.logger.log(d.ERROR,t.message);var p=E(I.NOT_TRACKING_USER,h,e);this.logger.log(d.INFO,p),this.errorHandler.handleError(t)}},n.prototype.getVariation=function(t,e,r){if(!this.isValidInstance)return this.logger.log(d.ERROR,E(I.INVALID_OBJECT,h,"getVariation")),null;try{if(!this.__validateInputs(e,r))return null;var n=this.configObj.experimentKeyMap[t];if(i.isEmpty(n))throw new Error(E(g.INVALID_EXPERIMENT_KEY,h,t));return this.decisionService.getVariation(t,e,r)}catch(t){return this.logger.log(d.ERROR,t.message),this.errorHandler.handleError(t),null}},n.prototype.setForcedVariation=function(t,e,r){try{return p.setForcedVariation(this.configObj,t,e,r,this.logger)}catch(t){return this.logger.log(d.ERROR,t.message),this.errorHandler.handleError(t),!1}},n.prototype.getForcedVariation=function(t,e){try{return p.getForcedVariation(this.configObj,t,e,this.logger)}catch(t){return this.logger.log(d.ERROR,t.message),this.errorHandler.handleError(t),null}},n.prototype.__validateInputs=function(t,e,r){try{return _.validate(t),e&&o.validate(e),r&&c.validate(r),!0}catch(t){return this.logger.log(d.ERROR,t.message),this.errorHandler.handleError(t),!1}},n.prototype.__getValidExperimentsForEvent=function(t,e,r){var n={},o=p.getExperimentIdsForEvent(this.configObj,t);return o?n=i.reduce(o,function(t,n){var i=this.configObj.experimentIdMap[n].key,o=this.getVariation(i,e,r);if(o)if(p.isRunning(this.configObj,i)){var a=p.getVariationIdFromExperimentAndVariationKey(this.configObj,i,o);t[n]=a}else{var s=E(I.SHOULD_NOT_DISPATCH_TRACK,h,i);this.logger.log(d.DEBUG,s)}else{var u=E(I.NOT_TRACKING_USER_FOR_EXPERIMENT,h,e,i);this.logger.log(d.DEBUG,u)}return t}.bind(this),{}):n},n.prototype.__notActivatingExperiment=function(t,e){var r=E(I.NOT_ACTIVATING_USER,h,e,t);return this.logger.log(d.INFO,r),null},n.prototype.__dispatchEvent=function(t,e){var r=this.eventDispatcher.dispatchEvent(t,e);"object"!=typeof r||r.hasOwnProperty("uri")||r.then(function(){e()})},n.prototype.__filterEmptyValues=function(t){for(var e in t)!t.hasOwnProperty(e)||null!==t[e]&&void 0!==t[e]||delete t[e];return t},t.exports=n},function(t,e){t.exports={handleError:function(t){}}},function(t,e,r){function n(){}function i(t){t=s.assignIn({logLevel:u.LOG_LEVEL.ERROR,logToConsole:!0,prefix:"[OPTIMIZELY]"},t),this.setLogLevel(t.logLevel),this.logToConsole=t.logToConsole,this.prefix=t.prefix}function o(t){switch(t){case u.LOG_LEVEL.DEBUG:return"DEBUG";case u.LOG_LEVEL.INFO:return"INFO";case u.LOG_LEVEL.WARNING:return"WARNING";case u.LOG_LEVEL.ERROR:return"ERROR";default:return"NOTSET"}}function a(){return new Date}var s=r(5),u=r(1);n.prototype.log=function(){},i.prototype.log=function(t,e){this.__shouldLog(t)&&(this.prefix&&(e=this.prefix+" - "+this.logLevelName+" "+a()+" "+e),this.logToConsole&&this.__consoleLog(t,[e]))},i.prototype.setLogLevel=function(t){this.logLevel=s.values(u.LOG_LEVEL).indexOf(t)>-1?t:u.LOG_LEVEL.ERROR,this.logLevelName=o(this.logLevel),this.log("Setting log level to "+t)},i.prototype.__shouldLog=function(t){return t>=this.logLevel},i.prototype.__consoleLog=function(t,e){switch(t){case u.LOG_LEVEL.DEBUG:case u.LOG_LEVEL.INFO:console.log.apply(console,e);break;case u.LOG_LEVEL.WARNING:console.warn.apply(console,e);break;case u.LOG_LEVEL.ERROR:console.error.apply(console,e);break;default:console.log.apply(console,e)}},t.exports={createLogger:function(t){return new i(t)},createNoOpLogger:function(){return new n}}},function(t,e,r){var n=r(2),i=r(1).ERROR_MESSAGES;t.exports={validate:function(t){if(t.errorHandler&&"function"!=typeof t.errorHandler.handleError)throw new Error(n(i.INVALID_ERROR_HANDLER,"CONFIG_VALIDATOR"));if(t.eventDispatcher&&"function"!=typeof t.eventDispatcher.dispatchEvent)throw new Error(n(i.INVALID_EVENT_DISPATCHER,"CONFIG_VALIDATOR"));if(t.logger&&"function"!=typeof t.logger.log)throw new Error(n(i.INVALID_LOGGER,"CONFIG_VALIDATOR"));return!0}}},function(t,e,r){var n=r(5),i=r(65),o=r(63),a=r(61),s=r(1),u=r(64),c=r(62);t.exports={createInstance:function(t){var e="logLevel"in t?t.logLevel:s.LOG_LEVEL.INFO,r=u.createLogger({logLevel:s.LOG_LEVEL.INFO});if(t)try{i.validate(t),t.isValidInstance=!0}catch(e){var f="INDEX:"+e.message;t.logger?t.logger.log(s.LOG_LEVEL.ERROR,f):r.log(s.LOG_LEVEL.ERROR,f),t.isValidInstance=!1}return null==t.skipJSONValidation&&(t.skipJSONValidation=!0),t=n.assignIn({clientEngine:s.JAVASCRIPT_CLIENT_ENGINE,clientVersion:"1.6.0",errorHandler:o,eventDispatcher:a,logger:u.createLogger({logLevel:e})},t),new c(t)}}},function(t,e,r){var n=r(9),i=r(3),o=n(i,"DataView");t.exports=o},function(t,e,r){function n(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}var i=r(123),o=r(124),a=r(125),s=r(126),u=r(127);n.prototype.clear=i,n.prototype.delete=o,n.prototype.get=a,n.prototype.has=s,n.prototype.set=u,t.exports=n},function(t,e,r){var n=r(9),i=r(3),o=n(i,"Promise");t.exports=o},function(t,e,r){var n=r(3),i=n.Reflect;t.exports=i},function(t,e,r){var n=r(9),i=r(3),o=n(i,"Set");t.exports=o},function(t,e,r){function n(t){var e=-1,r=t?t.length:0;for(this.__data__=new i;++e<r;)this.add(t[e])}var i=r(25),o=r(145),a=r(146);n.prototype.add=n.prototype.push=o,n.prototype.has=a,t.exports=n},function(t,e,r){var n=r(9),i=r(3),o=n(i,"WeakMap");t.exports=o},function(t,e){function r(t,e){return t.set(e[0],e[1]),t}t.exports=r},function(t,e){function r(t,e){return t.add(e),t}t.exports=r},function(t,e){function r(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}t.exports=r},function(t,e){function r(t,e,r,n){for(var i=-1,o=t?t.length:0;++i<o;){var a=t[i];e(n,a,r(a),t)}return n}t.exports=r},function(t,e){function r(t,e){for(var r=-1,n=t?t.length:0,i=0,o=[];++r<n;){var a=t[r];e(a,r,t)&&(o[i++]=a)}return o}t.exports=r},function(t,e){function r(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}t.exports=r},function(t,e){function r(t,e){for(var r=-1,n=t?t.length:0;++r<n;)if(e(t[r],r,t))return!0;return!1}t.exports=r},function(t,e,r){function n(t,e,r,n){return i(t,function(t,i,o){e(n,t,r(t),o)}),n}var i=r(11);t.exports=n},function(t,e,r){function n(t,e){return t&&i(e,o(e),t)}var i=r(16),o=r(4);t.exports=n},function(t,e,r){function n(t,e,r,b,T,m,S){var V;if(b&&(V=m?b(t,T,m,S):b(t)),void 0!==V)return V;if(!h(t))return t;var L=g(t);if(L){if(V=E(t),!e)return c(t,V)}else{var j=l(t),D=j==R||j==A;if(d(t))return u(t,e);if(j==N||j==O||D&&!m){if(I(t))return m?t:{};if(V=v(D?{}:t),!e)return f(t,s(V,t))}else{if(!x[j])return m?t:{};V=_(t,j,n,e)}}S||(S=new i);var w=S.get(t);if(w)return w;if(S.set(t,V),!L)var P=r?p(t):y(t);return o(P||t,function(i,o){P&&(o=i,i=t[o]),a(V,o,n(i,e,r,b,o,t,S))}),V}var i=r(26),o=r(38),a=r(14),s=r(82),u=r(103),c=r(110),f=r(111),p=r(118),l=r(30),E=r(128),_=r(129),v=r(130),g=r(0),d=r(57),I=r(31),h=r(7),y=r(4),O="[object Arguments]",R="[object Function]",A="[object GeneratorFunction]",N="[object Object]",x={};x[O]=x["[object Array]"]=x["[object ArrayBuffer]"]=x["[object DataView]"]=x["[object Boolean]"]=x["[object Date]"]=x["[object Float32Array]"]=x["[object Float64Array]"]=x["[object Int8Array]"]=x["[object Int16Array]"]=x["[object Int32Array]"]=x["[object Map]"]=x["[object Number]"]=x[N]=x["[object RegExp]"]=x["[object Set]"]=x["[object String]"]=x["[object Symbol]"]=x["[object Uint8Array]"]=x["[object Uint8ClampedArray]"]=x["[object Uint16Array]"]=x["[object Uint32Array]"]=!0,x["[object Error]"]=x[R]=x["[object WeakMap]"]=!1,t.exports=n},function(t,e,r){function n(t){return i(t)?o(t):{}}var i=r(7),o=Object.create;t.exports=n},function(t,e,r){function n(t,e){var r=[];return i(t,function(t,n,i){e(t,n,i)&&r.push(t)}),r}var i=r(11);t.exports=n},function(t,e,r){var n=r(115),i=n();t.exports=i},function(t,e,r){function n(t,e,r){var n=e(t);return o(t)?n:i(n,r(t))}var i=r(79),o=r(0);t.exports=n},function(t,e){function r(t,e){return null!=t&&e in Object(t)}t.exports=r},function(t,e,r){function n(t,e,r,n,g,I){var h=c(t),y=c(e),O=_,R=_;h||(O=u(t),O=O==E?v:O),y||(R=u(e),R=R==E?v:R);var A=O==v&&!f(t),N=R==v&&!f(e),x=O==R;if(x&&!A)return I||(I=new i),h||p(t)?o(t,e,r,n,g,I):a(t,e,O,r,n,g,I);if(!(g&l)){var b=A&&d.call(t,"__wrapped__"),T=N&&d.call(e,"__wrapped__");if(b||T){var m=b?t.value():t,S=T?e.value():e;return I||(I=new i),r(m,S,n,g,I)}}return!!x&&(I||(I=new i),s(t,e,r,n,g,I))}var i=r(26),o=r(47),a=r(116),s=r(117),u=r(30),c=r(0),f=r(31),p=r(163),l=2,E="[object Arguments]",_="[object Array]",v="[object Object]",g=Object.prototype,d=g.hasOwnProperty;t.exports=n},function(t,e,r){function n(t,e,r,n){var u=r.length,c=u,f=!n;if(null==t)return!c;for(t=Object(t);u--;){var p=r[u];if(f&&p[2]?p[1]!==t[p[0]]:!(p[0]in t))return!1}for(;++u<c;){p=r[u];var l=p[0],E=t[l],_=p[1];if(f&&p[2]){if(void 0===E&&!(l in t))return!1}else{var v=new i;if(n)var g=n(E,_,l,t,e,v);if(!(void 0===g?o(_,E,n,a|s,v):g))return!1}}return!0}var i=r(26),o=r(43),a=1,s=2;t.exports=n},function(t,e,r){function n(t){return!(!s(t)||a(t))&&(i(t)||o(t)?_:f).test(u(t))}var i=r(22),o=r(31),a=r(133),s=r(7),u=r(55),c=/[\\^$.*+?()[\]{}|]/g,f=/^\[object .+?Constructor\]$/,p=Object.prototype,l=Function.prototype.toString,E=p.hasOwnProperty,_=RegExp("^"+l.call(E).replace(c,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=n},function(t,e){function r(t){return n(Object(t))}var n=Object.keys;t.exports=r},function(t,e,r){function n(t){t=null==t?t:Object(t);var e=[];for(var r in t)e.push(r);return e}var i=r(70),o=r(134),a=Object.prototype,s=i?i.enumerate:void 0,u=a.propertyIsEnumerable;s&&!u.call({valueOf:1},"valueOf")&&(n=function(t){return o(s(t))}),t.exports=n},function(t,e,r){function n(t,e){var r=-1,n=o(t)?Array(t.length):[];return i(t,function(t,i,o){n[++r]=e(t,i,o)}),n}var i=r(11),o=r(6);t.exports=n},function(t,e,r){function n(t){var e=o(t);return 1==e.length&&e[0][2]?a(e[0][0],e[0][1]):function(r){return r===t||i(r,t,e)}}var i=r(90),o=r(120),a=r(53);t.exports=n},function(t,e,r){function n(t,e){return s(t)&&u(e)?c(f(t),e):function(r){var n=o(r,t);return void 0===n&&n===e?a(r,t):i(e,n,void 0,p|l)}}var i=r(43),o=r(158),a=r(159),s=r(19),u=r(51),c=r(53),f=r(21),p=1,l=2;t.exports=n},function(t,e,r){function n(t){return function(e){return i(e,t)}}var i=r(41);t.exports=n},function(t,e){function r(t,e,r,n,i){return i(t,function(t,i,o){r=n?(n=!1,t):e(r,t,i,o)}),r}t.exports=r},function(t,e){function r(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}t.exports=r},function(t,e,r){function n(t){if("string"==typeof t)return t;if(o(t))return u?u.call(t):"";var e=t+"";return"0"==e&&1/t==-a?"-0":e}var i=r(27),o=r(24),a=1/0,s=i?i.prototype:void 0,u=s?s.toString:void 0;t.exports=n},function(t,e,r){function n(t,e){return i(e,function(e){return t[e]})}var i=r(39);t.exports=n},function(t,e){function r(t){return t&&t.Object===Object?t:null}t.exports=r},function(t,e){function r(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}t.exports=r},function(t,e,r){function n(t,e){var r=e?i(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var i=r(29);t.exports=n},function(t,e,r){function n(t,e,r){var n=e?r(a(t),!0):a(t);return o(n,i,new t.constructor)}var i=r(74),o=r(28),a=r(52);t.exports=n},function(t,e){function r(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}var n=/\w*$/;t.exports=r},function(t,e,r){function n(t,e,r){var n=e?r(a(t),!0):a(t);return o(n,i,new t.constructor)}var i=r(75),o=r(28),a=r(54);t.exports=n},function(t,e,r){function n(t){return a?Object(a.call(t)):{}}var i=r(27),o=i?i.prototype:void 0,a=o?o.valueOf:void 0;t.exports=n},function(t,e,r){function n(t,e){var r=e?i(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var i=r(29);t.exports=n},function(t,e){function r(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}t.exports=r},function(t,e,r){function n(t,e){return i(t,o(t),e)}var i=r(16),o=r(49);t.exports=n},function(t,e,r){var n=r(3),i=n["__core-js_shared__"];t.exports=i},function(t,e,r){function n(t,e){return function(r,n){var u=s(r)?i:o,c=e?e():{};return u(r,t,a(n),c)}}var i=r(77),o=r(81),a=r(8),s=r(0);t.exports=n},function(t,e,r){function n(t,e){return function(r,n){if(null==r)return r;if(!i(r))return t(r,n);for(var o=r.length,a=e?o:-1,s=Object(r);(e?a--:++a<o)&&!1!==n(s[a],a,s););return r}}var i=r(6);t.exports=n},function(t,e){function r(t){return function(e,r,n){for(var i=-1,o=Object(e),a=n(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===r(o[u],u,o))break}return e}}t.exports=r},function(t,e,r){function n(t,e,r,n,i,R,N){switch(r){case O:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case y:return!(t.byteLength!=e.byteLength||!n(new o(t),new o(e)));case p:case l:return+t==+e;case E:return t.name==e.name&&t.message==e.message;case v:return t!=+t?e!=+e:t==+e;case g:case I:return t==e+"";case _:var x=s;case d:var b=R&f;if(x||(x=u),t.size!=e.size&&!b)return!1;var T=N.get(t);return T?T==e:(R|=c,N.set(t,e),a(x(t),x(e),n,i,R,N));case h:if(A)return A.call(t)==A.call(e)}return!1}var i=r(27),o=r(37),a=r(47),s=r(52),u=r(54),c=1,f=2,p="[object Boolean]",l="[object Date]",E="[object Error]",_="[object Map]",v="[object Number]",g="[object RegExp]",d="[object Set]",I="[object String]",h="[object Symbol]",y="[object ArrayBuffer]",O="[object DataView]",R=i?i.prototype:void 0,A=R?R.valueOf:void 0;t.exports=n},function(t,e,r){function n(t,e,r,n,s,u){var c=s&a,f=o(t),p=f.length;if(p!=o(e).length&&!c)return!1;for(var l=p;l--;){var E=f[l];if(!(c?E in e:i(e,E)))return!1}var _=u.get(t);if(_)return _==e;var v=!0;u.set(t,e);for(var g=c;++l<p;){E=f[l];var d=t[E],I=e[E];if(n)var h=c?n(I,d,E,e,t,u):n(d,I,E,t,e,u);if(!(void 0===h?d===I||r(d,I,n,s,u):h)){v=!1;break}g||(g="constructor"==E)}if(v&&!g){var y=t.constructor,O=e.constructor;y!=O&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof O&&O instanceof O)&&(v=!1)}return u.delete(t),v}var i=r(42),o=r(4),a=2;t.exports=n},function(t,e,r){function n(t){return i(t,a,o)}var i=r(87),o=r(49),a=r(4);t.exports=n},function(t,e,r){var n=r(44),i=n("length");t.exports=i},function(t,e,r){function n(t){for(var e=o(t),r=e.length;r--;){var n=e[r],a=t[n];e[r]=[n,a,i(a)]}return e}var i=r(51),o=r(4);t.exports=n},function(t,e){function r(t,e){return null==t?void 0:t[e]}t.exports=r},function(t,e,r){function n(t,e,r){e=u(e,t)?[e]:i(e);for(var n,l=-1,E=e.length;++l<E;){var _=p(e[l]);if(!(n=null!=t&&r(t,_)))break;t=t[_]}if(n)return n;var E=t?t.length:0;return!!E&&c(E)&&s(_,E)&&(a(t)||f(t)||o(t))}var i=r(45),o=r(33),a=r(0),s=r(18),u=r(19),c=r(23),f=r(34),p=r(21);t.exports=n},function(t,e,r){function n(){this.__data__=i?i(null):{}}var i=r(20);t.exports=n},function(t,e){function r(t){return this.has(t)&&delete this.__data__[t]}t.exports=r},function(t,e,r){function n(t){var e=this.__data__;if(i){var r=e[t];return r===o?void 0:r}return s.call(e,t)?e[t]:void 0}var i=r(20),o="__lodash_hash_undefined__",a=Object.prototype,s=a.hasOwnProperty;t.exports=n},function(t,e,r){function n(t){var e=this.__data__;return i?void 0!==e[t]:a.call(e,t)}var i=r(20),o=Object.prototype,a=o.hasOwnProperty;t.exports=n},function(t,e,r){function n(t,e){return this.__data__[t]=i&&void 0===e?o:e,this}var i=r(20),o="__lodash_hash_undefined__";t.exports=n},function(t,e){function r(t){var e=t.length,r=t.constructor(e);return e&&"string"==typeof t[0]&&i.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var n=Object.prototype,i=n.hasOwnProperty;t.exports=r},function(t,e,r){function n(t,e,r,n){var V=t.constructor;switch(e){case h:return i(t);case p:case l:return new V(+t);case y:return o(t,n);case O:case R:case A:case N:case x:case b:case T:case m:case S:return f(t,n);case E:return a(t,n,r);case _:case d:return new V(t);case v:return s(t);case g:return u(t,n,r);case I:return c(t)}}var i=r(29),o=r(104),a=r(105),s=r(106),u=r(107),c=r(108),f=r(109),p="[object Boolean]",l="[object Date]",E="[object Map]",_="[object Number]",v="[object RegExp]",g="[object Set]",d="[object String]",I="[object Symbol]",h="[object ArrayBuffer]",y="[object DataView]",O="[object Float32Array]",R="[object Float64Array]",A="[object Int8Array]",N="[object Int16Array]",x="[object Int32Array]",b="[object Uint8Array]",T="[object Uint8ClampedArray]",m="[object Uint16Array]",S="[object Uint32Array]";t.exports=n},function(t,e,r){function n(t){return"function"!=typeof t.constructor||a(t)?{}:i(o(t))}var i=r(84),o=r(48),a=r(12);t.exports=n},function(t,e,r){function n(t,e,r){if(!s(r))return!1;var n=typeof e;return!!("number"==n?o(r)&&a(e,r.length):"string"==n&&e in r)&&i(r[e],t)}var i=r(32),o=r(6),a=r(18),s=r(7);t.exports=n},function(t,e){function r(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}t.exports=r},function(t,e,r){function n(t){return!!o&&o in t}var i=r(112),o=function(){var t=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=n},function(t,e){function r(t){for(var e,r=[];!(e=t.next()).done;)r.push(e.value);return r}t.exports=r},function(t,e){function r(){this.__data__=[]}t.exports=r},function(t,e,r){function n(t){var e=this.__data__,r=i(e,t);return!(r<0)&&(r==e.length-1?e.pop():a.call(e,r,1),!0)}var i=r(15),o=Array.prototype,a=o.splice;t.exports=n},function(t,e,r){function n(t){var e=this.__data__,r=i(e,t);return r<0?void 0:e[r][1]}var i=r(15);t.exports=n},function(t,e,r){function n(t){return i(this.__data__,t)>-1}var i=r(15);t.exports=n},function(t,e,r){function n(t,e){var r=this.__data__,n=i(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}var i=r(15);t.exports=n},function(t,e,r){function n(){this.__data__={hash:new i,map:new(a||o),string:new i}}var i=r(68),o=r(13),a=r(36);t.exports=n},function(t,e,r){function n(t){return i(this,t).delete(t)}var i=r(17);t.exports=n},function(t,e,r){function n(t){return i(this,t).get(t)}var i=r(17);t.exports=n},function(t,e,r){function n(t){return i(this,t).has(t)}var i=r(17);t.exports=n},function(t,e,r){function n(t,e){return i(this,t).set(t,e),this}var i=r(17);t.exports=n},function(t,e){function r(t){return this.__data__.set(t,n),this}var n="__lodash_hash_undefined__";t.exports=r},function(t,e){function r(t){return this.__data__.has(t)}t.exports=r},function(t,e,r){function n(){this.__data__=new i}var i=r(13);t.exports=n},function(t,e){function r(t){return this.__data__.delete(t)}t.exports=r},function(t,e){function r(t){return this.__data__.get(t)}t.exports=r},function(t,e){function r(t){return this.__data__.has(t)}t.exports=r},function(t,e,r){function n(t,e){var r=this.__data__;return r instanceof i&&r.__data__.length==a&&(r=this.__data__=new o(r.__data__)),r.set(t,e),this}var i=r(13),o=r(25),a=200;t.exports=n},function(t,e,r){var n=r(167),i=r(176),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,a=/\\(\\)?/g,s=n(function(t){var e=[];return i(t).replace(o,function(t,r,n,i){e.push(n?i.replace(a,"$1"):r||t)}),e});t.exports=s},function(t,e,r){var n=r(14),i=r(16),o=r(46),a=r(6),s=r(12),u=r(4),c=Object.prototype,f=c.hasOwnProperty,p=c.propertyIsEnumerable,l=!p.call({valueOf:1},"valueOf"),E=o(function(t,e){if(l||s(e)||a(e))return void i(e,u(e),t);for(var r in e)f.call(e,r)&&n(t,r,e[r])});t.exports=E},function(t,e,r){var n=r(14),i=r(16),o=r(46),a=r(6),s=r(12),u=r(165),c=Object.prototype,f=c.propertyIsEnumerable,p=!f.call({valueOf:1},"valueOf"),l=o(function(t,e){if(p||s(e)||a(e))return void i(e,u(e),t);for(var r in e)n(t,r,e[r])});t.exports=l},function(t,e,r){function n(t){return i(t,!0,!0)}var i=r(83);t.exports=n},function(t,e,r){function n(t,e){return(s(t)?i:o)(t,a(e,3))}var i=r(78),o=r(85),a=r(8),s=r(0);t.exports=n},function(t,e,r){function n(t,e){return(s(t)?i:o)(t,a(e,3))}var i=r(38),o=r(11),a=r(8),s=r(0);t.exports=n},function(t,e,r){function n(t,e,r){var n=null==t?void 0:i(t,e);return void 0===n?r:n}var i=r(41);t.exports=n},function(t,e,r){function n(t,e){return null!=t&&o(t,e,i)}var i=r(88),o=r(122);t.exports=n},function(t,e){function r(t){return t}t.exports=r},function(t,e,r){function n(t){return o(t)&&i(t)}var i=r(6),o=r(10);t.exports=n},function(t,e,r){function n(t){if(s(t)&&(a(t)||p(t)||c(t.splice)||o(t)||u(t)))return!t.length;if(f(t)){var e=i(t);if(e==E||e==_)return!t.size}for(var r in t)if(g.call(t,r))return!1;return!(I&&l(t).length)}var i=r(30),o=r(33),a=r(0),s=r(6),u=r(57),c=r(22),f=r(10),p=r(34),l=r(4),E="[object Map]",_="[object Set]",v=Object.prototype,g=v.hasOwnProperty,d=v.propertyIsEnumerable,I=!d.call({valueOf:1},"valueOf");t.exports=n},function(t,e,r){function n(t){return o(t)&&i(t.length)&&!!a[u.call(t)]}var i=r(23),o=r(10),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1;var s=Object.prototype,u=s.toString;t.exports=n},function(t,e,r){var n=r(113),i=n(function(t,e,r){t[r]=e});t.exports=i},function(t,e,r){function n(t){for(var e=-1,r=s(t),n=i(t),u=n.length,f=o(t),p=!!f,l=f||[],E=l.length;++e<u;){var _=n[e];p&&("length"==_||a(_,E))||"constructor"==_&&(r||!c.call(t,_))||l.push(_)}return l}var i=r(93),o=r(50),a=r(18),s=r(12),u=Object.prototype,c=u.hasOwnProperty;t.exports=n},function(t,e,r){function n(t,e){return(s(t)?i:a)(t,o(e,3))}var i=r(39),o=r(8),a=r(94),s=r(0);t.exports=n},function(t,e,r){function n(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(o);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=t.apply(this,n);return r.cache=o.set(i,a),a};return r.cache=new(n.Cache||i),r}var i=r(25),o="Expected a function";n.Cache=i,t.exports=n},function(t,e,r){function n(t){return a(t)?i(s(t)):o(t)}var i=r(44),o=r(97),a=r(19),s=r(21);t.exports=n},function(t,e,r){function n(t,e,r){var n=u(t)?i:s,c=arguments.length<3;return n(t,a(e,4),r,c,o)}var i=r(28),o=r(11),a=r(8),s=r(98),u=r(0);t.exports=n},function(t,e,r){function n(t,e){if("function"!=typeof t)throw new TypeError(a);return e=s(void 0===e?t.length-1:o(e),0),function(){for(var r=arguments,n=-1,o=s(r.length-e,0),a=Array(o);++n<o;)a[n]=r[e+n];switch(e){case 0:return t.call(this,a);case 1:return t.call(this,r[0],a);case 2:return t.call(this,r[0],r[1],a)}var u=Array(e+1);for(n=-1;++n<e;)u[n]=r[n];return u[e]=a,i(t,this,u)}}var i=r(76),o=r(174),a="Expected a function",s=Math.max;t.exports=n},function(t,e){function r(){return[]}t.exports=r},function(t,e){function r(){return!1}t.exports=r},function(t,e,r){function n(t){if(!t)return 0===t?t:0;if((t=i(t))===o||t===-o){return(t<0?-1:1)*a}return t===t?t:0}var i=r(175),o=1/0,a=1.7976931348623157e308;t.exports=n},function(t,e,r){function n(t){var e=i(t),r=e%1;return e===e?r?e-r:e:0}var i=r(173);t.exports=n},function(t,e,r){function n(t){if("number"==typeof t)return t;if(a(t))return s;if(o(t)){var e=i(t.valueOf)?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(u,"");var r=f.test(t);return r||p.test(t)?l(t.slice(2),r?2:8):c.test(t)?s:+t}var i=r(22),o=r(7),a=r(24),s=NaN,u=/^\s+|\s+$/g,c=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,p=/^0o[0-7]+$/i,l=parseInt;t.exports=n},function(t,e,r){function n(t){return null==t?"":i(t)}var i=r(100);t.exports=n},function(t,e,r){function n(t){return t?i(t,o(t)):[]}var i=r(101),o=r(4);t.exports=n},function(t,e,r){!function(){function e(t,e){for(var r,n=t.length,i=e^n,o=0;n>=4;)r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24,r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16),r^=r>>>24,r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^r,n-=4,++o;switch(n){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i^=255&t.charCodeAt(o),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)}return i^=i>>>13,i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}function r(t,e){var r,n,i,o,a,s,u,c;for(r=3&t.length,n=t.length-r,i=e,a=3432918353,s=461845907,c=0;c<n;)u=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295,u=u<<15|u>>>17,u=(65535&u)*s+(((u>>>16)*s&65535)<<16)&4294967295,i^=u,i=i<<13|i>>>19,o=5*(65535&i)+((5*(i>>>16)&65535)<<16)&4294967295,i=27492+(65535&o)+((58964+(o>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&t.charCodeAt(c+2))<<16;case 2:u^=(255&t.charCodeAt(c+1))<<8;case 1:u^=255&t.charCodeAt(c),u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295,u=u<<15|u>>>17,u=(65535&u)*s+(((u>>>16)*s&65535)<<16)&4294967295,i^=u}return i^=t.length,i^=i>>>16,i=2246822507*(65535&i)+((2246822507*(i>>>16)&65535)<<16)&4294967295,i^=i>>>13,i=3266489909*(65535&i)+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}var n=r;n.v2=e,n.v3=r;t.exports=n}()},function(t,e,r){var n=r(181);t.exports={evaluate:function(t,e){if(!t||0===t.length)return!0;if(!e)return!1;for(var r=0;r<t.length;r++){var i=t[r],o=i.conditions;if(n.evaluate(o,e))return!0}return!1}}},function(t,e,r){var n=r(1),i=r(178),o=r(2),a=n.ERROR_MESSAGES,s=n.LOG_LEVEL,u=n.LOG_MESSAGES,c=Math.pow(2,32);t.exports={bucket:function(e){var r=e.experimentKeyMap[e.experimentKey],n=r.groupId;if(n){var i=e.groupIdMap[n];if(!i)throw new Error(o(a.INVALID_GROUP_ID,"BUCKETER",n));if("random"===i.policy){var c=t.exports._bucketUserIntoExperiment(i,e.bucketingId,e.userId,e.logger);if(null===c){var f=o(u.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",e.userId,n);return e.logger.log(s.INFO,f),null}if(c!==e.experimentId){var p=o(u.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,n);return e.logger.log(s.INFO,p),null}var l=o(u.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",e.userId,e.experimentKey,n);e.logger.log(s.INFO,l)}}var E=o("%s%s",e.bucketingId,e.experimentId),_=t.exports._generateBucketValue(E),v=o(u.USER_ASSIGNED_TO_VARIATION_BUCKET,"BUCKETER",_,e.userId);e.logger.log(s.DEBUG,v);var g=t.exports._findBucket(_,e.trafficAllocationConfig);if(null===g){var d=o(u.USER_HAS_NO_VARIATION,"BUCKETER",e.userId,e.experimentKey);e.logger.log(s.DEBUG,d)}else{if(""===g||!e.variationIdMap.hasOwnProperty(g)){var I=o(u.INVALID_VARIATION_ID,"BUCKETER");return e.logger.log(s.WARNING,I),null}var h=e.variationIdMap[g].key,y=o(u.USER_HAS_VARIATION,"BUCKETER",e.userId,h,e.experimentKey);e.logger.log(s.INFO,y)}return g},_bucketUserIntoExperiment:function(e,r,n,i){var a=o("%s%s",r,e.id),c=t.exports._generateBucketValue(a);i.log(s.DEBUG,o(u.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",c,n));var f=e.trafficAllocation;return t.exports._findBucket(c,f)},_findBucket:function(t,e){for(var r=0;r<e.length;r++)if(t<e[r].endOfRange)return e[r].entityId;return null},_generateBucketValue:function(t){try{var e=i.v3(t,1),r=e/c;return parseInt(1e4*r,10)}catch(e){throw new Error(o(a.INVALID_BUCKETING_ID,"BUCKETER",t,e.message))}}}},function(t,e){function r(t,e){if(Array.isArray(t)){var r=t[0];if(-1===f.indexOf(r))return!1;var p=t.slice(1);switch(r){case s:return n(p,e);case c:return i(p,e);case u:return o(p,e)}}return a([t.name,t.value],e)}function n(t,e){for(var n,i=0;i<t.length;i++)if(n=t[i],!r(n,e))return!1;return!0}function i(t,e){return 1===t.length&&!r(t[0],e)}function o(t,e){for(var n=0;n<t.length;n++){if(r(t[n],e))return!0}return!1}function a(t,e){return!!e.hasOwnProperty(t[0])&&e[t[0]]===t[1]}var s="and",u="or",c="not",f=[s,u,c];t.exports={evaluate:r}},function(t,e,r){function n(t){this.configObj=t.configObj,this.userProfileService=t.userProfileService||null,this.logger=t.logger}var i=r(179),o=r(180),a=r(1),s=r(5),u=r(35),c=r(2),f="DECISION_SERVICE",p=a.ERROR_MESSAGES,l=a.LOG_LEVEL,E=a.LOG_MESSAGES;n.prototype.getVariation=function(t,e,r){var n=e;if(s.isEmpty(r)||r.hasOwnProperty("$opt_bucketing_id")&&(n=r.$opt_bucketing_id,this.logger.log(l.DEBUG,c("Setting the bucketing ID to %s.",n))),!this.__checkIfExperimentIsActive(t,e))return null;var i=this.configObj.experimentKeyMap[t],a=u.getForcedVariation(this.configObj,t,e,this.logger);if(a)return a;var p=this.__getWhitelistedVariation(i,e);if(p)return p.key;var _=this.__getUserProfile(e);if(p=this.__getStoredVariation(i,_))return this.logger.log(l.INFO,c(E.RETURNING_STORED_VARIATION,f,p.key,t,e)),p.key;if(!this.__checkIfUserIsInAudience(t,e,r))return null;var v=this.__buildBucketerParams(t,n,e),g=o.bucket(v);return(p=this.configObj.variationIdMap[g])?(this.__saveUserProfile(_,i,p),p.key):null},n.prototype.__checkIfExperimentIsActive=function(t,e){if(!u.isActive(this.configObj,t)){var r=c(E.EXPERIMENT_NOT_RUNNING,f,t);return this.logger.log(l.INFO,r),!1}return!0},n.prototype.__getWhitelistedVariation=function(t,e){if(!s.isEmpty(t.forcedVariations)&&t.forcedVariations.hasOwnProperty(e)){var r=t.forcedVariations[e];if(t.variationKeyMap.hasOwnProperty(r)){var n=c(E.USER_FORCED_IN_VARIATION,f,e,r);return this.logger.log(l.INFO,n),t.variationKeyMap[r]}var i=c(E.FORCED_BUCKETING_FAILED,f,r,e);return this.logger.log(l.ERROR,i),null}return null},n.prototype.__checkIfUserIsInAudience=function(t,e,r){var n=u.getAudiencesForExperiment(this.configObj,t);if(!i.evaluate(n,r)){var o=c(E.USER_NOT_IN_EXPERIMENT,f,e,t);return this.logger.log(l.INFO,o),!1}return!0},n.prototype.__buildBucketerParams=function(t,e,r){var n={};return n.experimentKey=t,n.experimentId=u.getExperimentId(this.configObj,t),n.userId=r,n.trafficAllocationConfig=u.getTrafficAllocation(this.configObj,t),n.experimentKeyMap=this.configObj.experimentKeyMap,n.groupIdMap=this.configObj.groupIdMap,n.variationIdMap=this.configObj.variationIdMap,n.logger=this.logger,n.bucketingId=e,n},n.prototype.__getStoredVariation=function(t,e){if(!e||!e.experiment_bucket_map)return null;if(e.experiment_bucket_map.hasOwnProperty(t.id)){var r=e.experiment_bucket_map[t.id],n=r.variation_id;if(this.configObj.variationIdMap.hasOwnProperty(n))return this.configObj.variationIdMap[r.variation_id];this.logger.log(l.INFO,c(E.SAVED_VARIATION_NOT_FOUND,f,e.user_id,n,t.key))}return null},n.prototype.__getUserProfile=function(t){var e={user_id:t,experiment_bucket_map:{}};if(!this.userProfileService)return e;try{e=this.userProfileService.lookup(t)||e}catch(e){this.logger.log(l.ERROR,c(p.USER_PROFILE_LOOKUP_ERROR,f,t,e.message))}return e},n.prototype.__saveUserProfile=function(t,e,r){if(this.userProfileService)try{t.experiment_bucket_map[e.id]={variation_id:r.id},this.userProfileService.save(t),this.logger.log(l.INFO,c(E.SAVED_VARIATION,f,r.key,e.key,t.user_id))}catch(e){this.logger.log(l.ERROR,c(p.USER_PROFILE_SAVE_ERROR,f,t.user_id,e.message))}},t.exports={createDecisionService:function(t){return new n(t)}}},function(t,e,r){function n(t){var e=t.attributes,r=t.configObj,n=r.anonymizeIP;null!==n&&void 0!==n||(n=!1);var i={snapshots:[],visitor_id:t.userId,attributes:[]},o={account_id:r.accountId,project_id:r.projectId,visitors:[i],revision:r.revision,client_name:t.clientEngine,client_version:t.clientVersion,anonymize_ip:n};return s.forOwn(e,function(r,n){var i=c.getAttributeId(t.configObj,n);if(i){var a={entity_id:i,key:n,type:p,value:e[n]};o.visitors[0].attributes.push(a)}}),o}function i(t,e,r){return{decisions:[{campaign_id:c.getLayerId(t,e),experiment_id:e,variation_id:r}],events:[{entity_id:c.getLayerId(t,e),timestamp:s.currentTimestamp(),key:f,uuid:s.uuid()}]}}function o(t,e,r,n,i){var o=[];return s.forOwn(n,function(n,f){var p={decisions:[{campaign_id:c.getLayerId(t,f),experiment_id:f,variation_id:n}],events:[]},l={entity_id:c.getEventId(t,e),timestamp:s.currentTimestamp(),uuid:s.uuid(),key:e};if(r){var E=u.getRevenueValue(r,i);E&&(l[a.RESERVED_EVENT_KEYWORDS.REVENUE]=E);var _=u.getEventValue(r,i);_&&(l[a.RESERVED_EVENT_KEYWORDS.VALUE]=_),l.tags=r}p.events=[l],o.push(p)}),o}var a=r(1),s=r(5),u=r(187),c=r(35),f="campaign_activated",p="custom",l="https://logx.optimizely.com/v1/events";t.exports={getImpressionEvent:function(t){var e={httpVerb:"POST"},r=n(t);e.url=l;var o=i(t.configObj,t.experimentId,t.variationId);return r.visitors[0].snapshots.push(o),e.params=r,e},getConversionEvent:function(t){var e={httpVerb:"POST"},r=n(t);e.url=l;var i=o(t.configObj,t.eventKey,t.eventTags,t.experimentsToVariationMap,t.logger);return r.visitors[0].snapshots=i,e.params=r,e}}},function(t,e,r){function n(t){this.logger=t.logger,this.__notificationListeners={},o.forOwn(i.NOTIFICATION_TYPES,function(t){this.__notificationListeners[t]=[]}.bind(this)),this.__listenerId=1}var i=r(1),o=r(5),a=r(2),s=i.LOG_LEVEL,u=i.LOG_MESSAGES;n.prototype.addNotificationListener=function(t,e){if(!(o.values(i.NOTIFICATION_TYPES).indexOf(t)>-1))return-1;this.__notificationListeners[t]||(this.__notificationListeners[t]=[]);var r=!1;if(o.forEach(this.__notificationListeners[t],function(t){if(t.callback===e)return r=!0,!1}),r)return-1;this.__notificationListeners[t].push({id:this.__listenerId,callback:e});var n=this.__listenerId;return this.__listenerId+=1,n},n.prototype.removeNotificationListener=function(t){var e,r;return o.forOwn(this.__notificationListeners,function(n,i){if(o.forEach(n,function(n,o){if(n.id===t)return e=o,r=i,!1}),void 0!==e&&void 0!==r)return!1}),void 0!==e&&void 0!==r&&(this.__notificationListeners[r].splice(e,1),!0)},n.prototype.clearAllNotificationListeners=function(){o.forOwn(i.NOTIFICATION_TYPES,function(t){this.__notificationListeners[t]=[]}.bind(this))},n.prototype.clearNotificationListeners=function(t){this.__notificationListeners[t]=[]},n.prototype.sendNotifications=function(t,e){o.forEach(this.__notificationListeners[t],function(r){var n=r.callback;try{n(e)}catch(e){this.logger.log(s.ERROR,a(u.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",t,e.message))}}.bind(this))},t.exports={createNotificationCenter:function(t){return new n(t)}}},function(t,e){t.exports={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{projectId:{type:"string",required:!0},accountId:{type:"string",required:!0},groups:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},policy:{type:"string",required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},experiments:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0},status:{type:"string",required:!0},layerId:{type:"string",required:!0},variations:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},audienceIds:{type:"array",items:{type:"string"},required:!0},forcedVariations:{type:"object",required:!0}}},required:!0}}},required:!0},experiments:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0},status:{type:"string",required:!0},layerId:{type:"string",required:!0},variations:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},audienceIds:{type:"array",items:{type:"string"},required:!0},forcedVariations:{type:"object",required:!0}}},required:!0},events:{type:"array",items:{type:"object",properties:{key:{type:"string",required:!0},experimentIds:{type:"array",items:{type:"string",required:!0}},id:{type:"string",required:!0}}},required:!0},audiences:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},name:{type:"string",required:!0},conditions:{type:"string",required:!0}}},required:!0},attributes:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},version:{type:"string",required:!0},revision:{type:"string",required:!0}}}},function(t,e,r){var n=r(2),i=r(56),o=r(1).ERROR_MESSAGES;t.exports={validate:function(t){if("object"!=typeof t||Array.isArray(t)||null===t)throw new Error(n(o.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));return i(t,function(t,e){if(void 0===t)throw new Error(n(o.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",e))}),!0}}},function(t,e,r){var n=r(1),i=r(2),o=n.LOG_LEVEL,a=n.LOG_MESSAGES,s=n.RESERVED_EVENT_KEYWORDS.REVENUE,u=n.RESERVED_EVENT_KEYWORDS.VALUE;t.exports={getRevenueValue:function(t,e){if(t&&t.hasOwnProperty(s)){var r=t[s],n=parseInt(r,10);return isNaN(n)?(e.log(o.INFO,i(a.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",r)),null):(e.log(o.INFO,i(a.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",n)),n)}return null},getEventValue:function(t,e){if(t&&t.hasOwnProperty(u)){var r=t[u],n=parseFloat(r);return isNaN(n)?(e.log(o.INFO,i(a.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",r)),null):(e.log(o.INFO,i(a.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",n)),n)}return null}}},function(t,e,r){var n=r(2),i=r(1).ERROR_MESSAGES;t.exports={validate:function(t){if("object"!=typeof t||Array.isArray(t)||null===t)throw new Error(n(i.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"));return!0}}},function(t,e,r){var n=r(1),i=r(2),o=n.ERROR_MESSAGES;t.exports={validate:function(t){if("string"!=typeof t||""===t)throw new Error(i(o.INVALID_USER_ID,"USER_ID_VALIDATOR"));return!0}}},function(t,e,r){var n=r(2),i=r(1).ERROR_MESSAGES;t.exports={validate:function(t){if("function"!=typeof t.lookup)throw new Error(n(i.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'lookup'"));if("function"!=typeof t.save)throw new Error(n(i.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'save'"));return!0}}},function(t,e,r){var n=r(192),i=r(193),o=i;o.v1=n,o.v4=i,t.exports=o},function(t,e,r){function n(t,e,r){var n=e&&r||0,i=e||[];t=t||{};var a=void 0!==t.clockseq?t.clockseq:u,p=void 0!==t.msecs?t.msecs:(new Date).getTime(),l=void 0!==t.nsecs?t.nsecs:f+1,E=p-c+(l-f)/1e4;if(E<0&&void 0===t.clockseq&&(a=a+1&16383),(E<0||p>c)&&void 0===t.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=p,f=l,u=a,p+=122192928e5;var _=(1e4*(268435455&p)+l)%4294967296;i[n++]=_>>>24&255,i[n++]=_>>>16&255,i[n++]=_>>>8&255,i[n++]=255&_;var v=p/4294967296*1e4&268435455;i[n++]=v>>>8&255,i[n++]=255&v,i[n++]=v>>>24&15|16,i[n++]=v>>>16&255,i[n++]=a>>>8|128,i[n++]=255&a;for(var g=t.node||s,d=0;d<6;++d)i[n+d]=g[d];return e||o(i)}var i=r(59),o=r(58),a=i(),s=[1|a[0],a[1],a[2],a[3],a[4],a[5]],u=16383&(a[6]<<8|a[7]),c=0,f=0;t.exports=n},function(t,e,r){function n(t,e,r){var n=e&&r||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null),t=t||{};var a=t.random||(t.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[n+s]=a[s];return e||o(a)}var i=r(59),o=r(58);t.exports=n},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}}])});