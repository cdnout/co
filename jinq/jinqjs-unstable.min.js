var jinqJs=function(n){"use strict";var e=[],t=[],r=[],u=!1,l=!1,i=null,s=!1,a={LessThen:0,LessThenEqual:1,GreaterThen:2,GreaterThenEqual:3,Equal:4,EqualEqualType:5,NotEqual:6,NotEqualEqualType:7,Contains:8},f={};jinqJs.settings=jinqJs.settings||{},"undefined"!=typeof n?jinqJs.settings=n:jinqJs.settings={includeIdentity:jinqJs.settings.includeIdentity||!1};var o=function(n){return"undefined"==typeof n||0===n.length},h=function(n){return v(n,"length")&&!g(n)&&!d(n)},c=function(n){return null!==n&&(n.constructor===Object||h(n))},g=function(n){return null!==n&&n.constructor===String},v=function(n,e){return void 0!==n[e]},d=function(n){return"function"==typeof n},p=function(n){return"number"==typeof n},y=function(n,e,t){for(var r=0;r<n.length;r++)if(n[r][e]===t)return!0;return!1},q=function(n,e){return E(n,e,!0)},E=function(n,e,t){var r=null,u=!1,l=[],i=!1;t=t||!1;for(var s=0;s<n.length;s++){u=!1;for(var a in e){if(r=n[s],i=c(r),!i&&r!=e[a]||i&&r[a]!=e[a]){u=!1;break}u=!0}if(u){if(t)return r;l.push(r)}}return 0===l.length?null:l},N=function(n,e){for(var t={},r=null,u=0;u<e.length;u++)r=e[u],v(n,r)?t[r]=n[r]:t[r]=0;return t},m=function(n,e){for(var u=[],l=null,i=null,s=null,a=0;a<t.length;a++)if(l=N(t[a],r),i=N(t[a],n),s=q(u,l),null===s){s={};for(var f in l)s[f]=l[f];for(var o in i)s[o]=e(s[o],i[o],JSON.stringify(l)+o);u.push(s)}else for(var h in i)s[h]=e(s[h],t[a][h],JSON.stringify(l)+h);return r=[],u},J=function(n){for(var e=null,r=null,u=null,l=null,i=null,s=null,a=null,f=1,o=!1,h=0;h<n.length;h++)r=h>0?n[h-1]:null,e=n[h],u=v(e,"field")?e.field:null,f=v(e,"sort")&&"desc"===e.sort?-1:1,o=null!==u&&!isNaN(u),t.sort(function(n,e){var t=!1,h=!1,c=null,v=null;if(o?(l=Object.keys(n)[u],i=Object.keys(e)[u],null!==r&&(s=Object.keys(n)[r.field],a=Object.keys(e)[r.field])):(l=i=u,null!==r&&(s=a=r.field)),c=null===u?n:isNaN(n[l])?n[l]:Number(n[l]),v=null===u?e:isNaN(e[i])?e[i]:Number(e[i]),g(c)&&g(v)){var d=c.localeCompare(v);switch(d){case-1:t=!0;break;case 1:h=!0}}else t=c<v,h=c>v;return!t||null!==r&&null!==u&&n[s]!=e[a]?!h||null!==r&&null!==u&&n[s]!=e[a]?0:1*f:-1*f})},b=function(n){switch(n.length){case 1:return n[0].concat();case 2:return[].concat(n[0],n[1]);case 3:return[].concat(n[0],n[1],n[2]);case 4:return[].concat(n[0],n[1],n[2],n[3]);case 5:return[].concat(n[0],n[1],n[2],n[3],n[4]);default:for(var e=[],t=0;t<n.length;t++)e=e.concat(n[t]);return e}},j=function(n){for(var e={},t=0;t<n.length;t++)for(var r in n[t])e[r]=n[t][r];return e},T=function(n){var e={};for(var t in n)e[t]="";return e},w=function(n){switch(n){case"<":return a.LessThen;case">":return a.GreaterThen;case"!=":return a.NotEqual;case"!==":return a.NotEqualEqualType;case"=":case"==":return a.Equal;case"===":return a.EqualEqualType;case"<=":return a.LessThenEqual;case">=":return a.GreaterThenEqual;case"*":return a.Contains;default:throw"Invalid Expression!"}},O=function(n){var e=[];for(var t in n)e.push({field:t});return e},x=function(){return"undefined"!=typeof module&&"undefined"!=typeof module.exports},k=function(n,r){var u=null,l=[],i=null,s=[],a=1;if(h(r)&&0!==r.length&&0!==e.length){switch(n){case"from":if(1===e.length)return void(t=e[0]);s=e[0];break;case"full":case"inner":case"left":s=t,a=0;break;default:return}for(var f=a;f<e.length;f++){if(l=[],s.forEach(function(t){d(r[0])?(i=[],e[f].forEach(function(n){r[0](t,n)&&i.push(n)}),0===i.length&&(i=null)):(u=N(t,r),i=E(e[f],u)),null!==i?g(i[0])?l.push(t):i.forEach(function(n){l.push(j([n,t]))}):"left"!==n&&"full"!==n||(e[f].length>0&&(u=T(e[f][0]),u=j([u,t])),l.push(j([t,u])))}),"full"===n){var o=(new jinqJs).from(e[f]).not().in(l,r).select(O(l[0]));l=l.concat(o)}s=l}e=[],t=l}},V=function(n,t){if(0===t.length)return this;e=[],e.func=n;for(var r=0;r<t.length;r++)t[r].length>0&&e.push(t[r])},F=function(n,r,u){var l=require("http");l.get(r,function(r){var l="";r.on("data",function(n){l+=n}),r.on("end",function(){var r=JSON.parse(l),i=null;i=h(r)?r:new Array(r),e.push(i),t=i,d(u)&&u(n)})})},S=function(n,r,u){var l=new XMLHttpRequest,i=null;if(d(u)&&(l.onreadystatechange=function(){if(0!==l.response.length){var r=JSON.parse(l.response);i=h(r)?r:new Array(r),e.push(i),t=i,u(n)}}),l.open("GET",r,d(u)),l.send(),!d(u)){var s=JSON.parse(l.response);i=h(s)?s:new Array(s),e.push(i)}},A=function(n){for(var e=/([^\s]+)\s(<|>|!=|!==|=|==|===|<=|>=|\*)\s(.+)/,t=n.length,r=new Array(t),u=0;u<t;u++){var l=n[u].match(e);if(4!==l.length)throw"Invalid expression!";r[u]={lField:l[1],operator:w(l[2]),rValue:l[3]}}return r},G=function(n,e){switch(e.operator){case a.EqualEqualType:return n[e.lField]===e.rValue;case a.NotEqualEqualType:return n[e.lField]!==e.rValue;case a.LessThen:return n[e.lField]<e.rValue;case a.GreaterThen:return n[e.lField]>e.rValue;case a.NotEqual:return n[e.lField]!=e.rValue;case a.Equal:return n[e.lField]==e.rValue;case a.LessThenEqual:return n[e.lField]<=e.rValue;case a.GreaterThenEqual:return n[e.lField]>=e.rValue;case a.Contains:return n[e.lField].indexOf(e.rValue)>-1;default:return!1}},I=function(){var n=null,r=null;if(0===arguments.length)return this;t=[];for(var u=0;u<arguments.length;u++)if(null!==arguments[u]&&0!==arguments[u].length){if(2==arguments.length&&d(arguments[1]))n=arguments[0],r=arguments[1],u=arguments.length;else if(n=arguments[u],d(n))continue;g(n)?x()?F(this,n,r):S(this,n,r):e.push(n)}return e.func="from",t=b(e),d(r)?r:this},L=function(){var n=null,e=!1,r=!1,u=null;if(o(t))return[];var i=null,s=null,a=null,f=!1,g=null;if(jinqJs.settings.includeIdentity&&!l&&W(),o(arguments))return t;if(u=new Array(t.length),h(arguments[0])){n=arguments[0],e=!0,g=new Array(n.length);for(var y=0;y<n.length;y++)g[y]={hasField:v(n[y],"field"),hasText:v(n[y],"text"),hasValue:v(n[y],"value")}}else d(arguments[0])?(n=arguments[0],r=!0):n=arguments;f=!c(t[0]);for(var q=0;q<t.length;q++)if(r)u[q]=n(t[q],q);else{i={};for(var E=0;E<n.length;E++)e?(g[E].hasField&&(s=p(n[E].field)?Object.keys(t[q])[n[E].field]:n[E].field),a=g[E].hasText?n[E].text:n[E].field):a=s=n[E],e&&g[E].hasValue?d(n[E].value)?i[a]=n[E].value(t[q]):i[a]=n[E].value:i[a]=f?t[q]:0===t[q][s]?0:t[q][s]||null;u[q]=i}return u},C=function(n){if(s)throw"A pending delete operation exists!";return"undefined"!=typeof n&&d(n)?(i=n,this):this},B=function(){if(null!==i)throw"A pending update operation exists!";return s=!0,this},M=function(){var n=t.length,r=null,u=!1,l=!1,a=arguments.length;if(null===i&&!s||0===n)return this;if(s&&0===a)return t=[],e=[],i=null,s=!1,this;a>0&&(u=d(arguments[0]),u||(r=A(arguments)));for(var f=n-1;f>-1;f--)if(u)arguments[0](t,f)&&(s?t.splice(f,1):i(t,f));else if(0===a)s?t.splice(f,1):i(t,f);else{for(var o=0;o<a&&(l=G(t[f],r[o]),l);o++);l&&(s?t.splice(f,1):i(t,f))}return i=null,s=!1,this},_=function(){e.func=null;for(var n=0;n<arguments.length;n++)t=t.concat(arguments[n]);return this},D=function(n){var e=0;return e=n>-1&&n<1?t.length*n:n,t=n<0?t.slice(e,t.length-Math.abs(e)*-1):t.slice(0,e),this},H=function(n){return D(n*-1),this},P=function(n){var e=[],r=!1,u=!1,l=arguments.length,i=t.length,s=null,a=null;if("undefined"==typeof n)return this;r=d(n),r||(s=A(arguments));for(var f=0;f<i;f++)if(a=t[f],r)n(a,f)&&e.push(a);else{for(var o=0;o<l&&(u=G(a,s[o]),u);o++);u&&e.push(a)}return t=e,this},R=function(){var n=[],e=null,r=null,u=0,l=t.length,i=0,s=!1;if(0===arguments.length)if(c(t[0]))for(u=0;u<l;u++){s=!1;for(var a=0;a<i;a++)if(t[u]===n[a]){s=!0;break}s||(n[i++]=t[u])}else{var f={};for(u=0;u!==l;u++)e=t[u],1!==f[e]&&(f[e]=1,n[n.length]=e)}else{var o=arguments;for(Array.isArray(arguments[0])&&(o=arguments[0]),u=0;u<l;u++){e=N(t[u],o);for(var h=0;h<o.length;h++)if(r=o[h],!y(n,r,e[r])){n.push(e);break}}}return t=n,this},X=function(){return r=arguments,this},$=function(){var n={};if(0===r.length){n=0;for(var e=0;e<t.length;e++)n+=0===arguments.length?t[e]:t[e][arguments[0]];t=[n]}else t=m(arguments,function(e,t,r){var u=r;return v(n,u)||(n[u]=0),n[u]+=t});return this},z=function(){var n={};if(0===r.length){n=0;for(var e=0;e<t.length;e++)n+=0===arguments.length?t[e]:t[e][arguments[0]];t=[n/t.length]}else t=m(arguments,function(e,t,r){var u=JSON.stringify(r);return v(n,u)||(n[u]={count:0,sum:0}),n[u].count++,n[u].sum+=t,n[u].sum/n[u].count});return this},K=function(){var n={};return t=m(arguments,function(e,t,r){var u=JSON.stringify(r);return v(n,u)||(n[u]=0),++n[u]}),this},Q=function(){var n={},e=0;if(0===r.length){n=-1;for(var u=0;u<t.length;u++)e=0===arguments.length?Number(t[u]):Number(t[u][arguments[0]]),n=e<n||n===-1?e:n;t=[n]}else t=m(arguments,function(e,t,r){var u=JSON.stringify(r);return v(n,u)||(n[u]=0),(0===n[u]||t<n[u])&&(n[u]=t),n[u]});return this},U=function(){var n={},e=0;if(0===r.length){n=-1;for(var u=0;u<t.length;u++)e=0===arguments.length?Number(t[u]):Number(t[u][arguments[0]]),n=e>n||n===-1?e:n;t=[n]}else t=m(arguments,function(e,t,r){var u=JSON.stringify(r);return v(n,u)||(n[u]=0),t>n[u]&&(n[u]=t),n[u]});return this},W=function(){var n=1,e=0===arguments.length?"ID":arguments[0],r=t.length>0&&!c(t[0]),u=[],i=null;l=!0;for(var s=0;s<t.length;s++)r?(i={},i[e]=n++,i.Value=t[s],u.push(i)):t[s][e]=n++;return r&&(t=u),this},Y=function(){var n=arguments;return arguments.length>0&&h(arguments[0])?(J(arguments[0]),this):(t.sort(function(e,t){var r=JSON.stringify(N(e,n)),u=JSON.stringify(N(t,n));return r.localeCompare(u)}),this)},Z=function(){if(0===arguments.length||!h(arguments[0])||0===arguments[0].length)return this;if(c(arguments[0][0])){var n=b(arguments);_(n),r=[];for(var e in arguments[0][0])r.push(e);K()}else{for(var t=0;t<arguments.length;t++)_(arguments[t]);R()}return this},nn=function(){return 0!==arguments.length&&v(e,"func")?(k(e.func,arguments),e.func=null,this):this},en=function(){var n=[],e=null,r=null,l=!1,i=[],s=null;if(0===arguments.length)return this;if(s=arguments[0],0===s.length||0===t.length)return this;var a=!c(s[0]),f=!c(t[0]);if((!a||!f)&&arguments.length<2)throw"Invalid field or missing field!";if(arguments.length<2)i=[0];else if(h(arguments[1]))i=arguments[1];else for(var o=1;o<arguments.length;o++)i.push(arguments[o]);for(var g=0,v=0;v<t.length;v++){for(var d=0;d<s.length;d++){g=0;for(var p=0;p<i.length;p++)e=f?t[v]:t[v][i[p]],r=a?s[d]:s[d][i[p]],l=e===r,l&&g++;if(g===i.length)break}(d<s.length&&!u||d===s.length&&u)&&n.push(t[v])}return u=!1,t=n,this},tn=function(){return V("inner",arguments),this},rn=function(){return V("left",arguments),this},un=function(){return V("full",arguments),this},ln=function(){return u=!0,this},sn=function(){var n=0;if(0===arguments.length||!p(arguments[0]))return this;var e=arguments[0];return n=e>-1&&arguments[0]<1?t.length*e:e,t=t.slice(n),this};this.from=I,this.select=L,this.update=C,this.top=D,this.bottom=H,this.where=P,this.distinct=R,this.groupBy=X,this.sum=$,this.count=K,this.min=Q,this.max=U,this.avg=z,this.identity=W,this.orderBy=Y,this.on=nn,this.join=tn,this.leftJoin=rn,this.fullJoin=un,this.concat=_,this.union=Z,this.not=ln,this.in=en,this.skip=sn,this.filter=P,this.at=M,this.delete=B,this._x=function(n,e,r){return f[n]=f[n]||{},r.call(this,t,e,f[n])}};!function(){"use strict";jinqJs.addPlugin=function(n,e){jinqJs.prototype[n]=function(){return this._x(n,arguments,e)}},"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=jinqJs),"undefined"!=typeof angular&&angular.module("angular-jinqjs",[]).service("$jinqJs",function(){return new jinqJs})}();