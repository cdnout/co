import Player from"../player";import{EVENT_OPTIONS}from"../utils/constants";import{addEvent}from"../utils/events";import{hasClass,removeElement}from"../utils/general";class Play{constructor(t,e,s){return this.events={controls:{},media:{}},this.player=t,this.labels=this.player.getOptions().labels,this.position=e,this.layer=s,this}create(){this.button=document.createElement("button"),this.button.type="button",this.button.className=`op-controls__playpause op-control__${this.position}`,this.button.tabIndex=0,this.button.title=this.labels.play,this.button.setAttribute("aria-controls",this.player.id),this.button.setAttribute("aria-pressed","false"),this.button.setAttribute("aria-label",this.labels.play),this.button.innerHTML=`<span class="op-sr">${this.labels.play}/${this.labels.pause}</span>`,this.player.getControls().getLayer(this.layer).appendChild(this.button),this.events.media.click=(t=>{this.button.setAttribute("aria-pressed","true");const e=this.player.activeElement();e.paused||e.ended?(this.player.adsInstance&&(this.player.adsInstance.playRequested=!0),e.play()):e.pause(),t.preventDefault()}),this.events.media.play=(()=>{this.player.activeElement().ended?(this.player.isMedia()?this.button.classList.add("op-controls__playpause--replay"):this.button.classList.add("op-controls__playpause--pause"),this.button.title=this.labels.play,this.button.setAttribute("aria-label",this.labels.play)):(this.button.classList.remove("op-controls__playpause--replay"),this.button.classList.add("op-controls__playpause--pause"),this.button.title=this.labels.pause,this.button.setAttribute("aria-label",this.labels.pause),Object.keys(Player.instances).forEach(t=>{if(t!==this.player.id){Player.instances[t].activeElement().pause()}}))}),this.events.media.loadedmetadata=(()=>{hasClass(this.button,"op-controls__playpause--pause")&&(this.button.classList.remove("op-controls__playpause--replay"),this.button.classList.remove("op-controls__playpause--pause"),this.button.title=this.labels.play,this.button.setAttribute("aria-label",this.labels.play))}),this.events.media.playing=(()=>{hasClass(this.button,"op-controls__playpause--pause")||(this.button.classList.remove("op-controls__playpause--replay"),this.button.classList.add("op-controls__playpause--pause"),this.button.title=this.labels.pause,this.button.setAttribute("aria-label",this.labels.pause))}),this.events.media.pause=(()=>{this.button.classList.remove("op-controls__playpause--pause"),this.button.title=this.labels.play,this.button.setAttribute("aria-label",this.labels.play)}),this.events.media.ended=(()=>{this.player.activeElement().ended&&this.player.isMedia()?(this.button.classList.add("op-controls__playpause--replay"),this.button.classList.remove("op-controls__playpause--pause")):this.player.getElement().currentTime>=this.player.getElement().duration||this.player.getElement().currentTime<=0?(this.button.classList.add("op-controls__playpause--replay"),this.button.classList.remove("op-controls__playpause--pause")):(this.button.classList.remove("op-controls__playpause--replay"),this.button.classList.add("op-controls__playpause--pause")),this.button.title=this.labels.play,this.button.setAttribute("aria-label",this.labels.play)}),this.events.media.adsmediaended=(()=>{this.button.classList.remove("op-controls__playpause--replay"),this.button.classList.add("op-controls__playpause--pause"),this.button.title=this.labels.pause,this.button.setAttribute("aria-label",this.labels.pause)});const t=this.player.getElement();this.events.controls.controlschanged=(()=>{if(!this.player.activeElement().paused){const e=addEvent("playing");t.dispatchEvent(e)}}),Object.keys(this.events.media).forEach(e=>{t.addEventListener(e,this.events.media[e],EVENT_OPTIONS)}),this.player.getControls().getContainer().addEventListener("controlschanged",this.events.controls.controlschanged,EVENT_OPTIONS),this.player.getContainer().addEventListener("keydown",this._keydownEvent.bind(this),EVENT_OPTIONS),this.button.addEventListener("click",this.events.media.click,EVENT_OPTIONS)}destroy(){Object.keys(this.events.media).forEach(t=>{this.player.getElement().removeEventListener(t,this.events.media[t])}),this.player.getControls().getContainer().removeEventListener("controlschanged",this.events.controls.controlschanged),this.player.getContainer().removeEventListener("keydown",this._keydownEvent.bind(this)),this.button.removeEventListener("click",this.events.media.click),removeElement(this.button)}_keydownEvent(t){const e=t.which||t.keyCode||0,s=this.player.activeElement();13!==e&&32!==e||(s.paused?s.play():s.pause(),t.preventDefault())}}export default Play;