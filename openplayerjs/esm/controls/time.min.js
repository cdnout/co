import{EVENT_OPTIONS}from"../utils/constants";import{removeElement}from"../utils/general";import{formatTime}from"../utils/time";class Time{constructor(t,e,i){return this.events={controls:{},media:{}},this.player=t,this.labels=t.getOptions().labels,this.position=e,this.layer=i,this}create(){this.current=document.createElement("time"),this.current.className="op-controls__current",this.current.setAttribute("role","timer"),this.current.setAttribute("aria-live","off"),this.current.setAttribute("aria-hidden","false"),this.current.innerText="0:00",this.delimiter=document.createElement("span"),this.delimiter.className="op-controls__time-delimiter",this.delimiter.setAttribute("aria-hidden","false"),this.delimiter.innerText="/",this.duration=document.createElement("time"),this.duration.className="op-controls__duration",this.duration.setAttribute("aria-hidden","false"),this.duration.innerText=formatTime(this.player.getOptions().progress.duration);const t=()=>{const t=this.player.activeElement();if(t.duration===1/0||this.player.getElement().getAttribute("op-live__enabled"))this.duration.setAttribute("aria-hidden","true"),this.delimiter.setAttribute("aria-hidden","true");else{const e=isNaN(t.duration)?this.player.getOptions().progress.duration:t.duration;this.duration.innerText=formatTime(e),this.current.innerText=formatTime(t.currentTime)}};this.events.media.loadedmetadata=t.bind(this),this.events.controls.controlschanged=t.bind(this);const{showLabel:e}=this.player.getOptions().live;this.events.media.timeupdate=(()=>{const t=this.player.activeElement();if(t.duration===1/0||this.player.getElement().getAttribute("op-live__enabled")||this.player.getElement().getAttribute("op-dvr__enabled"))this.player.getElement().getAttribute("op-dvr__enabled")?(this.duration.setAttribute("aria-hidden","true"),this.delimiter.setAttribute("aria-hidden","true"),this.current.innerText=formatTime(t.currentTime)):this.player.getElement().getAttribute("op-dvr__enabled")||"false"!==this.duration.getAttribute("aria-hidden")?this.current.innerText=e?this.labels.live:formatTime(t.currentTime):(this.duration.setAttribute("aria-hidden","true"),this.delimiter.setAttribute("aria-hidden","true"),this.current.innerText=e?this.labels.live:formatTime(t.currentTime));else{const i=formatTime(t.duration);isNaN(t.duration)||i===this.duration.innerText?i!==this.duration.innerText&&(this.current.innerText=e?this.labels.live:formatTime(t.currentTime)):(this.duration.innerText=i,this.duration.setAttribute("aria-hidden","false"),this.delimiter.setAttribute("aria-hidden","false")),this.current.innerText=formatTime(t.currentTime)}}),this.events.media.ended=(()=>{const t=this.player.activeElement(),e=isNaN(t.duration)?this.player.getOptions().progress.duration:t.duration;this.player.isMedia()&&(this.duration.innerText=formatTime(e))}),Object.keys(this.events.media).forEach(t=>{this.player.getElement().addEventListener(t,this.events.media[t],EVENT_OPTIONS)}),this.player.getControls().getContainer().addEventListener("controlschanged",this.events.controls.controlschanged,EVENT_OPTIONS);const i=this.player.getControls().getLayer(this.layer);this.container=document.createElement("span"),this.container.className=`op-controls-time op-control__${this.position}`,this.container.appendChild(this.current),this.container.appendChild(this.delimiter),this.container.appendChild(this.duration),i.appendChild(this.container)}destroy(){Object.keys(this.events.media).forEach(t=>{this.player.getElement().removeEventListener(t,this.events.media[t])}),this.player.getControls().getContainer().removeEventListener("controlschanged",this.events.controls.controlschanged),removeElement(this.current),removeElement(this.delimiter),removeElement(this.duration),removeElement(this.container)}}export default Time;