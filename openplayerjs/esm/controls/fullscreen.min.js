import{EVENT_OPTIONS,IS_ANDROID,IS_IPHONE}from"../utils/constants";import{removeElement}from"../utils/general";class Fullscreen{constructor(e,t,s){this.fullscreenEvents=[],this.fullscreenWidth=0,this.fullscreenHeight=0,this.player=e,this.labels=e.getOptions().labels,this.position=t,this.layer=s,this.isFullscreen=document.body.classList.contains("op-fullscreen__on");const l=document;return this.fullScreenEnabled=!!(l.fullscreenEnabled||l.mozFullScreenEnabled||l.msFullscreenEnabled||l.webkitSupportsFullscreen||l.webkitFullscreenEnabled||document.createElement("video").webkitRequestFullScreen),this}create(){this.button=document.createElement("button"),this.button.type="button",this.button.className=`op-controls__fullscreen op-control__${this.position}`,this.button.tabIndex=0,this.button.title=this.labels.fullscreen,this.button.setAttribute("aria-controls",this.player.id),this.button.setAttribute("aria-pressed","false"),this.button.setAttribute("aria-label",this.labels.fullscreen),this.button.innerHTML=`<span class="op-sr">${this.labels.fullscreen}</span>`,this.clickEvent=(()=>{this.button.setAttribute("aria-pressed","true"),this.toggleFullscreen()}),this.fullscreenEvents=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],this._setFullscreenData(!1),this.player.getContainer().addEventListener("keydown",this._keydownEvent.bind(this),EVENT_OPTIONS),this.fullscreenEvents.forEach(e=>{document.addEventListener(e,this._fullscreenChange.bind(this),EVENT_OPTIONS)}),this.button.addEventListener("click",this.clickEvent.bind(this),EVENT_OPTIONS),this.player.getControls().getLayer(this.layer).appendChild(this.button),IS_IPHONE&&(this.player.getElement().addEventListener("webkitbeginfullscreen",()=>{this.isFullscreen=!0,this._setFullscreenData(!0),document.body.classList.add("op-fullscreen__on")},EVENT_OPTIONS),this.player.getElement().addEventListener("webkitendfullscreen",()=>{this.isFullscreen=!1,this._setFullscreenData(!1),document.body.classList.remove("op-fullscreen__on")},EVENT_OPTIONS))}destroy(){this.player.getContainer().removeEventListener("keydown",this._keydownEvent.bind(this)),this.fullscreenEvents.forEach(e=>{document.removeEventListener(e,this._fullscreenChange.bind(this))}),IS_IPHONE&&(this.player.getElement().removeEventListener("webkitbeginfullscreen",()=>{this.isFullscreen=!0,this._setFullscreenData(!1),document.body.classList.add("op-fullscreen__on")}),this.player.getElement().removeEventListener("webkitendfullscreen",()=>{this.isFullscreen=!1,this._setFullscreenData(!0),document.body.classList.remove("op-fullscreen__on")})),this.button.removeEventListener("click",this.clickEvent.bind(this)),removeElement(this.button)}toggleFullscreen(){if(this.isFullscreen){const e=document;e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():document.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msExitFullscreen?e.msExitFullscreen():this._fullscreenChange(),document.body.classList.remove("op-fullscreen__on")}else{const e=this.player.getElement();this.fullscreenWidth=window.screen.width,this.fullscreenHeight=window.screen.height,e.requestFullscreen?e.parentElement.requestFullscreen():e.mozRequestFullScreen?e.parentElement.mozRequestFullScreen():e.webkitRequestFullScreen?e.parentElement.webkitRequestFullScreen():e.msRequestFullscreen?e.parentElement.msRequestFullscreen():e.webkitEnterFullscreen?e.webkitEnterFullscreen():this._fullscreenChange(),document.body.classList.add("op-fullscreen__on")}if("undefined"!=typeof window&&(IS_ANDROID||IS_IPHONE)){const e=window.screen;e.orientation&&(this.isFullscreen||e.orientation.lock("landscape"))}}_fullscreenChange(){const e=this.isFullscreen?0:this.fullscreenWidth,t=this.isFullscreen?0:this.fullscreenHeight;this._setFullscreenData(!this.isFullscreen),this.player.isAd()&&this.player.getAd().resizeAds(e,t),this.isFullscreen=!this.isFullscreen,this.isFullscreen?document.body.classList.add("op-fullscreen__on"):document.body.classList.remove("op-fullscreen__on"),this._resize(e,t)}_setFullscreenData(e){this.player.getContainer().setAttribute("data-fullscreen",(!!e).toString()),e?this.button.classList.add("op-controls__fullscreen--out"):this.button.classList.remove("op-controls__fullscreen--out")}_resize(e,t){const s=this.player.getContainer(),l=this.player.getElement(),n=this.player.getOptions();let i="";if(e)s.style.width="100%",l.style.width="100%";else if(n.width){i+=`width: ${"number"==typeof n.width?`${n.width}px`:n.width} !important;`,l.style.removeProperty("width")}else l.style.removeProperty("width"),s.style.removeProperty("width");if(t)l.style.height="100%",s.style.height="100%";else if(n.height){i+=`height: ${"number"==typeof n.height?`${n.height}px`:n.height} !important;`,l.style.removeProperty("height")}else l.style.removeProperty("height"),s.style.removeProperty("height");i&&s.setAttribute("style",i)}_keydownEvent(e){70!==(e.which||e.keyCode||0)||e.ctrlKey||void 0===this.fullScreenEnabled||(this.toggleFullscreen(),e.preventDefault())}}export default Fullscreen;