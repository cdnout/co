(function(p){Ember.libraries.register("Ember Simple Auth","0.8.0");var b,a;(function(){var u={},t={};b=function(v,w,x){u[v]={deps:w,callback:x}};a=function(v){if(t.hasOwnProperty(v)){return t[v]}t[v]={};if(!u[v]){throw new Error("Could not find module "+v)}var A=u[v],E=A.deps,D=A.callback,y=[],x;for(var z=0,w=E.length;z<w;z++){if(E[z]==="exports"){y.push(x={})}else{y.push(a(C(E[z])))}}var B=D.apply(this,y);return t[v]=x||B;function C(K){if(K.charAt(0)!=="."){return K}var J=K.split("/");var G=v.split("/").slice(0,-1);for(var I=0,F=J.length;I<F;I++){var H=J[I];if(H===".."){G.pop()}else{if(H==="."){continue}else{G.push(H)}}}return G.join("/")}};a.registry=u})();b("simple-auth/authenticators/base",["exports"],function(t){t["default"]=Ember.Object.extend(Ember.Evented,{restore:function(u){return Ember.RSVP.reject()},authenticate:function(u){return Ember.RSVP.reject()},invalidate:function(u){return Ember.RSVP.resolve()}})});b("simple-auth/authorizers/base",["exports"],function(t){t["default"]=Ember.Object.extend({session:null,authorize:function(v,u){}})});b("simple-auth/configuration",["simple-auth/utils/load-config","exports"],function(w,u){var t=w["default"];var v={authenticationRoute:"login",routeAfterAuthentication:"index",routeIfAlreadyAuthenticated:"index",sessionPropertyName:"session",authorizer:null,session:"simple-auth-session:main",store:"simple-auth-session-store:local-storage",localStorageKey:"ember_simple_auth:session",crossOriginWhitelist:[],applicationRootUrl:null};u["default"]={authenticationRoute:v.authenticationRoute,routeAfterAuthentication:v.routeAfterAuthentication,routeIfAlreadyAuthenticated:v.routeIfAlreadyAuthenticated,sessionPropertyName:v.sessionPropertyName,authorizer:v.authorizer,session:v.session,store:v.store,localStorageKey:v.localStorageKey,crossOriginWhitelist:v.crossOriginWhitelist,applicationRootUrl:v.applicationRootUrl,load:t(v,function(x,y){this.applicationRootUrl=x.lookup("router:main").get("rootURL")||"/"})}});b("simple-auth/ember",["./initializer"],function(u){var t=u["default"];Ember.onLoad("Ember.Application",function(v){v.initializer(t)})});b("simple-auth/initializer",["./configuration","./utils/get-global-config","./setup","exports"],function(y,w,u,x){var v=y["default"];var z=w["default"];var t=u["default"];x["default"]={name:"simple-auth",initialize:function(A,C){var B=z("simple-auth");v.load(A,B);t(A,C)}}});b("simple-auth/mixins/application-route-mixin",["./../configuration","exports"],function(v,u){var t=v["default"];u["default"]=Ember.Mixin.create({activate:function(){this.set("_authRouteEntryComplete",true);this._super()},beforeModel:function(w){this._super(w);if(!this.get("_authEventListenersAssigned")){this.set("_authEventListenersAssigned",true);var x=this;Ember.A(["sessionAuthenticationSucceeded","sessionAuthenticationFailed","sessionInvalidationSucceeded","sessionInvalidationFailed","authorizationFailed"]).forEach(function(y){x.get(t.sessionPropertyName).on(y,function(z){Array.prototype.unshift.call(arguments,y);var A=x.get("_authRouteEntryComplete")?x:w;A.send.apply(A,arguments)})})}},actions:{sessionRequiresAuthentication:function(){this.transitionTo(t.authenticationRoute)},authenticateSession:function(){Ember.deprecate("The authenticateSession action is deprecated. Use sessionRequiresAuthentication instead.");this.send("sessionRequiresAuthentication")},sessionAuthenticationSucceeded:function(){var w=this.get(t.sessionPropertyName).get("attemptedTransition");if(w){w.retry();this.get(t.sessionPropertyName).set("attemptedTransition",null)}else{this.transitionTo(t.routeAfterAuthentication)}},sessionAuthenticationFailed:function(w){},invalidateSession:function(){Ember.deprecate("The invalidateSession action is deprecated. Use the session's invalidate method directly instead.");this.get(t.sessionPropertyName).invalidate()},sessionInvalidationSucceeded:function(){if(!Ember.testing){window.location.replace(t.applicationRootUrl)}},sessionInvalidationFailed:function(w){},authorizationFailed:function(){if(this.get(t.sessionPropertyName).get("isAuthenticated")){this.get(t.sessionPropertyName).invalidate()}}}})});b("simple-auth/mixins/authenticated-route-mixin",["./../configuration","exports"],function(v,u){var t=v["default"];u["default"]=Ember.Mixin.create({beforeModel:function(x){var w=this._super(x);if(!this.get(t.sessionPropertyName).get("isAuthenticated")){x.abort();this.get(t.sessionPropertyName).set("attemptedTransition",x);Ember.assert("The route configured as Configuration.authenticationRoute cannot implement the AuthenticatedRouteMixin mixin as that leads to an infinite transitioning loop!",this.get("routeName")!==t.authenticationRoute);x.send("sessionRequiresAuthentication")}return w}})});b("simple-auth/mixins/authentication-controller-mixin",["./../configuration","exports"],function(v,u){var t=v["default"];u["default"]=Ember.Mixin.create({authenticator:null,actions:{authenticate:function(w){Ember.deprecate("The AuthenticationControllerMixin is deprecated. Use the session's authenticate method directly instead.");var x=this.get("authenticator");Ember.assert("AuthenticationControllerMixin/LoginControllerMixin require the authenticator property to be set on the controller!",!Ember.isEmpty(x));return this.get(t.sessionPropertyName).authenticate(x,w)}}})});b("simple-auth/mixins/login-controller-mixin",["./../configuration","./authentication-controller-mixin","exports"],function(x,v,w){var u=x["default"];var t=v["default"];w["default"]=Ember.Mixin.create(t,{actions:{authenticate:function(){Ember.deprecate("The LoginControllerMixin is deprecated. Use the session's authenticate method directly instead.");var y=this.getProperties("identification","password");this.set("password",null);return this._super(y)}}})});b("simple-auth/mixins/unauthenticated-route-mixin",["./../configuration","exports"],function(v,u){var t=v["default"];u["default"]=Ember.Mixin.create({beforeModel:function(w){if(this.get(t.sessionPropertyName).get("isAuthenticated")){w.abort();Ember.assert("The route configured as Configuration.routeIfAlreadyAuthenticated cannot implement the UnauthenticatedRouteMixin mixin as that leads to an infinite transitioning loop!",this.get("routeName")!==t.routeIfAlreadyAuthenticated);this.transitionTo(t.routeIfAlreadyAuthenticated)}}})});b("simple-auth/session",["exports"],function(t){t["default"]=Ember.ObjectProxy.extend(Ember.Evented,{authenticator:null,store:null,container:null,isAuthenticated:false,attemptedTransition:null,content:null,initializeContent:Ember.on("init",function(){this.set("content",{secure:{}})}),authenticate:function(){var u=Array.prototype.slice.call(arguments);var v=u.shift();Ember.assert('Session#authenticate requires the authenticator factory to be specified, was "'+v+'"!',!Ember.isEmpty(v));var x=this;var w=this.container.lookup(v);Ember.assert('No authenticator for factory "'+v+'" could be found!',!Ember.isNone(w));return new Ember.RSVP.Promise(function(z,y){w.authenticate.apply(w,u).then(function(A){x.setup(v,A,true);z()},function(A){x.clear();x.trigger("sessionAuthenticationFailed",A);y(A)})})},invalidate:function(){Ember.assert("Session#invalidate requires the session to be authenticated!",this.get("isAuthenticated"));var u=this;return new Ember.RSVP.Promise(function(x,w){var v=u.container.lookup(u.authenticator);v.invalidate(u.content.secure).then(function(){v.off("sessionDataUpdated");u.clear(true);x()},function(y){u.trigger("sessionInvalidationFailed",y);w(y)})})},restore:function(){var u=this;return new Ember.RSVP.Promise(function(x,w){var y=u.store.restore();var v=(y.secure||{}).authenticator;if(!!v){delete y.secure.authenticator;u.container.lookup(v).restore(y.secure).then(function(z){u.set("content",y);u.setup(v,z);x()},function(){u.clear();w()})}else{u.clear();w()}})},setup:function(v,w,u){u=!!u&&!this.get("isAuthenticated");this.beginPropertyChanges();this.setProperties({isAuthenticated:true,authenticator:v});Ember.set(this.content,"secure",w);this.bindToAuthenticatorEvents();this.updateStore();this.endPropertyChanges();if(u){this.trigger("sessionAuthenticationSucceeded")}},clear:function(u){u=!!u&&this.get("isAuthenticated");this.beginPropertyChanges();this.setProperties({isAuthenticated:false,authenticator:null});Ember.set(this.content,"secure",{});this.updateStore();this.endPropertyChanges();if(u){this.trigger("sessionInvalidationSucceeded")}},setUnknownProperty:function(v,w){Ember.assert('"secure" is a reserved key used by Ember Simple Auth!',v!=="secure");var u=this._super(v,w);this.updateStore();return u},updateStore:function(){var u=this.content;if(!Ember.isEmpty(this.authenticator)){Ember.set(u,"secure",Ember.merge({authenticator:this.authenticator},u.secure||{}))}this.store.persist(u)},bindToAuthenticatorEvents:function(){var v=this;var u=this.container.lookup(this.authenticator);u.off("sessionDataUpdated");u.off("sessionDataInvalidated");u.on("sessionDataUpdated",function(w){v.setup(v.authenticator,w)});u.on("sessionDataInvalidated",function(w){v.clear(true)})},bindToStoreEvents:Ember.observer("store",function(){var u=this;this.store.on("sessionDataUpdated",function(w){var v=(w.secure||{}).authenticator;if(!!v){delete w.secure.authenticator;u.container.lookup(v).restore(w.secure).then(function(x){u.set("content",w);u.setup(v,x,true)},function(){u.set("content",w);u.clear(true)})}else{u.set("content",w);u.clear(true)}})})})});b("simple-auth/setup",["./configuration","./session","./stores/local-storage","./stores/ephemeral","exports"],function(B,u,F,x,w){var y=B["default"];var G=u["default"];var C=F["default"];var z=x["default"];var A="_wildcard_token_";function v(M){if(M==="*"){return M}M=M.replace("*",A);if(Ember.typeOf(M)==="string"){var O=document.createElement("a");O.href=M;O.href=O.href;M=O}var N=M.port;if(Ember.isEmpty(N)){N=M.protocol==="http:"?"80":(M.protocol==="https:"?"443":"")}return M.protocol+"//"+M.hostname+(N!==""?":"+N:"")}function D(M){return function(N){if(N.indexOf(A)>-1){var O=new RegExp(N.replace(A,".+"));return M.match(O)}return N.indexOf(M)>-1}}var H={};var L;function K(M){if(M.crossDomain===false||L.indexOf("*")>-1){return true}var N=H[M.url]=H[M.url]||v(M.url);return Ember.A(L).any(D(N))}function J(M){M.register("simple-auth-session-store:local-storage",C);M.register("simple-auth-session-store:ephemeral",z);M.register("simple-auth-session:main",G)}function E(M,O,N){if(K(M)){N.__simple_auth_authorized__=true;E.authorizer.authorize(N,M)}}function t(P,O,N,M){if(!!O.__simple_auth_authorized__&&O.status===401){t.session.trigger("authorizationFailed")}}var I=false;w["default"]=function(M,O){O.deferReadiness();J(O);var N=M.lookup(y.store);var Q=M.lookup(y.session);Q.set("store",N);Ember.A(["controller","route","component"]).forEach(function(S){O.inject(S,y.sessionPropertyName,y.session)});L=Ember.A(y.crossOriginWhitelist).map(function(S){return v(S)});if(!Ember.isEmpty(y.authorizer)){var R=M.lookup(y.authorizer);Ember.assert('The configured authorizer "'+y.authorizer+'" could not be found in the container!',!Ember.isEmpty(R));R.set("session",Q);E.authorizer=R;t.session=Q;if(!I){Ember.$.ajaxPrefilter("+*",E);Ember.$(document).ajaxError(t);I=true}}else{Ember.Logger.info("No authorizer was configured for Ember Simple Auth - specify one if backend requests need to be authorized.")}var P=function(){O.advanceReadiness()};Q.restore().then(P,P)}});b("simple-auth/stores/base",["../utils/objects-are-equal","exports"],function(v,u){var t=v["default"];u["default"]=Ember.Object.extend(Ember.Evented,{persist:function(w){},restore:function(){return{}},clear:function(){}})});b("simple-auth/stores/ephemeral",["./base","exports"],function(v,u){var t=v["default"];u["default"]=t.extend({init:function(){this.clear()},persist:function(w){this._data=JSON.stringify(w||{})},restore:function(){return JSON.parse(this._data)||{}},clear:function(){delete this._data;this._data="{}"}})});b("simple-auth/stores/local-storage",["./base","../utils/objects-are-equal","../configuration","exports"],function(z,w,t,y){var u=z["default"];var x=w["default"];var v=t["default"];y["default"]=u.extend({key:"ember_simple_auth:session",init:function(){this.key=v.localStorageKey;this.bindToStorageEvents()},persist:function(A){A=JSON.stringify(A||{});localStorage.setItem(this.key,A);this._lastData=this.restore()},restore:function(){var A=localStorage.getItem(this.key);return JSON.parse(A)||{}},clear:function(){localStorage.removeItem(this.key);this._lastData={}},bindToStorageEvents:function(){var A=this;Ember.$(window).bind("storage",function(C){var B=A.restore();if(!x(B,A._lastData)){A._lastData=B;A.trigger("sessionDataUpdated",B)}})}})});b("simple-auth/utils/get-global-config",["exports"],function(u){var t=(typeof window!=="undefined")?window:{};u["default"]=function(v){return Ember.get(t,"ENV."+v)||{}}});b("simple-auth/utils/load-config",["exports"],function(t){t["default"]=function(u,v){return function(w,x){var y=Ember.Object.create(x);for(var z in this){if(this.hasOwnProperty(z)&&Ember.typeOf(this[z])!=="function"){this[z]=y.getWithDefault(z,u[z])}}if(v){v.apply(this,[w,x])}}}});b("simple-auth/utils/objects-are-equal",["exports"],function(u){u["default"]=function t(w,v){function x(z,B){var A;if(isNaN(z)&&isNaN(B)&&typeof z==="number"&&typeof B==="number"){return true}if(z===B){return true}if(!(z instanceof Object&&B instanceof Object)){return false}for(A in B){if(B.hasOwnProperty(A)!==z.hasOwnProperty(A)){return false}else{if(typeof B[A]!==typeof z[A]){return false}}}for(A in z){if(B.hasOwnProperty(A)!==z.hasOwnProperty(A)){return false}else{if(typeof B[A]!==typeof z[A]){return false}}switch(typeof(z[A])){case"object":if(!x(z[A],B[A])){return false}break;default:if(z[A]!==B[A]){return false}break}}return true}return x(w,v)}});var q=a("simple-auth/initializer")["default"];var h=a("simple-auth/configuration")["default"];var m=a("simple-auth/session")["default"];var c=a("simple-auth/authenticators/base")["default"];var d=a("simple-auth/authorizers/base")["default"];var n=a("simple-auth/stores/base")["default"];var o=a("simple-auth/stores/local-storage")["default"];var r=a("simple-auth/stores/ephemeral")["default"];var k=a("simple-auth/utils/objects-are-equal")["default"];var g=a("simple-auth/utils/get-global-config")["default"];var i=a("simple-auth/utils/load-config")["default"];var l=a("simple-auth/mixins/application-route-mixin")["default"];var s=a("simple-auth/mixins/authenticated-route-mixin")["default"];var j=a("simple-auth/mixins/authentication-controller-mixin")["default"];var e=a("simple-auth/mixins/login-controller-mixin")["default"];var f=a("simple-auth/mixins/unauthenticated-route-mixin")["default"];p.SimpleAuth={Configuration:h,Session:m,Authenticators:{Base:c},Authorizers:{Base:d},Stores:{Base:n,LocalStorage:o,Ephemeral:r},Utils:{objectsAreEqual:k,getGlobalConfig:g,loadConfig:i},ApplicationRouteMixin:l,AuthenticatedRouteMixin:s,AuthenticationControllerMixin:j,LoginControllerMixin:e,UnauthenticatedRouteMixin:f};a("simple-auth/ember")})((typeof global!=="undefined")?global:window);