(function(c){var d=c.define;var b=c.require;var a=c.Ember;if(typeof a==="undefined"&&typeof b!=="undefined"){a=b("ember")}a.libraries.register("Ember Simple Auth OAuth 2.0","0.8.0");d("simple-auth-oauth2/authenticators/oauth2",["simple-auth/authenticators/base","./../configuration","exports"],function(i,g,h){var e=i["default"];var f=g["default"];h["default"]=e.extend({serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:true,_refreshTokenTimeout:null,init:function(){this.serverTokenEndpoint=f.serverTokenEndpoint;this.serverTokenRevocationEndpoint=f.serverTokenRevocationEndpoint;this.refreshAccessTokens=f.refreshAccessTokens},restore:function(j){var k=this;return new a.RSVP.Promise(function(n,m){var l=(new Date()).getTime();if(!a.isEmpty(j.expires_at)&&j.expires_at<l){if(k.refreshAccessTokens){k.refreshAccessToken(j.expires_in,j.refresh_token).then(function(o){n(o)},m)}else{m()}}else{if(a.isEmpty(j.access_token)){m()}else{k.scheduleAccessTokenRefresh(j.expires_in,j.expires_at,j.refresh_token);n(j)}}})},authenticate:function(j){var k=this;return new a.RSVP.Promise(function(o,n){var m={grant_type:"password",username:j.identification,password:j.password};if(!a.isEmpty(j.scope)){var l=a.makeArray(j.scope).join(" ");a.merge(m,{scope:l})}k.makeRequest(k.serverTokenEndpoint,m).then(function(p){a.run(function(){var q=k.absolutizeExpirationTime(p.expires_in);k.scheduleAccessTokenRefresh(p.expires_in,q,p.refresh_token);if(!a.isEmpty(q)){p=a.merge(p,{expires_at:q})}o(p)})},function(r,p,q){a.run(function(){n(r.responseJSON||r.responseText)})})})},invalidate:function(j){var l=this;function k(m){a.run.cancel(l._refreshTokenTimeout);delete l._refreshTokenTimeout;m()}return new a.RSVP.Promise(function(n,m){if(a.isEmpty(l.serverTokenRevocationEndpoint)){k(n)}else{var o=[];a.A(["access_token","refresh_token"]).forEach(function(q){var p=j[q];if(!a.isEmpty(p)){o.push(l.makeRequest(l.serverTokenRevocationEndpoint,{token_type_hint:q,token:p}))}});a.$.when.apply(a.$,o).always(function(p){k(n)})}})},makeRequest:function(j,k){return a.$.ajax({url:j,type:"POST",data:k,dataType:"json",contentType:"application/x-www-form-urlencoded"})},scheduleAccessTokenRefresh:function(k,j,m){var o=this;if(this.refreshAccessTokens){var l=(new Date()).getTime();if(a.isEmpty(j)&&!a.isEmpty(k)){j=new Date(l+k*1000).getTime()}var n=(Math.floor(Math.random()*5)+5)*1000;if(!a.isEmpty(m)&&!a.isEmpty(j)&&j>l-n){a.run.cancel(this._refreshTokenTimeout);delete this._refreshTokenTimeout;if(!a.testing){this._refreshTokenTimeout=a.run.later(this,this.refreshAccessToken,k,m,j-l-n)}}}},refreshAccessToken:function(j,k){var m=this;var l={grant_type:"refresh_token",refresh_token:k};return new a.RSVP.Promise(function(o,n){m.makeRequest(m.serverTokenEndpoint,l).then(function(p){a.run(function(){j=p.expires_in||j;k=p.refresh_token||k;var q=m.absolutizeExpirationTime(j);var r=a.merge(p,{expires_in:j,expires_at:q,refresh_token:k});m.scheduleAccessTokenRefresh(j,null,k);m.trigger("sessionDataUpdated",r);o(r)})},function(r,p,q){a.Logger.warn("Access token could not be refreshed - server responded with "+q+".");n()})})},absolutizeExpirationTime:function(j){if(!a.isEmpty(j)){return new Date((new Date().getTime())+j*1000).getTime()}}})});d("simple-auth-oauth2/authorizers/oauth2",["simple-auth/authorizers/base","exports"],function(g,f){var e=g["default"];f["default"]=e.extend({authorize:function(j,h){var i=this.get("session.secure.access_token");if(this.get("session.isAuthenticated")&&!a.isEmpty(i)){j.setRequestHeader("Authorization","Bearer "+i)}}})});d("simple-auth-oauth2/configuration",["simple-auth/utils/load-config","exports"],function(h,f){var e=h["default"];var g={serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:true};f["default"]={serverTokenEndpoint:g.serverTokenEndpoint,serverTokenRevocationEndpoint:g.serverTokenRevocationEndpoint,refreshAccessTokens:g.refreshAccessTokens,load:e(g)}});d("simple-auth-oauth2/ember",["./initializer"],function(f){var e=f["default"];a.onLoad("Ember.Application",function(g){g.initializer(e)})});d("simple-auth-oauth2/initializer",["./configuration","simple-auth/utils/get-global-config","simple-auth-oauth2/authenticators/oauth2","simple-auth-oauth2/authorizers/oauth2","exports"],function(k,m,g,i,l){var h=k["default"];var e=m["default"];var j=g["default"];var f=i["default"];l["default"]={name:"simple-auth-oauth2",before:"simple-auth",initialize:function(n,p){var o=e("simple-auth-oauth2");h.load(n,o);p.register("simple-auth-authorizer:oauth2-bearer",f);p.register("simple-auth-authenticator:oauth2-password-grant",j)}}})})(this);