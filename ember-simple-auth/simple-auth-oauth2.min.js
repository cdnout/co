(function(e){Ember.libraries.register("Ember Simple Auth OAuth 2.0","0.8.0");var g,a;(function(){var i={},h={};g=function(j,k,l){i[j]={deps:k,callback:l}};a=function(j){if(h.hasOwnProperty(j)){return h[j]}h[j]={};if(!i[j]){throw new Error("Could not find module "+j)}var p=i[j],t=p.deps,s=p.callback,n=[],m;for(var o=0,k=t.length;o<k;o++){if(t[o]==="exports"){n.push(m={})}else{n.push(a(r(t[o])))}}var q=s.apply(this,n);return h[j]=m||q;function r(z){if(z.charAt(0)!=="."){return z}var y=z.split("/");var v=j.split("/").slice(0,-1);for(var x=0,u=y.length;x<u;x++){var w=y[x];if(w===".."){v.pop()}else{if(w==="."){continue}else{v.push(w)}}}return v.join("/")}};a.registry=i})();g("simple-auth-oauth2/authenticators/oauth2",["simple-auth/authenticators/base","./../configuration","exports"],function(l,j,k){var h=l["default"];var i=j["default"];k["default"]=h.extend({serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:true,_refreshTokenTimeout:null,init:function(){this.serverTokenEndpoint=i.serverTokenEndpoint;this.serverTokenRevocationEndpoint=i.serverTokenRevocationEndpoint;this.refreshAccessTokens=i.refreshAccessTokens},restore:function(m){var n=this;return new Ember.RSVP.Promise(function(q,p){var o=(new Date()).getTime();if(!Ember.isEmpty(m.expires_at)&&m.expires_at<o){if(n.refreshAccessTokens){n.refreshAccessToken(m.expires_in,m.refresh_token).then(function(r){q(r)},p)}else{p()}}else{if(Ember.isEmpty(m.access_token)){p()}else{n.scheduleAccessTokenRefresh(m.expires_in,m.expires_at,m.refresh_token);q(m)}}})},authenticate:function(m){var n=this;return new Ember.RSVP.Promise(function(r,q){var p={grant_type:"password",username:m.identification,password:m.password};if(!Ember.isEmpty(m.scope)){var o=Ember.makeArray(m.scope).join(" ");Ember.merge(p,{scope:o})}n.makeRequest(n.serverTokenEndpoint,p).then(function(s){Ember.run(function(){var t=n.absolutizeExpirationTime(s.expires_in);n.scheduleAccessTokenRefresh(s.expires_in,t,s.refresh_token);if(!Ember.isEmpty(t)){s=Ember.merge(s,{expires_at:t})}r(s)})},function(u,s,t){Ember.run(function(){q(u.responseJSON||u.responseText)})})})},invalidate:function(m){var o=this;function n(p){Ember.run.cancel(o._refreshTokenTimeout);delete o._refreshTokenTimeout;p()}return new Ember.RSVP.Promise(function(q,p){if(Ember.isEmpty(o.serverTokenRevocationEndpoint)){n(q)}else{var r=[];Ember.A(["access_token","refresh_token"]).forEach(function(t){var s=m[t];if(!Ember.isEmpty(s)){r.push(o.makeRequest(o.serverTokenRevocationEndpoint,{token_type_hint:t,token:s}))}});Ember.$.when.apply(Ember.$,r).always(function(s){n(q)})}})},makeRequest:function(m,n){return Ember.$.ajax({url:m,type:"POST",data:n,dataType:"json",contentType:"application/x-www-form-urlencoded"})},scheduleAccessTokenRefresh:function(n,m,p){var r=this;if(this.refreshAccessTokens){var o=(new Date()).getTime();if(Ember.isEmpty(m)&&!Ember.isEmpty(n)){m=new Date(o+n*1000).getTime()}var q=(Math.floor(Math.random()*5)+5)*1000;if(!Ember.isEmpty(p)&&!Ember.isEmpty(m)&&m>o-q){Ember.run.cancel(this._refreshTokenTimeout);delete this._refreshTokenTimeout;if(!Ember.testing){this._refreshTokenTimeout=Ember.run.later(this,this.refreshAccessToken,n,p,m-o-q)}}}},refreshAccessToken:function(m,n){var p=this;var o={grant_type:"refresh_token",refresh_token:n};return new Ember.RSVP.Promise(function(r,q){p.makeRequest(p.serverTokenEndpoint,o).then(function(s){Ember.run(function(){m=s.expires_in||m;n=s.refresh_token||n;var t=p.absolutizeExpirationTime(m);var u=Ember.merge(s,{expires_in:m,expires_at:t,refresh_token:n});p.scheduleAccessTokenRefresh(m,null,n);p.trigger("sessionDataUpdated",u);r(u)})},function(u,s,t){Ember.Logger.warn("Access token could not be refreshed - server responded with "+t+".");q()})})},absolutizeExpirationTime:function(m){if(!Ember.isEmpty(m)){return new Date((new Date().getTime())+m*1000).getTime()}}})});g("simple-auth-oauth2/authorizers/oauth2",["simple-auth/authorizers/base","exports"],function(j,i){var h=j["default"];i["default"]=h.extend({authorize:function(m,k){var l=this.get("session.secure.access_token");if(this.get("session.isAuthenticated")&&!Ember.isEmpty(l)){m.setRequestHeader("Authorization","Bearer "+l)}}})});g("simple-auth-oauth2/configuration",["simple-auth/utils/load-config","exports"],function(k,i){var h=k["default"];var j={serverTokenEndpoint:"/token",serverTokenRevocationEndpoint:null,refreshAccessTokens:true};i["default"]={serverTokenEndpoint:j.serverTokenEndpoint,serverTokenRevocationEndpoint:j.serverTokenRevocationEndpoint,refreshAccessTokens:j.refreshAccessTokens,load:h(j)}});g("simple-auth-oauth2/ember",["./initializer"],function(i){var h=i["default"];Ember.onLoad("Ember.Application",function(j){j.initializer(h)})});g("simple-auth-oauth2/initializer",["./configuration","simple-auth/utils/get-global-config","simple-auth-oauth2/authenticators/oauth2","simple-auth-oauth2/authorizers/oauth2","exports"],function(n,p,j,l,o){var k=n["default"];var h=p["default"];var m=j["default"];var i=l["default"];o["default"]={name:"simple-auth-oauth2",before:"simple-auth",initialize:function(q,s){var r=h("simple-auth-oauth2");k.load(q,r);s.register("simple-auth-authorizer:oauth2-bearer",i);s.register("simple-auth-authenticator:oauth2-password-grant",m)}}});g("simple-auth/authenticators/base",["exports"],function(h){h["default"]=e.SimpleAuth.Authenticators.Base});g("simple-auth/authorizers/base",["exports"],function(h){h["default"]=e.SimpleAuth.Authorizers.Base});g("simple-auth/utils/get-global-config",["exports"],function(h){h["default"]=e.SimpleAuth.Utils.getGlobalConfig});g("simple-auth/utils/load-config",["exports"],function(h){h["default"]=e.SimpleAuth.Utils.loadConfig});var d=a("simple-auth-oauth2/initializer")["default"];var b=a("simple-auth-oauth2/configuration")["default"];var f=a("simple-auth-oauth2/authenticators/oauth2")["default"];var c=a("simple-auth-oauth2/authorizers/oauth2")["default"];e.SimpleAuth.Configuration.OAuth2=b;e.SimpleAuth.Authenticators.OAuth2=f;e.SimpleAuth.Authorizers.OAuth2=c;a("simple-auth-oauth2/ember")})((typeof global!=="undefined")?global:window);