import Mmenu from"../../core/oncanvas/mmenu.oncanvas";import options from"./_options";import configs from"./_configs";import{extendShorthandOptions}from"./_options";import*as DOM from"../../_modules/dom";import{extend,originalId}from"../../_modules/helpers";Mmenu.options.dropdown=options,Mmenu.configs.dropdown=configs;export default function(){var t=this;if(this.opts.offCanvas){var o=extendShorthandOptions(this.opts.dropdown);this.opts.dropdown=extend(o,Mmenu.options.dropdown);var e=this.conf.dropdown;if(o.drop){var n;this.bind("initMenu:after",function(){if(t.node.menu.classList.add("mm-menu_dropdown"),"string"!=typeof o.position.of){var e=originalId(t.node.menu.id);e&&(o.position.of='[href="#'+e+'"]')}if("string"==typeof o.position.of){n=DOM.find(document.body,o.position.of)[0];var i=o.event.split(" ");1==i.length&&(i[1]=i[0]),"hover"==i[0]&&n.addEventListener("mouseenter",function(){t.open()},{passive:!0}),"hover"==i[1]&&t.node.menu.addEventListener("mouseleave",function(){t.close()},{passive:!0})}}),this.bind("open:start",function(){t.node.menu.mmStyle=t.node.menu.getAttribute("style"),t.node.wrpr.classList.add("mm-wrapper_dropdown")}),this.bind("close:finish",function(){t.node.menu.setAttribute("style",t.node.menu.mmStyle),t.node.wrpr.classList.remove("mm-wrapper_dropdown")});var i=function(t,i){var s,r,m=i[0],d=i[1],p="x"==t?"offsetWidth":"offsetHeight",f="x"==t?"left":"top",a="x"==t?"right":"bottom",u="x"==t?"width":"height",h="x"==t?"innerWidth":"innerHeight",c="x"==t?"maxWidth":"maxHeight",l=null,v=DOM.offset(n,f),w=v+n[p],x=window[h],b=e.offset.button[t]+e.offset.viewport[t];if(o.position[t])switch(o.position[t]){case"left":case"bottom":l="after";break;case"right":case"top":l="before"}return null===l&&(l=v+(w-v)/2<x/2?"after":"before"),"after"==l?(r=x-((s="x"==t?v:w)+b),m[f]=s+e.offset.button[t]+"px",m[a]="auto",o.tip&&d.push("mm-menu_tip-"+("x"==t?"left":"top"))):(r=(s="x"==t?w:v)-b,m[a]="calc( 100% - "+(s-e.offset.button[t])+"px )",m[f]="auto",o.tip&&d.push("mm-menu_tip-"+("x"==t?"right":"bottom"))),o.fitViewport&&(m[c]=Math.min(e[u].max,r)+"px"),[m,d]};this.bind("open:start",s),window.addEventListener("resize",function(o){s.call(t)},{passive:!0}),this.opts.offCanvas.blockUI||window.addEventListener("scroll",function(o){s.call(t)},{passive:!0})}}function s(){var t=this;if(this.vars.opened){this.node.menu.setAttribute("style",this.node.menu.mmStyle);var e=[{},[]];for(var n in e=i.call(this,"y",e),(e=i.call(this,"x",e))[0])this.node.menu.style[n]=e[0][n];if(o.tip){["mm-menu_tip-left","mm-menu_tip-right","mm-menu_tip-top","mm-menu_tip-bottom"].forEach(function(o){t.node.menu.classList.remove(o)}),e[1].forEach(function(o){t.node.menu.classList.add(o)})}}}};