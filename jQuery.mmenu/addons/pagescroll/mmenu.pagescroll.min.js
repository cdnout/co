import Mmenu from"../../core/oncanvas/mmenu.oncanvas";import options from"./_options";import configs from"./_configs";import{extendShorthandOptions}from"./_options";import*as DOM from"../../_modules/dom";import{extend}from"../../_modules/helpers";Mmenu.options.pageScroll=options,Mmenu.configs.pageScroll=configs;export default function(){var e=this,n=extendShorthandOptions(this.opts.pageScroll);this.opts.pageScroll=extend(n,Mmenu.options.pageScroll);var o,t=this.conf.pageScroll;function i(){o&&window.scrollTo({top:o.getBoundingClientRect().top+document.scrollingElement.scrollTop-t.scrollOffset,behavior:"smooth"}),o=null}function r(e){try{return"#"!=e&&"#"==e.slice(0,1)?Mmenu.node.page.querySelector(e):null}catch(e){return null}}if(n.scroll&&this.bind("close:finish",function(){i()}),this.opts.offCanvas&&n.scroll&&this.clck.push(function(n,t){if(o=null,t.inMenu){var l=n.getAttribute("href");if(o=r(l))return e.node.menu.matches(".mm-menu_sidebar-expanded")&&e.node.wrpr.matches(".mm-wrapper_sidebar-expanded")?void i():{close:!0}}}),n.update){var l=[];this.bind("initListview:after",function(e){var n=DOM.children(e,".mm-listitem");DOM.filterLIA(n).forEach(function(e){var n=r(e.getAttribute("href"));n&&l.unshift(n)})});var s=-1;window.addEventListener("scroll",function(n){for(var o=window.scrollY,i=0;i<l.length;i++)if(l[i].offsetTop<o+t.updateOffset){if(s!==i){s=i;var r=DOM.children(e.node.pnls,".mm-panel_opened")[0],c=DOM.find(r,".mm-listitem"),f=DOM.filterLIA(c);(f=f.filter(function(e){return e.matches('[href="#'+l[i].id+'"]')})).length&&e.setSelected(f[0].parentElement)}break}})}};