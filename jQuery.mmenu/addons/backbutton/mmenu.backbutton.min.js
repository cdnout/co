import Mmenu from"../../core/oncanvas/mmenu.oncanvas";import options from"./_options";import{extendShorthandOptions}from"./_options";import*as DOM from"../../_modules/dom";import{extend}from"../../_modules/helpers";Mmenu.options.backButton=options;export default function(){var n=this;if(this.opts.offCanvas){var o=extendShorthandOptions(this.opts.backButton);this.opts.backButton=extend(o,Mmenu.options.backButton);var t="#"+this.node.menu.id;if(o.close){var e=[],i=function(){e=[t],DOM.children(n.node.pnls,".mm-panel_opened, .mm-panel_opened-parent").forEach(function(n){e.push("#"+n.id)})};this.bind("open:finish",function(){history.pushState(null,document.title,t)}),this.bind("open:finish",i),this.bind("openPanel:finish",i),this.bind("close:finish",function(){e=[],history.back(),history.pushState(null,document.title,location.pathname+location.search)}),window.addEventListener("popstate",function(o){if(n.vars.opened&&e.length){var i=(e=e.slice(0,-1))[e.length-1];i==t?n.close():(n.openPanel(n.node.menu.querySelector(i)),history.pushState(null,document.title,t))}})}o.open&&window.addEventListener("popstate",function(o){n.vars.opened||location.hash!=t||n.open()})}};