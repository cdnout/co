import*as support from"./_support";import*as options from"./_defaults";import*as settings from"./_settings";import{percentage2number}from"./_helpers";import{extend}from"../helpers";var DragEvents=function(){function t(t,s,e){this.surface=t,this.area=extend(s,options.area),this.treshold=extend(e,options.treshold),this.surface.mmHasDragEvents||(this.surface.addEventListener(support.touch?"touchstart":"mousedown",this.start.bind(this)),this.surface.addEventListener(support.touch?"touchend":"mouseup",this.stop.bind(this)),this.surface.addEventListener(support.touch?"touchleave":"mouseleave",this.stop.bind(this)),this.surface.addEventListener(support.touch?"touchmove":"mousemove",this.move.bind(this))),this.surface.mmHasDragEvents=!0}return t.prototype.start=function(t){this.currentPosition={x:t.touches?t.touches[0].pageX:t.pageX||0,y:t.touches?t.touches[0].pageY:t.pageY||0};var s=this.surface.clientWidth,e=this.surface.clientHeight,i=percentage2number(this.area.top,e);if(!("number"==typeof i&&this.currentPosition.y<i)){var a=percentage2number(this.area.right,s);if(!("number"==typeof a&&(a=s-a,this.currentPosition.x>a))){var r=percentage2number(this.area.bottom,e);if(!("number"==typeof r&&(r=e-r,this.currentPosition.y>r))){var n=percentage2number(this.area.left,s);"number"==typeof n&&this.currentPosition.x<n||(this.startPosition={x:this.currentPosition.x,y:this.currentPosition.y},this.state=settings.state.watching)}}}},t.prototype.stop=function(t){if(this.state==settings.state.dragging){var s=this._dragDirection(),e=this._eventDetail(s);if(this._dispatchEvents("drag*End",e),Math.abs(this.movement[this.axis])>this.treshold.swipe){var i=this._swipeDirection();e.direction=i,this._dispatchEvents("swipe*",e)}}this.state=settings.state.inactive},t.prototype.move=function(t){switch(this.state){case settings.state.watching:case settings.state.dragging:var s={x:t.changedTouches?t.touches[0].pageX:t.pageX||0,y:t.changedTouches?t.touches[0].pageY:t.pageY||0};this.movement={x:s.x-this.currentPosition.x,y:s.y-this.currentPosition.y},this.distance={x:s.x-this.startPosition.x,y:s.y-this.startPosition.y},this.currentPosition={x:s.x,y:s.y},this.axis=Math.abs(this.distance.x)>Math.abs(this.distance.y)?"x":"y";var e=this._dragDirection(),i=this._eventDetail(e);this.state==settings.state.watching&&Math.abs(this.distance[this.axis])>this.treshold.start&&(this._dispatchEvents("drag*Start",i),this.state=settings.state.dragging),this.state==settings.state.dragging&&this._dispatchEvents("drag*Move",i)}},t.prototype._eventDetail=function(t){var s=this.distance.x,e=this.distance.y;return"x"==this.axis&&(s-=s>0?this.treshold.start:0-this.treshold.start),"y"==this.axis&&(e-=e>0?this.treshold.start:0-this.treshold.start),{axis:this.axis,direction:t,movementX:this.movement.x,movementY:this.movement.y,distanceX:s,distanceY:e}},t.prototype._dispatchEvents=function(t,s){var e=new CustomEvent(t.replace("*",""),{detail:s});this.surface.dispatchEvent(e);var i=new CustomEvent(t.replace("*",this.axis.toUpperCase()),{detail:s});this.surface.dispatchEvent(i);var a=new CustomEvent(t.replace("*",s.direction),{detail:s});this.surface.dispatchEvent(a)},t.prototype._dragDirection=function(){return settings.directionNames[this.axis][this.distance[this.axis]>0?0:1]},t.prototype._swipeDirection=function(){return settings.directionNames[this.axis][this.movement[this.axis]>0?0:1]},t}();export default DragEvents;