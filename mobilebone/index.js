!function(e,a){document.MBLOADED?e.console&&console.warn("Don't repeat load Mobilebone!"):"function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(t){return a(e,t)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(e,{}):e.Mobilebone=a(e,{})}("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,function(t,m){var y={},h=[].slice,o=/^#?\w+(?:[\-_]\w+)*$/i,f="WebkitAppearance"in document.documentElement.style||void 0!==document.webkitHidden,g="pushState"in history&&"replaceState"in history;m.support=g;var s=!1;if(m.VERSION="2.8.1",m.autoInit=!0,m.captureLink=!0,m.captureForm=!0,m.rootTransition=t,m.mergeCallback=!0,m.classAnimation="slide",m.classPage="page",m.classMask="mask",m.pushStateEnabled=!0,m.evalScript=!1,0<=navigator.userAgent.indexOf("Firefox")&&window.top!==window&&(m.pushStateEnabled=!1),0==g)return m;history.popstate=!1,m.transition=function(t,e,a,o){if(0!=arguments.length&&t!=e){3==arguments.length&&1==isNaN(+a)&&(a=(o=a).back),e=e||null,a=a||!1,o=o||{};function s(a){if(!a||!a.getAttribute)return{};var n={},i=v(a.getAttribute("data-params")||"");return["title","root","form"].forEach(function(t){n[t]=a.getAttribute("data-"+t)||i[t]||o[t]||r[t]}),"string"==typeof n.root&&(n.root=m.getFunction(n.root)),["onpagefirstinto","callback","fallback","animationstart","animationend","preventdefault"].forEach(function(t){var e;1==m.mergeCallback&&"function"==typeof r[t]?(e=a.getAttribute("data-"+t)||i[t],"function"==typeof n.root[e]?n[t]=function(){r[t].apply(this,arguments),n.root[e].apply(this,arguments)}:"function"==typeof o[t]?n[t]=function(){r[t].apply(this,arguments),o[t].apply(this,arguments)}:n[t]=r[t]):n[t]=a.getAttribute("data-"+t)||i[t]||o[t]||r[t]}),n}var n,i,r={root:this.rootTransition,form:this.form||this.classAnimation,onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,preventdefault:this.preventdefault,fallback:this.fallback,callback:this.callback},l=s(e),c=s(t);if(null!=e&&e.classList&&(u=!1,"string"==typeof(n=l.preventdefault)&&(n=l.root[n])),null!=t&&t.classList&&(p=!1,"string"==typeof(i=c.preventdefault)&&(i=c.root[i])),"function"==typeof n&&(u=n.call(l.root,t,e,o)),1==u&&n===i)return!1;if("function"==typeof i&&(p=i.call(c.root,t,e,o)),1==p)return!1;var u,d,p=function(i,r){1!=i.flagAniBind&&["animationstart","animationend"].forEach(function(t,e){var a=c[t],n="webkit"+t.replace(/^a|s|e/g,function(t){return t.toUpperCase()}),t=f?n:t;e&&i.addEventListener(t,function(){0==this.classList.contains("in")&&(this.style.display="none"),this.classList.remove(s(this).form)}),"string"==typeof a&&c.root[a]?i.addEventListener(t,function(){r.root[a].call(r.root,this,this.classList.contains("in")?"into":"out",o)}):"function"==typeof a&&i.addEventListener(t,function(){a.call(r.root,this,this.classList.contains("in")?"into":"out",o)}),i.flagAniBind=!0})};null!=e&&e.classList&&1!=u&&(e.classList.add(l.form),e.offsetWidth,e.style.display="block",e.classList.add("out"),e.classList.remove("in"),e.classList[a?"add":"remove"]("reverse"),e.removeSelf=e.removeSelf||null,p(e,l),"string"==typeof(d=l.fallback)&&(d=l.root[d]),"function"==typeof d&&d.call(l.root,t,e,o)),null!=t&&t.classList&&(u=c.title,d=document.querySelector("h1"),l=document.querySelector("."+this.classPage),u&&!1!==o.title?(document.title=u,d&&(d.innerHTML=u,d.title=u)):l==t&&!e&&document.title&&t.setAttribute("data-title",document.title),d=o.id||t.id,u=o.id||t.id,e&&t.classList.add(c.form),t.offsetWidth,t.style.display="block",t.classList.remove("out"),t.classList.add("in"),t.classList[a?"add":"remove"]("reverse"),l=c.onpagefirstinto,t.firstintoBind||("string"==typeof l&&c.root[l]?c.root[l].call(c.root,t,e,o):"function"==typeof l&&l.call(c.root,t,e,o),h.call(t.querySelectorAll("form")).forEach(function(t){m.submit(t)}),t.firstintoBind=!0),p(t,c),p="",(u=u)&&0==/#/.test(u)&&(u="#"+u),p=u.replace(/#/,"#&"),g&&this.pushStateEnabled&&!1!==o.history&&u&&p!=location.hash&&(history.popstate=!1,history[e?"pushState":"replaceState"](null,document.title,u.replace(/#/,"#&"))),y[d]||(y[d]=t),"string"==typeof(d=c.callback)&&(d=c.root[d]),"function"==typeof d&&d.call(c.root,t,e,o),setTimeout(function(){history.popstate=!0},17),0==a&&0==history.popstate?y.lastShip=[t,e]:y.lastShip=null)}},m.remove=function(t){if(!t)return this;var e=t,t=t;if("string"==typeof t?e=y[t]:e.tagName&&"a"==e.tagName.toLowerCase()&&(t=this.getCleanUrl(e),e=y[t]),e&&e.parentElement){for(var a in y)y[a]==e&&delete y[a];e.parentElement.removeChild(e)}},m.getCleanUrl=function(t,e,a){var n="",i="",r="";if(t)if(1==t.nodeType)if(t.action){if(n=t.getAttribute("action"),t.method&&"POST"==t.method.toUpperCase())return n;window.$&&$.fn&&$.fn.serialize?i=$(t).serialize():(i={},h.call(t.querySelectorAll("input,select,textarea")).forEach(function(t){var e,a;t.name&&!t.disabled&&(e=t.value.trim(),a=t.name,/^radio|checkbox/i.test(t.type)?t.checked&&(i[a]?i[a].push(e):i[a]=[e]):i[a]=[e])}))}else{n=t.getAttribute("href"),/^javascript/.test(n)&&(n=""),i=t.getAttribute("data-formdata")||t.getAttribute("data-params")||"";var o="container",s=t.getAttribute("data-"+o);-1==i.indexOf(o)&&s&&(s=o+"="+s,i=i?i+"&"+s:s)}else t.url&&(n=t.url,i=t.data);if(!(n=n||e))return"";if("object"==typeof(i=i||a||"")){var l=[];for(key in i)i[key].forEach||(i[key]=[i[key]]),i[key].forEach(function(t){l.push(key+"="+encodeURIComponent(t))});i=0<l.length?l.join("&"):""}return"?"==(r=n.split("#")[0].replace(/&+$/,"").replace(/^\.\/+/,"")).slice(-1)&&(r=r.split("?")[0]),""!=i&&(/\?/.test(r)?r=r+"&"+(i=i.replace(/^&|\?/,"")):""!=i&&(r=r+"?"+(i=i.replace("?","")))),r},m.createPage=function(t,e,a){var n,i,r,o,s,l,c=null,u=null,d=this.classPage,p=null;t&&(void 0===a&&"object"==typeof e&&(a=e),a=a||{},n={},e&&(1==e.nodeType?((e.href||e.action)&&(i=e.getAttribute("data-title")||a.title),c=a.response,l=e.getAttribute("data-container"),u=document.getElementById(l),r=e.getAttribute("data-classpage"),p=(n.target=e).getAttribute("data-reload"),("form"==e.tagName.toLowerCase()||null!==p&&"false"!=p)&&(n.reload=!0),n.back="back"==e.getAttribute("data-rel"),"false"==e.getAttribute("data-history")&&(n.history=!1)):(c=e.response||a.response,i=e.title||a.title,u=e.container||a.container,r=e.classPage||a.classPage,n.target=e.target,n.back=e.back||a.back),u&&r&&(d=r)),o=(d==r?u:document).querySelector(".in."+d),s=null,l=document.createElement("div"),"string"==typeof t?l.innerHTML=t:l.appendChild(t),1==m.evalScript&&1!=t.firstintoBind&&h.call(l.getElementsByTagName("script")).forEach(function(t){var e=t.innerHTML.trim(),a=t.type||t.getAttribute("type"),n=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");a&&(i.type=a),e?i.appendChild(document.createTextNode(e)):t.src&&!document.querySelector('script[src="'+t.src+'"]')&&(i.src=t.src),setTimeout(function(){n.insertBefore(i,n.firstChild),n.removeChild(i),i=null},17),t=null}),p=l.getElementsByTagName("title")[0],(s=l.querySelector("."+d))||(l.className=d+" out",s=l),"string"==typeof i?s.setAttribute("data-title",i):p&&p.innerText&&s.setAttribute("data-title",p.innerText),n.response=c||t,n.id=a.id||this.getCleanUrl(e)||s.id||a.url||"unique"+Date.now(),"object"==typeof a&&(void 0!==a.history&&(n.history=a.history),void 0!==a.remove&&(n.remove=a.remove),void 0!==a.target&&(n.target=a.target),void 0!==a.title&&(n.title=a.title),void 0!==a.query&&(n.query=a.query)),d==r&&(n.history=!1,n.classPage=d),u=u||document.body,1==n.remove&&n.id&&(this.remove(n.id),a.id&&h.call(document.querySelectorAll('a[data-reload="'+a.id+'"]')).forEach(function(t){m.remove(t)})),(a=n.id.split("?")[0])&&y[a]&&u.contains(y[a])?u.insertBefore(s,y[a]):u.appendChild(s),l=null,this.transition(s,o,n),(l=y.backShip||[]).push({pageIn:s,pageOut:o,isBack:!!n.back}),y.backShip=l)},m.getFunction=function(t){if("string"==typeof t){for(var e=m.rootTransition,a=t.split("."),n=0;n<a.length&&(e=e[a[n]]);n+=1);return e}},m.ajax=function(a){if(a){var t=a,e={url:"",type:"",dataType:"",data:{},timeout:1e4,success:function(){},error:function(){},complete:function(){}},n={},i=null,r=null,o=this.classMask,s={};if(1==a.nodeType){for(c in s=v(t.getAttribute("data-params")||""),e)n[c]=t.getAttribute("data-"+c)||s[c]||e[c],"function"==typeof e[c]&&"string"==typeof n[c]&&(n[c]=this.getFunction(n[c]),"function"!=typeof n[c]&&(n[c]=e[c]));var l=this.getCleanUrl(t,n.url);n.url=l;var c,u=v(l.split("?")[1]);for(c in u)void 0===s[c]&&(s[c]=u[c]);n.query=s,n.target=t,n.back="back"==t.getAttribute("data-rel");var d=t.tagName.toLowerCase();"form"==d?(n.type=t.method,r=new FormData(t)):"a"==d&&(p=t.getAttribute("data-container"),d=t.getAttribute("data-classpage"),(p=p&&document.getElementById(p))&&d&&d!=m.classPage&&(n.history=!1,n.title=!1),"string"==typeof(d=t.getAttribute("data-reload"))&&"false"!=d&&(""!=d&&"true"!=d?(h.call(document.querySelectorAll('a[data-reload="'+d+'"]')).forEach(function(t){m.remove(t)}),m.remove(y[d])):m.remove(y[l]))),"true"!=(l=a.getAttribute("data-mask"))&&""!=l||(i=a.querySelector("."+o))}else{if(!a.url)return;for(key2 in n=a,e)n[key2]=a[key2]||e[key2];n.url=this.getCleanUrl(null,n.url,n.data),n.title=a.title,n.back=a.back,n.container=a.container,n.query=v(a.url.split("?")[1])}var p=p||document.body;"string"!=typeof l&&(i=[].slice.call(p.children).filter(function(t){return t.classList.contains(o)})[0]),null==i&&((i=document.createElement("div")).className=o,i.innerHTML='<s class="loading"></s>',("string"==typeof l?a:p).appendChild(i)),i.style.display="inline",this.showLoading&&this.showLoading();var f=new XMLHttpRequest;f.open(n.type||"GET",n.url+(/\?/.test(n.url)?"&":"?")+"r="+Date.now()),f.timeout=n.timeout,f.onload=function(){var e=null;if("json"==n.dataType||"JSON"==n.dataType)try{e=JSON.parse(f.response),n.response=e,m.createPage(m.jsonHandle(e,n),a,n)}catch(t){n.message="JSON parse errorï¼š"+t.message,n.error.call(n,f,f.status)}else if("unknown"==n.dataType){n.history=!1;try{e=JSON.parse(f.response),n.response=e,m.createPage(m.jsonHandle(e,n),a,n)}catch(t){e=f.response,m.createPage(e,a,n)}}else e=f.response,m.createPage(e,a,n);n.success.call(n,e,f.status)},f.onerror=function(t){n.message="Illegal request address or an unexpected network error!",n.error.call(n,f,f.status)},f.onloadend=function(){i.style.display="none",this.hideLoading&&this.hideLoading(),n.complete.call(n,f,f.status)},f.ontimeout=function(){n.message="The request timeout!",n.error.call(n,f,f.status),i.style.display="none",this.hideLoading&&this.hideLoading()},f.setRequestHeader("Type","ajax"),f.setRequestHeader("From","mobilebone"),f.send(r)}},m.submit=function(t){var e;t&&"string"==typeof t.action&&("false"==(e=t.getAttribute("data-ajax"))||0==m.captureForm&&"true"!=e||t.addEventListener("submit",function(t){var e=this.getAttribute("data-preventdefault"),e=m.getFunction(e);if("function"==typeof e&&1==e(this))return t.preventDefault(),!1;m.ajax(this),t.preventDefault()}))},m.isBack=function(e,a){if(1==history.tempBack)return!(history.tempBack=null);if(1==history.tempGo)return history.tempGo=null,!1;if(void 0===e)return!1;if(!a)return!1;var t=y.backShip||[],n=null;return t.forEach(function(t){t.pageIn==e&&t.pageOut==a?n=t.isBack:t.pageIn==a&&t.pageOut==e&&(n=!t.isBack)}),null===n&&(n=!!(e.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING)),n},m.jsonHandle=function(t,e){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},m.init=function(){if(1==s)return"Don't repeat initialization!";var t=location.hash.replace("#&","#"),e=null,a=null,n=t.split("?")[0],i=t.split("?")[1],r={query:{}};i&&(r.query=v(i)),""==n||"#"==n?this.transition(document.querySelector("."+this.classPage)):1==o.test(n)&&(e=document.querySelector(n))&&e.classList.contains(this.classPage)?(r.id=t.replace(/^#/,""),this.transition(e,null,r)):(2==t.split("container=").length&&(a=document.getElementById(t.split("container=")[1].split("&")[0])),this.ajax({url:t.replace("#",""),dataType:"unknown",container:a,error:function(){r.id=t.replace(/^#/,""),e=document.querySelector("."+m.classPage),m.transition(e,null,r)}})),document.addEventListener("click",this.handleTapEvent);a=!!navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)&&void 0!==document.hidden&&!window.chrome;"ontouchstart"in window==1&&a&&(document.addEventListener("touchmove",function(){history.popstateswipe=!0}),document.addEventListener("touchend",function(){history.popstateswipe=!1})),s=!0},m.handleTapEvent=function(t){var e=null;if(t&&1==t.nodeType&&((e=t).preventDefault=function(){}),e=(e||t.target)&&(e||t.target).closest("a")){var a=e.href,n=document.querySelector(".in."+m.classPage);if(null!=n){var i={target:e},r=e.getAttribute("data-preventdefault")||v(e.getAttribute("data-params")||"").preventdefault,o=m.getFunction(r);if("function"==typeof o&&1==o(e))return t.preventDefault(),!1;var s=e.getElementsByClassName(m.classMask)[0];if(s&&"none"!=s.style.display)return t.preventDefault(),!1;var l=e.getAttribute("data-container"),c=e.getAttribute("data-classpage"),u=l&&document.getElementById(l);u&&c&&c!=m.classPage&&(n=u.querySelector(".in."+c)||u.querySelector(c),i.history=!1,i.title=!1,i.classPage=c),"false"==e.getAttribute("data-history")&&(i.history=!1);var d=1==m.captureLink,r=e.getAttribute("data-rel"),o="back"==(r=r||"auto")?!0:!1;"go"==r&&(p=!0);s="external"==r;if(a){var p,l=e.getAttribute("href"),a=a.replace("#&","#");if(""!==l.replace(/#/g,"")){if(/^javascript/.test(a)){if(0==o&&!p)return}else if((1==(s=s||a.replace("://","").split("/")[0]!==location.href.replace("://","").split("/")[0])||0==d)&&"true"!=e.getAttribute("data-ajax"))return;1==/^#/.test(l)?(t.preventDefault(),s=(c=a.split("#")[1]).split("?")[0],d=c.split("?")[1],(l=e.getAttribute("data-formdata")||e.getAttribute("data-params"))&&(d=d+"&"+l),i.query=v(d),i.id=c,c=s&&document.getElementById(s),0==o&&"auto"==r&&(o=m.isBack(c,n)),c&&((s=y.lastShip)&&c==s[1]&&n==s[0]&&!p?(history.tempBack=!0,history.back()):m.transition(c,n,o,i))):/^javascript/.test(a)?o?(history.tempBack=!0,history.back()):p&&(history.tempGo=!0,history.go(1)):"false"!=e.getAttribute("data-ajax")&&(t.preventDefault(),a=m.getCleanUrl(e),i.query=v(a.split("?")[1]),null!=(p=e.getAttribute("data-reload"))&&"false"!=p||!y[a]?m.ajax(e):(0==o&&"auto"==r&&(o=m.isBack(y[a],n)),i.id=a,0==(u=u||document.body).contains(y[a])&&u.appendChild(y[a]),m.transition(y[a],n,o,i)))}else t.preventDefault()}}}},Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(e.matches(t))return e}while(null!==(e=e.parentElement||e.parentNode)&&1===e.nodeType);return null});var v=function(t){var a={};return"string"==typeof t&&t.split("&").forEach(function(t){var e=t.split("=");1<e.length&&(a[e[0]]=t.replace(e[0]+"=",""))}),a};return window.addEventListener("DOMContentLoaded",function(){0==s&&1==m.autoInit&&m.init()}),window.addEventListener("popstate",function(){if(1==history.popstateswipe)return location.reload(),void(history.popstateswipe=!1);if(0!=history.popstate){var t=location.hash.replace("#&","#").replace(/^#/,""),e=t.split("?")[0],a=null,n=document.querySelector(".in."+m.classPage),i=null;if(""==t){if((a=document.querySelector("."+m.classPage)).id)return}else if(a=y[e]||y[t],2==t.split("container=").length&&(i=document.getElementById(t.split("container=")[1].split("&")[0])),a&&0==o.test(e))return void m.transition(a,n,m.isBack(a,n),{id:t,history:!1,container:i,target:document.activeElement,query:v(t.split("?")[1])});if(!a){if(0==o.test(t))return void m.ajax({url:t,dataType:"unknown",back:m.isBack(),container:i});a=document.querySelector("#"+e)||document.querySelector("#"+t)}a&&a==n||0==m.pushStateEnabled||a&&m.transition(a,n,m.isBack(a,n),{id:t,history:!1,target:document.activeElement,query:v(t.split("?")[1])})}else history.popstate=!0}),document.MBLOADED=!0,m});