!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).maquette={})}(this,function(e){"use strict";function f(r,t){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function h(e,r){return e.vnodeSelector===r.vnodeSelector&&(e.properties&&r.properties?e.properties.key===r.properties.key&&e.properties.bind===r.properties.bind:!e.properties&&!r.properties)}function A(e){if("string"!=typeof e)throw Error("Style values must be strings")}function m(e,r,t,n){var o=e[r];if(""!==o.vnodeSelector){var i=o.properties;if(!(i&&(void 0===i.key?i.bind:i.key)))for(var d=0;d<e.length;d++)if(d!==r&&h(e[d],o))throw Error(t.vnodeSelector+" had a "+o.vnodeSelector+" child "+("added"===n?n:"removed")+", but there is now more than one. You must add unique key properties to make them distinguishable.")}}function r(){d=!1,i.forEach(a),i.length=0}function n(e){i.push(e),d||(d=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(r,{timeout:16}):setTimeout(r,16))}function g(e){var r=e.domNode;if(e.properties){var t=e.properties.exitAnimation;if(t)return r.style.pointerEvents="none",t(r,function(){r.parentNode&&(r.parentNode.removeChild(r),n(e))},e.properties),0}r.parentNode&&(r.parentNode.removeChild(r),n(e))}function u(e,r,t){!function(e,r,t){if(r)for(var n=0,o=r;n<o.length;n++){var i=o[n];N(i,e,void 0,t)}}(e,r.children,t),r.text&&(e.textContent=r.text),function(f,u,v){if(u)for(var h=v.eventHandlerInterceptor,m=Object.keys(u),e=m.length,g=0;g<e;g++)!function(){var e,r,t=m[g],n=u[t];if("className"===t)throw Error('Property "className" is not supported, use "class".');if("class"===t)E(f,n,!0);else if("classes"===t)for(var o=Object.keys(n),i=o.length,d=0;d<i;d++){var a=o[d];n[a]&&f.classList.add(a)}else if("styles"===t)for(var p=Object.keys(n),s=p.length,d=0;d<s;d++){var c=p[d],l=n[c];l&&(A(l),v.styleApplyer(f,c,l))}else"key"!==t&&null!=n&&("function"==(e=typeof n)?t.lastIndexOf("on",0)||(h&&(n=h(t,n,f,u)),"oninput"===t&&(r=n,n=function(e){r.call(this,e),e.target["oninput-value"]=e.target.value}),f[t]=n):v.namespace===S?"href"===t?f.setAttributeNS(k,t,n):f.setAttribute(t,n):"string"==e&&"value"!==t&&"innerHTML"!==t?f.setAttribute(t,n):f[t]=n)}()}(e,r.properties,t),r.properties&&r.properties.afterCreate&&r.properties.afterCreate.call(r.properties.bind||r.properties,e,t,r.vnodeSelector,r.properties,r.children)}function o(r,t){return{getLastRender:function(){return r},update:function(e){if(r.vnodeSelector!==e.vnodeSelector)throw Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");b(r,r=e,t)},domNode:r.domNode}}function p(e){return f(s,e)}var t="http://www.w3.org/",S=t+"2000/svg",k=t+"1999/xlink",y=[],i=[],d=!1,a=function(e){(e.children||[]).forEach(a),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.call(e.properties.bind||e.properties,e.domNode)},N=function(e,r,t,n){var o,i=0,d=e.vnodeSelector,a=r.ownerDocument;if(""===d)o=e.domNode=a.createTextNode(e.text),void 0!==t?r.insertBefore(o,t):r.appendChild(o);else{for(var p=0;p<=d.length;++p){var s,c,l=d[0|p];p!==d.length&&"."!=l&&"#"!=l||(s=d[0|i-1],c=d.slice(i,p),"."==s?o.classList.add(c):"#"==s?o.id=c:("svg"===c&&(n=f(n,{namespace:S})),void 0!==n.namespace?o=e.domNode=a.createElementNS(n.namespace,c):(o=e.domNode=e.domNode||a.createElement(c),"input"===c&&e.properties&&void 0!==e.properties.type&&o.setAttribute("type",e.properties.type)),void 0!==t?r.insertBefore(o,t):o.parentNode!==r&&r.appendChild(o)),i=p+1)}u(o,e,n)}},E=function(r,e,t){e&&e.split(" ").forEach(function(e){e&&r.classList.toggle(e,t)})},b=function(e,r,t){var n=e.domNode;if(e===r)return!1;var o=!1;if(""===r.vnodeSelector){if(r.text!==e.text){var i=n.ownerDocument.createTextNode(r.text);return n.parentNode.replaceChild(i,n),r.domNode=i,!0}r.domNode=n}else r.vnodeSelector.lastIndexOf("svg",0)||(t=f(t,{namespace:S})),e.text!==r.text&&(o=!0,void 0===r.text?n.removeChild(n.firstChild):n.textContent=r.text),r.domNode=n,o=function(e,r,t,n,o){if(t===n)return!1;for(var i,d,a=(t=t||y).length,p=(n=n||y).length,s=0,c=0,l=!1;c<p;){var f=s<a?t[s]:void 0,u=n[c];if(void 0!==f&&h(f,u))l=b(f,u,o)||l,s++;else{var v=function(e,r,t){if(""!==r.vnodeSelector)for(var n=t;n<e.length;n++)if(h(e[n],r))return n;return-1}(t,u,s+1);if(v<0)N(u,r,s<a?t[s].domNode:void 0,o),d=void 0,!u.properties||(d=u.properties.enterAnimation)&&d(u.domNode,u.properties),m(n,c,e,"added");else{for(i=s;i<v;i++)g(t[i]),m(t,i,e,"removed");l=b(t[v],u,o)||l,s=v+1}}c++}if(s<a)for(i=s;i<a;i++)g(t[i]),m(t,i,e,"removed");return l}(r,n,e.children,r.children,t)||o,o=function(e,r,t,n){if(t){for(var o=!1,i=Object.keys(t),d=i.length,a=0;a<d;a++){var p,s,c=i[a],l=t[c],f=r[c];if("class"===c)f!==l&&(E(e,f,!1),E(e,l,!0));else if("classes"===c)for(var u=e.classList,v=Object.keys(l),h=v.length,m=0;m<h;m++){var g=v[m],y=!!l[g];y!=!!f[g]&&(o=!0,y?u.add(g):u.remove(g))}else if("styles"===c)for(var N=Object.keys(l),b=N.length,m=0;m<b;m++){var w=N[m],x=l[w];x!==f[w]&&(o=!0,x?(A(x),n.styleApplyer(e,w,x)):n.styleApplyer(e,w,""))}else l||"string"!=typeof f||(l=""),"value"===c?((p=e[c])!==l&&(e["oninput-value"]?p===e["oninput-value"]:l!==f)&&(e[c]=l,e["oninput-value"]=void 0),l!==f&&(o=!0)):l!==f&&("function"==(s=typeof l)&&n.eventHandlerInterceptor||(n.namespace===S?"href"===c?e.setAttributeNS(k,c,l):e.setAttribute(c,l):"string"==s&&"innerHTML"!==c?"role"===c&&""===l?e.removeAttribute(c):e.setAttribute(c,l):e[c]!==l&&(e[c]=l),o=!0))}return o}}(n,e.properties,r.properties,t)||o,r.properties&&r.properties.afterUpdate&&r.properties.afterUpdate.call(r.properties.bind||r.properties,n,t,r.vnodeSelector,r.properties,r.children);return o&&r.properties&&r.properties.updateAnimation&&r.properties.updateAnimation(n,r.properties,e.properties),!1},s={namespace:void 0,performanceLogger:function(){},eventHandlerInterceptor:void 0,styleApplyer:function(e,r,t){"-"==r[0]?e.style.setProperty(r,t):e.style[r]=t}},v={create:function(e,r){return r=p(r),N(e,document.createElement("div"),void 0,r),o(e,r)},append:function(e,r,t){return t=p(t),N(r,e,void 0,t),o(r,t)},insertBefore:function(e,r,t){return t=p(t),N(r,e.parentNode,e,t),o(r,t)},merge:function(e,r,t){return t=p(t),u(r.domNode=e,r,t),o(r,t)},replace:function(e,r,t){return t=p(t),N(r,e.parentNode,e,t),e.parentNode.removeChild(e),o(r,t)}},c=function(e,r,t){for(var n=0,o=r.length;n<o;n++){var i=r[n];Array.isArray(i)?c(e,i,t):null!=i&&!1!==i&&("string"==typeof i&&(i={vnodeSelector:"",properties:void 0,children:void 0,text:i.toString(),domNode:null}),t.push(i))}},w=Array.prototype.find?function(e,r){return e.find(r)}:function(e,r){return e.filter(r)[0]};e.createCache=function(){var n,o;return{invalidate:function(){n=o=void 0},result:function(e,r){if(n)for(var t=0;t<e.length;t++)n[t]!==e[t]&&(o=void 0);return o||(o=r(),n=e),o}}},e.createMapping=function(c,l,f){var u=[],v=[];return{results:v,map:function(e){for(var r=e.map(c),t=v.slice(),n=0,o=0;o<e.length;o++){var i=e[o],d=r[o];if(d===u[n])v[o]=t[n],f(i,t[n],o),n++;else{for(var a=!1,p=1;p<u.length+1;p++){var s=(n+p)%u.length;if(u[s]===d){v[o]=t[s],f(e[o],t[s],o),n=1+s,a=!0;break}}a||(v[o]=l(i,o))}}v.length=e.length,u=r}}},e.createProjector=function(e){function t(e,r,t){var a,p,s;function o(e){s("domEvent",e);var r=a,t=function(e,r){for(var t=[];e&&e!==r;)t.push(e),e=e.parentNode;return t}(e.currentTarget,r.domNode);t.reverse();var n,o,i,d=(n=r.getLastRender(),o=n,t.forEach(function(r){o=o&&o.children?w(o.children,function(e){return e.domNode===r}):void 0}),o);return p.scheduleRender(),d&&(i=d.properties["on"+e.type].apply(d.properties.bind||this,arguments)),s("domEventProcessed",e),i}i.eventHandlerInterceptor=(p=f,s=d,function(e,r,t,n){return o}),a=e(r,t(),i),c.push(a),l.push(t)}function r(){if(n=void 0,o){o=!1,d("renderStart",void 0);for(var e=0;e<c.length;e++){var r=l[e]();d("rendered",void 0),c[e].update(r),d("patched",void 0)}d("renderDone",void 0),o=!0}}var n,i=p(e),d=i.performanceLogger,o=!0,a=!1,c=[],l=[],f={renderNow:r,scheduleRender:function(){n||a||(n=requestAnimationFrame(r))},stop:function(){n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:function(){o=!(a=!1),f.scheduleRender()},append:function(e,r){t(v.append,e,r)},insertBefore:function(e,r){t(v.insertBefore,e,r)},merge:function(e,r){t(v.merge,e,r)},replace:function(e,r){t(v.replace,e,r)},detach:function(e){for(var r=0;r<l.length;r++)if(l[r]===e)return l.splice(r,1),c.splice(r,1)[0];throw Error("renderFunction was not found")}};return f},e.dom=v,e.h=function(e,r,t){if(Array.isArray(r))t=r,r=void 0;else if(r&&("string"==typeof r||r.hasOwnProperty("vnodeSelector"))||t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector")))throw Error("h called with invalid arguments");var n,o;return t&&1===t.length&&"string"==typeof t[0]?n=t[0]:t&&(c(e,t,o=[]),0===o.length&&(o=void 0)),{vnodeSelector:e,properties:r,children:o,text:""===n?void 0:n,domNode:null}},Object.defineProperty(e,"__esModule",{value:!0})});