import"../utils/boot.js";import{wrap}from"../utils/wrap.js";import"../utils/settings.js";import{FlattenedNodesObserver}from"../utils/flattened-nodes-observer.js";export{flush,enqueueDebouncer as addDebouncer}from"../utils/flush.js";import{Debouncer}from"../utils/debounce.js";const p=Element.prototype,normalizedMatchesSelector=p.matches||p.matchesSelector||p.mozMatchesSelector||p.msMatchesSelector||p.oMatchesSelector||p.webkitMatchesSelector;export const matchesSelector=function(e,t){return normalizedMatchesSelector.call(e,t)};class DomApiNative{constructor(e){window.ShadyDOM&&window.ShadyDOM.inUse&&window.ShadyDOM.patch(e),this.node=e}observeNodes(e){return new FlattenedNodesObserver(this.node,e)}unobserveNodes(e){e.disconnect()}notifyObserver(){}deepContains(e){if(wrap(this.node).contains(e))return!0;let t=e,o=e.ownerDocument;for(;t&&t!==o&&t!==this.node;)t=wrap(t).parentNode||wrap(t).host;return t===this.node}getOwnerRoot(){return wrap(this.node).getRootNode()}getDistributedNodes(){return"slot"===this.node.localName?wrap(this.node).assignedNodes({flatten:!0}):[]}getDestinationInsertionPoints(){let e=[],t=wrap(this.node).assignedSlot;for(;t;)e.push(t),t=wrap(t).assignedSlot;return e}importNode(e,t){let o=this.node instanceof Document?this.node:this.node.ownerDocument;return wrap(o).importNode(e,t)}getEffectiveChildNodes(){return FlattenedNodesObserver.getFlattenedNodes(this.node)}queryDistributedElements(e){let t=this.getEffectiveChildNodes(),o=[];for(let i,r=0,n=t.length;r<n&&(i=t[r]);r++)i.nodeType===Node.ELEMENT_NODE&&matchesSelector(i,e)&&o.push(i);return o}get activeElement(){let e=this.node;return void 0!==e._activeElement?e._activeElement:e.activeElement}}function forwardMethods(e,t){for(let o=0;o<t.length;o++){let i=t[o];e[i]=function(){return this.node[i].apply(this.node,arguments)}}}function forwardReadOnlyProperties(e,t){for(let o=0;o<t.length;o++){let i=t[o];Object.defineProperty(e,i,{get:function(){return this.node[i]},configurable:!0})}}function forwardProperties(e,t){for(let o=0;o<t.length;o++){let i=t[o];Object.defineProperty(e,i,{get:function(){return this.node[i]},set:function(e){this.node[i]=e},configurable:!0})}}export class EventApi{constructor(e){this.event=e}get rootTarget(){return this.path[0]}get localTarget(){return this.event.target}get path(){return this.event.composedPath()}};DomApiNative.prototype.cloneNode,DomApiNative.prototype.appendChild,DomApiNative.prototype.insertBefore,DomApiNative.prototype.removeChild,DomApiNative.prototype.replaceChild,DomApiNative.prototype.setAttribute,DomApiNative.prototype.removeAttribute,DomApiNative.prototype.querySelector,DomApiNative.prototype.querySelectorAll,DomApiNative.prototype.parentNode,DomApiNative.prototype.firstChild,DomApiNative.prototype.lastChild,DomApiNative.prototype.nextSibling,DomApiNative.prototype.previousSibling,DomApiNative.prototype.firstElementChild,DomApiNative.prototype.lastElementChild,DomApiNative.prototype.nextElementSibling,DomApiNative.prototype.previousElementSibling,DomApiNative.prototype.childNodes,DomApiNative.prototype.children,DomApiNative.prototype.classList,DomApiNative.prototype.textContent,DomApiNative.prototype.innerHTML;let DomApiImpl=DomApiNative;if(window.ShadyDOM&&window.ShadyDOM.inUse&&window.ShadyDOM.noPatch&&window.ShadyDOM.Wrapper){class e extends window.ShadyDOM.Wrapper{}Object.getOwnPropertyNames(DomApiNative.prototype).forEach(t=>{"activeElement"!=t&&(e.prototype[t]=DomApiNative.prototype[t])}),forwardReadOnlyProperties(e.prototype,["classList"]),DomApiImpl=e,Object.defineProperties(EventApi.prototype,{localTarget:{get(){const e=this.event.currentTarget,t=e&&dom(e).getOwnerRoot(),o=this.path;for(let e=0;e<o.length;e++){const i=o[e];if(dom(i).getOwnerRoot()===t)return i}},configurable:!0},path:{get(){return window.ShadyDOM.composedPath(this.event)},configurable:!0}})}else forwardMethods(DomApiNative.prototype,["cloneNode","appendChild","insertBefore","removeChild","replaceChild","setAttribute","removeAttribute","querySelector","querySelectorAll"]),forwardReadOnlyProperties(DomApiNative.prototype,["parentNode","firstChild","lastChild","nextSibling","previousSibling","firstElementChild","lastElementChild","nextElementSibling","previousElementSibling","childNodes","children","classList"]),forwardProperties(DomApiNative.prototype,["textContent","innerHTML","className"]);export const DomApi=DomApiImpl;export const dom=function(e){if((e=e||document)instanceof DomApiImpl)return e;if(e instanceof EventApi)return e;let t=e.__domApi;return t||(t=e instanceof Event?new EventApi(e):new DomApiImpl(e),e.__domApi=t),t};