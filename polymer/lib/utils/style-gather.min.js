import{DomModule}from"../elements/dom-module.js";import{resolveCss}from"./resolve-url.js";const MODULE_STYLE_LINK_SELECTOR="link[rel=import][type~=css]",INCLUDE_ATTR="include",SHADY_UNSCOPED_ATTR="shady-unscoped";function importModule(t){return DomModule.import(t)}function styleForImport(t){let e=t.body?t.body:t;const o=resolveCss(e.textContent,t.baseURI),s=document.createElement("style");return s.textContent=o,s}let templateWithAssetPath;export function stylesFromModules(t){const e=t.trim().split(/\s+/),o=[];for(let t=0;t<e.length;t++)o.push(...stylesFromModule(e[t]));return o};export function stylesFromModule(t){const e=importModule(t);if(!e)return console.warn("Could not find style data in module named",t),[];if(void 0===e._styles){const t=[];t.push(..._stylesFromModuleImports(e));const o=e.querySelector("template");o&&t.push(...stylesFromTemplate(o,e.assetpath)),e._styles=t}return e._styles};export function stylesFromTemplate(t,e){if(!t._styles){const o=[],s=t.content.querySelectorAll("style");for(let t=0;t<s.length;t++){let l=s[t],r=l.getAttribute(INCLUDE_ATTR);r&&o.push(...stylesFromModules(r).filter(function(t,e,o){return o.indexOf(t)===e})),e&&(l.textContent=resolveCss(l.textContent,e)),o.push(l)}t._styles=o}return t._styles};export function stylesFromModuleImports(t){let e=importModule(t);return e?_stylesFromModuleImports(e):[]};function _stylesFromModuleImports(t){const e=[],o=t.querySelectorAll(MODULE_STYLE_LINK_SELECTOR);for(let t=0;t<o.length;t++){let s=o[t];if(s.import){const t=s.import,o=s.hasAttribute(SHADY_UNSCOPED_ATTR);if(o&&!t._unscopedStyle){const e=styleForImport(t);e.setAttribute(SHADY_UNSCOPED_ATTR,""),t._unscopedStyle=e}else t._style||(t._style=styleForImport(t));e.push(o?t._unscopedStyle:t._style)}}return e}export function cssFromModules(t){let e=t.trim().split(/\s+/),o="";for(let t=0;t<e.length;t++)o+=cssFromModule(e[t]);return o};export function cssFromModule(t){let e=importModule(t);if(e&&void 0===e._cssText){let t=_cssFromModuleImports(e),o=e.querySelector("template");o&&(t+=cssFromTemplate(o,e.assetpath)),e._cssText=t||null}return e||console.warn("Could not find style data in module named",t),e&&e._cssText||""};export function cssFromTemplate(t,e){let o="";const s=stylesFromTemplate(t,e);for(let t=0;t<s.length;t++){let e=s[t];e.parentNode&&e.parentNode.removeChild(e),o+=e.textContent}return o};export function cssFromModuleImports(t){let e=importModule(t);return e?_cssFromModuleImports(e):""};function _cssFromModuleImports(t){let e="",o=_stylesFromModuleImports(t);for(let t=0;t<o.length;t++)e+=o[t].textContent;return e}