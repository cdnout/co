import"./boot.js";import{wrap}from"./wrap.js";const ShadyDOM=window.ShadyDOM,ShadyCSS=window.ShadyCSS;function sameScope(e,o){return wrap(e).getRootNode()===o}export function scopeSubtree(e,o=!1){if(!ShadyDOM||!ShadyCSS)return null;if(!ShadyDOM.handlesDynamicScoping)return null;const t=ShadyCSS.ScopingShim;if(!t)return null;const n=t.scopeForNode(e),r=wrap(e).getRootNode(),d=e=>{if(!sameScope(e,r))return;const o=Array.from(ShadyDOM.nativeMethods.querySelectorAll.call(e,"*"));o.push(e);for(let e=0;e<o.length;e++){const d=o[e];if(!sameScope(d,r))continue;const c=t.currentScopeForNode(d);c!==n&&(""!==c&&t.unscopeNode(d,c),t.scopeNode(d,n))}};if(d(e),o){const o=new MutationObserver(e=>{for(let o=0;o<e.length;o++){const t=e[o];for(let e=0;e<t.addedNodes.length;e++){const o=t.addedNodes[e];o.nodeType===Node.ELEMENT_NODE&&d(o)}}});return o.observe(e,{childList:!0,subtree:!0}),o}return null};