"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hookMixin=exports.FeathersHookManager=exports.createContext=exports.fromErrorHooks=exports.fromErrorHook=exports.fromAfterHooks=exports.fromAfterHook=exports.fromBeforeHooks=exports.fromBeforeHook=void 0;const dependencies_1=require("../dependencies"),service_1=require("../service"),regular_1=require("./regular");var regular_2=require("./regular");function createContext(e,r,o={}){const t=e[r].createContext;if("function"!=typeof t)throw new Error(`Can not create context for method ${r}`);return t(o)}Object.defineProperty(exports,"fromBeforeHook",{enumerable:!0,get:function(){return regular_2.fromBeforeHook}}),Object.defineProperty(exports,"fromBeforeHooks",{enumerable:!0,get:function(){return regular_2.fromBeforeHooks}}),Object.defineProperty(exports,"fromAfterHook",{enumerable:!0,get:function(){return regular_2.fromAfterHook}}),Object.defineProperty(exports,"fromAfterHooks",{enumerable:!0,get:function(){return regular_2.fromAfterHooks}}),Object.defineProperty(exports,"fromErrorHook",{enumerable:!0,get:function(){return regular_2.fromErrorHook}}),Object.defineProperty(exports,"fromErrorHooks",{enumerable:!0,get:function(){return regular_2.fromErrorHooks}}),exports.createContext=createContext;class FeathersHookManager extends dependencies_1.HookManager{constructor(e,r){super(),this.app=e,this.method=r,this._middleware=[]}collectMiddleware(e,r){const o=this.app;var t=o.appHooks[dependencies_1.HOOKS].concat(o.appHooks[this.method]||[]),s=(0,regular_1.collectRegularHooks)(this.app,this.method),r=super.collectMiddleware(e,r),e=(0,regular_1.collectRegularHooks)(e,this.method);return[...t,...s,...r,...e]}initializeContext(e,r,o){const t=super.initializeContext(e,r,o);return t.params=t.params||{},t}middleware(e){return this._middleware.push(...e),this}}function hookMixin(t,s,e){if("function"==typeof t.hooks)return t;const n=this,r=(0,service_1.getHookMethods)(t,e);e=r.reduce((e,r)=>{var o=service_1.defaultServiceArguments[r]||["data","params"];return e[r]=new FeathersHookManager(n,r).params(...o).props({app:n,path:s,method:r,service:t,event:null,type:null,get statusCode(){var e;return null===(e=this.http)||void 0===e?void 0:e.status},set statusCode(e){(this.http||(this.http={})).status=e}}),e},{});const a=(0,regular_1.enableRegularHooks)(t,r);return(0,dependencies_1.hooks)(t,e),t.hooks=function(o){return o.before||o.after||o.error?a.call(this,o):Array.isArray(o)?(0,dependencies_1.hooks)(this,o):(Object.keys(o).forEach(e=>{const r=(0,dependencies_1.getManager)(this[e]);if(!(r instanceof FeathersHookManager))throw new Error(`Method ${e} is not a Feathers hooks enabled service method`);r.middleware(o[e])}),this)},t}exports.FeathersHookManager=FeathersHookManager,exports.hookMixin=hookMixin;