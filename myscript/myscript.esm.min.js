var Constants={EventType:{IDLE:"idle",CHANGED:"changed",IMPORTED:"imported",EXPORTED:"exported",CONVERTED:"converted",RENDERED:"rendered",LOADED:"loaded",UNDO:"undo",REDO:"redo",CLEAR:"clear",IMPORT:"import",SUPPORTED_IMPORT_MIMETYPES:"supportedImportMimeTypes",EXPORT:"export",CONVERT:"convert",ERROR:"error"},RecognitionType:{TEXT:"TEXT",MATH:"MATH",SHAPE:"SHAPE",MUSIC:"MUSIC",ANALYZER:"ANALYZER",DIAGRAM:"DIAGRAM",NEBO:"NEBO",RAWCONTENT:"Raw Content"},Protocol:{WEBSOCKET:"WEBSOCKET",REST:"REST"},ModelState:{INITIALIZING:"INITIALIZING",INITIALIZED:"INITIALIZED",EXPORTING:"EXPORTING",EXPORTED:"EXPORTED",PENDING:"PENDING",MODIFIED:"MODIFIED",ERROR:"ERROR"},Trigger:{QUIET_PERIOD:"QUIET_PERIOD",POINTER_UP:"POINTER_UP",DEMAND:"DEMAND"},Logger:{EDITOR:"editor",MODEL:"model",GRABBER:"grabber",RENDERER:"renderer",RECOGNIZER:"recognizer",CALLBACK:"callback",UTIL:"util",SMARTGUIDE:"smartguide"},LogLevel:{TRACE:"TRACE",DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR"},Languages:{zh_CN:"Noto Sans CJK tc",zh_HK:"Noto Sans CJK tc",zh_TW:"Noto Sans CJK tc",ko_KR:"Noto Sans CJK kr",ja_JP:"Noto Sans CJK jp",hy_AM:"Noto Sans Armenian",default:"Open Sans"},Error:{NOT_REACHABLE:"MyScript recognition server is not reachable. Please reload once you are connected.",WRONG_CREDENTIALS:"Application credentials are invalid. Please check or regenerate your application key and hmackey.",TOO_OLD:"Session is too old. Max Session Duration Reached."},Exports:{JIIX:"application/vnd.myscript.jiix"}},commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var loglevel=createCommonjsModule(function(e){var t,n;t=commonjsGlobal,n=function(){var e=function(){},t="undefined",n=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(t,r){for(var o=0;o<n.length;o++){var i=n[o];this[i]=o<t?e:this.methodFactory(i,t,r)}this.log=this.debug}function i(n,i,a){return function(n){return"debug"===n&&(n="log"),typeof console!==t&&(void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}(n)||function(e,n,r){return function(){typeof console!==t&&(o.call(this,n,r),this[e].apply(this,arguments))}}.apply(this,arguments)}function a(e,r,a){var s,c=this,l="loglevel";function u(){var e;if(typeof window!==t){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(l)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}e&&(l+=":"+e),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=a||i,c.getLevel=function(){return s},c.setLevel=function(r,i){if("string"==typeof r&&void 0!==c.levels[r.toUpperCase()]&&(r=c.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==i&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[l]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+r+";"}catch(e){}}}(r),o.call(c,r,e),typeof console===t&&r<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){u()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var d=u();null==d&&(d=null==r?"WARN":r),c.setLevel(d,!1)}var s=new a,c={};s.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=c[e];return t||(t=c[e]=new a(e,s.getLevel(),s.methodFactory)),t};var l=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=l),s},s.getLoggers=function(){return c},s},e.exports?e.exports=n():t.log=n()}),loglevel_1=loglevel.noConflict,log=loglevel_1(),editorLogger=log.getLogger(Constants.Logger.EDITOR);editorLogger.setDefaultLevel(Constants.LogLevel.ERROR);var smartGuideLogger=log.getLogger(Constants.Logger.SMARTGUIDE);editorLogger.setDefaultLevel(Constants.LogLevel.ERROR);var modelLogger=log.getLogger(Constants.Logger.MODEL);modelLogger.setDefaultLevel(Constants.LogLevel.ERROR);var grabberLogger=log.getLogger(Constants.Logger.GRABBER);grabberLogger.setDefaultLevel(Constants.LogLevel.ERROR);var rendererLogger=log.getLogger(Constants.Logger.RENDERER);rendererLogger.setDefaultLevel(Constants.LogLevel.ERROR);var recognizerLogger=log.getLogger(Constants.Logger.RECOGNIZER);recognizerLogger.setDefaultLevel(Constants.LogLevel.ERROR);var callbackLogger=log.getLogger(Constants.Logger.CALLBACK);callbackLogger.setDefaultLevel(Constants.LogLevel.ERROR);var utilLogger=log.getLogger(Constants.Logger.UTIL);utilLogger.setDefaultLevel(Constants.LogLevel.ERROR);var testLogger=log.getLogger("test");testLogger.setDefaultLevel(Constants.LogLevel.ERROR);var isPrimitive=function(e){return null==e||"function"!=typeof e&&"object"!=typeof e},assignSymbols=function(e,t){if(null==e)throw new TypeError("expected first argument to be an object.");if(void 0===t||"undefined"==typeof Symbol)return e;if("function"!=typeof Object.getOwnPropertySymbols)return e;for(var n=Object.prototype.propertyIsEnumerable,r=Object(e),o=arguments.length,i=0;++i<o;)for(var a=Object(arguments[i]),s=Object.getOwnPropertySymbols(a),c=0;c<s.length;c++){var l=s[c];n.call(a,l)&&(r[l]=a[l])}return r},toString=Object.prototype.toString,kindOf=function(e){var t=typeof e;return"undefined"===t?"undefined":null===e?"null":!0===e||!1===e||e instanceof Boolean?"boolean":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?void 0!==e.constructor.name&&"Generator"===e.constructor.name.slice(0,9)?"generatorfunction":"function":void 0!==Array.isArray&&Array.isArray(e)?"array":e instanceof RegExp?"regexp":e instanceof Date?"date":"[object RegExp]"===(t=toString.call(e))?"regexp":"[object Date]"===t?"date":"[object Arguments]"===t?"arguments":"[object Error]"===t?"error":"[object Promise]"===t?"promise":isBuffer(e)?"buffer":"[object Set]"===t?"set":"[object WeakSet]"===t?"weakset":"[object Map]"===t?"map":"[object WeakMap]"===t?"weakmap":"[object Symbol]"===t?"symbol":"[object Map Iterator]"===t?"mapiterator":"[object Set Iterator]"===t?"setiterator":"[object String Iterator]"===t?"stringiterator":"[object Array Iterator]"===t?"arrayiterator":"[object Int8Array]"===t?"int8array":"[object Uint8Array]"===t?"uint8array":"[object Uint8ClampedArray]"===t?"uint8clampedarray":"[object Int16Array]"===t?"int16array":"[object Uint16Array]"===t?"uint16array":"[object Int32Array]"===t?"int32array":"[object Uint32Array]"===t?"uint32array":"[object Float32Array]"===t?"float32array":"[object Float64Array]"===t?"float64array":"object"};function isBuffer(e){return e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function assign(e){e=e||{};var t=arguments.length,n=0;if(1===t)return e;for(;++n<t;){var r=arguments[n];isPrimitive(e)&&(e=r),isObject(r)&&extend(e,r)}return e}function extend(e,t){for(var n in assignSymbols(e,t),t)if("__proto__"!==n&&hasOwn(t,n)){var r=t[n];isObject(r)?("undefined"===kindOf(e[n])&&"function"===kindOf(r)&&(e[n]=r),e[n]=assign(e[n]||{},r)):e[n]=r}return e}function isObject(e){return"object"===kindOf(e)||"function"===kindOf(e)}function hasOwn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var assignDeep=assign,defaultConfiguration={recognitionParams:{type:"TEXT",protocol:"WEBSOCKET",apiVersion:"V4",server:{scheme:"https",host:"cloud.myscript.com",applicationKey:void 0,hmacKey:void 0,useWindowLocation:!1,websocket:{pingEnabled:!0,pingDelay:3e4,maxPingLostCount:10,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},v4:{alwaysConnected:!0,lang:"en_US",export:{"image-resolution":300,jiix:{"bounding-box":!1,strokes:!1,text:{chars:!1,words:!0}}},renderer:{debug:{"draw-text-boxes":!1,"draw-image-boxes":!1}},math:{mimeTypes:["application/x-latex","application/mathml+xml"],solver:{enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},margin:{bottom:10,left:15,right:15,top:10}},text:{guides:{enable:!0},smartGuide:!0,smartGuideFadeOut:{enable:!1,duration:1e4},mimeTypes:["text/plain","application/vnd.myscript.jiix"],margin:{top:20,left:10,right:10}},diagram:{mimeTypes:["application/vnd.myscript.jiix"],margin:{bottom:10,left:15,right:15,top:10}},"raw-content":{recognition:{text:!1,shape:!1}}},v3:{mathParameter:{resultTypes:["LATEX","MATHML"],columnarOperation:!1,userResources:[],scratchOutDetectionSensitivity:1},textParameter:{language:"en_US",textInputMode:"CURSIVE",resultDetail:"TEXT",contentTypes:[],subsetKnowledges:[],userLkWords:[],userResources:[],textProperties:{textCandidateListSize:1,wordCandidateListSize:void 0,wordPredictionListSize:0,wordCompletionListSize:0,characterCandidateListSize:void 0,enableOutOfLexicon:!1,discardCaseVariations:!1,discardAccentuationVariations:!1,glyphDistortion:void 0,enableTagger:!1,spellingDistortion:void 0}},shapeParameter:{userResources:void 0,rejectDetectionSensitivity:1,doBeautification:!0},musicParameter:{divisions:480,resultTypes:["MUSICXML","SCORETREE"],userResources:[],staff:{top:100,count:5,gap:20},clef:{symbol:"G",octave:0,line:2},scratchOutDetectionSensitivity:1},analyzerParameter:{textParameter:{textProperties:{},language:"en_US",textInputMode:"CURSIVE"},coordinateResolution:void 0}}},listenerOptions:{capture:!1,passive:!0},undoRedoMaxStackSize:20,xyFloatPrecision:0,timestampFloatPrecision:0,triggerDelay:2e3,processDelay:0,resizeTriggerDelay:200,triggers:{exportContent:"POINTER_UP",addStrokes:"POINTER_UP"},restConversionState:"",renderingParams:{stroker:"quadratic",minHeight:100,minWidth:100}};function overrideDefaultConfiguration(e){var t=e,n=void 0;return t&&t.recognitionParams.server&&t.recognitionParams.server.useWindowLocation?(t.recognitionParams.server.scheme=window.location.protocol.slice(0,-1),t.recognitionParams.server.host=window.location.host,n=assignDeep({},defaultConfiguration,void 0===t?{}:t)):n=assignDeep({},defaultConfiguration,void 0===e?{}:e),editorLogger.debug("Override default configuration",n),n}var jsoncss_min=createCommonjsModule(function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=function e(t){var n=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.toJSON=function(e){if("string"!=typeof e)return console.error("Need a CSS string but given ",void 0===e?"undefined":r(e),e),"Not a valid CSS..!";var t={},o=void 0,i=void 0,a=void 0;try{e.split("{").forEach(function(e){if(i=e.trim())if(-1===i.indexOf("}"))t[i]={},o=i;else{i.substring(0,i.indexOf("}")).split(";").forEach(function(e){(a=e.split(":"))&&2===a.length&&(t[o][a[0].trim().replace(/^\"|\"$/g,"")]=n._trimSemiColon(a[1].trim().replace(/^\"|\"$/g,"")))});try{(o=i.split("}")[1].trim())&&(t[o]={})}catch(e){}}})}catch(e){return"Not a valid CSS..!"}return t},this.toCSS=function(e){if("object"!==(void 0===e?"undefined":r(e)))return console.error("Need a JSON object but given ",void 0===e?"undefined":r(e),e),"Not a valid JSON..!";var t="";try{for(var n in e)if(e.hasOwnProperty(n)){for(var o in t+=n+" {\n",e[n])e[n].hasOwnProperty(o)&&(t+=o+": "+e[n][o]+";\n");t+="}\n"}}catch(e){return"Not a valid JSON..!"}return t},this._trimSemiColon=function(e){return";"===e.slice(-1)?e.slice(0,n.length-1):e}}},function(e,t,n){e.exports=n(0).default}])}),JsonCSS=unwrapExports(jsoncss_min),jsoncss_min_1=jsoncss_min.JsonCSS,defaultPenStyle=void 0,parser=new JsonCSS;function overrideDefaultPenStyle(e){var t=assignDeep({},defaultPenStyle,void 0===e?{}:e);return editorLogger.debug("Override default pen style",t),t}function toCSS(e){var t=parser.toCSS({css:e});return t.substring(6,t.length-3)}var defaultTheme={ink:{color:"#000000","-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"Open Sans","font-size":10}},parser$1=new JsonCSS;function overrideDefaultTheme(e){var t=assignDeep({},defaultTheme,void 0===e?{}:e);return editorLogger.debug("Override default theme",t),t}function toCSS$1(e){return parser$1.toCSS(e)}var floatPrecisionArray=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function roundFloat(e,t){if(t||0===t){var n=void 0;return n=t>10?floatPrecisionArray[10]:floatPrecisionArray[t],Math.round(e*n)/n}return e}function extractPoint(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=e;i.changedTouches&&(i=i.changedTouches[0]);var a=t.getBoundingClientRect();return{x:roundFloat(i.clientX-a.left-t.clientLeft-o,n.xyFloatPrecision),y:roundFloat(i.clientY-a.top-t.clientTop-r,n.xyFloatPrecision),t:roundFloat(Date.now(),n.timestampFloatPrecision)}}function attach(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=0;function i(){"None"!==window.getSelection().type&&window.getSelection().removeAllRanges()}function a(e){var t=document.querySelector(".more-menu");return!(e.target.classList.contains("ellipsis")||e.target.classList.contains("more-menu")||e.target.classList.contains("options-label-button")||!t||"none"===t.style.display)&&(t.style.display="none",!0)}function s(e){var t=document.querySelector(".candidates");return!(e.target.classList.contains("candidates")||"SPAN"===e.target.tagName||!t||"none"===t.style.display)&&(t.style.display="none",!0)}var c={options:t.configuration.listenerOptions,listeners:[{types:["pointerdown"],listener:function(o){var c=o.target.id===t.domElement.id||o.target.classList.contains("ms-canvas");if(void 0!==this.activePointerId)this.activePointerId===o.pointerId&&grabberLogger.trace(o.type+" event with the same id without any pointer up",o.pointerId);else if(2!==o.button&&2!==o.buttons&&c){if(!a(o)&&!s(o)){this.activePointerId=o.pointerId;var l=o.pointerId>2147483647?-1:o.pointerId;i(),o.stopPropagation(),t.pointerDown(extractPoint(o,e,t.configuration,n,r),o.pointerType,l)}}else o.target.classList.contains("ellipsis")||o.target.classList.contains("tag-icon")?(a(o),s(o)):(a(o),s(o),this.smartGuidePointerDown=!0,this.downSmartGuidePoint=extractPoint(o,e,t.configuration))}},{types:["pointermove"],listener:function(a){if(void 0!==this.activePointerId&&this.activePointerId===a.pointerId)i(),t.pointerMove(extractPoint(a,e,t.configuration,n,r));else if(this.smartGuidePointerDown){var s=extractPoint(a,e,t.configuration,n,r),c=Math.abs(this.downSmartGuidePoint.x-s.x),l=Math.abs(this.downSmartGuidePoint.y-s.y);if(o=Math.max(c,o),c<5&&l>5&&o<15||c>5&&l>5&&o<15){this.activePointerId=a.pointerId;var u=a.pointerId>2147483647?-1:a.pointerId;i(),t.pointerDown(this.downSmartGuidePoint,a.pointerType,u)}}else grabberLogger.trace(a.type+" event from another pointerid ("+a.pointerId+")",this.activePointerId)}},{types:["pointerup","pointerout","pointerleave","pointercancel"],listener:function(i){o=0,this.smartGuidePointerDown=!1;var a=["smartguide","prompter-text-container","prompter-text","tag-icon","ellipsis"],s=["ps__rail-x","ps__thumb-x"],c=i.relatedTarget&&(a.includes(i.relatedTarget.className)||s.includes(i.relatedTarget.className)),l=i.relatedTarget&&i.target&&(a.includes(i.target.className)||s.includes(i.target.className)),u=i.relatedTarget&&i.target&&("SPAN"===i.target.tagName||"SPAN"===i.relatedTarget.tagName);c||l||u?i.stopPropagation():void 0!==this.activePointerId&&this.activePointerId===i.pointerId?(this.activePointerId=void 0,i.stopPropagation(),t.pointerUp(extractPoint(i,e,t.configuration,n,r))):grabberLogger.trace(i.type+" event from another pointerid ("+i.pointerId+")",this.activePointerId)}}]};return grabberLogger.debug("attaching listeners",c),c.listeners.forEach(function(t){t.types.forEach(function(n){return e.addEventListener(n,t.listener,c.options)})}),c}function detach(e,t){grabberLogger.debug("detaching listeners",t),t.listeners.forEach(function(n){n.types.forEach(function(r){return e.removeEventListener(r,n.listener,t.options)})})}var PointerEventGrabber=Object.freeze({attach:attach,detach:detach});function drawStroke(e,t,n){n&&n.drawStroke(e,t)}var ShapeSymbols={table:"table",shape:"shape",recognizedShape:"recognizedShape",ellipse:"ellipse",line:"line"};function phi(e){var t=(e+Math.PI)%(2*Math.PI)-Math.PI;return t<-Math.PI&&(t+=2*Math.PI),t}function drawEllipseArc(e,t,n,r,o,i,a){var s=Math.cos(o),c=Math.sin(o),l=s,u=c;s*=n,l*=r,c*=n,u*=r;var d=Math.floor(Math.abs(a)/.02),g=[];e.save();try{e.beginPath();for(var p=0;p<=d;p++){var f=i+p/d*a,h=Math.atan2(Math.sin(f)/r,Math.cos(f)/n),m=Math.cos(h),v=Math.sin(h),y=t.x+s*m-u*v,b=t.y+l*v+c*m;0===p?e.moveTo(y,b):e.lineTo(y,b),0!==p&&p!==d||g.push({x:y,y:b})}e.stroke()}finally{e.restore()}return g}function drawArrowHead(e,t,n,r){var o=phi(n+Math.PI*(7/8)),i=phi(n-Math.PI*(7/8)),a=e;a.save();try{a.fillStyle=a.strokeStyle,a.moveTo(t.x,t.y),a.beginPath(),a.lineTo(t.x+r*Math.cos(o),t.y+r*Math.sin(o)),a.lineTo(t.x+r*Math.cos(i),t.y+r*Math.sin(i)),a.lineTo(t.x,t.y),a.fill()}finally{a.restore()}}function drawShapeEllipse(e,t){var n=drawEllipseArc(e,t.center,t.maxRadius,t.minRadius,t.orientation,t.startAngle,t.sweepAngle);t.beginDecoration&&"ARROW_HEAD"===t.beginDecoration&&drawArrowHead(e,n[0],t.beginTangentAngle,12),t.endDecoration&&"ARROW_HEAD"===t.endDecoration&&drawArrowHead(e,n[1],t.endTangentAngle,12)}function drawLine(e,t,n){e.save();try{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke()}finally{e.restore()}}function drawShapeLine(e,t){drawLine(e,t.firstPoint,t.lastPoint),"ARROW_HEAD"===t.beginDecoration&&drawArrowHead(e,t.firstPoint,t.beginTangentAngle,12),"ARROW_HEAD"===t.endDecoration&&drawArrowHead(e,t.lastPoint,t.endTangentAngle,12)}function drawShapeSymbol(e,t){rendererLogger.debug("draw "+t.type+" symbol");var n=e;n.save();try{if(n.lineWidth=t.width,n.strokeStyle=t.color,t.elementType)switch(t.elementType){case ShapeSymbols.shape:drawShapeSymbol(n,t.candidates[t.selectedCandidateIndex]);break;case ShapeSymbols.table:t.lines.forEach(function(e){return drawShapeSymbol(n,e)});break;case ShapeSymbols.line:drawLine(n,t.data.p1,t.data.p2);break;default:rendererLogger.error(t.elementType+" not implemented")}else switch(t.type){case ShapeSymbols.ellipse:drawShapeEllipse(n,t);break;case ShapeSymbols.line:drawShapeLine(n,t);break;case ShapeSymbols.recognizedShape:t.primitives.forEach(function(e){return drawShapeSymbol(n,e)});break;default:rendererLogger.error(t.type+" not implemented")}}finally{n.restore()}}var TextSymbols={inputCharacter:"inputCharacter",char:"char",string:"string",textLine:"textLine"};function drawUnderline(e,t,n,r){var o=r.width/n.length;drawLine(e,{x:r.topLeftPoint.x+t.data.firstCharacter*o,y:r.topLeftPoint.y+r.height},{x:r.topLeftPoint.x+t.data.lastCharacter*o,y:r.topLeftPoint.y+r.height})}function drawText(e,t,n){var r=e;r.save();try{r.font=n.textHeight+"px serif",r.textAlign="CENTER"===n.justificationType?"center":"left",r.textBaseline="bottom",r.fillStyle=r.strokeStyle,r.fillText(t,n.topLeftPoint.x,n.topLeftPoint.y+n.height)}finally{r.restore()}}function drawTextLine(e,t){drawText(e,t.label,t.data),t.underlineList.forEach(function(n){drawUnderline(e,n,t.label,t.data)})}function drawTextSymbol(e,t){rendererLogger.debug("draw "+t.type+" symbol");var n=e;n.save();try{if(n.lineWidth=t.width,n.strokeStyle=t.color,t.elementType)switch(t.elementType){case TextSymbols.textLine:drawTextLine(n,t);break;default:rendererLogger.error(t.elementType+" not implemented")}else switch(t.type){case TextSymbols.textLine:drawTextLine(n,t);break;default:rendererLogger.error(t.type+" not implemented")}}finally{n.restore()}}var MusicClefs={F:{svg:'<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="18" height="20"><g transform="translate(6.600000e-3,3.125356e-3)"><path d="M17.3 3.1 C17.3 3.5 17.1 3.8 16.8 4.1 C16.5 4.4 15.9 4.5 15.5 4.3 C15 4.1 14.7 3.7 14.7 3.2 C14.6 2.8 14.8 2.5 15 2.2 C15.3 1.9 15.7 1.8 16 1.8 C16.4 1.8 16.8 2 17 2.3 C17.2 2.5 17.3 2.8 17.3 3.1 z"/><path d="M17.3 8.9 C17.3 9.3 17.1 9.7 16.8 9.9 C16.5 10.3 15.9 10.3 15.5 10.2 C15 10 14.7 9.5 14.7 9.1 C14.6 8.7 14.8 8.3 15 8 C15.3 7.8 15.7 7.6 16 7.6 C16.5 7.7 17 8 17.2 8.4 C17.2 8.6 17.3 8.8 17.3 8.9 z"/><path d="M13 7.2 C13 10 11.8 12.7 9.8 14.7 C7.3 17.2 4 18.8 0.7 19.8 C0.3 20.1 -0.4 19.8 0.3 19.4 C1.6 18.8 3 18.3 4.2 17.5 C7 15.8 9.3 13.1 9.8 9.9 C10.1 8 10.1 5.9 9.6 4 C9.2 2.6 8.2 1.1 6.7 0.9 C5.3 0.7 3.7 1.2 2.7 2.2 C2.5 2.4 2 3.2 2 4 C2.6 3.6 2.6 3.6 3.1 3.4 C4.2 2.9 5.7 3.6 6 4.9 C6.3 6 6.1 7.5 5 8.1 C3.8 8.7 2 8.5 1.4 7.2 C0.3 5.3 0.9 2.6 2.6 1.2 C4.4 -0.3 7.1 -0.3 9.2 0.4 C11.4 1.3 12.7 3.5 12.9 5.8 C13 6.2 13 6.7 13 7.2 z"/></g></svg>',getBoundingBox:function(e,t,n){return{height:3*e,width:3*e*.9,x:t,y:n-e}}},C:{svg:'<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="18" height="25"><g transform="matrix(1,0,0,1.030698,-309.364,-543.8647)"><path d="M 325.9 546.8 C 325.8 548.7 324.7 550.7 322.8 551.5 C 321.1 552.1 319.1 552.2 317.6 551 C 316.6 550.2 316.2 548.4 317.3 547.5 C 318.3 546.5 320.4 547.4 320.3 548.9 C 320.7 549.9 318.5 550.5 319.7 551.3 C 321 551.6 322.3 550.5 322.6 549.3 C 323.1 547.5 323.1 545.6 322.7 543.8 C 322.4 542.9 321.9 541.5 320.7 541.9 C 319.2 542.2 318.3 543.8 317.9 545.1 C 317.6 543.2 316.4 541.5 315 540.2 C 315 544.1 315 548 315 551.9 L 314.1 551.9 C 314.1 543.9 314.1 535.7 314.1 527.7 L 315 527.7 C 315 531.5 315 535.5 315 539.4 C 316.4 538.1 317.6 536.4 317.8 534.5 C 318.3 535.9 319.3 537.5 321 537.8 C 322.2 537.8 322.5 536.3 322.8 535.4 C 323.1 533.7 323.1 531.8 322.6 530.1 C 322.2 529 320.9 528 319.6 528.3 C 318.6 529 320.6 529.6 320.3 530.6 C 320.5 532 318.8 533 317.6 532.3 C 316.3 531.6 316.4 529.7 317.4 528.8 C 318 528.1 319.3 527.7 320.3 527.7 C 321.2 527.7 321.8 527.7 322.6 528 C 324.6 528.7 325.7 530.7 325.9 532.7 C 326.2 534.9 324.9 537.3 322.8 538.2 C 321.5 538.7 319.9 538.3 318.8 537.3 C 318.7 538.3 318.2 539.2 317.7 539.9 C 318.1 540.6 318.6 541.8 318.8 542.1 C 320.1 540.9 322.5 540.8 323.8 542 C 325.2 543.1 326.1 545 325.9 546.8 z "/></g><g transform="matrix(1,0,0,1.030928,-309.364,-543.9805)"><path d="M 312.2 551.9 L 309.4 551.9 L 309.4 527.7 L 312.2 527.7 L 312.2 551.9 z "/></g></svg>',getBoundingBox:function(e,t,n){return{height:3*e,width:3*e*.72,x:t,y:n-1.5*e}}},G:{svg:'<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="15" height="40"><g><path d="m 12 3.4 c 0.3 3.1 -2 5.6 -4.1 7.6 -0.9 0.9 -0.2 0.1 -0.6 0.6 -0.1 -0.5 -0.3 -1.7 -0.3 -2.1 0.1 -2.6 2.3 -6.5 4.2 -7.9 0.3 0.6 0.6 0.6 0.8 1.8 z m 0.7 15.9 c -1.2 -0.9 -2.8 -1.1 -4.3 -0.9 -0.2 -1.2 -0.4 -2.5 -0.6 -3.7 2.4 -2.3 4.9 -4.9 5 -8.4 0.1 -2.2 -0.3 -4.6 -1.7 -6.4 C 9.5 0.1 8.3 2.1 7.4 3.3 c -1.5 2.6 -1.1 5.8 -0.6 8.6 -0.8 0.9 -1.9 1.7 -2.7 2.7 -2.4 2.3 -4.4 5.3 -4 8.7 0.2 3.3 2.6 6.3 5.9 7.1 1.2 0.3 2.6 0.3 3.8 0.1 0.2 2.2 1 4.5 0.1 6.7 -0.7 1.6 -2.8 2.9 -4.3 2.2 -0.6 -0.3 -0.1 -0.1 -0.5 -0.2 1.1 -0.3 2 -1 2.3 -1.5 0.8 -1.4 -0.4 -3.6 -2.2 -3.3 -2.3 0 -3.2 3.1 -1.7 4.6 1.3 1.5 3.8 1.3 5.4 0.3 1.8 -1.2 2 -3.5 1.8 -5.5 -0.1 -0.7 -0.4 -2.6 -0.4 -3.3 0.7 -0.2 0.2 -0.1 1.2 -0.4 2.7 -1 4.4 -4.2 3.6 -7 -0.3 -1.4 -1 -2.9 -2.3 -3.7 z m 0.6 5.7 c 0.2 2 -1.1 4.2 -3.1 4.9 -0.1 -0.8 -0.2 -1 -0.3 -1.4 -0.5 -2.4 -0.7 -4.9 -1.1 -7.3 1.6 -0.2 3.5 0.5 4 2.1 0.2 0.6 0.3 1.2 0.4 1.8 z m -5.1 5.1 c -2.5 0.1 -5 -1.6 -5.6 -4 -0.7 -2.1 -0.5 -4.5 0.8 -6.4 1.1 -1.7 2.6 -3 4 -4.5 0.2 1.1 0.4 2.2 0.5 3.3 -3 0.8 -5 4.6 -3.2 7.3 0.5 0.8 2 2.2 2.8 1.6 -1.1 -0.7 -2 -1.8 -1.8 -3.2 -0.1 -1.3 1.4 -2.9 2.7 -3.1 0.4 2.8 0.9 6 1.4 8.8 -0.5 0.1 -1 0.1 -1.5 0.1 z"/></g></svg>',getBoundingBox:function(e,t,n){return{height:7.5*e,width:7.5*e*.375,x:t,y:n-4.5*e}}}},MusicSymbols={accidental:"accidental",arpeggiate:"arpeggiate",bar:"bar",beam:"beam",clef:"clef",decoration:"decoration",dots:"dots",head:"head",ledgerLine:"ledgerLine",rest:"rest",staff:"staff",stem:"stem",tieOrSlur:"tieOrSlur",timeSignature:"timeSignature"};function createImage(e,t){var n=document.createElement("img");return n.dataset.clef=e,n.src=t,n.style.display="none",n}function getMusicClefElements(){return Object.keys(MusicClefs).map(function(e){return createImage(e,"data:image/svg+xml,"+MusicClefs[e].svg)})}function drawStaff(e,t){for(var n=0;n<t.count;n++){drawLine(e,{x:0,y:t.top+n*t.gap},{x:e.canvas.width,y:t.top+n*t.gap})}}function drawClef(e,t){e.drawImage(e.canvas.parentElement.querySelector("img[data-clef="+t.value.symbol+"]"),t.boundingBox.x,t.boundingBox.y,t.boundingBox.width,t.boundingBox.height)}function drawMusicSymbol(e,t){switch(rendererLogger.debug("draw "+t.type+" symbol"),t.type){case MusicSymbols.clef:drawClef(e,t);break;case MusicSymbols.staff:drawStaff(e,t);break;default:rendererLogger.error(t.type+" not implemented")}}function computeDistance(e,t,n,r,o){var i=Math.sqrt(Math.pow(t-r[o-1],2)+Math.pow(e-n[o-1],2));return isNaN(i)?0:i}function computeLength(e,t,n,r,o,i){var a=o[i-1]+computeDistance(e,t,n,r,i);return isNaN(a)?0:a}function computePressure(e,t,n,r,o,i){var a=1,s=computeDistance(e,t,n,r,i),c=computeLength(e,t,n,r,o,i);0===c?a=.5:s===c?a=1:s<10?a=.2+Math.pow(.1*s,.4):s>c-10&&(a=.2+Math.pow(.1*(c-s),.4));var l=a*Math.max(.1,1-.1*Math.sqrt(s));return isNaN(parseFloat(l))?.5:l}function filterPointByAcquisitionDelta(e,t,n,r,o){var i=2+o/4,a=!1;return(0===n.length||0===r.length||Math.abs(n[n.length-1]-e)>=i||Math.abs(r[r.length-1]-t)>=i)&&(a=!0),a}function createStrokeComponent(e){return Object.assign({},{type:"stroke",x:[],y:[],t:[],p:[],l:[],width:0},e)}function toJSON$2(e){return{type:e.type,x:e.x,y:e.y,t:e.t}}function toJSONV4(e){return{x:e.x,y:e.y,t:e.t}}function addPoint(e,t){var n=e;return filterPointByAcquisitionDelta(t.x,t.y,n.x,n.y,n.width)?(n.x.push(t.x),n.y.push(t.y),n.t.push(t.t),n.p.push(computePressure(t.x,t.y,n.x,n.y,n.l,n.x.length-1)),n.l.push(computeLength(t.x,t.y,n.x,n.y,n.l,n.x.length-1))):modelLogger.trace("ignore filtered point",t),n}function slice(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.x.length,r=createStrokeComponent({color:e.color,width:e.width}),o=t;o<n;o++)addPoint(r,{x:e.x[o],y:e.y[o],t:e.t[o]});return r}function getPointByIndex(e,t){var n=void 0;return void 0!==t&&t>=0&&t<e.x.length&&(n={x:e.x[t],y:e.y[t],t:e.t[t],p:e.p[t],l:e.l[t]}),n}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};function mergeBounds(e,t){return{minX:Math.min(e.minX,t.minX),maxX:Math.max(e.maxX,t.maxX),minY:Math.min(e.minY,t.minY),maxY:Math.max(e.maxY,t.maxY)}}function getLineBounds(e){return{minX:Math.min(e.firstPoint.x,e.lastPoint.x),maxX:Math.max(e.firstPoint.x,e.lastPoint.x),minY:Math.min(e.firstPoint.y,e.lastPoint.y),maxY:Math.max(e.firstPoint.y,e.lastPoint.y)}}function getEllipseBounds(e){var t=Math.cos(e.orientation),n=Math.sin(e.orientation),r=t,o=n;t*=e.maxRadius,r*=e.minRadius,n*=e.maxRadius,o*=e.minRadius;for(var i=Math.abs(e.sweepAngle)/.02,a=[],s=[],c=0;c<=i;c++){var l=e.startAngle+c/i*e.sweepAngle,u=Math.atan2(Math.sin(l)/e.minRadius,Math.cos(l)/e.maxRadius),d=Math.cos(u),g=Math.sin(u);a.push(e.center.x+(t*d-o*g)),s.push(e.center.y+(r*g+n*d))}return{minX:Math.min.apply(Math,a),maxX:Math.max.apply(Math,a),minY:Math.min.apply(Math,s),maxY:Math.max.apply(Math,s)}}function getTextLineBounds(e){return{minX:e.data.topLeftPoint.x,maxX:e.data.topLeftPoint.x+e.data.width,minY:e.data.topLeftPoint.y,maxY:e.data.topLeftPoint.y+e.data.height}}function getClefBounds(e){return{minX:e.boundingBox.x,maxX:e.boundingBox.x+e.boundingBox.width,minY:e.boundingBox.y,maxY:e.boundingBox.y+e.boundingBox.height}}function getStrokeBounds(e){return{minX:Math.min.apply(Math,toConsumableArray(e.x)),maxX:Math.max.apply(Math,toConsumableArray(e.x)),minY:Math.min.apply(Math,toConsumableArray(e.y)),maxY:Math.max.apply(Math,toConsumableArray(e.y))}}function getSymbolsBounds(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{minX:Number.MAX_VALUE,maxX:Number.MIN_VALUE,minY:Number.MAX_VALUE,maxY:Number.MIN_VALUE};return t=e.filter(function(e){return"stroke"===e.type}).map(getStrokeBounds).reduce(mergeBounds,t),t=e.filter(function(e){return"clef"===e.type}).map(getClefBounds).reduce(mergeBounds,t),t=e.filter(function(e){return"line"===e.type}).map(getLineBounds).reduce(mergeBounds,t),t=e.filter(function(e){return"ellipse"===e.type}).map(getEllipseBounds).reduce(mergeBounds,t),t=e.filter(function(e){return"textLine"===e.type}).map(getTextLineBounds).reduce(mergeBounds,t)}function getDefaultMusicSymbols(e){var t=Object.assign({},{type:"staff"},e.recognitionParams.v3.musicParameter.staff),n={type:"clef",value:Object.assign({},e.recognitionParams.v3.musicParameter.clef)};return n.value.yAnchor=t.top+t.gap*(t.count-n.value.line),delete n.value.line,n.boundingBox=MusicClefs[n.value.symbol].getBoundingBox(t.gap,0,n.value.yAnchor),[t,n]}function getDefaultSymbols(e){switch(e.recognitionParams.type){case Constants.RecognitionType.MUSIC:return getDefaultMusicSymbols(e);default:return[]}}function createModel(e){return{currentStroke:void 0,rawStrokes:[],strokeGroups:[],lastPositions:{lastSentPosition:-1,lastReceivedPosition:-1,lastRenderedPosition:-1},defaultSymbols:e?getDefaultSymbols(e):[],recognizedSymbols:void 0,exports:void 0,rawResults:{convert:void 0,exports:void 0},creationTime:(new Date).getTime(),modificationTime:void 0}}function clearModel(e){var t=e;return t.currentStroke=void 0,t.rawStrokes=[],t.strokeGroups=[],t.lastPositions.lastSentPosition=-1,t.lastPositions.lastReceivedPosition=-1,t.lastPositions.lastRenderedPosition=-1,t.recognizedSymbols=void 0,t.exports=void 0,t.rawResults.convert=void 0,t.rawResults.exports=void 0,t}function needRedraw(e){return!!e.recognizedSymbols&&e.rawStrokes.length!==e.recognizedSymbols.filter(function(e){return"stroke"===e.type}).length}function addStroke(e,t){var n=e;return modelLogger.debug("addStroke",t),n.rawStrokes.push(t),n}function addStrokeToGroup(e,t,n){var r=e;modelLogger.debug("addStroke",t);var o=r.strokeGroups.length-1;if(r.strokeGroups[o]&&r.strokeGroups[o].penStyle===n)r.strokeGroups[o].strokes.push(t);else{var i={penStyle:n,strokes:[]},a={};Object.assign(a,t),i.strokes.push(a),r.strokeGroups.push(i)}return r}function extractPendingStrokes(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.lastPositions.lastReceivedPosition+1;return e.rawStrokes.slice(t)}function initPendingStroke(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:96;if(n&&n["-myscript-pen-width"]){var o=n["-myscript-pen-width"]*r/25.4;Object.assign(n,{width:o/2})}var i=e;return modelLogger.trace("initPendingStroke",t),i.currentStroke=createStrokeComponent(n),i.currentStroke=addPoint(i.currentStroke,t),i}function appendToPendingStroke(e,t){var n=e;return n.currentStroke&&(modelLogger.trace("appendToPendingStroke",t),n.currentStroke=addPoint(n.currentStroke,t)),n}function endPendingStroke(e,t,n){var r=e;if(r.currentStroke){modelLogger.trace("endPendingStroke",t);var o=addPoint(r.currentStroke,t);addStroke(r,o),addStrokeToGroup(r,o,n),delete r.currentStroke}return r}function getBorderCoordinates(e){var t={minX:Number.MAX_VALUE,maxX:Number.MIN_VALUE,minY:Number.MAX_VALUE,maxY:Number.MIN_VALUE};return e.defaultSymbols&&e.defaultSymbols.length>0&&(t=getSymbolsBounds(e.defaultSymbols,t)),e.recognizedSymbols&&e.recognizedSymbols.length>0?(t=getSymbolsBounds(e.recognizedSymbols,t),t=getSymbolsBounds(extractPendingStrokes(e),t)):t=getSymbolsBounds(e.rawStrokes,t),t}function extractStrokesFromInkRange(e,t,n,r,o){return e.rawStrokes.slice(t,n+1).map(function(e,t,n){return n.length<2?slice(e,r,o+1):0===t?slice(e,r):t===n.length-1?slice(e,0,o+1):e})}function updateModelSentPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.rawStrokes.length-1,n=e;return n.lastPositions.lastSentPosition=t,n}function updateModelReceivedPosition(e){var t=e;return t.lastPositions.lastReceivedPosition=t.lastPositions.lastSentPosition,t}function resetModelPositions(e){var t=e;return t.lastPositions.lastSentPosition=-1,t.lastPositions.lastReceivedPosition=-1,t}function resetModelRendererPosition(e){var t=e;return t.lastPositions.lastRenderedPosition=-1,t}function updateModelRenderedPosition(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.recognizedSymbols?e.recognizedSymbols.length-1:-1,n=e;return n.lastPositions.lastRenderedPosition=t,n}function extractPendingRecognizedSymbols(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.lastPositions.lastRenderedPosition+1;return e.recognizedSymbols?e.recognizedSymbols.slice(t):[]}function cloneModel(e){var t=Object.assign({},e);return t.defaultSymbols=[].concat(toConsumableArray(e.defaultSymbols)),t.currentStroke=e.currentStroke?Object.assign({},e.currentStroke):void 0,t.rawStrokes=[].concat(toConsumableArray(e.rawStrokes)),t.strokeGroups=JSON.parse(JSON.stringify(e.strokeGroups)),t.lastPositions=Object.assign({},e.lastPositions),t.exports=e.exports?Object.assign({},e.exports):void 0,t.rawResults=Object.assign({},e.rawResults),t.recognizedSymbols=e.recognizedSymbols?[].concat(toConsumableArray(e.recognizedSymbols)):void 0,t}function mergeModels(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){var n=e;return n.recognizedSymbols=t.recognizedSymbols,n.lastPositions.lastSentPosition=t.lastPositions.lastSentPosition,n.lastPositions.lastReceivedPosition=t.lastPositions.lastReceivedPosition,n.lastPositions.lastRenderedPosition=t.lastPositions.lastRenderedPosition,n.rawResults=t.rawResults,n.exports=t.exports,n})}var InkModel=Object.freeze({createModel:createModel,clearModel:clearModel,needRedraw:needRedraw,addStroke:addStroke,addStrokeToGroup:addStrokeToGroup,extractPendingStrokes:extractPendingStrokes,initPendingStroke:initPendingStroke,appendToPendingStroke:appendToPendingStroke,endPendingStroke:endPendingStroke,getBorderCoordinates:getBorderCoordinates,extractStrokesFromInkRange:extractStrokesFromInkRange,updateModelSentPosition:updateModelSentPosition,updateModelReceivedPosition:updateModelReceivedPosition,resetModelPositions:resetModelPositions,resetModelRendererPosition:resetModelRendererPosition,updateModelRenderedPosition:updateModelRenderedPosition,extractPendingRecognizedSymbols:extractPendingRecognizedSymbols,cloneModel:cloneModel,mergeModels:mergeModels});function getInfo(){return{type:"canvas",apiVersion:"V3"}}function getPixelRatio(e){if(e){var t=e.getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}return 1}function detectPixelRatio(e){return getPixelRatio(document.createElement("canvas"))}function createCanvas(e,t){var n=document.createElement("canvas");return n.classList.add(t),n.classList.add("ms-canvas"),e.appendChild(n),rendererLogger.debug("canvas created",n),n}function resizeContent(e){return[e.renderingCanvas,e.capturingCanvas].forEach(function(t){var n=t.parentNode,r=n.clientWidth<e.minWidth?e.minWidth:n.clientWidth,o=n.clientHeight<e.minHeight?e.minHeight:n.clientHeight;t.width=r*e.pixelRatio,t.height=o*e.pixelRatio,t.style.width=r+"px",t.style.height=o+"px",t.getContext("2d").scale(e.pixelRatio,e.pixelRatio),rendererLogger.debug("canvas size changed",t)}),e}function attach$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;rendererLogger.debug("attach renderer",e);var r=detectPixelRatio(e),o=getMusicClefElements();o.forEach(function(t){return e.appendChild(t)});var i=createCanvas(e,"ms-rendering-canvas"),a=createCanvas(e,"ms-capture-canvas");return resizeContent({pixelRatio:r,minHeight:t,minWidth:n,renderingCanvas:i,renderingCanvasContext:i.getContext("2d"),capturingCanvas:a,capturingCanvasContext:a.getContext("2d"),resources:o})}function detach$1(e,t){rendererLogger.debug("detach renderer",e),t.resources.forEach(function(t){return e.removeChild(t)}),e.removeChild(t.renderingCanvas),e.removeChild(t.capturingCanvas)}function resize(e,t,n){return this.drawModel(resizeContent(e),t,n)}function drawSymbol(e,t,n){var r=t.elementType?t.elementType:t.type;rendererLogger.trace("attempting to draw "+r+" symbol"),"stroke"===r?drawStroke(e,t,n):TextSymbols[r]?drawTextSymbol(e,t):ShapeSymbols[r]?drawShapeSymbol(e,t):MusicSymbols[r]?drawMusicSymbol(e,t):rendererLogger.warn("impossible to draw "+r+" symbol")}function drawCurrentStroke(e,t,n){return e.capturingCanvasContext.clearRect(0,0,e.capturingCanvas.width,e.capturingCanvas.height),rendererLogger.trace("drawing current stroke ",t.currentStroke),drawStroke(e.capturingCanvasContext,t.currentStroke,n),t}function drawModel(e,t,n){e.renderingCanvasContext.clearRect(0,0,e.renderingCanvas.width,e.renderingCanvas.height);var r=[].concat(toConsumableArray(t.defaultSymbols));return t.recognizedSymbols?(r.push.apply(r,toConsumableArray(t.recognizedSymbols)),r.push.apply(r,toConsumableArray(extractPendingStrokes(t)))):r.push.apply(r,toConsumableArray(t.rawStrokes)),r.forEach(function(t){return drawSymbol(e.renderingCanvasContext,t,n)}),e.capturingCanvasContext.clearRect(0,0,e.capturingCanvas.width,e.capturingCanvas.height),t}var CanvasRenderer=Object.freeze({getInfo:getInfo,attach:attach$1,detach:detach$1,resize:resize,drawCurrentStroke:drawCurrentStroke,drawModel:drawModel});function computeLinksPoints(e,t,n){var r=e.p*n;return[{x:e.x-Math.sin(t)*r,y:e.y+Math.cos(t)*r},{x:e.x+Math.sin(t)*r,y:e.y-Math.cos(t)*r}]}function computeMiddlePoint(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2,p:(t.p+e.p)/2}}function computeAxeAngle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function getInfo$1(){return{type:"canvas",name:"quadratic",apiVersion:"V3"}}function renderArc(e,t,n){e.arc(t.x,t.y,n,0,2*Math.PI,!0)}function renderLine(e,t,n,r){var o=computeLinksPoints(t,computeAxeAngle(t,n),r),i=computeLinksPoints(n,computeAxeAngle(t,n),r);e.moveTo(o[0].x,o[0].y),e.lineTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(o[1].x,o[1].y)}function renderFinal(e,t,n,r){var o=computeAxeAngle(t,n),i=computeLinksPoints(n,o,r);e.moveTo(i[0].x,i[0].y);for(var a=1;a<=6;a++){var s=o-a*Math.PI/6;e.lineTo(n.x-n.p*r*Math.sin(s),n.y+n.p*r*Math.cos(s))}}function renderQuadratic(e,t,n,r,o){var i=computeLinksPoints(t,computeAxeAngle(t,r),o),a=computeLinksPoints(n,computeAxeAngle(r,n),o),s=computeLinksPoints(r,computeAxeAngle(t,n),o);e.moveTo(i[0].x,i[0].y),e.quadraticCurveTo(s[0].x,s[0].y,a[0].x,a[0].y),e.lineTo(a[1].x,a[1].y),e.quadraticCurveTo(s[1].x,s[1].y,i[1].x,i[1].y)}function drawStroke$1(e,t){var n=e,r=t.x.length,o=t.width>0?t.width:n.lineWidth,i=t.color?t.color:n.strokeStyle,a=getPointByIndex(t,0),s=r-2;n.save();try{if(n.beginPath(),r<3)renderArc(n,a,.6*o);else{renderArc(n,a,o*a.p),renderLine(n,a,computeMiddlePoint(a,getPointByIndex(t,1)),o);for(var c=0;c<s;c++)renderQuadratic(n,computeMiddlePoint(getPointByIndex(t,c),getPointByIndex(t,c+1)),computeMiddlePoint(getPointByIndex(t,c+1),getPointByIndex(t,c+2)),getPointByIndex(t,c+1),o);renderLine(n,computeMiddlePoint(getPointByIndex(t,r-2),getPointByIndex(t,r-1)),getPointByIndex(t,r-1),o),renderFinal(n,getPointByIndex(t,r-2),getPointByIndex(t,r-1),o)}n.closePath(),void 0!==i&&(n.fillStyle=i,n.fill())}finally{n.restore()}}var QuadraticCanvasStroker=Object.freeze({getInfo:getInfo$1,drawStroke:drawStroke$1}),xhtml="http://www.w3.org/1999/xhtml",namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),namespaces.hasOwnProperty(t)?{space:namespaces[t],local:e}:e}function creatorInherit(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===xhtml&&t.documentElement.namespaceURI===xhtml?t.createElement(e):t.createElementNS(n,e)}}function creatorFixed(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function creator(e){var t=namespace(e);return(t.local?creatorFixed:creatorInherit)(t)}function none(){}function selector(e){return null==e?none:function(){return this.querySelector(e)}}function selection_select(e){"function"!=typeof e&&(e=selector(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a,s=t[o],c=s.length,l=r[o]=new Array(c),u=0;u<c;++u)(i=s[u])&&(a=e.call(i,i.__data__,u,s))&&("__data__"in i&&(a.__data__=i.__data__),l[u]=a);return new Selection(r,this._parents)}function empty(){return[]}function selectorAll(e){return null==e?empty:function(){return this.querySelectorAll(e)}}function selection_selectAll(e){"function"!=typeof e&&(e=selectorAll(e));for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var a,s=t[i],c=s.length,l=0;l<c;++l)(a=s[l])&&(r.push(e.call(a,a.__data__,l,s)),o.push(a));return new Selection(r,o)}var matcher=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var element=document.documentElement;if(!element.matches){var vendorMatches=element.webkitMatchesSelector||element.msMatchesSelector||element.mozMatchesSelector||element.oMatchesSelector;matcher=function(e){return function(){return vendorMatches.call(this,e)}}}}var matcher$1=matcher;function selection_filter(e){"function"!=typeof e&&(e=matcher$1(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i,a=t[o],s=a.length,c=r[o]=[],l=0;l<s;++l)(i=a[l])&&e.call(i,i.__data__,l,a)&&c.push(i);return new Selection(r,this._parents)}function sparse(e){return new Array(e.length)}function selection_enter(){return new Selection(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function constant(e){return function(){return e}}EnterNode.prototype={constructor:EnterNode,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var keyPrefix="$";function bindIndex(e,t,n,r,o,i){for(var a,s=0,c=t.length,l=i.length;s<l;++s)(a=t[s])?(a.__data__=i[s],r[s]=a):n[s]=new EnterNode(e,i[s]);for(;s<c;++s)(a=t[s])&&(o[s]=a)}function bindKey(e,t,n,r,o,i,a){var s,c,l,u={},d=t.length,g=i.length,p=new Array(d);for(s=0;s<d;++s)(c=t[s])&&(p[s]=l=keyPrefix+a.call(c,c.__data__,s,t),l in u?o[s]=c:u[l]=c);for(s=0;s<g;++s)(c=u[l=keyPrefix+a.call(e,i[s],s,i)])?(r[s]=c,c.__data__=i[s],u[l]=null):n[s]=new EnterNode(e,i[s]);for(s=0;s<d;++s)(c=t[s])&&u[p[s]]===c&&(o[s]=c)}function selection_data(e,t){if(!e)return p=new Array(this.size()),l=-1,this.each(function(e){p[++l]=e}),p;var n=t?bindKey:bindIndex,r=this._parents,o=this._groups;"function"!=typeof e&&(e=constant(e));for(var i=o.length,a=new Array(i),s=new Array(i),c=new Array(i),l=0;l<i;++l){var u=r[l],d=o[l],g=d.length,p=e.call(u,u&&u.__data__,l,r),f=p.length,h=s[l]=new Array(f),m=a[l]=new Array(f);n(u,d,h,m,c[l]=new Array(g),p,t);for(var v,y,b=0,C=0;b<f;++b)if(v=h[b]){for(b>=C&&(C=b+1);!(y=m[C])&&++C<f;);v._next=y||null}}return(a=new Selection(a,r))._enter=s,a._exit=c,a}function selection_exit(){return new Selection(this._exit||this._groups.map(sparse),this._parents)}function selection_merge(e){for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),a=new Array(r),s=0;s<i;++s)for(var c,l=t[s],u=n[s],d=l.length,g=a[s]=new Array(d),p=0;p<d;++p)(c=l[p]||u[p])&&(g[p]=c);for(;s<r;++s)a[s]=t[s];return new Selection(a,this._parents)}function selection_order(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,o=e[t],i=o.length-1,a=o[i];--i>=0;)(r=o[i])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this}function selection_sort(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=ascending);for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var a,s=n[i],c=s.length,l=o[i]=new Array(c),u=0;u<c;++u)(a=s[u])&&(l[u]=a);l.sort(t)}return new Selection(o,this._parents).order()}function ascending(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function selection_call(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function selection_nodes(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function selection_node(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var a=r[o];if(a)return a}return null}function selection_size(){var e=0;return this.each(function(){++e}),e}function selection_empty(){return!this.node()}function selection_each(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o,i=t[n],a=0,s=i.length;a<s;++a)(o=i[a])&&e.call(o,o.__data__,a,i);return this}function attrRemove(e){return function(){this.removeAttribute(e)}}function attrRemoveNS(e){return function(){this.removeAttributeNS(e.space,e.local)}}function attrConstant(e,t){return function(){this.setAttribute(e,t)}}function attrConstantNS(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function attrFunction(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function attrFunctionNS(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function selection_attr(e,t){var n=namespace(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?attrRemoveNS:attrRemove:"function"==typeof t?n.local?attrFunctionNS:attrFunction:n.local?attrConstantNS:attrConstant)(n,t))}function defaultView(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function styleRemove(e){return function(){this.style.removeProperty(e)}}function styleConstant(e,t,n){return function(){this.style.setProperty(e,t,n)}}function styleFunction(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function selection_style(e,t,n){return arguments.length>1?this.each((null==t?styleRemove:"function"==typeof t?styleFunction:styleConstant)(e,t,null==n?"":n)):styleValue(this.node(),e)}function styleValue(e,t){return e.style.getPropertyValue(t)||defaultView(e).getComputedStyle(e,null).getPropertyValue(t)}function propertyRemove(e){return function(){delete this[e]}}function propertyConstant(e,t){return function(){this[e]=t}}function propertyFunction(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function selection_property(e,t){return arguments.length>1?this.each((null==t?propertyRemove:"function"==typeof t?propertyFunction:propertyConstant)(e,t)):this.node()[e]}function classArray(e){return e.trim().split(/^|\s+/)}function classList(e){return e.classList||new ClassList(e)}function ClassList(e){this._node=e,this._names=classArray(e.getAttribute("class")||"")}function classedAdd(e,t){for(var n=classList(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function classedRemove(e,t){for(var n=classList(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function classedTrue(e){return function(){classedAdd(this,e)}}function classedFalse(e){return function(){classedRemove(this,e)}}function classedFunction(e,t){return function(){(t.apply(this,arguments)?classedAdd:classedRemove)(this,e)}}function selection_classed(e,t){var n=classArray(e+"");if(arguments.length<2){for(var r=classList(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each(("function"==typeof t?classedFunction:t?classedTrue:classedFalse)(n,t))}function textRemove(){this.textContent=""}function textConstant(e){return function(){this.textContent=e}}function textFunction(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function selection_text(e){return arguments.length?this.each(null==e?textRemove:("function"==typeof e?textFunction:textConstant)(e)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(e){return function(){this.innerHTML=e}}function htmlFunction(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function selection_html(e){return arguments.length?this.each(null==e?htmlRemove:("function"==typeof e?htmlFunction:htmlConstant)(e)):this.node().innerHTML}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(e){var t="function"==typeof e?e:creator(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function constantNull(){return null}function selection_insert(e,t){var n="function"==typeof e?e:creator(e),r=null==t?constantNull:"function"==typeof t?t:selector(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function remove(){var e=this.parentNode;e&&e.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function selection_cloneDeep(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function selection_clone(e){return this.select(e?selection_cloneDeep:selection_cloneShallow)}function selection_datum(e){return arguments.length?this.property("__data__",e):this.node().__data__}ClassList.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var filterEvents={};if("undefined"!=typeof document){var element$1=document.documentElement;"onmouseenter"in element$1||(filterEvents={mouseenter:"mouseover",mouseleave:"mouseout"})}function filterContextListener(e,t,n){return e=contextListener(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function contextListener(e,t,n){return function(r){try{e.call(this,this.__data__,t,n)}finally{}}}function parseTypenames(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function onRemove(e){return function(){var t=this.__on;if(t){for(var n,r=0,o=-1,i=t.length;r<i;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++o]=n:this.removeEventListener(n.type,n.listener,n.capture);++o?t.length=o:delete this.__on}}}function onAdd(e,t,n){var r=filterEvents.hasOwnProperty(e.type)?filterContextListener:contextListener;return function(o,i,a){var s,c=this.__on,l=r(t,i,a);if(c)for(var u=0,d=c.length;u<d;++u)if((s=c[u]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=n),void(s.value=t);this.addEventListener(e.type,l,n),s={type:e.type,name:e.name,value:t,listener:l,capture:n},c?c.push(s):this.__on=[s]}}function selection_on(e,t,n){var r,o,i=parseTypenames(e+""),a=i.length;if(!(arguments.length<2)){for(s=t?onAdd:onRemove,null==n&&(n=!1),r=0;r<a;++r)this.each(s(i[r],t,n));return this}var s=this.node().__on;if(s)for(var c,l=0,u=s.length;l<u;++l)for(r=0,c=s[l];r<a;++r)if((o=i[r]).type===c.type&&o.name===c.name)return c.value}function dispatchEvent(e,t,n){var r=defaultView(e),o=r.CustomEvent;"function"==typeof o?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function dispatchConstant(e,t){return function(){return dispatchEvent(this,e,t)}}function dispatchFunction(e,t){return function(){return dispatchEvent(this,e,t.apply(this,arguments))}}function selection_dispatch(e,t){return this.each(("function"==typeof t?dispatchFunction:dispatchConstant)(e,t))}var root=[null];function Selection(e,t){this._groups=e,this._parents=t}function selection(){return new Selection([[document.documentElement]],root)}function select(e){return"string"==typeof e?new Selection([[document.querySelector(e)]],[document.documentElement]):new Selection([[e]],root)}function drawStroke$2(e,t,n){n&&n.drawStroke(e,t)}function getInfo$2(){return{type:"svg",apiVersion:"V4"}}function attach$2(e){var t=e;return rendererLogger.debug("populate root element",t),t.style.fontSize="10px",select(t)}function detach$2(e,t){rendererLogger.debug("detach renderer",e),t.select("svg").remove()}function resize$1(e,t,n,r,o){var i=e.node().getBoundingClientRect(),a=e.selectAll("svg"),s=i.width<o?o:i.width,c=i.height<r?r:i.height;return a.attr("viewBox","0 0 "+s+", "+c),a.attr("width",s+"px"),a.attr("height",c+"px"),rendererLogger.debug("svg viewBox changed",a),t}function drawCurrentStroke$1(e,t,n){var r=t;return r.currentStroke.id="pendingStroke-"+t.rawStrokes.length,rendererLogger.trace("drawing current stroke ",t.currentStroke),e.select("#pendingStrokes #"+r.currentStroke.id).remove(),drawStroke$2(e.select("#pendingStrokes").append("path").attr("id",t.currentStroke.id),t.currentStroke,n),r}function insertAdjacentSVG(e,t,n){var r=e.ownerDocument.createElementNS("http://www.w3.org/2000/svg","_");switch(r.innerHTML=n,t.toLowerCase()){case"beforebegin":e.parentNode.insertBefore(r.firstChild,e);break;case"afterbegin":e.insertBefore(r.lastChild,e.firstChild);break;case"beforeend":e.appendChild(r.firstChild);break;case"afterend":e.parentNode.insertBefore(r.lastChild,e.nextSibling);break;default:rendererLogger.warn("Invalid insertAdjacentHTML position")}}function drawModel$1(e,t,n){var r=extractPendingRecognizedSymbols(t);r&&(r.forEach(function(t){var n;(n=t).updates.forEach(function(t){try{var r='svg[data-layer="'+n.layer+'"]';switch(t.type){case"REPLACE_ALL":e.select(r).remove();var o=e.node();o.insertAdjacentHTML?o.insertAdjacentHTML("beforeEnd",t.svg):insertAdjacentSVG(o,"beforeEnd",t.svg),"MODEL"===n.layer&&e.select(r).append("g").attr("id","pendingStrokes");break;case"REMOVE_ELEMENT":t.id.includes("s")||t.id.includes("MODEL")?e.select("#"+t.id).remove():(e.select("#"+t.id).attr("class","removed-stroke"),setTimeout(function(){e.select("#"+t.id).remove()},100));break;case"REPLACE_ELEMENT":var i=e.select("#"+t.id).node().parentNode;e.select("#"+t.id).remove(),i.insertAdjacentHTML?i.insertAdjacentHTML("beforeEnd",t.svg):(insertAdjacentSVG(i,"beforeEnd",t.svg),e.node().insertAdjacentHTML("beforeEnd",e.select(r).remove().node().outerHTML));break;case"REMOVE_CHILD":e.select("#"+t.parentId+" > *:nth-child("+(t.index+1)+")").remove();break;case"APPEND_CHILD":var a=e.select(t.parentId?"#"+t.parentId:r).node();a.insertAdjacentHTML?a.insertAdjacentHTML("beforeEnd",t.svg):(insertAdjacentSVG(a,"beforeEnd",t.svg),e.node().insertAdjacentHTML("beforeEnd",e.select(r).remove().node().outerHTML));break;case"INSERT_BEFORE":var s=e.select("#"+t.refId).node();s.insertAdjacentHTML?s.insertAdjacentHTML("beforeBegin",t.svg):(insertAdjacentSVG(s,"beforeBegin",t.svg),e.node().insertAdjacentHTML("beforeEnd",e.select(r).remove().node().outerHTML));break;case"REMOVE_ATTRIBUTE":e.selectAll(t.id?"#"+t.id:"svg").attr(t.name,null);break;case"SET_ATTRIBUTE":t.id&&e.selectAll("#"+t.id).attr(t.name,t.value);break;default:rendererLogger.debug("unknown update "+t.type+" action")}}catch(e){rendererLogger.error("Invalid update "+t.type,t),rendererLogger.error("Error on svg patch",e)}})}),updateModelRenderedPosition(t));var o=extractPendingStrokes(t);return o&&o.forEach(function(t){return r=t,o=e.select("#pendingStrokes"),rendererLogger.trace("attempting to draw "+r.type+" symbol"),void("stroke"!==r.type||o.select("id",r.id)?rendererLogger.warn("impossible to draw "+r.type+" symbol"):drawStroke$2(o.append("path").attr("id",r.id),r,n));var r,o}),t}Selection.prototype=selection.prototype={constructor:Selection,select:selection_select,selectAll:selection_selectAll,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,merge:selection_merge,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch};var SVGRenderer=Object.freeze({getInfo:getInfo$2,attach:attach$2,detach:detach$2,resize:resize$1,drawCurrentStroke:drawCurrentStroke$1,drawModel:drawModel$1});function getInfo$3(){return{type:"svg",name:"quadratic",apiVersion:"V4"}}function renderArc$1(e,t,n){return["M "+t.x+","+t.y,"m "+-n+",0","a "+n+","+n+" 0 1 0 "+2*n+",0","a "+n+","+n+" 0 1 0 "+-2*n+",0"].join(" ")}function renderLine$1(e,t,n,r){var o=computeLinksPoints(t,computeAxeAngle(t,n),r),i=computeLinksPoints(n,computeAxeAngle(t,n),r);return["M "+o[0].x+","+o[0].y,"L "+i[0].x+","+i[0].y,"L "+i[1].x+","+i[1].y,"L "+o[1].x+","+o[1].y].join(" ")}function renderFinal$1(e,t,n,r){for(var o=computeAxeAngle(t,n),i=computeLinksPoints(n,o,r),a=["M "+i[0].x+","+i[0].y],s=1;s<=6;s++){var c=o-s*(Math.PI/6);a.push("L "+(n.x-n.p*r*Math.sin(c))+","+(n.y+n.p*r*Math.cos(c)))}return a.join(" ")}function renderQuadratic$1(e,t,n,r,o){var i=computeLinksPoints(t,computeAxeAngle(t,r),o),a=computeLinksPoints(n,computeAxeAngle(r,n),o),s=computeLinksPoints(r,computeAxeAngle(t,n),o);return["M "+i[0].x+","+i[0].y,"Q "+s[0].x+","+s[0].y+" "+a[0].x+","+a[0].y,"L "+a[1].x+","+a[1].y,"Q "+s[1].x+","+s[1].y+" "+i[1].x+","+i[1].y].join(" ")}function drawStroke$3(e,t){var n=t.x.length,r=t.width,o=getPointByIndex(t,0),i=n-2,a=[];if(n<3)a.push(renderArc$1(e,o,.6*r));else{a.push(renderArc$1(e,o,r*o.p)),a.push(renderLine$1(e,o,computeMiddlePoint(o,getPointByIndex(t,1)),r));for(var s=0;s<i;s++)a.push(renderQuadratic$1(e,computeMiddlePoint(getPointByIndex(t,s),getPointByIndex(t,s+1)),computeMiddlePoint(getPointByIndex(t,s+1),getPointByIndex(t,s+2)),getPointByIndex(t,s+1),r));a.push(renderLine$1(e,computeMiddlePoint(getPointByIndex(t,n-2),getPointByIndex(t,n-1)),getPointByIndex(t,n-1),r)),a.push(renderFinal$1(e,getPointByIndex(t,n-2),getPointByIndex(t,n-1),r))}var c=a.join(" ");e.attr("color",t.color).style("fill",t.color).style("stroke","transparent").classed("pending-stroke",!0).attr("d",c+"Z")}var QuadraticSVGStroker=Object.freeze({getInfo:getInfo$3,drawStroke:drawStroke$3}),core=createCommonjsModule(function(e,t){var n;e.exports=(n=n||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},o=r.lib={},i=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var a=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=a<<24-(r+i)%4*8}else for(var i=0;i<o;i+=4)t[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],o=function(t){var t=t,n=987654321,r=4294967295;return function(){var o=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var s=o(4294967296*(n||e.random()));n=987654071*s(),r.push(4294967296*s()|0)}return new a.init(r,t)}}),s=r.enc={},c=s.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(n,t/2)}},l=s.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(n,t)}},u=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,s=4*i,c=o/s,l=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*i,u=e.min(4*l,o);if(l){for(var d=0;d<l;d+=i)this._doProcessBlock(r,d);var g=r.splice(0,l);n.sigBytes-=u}return new a.init(g,u)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(o.Hasher=d.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math),n)}),encHex=createCommonjsModule(function(e,t){e.exports=core.enc.Hex}),x64Core=createCommonjsModule(function(e,t){var n,r,o,i,a,s;e.exports=(o=(r=n=core).lib,i=o.Base,a=o.WordArray,(s=r.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var o=e[r];n.push(o.high),n.push(o.low)}return a.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}}),n)}),sha512=createCommonjsModule(function(e,t){var n;e.exports=(n=core,function(){var e=n,t=e.lib.Hasher,r=e.x64,o=r.Word,i=r.WordArray,a=e.algo;function s(){return o.create.apply(o,arguments)}var c=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],l=[];!function(){for(var e=0;e<80;e++)l[e]=s()}();var u=a.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=n[5],d=n[6],g=n[7],p=r.high,f=r.low,h=o.high,m=o.low,v=i.high,y=i.low,b=a.high,C=a.low,S=s.high,x=s.low,E=u.high,k=u.low,R=d.high,w=d.low,P=g.high,I=g.low,T=p,L=f,_=h,M=m,A=v,z=y,D=b,O=C,U=S,N=x,j=E,$=k,B=R,H=w,W=P,X=I,G=0;G<80;G++){var F=l[G];if(G<16)var Y=F.high=0|e[t+2*G],V=F.low=0|e[t+2*G+1];else{var K=l[G-15],J=K.high,q=K.low,Z=(J>>>1|q<<31)^(J>>>8|q<<24)^J>>>7,Q=(q>>>1|J<<31)^(q>>>8|J<<24)^(q>>>7|J<<25),ee=l[G-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,oe=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=l[G-7],ae=ie.high,se=ie.low,ce=l[G-16],le=ce.high,ue=ce.low;Y=(Y=(Y=Z+ae+((V=Q+se)>>>0<Q>>>0?1:0))+re+((V+=oe)>>>0<oe>>>0?1:0))+le+((V+=ue)>>>0<ue>>>0?1:0),F.high=Y,F.low=V}var de,ge=U&j^~U&B,pe=N&$^~N&H,fe=T&_^T&A^_&A,he=L&M^L&z^M&z,me=(T>>>28|L<<4)^(T<<30|L>>>2)^(T<<25|L>>>7),ve=(L>>>28|T<<4)^(L<<30|T>>>2)^(L<<25|T>>>7),ye=(U>>>14|N<<18)^(U>>>18|N<<14)^(U<<23|N>>>9),be=(N>>>14|U<<18)^(N>>>18|U<<14)^(N<<23|U>>>9),Ce=c[G],Se=Ce.high,xe=Ce.low,Ee=W+ye+((de=X+be)>>>0<X>>>0?1:0),ke=ve+he;W=B,X=H,B=j,H=$,j=U,$=N,U=D+(Ee=(Ee=(Ee=Ee+ge+((de+=pe)>>>0<pe>>>0?1:0))+Se+((de+=xe)>>>0<xe>>>0?1:0))+Y+((de+=V)>>>0<V>>>0?1:0))+((N=O+de|0)>>>0<O>>>0?1:0)|0,D=A,O=z,A=_,z=M,_=T,M=L,T=Ee+(me+fe+(ke>>>0<ve>>>0?1:0))+((L=de+ke|0)>>>0<de>>>0?1:0)|0}f=r.low=f+L,r.high=p+T+(f>>>0<L>>>0?1:0),m=o.low=m+M,o.high=h+_+(m>>>0<M>>>0?1:0),y=i.low=y+z,i.high=v+A+(y>>>0<z>>>0?1:0),C=a.low=C+O,a.high=b+D+(C>>>0<O>>>0?1:0),x=s.low=x+N,s.high=S+U+(x>>>0<N>>>0?1:0),k=u.low=k+$,u.high=E+j+(k>>>0<$>>>0?1:0),w=d.low=w+H,d.high=R+B+(w>>>0<H>>>0?1:0),I=g.low=I+X,g.high=P+W+(I>>>0<X>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(u),e.HmacSHA512=t._createHmacHelper(u)}(),n.SHA512)}),hmac=createCommonjsModule(function(e,t){var n,r,o,i,a,s;e.exports=(r=(n=core).lib,o=r.Base,i=n.enc,a=i.Utf8,s=n.algo,void(s.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),s=o.words,c=i.words,l=0;l<n;l++)s[l]^=1549556828,c[l]^=909522486;o.sigBytes=i.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var r=t.finalize(this._oKey.clone().concat(n));return r}})))}),hmacSha512=createCommonjsModule(function(e,t){e.exports=core.HmacSHA512});function computeHmac(e,t,n){var r="object"===(void 0===e?"undefined":_typeof(e))?JSON.stringify(e):e;return recognizerLogger.debug("The HmacSHA512 function is loaded",hmacSha512),new hmacSha512(r,t+n).toString(encHex)}function parse(e){var t=void 0;try{t=JSON.parse(e.responseText)}catch(n){t=e.responseText}return t}function transformRequest(e){var t=[];return Object.keys(e).forEach(function(n){void 0!==e[n]&&"function"!=typeof e[n]&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}),t.join("&")}function xhr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments[4],i=arguments[5],a=r.editor.configuration,s=r;return new Promise(function(r,c){var l=new XMLHttpRequest;if(l.open(e,t,!0),l.withCredentials=!0,"V3"===o)l.setRequestHeader("Accept","application/json"),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");else if("V4"===o){switch(a.recognitionParams.type){case"TEXT":case"MATH":case"DIAGRAM":case"Raw Content":l.setRequestHeader("Accept","application/json,"+i)}l.setRequestHeader("applicationKey",a.recognitionParams.server.applicationKey),l.setRequestHeader("hmac",computeHmac(JSON.stringify(n),a.recognitionParams.server.applicationKey,a.recognitionParams.server.hmacKey)),l.setRequestHeader("Content-Type","application/json")}var u=i&&("application/vnd.openxmlformats-officedocument.presentationml.presentation"===i||i.startsWith("image/png")||i.startsWith("image/jpeg"));u&&(l.responseType="blob"),l.onerror=function(){c({msg:"Could not connect to "+t+" connection error",recoverable:!1})},l.onload=function(){l.status>=200&&l.status<300?r(u?l.response:parse(l)):c(new Error(l.responseText))},l.onreadystatechange=function(){4===l.readyState&&l.status>=200&&l.status<300&&r(u?l.response:parse(l))},s&&(s.idle=!1),"V4"===o?l.send(JSON.stringify(n)):l.send(n?transformRequest(n):void 0)}).then(function(e){return s&&(s.idle=!0),e})}function post(e,t,n,r,o){return xhr("POST",t,n,e,r,o)}function createEmptyRecognizerContext(e){var t=Date.now();return recognizerLogger.info("Create empty recognizer context with ID: "+t),{id:t,editor:e,recognitionContexts:[],initPromise:void 0,lastPositions:{lastSentPosition:-1,lastReceivedPosition:-1},url:void 0,websocket:void 0,websocketCallback:void 0,reconnect:void 0,currentReconnectionCount:0,sessionId:void 0,contentPartCount:0,currentPartId:void 0,instanceId:void 0,canUndo:!1,canRedo:!1,isEmpty:void 0,supportedImportMimeTypes:[],undoStackIndex:0,possibleUndoCount:0,idle:!0,initialized:!1}}function isResetRequired(e,t){return!!e.lastPositions&&e.lastPositions.lastSentPosition>=t.rawStrokes.length-1}function updateRecognitionPositions(e,t){var n=e;return t&&(n.lastPositions.lastSentPosition=t.lastSentPosition,n.lastPositions.lastReceivedPosition=t.lastReceivedPosition),n.lastPositions.lastSentPosition===n.lastPositions.lastReceivedPosition===-1&&delete n.instanceId,n}function setRecognitionContext(e,t){var n=e;return n.recognitionContexts[0]=t,n}function canReconnect(e){return!0===e.websocket.autoReconnect&&e.currentReconnectionCount<=e.websocket.maxRetryCount}function shouldAttemptImmediateReconnect(e){var t=e;return!0===t.websocket.autoReconnect&&t.currentReconnectionCount++<=t.websocket.maxRetryCount}var LOST_CONNEXION_MESSAGE={type:"LOST_CONNECTION"},CLOSE_RECOGNIZER_MESSAGE="CLOSE_RECOGNIZER",RecognizerContext=Object.freeze({createEmptyRecognizerContext:createEmptyRecognizerContext,isResetRequired:isResetRequired,updateRecognitionPositions:updateRecognitionPositions,setRecognitionContext:setRecognitionContext,canReconnect:canReconnect,shouldAttemptImmediateReconnect:shouldAttemptImmediateReconnect,LOST_CONNEXION_MESSAGE:LOST_CONNEXION_MESSAGE,CLOSE_RECOGNIZER_MESSAGE:CLOSE_RECOGNIZER_MESSAGE});function postMessage(e,t,n,r){var o=t.editor.configuration;return post(t,o.recognitionParams.server.scheme+"://"+o.recognitionParams.server.host+e,r(t,n),"V3").then(function(e){recognizerLogger.debug("Cdkv3RestRecognizer success",e);var n=t.lastPositions;n.lastReceivedPosition=n.lastSentPosition;var r=updateRecognitionPositions(t,n);return e.instanceId&&(r.instanceId=e.instanceId),e})}function extractExports(e){return e.rawResults&&e.rawResults.exports&&e.rawResults.exports.result&&e.rawResults.exports.result.textSegmentResult&&e.rawResults.exports.result.textSegmentResult.candidates?{CANDIDATES:e.rawResults.exports.result,TEXT:e.rawResults.exports.result.textSegmentResult.candidates[e.rawResults.exports.result.textSegmentResult.selectedCandidateIdx].label}:{}}function init(e,t,n){var r=resetModelPositions(t);recognizerLogger.debug("Updated model",r);var o=updateRecognitionPositions(e,r.lastPositions);o.initPromise=Promise.resolve(r),o.initPromise.then(function(e){o.initialized=!0,recognizerLogger.debug("Updated recognizer context",o),n(void 0,e,Constants.EventType.LOADED)})}function reset(e,t,n){var r=resetModelPositions(t);recognizerLogger.debug("Updated model",r);var o=updateRecognitionPositions(e,r.lastPositions);delete o.instanceId,recognizerLogger.debug("Updated recognizer context",o),n(void 0,r)}function clear(e,t,n){var r=clearModel(t);recognizerLogger.debug("Updated model",r);var o=updateRecognitionPositions(e,r.lastPositions);delete o.instanceId,recognizerLogger.debug("Updated recognizer context",o),n(void 0,r,Constants.EventType.CHANGED,Constants.EventType.EXPORTED,Constants.EventType.RENDERED)}function close(e,t,n){var r=e;r.initialized=!1,delete r.instanceId,n(void 0,t)}var textRestV3Configuration={types:[Constants.RecognitionType.TEXT],protocol:Constants.Protocol.REST,apiVersion:"V3",availableTriggers:{exportContent:[Constants.Trigger.QUIET_PERIOD,Constants.Trigger.DEMAND]}};function getInfo$4(){return textRestV3Configuration}function buildInput(e,t){var n=e.editor.configuration,r={inputUnits:[{textInputType:"MULTI_LINE_TEXT",components:t.rawStrokes.map(function(e){return toJSON$2(e)})}]};Object.assign(r,{textParameter:n.recognitionParams.v3.textParameter}),recognizerLogger.debug("input.inputUnits[0].components size is "+r.inputUnits[0].components.length);var o={instanceId:e?e.instanceId:void 0,applicationKey:n.recognitionParams.server.applicationKey,textInput:JSON.stringify(r)};return n.recognitionParams.server.hmacKey&&(o.hmac=computeHmac(o.textInput,n.recognitionParams.server.applicationKey,n.recognitionParams.server.hmacKey)),updateModelSentPosition(t),o}function resultCallback(e,t,n){recognizerLogger.debug("Cdkv3RestTextRecognizer result callback",e);var r=updateModelReceivedPosition(e);r.rawResults.exports=t,r.exports=extractExports(e),recognizerLogger.debug("Cdkv3RestTextRecognizer model updated",r),n(void 0,r,Constants.EventType.EXPORTED,Constants.EventType.IDLE)}function export_(e,t,n){postMessage("/api/v3.0/recognition/rest/text/doSimpleRecognition.json",e,t,buildInput).then(function(e){return resultCallback(t,e,n)}).catch(function(e){return n(e,t)})}var Cdkv3RestTextRecognizer=Object.freeze({textRestV3Configuration:textRestV3Configuration,getInfo:getInfo$4,buildInput:buildInput,export_:export_,init:init,close:close,clear:clear,reset:reset});function extractExports$1(e){return e.rawResults&&e.rawResults.exports&&e.rawResults.exports.result&&e.rawResults.exports.result.results&&e.rawResults.exports.result.results.length>0?e.rawResults.exports.result.results.map(function(e){var t={};return Object.keys(e).includes("root")?t[""+e.type]=e.root:t[""+e.type]=e.value,t}).reduce(function(e,t){return Object.assign(e,t)},{}):{}}function extractRecognizedSymbols(e){var t=[].concat(toConsumableArray(e.rawStrokes));if(e.rawResults&&e.rawResults.exports&&e.rawResults.exports.result&&e.rawResults.exports.result.scratchOutResults&&e.rawResults.exports.result.scratchOutResults.length>0){var n=e.rawResults.exports.result.scratchOutResults.map(function(e){return e.erasedInkRanges.concat(e.inkRanges)}).reduce(function(e,t){return e.concat(t)});return t.filter(function(e,t){return!n.find(function(e){return e.component===t})})}return t}var mathRestV3Configuration={types:[Constants.RecognitionType.MATH],protocol:Constants.Protocol.REST,apiVersion:"V3",availableTriggers:{exportContent:[Constants.Trigger.QUIET_PERIOD,Constants.Trigger.DEMAND]}};function getInfo$5(){return mathRestV3Configuration}function buildInput$1(e,t){var n=e.editor.configuration,r={components:t.rawStrokes.map(function(e){return toJSON$2(e)})};Object.assign(r,n.recognitionParams.v3.mathParameter),recognizerLogger.debug("input.components size is "+r.components.length);var o={instanceId:e?e.instanceId:void 0,applicationKey:n.recognitionParams.server.applicationKey,mathInput:JSON.stringify(r)};return n.recognitionParams.server.hmacKey&&(o.hmac=computeHmac(o.mathInput,n.recognitionParams.server.applicationKey,n.recognitionParams.server.hmacKey)),updateModelSentPosition(t),o}function resultCallback$1(e,t,n){recognizerLogger.debug("Cdkv3RestMathRecognizer result callback",e);var r=updateModelReceivedPosition(e);r.rawResults.exports=t,r.recognizedSymbols=extractRecognizedSymbols(e),r.exports=extractExports$1(e),recognizerLogger.debug("Cdkv3RestMathRecognizer model updated",r),n(void 0,r,Constants.EventType.EXPORTED,Constants.EventType.IDLE)}function export_$1(e,t,n){return postMessage("/api/v3.0/recognition/rest/math/doSimpleRecognition.json",e,t,buildInput$1).then(function(e){return resultCallback$1(t,e,n)}).catch(function(e){return n(e,t)})}var Cdkv3RestMathRecognizer=Object.freeze({mathRestV3Configuration:mathRestV3Configuration,getInfo:getInfo$5,export_:export_$1,init:init,close:close,clear:clear,reset:reset});function getStyleFromInkRanges(e,t){var n=e.rawStrokes;return t&&t.length>0&&(n=t.map(function(t){return extractStrokesFromInkRange(e,t.stroke?t.stroke:t.firstStroke,t.stroke?t.stroke:t.lastStroke,t.firstPoint,t.lastPoint)}).reduce(function(e,t){return e.concat(t)})),{color:n[0].color,width:n[0].width}}function extractShapeSymbols(e,t){if(t.candidates&&t.candidates.length>0){var n=t.candidates[t.selectedCandidateIndex];switch(n.type){case"notRecognized":return t.inkRanges&&t.inkRanges.length>0?t.inkRanges.map(function(t){return extractStrokesFromInkRange(e,t.firstStroke,t.lastStroke,t.firstPoint,t.lastPoint)}).reduce(function(e,t){return e.concat(t)}):[];case"recognizedShape":return n.primitives;default:return[]}}return[]}function extractRecognizedSymbols$1(e){return e.rawResults&&e.rawResults.exports&&e.rawResults.exports.result&&e.rawResults.exports.result.segments?e.rawResults.exports.result.segments.map(function(t){var n=getStyleFromInkRanges(e,t.inkRanges);return extractShapeSymbols(e,t).map(function(e){return Object.assign(e,n)})}).reduce(function(e,t){return e.concat(t)}):[]}function extractExports$2(e){return e.rawResults&&e.rawResults.exports&&e.rawResults.exports.result&&e.rawResults.exports.result.segments?{SEGMENTS:e.rawResults.exports.result.segments}:{}}var analyzerRestV3Configuration={types:[Constants.RecognitionType.ANALYZER],protocol:Constants.Protocol.REST,apiVersion:"V3",availableTriggers:{exportContent:[Constants.Trigger.QUIET_PERIOD,Constants.Trigger.DEMAND]}};function getInfo$6(){return analyzerRestV3Configuration}function buildInput$2(e,t){var n=e.editor.configuration,r={components:t.rawStrokes.map(function(e){return toJSON$2(e)})};Object.assign(r,{parameter:n.recognitionParams.v3.analyzerParameter}),recognizerLogger.debug("input.components size is "+r.components.length);var o={instanceId:e?e.instanceId:void 0,applicationKey:n.recognitionParams.server.applicationKey,analyzerInput:JSON.stringify(r)};return n.recognitionParams.server.hmacKey&&(o.hmac=computeHmac(o.analyzerInput,n.recognitionParams.server.applicationKey,n.recognitionParams.server.hmacKey)),updateModelSentPosition(t),o}function extractSymbols(e,t){var n=getStyleFromInkRanges(e,t.inkRanges);switch(t.elementType){case"table":return t.lines.map(function(e){return Object.assign(e,n)});case"textLine":return[t].map(function(e){return Object.assign(e,e.result.textSegmentResult.candidates[e.result.textSegmentResult.selectedCandidateIdx],n)});case"shape":return extractShapeSymbols(e,t).map(function(e){return Object.assign(e,n)});default:return[]}}function extractRecognizedSymbolsFromAnalyzerResult(e){return e.rawResults&&e.rawResults.exports&&e.rawResults.exports.result?[].concat(toConsumableArray(e.rawResults.exports.result.shapes),toConsumableArray(e.rawResults.exports.result.tables),toConsumableArray(e.rawResults.exports.result.textLines)).map(function(t){return extractSymbols(e,t)}).reduce(function(e,t){return e.concat(t)}):[]}function extractExports$3(e){return e.rawResults&&e.rawResults.exports&&e.rawResults.exports.result?{ANALYSIS:e.rawResults.exports.result}:{}}function resultCallback$2(e,t,n){recognizerLogger.debug("Cdkv3RestAnalyzerRecognizer result callback",e);var r=updateModelReceivedPosition(e);r.rawResults.exports=t,r.recognizedSymbols=extractRecognizedSymbolsFromAnalyzerResult(e),r.exports=extractExports$3(e),recognizerLogger.debug("Cdkv3RestAnalyzerRecognizer model updated",r),n(void 0,r,Constants.EventType.EXPORTED,Constants.EventType.CONVERTED,Constants.EventType.IDLE)}function export_$2(e,t,n){return postMessage("/api/v3.0/recognition/rest/analyzer/doSimpleRecognition.json",e,t,buildInput$2).then(function(e){return resultCallback$2(t,e,n)}).catch(function(e){return n(e,t)})}var Cdkv3RestAnalyzerRecognizer=Object.freeze({analyzerRestV3Configuration:analyzerRestV3Configuration,getInfo:getInfo$6,export_:export_$2,init:init,close:close,clear:clear,reset:reset}),shapeRestV3Configuration={types:[Constants.RecognitionType.SHAPE],protocol:Constants.Protocol.REST,apiVersion:"V3",availableTriggers:{exportContent:[Constants.Trigger.QUIET_PERIOD,Constants.Trigger.DEMAND]}};function getInfo$7(){return shapeRestV3Configuration}function buildInput$3(e,t){var n=e.editor.configuration,r={components:extractPendingStrokes(t).map(function(e){return toJSON$2(e)})};Object.assign(r,n.recognitionParams.v3.shapeParameter),recognizerLogger.debug("input.components size is "+r.components.length);var o={instanceId:e?e.instanceId:void 0,applicationKey:n.recognitionParams.server.applicationKey,shapeInput:JSON.stringify(r)};return n.recognitionParams.server.hmacKey&&(o.hmac=computeHmac(o.shapeInput,n.recognitionParams.server.applicationKey,n.recognitionParams.server.hmacKey)),updateModelSentPosition(t),o}function buildReset(e,t){return{instanceSessionId:e?e.instanceId:void 0}}function resultCallback$3(e,t,n){recognizerLogger.debug("Cdkv3RestShapeRecognizer result callback",e);var r=updateModelReceivedPosition(e);r.rawResults.exports=t,r.recognizedSymbols=extractRecognizedSymbols$1(e),r.exports=extractExports$2(e),recognizerLogger.debug("Cdkv3RestShapeRecognizer model updated",r),n(void 0,r,Constants.EventType.EXPORTED,Constants.EventType.CONVERTED,Constants.EventType.IDLE)}function export_$3(e,t,n){postMessage("/api/v3.0/recognition/rest/shape/doSimpleRecognition.json",e,t,buildInput$3).then(function(e){return resultCallback$3(t,e,n)}).catch(function(e){return n(e,t)})}function reset$1(e,t,n){var r=resetModelPositions(t);postMessage("/api/v3.0/recognition/rest/shape/clearSessionId.json",e,r,buildReset).then(function(e){return n(void 0,r,Constants.EventType.IDLE)}).catch(function(e){return n(e,r)})}function clear$1(e,t,n){var r=clearModel(cloneModel(t));postMessage("/api/v3.0/recognition/rest/shape/clearSessionId.json",e,r,buildReset).then(function(e){return n(void 0,r,Constants.EventType.CHANGED,Constants.EventType.EXPORTED,Constants.EventType.CONVERTED,Constants.EventType.IDLE)}).catch(function(e){return n(e,r)})}var Cdkv3RestShapeRecognizer=Object.freeze({shapeRestV3Configuration:shapeRestV3Configuration,getInfo:getInfo$7,export_:export_$3,reset:reset$1,clear:clear$1,init:init,close:close}),musicRestV3Configuration={types:[Constants.RecognitionType.MUSIC],protocol:Constants.Protocol.REST,apiVersion:"V3",availableTriggers:{exportContent:[Constants.Trigger.QUIET_PERIOD,Constants.Trigger.DEMAND]}};function getInfo$8(){return musicRestV3Configuration}function buildInput$4(e,t){var n=e.editor.configuration,r={components:[].concat(t.defaultSymbols,t.rawStrokes).filter(function(e){return"staff"!==e.type}).map(function(e){return"stroke"===e.type?toJSON$2(e):e})},o=Object.assign({},n.recognitionParams.v3.musicParameter);delete o.clef,Object.assign(r,o),recognizerLogger.debug("input.components size is "+r.components.length);var i={instanceId:e?e.instanceId:void 0,applicationKey:n.recognitionParams.server.applicationKey,musicInput:JSON.stringify(r)};return n.recognitionParams.server.hmacKey&&(i.hmac=computeHmac(i.musicInput,n.recognitionParams.server.applicationKey,n.recognitionParams.server.hmacKey)),updateModelSentPosition(t),i}function resultCallback$4(e,t,n){recognizerLogger.debug("Cdkv3RestMusicRecognizer result callback",e);var r=updateModelReceivedPosition(e);r.rawResults.exports=t,r.exports=extractExports$1(e),recognizerLogger.debug("Cdkv3RestMusicRecognizer model updated",r),n(void 0,r,Constants.EventType.EXPORTED,Constants.EventType.IDLE)}function init$1(e,t,n){var r=resetModelPositions(t);recognizerLogger.debug("Updated model",r);var o=updateRecognitionPositions(e,r.lastPositions);o.initPromise=Promise.resolve(r),o.initPromise.then(function(e){o.initialized=!0,recognizerLogger.debug("Updated recognizer context",o),n(void 0,e,Constants.EventType.LOADED,Constants.EventType.RENDERED)})}function export_$4(e,t,n){postMessage("/api/v3.0/recognition/rest/music/doSimpleRecognition.json",e,t,buildInput$4).then(function(e){return resultCallback$4(t,e,n)}).catch(function(e){return n(e,t)})}var Cdkv3RestMusicRecognizer=Object.freeze({musicRestV3Configuration:musicRestV3Configuration,getInfo:getInfo$8,init:init$1,export_:export_$4,close:close,clear:clear,reset:reset}),iinkRestConfiguration={types:[Constants.RecognitionType.TEXT,Constants.RecognitionType.DIAGRAM,Constants.RecognitionType.MATH,Constants.RecognitionType.RAWCONTENT],protocol:Constants.Protocol.REST,apiVersion:"V4",availableTriggers:{exportContent:[Constants.Trigger.QUIET_PERIOD,Constants.Trigger.DEMAND]}};function getInfo$9(){return iinkRestConfiguration}function postMessage$1(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments[5],a=t.editor.configuration;return post(t,a.recognitionParams.server.scheme+"://"+a.recognitionParams.server.host+e,r(t,n,o),"V4",i).then(function(e){recognizerLogger.debug("iinkRestRecognizer success",e);var n=t.lastPositions;n.lastReceivedPosition=n.lastSentPosition;var r=updateRecognitionPositions(t,n);return e.instanceId&&(r.instanceId=e.instanceId),e})}function buildTextConf(e){return{text:e.recognitionParams.v4.text,lang:e.recognitionParams.v4.lang,export:e.recognitionParams.v4.export}}function buildMathConf(e){return{math:e.recognitionParams.v4.math,lang:e.recognitionParams.v4.lang,export:e.recognitionParams.v4.export}}function buildDiagramConf(e){return{diagram:e.recognitionParams.v4.diagram,lang:e.recognitionParams.v4.lang,export:e.recognitionParams.v4.export}}function buildRawContentConf(e){return{"raw-content":{recognition:e.recognitionParams.v4["raw-content"].recognition},lang:e.recognitionParams.v4.lang,export:e.recognitionParams.v4.export}}function buildData(e,t,n){var r=e.editor.configuration,o=void 0;"TEXT"===r.recognitionParams.type?o=buildTextConf(r):"MATH"===r.recognitionParams.type?o=buildMathConf(r):"DIAGRAM"===r.recognitionParams.type?o=buildDiagramConf(r):"Raw Content"===r.recognitionParams.type&&(o=buildRawContentConf(r));var i=[];t.strokeGroups.forEach(function(e){var t={penStyle:"{}"===JSON.stringify(e.penStyle)?null:toCSS(e.penStyle),strokes:e.strokes.map(function(e){return toJSONV4(e)})};i.push(t)});var a={configuration:o,xDPI:96,yDPI:96,contentType:"Raw Content"===r.recognitionParams.type?"Raw Content":r.recognitionParams.type.charAt(0).toUpperCase()+r.recognitionParams.type.slice(1).toLowerCase(),theme:toCSS$1(e.editor.theme),strokeGroups:i};return e.editor.domElement&&(a.height=e.editor.domElement.clientHeight,a.width=e.editor.domElement.clientWidth),n&&(a.conversionState="DIGITAL_EDIT"),updateModelSentPosition(t),a}function extractExports$4(e,t,n){var r={};return r[t]=n,r}function resultCallback$5(e,t,n,r,o){recognizerLogger.debug("iinkRestRecognizer result callback",e);var i=updateModelReceivedPosition(e);i.rawResults.exports=n,i.exports?Object.assign(i.exports,extractExports$4(t,r,n)):i.exports=extractExports$4(t,r,n),recognizerLogger.debug("iinkRestRecognizer model updated",i),o(void 0,i,Constants.EventType.EXPORTED,Constants.EventType.IDLE)}function export_$5(e,t,n,r){var o=e.editor.configuration;function i(r){postMessage$1("/api/v4.0/iink/batch",e,t,buildData,o.restConversionState,r).then(function(e){resultCallback$5(t,o,e,r,n)}).catch(function(e){n(e,t)})}r?r.forEach(function(e){i(e)}):"TEXT"===o.recognitionParams.type?o.recognitionParams.v4.text.mimeTypes.forEach(function(e){i(e)}):"DIAGRAM"===o.recognitionParams.type?o.recognitionParams.v4.diagram.mimeTypes.forEach(function(e){i(e)}):"MATH"===o.recognitionParams.type?o.recognitionParams.v4.math.mimeTypes.forEach(function(e){i(e)}):"Raw Content"===o.recognitionParams.type&&o.recognitionParams.v4["raw-content"].mimeTypes.forEach(function(e){i(e)})}function convert(e,t,n){var r=e.editor.configuration;postMessage$1("/api/v4.0/iink/batch",e,t,buildData,"DIGITAL_EDIT").then(function(e){return resultCallback$5(t,r,e,n)}).catch(function(e){return n(e,t)})}var iinkRestRecognizer=Object.freeze({iinkRestConfiguration:iinkRestConfiguration,getInfo:getInfo$9,postMessage:postMessage$1,export_:export_$5,convert:convert,init:init,close:close,clear:clear,reset:reset});function infinitePing(e){var t=e;t.pingLostCount++,t.pingLostCount>t.maxPingLost?e.close(1e3,"PING_LOST"):t.readyState<=1&&setTimeout(function(){t.readyState<=1&&(t.send(JSON.stringify({type:"ping"})),infinitePing(t))},t.pingDelay)}function addWebsocketAttributes(e,t){var n=t.editor.configuration.recognitionParams.server.websocket,r=e;r.start=new Date,r.autoReconnect=n.autoReconnect,r.maxRetryCount=n.maxRetryCount,r.pingEnabled=n.pingEnabled,r.pingDelay=n.pingDelay,r.maxPingLost=n.maxPingLostCount,r.pingLostCount=0,r.recognizerContext=t}function openWebSocket(e){var t=void 0;try{t=new WebSocket(e.url)}catch(e){recognizerLogger.error("Unable to open websocket, Check the host and your connectivity")}return addWebsocketAttributes(t,e),t.pingEnabled&&infinitePing(t),t.onopen=function(t){recognizerLogger.trace("onOpen"),e.websocketCallback(t)},t.onclose=function(n){recognizerLogger.trace("onClose",new Date-t.start),e.websocketCallback(n)},t.onerror=function(t){recognizerLogger.trace("onError"),e.websocketCallback(t)},t.onmessage=function(n){if(recognizerLogger.trace("onMessage"),t.pingLostCount=0,"pong"!==JSON.parse(n.data).type){var r={type:n.type,data:JSON.parse(n.data)};e.websocketCallback(r)}},t}function send(e,t){var n=e;n.idle=!1;var r=n.websocket;if(!(r.readyState<=1))throw LOST_CONNEXION_MESSAGE;r.send(JSON.stringify(t)),recognizerLogger.debug(t.type+" message sent",t)}function close$1(e,t,n){var r=e.websocket;r&&r.readyState<2&&r.close(t,n)}function buildHmacMessage(e,t){return{type:"hmac",applicationKey:e.recognitionParams.server.applicationKey,challenge:t.data.challenge,hmac:computeHmac(t.data.challenge,e.recognitionParams.server.applicationKey,e.recognitionParams.server.hmacKey)}}function buildInitMessage(e){return{type:"applicationKey",applicationKey:e.recognitionParams.server.applicationKey}}function buildWebSocketCallback(e,t){return function(n){var r=t;recognizerLogger.trace(n.type+" websocket callback",n);var o=t.recognitionContexts[t.recognitionContexts.length-1];switch(recognizerLogger.debug("Current recognition context",o),n.type){case"open":send(t,buildInitMessage(t.editor.configuration));break;case"message":switch(recognizerLogger.trace("Receiving message",n.data.type),n.data.type){case"hmacChallenge":send(t,buildHmacMessage(t.editor.configuration,n));break;case"init":r.currentReconnectionCount=0,r.idle=!0,r.initialized=!0,o.callback(void 0,n.data),e.resolve(o);break;case"reset":r.idle=!0,o.callback(void 0,n.data);break;case"mathResult":case"textResult":r.idle=!0,n.data.instanceId&&(t.instanceId&&t.instanceId!==n.data.instanceId&&recognizerLogger.debug("Instance id switch from "+t.instanceId+" to "+n.data.instanceId+" this is suspicious"),r.instanceId=n.data.instanceId,recognizerLogger.debug("Memorizing instance id",n.data.instanceId)),o.callback(void 0,n.data);break;case"error":recognizerLogger.debug("Error detected stopping all recognition",n),o?o.callback(n.data):e.reject(Object.assign({},n.data,{recoverable:!1}));break;default:recognizerLogger.warn("This is something unexpected in current recognizer. Not the type of message we should have here.",n)}break;case"error":recognizerLogger.debug("Error detected stopping all recognition",n),o?o.callback(Object.assign({},n,{recoverable:!1})):e.reject(Object.assign({},n,{recoverable:!1}));break;case"close":recognizerLogger.debug("Close detected stopping all recognition",n),r.initialized=!1,o?o.callback(void 0,n):e.reject(n);break;default:recognizerLogger.warn("This is something unexpected in current recognizer. Not the type of message we should have here.",n)}}}function destructurePromise(){var e=void 0,t=void 0;return{promise:new Promise(function(n,r){e=n,t=r}),resolve:e,reject:t}}function buildUrl(e,t){return("https"===e.recognitionParams.server.scheme?"wss":"ws")+"://"+e.recognitionParams.server.host+t}var commonCallback=function(e,t,n,r){return n&&"close"===n.type?r(t,e,Constants.EventType.CHANGED):r(t,e)};function init$2(e,t,n,r){var o=updateRecognitionPositions(t,t.recognitionContexts[0].model.lastPositions);o.url=buildUrl(t.editor.configuration,e),o.reconnect=r;var i=destructurePromise();return o.initPromise=i.promise,recognizerLogger.debug("Opening the websocket for context ",t),o.websocketCallback=n(i,o),o.websocket=openWebSocket(o),o.initPromise.then(function(e){return recognizerLogger.debug("Init over",e),e})}function retry(e,t,n,r){for(var o=arguments.length,i=Array(o>4?o-4:0),a=4;a<o;a++)i[a-4]=arguments[a];shouldAttemptImmediateReconnect(t)&&t.reconnect?(recognizerLogger.info("Attempting a retry",t.currentReconnectionCount),t.reconnect(t,n,function(o,a){o?(recognizerLogger.error("Failed retry",o),retry.apply(void 0,[e,t,n,r].concat(i))):e.apply(void 0,[t,a,r].concat(i))})):r("Unable to reconnect",n)}function sendMessage(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.initPromise.then(function(){recognizerLogger.trace("Init was done. Sending message");var n=t.apply(void 0,r);if(n){send(e,n);var o=e.recognitionContexts[0].model.lastPositions;o&&updateRecognitionPositions(e,o)}else recognizerLogger.warn("empty message")})}function close$2(e,t,n){var r={model:t,callback:function(e,r){return commonCallback(t,e,r,n)}},o=e;e.initPromise.then(function(){return o.recognitionContexts[0]=r,o}).then(function(e){return close$1(e,1e3,CLOSE_RECOGNIZER_MESSAGE)})}var mathWebSocketV3Configuration={types:[Constants.RecognitionType.MATH],protocol:Constants.Protocol.WEBSOCKET,apiVersion:"V3",availableTriggers:{exportContent:[Constants.Trigger.POINTER_UP]}};function getInfo$a(){return mathWebSocketV3Configuration}function buildMathInput(e,t){return updateModelSentPosition(t),e.lastPositions.lastSentPosition<0?{type:"start",parameters:e.editor.configuration.recognitionParams.v3.mathParameter,components:t.rawStrokes.map(function(e){return toJSON$2(e)})}:{type:"continue",components:extractPendingStrokes(t,-1).map(function(e){return toJSON$2(e)})}}function buildResetMessage(e){return resetModelPositions(e),{type:"reset"}}var mathCallback=function(e,t,n,r){if(n){if("init"===n.type)return r(t,e,Constants.EventType.LOADED,Constants.EventType.IDLE);if("close"===n.type)return r(t,e,Constants.EventType.CHANGED);var o=updateModelReceivedPosition(e);return o.rawResults.exports=n,o.exports=extractExports$1(o),o.recognizedSymbols=extractRecognizedSymbols(o),r(t,o,Constants.EventType.EXPORTED,Constants.EventType.IDLE)}return r(t,e)};function init$3(e,t,n){init$2("/api/v3.0/recognition/ws/math",setRecognitionContext(e,{model:resetModelPositions(t),callback:function(e,r){return mathCallback(t,e,r,n)}}),buildWebSocketCallback,init$3).catch(function(r){shouldAttemptImmediateReconnect(e)&&e.reconnect?(recognizerLogger.info("Attempting a reconnect",e.currentReconnectionCount),e.reconnect(e,t,n)):(recognizerLogger.error("Unable to init",r),n(r,t))})}function export_$6(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return mathCallback(t,e,r,n)}}),buildMathInput,e,t).catch(function(r){return retry(export_$6,e,t,n)})}function reset$2(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return mathCallback(t,e,r,n)}}),buildResetMessage,t).catch(function(r){return retry(reset$2,e,t,n)})}function clear$3(e,t,n){clear(e,t,function(t,r){for(var o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];reset$2(e,r,function(e,t){return recognizerLogger.trace("Session reset")}),n.apply(void 0,[t,r].concat(i))})}var Cdkv3WSMathRecognizer=Object.freeze({init:init$3,export_:export_$6,reset:reset$2,mathWebSocketV3Configuration:mathWebSocketV3Configuration,getInfo:getInfo$a,clear:clear$3,close:close$2}),textWebSocketV3Configuration={types:[Constants.RecognitionType.TEXT],protocol:Constants.Protocol.WEBSOCKET,apiVersion:"V3",availableTriggers:{exportContent:[Constants.Trigger.POINTER_UP]}};function getInfo$b(){return textWebSocketV3Configuration}function buildTextInput(e,t){return updateModelSentPosition(t),e.lastPositions.lastSentPosition<0?{type:"start",textParameter:e.editor.configuration.recognitionParams.v3.textParameter,inputUnits:[{textInputType:"MULTI_LINE_TEXT",components:t.rawStrokes.map(function(e){return toJSON$2(e)})}]}:{type:"continue",inputUnits:[{textInputType:"MULTI_LINE_TEXT",components:extractPendingStrokes(t,-1).map(function(e){return toJSON$2(e)})}]}}function buildResetMessage$1(e){return resetModelPositions(e),{type:"reset"}}var textCallback=function(e,t,n,r){if(n){if("init"===n.type)return r(t,e,Constants.EventType.LOADED,Constants.EventType.IDLE);if("close"===n.type)return r(t,e,Constants.EventType.CHANGED);var o=updateModelReceivedPosition(e);return o.rawResults.exports=n,o.exports=extractExports(e),r(t,o,Constants.EventType.EXPORTED,Constants.EventType.IDLE)}return r(t,e)};function init$4(e,t,n){init$2("/api/v3.0/recognition/ws/text",setRecognitionContext(e,{model:resetModelPositions(t),callback:function(e,r){return textCallback(t,e,r,n)}}),buildWebSocketCallback,init$4).catch(function(r){shouldAttemptImmediateReconnect(e)&&e.reconnect?(recognizerLogger.info("Attempting a reconnect",e.currentReconnectionCount),e.reconnect(e,t,n)):(recognizerLogger.error("Unable to init",r),n(r,t))})}function export_$7(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return textCallback(t,e,r,n)}}),buildTextInput,e,t).catch(function(r){return retry(export_$7,e,t,n)})}function reset$3(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return textCallback(t,e,r,n)}}),buildResetMessage$1,t).catch(function(r){return retry(reset$3,e,t,n)})}function clear$4(e,t,n){clear(e,t,function(t,r){for(var o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];reset$3(e,r,function(e,t){return recognizerLogger.trace("Session reset")}),n.apply(void 0,[t,r].concat(i))})}var Cdkv3WSTextRecognizer=Object.freeze({init:init$4,export_:export_$7,reset:reset$3,textWebSocketV3Configuration:textWebSocketV3Configuration,getInfo:getInfo$b,clear:clear$4,close:close$2});function UUIDjs(){}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}UUIDjs.maxFromBits=function(e){return Math.pow(2,e)},UUIDjs.limitUI04=UUIDjs.maxFromBits(4),UUIDjs.limitUI06=UUIDjs.maxFromBits(6),UUIDjs.limitUI08=UUIDjs.maxFromBits(8),UUIDjs.limitUI12=UUIDjs.maxFromBits(12),UUIDjs.limitUI14=UUIDjs.maxFromBits(14),UUIDjs.limitUI16=UUIDjs.maxFromBits(16),UUIDjs.limitUI32=UUIDjs.maxFromBits(32),UUIDjs.limitUI40=UUIDjs.maxFromBits(40),UUIDjs.limitUI48=UUIDjs.maxFromBits(48),UUIDjs.randomUI04=function(){return getRandomInt(0,UUIDjs.limitUI04-1)},UUIDjs.randomUI06=function(){return getRandomInt(0,UUIDjs.limitUI06-1)},UUIDjs.randomUI08=function(){return getRandomInt(0,UUIDjs.limitUI08-1)},UUIDjs.randomUI12=function(){return getRandomInt(0,UUIDjs.limitUI12-1)},UUIDjs.randomUI14=function(){return getRandomInt(0,UUIDjs.limitUI14-1)},UUIDjs.randomUI16=function(){return getRandomInt(0,UUIDjs.limitUI16-1)},UUIDjs.randomUI32=function(){return getRandomInt(0,UUIDjs.limitUI32-1)},UUIDjs.randomUI40=function(){return(0|Math.random()*(1<<30))+(0|1024*Math.random())*(1<<30)},UUIDjs.randomUI48=function(){return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<18))*(1<<30)},UUIDjs.paddedString=function(e,t,n){n=n||"0";for(var r=t-(e=String(e)).length;r>0;r>>>=1,n+=n)1&r&&(e=n+e);return e},UUIDjs.prototype.fromParts=function(e,t,n,r,o,i){return this.version=n>>12&15,this.hex=UUIDjs.paddedString(e.toString(16),8)+"-"+UUIDjs.paddedString(t.toString(16),4)+"-"+UUIDjs.paddedString(n.toString(16),4)+"-"+UUIDjs.paddedString(r.toString(16),2)+UUIDjs.paddedString(o.toString(16),2)+"-"+UUIDjs.paddedString(i.toString(16),12),this},UUIDjs.prototype.toString=function(){return this.hex},UUIDjs.prototype.toURN=function(){return"urn:uuid:"+this.hex},UUIDjs.prototype.toBytes=function(){for(var e=this.hex.split("-"),t=[],n=0,r=0;r<e.length;r++)for(var o=0;o<e[r].length;o+=2)t[n++]=parseInt(e[r].substr(o,2),16);return t},UUIDjs.prototype.equals=function(e){return e instanceof UUID&&this.hex===e.hex},UUIDjs.getTimeFieldValues=function(e){var t=e-Date.UTC(1582,9,15),n=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&n,hi:n>>>16,timestamp:t}},UUIDjs._create4=function(){return(new UUIDjs).fromParts(UUIDjs.randomUI32(),UUIDjs.randomUI16(),16384|UUIDjs.randomUI12(),128|UUIDjs.randomUI06(),UUIDjs.randomUI08(),UUIDjs.randomUI48())},UUIDjs._create1=function(){var e=(new Date).getTime(),t=UUIDjs.randomUI14(),n=1099511627776*(1|UUIDjs.randomUI08())+UUIDjs.randomUI40(),r=UUIDjs.randomUI04(),o=0;e!=o?(e<o&&t++,o=e,r=UUIDjs.randomUI04()):Math.random()<.25&&r<9984?r+=1+UUIDjs.randomUI04():t++;var i=UUIDjs.getTimeFieldValues(o),a=i.low+r,s=4095&i.hi|4096,c=(t&=16383)>>>8|128,l=255&t;return(new UUIDjs).fromParts(a,i.mid,s,c,l,n)},UUIDjs.create=function(e){return this["_create"+(e=e||4)]()},UUIDjs.fromTime=function(e,t){t=t||!1;var n=UUIDjs.getTimeFieldValues(e),r=n.low,o=4095&n.hi|4096;return!1===t?(new UUIDjs).fromParts(r,n.mid,o,0,0,0):(new UUIDjs).fromParts(r,n.mid,o,128|UUIDjs.limitUI06,UUIDjs.limitUI08-1,UUIDjs.limitUI48-1)},UUIDjs.firstFromTime=function(e){return UUIDjs.fromTime(e,!1)},UUIDjs.lastFromTime=function(e){return UUIDjs.fromTime(e,!0)},UUIDjs.fromURN=function(e){var t;return(t=/^(?:urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(?:\})?$/i.exec(e))?(new UUIDjs).fromParts(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16)):null},UUIDjs.fromBytes=function(e){if(e.length<5)return null;for(var t="",n=0,r=[4,2,2,2,6],o=0;o<r.length;o++){for(var i=0;i<r[o];i++){var a=e[n++].toString(16);1==a.length&&(a="0"+a),t+=a}6!==r[o]&&(t+="-")}return UUIDjs.fromURN(t)},UUIDjs.fromBinary=function(e){for(var t=[],n=0;n<e.length;n++)if(t[n]=e.charCodeAt(n),t[n]>255||t[n]<0)throw new Error("Unexpected byte in binary data.");return UUIDjs.fromBytes(t)},UUIDjs.new=function(){return this.create(4)},UUIDjs.newTS=function(){return this.create(1)};var uuid=UUIDjs;function buildHmacMessage$1(e,t){return{type:"hmac",hmac:computeHmac(t.data.hmacChallenge,e.recognitionParams.server.applicationKey,e.recognitionParams.server.hmacKey)}}function buildWebSocketCallback$1(e,t){return function(n){var r=t;recognizerLogger.trace(n.type+" websocket callback",n);var o=t.recognitionContexts[t.recognitionContexts.length-1];switch(recognizerLogger.debug("Current recognition context",o),n.type){case"open":t.sessionId?send(t,buildRestoreIInkSessionInput(t.editor.configuration,t.editor.domElement,t.sessionId)):send(t,buildNewContentPackageInput(t.editor.configuration,t.editor.domElement));break;case"message":switch(recognizerLogger.debug("Receiving "+n.data.type+" message",n),n.data.type){case"ack":n.data.hmacChallenge&&send(t,buildHmacMessage$1(t.editor.configuration,n)),n.data.iinkSessionId&&(r.sessionId=n.data.iinkSessionId);break;case"newPart":break;case"contentPackageDescription":r.currentReconnectionCount=0,r.contentPartCount=n.data.contentPartCount,send(t,buildConfiguration(t.editor.configuration)),r.currentPartId?send(t,buildOpenContentPart(t.editor.configuration,t.currentPartId)):send(t,buildNewContentPart(t.editor.configuration));break;case"partChanged":n.data.partId&&(r.currentPartId=n.data.partId),r.initialized=!0,send(t,buildSetTheme(t.editor.theme)),send(t,buildSetPenStyle(t.editor.penStyle)),send(t,buildSetPenStyleClasses(t.editor.penStyleClasses)),o.callback(void 0,n.data),e.resolve(o);break;case"contentChanged":void 0!==n.data.canUndo&&(r.canUndo=n.data.canUndo),void 0!==n.data.canRedo&&(r.canRedo=n.data.canRedo),void 0!==n.data.empty&&(r.isEmpty=n.data.empty),void 0!==n.data.possibleUndoCount&&(r.possibleUndoCount=n.data.possibleUndoCount),void 0!==n.data.undoStackIndex&&(r.undoStackIndex=n.data.undoStackIndex),o.callback(void 0,n.data);break;case"exported":case"svgPatch":o.callback(void 0,n.data);break;case"supportedImportMimeTypes":r.supportedImportMimeTypes=n.data.mimeTypes,o.callback(void 0,n.data);break;case"fileChunkAck":o.callback(void 0,n.data);break;case"idle":r.idle=!0,o.callback(void 0,n.data);break;case"error":recognizerLogger.debug("Error detected stopping all recognition",n),o?o.callback(n.data):e.reject(Object.assign({},n.data,{recoverable:!1}));break;default:recognizerLogger.warn("This is something unexpected in current recognizer. Not the type of message we should have here.",n)}break;case"error":recognizerLogger.debug("Error detected stopping all recognition",n),o?o.callback(Object.assign({},n,{recoverable:!1})):e.reject(Object.assign({},n,{recoverable:!1}));break;case"close":recognizerLogger.debug("Close detected stopping all recognition",n),r.initialized=!1,r.canRedo=!1,r.canUndo=!1,o?o.callback(n):e.reject(n);break;default:recognizerLogger.warn("This is something unexpected in current recognizer. Not the type of message we should have here.",n)}}}function readBlob(e){var t=this,n=new FileReader;return new Promise(function(r,o){n.onload=function(e){return r(e.target.result)},n.onerror=function(){return o(t)},n.readAsText(e)})}function getDPI(e){return 96}var IInkWebSocketV4Configuration={types:[Constants.RecognitionType.MATH,Constants.RecognitionType.TEXT,Constants.RecognitionType.DIAGRAM,Constants.RecognitionType.NEBO],protocol:Constants.Protocol.WEBSOCKET,apiVersion:"V4",availableTriggers:{exportContent:[Constants.Trigger.POINTER_UP,Constants.Trigger.DEMAND],addStrokes:[Constants.Trigger.POINTER_UP]}};function getInfo$c(){return IInkWebSocketV4Configuration}function buildNewContentPackageInput(e,t){return{type:"newContentPackage",applicationKey:e.recognitionParams.server.applicationKey,xDpi:getDPI(t),yDpi:getDPI(t),viewSizeHeight:t.clientHeight<e.renderingParams.minHeight?e.renderingParams.minHeight:t.clientHeight,viewSizeWidth:t.clientWidth<e.renderingParams.minWidth?e.renderingParams.minWidth:t.clientWidth}}function buildRestoreIInkSessionInput(e,t,n){return{type:"restoreIInkSession",iinkSessionId:n,applicationKey:e.recognitionParams.server.applicationKey,xDpi:getDPI(t),yDpi:getDPI(t),viewSizeHeight:t.clientHeight<e.renderingParams.minHeight?e.renderingParams.minHeight:t.clientHeight,viewSizeWidth:t.clientWidth<e.renderingParams.minWidth?e.renderingParams.minWidth:t.clientWidth}}function buildNewContentPart(e){return{type:"newContentPart",contentType:e.recognitionParams.type,mimeTypes:e.triggers.exportContent!==Constants.Trigger.DEMAND?e.recognitionParams.v4[""+e.recognitionParams.type.toLowerCase()].mimeTypes:void 0}}function buildOpenContentPart(e,t){return{type:"openContentPart",id:t,mimeTypes:e.triggers.exportContent!==Constants.Trigger.DEMAND?e.recognitionParams.v4[""+e.recognitionParams.type.toLowerCase()].mimeTypes:void 0}}function buildConfiguration(e){return Object.assign({type:"configuration"},e.recognitionParams.v4)}function buildAddStrokes(e,t){var n=extractPendingStrokes(t,e.lastPositions.lastSentPosition+1);if(n.length>0)return updateModelSentPosition(t),{type:"addStrokes",strokes:n.map(function(e){return Object.assign({},{id:e.id,pointerType:e.pointerType,pointerId:e.pointerId,x:e.x,y:e.y,t:e.t,p:e.p})})}}function buildUndo(){return{type:"undo"}}function buildRedo(){return{type:"redo"}}function buildClear(){return{type:"clear"}}function buildConvert(e){return{type:"convert",conversionState:e}}function buildZoom(e){return{type:"zoom",zoom:e}}function buildResize(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{type:"changeViewSize",height:e.clientHeight<t?t:e.clientHeight,width:e.clientWidth<n?n:e.clientWidth}}function buildExport(e,t,n){return{type:"export",partId:t,mimeTypes:n&&0!==Object.keys(n).length?n:e.recognitionParams.v4[""+e.recognitionParams.type.toLowerCase()].mimeTypes}}function buildImportFile(e,t){return{type:"importFile",importFileId:e,mimeType:t}}function buildImportChunk(e,t,n){return{type:"fileChunk",importFileId:e,data:t,lastChunk:n}}function buildPointerEvents(e){return Object.assign({type:"pointerEvents"},e)}function buildWaitForIdle(){return{type:"waitForIdle"}}function buildGetSupportedImportMimeTypes(){return{type:"getSupportedImportMimeTypes"}}function buildSetPenStyle(e){return{type:"setPenStyle",style:e?toCSS(e):""}}function buildSetPenStyleClasses(e){return{type:"setPenStyleClasses",styleClasses:e}}function buildSetTheme(e){return{type:"setTheme",theme:toCSS$1(e)}}var iinkCallback=function(e,t,n,r){var o=updateModelReceivedPosition(e);if(n){if(void 0!==n.updates)return o.recognizedSymbols?o.recognizedSymbols.push(n):o.recognizedSymbols=[n],r(t,o,Constants.EventType.RENDERED);if(void 0!==n.exports)return o.rawResults.exports=n,o.exports=n.exports,r(t,o,Constants.EventType.EXPORTED);if(void 0!==n.canUndo||void 0!==n.canRedo)return r(t,o,Constants.EventType.CHANGED);if("supportedImportMimeTypes"===n.type)return r(t,o,Constants.EventType.SUPPORTED_IMPORT_MIMETYPES);if("partChanged"===n.type)return r(t,o,Constants.EventType.LOADED);if("idle"===n.type)return r(t,o,Constants.EventType.IDLE);if("close"===n.type)return r(t,o,Constants.EventType.CHANGED)}return r(t,o)};function init$5(e,t,n){init$2("/api/v4.0/iink/document",setRecognitionContext(e,{model:updateModelSentPosition(t,t.lastPositions.lastReceivedPosition),callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildWebSocketCallback$1,init$5).catch(function(r){shouldAttemptImmediateReconnect(e)&&e.reconnect?(recognizerLogger.info("Attempting a reconnect",e.currentReconnectionCount),e.reconnect(e,t,n)):(recognizerLogger.error("Unable to reconnect",r),iinkCallback(t,r,void 0,n))})}function newContentPart(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildNewContentPart,e.editor.configuration).catch(function(r){return retry(newContentPart,e,t,n)})}function openContentPart(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildOpenContentPart,e.editor.configuration,e.currentPartId).catch(function(r){return retry(openContentPart,e,t,n)})}function sendConfiguration(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildConfiguration,e.editor.configuration).catch(function(r){return retry(sendConfiguration,e,t,n)})}function pointerEvents(e,t,n,r){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,n){return iinkCallback(t,e,n,r)}}),buildPointerEvents,n).catch(function(o){return retry(pointerEvents,e,t,n,r)})}function addStrokes(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildAddStrokes,e,t).catch(function(r){return retry(addStrokes,e,t,n)})}function undo(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildUndo).catch(function(r){return retry(undo,e,t,n)})}function redo(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildRedo).catch(function(r){return retry(redo,e,t,n)})}function clear$5(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(r,o){clear(e,t,function(e,t){recognizerLogger.debug("The model after clear is :",t),iinkCallback(t,r,o,n)})}}),buildClear).catch(function(r){return retry(clear$5,e,t,n)})}function convert$1(e,t,n,r){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildConvert,r).catch(function(o){return retry(convert$1,e,t,n,r)})}function export_$8(e,t,n,r){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildExport,e.editor.configuration,e.currentPartId,r).catch(function(o){return retry(export_$8,e,t,n,r)})}function import_(e,t,n,r){for(var o={model:t,callback:function(e,n){return iinkCallback(t,e,n,r)},importFileId:uuid.create(4).toString()},i=setRecognitionContext(e,o),a=e.editor.configuration.recognitionParams.server.websocket.fileChunkSize,s=function(s){0===s&&sendMessage(i,buildImportFile,o.importFileId,n.type).catch(function(o){return retry(import_,e,t,n,r)}),readBlob(n.slice(s,a,n.type)).then(function(c){sendMessage(i,buildImportChunk,o.importFileId,c,s+a>n.size).catch(function(o){return retry(import_,e,t,n,r)})})},c=0;c<n.size;c+=a)s(c)}function getSupportedImportMimeTypes(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildGetSupportedImportMimeTypes).catch(function(r){return retry(getSupportedImportMimeTypes,e,t,n)})}function waitForIdle(e,t,n){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildWaitForIdle).catch(function(r){return retry(waitForIdle,e,t,n)})}function resize$2(e,t,n,r){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,r){return iinkCallback(t,e,r,n)}}),buildResize,r,e.editor.configuration.renderingParams.minHeight,e.editor.configuration.renderingParams.minWidth).catch(function(o){return retry(resize$2,e,t,n,r)})}function zoom(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments[3];sendMessage(setRecognitionContext(e,{model:t,callback:function(e,n){return iinkCallback(t,e,n,r)}}),buildZoom,n).catch(function(n){return retry(zoom,e,t,r)})}function setPenStyle(e,t,n,r){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,n){return iinkCallback(t,e,n,r)}}),buildSetPenStyle,n).catch(function(n){return retry(setPenStyle,e,t,r)})}function setPenStyleClasses(e,t,n,r){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,n){return iinkCallback(t,e,n,r)}}),buildSetPenStyleClasses,n).catch(function(n){return retry(setPenStyleClasses,e,t,r)})}function setTheme(e,t,n,r){sendMessage(setRecognitionContext(e,{model:t,callback:function(e,n){return iinkCallback(t,e,n,r)}}),buildSetTheme,n).catch(function(n){return retry(setTheme,e,t,r)})}var Cdkv4WSInteractiveRecognizer=Object.freeze({init:init$5,newContentPart:newContentPart,openContentPart:openContentPart,sendConfiguration:sendConfiguration,pointerEvents:pointerEvents,addStrokes:addStrokes,undo:undo,redo:redo,clear:clear$5,convert:convert$1,export_:export_$8,import_:import_,getSupportedImportMimeTypes:getSupportedImportMimeTypes,waitForIdle:waitForIdle,resize:resize$2,zoom:zoom,setPenStyle:setPenStyle,setPenStyleClasses:setPenStyleClasses,setTheme:setTheme,IInkWebSocketV4Configuration:IInkWebSocketV4Configuration,getInfo:getInfo$c,buildNewContentPackageInput:buildNewContentPackageInput,buildRestoreIInkSessionInput:buildRestoreIInkSessionInput,buildNewContentPart:buildNewContentPart,buildOpenContentPart:buildOpenContentPart,buildConfiguration:buildConfiguration,buildSetPenStyle:buildSetPenStyle,buildSetPenStyleClasses:buildSetPenStyleClasses,buildSetTheme:buildSetTheme,close:close$2});function eventCallback(e,t){callbackLogger.info("emitting "+e+" event",t),this.dispatchEvent(new CustomEvent(e,Object.assign({bubbles:!0,composed:!0},t?{detail:t}:void 0)))}var defaultBehaviors={grabber:PointerEventGrabber,strokerList:[QuadraticCanvasStroker,QuadraticSVGStroker],rendererList:[CanvasRenderer,SVGRenderer],recognizerList:[Cdkv3RestTextRecognizer,Cdkv3RestMathRecognizer,Cdkv3RestAnalyzerRecognizer,Cdkv3RestShapeRecognizer,Cdkv3RestMusicRecognizer,iinkRestRecognizer,Cdkv3WSTextRecognizer,Cdkv3WSMathRecognizer,Cdkv4WSInteractiveRecognizer],callbacks:[eventCallback],getBehaviorFromConfiguration:function(e,t){var n={};return n.grabber=e.grabber,t&&("V4"===t.recognitionParams.apiVersion&&"REST"===t.recognitionParams.protocol?n.stroker=QuadraticCanvasStroker:n.stroker=e.strokerList.find(function(e){return e.getInfo().apiVersion===t.recognitionParams.apiVersion&&e.getInfo().name===t.renderingParams.stroker}),"V4"===t.recognitionParams.apiVersion&&"REST"===t.recognitionParams.protocol?n.renderer=CanvasRenderer:n.renderer=e.rendererList.find(function(e){return e.getInfo().apiVersion===t.recognitionParams.apiVersion}),n.recognizer=e.recognizerList.find(function(e){return e.getInfo().types.includes(t.recognitionParams.type)&&e.getInfo().protocol===t.recognitionParams.protocol&&e.getInfo().apiVersion===t.recognitionParams.apiVersion})),n.callbacks=e.callbacks,n}};function overrideDefaultBehaviors(e){if(e){var t={grabber:e.grabber||defaultBehaviors.grabber,rendererList:e.rendererList||defaultBehaviors.rendererList,strokerList:e.strokerList||defaultBehaviors.strokerList,recognizerList:e.recognizerList||defaultBehaviors.recognizerList,callbacks:e.callbacks||defaultBehaviors.callbacks,getBehaviorFromConfiguration:e.getBehaviorFromConfiguration||defaultBehaviors.getBehaviorFromConfiguration};return editorLogger.debug("Override default behaviors",t),t}return defaultBehaviors}function createUndoRedoContext(e){return{stack:[],currentPosition:-1,maxSize:e.undoRedoMaxStackSize,canUndo:!1,canRedo:!1}}function updateUndoRedoState(e){var t=e;return t.canUndo=e.currentPosition>0,t.canRedo=e.currentPosition<e.stack.length-1,t}function getModel(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.stack[e.currentPosition],o=arguments.length,i=Array(o>3?o-3:0),a=3;a<o;a++)i[a-3]=arguments[a];t.apply(void 0,[void 0,n?cloneModel(r):r].concat(i))}function updateModel(e,t,n){var r=e.stack.findIndex(function(e){return e.modificationTime===t.modificationTime&&e.rawStrokes.length===t.rawStrokes.length}),o=t;o.modificationTime=(new Date).getTime();var i=[];if(r>-1)e.stack.splice(r,1,cloneModel(o)),modelLogger.debug("model updated",o);else{var a=e;a.currentPosition+=1,a.stack=a.stack.slice(0,a.currentPosition),a.stack.push(cloneModel(o)),a.stack.length>a.maxSize&&(a.stack.shift(),a.currentPosition--),modelLogger.debug("model pushed",o),i.push(Constants.EventType.CHANGED)}updateUndoRedoState(e),modelLogger.debug("undo/redo stack updated",e),getModel.apply(void 0,[e,n,!1].concat(i))}function undo$1(e,t,n){var r=e;r.currentPosition>0&&(r.currentPosition-=1,updateUndoRedoState(e),modelLogger.debug("undo index",r.currentPosition)),getModel(e,n,!0,Constants.EventType.CHANGED,Constants.EventType.EXPORTED)}function redo$1(e,t,n){var r=e;r.currentPosition<r.stack.length-1&&(r.currentPosition+=1,updateUndoRedoState(e),modelLogger.debug("redo index",r.currentPosition)),getModel(e,n,!0,Constants.EventType.CHANGED,Constants.EventType.EXPORTED)}var UndoRedoManager=Object.freeze({getModel:getModel,updateModel:updateModel,undo:undo$1,redo:redo$1});function computeStats(e){var t={strokesCount:0,pointsCount:0,byteSize:0,humanSize:0,humanUnit:"BYTE"};if(e.rawStrokes){t.strokesCount=e.rawStrokes.length;var n=buildInput(createEmptyRecognizerContext({configuration:defaultConfiguration}),e);t.pointsCount=e.rawStrokes.map(function(e){return e.x.length}).reduce(function(e,t){return e+t},0);var r=n.textInput.length;t.byteSize=r,r<270?(t.humanUnit="BYTE",t.byteSize=0,t.humanSize=0):r<2048?(t.humanUnit="BYTES",t.humanSize=r):r<1048576?(t.humanUnit="KiB",t.humanSize=(r/1024).toFixed(2)):(t.humanUnit="MiB",t.humanSize=(r/1024/1024).toFixed(2))}return utilLogger.info("Stats",t),t}function createCanvas$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=document.createElement("canvas");return n.width=Math.abs(e.maxX-e.minX)+2*t,n.style.width=n.width+"px",n.height=Math.abs(e.maxY-e.minY)+2*t,n.style.height=n.height+"px",n}function getImage(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(e.rawStrokes.length>0){var r=getBorderCoordinates(e),o=createCanvas$1(r,n),i=createCanvas$1(r,n),a={renderingCanvas:i,renderingCanvasContext:i.getContext("2d"),capturingCanvas:o,capturingCanvasContext:o.getContext("2d")};return a.renderingCanvasContext.translate(-r.minX+n,-r.minY+n),drawModel(a,e,t),a.renderingCanvas.toDataURL("image/png")}return null}function get$2(e){return getComputedStyle(e)}function set$1(e,t){for(var n in t){var r=t[n];"number"==typeof r&&(r+="px"),e.style[n]=r}return e}function div(e){var t=document.createElement("div");return t.className=e,t}var elMatches="undefined"!=typeof Element&&(Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector);function matches(e,t){if(!elMatches)throw new Error("No element matching method supported");return elMatches.call(e,t)}function remove$1(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e)}function queryChildren(e,t){return Array.prototype.filter.call(e.children,function(e){return matches(e,t)})}var cls={main:"ps",element:{thumb:function(e){return"ps__thumb-"+e},rail:function(e){return"ps__rail-"+e},consuming:"ps__child--consume"},state:{focus:"ps--focus",active:function(e){return"ps--active-"+e},scrolling:function(e){return"ps--scrolling-"+e}}},scrollingClassTimeout={x:null,y:null};function addScrollingClass(e,t){var n=e.element.classList,r=cls.state.scrolling(t);n.contains(r)?clearTimeout(scrollingClassTimeout[t]):n.add(r)}function removeScrollingClass(e,t){scrollingClassTimeout[t]=setTimeout(function(){return e.isAlive&&e.element.classList.remove(cls.state.scrolling(t))},e.settings.scrollingThreshold)}function setScrollingClassInstantly(e,t){addScrollingClass(e,t),removeScrollingClass(e,t)}var EventElement=function(e){this.element=e,this.handlers={}},prototypeAccessors={isEmpty:{configurable:!0}};EventElement.prototype.bind=function(e,t){void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t),this.element.addEventListener(e,t,!1)},EventElement.prototype.unbind=function(e,t){var n=this;this.handlers[e]=this.handlers[e].filter(function(r){return!(!t||r===t)||(n.element.removeEventListener(e,r,!1),!1)})},EventElement.prototype.unbindAll=function(){for(var e in this.handlers)this.unbind(e)},prototypeAccessors.isEmpty.get=function(){var e=this;return Object.keys(this.handlers).every(function(t){return 0===e.handlers[t].length})},Object.defineProperties(EventElement.prototype,prototypeAccessors);var EventManager=function(){this.eventElements=[]};function createEvent(e){if("function"==typeof window.CustomEvent)return new CustomEvent(e);var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,void 0),t}EventManager.prototype.eventElement=function(e){var t=this.eventElements.filter(function(t){return t.element===e})[0];return t||(t=new EventElement(e),this.eventElements.push(t)),t},EventManager.prototype.bind=function(e,t,n){this.eventElement(e).bind(t,n)},EventManager.prototype.unbind=function(e,t,n){var r=this.eventElement(e);r.unbind(t,n),r.isEmpty&&this.eventElements.splice(this.eventElements.indexOf(r),1)},EventManager.prototype.unbindAll=function(){this.eventElements.forEach(function(e){return e.unbindAll()}),this.eventElements=[]},EventManager.prototype.once=function(e,t,n){var r=this.eventElement(e),o=function(e){r.unbind(t,o),n(e)};r.bind(t,o)};var processScrollDiff=function(e,t,n,r,o){var i;if(void 0===r&&(r=!0),void 0===o&&(o=!1),"top"===t)i=["contentHeight","containerHeight","scrollTop","y","up","down"];else{if("left"!==t)throw new Error("A proper axis should be provided");i=["contentWidth","containerWidth","scrollLeft","x","left","right"]}processScrollDiff$1(e,n,i,r,o)};function processScrollDiff$1(e,t,n,r,o){var i=n[0],a=n[1],s=n[2],c=n[3],l=n[4],u=n[5];void 0===r&&(r=!0),void 0===o&&(o=!1);var d=e.element;e.reach[c]=null,d[s]<1&&(e.reach[c]="start"),d[s]>e[i]-e[a]-1&&(e.reach[c]="end"),t&&(d.dispatchEvent(createEvent("ps-scroll-"+c)),t<0?d.dispatchEvent(createEvent("ps-scroll-"+l)):t>0&&d.dispatchEvent(createEvent("ps-scroll-"+u)),r&&setScrollingClassInstantly(e,c)),e.reach[c]&&(t||o)&&d.dispatchEvent(createEvent("ps-"+c+"-reach-"+e.reach[c]))}function toInt(e){return parseInt(e,10)||0}function isEditable(e){return matches(e,"input,[contenteditable]")||matches(e,"select,[contenteditable]")||matches(e,"textarea,[contenteditable]")||matches(e,"button,[contenteditable]")}function outerWidth(e){var t=get$2(e);return toInt(t.width)+toInt(t.paddingLeft)+toInt(t.paddingRight)+toInt(t.borderLeftWidth)+toInt(t.borderRightWidth)}var env={isWebKit:"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style,supportsTouch:"undefined"!=typeof window&&("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),supportsIePointer:"undefined"!=typeof navigator&&navigator.msMaxTouchPoints,isChrome:"undefined"!=typeof navigator&&/Chrome/i.test(navigator&&navigator.userAgent)},updateGeometry=function(e){var t=e.element;e.containerWidth=t.clientWidth,e.containerHeight=t.clientHeight,e.contentWidth=t.scrollWidth,e.contentHeight=t.scrollHeight,t.contains(e.scrollbarXRail)||(queryChildren(t,cls.element.rail("x")).forEach(function(e){return remove$1(e)}),t.appendChild(e.scrollbarXRail)),t.contains(e.scrollbarYRail)||(queryChildren(t,cls.element.rail("y")).forEach(function(e){return remove$1(e)}),t.appendChild(e.scrollbarYRail)),!e.settings.suppressScrollX&&e.containerWidth+e.settings.scrollXMarginOffset<e.contentWidth?(e.scrollbarXActive=!0,e.railXWidth=e.containerWidth-e.railXMarginWidth,e.railXRatio=e.containerWidth/e.railXWidth,e.scrollbarXWidth=getThumbSize(e,toInt(e.railXWidth*e.containerWidth/e.contentWidth)),e.scrollbarXLeft=toInt((e.negativeScrollAdjustment+t.scrollLeft)*(e.railXWidth-e.scrollbarXWidth)/(e.contentWidth-e.containerWidth))):e.scrollbarXActive=!1,!e.settings.suppressScrollY&&e.containerHeight+e.settings.scrollYMarginOffset<e.contentHeight?(e.scrollbarYActive=!0,e.railYHeight=e.containerHeight-e.railYMarginHeight,e.railYRatio=e.containerHeight/e.railYHeight,e.scrollbarYHeight=getThumbSize(e,toInt(e.railYHeight*e.containerHeight/e.contentHeight)),e.scrollbarYTop=toInt(t.scrollTop*(e.railYHeight-e.scrollbarYHeight)/(e.contentHeight-e.containerHeight))):e.scrollbarYActive=!1,e.scrollbarXLeft>=e.railXWidth-e.scrollbarXWidth&&(e.scrollbarXLeft=e.railXWidth-e.scrollbarXWidth),e.scrollbarYTop>=e.railYHeight-e.scrollbarYHeight&&(e.scrollbarYTop=e.railYHeight-e.scrollbarYHeight),updateCss(t,e),e.scrollbarXActive?t.classList.add(cls.state.active("x")):(t.classList.remove(cls.state.active("x")),e.scrollbarXWidth=0,e.scrollbarXLeft=0,t.scrollLeft=0),e.scrollbarYActive?t.classList.add(cls.state.active("y")):(t.classList.remove(cls.state.active("y")),e.scrollbarYHeight=0,e.scrollbarYTop=0,t.scrollTop=0)};function getThumbSize(e,t){return e.settings.minScrollbarLength&&(t=Math.max(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=Math.min(t,e.settings.maxScrollbarLength)),t}function updateCss(e,t){var n={width:t.railXWidth};t.isRtl?n.left=t.negativeScrollAdjustment+e.scrollLeft+t.containerWidth-t.contentWidth:n.left=e.scrollLeft,t.isScrollbarXUsingBottom?n.bottom=t.scrollbarXBottom-e.scrollTop:n.top=t.scrollbarXTop+e.scrollTop,set$1(t.scrollbarXRail,n);var r={top:e.scrollTop,height:t.railYHeight};t.isScrollbarYUsingRight?t.isRtl?r.right=t.contentWidth-(t.negativeScrollAdjustment+e.scrollLeft)-t.scrollbarYRight-t.scrollbarYOuterWidth:r.right=t.scrollbarYRight-e.scrollLeft:t.isRtl?r.left=t.negativeScrollAdjustment+e.scrollLeft+2*t.containerWidth-t.contentWidth-t.scrollbarYLeft-t.scrollbarYOuterWidth:r.left=t.scrollbarYLeft+e.scrollLeft,set$1(t.scrollbarYRail,r),set$1(t.scrollbarX,{left:t.scrollbarXLeft,width:t.scrollbarXWidth-t.railBorderXWidth}),set$1(t.scrollbarY,{top:t.scrollbarYTop,height:t.scrollbarYHeight-t.railBorderYWidth})}var clickRail=function(e){e.event.bind(e.scrollbarY,"mousedown",function(e){return e.stopPropagation()}),e.event.bind(e.scrollbarYRail,"mousedown",function(t){var n=t.pageY-window.pageYOffset-e.scrollbarYRail.getBoundingClientRect().top>e.scrollbarYTop?1:-1;e.element.scrollTop+=n*e.containerHeight,updateGeometry(e),t.stopPropagation()}),e.event.bind(e.scrollbarX,"mousedown",function(e){return e.stopPropagation()}),e.event.bind(e.scrollbarXRail,"mousedown",function(t){var n=t.pageX-window.pageXOffset-e.scrollbarXRail.getBoundingClientRect().left>e.scrollbarXLeft?1:-1;e.element.scrollLeft+=n*e.containerWidth,updateGeometry(e),t.stopPropagation()})},dragThumb=function(e){bindMouseScrollHandler(e,["containerWidth","contentWidth","pageX","railXWidth","scrollbarX","scrollbarXWidth","scrollLeft","x"]),bindMouseScrollHandler(e,["containerHeight","contentHeight","pageY","railYHeight","scrollbarY","scrollbarYHeight","scrollTop","y"])};function bindMouseScrollHandler(e,t){var n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],c=t[6],l=t[7],u=e.element,d=null,g=null,p=null;function f(t){u[c]=d+p*(t[o]-g),addScrollingClass(e,l),updateGeometry(e),t.stopPropagation(),t.preventDefault()}function h(){removeScrollingClass(e,l),e.event.unbind(e.ownerDocument,"mousemove",f)}e.event.bind(e[a],"mousedown",function(t){d=u[c],g=t[o],p=(e[r]-e[n])/(e[i]-e[s]),e.event.bind(e.ownerDocument,"mousemove",f),e.event.once(e.ownerDocument,"mouseup",h),t.stopPropagation(),t.preventDefault()})}var keyboard=function(e){var t=e.element;e.event.bind(e.ownerDocument,"keydown",function(n){if(!(n.isDefaultPrevented&&n.isDefaultPrevented()||n.defaultPrevented)&&(matches(t,":hover")||matches(e.scrollbarX,":focus")||matches(e.scrollbarY,":focus"))){var r=document.activeElement?document.activeElement:e.ownerDocument.activeElement;if(r){if("IFRAME"===r.tagName)r=r.contentDocument.activeElement;else for(;r.shadowRoot;)r=r.shadowRoot.activeElement;if(isEditable(r))return}var o=0,i=0;switch(n.which){case 37:o=n.metaKey?-e.contentWidth:n.altKey?-e.containerWidth:-30;break;case 38:i=n.metaKey?e.contentHeight:n.altKey?e.containerHeight:30;break;case 39:o=n.metaKey?e.contentWidth:n.altKey?e.containerWidth:30;break;case 40:i=n.metaKey?-e.contentHeight:n.altKey?-e.containerHeight:-30;break;case 32:i=n.shiftKey?e.containerHeight:-e.containerHeight;break;case 33:i=e.containerHeight;break;case 34:i=-e.containerHeight;break;case 36:i=e.contentHeight;break;case 35:i=-e.contentHeight;break;default:return}e.settings.suppressScrollX&&0!==o||e.settings.suppressScrollY&&0!==i||(t.scrollTop-=i,t.scrollLeft+=o,updateGeometry(e),function(n,r){var o=t.scrollTop;if(0===n){if(!e.scrollbarYActive)return!1;if(0===o&&r>0||o>=e.contentHeight-e.containerHeight&&r<0)return!e.settings.wheelPropagation}var i=t.scrollLeft;if(0===r){if(!e.scrollbarXActive)return!1;if(0===i&&n<0||i>=e.contentWidth-e.containerWidth&&n>0)return!e.settings.wheelPropagation}return!0}(o,i)&&n.preventDefault())}})},wheel=function(e){var t=e.element;function n(n){var r=function(e){var t=e.deltaX,n=-1*e.deltaY;return void 0!==t&&void 0!==n||(t=-1*e.wheelDeltaX/6,n=e.wheelDeltaY/6),e.deltaMode&&1===e.deltaMode&&(t*=10,n*=10),t!=t&&n!=n&&(t=0,n=e.wheelDelta),e.shiftKey?[-n,-t]:[t,n]}(n),o=r[0],i=r[1];if(!function(e,n,r){if(!env.isWebKit&&t.querySelector("select:focus"))return!0;if(!t.contains(e))return!1;for(var o=e;o&&o!==t;){if(o.classList.contains(cls.element.consuming))return!0;var i=get$2(o);if([i.overflow,i.overflowX,i.overflowY].join("").match(/(scroll|auto)/)){var a=o.scrollHeight-o.clientHeight;if(a>0&&!(0===o.scrollTop&&r>0||o.scrollTop===a&&r<0))return!0;var s=o.scrollLeft-o.clientWidth;if(s>0&&!(0===o.scrollLeft&&n<0||o.scrollLeft===s&&n>0))return!0}o=o.parentNode}return!1}(n.target,o,i)){var a=!1;e.settings.useBothWheelAxes?e.scrollbarYActive&&!e.scrollbarXActive?(i?t.scrollTop-=i*e.settings.wheelSpeed:t.scrollTop+=o*e.settings.wheelSpeed,a=!0):e.scrollbarXActive&&!e.scrollbarYActive&&(o?t.scrollLeft+=o*e.settings.wheelSpeed:t.scrollLeft-=i*e.settings.wheelSpeed,a=!0):(t.scrollTop-=i*e.settings.wheelSpeed,t.scrollLeft+=o*e.settings.wheelSpeed),updateGeometry(e),(a=a||function(n,r){var o=0===t.scrollTop,i=t.scrollTop+t.offsetHeight===t.scrollHeight,a=0===t.scrollLeft,s=t.scrollLeft+t.offsetWidth===t.offsetWidth;return!(Math.abs(r)>Math.abs(n)?o||i:a||s)||!e.settings.wheelPropagation}(o,i))&&!n.ctrlKey&&(n.stopPropagation(),n.preventDefault())}}void 0!==window.onwheel?e.event.bind(t,"wheel",n):void 0!==window.onmousewheel&&e.event.bind(t,"mousewheel",n)},touch$1=function(e){if(env.supportsTouch||env.supportsIePointer){var t=e.element,n={},r=0,o={},i=null;env.supportsTouch?(e.event.bind(t,"touchstart",l),e.event.bind(t,"touchmove",u),e.event.bind(t,"touchend",d)):env.supportsIePointer&&(window.PointerEvent?(e.event.bind(t,"pointerdown",l),e.event.bind(t,"pointermove",u),e.event.bind(t,"pointerup",d)):window.MSPointerEvent&&(e.event.bind(t,"MSPointerDown",l),e.event.bind(t,"MSPointerMove",u),e.event.bind(t,"MSPointerUp",d)))}function a(n,r){t.scrollTop-=r,t.scrollLeft-=n,updateGeometry(e)}function s(e){return e.targetTouches?e.targetTouches[0]:e}function c(e){return(!e.pointerType||"pen"!==e.pointerType||0!==e.buttons)&&(!(!e.targetTouches||1!==e.targetTouches.length)||!(!e.pointerType||"mouse"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE))}function l(e){if(c(e)){var t=s(e);n.pageX=t.pageX,n.pageY=t.pageY,r=(new Date).getTime(),null!==i&&clearInterval(i)}}function u(i){if(c(i)){var l=s(i),u={pageX:l.pageX,pageY:l.pageY},d=u.pageX-n.pageX,g=u.pageY-n.pageY;if(function(e,n,r){if(!t.contains(e))return!1;for(var o=e;o&&o!==t;){if(o.classList.contains(cls.element.consuming))return!0;var i=get$2(o);if([i.overflow,i.overflowX,i.overflowY].join("").match(/(scroll|auto)/)){var a=o.scrollHeight-o.clientHeight;if(a>0&&!(0===o.scrollTop&&r>0||o.scrollTop===a&&r<0))return!0;var s=o.scrollLeft-o.clientWidth;if(s>0&&!(0===o.scrollLeft&&n<0||o.scrollLeft===s&&n>0))return!0}o=o.parentNode}return!1}(i.target,d,g))return;a(d,g),n=u;var p=(new Date).getTime(),f=p-r;f>0&&(o.x=d/f,o.y=g/f,r=p),function(n,r){var o=t.scrollTop,i=t.scrollLeft,a=Math.abs(n),s=Math.abs(r);if(s>a){if(r<0&&o===e.contentHeight-e.containerHeight||r>0&&0===o)return 0===window.scrollY&&r>0&&env.isChrome}else if(a>s&&(n<0&&i===e.contentWidth-e.containerWidth||n>0&&0===i))return!0;return!0}(d,g)&&i.preventDefault()}}function d(){e.settings.swipeEasing&&(clearInterval(i),i=setInterval(function(){e.isInitialized?clearInterval(i):o.x||o.y?Math.abs(o.x)<.01&&Math.abs(o.y)<.01?clearInterval(i):(a(30*o.x,30*o.y),o.x*=.8,o.y*=.8):clearInterval(i)},10))}},defaultSettings=function(){return{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollingThreshold:1e3,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipeEasing:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1}},handlers={"click-rail":clickRail,"drag-thumb":dragThumb,keyboard:keyboard,wheel:wheel,touch:touch$1},PerfectScrollbar=function(e,t){var n=this;if(void 0===t&&(t={}),"string"==typeof e&&(e=document.querySelector(e)),!e||!e.nodeName)throw new Error("no element is specified to initialize PerfectScrollbar");for(var r in this.element=e,e.classList.add(cls.main),this.settings=defaultSettings(),t)n.settings[r]=t[r];this.containerWidth=null,this.containerHeight=null,this.contentWidth=null,this.contentHeight=null;var o,i,a=function(){return e.classList.add(cls.state.focus)},s=function(){return e.classList.remove(cls.state.focus)};this.isRtl="rtl"===get$2(e).direction,this.isNegativeScroll=(i=e.scrollLeft,e.scrollLeft=-1,o=e.scrollLeft<0,e.scrollLeft=i,o),this.negativeScrollAdjustment=this.isNegativeScroll?e.scrollWidth-e.clientWidth:0,this.event=new EventManager,this.ownerDocument=e.ownerDocument||document,this.scrollbarXRail=div(cls.element.rail("x")),e.appendChild(this.scrollbarXRail),this.scrollbarX=div(cls.element.thumb("x")),this.scrollbarXRail.appendChild(this.scrollbarX),this.scrollbarX.setAttribute("tabindex",0),this.event.bind(this.scrollbarX,"focus",a),this.event.bind(this.scrollbarX,"blur",s),this.scrollbarXActive=null,this.scrollbarXWidth=null,this.scrollbarXLeft=null;var c=get$2(this.scrollbarXRail);this.scrollbarXBottom=parseInt(c.bottom,10),isNaN(this.scrollbarXBottom)?(this.isScrollbarXUsingBottom=!1,this.scrollbarXTop=toInt(c.top)):this.isScrollbarXUsingBottom=!0,this.railBorderXWidth=toInt(c.borderLeftWidth)+toInt(c.borderRightWidth),set$1(this.scrollbarXRail,{display:"block"}),this.railXMarginWidth=toInt(c.marginLeft)+toInt(c.marginRight),set$1(this.scrollbarXRail,{display:""}),this.railXWidth=null,this.railXRatio=null,this.scrollbarYRail=div(cls.element.rail("y")),e.appendChild(this.scrollbarYRail),this.scrollbarY=div(cls.element.thumb("y")),this.scrollbarYRail.appendChild(this.scrollbarY),this.scrollbarY.setAttribute("tabindex",0),this.event.bind(this.scrollbarY,"focus",a),this.event.bind(this.scrollbarY,"blur",s),this.scrollbarYActive=null,this.scrollbarYHeight=null,this.scrollbarYTop=null;var l=get$2(this.scrollbarYRail);this.scrollbarYRight=parseInt(l.right,10),isNaN(this.scrollbarYRight)?(this.isScrollbarYUsingRight=!1,this.scrollbarYLeft=toInt(l.left)):this.isScrollbarYUsingRight=!0,this.scrollbarYOuterWidth=this.isRtl?outerWidth(this.scrollbarY):null,this.railBorderYWidth=toInt(l.borderTopWidth)+toInt(l.borderBottomWidth),set$1(this.scrollbarYRail,{display:"block"}),this.railYMarginHeight=toInt(l.marginTop)+toInt(l.marginBottom),set$1(this.scrollbarYRail,{display:""}),this.railYHeight=null,this.railYRatio=null,this.reach={x:e.scrollLeft<=0?"start":e.scrollLeft>=this.contentWidth-this.containerWidth?"end":null,y:e.scrollTop<=0?"start":e.scrollTop>=this.contentHeight-this.containerHeight?"end":null},this.isAlive=!0,this.settings.handlers.forEach(function(e){return handlers[e](n)}),this.lastScrollTop=e.scrollTop,this.lastScrollLeft=e.scrollLeft,this.event.bind(this.element,"scroll",function(e){return n.onScroll(e)}),updateGeometry(this)};function select$1(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var r=window.getSelection(),o=document.createRange();o.selectNodeContents(e),r.removeAllRanges(),r.addRange(o),t=r.toString()}return t}PerfectScrollbar.prototype.update=function(){this.isAlive&&(this.negativeScrollAdjustment=this.isNegativeScroll?this.element.scrollWidth-this.element.clientWidth:0,set$1(this.scrollbarXRail,{display:"block"}),set$1(this.scrollbarYRail,{display:"block"}),this.railXMarginWidth=toInt(get$2(this.scrollbarXRail).marginLeft)+toInt(get$2(this.scrollbarXRail).marginRight),this.railYMarginHeight=toInt(get$2(this.scrollbarYRail).marginTop)+toInt(get$2(this.scrollbarYRail).marginBottom),set$1(this.scrollbarXRail,{display:"none"}),set$1(this.scrollbarYRail,{display:"none"}),updateGeometry(this),processScrollDiff(this,"top",0,!1,!0),processScrollDiff(this,"left",0,!1,!0),set$1(this.scrollbarXRail,{display:""}),set$1(this.scrollbarYRail,{display:""}))},PerfectScrollbar.prototype.onScroll=function(e){this.isAlive&&(updateGeometry(this),processScrollDiff(this,"top",this.element.scrollTop-this.lastScrollTop),processScrollDiff(this,"left",this.element.scrollLeft-this.lastScrollLeft),this.lastScrollTop=this.element.scrollTop,this.lastScrollLeft=this.element.scrollLeft)},PerfectScrollbar.prototype.destroy=function(){this.isAlive&&(this.event.unbindAll(),remove$1(this.scrollbarX),remove$1(this.scrollbarY),remove$1(this.scrollbarXRail),remove$1(this.scrollbarYRail),this.removePsClasses(),this.element=null,this.scrollbarX=null,this.scrollbarY=null,this.scrollbarXRail=null,this.scrollbarYRail=null,this.isAlive=!1)},PerfectScrollbar.prototype.removePsClasses=function(){this.element.className=this.element.className.split(" ").filter(function(e){return!e.match(/^ps([-_].+|)$/)}).join(" ")};var select_1=select$1,clipboardAction=createCommonjsModule(function(e,t){!function(e,t){var n,r=(n=t)&&n.__esModule?n:{default:n},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resolveOptions(t),this.initSelection()}return i(e,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.container=e.container,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,r.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,r.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":o(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}();e.exports=a}(e,select_1)});function E(){}unwrapExports(clipboardAction),E.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function o(){r.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,a=r.length;i<a;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}};var tinyEmitter=E,is=createCommonjsModule(function(e,t){t.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},t.nodeList=function(e){var n=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in e&&(0===e.length||t.node(e[0]))},t.string=function(e){return"string"==typeof e||e instanceof String},t.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}}),is_1=is.node,is_2=is.nodeList,is_3=is.string,is_4=is.fn,DOCUMENT_NODE_TYPE=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var proto=Element.prototype;proto.matches=proto.matchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector||proto.webkitMatchesSelector}function closest(e,t){for(;e&&e.nodeType!==DOCUMENT_NODE_TYPE;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}var closest_1=closest;function delegate(e,t,n,r,o){var i=listener.apply(this,arguments);return e.addEventListener(n,i,o),{destroy:function(){e.removeEventListener(n,i,o)}}}function listener(e,t,n,r){return function(n){n.delegateTarget=closest_1(n.target,t),n.delegateTarget&&r.call(e,n)}}var delegate_1=delegate;function listen(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!is.string(t))throw new TypeError("Second argument must be a String");if(!is.fn(n))throw new TypeError("Third argument must be a Function");if(is.node(e))return listenNode(e,t,n);if(is.nodeList(e))return listenNodeList(e,t,n);if(is.string(e))return listenSelector(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function listenNode(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function listenNodeList(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function listenSelector(e,t,n){return delegate_1(document.body,e,t,n)}var listen_1=listen,clipboard=createCommonjsModule(function(e,t){!function(e,t,n,r){var o=s(t),i=s(n),a=s(r);function s(e){return e&&e.__esModule?e:{default:e}}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.resolveOptions(n),r.listenClick(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),l(t,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText,this.container="object"===c(e.container)?e.container:document.body}},{key:"listenClick",value:function(e){var t=this;this.listener=(0,a.default)(e,"click",function(e){return t.onClick(e)})}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new o.default({action:this.action(t),target:this.target(t),text:this.text(t),container:this.container,trigger:t,emitter:this})}},{key:"defaultAction",value:function(e){return d("action",e)}},{key:"defaultTarget",value:function(e){var t=d("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return d("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach(function(e){n=n&&!!document.queryCommandSupported(e)}),n}}]),t}(i.default);function d(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}e.exports=u}(e,clipboardAction,tinyEmitter,listen_1)}),Clipboard=unwrapExports(clipboard);function createHTMLElements(e){var t=document.createElement("div");t.id="smartguide"+e,t.classList.add("smartguide");var n=document.createElement("div");n.id="prompter-text"+e,n.classList.add("prompter-text"),n.setAttribute("touch-action","none");var r=document.createElement("div");r.id="prompter-text-container"+e,r.classList.add("prompter-text-container"),r.appendChild(n);var o=document.createElement("div");o.id="ellipsis"+e,o.classList.add("ellipsis"),o.innerHTML="...";var i=document.createElement("div");i.id="tag-icon"+e,i.classList.add("tag-icon"),i.innerHTML="&#182;";var a=document.createElement("div");a.id="candidates"+e,a.classList.add("candidates");var s=document.createElement("div");s.id="more-menu"+e,s.classList.add("more-menu");var c=document.createElement("button");c.classList.add("options-label-button"),c.id="convert"+e,c.innerHTML="Convert";var l=document.createElement("button");l.classList.add("options-label-button"),l.id="copy"+e,l.innerHTML="Copy";var u=document.createElement("button");return u.classList.add("options-label-button"),u.id="delete"+e,u.innerHTML="Delete",{smartGuideElement:t,textElement:n,textContainer:r,candidatesElement:a,menuElement:s,tagElement:i,ellipsisElement:o,convertElement:c,copyElement:l,deleteElement:u}}function isInShadow(e){for(var t=e&&e.parentNode;t;){if("[object ShadowRoot]"===t.toString())return!0;t=t.parentNode}return!1}function showActions(e,t){var n=t,r=function(){var t=e.target.offsetLeft-68;n.menuElement.style.left=t+"px"},o=document.contains(n.menuElement);isInShadow(n.menuElement)||o?"none"===n.menuElement.style.display&&(r(),n.menuElement.style.display="flex"):(n.menuElement.style.display="flex",r(),n.menuElement.appendChild(n.convertElement),n.menuElement.appendChild(n.copyElement),n.menuElement.appendChild(n.deleteElement),e.target.parentNode.insertBefore(n.menuElement,e.target))}function showCandidates(e,t,n){var r=n,o=n.elements;if(e.target.id!=="prompter-text"+n.randomString){var i=e.target.id.replace("word-","").replace(n.randomString,""),a=JSON.parse(t.exports[Constants.Exports.JIIX]).words;if(r.wordToChange=a[i],r.wordToChange.id=i,o.candidatesElement.innerHTML="",r.wordToChange&&r.wordToChange.candidates){o.candidatesElement.style.display="flex",r.wordToChange.candidates.forEach(function(e,t){r.wordToChange.label===e?o.candidatesElement.innerHTML+='<span id="cdt-'+t+n.randomString+'" class="selected-word">'+e+"</span>":o.candidatesElement.innerHTML+='<span id="cdt-'+t+n.randomString+'">'+e+"</span>"});var s=e.target.getBoundingClientRect().left-60;o.candidatesElement.style.top="48px",o.candidatesElement.style.left=s+"px",e.target.parentNode.parentNode.parentNode.insertBefore(o.candidatesElement,e.target.parentNode.parentNode)}}}function clickCandidate(e,t,n){var r=n,o=n.elements,i=e.target.innerText;if(i!==r.wordToChange.label&&r.wordToChange.candidates.includes(i)){var a=JSON.parse(t.exports[Constants.Exports.JIIX]);a.words[r.wordToChange.id].label=i,t.import_(JSON.stringify(a),Constants.Exports.JIIX)}o.candidatesElement.style.display="none"}function addListeners(e,t){var n=t.elements;n.textElement.addEventListener("click",function(n){return showCandidates(n,e,t)}),n.candidatesElement.addEventListener("click",function(n){return clickCandidate(n,e,t)}),n.ellipsisElement.addEventListener("click",function(e){return showActions(e,n)}),n.copyElement.addEventListener("click",function(){n.menuElement.style.display="none"}),n.convertElement.addEventListener("click",function(){n.menuElement.style.display="none",e.convert()}),n.deleteElement.addEventListener("click",function(){n.menuElement.style.display="none",e.clear()})}function callFadeOutObserver(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,t=arguments[1],n=t,r=t.elements;new MutationObserver(function(t){t.forEach(function(){n.smartGuideTimeOutId&&clearTimeout(n.smartGuideTimeOutId),"none"===r.candidatesElement.style.display&&"none"===r.menuElement.style.display?n.smartGuideTimeOutId=setTimeout(function(){r.smartGuideElement.classList.add("smartguide-out"),r.smartGuideElement.classList.remove("smartguide-in")},e):document.contains(r.candidatesElement)||document.contains(r.menuElement)||(n.smartGuideTimeOutId=setTimeout(function(){r.smartGuideElement.classList.add("smartguide-out"),r.smartGuideElement.classList.remove("smartguide-in")},e))})}).observe(r.smartGuideElement,{childList:!0,subtree:!0,attributes:!0})}function createSmartGuide(e){var t="-"+Math.random().toString(10).substring(2,12),n=createHTMLElements(t),r=(new Clipboard(n.copyElement),{editor:e,wordToChange:"",lastWord:"",previousLabelExport:" ",perfectScrollbar:new PerfectScrollbar(n.textContainer,{suppressScrollY:!0,scrollXMarginOffset:1}),elements:n,smartGuideTimeOutId:0,randomString:t});return addListeners(e,r),e.configuration.recognitionParams.v4.text.smartGuideFadeOut.enable&&callFadeOutObserver(e.configuration.recognitionParams.v4.text.smartGuideFadeOut.duration,r),r}function resize$3(e){var t=e,n=e.elements,r=3.779527559*t.editor.configuration.recognitionParams.v4.text.margin.left,o=t.editor.domElement.clientWidth-r-n.tagElement.offsetWidth-35-r;n.textContainer.style.width=o+"px",n.textContainer.style.maxWidth=o+"px",r=n.tagElement.offsetWidth,r+=o,n.ellipsisElement.style.left=r+"px",n.smartGuideElement.style.width=n.tagElement.offsetWidth+n.textContainer.offsetWidth+n.ellipsisElement.offsetWidth+"px",t.perfectScrollbar.update()}function insertSmartGuide(e){var t=e,n=e.elements,r=3.779527559*t.editor.configuration.recognitionParams.v4.text.margin.top,o=3.779527559*t.editor.configuration.recognitionParams.v4.text.margin.left;!function(e,r){n.smartGuideElement.style.top=r+"px",n.smartGuideElement.style.left=e+"px",n.smartGuideElement.style.visibility="hidden",t.editor.domElement.insertBefore(n.smartGuideElement,t.editor.loader)}(o,r-45.354330708),n.smartGuideElement.appendChild(n.tagElement);var i=t.editor.domElement.clientWidth-o-n.tagElement.offsetWidth-35-o;(function(e,t){n.textContainer.style.left=e+"px",n.textContainer.style.width=t+"px",n.textContainer.style.maxWidth=t+"px",n.smartGuideElement.appendChild(n.textContainer)})(o=n.tagElement.offsetWidth,i),function(e){n.ellipsisElement.style.left=e+"px",n.smartGuideElement.appendChild(n.ellipsisElement)}(o+=i),n.menuElement.style.display="none",n.menuElement.appendChild(n.convertElement),n.menuElement.appendChild(n.copyElement),n.menuElement.appendChild(n.deleteElement),n.smartGuideElement.appendChild(n.menuElement),n.candidatesElement.style.display="none",n.smartGuideElement.appendChild(n.candidatesElement),n.smartGuideElement.style.height="48px",n.smartGuideElement.style.width=n.tagElement.offsetWidth+n.textContainer.offsetWidth+n.ellipsisElement.offsetWidth+"px",t.perfectScrollbar.update()}function launchSmartGuide(e,t){var n=e,r=e.elements,o=document.contains(r.smartGuideElement);isInShadow(r.smartGuideElement)||o||insertSmartGuide(e);var i=function(t,n,r){var o=document.createElement("span");return o.id="word-"+n+e.randomString,t?o.innerHTML="&nbsp;":o.textContent=r.label,o};if(t&&JSON.parse(t[Constants.Exports.JIIX]).words.length>0){if(r.smartGuideElement.classList.add("smartguide-in"),r.smartGuideElement.classList.remove("smartguide-out"),r.candidatesElement.style.display="none",r.menuElement.style.display="none",n.previousLabelExport&&n.previousLabelExport!==JSON.parse(t[Constants.Exports.JIIX]).label){var a=JSON.parse(t[Constants.Exports.JIIX]).words;!function(e){r.textElement.innerHTML="";var t=document.createDocumentFragment();e.forEach(function(o,a){if(" "===o.label||o.label.includes("\n"))t.appendChild(i(!0,a));else if(a!==e.length-1)t.appendChild(i(!1,a,o));else{r.textElement.appendChild(t),n.perfectScrollbar.update(),""===n.lastWord&&(n.lastWord=o);var s=i(!1,a,o);n.lastWord.candidates!==o.candidates&&n.lastWord.label!==o.label?(s.classList.add("added-word"),r.textElement.appendChild(s),r.textContainer.scrollLeft=s.offsetLeft,n.lastWord=o):(r.textElement.appendChild(s),r.textContainer.scrollLeft=s.offsetLeft)}})}(a),function(o){if(n.tempWords&&n.tempWords.length===o.length){var i=o.map(function(e){return e.label}),a=n.tempWords.map(function(e){return e.label}),s=i.indexOf(i.filter(function(e){return-1===a.indexOf(e)})[0]);document.getElementById("word-"+s+e.randomString)&&s>-1&&(document.getElementById("word-"+s+e.randomString).classList.add("modified-word"),r.textContainer.scrollLeft=document.getElementById("word-"+s+e.randomString).offsetLeft-10)}n.tempWords=JSON.parse(t[Constants.Exports.JIIX]).words}(a)}n.previousLabelExport=JSON.parse(t[Constants.Exports.JIIX]).label,r.copyElement.setAttribute("data-clipboard-text",JSON.parse(t[Constants.Exports.JIIX]).label)}else r.smartGuideElement.classList.add("smartguide-out"),r.smartGuideElement.classList.remove("smartguide-in");return n}function inkImporter(e,t,n,r){var o=e;editorLogger.debug("inkImporter start importing =>",t);var i=Object.assign({},o.behavior.grabber);i.detach=o.behavior.grabber.detach,o.behavior.grabber={};var a=[];t.forEach(function(e){e.convert?a.push({action:"convert",value:!0}):e.setDelay?a.push({action:"setDelay",value:e.setDelay}):(e.color&&a.push({action:"setColor",value:e.color}),e.X.forEach(function(t,n){var r="move";0===n?r="down":n===e.X.length-1&&(r="up"),a.push({action:r,point:{x:e.X[n],y:e.Y[n]}})}))}),editorLogger.debug("Array of actions =>",a);!function e(t,n,a){if(n<t.length){var s=t[n],c=a;if("convert"===s.action?o.convert():"setDelay"===s.action?c=s.value:"setColor"===s.action?o.penStyle={color:s.value}:(s.point.t=(new Date).getTime(),"down"===s.action?o.pointerDown(s.point):"up"===s.action?o.pointerUp(s.point):"move"===s.action&&o.pointerMove(s.point)),r&&n===t.map(function(e){return e.action}).lastIndexOf("down")-1)setTimeout(function(){e(t,n+1,c)},r);else if(n===t.length-1){var l=new Event("drawEnded");document.dispatchEvent(l),o.behavior.grabber=i}else setTimeout(function(){e(t,n+1,c)},c)}}(a,0,n)}function importStrokeGroups(e,t){t.forEach(function(t){t.strokes.forEach(function(n){addStroke(e.model,n),addStrokeToGroup(e.model,n,t.penStyle)})}),e.renderer.drawModel(e.rendererContext,e.model,e.stroker)}var eastereggs=Object.freeze({inkImporter:inkImporter,importStrokeGroups:importStrokeGroups});function triggerCallbacks(e,t){for(var n=e,r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];o.forEach(function(r){switch(r){case Constants.EventType.RENDERED:break;case Constants.EventType.UNDO:case Constants.EventType.REDO:case Constants.EventType.CLEAR:case Constants.EventType.CONVERT:case Constants.EventType.EXPORT:e.callbacks.forEach(function(t){return t.call(e.domElement,r)});break;case Constants.EventType.LOADED:case Constants.EventType.CHANGED:e.callbacks.forEach(function(t){return t.call(e.domElement,r,{initialized:e.initialized,canUndo:e.canUndo,canRedo:e.canRedo,canClear:e.canClear,isEmpty:e.isEmpty,possibleUndoCount:e.possibleUndoCount,undoStackIndex:e.undoStackIndex,canConvert:e.canConvert,canExport:e.canExport})});break;case Constants.EventType.EXPORTED:window.clearTimeout(n.notifyTimer),n.notifyTimer=window.setTimeout(function(){e.callbacks.forEach(function(t){return t.call(e.domElement,r,{exports:e.exports})})},n.configuration.processDelay);break;case Constants.EventType.SUPPORTED_IMPORT_MIMETYPES:e.callbacks.forEach(function(t){return t.call(e.domElement,r,{mimeTypes:e.supportedImportMimeTypes})});break;case Constants.EventType.ERROR:e.callbacks.forEach(function(n){return n.call(e.domElement,r,t)});break;case Constants.EventType.IDLE:e.callbacks.forEach(function(t){return t.call(e.domElement,r,{idle:e.idle})});break;default:editorLogger.debug("No valid trigger configured for "+r)}})}function manageResetState(e,t,n,r,o){for(var i=arguments.length,a=Array(i>5?i-5:0),s=5;s<i;s++)a[s-5]=arguments[s];e&&isResetRequired(n,r)?(editorLogger.debug("Reset is needed"),e(n,r,function(e,r){for(var i=arguments.length,s=Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];e?o.apply(void 0,[e,r].concat(s)):t.apply(void 0,[n,r,o].concat(a))})):t.apply(void 0,[n,r,o].concat(a))}function isTriggerValid(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.configuration.triggers[t];return!(!e.recognizer||!e.recognizer.getInfo().availableTriggers[t].includes(n))||(editorLogger.error(n+" is not a valid trigger for "+t),!1)}function manageRecognizedModel(e,t){for(var n=e,r=t,o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];editorLogger.debug("model changed callback on "+i+" event(s)",t),r.creationTime===e.model.creationTime&&(r.rawStrokes.length===e.model.rawStrokes.length&&r.lastPositions.lastSentPosition>=e.model.lastPositions.lastReceivedPosition?(n.model=mergeModels(n.model,r),(needRedraw(n.model)||i.includes(Constants.EventType.RENDERED))&&e.renderer.drawModel(e.rendererContext,n.model,e.stroker)):(n.model=r,e.renderer.drawModel(e.rendererContext,n.model,e.stroker)),triggerCallbacks.apply(void 0,[e,void 0].concat(i))),"TEXT"===e.configuration.recognitionParams.type&&"V4"===e.configuration.recognitionParams.apiVersion&&"REST"!==e.configuration.recognitionParams.protocol&&e.configuration.recognitionParams.v4.text.mimeTypes.includes(Constants.Exports.JIIX)&&e.configuration.recognitionParams.v4.text.smartGuide&&launchSmartGuide$1(n,r.exports),extractPendingStrokes(t).length>0&&!e.recognizer.addStrokes&&e.configuration.triggers.exportContent!==Constants.Trigger.DEMAND&&launchExport(e,t)}function recognizerCallback(e,t,n){for(var r=arguments.length,o=Array(r>3?r-3:0),i=3;i<r;i++)o[i-3]=arguments[i];var a=e,s=function(t,n){for(var r=arguments.length,i=Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];t?("close"!==t.type&&editorLogger.error("Error while firing the recognition",t.stack||t),"Invalid application key."===t.message||"Invalid HMAC"===t.message||t.error&&t.error.result&&t.error.result.error&&("InvalidApplicationKeyException"===t.error.result.error||"InvalidHMACSignatureException"===t.error.result.error)||t.code&&"access.not.granted"===t.code?a.error.innerText=Constants.Error.WRONG_CREDENTIALS:"Session is too old. Max Session Duration Reached"===t.message||t.code&&"session.too.old"===t.code?a.error.innerText=Constants.Error.TOO_OLD:!t.message&&1006!==t.code||"none"!==a.error.style.display||(a.error.innerText=Constants.Error.NOT_REACHABLE),a.error.innerText!==Constants.Error.TOO_OLD&&1e3!==t.code&&"CLOSE_RECOGNIZER"!==t.reason||!canReconnect(e.recognizerContext)?(a.error.style.display="initial",triggerCallbacks.apply(void 0,[e,t,Constants.EventType.ERROR].concat(i))):(editorLogger.info("Reconnection is available",t.stack||t),a.error.style.display="none")):manageRecognizedModel.apply(void 0,[a,n].concat(toConsumableArray([].concat(o,i).filter(function(e,t,n){return t===n.indexOf(e)}))))};editorLogger.debug("recognition callback"),e.undoRedoManager.updateModel&&!t?e.undoRedoManager.updateModel(e.undoRedoContext,n,s):s.apply(void 0,[t,n].concat(o))}function addStrokes$1(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.configuration.triggers.addStrokes;e.recognizer&&e.recognizer.addStrokes&&e.recognizerContext.initPromise.then(function(){isTriggerValid(e,"addStrokes",n)&&manageResetState(e.recognizer.reset,e.recognizer.addStrokes,e.recognizerContext,t,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function launchSmartGuide$1(e,t){e.smartGuide=launchSmartGuide(e.smartGuide,t)}function launchPointerEvents(e,t,n){e.recognizer&&e.recognizer.pointerEvents&&e.recognizerContext.initPromise.then(function(){e.recognizer.pointerEvents(e.recognizerContext,t,n,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function launchExport(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.configuration.triggers.exportContent;e.recognizer&&e.recognizer.export_&&e.recognizerContext.initPromise.then(function(){if(isTriggerValid(e,"exportContent",r)){var o=e;window.clearTimeout(e.exportTimer),o.exportTimer=window.setTimeout(function(){manageResetState(e.recognizer.reset,e.recognizer.export_,e.recognizerContext,t,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))},n)},r===Constants.Trigger.QUIET_PERIOD?e.configuration.triggerDelay:0)}})}function launchImport(e,t,n){e.recognizer&&e.recognizer.import_&&e.recognizerContext.initPromise.then(function(){e.recognizer.import_(e.recognizerContext,t,n,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function launchGetSupportedImportMimeTypes(e,t){e.recognizer&&e.recognizer.getSupportedImportMimeTypes&&e.recognizerContext.initPromise.then(function(){e.recognizer.getSupportedImportMimeTypes(e.recognizerContext,t,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function launchConvert(e,t,n){e.recognizer&&e.recognizer.convert&&e.recognizerContext.initPromise.then(function(){e.recognizer.convert(e.recognizerContext,t,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))},n)})}function launchConfig(e,t){e.recognizer&&e.recognizer.sendConfiguration&&e.recognizerContext.initPromise.then(function(){e.recognizer.sendConfiguration(e.recognizerContext,t,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function launchResize(e,t){e.recognizer&&e.recognizer.resize&&(e.recognizerContext.initPromise.then(function(){var n=e;window.clearTimeout(e.resizeTimer),n.resizeTimer=window.setTimeout(function(){e.recognizer.resize(e.recognizerContext,t,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))},e.domElement)},e.configuration.resizeTriggerDelay)}),resize$3(e.smartGuide))}function launchWaitForIdle(e,t){e.recognizer&&e.recognizer.waitForIdle&&e.recognizerContext.initPromise.then(function(){e.recognizer.waitForIdle(e.recognizerContext,t,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function setPenStyle$1(e,t){e.recognizer&&e.recognizer.setPenStyle&&e.recognizerContext.initPromise.then(function(){e.recognizer.setPenStyle(e.recognizerContext,t,e.penStyle,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function setPenStyleClasses$1(e,t){e.recognizer&&e.recognizer.setPenStyleClasses&&e.recognizerContext.initPromise.then(function(){e.recognizer.setPenStyleClasses(e.recognizerContext,t,e.penStyleClasses,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}function setTheme$1(e,t){e.recognizer&&e.recognizer.setTheme&&e.recognizerContext.initPromise.then(function(){e.recognizer.setTheme(e.recognizerContext,t,e.theme,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})})}var Editor=function(){function e(t,n,r,o,i){classCallCheck(this,e),this.domElement=t,this.domElement.classList.add("ms-editor"),this.loader=document.createElement("div"),this.loader.classList.add("loader"),this.loader=this.domElement.appendChild(this.loader),this.error=document.createElement("div"),this.error.classList.add("error-msg"),this.error=this.domElement.appendChild(this.error),this.exportTimer=void 0,this.resizeTimer=void 0,this.notifyTimer=void 0,this.innerBehaviors=overrideDefaultBehaviors(i),this.configuration=n,this.smartGuide=createSmartGuide(this),this.localTheme="",this.theme=o,this.penStyle=r,this.penStyleClasses="",this.domElement.editor=this}return createClass(e,[{key:"getStats",value:function(){return computeStats(this.model)}},{key:"pointerDown",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pen",n=arguments[2];editorLogger.trace("Pointer down",e),window.clearTimeout(this.notifyTimer),window.clearTimeout(this.exportTimer),this.model=initPendingStroke(this.model,e,Object.assign({pointerType:t,pointerId:n},this.theme.ink,this.localPenStyle)),this.renderer.drawCurrentStroke(this.rendererContext,this.model,this.stroker)}},{key:"pointerMove",value:function(e){editorLogger.trace("Pointer move",e),this.model=appendToPendingStroke(this.model,e),this.renderer.drawCurrentStroke(this.rendererContext,this.model,this.stroker)}},{key:"pointerUp",value:function(e){editorLogger.trace("Pointer up",e),this.model=endPendingStroke(this.model,e,this.penStyle),this.renderer.drawModel(this.rendererContext,this.model,this.stroker),this.recognizer.addStrokes?addStrokes$1(this,this.model):recognizerCallback(this,void 0,this.model)}},{key:"removeStroke",value:function(e){this.model.strokeGroups.forEach(function(t){var n=t.strokes.map(function(e){return JSON.stringify(e)}).indexOf(JSON.stringify(e));-1!==n&&t.strokes.splice(n,1)});var t=this.model.rawStrokes.map(function(e){return JSON.stringify(e)}).indexOf(JSON.stringify(e));-1!==t&&this.model.rawStrokes.splice(t,1),this.renderer.drawModel(this.rendererContext,this.model,this.stroker),recognizerCallback(this,void 0,this.model),"DEMAND"!==this.configuration.triggers.exportContent&&launchExport(this,this.model)}},{key:"reDraw",value:function(e,t){var n=this;e.forEach(function(e){addStroke(n.model,e)}),t.forEach(function(e){e.strokes.forEach(function(t){addStrokeToGroup(n.model,t,e.penStyle)})}),this.renderer.drawModel(this.rendererContext,this.model,this.stroker),recognizerCallback(this,void 0,this.model)}},{key:"waitForIdle",value:function(){triggerCallbacks(this,void 0,Constants.EventType.IDLE),launchWaitForIdle(this,this.model)}},{key:"undo",value:function(){var e=this;editorLogger.debug("Undo current model",this.model),triggerCallbacks(this,void 0,Constants.EventType.UNDO),this.undoRedoManager.undo(this.undoRedoContext,this.model,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];manageRecognizedModel.apply(void 0,[e,n].concat(o))})}},{key:"redo",value:function(){var e=this;editorLogger.debug("Redo current model",this.model),triggerCallbacks(this,void 0,Constants.EventType.REDO),this.undoRedoManager.redo(this.undoRedoContext,this.model,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];manageRecognizedModel.apply(void 0,[e,n].concat(o))})}},{key:"clear",value:function(){var e=this;editorLogger.debug("Clear current model",this.model),triggerCallbacks(this,void 0,Constants.EventType.CLEAR),this.recognizer.clear(this.recognizerContext,this.model,function(t,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];recognizerCallback.apply(void 0,[e,t,n].concat(o))})}},{key:"convert",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DIGITAL_EDIT";this.canConvert&&(triggerCallbacks(this,void 0,Constants.EventType.CONVERT),launchConvert(this,this.model,e))}},{key:"setGuides",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.configuration.recognitionParams.v4.text.guides.enable=e,launchConfig(this,this.model)}},{key:"export_",value:function(e){this.canExport&&(triggerCallbacks(this,void 0,Constants.EventType.EXPORT),launchExport(this,this.model,e,Constants.Trigger.DEMAND))}},{key:"import_",value:function(e,t){triggerCallbacks(this,void 0,Constants.EventType.IMPORT),launchImport(this,this.model,e instanceof Blob?e:new Blob([e],{type:t}))}},{key:"getSupportedImportMimeTypes",value:function(){launchGetSupportedImportMimeTypes(this,this.model)}},{key:"pointerEvents",value:function(e){launchPointerEvents(this,this.model,e)}},{key:"resize",value:function(){editorLogger.debug("Resizing editor"),this.renderer.resize(this.rendererContext,this.model,this.stroker,this.configuration.renderingParams.minHeight,this.configuration.renderingParams.minWidth),launchResize(this,this.model)}},{key:"setThemeForFont",value:function(e){var t=!Object.keys(Constants.Languages).includes(e),n="hy_AM"===e,r=t||n?Constants.Languages.default:Constants.Languages[e],o=t||n?"1.2":"1.8";this.theme={".text":{"font-family":r,"line-height":o}}}},{key:"unload",value:function(){this.grabber&&this.grabber.detach(this.domElement,this.grabberContext),this.innerRenderer&&this.innerRenderer.detach(this.domElement,this.rendererContext)}},{key:"forceChange",value:function(){triggerCallbacks(this,void 0,Constants.EventType.CHANGED)}},{key:"configuration",set:function(e){this.loader.style.display="initial",this.error.style.display="none",this.innerConfiguration=overrideDefaultConfiguration(e),this.setThemeForFont(this.innerConfiguration.recognitionParams.v4.lang),this.behavior=this.behaviors.getBehaviorFromConfiguration(this.behaviors,this.innerConfiguration)},get:function(){return this.innerConfiguration}},{key:"penStyle",set:function(e){this.innerPenStyle=overrideDefaultPenStyle(e),this.localPenStyle=this.innerPenStyle,setPenStyle$1(this,this.model)},get:function(){return this.innerPenStyle}},{key:"penStyleClasses",set:function(e){this.innerPenStyleClasses=e,this.localPenStyle=this.theme["."+this.innerPenStyleClasses],setPenStyleClasses$1(this,this.model)},get:function(){return this.innerPenStyleClasses}},{key:"theme",set:function(e){this.innerTheme=overrideDefaultTheme(e),setTheme$1(this,this.model)},get:function(){return this.innerTheme}},{key:"behaviors",get:function(){return this.innerBehaviors}},{key:"behavior",set:function(e){e&&(this.grabber&&this.grabber.detach(this.domElement,this.grabberContext),this.innerBehavior=e,this.renderer=this.innerBehavior.renderer,this.recognizer=this.innerBehavior.recognizer,this.grabberContext=this.grabber.attach(this.domElement,this))},get:function(){return this.innerBehavior}},{key:"recognizer",set:function(e){var t=this;this.undoRedoContext=createUndoRedoContext(this.configuration),this.undoRedoManager=UndoRedoManager;var n=function(n){t.innerRecognizer=e,t.innerRecognizer&&(t.recognizerContext=createEmptyRecognizerContext(t),t.innerRecognizer.undo&&t.innerRecognizer.redo&&t.innerRecognizer.clear&&(t.undoRedoContext=t.recognizerContext,t.undoRedoManager=t.innerRecognizer),t.innerRecognizer.init(t.recognizerContext,n,function(e,n){for(var r=arguments.length,o=Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];editorLogger.debug("Recognizer initialized",n),t.loader.style.display="none",recognizerCallback.apply(void 0,[t,e,n].concat(o))}))};e&&(this.innerRecognizer?this.innerRecognizer.close(this.recognizerContext,this.model,function(e,r){for(var o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];editorLogger.info("Recognizer closed"),recognizerCallback.apply(void 0,[t,e,r].concat(i)),n(clearModel(r))}):(this.model=createModel(this.configuration),n(this.model)))},get:function(){return this.innerRecognizer}},{key:"renderer",set:function(e){e&&(this.innerRenderer&&this.innerRenderer.detach(this.domElement,this.rendererContext),this.innerRenderer=e,this.innerRenderer&&(this.rendererContext=this.innerRenderer.attach(this.domElement,this.configuration.renderingParams.minHeight,this.configuration.renderingParams.minWidth)))},get:function(){return this.innerRenderer}},{key:"grabber",get:function(){return this.behavior?this.behavior.grabber:void 0}},{key:"stroker",get:function(){return this.behavior?this.behavior.stroker:void 0}},{key:"callbacks",get:function(){return this.behavior?this.behavior.callbacks:void 0}},{key:"png",get:function(){return getImage(this.model,this.stroker)}},{key:"initialized",get:function(){return!!this.recognizerContext&&this.recognizerContext.initialized}},{key:"idle",get:function(){return this.recognizerContext.idle}},{key:"canUndo",get:function(){return this.undoRedoContext.canUndo}},{key:"canRedo",get:function(){return this.undoRedoContext.canRedo}},{key:"isEmpty",get:function(){return this.recognizerContext.isEmpty}},{key:"canClear",get:function(){return this.canUndo&&this.model.rawStrokes.length>0}},{key:"canConvert",get:function(){return this.canUndo&&this.canClear&&this.recognizer&&this.recognizer.convert}},{key:"possibleUndoCount",get:function(){return this.recognizerContext.possibleUndoCount}},{key:"undoStackIndex",get:function(){return this.recognizerContext.undoStackIndex}},{key:"canExport",get:function(){return this.canUndo&&this.canClear&&this.recognizer&&this.recognizer.getInfo().availableTriggers.exportContent.includes(Constants.Trigger.DEMAND)}},{key:"exports",get:function(){return this.model?this.model.exports:void 0}},{key:"supportedImportMimeTypes",get:function(){return this.recognizerContext.supportedImportMimeTypes}},{key:"eastereggs",get:function(){return eastereggs}}]),e}(),result={af_ZA:"Afrikaans",az_AZ:"Azərbaycanca",be_BY:"Беларуская",bg_BG:"Български",bs_BA:"Bosanski",ca_ES:"Català",ceb_PH:"Sinugboanon",cs_CZ:"Čeština",da_DK:"Dansk",de_AT:"Deutsch (Österreich)",de_DE:"Deutsch",el_GR:"Ελληνικά",en_CA:"English (Canada)",en_GB:"English (United Kingdom)",en_PH:"English (Philippines)",en_US:"English (United States)",es_CO:"Español (Colombia)",es_ES:"Español (España)",es_MX:"Español (México)",et_EE:"Eesti",eu_ES:"Euskara",fi_FI:"Suomi",fil_PH:"Filipino",fr_CA:"Français (Canada)",fr_FR:"Français (France)",ga_IE:"Gaeilge",gl_ES:"Galego",hr_HR:"Hrvatski",hu_HU:"Magyar",hy_AM:"Հայերեն",id_ID:"Bahasa Indonesia",is_IS:"Íslenska",it_IT:"Italiano",ja_JP:"日本語",ka_GE:"ქართული",kk_KZ:"Қазақша",ko_KR:"한국어",lt_LT:"Lietuvių",lv_LV:"Latviešu",mg_MG:"Malagasy",mk_MK:"Македонски",mn_MN:"Монгол",ms_MY:"Bahasa Melayu (Malaysia)",nl_BE:"Nederlands (België)",nl_NL:"Nederlands",no_NO:"Norsk (Bokmål)",pl_PL:"Polski",pt_BR:"Português (Brasil)",pt_PT:"Português (Portugal)",ro_RO:"Română",ru_RU:"Русский",sk_SK:"Slovenčina",sl_SI:"Slovenščina",sq_AL:"Shqip",sr_Cyrl_RS:"Српски",sr_Latn_RS:"Srpski",sv_SE:"Svenska",sw_TZ:"Kiswahili",tr_TR:"Türkçe",tt_RU:"Татарча",uk_UA:"Українська",vi_VN:"Tiếng Việt",zh_CN:"中文 (中国)",zh_HK:"中文 (香港)",zh_TW:"中文 (台灣)"},languages={result:result},languagesJson=Object.freeze({result:result,default:languages}),result$1={af_ZA:"Afrikaans",az_AZ:"Azərbaycanca",id_ID:"Bahasa Indonesia",ms_MY:"Bahasa Melayu (Malaysia)",bs_BA:"Bosanski",ca_ES:"Català",da_DK:"Dansk",de_DE:"Deutsch",de_AT:"Deutsch (Österreich)",et_EE:"Eesti",en_CA:"English (Canada)",en_GB:"English (United Kingdom)",en_US:"English (United States)",es_ES:"Español (España)",es_MX:"Español (México)",eu_ES:"Euskara",fr_CA:"Français (Canada)",fr_FR:"Français (France)",ga_IE:"Gaeilge",gl_ES:"Galego",hr_HR:"Hrvatski",it_IT:"Italiano",lv_LV:"Latviešu",lt_LT:"Lietuvių",hu_HU:"Magyar",nl_NL:"Nederlands",nl_BE:"Nederlands (België)",no_NO:"Norsk (Bokmål)",pl_PL:"Polski",pt_BR:"Português (Brasil)",pt_PT:"Português (Portugal)",ro_RO:"Română",sq_AL:"Shqip",sk_SK:"Slovenčina",sl_SI:"Slovenščina",sr_Latn_RS:"Srpski",fi_FI:"Suomi",sv_SE:"Svenska",th_TH:"Thaiไทย",vi_VN:"Tiếng Việt",tr_TR:"Türkçe",is_IS:"Íslenska",cs_CZ:"Čeština",el_GR:"Ελληνικά",be_BY:"Беларуская",bg_BG:"Български",mk_MK:"Македонски",mn_MN:"Монгол",ru_RU:"Русский",sr_Cyrl_RS:"Српски",tt_RU:"Татарча",uk_UA:"Українська",kk_KZ:"Қазақша",hy_AM:"Հայերեն",he_IL:"עברית",ur_PK:"اردو",ar:"العربية",fa_IR:"فارسی",hi_IN:"हिन्दी",ka_GE:"ქართული",zh_CN:"中文 (中国)",zh_TW:"中文 (台灣)",zh_HK:"中文 (香港)",ja_JP:"日本語",ko_KR:"한국어"},languagesV3={result:result$1},languagesJsonV3=Object.freeze({result:result$1,default:languagesV3});function register(e,t,n,r,o){return editorLogger.debug("Registering a new editor"),new Editor(e,t,n,r,o)}function getAvailableLanguageList(e){return"V4"===overrideDefaultConfiguration(e).recognitionParams.apiVersion?languagesJson:languagesJsonV3}var MyScript={Constants:Constants,DefaultConfiguration:defaultConfiguration,DefaultBehaviors:defaultBehaviors,DefaultPenStyle:defaultPenStyle,DefaultTheme:defaultTheme,register:register,getAvailableLanguageList:getAvailableLanguageList,LoggerConfig:log,Editor:Editor,InkModel:InkModel,RecognizerContext:RecognizerContext};export default MyScript;export{Constants,defaultConfiguration as DefaultConfiguration,defaultBehaviors as DefaultBehaviors,defaultPenStyle as DefaultPenStyle,defaultTheme as DefaultTheme,register,getAvailableLanguageList,log as LoggerConfig,Editor,InkModel,RecognizerContext};