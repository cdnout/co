"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _enzymeShallowEqual=_interopRequireDefault(require("enzyme-shallow-equal")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_airbnbPropTypes=require("airbnb-prop-types"),_reactWithStyles=require("react-with-styles"),_throttle=_interopRequireDefault(require("lodash/throttle")),_isTouchDevice=_interopRequireDefault(require("is-touch-device")),_noflip=_interopRequireDefault(require("../utils/noflip")),_getInputHeight=_interopRequireDefault(require("../utils/getInputHeight")),_OpenDirectionShape=_interopRequireDefault(require("../shapes/OpenDirectionShape")),_constants=require("../constants");function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){(0,_defineProperty2.default)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var FANG_PATH_TOP="M0,".concat(_constants.FANG_HEIGHT_PX," ").concat(_constants.FANG_WIDTH_PX,",").concat(_constants.FANG_HEIGHT_PX," ").concat(_constants.FANG_WIDTH_PX/2,",0z"),FANG_STROKE_TOP="M0,".concat(_constants.FANG_HEIGHT_PX," ").concat(_constants.FANG_WIDTH_PX/2,",0 ").concat(_constants.FANG_WIDTH_PX,",").concat(_constants.FANG_HEIGHT_PX),FANG_PATH_BOTTOM="M0,0 ".concat(_constants.FANG_WIDTH_PX,",0 ").concat(_constants.FANG_WIDTH_PX/2,",").concat(_constants.FANG_HEIGHT_PX,"z"),FANG_STROKE_BOTTOM="M0,0 ".concat(_constants.FANG_WIDTH_PX/2,",").concat(_constants.FANG_HEIGHT_PX," ").concat(_constants.FANG_WIDTH_PX,",0"),propTypes="production"!==process.env.NODE_ENV?(0,_airbnbPropTypes.forbidExtraProps)(_objectSpread({},_reactWithStyles.withStylesPropTypes,{id:_propTypes.default.string.isRequired,placeholder:_propTypes.default.string,displayValue:_propTypes.default.string,ariaLabel:_propTypes.default.string,screenReaderMessage:_propTypes.default.string,focused:_propTypes.default.bool,disabled:_propTypes.default.bool,required:_propTypes.default.bool,readOnly:_propTypes.default.bool,openDirection:_OpenDirectionShape.default,showCaret:_propTypes.default.bool,verticalSpacing:_airbnbPropTypes.nonNegativeInteger,small:_propTypes.default.bool,block:_propTypes.default.bool,regular:_propTypes.default.bool,onChange:_propTypes.default.func,onFocus:_propTypes.default.func,onKeyDownShiftTab:_propTypes.default.func,onKeyDownTab:_propTypes.default.func,onKeyDownArrowDown:_propTypes.default.func,onKeyDownQuestionMark:_propTypes.default.func,isFocused:_propTypes.default.bool})):{},defaultProps={placeholder:"Select Date",displayValue:"",ariaLabel:void 0,screenReaderMessage:"",focused:!1,disabled:!1,required:!1,readOnly:null,openDirection:_constants.OPEN_DOWN,showCaret:!1,verticalSpacing:_constants.DEFAULT_VERTICAL_SPACING,small:!1,block:!1,regular:!1,onChange:function(){},onFocus:function(){},onKeyDownShiftTab:function(){},onKeyDownTab:function(){},onKeyDownArrowDown:function(){},onKeyDownQuestionMark:function(){},isFocused:!1},DateInput=function(n){(0,_inheritsLoose2.default)(t,n);var e=t.prototype;function t(e){var t=n.call(this,e)||this;return t.state={dateString:"",isTouchDevice:!1},t.onChange=t.onChange.bind((0,_assertThisInitialized2.default)(t)),t.onKeyDown=t.onKeyDown.bind((0,_assertThisInitialized2.default)(t)),t.setInputRef=t.setInputRef.bind((0,_assertThisInitialized2.default)(t)),t.throttledKeyDown=(0,_throttle.default)(t.onFinalKeyDown,300,{trailing:!1}),t}return e[!_react.default.PureComponent&&"shouldComponentUpdate"]=function(e,t){return!(0,_enzymeShallowEqual.default)(this.props,e)||!(0,_enzymeShallowEqual.default)(this.state,t)},e.componentDidMount=function(){this.setState({isTouchDevice:(0,_isTouchDevice.default)()})},e.componentWillReceiveProps=function(e){this.state.dateString&&e.displayValue&&this.setState({dateString:""})},e.componentDidUpdate=function(e){var t=this.props,n=t.focused,o=t.isFocused;e.focused===n&&e.isFocused===o||n&&o&&this.inputRef.focus()},e.onChange=function(e){var t=this.props,n=t.onChange,o=t.onKeyDownQuestionMark,a=e.target.value;"?"===a[a.length-1]?o(e):this.setState({dateString:a},function(){return n(a)})},e.onKeyDown=function(e){e.stopPropagation(),_constants.MODIFIER_KEY_NAMES.has(e.key)||this.throttledKeyDown(e)},e.onFinalKeyDown=function(e){var t=this.props,n=t.onKeyDownShiftTab,o=t.onKeyDownTab,a=t.onKeyDownArrowDown,r=t.onKeyDownQuestionMark,i=e.key;"Tab"===i?(e.shiftKey?n:o)(e):"ArrowDown"===i?a(e):"?"===i&&(e.preventDefault(),r(e))},e.setInputRef=function(e){this.inputRef=e},e.render=function(){var e=this.state,t=e.dateString,n=e.isTouchDevice,o=this.props,a=o.id,r=o.placeholder,i=o.ariaLabel,s=o.displayValue,p=o.screenReaderMessage,u=o.focused,l=o.showCaret,d=o.onFocus,_=o.disabled,c=o.required,f=o.readOnly,h=o.openDirection,y=o.verticalSpacing,b=o.small,D=o.regular,g=o.block,T=o.styles,P=o.theme.reactDates,I=t||s||"",m="DateInput__screen-reader-message-".concat(a),w=l&&u,O=(0,_getInputHeight.default)(P,b);return _react.default.createElement("div",(0,_reactWithStyles.css)(T.DateInput,b&&T.DateInput__small,g&&T.DateInput__block,w&&T.DateInput__withFang,_&&T.DateInput__disabled,w&&h===_constants.OPEN_DOWN&&T.DateInput__openDown,w&&h===_constants.OPEN_UP&&T.DateInput__openUp),_react.default.createElement("input",(0,_extends2.default)({},(0,_reactWithStyles.css)(T.DateInput_input,b&&T.DateInput_input__small,D&&T.DateInput_input__regular,f&&T.DateInput_input__readOnly,u&&T.DateInput_input__focused,_&&T.DateInput_input__disabled),{"aria-label":void 0===i?r:i,type:"text",id:a,name:a,ref:this.setInputRef,value:I,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:d,placeholder:r,autoComplete:"off",disabled:_,readOnly:"boolean"==typeof f?f:n,required:c,"aria-describedby":p&&m})),w&&_react.default.createElement("svg",(0,_extends2.default)({role:"presentation",focusable:"false"},(0,_reactWithStyles.css)(T.DateInput_fang,h===_constants.OPEN_DOWN&&{top:O+y-_constants.FANG_HEIGHT_PX-1},h===_constants.OPEN_UP&&{bottom:O+y-_constants.FANG_HEIGHT_PX-1})),_react.default.createElement("path",(0,_extends2.default)({},(0,_reactWithStyles.css)(T.DateInput_fangShape),{d:h===_constants.OPEN_DOWN?FANG_PATH_TOP:FANG_PATH_BOTTOM})),_react.default.createElement("path",(0,_extends2.default)({},(0,_reactWithStyles.css)(T.DateInput_fangStroke),{d:h===_constants.OPEN_DOWN?FANG_STROKE_TOP:FANG_STROKE_BOTTOM}))),p&&_react.default.createElement("p",(0,_extends2.default)({},(0,_reactWithStyles.css)(T.DateInput_screenReaderMessage),{id:m}),p))},t}(_react.default.PureComponent||_react.default.Component);DateInput.propTypes="production"!==process.env.NODE_ENV?propTypes:{},DateInput.defaultProps=defaultProps;var _default=(0,_reactWithStyles.withStyles)(function(e){var t=e.reactDates,n=t.border,o=t.color,a=t.sizing,r=t.spacing,i=t.font,s=t.zIndex;return{DateInput:{margin:0,padding:r.inputPadding,background:o.background,position:"relative",display:"inline-block",width:a.inputWidth,verticalAlign:"middle"},DateInput__small:{width:a.inputWidth_small},DateInput__block:{width:"100%"},DateInput__disabled:{background:o.disabled,color:o.textDisabled},DateInput_input:{fontWeight:i.input.weight,fontSize:i.input.size,lineHeight:i.input.lineHeight,color:o.text,backgroundColor:o.background,width:"100%",padding:"".concat(r.displayTextPaddingVertical,"px ").concat(r.displayTextPaddingHorizontal,"px"),paddingTop:r.displayTextPaddingTop,paddingBottom:r.displayTextPaddingBottom,paddingLeft:(0,_noflip.default)(r.displayTextPaddingLeft),paddingRight:(0,_noflip.default)(r.displayTextPaddingRight),border:n.input.border,borderTop:n.input.borderTop,borderRight:(0,_noflip.default)(n.input.borderRight),borderBottom:n.input.borderBottom,borderLeft:(0,_noflip.default)(n.input.borderLeft),borderRadius:n.input.borderRadius},DateInput_input__small:{fontSize:i.input.size_small,lineHeight:i.input.lineHeight_small,letterSpacing:i.input.letterSpacing_small,padding:"".concat(r.displayTextPaddingVertical_small,"px ").concat(r.displayTextPaddingHorizontal_small,"px"),paddingTop:r.displayTextPaddingTop_small,paddingBottom:r.displayTextPaddingBottom_small,paddingLeft:(0,_noflip.default)(r.displayTextPaddingLeft_small),paddingRight:(0,_noflip.default)(r.displayTextPaddingRight_small)},DateInput_input__regular:{fontWeight:"auto"},DateInput_input__readOnly:{userSelect:"none"},DateInput_input__focused:{outline:n.input.outlineFocused,background:o.backgroundFocused,border:n.input.borderFocused,borderTop:n.input.borderTopFocused,borderRight:(0,_noflip.default)(n.input.borderRightFocused),borderBottom:n.input.borderBottomFocused,borderLeft:(0,_noflip.default)(n.input.borderLeftFocused)},DateInput_input__disabled:{background:o.disabled,fontStyle:i.input.styleDisabled},DateInput_screenReaderMessage:{border:0,clip:"rect(0, 0, 0, 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",width:1},DateInput_fang:{position:"absolute",width:_constants.FANG_WIDTH_PX,height:_constants.FANG_HEIGHT_PX,left:22,zIndex:s+2},DateInput_fangShape:{fill:o.background},DateInput_fangStroke:{stroke:o.core.border,fill:"transparent"}}},{pureComponent:void 0!==_react.default.PureComponent})(DateInput);exports.default=_default;