"use strict";var R=require("ramda"),axios=require("axios"),pjson=require("../package.json"),PlaidError=require("./PlaidError"),wrapPromise=require("./wrapPromise"),DEFAULT_TIMEOUT_IN_MILLIS=6e5,rejectWithPlaidError=function(e,r){return"Object"===R.type(r.data)?(r.data.status_code=r.status,e(new PlaidError(r.data))):e(new PlaidError({error_type:"API_ERROR",status_code:r.status,error_code:"INTERNAL_SERVER_ERROR",error_message:String(r.data),display_message:null,request_id:null}))},handleApiResponse=function(e,r,t,a){var s=t.data;return null!=t&&"Object"===R.type(s)&&(s.status_code=t.status),a&&200===t.status?e([null,s]):a&&210===t.status?e([s,null]):200===t.status?null!=t.headers["plaid-request-id"]&&null!=t.headers["content-type"]&&0===t.headers["content-type"].indexOf("application")?e({request_id:t.headers["plaid-request-id"],buffer:s}):e(s):rejectWithPlaidError(r,t)},plaidRequest=function(e,a,r,t){var s=e.env+a.path,i=R.merge(R.dissoc("env",e),a.body),e={"User-Agent":"Plaid Node v"+pjson.version};null!=r.version&&(e["Plaid-Version"]=r.version),null!=r.clientApp&&(e["Plaid-Client-App"]=r.clientApp);var n=R.merge({url:s,method:"POST",data:i,headers:e,timeout:DEFAULT_TIMEOUT_IN_MILLIS,responseType:a.binary?"arraybuffer":"json"},r);return wrapPromise(new Promise(function(r,t){axios(n).then(e=>{handleApiResponse(r,t,e,a.includeMfaResponse)}).catch(e=>e.response?rejectWithPlaidError(t,e.response):t(e))}),t)};module.exports=plaidRequest;