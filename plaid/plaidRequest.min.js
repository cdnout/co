"use strict";var R=require("ramda"),axios=require("axios"),pjson=require("../package.json"),PlaidError=require("./PlaidError"),wrapPromise=require("./wrapPromise"),DEFAULT_TIMEOUT_IN_MILLIS=6e5,rejectWithPlaidError=function(e,r){return"Object"===R.type(r.data)?(r.data.status_code=r.status,e(new PlaidError(r.data))):e(new PlaidError({error_type:"API_ERROR",status_code:r.status,error_code:"INTERNAL_SERVER_ERROR",error_message:String(r.data),display_message:null,request_id:null}))},handleApiResponse=function(e,r,t,a){var s=t.data;return null!=t&&"Object"===R.type(s)&&(s.status_code=t.status),a&&200===t.status?e([null,s]):a&&210===t.status?e([s,null]):200===t.status?null!=t.headers["plaid-request-id"]&&null!=t.headers["content-type"]&&0===t.headers["content-type"].indexOf("application")?e({request_id:t.headers["plaid-request-id"],buffer:s}):e(s):rejectWithPlaidError(r,t)},plaidRequest=function(e,r,t,a){var s=e.env+r.path,i=R.merge(R.dissoc("env",e),r.body),n={"User-Agent":"Plaid Node v"+pjson.version};null!=t.version&&(n["Plaid-Version"]=t.version),null!=t.clientApp&&(n["Plaid-Client-App"]=t.clientApp);var o=R.merge({url:s,method:"POST",data:i,headers:n,timeout:DEFAULT_TIMEOUT_IN_MILLIS,responseType:r.binary?"arraybuffer":"json"},t);return wrapPromise(new Promise(function(e,t){axios(o).then(a=>{handleApiResponse(e,t,a,r.includeMfaResponse)}).catch(e=>e.response?rejectWithPlaidError(t,e.response):t(e))}),a)};module.exports=plaidRequest;