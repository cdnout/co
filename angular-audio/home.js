"use strict";angular.module("ngAudio",[]).constant("ngAudioDomUid",function(){for(var e="",t=0;t<8;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e}()).directive("ngAudio",["$compile","$q","ngAudio",function(e,t,n){return{restrict:"AEC",scope:{volume:"=",start:"=",currentTime:"=",loop:"=",clickPlay:"=",disablePreload:"="},controller:["$scope","$attrs","$element","$timeout",function(e,t,o,i){function r(){u=n.load(t.ngAudio,e),e.$audio=u,u.unbind()}var u;e.disablePreload||r(),o.on("click",function(){!1!==e.clickPlay&&(e.disablePreload&&r(),u.audio.play(),u.volume=e.volume||u.volume,u.loop=e.loop,u.currentTime=e.start||0,i(function(){u.play()},5))}),o.on("$destroy",function(){u.destroy()})}]}}]).directive("ngAudioHover",["$compile","$q","ngAudio",function(e,t,n){return{restrict:"AEC",controller:["$scope","$attrs","$element","$timeout",function(e,t,o,i){var r=n.load(t.ngAudioHover,e);o.on("mouseover rollover hover",function(){r.audio.play(),r.volume=t.volumeHover||r.volume,r.loop=t.loop,r.currentTime=t.startHover||0}),o.on("$destroy",function(){r.destroy()})}]}}]).service("localAudioFindingService",["$q",function(e){this.find=function(t){var n=e.defer(),o=document.getElementById(t);return o?n.resolve(o):n.reject(t),n.promise}}]).service("remoteAudioFindingService",["$q","ngAudioDomUid",function(e,t){this.find=function(n){var o=e.defer(),i=document.getElementById(t);if(i)i.pause(),i.src=n,i.load();else{var r=document.createElement("audio");r.style.display="none",r.id=t,r.src=n,document.body.appendChild(r),(i=document.getElementById(t)).load()}return i?o.resolve(i):o.reject(id),o.promise}}]).service("cleverAudioFindingService",["$q","localAudioFindingService","remoteAudioFindingService",function(e,t,n){this.find=function(o){var i=e.defer();return o=o.replace("|","/"),t.find(o).then(i.resolve,function(){return n.find(o)}).then(i.resolve,i.reject),i.promise}}]).value("ngAudioGlobals",{muting:!1,performance:25,unlock:!0,volume:1}).factory("NgAudioObject",["cleverAudioFindingService","$rootScope","$interval","$timeout","ngAudioGlobals",function(e,t,n,o,i){return function(o,r){function u(){try{v.play(),v.pause()}catch(e){}window.removeEventListener("click",u)}function c(){k||(w&&n.cancel(w),m&&m(),d&&d(),k=!0)}function l(){k||(d=S.$watch(function(){return{volume:E.volume,currentTime:E.currentTime,progress:E.progress,muting:E.muting,loop:E.loop,playbackRate:E.playbackRate,globalVolume:i.volume}},function(e,t){e.currentTime!==t.currentTime&&E.setCurrentTime(e.currentTime),e.progress!==t.progress&&E.setProgress(e.progress),e.volume!==t.volume&&E.setVolume(e.volume),e.playbackRate!==t.playbackRate&&E.setPlaybackRate(e.playbackRate),e.globalVolume!==t.globalVolume&&(0===e.globalVolume?E.setMuting(!0):(E.setMuting(!1),E.setVolume(e.globalVolume))),g=e.loop,e.muting!==t.muting&&E.setMuting(e.muting)},!0))}function a(){E.error=!0}function s(){if(d&&d(),v){if(A||i.muting?v.volume=0:v.volume=void 0!==E.volume?E.volume:1,p&&(v.play(),p=!1),y&&(v.pause(),v.currentTime=0,y=!1),h&&(v.pause(),h=!1),b&&(v.playbackRate=$,b=!1),f&&(v.volume=f,f=void 0),T){E.currentTime=v.currentTime,E.duration=v.duration,E.remaining=v.duration-v.currentTime,E.progress=0,E.paused=v.paused,E.src=v.src;var e=(v.currentTime/v.duration).toPrecision();e>0&&(E.progress=e),E.currentTime>=E.duration&&M.forEach(function(e){e(E)}),P.forEach(function(e){E.duration-E.currentTime<=e.secs&&(e.callback(E),P.shift())}),g&&E.currentTime>=E.duration&&(!0!==g&&(g--,E.loop--),E.setCurrentTime(0),E.play())}A||i.muting||(E.volume=v.volume),E.audio=v}l()}var d,m,f,g,v,p=!1,h=!1,y=!1,b=!1,$=!1,A=!1,T=!0,k=!1,S=r||t,E=this;this.id=o,this.safeId=o.replace("/","|"),this.loop=0,this.unbind=function(){T=!1},this.play=function(){return p=!0,this};var M=[];this.complete=function(e){M.push(e)};var P=[];this.toFinish=function(e,t){P.push({secs:e,callback:t})},this.pause=function(){h=!0},this.restart=function(){y=!0},this.stop=function(){this.restart()},this.setVolume=function(e){f=e},this.setPlaybackRate=function(e){$=e,b=!0},this.setMuting=function(e){A=e},this.setProgress=function(e){v&&v.duration&&isFinite(e)&&(v.currentTime=v.duration*e)},this.setCurrentTime=function(e){v&&v.duration&&(v.currentTime=e)},this.destroy=c,S.$on("$destroy",function(){c()}),this.destroyed=function(){return k},e.find(o).then(function(e){v=e,i.unlock&&(window.addEventListener("click",u),v.addEventListener("playing",function(){window.removeEventListener("click",u)})),v.addEventListener("error",a),v.addEventListener("canplay",function(){E.canPlay=!0})},a);var w=n(s,i.performance);m=S.$watch(function(){return i.performance},function(){n.cancel(w),w=n(s,i.performance)})}}]).service("ngAudio",["NgAudioObject","ngAudioGlobals",function(e,t){this.play=function(t,n){var o=new e(t,n);return o.play(),o},this.load=function(t,n){return new e(t,n)},this.mute=function(){t.muting=!0},this.unmute=function(){t.muting=!1},this.toggleMute=function(){t.muting=!t.muting},this.setUnlock=function(e){t.unlock=e},this.setGlobalVolume=function(e){t.volume=e}}]).filter("trackTime",function(){return function(e){var t=Math.floor(0|e),n="",o=0,i=0,r=0;return t>3599?(o=Math.floor(t/3600),r=t-(60*(i=Math.floor((t-3600*o)/60))+3600*o),1==o.toString().length&&(o="0"+Math.floor(t/3600).toString()),1==i.toString().length&&(i="0"+Math.floor((t-3600*o)/60).toString()),1==r.toString().length&&(r="0"+(t-(60*i+3600*o)).toString()),n=o+":"+i+":"+r):t>59?(r=t-60*(i=Math.floor(t/60)),1==i.toString().length&&(i="0"+Math.floor(t/60).toString()),1==r.toString().length&&(r="0"+(t-60*i).toString()),n=i+":"+r):(1==(r=t).toString().length&&(r="0"+t.toString()),n=t+"s"),"function"==typeof Number.isNaN&&Number.isNaN(n),n}});