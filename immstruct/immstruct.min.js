/**
* immstruct v2.0.0
* A part of the Omniscient.js project
***************************************/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.immstruct=t()}}(function(){return function t(e,n,r){function i(u,s){if(!n[u]){if(!e[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[u]={exports:{}};e[u][0].call(f.exports,function(t){var n=e[u][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(t,e,n){"use strict";function r(){return this instanceof r?void(this._instances={}):new r}function i(t,e){if("object"==typeof e.key?(e.data=e.key,e.key=void 0):"number"==typeof e.key?(e.data=e.historyLimit,e.historyLimit=e.key,e.key=void 0):"object"==typeof e.historyLimit&&(e.data=e.historyLimit,e.historyLimit=void 0),e.key&&t._instances[e.key])return t._instances[e.key];var n=new o(e);return t._instances[n.key]=n,n}var o=t("./src/structure");r.prototype.get=function(t,e){return i(this,{key:t,data:e})},r.prototype.instance=function(t){return t?this._instances[t]:this._instances},r.prototype.clear=function(){this._instances={}},r.prototype.remove=function(t){return delete this._instances[t]},r.prototype.withHistory=function(t,e,n){return i(this,{key:t,data:n,history:!0,historyLimit:e})};var u=new r;e.exports=function(t,e){return i(u,{key:t,data:e})},e.exports.withHistory=function(t,e,n){return i(u,{key:t,data:n,history:!0,historyLimit:e})},e.exports.Structure=o,e.exports.Immstruct=r,e.exports.clear=u.clear.bind(u),e.exports.remove=u.remove.bind(u),e.exports.get=u.get.bind(u),e.exports.instance=function(t){return t?u._instances[t]:u._instances}},{"./src/structure":4}],2:[function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}var o="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.listeners=function(t,e){var n=o?o+t:t,r=this._events&&this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,u=r.length,s=new Array(u);u>i;i++)s[i]=r[i].fn;return s},i.prototype.emit=function(t,e,n,r,i,u){var s=o?o+t:t;if(!this._events||!this._events[s])return!1;var a,c,f=this._events[s],h=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),h){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,r),!0;case 5:return f.fn.call(f.context,e,n,r,i),!0;case 6:return f.fn.call(f.context,e,n,r,i,u),!0}for(c=1,a=new Array(h-1);h>c;c++)a[c-1]=arguments[c];f.fn.apply(f.context,a)}else{var p,d=f.length;for(c=0;d>c;c++)switch(f[c].once&&this.removeListener(t,f[c].fn,void 0,!0),h){case 1:f[c].fn.call(f[c].context);break;case 2:f[c].fn.call(f[c].context,e);break;case 3:f[c].fn.call(f[c].context,e,n);break;default:if(!a)for(p=1,a=new Array(h-1);h>p;p++)a[p-1]=arguments[p];f[c].fn.apply(f[c].context,a)}}return!0},i.prototype.on=function(t,e,n){var i=new r(e,n||this),u=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[u]?this._events[u].fn?this._events[u]=[this._events[u],i]:this._events[u].push(i):this._events[u]=i,this},i.prototype.once=function(t,e,n){var i=new r(e,n||this,!0),u=o?o+t:t;return this._events||(this._events=o?{}:Object.create(null)),this._events[u]?this._events[u].fn?this._events[u]=[this._events[u],i]:this._events[u].push(i):this._events[u]=i,this},i.prototype.removeListener=function(t,e,n,r){var i=o?o+t:t;if(!this._events||!this._events[i])return this;var u=this._events[i],s=[];if(e)if(u.fn)(u.fn!==e||r&&!u.once||n&&u.context!==n)&&s.push(u);else for(var a=0,c=u.length;c>a;a++)(u[a].fn!==e||r&&!u[a].once||n&&u[a].context!==n)&&s.push(u[a]);return s.length?this._events[i]=1===s.length?s[0]:s:delete this._events[i],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[o?o+t:t]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,"undefined"!=typeof e&&(e.exports=i)},{}],3:[function(t,e,n){function r(t,e,n){return 1===arguments.length?e=[]:"function"==typeof e?(n=e,e=[]):e=v(e),u(t,e,n)}function i(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function o(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function u(t,e,n,r){arguments.length<4&&(r=t.getIn(e));var u=r&&r.size,a=l.isIndexed(r)?o:i,c=new a(t,e,n,u);return r instanceof w&&s(c,r),c}function s(t,e){try{e._keys.forEach(a.bind(void 0,t))}catch(n){}}function a(t,e){Object.defineProperty(t,e,{get:function(){return this.get(e)},set:function(t){if(!this.__ownerID)throw new Error("Cannot set on an immutable record.")}})}function c(t,e,n){return l.isIterable(n)?f(t,e,n):n}function f(t,e,n){return arguments.length<3?u(t._rootData,p(t._keyPath,e),t._onChange):u(t._rootData,p(t._keyPath,e),t._onChange,n)}function h(t,e,n){var r=arguments.length>2,i=t._rootData.updateIn(t._keyPath,r?g():void 0,e),o=t._keyPath||[],s=t._onChange&&t._onChange.call(void 0,i,t._rootData,r?p(o,n):o);return void 0!==s&&(i=s),u(i,t._keyPath,t._onChange)}function p(t,e){return t.concat(d(e))}function d(t){return Array.isArray(t)?t:y.Iterable(t).toArray()}function v(t){return Array.isArray(t)?t:l.isIterable(t)?t.toArray():[t]}var y="undefined"!=typeof window?window.Immutable:"undefined"!=typeof global?global.Immutable:null,l=y.Iterable,m=l.Iterator,_=y.Seq,g=y.Map,w=y.Record,b=Object.create(_.Keyed.prototype),I=Object.create(_.Indexed.prototype);b.constructor=i,I.constructor=o,b.toString=function(){return this.__toString("Cursor {","}")},I.toString=function(){return this.__toString("Cursor [","]")},b.deref=b.valueOf=I.deref=I.valueOf=function(t){return this._rootData.getIn(this._keyPath,t)},b.get=I.get=function(t,e){return this.getIn([t],e)},b.getIn=I.getIn=function(t,e){if(t=d(t),0===t.length)return this;var n=this._rootData.getIn(p(this._keyPath,t),x);return n===x?e:c(this,t,n)},I.set=b.set=function(t,e){return h(this,function(n){return n.set(t,e)},[t])},I.push=function(){var t=arguments;return h(this,function(e){return e.push.apply(e,t)})},I.pop=function(){return h(this,function(t){return t.pop()})},I.unshift=function(){var t=arguments;return h(this,function(e){return e.unshift.apply(e,t)})},I.shift=function(){return h(this,function(t){return t.shift()})},I.setIn=b.setIn=g.prototype.setIn,b.remove=b["delete"]=I.remove=I["delete"]=function(t){return h(this,function(e){return e.remove(t)},[t])},I.removeIn=I.deleteIn=b.removeIn=b.deleteIn=g.prototype.deleteIn,b.clear=I.clear=function(){return h(this,function(t){return t.clear()})},I.update=b.update=function(t,e,n){return 1===arguments.length?h(this,t):this.updateIn([t],e,n)},I.updateIn=b.updateIn=function(t,e,n){return h(this,function(r){return r.updateIn(t,e,n)},t)},I.merge=b.merge=function(){var t=arguments;return h(this,function(e){return e.merge.apply(e,t)})},I.mergeWith=b.mergeWith=function(t){var e=arguments;return h(this,function(t){return t.mergeWith.apply(t,e)})},I.mergeIn=b.mergeIn=g.prototype.mergeIn,I.mergeDeep=b.mergeDeep=function(){var t=arguments;return h(this,function(e){return e.mergeDeep.apply(e,t)})},I.mergeDeepWith=b.mergeDeepWith=function(t){var e=arguments;return h(this,function(t){return t.mergeDeepWith.apply(t,e)})},I.mergeDeepIn=b.mergeDeepIn=g.prototype.mergeDeepIn,b.withMutations=I.withMutations=function(t){return h(this,function(e){return(e||g()).withMutations(t)})},b.cursor=I.cursor=function(t){return t=v(t),0===t.length?this:f(this,t)},b.__iterate=I.__iterate=function(t,e){var n=this,r=n.deref();return r&&r.__iterate?r.__iterate(function(e,r){return t(c(n,[r],e),r,n)},e):0},b.__iterator=I.__iterator=function(t,e){var n=this.deref(),r=this,i=n&&n.__iterator&&n.__iterator(m.ENTRIES,e);return new m(function(){if(!i)return{value:void 0,done:!0};var e=i.next();if(e.done)return e;var n=e.value,o=n[0],u=c(r,[o],n[1]);return{value:t===m.KEYS?o:t===m.VALUES?u:[o,u],done:!1}})},i.prototype=b,o.prototype=I;var x={};n.from=r},{immutable:void 0}],4:[function(t,e,n){(function(n){"use strict";function r(t){var e=this;return t=t||{},this instanceof r?(this.key=t.key||x.generateRandomKey(),this._queuedChange=!1,this.current=t.data,l(this.current)&&this.current||(this.current=w.fromJS(this.current||{})),t.history&&(this.history=w.List.of(this.current),this._currentRevision=0,this._historyLimit="number"==typeof t.historyLimit?t.historyLimit:1/0),this._referencelisteners=w.Map(),this.on("swap",function(t,n,r){r=r||[];var o=[t,n,r];i(e._referencelisteners,t,n,r,o)}),void I.call(this,arguments)):new r(t)}function i(t,e,n,r,o){if(!t||e===n)return void 0;if(t.get(k,[]).forEach(function(t){t.apply(null,o)}),r.length>0){var u=r[0],s=e&&e.get?e.get(u):void 0,a=n&&n.get?n.get(u):void 0;return i(t.get(u),s,a,r.slice(1),o)}t.forEach(function(t,r){if(r===k)return void 0;var u=e&&e.get?e.get(r):void 0,s=n&&n.get?n.get(r):void 0;i(t,u,s,[],o)})}function o(t,e,n){return t.updateIn(e.concat(k),w.OrderedSet(),function(t){return t.add(n)})}function u(t,e,n){return t.updateIn(e.concat(k),w.OrderedSet(),function(t){return t.remove(n)})}function s(t,e){return function(n,r,i){var o=e.apply(e,arguments);return t.history&&n!==r?(t.history=t.history.take(++t._currentRevision).push(t.current),t.history.size>t._historyLimit&&(t.history=t.history.takeLast(t._historyLimit),t._currentRevision-=t.history.size-t._historyLimit),o):o}}function a(t,e,n,r){return t._queuedChange?void 0:(t._queuedChange=!0,void O(function(){t._queuedChange=!1,t.emit("next-animation-frame",e,n,r)}))}function c(t,e){return function(n,r,i){var o=t.current,u=e.apply(e,arguments);return n===o?u:(t.emit("swap",u,o,i),a(t,u,o,i),u)}}function f(t,e){return function(n,r,i){var o=t.current,u=e.apply(e,arguments);if(n===o)return u;var s=h(n,o,i);return s.eventName&&(t.emit.apply(t,[s.eventName].concat(s.args)),t.emit("any",s.newObject,s.oldObject,i)),u}}function h(t,e,n){var r,i,o=e&&e.getIn(n),u=t&&t.getIn(n),s=e&&p(e,n),a=t&&p(t,n);return s&&!a?(i="delete",r=[o,n]):s&&a?(i="change",r=[u,o,n]):!s&&a&&(i="add",r=[u,n]),{eventName:i,args:r,newObject:u,oldObject:o}}function p(t,e){return t.hasIn?t.hasIn(e):t.getIn(e,L)!==L}function d(t,e){return function(n,r,i){var o=h(n,r,i);return o.eventName!==t&&"any"!==t?void 0:"any"===t?e.call(e,o.newObject,o.oldObject,i):e.apply(e,o.args)}}function v(t,e){return function(n,r,i){return e.call(this,n.getIn(t),r.getIn(t),i.slice(t.length))}}function y(t){return t&&"function"==typeof t.deref}function l(t){return D.some(function(e){return m(e.name,e.method,t)})}function m(t,e,n){return w[t]&&w[t][e]&&w[t][e](n)}function _(t){return"undefined"==typeof t?t:Array.isArray(t)?t:m("Iterable","isIterable",t)?t.toArray():[t]}function g(t,e){var n={};Object.getOwnPropertyNames(t.prototype).forEach(function(e){n[e]=Object.getOwnPropertyDescriptor(t.prototype,e)}),t.prototype=Object.create(e.prototype,n),t["super"]=e}var w="undefined"!=typeof window?window.Immutable:"undefined"!=typeof n?n.Immutable:null,b=t("immutable/contrib/cursor/index"),I=t("eventemitter3"),x=t("./utils"),k={};g(r,I),e.exports=r,r.prototype.cursor=function(t){var e=this;if(t=_(t)||[],!this.current)throw new Error("No structure loaded.");var n=function(t,n,r){return e.current===n?e.current=t:p(t,r)?e.current=e.current.setIn(r,t.getIn(r)):e.current=e.current.removeIn(r),e.current};return n=s(this,n),n=c(this,n),n=f(this,n),b.from(e.current,t,n)},r.prototype.reference=function(t){function e(){s=i.cursor(t)}function n(t,e){i._referencelisteners=o(i._referencelisteners,t,e)}function r(t,e){i._referencelisteners=u(i._referencelisteners,t,e)}y(t)&&t._keyPath&&(t=t._keyPath),t=_(t)||[];var i=this,s=this.cursor(t),a=w.Set();return n(t,e),{observe:function(e,i){return"function"==typeof e&&(i=e,e=void 0),this._dead||"function"!=typeof i?void 0:(i=e&&"swap"!==e?d(e,i):v(t,i),n(t,i),a=a.add(i),function(){r(t,i)})},cursor:function(t){return this._dead?void 0:(t=_(t),t?s.cursor(t):s)},reference:function(t){return t=_(t),i.reference((s._keyPath||[]).concat(t))},unobserveAll:function(n){return this._dead?void 0:(a.forEach(function(e){r(t,e)}),void(n&&r(t,e)))},destroy:function(){s=void 0,this.unobserveAll(!0),this._dead=!0,this.observe=void 0,this.unobserveAll=void 0,this.cursor=void 0,this.destroy=void 0,e=void 0,r=void 0,n=void 0}}},r.prototype.forceHasSwapped=function(t,e,n){this.emit("swap",t||this.current,e,n),a(this,t||this.current,e,n)},r.prototype.undo=function(t){return this._currentRevision-=t||1,this._currentRevision<0&&(this._currentRevision=0),this.current=this.history.get(this._currentRevision),this.current},r.prototype.redo=function(t){return this._currentRevision+=t||1,this._currentRevision>this.history.count()-1&&(this._currentRevision=this.history.count()-1),this.current=this.history.get(this._currentRevision),this.current},r.prototype.undoUntil=function(t){return this._currentRevision=this.history.indexOf(t),this.current=t,t};var O="undefined"!=typeof window&&window.requestAnimationFrame||x.raf,L={},D=[{name:"Iterable",method:"isIterable"},{name:"Seq",method:"isSeq"},{name:"Map",method:"isMap"},{name:"OrderedMap",method:"isOrderedMap"},{name:"List",method:"isList"},{name:"Stack",method:"isStack"},{name:"Set",method:"isSet"}]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":5,eventemitter3:2,"immutable/contrib/cursor/index":3}],5:[function(t,e,n){"use strict";e.exports.generateRandomKey=function(t){return t=t||10,Math.random().toString(36).substring(2).substring(0,t)},e.exports.raf=function(){for(var t="undefined"==typeof window?e:window,n=0,r=["webkit","moz"],i=0;i<r.length&&!t.requestAnimationFrame;++i)t.requestAnimationFrame=t[r[i]+"RequestAnimationFrame"];return function(t,e){var r=(new Date).getTime(),i=Math.max(0,16-(r-n)),o=setTimeout(function(){t(r+i)},i);return n=r+i,o}}()},{}]},{},[1])(1)});