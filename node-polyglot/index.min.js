"use strict";var forEach=require("for-each"),warning=require("warning"),has=require("has"),trim=require("string.prototype.trim"),warn=function(r){warning(!1,r)},replace=String.prototype.replace,split=String.prototype.split,delimiter="||||",russianPluralGroups=function(r){var e=r%100,t=e%10;return 11!=e&&1==t?0:2<=t&&t<=4&&!(12<=e&&e<=14)?1:2},defaultPluralRules={pluralTypes:{arabic:function(r){if(r<3)return r;var e=r%100;return 3<=e&&e<=10?3:11<=e?4:5},bosnian_serbian:russianPluralGroups,chinese:function(){return 0},croatian:russianPluralGroups,french:function(r){return 1<r?1:0},german:function(r){return 1!==r?1:0},russian:russianPluralGroups,lithuanian:function(r){return r%10==1&&r%100!=11?0:2<=r%10&&r%10<=9&&(r%100<11||19<r%100)?1:2},czech:function(r){return 1===r?0:2<=r&&r<=4?1:2},polish:function(r){if(1===r)return 0;var e=r%10;return 2<=e&&e<=4&&(r%100<10||20<=r%100)?1:2},icelandic:function(r){return r%10!=1||r%100==11?1:0},slovenian:function(r){var e=r%100;return 1==e?0:2==e?1:3==e||4==e?2:3}},pluralTypeToLanguages:{arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]}};function langToTypeMap(r){var t={};return forEach(r,function(r,e){forEach(r,function(r){t[r]=e})}),t}function pluralTypeName(r,e){var t=langToTypeMap(r.pluralTypeToLanguages);return t[e]||t[split.call(e,/-/,1)[0]]||t.en}function pluralTypeIndex(r,e,t){return r.pluralTypes[pluralTypeName(r,e)](t)}function escape(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function constructTokenRegex(r){var e=r&&r.prefix||"%{",t=r&&r.suffix||"}";if(e===delimiter||t===delimiter)throw new RangeError('"'+delimiter+'" token is reserved for pluralization');return new RegExp(escape(e)+"(.*?)"+escape(t),"g")}var defaultTokenRegex=/%\{(.*?)\}/g;function transformPhrase(r,e,t,n,i){if("string"!=typeof r)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return r;var s=r,o=n||defaultTokenRegex,a=i||defaultPluralRules,l="number"==typeof e?{smart_count:e}:e;if(null!=l.smart_count&&s){var u=split.call(s,delimiter);s=trim(u[pluralTypeIndex(a,t||"en",l.smart_count)]||u[0])}return s=replace.call(s,o,function(r,e){return has(l,e)&&null!=l[e]?l[e]:r})}function Polyglot(r){var e=r||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var t=e.allowMissing?transformPhrase:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:t,this.warn=e.warn||warn,this.tokenRegex=constructTokenRegex(e.interpolation),this.pluralRules=e.pluralRules||defaultPluralRules}Polyglot.prototype.locale=function(r){return r&&(this.currentLocale=r),this.currentLocale},Polyglot.prototype.extend=function(r,n){forEach(r,function(r,e){var t=n?n+"."+e:e;"object"==typeof r?this.extend(r,t):this.phrases[t]=r},this)},Polyglot.prototype.unset=function(r,n){"string"==typeof r?delete this.phrases[r]:forEach(r,function(r,e){var t=n?n+"."+e:e;"object"==typeof r?this.unset(r,t):delete this.phrases[t]},this)},Polyglot.prototype.clear=function(){this.phrases={}},Polyglot.prototype.replace=function(r){this.clear(),this.extend(r)},Polyglot.prototype.t=function(r,e){var t,n,i=null==e?{}:e;if("string"==typeof this.phrases[r])t=this.phrases[r];else if("string"==typeof i._)t=i._;else if(this.onMissingKey){n=(0,this.onMissingKey)(r,i,this.currentLocale,this.tokenRegex,this.pluralRules)}else this.warn('Missing translation for key: "'+r+'"'),n=r;return"string"==typeof t&&(n=transformPhrase(t,i,this.currentLocale,this.tokenRegex,this.pluralRules)),n},Polyglot.prototype.has=function(r){return has(this.phrases,r)},Polyglot.transformPhrase=function(r,e,t){return transformPhrase(r,e,t)},module.exports=Polyglot;