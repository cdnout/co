/*
	Matreshka v1.9.1 (2016-05-21)
	JavaScript Framework by Andrey Gubanov
	Released under the MIT license
	More info: http://matreshka.io
*/

!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;b=function(){var a="undefined"!=typeof document?document.documentMode:null;if(a&&9>a)throw Error("Internet Explorer "+a+" isn't supported");return function Class(a,b){var c,d=a.constructor!==Object?a.constructor:function EmptyConstructor(){},e=a["extends"]=a["extends"]||a.extend,f=Object.assign||function(a,b){if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(void 0!==e&&null!==e)for(var f=Object.keys(Object(e)),g=0,h=f.length;h>g;g++){var i=f[g],j=Object.getOwnPropertyDescriptor(e,i);void 0!==j&&j.enumerable&&(c[i]=e[i])}}return c};return c=Object.create(e?e.prototype:{}),f(c,a),b&&"object"==typeof b&&f(d,b),c.instanceOf=function(){return this instanceof d},d.prototype=c,this instanceof Class?new d:d}}(),c={},d=function(a){function PseudoMap(){}var b=function(a,b){var c,d;
if(a)for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a},c={extend:b,trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},randomString:function(){return((new Date).getTime()-new Date(2013,4,3).getTime()).toString(36)+Math.floor(1679616*Math.random()).toString(36)},toArray:function(a,b){var c,d=[],e=a.length;for(b=b||0,c=b;e>c;c++)d[c-b]=a[c];return d},debounce:function(a,b,c){var d;return"number"!=typeof b&&(c=b,b=0),function(){var e=arguments,f=this;clearTimeout(d),d=setTimeout(function(){a.apply(c||f,e)},b||0)}},each:function(a,b,c){if(a){if(a.isMK&&"function"==typeof a.each)a.each(b,c);else if("length"in a)[].forEach.call(a,b,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}},deepFind:function(a,b){var c,d="string"==typeof b?b.split("."):b,e=a;for(c=0;c<d.length;++c){if("undefined"==typeof e[d[c]])return;e=e[d[c]]}return e},noop:function(){},orderBy:function(a,b,c){var d,e,f,g,h="asc";if("length"in a&&"object"==typeof a){
for(c instanceof Array||(g=c||h),e=a.length,d=Array(e),f=0;e>f;f++)d[f]=a[f];return b?(b=b instanceof Array?b:[b],d.sort(function(a,d){var e,f,h,i=b.length;if(a&&d)for(e=0;i>e;e++){if(h=b[e],f="desc"!=(g||c[e])?-1:1,a[h]>d[h])return-f;if(a[h]<d[h])return f}return 0})):d}return[]}};return b(PseudoMap.prototype,{get:function(a){return a.matreshkaData},set:function(a,b){Object.defineProperty(a,"matreshkaData",{value:b,enumerable:!1,writable:!1,configurable:!1})},has:function(a){return"matreshkaData"in a}}),c.PseudoMap=PseudoMap,b(a,c),c}(c),e=function(a){"mk-"+a.randomString();return"undefined"==typeof WeakMap?new a.PseudoMap:new WeakMap}(d),f=function(a){var b,c=function(b,c,d){var e=b.length,f=0,g=a.toArray(b);c?g.forEach(function(a){var b=new FileReader;b.onloadend=function(c){a.readerResult=b.result,++f==e&&d(g)},b[c](a)}):d(g)},d=function(a){if("undefined"==typeof FileReader)throw Error("FileReader is not supported by this browser");if(a&&(a="readAs"+a[0].toUpperCase()+a.slice(1),!FileReader.prototype[a]))throw Error(a+" is not supported by FileReader");
return a};return a.binders=b={innerHTML:function(){return{on:"input",getValue:function(){return this.innerHTML},setValue:function(a){this.innerHTML=a+""}}},innerText:function(){return{on:"input",getValue:function(){return this.textContent},setValue:function(a){this.textContent=a+""}}},className:function(a){function addClass(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");c.test(a.className)||(a.className=(a.className+" "+b).replace(/\s+/g," ").replace(/(^ | $)/g,""))}function removeClass(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function hasClass(a,b){return new RegExp("(\\s|^)"+b+"(\\s|$)").test(a.className)}var b=0===a.indexOf("!");return b&&(a=a.replace("!","")),{on:null,getValue:function(){var c=this,d=c.classList?c.classList.contains(a):hasClass(c,a);return b?!d:!!d},setValue:function(c){var d=this,e=b?!c:!!c;d.classList?d.classList[e?"add":"remove"](a):e?addClass(d,a):removeClass(d,a)}}},property:function(a){
return{on:null,getValue:function(){return this[a]},setValue:function(b){try{this[a]=b}catch(c){}}}},attribute:function(a){return{on:null,getValue:function(){return this.getAttribute(a)},setValue:function(b){this.setAttribute(a,b)}}},dataset:function(a){function toDashed(a){return"data-"+a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}return{on:null,getValue:function(){var b=this;return b.dataset?b.dataset[a]:b.getAttribute(toDashed(a))},setValue:function(b){var c=this;c.dataset?c.dataset[a]=b:c.setAttribute(toDashed(a),b)}}},textarea:function(){return b.input("text")},progress:function(){return b.input()},input:function(a,b){var c;switch(a){case"checkbox":return{on:"click keyup",getValue:function(){return this.checked},setValue:function(a){this.checked=a}};case"radio":return{on:"click keyup",getValue:function(){return this.value},setValue:function(a){this.checked="undefined"!=typeof a&&this.value==a}};case"submit":case"button":case"image":case"reset":return{};case"hidden":c=null;
break;case"file":c="change";break;default:c="input"}return{on:c,getValue:function(){return this.value},setValue:function(a){this.value=a}}},output:function(){return{on:null,getValue:function(){var a=this;return a.value||a.textContent},setValue:function(a){var b=this;b["form"in b?"value":"textContent"]=null===a?"":a+""}}},select:function(a){var b;return a?{on:"change",getValue:function(){for(var a=0,b=this.options,c=[];b.length>a;a++)b[a].selected&&c.push(b[a].value);return c},setValue:function(a){for(a="string"==typeof a?[a]:a,b=this.options.length-1;b>=0;b--)this.options[b].selected=~a.indexOf(this.options[b].value)}}:{on:"change",getValue:function(){return this.value},setValue:function(a){var c,d=this;if(d.value=a,!a)for(c=d.options,b=c.length-1;b>=0;b--)c[b].value||(c[b].selected=!0)}}},display:function(a){return a="undefined"==typeof a?!0:a,{on:null,getValue:function(){var b=this,c=b.style.display||(window.getComputedStyle?getComputedStyle(b,null).getPropertyValue("display"):b.currentStyle.display),d="none"==c;
return a?!d:!!d},setValue:function(b){this.style.display=a?b?"":"none":b?"none":""}}},style:function(a){return{on:null,getValue:function(){var b=this;return b.style[a]||getComputedStyle(b,null).getPropertyValue(a)},setValue:function(b){this.style[a]=b}}},file:function(a){return a=d(a),{on:function(b){this.addEventListener("change",function(){var d=this.files;d.length?c(d,a,b):b([])})},getValue:function(a){var b=a.domEvent||[];return this.multiple?b:b[0]||null},setValue:null}},dropFiles:function(a){return a=d(a),{on:function(b){this.addEventListener("drop",function(d){d.preventDefault();var e=d.dataTransfer.files;e.length?c(e,a,b):b([])}),this.addEventListener("dragover",function(a){a.preventDefault(),a.dataTransfer.dropEffect="copy"})},getValue:function(a){return a.domEvent||[]},setValue:null}},dragOver:function(){return{on:"dragover dragenter dragleave dragend drop",getValue:function(a){var b=a.domEvent&&a.domEvent.type;return"dragover"==b||"dragenter"==b},setValue:null}}},b.visibility=b.display,
b.html=b.innerHTML,b.text=b.innerText,b.prop=b.property,b.attr=b.attribute,b}(c),g=function(){function $b(a,b){return new $b.i(a,b)}if("undefined"!=typeof window){var a=/\.(.+)/,b={},c=0,d=[];return $b.i=function(a,b){var c,d,e;if(a&&(a.nodeType||a==window?c=[a]:"string"==typeof a?/</.test(a)?c=$b.parseHTML(a):b?(b=$b(b)[0])&&(c=b.querySelectorAll(a)):c=document.querySelectorAll(a):a instanceof Function?"loading"==document.readyState?document.addEventListener("DOMContentLoaded",a):a():c=a),d=c&&c.length)for(e=0;d>e;e++)this.push(c[e])},$b.fn=$b.i.fn=$b.i.prototype=d,$b.extend=function(a){var b,c,d,e=arguments;for(b=1;b<e.length;b++)if(d=e[b])for(c in d)a[c]=d[c];return a},$b.extend(d,{is:function(a){var b=this[0];return b?(b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector||b.oMatchesSelector).call(b,a):!1},on:function(d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=this;for("function"==typeof e&&(f=e,e=null),e&&(g=function(a){var b,c,d="x"+String(Math.random()).split(".")[1],g=this;
g.setAttribute(d,d),b="["+d+'="'+d+'"] ',c=e.split(",").map(function(a){return b+a+","+b+a+" *"}).join(","),$b(a.target).is(c)&&f.call(g,a),g.removeAttribute(d)}),d=d.split(/\s/),o=0;o<d.length;o++)for(h=d[o].split(a),i=h[1],h=h[0],p=0;p<r.length;p++){for(j=r[p],k=j.b$=j.b$||++c,l=b[h+k]=b[h+k]||[],n=!1,q=0;q<l.length;q++)if(m=l[q],f==m.handler&&(!e||e==m.selector)){n=!0;break}n||(l.push({delegate:g,handler:f,namespace:i,selector:e}),j.addEventListener(h,g||f,!1))}return r},off:function(c,d,e){var f,g,h,i,j,k,l,m,n=this;for("function"==typeof d&&(e=d,d=null),c=c.split(/\s/),k=0;k<c.length;k++)for(f=c[k].split(a),g=f[1],f=f[0],l=0;l<n.length;l++)if(h=n[l],i=b[f+h.b$])for(m=0;m<i.length;m++)j=i[m],e&&e!=j.handler&&e!=j.delegate||g&&g!=j.namespace||d&&d!=j.selector||(h.removeEventListener(f,j.delegate||j.handler),i.splice(m--,1));else g||d||h.removeEventListener(f,e);return n},add:function(a){var b,d,e,f=$b(this),g={};for(a=$b(a),e=0;e<f.length;e++)d=f[e],b=d.b$=d.b$||++c,g[b]=1;for(e=0;e<a.length;e++)d=a[e],
b=d.b$=d.b$||++c,g[b]||(g[b]=1,f.push(d));return f},not:function(a){var b,c,d=$b(this);for(a=$b(a),c=0;c<a.length;c++)~(b=d.indexOf(a[c]))&&d.splice(b,1);return d},find:function(a){var b=$b();return this.forEach(function(c){b=b.add($b(a,c))}),b}}),$b.parseHTML=function(a){var b,c,d,e=document.createElement("div"),f={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_:[0,"",""]};for(a=a.replace(/^\s+|\s+$/g,""),f.optgroup=f.option,f.tbody=f.tfoot=f.colgroup=f.caption=f.thead,f.th=f.td,d=/<([\w:]+)/.exec(a),b=d&&f[d[1]]||f._,e.innerHTML=b[1]+a+b[2],c=b[0];c--;)e=e.children[0];return $b(e.childNodes)},$b.create=function create(a,b){var c,d,e,f;if("object"==typeof a&&(b=a,a=b.tagName),c=document.createElement(a),b)for(d in b)if(f=b[d],"attributes"==d&&"object"==typeof f)for(e in f)f.hasOwnProperty(e)&&c.setAttribute(e,f[e]);else{
if("tagName"==d)continue;if("children"==d&&f)for(e=0;e<f.length;e++)c.appendChild(create(f[e]));else if("object"==typeof c[d]&&null!==c[d]&&"object"==typeof b)for(e in f)f.hasOwnProperty(e)&&(c[d][e]=f[e]);else c[d]=f}return c},$b.one=function(a,b){return $b(a,b)[0]||null},$b}}(),h=function(a){if("undefined"!=typeof window){var b,c,d="on off is add not find".split(/\s/),e="function"==typeof window.$?window.$:null,f=!0;if(e){for(b=e.fn||e.prototype,c=0;c<d.length;c++)if(!b[d[c]]){f=!1;break}f&&!e.parseHTML&&(e.parseHTML=a.parseHTML)}else f=!1;return f?e:a}}(g),i=function(a,b,c){function noop(){return[]}a.$=c||noop,a.$b=a.balalaika=a.bQuery=a.bquery=b||noop,a.useAs$=function(b){return a.$=this.$=c=b}}(c,g,h),j=function(a,b){var c=a.initMK=function(a){return b.has(a)||b.set(a,{events:{},special:{},id:"mk"+Math.random()}),a};return function(a){return a._initMK?a._initMK():c(a),a}}(c,e),k=function(a,b){a._defineSpecial=function(c,d,e){if(!c||"object"!=typeof c||!b.has(c))return c;var f=b.get(c),g=f.special[d];
return g||(g=f.special[d]={$nodes:a.$(),value:c[d],getter:null,setter:null,mediator:null},e||"sandbox"==d||Object.defineProperty(c,d,{configurable:!0,enumerable:!0,get:function(){return g.getter?g.getter.call(c):g.value},set:function(b){g.setter?g.setter.call(c,b):a.set(c,d,b,{fromSetter:!0})}})),g}}(c,e),l=function(a,b){var c,d,e;c=a.define=function(a,b,d){if(!a||"object"!=typeof a)return a;var e;if("object"==typeof b){for(e in b)c(a,e,b[e]);return a}return Object.defineProperty(a,b,d),a},d=a.defineGetter=function(c,e,f){if(!c||"object"!=typeof c)return c;b(c);var g,h;if("object"==typeof e){for(g in e)e.hasOwnProperty(g)&&d(c,g,e[g]);return c}return h=a._defineSpecial(c,e),h.getter=function(){return f.call(c,{value:h.value,key:e,self:c})},c},e=a.defineSetter=function(c,d,f){if(!c||"object"!=typeof c)return c;b(c);var g;if("object"==typeof d){for(g in d)d.hasOwnProperty(g)&&e(c,g,d[g]);return c}return a._defineSpecial(c,d).setter=function(a){return f.call(c,a,{value:a,key:d,self:c})},c};
}(c,j),m=function(a,b,c,d){a.linkProps=function(e,f,g,h,i){function getEvtName(a){var b,c;return a.length>1?(c=a.length-1,b=a.slice(0,c).join(".")+"@_rundependencies:"+a[c]):b="_rundependencies:"+a,b}if(!e||"object"!=typeof e)return e;c(e);var j,k,l,m,n,o,p,q,r=typeof i,s=b.get(e);if(q=function(b){var c=[],o=b._protect;if(!o){o=b._protect=b._protect||{};for(m in i)b[m]=i[m]}if(!(f+s.id in o)){if("object"==typeof g[0])for(m=0;m<g.length;m+=2)for(j=g[m],l="string"==typeof g[m+1]?g[m+1].split(/\s/):g[m+1],n=0;n<l.length;n++)c.push(d.deepFind(j,l[n]));else for(m=0;m<g.length;m++)k=g[m],j=e,c.push(d.deepFind(j,k));o[b.key+s.id]=1,a._defineSpecial(e,f,i.hideProperty),a.set(e,f,h.apply(e,c),b)}},g="string"==typeof g?g.split(/\s+/):g,"boolean"==r&&(p=i),"object"!=r&&(i={}),"boolean"==r&&(i.setOnInit=p),i.fromDependency=!0,h=h||function(a){return a},q=i.debounce?d.debounce(q):q,"object"==typeof g[0])for(m=0;m<g.length;m+=2)for(j=c(g[m]),l="string"==typeof g[m+1]?g[m+1].split(/\s/):g[m+1],n=0;n<l.length;n++)o=l[n].split("."),
a[o.length>1?"on":"_fastAddListener"](j,getEvtName(o),q);else for(m=0;m<g.length;m++)k=g[m],j=e,o=k.split("."),a[o.length>1?"on":"_fastAddListener"](j,getEvtName(o),q);return i.setOnInit!==!1&&q.call("object"==typeof g[0]?g[0]:e,{key:"object"==typeof g[0]?g[1]:g[0]}),e}}(c,e,j,d),n=function(a,b){a.mediate=function(c,d,e){if(!c||"object"!=typeof c)return c;b(c);var f,g,h=typeof d;if("object"==h&&!(d instanceof Array)){for(f in d)d.hasOwnProperty(f)&&a.mediate(c,f,d[f]);return c}for(d="string"==h?d.split(/\s/):d,f=0;f<d.length;f++)(function(b){g=a._defineSpecial(c,b),g.mediator=function(a){return e.call(c,a,g.value,b,c)},a.set(c,b,g.mediator(g.value),{fromMediator:!0})})(d[f]);return c},a.setClassFor=function(c,d,e,f){if(!c||"object"!=typeof c)return c;b(c);var g,h=typeof d;if("object"==h&&!(d instanceof Array)){for(g in d)d.hasOwnProperty(g)&&a.setClassFor(c,g,d[g],e);return c}d="string"==h?d.split(/\s/):d,f=f||function(a,b){var c,d,e;if(a.isMKArray)a.recreate(b);else if(a.isMKObject){for(d=a.keys(),
e=[],c=0;c<d.length;c++)d[c]in b||e.push(d[c]);a.jset(b).removeDataKeys(e)}else for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};for(g=0;g<d.length;g++)a.mediate(c,d[g],function(a,b,d){var g;return b&&(b.instanceOf?b.instanceOf(e):b instanceof e)?(f.call(c,b,a,d),g=b):g=new e(a,c,d),g});return c}}(c,j),o=function(a,b){var c;a.get=function(a,b){return a&&a[b]},c=a.set=function(d,e,f,g){if(!d||"object"!=typeof d)return d;var h,i,j,k,l,m,n,o,p,q=typeof e,r=Number.isNaN||function(a){return"number"==typeof a&&isNaN(a)};if("undefined"==q)return d;if("object"==q){for(m in e)e.hasOwnProperty(m)&&c(d,m,e[m],f);return d}if(h=b.get(d),!h||!h.special[e])return d[e]=f,d;if(i=h.special[e],j=h.events,k=i.value,l=!i.mediator||f===k||g&&(g.skipMediator||g.fromMediator)?f:i.mediator(f,k,e,d),o=l!==k,n={originalEvent:g,value:l,previousValue:k,key:e,node:i.$nodes[0]||null,$nodes:i.$nodes,self:d,isChanged:o},g&&"object"==typeof g)for(m in g)n[m]=n[m]||g[m];return p=(o||n.force)&&!n.silent,p&&(j["beforechange:"+e]&&a._fastTrigger(d,"beforechange:"+e,n),
j.beforechange&&a._fastTrigger(d,"beforechange",n)),i.value=l,(o||n.force||n.forceHTML||l!==f&&!r(l))&&(n.silentHTML||j["_runbindings:"+e]&&a._fastTrigger(d,"_runbindings:"+e,n)),p&&(j["change:"+e]&&a._fastTrigger(d,"change:"+e,n),j.change&&a._fastTrigger(d,"change",n)),!o&&!n.force||n.skipLinks||j["_rundependencies:"+e]&&a._fastTrigger(d,"_rundependencies:"+e,n),d},a.remove=function(c,d,e){if(!c||"object"!=typeof c||"string"!=typeof d)return c;var f,g,h=d.split(/\s+/),i={keys:h},j=b.get(c);if(e&&"object"==typeof e)for(g in e)i[g]=e[g];for(g=0;g<h.length;g++)d=h[g],f=d in c,f&&(i.key=d,i.value=c[d],delete c[d],j&&(a.unbindNode(c,d),a.off(c,"change:"+d+" beforechange:"+d+" _runbindings:"+d+" _rundependencies:"+d),delete j.special[d],i.silent||(a._fastTrigger(c,"delete",i),a._fastTrigger(c,"delete:"+d,i))));return c}}(c,e),p=function(a,b,c,d){function initBinding(b,c,e,g,h,i,j,k){var l,m,n,o,p,q,r,s,t={self:b,key:e,$nodes:g,node:g[0]},u=g[h],v="undefined"==typeof k.value;if(null===i)l={};else if(n=f(u)){
if(i)for(p in i)n[p]=i[p];l=n}else l=i||{};if(l.initialize){o={value:k.value};for(p in t)o[p]=t[p];l.initialize.call(u,o)}if(l.getValue&&(v&&j.assignDefaultValue!==!1||j.assignDefaultValue===!0)){m={fromNode:!0};for(p in j)m[p]=j[p];s=l.getValue.call(u,t),v="undefined"==typeof s,a.set(b,e,s,m)}l.setValue&&(r=function(a){var b,d=c.special[e].value,f=a&&"string"==typeof a.onChangeValue&&"number"==typeof d?d+"":d;if(!a||a.changedNode!=u||a.onChangeValue!=f||a.binder!=l){o={value:d};for(b in t)o[b]=t[b];l.setValue.call(u,d,o)}},j.debounce&&(r=d.debounce(r)),a._fastAddListener(b,"_runbindings:"+e,r,null,{node:u}),!v&&r()),l.getValue&&l.on&&(q={node:u,on:l.on,instance:b,key:e,mkHandler:r,handler:function(c){if(!q.removed){var d,f,g=b[e],h={value:g,domEvent:c,originalEvent:c.originalEvent||c,preventDefault:function(){c.preventDefault()},stopPropagation:function(){c.stopPropagation()},which:c.which,target:c.target};for(f in t)h[f]=t[f];d=l.getValue.call(u,h),d!==g&&a.set(b,e,d,{fromNode:!0,changedNode:u,
onChangeValue:d,binder:l})}}},a.domEvents.add(q))}var e,f;e=a.defaultBinders=[function(b){var c,d=b.tagName,e=a.binders;return"INPUT"==d?c=e.input(b.type):"TEXTAREA"==d?c=e.textarea():"SELECT"==d?c=e.select(b.multiple):"PROGRESS"==d?c=e.progress():"OUTPUT"==d&&(c=e.output()),c}],f=a.lookForBinder=function(a){var b,c,d=e;for(c=0;c<d.length;c++)if(b=d[c].call(a,a))return b},a.bindOptionalNode=function(a,b,c,d,e){return"object"==typeof b?h(a,b,c,d,!0):h(a,b,c,d,e,!0),a};var g=a.bindSandbox=function(b,d,e){var f,g,h,i=a.$(d);if(c(b),!i.length)throw Error('Binding error: node is missing for "sandbox".'+("string"==typeof d?' The selector is "'+d+'"':""));if(g=a._defineSpecial(b,"sandbox"),g.$nodes=g.$nodes.length?g.$nodes.add(i):i,b.isMK&&(b.$sandbox=i,b.sandbox=i[0],b.$nodes.sandbox=g.$nodes,b.nodes.sandbox=g.$nodes[0]),!e||!e.silent){if(f={key:"sandbox",$nodes:i,node:i[0]||null},e)for(h in e)f[h]=e[h];a._fastTrigger(b,"bind:sandbox",f),a._fastTrigger(b,"bind",f)}return b},h=a.bindNode=function(d,e,f,i,j,k){
if(!d||"object"!=typeof d)return d;if("sandbox"==e)return g(d,f,j,k);c(d);var l,m,n,o,p,q,r,s=b.get(d),t="undefined"!=typeof window?window:null;if(e instanceof Array){for(n=0;n<e.length;n++)h(d,e[n][0],e[n][1],e[n][2]||j,f);return d}if("string"==typeof e&&~e.indexOf(" ")&&(m=e.split(/\s+/),m.length>1)){for(n=0;n<m.length;n++)h(d,m[n],f,i,j,k);return d}if("object"==typeof e){for(n in e)e.hasOwnProperty(n)&&h(d,n,e[n],f,i,j);return d}if(f&&2==f.length&&f!==t&&!f[1].nodeName&&(f[1].setValue||f[1].getValue))return h(d,e,f[0],f[1],i,k);if(l=a._getNodes(d,f),!l.length){if(k)return d;throw Error('Binding error: node is missing for "'+e+'".'+("string"==typeof f?' The selector is "'+f+'"':""))}if((!j||j.deep!==!1)&&~e.indexOf("."))return p=e.split("."),q=function(b){b=b&&b.originalEvent;var c,e=b&&b.value;if(!e)for(e=d,c=0;c<p.length-1;c++)e=e[p[c]];h(e,p[p.length-1],l,i,b,k),b&&b.previousValue&&a.unbindNode(b.previousValue,p[p.length-1],l)},a._delegateListener(d,p.slice(0,p.length-2).join("."),"change:"+p[p.length-2],q),
q(),d;for(j=j||{},o=a._defineSpecial(d,e),o.$nodes=o.$nodes.length?o.$nodes.add(l):l,d.isMK&&(d.$nodes[e]=o.$nodes,d.nodes[e]=o.$nodes[0]),n=0;n<l.length;n++)initBinding(d,s,e,l,n,i,j,o);if(!j.silent){r={key:e,$nodes:l,node:l[0]||null};for(n in j)r[n]=j[n];a._fastTrigger(d,"bind:"+e,r),a._fastTrigger(d,"bind",r)}return d}}(c,e,j,d),q=function(a,b,c){var d=a.unbindNode=function(e,f,g,h){if(!e||"object"!=typeof e)return e;c(e);var i,j,k,l,m,n,o=typeof f,p=b.get(e),q=p.special[f];if(f instanceof Array){for(k=0;k<f.length;k++)h=g,d(e,f[k][0],f[k][1]||h,h);return e}if("string"==o){if(j=f.split(/\s/),j.length>1){for(k=0;k<j.length;k++)d(e,j[k],g,h);return e}if(l=f.indexOf("."),~l){m=f.split(".");var r=e;for(k=0;k<m.length-1;k++)r=r[m[k]];return a._undelegateListener(e,m.slice(0,m.length-2),"change:"+m[m.length-2]),d(r,m[m.length-1],g,h),e}}if(null===f){for(f in p.special)p.special.hasOwnProperty(f)&&d(e,f,g,h);return e}if("object"==o){for(k in f)f.hasOwnProperty(k)&&d(e,k,f[k],g);return e}if(!g)return q&&q.$nodes?d(e,f,q.$nodes,h):e;
if(2==g.length&&!g[1].nodeName&&(g[1].setValue||g[1].getValue||g[1].on))return d(e,f,g[0],h);if(!q)return e;for(i=a._getNodes(e,g),k=0;k<i.length;k++)a.domEvents.remove({key:f,node:i[k],instance:e}),q.$nodes=q.$nodes.not(i[k]),function(b){a._removeListener(e,"_runbindings:"+f,null,null,{node:b,howToRemove:function(a,b){return a.node==b.node}})}(i[k]);if(e.isMK&&(e.$nodes[f]=q.$nodes,e.nodes[f]=q.$nodes[0]||null,"sandbox"==f&&(e.sandbox=q.$nodes[0]||null,e.$sandbox=q.$nodes)),!h||!h.silent){n={key:f,$nodes:i,node:i[0]||null};for(k in h)n[k]=h[k];a._fastTrigger(e,"unbind:"+f,n),a._fastTrigger(e,"unbind",n)}return e}}(c,e,j),r=function(a,b,c,d){function insertHTML(a,b,c){var d,e=b.previousSibling;try{e?e.insertAdjacentHTML("afterend",c):a.insertAdjacentHTML("afterbegin",c)}catch(f){d=document.body,e?(d.appendChild(e),e.insertAdjacentHTML("afterend",c),d.removeChild(e)):(d.appendChild(a),a.insertAdjacentHTML("afterbegin",c),d.removeChild(a))}}a.parserBrackets={left:"{{",right:"}}"};a.parseBindings=function(d,e){
function initLink(b,c,e){var f,g={};for(f=0;f<c.length;f++)g[c[f]]=new RegExp(k+c[f]+l,"g");a.linkProps(d,b,c,function(){var a,b=e;for(a=0;a<c.length;a++)b=b.replace(g[c[a]],arguments[a]);return b},{hideProperty:!0,setOnInit:!0})}var f,g=a.$,h=a.parserBrackets,i=h.left,j=h.right,k=i.replace(/(\[|\(|\?)/g,"\\$1"),l=j.replace(/(\]|\)|\?)/g,"\\$1"),m=new RegExp(k+"(.+?)"+l,"g"),n=new RegExp("^"+k+"(.+?)"+l+"$","g");if(!d||"object"!=typeof d)return g();if(c(d),f=b.get(d),"string"==typeof e)if(~e.indexOf("<")){if(!~e.indexOf(i))return g.parseHTML(e.replace(/^\s+|\s+$/g,""));e=g.parseHTML(e.replace(/^\s+|\s+$/g,""))}else e=a._getNodes(d,e);else if(e)e=g(e);else if(e=f&&f.special&&f.special.sandbox&&f.special.sandbox.$nodes,!e||!e.length)return d;var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=[],D=0;for(p=0;p<e.length;p++)if(r=e[p],!r.outerHTML||~r.outerHTML.indexOf(i)||~r.outerHTML.indexOf(encodeURI(i))){for(o=r.getElementsByTagName("*"),q=0;q<o.length;q++)C[D++]=o[q];C[D++]=r}if(!C.length)return g();for(q=0;q<C.length;q++)if(r=C[q],
"TEXTAREA"!=r.tagName)for(p=0;p<r.childNodes.length;p++)A=r.childNodes[p],3==A.nodeType&&~A.nodeValue.indexOf(i)&&(z=A.nodeValue.replace(m,'<span mk-html="$1"></span>'),insertHTML(r,A,z),r.removeChild(A));for(p=0;p<e.length;p++)for(o=e[p].querySelectorAll("[mk-html]"),q=0;q<o.length;q++)C[D++]=o[q];for(p=0;p<C.length;p++)for(r=C[p],s=r.getAttribute("mk-html"),s&&(r.removeAttribute("mk-html"),a.bindNode(d,s,r,{setValue:function(a){this.innerHTML=a}})),t=r.attributes,q=0;q<t.length;q++)u=t[q],v=u.value,w=u.name,B=v.match(m),B&&(x=B.map(function(a){return a.replace(m,"$1")}),1==x.length&&n.test(v)?y=x[0]:(y=a.randomString(),initLink(y,x,v)),("value"==w&&"checkbox"!=r.type&&"radio"!=r.type||"checked"==w&&("checkbox"==r.type||"radio"==r.type))&&a.lookForBinder(r)?(r.setAttribute(w,""),a.bindNode(d,y,r)):a.bindNode(d,y,r,a.binders.attr(w)));return e}}(c,e,j,d),s=function(a,b,c,d){function selectNodes(c,e){var f,g,h,i,j,k,l,m,n,o,p=b.get(c),q=a.$,r=q();if(!c||"object"!=typeof c||!p)return r;for(e=e.split(","),
j=0;j<e.length;j++)if(i=e[j],f=/\s*:bound\(([^(]*)\)\s*([\S\s]*)\s*|\s*:sandbox\s*([\S\s]*)\s*/.exec(i)){if(n=void 0!==f[3]?"sandbox":f[1],m=void 0!==f[3]?f[3]:f[2],g=p.special[n]&&p.special[n].$nodes,!g||!g.length)continue;if(m)if(0===m.indexOf(">"))for(k=0;k<g.length;k++)h=g[k],l="m"+a.randomString(),h.setAttribute(l,l),o=h.querySelectorAll("["+l+'="'+l+'"]'+m),r=r.add(d.toArray(o)),h.removeAttribute(l);else r=r.add(g.find(m));else r=r.add(g)}else r=r.add(i);return r}var e,f,g;e=a.selectAll=function(c,d){var e,f=b.get(c);return f&&"string"==typeof d?/:sandbox|:bound\(([^(]*)\)/.test(d)?selectNodes(c,d):(e=f.special,e=e&&e.sandbox&&e.sandbox.$nodes,e&&e.find(d)):a.$()},a.select=function(a,c){var d,e=b.get(a);return e&&"string"==typeof c?/:sandbox|:bound\(([^(]*)\)/.test(c)?selectNodes(a,c)[0]||null:(d=e.special,d=d&&d.sandbox&&d.sandbox.$nodes&&d.sandbox.$nodes[0],d&&d.querySelector(c)):null},f=a.boundAll=function(e,g){var h,i,j,k,l=a.$,m=b.get(e);if(!m)return l();if(g&&~g.indexOf("."))return i=g.split("."),
g=i.splice(-1)[0],f(d.deepFind(e,i),g);if(c(e),h=m.special,g=g?g:"sandbox",i="string"==typeof g?g.split(/\s+/):g,i.length<=1)return i[0]in h?h[i[0]].$nodes:l();for(j=l(),k=0;k<i.length;k++)j=j.add(h[i[k]].$nodes);return j},a.$bound=function(a,b){return f(a,b)},g=a.bound=function(a,e){var f,h,i,j=b.get(a);if(!j)return null;if(e&&~e.indexOf("."))return h=e.split("."),e=h.splice(-1)[0],g(d.deepFind(a,h),e);if(c(a),f=j.special,e=e?e:"sandbox",h="string"==typeof e?e.split(/\s+/):e,h.length<=1)return h[0]in f?f[h[0]].$nodes[0]||null:null;for(i=0;i<h.length;i++)if(h[i]in f&&f[h[i]].$nodes.length)return f[h[i]].$nodes[0];return null},a._getNodes=function(b,c){return"string"==typeof c&&!/</.test(c)&&/:sandbox|:bound\(([^(]*)\)/.test(c)?selectNodes(b,c):a.$(c)}}(c,e,j,d),t=/([^\:\:]+)(::([^\(\)]+)?(\((.*)\))?)?/,u=function(a,b,c,d){var e=function(a,b,c){var d,e=document;if(e.createEvent)d=e.createEvent("Event"),d.initEvent(b,!0,!0),d.mkArgs=c,a.dispatchEvent(d);else{if("undefined"==typeof Event)throw Error("Cannot trigger DOM event");
d=new Event(b,{bubbles:!0,cancelable:!0}),d.mkArgs=c,a.dispatchEvent(d)}return d};a.trigger=function(f,g){if(!f||"object"!=typeof f)return f;var h,i,j,k,l,m,n,o,p,q,r,s=b.get(f),t=s&&s.events;if(g&&t)for(h=c.toArray(arguments,2),g=g.split(/\s/),i=0;i<g.length;i++)if(n=g[i],~n.indexOf("::")){if(o=d.exec(n),p=s.special[o[3]||"sandbox"],p=p&&p.$nodes,q=a.$(),r=o[5])for(j=0;j<p.length;j++)q=q.add(p.find(r));else q=p;for(j=0;j<q.length;j++)e(q[i],o[1],h)}else if(l=t[n])for(j=-1,k=l.length;++j<k;)(m=l[j]).callback.apply(m.ctx,h);return f},a._fastTrigger=function(a,c,d){var e,f,g,h=b.get(a).events[c];if(h)for(e=-1,f=h.length;++e<f;)(g=h[e]).callback.call(g.ctx,d)}}(c,e,d,t),v=function(a,b,c){var d=a.on=function(e,f,g,h,i,j){if(!e||"object"!=typeof e)return e;b(e);var k,l,m,n,o;if("object"==typeof f&&!(f instanceof Array)){for(l in f)f.hasOwnProperty(l)&&d(e,l,f[l],g,h);return e}if(!g)throw Error('callback is not a function for event(s) "'+f+'"');for(f=f instanceof Array?f:c.trim(f).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),
"boolean"!=typeof h&&"undefined"!=typeof h&&(k=i,i=h,h=k),l=0;l<f.length;l++)m=f[l],o=m.lastIndexOf("@"),~o?(n=m.slice(0,o),n?~n.indexOf("@")&&(n=n.replace(/([^@]*)@/g,function(a,b){return(b||"*")+"."}).replace(/\.$/,".*")||"*"):n="*",m=m.slice(o+1),a._delegateListener(e,n,m,g,i||e,j)):a._addListener(e,m,g,i,j);return h===!0&&g.call(i||e,{triggeredOnInit:!0}),e}}(c,j,d),w=function(a,b,c,d){var e=a.off=function(b,f,g,h){if(!b||"object"!=typeof b)return b;var i,j,k,l,m=d.get(b);if(!m)return b;if("object"==typeof f&&!(f instanceof Array)){for(i in f)f.hasOwnProperty(i)&&e(b,i,f[i],g);return b}if(!f&&!g&&!h)return m.events={},b;if(f=c.trim(f).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"object"!=typeof b)return b;for(i=0;i<f.length;i++)l=f[i],k=l.lastIndexOf("@"),~k?(j=l.slice(0,k),l=l.slice(k+1).replace(/@/g,"."),a._undelegateListener(b,j,l,g,h)):a._removeListener(b,l,g,h);return b}}(c,j,d,e),x=/_rundependencies:|_runbindings:|change:/,y=function(a,b,c,d,e){var f;a._fastAddListener=function(b,e,f,g,h){
var i=c.get(b).events,j=i[e]||(i[e]=[]);return j.push({callback:f,context:g,ctx:g||b,name:e,node:h&&h.node}),d.test(e)&&a._defineSpecial(b,e.replace(d,"")),b},f=a._addListener=function(f,g,h,i,j){if(!f||"object"!=typeof f)return!1;b(f);var k,l,m,n,o=i||f,p=c.get(f).events,q=p[g]||(p[g]=[]),r=q.length,s={callback:h,context:i,ctx:o,name:g};for(k=0;r>k;k++)if(l=q[k],(l.callback==h||l.callback==h._callback)&&l.context==i)return!1;if(j){m={};for(k in j)m[k]=j[k];for(k in s)m[k]=s[k]}else m=s;return q.push(m),n=e.exec(g),n&&n[2]?a._addDOMListener(f,n[3]||"sandbox",n[1],n[5],h,o,m):d.test(g)&&a._defineSpecial(f,g.replace(d,"")),a._fastTrigger(f,"addevent:"+g,m),a._fastTrigger(f,"addevent",m),!0}}(c,j,e,x,t),z=function(a,b){var c=/([^\:\:]+)(::([^\(\)]+)(\((.*)\))?)?/;a._removeListener=function(d,e,f,g,h){if(!d||"object"!=typeof d)return d;var i,j,k,l,m,n,o,p,q=b.get(d),r=0;if(!q)return d;if(j=q.events[e]||[],k=q.events[e]=[],i=j.length,h=h||{},n=c.exec(e),n&&n[2])a._removeDOMListener(d,n[3],n[1],n[5],f,g);else{
for(m=0;i>m;m++)l=j[m],o=l.howToRemove||h.howToRemove,(o?!o(l,h):f&&f!==l.callback&&f._callback!==l.callback||g&&g!==l.context)?k[r++]=l:(p={name:e,callback:l.callback,context:l.context},a._fastTrigger(d,"removeevent:"+e,p),a._fastTrigger(d,"removeevent",p));k.length||delete q.events[e]}return d}}(c,e),A=function(a,b,c,d){var e=a._delegateListener=function(f,g,h,i,j,k){if(!f||"object"!=typeof f)return f;b(f);var l,m=c.get(f),n=/([^\.]+)\.(.*)/.exec(g),o=n?n[1]:g;g=n?n[2]:"",k=k||{},o?"*"==o?f.isMKArray?(l=function(a){(a&&a.added?a.added:f).forEach(function(a){a&&e(a,g,h,i,j,k)})},l._callback=i,a._addListener(f,"add",l,j,k),l()):f.isMKObject&&(l=function(a){var b=f[a.key];b&&a&&a.key in m.keys&&e(b,g,h,i,j,k)},f.each(function(a){e(a,g,h,i,j,k)}),l._callback=i,a._addListener(f,"change",l,j,k)):(l=function(b){if(!b||!b._silent){var l,m,n,p=f[o],q=!0;if(k.path=g,k.previousValue=b&&b.previousValue||k.previousValue&&k.previousValue[o],b&&b.previousValue&&c.has(b.previousValue)&&a._undelegateListener(b.previousValue,g,h,i,j,k),
"object"==typeof p&&p&&e(p,g,h,i,j,k),d.test(h)&&(l=h.replace(d,""),!g&&k.previousValue&&k.previousValue[l]!==p[l])){if(n=c.get(k.previousValue).events[h])for(m=0;m<n.length;m++)n[m].path===g&&(q=!1);q&&a.set(p,l,p[l],{force:!0,previousValue:k.previousValue[l],previousObject:k.previousValue,_silent:!0})}}},l._callback=i,a._addListener(f,"change:"+o,l,j,k),l()):a._addListener(f,h,i,j,k)}}(c,j,e,x),B=function(a,b){var c=a._undelegateListener=function(d,e,f,g,h,i){if(!d||"object"!=typeof d)return d;var j,k,l=/([^\.]+)\.(.*)/.exec(e),m=l?l[1]:e,n=e,o=b.get(d);if(e=l?l[2]:"",m)if("*"==m){if(d.isMKArray){if(g)c(d,e,"add",g,h,i);else for(j=o.events.add||[],k=0;k<j.length;k++)j[k].path==n&&c(d,e,"add",j[k].callback);d.forEach(function(a){a&&c(a,e,f,g,h)})}else if(d.isMKObject){if(g)c(d,e,"change",g,h);else for(j=o.events.change||[],k=0;k<j.length;k++)j[k].path==n&&c(d,e,"change",j[k].callback);d.each(function(a){a&&c(a,e,f,g,h)})}}else{if(g)a._removeListener(d,"change:"+m,g,h,i);else for(j=o.events["change:"+m]||[],
k=0;k<j.length;k++)j[k].path==n&&a._removeListener(d,"change:"+m,j[k].callback);"object"==typeof d[m]&&c(d[m],e,f,g,h,i)}else a._removeListener(d,f,g,h,i)}}(c,e),C=function(a,b){var c={};a.domEvents={add:function(d){var e=a.$,f=b.get(d.instance);d.node&&("function"==typeof d.on?d.on.call(d.node,d.handler):e(d.node).on(d.on.split(/\s+/).join(".mk ")+".mk",d.handler)),(c[f.id]=c[f.id]||[]).push(d)},remove:function(d){var e,f,g=b.get(d.instance),h=c[g.id],i=a.$;if(h)for(f=0;f<h.length;f++)e=h[f],e.node===d.node&&(e.mkHandler&&a._removeListener(d.instance,"_runbindings:"+d.key,e.mkHandler),"string"==typeof e.on&&i(d.node).off(e.on+".mk",e.handler),e.removed=!0,c[g.id].splice(f--,1))}}}(c,e),D=function(a,b,c){a._addDOMListener=function(d,e,f,g,h,i,j){if(!d||"object"!=typeof d)return d;b(d),g=g||null,j=j||{};var k=c.get(d),l=function(b){var c=this,f=a.$,g=f(c),j=b.originalEvent?b.originalEvent.mkArgs:b.mkArgs,k={self:d,node:c,$nodes:g,key:e,domEvent:b,originalEvent:b.originalEvent||b,preventDefault:function(){
b.preventDefault()},stopPropagation:function(){b.stopPropagation()},which:b.which,target:b.target};h.apply(i,j?j:[k])},m=f+"."+k.id+e,n=function(a){a&&a.$nodes&&a.$nodes.on(m,g,l)},o=function(a){a&&a.$nodes&&a.$nodes.off(m,g,l)};return l._callback=h,a._defineSpecial(d,e),n._callback=o._callback=h,a._addListener(d,"bind:"+e,n,i,j)&&a._addListener(d,"unbind:"+e,o,i,j)&&n({$nodes:k.special[e]&&k.special[e].$nodes}),d}}(c,j,e),E=function(a,b){a._removeDOMListener=function(c,d,e,f,g,h,i){if(!c||"object"!=typeof c)return c;var j=b.get(c);return j?(f=f||null,i=i||{},d&&j.special[d]&&(j.special[d].$nodes.off(e+"."+j.id+d,f,g),a._removeListener(c,"bind:"+d,g,h,i),a._removeListener(c,"unbind:"+d,g,h,i)),c):c}}(c,e),F=function(a,b){var c=a.once=function(d,e,f,g,h){var i;if(!d||"object"!=typeof d)return d;if("object"==typeof e){for(i in e)e.hasOwnProperty(i)&&c(d,i,e[i],f,g);return d}if(!f)throw Error('callback is not function for event "'+e+'"');for(b(d),e=e.split(/\s+/),i=0;i<e.length;i++)!function(b){
var c=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}(f);c._callback=f,a.on(d,b,c,g)}(e[i]);return d}}(c,j),G=function(a,b,c){var d=a.onDebounce=function(b,e,f,g,h,i,j){if(!b||"object"!=typeof b)return b;var k,l;if("object"==typeof e){for(l in e)e.hasOwnProperty(l)&&d(b,l,e[l],f,g,h,i);return b}return"number"!=typeof g&&(j=i,i=h,h=g,g=0),k=c.debounce(f,g),k._callback=f,a.on(b,e,k,h,i,j)}}(c,j,d),H=function(a,b){return a.map=b,a}(c,e),I=function(a,b){return{isMK:!0,on:function(b,c,d,e,f){return a.on(this,b,c,d,e,f)},onDebounce:function(b,c,d,e,f,g){return a.onDebounce(this,b,c,d,e,f,g)},once:function(b,c,d){return a.once(this,b,c,d)},off:function(b,c,d){return a.off(this,b,c,d)},trigger:function(){var b=a.toArray(arguments);return b.unshift(this),a.trigger.apply(a,b)},bindNode:function(b,c,d,e,f){return a.bindNode(this,b,c,d,e,f)},bindOptionalNode:function(b,c,d,e){return a.bindOptionalNode(this,b,c,d,e)},bindSandbox:function(b,c){return a.bindSandbox(this,b,c);
},unbindNode:function(b,c,d){return a.unbindNode(this,b,c,d)},boundAll:function(b){return a.boundAll(this,b)},$bound:function(b){return a.boundAll(this,b)},bound:function(b){return a.bound(this,b)},selectAll:function(b){return a.selectAll(this,b)},$:function(b){return a.selectAll(this,b)},select:function(b){return a.select(this,b)},defineGetter:function(b,c){return a.defineGetter(this,b,c)},defineSetter:function(b,c){return a.defineSetter(this,b,c)},mediate:function(b,c){return a.mediate(this,b,c)},setClassFor:function(b,c,d){return a.setClassFor(this,b,c,d)},linkProps:function(b,c,d,e){return a.linkProps(this,b,c,d,e)},get:function(a){return this[a]},set:function(b,c,d){return a.set(this,b,c,d)},remove:function(b,c){return a.remove(this,b,c)},define:function(b,c){return a.define(this,b,c)},delay:function(a,b,c){var d=this;return"object"==typeof b&&(c=b,b=0),setTimeout(function(){a.call(c||d)},b||0),d},parseBindings:function(b){return a.parseBindings(this,b)},_initMK:function(){var c=this;
return b.has(c)?c:(a.initMK(c),c.nodes={},c.$nodes={},c.sandbox=null,c.$sandbox=a.$(),c)},toString:function(){return"[object Matreshka]"},constructor:function Matreshka(){if(!(this instanceof Matreshka))throw new TypeError("Cannot call a class as a function");return this._initMK()}}}(H,e),J=function(a){return{version:"dev",Class:a}}(b),K=function(a,b,c,d){if(!a)throw Error("Class function is missing");d.to=function(a){var b,c;if("object"==typeof a)if("length"in a){for(b=[],c=0;c<a.length;c++)b[c]=e.to(a[c]);b=(new e.Array).recreate(b)}else{b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=e.to(a[c]));b=new e.Object(b)}else b=a;return b};var e=a(c,d);return e.setProto=function(a){var b="__proto__",c=e.prototype;return Object.setPrototypeOf?Object.setPrototypeOf(e.prototype,a):(b in e.prototype||Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(Object.prototype,b)),e.prototype[b]=a),e},b.extend(e.Matreshka=e.prototype.Matreshka=e,b)}(b,H,I,J),L=function(a,b){return{keys:function(){var b,c=this._initMK(),d=a.get(c).keys,e=[];
for(b in d)d.hasOwnProperty(b)&&e.push(b);return e},toObject:function(){var b,c=this._initMK(),d={},e=a.get(c).keys;for(b in e)e.hasOwnProperty(b)&&(d[b]=c[b]);return d},toNative:function(){return this.toObject()},toJSON:function(){var b,c=this._initMK(),d={},e=a.get(c).keys;for(b in e)e.hasOwnProperty(b)&&(d[b]=c[b]&&c[b].toJSON?c[b].toJSON():c[b]);return d},keyOf:function(b){var c,d=this._initMK(),e=a.get(d).keys;for(c in e)if(e.hasOwnProperty(c))if(b&&b.isMK){if(b.eq(d[c]))return c}else if(b===d[c])return c;return null},jset:function(c,d,e){var f,g=this._initMK(),h=typeof c,i=a.get(g);if("undefined"==h)return g;if(c&&"object"==h){c=c.toJSON?c.toJSON():c;for(f in c)i.keys[f]=1,b._defineSpecial(g,f),g.set(f,c[f],d);return g}return i.keys[c]=1,b._defineSpecial(g,c),g.set(c,d,e)},addDataKeys:function(c){var d,e,f=this._initMK(),g=a.get(f),h=arguments;if(!h.length||!c)return f;for(e=h.length>1?h:c instanceof Array?c:b.trim(c).split(/\s+/),d=0;d<e.length;d++)g.keys[e[d]]||(g.keys[e[d]]=1,b._defineSpecial(f,e[d]),
b._fastTrigger(f,"modify",{key:e[d],value:f[e[d]]}));return f},removeDataKeys:function(c){var d,e,f=this._initMK(),g=a.get(f),h=arguments;if(!h.length||!c)return f;for(c=h.length>1?h:c instanceof Array?c:b.trim(c).split(/\s+/),d=0;d<c.length;d++)g.keys[c[d]]&&(delete g.keys[c[d]],e={key:c[d],value:f[c[d]]},b._fastTrigger(f,"remove",e),b._fastTrigger(f,"modify",e));return f},each:function(b,c){var d,e=this._initMK(),f=a.get(e);for(d in f.keys)f.keys.hasOwnProperty(d)&&b.call(c,e[d],d,e);return e}}}(e,K),M=function(){var a=this,b=a.keys(),c=0;return{next:function(){return c>b.length-1?{done:!0}:{done:!1,value:a[b[c++]]}}}},N="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",O=function(a,b,c,d,e){if(!a)throw new Error("Matreshka is missing");var f={"extends":a,isMKObject:!0,renderer:null,constructor:function MatreshkaObject(a){if(!(this instanceof MatreshkaObject))throw new TypeError("Cannot call a class as a function");return this.jset(a)},_initMK:function(){var b,c,d=this;return e.has(d)?d:(a.prototype._initMK.call(d),
b=e.get(d),b.keys={},a._fastAddListener(d,"addevent:modify",function(e){c||(a._fastAddListener(d,"change",function(c){c&&c.key in b.keys&&!c.silent&&a._fastTrigger(d,"modify",c)}),a._fastAddListener(d,"delete",function(c){c&&c.key in b.keys&&(delete b.keys[c.key],c.silent||(a._fastTrigger(d,"remove",c),a._fastTrigger(d,"modify",c)))}),c=!0)}),d)},hasOwnProperty:function(a){return e.get(this._initMK()).keys.hasOwnProperty(a)}};return a.extend(f,b),f[d]=c,a.Object=a.Class(f)}(K,L,M,N,e),P=function(a,b,c){var d=function(b,d,e){var f,g,h,i=a.get(b),j=a.get(d),k=i.id,l=c.$,m=j.arraysNodes=j.arraysNodes||{},n=m[k],o=b.itemRenderer,p=d.renderer,q=p||o,r=q===p,s=r?d:b,t=j.rendererNode,u=j.rendererHasBindings,v=i.itemRendererNode,w=i.itemRendererHasBindings,x=b.useBindingsParser!==!1,y=!0,z=!1;if(q){if(e.moveSandbox)return(n=c.bound(d,["sandbox"]))&&(m[k]=n),n;if(n){if(!e.forceRerender)return n;for(g=c.boundAll(d,["sandbox"]),h=0;h<g.length;h++)if(n==g[h]){c.unbindNode(d,"sandbox",n);break}n=m[k]=null;
}if(e.forceRerender||"function"==typeof q||(t&&(n=u&&x?c.parseBindings(d,t.cloneNode(!0))[0]:t.cloneNode(!0)),v&&(n=w&&x?c.parseBindings(d,v.cloneNode(!0))[0]:v.cloneNode(!0))),!n){if("function"==typeof q&&(y=!1,q=q.call(s,d)),"string"==typeof q){if(!/</.test(q)){if(q=c._getNodes(s,q)[0],!q)throw Error("renderer node is missing");q=q.innerHTML}if(/{{/.test(q)&&(z=!0),q=l.parseHTML(c.trim(q)),q.length>1){for(f=document.createElement("span"),h=0;h<q.length;h++)f.appendChild(q[h]);q=f}else q=q[0]}y?r?(j.rendererNode=q,j.rendererHasBindings=z):(i.itemRendererNode=q,i.itemRendererHasBindings=z):r?(j.rendererNode=null,j.rendererHasBindings=!1):(i.itemRendererNode=null,i.itemRendererHasBindings=!1),n=z&&x?c.parseBindings(d,q.cloneNode(!0))[0]:q.cloneNode(!0)}return m[k]=n}},e=function(e,f,g){var h,i,j;if(f&&"object"==typeof f&&e.renderIfPossible&&!g.dontRender&&(b(f),j=a.get(f),i=d(e,f,g)))return f.bindRenderedAsSandbox!==!1&&c.bindSandbox(f,i),g.silent||(h={node:i,$nodes:c.$(i),self:f,parentArray:e
},f.onRender&&f.onRender(h),e.onItemRender&&e.onItemRender(f,h),c._fastTrigger(f,"render",h),j.events.afterrender&&setTimeout(function(){c._fastTrigger(f,"afterrender",h)},0)),i};return function(b,c){var d,f,g,h,i,j=a.get(b),k=j.id,l=b.length,m=c.added,n=c.removed,o=m&&m.length,p=n&&n.length,q=j.special.container||j.special.sandbox;if(q=q&&q.$nodes,q=q&&q[0],!q)return b;switch(c.method){case"push":for(g=l-o;l>g;g++)(d=e(b,b[g],c))&&q.appendChild(d);break;case"unshift":for(g=o-1;g+1;g--)(d=e(b,b[g],c))&&(q.firstChild?q.insertBefore(d,q.firstChild):q.appendChild(d));break;case"pull":case"pop":case"shift":for(g=0;p>g;g++)h=n[g],i=a.get(h),d=i.arraysNodes&&i.arraysNodes[k],d&&q.removeChild(d);break;case"sort":case"reverse":for(g=0;l>g;g++)h=b[g],i=a.get(h),(d=i&&i.arraysNodes[k])&&q.appendChild(d);break;case"rerender":if(c.forceRerender)for(g=0;l>g;g++)h=b[g],i=a.get(h),d=i&&i.arraysNodes&&i.arraysNodes[k],d&&q.removeChild(d);for(g=0;l>g;g++)(d=e(b,b[g],c))&&q.appendChild(d);break;case"recreate":
for(g=0;p>g;g++)h=n[g],i=a.get(h),d=i&&i.arraysNodes&&i.arraysNodes[k],d&&q.removeChild(d);for(g=0;l>g;g++)(d=e(b,b[g],c))&&q.appendChild(d);break;case"splice":for(f=b[c.args[0]<0?l+c.args[0]-o+p-1:c.args[0]-1],f=a.get(f),f=f&&f.arraysNodes,f=f&&f[k],f=f&&f.nextSibling,f=f||q.firstChild,g=0;o>g;g++)(d=e(b,m[g],c))&&q.insertBefore(d,f);for(g=0;p>g;g++)h=n[g],i=a.get(h),d=i&&i.arraysNodes&&i.arraysNodes[k],d&&q.removeChild(d)}return b}}(e,j,K),Q=function(a,b,c){return function(d,e,f){var g,h=e.added,i=e.removed,j=b.get(d).events,k=e.method,l=h.length||i.length||"sort"==k||"reverse"==k;if(!e.silent){if(f&&j[f]&&a._fastTrigger(d,f,e),h.length&&(j.add&&a._fastTrigger(d,"add",e),j.addone))for(g=0;g<h.length;g++)a._fastTrigger(d,"addone",{self:d,added:h[g]});if(i.length&&(j.remove&&a._fastTrigger(d,"remove",e),j.removeone))for(g=0;g<i.length;g++)a._fastTrigger(d,"removeone",{self:d,removed:i[g]});l&&j.modify&&a._fastTrigger(d,"modify",e)}l&&!e.dontRender&&c(d,e)}}(K,e,P),R=function(a,b){b=b||[];
var c,d=a.length-b.length;for(c=0;c<b.length;c++)a[c]=b[c];for(c=0;d>c;c++)a.remove(c+b.length,{silent:!0});return a.length=b.length,a},S=function(a,b,c,d){function createMethod(b,d){switch(b){case"forEach":return function(a,c){var d=this;return f[b].call(d,a,c),d};case"map":case"filter":case"slice":return function(c,d){var e=this;return a.Array.from(f[b].call(e,c,d))};case"every":case"some":return function(a,c){var d=this;return f[b].call(d,a,c)};case"join":return function(a){var c=this;return f[b].call(c,a||",")};case"indexOf":case"lastIndexOf":return function(a){var c=this;return f[b].call(c,a)};case"reduce":case"reduceRight":return function(){var a=this;return f[b].apply(a,arguments)};case"sort":case"reverse":return function(a,e){if(this.length<=1)return k;var g,h,i,j,k=this._initMK();g=d?("sort"==b&&e?e:a)||{}:{},h=f[b].call(k,a),j={method:b,self:k,added:[],removed:[]};for(i in g)j[i]=g[i];return c(k,j,b),k};case"pop":case"shift":return function(a){if(this.length){var e,g,h,i,j,k,l=this._initMK();
e=d?a||{}:{},g=f[b].call(l),k={method:b,self:l,added:h=[],removed:i=[g]};for(j in e)k[j]=e[j];return c(l,k,b),g}};case"push":case"unshift":return function(){var a,e,f,g=this._initMK(),h=arguments,i=new Array(h.length),j=g.length,k=i.length;for(e=0;k>e;e++)i[e]=h[e];if(a=d?i[k-1]||{}:{},d&&(i.pop(),k--),!k)return j;if(!a.skipMediator&&"function"==typeof g._itemMediator)for(e=0;k>e;e++)i[e]=g._itemMediator.call(g,i[e],"push"==b?e+j:e);if("push"==b)for(e=0;k>e;e++)g[j+e]=i[e];else if("unshift"==b){for(e=j-1;e>=0;e--)g[k+e]=g[e];for(e=0;k>e;e++)g[e]=i[e]}g.length=j+=k,f={method:b,self:g,added:i,removed:[]};for(e in a)f[e]=a[e];return c(g,f,b),j};case"splice":return function(){var e,g,h,i,j,k,l=this._initMK(),m=arguments,n=new Array(m.length),o=l.length,p=n.length,q=[];for(j=0;p>j;j++)n[j]=m[j];if(e=n[0],g=d?n[p-1]||{}:{},e=0>e?o+e:e,d&&(n.pop(),p--),!g.skipMediator&&"function"==typeof l._itemMediator)for(j=2;p>j;j++)n[j]=l._itemMediator.call(l,n[j],e+j-2);for(j=2;p>j;j++)j>=2&&(q[j-2]=n[j]);
if(h=f[b].apply(l,n),i=h,q.length||i.length){k={args:n,method:b,self:l,added:q,removed:i};for(j in g)k[j]=g[j];c(l,k,b)}return a.Array.from(h)}}}var e={},f=Array.prototype;b.toArray;return"push pop unshift shift sort reverse splice map filter slice every some reduce reduceRight forEach join indexOf lastIndexOf".split(" ").forEach(function(a){e[a]=createMethod(a)}),"push pop unshift shift sort reverse splice".split(" ").forEach(function(a){e[a+"_"]=createMethod(a,!0)}),e.each=e.forEach,e.concat=function(){var b,c,d,e=arguments,f=this.toArray();for(c=0;c<e.length;c++)if(b=e[c],b instanceof Array||b instanceof a.Array||b&&b.instanceOf&&b.instanceOf(a.Array))for(d=0;d<b.length;d++)f.push(b[d]);return a.Array.from(f)},e.toString=function(){return this.toArray().join(",")},e}(K,d,Q,R),T=function(a){return{of:function(){var b,c=new a.Array,d=arguments;for(c.length=d.length,b=0;b<d.length;b++)c[b]=d[b];return c},from:function(b,c,d){var e,f=new a.Array;for(f.length=b.length,e=0;e<b.length;e++)f[e]=c?c.call(d,b[e],e,b):b[e];
return f}}}(K),U=function(a,b,c,d,e,f){return{mediateItem:function(a){var b,c=this,d=c.length;for(c._itemMediator=a,b=0;d>b;b++)c[b]=a.call(c,c[b],b);return c},recreate:function(b,c){function update(a,b){var c;if(a.isMKArray)a.recreate(b);else if(a.isMKObject)a.jset(b);else for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}b=b||[];var e,f,g,h,i,j,k,l,m=this._initMK(),n=b.length,o=m.length,p=o-n,q=m.toArray(),r=m.trackBy;if(c=c||{},r)if(i={},"$index"==r)for(f=0;n>f;f++)b[f]=m[f]?update(m[f],b[f]):b[f];else{for(f=0;f<m.length;f++)i[m[f][r]]=m[f];for(f=0;n>f;f++)b[f][r]in i&&(b[f]=update(i[b[f][r]],b[f]))}if(m._itemMediator&&!c.skipMediator){for(e=[],f=0;n>f;f++)e[f]=m._itemMediator.call(m,b[f],f);b=e}for(f=0;n>f;f++)m[f]=b[f];for(f=0;p>f;f++)delete m[f+n],delete a.get(m).special[f+n];if(m.length=n,c.silent&&c.dontRender)return m;if(l=m.toArray(),l.length)if(q.length)for(k=[],g=0,f=0;f<q.length;f++)~l.indexOf(q[f])||(k[g++]=q[f]);else k=[];else k=q;if(q.length)if(l.length)for(j=[],g=0,f=0;f<l.length;f++)~q.indexOf(l[f])||(j[g++]=l[f]);else j=[];else j=l;
h={added:j,removed:k,was:q,now:l,method:"recreate",self:m};for(f in c)h[f]=c[f];return d(m,h,"recreate"),m},toArray:function(){var a,b=this,c=[],d=b.length;for(c=[],a=0;d>a;a++)c[a]=b[a];return c},toNative:function(){return this.toArray()},rerender:function(a){var b,d={method:"rerender"};if(a&&"object"==typeof a)for(b in a)d[b]=a[b];return c(this,d)},toJSON:function(){var a,b=this,c=[],d=b.length;for(a=0;d>a;a++)b[a]&&b[a].toJSON?c.push(b[a].toJSON()):c.push(b[a]);return c},pull:function(a,b){var c,f,g,h,i=this._initMK(),j=i.toArray(),k=a,l=typeof a;if("number"!=l&&"string"!=l&&(a=i.indexOf(a),!~a))return null;if(c=j.splice(a,1)[0]||null){if(e(i,j,b),g={returns:c,args:[k],method:"pull",self:i,added:[],removed:f=c?[c]:[]},b)for(h in b)g[h]=b[h];d(i,g,"pull")}return c},restore:function(c,d){var e,g,h,i,j,k,l,m,n,o=this._initMK(),p=a.get(o),q=p.id,r=o.Model;if(c?e=b._getNodes(o,c):(h=p.special.container||p.special.sandbox,h=h&&h.$nodes,h=h&&h[0],e=h&&h.children),e&&e.length){for(m=[],i=0;i<e.length;i++)g=e[i],
j=r?new r:{},f(j),k=p.arraysNodes={},k[q]=g,j.bindRenderedAsSandbox!==!1&&b.bindNode(j,"sandbox",g),d&&d.silent||(l={node:g,$nodes:b.$(g),self:j,parentArray:o},j.onRender&&j.onRender(l),o.onItemRender&&o.onItemRender(j,l),b._fastTrigger(j,"render",l)),m[i]=j;if(n={dontRender:!0},d)for(i in d)n[i]=d[i];o.recreate(m,n)}return o},orderBy:function(a,c,f){var g,h,i=this;if(i.length>1){if(e(i,b.orderBy(i,a,c)),g={method:"sort",self:i,added:[],removed:[]},f)for(h in f)g[h]=f[h];d(i,g,"sort")}return i}}}(e,K,P,Q,R,j),V=function(){var a=this,b=0;return{next:function(){return b>a.length-1?{done:!0}:{done:!1,value:a[b++]}}}},W=function(a,b,c,d,e,f,g,h,i){if(!a)throw new Error("Matreshka is missing");var j={"extends":a,isMKArray:!0,length:0,itemRenderer:null,renderIfPossible:!0,Model:null,constructor:function MatreshkaArray(a){if(!(this instanceof MatreshkaArray))throw new TypeError("Cannot call a class as a function");var b,c=this._initMK(),d=arguments.length;if(1==d&&"number"==typeof a)c.length=a;else{
for(b=0;d>b;b++)c[b]=arguments[b];c.length=d}return c},_initMK:function(){var c,d=this;if(b.has(d))return d;if("Model"in d&&null!==d.Model&&"function"!=typeof d.Model)throw Error('Only function or null are valid values for Model, not "'+typeof d.Model+'"');return c=function(){var a=d.Model;a&&d.mediateItem(function(b,c){return b&&(b.instanceOf?b.instanceOf(a):b instanceof a)?b:new a(b&&b.toJSON?b.toJSON():b,d,c)})},a.prototype._initMK.call(d),a._fastAddListener(d,"change:Model",c),a._fastAddListener(d,"change:itemRenderer",function(a){d.rerender({forceRerender:a&&"forceRerender"in a?a.forceRerender:!0})}),c(),d},toJSON:function(){var a,b=this,c=[],d=b.length;for(a=0;d>a;a++)b[a]&&b[a].toJSON?c[a]=b[a].toJSON():c[a]=b[a];return c},hasOwnProperty:function(a){return"length"==a||a<this.length&&a>=0}};return a.extend(j,c,e),j[i]=h,a.Array=a.Class(j,d),a.Array}(K,e,S,T,U,Q,P,V,N),X=function(a,b,c,d){return a}(K,O,W),Y=function(a){return a}(X),Y.version="1.9.1",function(){var b="define";"undefined"!=typeof a&&("function"==typeof define&&define.amd?(a[b]&&(a[b]("matreshka",function(){
return Y}),a[b]("bquery",function(){return Y.$b}),a[b]("balalaika",function(){return Y.$b}),a[b]("xclass",function(){return Y.Class}),a[b]("matreshka-magic",function(){return matreshka_magic})),define(function(){return Y})):"object"==typeof exports?module.exports=Y:(a.Matreshka=a.MK=Y,a.$b=Y.$b,a.Class=Y.Class))}()}("undefined"!=typeof window?window:Function("return this")());
//# sourceMappingURL=matreshka.min.map