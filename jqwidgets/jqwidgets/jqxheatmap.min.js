!function(i){i.jqx.jqxWidget("jqxHeatMap","",{}),i.extend(i.jqx._jqxHeatMap.prototype,{defineInstance:function(){var e={width:"auto",xAxis:{labels:[],opposedPosition:!1,isInversed:!1,minimum:null,maximum:null,labelFormat:"short"},yAxis:{labels:[],opposedPosition:!1,isInversed:!1},source:[],title:"Title",paletteSettings:{palette:[{value:0,color:"#5dc3f0",label:""},{value:50,color:"#4bb1de",label:""},{value:100,color:"#3885a6",label:""}],type:"Gradient",emptyPointColor:"#eee"},legendSettings:{position:"Right"},tooltipRender:null,_isXAxisInversed:!1,_isYAxisInversed:!1};return this===i.jqx._jqxHeatMap.prototype||i.extend(!0,this,e),e},createInstance:function(){var e=this;"NodeList"in window&&!NodeList.prototype.forEach&&(console.info("polyfill for IE11"),NodeList.prototype.forEach=function(e,t){t=t||window;for(var i=0;i<this.length;i++)e.call(t,this[i],i,this)}),e._setDefaultValues(),e._renderAllElements(),e._addHandlers()},_addHandlers:function(){var a=this;a.host.find(".jqx-heatmap-cell").on("mouseenter",function(e){var t=e.target,i=t.getAttribute("data-value");"Top"===a.legendSettings.position||"Bottom"===a.legendSettings.position?a._showLegendArrow("horizontal",i):a._showLegendArrow("vertical",i),a._hideTimer&&clearTimeout(a._hideTimer),a._showTooltip(e.target),t.classList.toggle("jqx-opacity-50")}),a.host.find(".jqx-heatmap-cell").on("mouseleave",function(){var e=event.target;a._arrow.style.display="",e.classList.toggle("jqx-opacity-50"),e=setTimeout(function(){a._tooltipContainer.classList.add("jqx-heatmap-hidden")},300),a._hideTimer=e}),a.host.find(".jqx-color-container, .jqx-color-container-tick").on("click",function(){var e=i(this).attr("data-value"),t=i(this).attr("data-color-index");a._hideCells(t),a._toggleClass("jqx-color-container","jqx-selected-color",e),a._toggleClass("jqx-color-container-tick","jqx-opacity-50",e)})},_setDefaultValues:function(){var e=this,t=Object.keys(e.xAxis),i=Object.keys(e.yAxis),a=Object.keys(e.legendSettings),n=Object.keys(e.paletteSettings);-1===t.indexOf("labels")&&(e.xAxis.labels=[]),-1===t.indexOf("opposedPosition")&&(e.xAxis.opposedPosition=!1),-1===t.indexOf("isInversed")&&(e.xAxis.isInversed=!1),-1===i.indexOf("opposedPosition")&&(e.yAxis.opposedPosition=!1),-1===i.indexOf("isInversed")&&(e.yAxis.isInversed=!1),-1===a.indexOf("position")&&(e.legendSettings.position="Right"),-1===n.indexOf("type")&&(e.paletteSettings.type="Gradient"),-1===n.indexOf("palette")&&(e.paletteSettings.palette=[{value:0,color:"#5dc3f0",label:""},{value:50,color:"#4bb1de",label:""},{value:100,color:"#3885a6",label:""}]),-1===n.indexOf("emptyPointColor")&&(e.paletteSettings.emptyPointColor="#eee")},_showTooltip:function(e){var t=this,i=document.createElement("div"),a=e.getAttribute("data-value"),n=e.getAttribute("data-date"),s=e.getAttribute("data-column"),r=t.xAxis.labels[s],l=e.getAttribute("data-row"),o=t.yAxis.labels[l],s=r+" | "+o+" : "+a,l=e.offsetWidth;t._tooltipContainer||(t._tooltipContainer=i),t.element.appendChild(t._tooltipContainer),t._tooltipContainer.classList.remove("jqx-heatmap-hidden"),t._tooltipContainer.className="jqx-heatmap-tooltip",t.tooltipRender&&(o=t.xAxis.minimum&&t.xAxis.maximum?{xLabel:r,yLabel:o,value:a,date:n,content:s}:{xLabel:r,yLabel:o,value:a,content:s},t.tooltipRender(o),s=o.content),t.xAxis.minimum&&t.xAxis.maximum?t._tooltipContainer.innerHTML=a+" on "+t._defaultDateTooltipFormat(new Date(n)):t._tooltipContainer.innerHTML=s,n=t._tooltipContainer.offsetWidth,s=t._tooltipContainer.offsetHeight,l=n-l,t._tooltipContainer.style.top=e.offsetTop-s+10+"px",t._tooltipContainer.style.left=0<l?e.offsetLeft-l/2+"px":e.offsetLeft+Math.abs(l)/2+"px"},_defaultDateTooltipFormat:function(e){return new Intl.DateTimeFormat("en-US",{day:"numeric",weekday:"short",month:"short",year:"numeric"}).format(e)},_getAllDates:function(){for(var e=this,t=new Date(e.xAxis.minimum),i=new Date(e.xAxis.maximum),a=e.source[0].length,n=[],s=[],r=t,l=0;r<=i;r.setDate(r.getDate()+1),l++)l<a?s.push(r.toISOString()):(n.push(s),e._addMonthLabel(s),l=0,(s=[]).push(r.toISOString()));e._dateArray=n},_addMonthLabel:function(e){var t={month:this.xAxis.labelFormat},t=new Intl.DateTimeFormat("en-US",t),e=new Date(e[0]),e=t.format(e);this.xAxis.labels.push(e)},_renderGrid:function(){var e=this,t=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div");t.className="jqx-heatmap-grid",i.className="jqx-x-axis-container",a.className="jqx-y-axis-container",n.className="jqx-heatmap-container-wrapper",e._setAxisOrigin();for(var s=0,r=e.source.length;s<r;s++){var l=document.createElement("div"),o=e.source[s];e._setGridColumn(l,s,r);for(var d=0,c=o.length;d<c;d++){var x=document.createElement("div");e._setGridCell(x,s,d,o),l.appendChild(x)}t.appendChild(l)}n.style.width=e._toPx(e.width),i.appendChild(t),a.appendChild(i),n.appendChild(a),e._gridXAxisContainer=i,e._gridYAxisContainer=a,e._gridContainerWrapper=n,e.element.appendChild(n)},_renderAxis:function(e,t,i,a){for(var n=this,s=document.createElement("div"),r=n.element.querySelector(".jqx-heatmap-grid").offsetHeight,l=0,o=t.length;l<o;l++){var d,c=t[l],x=document.createElement("div");x.innerHTML=c,x.className=a,"x"===e?(x.style.width="calc(100% /"+o+")",n.xAxis.minimum&&n.xAxis.maximum&&(d=n.source.length,d=c.duplicates/d*100,x.innerHTML=c.name,x.style.width=d+"%",n.xAxis.isInversed?x.style.textAlign="right":x.style.textAlign="left")):(s.style.height=r+"px",x.style.height="calc(100% /"+o+")"),s.appendChild(x)}"x"===e?(s.className=i,n._gridXAxisContainer.appendChild(s)):(s.className=i,n._gridYAxisContainer.appendChild(s))},_getLabels:function(i){var a,n=[],s=0;i.forEach(function(e,t){e===i[t+1]?s++:(a={name:e,duplicates:++s},n.push(a),s=0)}),this.xAxis.labels=n},_renderAllAxis:function(){var e,t,i,a=this;a.xAxis.minimum&&a.xAxis.maximum&&a._getLabels(a.xAxis.labels),a._renderAxis("x",a.xAxis.labels,"jqx-x-axis","jqx-x-axis-label"),a._renderAxis("y",a.yAxis.labels,"jqx-y-axis","jqx-y-axis-label"),i=a.element.querySelector(".jqx-y-axis"),e=a.element.querySelectorAll(".jqx-x-axis-label"),t=a.element.querySelectorAll(".jqx-y-axis-label"),a.xAxis.opposedPosition&&(a._gridXAxisContainer.style.flexDirection="column-reverse",i.classList.add("jqx-margin-top-auto"),e.forEach(function(e){e.classList.add("jqx-top")})),a.yAxis.opposedPosition&&(a._gridYAxisContainer.style.flexDirection="row",t.forEach(function(e){e.classList.add("jqx-right")}))},_setGridColumn:function(e,t,i){e.id="jqx-column-"+t,e.classList.add("jqx-column"),e.style.width="calc(100% / "+i+")"},_setGridCell:function(e,t,i,a){var n=this,s=a[i];e.classList.add("jqx-heatmap-cell"),e.setAttribute("data-row",i),e.setAttribute("data-column",t),e.setAttribute("data-value",s),n.xAxis.minimum&&n.xAxis.maximum&&e.setAttribute("data-date",n._dateArray[t][i]);for(var r=0,l=n.paletteSettings.palette.length;r<l;r++)if(null!==s){var o,d=Number(s),c=n.paletteSettings.palette[r].value,x=Number(c),c=null;if(r+1<l&&(o=n.paletteSettings.palette[r+1].value,c=Number(o)),c&&(x<=d&&d<c||d<n._minValue)){e.setAttribute("data-color-index",r);break}!c&&x<=d&&e.setAttribute("data-color-index",r)}if(!n.xAxis.minimum||!n.xAxis.maximum)return null===s?(e.innerHTML="&nbsp",void e.classList.add("jqx-empty-cell")):void(e.innerHTML=s);null===s&&e.classList.add("jqx-empty-cell")},_getTicksMinMax:function(){for(var e=JSON.parse(JSON.stringify(this.paletteSettings.palette)),t=e[0].value,i=e[0].value,a=[],n=0,s=e.length;n<s;n++){var r=e[n].value,l=e[n].label||"";a.push({value:r,label:l}),r<t?t=r:i<r&&(i=r)}this._minValue=t,this._maxValue=i,this._ticksArray=a},_renderTitle:function(){var e=this,t=document.createElement("div");t.className="jqx-heatmap-title",t.innerHTML=e.title,t.style.width=e._toPx(e.width),e._title=t,e.element.appendChild(t)},_renderLegend:function(e){var t=this,i=document.createElement("div"),a="Gradient"===t.paletteSettings.type?document.createElement("canvas"):document.createElement("div"),n=document.createElement("div");i.classList.add("jqx-legend-"+e),a.classList.add("jqx-palette-"+e),n.classList.add("jqx-arrow-"+e),t._drawLegend(i,a,e),i.appendChild(a),i.appendChild(n),t._gridContainerWrapper.appendChild(i),t._arrow=n,t._palette=a,t._legend=i,t._adjustLegend(e)},_drawLegend:function(e,t,i){var a=this;"vertical"===i?(!0===a.xAxis.opposedPosition&&e.classList.add("jqx-margin-top-auto"),"Gradient"===a.paletteSettings.type?a._drawGradientLegend(t,"vertical"):a._drawFixedLegend(t,"vertical"),"Left"===a.legendSettings.position&&e.classList.add("jqx-left"),a._gridXAxisContainer.width="calc(100% - "+e.offsetWidth+"px)"):("Gradient"===a.paletteSettings.type?a._drawGradientLegend(t,"horizontal"):a._drawFixedLegend(t,"horizontal"),"Bottom"===a.legendSettings.position&&e.classList.add("jqx-bottom"),!0===a.yAxis.opposedPosition&&e.classList.add("jqx-margin-right-auto"))},_drawFixedLegend:function(e,t){var i=JSON.parse(JSON.stringify(this.paletteSettings.palette)),a=this.element.querySelector(".jqx-heatmap-grid").offsetWidth,n=this.element.querySelector(".jqx-heatmap-grid").offsetHeight;"horizontal"===t&&e.classList.add("jqx-fixed");for(var s=0,r=i.length;s<r;s++){var l=i[s],o=document.createElement("div"),d=a/r/a*100;o.id="jqx-color-container-"+s,o.className="jqx-color-container",o.setAttribute("data-value",l.value),o.setAttribute("data-color-index",s),o.setAttribute("data-color",l.color),o.style.background=l.color,"vertical"===t?(o.style.width="10px",o.style.height="calc("+n+"px / "+r+")"):(o.style.width=d+"%",o.style.height="10px"),e.appendChild(o)}},_drawGradientLegend:function(e,t){var i,a=this,n=JSON.parse(JSON.stringify(a.paletteSettings.palette)),e=e.getContext("2d");i="vertical"===t?e.createLinearGradient(0,0,0,150):e.createLinearGradient(0,0,300,0),"Gradient"===a.paletteSettings.type&&a._checkNewMinMax();for(var s=0,r=n.length;s<r;s++){var l=n[s],o=(l.value-a._minValue)/(a._maxValue-a._minValue);i.addColorStop(o,l.color)}e.fillStyle=i,e.fillRect(0,0,300,150),a._canvasContext=e},_getSourceMinMax:function(){for(var e=this,t=e.source[0][0],i=e.source[0][0],a=0,n=e.source.length;a<n;a++)for(var s=0,r=e.source[a].length;s<r;s++){var l=e.source[a][s];null!==l&&(l<t?t=l:i<l&&(i=l))}return{min:t,max:i}},_checkNewMinMax:function(){var e=this,t=JSON.parse(JSON.stringify(e.paletteSettings.palette)),i=e._getSourceMinMax();e._minValue>i.min&&(e._minValue=i.min,t.splice(0,0,{value:i.min,color:t[0].color})),e._maxValue<i.max&&(e._maxValue=i.max,t.push({value:i.max,color:t[t.length-1].color}))},_adjustLegend:function(e){"vertical"===e?(this._setVerticalLegendHeight(),this._renderScale("vertical")):(this._setHorizontalLegendWidth(),this._renderScale("horizontal"))},_renderScale:function(e){for(var t=this,i=0,a=t._ticksArray.length;i<a;i++){var n=t._ticksArray[i].value,s=t._ticksArray[i].label,r=document.createElement("div");"Fixed"===t.paletteSettings.type&&r.classList.add("jqx-color-container-tick"),r.classList.add("jqx-tick","jqx-tick-"+e),r.setAttribute("data-value",n),r.setAttribute("data-color-index",i),r.innerHTML=s||n,t._setLegendTicksPosition(r,n,i,e),t._legend.appendChild(r)}"vertical"===e&&(t._tick=r,t._setVerticalLegendWidth())},_setLegendTicksPosition:function(e,t,i,a){var n,s=this;"Gradient"===s.paletteSettings.type?t===s._minValue||t===s._maxValue?(t===s._minValue?"vertical"===a?e.style.top="-0.5%":e.style.left="-3px":"vertical"===a?e.style.top="96%":e.style.right="-11px",e.classList.add("jqx-no-line")):(n=(t-s._minValue)/(s._maxValue-s._minValue)*100,"vertical"===a?e.style.top="calc("+n+"% - 6px)":e.style.left="calc("+n+"% - 6px)"):(t=s.element.querySelector(".jqx-color-container").offsetHeight,n=s.element.querySelector(".jqx-color-container").offsetWidth,"vertical"===a?e.style.top=0===i?i*t+"px":i*t-5+"px":0===i?e.style.left=i*n+"px":(n=s.paletteSettings.palette.length,s=(s=s.element.querySelector(".jqx-heatmap-grid").offsetWidth)/n/s*100,e.style.left="calc("+s*i+"% - 5px)"),e.classList.add("jqx-no-line"))},_showLegendArrow:function(e,t){var i=this,a=(t-i._minValue)/(i._maxValue-i._minValue)*100;"Gradient"===i.paletteSettings.type&&t<=i._maxValue&&(i._arrow.style.display="block","vertical"===e?i._arrow.style.top="calc("+a+"% - 6px)":i._arrow.style.left="calc("+a+"% - 6px)")},_setVerticalLegendWidth:function(){this._legend.style.width=15+this._tick.offsetWidth+"px",this._gridXAxisContainer.style.width="calc(100% - "+(this._legend.offsetWidth+15)+"px)"},_setVerticalLegendHeight:function(){var e=this.element.querySelector(".jqx-heatmap-grid").offsetHeight;this._legend.style.height=e+"px"},_setHorizontalLegendWidth:function(){var e=this.element.querySelector(".jqx-y-axis").offsetWidth;this._legend.style.width="calc(100% - "+e+"px)"},_hideCells:function(e){for(var t=this.element.querySelectorAll('.jqx-heatmap-cell[data-color-index="'+e+'"]'),i=0,a=t.length;i<a;i++)t[i].classList.toggle("jqx-heatmap-hidden")},_toggleClass:function(e,t,i){for(var a=this.element.querySelectorAll("."+e),n=0,s=a.length;n<s;n++){var r=a[n];if(i===r.getAttribute("data-value"))return void r.classList.toggle(t)}},_toPx:function(e){return"number"==typeof e?e+"px":e},_getLegendColor:function(e,t){var i=this,a=(e-i._minValue)/(i._maxValue-i._minValue)*149,n=(e-i._minValue)/(i._maxValue-i._minValue)*299,s=null;if(!(e>i._maxValue||e<i._minValue))return"rgba("+(s=("vertical"===t?i._canvasContext.getImageData(0,a,1,1):i._canvasContext.getImageData(n,0,1,1)).data)[0]+", "+s[1]+", "+s[2]+", "+s[3]/255+")"},_getFixedLegendColor:function(e){for(var t=JSON.parse(JSON.stringify(this.paletteSettings.palette)),i=0,a=t.length;i<a;i++){var n=t[i],s=t[i+1];if(s&&(e>=n.value&&e<s.value||e<this._minValue))return n.color;if(!s&&e>=n.value)return n.color}},_setCellsBackground:function(e){for(var t=this,i=t.element.querySelectorAll(".jqx-heatmap-cell"),a=0,n=i.length;a<n;a++){var s=i[a],r=i[a].getAttribute("data-value");"null"===r?s.style.background=t.paletteSettings.emptyPointColor:(r="Gradient"===t.paletteSettings.type?t._getLegendColor(r,e):t._getFixedLegendColor(r),s.style.background=r)}},_renderLegendPosition:function(){var e=this;switch(e.legendSettings.position){default:case"Right":e._gridContainerWrapper.style.flexDirection="row",e._renderLegend("vertical"),e._setCellsBackground("vertical");break;case"Left":e._gridContainerWrapper.style.flexDirection="row-reverse",e._renderLegend("vertical"),e._setCellsBackground("vertical");break;case"Top":e._gridContainerWrapper.style.flexDirection="column-reverse",e._renderLegend("horizontal"),e._setCellsBackground("horizontal");break;case"Bottom":e._gridContainerWrapper.style.flexDirection="column",e._renderLegend("horizontal"),e._setCellsBackground("horizontal")}},_reverseXAxisOrigin:function(){var e=this;e.xAxis.labels.reverse(),e.source.reverse(),e._isXAxisInversed=!e._isXAxisInversed,e.xAxis.minimum&&e.xAxis.maximum&&e._dateArray.reverse()},_reverseYAxisOrigin:function(){var e=this;e.yAxis.labels.reverse(),e._isYAxisInversed=!e._isYAxisInversed,e._reverseNestedArray(e.source),e.xAxis.minimum&&e.xAxis.maximum&&e._reverseNestedArray(e._dateArray)},_reverseNestedArray:function(e){for(var t=0,i=e.length;t<i;t++)e[t].reverse()},_setAxisOrigin:function(){var e=this;e.xAxis.isInversed!==e._isXAxisInversed&&e._reverseXAxisOrigin(),e.yAxis.isInversed!==e._isYAxisInversed&&e._reverseYAxisOrigin()},_destroyGrid:function(){i(this._gridContainerWrapper).remove(),this.xAxis.minimum&&this.xAxis.maximum&&(this.xAxis.labels=[])},_destroyTitle:function(){i(this._title).remove()},_renderAllElements:function(){var e=this;e._renderTitle(),e._getTicksMinMax(),e.xAxis.minimum&&e.xAxis.maximum&&e._getAllDates(),e._renderGrid(),e._renderAllAxis(),e._renderLegendPosition()},_rerender:function(){this._destroyTitle(),this._destroyGrid(),this._renderAllElements(),this._addHandlers()},setLegendPosition:function(e){this.legendSettings.position!==e&&(this.legendSettings.position=e,this._rerender())},setOpposedXAxisPosition:function(e){this.xAxis.opposedPosition!==e&&(this.xAxis.opposedPosition=e,this._rerender())},setOpposedYAxisPosition:function(e){this.yAxis.opposedPosition!==e&&(this.yAxis.opposedPosition=e,this._rerender())},reverseXAxisPosition:function(e){this.xAxis.isInversed=e,this._rerender()},reverseYAxisPosition:function(e){this.yAxis.isInversed=e,this._rerender()},setPaletteType:function(e){this.paletteSettings.type=e,this._rerender()},destroy:function(){this.host.remove()}})}(jqxBaseFramework);