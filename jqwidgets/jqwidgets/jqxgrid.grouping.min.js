!function(z){z.jqx.dataview.grouping=function(){this.loadgrouprecords=function(n,r,e,t,s,o,i,a,l){for(var u=n,d=this,p=new Array,g=0;g<d.groups.length;g++)p[g]=d.generatekey();var h=new Array,c=0,p=p,m=new Array,v=r,f=d.groups.length;this.loadedrecords=new Array,this.bounditems=new Array,this.loadedrecords=new Array,this.loadedrootgroups=new Array,this.loadedgroups=new Array,this.loadedgroupsByKey=new Array,this.sortedgroups=new Array;var b=null!=this.sortdata,x=b?this.sortdata:this.records;if(this.pageable&&(w=new Array,y=0,x[r]||(z.each(x,function(e,t){w[r+e++]=this}),x=w)),this.virtualmode){for(var w=new Array,y=0,v=0;v<e-r;v++)x[v]?w[r+y++]=x[v]:x[r+y]&&(w[r+y]=x[r+y],y++);v=0,x=w}for(var I=r;I<e;I++){var _={},q=(_=b?z.extend({},x[I].value):z.extend({},x[I]))[d.uniqueId];(a<=s||q!=i[s][d.uniqueId]||o&&o[q])&&(l[l.length]=s);for(var j=new Array,T=0,g=0;g<f;g++){var G=_[M=d.groups[g]];null==G&&(G=""),j[T++]={value:G,hash:p[g]}}if(j.length!=f)break;for(var P=null,A="",C=0;C<j.length;C++){0;var S,H=j[C].value;null==m[A=A+"_"+j[C].hash+"_"+H]||null==m[A]?(null==P?(P={group:H,subItems:new Array,subGroups:new Array,level:0},(h[c++]=P).uniqueid=d.generatekey(),d.loadedgroupsByKey[H]=P):(S={group:H,subItems:new Array,subGroups:new Array,parentItem:P,level:P.level+1},(d.loadedgroupsByKey[P.uniqueid+"_"+H]=S).uniqueid=d.generatekey(),P.subGroups[P.subGroups.length++]=S,P=S),m[A]=P):P=m[A]}null!=P?(null==_.uid&&(_.uid=this.getid(this.source.id,_,v)),b?(_.boundindex=x[I].index,this.recordsbyid["id"+_.uid]=x[I].value):(_.boundindex=v,this.recordsbyid["id"+_.uid]=x[I]),this.bounditems[_.boundindex]=_,(this.sortedgroups[v]=_).uniqueid=d.generatekey(),_.parentItem=P,_.level=P.level+1,P.subItems[P.subItems.length++]=_):(null==_.uid&&(_.uid=this.getid(this.source.id,_,v)),b?(_.boundindex=x[I].index,this.recordsbyid["id"+_.uid]=x[I].value):(_.boundindex=v,this.recordsbyid["id"+_.uid]=x[I]),this.sortedgroups[v]=_,(this.bounditems[_.boundindex]=_).uniqueid=d.generatekey()),s++,v++,0}function B(e,t,r){for(var s=0;s<t.subItems.length;s++)t.subItems[s].visibleindex=n+r,e.rows[r]=t.subItems[s],e.loadedrecords[r]=t.subItems[s],r++;return r}var D=function(d,e,i){var r=1,p=d.grid.columns.records||d.grid.columns;if(1==d.aggregates)for(var t=0;t<p.length;t++)p[t].aggregates&&(r=Math.max(r,p[t].aggregates.length));for(var s in e.subGroups){var o=e.subGroups[s];o.subGroups&&((d.loadedgroups[d.loadedgroups.length]=o).visibleindex=n+i,d.rows[i]=o,d.loadedrecords[i]=o,i++,0<o.subGroups.length?i=D(d,o,i):0<o.subItems.length&&(i=B(d,o,i)))}return 0<e.subItems.length&&(i=B(d,e,i)),function(o){if(1==d.aggregates){function e(l){function e(e){for(var t=0;t<p.length;t++)if(p[t].aggregates)for(var r,s,o,i,n=d.grid.getcolumnaggregateddata(p[t].datafield,p[t].aggregates,!0,e),a=0;a<p[t].aggregates.length;a++)p[t].aggregates[l]&&(r=p[t],o=s=p[t].aggregates[l],i=(o=d.grid._getaggregatename(o))+":"+n[s],n[s]?u[r.datafield]=i:u[r.datafield]=o+":"+n[o])}var r,s,t=o,u={};null!=t&&(u.level=t.level,u.visibleindex=n+i,u.uniqueid=d.generatekey(),d.rows[i]=u,(d.loadedrecords[i++]=u).totalsrow=!0,0<o.subItems.length?(t=o.subItems[o.subItems.length-1],u.parentItem=t.parentItem,u.parentItem.subItems&&(u.parentItem.subItems[u.parentItem.subItems.length]=u),r=[],(s=function(){for(var e=0;e<o.subItems.length;e++)o.subItems[e].totalsrow||(r[r.length]=o.subItems[e])})(o),e(r)):0<o.subGroups.length&&(t=o.subGroups[o.subGroups.length-1],u.level=t.level,(u.parentItem=o).subGroups[o.subGroups.length]=u,r=[],(s=function(e){if(!e.totalsrow){for(var t=0;t<e.subItems.length;t++)e.subItems[t].totalsrow||(r[r.length]=e.subItems[t]);for(t=0;t<e.subGroups.length;t++)s(e.subGroups[t])}})(o),e(r)))}for(var t=0;t<r;t++)e(t)}}(e),i},E=h.length;this.loadedgroups=new Array,this.rows=new Array;for(u=0,v=0;v<E;v++){var M=h[v];this.loadedrootgroups[v]=M,(this.loadedgroups[this.loadedgroups.length]=M).visibleindex=n+u,this.rows[u]=M,this.loadedrecords[u]=M,u=D(this,M,++u)}return u},this._updategroupsinpage=function(e,t,r,s,o,i,n){var d=new Array,a=[];if(this.groupable&&0<this.groups.length){for(var l=0,u=new Array,p=new Array,g=0;g<e.groups.length;g++)p[g]=e.generatekey();var h=0,c=new Array,m=0;n>this.totalrecords&&(n=this.totalrecords);for(var v=i;v<n;v++){var f=z.extend({},e.sortedgroups[v]),b=f[e.uniqueId];if(!e.pagesize||r>=e.pagesize*e.pagenum&&r<e.pagesize*(e.pagenum+1)){(o<=s||b!=d[s][e.uniqueId]||updated&&updated[b])&&(a[a.length]=s);for(var x=new Array,w=0,g=0;g<e.groups.length;g++){var y=f[S=e.groups[g]];null==y&&(y=""),x[w++]={value:y,hash:p[g]}}if(x.length!=e.groups.length)break;for(var I=null,_="",q=0;q<x.length;q++){0;var j,T,G=x[q].value;null==u[_=_+"_"+x[q].hash+"_"+G]||null==u[_]?(null==I?(I={group:G,subItems:new Array,subGroups:new Array,level:0},c[m++]=I,null!=(T=e.loadedgroupsByKey[G])&&(I.visibleindex=T.visibleindex,I.uniqueid=T.uniqueid)):(j={group:G,subItems:new Array,subGroups:new Array,parentItem:I,level:I.level+1},T=e.loadedgroupsByKey[I.uniqueid+"_"+G],j.visibleindex=T.visibleindex,j.uniqueid=T.uniqueid,I.subGroups[I.subGroups.length++]=j,I=j),u[_]=I):I=u[_]}null!=I&&(f.parentItem=I,f.level=I.level+1,I.subItems[I.subItems.length++]=f),s++}h++,r++}function P(e,t,r){for(var s=0;s<t.subItems.length;s++)d[r]=z.extend({},t.subItems[s]),r++;return r}for(var A=function(e){var t,r=!1;for(t in e.subGroups){var s=e.subGroups[t];if(s.subGroups){if(0<s.subGroups.length)if(A(s))return r=!0;if(0<s.subItems.length)return r=!0}}return 0<e.subItems.length?r=!0:r},C=function(l,e,i){var r=1,u=l.grid.columns.records||l.grid.columns;if(1==l.aggregates)for(var t=0;t<u.length;t++)u[t].aggregates&&(r=Math.max(r,u[t].aggregates.length));for(var s in e.subGroups){var o=e.subGroups[s];o.subGroups&&A(o)&&(d[i]=o,i++,0<o.subGroups.length?i=C(l,o,i):0<o.subItems.length&&(i=P(0,o,i)))}return 0<e.subItems.length&&(i=P(0,e,i)),function(o){if(1==l.aggregates){function e(n){function e(e){for(var t=0;t<u.length;t++)if(u[t].aggregates)for(var r,s,o=l.grid.getcolumnaggregateddata(u[t].datafield,u[t].aggregates,!0,e),i=0;i<u[t].aggregates.length;i++)u[t].aggregates[n]&&(r=u[t],s=u[t].aggregates[n],s=l.grid._getaggregatename(s)+":"+o[s],a[r.datafield]=s)}var r,s,t=o,a={};null!=t&&(a.level=t.level,a.visibleindex=i,a.uniqueid=l.generatekey(),d[i]=a,(l.loadedrecords[i++]=a).totalsrow=!0,0<o.subItems.length?(t=o.subItems[o.subItems.length-1],a.parentItem=t.parentItem,a.parentItem.subItems&&(a.parentItem.subItems[a.parentItem.subItems.length]=a),r=[],(s=function(){for(var e=0;e<o.subItems.length;e++)o.subItems[e].totalsrow||(r[r.length]=o.subItems[e])})(o),e(r)):0<o.subGroups.length&&(t=o.subGroups[o.subGroups.length-1],a.level=t.level,(a.parentItem=o).subGroups[o.subGroups.length]=a,r=[],(s=function(e){if(!e.totalsrow){for(var t=0;t<e.subItems.length;t++)e.subItems[t].totalsrow||(r[r.length]=e.subItems[t]);for(t=0;t<e.subGroups.length;t++)s(e.subGroups[t])}})(o),e(r)))}for(var t=0;t<r;t++)e(t)}}(e),i},h=0;h<c.length;h++){var S=c[h];A(S)&&(d[l]=S,l=C(this,S,++l))}}return d}},z.extend(z.jqx._jqxGrid.prototype,{_initgroupsheader:function(){var o,i,n,e;this.groupsheader.css("visibility","hidden"),this._groupsheader()&&(this.groupsheader.css("visibility","inherit"),e=(o=this).gridlocalization.groupsheaderstring,this.groupsheaderdiv=this.groupsheaderdiv||z('<div style="width: 100%; position: relative;"></div>'),this.groupsheaderdiv.height(this.groupsheaderheight),this.groupsheaderdiv.css("top",0),this.groupsheader.append(this.groupsheaderdiv),this.groupheadersbounds=new Array,i=this.groups.length,this.groupsheaderdiv.children().remove(),this.groupsheaderdiv[0].innerHTML="",n=new Array,0<i?z.each(this.groups,function(e){var t,r=this,s=o._getColumnText(this).label,s=o._rendergroupcolumn(s,r);s.addClass(o.toThemeProperty("jqx-grid-group-column")),o.groupsheaderdiv.append(s),o.closeablegroups&&(t=z(s.find(".jqx-icon-close")),o.isTouchDevice()&&!0!==o.touchmode?o.addHandler(t,"touchstart",function(){return o.removegroupat(e),!1}):o.addHandler(t,"click",function(){return o.removegroupat(e),!1})),o.sortable&&o.addHandler(s,"click",function(){var e=o.getcolumn(r);return null!=e&&o._togglesort(e),!1}),n[n.length]=s,o._handlegroupstocolumnsdragdrop(this,s),e<i-1&&(t=s.height(),s=z('<div style="float: left; position: relative;"></div>'),o.rtl&&s.css("float","right"),s.width(o.groupindentwidth/3),s.height(1),s.css("top",t/2),s.addClass(o.toThemeProperty("jqx-grid-group-column-line")),o.groupsheaderdiv.append(s))}):(e=z('<div style="position: relative;">'+e+"</div>"),this.groupsheaderdiv.append(e),this.rtl&&e.addClass(this.toThemeProperty("jqx-rtl"))),this._groupheaders=n,this._updategroupheadersbounds())},_updategroupheadersbounds:function(){var r=this,e=this.groupsheaderdiv.children().outerHeight(),e=(this.groupsheader.height()-e)/2;this.groupsheaderdiv.css("top",e),this.rtl?(this.groupsheaderdiv.css("left",""),this.groupsheaderdiv.css("right",e)):(this.groupsheaderdiv.css("left",e),this.groupsheaderdiv.css("right","")),this.rtl&&this._groupheaders.reverse(),z.each(this._groupheaders,function(e){var t=this.coord();r.groupheadersbounds[e]={left:t.left,top:t.top,width:this.outerWidth(),height:this.outerHeight(),index:e}})},addgroup:function(e){var t;e&&((t=this).groups!==t.dataview.groups&&(t.dataview.groups=t.groups),t.groups[t.groups.length]=e,t.refreshgroups(),this._raiseEvent(12,{type:"Add",index:t.groups[t.groups.length],groups:t.groups}))},insertgroup:function(e,t){var r;null!=e&&null!=e&&0<=e&&e<=this.groups.length&&t&&((r=this).groups!==r.dataview.groups&&(r.dataview.groups=r.groups),r.groups.splice(e,0,t.toString()),r.refreshgroups(),this._raiseEvent(12,{type:"Insert",index:e,groups:r.groups}))},refreshgroups:function(){this._refreshdataview(),this._render(!0,!0,!0,!1),this._postrender("group")},_insertaftergroup:function(e,t){e=this._getGroupIndexByDataField(e);this.insertgroup(e+1,t)},_insertbeforegroup:function(e,t){e=this._getGroupIndexByDataField(e);this.insertgroup(e,t)},removegroupat:function(e){if(0<=e&&null!=e&&null!=e){var t=this;return t.groups!==t.dataview.groups&&(t.dataview.groups=t.groups),t.groups.splice(e,1),t.refreshgroups(),t.virtualmode&&t.updatebounddata(),this._raiseEvent(12,{type:"Remove",index:e,groups:t.groups}),!0}return!1},cleargroups:function(){var e=this;return e.groups=[],e.dataview.groups=e.groups,e.refreshgroups(),this._raiseEvent(12,{type:"Clear",index:-1,groups:e.groups}),!0},removegroup:function(e){if(null==e)return!1;e=this.groups.indexOf(e.toString());return this.removegroupat(e)},getrootgroupscount:function(){return this.dataview.loadedrootgroups.length},collapsegroup:function(e){if(0<=e&&-1===e.toString().indexOf("."))return this._setrootgroupstate(e,!1);var t=e.toString().split("."),r=null;this.groupsVisibility||(this.groupsVisibility=new Array);for(var s=0;s<t.length;s++){var o,e=parseInt(t[s]);0==s?(r=this.dataview.loadedrootgroups[e],this.groupsVisibility[r.group]=null):(o=r.subGroups[e])&&(r=o,s==t.length-1&&(this._setgroupstate(r,!1,!0),this.groupsVisibility[r.group]=null))}},expandgroup:function(e){if(0<=e&&-1===e.toString().indexOf("."))return this._setrootgroupstate(e,!0);for(var t=e.toString().split("."),r=null,s=0;s<t.length;s++){var o,e=parseInt(t[s]);0==s?(r=this.dataview.loadedrootgroups[e],this._setrootgroupstate(e,!0),this.groupsVisibility||(this.groupsVisibility=new Array),this.groupsVisibility[r.group]=r):(o=r.subGroups[e])&&(r=o,this._setgroupstate(r,!0,!0),this.groupsVisibility||(this.groupsVisibility=new Array),this.groupsVisibility[r.group]=r)}},collapseallgroups:function(e){this._setbatchgroupstate(!1,e)},expandallgroups:function(e){this._setbatchgroupstate(!0,e)},isgroupexpanded:function(e){e=this.dataview.loadedrootgroups[e];return null==e?null:this.expandedgroups[e.uniqueid].expanded},jsonParser:function(){var v="~",f="\\x"+("0"+v.charCodeAt(0).toString(16)).slice(-2),b="\\"+f,x=new RegExp(f,"g"),o=new RegExp(b,"g"),i=new RegExp("(?:^|([^\\\\]))"+b),w=[].indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},n=String;function a(e,t,r){return t instanceof Array?function(e,t,r){for(var s=0,o=t.length;s<o;s++)t[s]=a(e,t[s],r);return t}(e,t,r):t instanceof n?t.length?r.hasOwnProperty(t)?r[t]:r[t]=function(e,t){for(var r=0,s=t.length;r<s;e=e[t[r++].replace(o,v)]);return e}(e,t.split(v)):e:t instanceof Object?function(e,t,r){for(var s in t)t.hasOwnProperty(s)&&(t[s]=a(e,t[s],r));return t}(e,t,r):t}var y={stringify:function(e,t,r,s){return y.parser.stringify(e,(l=!1,d=[],p=[e=e],g=[e],h=[(i=!s)?v:"[Circular]"],c=e,m=1,(u=!!(o=t))&&(a="object"==typeof o?function(e,t){return""!==e&&w.call(o,e)<0?void 0:t}:o),function(e,t){return u&&(t=a.call(this,e,t)),l?(c!==this&&(n=m-w.call(p,this)-1,m-=n,p.splice(m,p.length),d.splice(m-1,d.length),c=this),"object"==typeof t&&t?(w.call(p,t)<0&&p.push(c=t),m=p.length,(n=w.call(g,t))<0?(n=g.push(t)-1,i?(d.push((""+e).replace(x,f)),h[n]=v+d.join(v)):h[n]=h[0]):t=h[n]):"string"==typeof t&&i&&(t=t.replace(f,b).replace(v,f))):l=!0,t}),r);var o,i,n,a,l,u,d,p,g,h,c,m},parse:function(e,t){return y.parser.parse(e,(s=t,function(e,t){var r="string"==typeof t;return r&&t.charAt(0)===v?new n(t.slice(1)):(""===e&&(t=a(t,t,{})),r&&(t=t.replace(i,"$1"+v).replace(b,f)),s?s.call(this,e,t):t)}));var s},parser:JSON};return y},getgroup:function(e){var t=this.dataview.loadedrootgroups[e];if(null==t)return null;var r=this.expandedgroups[t.uniqueid].expanded,s=t.group,o=t.level,e=new Array;this._getsubgroups(e,t);var i,n=this,e={group:s,level:o,expanded:r,subgroups:e};t.subItems&&(i=new Array,z.each(t.subItems,function(){var e=this.boundindex;i[i.length]=n.getrowdata(e)}),0<i.length&&(e.subrows=i));t=this.jsonParser().stringify(t);return t=(t=t.replace(/subItems/gi,"subrows")).replace(/subGroups/gi,"subgroups"),e=this.jsonParser().parse(t)},getrootgroups:function(){for(var e=this.dataview.loadedrootgroups.length,t=new Array,r=0;r<e;r++)t[r]=this.getgroup(r);return t},_getsubgroups:function(e,t){var r,s=this;for(r in t.subGroups){var o,i=t.subGroups[r],n=s.expandedgroups[i.uniqueid].expanded,a=i.group,l=i.level;e[e.length]={group:a,level:l,expanded:n},i.subItems&&(o=new Array,z.each(i.subItems,function(){var e=this.boundindex;o[o.length]=s.getrowdata(e)}),e[e.length-1].subrows=o),i.subGroups&&(n=new Array,s._getsubgroups(n,i))}return e},_setbatchgroupstate:function(e,t){for(var r in this.dataview.loadedrootgroups)this._setrootgroupstate(r,e,!1,!0);if(0==t)return this._requiresupdate=!0,this._renderrows(this.virtualsizeinfo),!0;t=this.vScrollBar[0].style.visibility;return this.rendergridcontent(!0,!1),t==this.vScrollBar[0].style.visibility&&!this._hiddencolumns||(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo)),!0},_setrootgroupstate:function(e,t,r,s){if(null==e||null==e||e<0)return!1;if(!this.groupable||0==this.groups.length)return!1;var o=null==r||r;if(0<=e&&e<this.dataview.loadedrootgroups.length){r=this.dataview.loadedrootgroups[e];if(this.pageable){for(var i=new Array,n=0;n<this.dataview.rows.length;n++)null!=this.dataview.rows[n].group&&0===this.dataview.rows[n].level&&i.push(this.dataview.rows[n]);if(!(r=i[e]))return}return this._setgroupstate(r,t,o,s)}return!1},_togglegroupstate:function(e,t){if(null==e||null==e)return!1;var r=this.vScrollInstance.value,s=this.expandedgroups[e.uniqueid];s=!(s=null!=s&&s.expanded),this.groupsVisibility||(this.groupsVisibility=new Array),this.groupsVisibility[e.group]=s?e:null;t=this._setgroupstate(e,s,t);return this._newmax=null,0!==r&&"hidden"!==this.vScrollBar.css("visibility")&&(r<=this.vScrollInstance.max?this.vScrollInstance.setPosition(r):this.vScrollInstance.setPosition(this.vScrollInstance.max)),t},_setgroupstate:function(e,t,r,s){if(null==e||null==e)return!1;var o=!1;this.editable&&this.editcell&&this.endcelledit(this.editcell.row,this.editcell.column,!1,!1);var i=this.expandedgroups[e.uniqueid];return null==i&&(i={expanded:!1},o=!0),i.expanded!=t&&(o=!0),!!o&&(this.expandedgroups[e.uniqueid]={expanded:t,group:e},this._setsubgroupsvisibility(this,e,!t,s),r&&(r=this.vScrollBar[0].style.visibility,this.rendergridcontent(!0,!1),r==this.vScrollBar[0].style.visibility&&!this._hiddencolumns||(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo))),null!=this.suspendgroupevents&&0!=this.suspendgroupevents||(t?this._raiseEvent(4,{group:e.group,parentgroup:e.parentItem?e.parentItem.group:null,level:e.level,visibleindex:e.visibleindex}):this._raiseEvent(5,{group:e.group,parentgroup:e.parentItem?e.parentItem.group:null,level:e.level,visibleindex:e.visibleindex})),!0)},_setgroupitemsvisibility:function(e,t,r){for(var s=0;s<t.subItems.length;s++)e._setrowvisibility(t.subItems[s].visibleindex,r,!1)},_setsubgroupsvisibility:function(e,t,r,s){if(null!=t.parentItem){if(this.hiddens[t.parentItem.visibleindex])return}else if(null==t.parentItem&&this.hiddens[t.visibleindex])return;for(var o in t.subGroups){var i=t.subGroups[o];r||e._setrowvisibility(i.visibleindex,r,!1);var n=!r;s?this.expandedgroups[i.uniqueid]={expanded:n,group:i}:n=null!=e.expandedgroups[i.uniqueid]&&e.expandedgroups[i.uniqueid].expanded,i.subGroups&&(0<i.subGroups.length?e._setsubgroupsvisibility(e,i,!n||r,s):0<i.subItems.length&&e._setgroupitemsvisibility(e,i,!n||r)),r&&e._setrowvisibility(i.visibleindex,r,!1)}t.subItems&&0<t.subItems.length&&e._setgroupitemsvisibility(e,t,r)},_handlecolumnsdragdrop:function(){var e,t,a,l=this,u=-1,d=!1;l.groupable&&(e="mousemove.grouping"+this.element.id,this.element.id,t="mouseup.grouping"+this.element.id,a=!1,this.isTouchDevice()&&!0!==this.touchmode&&(a=!0,e=z.jqx.mobile.getTouchEventName("touchmove")+".grouping"+this.element.id,z.jqx.mobile.getTouchEventName("touchstart"),this.element.id,t=z.jqx.mobile.getTouchEventName("touchend")+".grouping"+this.element.id),this.removeHandler(z(document),e),this.addHandler(z(document),e,function(e){if(!l.showgroupsheader)return!0;if(null!=l.dragcolumn){var t=parseInt(e.pageX),r=parseInt(e.pageY);a&&(n=l.getTouches(e)[0],t=parseInt(n.pageX),r=parseInt(n.pageY));var s=l.host.coord(),o=parseInt(s.left),i=parseInt(s.top);null!=l.dragmousedownoffset&&null!=l.dragmousedownoffset||(l.dragmousedownoffset={left:0,top:0});var n=parseInt(t)-parseInt(l.dragmousedownoffset.left),s=parseInt(r)-parseInt(l.dragmousedownoffset.top);if(l.dragcolumn.css({left:n+"px",top:s+"px"}),d=!1,o<=t&&t<=o+l.host.width()&&i<=r&&r<=i+l.host.height()&&(d=!0),u=-1,d?(l.dragcolumnicon.removeClass(l.toThemeProperty("jqx-grid-dragcancel-icon")),l.dragcolumnicon.addClass(l.toThemeProperty("jqx-grid-drag-icon")),o=(s=l.groupsheader.coord()).top+l.groupsheader.height(),i=-1==(i=(i=z.data(l.dragcolumn[0],"datarecord"))?l.groups.indexOf(i.toString()):-1)||1<l.groups.length&&-1<i,null!=l.dropline&&(r>=s.top&&r<=o?i&&(u=l._handlegroupdroplines(t)):l.dropline.fadeOut("slow"))):(null!=l.dropline&&l.dropline.fadeOut("slow"),l.dragcolumnicon.removeClass(l.toThemeProperty("jqx-grid-drag-icon")),l.dragcolumnicon.addClass(l.toThemeProperty("jqx-grid-dragcancel-icon"))),a)return e.preventDefault(),e.stopPropagation(),!1}},{passive:!1}),this.removeHandler(z(document),t),this.addHandler(z(document),t,function(e){if(!l.showgroupsheader)return!0;l.__drag=!1,z(document.body).removeClass("jqx-disableselect");parseInt(e.pageX);var t=parseInt(e.pageY);a&&(r=l.getTouches(e)[0],parseInt(r.pageX),t=parseInt(r.pageY));var r,s,o=l.host.coord(),i=(parseInt(o.left),parseInt(o.top)),n=l.groupsheader.height();l.showtoolbar&&(i+=l.toolbarheight),l.dragstarted=!1,(l.dragmousedown=null)!=l.dragcolumn&&(e=z.data(l.dragcolumn[0],"datarecord"),l.dragcolumn.remove(),(l.dragcolumn=null)!=e&&(l.getcolumn(e).groupable&&d&&(-1!=u?(r=u.index,o=l.groups[r],(s=l._getGroupIndexByDataField(e))!=r&&(null!=s&&0<=s&&l.groups.splice(s,1),"before"==u.position?l.rtl?l._insertaftergroup(o,e):l._insertbeforegroup(o,e):l.rtl?l._insertbeforegroup(o,e):l._insertaftergroup(o,e))):0==l.groups.length?i<t&&t<=i+n&&l.addgroup(e):i+n<t&&(s=l._getGroupIndexByDataField(e),l.removegroupat(s))),null!=l.dropline&&(l.dropline.remove(),l.dropline=null)))}))},_getGroupIndexByDataField:function(e){for(var t=0;t<this.groups.length;t++)if(this.groups[t]==e)return t;return-1},_isColumnInGroups:function(e){for(var t=0;t<this.groups.length;t++)if(this.groups[t]==e)return!0;return!1},_handlegroupdroplines:function(r){var s=this,o=-1;return z.each(s.groupheadersbounds,function(e){if(r<=this.left+this.width/2){var t=this.left-3;return 0<e&&(t=this.left-1-s.groupindentwidth/6),s.dropline.css("left",t),s.dropline.css("top",this.top),s.dropline.height(this.height),s.dropline.fadeIn("slow"),o={index:e,position:"before"},s.rtl&&(o={index:s.groupheadersbounds.length-1-e,position:"before"}),!1}r>=this.left+this.width/2&&(s.dropline.css("left",1+this.left+this.width),s.dropline.css("top",this.top),s.dropline.height(this.height),s.dropline.fadeIn("slow"),o={index:e,position:"after"},s.rtl&&(o={index:s.groupheadersbounds.length-1-e,position:"after"}))}),o},_handlegroupstocolumnsdragdrop:function(s,o){this.dragmousedown=null,this.dragmousedownoffset=null,this.dragstarted=!1,this.dragcolumn=null;var i,n=this,e="mousedown",t="mousemove",a=!1;this.isTouchDevice()&&!0!==this.touchmode&&(a=!0,e=z.jqx.mobile.getTouchEventName("touchstart"),t=z.jqx.mobile.getTouchEventName("touchmove")),this.addHandler(o,"dragstart",function(e){return!1}),this.addHandler(o,e,function(e){if(!n.showgroupsheader)return!0;var t,r=e.pageX,s=e.pageY;n.__drag=!0,n.dragmousedown={left:r,top:s},a&&(r=(t=n.getTouches(e)[0]).pageX,s=t.pageY,n.dragmousedown={left:r,top:s},e.preventDefault&&e.preventDefault());e=z(e.target).coord();n.dragmousedownoffset={left:parseInt(r)-parseInt(e.left),top:parseInt(s-e.top)}}),this.addHandler(o,t,function(e){return!n.showgroupsheader||void(n.dragmousedown&&(i={left:e.pageX,top:e.pageY},a&&(r=n.getTouches(e)[0],i={left:r.pageX,top:r.pageY}),n.dragstarted||null!=n.dragcolumn||(t=Math.abs(i.left-n.dragmousedown.left),r=Math.abs(i.top-n.dragmousedown.top),(3<t||3<r)&&(n._createdragcolumn(o,i,!0),z(document.body).addClass("jqx-disableselect"),z.data(n.dragcolumn[0],"datarecord",s),e.preventDefault&&e.preventDefault()))));var t,r},{passive:!1})},_createdragcolumn:function(e,t,r){var s=this,o=t;s.dragcolumn=z("<div></div>");var i=e.clone();s.dragcolumn.css("z-index",999999),i.css("border-width","1px"),i.css("opacity","0.4");t=z(i.find("."+s.toThemeProperty("jqx-grid-column-menubutton")));0<t.length&&t.css("display","none");t=z(i.find(".jqx-icon-close"));0<t.length&&t.css("display","none"),s.dragcolumnicon=z('<div style="z-index: 9999; position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -7px;"></div>'),s.dragcolumnicon.addClass(s.toThemeProperty("jqx-grid-drag-icon")),s.dragcolumn.css("float","left"),s.dragcolumn.css("position","absolute");s.host.coord();i.width(e.width()+16),s.dragcolumn.append(i),s.dragcolumn.height(e.height()),s.dragcolumn.width(i.width()),s.dragcolumn.append(s.dragcolumnicon),z(document.body).append(s.dragcolumn),i.css("margin-left",0),i.css("left",0),i.css("top",0),s.dragcolumn.css("left",o.left+s.dragmousedown.left),s.dragcolumn.css("top",o.top+s.dragmousedown.top),null!=r&&r&&(s.dropline=z('<div style="display: none; position: absolute;"></div>'),s.dropline.width(2),s.dropline.addClass(s.toThemeProperty("jqx-grid-group-drag-line")),z(document.body).append(s.dropline))},iscolumngroupable:function(e){return this._getcolumnproperty(e,"groupable")},_handlecolumnstogroupsdragdrop:function(o,i){this.dragmousedown=null,this.dragmousedownoffset=null,this.dragstarted=!1,this.dragcolumn=null;var n=this,a=!1;this.isTouchDevice()&&!0!==this.touchmode&&(a=!0);var e="mousedown.drag",l="mousemove.drag";a?(e=z.jqx.mobile.getTouchEventName("touchstart")+".drag",l=z.jqx.mobile.getTouchEventName("touchmove")+".drag"):this.addHandler(i,"dragstart",function(e){return!1}),this.addHandler(i,e,function(e){if(!n.showgroupsheader)return!0;if(n.__drag=!0,n._isColumnInGroups(o.displayfield))return i.css("cursor"),!0;if(0==o.groupable)return!0;var t,r=e.pageX,s=e.pageY;a&&(r=(t=n.getTouches(e)[0]).pageX,s=t.pageY),n.dragmousedown={left:r,top:s},a&&e.preventDefault&&e.preventDefault();e=z(e.target).coord();n.dragmousedownoffset={left:parseInt(r)-parseInt(e.left),top:parseInt(s-e.top)}}),this.addHandler(i,l,function(e){return!n.showgroupsheader||(n._isColumnInGroups(o.displayfield)?(i.css("cursor"),!0):void(n.dragmousedown&&(r=e.pageX,s=e.pageY,a&&(r=(t=n.getTouches(e)[0]).pageX,s=t.pageY),l={left:r,top:s},n.dragstarted||null!=n.dragcolumn||(r=Math.abs(l.left-n.dragmousedown.left),s=Math.abs(l.top-n.dragmousedown.top),(3<r||3<s)&&(n._createdragcolumn(i,l,!0),z.data(n.dragcolumn[0],"datarecord",o.displayfield),e.preventDefault&&e.preventDefault())))));var t,r,s})},_rendergroupcolumn:function(e,t){var r,s,o=z('<div style="float: left; position: relative;"></div>');return this.rtl&&o.css("float","right"),null!=this.groupcolumnrenderer&&(o[0].innerHTML=this.groupcolumnrenderer(e),o.addClass(this.toThemeProperty("jqx-grid-group-column")),o.addClass(this.toThemeProperty("jqx-fill-state-normal"))),this.closeablegroups?(""==o[0].innerHTML&&(o[0].innerHTML='<a style="float: left;" href="#">'+e+"</a>"),this.rtl&&(o[0].innerHTML='<a style="float: right;" href="#">'+e+"</a>"),s='<div style="float: '+(r=this.rtl?"left":"right")+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>',z.jqx.browser.msie&&z.jqx.browser.version<8&&(s='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>'),this.rtl&&(s='<div style="float: '+r+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>',z.jqx.browser.msie&&z.jqx.browser.version<8&&(s='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>')),o[0].innerHTML+=s):""==o[0].innerHTML&&(o[0].innerHTML='<a href="#">'+e+"</a>"),this.sortable&&(s=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),e=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(s=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),e=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>')),this.rtl&&(s=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),e=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(s=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),e=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'))),s.css("display","none"),e.css("display","none"),z.jqx.browser.msie&&z.jqx.browser.version<8&&(s.css("float","left"),e.css("float","left")),o.append(s),o.append(e),z.data(document.body,"groupsortelements"+t,{sortasc:s,sortdesc:e})),o.addClass(this.toThemeProperty("jqx-fill-state-normal")),o.addClass(this.toThemeProperty("jqx-grid-group-column")),o},_rendergroup:function(e,t,r,s,o,i,n){var a=t,l=t.cells[r.level];this.rtl&&(l=t.cells[t.cells.length-1-r.level]);var u=this._findgroupstate(r.uniqueid);(0<r.bounddata.subGroups.length||0<r.bounddata.subItems.length)&&(g=this.rtl?"-rtl":"",v=this.toThemeProperty("jqx-icon-arrow-right"),g&&(v=this.toThemeProperty("jqx-icon-arrow-left")),l.className+=u?" "+this.toThemeProperty("jqx-grid-group-expand"+g)+" "+this.toThemeProperty("jqx-icon-arrow-down"):" "+this.toThemeProperty("jqx-grid-group-collapse"+g)+" "+v);var d=this._getColumnText(this.groups[r.level]).label,p=this.groupindentwidth,l=this.rowdetails&&this.showrowdetailscolumn?(1+e)*p:e*p,g=n-l,h=r.level+1;this.rtl&&(h=0);for(var c=a.cells[h],m=2;null!=c&&"none"==c.style.display&&m<a.cells.length-1;)c=a.cells[h+m-1],m++;var v=z(c);if(c){if(c.style.width=parseInt(g)+"px",-1!=c.className.indexOf("jqx-grid-cell-filter")&&v.removeClass(this.toThemeProperty("jqx-grid-cell-filter")),-1!=c.className.indexOf("jqx-grid-cell-sort")&&v.removeClass(this.toThemeProperty("jqx-grid-cell-sort")),-1!=c.className.indexOf("jqx-grid-cell-pinned")&&v.removeClass(this.toThemeProperty("jqx-grid-cell-pinned")),null!=this.groupsrenderer){e={group:r.group,level:r.level,parent:r.bounddata.parentItem,subGroups:r.bounddata.subGroups,subItems:r.bounddata.subItems,groupcolumn:this._getColumnText(this.groups[r.level]).column},e=this.groupsrenderer(d+": "+r.group,r.group,u,e);if(e)c.innerHTML=e;else{var f=(0<r.bounddata.subItems.length?r.bounddata.subItems:r.bounddata.subGroups).length;if(this.showgroupaggregates)for(var b=0<r.bounddata.subItems.length?r.bounddata.subItems:r.bounddata.subGroups,x=f=0;x<b.length;x++)b[x].totalsrow||f++;c.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+d+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+r.group+" ("+f+")</span></div>"}}else{var w=this._getcolumnbydatafield(this.groups[r.level]),y=r.group;if(null==w)throw new Error("jqxGrid: Unable to find '"+this.groups[r.level]+"' group in the Grid's columns collection.");w.cellsformat&&z.jqx.dataFormat&&(z.jqx.dataFormat.isDate(y)?y=z.jqx.dataFormat.formatdate(y,w.cellsformat,this.gridlocalization):z.jqx.dataFormat.isNumber(y)&&(y=z.jqx.dataFormat.formatnumber(y,w.cellsformat,this.gridlocalization)));f=(0<r.bounddata.subItems.length?r.bounddata.subItems:r.bounddata.subGroups).length;if(this.showgroupaggregates)for(b=0<r.bounddata.subItems.length?r.bounddata.subItems:r.bounddata.subGroups,x=f=0;x<b.length;x++)b[x].totalsrow||f++;c.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+d+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+y+" ("+f+")</span></div>"}this.rtl&&(w=w||this._getcolumnbydatafield(this.groups[r.level]),d="hidden"==this.hScrollBar.css("visibility")?0:this.hScrollInstance.max-this.hScrollInstance.value,y="hidden"==this.vScrollBar.css("visibility")?0:this.scrollbarsize+6,l=this.rowdetails&&this.showrowdetailscolumn?(2+r.level)*p:(1+r.level)*p,c.style.width=n+parseInt(d)-l-y+"px",v.addClass(this.toThemeProperty("jqx-rtl")),p=z(t.cells[t.cells.length-1]).css("z-index"),v.css("z-index",p),g=(v=v.find("div")).width(),v.css("left","100%"),r=null!=this.columns.records[t.cells.length-2-r.level]&&this.columns.records[t.cells.length-2-r.level].pinned,this.table.width()<n&&(n=this.table.width(),"hidden"!=this.vScrollBar.css("visibility")&&(n+=this.vScrollBar.outerWidth())),w.pinned||r?(this.rowdetails&&this.showrowdetailscolumn&&(n+=30),v.css("margin-left",-g),c.style.width=n+d-l-y+"px"):(d="hidden"==this.hScrollBar.css("visibility")?0:this.hScrollInstance.max,c.style.width=n+d-l-y+"px",g=v.width(),v.css("margin-left",-g)))}}})}(jqxBaseFramework);