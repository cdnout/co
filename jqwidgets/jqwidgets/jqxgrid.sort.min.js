!function(x){x.jqx.dataview.sort=function(){this.sortby=function(t,s,e){var r=Object.prototype.toString;if(null!=s||(this.sortdata=null,"many"!==this.grid.sortmode?this.sortcache={}:this.sortcache[t]&&delete this.sortcache[t],this.grid._pagescache=new Array,this.grid._cellscache=new Array,"many"===this.grid.sortmode)){"many"===this.grid.sortmode&&(this.grid._pagescache=new Array,this.grid._cellscache=new Array),null!=s&&(s="a"==s||"asc"==s||"ascending"==s||1==s);var i=t;this.sortfield=t,this.sortfielddirection=s?"asc":"desc",null==s&&(this.sortfielddirection=null),null==this.sortcache&&(this.sortcache={}),this.sortdata=[];var o=[],n=!1;"constructor"==i&&(i=""),this.virtualmode||null==this.sortcache[i]||"many"===this.grid.sortmode||(o=(p=this.sortcache[i])._sortdata,p.direction==s?o.reverse():(!p.direction&&s&&o.reverse(),n=!0),o.length<this.totalrecords&&(n=!(this.sortcache={}),o=[])),Object.prototype.toString="function"==typeof t?t:function(){return this[t]};var a,d=this.records,c=(this.that,"");if(this.source.datafields&&x.each(this.source.datafields,function(){if(this.name==t)return this.type&&(c=this.type),!1}),0==o.length)if(d.length)for(var l,h=d.length,u=0;u<h;u++)null!=(g=d[u])&&(l=(v=g).toString(),o.push({sortkey:l,value:v,index:u}));else{var f,g,m=!1;for(f in d){if(null==(g=d[f])){m=!0;break}var v=g;o.push({sortkey:v.toString(),value:v,index:f})}m&&x.each(d,function(t,s){o.push({sortkey:s.toString(),value:s,index:t})})}if(n||(null==e?(this._sortcolumntype=c,a=this,o.sort(function(t,s){return a._compare(t,s,c)})):o.sort(e)),s||o.reverse(),Object.prototype.toString=r,this.sortdata=o,null!==s&&(this.sortcache[i]={_sortdata:o,direction:s,dataType:this._sortcolumntype,dataField:i}),"many"===this.grid.sortmode){var y,p,b=[],w=[],_=[];for(y in this.sortcache)"data"!==y&&(p=this.sortcache[y],b.push(p.dataField),w.push(p.direction?"asc":"desc"),_.push(p.dataType));if(!(0<b.length))return this.sortcache={},this.sortdata=null,void this.refresh();s=this.multiSort(d,b,w,_);o=[],s&&x.each(s,function(t,s){o.push({sortkey:i,value:s,index:s.boundindex})}),this.sortdata=o}this.reload(this.records,this.rows,this.filters,this.updated,!0)}else this.refresh()},this.multiSort=function(t,i,s,e,r){if(0===t.length)return[];for(var o=[],n=0;n<t.length;n++){var a=x.extend({},t[n]);o.push(a)}var d=!1;if(o&&o.constructor&&"ObservableArray"===o.constructor.name&&(d=!0),!(o&&o instanceof Array&&0!==o.length&&i&&!(i instanceof Array&&0===i.length)||d))throw new Error("sort: Missing or Invalid arguments!");"string"==typeof i&&(i=[i]);var c=[],l=[];void 0===s&&(s=[]);for(n=0;n<i.length;n++){void 0===s[n]||"asc"===s[n]||"ascending"===s[n]?c[n]=1:c[n]=-1;var h=o[0][i[n]];l[n]=function(t,s){var e;switch(s||typeof t){case"string":default:e=(new Intl.Collator).compare;break;case"date":case"time":case"datetime":case"number":case"int":case"float":e=function(t,s){return t-s};break;case"boolean":e=function(t,s){return t===s?0:!1===t?-1:1};break;case"object":t instanceof Date&&(e=function(t,s){return t.getTime()-s.getTime()})}return e}(h,e[n])}if(!r)return o.sort(function(t,s){for(var e=0;e<i.length;e++){var r=l[e](t[i[e]],s[i[e]]);if(0!==r)return r*c[e];if(!i[e+1])return void 0!==t._index?(t._index-s._index)*c[e]:0}if(0===i.length)return t.boundIndex<s.boundIndex?-1:t.boundIndex>s.boundIndex?1:0}),o;r(o,i,s,l)},this.clearsortdata=function(){this.sortcache={},this.sortdata=null},this._compare=function(t,s,e){if(void 0===(t=t.sortkey)&&(t=null),void 0===(s=s.sortkey)&&(s=null),null===t&&null===s)return 0;if(null===t&&null!==s)return-1;if(null!==t&&null===s)return 1;if(x.jqx.dataFormat)if(e&&""!=e)switch(e){case"number":case"int":case"float":return t<s?-1:s<t?1:0;case"date":case"time":return t<s?-1:s<t?1:0;case"string":case"text":t=String(t).toLowerCase(),s=String(s).toLowerCase()}else{if(x.jqx.dataFormat.isNumber(t)&&x.jqx.dataFormat.isNumber(s))return t<s?-1:s<t?1:0;if(x.jqx.dataFormat.isDate(t)&&x.jqx.dataFormat.isDate(s))return t<s?-1:s<t?1:0;x.jqx.dataFormat.isNumber(t)||x.jqx.dataFormat.isNumber(s)||(t=String(t).toLowerCase(),s=String(s).toLowerCase())}try{if(t<s)return-1;if(s<t)return 1}catch(t){}return 0},this._equals=function(t,s){return 0===this._compare(t,s)}},x.extend(x.jqx._jqxGrid.prototype,{_rendersortcolumn:function(){var t,r=this.that,i=this.getsortcolumn();if("many"!==this.sortmode)this.sortdirection&&(t=function(t,s){t=r.getcolumn(t);t&&(s.ascending?x.jqx.aria(t.element,"aria-sort","ascending"):s.descending?x.jqx.aria(t.element,"aria-sort","descending"):x.jqx.aria(t.element,"aria-sort","none"))},this._oldsortinfo&&this._oldsortinfo.column&&t(this._oldsortinfo.column,{ascending:!1,descending:!1}),t(i,this.sortdirection)),this._oldsortinfo={column:i,direction:this.sortdirection},this.sortdirection&&x.each(this.columns.records,function(t,s){var e=x.data(document.body,"groupsortelements"+this.displayfield);null==i||this.displayfield!=i?(x(this.sortasc).hide(),x(this.sortdesc).hide(),x(this.sorticon).css("visibility","hidden"),x(this.sorticon).removeClass("ascending"),x(this.sorticon).removeClass("descending"),this.element.removeAttribute("sort"),null!=e&&(e.sortasc.hide(),e.sortdesc.hide())):(r.isMaterialized()||r.isModern()?(x(this.sortasc).hide(),x(this.sortdesc).hide(),x(this.sorticon).show(),x(this.sorticon).css("visibility","inherit"),null!=e&&(e.sortasc.hide(),e.sortdesc.show()),x(this.sorticon).removeClass("ascending"),x(this.sorticon).removeClass("descending"),r.sortdirection.ascending?x(this.sorticon).addClass("ascending"):x(this.sorticon).addClass("descending")):r.sortdirection.ascending?(x(this.sortasc).show(),x(this.sortdesc).hide(),null!=e&&(e.sortasc.show(),e.sortdesc.hide())):(x(this.sortasc).hide(),x(this.sortdesc).show(),null!=e&&(e.sortasc.hide(),e.sortdesc.show())),this.element.setAttribute("sort",!0))});else{this.__columnsbydatafield=new Array;var s=this.getsortcolumns();if(x.each(this.columns.records,function(t,s){x(this.sortasc).hide(),x(this.sortdesc).hide(),x(this.sorticon).css("visibility","hidden"),this.element.removeAttribute("sort")}),0<s.length)for(var e=0;e<s.length;e++){var o=s[e],n=this._getcolumnbydatafield(o.dataField);n.element.setAttribute("sort",!0),r.isMaterialized()||r.isModern()?(x(n.sorticon).show(),x(n.sorticon).css("visibility","inherit"),x(n.sorticon).removeClass("ascending"),x(n.sorticon).removeClass("descending"),o.ascending?x(n.sorticon).addClass("ascending"):x(n.sorticon).addClass("descending")):o.ascending?(x(n.sortasc).show(),x(n.sortdesc).hide()):!1===o.ascending&&(x(n.sortasc).hide(),x(n.sortdesc).show())}}},getsortcolumns:function(){var t,s=[];for(t in this.dataview.sortcache)"data"!==t&&s.push({dataField:t,ascending:this.dataview.sortcache[t].direction});if(0===s.length)for(var e in this.sortcolumns){var r=this.sortcolumns[e];null!==r&&s.push({dataField:e,ascending:r})}return s},getsortcolumn:function(){return null!=this.sortcolumn?this.sortcolumn:null},removesort:function(){if(this.sortby(null),"many"===this.sortmode)for(var t in this.sortcolumns)this.sortby(t,null)},sortby:function(t,s,e,r,i){if(this._loading&&!1!==i)throw new Error("jqxGrid: "+this.loadingerrormessage);if(null==t&&(s=null,t=this.sortcolumn),null!=t){var o=this.that;if(null==e&&o.source&&null!=o.source.sortcomparer&&(e=o.source.sortcomparer),void 0===s&&(s=!0),i="a"==s||"asc"==s||"ascending"==s||1==s,o.sortdirection=null!=s?{ascending:i,descending:!i}:{ascending:!1,descending:!1},o.sortcolumn=null!=s?t:null,o.sortcolumns||(o.sortcolumns=[]),o.sortcolumns[t]=s,o.source&&(o.source.sort||o.virtualmode)){if(o.dataview.sortfield=t,o.dataview.sortfielddirection=null==s?"":i?"asc":"desc",o.source.sort&&!this._loading)return o.source.sort(t,s,o.sortcolumns),void o._raiseEvent(6,{sortinformation:o.getsortinformation()})}else o.dataview.sortby(t,s,e);!1!==r&&(o.groupable&&0<o.groups.length?(o._render(!0,!1,!1),o._updategroupheadersbounds&&o.showgroupsheader&&o._updategroupheadersbounds()):(o.pageable&&o.dataview.updateview(),o._updaterowsproperties(),o.rendergridcontent(!0)),o._postrender("sort"),o._raiseEvent(6,{sortinformation:o.getsortinformation()}))}},_togglesort:function(t){var s,e=this.that;if(!this.disabled)if("many"!==this.sortmode)t.sortable&&e.sortable&&(i=(i=null)==(s=e.getsortinformation()).sortcolumn||s.sortcolumn!=t.displayfield||(i=s.sortdirection.ascending,1<e.sorttogglestates?1!=i&&null:!i),e.sortby(t.displayfield,i,null));else if(t.sortable&&e.sortable){for(var r=e.getsortcolumns(),i=null,o=0;o<r.length;o++){var n=r[o];if(t.displayfield===n.dataField)return i=n.ascending,i=1<e.sorttogglestates?1!=i&&null:!i,void e.sortby(t.displayfield,i,null)}e.sortby(t.displayfield,!0,null)}}})}(jqxBaseFramework);