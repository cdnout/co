!function(c){c.jqx.jqxWidget("jqxTreeMap","",{});var h={};function o(e,t,r,a){this.height=a,this.width=r,this.xoffset=e,this.yoffset=t,this.shortestEdge=function(){return Math.min(this.height,this.width)},this.getCoordinates=function(e){var t=[],r=this.xoffset,a=this.yoffset,n=f(e)/this.height,o=f(e)/this.width;if(this.width>=this.height)for(var i=0;i<e.length;i+=1)t.push([r,a,r+n,a+e[i]/n]),a+=e[i]/n;else for(i=0;i<e.length;i+=1)t.push([r,a,r+e[i]/o,a+o]),r+=e[i]/o;return t},this.cutArea=function(e){var t,r;return this.width>=this.height?(t=e/this.height,r=this.width-t,new o(this.xoffset+t,this.yoffset,r,this.height)):(r=e/this.width,e=this.height-r,new o(this.xoffset,this.yoffset+r,this.width,e))}}function d(e,t,r,a,n){return a=void 0===a?0:a,n=void 0===n?0:n,function(e){for(var t=[],r=0;r<e.length;r+=1)for(var a=0;a<e[r].length;a+=1)t.push(e[r][a]);return t}(function e(t,r,a,n){var o,i;if(0===t.length)return void n.push(a.getCoordinates(r));o=a.shortestEdge();i=t[0];l(r,i,o)?(r.push(i),e(t.slice(1),r,a,n)):(i=a.cutArea(f(r),n),n.push(a.getCoordinates(r)),e(t,[],i,n));return n}(function(e,t){for(var r=[],a=t/f(e),n=0;n<e.length;n+=1)r[n]=e[n]*a;return r}(e,t*r),[],new o(a,n,t,r),[]))}function l(e,t,r){var a;if(0===e.length)return 1;(a=e.slice()).push(t);e=n(e,r);return n(a,r)<=e}function n(e,t){var r=Math.min.apply(Math,e),a=Math.max.apply(Math,e),e=f(e);return Math.max(Math.pow(t,2)*a/Math.pow(e,2),Math.pow(e,2)/(Math.pow(t,2)*r))}function u(e){return e&&e.constructor===Array}function f(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t}function s(e,t,r,a,n,o,i,l){this.label=e,this.value=t,this.parent=r,this.children=a,this.area=n||null,this.color=o,this.data=i,this.record=l}h.default=function e(t,r,a,n,o){n=void 0===n?0:n,o=void 0===o?0:o;var i,l=[],s=[];if(u(t[0])){for(var h=0;h<t.length;h+=1)l[h]=function e(t){var r=0;if(u(t[0]))for(var a=0;a<t.length;a+=1)r+=e(t[a]);else r=f(t);return r}(t[h]);for(i=d(l,r,a,n,o),h=0;h<t.length;h+=1)s.push(e(t[h],i[h][2]-i[h][0],i[h][3]-i[h][1],i[h][0],i[h][1]))}else s=d(t,r,a,n,o);return s};var a=0,i=1,p=2;c.extend(c.jqx._jqxTreeMap.prototype,{defineInstance:function(){var e={width:600,height:600,renderCallbacks:{},legendScaleCallback:function(e){return e},hoverEnabled:!1,selectionEnabled:!0,singleSelection:!0,showLegend:!0,legendLabel:"Legend",headerHeight:25,colorRange:100,layout:"default",source:[],displayMember:null,valueMember:null,colorMode:"parent",baseColor:"#C2EEFF",legendPosition:{x:0,y:0},colorRanges:[{color:"#aa9988",min:0,max:10},{color:"#ccbbcc",min:11,max:50},{color:"#000",min:50,max:100}],_root:[]};return this===c.jqx._jqxTreeMap.prototype||c.extend(!0,this,e),e},createInstance:function(){this.render()},render:function(){this.host.addClass(this.toThemeProperty("jqx-widget")),this._destroy(),this._root=new s(void 0,0,null,[],this.host);function e(e,t){for(var r,a={},n=null,o=0;o<e.length;o+=1)if(e[o].items){n=!0;break}var l,s=new Array;for(n&&((l=function(e,t){for(var r=0;r<e.length;r+=1){if(e[r].parent=t,e[r].data||(e[r].data=e[r].value),null==e[r].value&&(e[r].value=0),isNaN(parseFloat(e[r].value))){for(var a=e[r].value.toString(),n="",o=0;o<a.length;o++){var i=a.substring(o,o+1);null==i.match(/^[0-9]+$/)&&"."!=i||(n+=i)}e[r].value=new Number(n)}else e[r].value=parseFloat(e[r].value);s.push(e[r]),e[r].items&&l(e[r].items,e[r].label)}})(e,null),e=s),o=0;o<e.length;o+=1)(r=e[o]).value&&null!=r.parent&&(a[r.parent]||(a[r.parent]=0),a[r.parent]+=r.value);for(o=0;o<e.length;o+=1)void 0!==a[(r=e[o]).label]&&(r.value=a[r.label]);t._buildTree(e,t._root),t._dataList=t._buildList(),t._setStyles();var i=h.default;"simple"===t.layout&&(i=h.simple),t._render(t._root,i),t._renderLegend()}c.jqx.dataAdapter&&null!=this.source&&this.source._source?this.dataBind(this.source,e):(e(this.source,this),this._trigger("bindingComplete"))},dataBind:function(e,o){this.records=new Array;var t=!!e._source,i=new c.jqx.dataAdapter(e,{autoBind:!1});t&&(e=(i=e)._source);function r(e,t){e.records=i.records;for(var r=new Array,a=0;a<e.records.length;a++){var n=e.records[a];e.displayMember&&(n.label=n[e.displayMember]),e.valueMember&&(n.value=n[e.valueMember]),n.record=n,r.push(n)}e._trigger("bindingComplete"),o(r,e)}null!=e.type&&(i._options.type=e.type),null!=e.formatdata&&(i._options.formatData=e.formatdata),null!=e.contenttype&&(i._options.contentType=e.contenttype),null!=e.async&&(i._options.async=e.async);var a=this;switch(e.datatype){case"local":case"array":default:null!=e.localdata&&(i.unbindBindingUpdate(this.element.id),i.dataBind(),r(this),i.bindBindingUpdate(this.element.id,function(e){r(a)}));break;case"json":case"jsonp":case"xml":case"xhtml":case"script":case"text":case"csv":case"tab":if(null!=e.localdata)return i.unbindBindingUpdate(this.element.id),i.dataBind(),r(this),void i.bindBindingUpdate(this.element.id,function(){r(a)});t={};i._options.data?c.extend(i._options.data,t):(e.data&&c.extend(t,e.data),i._options.data=t);i.unbindDownloadComplete(a.element.id),i.bindDownloadComplete(a.element.id,function(){r(a)}),i.dataBind()}},_destroy:function(){this.host.children().remove()},destroy:function(){this.host.remove()},refresh:function(e){e||this._refresh()},_refresh:function(){this.render()},_setStyles:function(){this.host.css({position:"relative",width:this.width,height:this.height});null!=this.width&&this.width.toString().indexOf("%"),null!=this.height&&this.height.toString().indexOf("%");var e=this;c.jqx.utilities.resize(this.host,function(){e.resizeTimer&&clearTimeout(e.resizeTimer),e.resizeTimer=setTimeout(function(){e.performLayout()},50)})},resize:function(e,t){this.width=e,this.height=t,this.performLayout()},performLayout:function(){var e=h.default;this.clearSelection(),this._layout(this._root,e)},_getValues:function(e){for(var t=[],r=0;r<e.length;r+=1)t.push(e[r].value);return t},_isColor:function(e){if(!e)return!1;var t=this._colorEvaluator;return!(!t._isRgb(e)&&!t._isHex(e))},_colorEvaluator:{_toRgb:function(e){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},_toHex:function(e){var t=e.r.toString(16),r=e.g.toString(16),e=e.b.toString(16);return"#"+(t=1===t.length?"0"+t:t)+(r=1===r.length?"0"+r:r)+(e=1===e.length?"0"+e:e)},_isRgb:function(e){return/(rgb|rgba)\s*\(\s*\d+\s*(,\s*\d+\s*){2}(,\d+\.\d+)?\)(;?)/i.test(e)},_isHex:function(e){return/^(#([0-9A-F]{3})([0-9A-F]{3})?)$/i.test(e)},getColorByValue:function(e,t,r){var a,n,o=this._colorEvaluator;o._isRgb(r)&&(r=o._toHex(r)),r=o._toRgb(r),n=t.length,a=-1/0;for(var i=0;i<n;i+=1)a<t[i].value&&(a=t[i].value);return e=e/a,e=Math.round(e*this.colorRange),o._toHex({r:Math.max(r.r-e,0),g:Math.max(r.g-e,0),b:Math.max(r.b-e,0)})},parent:function(e){var t=e.parent.color,r=this._colorEvaluator;return e.parent?(t=t||this.baseColor,t=r.getColorByValue.call(this,e.value,e.parent.children,t),e.color=t):"#fff"},autoColors:function(e){var t=this.baseColor,t=this._colorEvaluator.getColorByValue.call(this,e.value,this._dataList,t);return e.color=t},rangeColors:function(e){for(var t,r=e.value,a=0;a<this.colorRanges.length;a+=1)if((t=this.colorRanges[a]).min<r&&t.max>=r)return t.color;return"#fff"}},_getColor:function(e){var t=e.color,r=this.colorMode;if(this._isColor(t))return t;if("function"==typeof this._colorEvaluator[r])return this._colorEvaluator[r].call(this,e);throw"Invalid colorMode"},_renderRect:function(e,t){var r=c("<div/>"),a=e[2]-e[0],n=e[3]-e[1],o=this._getColor(t);r.css({position:"absolute",left:e[0]-1,top:e[1]-1,width:a,height:n,backgroundColor:o}),r.addClass(this.toThemeProperty("jqx-treemap-rectangle"));n=this._colorEvaluator,o={data:t.data,label:t.label,value:t.value,parent:t.parent,record:t.record,color:o,rgb:n._toRgb(o)};if((t.parent==this._root&&(o.parent=null),"function"==typeof this.renderCallbacks["*"])&&void 0!==this.renderCallbacks["*"](r,o))return r;return"function"==typeof this.renderCallbacks[t.label]?this.renderCallbacks[t.label](r,o):(a=r.width()-2,r.html('<span style="max-width:'+a+'px;" class="jqx-treemap-label">'+t.label+"</span>")),r},_centerLabel:function(e,t){var r=e[0].firstChild;r.style.position="absolute",t!==a&&t!==p||(r.style.left=(e[0].offsetWidth-r.offsetWidth)/2+"px"),t!==i&&t!==p||(r.style.top=(e[0].offsetHeight-r.offsetHeight)/2+"px")},_trigger:function(e,t){e=c.Event(e);return e.args=t,this.host.trigger(e)},_addHandlers:function(r,t){var a=this;r.on("mouseenter",function(e){a.hoverEnabled&&(a.host.find(".jqx-treemap-rectangle").removeClass("jqx-treemap-rectangle-hover"),r.addClass(a.toThemeProperty("jqx-treemap-rectangle-hover"))),a._trigger("mouseenterSector",t)}),r.on("mouseleave",function(e){a.hoverEnabled&&r.removeClass("jqx-treemap-rectangle-hover"),a._trigger("mouseleaveSector",t)}),r.on("click",function(e){var t;a.selectionEnabled&&(t=c.data(this,"jqx-treemap-selected")||!1,a.singleSelection&&a.host.find(".jqx-treemap-rectangle-hover").each(function(e,t){c.data(t,"jqx-treemap-selected",!1),c(t).removeClass("jqx-treemap-rectangle-hover")}),t=t?(r.removeClass("jqx-treemap-rectangle-hover"),!1):(r.addClass(a.toThemeProperty("jqx-treemap-rectangle-hover")),!0),c.data(this,"jqx-treemap-selected",t),e.stopImmediatePropagation())})},clearSelection:function(){this.host.find(".jqx-treemap-rectangle-hover").removeClass(this.toThemeProperty("jqx-treemap-rectangle-hover")),c.data(this,"jqx-treemap-selected",!1)},_layoutArea:function(e,t){e.children.length&&0<e.children.length?(this._centerLabel(t,a),t.addClass(this.toThemeProperty("jqx-treemap-rectangle-parent"))):this._centerLabel(t,p)},_render:function(e,t){if(e.children.length){var r=0;e.value&&(r=this.headerHeight);for(var a,n,o=this._getValues(e.children),i=(e.area.offset(),t(o,e.area.width(),e.area.height()-r,0,r)),l=0;l<e.children.length;l+=1)a=e.children[l],n=this._renderRect(i[l],a),a.area=n,e.area.append(n),this._addHandlers(n,{label:a.label,value:a.value,color:a.color,sector:a.area,data:a.data}),this._layoutArea(a,n),this._render(a,t)}},_layout:function(e,t){if(e.children.length){var r=0;e.value&&(r=this.headerHeight);for(var a=this._getValues(e.children),n=(e.area.offset(),t(a,e.area.width(),e.area.height()-r,0,r)),o=0;o<e.children.length;o+=1){var i=e.children[o];this._layoutRect(n[o],i),this._layoutArea(i,i.area),this._layout(i,t)}this.showLegend&&(c(".jqx-treemap-legend").remove(),this._renderLegend())}},_layoutRect:function(e,t){var r=t.area,a=e[2]-e[0],n=e[3]-e[1];r.css({left:e[0]-1,top:e[1]-1,width:a,height:n});e=this._colorEvaluator,n=this._getColor(t),n={data:t.data,label:t.label,value:t.value,parent:t.parent,record:t.record,color:n,rgb:e._toRgb(n)};if((t.parent==this._root&&(n.parent=null),"function"==typeof this.renderCallbacks["*"])&&void 0!==this.renderCallbacks["*"](r,n))return r;"function"==typeof this.renderCallbacks[t.label]?this.renderCallbacks[t.label](r,n):(a=r.width()-2,r.find(".jqx-treemap-label:first").css("max-width",a))},_getBoundValues:function(){var e,t=this._root,r=[],a={},n={};for(a.value=t.value||1/0,n.value=t.value||-1/0,r.push(t);r.length;){e=r.pop(),a.value>e.value&&(a=e),n.value<e.value&&(n=e);for(var o=0;o<e.children.length;o+=1)r.push(e.children[o])}return[a,n]},_getAutocolorRanges:function(){for(var e,t=this._getBoundValues(),r=t[1].value,t=t[0].value,a=(r-t)/5,n=[],o=t;o<r;o+=a)e=Math.round(o),n.push({min:e,max:o+a,color:this._colorEvaluator.getColorByValue.call(this,e,this._dataList,this.baseColor)});return n},_renderLegend:function(){var e;/autoColors|rangeColors/.test(this.colorMode)&&this.showLegend&&(e=this.colorRanges,"autoColors"===this.colorMode&&(e=this._getAutocolorRanges()),e=this._renderColorLegend(e),this._renderLegendLabel(e))},_renderLegendLabel:function(e){var t=c('<tr><td colspan="'+e.find("td").length/2+'"/></tr>'),r=c('<div class="'+this.toThemeProperty("jqx-treemap-legend-label")+'" />');r.text(this.legendLabel),t.children().append(r),e.prepend(t)},_renderColorLegend:function(e){var t,r,a=c('<div class="'+this.toThemeProperty("jqx-treemap-legend")+'"/>'),n=function(e){return e};"function"==typeof this.legendScaleCallback&&(n=this.legendScaleCallback);var o=c('<table class="'+this.toThemeProperty("jqx-treemap-legend-table")+'"/>');a.append(o),o.append("<tr/>"),a.append("<div/>"),this.host.append(a),t=c(a.find("tr")[0]),(r=c(a.find("div")[0])).addClass(this.toThemeProperty("jqx-treemap-legend-values"));e.sort(function(e,t){try{if(e.min<t.min)return-1;if(e.min>t.min)return 1}catch(e){}return 0});for(var i=Math.round(a.width()/e.length),l=-2,s=0,h=0;h<e.length;h+=1){var d,u=c('<td class="'+this.toThemeProperty("jqx-treemap-legend-color")+'"/>');u.css("backgroundColor",e[h].color),t.append(u),0===h&&((d=c('<span class="'+this.toThemeProperty("jqx-treemap-legend-max-value")+" "+this.toThemeProperty("jqx-treemap-legend-value")+'"/>')).text(n(e[h].min)),r.append(d),o.css("margin-left",d.width()/2),s=l+=d.width()/2),l+=i,(d=c('<span class="'+this.toThemeProperty("jqx-treemap-legend-max-value")+" "+this.toThemeProperty("jqx-treemap-legend-value")+'"/>')).text(n(e[h].max)),r.append(d),h==e.length-1&&(s+=d.width()/2,a.css("padding-right",s+5),l-=2),l-=d.width()/2,d.css("left",l),l+=d.width()/2}return a.css({position:"absolute",left:this.legendPosition.x,bottom:this.legendPosition.y,visibility:this.showLegend?"visible":"hidden"}),a},_buildTree:function(e,t){var r=null,a=[];for(a.push(t);a.length;){r=a.pop();for(var n,o,i=0;i<e.length;i+=1)(o=e[i]).parent!==r.label&&(o.parent||r.label)||(n=r,o=new s(o.label,parseFloat(o.value,10),n,[],null,o.color,o.data,o.record),r.children.push(o),a.push(o))}return t},_buildList:function(){var e,t=[],r=[];for(r.push(this._root);r.length;){(e=r.pop())!==this._root&&t.push(e);for(var a=0;a<e.children.length;a+=1)r.push(e.children[a])}return t},propertyChangedHandler:function(e,t,r){"renderCallbacks"!==t&&(/hoverEnabled|selectionEnabled/.test(t)?r||this.host.find("jqx-treemap-rectangle-hover"):"showLegend"===t?this.host.find("jqx-treemap-legend").toggle():this._refresh())}})}(jqxBaseFramework);