!function(m){m.extend(m.jqx._jqxChart.prototype,{_moduleRangeSelector:!0,_renderXAxisRangeSelector:function(e,t){var s=this;s._isTouchDevice=m.jqx.mobile.isTouchDevice();var i=s.seriesGroups[e],r=s._getXAxis(e),o=r?r.rangeSelector:void 0;if(s._isSelectorRefresh||(o&&o.renderTo?o.renderTo:s.host).find(".rangeSelector").remove(),!r||0==r.visible||"spider"==i.type)return!1;if(!s._isGroupVisible(e))return!1;if(!o)return!1;var a="horizontal"==i.orientation;o.renderTo&&(a=!1),s.rtl&&(r.flip=!0);var n=a?this.host.height():this.host.width();n-=4;var l=this._getXAxisStats(e,r,n),d=r.position;return o.renderTo&&o.position&&(d=o.position),this._isSelectorRefresh||(i=o.renderTo,s=m("<div class='rangeSelector jqx-disableselect' style='position: absolute; background-color: transparent;' onselectstart='return false;'></div>").appendTo(i||this.renderer.getContainer()),i?(s.css({width:i.width(),height:i.height()}),t.width=i.width(),t.height=i.height()):((o=this.host.coord()).top=0,o.left=0,i=this._selectorGetSize(r),a?(s.css("left",o.left+1+t.x+("right"!=d?-i:t.width)),s.css("top",o.top),s.css("height",n),s.css("width",i),t.height=i):(s.css("left",o.left+1),s.css("top",o.top+t.y+("top"!=d?t.height:-i)),s.css("height",i),s.css("width",n))),this._refreshSelector(e,r,l,s,t,a)),!(this._isSelectorRefresh=!1)},_refreshSelector:function(e,t,s,i,r,o){var a={},n=t.rangeSelector;this.seriesGroups[e];for(p in n)a[p]=n[p];delete a.padding;var l=a.minValue,d=a.maxValue;null==l&&(l=Math.min(s.min.valueOf(),s.dsRange.min.valueOf())),null==d&&(d=Math.max(s.max.valueOf(),s.dsRange.max.valueOf())),this._isDate(s.min)&&(l=new Date(l)),this._isDate(s.max)&&(d=new Date(d));var h=t.position;n.renderTo&&n.position&&(h=n.position),a.dataField=t.dataField,delete a.rangeSelector,a.type=t.type,a.baseUnit=n.baseUnit||t.baseUnit,a.minValue=l,a.maxValue=d,a.flip=t.flip,a.position=h;var c=2,s=2,l=2,d=2;n.renderTo||(c=o?0:r.x,s=o?0:this._rect.width-r.x-r.width,l=o?r.y:5,d=o?this._paddedRect.height-this._plotRect.height:5);for(var r=null!=(r=n.padding)||n.renderTo?{left:r&&r.left?r.left:c,top:r&&r.top?r.top:l,right:r&&r.right?r.right:s,bottom:r&&r.bottom?r.bottom:d}:{left:c,top:l,right:s,bottom:d},g=t.rangeSelector.dataField,p=0;null==g&&p<this.seriesGroups.length;p++)for(var u=0;null==g&&u<this.seriesGroups[p].series.length;u++)g=this.seriesGroups[p].series[u].dataField;d={padding:r,_isRangeSelectorInstance:!0,title:n.title||"",description:n.description||"",titlePadding:n.titlePadding,colorScheme:n.colorScheme||this.colorScheme,backgroundColor:n.backgroundColor||this.backgroundColor||"transparent",backgroundImage:n.backgroundImage||"",showBorderLine:n.showBorderLine||!!n.renderTo,borderLineWidth:n.borderLineWidth||this.borderLineWidth,borderLineColor:n.borderLineColor||this.borderLineColor,rtl:n.rtl||this.rtl,greyScale:n.greyScale||this.greyScale,renderEngine:this.renderEngine,showLegend:!1,enableAnimations:!1,enableEvents:!1,showToolTips:!1,source:this.source,xAxis:a,seriesGroups:[{orientation:o?"horizontal":"vertical",valueAxis:{visible:!1},type:t.rangeSelector.serieType||"area",skipOverlappingPoints:m.jqx.getByPriority([t.rangeSelector.skipOverlappingPoints,!0]),columnSeriesOverlap:m.jqx.getByPriority([t.rangeSelector.columnSeriesOverlap,!1]),columnsGapPercent:m.jqx.getByPriority([t.rangeSelector.columnsGapPercent,25]),seriesGapPercent:m.jqx.getByPriority([t.rangeSelector.seriesGapPercent,25]),series:[{dataField:g,opacity:.8,lineWidth:1}]}]};t.rangeSelector.seriesGroups&&(d.seriesGroups=t.rangeSelector.seriesGroups),t.rangeSelector.valueAxis&&(d.valueAxis=t.rangeSelector.valueAxis),d.showBorderLine||(d.borderLineWidth=1,d.borderLineColor=m.jqx.getByPriority([this.backgroundColor,this.background,"#FFFFFF"]),d.showBorderLine=!0);var f=this;f._supressBindingRefresh=!0,i.empty(),i.jqxChart(d),f._rangeSelectorInstances[e]=i,f._supressBindingRefresh=!1,i.on(f._getEvent("mousemove"),function(){f._unselect(),f._hideToolTip()});r=i.jqxChart("getInstance");r._plotRect&&((t=r._paddedRect).height=r._plotRect.height,o||"top"!=h?o&&(d=r._renderData[0].xAxis.rect.width,t.width-=d,"right"!=h&&(t.x+=d)):t.y+=r._renderData[0].xAxis.rect.height,f._createSliderElements(e,i,t,n),f.removeHandler(m(document),f._getEvent("mousemove")+"."+this.element.id,f._onSliderMouseMove),f.removeHandler(m(document),f._getEvent("mousedown"),f._onSliderMouseDown),f.removeHandler(m(document),f._getEvent("mouseup")+"."+this.element.id,f._onSliderMouseUp),f.addHandler(m(document),f._getEvent("mousemove")+"."+this.element.id,f._onSliderMouseMove,{self:this,groupIndex:e,renderTo:i,swapXY:o}),f.addHandler(m(i),f._getEvent("mousedown"),this._onSliderMouseDown,{self:this,groupIndex:e,renderTo:i,swapXY:o}),f.addHandler(m(document),f._getEvent("mouseup")+"."+this.element.id,f._onSliderMouseUp,{element:this.element.id,self:this,groupIndex:e,renderTo:i,swapXY:o}))},_createSliderElements:function(e,t,s,i){t.find(".slider").remove();var r=i.selectedRangeColor||"blue",o=m.jqx.getByPriority([i.selectedRangeOpacity,.1]),a=m.jqx.getByPriority([i.unselectedRangeOpacity,.5]),n=i.unselectedRangeColor||"white",l=i.rangeLineColor||"grey",i=m("<div class='slider' style='position: absolute;'></div>");for(i.css({background:r,opacity:o,left:s.x,top:s.y,width:s.width,height:s.height}),i.appendTo(t);this._sliders.length<e+1;)this._sliders.push({});n="<div class='slider' style='position: absolute;  background: "+n+"; opacity: "+a+";'></div>",a="<div class='slider' style='position: absolute; background:"+l+"; opacity: "+a+";'></div>",l="<div class='slider jqx-rc-all' style='position: absolute; background: white; border-style: solid; border-width: 1px; border-color: "+l+";'></div>";this._sliders[e]={element:i,host:t,_sliderInitialAbsoluteRect:{x:i.coord().left,y:i.coord().top,width:s.width,height:s.height},_hostInitialAbsolutePos:{x:t.coord().left,y:t.coord().top},getRect:function(){return{x:this.host.coord().left-this._hostInitialAbsolutePos.x+this._sliderInitialAbsoluteRect.x,y:this.host.coord().top-this._hostInitialAbsolutePos.y+this._sliderInitialAbsoluteRect.y,width:this._sliderInitialAbsoluteRect.width,height:this._sliderInitialAbsoluteRect.height}},rect:s,left:m(n),right:m(n),leftTop:m(a),rightTop:m(a),leftBorder:m(a),leftBar:m(l),rightBorder:m(a),rightBar:m(l)},this._sliders[e].left.appendTo(t),this._sliders[e].right.appendTo(t),this._sliders[e].leftTop.appendTo(t),this._sliders[e].rightTop.appendTo(t),this._sliders[e].leftBorder.appendTo(t),this._sliders[e].rightBorder.appendTo(t),this._sliders[e].leftBar.appendTo(t),this._sliders[e].rightBar.appendTo(t);a=this._renderData[e].xAxis.data.axisStats,l=a.min.valueOf(),t=a.max.valueOf(),a=this._valueToOffset(e,l),l=this._valueToOffset(e,t);l<a&&(t=l,l=a,a=t),"horizontal"!=this.seriesGroups[e].orientation?i.css({left:Math.round(s.x+a),top:s.y,width:Math.round(l-a),height:s.height}):i.css({top:Math.round(s.y+a),left:s.x,height:Math.round(l-a),width:s.width}),this._setSliderPositions(e,a,l)},_setSliderPositions:function(e,t,s){var i=this.seriesGroups[e],r=this._getXAxis(e),o=r.rangeSelector,a="horizontal"==i.orientation;r.rangeSelector.renderTo&&(a=!1);var n=r.position;o.renderTo&&o.position&&(n=o.position);var l=this._sliders[e],d=a?"top":"left",h=a?"left":"top",c=a?"height":"width",i=a?"width":"height",r=a?"y":"x",o=a?"x":"y",e=l.rect;l.startOffset=t,l.endOffset=s,l.left.css(d,e[r]),l.left.css(h,e[o]),l.left.css(c,t),l.left.css(i,e[i]),l.right.css(d,e[r]+s),l.right.css(h,e[o]),l.right.css(c,e[c]-s+1),l.right.css(i,e[i]),l.leftTop.css(d,e[r]),l.leftTop.css(h,e[o]+(a&&"right"==n||!a&&"top"!=n?0:e[i])),l.leftTop.css(c,t),l.leftTop.css(i,1),l.rightTop.css(d,e[r]+s),l.rightTop.css(h,e[o]+(a&&"right"==n||!a&&"top"!=n?0:e[i])),l.rightTop.css(c,e[c]-s+1),l.rightTop.css(i,1),l.leftBorder.css(d,e[r]+t),l.leftBorder.css(h,e[o]),l.leftBorder.css(c,1),l.leftBorder.css(i,e[i]);n=e[i]/4;20<n&&(n=20),n<3&&(n=3),l.leftBar.css(d,e[r]+t-3),l.leftBar.css(h,e[o]+e[i]/2-n/2),l.leftBar.css(c,5),l.leftBar.css(i,n),l.rightBorder.css(d,e[r]+s),l.rightBorder.css(h,e[o]),l.rightBorder.css(c,1),l.rightBorder.css(i,e[i]),l.rightBar.css(d,e[r]+s-3),l.rightBar.css(h,e[o]+e[i]/2-n/2),l.rightBar.css(c,5),l.rightBar.css(i,n)},_resizeState:{},_onSliderMouseDown:function(e){e.stopImmediatePropagation(),e.stopPropagation();var t=e.data.self;t._sliders[e.data.groupIndex]&&(null==t._resizeState.state&&t._testAndSetReadyResize(e),"ready"==t._resizeState.state&&((m.jqx._rangeSelectorTarget=t)._resizeState.state="resizing"))},_valueToOffset:function(e,t){var s=this.seriesGroups[e],i=this._sliders[e],r=i.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats,o=r.min.valueOf(),r=r.max.valueOf()-o;0==r&&(r=1);e=this._getXAxis(e),s="horizontal"==s.orientation?"height":"width",r=(t.valueOf()-o)/r;return i.getRect()[s]*(e.flip?1-r:r)},_offsetToValue:function(e,t){var s=this._sliders[e],i=this.seriesGroups[e],r=this._getXAxis(e),o="horizontal"==i.orientation?"height":"width",a=s.getRect()[o];0==a&&(a=1);e=s.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats,i=e.min.valueOf(),o=e.max.valueOf(),s=t/a*(o-i)+i;return 1==r.flip&&(s=o-t/a*(o-i)),this._isDate(e.min)||this._isDate(e.max)?s=new Date(s):(null!=r.dataField&&!e.useIndeces||(s=Math.round(s)),s<e.min&&(s=e.min),s>e.max&&(s=e.max)),s},_onSliderMouseUp:function(e){var t=m.jqx._rangeSelectorTarget;if(t){var s=e.data.groupIndex,i=e.data.swapXY,r=t._sliders[s];if(r&&"resizing"==t._resizeState.state){e.stopImmediatePropagation(),e.stopPropagation(),t._resizeState={},t.host.css("cursor","default");var o=i?"top":"left",a=i?"y":"x",e=r.element.coord()[o],o=e+(i?r.element.height():r.element.width()),i=r.getRect(),n=t._offsetToValue(s,e-i[a]),l=t._offsetToValue(s,o-i[a]);!r.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats.isTimeUnit&&864e5<l.valueOf()-n.valueOf()&&(n.setHours(0,0,0,0),l.setDate(l.getDate()+1),l.setHours(0,0,0,0));var d=t._getXAxis(s);d.flip&&(c=n,n=l,l=c);for(var h=0;h<t.seriesGroups.length;h++)t._getXAxis(h)==d&&(t._selectorRange[h]={min:n,max:l});t._isSelectorRefresh=!0;var c=t.enableAnimations;t._raiseEvent("rangeSelectionChanging",{instance:t,minValue:n,maxValue:l}),t.enableAnimations=!1,t.update(),t.enableAnimations=c,t._raiseEvent("rangeSelectionChanged",{instance:t,minValue:n,maxValue:l})}}},_onSliderMouseMove:function(e){var t,s,i,r,o,a,n,l,d,h,c,g,p=e.data.self,u=(e.data.renderTo,e.data.groupIndex),f=p._sliders[u],_=e.data.swapXY;f&&(t=f.getRect(),g=f.element,s=m.jqx.position(e),i=g.coord(),r=_?"top":"left",o=_?"height":"width",c=_?"y":"x","resizing"==p._resizeState.state?(e.stopImmediatePropagation(),e.stopPropagation(),"left"==p._resizeState.side?(h=Math.round(s[r]-i[r]),a=t[c],i[r]+h>=a&&i[r]+h<=a+t[o]&&(d=parseInt(g.css(r)),n=Math.max(2,(_?g.height():g.width())-h),g.css(o,n),g.css(r,d+h))):"right"==p._resizeState.side?(l=_?g.height():g.width(),h=Math.round(s[r]-i[r]-l),a=t[c],i[r]+l+h>=a&&i[r]+h+l<=a+t[o]&&(n=Math.max(2,l+h),g.css(o,n))):"move"==p._resizeState.side&&(l=_?g.height():g.width(),d=parseInt(g.css(r)),h=Math.round(s[r]-p._resizeState.startPos),i[r]+h>=t[c]&&i[r]+h+l<=t[c]+t[o]&&(p._resizeState.startPos=s[r],g.css(r,d+h))),g=(c=parseInt(g.css(r))-f.rect[c])+(_?g.height():g.width()),p._setSliderPositions(u,c,g)):p._testAndSetReadyResize(e))},_testAndSetReadyResize:function(e){var t=e.data.self,s=e.data.renderTo,i=e.data.groupIndex,r=t._sliders[i],o=e.data.swapXY,a=r.getRect(),n=r.element,l=m.jqx.position(e),d=n.coord(),h=o?"left":"top",i=o?"top":"left",r=o?"width":"height",e=t._isTouchDevice?30:5;l[h]>=d[h]&&l[h]<=d[h]+a[r]?Math.abs(l[i]-d[i])<=e?(s.css("cursor",o?"row-resize":"col-resize"),t._resizeState={state:"ready",side:"left"}):Math.abs(l[i]-d[i]-(o?n.height():n.width()))<=e?(s.css("cursor",o?"row-resize":"col-resize"),t._resizeState={state:"ready",side:"right"}):l[i]+e>d[i]&&l[i]-e<d[i]+(o?n.height():n.width())?(s.css("cursor","pointer"),t._resizeState={state:"ready",side:"move",startPos:l[i]}):(s.css("cursor","default"),t._resizeState={}):(s.css("cursor","default"),t._resizeState={})},_selectorGetSize:function(e){return e.rangeSelector.renderTo?0:e.rangeSelector.size||this._paddedRect.height/3}})}(jqxBaseFramework);