!function(a){a.jqx.jqxWidget("jqxPivotGrid","",{}),a.extend(a.jqx._jqxPivotGrid.prototype,{defineInstance:function(){var t={scrollBarsEnabled:!0,source:null,groupingColumns:[],isGroupingEnabled:!1,_offsetX:0,_offsetY:0,_currentPosition:{},_selectStartPosition:{},_isMouseLeftButtonDown:!1,_timeLastUp:new Date,_timeLastDown:new Date,resizeTooltipEnabled:!1,isHorizontalResize:!0,_colResizeState:"NO_RESIZE",activeEditor:{Editor:null},_id:0,_colItemRangeSelectionBeg:null,_colItemRangeSelectionEnd:null,_rowItemRangeSelectionBeg:null,_rowItemRangeSelectionEnd:null,_isCTRLPressed:!1,_internalSelectMode:"CELLS_SELECT",_mostRightItemBounds:{x:0,y:0,width:0,height:0},_mostLeftItemBounds:{x:0,y:0,width:0,height:0},_adjSelectedItemsSave:{},multipleSelectionEnabled:!0,selectionEnabled:!0,selectionMode:"CELLS_SELECT",treeStyleRows:!0,autoResize:!1,cellsRenderer:null,itemsRenderer:null,localization:null};return a.extend(!0,this,t),this._createPivotAreas(),t},_createPivotAreas:function(){this._pivotRows&&(this._pivotRows.clear(),delete this._pivotRows),this._pivotColumns&&(this._pivotColumns.clear(),delete this._pivotColumns),this._pivotCells&&(this._pivotCells._resetCanvas(),this._pivotCells.clear(),delete this._pivotCells),this._pivotRows=new a.jqx.jqxPivotGrid.pivotRows(this),this._pivotColumns=new a.jqx.jqxPivotGrid.pivotColumns(this),this._pivotCells=new a.jqx.jqxPivotGrid.pivotCells,this._pivotCells.parentPivotGrid=this},_instanceId:0,createInstance:function(t){this.element;var e=this.host,i=this;i.localizeStrings(i.localization);var s="jqx-pivotgrid jqx-rc-all jqx-widget "+this.toThemeProperty("jqx-widget-content"),n="";this._isTouchDevice()&&(n="class='jqx-grid-menu-item-touch'"),e.append("<div class='"+s+"' style='width:100%; height: 100%; overflow:hidden; position:relative; onselectstart='return false;' oncontextmenu='return false;''><div id='divContent' style='width:100px; height:100%;'></div><div id='divHScroll' style='width:100%; height:13px;'></div><div id='divVScroll' style='width:13px; height:100%;'></div><div id='divContextMenu'><ul><li "+n+"><div id='sortasc' class='jqx-pivotgrid-sortasc-icon'></div><span>"+i._localizedStrings.sortascendingstring+"</span></li><li "+n+"><div id='sortdesc' class='jqx-pivotgrid-sortdesc-icon'></div><span>"+i._localizedStrings.sortdescendingstring+"</span></li><li "+n+"><div id='sortremove' class='jqx-pivotgrid-sortremove-icon'></div><span>"+i._localizedStrings.sortremovestring+"</span></li></ul></div></div>");s=e.find("#divContent"),s[0],n=document.createElement("div");n.style.position="relative",n.style.left="0px",n.style.top="0px",n.style.width="100%",n.style.height="100%",n.style.overflow="hidden",s.append(n),this.contentCanvas=this.Canvas=n,this.hostVScroll=e.find("#divVScroll"),this.hostHScroll=e.find("#divHScroll"),this.hScroll=e.find("#divHScroll").jqxScrollBar({vertical:!1,theme:this.theme}),this.vScroll=e.find("#divVScroll").jqxScrollBar({vertical:!0,theme:this.theme}),i._createContextMenu(),i.id=i._instanceId++,i._resizeLineId="divResizeLine"+i.id,a(document.body).append("<div id='"+i._resizeLineId+"' style='position: absolute; display: none;'></div>");try{i.dataBind()}catch(t){throw"Databinding exception: "+t.toString()}i._installEventHandlers(),a.jqx.utilities.resize(i.host,function(){i.refresh()},!1),i._isInitialized||(i._isInitialized=!0)},destroy:function(){this._isInitialized=!1,this.host.find("#divHScroll").off(),this.host.find("#divVScroll").off(),this._contextMenu.off(),this.removeHandler(this.host),a.jqx.utilities.resize(this.host,null,!0)},_installEventHandlers:function(){var i=this;i.hostVScroll.on("valueChanged",function(t){t.currentTarget==i.hostVScroll[0]&&i.onVScroll(t.currentValue)}),i.hostHScroll.on("valueChanged",function(t){t.currentTarget==i.hostHScroll[0]&&i.onHScroll(t.currentValue)}),i.addHandler(i.host,"mousewheel DOMMouseScroll",function(t){var e;i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||(e=a.jqx.position(t),i.isPtInRect({x:e.left,y:e.top},i._rect)&&(t.preventDefault(),i._scrollBarPositions.vertical.visible&&i.onMouseWheel(t)))}),i.addHandler(i.host,"mouseenter",function(t){t.currentTarget==i.element&&i._onMouseEnter(t)}),i.addHandler(i.host,"mouseleave",function(t){t.currentTarget==i.element&&i._onMouseLeave(t)}),i.addHandler(i.host,"mousedown",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||(t.preventDefault(),i._onMouseDown(t),this.focus())}),i.addHandler(a(document),"mouseup",function(t){var e;i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||(t.preventDefault(),i._onMouseUp(t),t.cancel||(e=a.jqx.position(t),!i.isPtInRect({x:e.left,y:e.top},i._rect)&&"RESIZING"!=i._colResizeState||i._onMouseClick(t)))}),i.addHandler(a(document),"mousemove",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||i._onMouseMove(t)}),i.addHandler(a(document),"keydown",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||i._isContextMenuOpen||(17==t.keyCode?i._isCTRLPressed=!0:16==t.keyCode?i._isSHIFTPressed=!0:i._handleKeyboardNavigation&&i._handleKeyboardNavigation(t))}),i.addHandler(a(document),"keyup",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||i._isContextMenuOpen||(17==t.keyCode?i._isCTRLPressed=!1:16==t.keyCode&&(i._isSHIFTPressed=!1))})},_createContextMenu:function(){var s=this,t=this.host.find("#divContextMenu");s._contextMenu=t.jqxMenu({width:"120px",autoCloseOnClick:!0,autoOpenPopup:!1,animationShowDuration:0,animationHideDuration:0,animationShowDelay:0,theme:this.theme,keyboardNavigation:!1,mode:"popup"});for(var e=t.find("li"),i="",n=0;n<e.length;n++){var o=a(e[n]).text();o.length>i.length&&(i=o)}var r=a('<span style="white-space:nowrap;">'+i+"</span>");r.addClass(this.toThemeProperty("jqx-menu-item")),this.host.append(r);var l=r.outerWidth()+30;r.remove(),s._contextMenu=t.jqxMenu({width:l}),s._contextMenu.on("shown",function(){s._isContextMenuOpen=!0}),s._contextMenu.on("closed",function(){s._isContextMenuOpen=!1,s._hideItemMenuElement()}),s._contextMenu.on("itemclick",function(t){t.stopImmediatePropagation(),t.stopPropagation();var e,i=s._menuElement._itemMouseOver;i&&(e=i.hierarchy==s._pivotColumns?s._pivotRows:s._pivotColumns,-1!=(t=t.args.innerHTML).indexOf("sortasc")?e.sortBy(i,"asc"):-1!=t.indexOf("sortdesc")?e.sortBy(i,"desc"):-1!=t.indexOf("sortremove")&&e.removeSort())})},_isTouchDevice:function(){if(null!=this.touchDevice)return this.touchDevice;var t=a.jqx.mobile.isTouchDevice();if(this.touchDevice=t,1==this.touchmode){if(a.jqx.browser.msie&&a.jqx.browser.version<9)return this.enablehover=!1;t=!0,a.jqx.mobile.setMobileSimulator(this.element),this.touchDevice=t}else 0==this.touchmode&&(t=!1);return t&&0!=this.touchModeStyle&&(this.touchDevice=!0,this.host.addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-content").addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-header").addClass(this.toThemeProperty("jqx-touch")),this.scrollbarsize=this.touchscrollbarsize),t},propertyChangedHandler:function(t,e,i,s){null!=this._isInitialized&&0!=this._isInitialized&&("source"==e?this.dataBind():"theme"==e&&(this.hostVScrollBar.jqxScrollBar("theme",this.theme),this.hostHScrollBar.jqxScrollBar("theme",this.theme)),this._internalRefresh())},genId:function(){return this._id++},getCellId:function(t,e){return t.id+"_"+e.id},_scrollTimer:void 0,_renderOnTimeout:function(t){clearTimeout(this._scrollTimer);var e=this;0==t?(this._pivotColumns._refreshRequired=this._pivotRows._refreshRequired=!0,e._internalRefresh()):this._scrollTimer=setTimeout(function(){e._render()},t)},onVScroll:function(t){(t=Math.round(t))!=this._offsetY&&(this._offsetY=t,this._renderOnTimeout(0))},onHScroll:function(t){(t=Math.round(t))!=this._offsetX&&(this._offsetX=t,this._renderOnTimeout(0))},onMouseWheel:function(t){var e,i,s=0;(t=t||window.event).wheelDelta?s=t.wheelDelta/120:t.detail&&(s=-t.detail/3),s&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1,e=this.vScroll.jqxScrollBar("min"),i=this.vScroll.jqxScrollBar("max"),t=this.vScroll.jqxScrollBar("value"),i<(t-=s*=10)&&(t=i),t<e&&(t=e),this.vScroll.jqxScrollBar("value",t))},_onMouseMove:function(t){var e=a.jqx.position(t),i=e.left,s=e.top;if(this.isPtInRect({x:i,y:s},this._rect)||"RESIZING"==this._colResizeState){e=this.host.offset();if(i-=Math.round(e.left),s-=Math.round(e.top),i=Math.max(i,0),s=Math.max(s,0),this._currentPosition.x!=i||this._currentPosition.y!=s){for(var n in this._currentPosition.x=i,this._currentPosition.y=s,this._scrollBarPositions)if(this._scrollBarPositions[n].visible&&this.isPtInRect({x:i,y:s},this._scrollBarPositions[n].rect))return;this._handleMouseMove(t),this.activeEditor&&this.activeEditor.Editor}}},_onMouseEnter:function(t){},_onMouseLeave:function(t){this._hideItemMenuElement()},_onMouseDown:function(t){var e=this._itemHitTest(this._currentPosition,{isOnItemButton:!1});if(null!=e&&this._raisePivotItemMouseEvent(e,"pivotitemmousedown",0==t.button?"left":"right"))return void(t.cancel=!0);0==t.button?this.onMouseLeftButtonDown(t):2==t.button&&this.onMouseRightButtonDown(t)},_onMouseUp:function(t){var e=this._itemHitTest(this._currentPosition,{isOnItemButton:!1});if(null!=e&&this._raisePivotItemMouseEvent(e,"pivotitemmouseup",0==t.button?"left":"right"))return void(t.cancel=!0);0==t.button?this.onMouseLeftButtonUp(t):2==t.button&&this.onMouseRightButtonUp(t)},_onMouseClick:function(t){var e=this;if(e._handleMouseClick(t),!t.cancel){if(e._dtLastMouseClick)if(new Date-e._dtLastMouseClick<500)return this._handleMouseDoubleClick(t),void(e._dtLastMouseClick=void 0);e._dtLastMouseClick=new Date}},setDivContent:function(t,e,i,s,n){var o=this.getChild(t,"innerDiv");o.style.padding=i.top+"px "+i.right+"px "+i.bottom+"px "+i.left+"px",s&&(o.style["text-align"]=s),this.setElementSize(t,parseFloat(t.style.width),parseFloat(t.style.height)),n&&(o.style.width=parseFloat(t.style.width)-i.left+"px"),o.innerHTML=e},setElementPosition:function(t,e,i){t.style.position="absolute",t.style.left=e+"px",t.style.top=i+"px"},_getFloat:function(t){for(var e,i=0;i<t.length;i++)if(e=parseFloat(t[i]),!isNaN(e))return e;return NaN},setElementSize:function(t,e,i){t.style.width=e+"px",t.style.height=i+"px";var s,n,o,r=this.getChild(t,"innerDiv");r&&(s=this._getFloat([r.style.padding.left,r.style.padding,0]),n=this._getFloat([r.style.padding.right,r.style.padding,0]),o=this._getFloat([r.style.padding.top,r.style.padding,0]),t=this._getFloat([r.style.padding.bottom,r.style.padding,0]),r.style.width=e-s-n+"px",r.style.height=i-o-t+"px")},createCanvas:function(t){var e=document.createElement("div");return e.style["background-color"]="transparent",e.style.overflow="hidden",t.appendChild(e),e},createDiv:function(t,e,i,s){var n=document.createElement("div");n.id=e,n.style.height=s+"px",n.style.width=i+"px";e=document.createElement("div");return e.id="innerDiv",e.style.height=s+"px",e.style.width=i+"px",n.appendChild(e),t.appendChild(n),n},getPivotRows:function(){return this._pivotRows},getPivotColumns:function(){return this._pivotColumns},getPivotCells:function(){return this._pivotCells},_layout:function(){this.host.find("#divContent"),this.host.find("#divVScroll"),this.host.find("#divHScroll"),this.host.width(),this.host.height();this._pivotCells.Canvas||(this._pivotCells.Canvas=this.createCanvas(this.Canvas,"divCells",100,100)),this._pivotRows.Canvas||(this._pivotRows.Canvas=this.createCanvas(this.Canvas,"divRowsHierarchy",100,100)),this._pivotColumns.Canvas||(this._pivotColumns.Canvas=this.createCanvas(this.Canvas,"divColumnsHierarchy",100,100)),this._pivotRows.isHidden?this._pivotRows.Canvas.style.display="none":(this._pivotRows.Canvas.style.display="block",this.setElementPosition(this._pivotRows.Canvas,this._pivotRows.x,this._pivotRows.y),this.setElementSize(this._pivotRows.Canvas,this._pivotRows.getWidth()+1,this._pivotRows.getHeight()),null==this._pivotRows.renderCanvas&&(this._pivotRows.renderCanvas=this.createCanvas(this._pivotRows.Canvas,"divRowsRender",100,100)),this.setElementSize(this._pivotRows.renderCanvas,this._pivotRows.getWidth()+1,this._pivotRows.getHeight())),this._pivotColumns.isHidden?this._pivotColumns.Canvas.style.display="none":(this._pivotColumns.Canvas.style.display="block",this.setElementPosition(this._pivotColumns.Canvas,this._pivotColumns.x,this._pivotColumns.y),this.setElementSize(this._pivotColumns.Canvas,this._pivotColumns.getWidth(),this._pivotColumns.getHeight()+1),null==this._pivotColumns.renderCanvas&&(this._pivotColumns.renderCanvas=this.createCanvas(this._pivotColumns.Canvas,"divColumnsRender",100,100)),this.setElementSize(this._pivotColumns.renderCanvas,this._pivotColumns.getWidth(),this._pivotColumns.getHeight()+1)),this.setElementPosition(this._pivotCells.Canvas,this._pivotColumns.x,this._pivotRows.y),this.setElementSize(this._pivotCells.Canvas,this._pivotCells.viewPort.width,this._pivotCells.viewPort.height),null==this._pivotCells.renderCanvas&&(this._pivotCells.renderCanvas=this.createCanvas(this._pivotCells.Canvas,"divCellsRender",100,100)),this.setElementSize(this._pivotCells.renderCanvas,this._pivotColumns.getWidth()+1,this._pivotRows.getHeight()+1)},refresh:function(){this._pivotColumns._renderRequired=!0,this._pivotRows._renderRequired=!0,this._pivotCells.clear(),this._internalRefresh()},_internalRefresh:function(){var t,e,i,s,n,o=this.host.offset();this.autoResize&&(t=this._pivotColumns.isHidden?0:this._pivotColumns.getHeight(),e=this._pivotColumns.isHidden?0:this._pivotColumns.getWidth(),i=this._pivotRows.isHidden?0:this._pivotRows.getHeight(),s=this._pivotRows.isHidden?0:this._pivotRows.getWidth(),(n={}).width=e+s+1,n.height=t+i+1,n.width==this.host.width()&&n.height==this.host.height()||(this._pivotColumns._renderRequired=this._pivotRows._renderRequired=!0,this.host.css({width:n.width+"px",height:n.height+"px"}))),this._rect={x:o.left,y:o.top,width:this.host.width(),height:this.host.height()},this._render(),this.host.find("#divHScroll").jqxScrollBar("refresh")},_render:function(){var t=this._pivotColumns._renderRequired||this._pivotRows._renderRequired;this._pivotRows.compactStyleRenderingEnabled!=this.treeStyleRows&&(this._pivotRows.compactStyleRenderingEnabled=this.treeStyleRows,t=!0),t&&(this._pivotRows._renderRequired=this._pivotColumns._renderRequired=!0,this.RenderGridContent(),this._layout()),this._pivotRows.viewPort.y=this._offsetY+(this._pivotColumns.isVisible()?this._pivotColumns.viewPort.height:0),this._pivotColumns.viewPort.x=this._offsetX+(this._pivotRows.isVisible()?this._pivotRows.viewPort.width:0),this._pivotColumns.refresh(),this._pivotRows.refresh(),this._pivotCells.render(),this._updateMenuElement()},_updateMenuElement:function(){var t=this.host.find("#divContent")[0];this._menuElement&&(a(this._menuElement).off(),t.removeChild(this._menuElement));var e=document.createElement("div");e.style.height="16px",e.style.width="16px",e.style.id="menu_element",e.style.align="left",e.style.valign="top",e.style.display="none",t.appendChild(e),this._menuElement=e;var i=this;a(i._menuElement).on("click",function(){i._showItemContextMenu()})},dataBind:function(){var t=this.source;function h(t,e,i,s,n){for(var o in t.items){var r=t.items[o];(l=new a.jqx.jqxPivotGrid.pivotItem(i,s)).text=r.text,l.adapterItem=r,l.isColumn=n,e.items.push(l),h(r,l,l,s,n)}for(var o in t.valueItems){var l,r=t.valueItems[o];(l=new a.jqx.jqxPivotGrid.pivotItem(i,s)).adapterItem=r,l.text=r.text,l.isColumn=n,l._isValueItem=!0,e.valueItems.push(l),h(r,l,l,s,n)}}this.localization&&!t.localization&&(t.localization=this.localization),t.dataBind(),this._createPivotAreas(),h(t._rowsHierarchy,this._pivotRows,null,this._pivotRows,!1),h(t._columnsHierarchy,this._pivotColumns,null,this._pivotColumns,!0),this.bindingState="DataBoundPivot",this._pivotRows.autoResize("default"),this._pivotColumns.autoResize("default"),this._internalRefresh()},getChild:function(t,e){for(var i=t.childNodes,s=0;s<i.length;s++)if(i[s].id==e)return i[s];return null},scrollToOffset:function(t,e){for(var i=this.gridcells,s=0;s<i.length;s++)i[s].style.top=e+parseInt(i[s].originalY)+"px",this.setDivContent(i[s],"cell "+s)},getWidth:function(){return this.host.width()},getHeight:function(){return this.host.height()},RenderGridContent:function(){if(!this._pivotColumns._renderRequired&&!this._pivotRows._renderRequired)return this._pivotRows.viewPort.y=this._offsetY,void(this._pivotColumns.viewPort.x=this._offsetX);var t,e,i,s,n,o,r,l;this.PaintSuspended||"RESIZING"!=this._colResizeState&&((t={}).x=this._offsetX,t.y=this._offsetY,t.width=this.getWidth(),t.height=this.getHeight(),0!=t.width&&0!=t.height&&(this.PaintSuspended=!0,this._pivotColumns._isColumnsCountRequresUpdate&&(this._pivotColumns._updateVisibleLeaves(),this._pivotColumns._updateColumnsCount(),this._pivotColumns._updateColumnsIndexes()),this._pivotRows._isColumnsCountRequresUpdate&&(this._pivotRows._updateColumnsCount(),this._pivotRows._updateColumnsIndexes()),0!=this.getWidth()&&0!=this.getHeight()&&(this.GroupingEnabled&&0<this.groupingColumns.length&&(this._pivotRows.isHidden=!0),this._pivotColumns._renderRequired&&this._pivotColumns.render(),this._pivotRows._renderRequired&&this._pivotRows.render(),l=this._pivotColumns.isVisible()?this._pivotColumns.getHeight():0,e=this._pivotRows.isVisible()?this._pivotRows.getWidth():0,o={width:this._pivotColumns.getWidth()+e,height:this._pivotRows.getHeight()+l},this.scrollableAreaSize==o&&!this.isSyncScrollRequired||(this.scrollableAreaSize=o,this.SynchronizeScrollBars()),r=this.host.find("#divContent"),i=this.host.find("#divVScroll"),n="none"!=(s=this.host.find("#divHScroll")).css("display"),o="none"!=i.css("display"),r.css({height:t.height-(n?s.height()+4:0)+"px"}),r.css({width:t.width-(o?i.width()+4:0)+"px"}),r=t.height,t.height==this.getHeight()&&(r=t.height-l-(n?s.height()+4:0))<0&&(r=t.height),this._pivotRows.x=0,this._pivotRows.y=l,this._pivotRows.viewPort={x:this._pivotRows.x,y:t.y,width:this._pivotRows.getWidth(),height:r},l=t.width,t.width==this.getWidth()&&(l=t.width-e-(o?i.width()+4:0))<0&&(l=t.width),this._pivotColumns.x=e,this._pivotColumns.y=0,this._pivotColumns.viewPort={x:t.x,y:this._pivotColumns.y,width:l,height:this._pivotColumns.getHeight()},this._pivotCells.Bounds={x:this._pivotColumns.x,y:this._pivotRows.y,width:this._pivotColumns.getWidth(),height:r},this._pivotCells.viewPort={x:t.x,y:t.y,width:l,height:r},null!=this.draggingItem&&"visible"==this.dragElement.visibility&&this.dragElement.setValue(this.Canvas.ZIndexProperty,1e4),this._pivotRows._renderRequired=!1,this._pivotColumns._renderRequired=!1),this.PaintSuspended=!1))},SynchronizeScrollBars:function(){var t,e=!1,i=!1,s=this.host.find("#divVScroll"),n=this.host.find("#divHScroll"),o="none"!=n.css("display"),r="none"!=s.css("display"),l=n.height();this.scrollableAreaSize.height>this.getHeight()&&(e=!0),this.scrollableAreaSize.width>this.getWidth()&&(i=!0),this.scrollableAreaSize.height<=this.getHeight()&&this.scrollableAreaSize.width<=this.getWidth()&&(i=e=!1),e&&(i=i||this.scrollableAreaSize.width>this.getWidth()-l),i&&(e=e||this.scrollableAreaSize.height>this.getHeight()-l),e?(s[0].style.display="block",(t=this.getHeight()-(i?l+5:0))<0&&(t=0),this.setElementPosition(s[0],this.getWidth()-l-4,0),this.setElementSize(s[0],l,t),s.jqxScrollBar("min",0),(t=this.scrollableAreaSize.height-(this.getHeight()-(i?l:0))+4)!=s.jqxScrollBar("max")&&s.jqxScrollBar("max",t),null!=this.VerticalScrollBarSmallChange?s.jqxScrollBar("step",this.VerticalScrollBarSmallChange):s.jqxScrollBar("step",10),(t=this.scrollableAreaSize.height/10)<10&&(t=10),null!=this.VerticalScrollBarLargeChange&&(t=verticalScrollBarLargeChange),s.jqxScrollBar("largestep")!=t&&s.jqxScrollBar("largestep",t),s.jqxScrollBar("largestep")<s.jqxScrollBar("step")&&s.jqxScrollBar("largestep",s.jqxScrollBar("step")),this.rtl):(s.jqxScrollBar("value",0),s[0].style.display="none"),i?(n[0].style.display="block",((r=this.getWidth()-(e?l+5:0))<0||null==r)&&(r=0),this.setElementPosition(n[0],0,this.getHeight()-l-4),this.setElementSize(n[0],r,l),0!=n.jqxScrollBar("min")&&n.jqxScrollBar("min",0),l=this.scrollableAreaSize.width-(this.getWidth()-(e?l:0))+4,n.jqxScrollBar("max")!=l&&n.jqxScrollBar("max",l),null!=this.HorizontalScrollBarSmallChange?n.jqxScrollBar("step",this.HorizontalScrollBarSmallChange):n.jqxScrollBar("step",10),(l=this.getWidth()/2)<25&&(l=25),null!=this.HorizontalScrollBarLargeChange&&(l=this.HorizontalScrollBarSmallChange),n.jqxScrollBar("largestep",l),n.jqxScrollBar("largestep")<n.jqxScrollBar("largestep")&&n.jqxScrollBar("largestep",n.jqxScrollBar("step"))):(n.jqxScrollBar("value",0),n[0].style.display="none"),i=i&&this.scrollBarsEnabled,e=e&&this.scrollBarsEnabled,i!=("block"==n[0].display)&&(n[0].display=i?"block":"none"),e!=("block"==s[0].display)&&(s[0].display=e?"block":"none"),this._scrollBarPositions={vertical:{visible:e,rect:{x:s.position().left,y:s.position().top,width:s.width(),height:s.height()}},horizontal:{visible:i,rect:{x:n.position().left,y:n.position().top,width:n.width(),height:n.height()}}},n.jqxScrollBar("refresh"),s.jqxScrollBar("refresh")},isPtInRect:function(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},onMouseLeftButtonUp:function(t){var e,i=this;for(e in i._scrollBarPositions)if(this._scrollBarPositions[e].visible&&this.isPtInRect(i._currentPosition,i._scrollBarPositions[e].rect))return i._isMouseCaptured()&&i._releaseMouseCapture(),void(i._isMouseLeftButtonDown=!1);if(i._isMouseCaptured())i._releaseMouseCapture();else if(!i._itemMenuButtonMouseOver&&!i._isContextMenuOpen){i.canDrag=!1;var s=a.jqx.position(t),t=i.isPtInRect({x:s.left,y:s.top},i._rect),s=i._pivotCells._hitTest(i._currentPosition);if(s&&t)if(i._raisePivotCellMouseEvent(s.pivotRow,s.pivotColumn,"pivotcellmouseup","left"))return;if("RESIZING"==i._colResizeState){i._colResizeState="NO_RESIZE",i._updateCursor("ARROW"),i._pivotColumns._renderRequired=!0,i._pivotRows._renderRequired=!0;var n=i.resizingItem.x+i.resizingItem.hierarchy.x-i._offsetX,o=i.resizingItem.y+i.resizingItem.hierarchy.y-i._offsetY;return this.isHorizontalResize?i.resizingItem.setWidth(Math.max(i.resizingItem.minimumWidth,Math.abs(i._currentPosition.x-n))):i.resizingItem.setHeight(Math.max(i.resizingItem.minimumHeight,Math.abs(i._currentPosition.y-o))),a("body").find("#"+i._resizeLineId).hide(),i.resizingItem=null,i.resizeTooltipEnabled,i._isMouseLeftButtonDown=!1,void i._internalRefresh()}n={isOnItemButton:!1},o=i._itemHitTest(i._currentPosition,n);if(null==o||!n.isOnItemButton&&!n.isOnMenuButton){n=!1;if(i._canDrop(o)?(i._endDrag(o),n=!0):i.dragElement&&"block"==i.dragElement.style.display&&(i._endDrag(draggingItem),n=!0),n)return i._isMouseLeftButtonDown=!1,void i._internalRefresh();i._isMouseLeftButtonDown=!1,t&&null==i.activeEditor.Editor&&i._updateSelection()}}},onMouseLeftButtonDown:function(t){for(var e in this._scrollBarPositions)if(this._scrollBarPositions[e].visible&&this.isPtInRect(this._currentPosition,this._scrollBarPositions[e].rect))return void this._captureMouse();var i={isOnItemButton:!1},s=this._itemHitTest(this._currentPosition,i);this._timeLastDown=new Date;if(this.isShiftPressed||(this._selectStartPosition={x:this._currentPosition.x,y:this._currentPosition.y}),!this._itemMenuButtonMouseOver&&!this._isContextMenuOpen){if(this._isMouseLeftButtonDown=!0,"READY_RESIZE"==this._colResizeState)return this._colResizeState="RESIZING",this._updateCursor(this.isHorizontalResize?"COLUMN_RESIZE":"ROW_RESIZE"),void this._refreshMouseCursor();if("RESIZING"!=this._colResizeState){if(null!=s){if(i.isOnItemButton)return this._lastToggle&&this._lastToggle.item==s&&new Date-this._lastToggle.time<500?void 0:(this._isMouseLeftButtonDown=!1,s.isExpanded?s.collapse():s.expand(),this._lastToggle={time:new Date,item:s},void this._internalRefresh());this.canDrag=!0,i.isOnItemButton?this._updateCursor("ARROW"):this._updateCursor("CROSS"),s.isColumn?this._internalSelectMode="COL_SELECT":this._internalSelectMode="ROW_SELECT"}else this._internalSelectMode="CELLS_SELECT";s=this._pivotCells._hitTest(this._currentPosition);if(s)if(this._raisePivotCellMouseEvent(s.pivotRow,s.pivotColumn,"pivotcellmousedown","left"))return;null==this.activeEditor.Editor&&this._updateSelection(),this._refreshMouseCursor()}}},onMouseRightButtonDown:function(t){this._timeLastDown=new Date;var e,i=this._itemHitTest(this._currentPosition,{isOnItemButton:!1});null==i?(e=this._pivotCells._hitTest(this._currentPosition))&&this._raisePivotCellMouseEvent(e.pivotRow,e.pivotColumn,"pivotcellmousedown","right"):this._raisePivotItemMouseEvent(i,"pivotitemmousedown","right")},onMouseRightButtonUp:function(t){var e=a.jqx.position(t),t=this.isPtInRect({x:e.left,y:e.top},this._rect),e=this._pivotCells._hitTest(this._currentPosition);e&&t&&this._raisePivotCellMouseEvent(e.pivotRow,e.pivotColumn,"pivotcellmouseup","right"),this._timeLastUp=new Date},_itemMouseMove:function(t,e){if(this.resizingItem)this.isHorizontalResize?this._updateCursor("COLUMN_RESIZE"):this._updateCursor("ROW_RESIZE");else{this._menuElement._itemMouseOver!=e&&this._hideItemMenuElement(),this._updateCursor("CROSS");var i={x:e.x,y:e.y,width:e.getDisplayWidth(),height:e.getDisplayHeight()};if(e.isColumn?i.x+=e.hierarchy.x-this._offsetX:i.y+=e.hierarchy.y-this._offsetY,e.IsRowsHierarchyItem&&this._pivotRows.compactStyleRenderingEnabled&&(i.height=e.height),i.right=i.x+i.width,i.bottom=i.y+i.height,Math.abs(i.right-t.x)<=4&&t.y>=i.y&&t.y<=i.bottom){if(this.isHorizontalResize=!0,e.hierarchy.resizable&&!this._pivotColumns.isGroupingColumn(e)){if(this._updateCursor("COLUMN_RESIZE"),this.resizingItem=e.isColumn?e._getLastVisibleLeaf(e):e,!this.resizingItem.isColumn&&!this.resizingItem.isExpanded){var s,n=this._pivotRows._getVisibleLeafLevelItems();for(s in n){var o=n[s];o.ItemLevel>this.resizingItem.ItemLevel&&(this.resizingItem=o)}}this._colResizeState="READY_RESIZE"}}else{if(!e.isColumn&&Math.abs(i.bottom-t.y)<=3)return this.isHorizontalResize=!1,e.IsRowsHierarchyItem&&this._pivotRows.compactStyleRenderingEnabled||(e=e._getLastVisibleLeaf(e)),void(e.hierarchy.resizable&&(this._updateCursor("ROW_RESIZE"),this.resizingItem=e,this._colResizeState="READY_RESIZE"));var r=e.hierarchy.getOtherHierarchy();e.hierarchy.sortable&&0<r.items.length&&this._hitTestShowItemMenuElement(t,e,i)}}},isInHierarchyViewPort:function(t,e){return e.isColumnsHierarchy?this.isPtInRect({x:t.x+this._offsetX,y:t.y},e.viewPort):this.isPtInRect({x:t.x,y:t.y+this._offsetY},e.viewPort)},_hitTestShowItemMenuElement:function(t,e,i){var s;this._menuElement&&this._menuElement._itemMouseOver&&this._menuElement._itemMouseOver._element&&a(this._menuElement._itemMouseOver._element).find("#sortElement").show(),this._menuElement.style.display="none",!(this._isContextMenuOpen||0<e.valueItems.length)&&t.x<i.right&&t.x>i.x&&t.y>=i.y&&t.y<=i.bottom&&((s=a.extend({},this._rect)).x=s.y=0,"block"==this.vScroll[0].display&&(s.width-=this.vScroll.width()),"block"==this.hScroll[0].display&&(s.height-=this.hScroll.height()),(t={x:this._currentPosition.x,y:this._currentPosition.y}).x-=e.hierarchy.x-(e.hierarchy.viewPort.x-e.hierarchy.x),t.y-=e.hierarchy.y-(e.hierarchy.viewPort.y-e.hierarchy.y),i={x:e.x+i.width-18,y:e.y+(i.height-16)/2+1,width:16,height:16},this._menuElement.style.height=i.height+"px",this._menuElement.className=this.toThemeProperty("jqx-pivotgrid-menu-button"),e.isColumn?i.x+=e.hierarchy.x-this._offsetX:i.y+=e.hierarchy.y-this._offsetY,this.setElementPosition(this._menuElement,i.x,i.y),this.isPtInRect({x:i.x,y:i.y},s)&&this.isPtInRect({x:i.x,y:i.y+i.height},s)&&this.isPtInRect({x:i.x+i.width,y:i.y},s)&&this.isPtInRect({x:i.x+i.width,y:i.y+i.height},s)&&(this._menuElement.style.display="block",this._menuElement._itemMouseOver=e,a(this._menuElement._itemMouseOver._element).find("#sortElement").hide(),e._currentCustomContent||(s=a(e._element).css("background-color"),this._menuElement.style["background-color"]=s),e.isColumn?i.x+=this._offsetX-e.hierarchy.x:i.y+=this._offsetY-e.hierarchy.y,this.isPtInRect({x:t.x,y:t.y},i)&&(this._itemMenuButtonMouseOver=!0)))},_hideItemMenuElement:function(){this._menuElement&&!this._isContextMenuOpen&&"block"==this._menuElement.style.display&&(this._menuElement.style.display="none",a(this._menuElement._itemMouseOver._element).find("#sortElement").show())},_hideItemContextMenu:function(){this._contextMenu.jqxMenu("close"),this._hideItemMenuElement()},_showItemContextMenu:function(){var t,e,i,s=this._menuElement._itemMouseOver;s&&(i=this._contextMenu.width(),t=this._contextMenu.height(),this._contextMenu.find("#sortasc")[0].className="jqx-pivotgrid-sortasc-icon "+this.toThemeProperty("jqx-pivotgrid-sortasc-icon"),this._contextMenu.find("#sortdesc")[0].className="jqx-pivotgrid-sortdesc-icon "+this.toThemeProperty("jqx-pivotgrid-sortdesc-icon"),this._contextMenu.find("#sortremove")[0].className="jqx-pivotgrid-sortremove-icon "+this.toThemeProperty("jqx-pivotgrid-sortremove-icon"),e=-i+s.displayWidth+s.x+(s.hierarchy.viewPort.x-this._offsetX)-this._offsetX,s.isColumn||(e=s.x+s.displayWidth),i=s.y+s.getDisplayHeight(),s.isColumn||(i=s.y-this._offsetY+s.hierarchy.y),e<=1&&(e=1),i<this._pivotColumns.y+this._pivotColumns.getHeight()&&(i=this._pivotColumns.y+this._pivotColumns.getHeight()),i+t>this._rect.height&&(i=this._rect.height-t),this._contextMenu.jqxMenu("open",e+this._rect.x,i+this._rect.y),this._contextMenu.focus())},_handleMouseMove:function(t){if("RESIZING"==this._colResizeState)return this._doResize({x:this._currentPosition.x,y:this._currentPosition.y}),void this._refreshMouseCursor();this._colResizeState="NO_RESIZE",this.resizingItem=null;var e=this._currentPosition,i=null;this.isInHierarchyViewPort({x:e.x,y:e.y},this._pivotColumns)&&(i=this._pivotColumns.hitTest(e));var s=null;if(this.isInHierarchyViewPort({x:e.x,y:e.y},this._pivotRows)&&(s=this._pivotRows.hitTest(e)),this._itemMenuButtonMouseOver=!1,null!=i||null!=s){var n=null==i?s:i;this.gridCellMouseOver=null,this._itemMouseMove(e,n),this._focusedItem!=n&&(this._focusedItem=n,this._isMouseLeftButtonDown&&this._updateSelection());var o={};return this.CellsHighlightOnHierarchyItemMoveEnabled&&(n.IsRowsHierarchyItem&&"CELLS_HIGHLIGHT_ROW"==this.CellsHighlightMode||n.isColumn&&"CELLS_HIGHLIGHT_COLUMN"==this.CellsHighlightMode)&&(o=n.isColumn?{x:n.x,y:0,width:n.DisplayWidth,height:this._pivotRows.getHeight()}:{x:0,y:n.y,width:this._pivotColumns.getWidth(),height:n.getDisplayHeight()},(n.isColumn&&this.isGroupingEnabled&&0<this.groupingColumns.length||n.IsRowsHierarchyItem&&this._pivotRows.isOnRowDetails(this._currentPosition,n))&&(o={x:0,y:0,width:0,height:0})),void this._refreshMouseCursor()}this._hideItemMenuElement();this.gridCellMouseOver;this.resizingItem=null,this._focusedItem=null,this._colResizeState="NO_RESIZE",this._updateCursor("ARROW");n=null;this.gridCellMouseOver&&((n={}).pivotColumn=this.gridCellMouseOver.pivotColumn,n.pivotRow=this.gridCellMouseOver.pivotRow);e=this._pivotCells._hitTest(e);this._isMouseLeftButtonDown&&e?(null!=this.gridCellMouseOver&&this.gridCellMouseOver.pivotRow==s&&this.gridCellMouseOver.pivotColumn==i||(this.gridCellMouseOver={pivotRow:e.pivotRow,pivotColumn:e.pivotColumn,pivotCells:this._pivotCells}),o={x:0,y:0,width:0,height:0},"CELLS_HIGHLIGHT_COLUMN"==this.cellsHighlightMode?o={x:this.gridCellMouseOver.pivotColumn.x,y:0,width:this.gridCellMouseOver.pivotColumn.getDisplayWidth(),height:this._pivotRows.getHeight()}:"CELLS_HIGHLIGHT_ROW"==this.cellsHighlightMode?o={x:0,y:this.gridCellMouseOver.pivotRow.y,width:this._pivotColumns.getWidth(),height:this.gridCellMouseOver.pivotRow.getDisplayHeight()}:"CELLS_HIGHLIGHT_SINGLE_CELL"==this.cellsHighlightMode&&(o={x:this.gridCellMouseOver.pivotColumn.x,y:this.gridCellMouseOver.pivotRow.y,width:this._pivotColumns.getWidth(),height:this.gridCellMouseOver.pivotRow.getDisplayHeight()},this.isGroupingEnabled&&0<this.groupingColumns.length&&0<this.gridCellMouseOver.pivotRow.items.length&&(o={x:0,y:0,width:0,height:0}),this.gridCellMouseOver.pivotRow.RowDetailsVisible&&(o.height-=this.gridCellMouseOver.pivotRow.GetRowDetailsHeight())),(this._pivotColumns.isGroupingColumn(this.gridCellMouseOver.pivotColumn)||this._pivotRows.isOnRowDetails(this._currentPosition,this.gridCellMouseOver.pivotRow))&&(o={x:0,y:0,width:0,height:0})):this.gridCellMouseOver=null,null==this.gridCellMouseOver||this.gridCellMouseOver==n&&n.pivotRow==this.gridCellMouseOver.pivotRow&&n.pivotColumn==this.gridCellMouseOver.pivotColumn||this._isMouseLeftButtonDown&&!this._itemMenuButtonMouseOver&&(this._updateSelection(),this._internalRefresh())},_handleMouseClick:function(t){var e,i={isOnItemButton:!1},s=this._itemHitTest(this._currentPosition,i);null!=s?this._raisePivotItemMouseEvent(s,"pivotitemclick",0==t.button?"left":"right")?t.cancel=!0:this._itemMenuButtonMouseOver||this._isContextMenuOpen||this._isMouseLeftButtonDown&&!i.isOnItemButton&&"Automatic"==s.sortMode&&0==s.valueItems.length&&(e=this.cursor,this.cursor="Wait",this.cursor=e):(e=this._pivotCells._hitTest(this._currentPosition))&&this._raisePivotCellMouseEvent(e.pivotRow,e.pivotColumn,"pivotcellclick",0==t.button?"left":"right")&&(t.cancel=!0)},_handleMouseDoubleClick:function(t){if(null!=this.activeEditor.Editor)if(0==this.hideEditor("MOUSE_DBLCLICK",null,!0))return;if(!this._itemMenuButtonMouseOver&&!this._isContextMenuOpen){var e={isOnItemButton:!1},i=this._itemHitTest(this._currentPosition,e);if(null!=i){if(e.isOnMenuButton)return;if(this._raisePivotItemMouseEvent(i,"pivotitemdblclick",0==t.button?"left":"right"))return;if(this._lastToggle&&this._lastToggle.item==i&&new Date-this._lastToggle.time<500)return;0==t.button&&(i.isExpanded?i.collapse():i.expand(),i.hierarchy.selectItem(i),this._internalRefresh()),this._lastToggle={time:new Date,item:i}}else{i=this._pivotCells._hitTest(this._currentPosition);if(i)if(this._raisePivotCellMouseEvent(i.pivotRow,i.pivotColumn,"pivotcelldblclick",0==t.button?"left":"right"))return}this._refreshMouseCursor()}},_isMouseCaptured:function(){return!0===this._captured},_releaseMouseCapture:function(){this._captured=!1},_captureMouse:function(){this._captured=!0},_updateCursor:function(t){"ARROW"==t?this.element.style.cursor="default":"CROSS"==t?this.element.style.cursor="pointer":"COLUMN_RESIZE"==t?this.element.style.cursor="col-resize":"ROW_RESIZE"==t&&(this.element.style.cursor="row-resize")},_refreshMouseCursor:function(){},_ensureEditorFocus:function(){},focus:function(){},_itemHitTest:function(t,e){e.isOnItemButton=!1;var i,s=null;return!this._pivotRows.isHidden&&this.isInHierarchyViewPort(t,this._pivotRows)&&(s=this._pivotRows.hitTest(t)),null==s&&!this._pivotColumns.isHidden&&this.isInHierarchyViewPort(t,this._pivotColumns)&&(s=this._pivotColumns.hitTest(t)),null!=s&&((t={x:this._currentPosition.x,y:this._currentPosition.y}).x-=s.hierarchy.x-(s.hierarchy.viewPort.x-s.hierarchy.x),t.y-=s.hierarchy.y-(s.hierarchy.viewPort.y-s.hierarchy.y),0!=s.items.length&&0!=s.expandCollapseEnabled&&s.hierarchy.showExpandCollapseButtons&&(i=0,!s.hierarchy.isColumnsHierarchy&&s.hierarchy.compactStyleRenderingEnabled&&(i=24*s.itemLevel),t.x>s.x+9+i&&t.x<s.x+20+i&&t.y>s.y+9&&t.y<s.y+20&&(e.isOnItemButton=!0)),i={x:s.x,y:s.y,width:s.getDisplayWidth(),height:s.getDisplayHeight()},i={x:s.x+i.width-16,y:s.y,width:16,height:i.height},this.isPtInRect(t,i)&&s.hierarchy.sortable&&(e.isOnMenuButton=!0)),s},_raisePivotCellMouseEvent:function(t,e,i,s){i=new a.Event(i);return i.owner=this,i.args={pivotRow:t,pivotColumn:e,mousebutton:s,cancel:!1},this.host.trigger(i),!!i.args.cancel},_raisePivotItemMouseEvent:function(t,e,i){e=new a.Event(e);return e.owner=this,e.args={pivotItem:t,mousebutton:i,cancel:!1},this.host.trigger(e),!!e.args.cancel},_beginDrag:function(t){},_endDrag:function(t){},_canDrop:function(t){},_doResize:function(t){if(null!=this.resizingItem&&this.resizingItem.hierarchy.resizable&&!this._pivotColumns.isGroupingColumn(this.resizingItem)){this.isHorizontalResize?this._updateCursor("COLUMN_RESIZE"):this._updateCursor("ROW_RESIZE"),this._focusedItem=this.resizingItem;var e=this.resizingItem.x+2*this.resizingItem.hierarchy.x-this.resizingItem.hierarchy.viewPort.x,i=this.resizingItem.y+2*this.resizingItem.hierarchy.y-this.resizingItem.hierarchy.viewPort.y,s=!1,n=(this.resizingItem.hierarchy,a("body").find("#"+this._resizeLineId));if(this.isHorizontalResize){e=t.x-e;if(e<this.resizingItem.minimumWidth)return;var o={x:t.x+this._rect.x,y:this._pivotRows.y+this._rect.y};n.css({"border-right":"1px dotted #555","border-bottom":"",width:"1px",height:this._pivotCells.viewPort.height,top:o.y,left:o.x,display:"block"}),e>=this.resizingItem.minimumWidth&&e<=this.resizingItem.maximumWidth&&(this.resizeTooltipEnabled&&(this._resizeTooltip.Content="width: "+e+" pixels"),s=!0)}else{i=t.y-i;if(i<this.resizingItem.minimumHeight)return;o={x:this._pivotColumns.x+this._rect.x,y:t.y+this._rect.y};n.css({"border-bottom":"1px dotted #555","border-right":"",height:"1px",width:this._pivotCells.viewPort.width,left:o.x,top:o.y,display:"block",zIndex:5e4}),i>=this.resizingItem.minimumHeight&&i<=this.resizingItem.maximumHeight&&(this.resizeTooltipEnabled&&(this._resizeTooltip.Content="height: "+i+" pixels"),s=!0)}s&&this.resizeTooltipEnabled&&("visible"!=this._resizeTooltip.visibility&&(this._resizeTooltip.visibility="visible"),this._resizeTooltip.setValue(this.Canvas.LeftProperty,t.x),this._resizeTooltip.setValue(this.Canvas.TopProperty,t.y),this._resizeTooltip.setValue(this.Canvas.ZIndexProperty,10002))}},_internalClearSelection:function(){this._pivotColumns._internalClearSelection(),this._pivotRows._internalClearSelection(),this._pivotCells._internalClearSelection()},_beginSelectionUpdate:function(){this._isCTRLPressed&&this.multipleSelectionEnabled||(this._pivotCells._beginSelectionUpdate(),this._pivotColumns._beginSelectionUpdate(),this._pivotRows._beginSelectionUpdate())},_endSelectionUpdate:function(){this._pivotColumns._endSelectionUpdate(),this._pivotRows._endSelectionUpdate(),this._pivotCells._endSelectionUpdate()},_updateSelection:function(){if(this.selectionEnabled){this._colItemRangeSelectionBeg=null,this._rowItemRangeSelectionBeg=null,this._beginSelectionUpdate();var t=!1;if(this._isCTRLPressed&&0!=this.multipleSelectionEnabled||(this._internalClearSelection(),t=!0),null!=this.activeEditor.Editor)return this._internalClearSelection(),void this._endSelectionUpdate();var e=-1,i=-1,s={x:this._selectStartPosition.x,y:this._selectStartPosition.y};s.y-=this._offsetY,s.x-=this._offsetX;var n=this._itemHitTest(this._selectStartPosition,{isOnItemButton:!1});if(null!=n)if(!n.isColumn&&this._pivotRows.compactStyleRenderingEnabled||(n=n._getFirstVisibleLeaf(n)),n.isColumn){if("FULL_ROW_SELECT"==this.selectionMode)return this._internalSelectMode="NO_SELECT",void this._endSelectionUpdate();this._internalSelectMode="COL_SELECT",this._colItemRangeSelectionBeg=n}else{if("FULL_COLUMN_SELECT"==this.selectionMode)return this._internalSelectMode="NO_SELECT",this._endSelectionUpdate(),void this._internalRefresh();this._internalSelectMode="ROW_SELECT",this._rowItemRangeSelectionBeg=n}else{if(!(h=this._pivotCells._hitTest(this._selectStartPosition)))return this._internalSelectMode="NO_SELECT",this._endSelectionUpdate(),void this._internalRefresh();this._internalSelectMode="CELLS_SELECT","FULL_ROW_SELECT"==this.selectionMode?this._internalSelectMode="ROW_SELECT":"FULL_COLUMN_SELECT"==this._SelectionMode&&(this._internalSelectMode="COL_SELECT")}var o={x:this._currentPosition.x,y:this._currentPosition.y};"COL_SELECT"==this._internalSelectMode?(o.y>=this._pivotColumns.y+this._pivotColumns.getHeight()&&(o.y=this._pivotColumns.y+this._pivotColumns.getHeight()-1),o.y<=this._pivotColumns.y&&(o.y=this._selectStartPosition.y),o.x<=this._pivotColumns.x&&(o.x=this._pivotColumns.x+1),o.x>=this._pivotColumns.x+this._pivotColumns.getWidth()&&(o.x=this._pivotColumns.x+this._pivotColumns.getWidth()-1)):"ROW_SELECT"==this._internalSelectMode?(o.y>=this._pivotRows.y+this._pivotRows.getHeight()&&(o.y=this._pivotRows.y+this._pivotRows.getHeight()-1),o.y<=this._pivotRows.y&&(o.y=this._pivotRows.y+1),o.x<=this._pivotRows.x&&(o.x=this._pivotRows.x+this._pivotRows.getWidth()-1),o.x>=this._pivotRows.x+this._pivotRows.getWidth()&&(o.x=this._pivotRows.x+this._pivotRows.getWidth()-1)):"CELLS_SELECT"==this._internalSelectMode&&(o.x<this._pivotColumns.x&&(o.x=this._pivotColumns.x+1),o.y<this._pivotRows.y&&(o.y=this._pivotRows.y+1)),this._colItemRangeSelectionEnd=null,this._rowItemRangeSelectionEnd=null;var r=-1,l=-1;if("COL_SELECT"==this._internalSelectMode||"ROW_SELECT"==this._internalSelectMode)if(null!=n){var h={},n=this._itemHitTest(o,h);if(null==n)return void this._endSelectionUpdate();!n.isColumn&&this._pivotRows.compactStyleRenderingEnabled||(n=n._getLastVisibleLeaf(n)),n.isColumn?this._colItemRangeSelectionEnd=n:this._rowItemRangeSelectionEnd=n}else this._pivotCells.hitTest(o,h),null!=h?(this._colItemRangeSelectionEnd=h.pivotColumn,this._rowItemRangeSelectionEnd=h.pivotRow):(this._colItemRangeSelectionEnd=null,this._rowItemRangeSelectionEnd=null);if("CELLS_SELECT"==this._internalSelectMode){h=this._pivotCells._hitTest(this._selectStartPosition);if(this._colItemRangeSelectionBeg=h.pivotColumn,this._rowItemRangeSelectionBeg=h.pivotRow,!h)return this._endSelectionUpdate(),void this._internalRefresh();if(s.x==o.x&&s.y==o.y||(this._pivotCells.hitTest(o,h),this._colItemRangeSelectionEnd=h.pivotColumn,this._rowItemRangeSelectionEnd=h.pivotRow),!h.pivotRow||!h.pivotColumn)return this._internalSelectMode="CELLS_SELECT",this._pivotCells._internalSelectCell(this._rowItemRangeSelectionBeg,this._colItemRangeSelectionBeg),this._cellKBRangeSelectionStart=this._cellKBRangeSelectionEnd={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells},this._endSelectionUpdate(),void this._internalRefresh()}if(this._saveSelectedItemsRangeOrder(),this._adjustSelectedItemsOrder(t),"CELLS_SELECT"==this._internalSelectMode){var a,d=this._pivotRows._getVisibleLeafLevelItems(),u=this._pivotColumns._getVisibleLeafLevelItems(),i=this._pivotRows._pointToLeafItemIndexAbsolute(this._selectStartPosition),l=this._pivotRows._pointToLeafItemIndexAbsolute(o),e=this._pivotColumns._pointToLeafItemIndexAbsolute(this._selectStartPosition),r=this._pivotColumns._pointToLeafItemIndexAbsolute(o);if(-1==e&&-1==r||-1==i&&-1==l)return this._endSelectionUpdate(),void this._internalRefresh();-1==e&&(e=r),-1==r&&(r=e),-1==i&&(i=l),-1==l&&(l=i),r<e&&(a=e,e=r,r=a),l<i&&(a=i,i=l,l=a);for(var c=i;c<=l&&c<d.length;c++)for(var m=d[c],v=e;v<=r&&v<u.length;v++){var p=u[v];this._pivotCells._internalSelectCell(m,p)}return this._cellKBRangeSelectionStart={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells},this._cellKBRangeSelectionEnd={pivotRow:this._rowItemRangeSelectionEnd,pivotColumn:this._colItemRangeSelectionEnd,pivotCells:this._pivotCells},this._endSelectionUpdate(),void this._internalRefresh()}this._restoreSelectedItemsRangeOrder(),this._applyItemsMultiSelect(t),this._endSelectionUpdate(),this._internalRefresh()}},_saveSelectedItemsRangeOrder:function(){this._adjSelectedItemsSave.colBeg=this._colItemRangeSelectionBeg,this._adjSelectedItemsSave.colEnd=this._colItemRangeSelectionEnd,this._adjSelectedItemsSave.rowBeg=this._rowItemRangeSelectionBeg,this._adjSelectedItemsSave.rowEnd=this._rowItemRangeSelectionEnd},_restoreSelectedItemsRangeOrder:function(){this._colItemRangeSelectionBeg=this._adjSelectedItemsSave.colBeg,this._colItemRangeSelectionEnd=this._adjSelectedItemsSave.colEnd,this._rowItemRangeSelectionBeg=this._adjSelectedItemsSave.rowBeg,this._rowItemRangeSelectionEnd=this._adjSelectedItemsSave.rowEnd},_adjustSelectedItemsOrder:function(t){var e;null!=this._colItemRangeSelectionBeg&&null!=this._colItemRangeSelectionEnd&&this._colItemRangeSelectionBeg.x>this._colItemRangeSelectionEnd.x&&(e=this._colItemRangeSelectionBeg,this._colItemRangeSelectionBeg=this._colItemRangeSelectionEnd,this._colItemRangeSelectionEnd=e),null!=this._rowItemRangeSelectionBeg&&null!=this._rowItemRangeSelectionEnd&&this._rowItemRangeSelectionBeg.y>this._rowItemRangeSelectionEnd.y&&(e=this._rowItemRangeSelectionBeg,this._rowItemRangeSelectionBeg=this._rowItemRangeSelectionEnd,this._rowItemRangeSelectionEnd=e),(0!=this.multipleSelectionEnabled||t)&&null!=this._rowItemRangeSelectionEnd||(this._rowItemRangeSelectionEnd=this._rowItemRangeSelectionBeg),(0!=this.multipleSelectionEnabled||t)&&null!=this._colItemRangeSelectionEnd||(this._colItemRangeSelectionEnd=this._colItemRangeSelectionBeg)},_applyItemsMultiSelect:function(t){this._saveSelectedItemsRangeOrder(),this._adjustSelectedItemsOrder(t);for(var e=0;e<2;e++)if(!("COL_SELECT"==this._internalSelectMode&&0!=e||"ROW_SELECT"==this._internalSelectMode&&1!=e)){var i=0==e?this._colItemRangeSelectionBeg:this._rowItemRangeSelectionBeg,s=0==e?this._colItemRangeSelectionEnd:this._rowItemRangeSelectionEnd,n=0==e?this._pivotColumns:this._pivotRows,o=n._getVisibleLeafLevelItems();if(null==o)return this._internalRefresh(),void this._restoreSelectedItemsRangeOrder();var r,l=!1;for(r in o){var h=o[r];if((h==i||l)&&(h.getWidthWithChildren()+h.x>this._mostRightItemBounds.x+this._mostRightItemBounds.width&&(this._mostRightItemBounds={x:h.x,y:h.y,width:h.getWidthWithChildren(),height:h.getHeightWithChildren()}),h.getWidthWithChildren()+h.x<this._mostLeftItemBounds.x+this._mostLeftItemBounds.width&&(this._mostLeftItemBounds={x:h.x,y:h.y,width:h.getWidthWithChildren(),height:h.getHeightWithChildren()}),l=!0,n._internalSelectItem(h),h==s))break}!n.isColumnsHierarchy&&n.compactStyleRenderingEnabled||n._applySelectionToParentItems()}this._restoreSelectedItemsRangeOrder()},localizeStrings:function(t,e){var i=this;a.jqx.dataFormat&&a.jqx.dataFormat.cleardatescache(),i._localizedStrings={decimalseparator:".",thousandsseparator:",",sortascendingstring:"Sort Ascending",sortdescendingstring:"Sort Descending",sortremovestring:"Remove Sort",alignment:"Text alignment",cellalignment:"Number alignment",numberformat:"Number format",prefix:"Number prefix",decimalplacestext:"Decimal places",thousandsseparatortext:"Thousands separator",decimalseparatortext:"Decimal separator",nagativebracketstext:"Negatives in brackets",fieldsettings:"Field settings",ok:"Ok",cancel:"Cancel"};var s,n,o=a.extend({},t);for(s in i._localizedStrings=a.extend(i._localizedStrings,o),o)s&&s.toLowerCase()!==s&&(o[s.toLowerCase()]=o[s]);for(n in i._localizedStrings)void 0!==o[n]&&(i._localizedStrings[n]=o[n])}})}(jqxBaseFramework),$.jqx.jqxPivotGrid=$.jqx.jqxPivotGrid||{},$.jqx.define($.jqx.jqxPivotGrid,"propertyBag",""),$.extend($.jqx.jqxPivotGrid.propertyBag.prototype,{defineInstance:function(){this.namedPropertyTables={},this._tableSizes={},this.enablePropertyChangeNotifications=!1},getPropertyTable:function(t){return null==this.namedPropertyTables[t]&&(this.namedPropertyTables[t]={},this._tableSizes[t]=0),this.namedPropertyTables[t]},getPropertyCount:function(t){return null==this.getPropertyTable(t)?0:this._tableSizes[t]},getPropertyValue:function(t,e){t=this.getPropertyTable(t);return null!=t&&null!=t[e]?t[e]:null},containsPropertyValue:function(t,e){t=this.getPropertyTable(t);return null!=t&&null!=t[e]},removePropertyValue:function(t,e){var i=this.getPropertyTable(t);null!=i&&(delete i[e],this._tableSizes[t]--)},setPropertyValue:function(t,e,i){var s=this.getPropertyTable(t);null!=s&&(null==i||null==i?s[e]&&(this._tableSizes[t]--,delete s[e]):(s[e]||this._tableSizes[t]++,s[e]=i),this.enablePropertyChangeNotifications&&this.onPropertyChanged(t))},clear:function(t){""!=t&&null!=t&&null!=t?(this.getPropertyTable(t),this._tableSizes[t]=0):this.namedPropertyTables={}},onPropertyChanged:function(t){$.event.trigger("propertychanged",t)}}),function(R){R.jqx.jqxPivotGrid=R.jqx.jqxPivotGrid||{},R.jqx.define(R.jqx.jqxPivotGrid,"pivotCells",""),R.extend(R.jqx.jqxPivotGrid.pivotCells.prototype,{defineInstance:function(){this.parentPivotGrid=null,this.IsDataBoundPivotCellsEditable=!1,this.cellProperties=new R.jqx.jqxPivotGrid.propertyBag,this.hashCellAutoSize={},this.hashCellInSpan={},this.hashCellSpan={},this._selectedCells=new Object},hitTest:function(t){t=this._hitTest(t);if(t)return{pivotRow:t.pivotRow,pivotColumn:t.pivotColumn,pivotCells:this}},_hitTest:function(t){var e={};if(e.pivotColumn=this.parentPivotGrid._pivotColumns._pointToLeafItemAbsolute(t),e.pivotRow=this.parentPivotGrid._pivotRows._pointToLeafItemAbsolute(t),!this.parentPivotGrid._pivotColumns.isGroupingColumn(e.pivotColumn)&&null!=e.pivotColumn&&null!=e.pivotRow)return e},clear:function(){this._reset()},_reset:function(){this.cellProperties.clear(),this._selectedCells=new Object,this.hashCellAutoSize={},this.hashCellInSpan={},this.hashCellSpan={},this._clearElementsAndCellsCache()},_resetCanvas:function(){var t=R.jqx.get(this,"renderCanvas");if(t)for(;t.hasChildNodes();)t.removeChild(t.firstChild)},_clearElementsAndCellsCache:function(){this._clearCellsCache()},setCellValue:function(t,e,i){if(null!=t&&null!=e){var s=this.parentPivotGrid.getCellId(e,t),n=(this.getCellDataSource(t,e),-1!=t.BoundFieldIndex&&-1!=e.BoundFieldIndex),o=this.getCellDataSource(t,e);if("DataBound"==o&&n){if(this.parentPivotGrid.OnCellValueChanging(t,e,i))return;try{this.parentPivotGrid.setCellValueFromDataSourceNonPivot(t,e,i)}catch(t){return}return this.cellProperties.setPropertyValue("CellValue",s,null),void this.parentPivotGrid.OnCellValueChanged(t,e)}if("DataBoundPivot"==o){if(this.IsDataBoundPivotCellsEditable)return;throw"The cell's value is derived from the data source and aggregated. It is not editable in this mode. Use the SetCellDataSource method to change the cell's data source first"}this.parentPivotGrid.OnCellValueChanging(t,e,i)||(this.SetCellDataSource(t,e,"Static"),this.cellProperties.setPropertyValue("CellValue",s,i),this.onPropertyChanged("CellValue"),this.parentPivotGrid.OnCellValueChanged(t,e))}},_clearCellsCache:function(){this.cellProperties.clear("CellValue")},_clearCachedCell:function(t,e){t=this.parentPivotGrid.getCellId(e,t);this.cellProperties.containsPropertyValue("CellValue",t)&&this.cellProperties.removePropertyValue("CellValue",t)},drillThroughCell:function(t,e){if(!t||t.isColumn)throw"Invalid pivotRow parameter";if(!e||!e.isColumn)throw"Invalid pivotColumn parameter";return this.parentPivotGrid.source.drillThroughPivotCell(t.adapterItem,e.adapterItem)},getCellValue:function(t,e){var i=null;if(this.parentPivotGrid._pivotColumns.isGroupingColumn(e))return null;var s=this.parentPivotGrid.getCellId(e,t),n=this.getCellDataSource(t,e);switch((t.isTotal||e.isTotal)&&(n="Virtual"),n){case"Virtual":i=this.parentPivotGrid.onCellValueNeeded(t,e),this.cellProperties.setDirty(s),null==i&&"BoundPivot"==this.parentPivotGrid.bindingState&&(t.isTotal||e.isTotal)&&(i=this.parentPivotGrid.getCellValueFromDataSource(t,e));break;case"DataBoundPivot":null==(i=this.cellProperties.getPropertyValue("CellValue",s))&&(i=this.parentPivotGrid.source.getCellValue(t.adapterItem,e.adapterItem),this.cellProperties.getPropertyCount("CellValue")<4e6&&this.cellProperties.setPropertyValue("CellValue",s,i));break;case"DataBound":if(null==(i=this.cellProperties.getPropertyValue("CellValue",s))){try{i=this.parentPivotGrid.getCellValueFromDataSourceNonPivot(t,e)}catch(t){return null}this.cellProperties.getPropertyCount("CellValue")<4e6&&this.cellProperties.setPropertyValue("CellValue",s,i)}break;case"NotSet":case"Static":default:i=this.cellProperties.getPropertyValue("CellValue",s)}return i},setCellDataSource:function(t,e,i){null!=t&&null!=e&&(t=this.parentPivotGrid.getCellId(e,t),this.cellProperties.setPropertyValue("cellDataSource",t,i))},getCellDataSource:function(t,e){var i=this.parentPivotGrid.getCellId(e,t),i=this.cellProperties.getPropertyValue("cellDataSource",i);return null==i&&(i=e.cellDataSource),null!=i&&"NotSet"!=i||(i=t.cellDataSource),null!=i&&"NotSet"!=i?i:this.parentPivotGrid.UseVirtualCellsByDefault?"Virtual":"DataBound"==this.parentPivotGrid.bindingState||"DataBoundPivot"==this.parentPivotGrid.bindingState?this.parentPivotGrid.bindingState:"NotSet"},render:function(){var t=this.renderCanvas;if(t){var e=this.parentPivotGrid;e.setElementPosition(t,-this.parentPivotGrid._offsetX,-this.parentPivotGrid._offsetY);var i=e._pivotRows,s=e._pivotColumns;if(this._refreshRequired||i._isVirtualMode||s._isVirtualMode){var n=i._getLeafItemsToRender(),o=s._getLeafItemsToRender();this._cellElements=this._cellElements||{};for(var r=new Array,l=new Date,h={first:i._isVirtualMode?n.first:0,last:i._isVirtualMode?n.last:n.items.length-1},a={first:s._isVirtualMode?o.first:0,last:s._isVirtualMode?o.last:o.items.length-1},d=h.last;h.first<=d;d--)for(var u,c,m,v,p,_,g,C,f,y,x=a.last;a.first<=x;x--)-1!=d&&-1!=x&&(u=n.items[d],c=o.items[x],m=e.getCellId(c,u),v=c.getDisplayWidth()-1,p=u.getDisplayHeight()-1,_=this.isCellSelected(u,c),I=void 0,(C=this._cellElements[m])&&C.isSelected==_&&(I=C.element),g={left:4,top:4,right:4,bottom:4},f=this.getCellValue(u,c),C="",I?I.style.width==v+"px"&&I.style.height==p+"px"||this.parentPivotGrid.setElementSize(I,v,p):((I=e.createDiv(t,C,v,p)).cellId=m,this._cellElements[m]={element:I,isSelected:_},e.setElementSize(I,v,p),y="right",e.cellsRenderer&&R.isFunction(e.cellsRenderer)?(C=e.cellsRenderer({value:f.value,formattedValue:f.formattedValue,isSelected:_,pivotRow:u,pivotColumn:c}),g={left:0,top:0,right:0,bottom:0}):(C=void 0!==f&&void 0!==f.formattedValue?f.formattedValue.toString():"",(f=this.parentPivotGrid.source.getCellFormatSettings(u.adapterItem,c.adapterItem))&&(y=f.align||"right")),this.parentPivotGrid.setDivContent(I,C,g,y),I.originalY=I.style.top,I.className=this.parentPivotGrid.toThemeProperty("jqx-grid-cell-normal")),I.tRender=l,"block"!=I.style.display&&(I.style.display="block"),I.style.left==c.x+"px"&&I.style.top==u.y+"px"||this.parentPivotGrid.setElementPosition(I,c.x,u.y),y="cellsClassName",this.isCellSelected(u,c)?(I.className=this.parentPivotGrid.toThemeProperty("jqx-grid-cell-selected jqx-fill-state-hover jqx-widget-content"),y="cellsClassNameSelected"):I.className=this.parentPivotGrid.toThemeProperty("jqx-grid-cell-normal jqx-widget-content"),(y=R.jqx.getByPriority([u[y],u.adapterItem&&u.adapterItem.boundField?u.adapterItem.boundField[y]:void 0,c[y],c.adapterItem&&c.adapterItem.boundField?c.adapterItem.boundField[y]:void 0]))&&(I.className+=" "+y),I.className+=" jqx-pivotgrid-content-wrapper");for(var I,S=0;S<t.childNodes.length;S++)t.childNodes[S].cellId&&t.childNodes[S].tRender!=l&&r.push(t.childNodes[S]);for(;;){if(!(I=r.pop()))break;delete this._cellElements[I.cellId],I.style.display="none",t.removeChild(I)}this._refreshRequired=!1}}},_beginSelectionUpdate:function(){for(var t in this._selectedCells)this._selectedCells[t].OldIsSelected=this._selectedCells[t].isSelected},_endSelectionUpdate:function(){var t=new Array;for(i in this._selectedCells){var e=this._selectedCells[i];e.isSelected||t.push(i),e.isSelected,e.OldIsSelected}if(0<t.length)for(var i in t)delete this._selectedCells[t[i]]},_internalClearSelection:function(){for(var t in this._selectedCells)this._internalUnselectCell(this._selectedCells[t].pivotRow,this._selectedCells[t].pivotColumn)},clearSelection:function(){this._beginSelectionUpdate(),this._internalClearSelection(),this._endSelectionUpdate(),this.render()},selectCell:function(t,e){this.parentPivotGrid.selectionEnabled&&(this._beginSelectionUpdate(),this._internalSelectCell(t,e),this.parentPivotGrid._cellKBRangeSelectionStart={pivotRow:t,pivotColumn:e,pivotCells:this},this.parentPivotGrid._cellKBRangeSelectionEnd={pivotRow:t,pivotColumn:e,pivotCells:this},this._endSelectionUpdate())},_internalSelectCell:function(t,e){if(null==e||!this.parentPivotGrid._pivotColumns.isGroupingColumn(e)){if("NO_SELECT"==this.parentPivotGrid._internalSelectMode)switch(this.parentPivotGrid.selectionMode){case"CELL_SELECT":this.parentPivotGrid._internalSelectMode="CELLS_SELECT";break;case"FULL_COLUMN_SELECT":this.parentPivotGrid._internalSelectMode="COL_SELECT";break;case"FULL_ROW_SELECT":this.parentPivotGrid._internalSelectMode="ROW_SELECT"}var i=this.parentPivotGrid.getCellId(e,t);delete this._cellElements[i],null==this._selectedCells[i]?this._selectedCells[i]={pivotRow:t,pivotColumn:e,isSelected:!0}:this._selectedCells[i].isSelected=!0,this._refreshRequired=!0}},unselectCell:function(t,e){this._beginSelectionUpdate(),this._internalUnselectCell(t,e),this._endSelectionUpdate()},_internalUnselectCell:function(t,e){t=this.parentPivotGrid.getCellId(e,t);null!=this._selectedCells[t]&&(this._selectedCells[t].isSelected=!1),delete this._cellElements[t],this._refreshRequired=!0},isCellSelected:function(t,e){var i=this.parentPivotGrid.getCellId(e,t);return!(!e.isSelected&&!t.isSelected)||null!=this._selectedCells[i]&&this._selectedCells[i].isSelected},getSelectedCellsCount:function(){return this._selectedCells.length},getSelectedCells:function(){var t,e=new Array;for(t in this._selectedCells){var i=this._selectedCells[t];i.isSelected&&e.push({pivotRow:i.pivotRow,pivotColumn:i.pivotColumn,pivotCells:this})}return e},getNextCell:function(t,e){var i={};switch(e){case"left":i={x:t.pivotColumn.x-1,y:t.pivotRow.y+1};break;case"right":i={x:t.pivotColumn.x+t.pivotColumn.getWidth()+1,y:t.pivotRow.y+1};break;case"top":i={x:t.pivotColumn.x+1,y:t.pivotRow.y-1};break;case"bottom":i={x:t.pivotColumn.x+1,y:t.pivotRow.y+t.pivotRow.getHeight()+1}}i={x:i.x+2*this.parentPivotGrid._pivotColumns.x-this.parentPivotGrid._pivotColumns.viewPort.x,y:i.y+2*this.parentPivotGrid._pivotRows.y-this.parentPivotGrid._pivotRows.viewPort.y},i=this._hitTest(i);if(i)return i}})}(jqxBaseFramework),function(S){S.jqx.jqxPivotGrid=S.jqx.jqxPivotGrid||{},S.jqx.jqxPivotGrid.pivotItem=function(t,e){this.text="Item",this.isExpanded=!1,this.expandCollapseEnabled=!0,this.isHidden=!1,this.isFiltered=!1,this.isSelected=!1,this._height=26,this._width=18,this.isDirty=!0,this.parentItem=t||null,this.hierarchy=e||t.hierarchy,this.parentPivotGrid=this.hierarchy.parentPivotGrid,this.id=this.parentPivotGrid.genId(),this.itemLevel=0,this.itemColumn=0,this._itemOrdinal=NaN,this.x=0,this.y=0,this.hierarchyItemWidth=70,this.hierarchyItemHeight=26,this.widthWithChildrenCached=0,this.minimumWidth=18,this.maximumWidth=1e7,this.minimumHeight=8,this.maximumHeight=1/0,this.items=new Array,this.valueItems=new Array},S.extend(S.jqx.jqxPivotGrid.pivotItem.prototype,{_getChildItemsToRender:function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];i.isHidden||i.isFiltered||(t.push(i),i.isExpanded&&i._getChildItemsToRender(t))}},_calculateWidthWithChildren:function(){if(this.isHidden)this.widthWithChildrenCached=0;else{var t=!this.isColumn&&this.hierarchy.compactStyleRenderingEnabled;if(t)this.widthWithChildrenCached=this.hierarchy.getColumnWidth(0);else if(this.widthWithChildrenCached=this.getWidth(),null!=this.items&&null!=this.valueItems&&(0<this.getVisibleItemsCount()||!this.isColumn&&!t)){var e=0;if(this.isColumn){if(e=0,this.isExpanded)for(s=0;s<this.items.length;s++)this.items[s].isHidden||(e+=this.items[s].getWidthWithChildren());for(s=0;s<this.valueItems.length;s++)this.valueItems[s].isHidden||(e+=this.valueItems[s].getWidthWithChildren())}else for(var i=this.hierarchy.getMaxVisibleLevelDepth(),s=this.itemLevel;s<=i;s++)e+=this.hierarchy.getColumnWidth(s);this.widthWithChildrenCached=e}else this.widthWithChildrenCached=this.getWidth()}},getWidthWithChildren:function(){return this.hierarchy._renderRequired&&this._calculateWidthWithChildren(),this.widthWithChildrenCached},getDisplayWidth:function(){if(!this.isDirty&&!this.hierarchy._renderRequired)return this.displayWidth;var t=this.hasVisibleValueItems();return this.isColumn?this.displayWidth=this.isExpanded||t?this.getWidthWithChildren():this.getWidth():(this.displayWidth=!this.hierarchy.isColumnsHierarchy&&this.hierarchy.compactStyleRenderingEnabled?this.getWidthWithChildren():this.getWidth(),this.isExpanded||t||(this.displayWidth=this.hierarchy.getWidth()-this.x)),this.displayWidth<18&&(this.displayWidth=18),this.displayWidth},getWidth:function(){if(this.isHidden||this.isFiltered)return 0;if(null==this.hierarchy)return 0;var t=this.itemColumn;!this.hierarchy.isColumnsHierarchy&&this.hierarchy.compactStyleRenderingEnabled&&(t=0);var e=this.minimumWidth;return this.isColumn?(e=this.hierarchyItemWidth,!this.parentItem||e<this.parentItem.getWidth()&&this.parentItem.widthWithChildrenCached):e=this.hierarchy.getColumnWidth(t),e},escape_HTML:function(t){return t.replace(/[&<>"]/g,function(t){return{"&":"&","<":"<",">":">",'"':'"'}[t]||t})},_measureElement:function(t){t=this.escape_HTML(""+t);var e=S("<span style='visibility: hidden; white-space: nowrap;'>"+t+"</span>");S(document.body).append(e);t=this.hierarchy.sortable?16:0,t={width:e.width()+t+8,height:e.height()+8};return e.remove(),t},autoResize:function(t){t=t||"fitItemContent",this.isColumn?this.setWidth(this.minimumWidth):this.setHeight(this.minimumHeight),"default"!=t&&"fitAll"!=t&&"fitItemContent"!=t||this._autoResizeBestItemContent(t),"default"!=t&&"fitAll"!=t&&"fitItemContent"!=t||this.isColumn&&null!=this.parentItem&&this.getWidth()<this.parentItem.getWidth()&&this.setWidth(this.parentItem.getWidth())},_autoResizeBestItemContent:function(t){this._updateVisibleChildItemsCount();var e,i=this._measureElement(this.text);for(e in"default"==t&&this.adapterItem.boundField&&(isNaN(this.adapterItem.boundField.width)||(i.width=this.adapterItem.boundField.width),isNaN(this.adapterItem.boundField.height)||(i.height=this.adapterItem.boundField.height)),this.itemColumn>=this.hierarchy._getColumnsCount()&&this.hierarchy._updateColumnsCount(),0<this._visibleChildItemsCount&&(i.width+=30),(this.getWidth()<i.width||"default"==t&&this.adapterItem.boundField&&!isNaN(this.adapterItem.boundField.width))&&this.setWidth(i.width),this.isColumn?this.parentPivotGrid._pivotColumns.getHeight()<i.height&&this.parentPivotGrid._pivotColumns.setRowHeight(this,i.height):this.getHeight()<i.height&&this.setHeight(i.height),this.items)this.items[e]._autoResizeBestItemContent(t);for(e in this.valueItems)this.valueItems[e]._autoResizeBestItemContent(t);null!=this.hierarchy&&(this.hierarchy._renderRequired=!0)},_autoResizeBestCellFit:function(t){if(null!=this.hierarchy&&this.hierarchy._renderRequired&&this.hierarchy.render(),null!=this.hierarchy&&this.hierarchy.ColumnsCountRequresUpdate&&this.hierarchy._updateColumnsCount(),0==this.items.length&&0==this.valueItems.length){if(null!=this.hierarchy&&null!=this.parentPivotGrid&&null!=this.parentPivotGrid._pivotCells&&null!=this.parentPivotGrid._pivotRows&&null!=this.parentPivotGrid._pivotColumns){var e={width:1,height:1},i=(this.isColumn?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns,this._getVisibleLeafLevelItems());for(o in i){i[o].isColumn||i[o],i[o].isColumn&&i[o];var s=10,n=10;e.width<s&&(e.width=s),e.height<n&&(e.height=n)}this.width<e.width&&this.setWidth(e.width),!this.isColumn&&this.getHeight()<e.height&&this.setHeight(e.height)}}else{for(var o in this.items)this.items[o]._autoResizeBestCellFit(t);for(var o in this.valueItems)this.valueItems[o]._autoResizeBestCellFit(t)}null!=this.hierarchy&&(this.hierarchy._renderRequired=!0)},setWidth:function(t){if(t<0)throw new Exception("Invalid pivotItem Width value. The value must greater than 0");var e;null!=this.hierarchy&&(e=this.itemColumn,!this.hierarchy.isColumnsHierarchy&&this.hierarchy.compactStyleRenderingEnabled&&(e=0),this.hierarchy._getColumnsCount()<e&&this.hierarchy._updateColumnsCount(),t<this.minimumWidth&&(t=this.minimumWidth),t>this.maximumWidth&&(t=this.maximumWidth),this.isColumn?this.hierarchyItemWidth=t:this.hierarchy.setColumnWidth(e,t),this.hierarchy._renderRequired=!0)},getHeight:function(){return this.isHidden||this.isFiltered?0:this.hierarchyItemHeight},setHeight:function(t){if(t<0||1e4<t)throw new Exception("Invalid pivotItem Height value. The value must be between 0 and 10000");t<this.minimumHeight&&(t=this.minimumHeight),t>this.maximumHeight&&(t=this.maximumHeight),this.hierarchyItemHeight=t,null!=this.hierarchy&&(this.hierarchy._renderRequired=!0)},_calculateHeightWithChildren:function(){if(this.isHidden||this.isFiltered)this.heightWithChildren=0;else{var t=!this.isColumn&&this.hierarchy.compactStyleRenderingEnabled;if(this.isExpanded||this.hasVisibleValueItems()){var e=0;if(this.isColumn){e=this.hierarchyItemHeight;var i=0;if(this.isExpanded)for(var s=0;s<this.items.length;s++)i<(n=this.items[s].getHeightWithChildren())&&(i=n);for(var n,s=0;s<this.valueItems.length;s++)i<(n=this.valueItems[s].getHeightWithChildren())&&(i=n);0<i&&(e+=i)}else{if(e=t?this.getHeight():0,this.isExpanded)for(s=0;s<this.items.length;s++)this.items[s].isHidden||this.items[s].isFiltered||(e+=this.items[s].getHeightWithChildren());for(s=0;s<this.valueItems.length;s++)this.valueItems[s].isHidden||this.valueItems[s].isFiltered||(e+=this.valueItems[s].getHeightWithChildren())}this.heightWithChildren=e}else this.heightWithChildren=this.hierarchyItemHeight;this.IsRowDetailsVisible&&(this.heightWithChildren+=this.RowDetailsHeight)}},getHeightWithChildren:function(){return(this.hierarchy._renderRequired||this.isDirty)&&this._calculateHeightWithChildren(),this.heightWithChildren},getDisplayHeight:function(){var t=this.hasVisibleValueItems(),e=0;return this.isColumn?e=this.isExpanded||t?this.getTotalHeight():this.hierarchy.getHeight()-this.y:this.hierarchy.compactStyleRenderingEnabled?(e=this.getHeight(),this.IsRowDetailsVisible&&(e+=this.RowDetailsHeight)):e=this.getHeightWithChildren(),e<this.minimumHeight&&(e=this.minimumHeight),e},getTotalHeight:function(){return this.isHidden||this.isFiltered?0:this.hierarchyItemHeight+(this.IsRowDetailsVisible?this.RowDetailsHeight:0)},ensureVisible:function(){var t,e,i=this;i.isVisible()||(e=i.hierarchy.parentPivotGrid.host,i.isColumn?(t=e.find("#divHScroll"),i.x+i.getWidth()>i.hierarchy.viewPort.width?t.val(i.x+i.getWidth()-i.hierarchy.viewPort.width):t.val(i.x)):(e=e.find("#divVScroll"),i.y+i.getHeight()>i.hierarchy.viewPort.height?e.val(i.y+i.getHeight()-i.hierarchy.viewPort.height):e.val(i.y)))},isVisible:function(){return!this.isHidden&&!(this.y<this.hierarchy.viewPort.y-this.hierarchy.y||this.y+this.getDisplayHeight()>this.hierarchy.viewPort.y-this.hierarchy.y+this.hierarchy.viewPort.height||this.x<this.hierarchy.viewPort.x-this.hierarchy.x||this.x+this.getDisplayWidth()>this.hierarchy.viewPort.x-this.hierarchy.x+this.hierarchy.viewPort.width)},_updateVisibleChildItemsCount:function(){for(var t=0,e=0;e<this.items.length;e++)this.items[e].isHidden||this.items[e].isFiltered||t++;this._visibleChildItemsCount=t},render:function(t,e){this._updateVisibleChildItemsCount();if(this.isHidden||this.isFiltered)return!0;this.x=t,this.y=e;var i=!this.isColumn&&this.hierarchy.compactStyleRenderingEnabled,s=i?this.getTotalHeight():0;if(this.isExpanded)for(var n=0;n<this.items.length;n++)if(!(r=this.items[n]).isHidden&&!r.isFiltered)if(this.isColumn){if(!r.render(this.x+s,e+this.getTotalHeight()))break;s+=r.getWidthWithChildren()}else{var o=t;if(o+=i?0:this.getWidth(),!r.render(o,this.y+s))break;s+=r.getHeightWithChildren()}for(var r,n=0;n<this.valueItems.length;n++)if(!(r=this.valueItems[n]).isHidden&&!r.isFiltered)if(this.isColumn){if(!r.render(this.x+s,e+this.getTotalHeight()))break;s+=r.getWidthWithChildren()}else{o=t;if(o+=i?0:this.getWidth(),!r.render(o,this.y+s))break;s+=r.getHeightWithChildren()}return this._calculateWidthWithChildren(),this._calculateHeightWithChildren(),!0},_getChildItemsDepth:function(){for(var t=0,e=0;e<this.items.length;e++)t<(i=this.items[e]._getChildItemsDepth())&&(t=i);for(var i,e=0;e<this.valueItems.length;e++)t<(i=this.valueItems[e]._getChildItemsDepth())&&(t=i);return t+1},getTotalItemsCount:function(){var t=0;if(0==this.items.length&&0==this.valueItems.length)t=1;else{for(var e=0;e<this.items.length;e++)t+=this.items[e].getTotalItemsCount();for(e=0;e<this.valueItems.length;e++)t+=this.valueItems[e].getTotalItemsCount()}return t},hasVisibleValueItems:function(){for(var t=0;t<this.valueItems.length;t++){var e=this.valueItems[t];if(0==e.isHidden&&0==e.isFiltered)return!0}return!1},getVisibleItemsCount:function(){if(this.isHidden||this.isFiltered)return 0;var t=0;if(!(this.isExpanded&&0!=this.items.length||0!=this.valueItems.length))return t;for(var e=t=0;e<this.items.length;e++)this.items[e].isHidden||this.items[e].isFiltered||t++;for(e=0;e<this.valueItems.length;e++)this.valueItems[e].isHidden||this.valueItems[e].isFiltered||t++;return t},hitTest:function(t){if(this.isHidden||this.isFiltered)return null;var e=this.getDisplayHeight()+1,i=this.getDisplayWidth()+1;return t.x>=this.x&&t.x<=this.x+i&&t.y>=this.y&&t.y<=this.y+e?this:null},_expandInternal:function(t,e,i){if(0!=this.items.length&&this.expandCollapseEnabled&&this.isExpanded!=t){var s=new S.Event(this.isExpanded?"pivotitemcollapsing":"pivotitemexpanding");s.owner=this.hierarchy.parentPivotGrid,s.args={pivotItem:this},s.cancel=!1;var n=this.hierarchy.parentPivotGrid.host;if(n.trigger(s),!s.cancel&&(this.isExpanded=t,0!=this.items.length||0!=this.valueItems.length)){if(i){for(var o=0;o<this.items.length;o++)this.items[o]._expandInternal(t,e,i);for(o=0;o<this.valueItems.length;o++)this.valueItems[o]._expandInternal(t,e,i)}this.hierarchy._renderRequired=!0,e&&this.hierarchy._updateVisibleLeaves(),(s=new S.Event(this.isExpanded?"pivotitemexpanded":"pivotitemcollapsed")).owner=this.hierarchy.parentPivotGrid,s.args={pivotItem:this},n.trigger(s)}}},expand:function(){this._expandInternal(!0,!0,!1)},collapse:function(){this._expandInternal(!1,!0,!1)},_getFirstVisibleLeaf:function(t){if(t.isExpanded){for(var e=!1,i=0;i<t.items.length;i++)if(0==t.items[i].isHidden&&0==t.items[i].isFiltered){t=t.items[i],t=this._getFirstVisibleLeaf(t),e=!0;break}if(e)return t}if(t.hasVisibleValueItems){for(e=!1,i=0;i<t.valueItems.length;i++)if(0==t.valueItems[i].isHidden&&0==t.valueItems[i].isFiltered){t=t.valueItems[i],t=this._getFirstVisibleLeaf(t),e=!0;break}if(e)return t}return t},_getLastVisibleLeaf:function(t){for(var e=!1,i=t.valueItems.length-1;0<=i;i--)if(0==t.valueItems[i].isHidden&&0==t.valueItems[i].isFiltered){t=t.valueItems[i],t=this._getLastVisibleLeaf(t),e=!0;break}if(e)return t;for(i=t.items.length-1;0<=i&&t.isExpanded;i--)if(0==t.items[i].isHidden&&0==t.items[i].isFiltered){t=t.items[i],t=this._getLastVisibleLeaf(t);break}return t}}),S.jqx.jqxPivotGrid.hierarchy=function(){this.parentPivotGrid=arguments[0],this._initDefaults()},S.extend(S.jqx.jqxPivotGrid.hierarchy.prototype,{_initDefaults:function(){this.columnWidths=new Array,this.rowHeights=new Array,this.items=new Array,this.valueItems=new Array,this.visibleLeafItems=new Array,this.viewPort=new Object,this.viewPort.x=0,this.viewPort.y=0,this.viewPort.width=1e4,this.viewPort.height=1e4,this.isFixed=!1,this.isHidden=!1,this.resizable=!0,this.sortable=!0,this._renderRequired=!0,this.maxVisibleLevelDepth=-1,this.showExpandCollapseButtons=!0,this.x=0,this.y=0,this._width=0,this._height=0,this.minColumnWidth=18,this._isColumnsCountRequresUpdate=!0,this._selectedItems=new Object,this.virtualModeThreshold=5e3,this._isVirtualMode=!0},isVisible:function(){return!this.isHidden},toggle:function(){this.isHidden?this.show():this.hide()},getOtherHierarchy:function(){return this.isColumnsHierarchy?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns},show:function(){this.isHidden=!1,this._renderRequired=!0,this.getOtherHierarchy()._renderRequired=!0},hide:function(){this.isHidden=!0,this._renderRequired=!0,this.getOtherHierarchy()._renderRequired=!0},refresh:function(){var t=this.parentPivotGrid,e=t.toThemeProperty("jqx-widget-content jqx-fill-state-pressed jqx-widget-header"),i=t.toThemeProperty("jqx-widget-content jqx-fill-state-normal jqx-widget-header"),s=S.jqx.get(this,"renderCanvas"),n=this._renderRequired||this._refreshRequired;if(n&&(this._renderRequired&&this.render(),!this.isHidden)){var o=new Array,r=new Date,l=this._getItemsToRender();if(l){for(var h=0;h<l.length;h++){var a,d,u,c,m,v,p=l[h],_=p.getDisplayWidth()-1,g=p.getDisplayHeight()-1,C=p._element;S.isFunction(t.itemsRenderer)&&(v=t.itemsRenderer(p),C&&p._currentCustomContent!=v&&(s.removeChild(C),C=p._element=null),p._currentCustomContent=v),C||(f={left:4,top:4,right:4,bottom:4},!this.isColumnsHierarchy&&this.compactStyleRenderingEnabled&&(f.left+=p.itemLevel*this.compactStyleRenderingItemsIndent),a=p.text,y="left",S.isFunction(t.itemsRenderer)?(a=p._currentCustomContent,f={left:0,top:0,right:0,bottom:0}):(d="",0!=p.items.length&&p.hierarchy.showExpandCollapseButtons&&(d=p.isExpanded?"<div style='position: relative; top: 3px; padding: 5px; width: 11px; height: 11px;' class='jqx-pivotgrid-collapse-button'></div>":"<div style='position: relative; top: 3px; padding: 5px; width: 11px; height: 11px;' class='jqx-pivotgrid-expand-button'></div>"),u="",p.hierarchy._sortItem==p&&(u="<div id='sortElement' class='"+("desc"==p.hierarchy._sortOrder?"sortdesc jqx-grid-column-sortdescbutton "+this.parentPivotGrid.toThemeProperty("jqx-icon-arrow-down"):"sortasc jqx-grid-column-sortascbutton "+this.parentPivotGrid.toThemeProperty("jqx-icon-arrow-up"))+"' style='position: relative; float: right; padding-right: 8px; width: 16px; height: 100%;'></div>"),c=p.text,p.adapterItem.boundField&&(y=p.adapterItem.boundField.align||"left"),"center"!=(y=y.toString().toLowerCase())&&"right"!=y&&(y="left"),a=""!=u?(m=0,v=24,""!=d&&(v+=m=23),d+"<div><div style='left: "+m+"px; top: 0; position: absolute; height: 100%; width: calc(100% - "+v+"px); text-overflow: ellipsis; overflow: hidden;  white-space: nowrap;padding-left:"+f.left+"px; padding-top:"+f.top+"px; '>"+c+"</div><div style='left: 0; top: 0; position: absolute; height: 100%; width: 100%;'>"+u+"</div></div>"):d+c+u),C=t.createDiv(s,"",_,g),t.setDivContent(C,a,f,y,!0),this.parentPivotGrid.getChild(C,"innerDiv").className="jqx-pivotgrid-item",t.setElementPosition(C,p.x,p.y),C.originalY=C.style.top),p.tRender=r;var f=p.isSelected?e:i,y=p.isSelected?"classNameSelected":"className",y=S.jqx.getByPriority([p[y],p.adapterItem&&p.adapterItem.boundField?p.adapterItem.boundField[y]:void 0,this.hierarchy?this.hierarchy[y]:void 0]);y&&(f+=" "+y),(f+=" jqx-pivotgrid-content-wrapper")!=C.className&&(C.className=f),C.style.display="block",(C.item=p)._element=C}for(h=0;h<s.childNodes.length;h++)s.childNodes[h].item&&s.childNodes[h].item.tRender!=r&&o.push(s.childNodes[h]);for(;;){var x=o.pop();if(!x)break;100<s.childNodes.length?(x.item._element=void 0,s.removeChild(x)):x.item._element.style.display="none"}var I=this.isColumnsHierarchy?0:-t._offsetY,n=this.isColumnsHierarchy?-t._offsetX:0;t.setElementPosition(s,n,I),this._refreshRequired=!1}}},clear:function(){this._initDefaults(),this._resetCanvas(),this.items=[],this.valueItems=[],this._renderRequired=!0},_resetCanvas:function(){var t=S.jqx.get(this,"renderCanvas");if(t)for(;t.hasChildNodes();)t.firstChild.item._element=void 0,t.removeChild(t.firstChild)},autoResize:function(t){for(var e=0;e<this.items.length;e++)this.items[e].autoResize(t);for(e=0;e<this.valueItems.length;e++)this.valueItems[e].autoResize(t)},getMaxVisibleLevelDepth:function(){if(-1==this.maxVisibleLevelDepth||this._renderRequired)for(var t=this._getVisibleLeafLevelItems(),e=this.maxVisibleLevelDepth=0;e<t.length;e++)t[e].itemLevel>this.maxVisibleLevelDepth&&(this.maxVisibleLevelDepth=t[e].itemLevel);return this.maxVisibleLevelDepth},getHierarchyDepth:function(){for(var t=0,e=0;e<this.items.length;e++)t<(i=this.items[e]._getChildItemsDepth())&&(t=i);for(var i,e=0;e<this.valueItems.length;e++)t<(i=this.valueItems[e]._getChildItemsDepth())&&(t=i);return t},getSortItem:function(){return this._sortItem},getSortOrder:function(){return this._sortOrder},_fnAscSortComparer:function(t,e){var i=t.hierarchy.parentPivotGrid,s=(t.isColumn?i._pivotRows:i._pivotColumns)._sortItem;if(!s)return 0;if(t.adapterItem&&t.adapterItem.isTotal)return 1;if(e.adapterItem&&e.adapterItem.isTotal)return-1;i=i._pivotCells,t=t.isColumn?i.getCellValue(s,t):i.getCellValue(t,s),s=e.isColumn?i.getCellValue(s,e):i.getCellValue(e,s);return t.value-s.value},_fnDescSortComparer:function(t,e){return t.adapterItem&&t.adapterItem.isTotal?1:e.adapterItem&&e.adapterItem.isTotal?-1:-1*S.jqx.jqxPivotGrid.hierarchy.prototype._fnAscSortComparer(t,e)},_collectionSort:function(t,e,i){if(this.parentPivotGrid&&this.parentPivotGrid._pivotCells){var s=this.isColumnsHierarchy?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns;t=t||this.items,e=e||("asc"==s._sortOrder?this._fnAscSortComparer:this._fnDescSortComparer),this._isSorted&&!i&&this._collectionRemoveSort(t);for(var n=0;n<t.length;n++)t[n]._itemOrdinal=n,this._collectionSort(t[n].items,e,!0);t=t.sort(e),i||(this._isSorted=!0,this._renderRequired=!0,s._renderRequired=!0,this._updateVisibleLeaves())}},_collectionRemoveSort:function(t,e){if(this._isSorted){t=t||this.items;for(var i=new Array(t.length),s=0;s<t.length;s++)i[t[s]._itemOrdinal]=t[s],this._collectionRemoveSort(t[s].items,!0);this.items=i,e||(this._renderRequired=!0,this._updateVisibleLeaves(),this.isColumnsHierarchy&&(this._isColumnsCountRequresUpdate=!0),this._isSorted=!1,(e=this.isColumnsHierarchy?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns)._sortItem=void 0,e._sortOrder=void 0,e._renderRequired=!0)}},sortBy:function(t,e){var i,s;!t||t.isColumn==this.isColumnsHierarchy||0<t.valueItems.length||((i=new S.Event("sortchanging")).owner=this.parentPivotGrid,i.args={pivotItem:t,sortOrder:e},i.cancel=!1,this.parentPivotGrid.host.trigger(i),i.cancel||(this._collectionRemoveSort(this.items),(s=t.isColumn?this.parentPivotGrid._pivotColumns:this.parentPivotGrid._pivotRows)._sortItem=t,s._sortOrder=e,this._collectionSort(),this.parentPivotGrid._internalRefresh(),(i=new S.Event("sortchanged")).owner=this.parentPivotGrid,i.args={pivotItem:t,sortOrder:e},this.parentPivotGrid.host.trigger(i)))},removeSort:function(){var t=this==this.parentPivotGrid._pivotColumns?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns,e=t._sortItem,i=t._sortOrder,s=new S.Event("sortremoving");s.owner=this.parentPivotGrid,s.args={pivotItem:e,sortOrder:i},s.cancel=!1;t=this.parentPivotGrid.host;t.trigger(s),s.cancel||(this._collectionRemoveSort(this.items),this.parentPivotGrid._internalRefresh(),(s=new S.Event("sortremoved")).owner=this.parentPivotGrid,s.args={pivotItem:e,sortOrder:i},t.trigger(s))},_binSearchItems:function(t,e){return this._binSearchItems2(t,e,0,t.length)},_binSearchItems2:function(t,e,i,s){var n=i,o=s;if(o==n)return-1;for(var r=t[0].isColumn;n<o;){var l=parseInt((n+o)/2),h=t[l];if(r)if(h.x>e.x)o=l;else{if(!((l+1<o?t[l+1].x:h.x+h.getWidth())<e.x))return l;n=l+1}else if(h.y>e.y)o=l;else{if(!((l+1<o?t[l+1].y:h.y+h.getTotalHeight())<e.y))return l;n=l+1}}return-1},_pointToLeafItemIndex:function(t){this._renderRequired&&this.render();var e={x:t.x,y:t.y};e.x+=-this.x+this.viewPort.x,e.y+=-this.y+this.viewPort.y;t=this._getVisibleLeafLevelItems();return this._binSearchItems(t,e)},_pointToLeafItem:function(t){var e=this._getVisibleLeafLevelItems(),t=this._pointToLeafItemIndex(t);return-1==t||t<0||t>=e.length?null:(e[t].lfIdx=t,e[t])},_pointToLeafItemIndexAbsolute:function(t){this._renderRequired&&this.render();this.viewPort.x,this.x,this.viewPort.y,this.y;var e={x:t.x,y:t.y};e.x-=this.x-(this.viewPort.x-this.x),e.y-=this.y-(this.viewPort.y-this.y);t=this._getVisibleLeafLevelItems();return this._binSearchItems(t,e)},_pointToLeafItemAbsolute:function(t){var e=this._getVisibleLeafLevelItems(),t=this._pointToLeafItemIndexAbsolute(t);return-1==t||t<0||t>=e.length?null:(e[t].lfIdx=t,e[t])},_pointInRect:function(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},hitTest:function(t){this._renderRequired&&this.render();var e=this.viewPort.x-this.x,i=this.viewPort.y-this.y;if(!this._pointInRect({x:t.x+e,y:t.y+i},this.viewPort)||this.isHidden)return null;var s={x:t.x,y:t.y};s.x-=this.x-(this.viewPort.x-this.x),s.y-=this.y-(this.viewPort.y-this.y);i=this._getVisibleLeafLevelItems(),t=this._binSearchItems(i,s);if(-1==t)return null;var n=i[t],o=n.hitTest(s);if(null!=o)return o;for(;null!=n;)if(n=n.parentItem,null!=n&&null!=(o=n.hitTest(s)))return o;return null},_addColumn:function(t){return t<this.minColumnWidth&&(t=this.minColumnWidth),this.columnWidths.push(t),this.columnWidths.length-1},setColumnWidth:function(t,e){return t>=this.columnWidths.length&&this._updateColumnsCount(t+1),e<this.minColumnWidth&&(e=this.minColumnWidth),t<this.columnWidths.length&&(this.columnWidths[t]=e),this._renderRequired=!0},getColumnWidth:function(t){return t>=this.columnWidths.length?70:this.columnWidths[t]},_getVisibleLeaves:function(t,e,i){if(e.isHidden||e.isFiltered)return!0;if(0==e.items.length&&0==e.valueItems.length)return t.push(e),!0;if(i&&t.push(e),e.isExpanded)for(var s=0;s<e.items.length;s++){var n=e.items[s];n.isHidden||n.isFiltered||(0<e.items.length&&n.isExpanded||n.hasVisibleValueItems()?this._getVisibleLeaves(t,n,i):t.push(n))}for(s=0;s<e.valueItems.length;s++){var o=e.valueItems[s];o.isHidden||o.isFiltered||t.push(o)}return!0},_getVisibleLeafLevelItems:function(){return 0==this.visibleLeafItems.length&&this._updateVisibleLeaves(),this.visibleLeafItems},_updateVisibleLeaves:function(){if(this.visibleLeafItems=new Array,this.items.length+this.valueItems.length!=0){for(var t=!this.isColumnsHierarchy&&this.compactStyleRenderingEnabled,e=0;e<this.items.length;e++)(i=this.items[e]).isHidden||i.isFiltered||(i.isExpanded||i.hasVisibleValueItems()?this._getVisibleLeaves(this.visibleLeafItems,i,t):this.visibleLeafItems.push(i));for(var i,e=0;e<this.valueItems.length;e++)(i=this.valueItems[e]).isHidden||i.isFiltered||(i.isExpanded||i.hasVisibleValueItems()?this._getVisibleLeaves(this.visibleLeafItems,i,t):this.visibleLeafItems.push(i));for(e=0;e<this.visibleLeafItems.length;e++)this.visibleLeafItems[e]._lfIndex=e;this._updateItemsLevelAndColumn()}},_getFirstLeafIndexToRender:function(){var t={x:this.x,y:this.y},t={x:t.x,y:t.y};return t.x-=this.x-(this.viewPort.x-this.x),t.y-=this.y-(this.viewPort.y-this.y),this._binSearchItems(this._getVisibleLeafLevelItems(),t)},_getLastLeafIndexToRender:function(){var t={x:Math.min(this.viewPort.width,this.getWidth())-5,y:Math.min(this.viewPort.height,this.getHeight())-5};return this._pointToLeafItemIndex(t)},_getLeafItemsToRender:function(){var t={};return t.items=this._getVisibleLeafLevelItems(),t.first=this._getFirstLeafIndexToRender(),t.last=this._getLastLeafIndexToRender(),t},_getItemsToRender:function(){var t=this._getLeafItemsToRender(),e=t.first,i=t.last;if(-1!=e&&-1!=i){for(var s={},n=e;n<=i;n++){var o=t.items[n];for(s[o.id]=o;null!=o.parentItem;)s[(o=o.parentItem).id]=o}var n,r=new Array;for(n in s)r.push(s[n]);return r}},_updateItemsLevelAndColumn2:function(t,e){t.itemColumn=e,t.itemLevel=e;for(var i=0;i<t.items.length;i++)this._updateItemsLevelAndColumn2(t.items[i],e+1);for(i=0;i<t.valueItems.length;i++)this._updateItemsLevelAndColumn2(t.valueItems[i],e+1)},_updateItemsLevelAndColumn:function(){for(var t=0;t<this.items.length;t++)this._updateItemsLevelAndColumn2(this.items[t],0);for(t=0;t<this.valueItems.length;t++)this._updateItemsLevelAndColumn2(this.valueItems[t],0)},updateColumnsCount:function(){this.updateColumnsCount(0)},getTotalItemsCount:function(){var t=0;if(0==this.items.length&&0==this.valueItems.length)t=1;else{for(var e=0;e<this.items.length;e++)t+=this.items[e].getTotalItemsCount();for(e=0;e<this.valueItems.length;e++)t+=this.valueItems[e].getTotalItemsCount()}return t},_updateColumnsCount:function(t){var e,i=this._getColumnsCount(),s=this.getTotalItemsCount();1024<t&&(t=1024),this.isColumnsHierarchy?s<t&&(s=t):s=(e=this.getHierarchyDepth())<t?t:e;for(var n=i;n<s;n++)this._addColumn(70);this._isColumnsCountRequresUpdate=!1},_updateColumnsIndexes:function(){for(var t in this.items)this._updateItemsLevelAndColumn2(this.items[t],0);for(var t in this.valueItems)this._updateItemsLevelAndColumn2(this.valueItems[t],0)},_getColumnsCount:function(){return this.columnWidths.length},_getRenderedItems:function(){var t=new Array;return this._getChildItemsToRender(t),t},_getChildItemsToRender:function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];i.isHidden||i.isFiltered||(t.push(i),i.isExpanded&&i._getChildItemsToRender(t))}},getWidth:function(){return this._renderRequired&&this.render(),this._width},getHeight:function(){return this._renderRequired&&this.render(),this._height},_beginSelectionUpdate:function(){for(var t in this._selectedItems)this._selectedItems[t].OldIsSelected=this._selectedItems[t].isSelected},_endSelectionUpdate:function(){var t,e=new Array;for(t in this._selectedItems){var i,s=this._selectedItems[t];s.isSelected||e.push(this._selectedItems[t]),s.isSelected==s.OldIsSelected||null!=s.parentItem&&1!=s.parentItem.isExpanded&&!s._isValueItem||((i=new S.Event("pivotitemselectionchanged")).owner=this.parentPivotGrid,i.args={pivotItem:s,selected:s.isSelected},this.parentPivotGrid.host.trigger(i))}for(t in e){var n=this._selectedItems[e[t].adapterItem.key];n.isSelected=n.OldIsSelected=!1,delete this._selectedItems[e[t].adapterItem.key]}},selectItem:function(t){this.parentPivotGrid.selectionEnabled&&(this._beginSelectionUpdate(),this._internalSelectItem(t),this._endSelectionUpdate())},_internalSelectItem:function(t){if(null!=t&&!(t.isColumn!=this.isColumnsHierarchy||this.isColumnsHierarchy&&this.isGroupingColumn(t))){var e=t.adapterItem.key;if(null==this._selectedItems[e]&&(this._selectedItems[e]=t),t.isSelected=!0,this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0,this.isColumnsHierarchy||!t.hierarchy.compactStyleRenderingEnabled){for(var i in t.items)this._internalSelectItem(t.items[i]);for(var i in t.valueItems)this._internalSelectItem(t.valueItems[i])}}},unselectItem:function(t){this._beginSelectionUpdate(),this._internalUnselectItem(t),this._endSelectionUpdate()},_internalUnselectItem:function(t){if(null!=t&&t.isColumn==this.isColumnsHierarchy){var e=t.adapterItem.key;if(this._selectedItems[e]&&(this._selectedItems[e].isSelected=!1,this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0),this.isColumnsHierarchy||!t.hierarchy.compactStyleRenderingEnabled){for(var i in t.items)this._internalUnselectItem(t.items[i]);for(var i in t.valueItems)this._internalUnselectItem(t.valueItems[i])}}},_internalClearSelection:function(){for(var t in this._selectedItems)this._internalUnselectItem(this._selectedItems[t])},clearSelection:function(){this._beginSelectionUpdate(),this._internalClearSelection(),this._endSelectionUpdate()},_applySelectionToParentItem:function(t){var e=t.parentItem;if(null!=e&&null!=e){var i,s=t.hierarchy,n=!0;if(e.isExpanded)for(var o in e.items)if(0==(i=e.items[o]).isSelected&&0==i.isHidden){n=!1;break}if(n)for(var o in e.valueItems)if(0==(i=e.valueItems[o]).isSelected&&0==i.isHidden){n=!1;break}n&&(t=e.adapterItem.key,null==s._selectedItems[t]&&(s._selectedItems[t]=e),e.isSelected=!0,this._applySelectionToParentItem(e))}},_applySelectionToParentItems:function(){for(var t in this._selectedItems)this._applySelectionToParentItem(this._selectedItems[t])},getSelectedItems:function(){var t,e=new Array;for(t in this._selectedItems)this._selectedItems[t].isSelected&&e.push(t);return e}}),S.jqx.jqxPivotGrid.pivotRows=function(t){S.extend(this,new S.jqx.jqxPivotGrid.hierarchy),this.parentPivotGrid=t,this.isColumnsHierarchy=!1,this.compactStyleRenderingEnabled=!1,this.compactStyleRenderingItemsIndent=20},S.extend(S.jqx.jqxPivotGrid.pivotRows.prototype,S.jqx.jqxPivotGrid.hierarchy.prototype),S.extend(S.jqx.jqxPivotGrid.pivotRows.prototype,{setColumnWidth:function(t,e){return t>=this.columnWidths.Count&&this._updateColumnsCount(t+1),this.compactStyleRenderingEnabled&&(t=0),t<this.columnWidths.length&&(this.columnWidths[t]=e),this._renderRequired=!0},updateBounds:function(){for(var t=0,e=0,i=0;i<2;i++)for(var s=0==i?this.items:this.valueItems,n=0;n<s.length;n++){var o=s[n];o.isHidden||(t+=o.getHeightWithChildren(),e<(o=o.getWidthWithChildren())&&(e=o))}this._width=e,this._height=t+1},render:function(){if(!this._renderSuppressed){for(this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0,this.isRendering=!0,this._isColumnsCountRequresUpdate&&this._updateColumnsCount();this._getColumnsCount()<this.getHierarchyDepth();)S.jqx.get(this,"columnWidths").push(70);var t,e;this._updateVisibleLeaves(),this.compactStyleRenderingEnabled&&(0==this.columnWidths.Count&&this._addColumn(70),(t=this.columnWidths[0])<(e=this.getHierarchyDepth())*this.compactStyleRenderingItemsIndent&&(t=e*this.compactStyleRenderingItemsIndent),this.columnWidths[0]=t),this.updateBounds();var i=0;if(this.items.length+this.valueItems.length==0)return null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),this.isRendering=!1,void(this._renderRequired=!1);for(var s=0;s<2;s++)for(var n=0==s?this.items:this.valueItems,o=0;o<n.length;o++){var r=n[o];if(null==r.hierarchy&&(r.hierarchy=this),!r.isHidden){var l=r.getHeightWithChildren();if(r.itemLevel<this.columnWidths.length&&r.getWidth()>this.columnWidths[r.itemLevel]&&(this.columnWidths[r.itemLevel]=r.getWidth()),!r.render(0,i))break;i+=l}}this.updateBounds(),null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),this._resetCanvas(),this._renderRequired=!1,this.isRendering=!1}},isOnRowDetails:function(t,e){if(!e.RowDetailsVisible)return!1;t={x:t.x,y:t.y};return t.x+=-this.x+this.viewPort.x,t.y+=-this.y+this.viewPort.y,t.y<e.y+e.getDisplayHeight()&&t.y>e.y+e.getDisplayHeight()-e.RowDetailsHeight}}),S.jqx.jqxPivotGrid.pivotColumns=function(t){S.extend(this,new S.jqx.jqxPivotGrid.hierarchy),this.parentPivotGrid=t,this.isColumnsHierarchy=!0},S.extend(S.jqx.jqxPivotGrid.pivotColumns.prototype,S.jqx.jqxPivotGrid.hierarchy.prototype),S.extend(S.jqx.jqxPivotGrid.pivotColumns.prototype,{render:function(){if(!this._renderSuppressed){if(this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0,this._updateVisibleLeaves(),this._updateColumnsIndexes(),this.items.length+this.valueItems.length==0)return null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),void this._updateVisibleLeaves();for(var t=0,e=0;e<2;e++)for(var i=0==e?this.items:this.valueItems,s=0;s<i.length;s++){var n=i[s];if(null==n.hierarchy&&(n.hierarchy=this),!n.isHidden){var o=n.getWidthWithChildren();if(!n.render(t,0))break;t+=o}}this._renderRequired=!1,null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),this._updateVisibleLeaves(),this.updateBounds(),this._resetCanvas()}},updateBounds:function(){for(var t=0,e=0,i=0;i<2;i++)for(var s=0==i?this.items:this.valueItems,n=0;n<s.length;n++){var o=s[n],r=o.getHeightWithChildren();t<r&&(t=r),e+=o.getWidthWithChildren()}this._height=t,this._width=e+1},_updateColumnsIndexes:function(){for(var t=this.visibleLeafItems.length,e=--t;0<=e;e--){var i=this.visibleLeafItems[e];i.itemColumn=e;for(var s=i.parentItem;null!=s;)s=s.hierarchy!=i.hierarchy?null:(s.itemColumn=e,(i=s).parentItem)}},setRowHeight:function(t,e){return!(e<15||500<e)&&(t.hierarchyItemHeight=e,this._renderRequired=!0)},isGroupingColumn:function(t){return null!=t&&(null!=this.parentPivotGrid&&!!(t.ItemIndex<this.parentPivotGrid.groupingColumns.length&&this.parentPivotGrid.isGroupingEnabled))}})}(jqxBaseFramework),function(t){t.extend(t.jqx._jqxPivotGrid.prototype,{_handleKeyboardNavigation:function(t){return"CELLS_SELECT"==this._internalSelectMode?this._handleCellsKeyboardNavigation(t):("ROW_SELECT"==this._internalSelectMode||this._internalSelectMode,!1)},_handleCellsKeyboardNavigation:function(t){var e=this._cellKBRangeSelectionEnd,i=void 0;if(!e)return!1;if(37==t.keyCode&&(i=this._pivotCells.getNextCell(e,"left")),38==t.keyCode?i=this._pivotCells.getNextCell(e,"top"):39==t.keyCode?i=this._pivotCells.getNextCell(e,"right"):40==t.keyCode&&(i=this._pivotCells.getNextCell(e,"bottom")),null!=i){this._pivotRows._refreshRequired=!0,this._pivotColumns._refreshRequired=!0,this._pivotCells._refreshRequired=!0,this._colItemRangeSelectionBeg=i.pivotColumn,this._rowItemRangeSelectionBeg=i.pivotRow,this._beginSelectionUpdate(),this._isCTRLPressed&&0!=this.multipleSelectionEnabled||this._internalClearSelection(),this._pivotCells._internalSelectCell(this._rowItemRangeSelectionBeg,this._colItemRangeSelectionBeg),this._cellKBRangeSelectionEnd={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells},this._cellKBRangeSelectionStart&&this._isSHIFTPressed||(this._cellKBRangeSelectionStart={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells});for(var e=Math.min(this._cellKBRangeSelectionStart.pivotColumn._lfIndex,this._cellKBRangeSelectionEnd.pivotColumn._lfIndex),s=Math.max(this._cellKBRangeSelectionStart.pivotColumn._lfIndex,this._cellKBRangeSelectionEnd.pivotColumn._lfIndex),n=Math.min(this._cellKBRangeSelectionStart.pivotRow._lfIndex,this._cellKBRangeSelectionEnd.pivotRow._lfIndex),o=Math.max(this._cellKBRangeSelectionStart.pivotRow._lfIndex,this._cellKBRangeSelectionEnd.pivotRow._lfIndex),r=e;r<=s;r++)for(var l=n;l<=o;l++){var h=this._pivotColumns.visibleLeafItems[r],a=this._pivotRows.visibleLeafItems[l];this._pivotCells._internalSelectCell(a,h)}this._endSelectionUpdate(),i.pivotRow.ensureVisible(),i.pivotColumn.ensureVisible(),this._internalRefresh()}return!1}})}(jqxBaseFramework);