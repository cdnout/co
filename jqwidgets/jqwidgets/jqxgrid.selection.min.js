!function(M){M.extend(M.jqx._jqxGrid.prototype,{selectallrows:function(){this._trigger=!1;var e=this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=new Array,this.selectedcells=new Array;for(var t=this.dataview.loadedrecords,l=0;l<e;l++){var i=t[l];if(i){var s=this.getboundindex(i);null!=s&&(this.selectedrowindexes[l]=s);for(var o=0;o<this.columns.records.length;o++)this.selectedcells[s+"_"+this.columns.records[o].datafield]=!0}else this.selectedrowindexes[l]=l}"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},unselectallrows:function(){this._trigger=!1;this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=new Array,this.selectedcells=new Array,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}),this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},selectrow:function(e,t){"none"!==this.selectionmode&&(this._applyrowselection(e,!0,t),!1!==t&&this._updatecheckboxselection())},_updatecheckboxselection:function(){var e,t;"checkbox"!=this.selectionmode||(t=this.getrows())&&this._checkboxcolumn&&(0!==t.length?(e=t.length,this.groupable&&(e=this.dataview.loadedrecords.length),this.virtualmode&&(e=this.source._source.totalrecords),(t=this.selectedrowindexes.length)===e?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}):0===t?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}):this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:null})):this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}))},unselectrow:function(e,t){this._applyrowselection(e,!1,t),!1!==t&&this._updatecheckboxselection()},selectcell:function(e,t){this._applycellselection(e,t,!0)},unselectcell:function(e,t){this._applycellselection(e,t,!1)},clearselection:function(e,t){if(this._trigger=!1,this.selectedrowindex=-1,this._oldselectedcell=null,!1!==t)for(var l=0;l<this.selectedrowindexes.length;l++)this._raiseEvent(3,{rowindex:this.selectedrowindexes[l]});this.selectedrowindexes=new Array,this.selectedcells=new Array,this.selectedcell=null,"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});for(l=0;l<this.columns.records.length;l++)this.columns.records[l].selected=!1,this.columns.records[l]._applyStyle();!1!==e?(this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(3,{rowindex:this.selectedrowindexes})):this._trigger=!0},getselectedrowindex:function(){if(-1==this.selectedrowindex||null==this.selectedrowindex){var e=0;if(e<this.selectedrowindexes.length)return this.selectedrowindexes[e]}return this.selectedrowindex},getselectedrowindexes:function(){return this.selectedrowindexes},getselectedcell:function(){if(!this.selectedcell)return null;var e=this.selectedcell;return e.row=this.selectedcell.rowindex,e.column=this.selectedcell.datafield,e.value=this.getcellvalue(e.row,e.column),e},getselectedcells:function(){var e,t=new Array;for(e in this.selectedcells)t[t.length]=this.selectedcells[e];return t},getselection:function(){return{cells:this.getselectedcells(),rows:this.getselectedrowindexes()}},_getcellsforcopypaste:function(){var e=new Array;if(-1==this.selectionmode.indexOf("cell"))for(var t=this.selectedrowindexes,l=0;l<t.length;l++)for(var i,s=t[l],o=0;o<this.columns.records.length;o++)"_checkboxcolumn"!==this.columns.records[o].datafield&&(this.columns.records[o].datafield,i={rowindex:s,datafield:this.columns.records[o].datafield},e.push(i));return e},deleteselection:function(){var e=this,t=e.getselectedcells();if(-1==this.selectionmode.indexOf("cell")&&(t=this._getcellsforcopypaste()),null!=t&&0<t.length){for(var l=0;l<t.length;l++){var i,s=t[l],o=e.getcolumn(s.datafield),a=e.getcellvalue(s.rowindex,s.datafield);o&&""!==a&&(i=null,"checkbox"==o.columntype&&(o.threestatecheckbox||(i=!1)),e._raiseEvent(17,{rowindex:s.rowindex,datafield:s.datafield,value:a}),l==t.length-1?e.setcellvalue(s.rowindex,s.datafield,i,!0):e.setcellvalue(s.rowindex,s.datafield,i,!1),o.displayfield!=o.datafield&&e.setcellvalue(s.rowindex,o.displayfield,i,!0),e._raiseEvent(18,{rowindex:s.rowindex,datafield:s.datafield,oldvalue:a,value:i}))}this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}},copyselection:function(){var l="",i=this;this.clipboardselection={},this.logicalclipboardselection={},this._clipboardselection=[];var e=i.getselectedcells();-1==this.selectionmode.indexOf("cell")&&(e=this._getcellsforcopypaste());var t=new Array;if(null!=e&&0<e.length){for(var s=999999999999999,o=-1,a=0;a<e.length;a++){var r,n,d=e[a],c=i.getcolumn(d.datafield);null==c||!c.clipboard||c.hidden&&!this.copytoclipboardhiddencolumns||(-1==t.indexOf(c.text)&&t.push(c.text),r=i.getcelltext(d.rowindex,c.displayfield),n=this.getrowdisplayindex(d.rowindex),this.clipboardselection[n]||(this.clipboardselection[n]={}),this.clipboardselection[n][c.displayfield]=r,this.logicalclipboardselection[n]||(this.logicalclipboardselection[n]={}),this.logicalclipboardselection[n][c.displayfield]=r,c.displayfield!=c.datafield&&(this.logicalclipboardselection[n][c.datafield]=i.getcellvalue(d.rowindex,c.datafield)),s=Math.min(s,n),o=Math.max(o,n))}for(var h,u=new Array,f=s;f<=o;f++)this.logicalclipboardselection[f]&&(h=M.extend({},this.logicalclipboardselection[f]),u.push(h));if(this.logicalclipboardselection=u,this.copytoclipboardwithheaders){for(var p=0;p<t.length;p++)0<p&&(l+="\t"),l+=t[p];l+="\r\n"}for(f=s;f<=o;f++){var g=0;this._clipboardselection[this._clipboardselection.length]=new Array,null!=this.clipboardselection[f]&&(M.each(this.clipboardselection[f],function(e,t){0<g&&(l+="\t");t=null==t?"":t;i._clipboardselection[i._clipboardselection.length-1][g]=t,g++,l+=t}),f<o&&(l+="\r\n"))}}return this.clipboardselectedtext=l},pasteselection:function(){var e=this.getselectedcells();if(this._oldselectedcell=null,-1==this.selectionmode.indexOf("cell")&&(e=this._getcellsforcopypaste()),null!=e&&0<e.length){var t=e[0].rowindex,l=this.getrowdisplayindex(t),t=e[0].datafield,i=this._getcolumnindex(t);this.selectedrowindexes=new Array,this.selectedcells=new Array;e.length;var s=0,o=new Array,a=[];this.copytoclipboardwithheaders&&this._clipboardselection.splice(0,1),this._clipboardselection||(this._clipboardselection=[]);for(var r=0;r<this._clipboardselection.length;r++){s+=this._clipboardselection[r].length,o[r]=new Array;for(var n=0;n<this._clipboardselection[r].length;n++){var d=this._clipboardselection[r][n];o[r].push(d)}}if(s<e.length){for(var c=new Array,r=0;r<e.length;r++)c[(x=e[r]).rowindex]||(c[x.rowindex]=new Array),c[x.rowindex].push(x);for(var h=0,u=0,r=0;r<c.length;r++)if(c[r]){for(n=0;n<c[r].length;n++){var f=(x=c[r][n]).rowindex,p=this.getcolumn(x.datafield);if("_checkboxcolumn"!==p.datafield&&!p.hidden){d="";if(o[h]&&null==o[h][u]&&(u=0),d=""+o[h][u],u++,p.cellsformat&&(-1!=p.cellsformat.indexOf("p")||-1!=p.cellsformat.indexOf("c")||-1!=p.cellsformat.indexOf("n")||-1!=p.cellsformat.indexOf("f"))){d.indexOf&&-1<d.indexOf(this.gridlocalization.currencysymbol)&&(d=d.replace(this.gridlocalization.currencysymbol,"")),-1<(d=(d=function(e,t,l){var i=e;if(t==l)return e;for(var s=i.indexOf(t);-1!=s;)s=(i=i.replace(t,l)).indexOf(t);return i}(d,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(d=d.replace(this.gridlocalization.percentsymbol,""));for(var g="",w=0;w<d.length;w++)"-"===(b=d.substring(w,w+1))&&(g+="-"),"."===b&&(g+="."),null!=b.match(/^[0-9]+$/)&&(g+=b);d=(d=g).replace(/ /g,""),d=new Number(d),isNaN(d)&&(d="")}this._raiseEvent(17,{rowindex:f,datafield:x.datafield,value:d});var v=this.getrowdata(f);a.push({oldvalue:v[x.datafield],value:d,datafield:x.datafield,row:f}),this.pushToHistory=!0,this.setcellvalue(f,p.displayfield,d,!1),this.pushToHistory=!1,p.displayfield!=p.datafield&&this.logicalclipboardselection&&this.logicalclipboardselection[f]&&null!=(_=this.logicalclipboardselection[f][p.datafield])&&this.setcellvalue(f,p.datafield,_,!1),this._raiseEvent(18,{rowindex:f,datafield:x.datafield,oldvalue:this.getcellvalue(x.rowindex,x.datafield),value:d}),this._applycellselection(f,x.datafield,!0,!1)}}u=0,o[++h]||(h=0)}}else{if(!this._clipboardselection)return;for(v=0;v<this._clipboardselection.length;v++)for(var m=0;m<this._clipboardselection[v].length;m++){p=this.getcolumnat(i+m);if(p&&("_checkboxcolumn"!==p.datafield&&!p.hidden)){var f=this.getrowboundindex(l+v),x=this.getcell(f,p.datafield),d=null;if(null!=(d=this._clipboardselection[v][m])){if(p.cellsformat&&(-1!=p.cellsformat.indexOf("p")||-1!=p.cellsformat.indexOf("c")||-1!=p.cellsformat.indexOf("n")||-1!=p.cellsformat.indexOf("f"))){-1<d.indexOf(this.gridlocalization.currencysymbol)&&(d=d.replace(this.gridlocalization.currencysymbol,"")),-1<(d=(d=function(e,t,l){var i=e;if(t==l)return e;for(var s=i.indexOf(t);-1!=s;)s=(i=i.replace(t,l)).indexOf(t);return i}(d,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(d=d.replace(this.gridlocalization.percentsymbol,""));for(var b,g="",w=0;w<d.length;w++)"-"===(b=d.substring(w,w+1))&&(g+="-"),"."===b&&(g+="."),null!=b.match(/^[0-9]+$/)&&(g+=b);d=(d=g).replace(/ /g,""),d=new Number(d),isNaN(d)&&(d="")}this._raiseEvent(17,{rowindex:f,datafield:x.datafield,value:d});var _,y=this.getrowdata(f);a.push({oldvalue:y[x.datafield],value:d,datafield:x.datafield,row:f}),this.pushToHistory=!0,this.setcellvalue(f,p.displayfield,d,!1),this.pushToHistory=!1,p.displayfield!=p.datafield&&this.logicalclipboardselection&&null!=(_=this.logicalclipboardselection[v][p.datafield])&&this.setcellvalue(f,p.datafield,_,!1),this._raiseEvent(18,{rowindex:f,datafield:x.datafield,oldvalue:this.getcellvalue(x.rowindex,x.datafield),value:d}),this._applycellselection(f,x.datafield,!0,!1)}}}}"checkbox"==this.selectionmode&&this._updatecheckboxselection(),this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)}this._undoRedo.push({action:"paste",data:a}),this._undoRedoIndex=-1,this.clipboardend&&this.clipboardend("paste")},_applyrowselection:function(e,t,l,i,s){if(null==e)return!1;var o=this.selectedrowindex;"singlerow"==this.selectionmode&&(t?this._raiseEvent(2,{rowindex:e,row:this.getrowdata(e)}):this._raiseEvent(3,{rowindex:e,row:this.getrowdata(e)}),this._raiseEvent(3,{rowindex:o}),this.selectedrowindexes=new Array,this.selectedcells=new Array),1==i&&(this.selectedrowindexes=new Array),0<this.dataview.filters.length&&((a=this.getrowdata(e))&&void 0!==a.dataindex?e=a.dataindex:a&&void 0===a.dataindex&&null!=a.uid&&(e=this.getrowboundindexbyid(a.uid)));var a=this.selectedrowindexes.indexOf(e);return t?(this.selectedrowindex=e,-1==a?(this.selectedrowindexes.push(e),"singlerow"!=this.selectionmode&&this._raiseEvent(2,{rowindex:e,row:this.getrowdata(e)})):"multiplerows"==this.selectionmode&&(this.selectedrowindexes.splice(a,1),this._raiseEvent(3,{rowindex:this.selectedrowindex,row:this.getrowdata(e)}),this.selectedrowindex=0<this.selectedrowindexes.length?this.selectedrowindexes[this.selectedrowindexes.length-1]:-1)):(0<=a||"singlerow"==this.selectionmode||"multiplerowsextended"==this.selectionmode||"multiplerowsadvanced"==this.selectionmode)&&(t=this.selectedrowindexes[a],this.selectedrowindexes.splice(a,1),this._raiseEvent(3,{rowindex:t,row:this.getrowdata(e)}),this.selectedrowindex=-1),null!=l&&!l||this._rendervisualrows(),!0},_applycellselection:function(e,t,l,i,s){if(null==e)return!1;if(null==t)return!1;this._autofill&&(this._autofill.remove(),M(document).off("pointermove.autofill"),M(document).off("pointerup.autofill"),this._autofill=null);this.selectedrowindex;"singlecell"==this.selectionmode&&(null!=(o=this.selectedcell)&&this._raiseEvent(16,{rowindex:o.rowindex,datafield:o.datafield}),this.selectedcells=new Array),"multiplecellsextended"!=this.selectionmode&&"multiplecellsadvanced"!=this.selectionmode||null!=(o=this.selectedcell)&&this._raiseEvent(16,{rowindex:o.rowindex,datafield:o.datafield});var o,a=e+"_"+t;0<this.dataview.filters.length&&((o=this.getrowdata(e))&&void 0!==o.dataindex?a=(e=o.dataindex)+"_"+t:o&&void 0===o.dataindex&&o.uid&&(a=(e=this.getrowboundindexbyid(o.uid))+"_"+t));e={rowindex:e,datafield:t};return l?(t=this.selectedcell,this.selectedcell=e,this.selectedcells[a]?"multiplecells"!=this.selectionmode&&"multiplecellsextended"!=this.selectionmode&&"multiplecellsadvanced"!=this.selectionmode||(delete this.selectedcells[a],0<this.selectedcells.length&&this.selectedcells.length--,!1!==s&&this._raiseEvent(16,e)):(this.selectedcells[a]=e,this.selectedcells.length++,l=!0,t&&t.datafield===e.datafield&&e.rowindex===t.rowindex&&(l=!1),l&&!1!==s&&this._raiseEvent(15,e))):(delete this.selectedcells[a],0<this.selectedcells.length&&this.selectedcells.length--,!1!==s&&this._raiseEvent(16,e)),null!=i&&!i||this._rendervisualrows(),!0},_getcellindex:function(e){var t=-1;return M.each(this.selectedcells,function(){if(t++,this[e])return!1}),t},_clearhoverstyle:function(){if(null!=this.hoveredrow&&-1!=this.hoveredrow&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var e=this.table.find(".jqx-grid-cell-hover");0<e.length&&(e.removeClass(this.toTP("jqx-grid-cell-hover")),e.removeClass(this.toTP("jqx-fill-state-hover")));for(var t=0;t<e.length;t++){var l=e[t].getAttribute("columnindex");!l||(l=this.columns.records[parseInt(l)])&&l._applyCellStyle(e[t])}this.hoveredrow=-1}},_clearselectstyle:function(){for(var e=this.table[0].rows.length,t=this.table[0].rows,l=this.toTP("jqx-grid-cell-selected"),i=this.toTP("jqx-fill-state-pressed"),s=this.toTP("jqx-grid-cell-hover"),o=this.toTP("jqx-fill-state-hover"),a=0;a<e;a++)for(var r=t[a],n=r.cells.length,d=r.cells,c=0;c<n;c++){var h=d[c],u=M(h);-1!=h.className.indexOf("jqx-grid-cell-selected")&&(u.removeClass(l),u.removeClass(i)),-1!=h.className.indexOf("jqx-grid-cell-hover")&&(u.removeClass(s),u.removeClass(o));u=h.getAttribute("columnindex");!u||(u=this.columns.records[parseInt(u)])&&u._applyCellStyle(h)}},_selectpath:function(e,t){var l=this._lastClickedCell?Math.min(this._lastClickedCell.row,e):0,i=this._lastClickedCell?Math.max(this._lastClickedCell.row,e):0;if(l<=i){var s=this._getcolumnindex(this._lastClickedCell.column||this._lastClickedCell.datafield),t=this._getcolumnindex(t),o=Math.min(s,t),a=Math.max(s,t);this.selectedcells=new Array;for(var r=this.dataview.loadedrecords,n=l;n<=i;n++)for(var d=o;d<=a;d++){e=r[n];this._applycellselection(this.getboundindex(e),this._getcolumnat(d).datafield,!0,!1),this.getboundindex(e),this._getcolumnat(d).datafield}this._rendervisualrows()}},_selectrowpath:function(e){if("multiplerowsextended"==this.selectionmode){var t=this._lastClickedCell?Math.min(this._lastClickedCell.row,e):0,l=this._lastClickedCell?Math.max(this._lastClickedCell.row,e):0,i=this.dataview.loadedrecords;if(t<=l){this.selectedrowindexes=new Array;for(var s=t;s<=l;s++){var e=i[s],o=this.getrowboundindex(s);this._applyrowselection(o,!0,!1)}this._rendervisualrows()}}},_selectrowwithmouse:function(e,t,l,i,s,o){if(null!=(h=t.row)){var a=t.index;if(null!=this.hittestinfo[a]){for(var r=0;r<this.columns.records.length;r++){var n=this.columns.records[r];n.selected=!1,n.element&&n.element.removeAttribute("selected"),n._applyStyle()}var d=this.hittestinfo[a].visualrow;if(!this.hittestinfo[a].details){d.cells[0].className;if(!h.group){if("multiplerows"==this.selectionmode||"multiplecells"==this.selectionmode||"checkbox"==this.selectionmode||-1!=this.selectionmode.indexOf("multiple")&&(1==o||1==s)){t=this.getboundindex(h);0<this.dataview.filters.length&&((c=this.getrowdata(t))&&null==(t=c.dataindex)&&(t=this.getboundindex(h)));var c=-1!=l.indexOf(t),l=this.getboundindex(h)+"_"+i;if(-1!=this.selectionmode.indexOf("cell")){t=null!=this.selectedcells[l];null!=this.selectedcells[l]&&t?this._selectcellwithstyle(e,!1,a,i,d):this._selectcellwithstyle(e,!0,a,i,d),!o||null!=this._lastClickedCell||(t=this.getselectedcells())&&0<t.length&&(this._lastClickedCell={row:t[0].rowindex,column:t[0].datafield}),o&&this._lastClickedCell&&(this._selectpath(h.visibleindex,i),this.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")&&this.selectionarea.css("visibility","hidden"))}else if(c?s?this._applyrowselection(this.getboundindex(h),!1):this._selectrowwithstyle(e,d,!1,i):this._selectrowwithstyle(e,d,!0,i),!o||null!=this._lastClickedCell||(u=this.getselectedrowindexes())&&0<u.length&&(this._lastClickedCell={row:u[0],column:i}),o&&this._lastClickedCell){this.selectedrowindexes=new Array;for(var h,u=this._lastClickedCell?Math.min(this._lastClickedCell.row,h.visibleindex):0,f=this._lastClickedCell?Math.max(this._lastClickedCell.row,h.visibleindex):0,p=this.dataview.loadedrecords,g=u;g<=f;g++)(h=p[g])&&this._applyrowselection(this.getboundindex(h),!0,!1,!1);this._rendervisualrows()}}else this._clearselectstyle(),this._selectrowwithstyle(e,d,!0,i),-1!=this.selectionmode.indexOf("cell")&&this._selectcellwithstyle(e,!0,a,i,d);o||(this._lastClickedCell={row:h.visibleindex,column:i})}}}}},_selectcellwithstyle:function(e,t,l,i,s){e=M(s.cells[e._getcolumnindex(i)]);e.removeClass(this.toTP("jqx-grid-cell-hover")),e.removeClass(this.toTP("jqx-fill-state-hover")),t?(e.addClass(this.toTP("jqx-grid-cell-selected")),e.addClass(this.toTP("jqx-fill-state-pressed"))):(e.removeClass(this.toTP("jqx-grid-cell-selected")),e.removeClass(this.toTP("jqx-fill-state-pressed"))),this.getcolumn(i)._applyCellStyle(e)},_selectrowwithstyle:function(e,t,l,i){var s=t.cells.length,o=0;e.rowdetails&&e.showrowdetailscolumn?this.rtl?(--s,s-=this.groups.length):o=1+this.groups.length:this.groupable&&(this.rtl?s-=this.groups.length:o=this.groups.length);for(var a=o;a<s;a++){var r,n=t.cells[a];l?(M(n).removeClass(this.toTP("jqx-grid-cell-hover")),M(n).removeClass(this.toTP("jqx-fill-state-hover")),-1==e.selectionmode.indexOf("cell")&&(M(n).addClass(this.toTP("jqx-grid-cell-selected")),M(n).addClass(this.toTP("jqx-fill-state-pressed")))):(M(n).removeClass(this.toTP("jqx-grid-cell-hover")),M(n).removeClass(this.toTP("jqx-grid-cell-selected")),M(n).removeClass(this.toTP("jqx-fill-state-hover")),M(n).removeClass(this.toTP("jqx-fill-state-pressed"))),!(i=n.getAttribute("columnindex"))||(r=this.columns.records[parseInt(i)])&&r._applyCellStyle(n)}},_handlemousemoveselection:function(e,l,t){if(l.hScrollInstance.isScrolling()||l.vScrollInstance.isScrolling())return!1;if(("multiplerowsextended"==l.selectionmode||"multiplecellsextended"==l.selectionmode||"multiplecellsadvanced"==l.selectionmode)&&l.mousecaptured){if(l.multipleselectionbegins)if(!1===l.multipleselectionbegins(e))return!0;var i=this.showheader?this.columnsheader.height()+2:0,s=this._groupsheader()?this.groupsheader.height():0;s+=this.showtoolbar?this.toolbar.height():0,s+=this.showfilterbar?this.toolbarheight:0;var o=this.host.coord();this.hasTransform&&(o=M.jqx.utilities.getOffset(this.host),d=this._getBodyOffset(),o.left-=d.left,o.top-=d.top),"0px"===this.host.css("border-top-width")&&(s-=2);var a=e.pageX,r=e.pageY-s;if(e._pageX&&(a=e._pageX,r=e._pageY-s),3<Math.abs(this.mousecaptureposition.left-a)||3<Math.abs(this.mousecaptureposition.top-r)||l.autofill){parseInt(this.columnsheader.coord().top);this.hasTransform&&M.jqx.utilities.getOffset(this.columnsheader).top,a<o.left&&(a=o.left),a>o.left+this.host.width()&&(a=o.left+this.host.width());var n=o.top+i;r<n&&(r=n+5);var d=parseInt(Math.min(l.mousecaptureposition.left,a)),c=-5+parseInt(Math.min(l.mousecaptureposition.top,r)),i=parseFloat(Math.abs(l.mousecaptureposition.left-a)),h=parseInt(Math.abs(l.mousecaptureposition.top-r));if(d-=o.left,c-=o.top,this.selectionarea.css("visibility","visible"),"multiplecellsadvanced"==l.selectionmode){var u=(a=d)+i,n=l.hScrollInstance,f=n.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(f=n.max-n.value),this.vScrollBar[0].style.visibility);var r=l.table[0].rows[0],p=0,g=C=l.mousecaptureposition.clickedcell,w=!1,n=0,v=r.cells.length;l.mousecaptureposition.left<=e.pageX&&(n=C);for(var m=!1,x=n;x<v;x++){var b=parseFloat(M(this.columnsrow[0].cells[x]).css("left")),_=b-f;if(!l.columns.records[x].pinned||l.columns.records[x].hidden){if(m){w=!0,g--;break}var y=this._getcolumnat(x);if(!(null!=y&&y.hidden||l.groupable&&0<l.groups.length&&x<l.groups.length)){k=_+M(this.columnsrow[0].cells[x]).width();if(l.mousecaptureposition.left>e.pageX){if(a<=k&&_<=a){g=x,w=!0;break}}else if(u<=k&&_<=u){g=x,w=!0;break}}}else{x==C&&(m=!0);var k=b+M(this.columnsrow[0].cells[x]).width();if(l.mousecaptureposition.left>e.pageX){if(a<=k&&_<=a){g=x,w=!0;break}}else if(u<=k&&_<=u){g=x,w=!0;break}}}w||(l.mousecaptureposition.left>e.pageX?M.each(this.columns.records,function(e,t){return!!(l.groupable&&0<l.groups.length&&e<l.groups.length)||(this.pinned||this.hidden?void 0:(g=e,!1))}):(!l.groupable||l.groupable&&0<!l.groups.length)&&(g=r.cells.length-1));var r=C,C=Math.min(C,g),g=Math.max(r,g);c+=5,c+=s;l.table[0].rows.indexOf(l.mousecaptureposition.clickedrow);for(var q=0,j=-1,O=-1,T=0,x=0;x<l.table[0].rows.length;x++){var S=M(l.table[0].rows[x]);0==x&&(T=S.coord().top);var I=S.height(),A=T-o.top;if(-1==j&&c<=A+I){for(var P=!1,E=0;E<l.groups.length;E++)if(-1!=(z=S[0].cells[E].className).indexOf("jqx-grid-group-collapse")||-1!=z.indexOf("jqx-grid-group-expand")){P=!0;break}if(P)continue;j=x}if(T+=I,l.groupable&&0<l.groups.length){for(var z,P=!1,E=0;E<l.groups.length;E++)if(-1!=(z=S[0].cells[E].className).indexOf("jqx-grid-group-collapse")||-1!=z.indexOf("jqx-grid-group-expand")){P=!0;break}if(P)continue;for(var p=0,R=l.groups.length;R<S[0].cells.length;R++){var K=S[0].cells[R];""==M(K).html()&&p++}if(p==S[0].cells.length-l.groups.length)continue}if(-1!=j&&(q+=I),c+h<A+I){O=x;break}}if(-1!=j){c=M(l.table[0].rows[j]).coord().top-o.top-s-2;r=0;this.filterable&&this.showfilterrow&&(r=this.filterrowheight),parseFloat(l.table[0].style.top)<0&&c<this.rowsheight+r&&(c-=parseFloat(l.table[0].style.top),q+=parseFloat(l.table[0].style.top)),h=q;s=M(this.columnsrow[0].cells[C]),r=M(this.columnsrow[0].cells[g]),d=parseFloat(s.css("left")),i=parseFloat(r.css("left"))-parseFloat(d)+r.width()-2;if(d-=f,m&&(d+=f),l.editcell&&l.editable&&l.endcelledit&&(C!=g||j!=O)){if(0==l.editcell.validated)return;l.endcelledit(l.editcell.row,l.editcell.column,!0,!0)}}}this.selectionarea.width(i),this.selectionarea.css("left",d),null!==t&&(this.selectionarea.css("top",c),this.selectionarea.height(h))}}},_handlemouseupselection:function(t,l,e){if(this.selectionarea){if("visible"!=this.selectionarea[0].style.visibility)return l._handlemousemoveselection(t,l),!1!==e&&(l.__firstcell?(a=l.getselectedcell())&&(l.__firstcell.index=l.columns.records.indexOf(l.getcolumn(a.datafield)),l.__firstcell.row=a.row,l.__firstcell.rowindex=a.rowindex,l._handleAutofill(t,l)):(l.__firstcell=l.getselectedcell(),l.__firstcell&&(l.__firstcell.index=l.columns.records.indexOf(l.getcolumn(l.__firstcell.datafield)),l._handleAutofill(t,l)))),l.mousecaptured=!1,l.selectionarea[0].style.visibility="hidden",!0;if(l.mousecaptured&&("multiplerowsextended"==l.selectionmode||"multiplerowsadvanced"==l.selectionmode||"multiplecellsextended"==l.selectionmode||"multiplecellsadvanced"==l.selectionmode)){if(l.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")){this.selectionarea.css("visibility","hidden");var i=this.showheader?this.columnsheader.height()+2:0,s=this._groupsheader()?this.groupsheader.height():0;"0px"===this.host.css("border-top-width")&&(s-=2),s+=this.showtoolbar?this.toolbar.height():0,s+=this.showfilterbar?this.toolbarheight:0;var o=this.selectionarea.coord(),a=this.host.coord();this.hasTransform&&(a=M.jqx.utilities.getOffset(this.host),o=M.jqx.utilities.getOffset(this.selectionarea)),"0px"===this.host.css("border-top-width")&&(s-=2);var r=o.left-a.left,n=o.top-i-a.top-s,d=n,c=r+this.selectionarea.width(),h=r,u=new Array,f=new Array;if("multiplerowsextended"==l.selectionmode){for(;n<d+this.selectionarea.height();){var p=(x=this._hittestrow(r,n)).row;-1!=(C=x.index)&&(f[C]||(f[C]=!0,u[u.length]=x)),n+=20}d=0;M.each(u,function(){var e=this.row;"none"!=l.selectionmode&&l._selectrowwithmouse&&(!t.ctrlKey&&!t.metaKey&&0==d?l._applyrowselection(l.getboundindex(e),!0,!1,!0):l._applyrowselection(l.getboundindex(e),!0,!1,!1),d++)})}else{var g=null,w=null;"multiplecellsadvanced"==l.selectionmode&&(n+=2);var o=l.hScrollInstance,v=o.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(v=o.max-o.value),"hidden"!=this.vScrollBar[0].style.visibility&&(v-=this.scrollbarsize+4));var m=l.table[0].rows[0],i=l.selectionarea.height();!t.ctrlKey&&!t.metaKey&&0<i&&(l.selectedcells=new Array);var x,b=i,_=(parseInt(this.vScrollInstance.value),parseInt(this.hScrollInstance.value)),a=(this._gettableheight(),null!=this._hostwidth?this._hostwidth:this.host.width()),s=this.groupable&&0<this.groups.length?this.groups.length:0,o=this.columns.records.length-s,i=this.groupable&&0<this.groups.length,i=this._getvisualcolumnsindexes(_,a,s,o,i,!0,!0),y=i.start,k=i.end;for(this.__firstcell=null;n<d+b;)if(x=l._hittestrow(r,n)){var p=x.row,C=x.index;if(-1!=C&&!f[C])if(f[C]=!0,this.enableoptimization)for(q=y;q<k;q++){j=(_=parseFloat(l.columnsrow[0].cells[q].style.left)-v)+l.columns.records[q].width;(_<=h&&h<=j||_<=c&&c<=j||h<=_&&_<=c)&&(l._applycellselection(l.getboundindex(p),l._getcolumnat(q).datafield,!0,!1),g={x:r,y:n,rowindex:C,row:l.getboundindex(p),index:q,datafield:l._getcolumnat(q).datafield},l.__lastcell=g,w||(w=g,l.__firstcell=w))}else for(var q=0;q<m.cells.length;q++){var j=(_=parseFloat(M(l.columnsrow[0].cells[q]).css("left"))-v)+M(l.columnsrow[0].cells[q]).width();(_<=h&&h<=j||_<=c&&c<=j||h<=_&&_<=c)&&(l._applycellselection(l.getboundindex(p),l._getcolumnat(q).datafield,!0,!1),g={x:r,y:n,rowindex:C,row:l.getboundindex(p),index:q,datafield:l._getcolumnat(q).datafield},l.__lastcell=g,w||(w=g,l.__firstcell=w))}n+=5}else n+=5}l.autosavestate&&l.savestate&&l.savestate()}l._renderrows(l.virtualsizeinfo),!1!==e&&l._handleAutofill(t,l)}}},_handleAutofill:function(e,a){var t,l,i,r,s,n,d,o,c;this.autofill&&(t=(c=this).showheader?this.columnsheader.height()+2:0,i=this._groupsheader()?this.groupsheader.height():0,"0px"===this.host.css("border-top-width")&&(i-=2),new Array,new Array,i+=this.showtoolbar?this.toolbar.height():0,i+=this.showfilterbar?this.toolbarheight:0,l=this.selectionarea.coord(),o=this.host.coord(),this.hasTransform&&(o=M.jqx.utilities.getOffset(this.host),l=M.jqx.utilities.getOffset(this.selectionarea)),"0px"===this.host.css("border-top-width")&&(i-=2),s=l.left-o.left,o=l.top-t-o.top-i,i=s+this.selectionarea.width(),c.__lastcell,r=c.__firstcell,"multiplecellsadvanced"==a.selectionmode&&(o+=2),o=(s=a.hScrollInstance).value,this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(o=s.max-s.value),"hidden"!=this.vScrollBar[0].style.visibility&&(o-=this.scrollbarsize+4)),a.table[0].rows[0],o=a.selectionarea.height(),n=parseInt(e.pageX),d=parseInt(e.pageY),o=o,(c=a)._autofill&&c._autofill.remove(),r&&!c.getcolumn(r.datafield).autofill||c.autofill&&(c._autofill=document.createElement("div"),c._autofill.style.width="6px",c._autofill.style.height="6px",c._autofill.style.position="absolute",c._autofill.style.top=l.top-c.host.offset().top+o+1+"px",c._autofill.style.left=i+2+"px",c._autofill.style.cursor="crosshair",c._autofill.style.paddingLeft="0px",c._autofill.style.paddingTop="0px",c._autofill.style.paddingRight="0px",c._autofill.style.paddingBottom="0px",c._autofill.style.borderTopLeftRadius="0px",c._autofill.style.borderTopRightRadius="0px",c._autofill.style.borderBottomLeftRadius="0px",c._autofill.style.borderBottomRightRadius="0px",c._autofill.style.background="transparent",M(c._autofill).addClass(c.toThemeProperty("jqx-widget")),M(c._autofill).addClass(c.toThemeProperty("jqx-button")),M(c._autofill).addClass(c.toThemeProperty("primary")),M(c._autofill).addClass(c.toThemeProperty("jqx-fill-state-pressed")),c._autofill.onpointerdown=function(e){c._handlemouseupselection(e,c,!1);var t=e.originalEvent||e;c._autofillDragStart=!0,c.mousecaptured=!0;var l=c.showheader?c.columnsheader.height()+2:0,i=c._groupsheader()?c.groupsheader.height():0;i+=c.showtoolbar?c.toolbarheight:0,i+=c.showfilterbar?c.toolbarheight:0;var s=c.host.coord(),o=n-s.left,e=d-l-s.top-i;if(c.pageable&&!c.autoheight&&c.gotopage&&c.pager.coord().top-s.top-i-l<e)return;l=c._hittestrow(o,e);l&&(l.details||(l.row,l.index,t.target.className,o=c.table[0].rows[r.rowindex],e=M(a.columnsrow[0].cells[r.index]).coord().left,l=M(o).coord().top+1,c.mousecaptured=!0,c.mousecaptureposition={x:e,y:l,left:t.pageX,top:t.pageY,clickedrow:o},c.copyselection(),t.stopPropagation(),t.preventDefault()))},M(document).off("pointermove.autofill"),M(document).off("pointerup.autofill"),M(document).on("pointermove.autofill",function(e){c._autofillDragStart&&(e=e.originalEvent||e,c.mousecaptureposition.position?"y"===c.mousecaptureposition.position?(e._pageX=c.mousecaptureposition.x,e._pageY=e.pageY,c.mousecaptureposition.top=c.mousecaptureposition.y,c._handlemousemoveselection(e,c)):(e._pageX=e.pageX,e._pageY=c.mousecaptureposition.y,c.mousecaptureposition.clickedcell=r.index,c.mousecaptureposition.left=c.mousecaptureposition.x,c._handlemousemoveselection(e,c,null)):5<=Math.abs(c.mousecaptureposition.left-e.pageX)?c.mousecaptureposition.position="x":Math.abs(c.mousecaptureposition.top-e.pageY)&&(c.mousecaptureposition.position="y"))}),M(document).on("pointerup.autofill",function(e){e=e.originalEvent||e;if(!c._autofillDragStart)return c._autofill&&c._autofill.remove(),void c.clearselection();c._handlemouseupselection(e,c),c._autofillDragStart=!1,c.mousecaptureposition=null,c.mousecaptured=!1,c.pasteselection(),c._handlemouseupselection(e,c)}),c.wrapper[0].appendChild(c._autofill)))},selectprevcell:function(e,t){t=this._getcolumnindex(t),this.columns.records.length,t=this._getprevvisiblecolumn(t);null!=t&&(this.clearselection(),this.selectcell(e,t.datafield))},selectnextcell:function(e,t){t=this._getcolumnindex(t),this.columns.records.length,t=this._getnextvisiblecolumn(t);null!=t&&(this.clearselection(),this.selectcell(e,t.datafield))},_getfirstvisiblecolumn:function(){for(var e=this.columns.records.length,t=0;t<e;t++){var l=this.columns.records[t];if(!l.hidden&&null!=l.datafield)return l}return null},_getlastvisiblecolumn:function(){for(var e=this.columns.records.length-1;0<=e;e--){var t=this.columns.records[e];if(!t.hidden&&null!=t.datafield)return t}return null},_handlekeydown:function(f,p){if(p.groupable&&p.groups.length,p.disabled)return!1;if(32===(v=f.charCode||f.keyCode||0)&&(f.metaKey||f.ctrlKey)&&"multiplecellsadvanced"==p.selectionmode){var e=this.getselectedcell();if(f.shiftKey){if(this.clearselection(),this.selectallrows(),this.columns.records.length<30)for(var t,l=0;l<this.columns.records.length;l++)(t=this.columns.records[l]).selectable&&t.toggleSelection(t,f,!0);return void this._renderrows(this.virtualsizeinfo)}e&&(t=this.getcolumn(e.datafield)).selectable&&(this.clearselection(),t.toggleSelection(t,f,!0),this._renderrows(this.virtualsizeinfo))}if(p.editcell&&"multiplecellsadvanced"!=p.selectionmode)return!0;if(p.editcell&&"multiplecellsadvanced"==p.selectionmode){if(!(33<=v&&v<=40))return!0;if(f.altKey)return!(p._cancelkeydown=!1);if(null!=p._cancelkeydown&&0!=p._cancelkeydown)return!(p._cancelkeydown=!1);if("selectedrow"===p.editmode)return!0;if(p.endcelledit(p.editcell.row,p.editcell.column,!1,!0),p._cancelkeydown=!1,p.editcell&&!p.editcell.validated)return p._rendervisualrows(),p.endcelledit(p.editcell.row,p.editcell.column,!1,!0),!1}if("none"==p.selectionmode)return!0;if(p.showfilterrow&&p.filterable&&this.filterrow&&M(f.target).ischildof(p.filterrow))return!0;if(p.showeverpresentrow){if(p.addnewrowtop&&M(f.target).ischildof(p.addnewrowtop))return!0;if(p.addnewrowbottom&&M(f.target).ischildof(p.addnewrowbottom))return!0}if(f.target.className&&0<=f.target.className.indexOf("jqx-grid-widget"))return!0;if(p.pageable&&M(f.target).ischildof(this.pager))return!0;if(this.showtoolbar&&M(f.target).ischildof(this.toolbar))return!0;if(this.showfilterbar&&M(f.target).ischildof(this.filterbar))return!0;if(this.showstatusbar&&M(f.target).ischildof(this.statusbar))return!0;var g=!1;if(f.altKey)return!0;if((f.ctrlKey||f.metaKey)&&this.clipboard){var i,s=String.fromCharCode(v).toLowerCase();if("z"===s&&this._undoRedo){if(-1===this._undoRedoIndex&&(this._undoRedoIndex=this._undoRedo.length-1),i=this._undoRedo[this._undoRedoIndex])if("setcellvalue"===i.action)this.setcellvalue(i.data.row,i.data.datafield,i.data.oldvalue),this.clearselection(),this.selectcell(i.data.row,i.data.datafield),this.ensurecellvisible(i.data.row,i.data.datafield);else if("paste"===i.action){if(this.clearselection(),i.data)for(l=0;l<i.data.length;l++){var o=i.data[l];this.setcellvalue(o.row,o.datafield,o.oldvalue),this._applycellselection(o.row,o.datafield,!0,!1),0===l&&this.ensurecellvisible(o.row,o.datafield)}this._rendervisualrows()}0<this._undoRedoIndex&&this._undoRedoIndex--}if("y"===s&&this._undoRedo){if(-1===this._undoRedoIndex&&(this._undoRedoIndex=this._undoRedo.length-1),i=this._undoRedo[this._undoRedoIndex])if("setcellvalue"===i.action)this.setcellvalue(i.data.row,i.data.datafield,i.data.value),this.clearselection(),this.selectcell(i.data.row,i.data.datafield),this.ensurecellvisible(i.data.row,i.data.datafield);else if("paste"===i.action){this.clearselection();for(l=0;l<i.data.length;l++){o=i.data[l];this.setcellvalue(o.row,o.datafield,o.value),this._applycellselection(o.row,o.datafield,!0,!1),0===l&&this.ensurecellvisible(o.row,o.datafield)}this._rendervisualrows()}this._undoRedoIndex<this._undoRedo.length-1&&this._undoRedoIndex++}if("d"===s&&(this.copyselection(),this._clipboardselection[0],this._clipboardselection=[this._clipboardselection[0]],this.pasteselection(),f.preventDefault(),f.stopPropagation()),this.clipboardbegin){var a=null;if("c"==s?a=this.clipboardbegin("copy",this.copyselection()):"x"==s?a=this.clipboardbegin("cut",this.copyselection()):"v"==s&&(a=this.clipboardbegin("paste")),!1===a)return!1}if("c"==s||"x"==s){var r,n=this.copyselection();if("c"==s&&this.clipboardend&&this.clipboardend("copy"),"x"==s&&this.clipboardend&&this.clipboardend("cut"),window.clipboardData?window.clipboardData.setData("Text",n):((r=M('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>')).val(n),M("body").append(r),r.select(),setTimeout(function(){document.designMode="off",r.select(),r.remove(),p.focus()},100)),"c"==s&&M.jqx.browser.msie)return!1;if("c"==s)return!0}else if("v"==s){if(document.activeElement&&"INPUT"===document.activeElement.nodeName)return!0;var d=M('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');M("body").append(d),d.select();var c=this;return setTimeout(function(){c._clipboardselection=new Array;var e=d.val();0==e.length&&window.clipboardData&&(d.val(window.clipboardData.getData("Text")),e=d.val());for(var t,l=e.split("\n"),i=0;i<l.length;i++)0<l[i].split("\t").length&&(1==(t=l[i].split("\t")).length&&i==l.length-1&&""==t[0]||0<t.length&&c._clipboardselection.push(t));c.pasteselection(),d.remove(),c.focus()},100),!0}if("x"==s)return this.deleteselection(),this.host.focus(),!1}var a=Math.round(p._gettableheight()),n=Math.round(a/p.rowsheight),h=p.getdatainformation();switch(p.selectionmode){case"singlecell":case"multiplecells":case"multiplecellsextended":case"multiplecellsadvanced":if(null===(e=p.getselectedcell())&&p.selectcell(0,p.columns.records[0].displayfield),null!=e){function u(e,t,h,u){var l=function(e,t){var l,i=p.dataview.loadedrecords[e];if(p.groupable&&0<p.groups.length){var s=e;"up"==u&&s++,"down"==u&&s--;for(var i=p.getdisplayrows()[s],o=1,a=!0;a&&o<300&&(a=!1,"down"==u?i=p.getdisplayrows()[s+o]:"up"==u&&(i=p.getdisplayrows()[s-o]),i);){i&&i.group&&(a=!0),i&&i.totalsrow&&(a=!0);for(var r=i.parentItem;r;)!r||(l=r).group&&p.expandedgroups[l.uniqueid]&&p.expandedgroups[l.uniqueid].expanded||(a=!0),r=r.parentItem;if(!a)break;o++}if(300==o&&(i=null),p.pageable){var n=!1;if(i){for(var d=0;d<p.dataview.rows.length;d++)p.dataview.rows[d].boundindex==i.boundindex&&(n=!0);n||(i=null)}}}else if(p.pageable){n=!1;if(i){for(d=0;d<p.dataview.rows.length;d++)p.dataview.rows[d].boundindex==i.boundindex&&(n=!0);n||(p.pagerpageinput&&9===f.keyCode&&i.boundindex>p.dataview.rows[p.dataview.rows.length-1].boundindex&&(p.pagerpageinput.focus(),f.preventDefault()),p.ensurerowvisible(i))}}if(null==i||null==t||i.totalsrow)return!1;!h&&null!=h||p.clearselection();var c=p.getboundindex(i);return p.selectcell(c,t),p._oldselectedcell=p.selectedcell,g=!0,p.groupable?p.ensurecellvisible(c,t):p.ensurecellvisible(e,t),!0};l(e,t)||p.groupable||(p.ensurecellvisible(e,t),l(e,t),p.virtualmode&&p.host.focus()),p.groupable&&0<p.groups.length||(f.shiftKey&&9!=f.keyCode?"multiplecellsextended"!=p.selectionmode&&"multiplecellsadvanced"!=p.selectionmode||p._lastClickedCell&&(p._selectpath(e,t),l=p.dataview.loadedrecords[e],l=p.getboundindex(l),p.selectedcell={rowindex:l,datafield:t}):f.shiftKey||(p._lastClickedCell={row:e,column:t}))}var w,v,m,x=this.getrowvisibleindex(e.rowindex),b=e.datafield,s=p._getcolumnindex(b),_=(p.columns.records.length,f.shiftKey&&"singlecell"!=p.selectionmode&&"multiplecells"!=p.selectionmode),y=function(){var e;p.pageable?(e=p.dataview.pagenum*p.dataview.pagesize,u(e,b,!_)):u(0,b,!_)},k=function(){var e=h.rowscount-1;p.pageable&&(e=p.dataview.pagenum*p.dataview.pagesize+p.dataview.rows.length-1),u(e,b,!_)},a=9==v&&!f.shiftKey,e=9==v&&f.shiftKey;if(p.rtl&&(j=a,a=e,e=j),(a||e)&&(_=!1),(a||e)&&document.activeElement&&document.activeElement.className&&0<=document.activeElement.className.indexOf("jqx-grid-cell-add-new-row"))return!0;(j=f.ctrlKey||f.metaKey)&&37==v?null!=(m=p._getfirstvisiblecolumn(s))&&u(x,m.datafield):j&&39==v?null!=(w=p._getlastvisiblecolumn(s))&&u(x,w.datafield):39==v||a?null!=(w=p._getnextvisiblecolumn(s))?u(x,w.datafield,!_):a?(a=p._getfirstvisiblecolumn(),v=40,b=a.displayfield):g=!0:37==v||e?null!=(m=p._getprevvisiblecolumn(s))?u(x,m.datafield,!_):e?(e=p._getlastvisiblecolumn(),v=38,b=e.displayfield):g=!0:36==v?y():35==v?k():33==v?0<=x-n?(u(q=x-n,b,!_),p.pageable&&p.virtualmode&&(p.gotoprevpage(),setTimeout(function(){u(q,b,!_)},25))):y():34==v&&(h.rowscount>x+n?(u(q=x+n,b,!_),p.pageable&&p.virtualmode&&(p.gotonextpage(),setTimeout(function(){u(q,b,!_)},25))):k()),38==v&&(j?y():0<x?u(x-1,b,!_,"up"):g=!1),40==v&&(j?k():h.rowscount>x+1||p.groupable&&0<p.groups.length?u(x+1,b,!_,"down"):g=!0)}break;case"singlerow":case"multiplerows":case"multiplerowsextended":case"multiplerowsadvanced":if(null==(x=p.getselectedrowindex())||-1==x)return!0;x=this.getrowvisibleindex(x);function C(e,c,h){function t(e){var t,l=p.dataview.loadedrecords[e];if(p.groupable&&0<p.groups.length){"up"==h&&e++,"down"==h&&e--;for(var l=p.getdisplayrows()[e],i=1,s=!0;s&&i<300&&(s=!1,"down"==h?l=p.getdisplayrows()[e+i]:"up"==h&&(l=p.getdisplayrows()[e-i]),l);){l&&l.group&&(s=!0),l&&l.totalsrow&&(s=!0);for(var o=l.parentItem;o;)!o||(t=o).group&&p.expandedgroups[t.uniqueid]&&p.expandedgroups[t.uniqueid].expanded||(s=!0),o=o.parentItem;if(!s)break;i++}if(300==i&&(l=null),p.pageable){var a=!1;if(l){for(var r=0;r<p.dataview.rows.length;r++)p.dataview.rows[r].boundindex==l.boundindex&&(a=!0);a||(l=null)}}}if(null!=l){var n=p.getboundindex(l),d=p.selectedrowindex;return!c&&null!=c||p.clearselection(),p.selectedrowindex=d,p.selectrow(n,!1),(p.groupable?p.ensurerowvisible(n):p.ensurerowvisible(e))&&!p.autoheight&&!p.groupable||p._rendervisualrows(),g=!0}}t(e)||p.groupable||(p.ensurerowvisible(e),t(e),p.virtualmode&&setTimeout(function(){t(e)},25),p.virtualmode&&p.host.focus()),p.groupable&&0<p.groups.length||(f.shiftKey&&9!=v?"multiplerowsextended"==p.selectionmode&&p._lastClickedCell&&(p._selectrowpath(e),p.selectedrowindex=p.getrowboundindex(e)):f.shiftKey||(p._lastClickedCell={row:e},p.selectedrowindex=p.getrowboundindex(e)))}var q,_=f.shiftKey&&"singlerow"!=p.selectionmode&&"multiplerows"!=p.selectionmode,y=function(){var e;p.pageable?(e=p.dataview.pagenum*p.dataview.pagesize,C(e,!_)):C(0,!_)},k=function(){var e=h.rowscount-1;p.pageable&&(e=p.dataview.pagenum*p.dataview.pagesize+p.dataview.rows.length-1),C(e,!_)},j=f.ctrlKey||f.metaKey;36==v||j&&38==v?y():35==v||j&&40==v?k():33==v?0<=x-n?(C(q=x-n,!_,"up"),p.pageable&&p.virtualmode&&(p.gotoprevpage(),setTimeout(function(){C(q,!_)},25))):y():34==v?h.rowscount>x+n?(C(q=x+n,!_,"down"),p.pageable&&p.virtualmode&&(p.gotonextpage(),setTimeout(function(){C(q,!_)},25))):k():38==v?0<x?C(x-1,!_,"up"):g=!0:40==v&&(h.rowscount>x+1||p.groupable&&0<p.groups.length?C(x+1,!_,"down"):g=!0)}return!g||(p.autosavestate&&p.savestate&&p.savestate(),!1)},_handlemousemove:function(e,t){var l,i;if(!t.vScrollInstance.isScrolling()&&(!t.hScrollInstance.isScrolling()&&(!t.enablehover&&"multiplerows"!=t.selectionmode||(a=this.showheader?this.columnsheader.height()+2:0,o=this._groupsheader()?this.groupsheader.height():0,o+=this.showtoolbar?this.toolbarheight:0,o+=this.showfilterbar?this.toolbarheight:0,s=this.host.coord(),this.hasTransform&&(s=M.jqx.utilities.getOffset(this.host),i=this._getBodyOffset(),s.left-=i.left,s.top-=i.top),l=e.pageX-s.left,a=e.pageY-a-s.top-o),"multiplerowsextended"!=t.selectionmode&&"multiplecellsextended"!=t.selectionmode&&"multiplecellsadvanced"!=t.selectionmode||1!=t.mousecaptured))){if(!t.enablehover)return!0;if(!t.disabled&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var s=this._hittestrow(l,a);if(s){var o=s.row,a=s.index;if((-1==this.hoveredrow||-1==a||this.hoveredrow!=a||-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode)&&(this._clearhoverstyle(),-1!=a&&null!=o)){var r=this.hittestinfo[a].visualrow;if(null!=r&&!(this.hittestinfo[a].details||e.clientX>M(r).width()+M(r).coord().left)){var s=0,n=r.cells.length;if(t.rowdetails&&t.showrowdetailscolumn?this.rtl?(--n,n-=this.groups.length):s=1+this.groups.length:this.groupable&&(this.rtl?n-=this.groups.length:s=this.groups.length),0!=r.cells.length){t=r.cells[s].className;if(!(o.group||0<=this.selectionmode.indexOf("row")&&-1!=t.indexOf("jqx-grid-cell-selected")))if(this.hoveredrow=a,-1==this.selectionmode.indexOf("cell")&&"checkbox"!=this.selectionmode)for(h=s;h<n;h++){f=r.cells[h];M(f).addClass(this.toTP("jqx-grid-cell-hover")),M(f).addClass(this.toTP("jqx-fill-state-hover")),this.cellhover&&this.cellhover(f,e.pageX,e.pageY),(p=this._getcolumnat(h))._applyCellStyle(f)}else{var d=-1,t=this.hScrollInstance,c=t.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(c=t.max-t.value);for(var h=s;h<n;h++){var u=parseInt(this.columnsrow[0].cells[h].style.left)-c;if(this.columns.records[h].pinned&&!this.rtl&&(u=parseInt(this.columnsrow[0].cells[h].style.left)),l<=u+this.columns.records[h].width&&u<=l){d=h;break}}if(-1!=d){var f=r.cells[d];if(this.cellhover&&this.cellhover(f,e.pageX,e.pageY),-1==f.className.indexOf("jqx-grid-cell-selected")&&this.editcell){var p=this._getcolumnat(d);if(p&&this.editcell.row==a&&this.editcell.column==p.datafield)return}M(f).addClass(this.toTP("jqx-grid-cell-hover")),M(f).addClass(this.toTP("jqx-fill-state-hover")),(p=this._getcolumnat(d))._applyCellStyle(f)}}}}}}}}}})}(jqxBaseFramework);