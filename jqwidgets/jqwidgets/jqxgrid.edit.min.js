!function(S){S.extend(S.jqx._jqxGrid.prototype,{_handledblclick:function(e,t){if(null!=e.target&&!(t.disabled||S(e.target).ischildof(this.columnsheader)||(e.which?o=3==e.which:e.button&&(o=2==e.button),o||(e.which?d=2==e.which:e.button&&(d=1==e.button),d)))){var i=this.showheader?this.columnsheader.height()+2:0,l=this._groupsheader()?this.groupsheader.height():0;l+=this.showtoolbar?this.toolbarheight:0,l+=this.showfilterbar?this.toolbarheight:0;var o=this.host.offset(),s=e.pageX-o.left,d=e.pageY-i-o.top-l,i=this._hittestrow(s,d);if(i){var o=i.row,d=i.index,i=e.target.className,a=this.table[0].rows[d];if(null!=a){t.mousecaptured=!0,t.mousecaptureposition={left:e.pageX,top:e.pageY-l};for(var r=this.hScrollInstance.value,n=0,c=(this.groupable&&this.groups.length,0);c<a.cells.length;c++){var h=parseInt(S(this.columnsrow[0].cells[c]).css("left")),u=h-r;t.columns.records[c].pinned&&(u=h);var p=this._getcolumnat(c);if(null==p||!p.hidden)if(s<=u+S(this.columnsrow[0].cells[c]).width()&&u<=s){n=c;break}}null!=o&&(p=this._getcolumnat(n),-1==i.indexOf("jqx-grid-group-expand")&&-1==i.indexOf("jqx-grid-group-collapse")&&-1!=o.boundindex&&t.begincelledit(t.getboundindex(o),p.datafield,p.defaulteditorvalue))}}}},_getpreveditablecolumn:function(e){for(;0<e;){e--;var t=this.getcolumnat(e);if(!t)return null;if(t.editable&&!t.hidden)return t}return null},_getnexteditablecolumn:function(e){for(;e<this.columns.records.length;){e++;var t=this.getcolumnat(e);if(!t)return null;if(t.editable&&!t.hidden)return t}return null},_handleeditkeydown:function(e,t){if(t.handlekeyboardnavigation&&1==t.handlekeyboardnavigation(e))return!0;var i=e.charCode||e.keyCode||0;if(t.editEvent=e,t.showfilterrow&&t.filterable&&this.filterrow&&S(e.target).ischildof(this.filterrow))return!0;if(e.target.className&&0<=e.target.className.indexOf("jqx-grid-widget"))return!0;if(t.pageable&&S(e.target).ischildof(this.pager))return!0;if(this.showtoolbar&&S(e.target).ischildof(this.toolbar))return!0;if(this.showeverpresentrow){if(this.addnewrowtop&&S(e.target).ischildof(this.addnewrowtop))return!0;if(this.addnewrowbottom&&S(e.target).ischildof(this.addnewrowbottom))return!0}if(this.showstatusbar&&S(e.target).ischildof(this.statusbar))return!0;if(this.rowdetails&&S(e.target).ischildof(this.content.find("[role='rowgroup']")))return!0;if(this.editcell){if("selectedrow"===this.editmode){if(13===i)return this.endrowedit(this.editcell.row,!1),!1;if(27===i)return this.endrowedit(this.editcell.row,!0),!1;if(32==i)if(this._currentColumn&&"checkbox"==this.getcolumn(this._currentColumn).columntype)if((h=this.getcolumn(this._currentColumn)).editable){var l=!this.getcellvalue(this.editcell.row,h.datafield),o=this.getrowdata(this.editcell.row),s=this.editcell.row,o=t.getrowdata(t.editcell.row);this.pushToHistory=!0,this.setcellvalue(this.editcell.row,h.datafield,l,!1),this.pushToHistory=!1;var d,a=this._focusedColumn,r=this._currentColumn,n=this._currentEditableColumn;return this.endrowedit(this.editcell.row,!1),this.beginrowedit(s,!1),this._currentColumn=r,this._focusedColumn=a,this._currentEditableColumn=n,this._renderrows(),this.selectcell(s,h.datafield),this._oldselectedcell=this.selectedcell,a&&(d=this,setTimeout(function(){d.selectcell(s,h.datafield),d._oldselectedcell=d.selectedcell,S(d._checkboxCells[h.datafield].checkbox).jqxCheckBox("focus")},25)),!1}if(9!==i)return!0;var c=this.editcell.datafield,n=this._getcolumnindex(c);this._currentEditableColumn?n=this._currentEditableColumn:this._currentEditableColumn=n;var h=this._getnexteditablecolumn(n);if((e.shiftKey||this.rtl)&&(h=this._getpreveditablecolumn(n)),h){n=this._getcolumnindex(h.datafield);if(this.editcell[h.datafield])this._currentEditableColumn=n,(p=this.editcell[h.datafield].editor)&&(p.data().jqxWidget&&p.data().jqxWidget.focus?p.data().jqxWidget.focus():(p.focus(),p[0].onkeyup=function(){0!=t.gridcontent[0].scrollTop&&(t.scrolltop(Math.abs(t.gridcontent[0].scrollTop)),t.gridcontent[0].scrollTop=0),0!=t.gridcontent[0].scrollLeft&&(t.gridcontent[0].scrollLeft=0)})),this._focusedColumn=h.datafield,this._currentColumn=h.datafield,0!=this.gridcontent[0].scrollTop&&(this.scrolltop(Math.abs(this.gridcontent[0].scrollTop)),this.gridcontent[0].scrollTop=0),0!=this.gridcontent[0].scrollLeft&&(this.gridcontent[0].scrollLeft=0);else if("checkbox"==h.columntype)return this._currentColumn=h.datafield,this._currentEditableColumn=n,this.selectcell(this.editcell.row,h.datafield),this._oldselectedcell=this.selectedcell,this._checkboxCells[h.datafield]&&S(this._checkboxCells[h.datafield].checkbox).jqxCheckBox("focus"),!1}return!1}if(null==this.editcell.columntype||"textbox"==this.editcell.columntype||"numberinput"==this.editcell.columntype||"combobox"==this.editcell.columntype||"datetimeinput"==this.editcell.columntype?33<=i&&i<=40&&"multiplecellsadvanced"==t.selectionmode&&(p="textbox"==this.editcell.columntype||null==this.editcell.columntype?this.editcell.editor:this.editcell.editor.find("input"),m=t._selection(p),w=p.val().length,0<m.length&&"datetimeinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),0<m.start&&37==i&&(t._cancelkeydown=!0),m.start<w&&39==i&&"datetimeinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),"datetimeinput"==this.editcell.columntype&&39==i&&m.start+m.length<w&&(t._cancelkeydown=!0)):"dropdownlist"==this.editcell.columntype?(37==i||39==i&&"multiplecellsadvanced"==t.selectionmode)&&(t._cancelkeydown=!1):"multiplecellsadvanced"==this.selectionmode&&"textbox"!=this.editcell.columntype&&"numberinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),32==i)if("checkbox"==t.editcell.columntype)if((h=t.getcolumn(t.editcell.datafield)).editable){l=!t.getcellvalue(t.editcell.row,t.editcell.column);if(h.cellbeginedit)if(0==h.cellbeginedit(t.editcell.row,h.datafield,h.columntype,!l))return!1;o=t.getrowdata(t.editcell.row);return t.pushToHistory=!0,t.setcellvalue(t.editcell.row,t.editcell.column,l,!0),t.pushToHistory=!1,t._raiseEvent(18,{rowindex:t.editcell.row,row:o,datafield:t.editcell.column,oldvalue:!l,value:l,columntype:"checkbox"}),!1}if(9==i){var u=this.editcell.row,a=c=this.editcell.column,n=t._getcolumnindex(c),p=!1,f=t.getrowvisibleindex(u),m=u;this.editchar="";var v,x,w=this.editcell.validated;if(this.editcell.validated||(w=this.endcelledit(this.editcell.row,this.editcell.column,!1,!0,!1)),0!=w){if(e.shiftKey||this.rtl?(h=t._getpreveditablecolumn(n))?(c=h.datafield,p=!0,-1!=t.selectionmode.indexOf("cell")&&(t.selectprevcell(u,a),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,c)},10))):(x=t._getlastvisiblecolumn(),p=!0,c=x.displayfield,(v=t.getdisplayrows()[f-1])&&(void 0===(u=v.dataindex)&&(u=v.boundindex),f=t.getrowvisibleindex(u)),x=!0,t.pageable&&(g=Math.floor(f/this.pagesize),this.dataview.pagenum!=g&&(x=!1)),x&&-1!=t.selectionmode.indexOf("cell")&&(t.clearselection(),t.selectcell(u,c),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,c)},10))):(h=t._getnexteditablecolumn(n))?(c=h.datafield,p=!0,-1!=t.selectionmode.indexOf("cell")&&(t.selectnextcell(u,a),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,c)},10))):(n=t._getfirstvisiblecolumn(),p=!0,c=n.displayfield,(v=t.getdisplayrows()[f+1])&&(void 0===(u=v.dataindex)&&(u=v.boundindex),f=t.getrowvisibleindex(u)),x=!0,t.pageable&&(g=Math.floor(f/this.pagesize),this.dataview.pagenum!=g&&(x=!1)),-1!=t.selectionmode.indexOf("cell")&&x&&(t.clearselection(),t.selectcell(u,c),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,c)},10))),!p)return null!=this.editcell&&(t.endcelledit(u,c,!1),this._renderrows(this.virtualsizeinfo)),!0;if(t.pageable){var g=Math.floor(f/this.pagesize);if(this.dataview.pagenum!=g)return this._renderrows(this.virtualsizeinfo),-1!=t.selectionmode.indexOf("cell")&&(t.clearselection(),t.selectcell(m,a),t._oldselectedcell=t.selectedcell),void(g>this.dataview.pagenum&&setTimeout(function(){t.pagerpageinput.focus()},25))}t.begincelledit(u,c),null!=this.editcell&&"checkbox"==this.editcell.columntype&&this._renderrows(this.virtualsizeinfo)}return!1}if(13==i){var b,g=this.selectedcell;return g&&(b=this.getrowvisibleindex(g.rowindex)),this.endcelledit(this.editcell.row,this.editcell.column,!1,!0),"multiplecellsadvanced"==this.selectionmode&&null!=(k=t.getselectedcell())&&t.selectcell&&null==this.editcell&&k.rowindex+1<this.dataview.totalrecords&&(this.sortcolumn!=k.datafield?(f=this.getrowvisibleindex(k.rowindex),(q=this.dataview.loadedrecords[f+1])&&(!this.pageable||this.pageable&&f+1<(this.dataview.pagenum+1)*this.pagesize)&&(this.clearselection(!1),this.selectcell(this.getboundindex(q),k.datafield),k=this.getselectedcell(),this.ensurecellvisible(q.visibleindex,k.datafield))):null==g||(y=this.dataview.loadedrecords[b+1])&&(!this.pageable||this.pageable&&b+1<this.pagesize?(this.clearselection(!1),this.selectcell(this.getboundindex(y),k.datafield)):this.pageable&&b+1>=this.pagesize&&(this.clearselection(!1),y=this.dataview.loadedrecords[b],this.selectcell(this.getboundindex(y),k.datafield)))),!1}if(27==i)return this.endcelledit(this.editcell.row,this.editcell.column,!0,!0),!1}else{var y=113==i?!0:!1;if(!e.ctrlKey&&!e.altKey&&!e.metaKey){48<=i&&i<=57&&(this.editchar=String.fromCharCode(i),y=!0),189===i&&(y=!0),65<=i&&i<=90?(this.editchar=String.fromCharCode(i),_=!1,e.shiftKey?_=e.shiftKey:e.modifiers&&(_=!!(4&e.modifiers)),this._capsLock&&(_=!_),_||(this.editchar=this.editchar.toLowerCase()),y=!0):96<=i&&i<=105&&(this.editchar=i-96,this.editchar=this.editchar.toString(),y=!0);var _=S(".jqx-grid").length,y=y&&(1==_||1<_&&t.focused),_=S.data(document.body,"jqxgrid.edit");if(void 0!==_&&""!==_&&(13===i||y)&&_!=t.element.id)return!0}if((13==i||y)&&t.getselectedrowindex){var q,u=t.getselectedrowindex();if("selectedrow"===t.editmode){if(!(0<=u))return null!=(k=t.getselectedcell())&&(h=t._getcolumnbydatafield(k.datafield),t.beginrowedit(k.rowindex)),!1;t.beginrowedit(u)}switch(t.selectionmode){case"singlerow":case"multiplerows":case"multiplerowsextended":if(0<=u){for(var c="",j=0;j<t.columns.records.length;j++)if((h=t.getcolumnat(j)).editable){c=h.datafield;break}"selectedrow"===t.editmode?t.beginrowedit(u):t.begincelledit(u,c)}break;case"singlecell":case"multiplecells":case"multiplecellsextended":null!=(k=t.getselectedcell())&&(h=t._getcolumnbydatafield(k.datafield),"selectedrow"===t.editmode?t.beginrowedit(k.rowindex):"checkbox"!=h.columntype&&t.begincelledit(k.rowindex,k.datafield));break;case"multiplecellsadvanced":null!=(k=t.getselectedcell())&&(13==i?t.selectcell&&(f=this.getrowvisibleindex(k.rowindex))+1<t.dataview.totalrecords&&(q=this.dataview.loadedrecords[f+1])&&(this.clearselection(!1),this.selectcell(this.getboundindex(q),k.datafield),k=this.getselectedcell(),this.ensurecellvisible(q.visibleindex,k.datafield)):"selectedrow"!==t.editmode&&t.begincelledit(k.rowindex,k.datafield,null,!1))}return!1}if(46==i){var I=t.getselectedcells();if(-1==t.selectionmode.indexOf("cell")&&t._getcellsforcopypaste&&(I=t._getcellsforcopypaste()),null!=I&&0<I.length){for(var D=0;D<I.length;D++)if((k=I[D]).datafield){var h=t.getcolumn(k.datafield),T=t.getcellvalue(k.rowindex,k.datafield);if(""!==T&&h.editable&&t.enablekeyboarddelete){var C=null;if("checkbox"==h.columntype&&(h.threestatecheckbox||(C=!1)),h.cellbeginedit)if(0==h.cellbeginedit(k.rowindex,h.datafield,h.columntype,C))return!1;o=t.getrowdata(k.rowindex);t._raiseEvent(17,{rowindex:k.rowindex,row:o,datafield:k.datafield,value:T}),t.pushToHistory=!0,D==I.length-1?t.setcellvalue(k.rowindex,k.datafield,C,!0):t.setcellvalue(k.rowindex,k.datafield,C,!1),h.displayfield!=h.datafield&&t.setcellvalue(k.rowindex,h.displayfield,C,!0),t.pushToHistory=!1,h.cellendedit&&h.cellendedit(k.rowindex,h.datafield,h.columntype,C),t._raiseEvent(18,{rowindex:k.rowindex,row:o,datafield:k.datafield,oldvalue:T,value:C})}}return this.dataview.updateview(),this._renderrows(this.virtualsizeinfo),!1}}if(32==i){var k=t.getselectedcell();if(null!=k)if("checkbox"==(h=t.getcolumn(k.datafield)).columntype&&h.editable){l=!t.getcellvalue(k.rowindex,k.datafield);if(h.cellbeginedit)if(0==h.cellbeginedit(k.rowindex,h.datafield,h.columntype,!l))return!1;o=t.getrowdata(k.rowindex);return t._raiseEvent(17,{rowindex:k.rowindex,row:o,datafield:k.datafield,value:!l,columntype:"checkbox"}),t.pushToHistory=!0,t.setcellvalue(k.rowindex,k.datafield,l,!0),t.pushToHistory=!1,t._raiseEvent(18,{rowindex:k.rowindex,row:o,datafield:k.datafield,oldvalue:!l,value:l,columntype:"checkbox"}),!1}}}return!0},begincelledit:function(e,t,i,l,o){var s=this.getcolumn(t);if(this._cellscache=new Array,null!=t&&"number"!=s.columntype&&"button"!=s.columntype&&!s.createwidget){if(this.groupable){if(0<=this.groups.indexOf(t))return;if(0<=this.groups.indexOf(s.displayfield))return}if(null==this.editrow){if(this.editcell){if(this.editcell.row==e&&this.editcell.column==t)return!0;if("selectedrow"===this.editmode&&this.editcell.row==e)return;if(0==this.endcelledit(this.editcell.row,this.editcell.column,!1,!0,!1))return}var d="checkbox"==s.columntype||"button"==s.columntype||s.createwidget;if(this.host.removeClass("jqx-disableselect"),this.content.removeClass("jqx-disableselect"),s.editable){if(s.cellbeginedit){var a=this.getcell(e,t);if(0==s.cellbeginedit(e,t,s.columntype,null!=a?a.value:null))return}a=this.getrowvisibleindex(e);if(this.editcell=this.getcell(e,t),this.editcell)if(this.editcell.visiblerowindex=a,!this.editcell.editing)if(d||(this.editcell.editing=!0),this.editcell.columntype=s.columntype,this.editcell.defaultvalue=i,null!=s.defaultvalue&&(this.editcell.defaultvalue=s.defaultvalue),this.editcell.init=!0,"checkbox"!=s.columntype&&"selectedrow"!=this.editmode&&(i=this.getrowdata(e),this._raiseEvent(17,{rowindex:e,row:i,datafield:s.datafield,value:this.editcell.value,columntype:s.columntype})),S.data(document.body,"jqxgrid.edit",this.element.id),d||(e=this.getrowvisibleindex(e),!1!==l&&(this.autorowheight||0!==this.groups.length||this.ensurecellvisible(e,s.datafield)),!1!==o&&this._renderrows(this.virtualsizeinfo)),this.editcell)return!(this.editcell.init=!1)}else this.editcell?(this.editchar="",this.editcell.editor=null,(this.editcell.editing=!1)!==o&&this._renderrows(this.virtualsizeinfo),this.editcell=null):this.editchar=""}}},getScrollTop:function(){if(this._py)return this._py;if(this._py="undefined"!=typeof pageYOffset,this._py)return pageYOffset;var e=document.body,t=document.documentElement;return(t=t.clientHeight?t:e).scrollTop},getScrollLeft:function(){if("undefined"!=typeof pageXOffset)return pageXOffset;var e=document.body,t=document.documentElement;return(t=t.clientHeight?t:e).scrollLeft},endcelledit:function(i,l,e,o,s){if(null!=i&&null!=l||(this.editcell&&(i=this.editcell.row,l=this.editcell.column),null==e&&(e=!0)),this.editcell){var d=this.getcolumn(l),a=this;if("selectedrow"!==a.editmode){function r(){if(0!=s&&!a.isTouchDevice()&&!a.isNestedGrid){var e=a.getScrollTop(),t=a.getScrollLeft();try{a.element.focus(),a.content.focus(),e!=a.getScrollTop()&&window.scrollTo(t,e),setTimeout(function(){a.element.focus(),a.content.focus(),e!=a.getScrollTop()&&window.scrollTo(t,e)},10)}catch(e){}}}if("checkbox"==d.columntype||"button"==d.columntype||d.createwidget)return this.editcell&&(this.editcell.editor=null,this.editcell.editing=!1,this.editcell=null),!0;function t(e){e._hidecelleditor(),d.cellendedit&&d.cellendedit(i,l,d.columntype,e.editcell.value,c),e.editchar=null,d.displayfield!=d.datafield&&(t=e.getcellvalue(e.editcell.row,d.displayfield)),e.editcell.value;var t=e.getrowdata(i);e._raiseEvent(18,{rowindex:i,row:t,datafield:l,displayfield:d.displayfield,oldvalue:c,value:c,columntype:d.columntype}),e.editcell.editor=null,e.editcell.editing=!1,e.editcell=null,!o&&null!=o||e._renderrows(e.virtualsizeinfo),r(),e.enablebrowserselection||(e.host.addClass("jqx-disableselect"),e.content.addClass("jqx-disableselect"))}var n,c=this._geteditorvalue(d);if(e)return t(this),!1;if(this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide()),!d.cellvaluechanging||null!=(n=d.cellvaluechanging(i,l,d.columntype,this.editcell.value,c))&&(c=n),d.validation){var h=this.getcell(i,l);try{var u=d.validation(h,c),p=this.gridlocalization.validationstring;if(null!=u.message&&(p=u.message),!("boolean"==typeof u?u:u.result))return null!=u.showmessage&&1!=u.showmessage||this._showvalidationpopup(i,l,p),this.editcell.validated=!1}catch(e){return this._showvalidationpopup(i,l,this.gridlocalization.validationstring),this.editcell.validated=!1}}n=d.displayfield!=d.datafield?(f=this.getcellvalue(this.editcell.row,d.displayfield),{value:this.editcell.value,label:f}):this.editcell.value;var f=this.getrowdata(i);if(d.cellendedit)if(0==d.cellendedit(i,l,d.columntype,this.editcell.value,c))return this._raiseEvent(18,{rowindex:i,row:f,datafield:l,displayfield:d.displayfield,oldvalue:n,value:n,columntype:d.columntype}),t(this),!1;return this._raiseEvent(18,{rowindex:i,row:f,datafield:l,displayfield:d.displayfield,oldvalue:n,value:c,columntype:d.columntype}),this._hidecelleditor(!1),null!=this.editcell&&(this.editcell.editor=null,this.editcell.editing=!1),this.editcell=null,this.editchar=null,this.pushToHistory=!0,this.setcellvalue(i,l,c,o),this.pushToHistory=!1,this.enablebrowserselection||(this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect")),S.jqx.browser.msie||r(),S.data(document.body,"jqxgrid.edit",""),!0}this.endrowedit(i,e)}},beginrowedit:function(o){var e,t,s,d=this;null!=o&&(d._oldselectedrow=o,this._cellscache=new Array,e=!1,"selectedrow"!=this.editmode&&(e=!0),e&&(t=this.editmode,this.editmode="selectedrow"),s=null,this._currentEditableColumn&&(s=this.getcolumnat(this._currentEditableColumn).datafield),S.each(this.columns.records,function(e,t){if(d.editable&&this.editable){if("checkbox"===this.columntype||"custom"===this.columntype||"widget"===this.columntype||"template"===this.columntype||"button"===this.columntype)return!0;s=s||this.datafield;var i=d.getcell(o,this.datafield);d.begincelledit(o,this.datafield,null,!1,!1);var l=d.getrowdata(o);d._raiseEvent(17,{rowindex:o,row:l,datafield:this.datafield,value:i.value,columntype:this.columntype})}}),d.editcell&&(d.editcell.init=!0),this._renderrows(this.virtualsizeinfo),e&&(this.editmode=t),s&&d.editcell&&setTimeout(function(){var e;d.editcell&&d.editcell[s]&&((e=d.editcell[s].editor)&&(e.data().jqxWidget&&e.data().jqxWidget.focus?e.data().jqxWidget:e).focus())},25))},endrowedit:function(o,e){var s=this;if(this._currentEditableColumn=0,this._focusedColumn=null,this._currentColumn=null,this._checkboxCells=[],!this.editcell)return!1;if(null==this.editcell.editor&&"checkbox"!==this.editcell.columntype)return!1;var t,i=!1;"selectedrow"!=this.editmode&&(i=!0),i&&(t=this.editmode,this.editmode="selectedrow");var l=!1,d={};this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide());for(var a=0;a<this.columns.records.length;a++){var r=this.columns.records[a];if(r.editable&&(!r.hidden&&"checkbox"!=r.columntype&&!r.createwidget)){var n=this._geteditorvalue(r),c=function(e){e._hidecelleditor();var t=e.getcellvalue(e.editcell.row,r.displayfield);r.cellendedit&&r.cellendedit(o,u,r.columntype,t,n),e.editchar=null,r.displayfield!=r.datafield&&e.getcellvalue(e.editcell.row,r.displayfield);var i=e.getrowdata(o);e._raiseEvent(18,{rowindex:o,row:i,datafield:u,displayfield:r.displayfield,oldvalue:t,value:t,columntype:r.columntype}),e.editcell.editing=!1};if(e)c(this);else{r.cellvaluechanging&&(g=this.getcellvalue(this.editcell.row,r.displayfield),null!=(h=r.cellvaluechanging(o,u,r.columntype,g,n))&&(n=h));var h,u=r.datafield;if(r.validation){var p=this.getcell(o,r.datafield);try{var f=r.validation(p,n),m=this.gridlocalization.validationstring;if(null!=f.message&&(m=f.message),!(y="boolean"==typeof f?f:f.result)){null!=f.showmessage&&1!=f.showmessage||this._showvalidationpopup(o,u,m),l=!0,this.editcell[r.datafield].validated=!1;continue}}catch(e){this._showvalidationpopup(o,u,this.gridlocalization.validationstring),l=!(this.editcell[r.datafield].validated=!1);continue}}g=r.displayfield!=r.datafield?(h=this.getcellvalue(this.editcell.row,r.displayfield),{value:this.editcell.value,label:h}):this.getcellvalue(this.editcell.row,r.displayfield),d[r.datafield]={newvalue:n,oldvalue:g}}}}var v={},x={};if(!l){this._hidecelleditor(!1);for(a=0;a<this.columns.records.length;a++){u=(r=this.columns.records[a]).datafield;if(!r.hidden&&r.editable){var w=this.getrowdata(o);if(!r.createwidget)if("checkbox"!=r.columntype){if(d[r.datafield]){var n=d[r.datafield].newvalue,g=d[r.datafield].oldvalue;if(r.cellendedit)if(0==r.cellendedit(o,u,r.columntype,g,n)){this._raiseEvent(18,{rowindex:o,row:w,datafield:u,displayfield:r.displayfield,oldvalue:g,value:g,columntype:r.columntype}),c(this);continue}this.source.updaterow||this._raiseEvent(18,{rowindex:o,row:w,datafield:r.datafield,displayfield:r.displayfield,oldvalue:g,value:n,columntype:r.columntype}),v[r.datafield]=n,x[r.datafield]=g}}else{n=this.getcellvalue(o,r.displayfield);this._raiseEvent(18,{rowindex:o,row:w,datafield:r.datafield,displayfield:r.displayfield,oldvalue:n,value:n,columntype:r.columntype})}}}var b=this.getrowid(o),w=this.getrowdata(o);if(S.each(v,function(e,t){var i;t&&null!=t.label?(i=s.getcolumn(e),w[i.displayfield]=t.label,w[i.datafield]=t.value):w[e]=t}),this.enablebrowserselection||(this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect")),S.data(document.body,"jqxgrid.edit",""),this.editcell=null,this.editchar=null,this.pushToHistory=!0,this.source.updaterow&&!e){var s=this,y=function(e){var t=s.source.updaterow;s.source.updaterow=null,0==e&&S.each(x,function(e,t){var i;t&&null!=t.label?(i=s.getcolumn(e),w[i.displayfield]=t.label,w[i.datafield]=t.value):w[e]=t}),s.updaterow(b,w);for(var i=0;i<s.columns.records.length;i++){var l=s.columns.records[i];l.datafield;s._raiseEvent(18,{rowindex:o,datafield:l.datafield,row:w,displayfield:l.displayfield,oldvalue:x[l.datafield],value:w[l.displayfield],columntype:l.columntype})}s.source.updaterow=t};try{null==this.source.updaterow(b,w,y)&&0}catch(e){return void 0}}else e||this.updaterow(b,w),this._renderrows(this.virtualsizeinfo)}return this.pushToHistory=!1,i&&(this.editmode=t),l},_selection:function(e){if("selectionStart"in e[0]){var t=e[0],i=t.selectionEnd-t.selectionStart;return{start:t.selectionStart,end:t.selectionEnd,length:i,text:t.value}}var l=document.selection.createRange();if(null==l)return{start:0,end:t.value.length,length:0};t=e[0].createTextRange(),e=t.duplicate();t.moveToBookmark(l.getBookmark()),e.setEndPoint("EndToStart",t);i=l.text.length;return{start:e.text.length,end:e.text.length+l.text.length,length:i,text:l.text}},_setSelection:function(e,t,i){try{var l;"selectionStart"in e?e.setSelectionRange(t,i):((l=e.createTextRange()).collapse(!0),l.moveEnd("character",i),l.moveStart("character",t),l.select())}catch(e){}},findRecordIndex:function(e,t,i){if(t)for(var l=i.length,o=0;o<l;o++)if(e==i[o].label)return o;return-1},_destroyeditors:function(){var r=this;this.columns.records&&(S.each(this.columns.records,function(e,t){var i=S.trim(this.datafield).split(" ").join("");switch(this.columntype){case"dropdownlist":var l=r.editors["dropdownlist_"+i];l&&(l.jqxDropDownList("destroy"),r.editors["dropdownlist_"+i]=null);break;case"combobox":var o=r.editors["combobox_"+i];o&&(o.jqxComboBox("destroy"),r.editors["combobox_"+i]=null);break;case"datetimeinput":o=r.editors["datetimeinput_"+this.datafield];o&&(o.jqxDateTimeInput("destroy"),r.editors["datetimeinput_"+i]=null);break;case"numberinput":var s=r.editors["numberinput_"+i];s&&(s.jqxNumberInput("destroy"),r.editors["numberinput_"+i]=null);break;case"custom":case"template":if(r.destroyeditor&&r.editors["templateeditor_"+i]&&(r.destroyeditor(r.editors["templateeditor_"+i]),r.editors["templateeditor_"+i]=null),r.destroyeditor)for(var d=r.getrows.length(),a=0;a<d;a++)r.editors["customeditor_"+i+"_"+a]&&(r.destroyeditor(r.editors["customeditor_"+i+"_"+a],a),r.editors["customeditor_"+i+"_"+a]=null);break;case"textbox":default:s=r.editors["textboxeditor_"+i];s&&(r.removeHandler(s,"keydown"),r.editors["textbox_"+i]=null)}}),r.editors=new Array)},_showcelleditor:function(e,d,t,i,l){if(null!=t&&null!=this.editcell)if("checkbox"==d.columntype&&d.editable)"selectedrow"==this.editmode&&(this._checkboxCells||(this._checkboxCells=[]),this._checkboxCells[d.datafield]=t);else{null==l&&(l=!0),"selectedrow"==this.editmode&&(this.editchar="",l=!1);var o=d.datafield,s=S(t),a=this,r=this.editcell.editor,n=this.getcellvalue(e,o),c=this.getcelltext(e,o),h=this.hScrollInstance.value,u=parseInt(h);this.columns.records.indexOf(d);this.editcell.element=t,0==this.editcell.validated&&(h="",this.validationpopup&&(h=this.validationpopup.text()),this._showvalidationpopup(e,o,h));function p(e){a.hScrollInstance.isScrolling()||a.vScrollInstance.isScrolling()||l&&(a.isTouchDevice()||(e&&e.focus(),0!=a.gridcontent[0].scrollTop&&(a.scrolltop(Math.abs(a.gridcontent[0].scrollTop)),a.gridcontent[0].scrollTop=0),0!=a.gridcontent[0].scrollLeft&&(a.gridcontent[0].scrollLeft=0)))}var f,m,v,x,w,g;switch(d.columntype){case"dropdownlist":if(this.host.jqxDropDownList){t.innerHTML="";var b=S.trim(d.datafield).split(" ").join(""),y=S.trim(d.displayfield).split(" ").join("");-1!=b.indexOf(".")&&(b=b.replace(".","")),-1!=y.indexOf(".")&&(y=y.replace(".",""));var _=this.editors["dropdownlist_"+b];(r=null==_?S("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='dropdownlisteditor'></div>"):_).css("top",S(t).parent().position().top),this.oldhscroll?r.css("left",-u+parseInt(S(t).position().left)):r.css("left",parseInt(S(t).position().left)),d.pinned&&r.css("left",u+parseInt(S(t).position().left)),null==_&&(r.prependTo(this.table),r[0].id="dropdownlisteditor"+this.element.id+b,I=null,I=!!this.source._source?(D={localdata:JSON.parse(JSON.stringify(this.source.records)),datatype:this.source.datatype,async:!1},new S.jqx.dataAdapter(D,{autoBind:!1,async:!1,uniqueDataFields:[y],autoSort:!0,autoSortField:y})):new S.jqx.dataAdapter(this.source,{autoBind:!1,uniqueDataFields:[y],async:!1,autoSort:!0,autoSortField:y}),T=!d.createeditor,r.jqxDropDownList({hint:!1,enableBrowserBoundsDetection:!0,keyboardSelection:!1,source:I,rtl:this.rtl,autoDropDownHeight:T,theme:this.theme,width:s.width(),height:s.height(),displayMember:y,valueMember:o}),this.editors["dropdownlist_"+b]=r,d.createeditor&&d.createeditor(e,n,r)),d._requirewidthupdate&&r.jqxDropDownList({width:s.width()});var q=r.jqxDropDownList("listBox").visibleItems;d.createeditor||(q.length<8?r.jqxDropDownList("autoDropDownHeight",!0):r.jqxDropDownList("autoDropDownHeight",!1));var n=this.getcellvalue(e,y),j=this.findRecordIndex(n,y,q);if(i&&(""!=n?r.jqxDropDownList("selectIndex",j,!0):r.jqxDropDownList("selectIndex",-1)),!this.editcell)return;null!=this.editcell.defaultvalue&&r.jqxDropDownList("selectIndex",this.editcell.defaultvalue,!0),l&&r.jqxDropDownList("focus")}break;case"combobox":if(this.host.jqxComboBox){t.innerHTML="";var b=S.trim(d.datafield).split(" ").join(""),y=S.trim(d.displayfield).split(" ").join("");-1!=b.indexOf(".")&&(b=b.replace(".","")),-1!=y.indexOf(".")&&(y=y.replace(".",""));var I,D,T,_=this.editors["combobox_"+b];(r=null==_?S("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='comboboxeditor'></div>"):_).css("top",S(t).parent().position().top),this.oldhscroll?r.css("left",-u+parseInt(S(t).position().left)):r.css("left",parseInt(S(t).position().left)),d.pinned&&r.css("left",u+parseInt(S(t).position().left)),null==_&&(r.prependTo(this.table),r[0].id="comboboxeditor"+this.element.id+b,I=null,I=!!this.source._source?(D={localdata:JSON.parse(JSON.stringify(this.source.records)),datatype:this.source.datatype,async:!1},new S.jqx.dataAdapter(D,{autoBind:!1,async:!1,uniqueDataFields:[y],autoSort:!0,autoSortField:y})):new S.jqx.dataAdapter(this.source,{autoBind:!1,uniqueDataFields:[y],async:!1,autoSort:!0,autoSortField:y}),T=!d.createeditor,r.jqxComboBox({hint:!1,enableBrowserBoundsDetection:!0,keyboardSelection:!1,source:I,rtl:this.rtl,autoDropDownHeight:T,theme:this.theme,width:s.width(),height:s.height(),displayMember:y,valueMember:o}),r.removeAttr("tabindex"),r.find("div").removeAttr("tabindex"),this.editors["combobox_"+b]=r,d.createeditor&&d.createeditor(e,n,r)),d._requirewidthupdate&&r.jqxComboBox({width:s.width()-2});q=r.jqxComboBox("listBox").visibleItems;d.createeditor||(q.length<8?r.jqxComboBox("autoDropDownHeight",!0):r.jqxComboBox("autoDropDownHeight",!1));n=this.getcellvalue(e,y),j=this.findRecordIndex(n,y,q);if(i&&(""!=n?r.jqxComboBox("selectIndex",j,!0):r.jqxComboBox("selectIndex",-1),r.jqxComboBox("val",n)),!this.editcell)return;null!=this.editcell.defaultvalue&&r.jqxComboBox("selectIndex",this.editcell.defaultvalue,!0),this.editchar&&0<this.editchar.length&&r.jqxComboBox("input").val(this.editchar),l&&setTimeout(function(){var e;p(r.jqxComboBox("input")),r&&(r.jqxComboBox("_setSelection",0,0),a.editchar?(r.jqxComboBox("_setSelection",1,1),a.editchar=null):r.jqxComboBox("input")&&(e=r.jqxComboBox("input").val(),r.jqxComboBox("_setSelection",0,e.length)))},10)}break;case"datetimeinput":this.host.jqxDateTimeInput&&(t.innerHTML="",-1!=(b=S.trim(d.datafield).split(" ").join("")).indexOf(".")&&(b=b.replace(".","")),x=this.editors["datetimeinput_"+b],(r=null==x?S("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='datetimeeditor'></div>"):x).show(),r.css("top",S(t).parent().position().top),this.oldhscroll?r.css("left",-u+parseInt(S(t).position().left)):r.css("left",parseInt(S(t).position().left)),d.pinned&&r.css("left",u+parseInt(S(t).position().left)),null==x&&(r.prependTo(this.table),r[0].id="datetimeeditor"+this.element.id+b,m={calendar:this.gridlocalization},r.jqxDateTimeInput({hint:!1,firstDayOfWeek:this.gridlocalization.firstDay,enableBrowserBoundsDetection:!0,localization:m,_editor:!0,theme:this.theme,rtl:this.rtl,width:s.width(),height:s.height(),formatString:d.cellsformat}),this.editors["datetimeinput_"+b]=r,d.createeditor&&d.createeditor(e,n,r)),d._requirewidthupdate&&r.jqxDateTimeInput({width:s.width()}),i&&(""!=n&&null!=n?("Invalid Date"==(v=new Date(n))&&this.source.getvaluebytype&&(v=this.source.getvaluebytype(n,{name:d.datafield,type:"date"})),r.jqxDateTimeInput("setDate",v)):r.jqxDateTimeInput("setDate",null),null!=this.editcell.defaultvalue&&r.jqxDateTimeInput("setDate",this.editcell.defaultvalue)),l&&(f=this.editEvent,setTimeout(function(){p(r.jqxDateTimeInput("dateTimeInput")),setTimeout(function(){var e;r.jqxDateTimeInput("_selectGroup",0),a.editchar&&0<a.editchar.length&&(e=parseInt(a.editchar),isNaN(e)||f&&(e=f.charCode||f.keyCode||0,r.jqxDateTimeInput("_handleKeyPress",f,e)))},25)},10)));break;case"numberinput":this.host.jqxNumberInput&&(t.innerHTML="",-1!=(b=S.trim(d.datafield).split(" ").join("")).indexOf(".")&&(b=b.replace(".","")),x=this.editors["numberinput_"+b],(r=null==x?S("<div style='border:none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='numbereditor'></div>"):x).show(),r.css("top",S(t).parent().position().top),this.oldhscroll?r.css("left",-u+parseInt(S(t).position().left)):r.css("left",parseInt(S(t).position().left)),d.pinned&&r.css("left",u+parseInt(S(t).position().left)),null==x&&(r.prependTo(this.table),r[0].id="numbereditor"+this.element.id+b,m="",v="left",x=2,d.cellsformat?-1!=d.cellsformat.indexOf("c")?(m=this.gridlocalization.currencysymbol,v="before"==(v=this.gridlocalization.currencysymbolposition)?"left":"right",1<d.cellsformat.length&&(x=parseInt(d.cellsformat.substring(1),10))):-1!=d.cellsformat.indexOf("p")&&(m=this.gridlocalization.percentsymbol,v="right",1<d.cellsformat.length&&(x=parseInt(d.cellsformat.substring(1),10))):x=0,r.jqxNumberInput({decimalSeparator:this.gridlocalization.decimalseparator,decimalDigits:x,inputMode:"simple",theme:this.theme,rtl:this.rtl,width:s.width(),height:s.height(),spinButtons:!0,symbol:m,symbolPosition:v}),this.editors["numberinput_"+b]=r,d.createeditor&&d.createeditor(e,n,r)),d._requirewidthupdate&&r.jqxNumberInput({width:s.width()}),i&&(""!=n&&null!=n?(g=n,r.jqxNumberInput("setDecimal",g)):r.jqxNumberInput("setDecimal",0),null!=this.editcell.defaultvalue&&r.jqxNumberInput("setDecimal",this.editcell.defaultvalue),this.editchar&&0<this.editchar.length&&(w=parseInt(this.editchar),isNaN(w)||r.jqxNumberInput("setDecimal",w)),l&&setTimeout(function(){var e;p(r.jqxNumberInput("numberInput")),r.jqxNumberInput("_setSelectionStart",0),a.editchar?(0<d.cellsformat.length&&0<=d.cellsformat.indexOf("c")?r.jqxNumberInput("_setSelectionStart",2):r.jqxNumberInput("_setSelectionStart",1),a.editchar=null):(r.jqxNumberInput("spinButtons")?(e=r.jqxNumberInput("numberInput").val(),a._setSelection(r.jqxNumberInput("numberInput")[0],e.length,e.length)):(e=r.jqxNumberInput("numberInput").val(),a._setSelection(r.jqxNumberInput("numberInput")[0],0,e.length)),r.jqxNumberInput("selectAll"))},10)));break;case"rating":this.host.jqxRating&&(t.innerHTML="",-1!=(b=S.trim(d.datafield).split(" ").join("")).indexOf(".")&&(b=b.replace(".","")),w=this.editors["rating_"+b],(r=null==w?S("<div style='margin: 5px;white-space: nowrap; overflow: auto; border:none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='ratingEditor'></div>"):w).show(),r.css("top",S(t).parent().position().top),this.oldhscroll?r.css("left",-u+parseInt(S(t).position().left)):r.css("left",parseInt(S(t).position().left)),d.pinned&&r.css("left",u+parseInt(S(t).position().left)),null==w&&(r.prependTo(this.table),r[0].id="ratingEditor"+this.element.id+b,r.jqxRating({theme:this.theme,width:s.width(),height:s.height()}),this.editors["numberinput_"+b]=r,d.createeditor&&d.createeditor(e,n,r)),d._requirewidthupdate&&r.jqxRating({width:s.width()}),i&&(""!=n&&null!=n?(g=n,r.jqxRating("val",g)):r.jqxRating("val",0),null!=this.editcell.defaultvalue&&r.jqxRating("val",this.editcell.defaultvalue)));break;case"custom":t.innerHTML="",-1!=(b=S.trim(d.datafield).split(" ").join("")).indexOf(".")&&(b=b.replace(".",""));var C=this.editors["customeditor_"+b+"_"+e];(r=null==C?S("<div style='overflow: hidden; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='customeditor'></div>"):C).show(),r.css("top",S(t).parent().position().top),this.oldhscroll?r.css("left",-u+parseInt(S(t).position().left)):r.css("left",parseInt(S(t).position().left)),d.pinned&&r.css("left",u+parseInt(S(t).position().left)),null==C&&(r.prependTo(this.table),r[0].id="customeditor"+this.element.id+b+"_"+e,this.editors["customeditor_"+b+"_"+e]=r,k=s.width()-1,z=s.height()-1,r.width(k),r.height(z),d.createeditor&&d.createeditor(e,n,r,c,k,z,this.editchar)),d._requirewidthupdate&&r.width(s.width());break;case"template":t.innerHTML="",-1!=(b=S.trim(d.datafield).split(" ").join("")).indexOf(".")&&(b=b.replace(".",""));var k,z,C=this.editors["templateeditor_"+b];(r=null==C?S("<div style='overflow: hidden; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='templateeditor'></div>"):C).show(),r.css("top",S(t).parent().position().top),this.oldhscroll?r.css("left",-u+parseInt(S(t).position().left)):r.css("left",parseInt(S(t).position().left)),d.pinned&&r.css("left",u+parseInt(S(t).position().left)),null==C&&(r.prependTo(this.table),r[0].id="templateeditor"+this.element.id+b,this.editors["templateeditor_"+b]=r,k=s.width()-1,z=s.height()-1,r.width(k),r.height(z),d.createeditor&&d.createeditor(e,n,r,c,k,z,this.editchar)),d._requirewidthupdate&&r.width(s.width());break;case"textbox":default:t.innerHTML="",(r=this.editors["textboxeditor_"+d.datafield]||S("<input autocomplete='off' style='padding-left: 4px; padding-right:4px; border: none; border-color: transparent;' autocorrect='off' autocapitalize='off' spellcheck='false' type='textbox' id='textboxeditor'/>"))[0].id="textboxeditor"+this.element.id+d.datafield,r.appendTo(s),this.rtl&&r.css("direction","rtl"),!i&&""!=r[0].className||(r.addClass(this.toThemeProperty("jqx-input")),r.addClass(this.toThemeProperty("jqx-widget-content")),this.editchar&&0<this.editchar.length?r.val(this.editchar):(""!=d.cellsformat&&(n=this.getcelltext(e,o)),null==n&&(n=""),r.val(n)),null!=this.editcell.defaultvalue&&r.val(this.editcell.defaultvalue),r.width(s.width()+1),r.height(s.height()+1),d.createeditor&&d.createeditor(e,n,r),""!=d.cellsformat&&(-1==d.cellsformat.indexOf("p")&&-1==d.cellsformat.indexOf("c")&&-1==d.cellsformat.indexOf("n")&&-1==d.cellsformat.indexOf("f")||this.editors["textboxeditor_"+d.datafield]||r.keydown(function(e){e=e.charCode||e.keyCode||0,e=String.fromCharCode(e),e=parseInt(e);if(isNaN(e))return!0;if(0<a._selection(r).length)return!0;var t,i="",l=r.val();if(1<d.cellsformat.length?(t=parseInt(d.cellsformat.substring(1)),isNaN(t)&&(t=0)):t=0,0<t&&-1!=l.indexOf(a.gridlocalization.decimalseparator)&&a._selection(r).start>l.indexOf(a.gridlocalization.decimalseparator))return!0;for(var o=0;o<l.length-t;o++){var s=l.substring(o,o+1);null!=s.match(/^[0-9]+$/)&&(i+=s)}return!(11<=i.length)&&void 0}))),this.editors["textboxeditor_"+d.datafield]=r,i&&l&&setTimeout(function(){p(r),a.editchar?(a._setSelection(r[0],1,1),a.editchar=null):a._setSelection(r[0],0,r.val().length)},25)}r&&(r.addClass("jqx-grid-cell-edit"),r[0].style.zIndex=1+parseInt(t.style.zIndex),S.jqx.browser.msie&&S.jqx.browser.version<8&&(r[0].style.zIndex=1+this.columns.records.length+t.style.zIndex),r.css("display","block"),this.editcell.editor=r,this.editcell[o]||(this.editcell[o]={}),this.editcell[o].editor=r),i&&d.initeditor&&d.initeditor(e,n,r,c,this.editchar),a.isTouchDevice()||setTimeout(function(){a.content&&(a.content[0].scrollTop=0,a.content[0].scrollLeft=0),a.gridcontent&&(a.gridcontent[0].scrollLeft=0,a.gridcontent[0].scrollTop=0)},10)}},_hideeditors:function(){if(null!=this.editcells)for(var e in this.editcells)this.editcell=this.editcells[e],this._hidecelleditor()},_hidecelleditor:function(e){if(this.editcell)if("selectedrow"!==this.editmode){if("checkbox"!=this.editcell.columntype){if(this.editcell.editor)switch(this.editcell.editor.hide(),this.editcell.columntype){case"dropdownlist":this.editcell.editor.jqxDropDownList({closeDelay:0}),this.editcell.editor.jqxDropDownList("hideListBox"),this.editcell.editor.jqxDropDownList({closeDelay:300});break;case"combobox":this.editcell.editor.jqxComboBox({closeDelay:0}),this.editcell.editor.jqxComboBox("hideListBox"),this.editcell.editor.jqxComboBox({closeDelay:300});break;case"datetimeinput":var t=this.editcell.editor;t.jqxDateTimeInput("isOpened")&&(t.jqxDateTimeInput({closeDelay:0}),t.jqxDateTimeInput("hideCalendar"),t.jqxDateTimeInput({closeDelay:300}))}this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide()),this.isNestedGrid||0!=e&&this.element.focus()}}else{for(var i=0;i<this.columns.records.length;i++){var l=this.columns.records[i];if(this.editcell[l.datafield]&&this.editcell[l.datafield].editor){this.editcell[l.datafield].editor.hide();var o=this.editcell[l.datafield].editor;switch(l.columntype){case"dropdownlist":o.jqxDropDownList({closeDelay:0}),o.jqxDropDownList("hideListBox"),o.jqxDropDownList({closeDelay:300});break;case"combobox":o.jqxComboBox({closeDelay:0}),o.jqxComboBox("hideListBox"),o.jqxComboBox({closeDelay:300});break;case"datetimeinput":o.jqxDateTimeInput("isOpened")&&(o.jqxDateTimeInput({closeDelay:0}),o.jqxDateTimeInput("hideCalendar"),o.jqxDateTimeInput({closeDelay:300}))}}}this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide())}},_geteditorvalue:function(e){var t=new String;if(!this.editcell)return null;var i,l=this.editcell.editor;if("selectedrow"==this.editmode&&this.editcell[e.datafield]&&(l=this.editcell[e.datafield].editor),l){switch(e.columntype){case"textbox":default:if(t=l.val(),""!=e.cellsformat){var o,s="string",d=this.source.datafields||(this.source._source?this.source._source.datafields:null);d&&(o="",S.each(d,function(){if(this.name==e.displayfield)return this.type&&(o=this.type),!1}),o&&(s=o));var a="date"===s||"time"===s;if("number"===s||"float"===s||"int"===s||"integer"===s||"string"===s&&(-1!=e.cellsformat.indexOf("p")||-1!=e.cellsformat.indexOf("c")||-1!=e.cellsformat.indexOf("n")||-1!=e.cellsformat.indexOf("f"))){if(""===t&&e.nullable)return"";t.indexOf&&-1<t.indexOf(this.gridlocalization.currencysymbol)&&(t=t.replace(this.gridlocalization.currencysymbol,""));d=t,d=new Number(d);if(!isNaN(d))return d;-1<(t=(t=function(e,t,i){var l=e;if(t==i)return e;for(var o=l.indexOf(t);-1!=o;)o=(l=l.replace(t,i)).indexOf(t);return l}(t,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(t=t.replace(this.gridlocalization.percentsymbol,""));for(var r="",n=0;n<t.length;n++){var c=t.substring(n,n+1);"-"===c&&(r+="-"),"."===c&&(r+="."),null!=c.match(/^[0-9]+$/)&&(r+=c)}t=(t=r).replace(/ /g,""),t=new Number(t),isNaN(t)&&(t="")}if(a||"string"===s&&(-1!=e.cellsformat.indexOf("H")||-1!=e.cellsformat.indexOf("m")||-1!=e.cellsformat.indexOf("M")||-1!=e.cellsformat.indexOf("y")||-1!=e.cellsformat.indexOf("h")||-1!=e.cellsformat.indexOf("d"))){if(""===t&&e.nullable)return"";S.jqx.dataFormat&&(t=S.jqx.dataFormat.tryparsedate(t,this.gridlocalization)),"Invalid Date"!=t&&null!=t||(t="")}}e.displayfield!=e.datafield&&(t={label:t,value:t});break;case"checkbox":l.jqxCheckBox&&(t=l.jqxCheckBox("checked"));break;case"datetimeinput":if(l.jqxDateTimeInput){if(l.jqxDateTimeInput({isEditing:!1}),"none"!==l.jqxDateTimeInput("container").css("display")&&l.jqxDateTimeInput("close"),l.jqxDateTimeInput("_validateValue"),null==(t=l.jqxDateTimeInput("getDate")))return null;t=new Date(t.toString()),e.displayfield!=e.datafield&&(t={label:t,value:t})}break;case"dropdownlist":l.jqxDropDownList&&(i=l.jqxDropDownList("selectedIndex"),i=l.jqxDropDownList("listBox").getVisibleItem(i),null==(t=e.displayfield!=e.datafield?i?{label:i.label,value:i.value}:"":i?i.label:"")&&(t=""));break;case"combobox":l.jqxComboBox&&(t=l.jqxComboBox("val"),e.displayfield!=e.datafield&&null!=(i=l.jqxComboBox("getSelectedItem"))&&(t={label:i.label,value:i.value}),null==t&&(t=""));break;case"numberinput":l.jqxNumberInput&&(this.touchdevice&&l.jqxNumberInput("_doTouchHandling"),i=l.jqxNumberInput("getDecimal"),t=new Number(i),t=parseFloat(t),isNaN(t)&&(t=0),null===i&&(t=null),e.displayfield!=e.datafield&&(t={label:t,value:t}))}e.geteditorvalue&&(t="selectedrow"==this.editmode?e.geteditorvalue(this.editcell.row,this.getcellvalue(this.editcell.row,e.datafield),l):e.geteditorvalue(this.editcell.row,this.editcell.value,l))}return t},hidevalidationpopups:function(){this.popups&&(S.each(this.popups,function(){this.validation.remove(),this.validationrow.remove()}),this.popups=new Array),this.validationpopup&&(this.validationpopuparrow.hide(),this.validationpopup.hide())},showvalidationpopup:function(i,l,o){null==o&&(o=this.gridlocalization.validationstring);var e=S("<div style='z-index: 99999; top: 0px; left: 0px; position: absolute;'></div>"),t=S("<div style='width: 20px; height: 20px; z-index: 999999; top: 0px; left: 0px; position: absolute;'></div>");e.html(o),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),e.addClass(this.toThemeProperty("jqx-grid-validation")),e.addClass(this.toThemeProperty("jqx-rc-all")),e.prependTo(this.table),t.prependTo(this.table);for(var s=this.hScrollInstance.value,d=parseInt(s),a=this.getcolumn(l).uielement,r=null,n=0;n<this.hittestinfo.length;n++)i===this.hittestinfo[n].row.visibleindex&&(r=this.hittestinfo[n]);if(!r){this.ensurerowvisible(i);var c=this;return e.remove(),t.remove(),void setTimeout(function(){for(var e=null,t=0;t<c.hittestinfo.length;t++)i===c.hittestinfo[t].row.visibleindex&&(e=c.hittestinfo[t]);e&&c.showvalidationpopup(i,l,o)},25)}var h=S(r.visualrow);e.css("top",parseInt(h.position().top)+30+"px");var u=parseInt(e.css("top"));t.css("top",u-12),t.removeClass(),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up"));s=!1;u>=this._gettableheight()-this.rowsheight&&(t.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),(u=parseInt(h.position().top)-this.rowsheight)<0&&(u=0,this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),s=!0),e.css("top",u+"px"),t.css("top",u+e.outerHeight()-9));h=-d+parseInt(S(a).position().left);0===a[0].offsetHeight&&(h=-d+parseInt(a[0].style.left)),t.css("left",d+h+30);u=e.width();u+h>this.host.width()-20&&(h-=u+h-this.host.width()+40),s?e.css("left",d+parseInt(S(a).position().left)-e.outerWidth()):e.css("left",d+h),e.show(),t.show(),this.popups||(this.popups=new Array),this.popups[this.popups.length]={validation:e,validationrow:t}},_showvalidationpopup:function(e,t,i){var l,o,s=this.editcell,d=this.editcell.editor;"selectedrow"==this.editmode&&(s=this.editcell[t])&&s.editor&&(d=s.editor,s.element=d),d&&(this.validationpopup&&S.jqx.isHidden(this.validationpopup)&&(this.validationpopup.remove&&(this.validationpopup.remove(),this.validationpopuparrow.remove()),this.validationpopup=null,this.validationpopuparrow=null,void 0===t&&void 0===i&&this.editors&&0===this.editors.length)||(this.validationpopup?this.validationpopup.html(i):(o=S("<div style='z-index: 99999; top: 0px; left: 0px; position: absolute;'></div>"),l=S("<div style='width: 20px; height: 20px; z-index: 999999; top: 0px; left: 0px; position: absolute;'></div>"),o.html(i),l.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),o.addClass(this.toThemeProperty("jqx-grid-validation")),o.addClass(this.toThemeProperty("jqx-rc-all")),o.prependTo(this.table),l.prependTo(this.table),this.validationpopup=o,this.validationpopuparrow=l),t=this.hScrollInstance.value,i=parseInt(t),"selectedrow"==this.editmode?this.visiblerows&&this.visiblerows[this.editcell.visiblerowindex]?this.validationpopup.css("top",this.visiblerows[this.editcell.visiblerowindex].top+(this.rowsheight+5)+"px"):this.validationpopup.css("top",parseInt(S(s.editor).position().top)+(this.rowsheight+5)+"px"):this.validationpopup.css("top",parseInt(S(s.element).parent().position().top)+(this.rowsheight+5)+"px"),o=parseInt(this.validationpopup.css("top")),this.validationpopuparrow.css("top",o-11),this.validationpopuparrow.removeClass(),this.validationpopuparrow.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),l=!1,this._gettableheight()<=o&&(this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),this.validationpopuparrow.addClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),o=parseInt(S(s.element).parent().position().top)-this.rowsheight-5,"selectedrow"==this.editmode&&(o=this.visiblerows&&this.visiblerows[this.editcell.visiblerowindex]?this.visiblerows[this.editcell.visiblerowindex].top-this.rowsheight-5:parseInt(S(s.editor).position().top)-this.rowsheight-5),o<0&&(o=0,this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),l=!0),this.validationpopup.css("top",o+"px"),this.validationpopuparrow.css("top",o+this.validationpopup.outerHeight()-9)),t=-i+parseInt(S(s.element).position().left),this.validationpopuparrow.css("left",i+t+30),(o=this.validationpopup.width())+t>this.host.width()-20&&(t-=o+t-this.host.width()+40),l?this.validationpopup.css("left",i+parseInt(S(s.element).position().left)-this.validationpopup.outerWidth()):this.validationpopup.css("left",i+t),"none"==this.editcell.editor.css("display")?(this.validationpopup.hide(),this.validationpopuparrow.hide()):(this.validationpopup.show(),this.validationpopuparrow.show())))}})}(jqxBaseFramework);