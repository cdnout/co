!function(l){l.jqx.jqxWidget("jqxDragDrop","",{}),l.extend(l.jqx._jqxDragDrop.prototype,{defineInstance:function(){var e={restricter:"document",handle:!1,feedback:"clone",opacity:.6,revert:!1,revertDuration:400,distance:5,disabled:!1,tolerance:"intersect",data:null,dropAction:"default",dragZIndex:999999,appendTo:"parent",cursor:"move",onDragEnd:null,onDrag:null,onDragStart:null,onTargetDrop:null,onDropTargetEnter:null,onDropTargetLeave:null,initFeedback:null,dropTarget:null,isDestroyed:!1,triggerEvents:!0,_touchEvents:{mousedown:l.jqx.mobile.getTouchEventName("touchstart"),click:l.jqx.mobile.getTouchEventName("touchstart"),mouseup:l.jqx.mobile.getTouchEventName("touchend"),mousemove:l.jqx.mobile.getTouchEventName("touchmove"),mouseenter:"mouseenter",mouseleave:"mouseleave"},_restricter:null,_zIndexBackup:0,_targetEnterFired:!1,_oldOpacity:1,_feedbackType:void 0,_isTouchDevice:!1,_events:["dragStart","dragEnd","dragging","dropTargetEnter","dropTargetLeave"]};return this===l.jqx._jqxDragDrop.prototype||l.extend(!0,this,e),e},createInstance:function(){this._createDragDrop()},_createDragDrop:function(){var e,t,i=l.data(document.body,"jqx-draggables")||1;this.appendTo=this._getParent(),this._isTouchDevice=l.jqx.mobile.isTouchDevice(),/(static|relative)/.test(this.host.css("position"))&&(this.feedback&&"original"!==this.feedback||(e=this._getRelativeOffset(this.host),t=this.appendTo.offset(),"static"!=this.appendTo.css("position")&&(t={left:0,top:0}),this.element.style.position="absolute",this.element.style.left=t.left+e.left+"px",this.element.style.top=t.top+e.top+"px")),this._validateProperties(),this._idHandler(i),this.disabled&&this.disable(),"string"==typeof this.dropTarget&&(this.dropTarget=l(this.dropTarget)),this._refresh(),i+=1,l.data(document.body,"jqx-draggables",i),this.host.addClass("jqx-draggable"),this.disabled||this.host.css("cursor",this.cursor)},_getParent:function(){var e=this.appendTo;if("string"==typeof this.appendTo)switch(this.appendTo){case"parent":e=this.host.parent();break;case"document":e=l(document);break;case"body":e=l(document.body);break;default:e=l(this.appendTo)}return e},_idHandler:function(e){this.element.id||(e="jqx-draggable-"+e,this.element.id=e)},_refresh:function(){this._removeEventHandlers(),this._addEventHandlers()},_getEvent:function(e){return this._isTouchDevice?this._touchEvents[e]:e},_validateProperties:function(){"clone"===this.feedback?this._feedbackType="clone":this._feedbackType="original","default"!==this.dropAction&&(this.dropAction="nothing")},_removeEventHandlers:function(){this.removeHandler(this.host,"dragstart"),this.removeHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown),this.removeHandler(l(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove),this.removeHandler(l(document),this._getEvent("mouseup")+".draggable."+this.element.id,this._mouseUp)},_addEventHandlers:function(){var e,t=this;this.addHandler(this.host,"dragstart",function(e){return!!t.disabled||(l.jqx.mobile.isTouchDevice()?void 0:(e.preventDefault(),!1))}),this.addHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown,{self:this}),this.addHandler(l(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove,{self:this}),this.addHandler(l(document),this._getEvent("mouseup")+".draggable."+this.element.id,function(e){t._mouseUp(e)},{self:this});try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.self||(e="",window.parent&&document.referrer&&(e=document.referrer),-1!=e.indexOf(document.location.host)&&(window.top.document.addEventListener?window.top.document.addEventListener("mouseup",function(){t._mouseUp(t)},!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",function(){t._mouseUp(t)})))}catch(e){}},_mouseDown:function(e){var t=e.data.self,i=t._getMouseCoordinates(e),r=t._mouseCapture(e);if(t._originalPageX=i.left,t._originalPageY=i.top,t.disabled)return!0;return t._mouseStarted||t._clear(e),r&&(t._mouseDownEvent=e),!!t._isTouchDevice||(1!==e.which||!r||void e.preventDefault())},_mouseMove:function(e){var t=e.data.self;return!!t.disabled||(t._mouseStarted?(t._mouseDrag(e),e.preventDefault&&e.preventDefault(),!1):(t._mouseDownEvent&&t._isMovedDistance(e)&&(t._mouseStart(t._mouseDownEvent,e)?t._mouseStarted=!0:t._mouseStarted=!1,t._mouseStarted?t._mouseDrag(e):t._mouseUp(e)),!t._mouseStarted))},_mouseUp:function(e){this._clear(e)},_clear:function(e){var t=e.data&&e.data.self?e.data.self:this;return!!t.disabled||(t._mouseDownEvent=!1,t._movedDistance=!1,t._mouseStarted&&(t._mouseStarted=!1,t._mouseStop(e)),t.feedback&&t.feedback[0]&&"original"!==t._feedbackType&&"function"==typeof t.feedback.remove&&!t.revert&&t.feedback.remove(),!!t._isTouchDevice&&void 0)},cancelDrag:function(){var e=this.revertDuration;this.revertDuration=0,this._mouseDownEvent=!1,this._movedDistance=!1,this._mouseStarted=!1,this._mouseStop(),this.feedback.remove(),this.revertDuration=e},_isMovedDistance:function(e){e=this._getMouseCoordinates(e);return!!this._movedDistance||(e.left>=this._originalPageX+this.distance||e.left<=this._originalPageX-this.distance||e.top>=this._originalPageY+this.distance||e.top<=this._originalPageY-this.distance)&&(this._movedDistance=!0)},_getMouseCoordinates:function(e){if(this._isTouchDevice){var t=l.jqx.position(e);return{left:t.left,top:t.top}}return{left:e.pageX,top:e.pageY}},destroy:function(){return this._enableSelection(this.host),this.host.removeData("draggable").off(".draggable").removeClass("jqx-draggable jqx-draggable-dragging jqx-draggable-disabled"),this._removeEventHandlers(),this.isDestroyed=!0,this},_disableSelection:function(e){e.each(function(){l(this).attr("unselectable","on").css({"-ms-user-select":"none","-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).each(function(){this.onselectstart=function(){return!1}})})},_enableSelection:function(e){e.each(function(){l(this).attr("unselectable","off").css({"-ms-user-select":"text","-moz-user-select":"text","-webkit-user-select":"text","user-select":"text"}).each(function(){this.onselectstart=null})})},_mouseCapture:function(e){return!this.disabled&&(!!this._getHandle(e)&&(this._disableSelection(this.host),!0))},_getScrollParent:function(e){var t=(l.jqx.browser.msie&&/(static|relative)/.test(e.css("position"))||/absolute/.test(e.css("position"))?e.parents().filter(function(){return/(relative|absolute|fixed)/.test(l.css(this,"position",1))&&/(auto|scroll)/.test(l.css(this,"overflow",1)+l.css(this,"overflow-y",1)+l.css(this,"overflow-x",1))}):e.parents().filter(function(){return/(auto|scroll)/.test(l.css(this,"overflow",1)+l.css(this,"overflow-y",1)+l.css(this,"overflow-x",1))})).eq(0);return/fixed/.test(e.css("position"))||!t.length?l(document):t},_mouseStart:function(e){var t=this._getMouseCoordinates(e);this._getParentOffset(this.host);this.feedback=this._createFeedback(e),this._zIndexBackup=this.feedback.css("z-index"),this.feedback[0].style.zIndex=this.dragZIndex,this._backupFeedbackProportions(),this._backupeMargins(),this._positionType=this.feedback.css("position"),this._scrollParent=this._getScrollParent(this.feedback),this._offset=this.positionAbs=this.host.offset(),this._offset={top:this._offset.top-this.margins.top,left:this._offset.left-this.margins.left},l.extend(this._offset,{click:{left:t.left-this._offset.left,top:t.top-this._offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset(),hostRelative:this._getRelativeOffset(this.host)}),this.position=this._generatePosition(e),this.originalPosition=this._fixPosition(),this.restricter&&this._setRestricter(),this.feedback.addClass(this.toThemeProperty("jqx-draggable-dragging"));this._raiseEvent(0,e);return this.onDragStart&&"function"==typeof this.onDragStart&&this.onDragStart(this.position),this._mouseDrag(e,!0),!0},_fixPosition:function(){var e=this._getRelativeOffset(this.host);this.position;return{left:this.position.left+e.left,top:this.position.top+e.top}},_mouseDrag:function(e,t){return this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.feedback[0].style.left=this.position.left+"px",this.feedback[0].style.top=this.position.top+"px",this._raiseEvent(2,e),this.onDrag&&"function"==typeof this.onDrag&&this.onDrag(this.data,this.position),this._handleTarget(),!1},_over:function(i,r,s){var o,n;return this.dropTarget&&(o=!1,n=this,l.each(this.dropTarget,function(e,t){if((o=n._overItem(t,i,r,s)).over)return!1})),o},_overItem:function(e,t,i,r){var s=(e=l(e)).offset(),o=e.outerHeight(),n=e.outerWidth();if(e&&e[0]!==this.element){var a=!1;switch(this.tolerance){case"intersect":t.left+i>s.left&&t.left<s.left+n&&t.top+r>s.top&&t.top<s.top+o&&(a=!0);break;case"fit":i+t.left<=s.left+n&&t.left>=s.left&&r+t.top<=s.top+o&&t.top>=s.top&&(a=!0)}return{over:a,target:e}}},_handleTarget:function(){var e,t,i;this.dropTarget&&(e=this.feedback.offset(),t=this.feedback.outerWidth(),i=this.feedback.outerHeight(),(i=this._over(e,t,i)).over?(this._targetEnterFired&&0<i.target.length&&this._oldtarget&&0<this._oldtarget.length&&i.target[0]!=this._oldtarget[0]&&(this._raiseEvent(4,{target:this._oldtarget}),this.onDropTargetLeave&&"function"==typeof this.onDropTargetLeave&&this.onDropTargetLeave(this._oldtarget)),(!this._targetEnterFired||0<i.target.length&&this._oldtarget&&0<this._oldtarget.length&&i.target[0]!=this._oldtarget[0])&&(this._targetEnterFired=!0,this._raiseEvent(3,{target:i.target}),this.onDropTargetEnter&&"function"==typeof this.onDropTargetEnter&&this.onDropTargetEnter(i.target)),this._oldtarget=i.target):this._targetEnterFired&&(this._targetEnterFired=!1,this._raiseEvent(4,{target:this._oldtarget||i.target}),this.onDropTargetLeave&&"function"==typeof this.onDropTargetLeave&&this.onDropTargetLeave(this._oldtarget||i.target)))},_mouseStop:function(e){var t=this._fixPosition(),i={width:this.host.outerWidth(),height:this.host.outerHeight()};return this.feedback[0].style.opacity=this._oldOpacity,this.revert||(this.feedback[0].style.zIndex=this._zIndexBackup),this._enableSelection(this.host),this.dropped&&(this.dropped,this.dropped=!1),(this.element&&this.element.parentNode||"original"!==this.feedback)&&(this._dropElement(t),this.feedback.removeClass(this.toThemeProperty("jqx-draggable-dragging")),this._raiseEvent(1,e),this.onDragEnd&&"function"==typeof this.onDragEnd&&this.onDragEnd(this.data),this.onTargetDrop&&"function"==typeof this.onTargetDrop&&this._over(t,i.width,i.height).over&&this.onTargetDrop(this._over(t,i.width,i.height).target),this._revertHandler()),!1},_dropElement:function(e){var t;"default"===this.dropAction&&this.feedback&&this.feedback[0]!==this.element&&"original"!==this.feedback&&(this.revert||/(fixed|absolute)/.test(this.host.css("position"))||(this.host.css("position","relative"),t=this._getRelativeOffset(this.host),(e=this.position).left-=t.left,e.top-=t.top,this.element.style.left=e.left+"px",this.element.style.top=e.top+"px"))},_revertHandler:function(){var e;(this.revert||l.isFunction(this.revert)&&this.revert())&&("original"!=(e=this)._feedbackType?null!=this.feedback&&("none"!=this.dropAction?l(this.feedback).animate({left:e.originalPosition.left-e._offset.hostRelative.left,top:e.originalPosition.top-e._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){e.feedback&&e.feedback[0]&&"original"!==e._feedbackType&&"function"==typeof e.feedback.remove&&e.feedback.remove()}):e.feedback&&e.feedback[0]&&"original"!==e._feedbackType&&"function"==typeof e.feedback.remove&&e.feedback.remove()):(this.element.style.zIndex=this.dragZIndex,l(this.host).animate({left:e.originalPosition.left-e._offset.hostRelative.left,top:e.originalPosition.top-e._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){e.element.style.zIndex=e._zIndexBackup})))},_getHandle:function(e){var t;return this.handle?l(this.handle,this.host).find("*").andSelf().each(function(){this==e.target&&(t=!0)}):t=!0,t},_createFeedback:function(e){var t="function"==typeof this._feedbackType?this._feedbackType():"clone"===this._feedbackType?this.host.clone().removeAttr("id"):this.host;return/(absolute|fixed)/.test(t.css("position"))||t.css("position","absolute"),this.appendTo[0]===this.host.parent()[0]&&t[0]===this.element||(t.css({left:this.host.offset().left-this._getParentOffset(this.host).left+this._getParentOffset(t).left,top:this.host.offset().top-this._getParentOffset(this.host).top+this._getParentOffset(t).top}),t.appendTo(this.appendTo)),"function"==typeof this.initFeedback&&this.initFeedback(t),t},_getParentOffset:function(e){e=e||this.feedback;this._offsetParent=e.offsetParent();e=this._offsetParent.offset();return"absolute"==this._positionType&&this._scrollParent[0]!==document&&l.contains(this._scrollParent[0],this._offsetParent[0])&&(e.left+=this._scrollParent.scrollLeft(),e.top+=this._scrollParent.scrollTop()),(this._offsetParent[0]==document.body||this._offsetParent[0].tagName&&"html"==this._offsetParent[0].tagName.toLowerCase()&&l.jqx.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this._offsetParent.css("border-top-width"),10)||0),left:e.left+(parseInt(this._offsetParent.css("border-left-width"),10)||0)}},_getRelativeOffset:function(e){this._scrollParent||e.parent();if("relative"!==(e=e||this.feedback).css("position"))return{top:0,left:0};var t=this.host.position();return{top:t.top-(parseInt(e.css("top"),10)||0),left:t.left-(parseInt(e.css("left"),10)||0)}},_backupeMargins:function(){this.margins={left:parseInt(this.host.css("margin-left"),10)||0,top:parseInt(this.host.css("margin-top"),10)||0,right:parseInt(this.host.css("margin-right"),10)||0,bottom:parseInt(this.host.css("margin-bottom"),10)||0}},_backupFeedbackProportions:function(){this.feedback[0].style.opacity=this.opacity,this._feedbackProportions={width:this.feedback.outerWidth(),height:this.feedback.outerHeight()}},_setRestricter:function(){"parent"==this.restricter&&(this.restricter=this.feedback[0].parentNode),"document"!=this.restricter&&"window"!=this.restricter||this._handleNativeRestricter(),void 0!==this.restricter.left&&void 0!==this.restricter.top&&void 0!==this.restricter.height&&void 0!==this.restricter.width?this._restricter=[this.restricter.left,this.restricter.top,this.restricter.width,this.restricter.height]:/^(document|window|parent)$/.test(this.restricter)||this.restricter.constructor==Array?this.restricter.constructor==Array&&(this._restricter=this.restricter):this._handleDOMParentRestricter()},_handleNativeRestricter:function(){this._restricter=["document"===this.restricter?0:l(window).scrollLeft()-this._offset.relative.left-this._offset.parent.left,"document"===this.restricter?0:l(window).scrollTop()-this._offset.relative.top-this._offset.parent.top,("document"===this.restricter?0:l(window).scrollLeft())+l("document"===this.restricter?document:window).width()-this._feedbackProportions.width-this.margins.left,("document"===this.restricter?0:l(window).scrollTop())+(l("document"===this.restricter?document:window).height()||document.body.parentNode.scrollHeight)-this._feedbackProportions.height-this.margins.top]},_handleDOMParentRestricter:function(){var e,t=l(this.restricter),i=t[0];i&&(e="hidden"!==l(i).css("overflow"),this._restricter=[(parseInt(l(i).css("borderLeftWidth"),10)||0)+(parseInt(l(i).css("paddingLeft"),10)||0),(parseInt(l(i).css("borderTopWidth"),10)||0)+(parseInt(l(i).css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(l(i).css("borderLeftWidth"),10)||0)-(parseInt(l(i).css("paddingRight"),10)||0)-this._feedbackProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(l(i).css("borderTopWidth"),10)||0)-(parseInt(l(i).css("paddingBottom"),10)||0)-this._feedbackProportions.height-this.margins.top-this.margins.bottom],this._restrictiveContainer=t)},_convertPositionTo:function(e,t){var i,r;return t=t||this.position,i="absolute"===e?1:-1,r="absolute"!==this._positionType||this._scrollParent[0]!=document&&l.contains(this._scrollParent[0],this._offsetParent[0])?this._scrollParent:this._offsetParent,e=/(html|body)/i.test(r[0].tagName),this._getPosition(t,i,e,r)},_getPosition:function(e,t,i,r){return{top:e.top+this._offset.relative.top*t+this._offset.parent.top*t-(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:("fixed"==this._positionType?-this._scrollParent.scrollTop():i?0:r.scrollTop())*t),left:e.left+this._offset.relative.left*t+this._offset.parent.left*t-(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:("fixed"==this._positionType?-this._scrollParent.scrollLeft():i?0:r.scrollLeft())*t)}},_generatePosition:function(e){var t,i="absolute"!=this._positionType||this._scrollParent[0]!=document&&l.contains(this._scrollParent[0],this._offsetParent[0])?this._scrollParent:this._offsetParent,r=/(html|body)/i.test(i[0].tagName),s=this._getMouseCoordinates(e),o=s.left,e=s.top;return this.originalPosition&&this.restricter&&(t=this._restrictiveContainer?(t=this._restrictiveContainer.offset(),[this._restricter[0]+t.left,this._restricter[1]+t.top,this._restricter[2]+t.left,this._restricter[3]+t.top]):this._restricter,s.left-this._offset.click.left<t[0]&&(o=t[0]+this._offset.click.left),s.top-this._offset.click.top<t[1]&&(e=t[1]+this._offset.click.top),s.left-this._offset.click.left>t[2]&&(o=t[2]+this._offset.click.left),s.top-this._offset.click.top>t[3]&&(e=t[3]+this._offset.click.top)),{top:e-this._offset.click.top-this._offset.relative.top-this._offset.parent.top+(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:"fixed"==this._positionType?-this._scrollParent.scrollTop():r?0:i.scrollTop()),left:o-this._offset.click.left-this._offset.relative.left-this._offset.parent.left+(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:"fixed"==this._positionType?-this._scrollParent.scrollLeft():r?0:i.scrollLeft())}},_raiseEvent:function(e,t){if(null==this.triggerEvents||0!=this.triggerEvents){e=this._events[e],e=l.Event(e);return(t=t||{}).position=this.position,t.element=this.element,l.extend(t,this.data),t.feedback=this.feedback,e.args=t,this.host.trigger(e)}},disable:function(){this.disabled=!0,this.host.addClass(this.toThemeProperty("jqx-draggable-disabled")),this._enableSelection(this.host)},enable:function(){this.disabled=!1,this.host.removeClass(this.toThemeProperty("jqx-draggable-disabled"))},propertyChangedHandler:function(e,t,i,r){"dropTarget"===t?"string"==typeof r&&(e.dropTarget=l(r)):"disabled"==t?r&&e._enableSelection(e.host):"cursor"==t&&e.host.css("cursor",e.cursor)}})}(jqxBaseFramework),function(f){window.jqxListBoxDragDrop=function(){f.extend(f.jqx._jqxListBox.prototype,{_hitTestBounds:function(e,t,i){var r=e.host.offset(),s=i-parseInt(r.top),o=t-parseInt(r.left),i=e._hitTest(o,s);if(s<0)return null;if(null!=i){o=parseInt(r.left),r=o+e.host.width();return o<=t+i.width/2&&t<=r?i:null}if(e.items&&0<e.items.length){i=e.items[e.items.length-1];if(e.groups.length<2&&i.top+i.height+15>=s)return i}return null},_handleDragStart:function(e,r){f.jqx.mobile.isTouchDevice()&&r.allowDrag&&e.on(f.jqx.mobile.getTouchEventName("touchstart"),function(){f.jqx.mobile.setTouchScroll(!1,r.element.id)}),e.off("dragStart"),e.on("dragStart",function(e){if(r.allowDrag&&!r.disabled){r.feedbackElement=f("<div style='z-index: 99999; position: absolute;'></div>"),r.feedbackElement.addClass(r.toThemeProperty("jqx-listbox-feedback")),r.feedbackElement.appendTo(f(document.body)),r.feedbackElement.hide(),r.isDragging=!0,r._dragCancel=!1;var t=r._getMouseCoordinates(e),i=r._hitTestBounds(r,t.left,t.top),t=f.find(".jqx-listbox");r._listBoxes=t,f.each(r._listBoxes,function(){var e;f.jqx.isHidden(f(this))||((e=f.data(this,"jqxListBox").instance)._enableHover=e.enableHover,e.enableHover=!1,f.jqx.mobile.setTouchScroll(!1,r.element.id))});t=function(){r._dragCancel=!0,f(e.args.element).jqxDragDrop({triggerEvents:!1}),f(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(r._autoScrollTimer),f(e.args.element).jqxDragDrop({triggerEvents:!0}),f.each(r._listBoxes,function(){var e;f.jqx.isHidden(f(this))||null!=(e=f.data(this,"jqxListBox").instance)._enableHover&&(e.enableHover=e._enableHover,f.jqx.mobile.setTouchScroll(!0,r.element.id))})};if(null==i||i.isGroup)null==i&&t();else{if(r._dragItem=i,r.dragStart)if(0==r.dragStart(i))return t(),!1;i.disabled&&t(),r._raiseEvent(4,{label:i.label,value:i.value,dragSourceElement:r.element,originalEvent:e.args})}}return!1})},_handleDragging:function(e,c){var t=this;e.off("dragging"),e.on("dragging",function(e){var l,d,h=e.args;c._dragCancel||(l=c._getMouseCoordinates(e),c._lastDraggingPosition=l,c._dragOverItem=null,c.feedbackElement.hide(),d=t._getBestMatchItem(c,l),f.each(c._listBoxes,function(){if(f.jqx.isHidden(f(this)))return!0;var e=f(this).offset(),t=e.top+20,i=f(this).height()+t-40,r=e.left,s=r+f(this).width(),o=f.data(this,"jqxListBox").instance,n=o._hitTestBounds(o,l.left,l.top),a=o.vScrollInstance;n&&o.allowDrop&&!o.disabled&&n.element&&d&&d.item&&f(this)[0]==d.item[0]&&(c._dragOverItem=n,c.feedbackElement.show(),e=f(n.element).offset().top+1,l.top>e+n.height/2&&(e+=n.height),c.feedbackElement.css("top",e),c.feedbackElement.css("left",r),"visible"!=o.vScrollBar.css("visibility")?c.feedbackElement.width(f(this).width()):c.feedbackElement.width(f(this).width()-20),l.left>=r&&l.left<s?h.position.top<t&&h.position.top>=t-30?(clearInterval(o._autoScrollTimer),0!=a.value&&c.feedbackElement.hide(),o._autoScrollTimer=setInterval(function(){o.scrollUp()||clearInterval(o._autoScrollTimer)},100)):h.position.top>i&&h.position.top<30+i?(clearInterval(o._autoScrollTimer),"hidden"!=o.vScrollBar.css("visibility")&&a.value!=a.max&&c.feedbackElement.hide(),o._autoScrollTimer=setInterval(function(){o.scrollDown()||clearInterval(o._autoScrollTimer)},100)):clearInterval(o._autoScrollTimer):(null==c._dragOverItem&&c.feedbackElement.hide(),clearInterval(o._autoScrollTimer)))}))})},_getBestMatchItem:function(e,t){for(var i={},r=f.find(".jqx-listbox"),s=0;s<r.length;s++){var o,n,a,l,d,h=f(r[s]);f.jqx.isHidden(h)||(d=(o=parseInt(h.offset().left))+h.width(),l=h.jqxListBox("getInstance"),clearInterval(l._autoScrollTimer),null!=l._enableHover&&(l.enableHover=l._enableHover,f.jqx.mobile.setTouchScroll(!0,e.element.id)),null!=e._dragItem&&(n=t.left>=o&&t.left<=d,a=t.left-e._dragItem.width/2>=o&&t.left-e._dragItem.width/2<=d,l=t.left-e._dragItem.width/2>=o&&t.left-e._dragItem.width/2<=d,(n||a||l)&&(l=(a=parseInt(h.offset().top))+h.height(),t.top>=a&&t.top<=l&&(d=t.left+e._dragItem.width/2-(o+d)/2,(isNaN(i.distance)||i.distance>d)&&(i={distance:d,item:h})))))}return i},_handleDragEnd:function(e,d){var h=this;f.find(".jqx-listbox");e.off("dragEnd"),e.on("dragEnd",function(e){clearInterval(d._autoScrollTimer);var t=f.jqx.mobile.isTouchDevice()?d._lastDraggingPosition:d._getMouseCoordinates(e);f.find(".jqx-listbox");if(d.feedbackElement.remove(),!d._dragCancel){var i=h._getBestMatchItem(d,t).item,r=d._dragItem,s=null;if(null!=i&&0<i.length){var o=(n=f.data(i[0],"jqxListBox").instance).allowDrop,s=n.element;if(o&&!n.disabled){var n,a=(n=f.data(i[0],"jqxListBox").instance)._hitTestBounds(n,t.left,t.top);if(null==(a=d._dragOverItem)||a.isGroup){if("none"!=n.dropAction){if(0<n.content.find(".draggable").length&&n.content.find(".draggable").jqxDragDrop("destroy"),d.dragEnd){if(0==(l=d.dragEnd(d._dragItem,null,e.args)))return f(e.args.element).jqxDragDrop({triggerEvents:!1}),f(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(d._autoScrollTimer),f(e.args.element).jqxDragDrop({triggerEvents:!0}),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1;null==l&&(l=!0)}n.addItem(d._dragItem),"default"==n.dropAction&&(0<r.visibleIndex&&d.selectIndex(r.visibleIndex-1),d.removeItem(r,!0)),n.clearSelection(),n.selectIndex(n.items.length-1)}}else{var l=!0;if(d.dragEnd){if(0==(l=d.dragEnd(r,a,e.args)))return f(e.args.element).jqxDragDrop({triggerEvents:!1}),f(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(d._autoScrollTimer),f(e.args.element).jqxDragDrop({triggerEvents:!0}),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1;null==l&&(l=!0)}l&&(a.visibleIndex,"none"!=n.dropAction&&(l=a.element?f(a.element).offset().top+1:f(n.element).offset().top+1,0<n.content.find(".draggable").length&&n.content.find(".draggable").jqxDragDrop("destroy"),t.top>l+a.height/2?n.insertAt(d._dragItem,a.index+1):n.insertAt(d._dragItem,a.index),"default"==d.dropAction&&(0<r.visibleIndex&&(d.clearSelection(),d.selectIndex(r.visibleIndex-1)),d.removeItem(r,!0)),l=function(){for(var e=a.visibleIndex,t=e-2;t<=e+2;t++)if(n.items&&n.items.length>t){var i=n.items[t];if(null!=i&&i.value==r.value)return i.visibleIndex}return e}(),n.clearSelection(),n.selectIndex(l)))}}}else if(d.dragEnd)if(0==d.dragEnd(r,e.args))return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1;return null!=r&&d._raiseEvent(5,{label:r.label,value:r.value,index:r.index,dropTargetElement:s,originalEvent:e.args}),!1}e.stopPropagation()})},_enableDragDrop:function(){var e,r;this.allowDrag&&this.host.jqxDragDrop&&(0<(e=this.content.find(".draggable")).length&&(r=this,e.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:!0,initFeedback:function(e){var t=f('<span style="white-space: nowrap;" class="'+r.toThemeProperty("jqx-fill-state-normal")+'">'+e.text()+"</span>");f(document.body).append(t);var i=t.width();t.remove(),e.width(i+5),e.addClass(r.toThemeProperty("jqx-fill-state-pressed"))}}),this._autoScrollTimer=null,r._dragItem=null,r._handleDragStart(e,r),r._handleDragging(e,r),r._handleDragEnd(e,r)))},_getMouseCoordinates:function(e){if(this._isTouchDevice=f.jqx.mobile.isTouchDevice(),this._isTouchDevice){var t=f.jqx.position(e.args);return{left:t.left,top:t.top}}return{left:e.args.pageX,top:e.args.pageY}}})},window.jqxTreeDragDrop=function(){f.extend(f.jqx._jqxTree.prototype,{_hitTestBounds:function(i,r,s){var o,n,a=null;return i._visibleItems&&(o=parseInt(i.host.offset().left),n=i.host.outerWidth(),f.each(i._visibleItems,function(e){if(o<=r&&r<o+n&&this.top+5<s&&s<this.top+this.height){var t=f(this.element).parents("li:first");if(0<t.length&&null!=(a=i.getItem(t[0])))return a.height=this.height,a.top=this.top,!1}})),a},_handleDragStart:function(e,r){r._dragOverItem&&r._dragOverItem.titleElement.removeClass(r.toThemeProperty("jqx-fill-state-hover")),f.jqx.mobile.isTouchDevice()&&r.allowDrag&&e.on(f.jqx.mobile.getTouchEventName("touchstart"),function(){f.jqx.mobile.setTouchScroll(!1,"panel"+r.element.id)}),e.off("dragStart"),e.on("dragStart",function(i){r.feedbackElement=f("<div style='z-index: 99999; position: absolute;'></div>"),r.feedbackElement.addClass(r.toThemeProperty("jqx-listbox-feedback")),r.feedbackElement.appendTo(f(document.body)),r.feedbackElement.hide(),r._dragCancel=!1;i.args.position;var e=f.find(".jqx-tree");return r._trees=e,f.each(e,function(){var e=f.data(this,"jqxTree").instance,t=e.host.find(".draggable");if(e._syncItems(t),e.allowDrag&&!e.disabled){t=f(i.target).parents("li:first");if(0<t.length){t=e.getItem(t[0]);if(t){if(r._dragItem=t,e.dragStart)if(0==e.dragStart(t))return r._dragCancel=!0,f(i.args.element).jqxDragDrop({triggerEvents:!1}),f(i.args.element).jqxDragDrop("cancelDrag"),clearInterval(r._autoScrollTimer),f(i.args.element).jqxDragDrop({triggerEvents:e}),!1;e._raiseEvent(8,{label:t.label,value:t.value,originalEvent:i.args})}}}}),!1})},_getMouseCoordinates:function(e){if(this._isTouchDevice=f.jqx.mobile.isTouchDevice(),this._isTouchDevice){var t=f.jqx.position(e.args);return{left:t.left,top:t.top}}return{left:e.args.pageX,top:e.args.pageY}},_handleDragging:function(e,c){(e=this.host.find(".draggable")).off("dragging"),e.on("dragging",function(e){e.args.position;var d,h,t=c._trees;c._dragCancel||(c._dragOverItem&&c._dragOverItem.titleElement.removeClass(c.toThemeProperty("jqx-fill-state-hover")),d=!0,h=c._getMouseCoordinates(e),c._lastDraggingPosition=h,f.each(t,function(){if(f.jqx.isHidden(f(this)))return!0;var e,t,i,r=f(this).offset(),s=r.top+20,o=f(this).height()+s-40,n=r.left,a=n+f(this).width(),l=f.data(this,"jqxTree").instance;!l.disabled&&l.allowDrop&&(e=l.vScrollInstance,null!=(t=l._hitTestBounds(l,h.left,h.top))&&(c._dragOverItem&&c._dragOverItem.titleElement.removeClass(l.toThemeProperty("jqx-fill-state-hover")),(c._dragOverItem=t).element&&(c.feedbackElement.show(),i=t.top,r=h.top,c._dropPosition="before",r>i+t.height/3&&(i=t.top+t.height/2,c._dragOverItem.titleElement.addClass(c.toThemeProperty("jqx-fill-state-hover")),c.feedbackElement.hide(),c._dropPosition="inside"),r>t.top+t.height-t.height/3&&(i=t.top+t.height,c._dragOverItem.titleElement.removeClass(c.toThemeProperty("jqx-fill-state-hover")),c.feedbackElement.show(),c._dropPosition="after"),c.feedbackElement.css("top",i),n=-2+parseInt(t.titleElement.offset().left),c.feedbackElement.css("left",n),c.feedbackElement.width(f(t.titleElement).width()+12))),h.left>=n&&h.left<a?(h.top+20>=s&&h.top<=s+l.host.height()&&(d=!1),h.top<s&&h.top>=s-30?(clearInterval(l._autoScrollTimer),0!=e.value&&c.feedbackElement.hide(),l._autoScrollTimer=setInterval(function(){var e=l.panelInstance.scrollUp(),t=l.host.find(".draggable");l._syncItems(t),e||clearInterval(l._autoScrollTimer)},100)):h.top>o&&h.top<30+o?(clearInterval(l._autoScrollTimer),e.value!=e.max&&c.feedbackElement.hide(),l._autoScrollTimer=setInterval(function(){var e=l.panelInstance.scrollDown(),t=l.host.find(".draggable");l._syncItems(t),e||clearInterval(l._autoScrollTimer)},100)):clearInterval(l._autoScrollTimer)):clearInterval(l._autoScrollTimer))}),d&&c.feedbackElement&&c.feedbackElement.hide())})},_handleDragEnd:function(e,d){e.off("dragEnd"),e.on("dragEnd",function(e){d.host.find(".draggable");clearInterval(d._autoScrollTimer);e.args.position;var t=d._trees,r=null,s=f.jqx.mobile.isTouchDevice()?d._lastDraggingPosition:d._getMouseCoordinates(e);if(d.feedbackElement.remove(),d._dragCancel)return!1;d._dragOverItem&&d._dragOverItem.titleElement.removeClass(d.toThemeProperty("jqx-fill-state-hover")),f.each(t,function(){if(f.jqx.isHidden(f(this)))return!0;var e=parseInt(f(this).offset().left),t=e+f(this).width(),i=f.data(this,"jqxTree").instance;clearInterval(i._autoScrollTimer),null!=d._dragItem&&s.left>=e&&s.left<t&&(t=(e=parseInt(f(this).offset().top))+f(this).height(),s.top>=e&&s.top<=t&&(r=f(this)))});var i,o,n,a,l=d._dragItem;if(null!=r&&0<r.length)r.jqxTree("allowDrop")&&(i=f.data(r[0],"jqxTree").instance,null!=(o=d._dragOverItem)&&d._dragOverItem.treeInstance.element.id==i.element.id?(n=!0,d.dragEnd&&(0==(n=d.dragEnd(l,o,e.args,d._dropPosition,r))&&(f(e.args.element).jqxDragDrop({triggerEvents:!1}),f(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(d._autoScrollTimer),f(e.args.element).jqxDragDrop({triggerEvents:!0})),null==n&&(n=!0)),n&&(a=function(){var e=d._dragItem.treeInstance;e._refreshMapping(),e._updateItemsNavigation(),e._render(!0,!1),e.checkboxes&&e._updateCheckStates(),d._dragItem.treeInstance=i,d._syncItems(d._dragItem.treeInstance.host.find(".draggable"))},"none"!=i.dropAction&&d._dragItem.id!=d._dragOverItem.id&&("inside"==d._dropPosition?i._drop(d._dragItem.element,d._dragOverItem.element,-1,i):(t=0,"after"==d._dropPosition&&t++,i._drop(d._dragItem.element,d._dragOverItem.parentElement,t+f(d._dragOverItem.element).index(),i)),a()),i._render(!0,!1),a=i.host.find(".draggable"),d._syncItems(a),d._dragOverItem=null,d._dragItem=null,i._refreshMapping(),i._updateItemsNavigation(),i.selectedItem=null,i.selectItem(l.element),i.checkboxes&&i._updateCheckStates(),i._render(!0,!1))):"none"!=i.dropAction&&i.allowDrop&&(n=!0,d.dragEnd&&(0==(n=d.dragEnd(l,o,e.args,d._dropPosition,r))&&(f(e.args.element).jqxDragDrop({triggerEvents:!1}),f(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(d._autoScrollTimer),f(e.args.element).jqxDragDrop({triggerEvents:!0})),null==n&&(n=!0)),n&&(d._dragItem.parentElement=null,i._drop(d._dragItem.element,null,-1,i),(n=d._dragItem.treeInstance)._refreshMapping(),n._updateItemsNavigation(),n.checkboxes&&n._updateCheckStates(),a=n.host.find(".draggable"),d._syncItems(a),(d._dragItem.treeInstance=i).items[i.items.length]=d._dragItem,i._render(!0,!1),i._refreshMapping(),i.selectItem(l.element),i._updateItemsNavigation(),a=i.host.find(".draggable"),i._syncItems(a),i.checkboxes&&i._updateCheckStates(),d._dragOverItem=null,d._dragItem=null)));else if(d.dragEnd&&0==d.dragEnd(l,e.args))return!1;return null!=l&&d._raiseEvent(7,{label:l.label,value:l.value,originalEvent:e.args}),!1})},_drop:function(e,t,i,r){var s,o,n,a;0<f(t).parents("#"+e.id).length||null!=t&&t.id==e.id||(r.element.innerHTML.indexOf("UL")&&(s=r.host.find("ul:first")),null==t&&null==t?null==i||-1==i?s.append(e):0==s.children("li").eq(i).length?s.children("li").eq(i-1).after(e):s.children("li").eq(i)[0].id!=e.id&&s.children("li").eq(i).before(e):null==i||-1==i?0==(o=(t=f(t)).find("ul:first")).length?(n=f("<ul></ul>"),f(t).append(n),o=t.find("ul:first"),(a=r.itemMapping["id"+t[0].id].item).subtreeElement=o[0],a.hasItems=!0,o.addClass(r.toThemeProperty("jqx-tree-dropdown")),o.append(e),e=o.find("li:first"),a.parentElement=e):o.append(e):0==(o=(t=f(t)).find("ul:first")).length?(n=f("<ul></ul>"),f(t).append(n),o=t.find("ul:first"),t&&((a=r.itemMapping["id"+t[0].id].item).subtreeElement=o[0],a.hasItems=!0),o.addClass(r.toThemeProperty("jqx-tree-dropdown")),o.append(e),e=o.find("li:first"),a.parentElement=e):0==o.children("li").eq(i).length?o.children("li").eq(i-1).after(e):o.children("li").eq(i)[0].id!=e.id&&o.children("li").eq(i).before(e))},_enableDragDrop:function(){var e,r;this.allowDrag&&this.host.jqxDragDrop&&(e=this.host.find(".draggable"),r=this,0<e.length&&(e.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:!0,initFeedback:function(e){var t=f('<span style="white-space: nowrap;" class="'+r.toThemeProperty("jqx-fill-state-normal")+'">'+e.text()+"</span>");f(document.body).append(t);var i=t.width();t.remove(),e.width(i+5),e.addClass(r.toThemeProperty("jqx-fill-state-pressed"))}}),!0===e.jqxDragDrop("isDestroyed")&&e.jqxDragDrop("_createDragDrop"),this._autoScrollTimer=null,r._dragItem=null,r._handleDragStart(e,r),r._handleDragging(e,r),r._handleDragEnd(e,r)))}})}}(jqxBaseFramework);