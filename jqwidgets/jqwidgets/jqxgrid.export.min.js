!function(P){P.extend(P.jqx._jqxGrid.prototype,{_exportData:function(e,t,r){var a=this,s=(s="string"==typeof t?t:t.fileName)||"jqxGrid";t&&"string"!=typeof t||(t={header:!0,filterBy:null,groupBy:null,style:null,fileName:s,pageOrientation:"portrait",expandChart:"+",collapseChar:"-"});var l=new P.jqx.dataAdapter.DataExporter({exportHeader:t.header});l.expandChar=t.expandChar,l.collapseChar=t.collapseChar,l.pageOrientation=t.pageOrientation,l.style=t.style,l.filterBy=t.filterBy,l.groupBy=t.groupBy;for(var o=[],i=a.columngroups||[],n=0,d=0;d<a.columns.records.length;d++)(x=a.columns.records[d]).exportable&&null!==a.columns.records[d].datafield&&(o[n++]={label:a.columns.records[d].text,dataField:a.columns.records[d].datafield});if(l.header={columns:o,columngroups:i},!t.style){var h=window.getComputedStyle(a.element),f=window.getComputedStyle(0<a.columns.records.length&&a.columns.records[0].element?a.columns.records[0].element:a.host.find(".jqx-grid-header")[0]),s=window.getComputedStyle(a.host.find(".jqx-grid-header")[0]);if(!(0===a.offsetWidth||0===a.offsetHeight)){for(var c,i=function(e){function o(e){return isNaN(e)?"00":l[(e-e%16)/16]+l[e%16]}var t=e.fontSize,r=e.borderRightColor,s=e.backgroundColor,i=e.color,l=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),e=function(e){if(-1==e.toString().indexOf("rgba"))return(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))?"#"+o(e[1])+o(e[2])+o(e[3]).toUpperCase():"#ffffff";var t=i.split(","),r=parseInt(t[0].substring(5)),s=parseInt(t[1]),l=parseInt(t[2]),e=parseFloat(t[3].substring(1,4)),t={r:r,g:s,b:l},t=a._rgbToHex(t);return 0==r&&0==s&&0==l&&0==e?"#ffffff":"#"+t};return{borderColor:e(r),fontSize:t,fontFamily:"Helvetica",color:e(i),backgroundColor:e(s)}},h=i(h),f=i(f),s=i(s),g={height:"30px",border:"1px solid "+h.borderColor,fontFamily:s.fontFamily,fontSize:s.fontSize,color:s.color,backgroundColor:f.backgroundColor,fontWeight:"400"},u={border:"1px solid "+h.borderColor,fontFamily:h.fontFamily,fontSize:h.fontSize},f={height:a.rowsheight+"px"},d=0;d<a.columns.records.length;d++)(x=a.columns.records[d]).exportable&&(g[x.datafield]={textAlign:x.align,width:x.width+"px",format:x.cellsformat||""},c=x.cellsformat||"","date"===x.dataType?c="d":"dateTime"===x.dataType?c="D":"time"===x.dataType&&(c="t"),c={textAlign:x.cellsalign,format:c},u[x.datafield]=c);a.altrows&&(f.alternationCount=2,f.alternationStart=0,f.alternationEnd=0,f.alternationIndex0Color=h.color,f.alternationIndex0BackgroundColor=h.backgroundColor,f.alternationIndex1Color=h.color,f.alternationIndex1BackgroundColor="#F5F5F5"),l.style={border:"1px solid "+h.borderColor,borderCollapse:"collapse",header:g,columns:u,rows:f}}}for(var p=r||this.getrows(),m=[],d=0;d<p.length;d++){var y=p[d];if(!y.hidden){for(var x,b={},v=0;v<a.columns.records.length;v++)(x=a.columns.records[v]).exportable&&(b[x.datafield]=y[x.datafield]);m.push(b)}}return!t.groupBy&&a.groups&&(l.groupBy=a.groups.slice(0)),l.exportData(m,e,t.fileName,null)},exportview:function(e,t,r){this._exportData(e,t,r)},exportdata:function(h,e,n,f,t,r,s){if(!P.jqx.dataAdapter.ArrayExporter)throw"jqxGrid: Missing reference to jqxdata.export.js!";if("xlsx"!==h){null==n&&(n=!0);var c=this;if(null==f)if(0==(f=this.getrows()).length)throw"No data to export.";this.exporting=!0,this.pageable||(this.loadondemand=!0),this.altrows&&this._renderrows(this.virtualsizeinfo);var l=this.hScrollInstance.value;this.hScrollInstance.setPosition(0),this._renderrows(this.virtualsizeinfo);var g=null!=t&&t,u={},p={},o=this.host.find(".jqx-grid-cell:first"),t=this.host.find(".jqx-grid-cell-alt:first");o.removeClass(this.toThemeProperty("jqx-grid-cell-selected")),o.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),t.removeClass(this.toThemeProperty("jqx-grid-cell-selected")),t.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),o.removeClass(this.toThemeProperty("jqx-grid-cell-hover")),o.removeClass(this.toThemeProperty("jqx-fill-state-hover")),t.removeClass(this.toThemeProperty("jqx-grid-cell-hover")),t.removeClass(this.toThemeProperty("jqx-fill-state-hover"));for(var m,y="cell",x=1,b=1,v=[],i=0;i<this.columns.records.length;i++){var a=this.columns.records[i];if(""!=a.cellclassname)if(a.customCellStyles=new Array,"string"==typeof a.cellclassname)for(var d=0;d<f.length;d++)a.customCellStyles[d]=a.cellclassname;else for(d=0;d<f.length;d++){var w=this.getrowboundindex(d),w=a.cellclassname(w,a.displayfield,f[d][a.displayfield],f[d]);w&&(a.customCellStyles[d]=w)}}var C,S,T,j=new Array,q=null,F=null,_=null;P.each(this.columns.records,function(e){var t,r=P(c.table[0].rows[0].cells[e]);1<c.table[0].rows.length&&(t=P(c.table[0].rows[1].cells[e]),_=_||t),F=F||r;var s=this,l=function(e){if(e.removeClass(c.toThemeProperty("jqx-grid-cell-selected")),e.removeClass(c.toThemeProperty("jqx-fill-state-pressed")),e.removeClass(c.toThemeProperty("jqx-grid-cell-hover")),e.removeClass(c.toThemeProperty("jqx-fill-state-hover")),s.customCellStyles)for(var t in s.customCellStyles)e.removeClass(s.customCellStyles[t])};if(l(r),t&&l(t),null==this.displayfield)return!0;c.showaggregates&&c.getcolumnaggregateddata&&v.push(c.getcolumnaggregateddata(this.displayfield,this.aggregates,!0,f));var d=c._getexportcolumntype(this);!this.exportable||this.hidden&&!g||(u[this.displayfield]={},u[this.displayfield].text=this.text,u[this.displayfield].width=parseInt(this.width),isNaN(u[this.displayfield].width)&&(u[this.displayfield].width=60),u[this.displayfield].formatString=this.cellsformat,u[this.displayfield].localization=c.gridlocalization,u[this.displayfield].type=d,u[this.displayfield].cellsAlign=this.cellsalign,u[this.displayfield].hidden=!n,u[this.displayfield].displayfield=this.displayfield,j.push(u[this.displayfield])),y="cell"+x;var o=P(this.element);if(null==this.element&&(o=P(this.uielement)),q?s._rendered||(o=q,r=F,t=_,l=c.toTP("jqx-grid-cell")+" "+c.toTP("jqx-item"),r[0].className=l,l+=c.toTP("jqx-grid-cell-alt"),t&&(t[0].className=l)):q=o,m="column"+b,"html"==h||"xls"==h||"pdf"==h){function i(e,t,r,s,l,o,i,a,n){p[e]={},null!=t&&(0!=t[0].offsetWidth&&0!=t[0].offsetHeight?(p[e]["font-size"]=t.css("font-size"),p[e]["font-weight"]=t.css("font-weight"),p[e]["font-style"]=t.css("font-style"),p[e]["background-color"]=o._getexportcolor(t.css("background-color")),p[e].color=o._getexportcolor(t.css("color")),p[e]["border-color"]=o._getexportcolor(t.css("border-top-color")),r?p[e]["text-align"]=l.align:(p[e]["text-align"]=l.cellsalign,p[e].formatString=l.cellsformat,p[e].dataType=d),"html"!=h&&"pdf"!=h||(p[e]["border-top-width"]=t.css("border-top-width"),p[e]["border-left-width"]=t.css("border-left-width"),p[e]["border-right-width"]=t.css("border-right-width"),p[e]["border-bottom-width"]=t.css("border-bottom-width"),p[e]["border-top-style"]=t.css("border-top-style"),p[e]["border-left-style"]=t.css("border-left-style"),p[e]["border-right-style"]=t.css("border-right-style"),p[e]["border-bottom-style"]=t.css("border-bottom-style"),r?(0==i&&(p[e]["border-left-width"]=t.css("border-right-width")),p[e]["border-top-width"]=t.css("border-right-width"),p[e]["border-bottom-width"]=t.css("border-bottom-width")):0==i&&(p[e]["border-left-width"]=t.css("border-right-width")),p[e].height=t.css("height")),!l.exportable||l.hidden&&!g||(1==a?(u[l.displayfield].customCellStyles||(u[l.displayfield].customCellStyles=new Array),u[l.displayfield].customCellStyles[n]=e):r?u[l.displayfield].style=e:s?u[l.displayfield].cellAltStyle=e:u[l.displayfield].cellStyle=e)):r||(p[e].dataType=d))}if(i(m,o,!0,!1,this,c,e),b++,i(y,r,!1,!1,this,c,e),c.altrows&&i(y="cellalt"+x,t,!1,!0,this,c,e),this.customCellStyles){for(var a in s.customCellStyles)r.removeClass(s.customCellStyles[a]);for(var a in s.customCellStyles)r.addClass(s.customCellStyles[a]),i(y+s.customCellStyles[a],r,!1,!1,this,c,e,!0,a),r.removeClass(s.customCellStyles[a])}x++}}),P.each(this.columns.records,function(e){u[this.displayfield]&&(u[this.displayfield].columnsDataFields=j)}),this.showaggregates&&(C=[],S="xls"==h?"_AG":"",T=this.groupable?this.groups.length:0,this.rowdetails&&T++,"checkbox"===this.selectionmode&&T++,0<v.length&&(P.each(this.columns.records,function(e){if(this.aggregates)for(var t,r,s,l=0;l<this.aggregates.length;l++)C[l]||(C[l]={}),C[l]&&(t=c._getaggregatename(this.aggregates[l]),r=c._getaggregatetype(this.aggregates[l]),(s=v[e-T])&&(C[l][this.displayfield]=S+t+": "+s[r]))}),P.each(this.columns.records,function(e){for(var t=0;t<C.length;t++)null==C[t][this.displayfield]&&(C[t][this.displayfield]=S)})),P.each(C,function(){f.push(this)}));var I=this,o=P.jqx.dataAdapter.ArrayExporter(f,u,p);if(null==e){this._renderrows(this.virtualsizeinfo);t=o.exportTo(h);return this.showaggregates&&P.each(C,function(){f.pop(this)}),setTimeout(function(){I.exporting=!1},50),this.hScrollInstance.setPosition(l),this._renderrows(this.virtualsizeinfo),t}o.exportToFile(h,e,r,s),this.showaggregates&&P.each(C,function(){f.pop(this)}),this._renderrows(this.virtualsizeinfo),setTimeout(function(){I.exporting=!1},50),this.hScrollInstance.setPosition(l),this._renderrows(this.virtualsizeinfo)}else this._exportData("xlsx",e)},_getexportcolor:function(e){e="transparent"==e?"#FFFFFF":e;if(e&&e.toString()||(e="#FFFFFF"),-1==e.toString().indexOf("rgb"))return-1!=e.toString().indexOf("#")&&4==e.toString().length&&(t=e.toString().substring(1,4),e+=t),e;var t=e.split(",");if(-1!=e.toString().indexOf("rgba")){var r=parseInt(t[0].substring(5)),s=parseInt(t[1]),l=parseInt(t[2]),e=parseFloat(t[3].substring(1,4)),o={r:r,g:s,b:l},i=this._rgbToHex(o);return 0==r&&0==s&&0==l&&0==e?"#ffffff":"#"+i}o={r:r=parseInt(t[0].substring(4)),g:s=parseInt(t[1]),b:l=parseInt(t[2].substring(1,4))};return"#"+(i=this._rgbToHex(o))},_rgbToHex:function(e){return this._intToHex(e.r)+this._intToHex(e.g)+this._intToHex(e.b)},_intToHex:function(e){e=parseInt(e).toString(16);return 1==e.length&&(e="0"+e),e.toUpperCase()},_getexportcolumntype:function(e){var t="string",r=this.source.datafields||(this.source._source?this.source._source.datafields:null);if(r){var s="";if(P.each(r,function(){if(this.name==e.displayfield)return this.type&&(s=this.type),!1}),s)return s}if(null!=e){if(null==this.dataview.cachedrecords)return t;var l=null;if(this.virtualmode)P.each(this.dataview.cachedrecords,function(){return l=this[e.displayfield],!1});else{if(0==this.dataview.cachedrecords.length)return t;if(null!=(l=this.dataview.cachedrecords[0][e.displayfield])&&""==l.toString())return"string"}if(null!=l){if(-1!=e.cellsformat.indexOf("c"))return"number";if(-1!=e.cellsformat.indexOf("n"))return"number";if(-1!=e.cellsformat.indexOf("p"))return"number";if(-1!=e.cellsformat.indexOf("d"))return"date";if(-1!=e.cellsformat.indexOf("y"))return"date";if(-1!=e.cellsformat.indexOf("M"))return"date";if(-1!=e.cellsformat.indexOf("m"))return"date";if(-1!=e.cellsformat.indexOf("t"))return"date";if("boolean"==typeof l)t="boolean";else if(P.jqx.dataFormat.isNumber(l))t="number";else{r=new Date(l);if("NaN"==r.toString()||"Invalid Date"==r.toString())if(P.jqx.dataFormat){if(null!=(r=P.jqx.dataFormat.tryparsedate(l))){if(r&&r.getFullYear()&&1970==r.getFullYear()&&0==r.getMonth()&&1==r.getDate()){r=new Number(l);return isNaN(r)?"string":"number"}return"date"}t="string"}else t="string";else t="date"}}}return t}})}(jqxBaseFramework);