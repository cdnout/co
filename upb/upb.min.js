// upb.js by the DaAwesomeP

// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
!function(){function e(e,t,r){return r=r||"0",e+="",e.length>=t?e:Array(t-e.length+1).join(r)+e}function t(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0
return!1}var r,n,d={}
r=this,null!=r&&(n=r.upb),d.noConflict=function(){return r.upb=n,d},d.validCommands=["20","activate","21","deactivate","22","goto","23","fadeStart","24","fadeStop","25","blink","26","indicate","27","toggle","30","reportState","31","storeState","80","ackResponse","85","setupTimeReport","86","deviceStateReport","87","deviceStatusReport","8F","deviceSignatureReport","90","registerValuesReport","91","RAMvaluesReport","92","rawDataReport","93","heartbeatReport"],d.defaultCommand={source:255,sendx:1,sendTime:1,ackPulse:!1,idPulse:!1,ackMsg:!1,powerlineRepeater:0},d.generateChecksum=function(e){var t=parseInt(e.hex.ctrlWord.byte1.slice(0,2),16)
return t+=parseInt(e.hex.ctrlWord.byte2.slice(0,2),16),t+=parseInt(e.hex.network.slice(0,2),16),t+=parseInt(e.hex.id.slice(0,2),16),t+=parseInt(e.hex.source.slice(0,2),16),t+=parseInt(e.hex.msg.slice(0,2),16),e.hex.level&&(t+=parseInt(e.hex.level.slice(0,2),16)),e.hex.rate&&(t+=parseInt(e.hex.rate.slice(0,2),16)),e.hex.blinkRate&&(t+=parseInt(e.hex.blinkRate.slice(0,2),16)),e.hex.toggleCount&&(t+=parseInt(e.hex.toggleCount.slice(0,2),16)),e.hex.toggleRate&&(t+=parseInt(e.hex.toggleRate.slice(0,2),16)),e.hex.channel&&(t+=parseInt(e.hex.channel.slice(0,2),16)),t=parseInt(~t+1>>>0).toString(16),t=t.substr(t.length-2)},d.generate=function(r,n){r.network||n(null,Error("No network id specified!")),r.id||n(null,Error("No link or device id specified!")),r.type||n(null,Error("No id type specified!")),r.cmd||n(null,Error("No command specified!")),t(d.validCommands,r.cmd+"")&&"1"!==r.cmd||n(null,Error("Invalid command specified! Please us the correct command name or number.")),0===r.powerlineRepeater&&(r.powerlineRepeater=!1),(r.powerlineRepeater===!0||"true"===r.powerlineRepeater)&&(r.powerlineRepeater=1),r.powerlineRepeater&&1!==r.powerlineRepeater&&2!==r.powerlineRepeater&&4!==r.powerlineRepeater&&r.powerlineRepeater!==!1&&0!==r.powerlineRepeater&&n(null,Error("Power line repeater argument only accepts 1, 2, 4, or false!")),(r.level>100||r.level<0)&&n(null,Error("Level can only be values 0 through 100! Inequality: -1 < L < 101 where variable 'L' is level.")),r.sendTime&&r.sendTime>r.sendx&&n(null,Error("Number of time sent (sendTime) cannot be greater than total number of times sent (sendx)!")),r.source||(r.source=255),r.ctrlWord={},r.ctrlWord.nibble1=0,r.ctrlWord.nibble2=0,r.words=7,r.ctrlWord.nibble3=0,r.ctrlWord.nibble4=0,r.hex={},r.hex.network=parseInt(r.network).toString(16),r.hex.id=parseInt(r.id).toString(16),r.hex.source=parseInt(r.source).toString(16),20===r.cmd||"20"===r.cmd||"activate"==r.cmd?(r.cmd="activate",r.msg=20):21===r.cmd||"21"===r.cmd||"deactivate"==r.cmd?(r.msg=21,r.cmd="deactivate"):22===r.cmd||"22"===r.cmd||"goto"==r.cmd?(r.msg=22,r.cmd="goto"):23===r.cmd||"23"===r.cmd||"fadeStart"==r.cmd?(r.msg=23,r.cmd="fadeStart"):24===r.cmd||"24"===r.cmd||"fadeStop"==r.cmd?(r.msg=24,r.cmd="fadeStop"):25===r.cmd||"25"===r.cmd||"blink"==r.cmd?(r.msg=25,r.cmd="blink"):26===r.cmd||"26"===r.cmd||"indicate"==r.cmd?(r.msg=26,r.cmd="indicate"):27===r.cmd||"27"===r.cmd||"toggle"==r.cmd?(r.msg=27,r.cmd="toggle"):30===r.cmd||"30"===r.cmd||"reportState"==r.cmd?(r.msg=30,r.cmd="reportState"):31===r.cmd||"31"===r.cmd||"storeState"==r.cmd?(r.msg=31,r.cmd="storeState"):80===r.cmd||"80"===r.cmd||"ackResponse"==r.cmd?(r.msg=80,r.cmd="ackResponse"):85===r.cmd||"85"===r.cmd||"setupTimeReport"==r.cmd?(r.msg=85,r.cmd="setupTimeReport"):86===r.cmd||"86"===r.cmd||"deviceStateReport"==r.cmd?(r.msg=86,r.cmd="deviceStateReport"):87===r.cmd||"87"===r.cmd||"deviceStatusReport"==r.cmd?(r.msg=87,r.cmd="deviceStatusReport"):"8F"===r.cmd||"deviceSignatureReport"==r.cmd?(r.msg="8F",r.cmd="deviceSignatureReport"):90===r.cmd||"90"===r.cmd||"registerValuesReport"==r.cmd?(r.msg=90,r.cmd="registerValuesReport"):91===r.cmd||"91"===r.cmd||"RAMvaluesReport"==r.cmd?(r.msg=91,r.cmd="RAMvaluesReport"):92===r.cmd||"92"===r.cmd||"rawDataReport"==r.cmd?(r.msg=92,r.cmd="rawDataReport"):(93===r.cmd||"93"===r.cmd||"heartbeatReport"==r.cmd)&&(r.msg=93,r.cmd="heartbeatReport"),r.hex.msg=parseInt(r.msg,16).toString(16),"goto"!==r.cmd&&"fadeStart"!==r.cmd&&"deviceStateReport"!==r.cmd||r.level||n(null,Error("No level specified! A level must be specified with goto, fadeStart, and deviceStateReport.")),"blink"!==r.cmd||r.blinkRate||n(null,Error("No blink rate specified!")),"toggle"!==r.cmd||r.toggleCount||n(null,Error("No toggle count specified!")),!r.level||"goto"!==r.cmd&&"fadeStart"!==r.cmd&&"fadeStop"!==r.cmd&&"indicate"!==r.cmd||(r.words++,r.hex.level=parseInt(r.level).toString(16)),r.rate&&r.level&&("goto"===r.cmd||"fadeStart"===r.cmd||"indicate"===r.cmd)&&(r.words++,r.hex.rate=parseInt(r.rate).toString(16)),"blink"===r.cmd&&(r.words++,r.hex.blinkRate=parseInt(r.blinkRate).toString(16)),"toggle"===r.cmd&&(r.words++,r.hex.toggleCount=parseInt(r.toggleCount).toString(16)),r.toggleRate&&"toggle"===r.cmd&&(r.words++,r.hex.toggleRate=parseInt(r.toggleRate).toString(16)),r.channel&&"device"===r.type&&r.rate&&("goto"===r.cmd||"fadeStart"===r.cmd||"blink"===r.cmd||"toggle"===r.cmd||"indicate"===r.cmd)&&(r.words++,r.hex.channel=parseInt(r.channel).toString(16)),"link"===r.type&&(r.ctrlWord.nibble1+=8),1===r.powerlineRepeater?r.ctrlWord.nibble1+=2:2===r.powerlineRepeater?r.ctrlWord.nibble1+=4:4===r.powerlineRepeater&&(r.ctrlWord.nibble1+=6),r.ctrlWord.nibble2=r.words,r.ackPulse===!0&&(r.ctrlWord.nibble3+=1),r.idPulse===!0&&(r.ctrlWord.nibble3+=2),r.ackMsg===!0&&(r.ctrlWord.nibble3+=4),2===r.sendx?r.ctrlWord.nibble4+=4:3===r.sendx?r.ctrlWord.nibble4+=8:4===r.sendx&&(r.ctrlWord.nibble4+=12),2===r.sendTime?r.ctrlWord.nibble4+=1:3===r.sendTime?r.ctrlWord.nibble4+=2:4===r.sendTime&&(r.ctrlWord.nibble4+=3),r.hex.ctrlWord={},r.hex.ctrlWord.nibble1=parseInt(r.ctrlWord.nibble1).toString(16),r.hex.ctrlWord.nibble2=parseInt(r.words).toString(16),r.hex.ctrlWord.nibble3=parseInt(r.ctrlWord.nibble3).toString(16),r.hex.ctrlWord.nibble4=parseInt(r.ctrlWord.nibble4).toString(16),r.hex.ctrlWord.byte1=r.hex.ctrlWord.nibble1+r.hex.ctrlWord.nibble2,r.hex.ctrlWord.byte2=r.hex.ctrlWord.nibble3+r.hex.ctrlWord.nibble4,r.generated=r.hex.ctrlWord.byte1,r.generated+=r.hex.ctrlWord.byte2,r.generated+=e(r.hex.network,2,0),r.generated+=e(r.hex.id,2,0),r.generated+=e(r.hex.source,2,0),r.generated+=e(r.msg,2,0),r.hex.level&&(r.generated+=e(r.hex.level,2,0)),r.hex.rate&&(r.generated+=e(r.hex.rate,2,0)),r.hex.blinkRate&&(r.generated+=e(r.hex.blinkRate,2,0)),r.hex.toggleCount&&(r.generated+=e(r.hex.toggleCount,2,0)),r.hex.toggleRate&&(r.generated+=e(r.hex.toggleRate,2,0)),r.hex.channel&&(r.generated+=e(r.hex.channel,2,0)),r.checksum=d.generateChecksum(r),r.generated+=e(r.checksum,2,0),r.generated=r.generated.toUpperCase(),n(r,null)},d.decode=function(e,t){var r=d.defaultCommand
r.hex={},r.generated=e.toUpperCase(),r.hex.ctrlWord={},r.hex.ctrlWord.byte1=r.generated.substring(0,2).toString(16),r.hex.ctrlWord.byte2=r.generated.substring(2,4).toString(16),r.hex.ctrlWord.nibble1=r.generated.substring(0,1).toString(16),r.hex.ctrlWord.nibble2=r.generated.substring(1,2).toString(16),r.hex.ctrlWord.nibble3=r.generated.substring(2,3).toString(16),r.hex.ctrlWord.nibble4=r.generated.substring(3,4).toString(16),r.ctrlWord={},r.ctrlWord.nibble1=parseInt(r.hex.ctrlWord.nibble1,16),r.ctrlWord.nibble2=parseInt(r.hex.ctrlWord.nibble2,16),r.ctrlWord.nibble3=parseInt(r.hex.ctrlWord.nibble3,16),r.ctrlWord.nibble4=parseInt(r.hex.ctrlWord.nibble4,16),r.ctrlWord.nibble1>=8?(r.type="link",r.powerlineRepeater=r.ctrlWord.nibble1-8):(r.type="device",r.powerlineRepeater=r.ctrlWord.nibble1),r.powerlineRepeater===!1||0===r.powerlineRepeater?r.powerlineRepeater=0:2===r.powerlineRepeater?r.powerlineRepeater=1:4===r.powerlineRepeater?r.powerlineRepeater=2:6===r.powerlineRepeater?r.powerlineRepeater=4:t(null,Error("Invalid command! Powerline repeater argument can only be 1, 2, or 4 which translates into 2, 4, or 6.")),r.words=r.ctrlWord.nibble2,r.generated.length/2!==r.words&&t(null,Error("Invalid command! Word count doesn't add up.'")),1===r.ctrlWord.nibble3&&(r.ackPulse=!0),2===r.ctrlWord.nibble3&&(r.idPulse=!0),3==r.ctrlWord.nibble3&&(r.ackPulse=!0,r.idPulse=!0),4===r.ctrlWord.nibble3&&(r.ackMsg=!0),5===r.ctrlWord.nibble3&&(r.ackPulse=!0,r.ackMsg=!0),6===r.ctrlWord.nibble3&&(r.idPulse=!0,r.ackMsg=!0),7===r.ctrlWord.nibble3&&(r.ackPulse=!0,r.idPulse=!0,r.ackMsg=!0),r.ctrlWord.nibble3>7&&t(null,Error("Invalid command! Any number greater than seven cannot be an Acknowledge Pulse, ID Pulse, or Acknowledge Message.")),0===r.ctrlWord.nibble4?(r.sendx=1,r.sendTime=1):4===r.ctrlWord.nibble4?(r.sendx=2,r.sendTime=1):5===r.ctrlWord.nibble4?(r.sendx=2,r.sendTime=2):8===r.ctrlWord.nibble4?(r.sendx=3,r.sendTime=1):9===r.ctrlWord.nibble4?(r.sendx=3,r.sendTime=2):10===r.ctrlWord.nibble4?(r.sendx=3,r.sendTime=3):12===r.ctrlWord.nibble4?(r.sendx=4,r.sendTime=1):12===r.ctrlWord.nibble4?(r.sendx=4,r.sendTime=2):13===r.ctrlWord.nibble4?(r.sendx=4,r.sendTime=3):14===r.ctrlWord.nibble4?(r.sendx=4,r.sendTime=4):t(null,Error("Invalid command! Send time is greater than total sent times.")),r.hex.network=r.generated.substring(4,6).toString(16),r.network=parseInt(r.hex.network,16),r.hex.id=r.generated.substring(6,8).toString(16),r.id=parseInt(r.hex.id,16),r.hex.source=r.generated.substring(8,10).toString(16),r.source=parseInt(r.hex.source,16),r.msg=r.generated.substring(10,12).toString(16),20==r.msg?r.cmd="activate":21===r.msg?r.cmd="deactivate":22===r.msg?r.cmd="goto":23===r.msg?r.cmd="fadeStart":24===r.msg?r.cmd="fadeStop":25===r.msg?r.cmd="blink":26===r.msg?r.cmd="indicate":27===r.msg?r.cmd="toggle":30===r.msg?r.cmd="reportState":31===r.msg?r.cmd="storeState":80===r.msg?r.cmd="ackResponse":85===r.msg?r.cmd="setupTimeReport":86===r.msg?r.cmd="deviceStateReport":87===r.msg?r.cmd="deviceStatusReport":"8F"===r.msg?r.cmd="deviceSignatureReport":90===r.msg?r.cmd="registerValuesReport":91===r.msg?r.cmd="RAMvaluesReport":92===r.msg?r.cmd="rawDataReport":93===r.msg?r.cmd="heartbeatReport":calbackFinal(null,"An unknown command was specified!"),r.hex.msg=parseInt(r.msg,16).toString(16),r.checksum=r.generated.slice(-2).toString(16),r.words>7&&r.checksum!==r.generated.substring(12,14)+""&&("goto"===r.cmd||"fadeStart"===r.cmd||"fadeStop"===r.cmd||"deviceStateReport"===r.cmd||"indicate"===r.cmd)&&(r.hex.level=r.generated.substring(12,14).toString(16),r.level=parseInt(r.hex.level,16)),r.words>8&&r.checksum!==r.generated.substring(12,14)+""&&r.level&&("goto"===r.cmd||"fadeStart"===r.cmd||"indicate"===r.cmd)&&(r.hex.rate=r.generated.substring(14,16).toString(16),r.rate=parseInt(r.hex.rate,16)),r.words>7&&"blink"===r.cmd&&(r.hex.blinkRate=r.generated.substring(12,14).toString(16),r.blinkRate=parseInt(r.hex.blinkRate,16)),r.words>7&&"toggle"===r.cmd&&(r.hex.toggleCount=r.generated.substring(12,14).toString(16),r.toggleCount=parseInt(r.hex.toggleCount,16)),r.words>8&&"toggle"===r.cmd&&(r.hex.toggleRate=r.generated.substring(14,16).toString(16),r.toggleRate=parseInt(r.hex.toggleRate,16)),r.words>9&&r.checksum!==r.generated.substring(12,14)+""&&r.rate&&"device"===r.type&&("goto"===r.cmd||"fadeStart"===r.cmd||"toggle"===r.cmd||"indicate"===r.cmd)&&(r.hex.channel=r.generated.substring(16,18).toString(16),r.channel=parseInt(r.hex.channel,16)),r.words>8&&r.checksum!==r.generated.substring(14,16)+""&&r.blinkRate&&"device"===r.type&&"blink"===r.cmd&&(r.hex.channel=r.generated.substring(16,18).toString(16),r.channel=parseInt(r.hex.channel,16)),"goto"!==r.cmd&&"fadeStart"!==r.cmd||r.level||t(null,Error("Invalid command! No level specified. A level must be specified with goto and fadeStart.")),"blink"!==r.cmd||r.blinkRate||t(null,Error("No blink rate specified. Blink rate must be specified with the blink command.")),"toggle"!==r.cmd||r.toggleCount||t(null,Error("Invalid command! No toggle count specified. Toggle count must be specified with the toggle command.")),t(r,null)},"undefined"!=typeof module&&module.exports?module.exports=d:"undefined"!=typeof define&&define.amd?define([],function(){return d}):r.upb=d}()
