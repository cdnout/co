/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notification.
 * https://github.com/jtsage/jquery-mobile-datebox
 */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeOptPick:"b",themeOpt:"a",useSetButton:true,customData:[{input:true,name:"Letter",data:["a","b","c","d","e"]},{input:true,name:"Text",data:["some","bull","shtuff","here"]},{input:false,name:"Image",data:['<img src="img/slot1.png" />','<img src="img/slot2.png" />','<img src="img/slot3.png" />','<img src="img/slot4.png" />']}],customDefault:[0,0,0],customFormat:false,customfliplang:{customSet:"Looks Good"}});a.extend(a.mobile.datebox.prototype,{_customflipDoSet:function(){var b=this,c=this.options;if(typeof b.customCurrent==="undefined"){b.customCurrent=this._makeDate(this.d.input.val())}b.d.input.trigger("datebox",{method:"set",value:b._formatter(c.customFormat,b.customCurrent),date:b.customCurrent})},_cubox_offset:function(e,d){var c=this,b,f=this.options;tmp=(c.customCurrent[e]+d)%f.customData[e]["data"].length;if(tmp<0){tmp=f.customData[e]["data"].length+tmp}c.customCurrent[e]=tmp;if(f.useImmediate){c.d.input.trigger("datebox",{method:"set",value:c._formatter(f.customFormat,c.customCurrent),date:c.customCurrent})}c.refresh()},_cubox_arr:function(f,c){var e=f,b,d=f.slice(0,c),g=f.slice(c+1);while(d.length<10){for(b=e.length;b>0;b--){d.unshift(e[b-1])}}while(d.length>10){d.shift()}while(g.length<10){for(b=0;b<e.length;b++){g.push(e[b])}}g.length=10;d.push(f[c]);return a.merge(a.merge([],d),g)},_cubox_pos:function(){var b=this,f=null,e=null,d=this.d.intHTML.find(".ui-datebox-flipcontent").innerHeight(),c=null;b.d.intHTML.find(".ui-datebox-flipcenter").each(function(){f=a(this);e=f.innerHeight();f.css("top",((d/2)-(e/2)+4)*-1)});b.d.intHTML.find("ul").each(function(){f=a(this);d=f.parent().innerHeight();e=f.find("li").first();c=f.find("li").size()*e.outerHeight();e.css("marginTop",((c/2)-(d/2)+(e.outerHeight()/2))*-1)})}});a.extend(a.mobile.datebox.prototype._parser,{customflip:function(g){var k=this,b=this.options,c=b.customFormat,i,h,e,d,f=[0,0,0,0,0,0];if(typeof(c)!=="string"){c=""}c=c.replace(/%X([0-9a-f])/gi,function(l,m){switch(m){case"a":case"b":case"c":case"d":case"e":case"f":return"("+l+"|.+?)";break;case"0":case"1":case"2":case"3":case"4":case"5":return"("+l+"|[0-9]+)";break;default:return".+?"}});c=new RegExp("^"+c+"$");i=c.exec(g);h=c.exec(b.customFormat);if(i!==null){for(var j=1;j<i.length;j++){e=h[j].charAt(2);console.log(e);if(isNaN(parseInt(e))){d=a.inArray(e,["a","b","c","d","e","f"]);f[d]=a.inArray(i[j],b.customData[d].data)}else{f[parseInt(e)-1]=parseInt(i[j])}}}return(g.length<1||f.length<1)?this.options.customDefault:f}});a.extend(a.mobile.datebox.prototype._customformat,{customflip:function(f,e,d){var b=parseInt(f),c;if(typeof(b)==="number"&&!isNaN(b)){return e[f-1]}else{c=a.inArray(f,["a","b","c","d","e","f"]);return d.customData[c].data[e[c]]}}});a.extend(a.mobile.datebox.prototype._build,{customflip:function(){var l=this,d=this.options,e,k,m,f,h,j="ui-datebox-",g=this._makeDate(this.d.input.val()),c=a("<div class='ui-overlay-shadow'><ul></ul></div>"),b=a("<div>",{"class":j+"flipcontent"});if(typeof l.customCurrent==="undefined"){l.customCurrent=g}if(d.customFormat===false){f=[];for(e=0;e<d.customData.length;e++){f.push("%X"+(e+1))}d.customFormat=f.join(",")}if(typeof l.d.intHTML!=="boolean"){l.d.intHTML.empty().remove()}l.d.input.on("datebox",function(n,i){if(i.method==="postrefresh"){l._cubox_pos()}});l.d.headerText=((l._grabLabel()!==false)?l._grabLabel():l.__("tireTitleString"));l.d.intHTML=a("<span>");l.fldOrder=d.tireFieldOrder;f=a('<div class="'+j+"header ui-grid-"+[0,0,"a","b","c"][d.customData.length]+'"></div>');for(k=0;k<d.customData.length;k++){a('<div class="ui-block-'+["a","b","c","d"][k]+'">'+d.customData[k]["name"]+"</div>").css("textAlign","center").appendTo(f)}f.appendTo(l.d.intHTML);l.d.intHTML.append(b);for(k=0;k<d.customData.length;k++){h=l._cubox_arr(d.customData[k]["data"],l.customCurrent[k]);m=l._makeEl(c,{attr:{field:k,amount:1}});for(e in h){f=(e!=10)?d.themeOpt:d.themeOptPick;a("<li>",{"class":"ui-body-"+f}).html("<span>"+h[e]+"</span>").appendTo(m.find("ul"))}m.appendTo(b)}a("<div>",{"class":j+"flipcenter ui-overlay-shadow"}).css("pointerEvents","none").appendTo(l.d.intHTML);if(d.useSetButton){k=a("<div>",{"class":j+"controls"});if(d.useSetButton){a('<a href="#">'+l.__("customSet")+"</a>").appendTo(k).buttonMarkup({theme:d.theme,icon:"check",iconpos:"left",corners:true,shadow:true}).on(d.clickEventAlt,function(i){i.preventDefault();l.d.input.trigger("datebox",{method:"set",value:l._formatter(d.customFormat,l.customCurrent),date:l.tireChoice});l.d.input.trigger("datebox",{method:"close"})})}k.appendTo(l.d.intHTML)}if(l.wheelExists){l.d.intHTML.on("mousewheel",".ui-overlay-shadow",function(i,n){i.preventDefault();l._cubox_offset(a(this).jqmData("field"),((n<0)?1:-1)*a(this).jqmData("amount"))})}l.d.intHTML.on(l.drag.eStart,"ul",function(n,i){if(!l.drag.move){if(typeof i!=="undefined"){n=i}l.drag.move=true;l.drag.target=a(this).find("li").first();l.drag.pos=parseInt(l.drag.target.css("marginTop").replace(/px/i,""),10);l.drag.start=l.touch?n.originalEvent.changedTouches[0].pageY:n.pageY;l.drag.end=false;n.stopPropagation();n.preventDefault()}});l.d.intHTML.on(l.drag.eStart,"."+j+"flipcenter",function(i){if(!l.drag.move){l.drag.target=l.touch?i.originalEvent.changedTouches[0].pageX-a(i.currentTarget).offset().left:i.pageX-a(i.currentTarget).offset().left;l.drag.tmp=l.d.intHTML.find("."+j+"flipcenter").innerWidth()/((a.inArray("a",l.fldOrder)>-1&&l.__("timeFormat")!==12)?l.fldOrder.length-1:l.fldOrder.length);a(l.d.intHTML.find("ul").get(parseInt(l.drag.target/l.drag.tmp,10))).trigger(l.drag.eStart,i)}})}});a.extend(a.mobile.datebox.prototype._drag,{customflip:function(){var b=this,d=this.options,c=this.drag;a(document).on(c.eMove,function(f){if(c.move&&d.mode==="customflip"){c.end=b.touch?f.originalEvent.changedTouches[0].pageY:f.pageY;c.target.css("marginTop",(c.pos+c.end-c.start)+"px");f.preventDefault();f.stopPropagation();return false}});a(document).on(c.eEnd,function(f){if(c.move&&d.mode==="customflip"){c.move=false;if(c.end!==false){f.preventDefault();f.stopPropagation();c.tmp=c.target.parent().parent();b._cubox_offset(c.tmp.jqmData("field"),(parseInt((c.start-c.end)/c.target.innerHeight(),10)*c.tmp.jqmData("amount")))}c.start=false;c.end=false}})}})})(jQuery);