"use strict";angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(h){if(angular.isUndefined(window.ace))throw new Error("ui-ace need ace to work... (o rly?)");return{restrict:"EA",require:"?ngModel",link:function(a,e,r,i){function t(){var e=arguments[0],n=Array.prototype.slice.call(arguments,1);angular.isDefined(e)&&a.$evalAsync(function(){if(!angular.isFunction(e))throw new Error("ui-ace use a function as callback.");e(n)})}var o,s,u=h.ace||{},c=angular.extend({},u,a.$eval(r.uiAce)),d=window.ace.edit(e[0]),l=d.getSession(),f=function(r){return function(e){var n=l.getValue();!i||n===i.$viewValue||a.$$phase||a.$root.$$phase||a.$evalAsync(function(){i.$setViewValue(n)}),t(r,e,d)}},g=function(e){return function(){t(e,d)}};r.$observe("readonly",function(e){d.setReadOnly(!!e||""===e)}),i&&(i.$formatters.push(function(e){if(angular.isUndefined(e)||null===e)return"";if(angular.isObject(e)||angular.isArray(e))throw new Error("ui-ace cannot use an object or an array as a model");return e}),i.$render=function(){l.setValue(i.$viewValue)});function n(e,n){e!==n&&((c=angular.extend({},u,a.$eval(r.uiAce))).callbacks=[c.onLoad],c.onLoad!==u.onLoad&&c.callbacks.unshift(u.onLoad),l.removeListener("change",o),o=f(c.onChange),l.on("change",o),d.removeListener("blur",s),s=g(c.onBlur),d.on("blur",s),function(n,e,r){var a,i;if(angular.isDefined(r.workerPath)&&window.ace.require("ace/config").set("workerPath",r.workerPath),angular.isDefined(r.require)&&r.require.forEach(function(e){window.ace.require(e)}),angular.isDefined(r.showGutter)&&n.renderer.setShowGutter(r.showGutter),angular.isDefined(r.useWrapMode)&&e.setUseWrapMode(r.useWrapMode),angular.isDefined(r.showInvisibles)&&n.renderer.setShowInvisibles(r.showInvisibles),angular.isDefined(r.showIndentGuides)&&n.renderer.setDisplayIndentGuides(r.showIndentGuides),angular.isDefined(r.useSoftTabs)&&e.setUseSoftTabs(r.useSoftTabs),angular.isDefined(r.showPrintMargin)&&n.setShowPrintMargin(r.showPrintMargin),angular.isDefined(r.disableSearch)&&r.disableSearch&&n.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0}]),angular.isString(r.theme)&&n.setTheme("ace/theme/"+r.theme),angular.isString(r.mode)&&e.setMode("ace/mode/"+r.mode),angular.isDefined(r.firstLineNumber)&&(angular.isNumber(r.firstLineNumber)?e.setOption("firstLineNumber",r.firstLineNumber):angular.isFunction(r.firstLineNumber)&&e.setOption("firstLineNumber",r.firstLineNumber())),angular.isDefined(r.advanced))for(a in r.advanced)i={name:a,value:r.advanced[a]},n.setOption(i.name,i.value);if(angular.isDefined(r.rendererOptions))for(a in r.rendererOptions)i={name:a,value:r.rendererOptions[a]},n.renderer.setOption(i.name,i.value);angular.forEach(r.callbacks,function(e){angular.isFunction(e)&&e(n)})}(d,l,c))}a.$watch(r.uiAce,n,!0),n(u),e.on("$destroy",function(){d.session.$stopWorker(),d.destroy()}),a.$watch(function(){return[e[0].offsetWidth,e[0].offsetHeight]},function(){d.resize(),d.renderer.updateFull()},!0)}}}]);