ComponentJS.plugin("localstorage",function(o,t,e){if("undefined"===o.istypeof(e.localStorage))throw o.exception("plugin:localstorage",'sorry, mandatory HTML5 "localStorage" facility not supported by run-time environment');if("undefined"===o.istypeof(e.JSON))throw o.exception("plugin:localstorage",'sorry, mandatory JavaScript "JSON" encoding/decoding not supported by run-time environment');if(void 0===e.document||void 0===e.document.location||void 0===e.document.location.pathname)throw o.exception("plugin:localstorage",'sorry, mandatory DOM "document location" facility not supported by run-time environment');var n=function(o){var t="ComponentJS:store:";return t+=e.document.location.pathname,t+=":"+o.path("/")};o.latch("ComponentJS:store-load",function(o){var t=n(o),a=e.localStorage.getItem(t);"string"==typeof a&&(o.__store=e.JSON.parse(a))}),o.latch("ComponentJS:store-save",function(o){var t=n(o),a=e.JSON.stringify(o.__store);"{}"===a?e.localStorage.removeItem(t):e.localStorage.setItem(t,a)})});