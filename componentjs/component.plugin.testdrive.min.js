ComponentJS.plugin("testdrive",function(e,t,n){var o={};t.usecase=function(){var n=t.params("usecase",arguments,{name:{pos:0,req:!0,valid:"string"},desc:{pos:1,req:!0,valid:"string"},conf:{def:{},valid:"object"},func:{pos:2,req:!0,valid:"(function|null)"}});if(null===n.func)delete o[n.name];else{if(e.isdefined(o[n.name]))throw e.exception("usecase",'usecase of name "'+n.name+'" already defined');o[n.name]={desc:n.desc,conf:n.conf,func:n.func}}},t.suite=function(){var s=n.jQuery||n.$;if("function"!=typeof s)throw new Error("testdrive#suite() requires jQuery");var i="ComponentJS-testdrive-suite",r=s("body > ."+i);0===r.length&&((r=s('<div class="'+i+'"><div class="'+i+'-head"><b>ComponentJS</b> Test-Drive Use-Cases Suite<div class="'+i+'-head-close">close</div></div><div class="'+i+'-list"></div></div>')).hide(),s("body").append(r));var a=s(n).width(),c=a/10*8,l=function(e){s(r).animate({top:-400},300,"swing",function(){s(r).hide(),s(r).remove(),"function"==typeof e&&e()})};if(s("body > ."+i).filter(":visible").length>0)l();else{r.width(c).height(400).css("box-sizing","content-box").css("top",-400).css("left",a/2-c/2).css("position","absolute").css("z-index",1e4).css("background-color","#f8f8f8").css("-webkit-box-shadow","0 4px 16px 0 #909090").css("box-shadow","0 4px 16px 0 #909090").css("-webkit-border-radius","0 0 8px 8px").css("border-radius","0 0 8px 8px").css("color","#000000").css("font-family","sans-serif").css("font-size","11pt"),s("."+i+"-head",r).width(c-20).height(20).css("box-sizing","content-box").css("position","relative").css("background","#666666").css("background","-moz-linear-gradient(top, #666666 0%, #333333 49%, #222222 51%, #000000 100%)").css("background","-webkit-linear-gradient(top, #666666 0% ,#333333 49% ,#222222 51%, #000000 100%)").css("background","linear-gradient(to bottom, #666666 0%, #333333 49%, #222222 51%, #000000 100%)").css("color","#ffffff").css("padding","7px 10px 7px 10px").css("font-size","16px"),s("."+i+"-head-close",r).css("position","absolute").css("right","10px").css("top","6px").css("padding","4px 10px 4px 10px").css("font-size","12px").css("color","#c0c0c0").css("border","1px solid #606060").css("cursor","pointer"),s("."+i+"-list",r).width(c).height(370).css("overflow","scroll").css("overflow-x","hidden");var f=s("<table></table>");f.append('<tr class="'+i+'-list-row-first"><td class="'+i+'-list-name">Identifier</td><td class="'+i+'-list-desc">Description</td></tr>');var u=0;e.foreach(e.keysof(o).sort(),function(e){f.append('<tr data-id="'+e+'" class="'+i+"-list-row "+i+"-list-row-"+u++%2+'"><td class="'+i+'-list-name">'+e+'</td><td class="'+i+'-list-desc">'+o[e].desc+"</td></tr>")}),s("."+i+"-list",r).html(f),s("."+i+"-list table",r).width(c).css("border-collapse","collapse"),s("."+i+"-list-row",r).css("cursor","pointer"),s("."+i+"-list-row-first",r).width(c).css("background-color","#909090").css("color","#f0f0f0"),s("."+i+"-list-row-1",r).width(c).css("background-color","#f0f0f0"),s("."+i+"-list-name",r).css("padding","2px 10px 2px 10px").css("font-family","monospace").css("white-space","nowrap"),s("."+i+"-list-desc",r).width("100%").css("padding","2px 10px 2px 10px"),s("."+i+"-list-row",r).on("click",function(e){var n=e.target;"tr"!==s(n).prop("tagName")&&(n=s(n).parent());var o=s(n).data("id");"string"==typeof o&&""!==o&&l(function(){t.drive(o).then(null,function(e){alert('ComponentJS: testdrive: use case "" failed: '+e)})})}),s("."+i+"-head-close",r).on("click",l),d=void 0,s(r).show().animate({top:0},300,"swing",d);var d}},t.promise=function(){var e={exports:{}};t=this,n="Thenable",o=function(){var e=function(t){if(!(this instanceof e))return new e(t);this.id="Thenable/1.0.7",this.state=0,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},"function"==typeof t&&t.call(this,this.fulfill.bind(this),this.reject.bind(this))},t=function(e,t,n){if(0!==e[t].length){var o=e[t];e[t]=[];var s=function(){for(var e=0;e<o.length;e++)o[e](n)};"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick(s):"function"==typeof setImmediate?setImmediate(s):setTimeout(s,0)}},n=function(e){1===e.state?t(e,"onFulfilled",e.fulfillValue):2===e.state&&t(e,"onRejected",e.rejectReason)},o=function(e,t,o,s){return 0===e.state&&(e.state=t,e[o]=s,n(e)),e},s=function(e,t){if(e!==t&&e.proxy!==t){var n;if("object"==typeof t&&null!==t||"function"==typeof t)try{n=t.then}catch(t){return void e.reject(t)}if("function"!=typeof n)e.fulfill(t);else{var o=!1;try{n.call(t,function(n){o||(o=!0,n===t?e.reject(new TypeError("circular thenable chain")):s(e,n))},function(t){o||(o=!0,e.reject(t))})}catch(t){o||e.reject(t)}}}else e.reject(new TypeError("cannot resolve promise with itself"))},i=function(e,t,n){return function(o){if("function"!=typeof e)t[n].call(t,o);else{var i;try{i=e(o)}catch(e){return void t.reject(e)}s(t,i)}}};return e.prototype={fulfill:function(e){return o(this,1,"fulfillValue",e)},reject:function(e){return o(this,2,"rejectReason",e)},then:function(t,o){var s=new e;return this.onFulfilled.push(i(t,s,"fulfill")),this.onRejected.push(i(o,s,"reject")),n(this),s.proxy}},e},"object"==typeof e&&"object"==typeof e.exports?e.exports=o():t[n]=function(){var e=t[n],s=o();return s.noConflict=function(){return t[n]=e,s},s}();var t,n,o;return e.exports}(),t.drive=function(){var n=t.params("drive",arguments,{name:{pos:0,req:!0,valid:"string"},conf:{pos:1,def:{},valid:"object"},timeout:{pos:2,def:1e4,valid:"number"}}),s=o[n.name];if(!e.isdefined(s))throw e.exception("drive",'invalid usecase name "'+n.name+'"');var i=new t.promise,r=i.proxy,a=!1,c=null;n.timeout>0&&(c=setTimeout(function(){c=null,a||(a=!0,t.debug(1,'drive: usecase "'+n.name+'", TIMEOUT after '+n.timeout+" ms"),i.reject(new Error('usecase "'+n.name+'": timeout')))},n.timeout));var l={};e.extend(l,s.conf),e.extend(l,n.conf),t.debug(1,'drive: usecase "'+n.name+'" ('+o[n.name].desc+"), EXECUTING"+(e.keysof(n.conf).length>0?" with configuration "+e.json(n.conf):"")+(n.timeout>0?" and timeout of "+n.timeout+" ms":""));var f;try{f=s.func.apply(l,[l])}catch(e){a||(a=!0,t.debug(1,'drive: usecase "'+n.name+'", EXCEPTION: '+e.message),i.reject(new Error('usecase "'+n.name+'": '+e.message)))}return null!==c&&(clearTimeout(c),c=null),a||("object"!=typeof f&&"function"!=typeof f||"function"!=typeof f.then?i.fulfill(!0):r=f),r=r.then(null,function(e){throw t.debug(1,'drive: usecase "'+n.name+'" failed: '+e),e})},t.ensure=function(){var e=t.params("ensure",arguments,{path:{pos:0,req:!0,valid:"string"},state:{pos:1,req:!0,valid:"string"},min:{def:!0,valid:"boolean"},max:{def:!1,valid:"boolean"},sync:{def:!1,valid:"boolean"}}),n=new t.promise,o=t(e.path);return o.state({state:e.state,min:e.min,max:e.max,sync:e.sync,func:function(e){n.fulfill(o)}}),n.proxy};var s=[],i=function(n,o,i){var r;if(e.states.length<=1)throw e.exception("await(internal)","no user-defined component states");if(o===e.states[1].state&&"enter"===i)for(r=0;r<s.length;r++)s[r].comp===e.none&&(s[r].comp=t(s[r].path));for(r=0;void 0!==s[r];)if(s[r].comp===n&&s[r].state===o&&s[r].direction===i){for(var a=0;a<s[r].promises.length;a++)!function(t,n){setTimeout(e.hook("ComponentJS:settimeout:func","pass",function(){t.fulfill(n)}),0)}(s[r].promises[a],n);s.splice(r,1)}else r++;if(o===e.states[1].state&&"leave"===i)for(r=0;r<s.length;r++)s[r].comp===n&&(s[r].comp=e.none)};t.await=function(n,o,r){var a=t.params("await",arguments,{path:{pos:0,req:!0,valid:"string"},state:{pos:1,req:!0,valid:"string"},direction:{pos:2,def:"enter",valid:"string"}});if(e.states.length<=1)throw e.exception("await","no user-defined component states");if(-1===e.state_name2idx(a.state))throw e.exception("await",'invalid state name "'+a.state+'": no such state defined');if(!a.direction.match(/^(?:enter|leave)$/))throw e.exception("await",'invalid direction "'+a.direction+'"');var c,l=new t.promise;for(c=0;c<s.length&&(s[c].path!==a.path||s[c].state!==a.state||s[c].direction!==a.direction);c++);c===s.length&&(s[c]={path:a.path,comp:t(a.path),state:a.state,direction:a.direction,promises:[]}),s[c].promises.push(l);var f=s[c].comp;return f!==e.none&&i(f,f.state(),"enter"),l.proxy},e.latch("ComponentJS:bootstrap",function(){e.latch("ComponentJS:comp-created",function(t){if(e.states.length<=1)throw e.exception("await(internal)","no user-defined component states");i(t,e.states[1].state,"enter")}),e.latch("ComponentJS:comp-destroyed",function(t){if(e.states.length<=1)throw e.exception("await(internal)","no user-defined component states");i(t,e.states[1].state,"leave")}),e.latch("ComponentJS:state-enter",function(e,t){i(e,t,"enter")}),e.latch("ComponentJS:state-leave",function(e,t){i(e,t,"leave")})}),t.poll=function(){var e=t.params("poll",arguments,{check:{pos:0,req:!0,valid:"function"},wait:{pos:1,def:100,valid:"(function|number)"},max:{pos:2,def:600,valid:"number"}});"number"==typeof e.wait&&(e.wait=(n=e.wait,function(){return t.sleep(n)}));var n,o=e.check,s=e.wait,i=e.max;return new t.promise(function(e,t){var n=function(){i--<=0?t():o()?e():s().then(n)};n()})},t.sleep=function(){var e=t.params("sleep",arguments,{ms:{pos:0,req:!0,valid:"number"}});return new t.promise(function(t,n){setTimeout(function(){t()},e.ms)})},t.once=function(){var e=t.params("once",arguments,{selector:{pos:0,req:!0,valid:"any"},events:{pos:1,req:!0,valid:"string"},subselector:{pos:2,def:null,valid:"(string|null)"}}),o=n.jQuery||n.$;if("function"!=typeof o)throw new Error("testdrive#once() requires jQuery");var s=new t.promise;if("mutation"===e.events){if("function"!=typeof n.MutationObserver)throw new Error("once: MutationObserver not available");if(null!==e.subselector)throw new Error("once: mutation event does not support sub-selector");var i=o(e.selector);if(0===i.length)throw new Error("once: no nodes found");if(1!==i.length)throw new Error("once: more than exactly one node found");var r=new n.MutationObserver(function(e){r.disconnect(),s.fulfill(e)});r.observe(i.get(0),{attributes:!0,characterData:!0,childList:!0,subtree:!1})}else o(e.selector).one(e.events,e.subselector,function(e){s.fulfill(e)});return s.proxy}});