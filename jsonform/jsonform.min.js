!function(e,l,d,m,h){e&&!m&&(m=require("underscore"));function c(e){return!(m.isUndefined(e)||m.isNull(e))}function u(e,t){return"object"==typeof e&&e.hasOwnProperty(t)}function r(e){return c(e)&&(e=""+e)?e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}function f(e){return e.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")}function o(e){return e.replace(/\ /g,"_")}function i(e){function a(e,t){t.find("> .active").removeClass("active"),e.addClass("active")}function l(e,t){e.find("input, textarea, select").removeAttr("disabled"),e.parent().children(":not([data-idx="+t+"])").find("input, textarea, select").attr("disabled","disabled")}function t(e){var t=d("option:selected",d(this)),n=d(this),i=t.get(0).getAttribute("data-idx")||t.attr("value");e.preventDefault(),t.hasClass("active")||(e=d(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+i+"]"),a(t,n),a(e,e.parent()),l(e,i))}function n(e){d("a",d(this));var t=d(this).parents(".tabbable").first().find(".tab-content").first(),n=d(this).index(),t=t.find("> [data-idx="+n+"]");e.preventDefault(),a(d(this),d(this).parent()),a(t,t.parent()),d(this).parent().hasClass("jsonform-alternative")&&l(t,n)}e.each(function(){d(this).delegate("select.nav","change",t),d(this).find("select.nav").each(function(){d(this).val(d(this).find(".active").attr("value"));var e=d(this).find("option:selected").get(0).getAttribute("data-idx")||d(this).find("option:selected").attr("value"),t=d(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+e+"]");l(t,e)}),d(this).delegate("ul.nav li","click",n),d(this).find("ul.nav li.active").click()})}var p=/\[([0-9]*)\](?=\[|\.|$)/g,a={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},v={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},g={util:{}};g.fieldTemplate=function(e){return'<div <% for(var key in elt.htmlMetaData) {%><%= key %>="<%= elt.htmlMetaData[key] %>" <% }%>class="form-group jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " jsonform-required" : "") %><%= (node.readOnly ? " jsonform-readonly" : "") %><%= (node.disabled ? " jsonform-disabled" : "") %>"><% if (!elt.notitle) { %><label for="<%= node.id %>"><%= node.title ? node.title : node.name %></label><% } %><div class="controls"><% if (node.prepend || node.append) { %><div class="<% if (node.prepend) { %>input-group<% } %><% if (node.append) { %> input-group<% } %>"><% if (node.prepend) { %><span class="input-group-addon"><%= node.prepend %></span><% } %><% } %>'+e+'<% if (node.append) { %><span class="input-group-addon"><%= node.append %></span><% } %><% if (node.prepend || node.append) { %></div><% } %><% if (node.description) { %><span class="help-block"><%= node.description %></span><% } %><span class="help-block jsonform-errortext" style="display:none;"></span></div></div>'};var t='<div class="_jsonform-preview"><% if (value.type=="image") { %><img class="jsonform-preview" id="jsonformpreview-<%= id %>" src="<%= value.url %>" /><% } else { %><a href="<%= value.url %>"><%= value.name %></a> (<%= Math.ceil(value.size/1024) %>kB)<% } %></div><a href="#" class="btn btn-default _jsonform-delete"><i class="glyphicon glyphicon-remove" title="Remove"></i></a> ',e=function(e){return{template:'<input type="'+e+'" class=\'form-control<%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\'name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && (node.schemaElement.step > 0 || node.schemaElement.step == "any") ? " step=\'" + node.schemaElement.step + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:!0,inputfield:!0}};g.elementTypes={none:{template:""},root:{template:"<div><%= children %></div>"},text:e("text"),password:e("password"),date:e("date"),datetime:e("datetime"),"datetime-local":e("datetime-local"),email:e("email"),month:e("month"),number:e("number"),search:e("search"),tel:e("tel"),time:e("time"),url:e("url"),week:e("week"),range:{template:'<input type="range" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%> min=<%= range.min %> max=<%= range.max %> step=<%= range.step %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> />',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){e.range={min:1,max:100,step:1},t&&t.schemaElement&&(t.formElement&&t.formElement.step&&(e.range.step=t.formElement.step),void 0!==t.schemaElement.minimum&&(t.schemaElement.exclusiveMinimum?e.range.min=t.schemaElement.minimum+e.range.step:e.range.min=t.schemaElement.minimum),void 0!==t.schemaElement.maximum&&(t.schemaElement.exclusiveMaximum?e.range.max=t.schemaElement.maximum-e.range.step:e.range.max=t.schemaElement.maximum))}},color:{template:'<input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){d(t.el).find("#"+f(t.id)).spectrum({preferredFormat:"hex",showInput:!0})}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;"<%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %><%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){function n(){d(t.el).data("wysihtml5")||(d(t.el).data("wysihtml5_loaded",!0),d(t.el).find("#"+f(t.id)).wysihtml5({html:!0,link:!0,"font-styles":!0,image:!1,events:{load:function(){d(this.textareaElement).removeAttr("required")}}}))}var i;window.jsonform_wysihtml5_setup?window.jsonform_wysihtml5_setup(n):i=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(i),n())},1e3)}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,i){function t(){var e=i.formElement||{},t=window.ace.edit(d(i.el).find("#"+f(i.id)+"__ace").get(0)),n="#"+f(i.id)+"__hidden";t.getSession().setNewLineMode("unix"),t.renderer.setShowPrintMargin(!1),t.setTheme("ace/theme/"+(e.aceTheme||"twilight")),e.aceMode&&t.getSession().setMode("ace/mode/"+e.aceMode),t.getSession().setTabSize(2),t.getSession().setValue(i.value||""),e=m.debounce(function(){d(i.el).find(n).val(t.getSession().getValue()),d(i.el).find(n).change()},600),t.getSession().on("change",e),t.on("blur",function(){d(i.el).find(n).change(),d(i.el).find(n).trigger("blur")}),t.on("focus",function(){d(i.el).find(n).trigger("focus")})}var n;window.jsonform_ace_setup?window.jsonform_ace_setup(t):n=window.setInterval(function(){window.ace&&(window.clearInterval(n),t())},1e3)}},checkbox:{template:'<div class="checkbox"><label><input type="checkbox" id="<%= id %>" <%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %>name="<%= node.name %>" value="1" <% if (value) {%>checked<% } %><%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %> /><%= node.inlinetitle || "" %></label></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return d(e).parent().get(0)}},file:{template:'<input class="input-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>/>',fieldtemplate:!0,inputfield:!0},"file-hosted-public":{template:"<span><% if (value && (value.type||value.url)) { %>"+t+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="<%= transloaditname %>" /><input data-transloadit-name="_transloadit_<%= transloaditname %>" type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return d(e).parent().get(0)},onBeforeRender:function(e,t){t.ownerTree._transloadit_generic_public_index?t.ownerTree._transloadit_generic_public_index++:t.ownerTree._transloadit_generic_public_index=1,e.transloaditname="_transloadit_jsonform_genericupload_public_"+t.ownerTree._transloadit_generic_public_index,t.ownerTree._transloadit_generic_elts||(t.ownerTree._transloadit_generic_elts={}),t.ownerTree._transloadit_generic_elts[e.transloaditname]=t},onChange:function(e,i){if(i.ownerTree._transloadit_bound)return!1;i.ownerTree._transloadit_bound=!0;var a=d(i.ownerTree.domRoot);a.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(e){e=m.values(e.results),e=m.flatten(e);m.each(e,function(t){var e=i.ownerTree._transloadit_generic_elts[t.field].id,n=a.find("#"+f(e)),e=m.filter(m.keys(t.meta),function(e){return!!c(t.meta[e])});t.meta=m.pick(t.meta,e),n.val(h.stringify(t))}),i.ownerTree._transloadit_bound=!1,a.unbind("submit.transloadit"),m.delay(function(){console.log("submit form"),i.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,t){d(t.el).find("a._jsonform-delete").on("click",function(e){return d(t.el).find("._jsonform-preview").remove(),d(t.el).find("a._jsonform-delete").remove(),d(t.el).find("#"+f(t.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},"file-transloadit":{template:"<span><% if (value && (value.type||value.url)) { %>"+t+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="_transloadit_<%= node.name %>" /><input type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return d(e).parent().get(0)},onChange:function(e,t){if(t.ownerTree._transloadit_bound)return!1;t.ownerTree._transloadit_bound=!0;var i=d(t.ownerTree.domRoot);i.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(e){e=m.values(e.results),e=m.flatten(e);m.each(e,function(t){var e=i.find('input[name="'+t.field.replace(/^_transloadit_/,"")+'"]'),n=m.filter(m.keys(t.meta),function(e){return!!c(t.meta[e])});t.meta=m.pick(t.meta,n),e.val(h.stringify(t))}),t.ownerTree._transloadit_bound=!1,i.unbind("submit.transloadit"),m.delay(function(){console.log("submit form"),t.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,t){d(t.el).find("a._jsonform-delete").on("click",function(e){return d(t.el).find("._jsonform-preview").remove(),d(t.el).find("a._jsonform-delete").remove(),d(t.el).find("#"+f(t.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},select:{template:'<select name="<%= node.name %>" id="<%= id %>"class=\'form-control<%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\'<%= (node.schemaElement && node.schemaElement.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>> <% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select>',fieldtemplate:!0,inputfield:!0},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } else { %> btn-default<% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } else { %> btn-default<% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn btn-default">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n,i=t.formElement||{},a=i.imageSelectorColumns||5;e.buttonTitle=i.imageSelectorTitle||"Select...",e.prefix=i.imagePrefix||"",e.suffix=i.imageSuffix||"",e.width=i.imageWidth||32,e.height=i.imageHeight||32,e.buttonClass=i.imageButtonClass||!1,t.options.length>a?(n=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/n)):e.columns=a},getElement:function(e){return d(e).parent().get(0)},onInsert:function(e,s){d(s.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var t=("img"===e.target.nodeName.toLowerCase()?d(e.target):d(e.target).find("img")).attr("src"),n=s.formElement||{},i=n.imagePrefix||"",a=n.imageSuffix||"",l=n.imageWidth||32,e=n.imageHeight||32;t?(0===t.indexOf(i)&&(t=t.substring(i.length)),t=t.substring(0,t.length-a.length),d(s.el).find("input").attr("value",t),d(s.el).find('a[data-toggle="dropdown"]').addClass(n.imageButtonClass).attr("style","max-width:"+l+"px;max-height:"+e+"px").html('<img src="'+(t.match(/^https?:/)?"":i)+t+a+'" alt="" />')):(d(s.el).find("input").attr("value",""),d(s.el).find('a[data-toggle="dropdown"]').removeClass(n.imageButtonClass).removeAttr("style").html(n.imageSelectorTitle||"Select..."))})}},iconselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><i class="icon-<%= node.value %>" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" ><% if (key instanceof Object) { %><i class="icon-<%= key.value %>" alt="<%= key.title %>" /></a><% } else { %><i class="icon-<%= key %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n,i=t.formElement||{},a=i.imageSelectorColumns||5;e.buttonTitle=i.imageSelectorTitle||"Select...",e.buttonClass=i.imageButtonClass||!1,t.options.length>a?(n=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/n)):e.columns=a},getElement:function(e){return d(e).parent().get(0)},onInsert:function(e,n){d(n.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var t=("i"===e.target.nodeName.toLowerCase()?d(e.target):d(e.target).find("i")).attr("class"),e=n.formElement||{};t?(d(n.el).find("input").attr("value",t),d(n.el).find('a[data-toggle="dropdown"]').addClass(e.imageButtonClass).html('<i class="'+t+'" alt="" />')):(d(n.el).find("input").attr("value",""),d(n.el).find('a[data-toggle="dropdown"]').removeClass(e.imageButtonClass).html(e.imageSelectorTitle||"Select..."))})}},radios:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><div class="radio"><label><input<%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %> type="radio" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>/><%= (key instanceof Object ? key.title : key) %></label></div> <% }); %></div>',fieldtemplate:!0,inputfield:!0},radiobuttons:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><label class="btn btn-default <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>active btn-success<% } %>"><input<%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %> type="radio" style="position:absolute;left:-9999px;" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" /><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var n="active",i=t.formElement||{};i.activeClass&&(n+=" "+i.activeClass),d(t.el).find("label").on("click",function(){d(this).parent().find("label").removeClass(n),d(this).addClass(n)})}},checkboxes:{template:"<div><%= choiceshtml %></div>",fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,n){var t=null,i=null;n&&n.schemaElement&&(t=n.schemaElement.items?n.schemaElement.items.enum||n.schemaElement.items[0].enum:n.schemaElement.enum)&&(i="",m.each(t,function(e,t){i+=m.template('<div class="checkbox"><label><input type="checkbox" <% if (value) { %> checked="checked" <% } %> name="<%= name %>" value="1"<%= (node.disabled? " disabled" : "")%>/><%= title %></label></div>',a)({name:n.key+"["+t+"]",value:m.include(n.value,e),title:u(n.formElement.titleMap,e)?n.formElement.titleMap[e]:e,node:n})}),e.choiceshtml=i)}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><span class="_jsonform-array-buttons"><a href="#" class="btn btn-default _jsonform-array-addmore"><i class="glyphicon glyphicon-plus-sign" title="Add new"></i></a> <a href="#" class="btn btn-default _jsonform-array-deletelast"><i class="glyphicon glyphicon-minus-sign" title="Delete last"></i></a></span></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return d("").sortable?'<li data-idx="<%= node.childPos %>"><span class="draggable line"><i class="glyphicon glyphicon-list" title="Move item"></i></span>'+e+"</li>":'<li data-idx="<%= node.childPos %>">'+e+"</li>"},onInsert:function(e,r){var o=d(r.el).find("#"+f(r.id)),n=r.getArrayBoundaries();d("> span > a._jsonform-array-addmore",o).click(function(e){e.preventDefault(),e.stopPropagation();e=r.children.length;if(0<=n.maxItems&&(r.children.length>n.maxItems-2&&o.find("> span > a._jsonform-array-addmore").addClass("disabled"),r.children.length>n.maxItems-1))return!1;r.insertArrayItem(e,d("> ul",o).get(0)),(n.minItems<=0||0<n.minItems&&r.children.length>n.minItems-1)&&o.find("> span > a._jsonform-array-deletelast").removeClass("disabled")});var t=d("> ul > li",o).length;if(0<n.minItems&&t<n.minItems)for(var i=0;i<n.minItems-1&&o.find("> ul > li").length<n.minItems;i++)r.insertArrayItem(t,o.find("> ul").get(0));0<n.minItems&&r.children.length<=n.minItems&&o.find("> span > a._jsonform-array-deletelast").addClass("disabled"),d("> span > a._jsonform-array-deletelast",o).click(function(e){var t=r.children.length-1;if(e.preventDefault(),e.stopPropagation(),0<n.minItems){if(r.children.length<n.minItems+2&&o.find("> span > a._jsonform-array-deletelast").addClass("disabled"),r.children.length<=n.minItems)return!1}else 1===r.children.length&&o.find("> span > a._jsonform-array-deletelast").addClass("disabled");r.deleteArrayItem(t),0<=n.maxItems&&t<=n.maxItems-1&&o.find("> span > a._jsonform-array-addmore").removeClass("disabled")}),d(r.el).sortable&&(d("> ul",o).sortable(),d("> ul",o).bind("sortstop",function(e,t){!function(e,t){if(e!==t){for(var n=e<t?1:-1,i=0,a=d("> ul",o),i=e;i!==t;i+=n)r.children[i].switchValuesWith(r.children[i+n]),r.children[i].render(a.get(0)),r.children[i+n].render(a.get(0));var l=d(r.children[e].el),s=d(r.children[t].el);l.detach(),s.detach(),e<t?(0===e?a.prepend(l):d(r.children[e-1].el).after(l),d(r.children[t-1].el).after(s)):(0===t?a.prepend(s):d(r.children[t-1].el).after(s),d(r.children[e-1].el).after(l))}}(d(t.item).data("idx"),d(t.item).index())}))}},tabarray:{template:'<div id="<%= id %>"><div class="tabbable tabs-left"><ul class="nav nav-tabs"><%= tabs %></ul><div class="tab-content"><%= children %></div></div><a href="#" class="btn btn-default _jsonform-array-addmore"><i class="glyphicon glyphicon-plus-sign" title="Add new"></i></a> <a href="#" class="btn btn-default _jsonform-array-deleteitem"><i class="glyphicon glyphicon-minus-sign" title="Delete item"></i></a></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+e+"</div>"},onBeforeRender:function(e,t){var n="";m.each(t.children,function(e,t){e=e.legend||e.title||"Item "+(t+1);n+='<li data-idx="'+t+'"'+(0===t?' class="active"':"")+'><a class="draggable tab" data-toggle="tab">'+r(e)+"</a></li>"}),e.tabs=n},onInsert:function(e,l){function i(e){var n="",t=!1;void 0===e&&(e=(e=d("> .tabbable > .nav-tabs .active",s).data("idx"))?parseInt(e,10):(t=!0,0)),e>=l.children.length&&(e=l.children.length-1),m.each(l.children,function(e,t){d('> .tabbable > .tab-content > [data-idx="'+t+'"] > fieldset > legend',s).html(e.legend);e=e.legend||e.title||"Item "+(t+1);n+='<li data-idx="'+t+'"><a class="draggable tab" data-toggle="tab">'+r(e)+"</a></li>"}),d("> .tabbable > .nav-tabs",s).html(n),t&&d('> .tabbable > .nav-tabs [data-idx="0"]',s).addClass("active"),d('> .tabbable > .nav-tabs [data-toggle="tab"]',s).eq(e).click()}var s=d(l.el).find("#"+f(l.id)),n=l.getArrayBoundaries();if(d("> a._jsonform-array-deleteitem",s).click(function(e){var t=d("> .tabbable > .nav-tabs .active",s).data("idx");if(e.preventDefault(),e.stopPropagation(),0<n.minItems&&(l.children.length<n.minItems+1&&s.find("> a._jsonform-array-deleteitem").addClass("disabled"),l.children.length<=n.minItems))return!1;l.deleteArrayItem(t),i(),(l.children.length<n.minItems+1||0===l.children.length)&&s.find("> a._jsonform-array-deleteitem").addClass("disabled"),0<=n.maxItems&&l.children.length<=n.maxItems&&s.find("> a._jsonform-array-addmore").removeClass("disabled")}),d("> a._jsonform-array-addmore",s).click(function(e){var t=l.children.length;if(0<=n.maxItems&&(l.children.length>n.maxItems-2&&d("> a._jsonform-array-addmore",s).addClass("disabled"),l.children.length>n.maxItems-1))return!1;e.preventDefault(),e.stopPropagation(),l.insertArrayItem(t,s.find("> .tabbable > .tab-content").get(0)),i(t),(n.minItems<=0||0<n.minItems&&t>n.minItems-1)&&s.find("> a._jsonform-array-deleteitem").removeClass("disabled")}),d(l.el).on("legendUpdated",function(e){i(),e.preventDefault(),e.stopPropagation()}),d(l.el).sortable&&(d("> .tabbable > .nav-tabs",s).sortable({containment:l.el,tolerance:"pointer"}),d("> .tabbable > .nav-tabs",s).bind("sortstop",function(e,t){var n=d(t.item).data("idx"),t=d(t.item).index();!function(e,t){if(e!==t)for(var n=e<t?1:-1,i=0,a=d("> .tabbable > .tab-content",s).get(0),i=e;i!==t;i+=n)l.children[i].switchValuesWith(l.children[i+n]),l.children[i].render(a),l.children[i+n].render(a)}(n,t),i(t)})),0<=n.minItems&&l.children.length<=n.minItems){for(var t=0;t<n.minItems-1;t++)s.find("> a._jsonform-array-addmore").click();s.find("> a._jsonform-array-deleteitem").addClass("disabled"),i()}0<=n.maxItems&&l.children.length>=n.maxItems&&s.find("> a._jsonform-array-addmore").addClass("disabled"),0<=n.minItems&&l.children.length<=n.minItems&&s.find("> a._jsonform-array-deleteitem").addClass("disabled")}},help:{template:'<span class="help-block" style="padding-top:5px"><%= elt.helpvalue %></span>',fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},fieldset:{template:'<fieldset class="form-group jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %>><% if (node.title || node.legend) { %><legend><%= node.title || node.legend %></legend><% } %><% if (elt.expandable) { %><div class="form-group"><% } %><%= children %><% if (elt.expandable) { %></div><% } %></fieldset>',onInsert:function(e,t){null!==t.el&&(d(".expandable > div, .expandable > fieldset",t.el).hide(),d(".expandable",t.el).removeClass("expanded"))}},advancedfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend><%= (node.title || node.legend) ? (node.title || node.legend) : "Advanced options" %></legend><div class="form-group"><%= children %></div></fieldset>',onInsert:function(e,t){null!==t.el&&(d(".expandable > div, .expandable > fieldset",t.el).hide(),d(".expandable",t.el).removeClass("expanded"))}},authfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend><%= (node.title || node.legend) ? (node.title || node.legend) : "Authentication settings" %></legend><div class="form-group"><%= children %></div></fieldset>',onInsert:function(e,t){null!==t.el&&(d(".expandable > div, .expandable > fieldset",t.el).hide(),d(".expandable",t.el).removeClass("expanded"))}},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-primary <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:' <button type="button" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-default <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button> '},actions:{template:'<div class="<%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" />',inputfield:!0},tabs:{template:'<ul class="nav nav-tabs <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (elt.id) { %> id="<%= elt.id %>"<% } %>><%=tab_list%></ul><div class="tab-content" <% if (elt.id) { %> data-tabset="<%= elt.id %>"<% } %>><%=children%></div>',getElement:function(e){return d(e).parent().get(0)},onBeforeRender:function(e,t){var i=r(t.id?t.id+"-":""),a="";return m.each(t.children,function(e,t){var n=r(e.title||"Item "+(t+1)),e=n.replace(" ","_");a+='<li class="nav-item'+(0===t?" active":"")+'"><a href="#'+i+e+'" class="nav-link" data-tab="'+i+e+'" data-toggle="tab">'+n+"</a></li>"}),e.tab_list=a,e},onInsert:function(e,t){d("#"+t.id+">li.nav-item").on("click",function(e){e.preventDefault(),d(t.el).find("div[data-tabset='"+t.id+"']>div.tab-pane.active").each(function(){d(this).removeClass("active")});e=d(this).find("a").attr("data-tab");d("#"+e).addClass("active")})}},tab:{template:'<div class="tab-pane<% if (elt.htmlClass) { %> <%= elt.htmlClass %> <% } %><% if (node.childPos === 0) { %> active<% } %>"<% if (node.title) { %> id="<%= node.parentNode.id %>-<%= node.title.replace(" ","_") %>"<% } %>><%= children %></div>'},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"><% if (node.legend) { %><legend><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="tabbable"><div class="form-group<%= node.formElement.hideMenu ? " hide" : "" %>"><% if (!elt.notitle) { %><label for="<%= node.id %>"><%= node.title ? node.title : node.name %></label><% } %><div class="controls"><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(e){return d(e).parent().get(0)},childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+e+"</div>"},onBeforeRender:function(e,i){var t=null,a=[];i.schemaElement&&(a=i.schemaElement.enum||[]),t=i.options?m.map(i.options,function(e,t){var n=i.children[t];return n.childPos=t,e instanceof Object?((e=m.extend({node:n},e)).title=e.title||n.legend||n.title||"Option "+(n.childPos+1),e.value=c(e.value)?e.value:c(a[t])?a[t]:t,e):{title:e,value:c(a[n.childPos])?a[n.childPos]:n.childPos,node:n}}):m.map(i.children,function(e,t){return e.childPos=t,{title:e.legend||e.title||"Option "+(e.childPos+1),value:a[e.childPos]||e.childPos,node:e}}),m.each(t,function(e,t){e.node.active=!1});var n=null;e.value&&(n=m.find(t,function(e){return e.value===i.value})),(n=(n=n||m.find(t,function(e){return e.node.hasNonDefaultValue()}))||t[0]).node.active=!0,e.value=n.value;i.formElement;var l='<select class="nav"'+(i.disabled?" disabled":"")+">";return m.each(t,function(e,t){l+='<option data-idx="'+t+'" value="'+e.value+'"'+(e.node.active?' selected="selected" class="active"':"")+">"+r(e.title)+"</option>"}),l+="</select>",e.tabs=l,e},onInsert:function(e,n){d(n.el).find("select.nav").first().on("change",function(e){var t=d(this).find("option:selected");d(n.el).find('input[type="hidden"]').first().val(t.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (elt.htmlClass) { %> class="<%= elt.htmlClass %>"<% } %><% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return d(e).parent().get(0)},onInsert:function(e,t){t.children&&0!==t.children.length&&(m.each(t.children,function(e){d(e.el).hide()}),d(t.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><label class="<%= (node.formElement.optionsType === "radiobuttons") ? "btn btn-default" : "" %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>"><input type="radio" <% if (node.formElement.optionsType === "radiobuttons") { %> style="position:absolute;left:-9999px;" <% } %>name="<%= node.id %>" value="<%= val %>"<%= (node.disabled? " disabled" : "")%>/><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,onInsert:function(e,i){var a="active",t=i.formElement||{};t.activeClass&&(a+=" "+t.activeClass),d(i.el).find('input[type="radio"]').on("change",function(e){var t,n=i.options[d(this).val()];i.parentNode&&i.parentNode.el&&(d(this).parent().parent().find("label").removeClass(a),d(this).parent().addClass(a),d(i.el).nextAll().hide(),d(i.el).nextAll().find('input[type="radio"]').prop("checked",!1),n.value&&d(i.parentNode.el).find('input[type="hidden"]').val(n.value),n.next&&(t=m.find(i.parentNode.children,function(e){return e.formElement&&e.formElement.qid===n.next}),d(t.el).show(),d(t.el).nextAll().hide(),d(t.el).nextAll().find('input[type="radio"]').prop("checked",!1)),n.href&&(n.target?window.open(n.href,n.target):window.location=n.href),n.submit&&setTimeout(function(){i.ownerTree.submit()},0))})}}},g.util.getObjKey=function(e,t,n){for(var i=e,a=t.split("."),l=null,s=null,r=null,o=0;o<a.length;o++){if(null===i||"object"!=typeof i)return null;if(r=(l=a[o]).replace(p,""),p.lastIndex=0,s=p.exec(l))for(;;){if(r&&!m.isArray(i[r]))return null;if(i=(r?i[r]:i)[parseInt(s[1])],!(s=p.exec(l)))break;r=null}else i=(n&&!i[r]&&m.isArray(i)&&i[0]?i[0]:i)[r]}return n&&m.isArray(i)&&i[0]?i[0]:i},g.util.setObjKey=function(e,t,n){for(var i=e,a=t.split("."),l=null,s=null,r=null,o=0;o<a.length-1;o++)if(r=(l=a[o]).replace(p,""),p.lastIndex=0,s=p.exec(l)){for(;m.isArray(i[r])||(i[r]=[]),i=i[r],r=parseInt(s[1],10),s=p.exec(l););"object"==typeof i[r]&&null!==i[r]||(i[r]={}),i=i[r]}else"object"==typeof i[r]&&null!==i[r]||(i[r]={}),i=i[r];if(r=(l=a[a.length-1]).replace(p,""),p.lastIndex=0,s=p.exec(l)){for(;m.isArray(i[r])||(i[r]=[]),i=i[r],r=parseInt(s[1],10),s=p.exec(l););i[r]=n}else i[r]=n};function y(e,t){if(t=t.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items"),(t=g.util.getObjKey(e,t,!0))&&t.$ref)throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54");return t}function b(e,n){var i=0;return e?n&&0!==n.length?e.replace(p,function(e,t){return c(n[i])&&(e="["+n[i]+"]"),i+=1,e}):e:null}function w(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0}var x=function(t,e,n,i,a){var l=null;(i=i||{}).idx=i.idx||(n?n[n.length-1]:1),i.value=c(i.value)?i.value:"",i.getValue=i.getValue||function(e){return x(t,e,n,i,a)};var s=function(e,t){var n=null;return e&&e.length?(m.each(e,function(e){n||(e!==t?m.isString(e)||(e.key===t?n=e:e.items&&(n=s(e.items,t))):n={key:e})}),n):null},r=s(t.form||[],e),o=y(t.schema.properties,e);return a&&t.value&&(l=g.util.getObjKey(t.value,b(e,n))),c(l)||(r&&void 0!==r.value?l=r.value:o&&c(o.default)&&(l=o.default),l&&-1!==l.indexOf("{{values.")&&(l=l.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')),l=l&&m.template(l,v)(i)),c(l)&&r&&u(r.titleMap,l)&&(l=m.template(r.titleMap[l],v)(i)),l&&m.isString(l)&&o&&o.maxLength&&l.length>o.maxLength&&(l=l.substr(0,o.maxLength-1)+"…"),c(l)?l:null};w.prototype.clone=function(e){var t=new w;return t.arrayPath=m.clone(this.arrayPath),t.ownerTree=this.ownerTree,t.parentNode=e||this.parentNode,t.formElement=this.formElement,t.schemaElement=this.schemaElement,t.view=this.view,t.children=m.map(this.children,function(e){return e.clone(t)}),this.childTemplate&&(t.childTemplate=this.childTemplate.clone(t)),t},w.prototype.hasNonDefaultValue=function(){return(!this.formElement||"hidden"!=this.formElement.type)&&(!(!this.value||this.defaultValue)||!!m.find(this.children,function(e){return e.hasNonDefaultValue()}))},w.prototype.appendChild=function(e){return e.parentNode=this,e.childPos=this.children.length,this.children.push(e),e},w.prototype.removeChild=function(){var e=this.children[this.children.length-1];if(e)return d(e.el).remove(),this.children.pop()},w.prototype.moveValuesTo=function(e){var t=this.getFormValues(e.arrayPath);e.resetValues(),e.computeInitialValues(t,!0)},w.prototype.switchValuesWith=function(e){var t=this.getFormValues(e.arrayPath),n=e.getFormValues(this.arrayPath);e.resetValues(),e.computeInitialValues(t,!0),this.resetValues(),this.computeInitialValues(n,!0)},w.prototype.resetValues=function(){var e;if(this.value=null,this.parentNode?(this.arrayPath=m.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)e=d(":input",this.el).serializeArray(),m.each(e,function(e){d('[name="'+f(e.name)+'"]',d(this.el)).val("")},this);else if(this.view&&this.view.array)for(;0<this.children.length;)this.removeChild();m.each(this.children,function(e){e.resetValues()})},w.prototype.setChildTemplate=function(e){(this.childTemplate=e).parentNode=this},w.prototype.computeInitialValues=function(a,t){var l=this,e=null,n=1,i=0,s=this.ownerTree.formDesc.tpldata||{};if(this.parentNode?(this.arrayPath=m.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],s.idx=0<this.arrayPath.length?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,s.value="",s.getValue=function(e){if(!a)return"";for(var t=a,n=e.split("[]."),i=0;i<n.length-1;i++)t=t[n[i]][l.arrayPath[i]];return t[n[i]]},this.formElement&&(this.formElement.id?this.id=b(this.formElement.id,this.arrayPath):(this.view&&this.view.array||this.parentNode&&this.parentNode.view&&this.parentNode.view.array||"button"===this.formElement.type||"selectfieldset"===this.formElement.type||"question"===this.formElement.type||"buttonquestion"===this.formElement.type)&&(this.id=f(this.ownerTree.formDesc.prefix)+"-elt-counter-"+m.uniqueId()),this.formElement.key&&(this.key=b(this.formElement.key,this.arrayPath),this.keydash=o(this.key.replace(/\./g,"---"))),this.name=b(this.formElement.name,this.arrayPath),m.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","placeholder","readOnly"],function(e){m.isString(this.formElement[e])?(-1!==this.formElement[e].indexOf("{{values.")?this[e]=this.formElement[e].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this[e]=b(this.formElement[e],this.arrayPath),this[e]&&(this[e]=m.template(this[e],v)(s))):this[e]=this.formElement[e]},this),this.formElement.options&&(this.options=m.map(this.formElement.options,function(e){var t=null;return m.isObject(e)&&e.title?(t=-1!==e.title.indexOf("{{values.")?e.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):b(e.title,l.arrayPath),m.extend({},e,{value:c(e.value)?e.value:"",title:m.template(t,v)(s)})):e}))),this.view&&this.view.inputfield&&this.schemaElement)a?c(g.util.getObjKey(a,this.key))&&(this.value=g.util.getObjKey(a,this.key)):t||!c(this.value)&&c(this.schemaElement.default)&&(this.value=this.schemaElement.default,m.isString(this.value)&&(-1!==this.value.indexOf("{{values.")?this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this.value=b(this.value,this.arrayPath),this.value&&(this.value=m.template(this.value,v)(s))),this.defaultValue=!0);else if(this.view&&this.view.array)for(n=0,a?n=this.getPreviousNumberOfItems(a,this.arrayPath):0===n&&(n=1),i=0;i<n;i++)this.appendChild(this.childTemplate.clone());if(m.each(this.children,function(e){e.computeInitialValues(a,t)}),this.formElement&&this.formElement.valueInLegend)for(e=this;e;){if(e.parentNode&&e.parentNode.view&&e.parentNode.view.array&&(e.legendChild=this,e.formElement&&e.formElement.legend)){e.legend=b(e.formElement.legend,e.arrayPath),s.idx=0<e.arrayPath.length?e.arrayPath[e.arrayPath.length-1]+1:e.childPos+1,s.value=c(this.value)?this.value:"",e.legend=m.template(e.legend,v)(s);break}e=e.parentNode}},w.prototype.getPreviousNumberOfItems=function(t,n){var e,i,a=null;return t?this.view.inputfield&&this.schemaElement?(e=function(e,t){var n=0,i=0;if(!e)return null;if(0<t)for(;n<t;){if(-1===(i=e.indexOf("[]",i)))return e;i+=2,n+=1}return-1===(i=e.indexOf("[]",i))?e:e.substring(0,i)}(this.formElement.key,n.length),e=b(e,n),(i=g.util.getObjKey(t,e))?(a=m.map(this.children,function(e){return e.getPreviousNumberOfItems(t,n)}),m.max([m.max(a)||0,i.length])):0):this.view.array?this.childTemplate.getPreviousNumberOfItems(t,n):(a=m.map(this.children,function(e){return e.getPreviousNumberOfItems(t,n)}),m.max(a)||0):0},w.prototype.getFormValues=function(t){var e={};if(!this.el)throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var n=(n=d(":input",this.el).serializeArray()).concat(d(":input[type=checkbox]:not(:disabled):not(:checked)",this.el).map(function(){return{name:this.name,value:this.checked}}).get());t&&m.each(n,function(e){e.name=b(e.name,t)});for(var i=this.ownerTree.formDesc.schema,a=0;a<n.length;a++){var l,s=n[a].name,r=y(i.properties,s),o=null;if(r)if(r._jsonform_checkboxes_as_array&&(l=s.match(/\[([0-9]*)\]$/)))s=s.replace(/\[([0-9]*)\]$/,""),o=g.util.getObjKey(e,s)||[],"1"===n[a].value&&o.push(r.enum[parseInt(l[1],10)]),g.util.setObjKey(e,s,o);else{if("boolean"===r.type&&("0"===n[a].value?n[a].value=!1:n[a].value=!!n[a].value),"number"!==r.type&&"integer"!==r.type||m.isString(n[a].value)&&(n[a].value.length?isNaN(Number(n[a].value))||(n[a].value=Number(n[a].value)):n[a].value=null),"string"!==r.type||""!==n[a].value||r._jsonform_allowEmpty||(n[a].value=null),"object"===r.type&&m.isString(n[a].value)&&"{"===n[a].value.substring(0,1))try{n[a].value=h.parse(n[a].value)}catch(e){n[a].value={}}"object"!==r.type||"null"!==n[a].value&&""!==n[a].value||(n[a].value=null),n[a].name&&null!==n[a].value&&g.util.setObjKey(e,n[a].name,n[a].value)}}return e},w.prototype.render=function(e){var t=this.generate();this.setContent(t,e),this.enhance()},w.prototype.setContent=function(e,t){var n=d(e),e=t||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot),t=null;this.el?d(this.el).replaceWith(n):(t=d(e).children().get(this.childPos))?d(t).before(n):d(e).append(n),this.el=n,this.updateElement(this.el)},w.prototype.updateElement=function(e){for(var t in this.id&&(this.el=d("#"+f(this.id),e).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),!1!==this.fieldtemplate&&this.view&&this.view.fieldtemplate&&(this.el=d(this.el).parent().parent(),(this.prepend||this.prepend)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=d(this.el).parent().get(0))),this.children)this.children[t].updateElement(this.el||e)},w.prototype.generate=function(){var e={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:c(this.value)?this.value:"",escape:r},t=null;this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(e,this),this.view.onBeforeRender&&this.view.onBeforeRender(e,this),t=this.template||(this.formElement&&this.formElement.template?this.formElement:this.view).template,!1!==this.fieldtemplate&&(this.fieldtemplate||this.view.fieldtemplate)&&(t=g.fieldTemplate(t)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(t=this.parentNode.view.childTemplate(t));var n="";return m.each(this.children,function(e){n+=e.generate()}),e.children=n,e.fieldHtmlClass="",this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass&&(e.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass),this.formElement&&void 0!==this.formElement.fieldHtmlClass&&(e.fieldHtmlClass=this.formElement.fieldHtmlClass),m.template(t,a)(e)},w.prototype.enhance=function(){var n=this,e=null,t=null,i=m.clone(this.ownerTree.formDesc.tpldata)||{};this.formElement&&(this.view.onInsert&&this.view.onInsert({target:d(this.el)},this),e=this.handlers||this.formElement.handlers,(t=this.onInsert||this.formElement.onInsert)&&t({target:d(this.el)},this),e&&m.each(e,function(e,t){"insert"===t&&e({target:d(this.el)},this)},this),this.el&&(this.onChange&&d(this.el).bind("change",function(e){n.onChange(e,n)}),this.view.onChange&&d(this.el).bind("change",function(e){n.view.onChange(e,n)}),this.formElement.onChange&&d(this.el).bind("change",function(e){n.formElement.onChange(e,n)}),this.onClick&&d(this.el).bind("click",function(e){n.onClick(e,n)}),this.view.onClick&&d(this.el).bind("click",function(e){n.view.onClick(e,n)}),this.formElement.onClick&&d(this.el).bind("click",function(e){n.formElement.onClick(e,n)}),this.onKeyUp&&d(this.el).bind("keyup",function(e){n.onKeyUp(e,n)}),this.view.onKeyUp&&d(this.el).bind("keyup",function(e){n.view.onKeyUp(e,n)}),this.formElement.onKeyUp&&d(this.el).bind("keyup",function(e){n.formElement.onKeyUp(e,n)}),e&&m.each(e,function(t,e){"insert"!==e&&d(this.el).bind(e,function(e){t(e,n)})},this)),this.legendChild&&this.legendChild.formElement&&(e=function(e){n.formElement&&n.formElement.legend&&n.parentNode&&(n.legend=b(n.formElement.legend,n.arrayPath),i.idx=0<n.arrayPath.length?n.arrayPath[n.arrayPath.length-1]+1:n.childPos+1,i.value=d(e.target).val(),n.legend=m.template(n.legend,v)(i),d(n.parentNode.el).trigger("legendUpdated"))},d(this.legendChild.el).bind("change",e),d(this.legendChild.el).bind("keyup",e))),m.each(this.children,function(e){e.enhance()})},w.prototype.insertArrayItem=function(e,t){var n=0;void 0===e&&(e=this.children.length);var i=this.childTemplate.clone();for(this.appendChild(i),i.resetValues(),n=this.children.length-2;e<=n;n--)this.children[n].moveValuesTo(this.children[n+1]);for(this.children[e].resetValues(),this.children[e].computeInitialValues(),n=e;n<this.children.length;n++)this.children[n].render(t)},w.prototype.deleteArrayItem=function(e){var t=0;for(void 0===e&&(e=this.children.length-1),t=e;t<this.children.length-1;t++)this.children[t+1].moveValuesTo(this.children[t]),this.children[t].render();this.removeChild()},w.prototype.getArrayBoundaries=function(){if(!this.view||!this.view.array)return{minItems:-1,maxItems:-1};var l=function(e,t){var n,i=null,a={minItems:-1,maxItems:-1};return t=t||e,e.view&&e.view.array&&e!==t?a:e.key?(i=e.key.replace(/\[[0-9]+\]/g,"[]"),e!==t&&(i=i.replace(/\[\][^\[\]]*$/,"")),(n=y(e.ownerTree.formDesc.schema.properties,i))?{minItems:n.minItems||n.minLength||-1,maxItems:n.maxItems||n.maxLength||-1}:a):(m.each(e.children,function(e){e=l(e,t);-1!==e.minItems&&(-1!==a.minItems?a.minItems=Math.max(a.minItems,e.minItems):a.minItems=e.minItems),-1!==e.maxItems&&(-1!==a.maxItems?a.maxItems=Math.min(a.maxItems,e.maxItems):a.maxItems=e.maxItems)}),a)};return l(this)};function s(){this.eventhandlers=[],this.root=null,this.formDesc=null}s.prototype.initialize=function(e){e=e||{},this.formDesc=m.clone(e),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+m.uniqueId(),this.formDesc.schema&&!this.formDesc.schema.properties&&(this.formDesc.schema={properties:this.formDesc.schema}),this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=m.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.formDesc.params=this.formDesc.params||{},this.root=new w,(this.root.ownerTree=this).root.view=g.elementTypes.root,this.buildTree(),this.computeInitialValues()},s.prototype.buildTree=function(){m.each(this.formDesc.form,function(e){"*"===e?m.each(this.formDesc.schema.properties,function(e,t){this.root.appendChild(this.buildFromLayout({key:t}))},this):(m.isString(e)&&(e={key:e}),this.root.appendChild(this.buildFromLayout(e)))},this)},s.prototype.buildFromLayout=function(n,e){var t,i,a=null,l=new w,s=null;if((n=m.clone(n)).items&&(m.isArray(n.items)?n.items=m.map(n.items,m.clone):n.items=[m.clone(n.items)]),n.key){if(!(a=y(this.formDesc.schema.properties,n.key)))throw new Error('The JSONForm object references the schema key "'+n.key+'" but that key does not exist in the JSON schema');if(this.formDesc.onElementSchema&&this.formDesc.onElementSchema(n,a),n.name=n.name||n.key,n.title=n.title||a.title,n.description=n.description||a.description,n.readOnly=n.readOnly||a.readOnly||n.readonly||a.readonly,n.id||(n.id=f(this.formDesc.prefix)+"-elt-"+o(n.key)),n.allowEmpty&&(a._jsonform_allowEmpty=!0),!n.type){if(m.isArray(a.type)){if(m.contains(a.type,"null")&&(a.type=m.without(a.type,"null"),a.required=!1),1<a.type.length)throw new Error("Cannot process schema element with multiple types.");a.type=m.first(a.type)}"string"===a.type&&"color"===a.format?n.type="color":"number"!==a.type&&"integer"!==a.type||a.enum?"string"!==a.type&&"any"!==a.type||a.enum?"boolean"===a.type?n.type="checkbox":"object"===a.type?a.properties?n.type="fieldset":n.type="textarea":m.isUndefined(a.enum)?n.type=a.type:n.type="select":n.type="text":(n.type="number")===a.type&&(a.step="any")}!n.options&&a.enum&&(n.titleMap?n.options=m.map(a.enum,function(e){return{value:e,title:u(n.titleMap,e)?n.titleMap[e]:e}}):n.options=a.enum),"checkboxes"===n.type&&a.items&&((i=a.items.enum)&&(a.items._jsonform_checkboxes_as_array=!0),!i&&a.items[0]&&(i=a.items[0].enum)&&(a.items[0]._jsonform_checkboxes_as_array=!0)),"object"===a.type&&m.each(a.properties,function(e,t){l.appendChild(this.buildFromLayout({key:n.key+"."+t}))},this)}if(n.type||(n.type="none"),!(t=g.elementTypes[n.type]))throw new Error('The JSONForm contains an element whose type is unknown: "'+n.type+'"');if(a){if(!t.inputfield&&!t.array&&"selectfieldset"!==n.type&&"object"!==a.type)throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+n.key+'") and that should not based on its type ("'+n.type+'")')}else if(t.inputfield&&"selectfieldset"!==n.type)throw new Error('The JSONForm defines an element of type "'+n.type+'" but no "key" property to link the input field to the JSON schema');return n.iddot=f(n.id||""),l.formElement=n,l.schemaElement=a,l.view=t,l.ownerTree=this,n.handlers||(n.handlers={}),l.view.array?(s=n.items?n.items[0]||n.items:n.key+"[]",m.isString(s)&&(s={key:s}),l.setChildTemplate(this.buildFromLayout(s))):n.items&&m.each(n.items,function(e){m.isString(e)&&(e={key:e}),l.appendChild(this.buildFromLayout(e))},this),l},s.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},s.prototype.render=function(e){e&&(this.domRoot=e,this.root.render(),this.hasRequiredField()&&d(e).addClass("jsonform-hasrequired"))},s.prototype.forEachElement=function(n){var i=function(e){for(var t=0;t<e.children.length;t++)n(e.children[t]),i(e.children[t])};i(this.root)},s.prototype.validate=function(e){var t,n=g.getFormValue(this.domRoot),i=!1,a=this.formDesc;return!1!==a.validate&&(t=!1,"object"!=typeof a.validate?l.JSONFormValidator&&(t=l.JSONFormValidator.createEnvironment("json-schema-draft-03")):t=a.validate,t&&(n=t.validate(n,this.formDesc.schema),d(this.domRoot).jsonFormErrors(!1,a),n.errors.length&&(i=(i=i||[]).concat(n.errors)))),i&&!e&&(a.displayErrors?a.displayErrors(i,this.domRoot):d(this.domRoot).jsonFormErrors(i,a)),{errors:i}},s.prototype.submit=function(t){function e(){return t&&(t.preventDefault(),t.stopPropagation()),!1}var n=g.getFormValue(this.domRoot),i=this.formDesc,a=!1;if(this.forEachElement(function(e){a||e.view.onSubmit&&(a=!e.view.onSubmit(t,e))}),a)return e();var l=this.validate();return(i.onSubmit&&!i.onSubmit(l.errors,n)||l.errors||!(!i.onSubmitValid||i.onSubmitValid(n)))&&e()},s.prototype.hasRequiredField=function(){var n=function(e){if(!e)return null;if(e.required&&"boolean"!==e.type)return e;var t=m.find(e.properties,function(e){return n(e)});return t||(e.items&&(t=m.isArray(e.items)?m.find(e.items,function(e){return n(e)}):n(e.items))?t:void 0)};return n(this.formDesc.schema)},g.getFormValue=function(e){e=d(e).data("jsonform-tree");return e?e.root.getFormValues():null},d.fn.jsonFormErrors=function(e,t){if(d(".error",this).removeClass("error"),d(".warning",this).removeClass("warning"),d(".jsonform-errortext",this).hide(),e){for(var n=[],i=0;i<e.length;i++){var a=e[i].uri.replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]"),l=".jsonform-error-"+f(a.replace(/\./g,"---"));n.push(l);a=e[i].type||"error";d(l,this).addClass(a),d(l+" .jsonform-errortext",this).html(e[i].message).show()}n=n.join(",");var s=d(n).get(0);s&&s.scrollIntoView&&s.scrollIntoView(!0,{behavior:"smooth"})}},d.fn.jsonForm=function(e){var t=this;e=m.defaults({},e,{submitEvent:"submit"});var n=new s;return n.initialize(e),n.render(t.get(0)),e.transloadit&&t.append('<input type="hidden" name="params" value=\''+r(h.stringify(e.transloadit.params))+"'>"),t.data("jsonform-tree",n),e.submitEvent&&(t.unbind(e.submitEvent+".jsonform"),t.bind(e.submitEvent+".jsonform",function(e){n.submit(e)})),i(t),d(".expandable > div, .expandable > fieldset",t).hide(),t.on("click",".expandable > legend",function(){var e=d(this).parent();e.toggleClass("expanded"),d("> div",e).slideToggle(100)}),n},d.fn.jsonFormValue=function(){return g.getFormValue(this)},l.JSONForm=l.JSONForm||{util:{}},l.JSONForm.getFormValue=g.getFormValue,l.JSONForm.fieldTemplate=g.fieldTemplate,l.JSONForm.fieldTypes=g.elementTypes,l.JSONForm.getInitialValue=x,l.JSONForm.util.getObjKey=g.util.getObjKey,l.JSONForm.util.setObjKey=g.util.setObjKey}("undefined"!=typeof exports,"undefined"!=typeof exports?exports:window,"undefined"!=typeof jQuery?jQuery:{fn:{}},"undefined"!=typeof _?_:null,JSON);