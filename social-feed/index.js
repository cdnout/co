if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}(function(c,b,a,d){c.fn.socialfeed=function(m){var h={plugin_folder:"",template:"template.html",show_media:false,length:500};var m=c.extend(h,m),f=c(this),l,k=["facebook","instagram","vk","google","blogspot","twitter"];f.empty().css("display","inline-block");function e(){var n=true;if(n&&m.callback){m.callback()}}var j={request:function(n,o){c.ajax({url:n,dataType:"jsonp",success:o})},get_request:function(n,o){c.get(n,o,"json")},wrapLinks:function(n,o){var p=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;if(o==="google-plus"){n=n.replace(/(@|#)([a-z0-9_]+['])/ig,j.wrapGoogleplusTagTemplate)}else{n=n.replace(p,j.wrapLinkTemplate)}return n},wrapLinkTemplate:function(n){return'<a target="_blank" href="'+n+'">'+n+"</a>"},wrapGoogleplusTagTemplate:function(n){return'<a target="_blank" href="https://plus.google.com/s/'+n+'" >'+n+"</a>"},shorten:function(n){n=c.trim(n);if(n.length>m.length){return jQuery.trim(n).substring(0,m.length).split(" ").slice(0,-1).join(" ")+"..."}else{return n}},stripHTML:function(n){if(typeof n==="undefined"||n===null){return""}return n.replace(/(<([^>]+)>)|nbsp;|\s{2,}|/ig,"")}};function i(o,n){this.content=n;this.content.attachment=(this.content.attachment==d)?"":this.content.attachment;this.content.time_ago=n.dt_create.fromNow();this.content.dt_create=this.content.dt_create.valueOf();this.content.text=j.wrapLinks(j.shorten(n.message+" "+n.description),n.social_network);this.content.moderation_passed=(m.moderation)?m.moderation(this.content):true;g[o].posts.push(this)}i.prototype={render:function(){var n=g.template(this.content);var r=this.content;if(c(f).children("[social-feed-id="+r.id+"]").length!=0){return false}if(c(f).children().length==0){c(f).append(n)}else{var o=0,p=-1;c.each(c(f).children(),function(){if(c(this).attr("dt-create")<r.dt_create){p=o;return false}o++});c(f).append(n);if(p>=0){p++;var q=c(f).children("div:nth-child("+p+")"),s=c(f).children("div:last-child");c(s).insertBefore(q)}}}};var g={template:false,init:function(){g.getTemplate(function(){k.forEach(function(n){if(m[n]){m[n].accounts.forEach(function(o){g[n].getData(o)})}})})},getTemplate:function(n){if(g.template){return n()}else{if(m.template_html){g.template=doT.template(m.template_html);return n()}else{c.get(m.template,function(o){g.template=doT.template(o);return n()})}}},twitter:{posts:[],loaded:false,api:"http://api.tweecool.com/",getData:function(q){var n=new Codebird;n.setConsumerKey(m.twitter.consumer_key,m.twitter.consumer_secret);switch(q[0]){case"@":var o=q.substr(1);n.__call("statuses_userTimeline","id="+o+"&count="+m.twitter.limit,g.twitter.utility.getPosts,true);break;case"#":var p=q.substr(1);n.__call("search_tweets","q="+p,function(r){g.twitter.utility.getPosts(r.statuses)},true);break;default:}},utility:{getPosts:function(n){c.each(n,function(){var p=this;var o=new i("twitter",g.twitter.utility.unifyPostData(p));o.render()})},unifyPostData:function(o){var n={};n.id=o.id;n.dt_create=moment(g.twitter.utility.fixTwitterDate(o.created_at));n.author_link="http://twitter.com/"+o.user.screen_name;n.author_picture=o.user.profile_image_url;n.post_url=n.author_link+"/status/"+o.id_str;n.author_name=o.user.name;n.message=o.text;n.description="";n.social_network="twitter";n.link="http://twitter.com/"+o.user.screen_name+"/status/"+o.id_str;if(m.show_media===true){if(o.entities.media&&o.entities.media.length>0){image_url=o.entities.media[0].media_url;if(image_url){n.attachment='<img class="attachment" src="'+image_url+'" />'}}}return n},fixTwitterDate:function(n){n=n.replace("+0000","Z");if(n!==d){return n}}}},facebook:{posts:[],graph:"https://graph.facebook.com/",loaded:false,getData:function(q){var o,n="limit="+m.facebook.limit,r="&access_token="+m.facebook.access_token+"&callback=?";switch(q[0]){case"@":var s=q.substr(1);o=g.facebook.graph+s+"/posts?"+n+r;j.request(o,g.facebook.utility.getPosts);break;case"#":var p=q.substr(1);o=g.facebook.graph+"search?q=%23"+p+"&"+n+r;j.request(o,g.facebook.utility.getPosts);break;default:o=g.facebook.graph+"search?q="+q+"&"+n+r;j.request(o,g.facebook.utility.getPosts)}},utility:{getPosts:function(n){if(n.data){n.data.forEach(function(p){var o=new i("facebook",g.facebook.utility.unifyPostData(p));o.render()})}},unifyPostData:function(o){var n={},p=(o.message)?o.message:o.story;n.id=o.id;n.dt_create=moment(o.created_time);n.author_link="http://facebook.com/"+o.from.id;n.author_picture=g.facebook.graph+o.from.id+"/picture";n.author_name=o.from.name;if(p){n.message=p}n.description=(o.description)?o.description:"";n.link=(o.link)?o.link:"http://facebook.com/"+o.from.id;n.social_network="facebook";if(m.show_media===true){if(o.picture){var q=o.picture;if(o.object_id){q=g.facebook.graph+o.object_id+"/picture/?type=normal"}else{q=q+"&w=500&h=500"}n.attachment='<img class="attachment" src="'+q+'" />'}}return n}}},google:{posts:[],loaded:false,api:"https://www.googleapis.com/plus/v1/",getData:function(p){var n;switch(p[0]){case"#":var o=p.substr(1);n=g.google.api+"activities?query="+o+"&key="+m.google.access_token+"&maxResults="+m.google.limit;j.request(n,g.google.utility.getPosts);break;case"@":var q=p.substr(1);n=g.google.api+"people/"+q+"/activities/public?key="+m.google.access_token+"&maxResults="+m.google.limit;Utilityrequest(n,g.google.utility.getPosts);break;default:}},utility:{getPosts:function(n){n.items.forEach(function(p){var o=new i("google",g.google.utility.unifyPostData(p));o.render()})},unifyPostData:function(o){var n={};n.id=o.id;n.attachment="";n.description="";n.dt_create=moment(o.published);n.author_link=o.actor.url;n.author_picture=o.actor.image.url;n.author_name=o.actor.displayName;if(m.show_media===true){if(o.object.attachments){c.each(o.object.attachments,function(){var p="";if(this.fullImage){p=this.fullImage.url}else{if(this.objectType=="album"){if(this.thumbnails&&this.thumbnails.length>0){if(this.thumbnails[0].image){p=this.thumbnails[0].image.url}}}}n.attachment='<img class="attachment" src="'+p+'"/>'})}}if(o.object.content===""){c.each(o.object.attachments,function(){if(this.content!==d){n.message=this.content}else{if(this.displayName!==d){n.message=this.displayName+"<br />"+this.url}}})}else{n.message=o.object.content}n.social_network="google-plus";n.link=o.url;return n}}},instagram:{posts:[],loaded:false,getData:function(r){var p,n="count="+m.instagram.limit,s="client_id="+m.instagram.client_id+"&"+n+"&callback=?",o="https://api.instagram.com/v1/";switch(r[0]){case"@":var t=r.substr(1);p=o+"users/search/?q="+t+"&"+s;j.request(p,g.instagram.utility.getUsers);break;case"#":var q=r.substr(1);p=o+"tags/"+q+"/media/recent/?"+s;j.request(p,g.instagram.utility.getImages);break;default:}},utility:{getImages:function(n){n.data.forEach(function(p){var o=new i("instagram",g.instagram.utility.unifyPostData(p));o.render()})},getUsers:function(n,o){n.data.forEach(function(p){if(p.username==o){var q=igm_api_base+"users/"+p.id+"/media/recent/?"+query_extention;j.request(q,g.instagram.utility.getImages)}})},unifyPostData:function(o){var n={};n.id=o.id;n.dt_create=moment(o.created_time*1000);n.author_link="http://instagram.com/"+o.user.username;n.author_picture=o.user.profile_picture;n.author_name=o.user.full_name;n.message=(o.caption&&o.caption)?o.caption.text:"";n.description="";n.social_network="instagram";n.link=o.link;if(m.show_media){n.attachment='<img class="attachment" src="'+o.images.standard_resolution.url+'" />'}return n}}},vk:{posts:[],loaded:false,base:"http://vk.com/",api:"https://api.vk.com/method/",user_json_template:"https://api.vk.com/method/users.get?fields=first_name,%20last_name,%20screen_name,%20photo&uid=",group_json_template:"https://api.vk.com/method/groups.getById?fields=first_name,%20last_name,%20screen_name,%20photo&gid=",getData:function(p){var n;switch(p[0]){case"@":var q=p.substr(1);n=g.vk.api+"wall.get?owner_id="+q+"&filter="+m.vk.source+"&count="+m.vk.limit+"&callback=?";j.get_request(n,g.vk.utility.getPosts);break;case"#":var o=p.substr(1);n=g.vk.api+"newsfeed.search?q="+o+"&count="+m.vk.limit+"&callback=?";j.get_request(n,g.vk.utility.getPosts);break;default:}},utility:{getPosts:function(n){c.each(n.response,function(){if(this!=parseInt(this)&&this.post_type=="post"){var p=(this.owner_id)?this.owner_id:this.from_id,o=(p>0)?(g.vk.user_json_template+p+"&callback=?"):(g.vk.group_json_template+(-1)*p+"&callback=?"),q=this;j.get_request(o,function(r){g.vk.utility.unifyPostData(r,q,n)})}})},unifyPostData:function(s,q,p){var o={};o.id=q.id;o.dt_create=moment.unix(q.date);o.description=" ";o.message=j.stripHTML(q.text);o.social_network="vk";if(m.show_media){if(q.attachment){if(q.attachment.type=="video"){o.attachment='<img class="attachment" src="'+q.attachment.video.image_big+'" />'}if(q.attachment.type=="photo"){o.attachment='<img class="attachment" src="'+q.attachment.photo.src_big+'" />'}if(q.attachment.type=="link"){o.attachment='<img class="attachment" src="'+q.attachment.link.image_src+'" />'}}}if(q.from_id>0){var r=g.vk.user_json_template+q.from_id+"&callback=?";j.get_request(r,function(u){var t=new i("vk",g.vk.utility.getUser(u,o,q,p));t.render()})}else{var n=g.vk.group_json_template+(-1)*q.from_id+"&callback=?";j.get_request(n,function(u){var t=new i("vk",g.vk.utility.getGroup(u,o,q,p));t.render()})}},getUser:function(q,p,o,n){p.author_name=q.response[0].first_name+" "+q.response[0].last_name;p.author_picture=q.response[0].photo;p.author_link=g.vk.base+q.response[0].screen_name;p.link=g.vk.base+q.response[0].screen_name+"?w=wall"+o.from_id+"_"+o.id;return p},getGroup:function(q,p,o,n){p.author_name=q.response[0].name;p.author_picture=q.response[0].photo;p.author_link=g.vk.base+q.response[0].screen_name;p.link=g.vk.base+q.response[0].screen_name+"?w=wall-"+q.response[0].gid+"_"+o.id;return p}}},blogspot:{loaded:false,getData:function(o){var n;switch(o[0]){case"@":var p=o.substr(1);n="http://"+p+".blogspot.com/feeds/posts/default?alt=json-in-script&callback=?";request(n,getPosts);break;default:}},utility:{getPosts:function(n){c.each(n.feed.entry,function(){var p={},o=this;p.id=o.id["$t"].replace(/[^a-z0-9]/gi,"");p.dt_create=moment((o.published["$t"]));p.author_link=o.author[0]["uri"]["$t"];p.author_picture="http:"+o.author[0]["gd$image"]["src"];p.author_name=o.author[0]["name"]["$t"];p.message=o.title["$t"]+"</br></br>"+stripHTML(o.content["$t"]);p.description="";p.social_network="blogspot";p.link=o.link.pop().href;if(m.show_media){if(o["media$thumbnail"]){p.attachment='<img class="attachment" src="'+o["media$thumbnail"]["url"]+'" />'}}p.render()})}}}};g.init();if(m.update_period){setInterval(function(){return g.init()},m.update_period)}}})(jQuery);