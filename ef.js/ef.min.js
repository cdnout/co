!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ef={})}(this,(function(e){"use strict";var t="&",n="&&",r=new RegExp("\\&[0-7]{1,3}","g"),a=new RegExp("\\&u\\[.*?\\]","g"),o=new RegExp("\\&u.{0,4}","g"),i=new RegExp("\\&x.{0,2}","g"),c=new RegExp("\\&","g"),s=new RegExp("\\&b","g"),u=new RegExp("\\&t","g"),p=new RegExp("\\&n","g"),l=new RegExp("\\&v","g"),f=new RegExp("\\&f","g"),h=new RegExp("\\&r","g"),d=function(){throw new SyntaxError("Octal escape sequences are not allowed in EFML.")},v=function(e){if(e=e.substr(3,e.length-4),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");try{return String.fromCodePoint(e)}catch(e){throw new SyntaxError("Undefined Unicode code-point")}},m=function(e){if(e=e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");return String.fromCharCode(e)},y=function(e){if(e="00"+e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid hexadecimal escape sequence");return String.fromCharCode(e)},g=function(e){for(var g=[],b=0,x=e.split(n);b<x.length;b+=1){var N=x[b].replace(r,d).replace(a,v).replace(o,m).replace(i,y).replace(s,"\b").replace(u,"\t").replace(p,"\n").replace(l,"\v").replace(f,"\f").replace(h,"\r").replace(c,"");g.push(N)}return g.join(t)},b=function(e){return e[e.length-1]===t},x=function(e,t){for(var n=[],r=!1,a=0,o=e.split(t);a<o.length;a+=1){var i=o[a];r?n[n.length-1]+=""+t+i:n.push(i),r=b(i)}return n},N=function(e,t){for(var r=e.split(n),a=x(r.shift(),t),o=0,i=r;o<i.length;o+=1){var c=i[o],s=x(c,t);a[a.length-1]+="&&"+s.shift(),a.push.apply(a,s)}return a},$=["$ctx","$refs","$data","$methods","$mount","$umount","$subscribe","$unsubscribe","$update","$dispatch","$emit","$on","$off","$destroy","__DIRECTMOUNT__"],w=/\{\{.+?\}\}/g,E=/^(\t*)( *).*/,k=/#([^}]|}[^}])*$/,O=function(e,t){return void 0===t&&(t=-2),"Failed to parse eft template: "+e+". at line "+(t+1)},_=function(e){return["number","boolean","string"].indexOf(typeof e)>-1},D=function(e){if(!e)return[e,!1];try{var t=JSON.parse(e);return-1===["number","boolean"].indexOf(typeof t)?[g(e),!0]:[t,!1]}catch(t){return[g(e),!0]}},T=function(e){e=e.slice(2,e.length-2);var t=N(e,"="),n=t[0],r=t.slice(1),a=N(n.trim(),".").map(g),o=D(r.join("=").trim()),i=o[0],c=o[1];return _(i)&&(c||!c&&""!==i)?[a,i]:[a]},F=function(e){var t=e.split(w);if(1===t.length)return D(e)[0];var n=[];2!==t.length||t[0]||t[1]?n.push(t.map(g)):n.push(0);var r=e.match(w);return r&&n.push.apply(n,r.map(T)),n},C=function(e,t){t&&e.push(t)},j=function(e){var t=F(e);if(_(t))return[""+t];for(var n=t[0],r=t.slice(1),a=[],o=0;o<r.length;o++)C(a,n[o]),a.push(r[o]);return C(a,n[n.length-1]),a},P=function(e){return e.replace(/\./g," ")},R=function(e,t,n){var r=parseInt(n,10);if(isNaN(r))return function(e,t){switch(t){case"stop":e.s=1;break;case"stopImmediate":e.i=1;break;case"prevent":e.p=1;break;case"shift":e.h=1;break;case"alt":e.a=1;break;case"ctrl":e.c=1;break;case"meta":e.t=1;break;case"capture":e.u=1;break;default:console.warn("Dropped unsupported eft event option '"+t+"'.")}}(e,g(n));t.push(r)},A=function(e){var t={},n=[],r=N(e,"."),a=r[0],o=r.slice(1);t.l=g(a);for(var i=0,c=o;i<c.length;i+=1){var s=c[i];R(t,n,s)}return n.length>0&&(t.k=n),t},I=function(e){var t,n,r=e.line,a=e.ast,o=e.parsingInfo,i=e.i;if(r.replace(/\s/,"")){!function(e,t){null===t.offset&&(t.offset=e.match(/\s*/)[0],t.offset&&(t.offsetReg=t.offset))}(r,o);var c=function(e,t,n){if(t.offsetReg){var r=!1;if(e=e.replace(t.offsetReg,(function(){return r=!0,""})),!r)throw new SyntaxError(O("Expected indent to be grater than 0 and less than "+(t.prevDepth+1)+", but got -1",n))}return e}(r,o,i);!function(e,t){if(!t.indentReg){var n=e.match(E)[2];n&&(t.indentReg=new RegExp(n,"g"))}}(c,o);var s=function(e,t,n){var r=0;t.indentReg&&(e=e.replace(/^\s*/,(function(e){return e.replace(t.indentReg,"\t")})));var a=e.replace(/^\t*/,(function(e){return r=e.length,""}));if(/^\s/.test(a))throw new SyntaxError(O("Bad indent",n));return{depth:r,content:a}}(c,o,i),u=s.depth,p=s.content;if(p){if(u<0||u-o.prevDepth>1||u-o.prevDepth==1&&-1===["comment","tag"].indexOf(o.prevType)||"comment"!==o.prevType&&0===u&&o.topExists)throw new SyntaxError(O("Expected indent to be grater than 0 and less than "+(o.prevDepth+1)+", but got "+u,i));var l=p[0];if(!(p=p.slice(1))&&">#%@.-+".indexOf(l)>=0)throw new SyntaxError(O("Empty content",i));switch((u<o.prevDepth||u===o.prevDepth&&"tag"===o.prevType)&&(o.currentNode=function(e,t){for(var n=e,r=0;r<t;r++)n=n[n.length-1];return n}(a,u)),o.prevDepth=u,l){case">":var f=function(e){var t={},n=N(e.replace(k,(function(e){return t.ref=e.slice(1),""})),"."),r=n[0],a=n.slice(1);return t.tag=g(r),t.class=F(a.join(".")),"string"==typeof t.class?t.class=P(t.class).trim():t.class[0]&&(t.class[0]=t.class[0].map(P)),t}(p),h=[{t:f.tag}];f.class&&(h[0].a={},h[0].a.class=f.class),f.ref&&(h[0].r=f.ref),o.currentNode.push(h),o.currentNode=h,o.prevType="tag";break;case"#":var d=function(e){var t=N(e,"=");return{name:g(t.shift().trim()),value:F(t.join("=").trim())}}(p),v=d.name,m=d.value;o.currentNode[0].a||(o.currentNode[0].a={}),o.currentNode[0].a[v]=m,o.prevType="attr";break;case"%":var y=function(e){var t=N(e,"="),n=t.shift().trim(),r=N(n,"@"),a=r[0],o=r[1],i=N(a,"!"),c=i[0],s=i[1],u=o&&A(o);return{propPath:N(c,".").map(g),value:F(t.join("=").trim()),updateOnly:s,syncTrigger:u}}(p),b=y.propPath,x=y.value,w=y.updateOnly,_=y.syncTrigger,D=[b,x];_?(D.push(_),""===w&&D.push(!0)):""===w&&(D.push(null),D.push(!0)),o.currentNode[0].p||(o.currentNode[0].p=[]),o.currentNode[0].p.push(D),o.prevType="prop";break;case"@":var T=function(e){var t=N(e,"=");return{name:t.shift().trim(),value:t.join("=").trim()}}(p),C=T.name,R=T.value;o.currentNode[0].e||(o.currentNode[0].e=[]);var I=A(C),S=function(e){var t=N(e,":"),n=t[0],r=t.slice(1).join(":"),a=g(n.trim());return r?[a,F(r)]:[a]}(R),q=S[0],U=S[1];I.m=q,U&&(I.v=U),o.currentNode[0].e.push(I),o.prevType="event";break;case".":(t=o.currentNode).push.apply(t,j(p)),o.prevType="text";break;case"|":o.currentNode.length>1&&(p="\n"+p),(n=o.currentNode).push.apply(n,j(p)),o.prevType="multiline-text";break;case"-":if(-1!==$.indexOf(p))throw new SyntaxError(O("Reserved name '"+p+"' should not be used",i));o.currentNode.push({n:p,t:0}),o.prevType="node";break;case"+":o.currentNode.push({n:p,t:1}),o.prevType="list";break;default:o.prevType="comment"}}}},S=function(e){if(!e)throw new TypeError(O("Template required, but nothing given"));var t=typeof e;if("string"!==t)throw new TypeError(O("Expected a string, but got a(n) "+t));for(var n=e.split(/\r?\n/),r=[{t:0}],a={indentReg:null,prevDepth:0,offset:null,offsetReg:null,prevType:"comment",currentNode:r,topExists:!1},o=0;o<n.length;o++)I({line:n[o],ast:r,parsingInfo:a,i:o});if(r.length<=1)throw new SyntaxError(O("Nothing to be parsed",n.length-1));return 2===r.length&&Array.isArray(r[1])&&Object.hasOwnProperty.call(r[1][0],"t")?r[1]:r},q=Array,U=q.prototype,B={copy:function(e){return U.slice.call(e,0)},empty:function(e){return e.length=0,e},equals:function(e,t){if(!q.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0},pop:function(e){return U.pop.call(e)},push:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return U.push.apply(e,t)},remove:function(e,t){var n=U.indexOf.call(e,t);if(n>-1)return U.splice.call(e,n,1),t},reverse:function(e){return U.reverse.call(e)},rightUnique:function(e){for(var t=[],n=0;n<e.length;n++){for(var r=n+1;r<e.length;r++)e[n]===e[r]&&(r=n+=1);t.push(e[n])}return t},shift:function(e){return U.shift.call(e)},slice:function(e,t,n){return U.slice.call(e,t,n)},sort:function(e,t){return U.sort.call(e,t)},splice:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return U.splice.apply(e,t)},unshift:function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return U.unshift.apply(e,t)},isArray:function(e){return q.isArray(e)}};"undefined"!=typeof Set&&q.from?B.unique=function(e){return q.from(new Set(e))}:B.unique=B.rightUnique;var L=function(e){return B.isArray(e)?"array":typeof e},M=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r="",a=0;a<t.length;a++)void 0===t[a]?r+=e[a]:r+=e[a]+t[a];return r+e[e.length-1]},K=function(e){var t=e.dataNode[e._key];return void 0===t?"":t},Z=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(!e)return K(t[0]);var r=[e];return r.push.apply(r,t.map(K)),M.apply(void 0,r)},J=[],V=[],W=[],G=0,X=function(e){return J.push.apply(J,e)},z=function(e){return V.push(e)},H=function(){return G+=1},Q=function(){if(0!==W.length){var e=B.unique(W);B.empty(W);for(var t=0,n=e;t<n.length;t+=1){(0,n[t])()}}},Y=function(e){return!e&&(G-=1)>0||(G=0,J.length>0&&function(){if(0!==J.length){var e=B.unique(J);B.empty(J);for(var t=0,n=e;t<n.length;t+=1)(0,n[t])()}}(),V.length>0&&function(){if(0!==V.length){var e=B.rightUnique(V);B.empty(V);for(var t=0,n=e;t<n.length;t+=1)(0,n[t])()}}(),W.length>0&&setTimeout(Q,0)),G},ee=function(e,t){for(var n in t)e[n]=t[n];return e},te=Object.assign||ee,ne=function(e,t){var n={};return Object.defineProperty(t,e,{get:function(){return n},set:function(e){H(),te(n,e),Y()},configurable:!1,enumerable:!0}),n},re=function(e){var t=e._path,n=e._key,r=e.data,a=e.handlers,o=e.subscribers,i=e.innerData,c=function(e,t){for(var n=0,r=e;n<r.length;n+=1){var a=r[n];t=t[a]?t[a]:ne(a,t)}return t}(t,r),s=function(e){for(var t=e._path,n=e.handlers,r=e.subscribers,a=e.innerData,o=0,i=t;o<i.length;o+=1){var c=i[o];n[c]||(n[c]={}),r[c]||(r[c]={}),a[c]||(a[c]={}),n=n[c],r=r[c],a=a[c]}return{handlerNode:n,subscriberNode:r,dataNode:a}}({_path:t,handlers:a,subscribers:o,innerData:i}),u=s.handlerNode,p=s.subscriberNode,l=s.dataNode;return u[n]||(u[n]=[]),p[n]||(p[n]=[]),Object.prototype.hasOwnProperty.call(l,n)||(l[n]=void 0),{parentNode:c,handlerNode:u[n],subscriberNode:p[n],dataNode:l}},ae=function(e){return e!=e},oe="[EF] %s",ie={log:console.log.bind(console,oe),info:console.info.bind(console,oe),warn:console.warn.bind(console,oe),error:console.error.bind(console,oe)},ce=function(e){var t=e.bind,n=e.ctx,r=e.handlers,a=e.subscribers,o=e.innerData,i=B.copy(t[0]),c=i.pop(),s=re({_path:i,_key:c,data:n.data,handlers:r,subscribers:a,innerData:o}),u=s.parentNode,p=s.handlerNode,l=s.subscriberNode,f=s.dataNode;return Object.prototype.hasOwnProperty.call(u,c)||function(e){var t=e.parentNode,n=e.dataNode,r=e.handlerNode,a=e.subscriberNode,o=e.ctx,i=e._key,c=!1;Object.defineProperty(t,i,{get:function(){return n[i]},set:function(e){if(!c)if(c=!0,n[i]===e||ae(n[i])&&ae(e))c=!1;else{if(n[i]=e,H(),X(r),Y(),a.length>0){H();try{for(var t=0,s=a;t<s.length;t+=1)(0,s[t])({state:o.state,value:e})}catch(e){ie.error("Error caught when executing subscribers:\n",e)}Y()}c=!1}},enumerable:!0})}({parentNode:u,dataNode:f,handlerNode:p,subscriberNode:l,ctx:n,_key:c}),t.length>1&&(u[c]=t[1]),{dataNode:f,parentNode:u,handlerNode:p,subscriberNode:l,_key:c}},se=function(e,t){return e.constructor===t},ue=function(e,t){for(var n=0,r=t;n<r.length;n+=1){var a=r[n];Object.defineProperty(e.prototype,a,{enumerable:!1})}return e},pe=function(e,t){var n=B.copy(e);return B.unshift(n,t),n},le="undefined"!=typeof document&&"undefined"!=typeof Node,fe={},he=new WeakMap,de={},ve=function(){function e(){this.$children=[],this.$safeZone=de.document.createDocumentFragment()}return e.prototype.append=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return de.append.apply(null,pe(t,this.$safeZone)),(e=this.$children).push.apply(e,t)},e.prototype.appendTo=function(e){de.append.apply(null,pe(this.$children,e))},e.prototype.removeChild=function(e){de.remove(e),B.remove(this.$children,e)},e.prototype.remove=function(){for(var e=0,t=this.$children;e<t.length;e+=1){var n=t[e];de.append(this.$safeZone,n)}},e}(),me=function(e,t){var n=e.$ctx.nodeInfo,r=n.element,a=n.placeholder;de.append(t,r,a)},ye=function(e,t){if(3===e.nodeType){var n=he.get(e);if(n){var r=n.node;if(r)if(B.isArray(r))for(var a=0,o=r;a<o.length;a+=1){var i=o[a];me(i,t)}else me(r,t)}}};de.before=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=de.document.createDocumentFragment();H();for(var a=0,o=t;a<o.length;a+=1){var i=o[a];i instanceof fe.EFBaseComponent?i.$mount({target:r}):se(i,ve)?i.appendTo(r):(de.Node.prototype.appendChild.call(r,i),ye(i,r))}de.Node.prototype.insertBefore.call(e.parentNode,r,e),Y()},de.after=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];var r=de.document.createDocumentFragment();H();for(var a=0,o=t;a<o.length;a+=1){var i=o[a];i instanceof fe.EFBaseComponent?i.$mount({target:r}):se(i,ve)?i.appendTo(r):de.Node.prototype.appendChild.call(r,i)}e.nextSibling?de.Node.prototype.insertBefore.call(e.parentNode,r,e.nextSibling):de.Node.prototype.appendChild.call(e.parentNode,r),Y()},de.append=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(se(e,ve))return e.append.apply(e,t);if(e instanceof fe.EFBaseComponent){if(!B.isArray(e.children))return;H();for(var r=0,a=t;r<a.length;r+=1){var o=a[r];o=new fe.toEFComponent(o),e.children.push(o)}Y()}else if(-1!==[1,9,11].indexOf(e.nodeType)){for(var i=de.document.createDocumentFragment(),c=0,s=t;c<s.length;c+=1){var u=s[c];se(u,ve)?u.appendTo(i):u instanceof de.Node?(de.Node.prototype.appendChild.call(i,u),ye(u,i)):u instanceof fe.EFBaseComponent&&u.$mount({target:i})}de.Node.prototype.appendChild.call(e,i)}},de.remove=function(e){se(e,ve)?e.remove():e instanceof fe.EFBaseComponent?e.$umount():de.Node.prototype.removeChild.call(e.parentNode,e)};var ge=function(e){return te(de,e)};le&&ge({Node:Node,document:document});var be=function(e,t){void 0===t&&(t={bubbles:!1,cancelable:!1});var n=t.bubbles,r=t.cancelable,a=de.document.createEvent("CustomEvent");return a.initEvent(e,n,r),a},xe={xml:"http://www.w3.org/XML/1998/namespace",html:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML",xlink:"http://www.w3.org/1999/xlink"},Ne=function(e){if(xe[e])return xe[e];throw new Error('[EF] Namespace "'+e+'" has not been declared.')},$e=function(e){return["number","boolean","string"].indexOf(typeof e)>-1},we=function(e){var t=e.tagName,n=e.tagContent,r=e.attrs,a=e.ref,o=e.refs,i=function(e){var t=e.tagName,n=e.tagContent,r=e.attrs,a=e.namespace;switch(typeof n){case"string":var o={};return t===n&&r&&r.is&&"string"==typeof r.is&&(o.is=r.is),a?de.document.createElementNS(a,n,o):de.document.createElement(n,o);case"function":return new n;default:return n.tag&&(t=n.tag),a?de.document.createElementNS(a,t,{is:n.is}):de.document.createElement(t,{is:n.is})}}({tagName:t,tagContent:n,attrs:r,namespace:e.namespace});return a&&Object.defineProperty(o,a,{value:i,enumerable:!0}),i},Ee=function(e){var t=e.val,n=e.ctx,r=e.handlers,a=e.subscribers,o=e.innerData,i=e.handler;if(B.isArray(t)){var c=t[0],s=t.slice(1),u=[c],p=function(){return i(Z.apply(void 0,u))};return u.push.apply(u,s.map((function(e){var t=ce({bind:e,ctx:n,handlers:r,subscribers:a,innerData:o}),i=t.dataNode,c=t.handlerNode,s=t._key;return c.push(p),{dataNode:i,_key:s}}))),p}return function(){return t}},ke=function(e){var t=e.element,n=e.attr,r=e.key,a=e.ctx,o=e.handlers,i=e.subscribers,c=e.innerData,s=e.custom;if($e(n)){if(s)return void(t[r]=""===n||n);if("is"===r)return;if(r.indexOf(":")>-1){var u=r.split(":")[0];if("xmlns"!==u)return t.setAttributeNS(a.localNamespaces[u]||Ne(u),r,n)}return t.setAttribute(r,n)}var p=function(e){var t=e.element,n=e.key,r=e.custom,a=e.ctx;if(r)return function(e){t[n]=e};if("class"===n)return function(e){if(!(e=(""+e).replace(/\s+/g," ").trim()))return t.removeAttribute(n);t.setAttribute(n,e)};if(n.indexOf(":")>-1){var o=n.split(":")[0],i=a.localNamespaces[o]||Ne(o);return function(e){if(""===e)return t.removeAttributeNS(i,n);t.setAttributeNS(i,n,e)}}return function(e){if(""===e)return t.removeAttribute(n);t.setAttribute(n,e)}}({element:t,key:r,custom:s,ctx:a});X([Ee({val:n,ctx:a,handlers:o,subscribers:i,innerData:c,handler:p})])},Oe=function(e){var t=e.element,n=e.propPath,r=e.value,a=e.syncTrigger,o=e.updateOnly,i=e.ctx,c=e.handlers,s=e.subscribers,u=e.innerData,p=e.custom,l=B.copy(n),f=l.pop();p&&l.unshift("$data");var h=function(e,t){for(var n=0,r=e;n<r.length;n+=1){var a=r[n];t[a]||(t[a]={}),t=t[a]}return t}(l,t);if($e(r))h[f]=r;else{var d={locked:!1},v=function(e){d.locked||h[f]===e||(h[f]=e),d.locked=!1};o&&(v=function(){d.locked=!1});var m=Ee({val:r,ctx:i,handlers:c,subscribers:s,innerData:u,handler:v});!a&&(1!==n.length||"value"!==f&&"checked"!==f||r[0])||function(e){var t=e.ctx,n=e.syncTrigger,r=e.updateLock,a=e.handlers,o=e.subscribers,i=e.innerData,c=e.element,s=e.lastNode,u=e.key,p=e.expr,l=e.custom,f=l?"$on":"addEventListener",h=ce({bind:p,ctx:t,handlers:a,subscribers:o,innerData:i}),d=h.parentNode,v=h._key,m=function(){r.locked=!0,H(),d[v]=s[u],Y()};if(n){var y=n.l,g=n.s,b=n.i,x=n.p,N=n.h,$=n.a,w=n.c,E=n.t,k=n.u,O=n.k;c[f](y,(function(e){!!N!=!!e.shiftKey||!!$!=!!e.altKey||!!w!=!!e.ctrlKey||!!E!=!!e.metaKey||O&&-1===O.indexOf(e.which)||(g&&e.stopPropagation(),b&&e.stopImmediatePropagation(),x&&e.preventDefault(),m())}),!!k)}else if("value"===u)c[f]("input",m,!0),c[f]("keyup",m,!0),c[f]("change",m,!0);else{var _=l?"$dispatch":"dispatchEvent";c[f]("change",(function(){if(c[_](be("--ef-change-event--"),{bubbles:!0,canceoable:!1}),"INPUT"===c.tagName&&"radio"===c.type&&""!==c.name){var e=de.document.querySelectorAll("input[name="+c.name+"][type=radio]");if(e){var t=B.copy(e);B.remove(t,c);for(var n=0,r=t;n<r.length;n+=1)r[n].dispatchEvent(be("--ef-change-event--"))}}}),!0),c[f]("--ef-change-event--",m)}}({ctx:i,syncTrigger:a,updateLock:d,handlers:c,subscribers:s,innerData:u,element:t,lastNode:h,key:f,expr:r[1],custom:p}),X([m])}},_e=function(e){return e},De=function(e){var t=e.element,n=e.event,r=e.ctx,a=e.handlers,o=e.subscribers,i=e.innerData,c=e.custom?"$on":"addEventListener",s=n.l,u=n.m,p=n.s,l=n.i,f=n.p,h=n.h,d=n.a,v=n.c,m=n.t,y=n.u,g=n.k,b=n.v,x=Ee({val:b,ctx:r,handlers:a,subscribers:o,innerData:i,handler:_e});t[c](s,(function(e){!!h!=!!e.shiftKey||!!d!=!!e.altKey||!!v!=!!e.ctrlKey||!!m!=!!e.metaKey||g&&-1===g.indexOf(e.which)||(p&&e.stopPropagation(),l&&e.stopImmediatePropagation(),f&&e.preventDefault(),r.methods[u]&&r.methods[u]({e:e,value:x(),state:r.state}))}),!!y)},Te={empty:function(){H();for(var e=0,t=B.copy(this);e<t.length;e+=1){t[e].$destroy()}Y(),B.empty(this)},clear:function(){H();for(var e=0,t=B.copy(this);e<t.length;e+=1){t[e].$umount()}Y(),B.empty(this)},pop:function(){if(0!==this.length){var e=B.pop(this);return e.$umount(),e}},push:function(e){for(var t=e.ctx,n=e.key,r=e.anchor,a=[],o=arguments.length-1;o-- >0;)a[o]=arguments[o+1];a=a.map(fe.toEFComponent);var i=[];H();for(var c=0,s=a;c<s.length;c+=1){var u=s[c];B.push(i,u.$mount({parent:t.state,key:n}))}return 0===this.length?de.after.apply(de,[r].concat(i)):de.after.apply(de,[this[this.length-1].$ctx.nodeInfo.placeholder].concat(i)),Y(),B.push.apply(B,[this].concat(a))},remove:function(e){if(-1!==this.indexOf(e))return e.$umount(),e},reverse:function(e){var t=e.ctx,n=e.key,r=e.anchor;if(0===this.length)return this;var a=B.copy(this),o=[];H();for(var i=a.length-1;i>=0;i--)a[i].$umount(),B.push(o,a[i].$mount({parent:t.state,key:n}));return B.push.apply(B,[this].concat(B.reverse(a))),de.after.apply(de,[r].concat(o)),Y(),this},shift:function(){if(0!==this.length){var e=B.shift(this);return e.$umount(),e}},sort:function(e,t){var n=e.ctx,r=e.key,a=e.anchor;if(0===this.length)return this;var o=B.copy(B.sort(this,t)),i=[];H();for(var c=0,s=o;c<s.length;c+=1){var u=s[c];u.$umount(),B.push(i,u.$mount({parent:n.state,key:r}))}return B.push.apply(B,[this].concat(o)),de.after.apply(de,[a].concat(i)),Y(),this},splice:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(0===this.length)return this;var n=B.splice.apply(B,[B.copy(this)].concat(e));H();for(var r=0,a=n;r<a.length;r+=1){var o=a[r];o.$umount()}return Y(),n},unshift:function(e){for(var t,n=e.ctx,r=e.key,a=e.anchor,o=[],i=arguments.length-1;i-- >0;)o[i]=arguments[i+1];if(0===this.length)return(t=this).push.apply(t,o).length;o=o.map(fe.toEFComponent);var c=[];H();for(var s=0,u=o;s<u.length;s+=1){var p=u[s];B.push(c,p.$mount({parent:n.state,key:r}))}return de.after.apply(de,[a].concat(c)),Y(),B.unshift.apply(B,[this].concat(o))}},Fe={BEFORE:"before",AFTER:"after",APPEND:"append",REPLACE:"replace"},Ce=Ne("svg"),je=Ne("math"),Pe=Ne("html"),Re=Object.create(null),Ae=[function(e){var t=e.ctx,n=e.key,r=e.value,a=t.children[n],o=a.anchor,i=a.node;i!==r&&(r=fe.toEFComponent(r),H(),i&&(r===Re?r=null:i.$umount()),a.node=r,r&&r.$mount({target:o,parent:t.state,option:Fe.BEFORE,key:n}),Y())},function(e){var t=e.ctx,n=e.key,r=e.value,a=t.children[n],o=a.anchor,i=a.node;if(!B.equals(i,r)){r=r?B.copy(r):[];var c=de.document.createDocumentFragment();if(H(),i){i.clear();for(var s=0,u=r;s<u.length;s+=1){var p=u[s];(p=fe.toEFComponent(p)).$ctx.nodeInfo.parent&&p.$umount(),de.append(c,p.$mount({parent:t.state,key:n}))}}else for(var l=0,f=r;l<f.length;l+=1){var h=f[l];de.append(c,h.$mount({parent:t.state,key:n}))}i.length=0,B.push.apply(B,[i].concat(r)),de.after(o,c),Y()}}],Ie=function(e){var t=e.node,n=e.nodeType,r=e.element,a=e.ctx,o=e.innerData,i=e.refs,c=e.handlers,s=e.subscribers,u=e.namespace,p=e.create;if(t instanceof de.Node)de.append(r,t);else switch(n){case"string":de.append(r,de.document.createTextNode(t));break;case"array":"object"===L(t[0])?de.append(r,p({node:t,ctx:a,innerData:o,refs:i,handlers:c,subscribers:s,namespace:u})):function(e){var t=e.node,n=e.ctx,r=e.handlers,a=e.subscribers,o=e.innerData,i=e.element,c=de.document.createTextNode(""),s=ce({bind:t,ctx:n,handlers:r,subscribers:a,innerData:o}),u=s.dataNode,p=s.handlerNode,l=s._key,f=function(){var e=u[l];c.textContent=void 0!==e?e:""};p.push(f),X([f]),de.append(i,c)}({node:t,ctx:a,handlers:c,subscribers:s,innerData:o,element:r});break;case"object":var l=de.document.createTextNode("");0===t.t?function(e){var t=e.ctx,n=e.key,r=e.anchor,a=t.children,o=t.isFragment;a[n]={anchor:r},he.set(r,a[n]),o&&de.append(t.safeZone,r)}({ctx:a,key:t.n,anchor:l}):function(e){var t,n,r=e.ctx,a=e.key,o=e.anchor,i=r.children,c=r.isFragment;i[a]={node:(t=[],n={ctx:r,key:a,anchor:o},Object.defineProperties(t,{empty:{value:Te.empty},clear:{value:Te.clear},pop:{value:Te.pop},push:{value:Te.push.bind(t,n)},remove:{value:Te.remove},reverse:{value:Te.reverse.bind(t,n)},shift:{value:Te.shift},sort:{value:Te.sort.bind(t,n)},splice:{value:Te.splice},unshift:{value:Te.unshift.bind(t,n)}}),t),anchor:o},he.set(o,i[a]),c&&de.append(r.safeZone,o)}({ctx:a,key:t.n,anchor:l}),de.append(r,l)}},Se=function(e){var t=e.node,n=e.ctx,r=e.innerData,a=e.refs,o=e.handlers,i=e.subscribers,c=e.namespace,s=t[0],u=t.slice(1),p=c,l=s.t,f=!1,h=0===l,d=Object.isPrototypeOf.call(fe.EFBaseComponent,n.scope[l]||l);if(!h&&!d){if(n.scope[l]){var v=n.scope[l];"string"==typeof v?l=v:v.tag&&(l=v.tag,v.namespaceURI&&(c=v.namespaceURI))}if(l.indexOf(":")>-1){var m=l.split(":"),y=m[0],g=m[1];n.localNamespaces[y]?(c=n.localNamespaces[y],f=!0):c=Ne(y),l=g}else if(s.a&&s.a.xmlns&&$e(s.a.xmlns))c=s.a.xmlns;else if(!c)switch(l=l.toLowerCase()){case"svg":c=Ce;break;case"math":c=je}}c===Pe&&(c="");var b=function(e){var t=e.info,n=e.ctx,r=e.innerData,a=e.refs,o=e.handlers,i=e.subscribers,c=e.namespace,s=e.fragment,u=e.custom;if(s)return new ve;var p=t.t,l=t.a,f=t.p,h=t.e,d=t.r,v=p,m=n.scope[p]||p,y=we({tagName:v,tagContent:m,attrs:l,ref:d,refs:a,namespace:c});if(l)for(var g in l)ke({element:y,custom:u,attr:l[g],key:g,ctx:n,handlers:o,subscribers:i,innerData:r});if(f)for(var b=0,x=f;b<x.length;b+=1){var N=x[b],$=N[0],w=N[1],E=N[2],k=N[3];Oe({element:y,custom:u,value:w,propPath:$,syncTrigger:E,updateOnly:k,ctx:n,handlers:o,subscribers:i,innerData:r})}if(h)for(var O=0,_=h;O<_.length;O+=1){var D=_[O];De({element:y,custom:u,event:D,ctx:n,handlers:o,subscribers:i,innerData:r})}return y}({info:s,ctx:n,innerData:r,refs:a,handlers:o,subscribers:i,namespace:c,fragment:h,custom:d});c&&c===Ce&&["foreignobject","desc","title"].indexOf(l.toLowerCase())>-1&&(c=""),f&&(c=p);for(var x=0,N=u;x<N.length;x+=1){var $=N[x];$ instanceof fe.EFBaseComponent?$.$mount({target:b}):Ie({node:$,nodeType:L($),element:b,ctx:n,innerData:r,refs:a,handlers:o,subscribers:i,namespace:c,create:Se})}return b},qe=function(e,t){var n=e.base,r=e.key,a=t.checkTrue,o=t.get,i=t.set;if(o){if(!i)throw new Error("[EF] Setter must be defined when getter exists");return o}return a?function(){return a(n(this)[r],this)}:function(){return n(this)[r]}},Ue=function(e,t){var n=e.base,r=e.key,a=t.checkTrue,o=t.trueVal,i=t.falseVal,c=t.get,s=t.set;if(s){if(!c)throw new Error("[EF] Getter must be defined when setter exists");return s}return a?function(e){var t=n(this),a=o,c=i;"function"!=typeof o&&(o=function(){return a}),"function"!=typeof i&&(i=function(){return c}),t[r]=e?o(this):i(this)}:function(e){n(this)[r]=e}},Be=function(e){return e.$data},Le=function(e){return e?"function"==typeof e?e:("string"==typeof e&&(e=e.split(".")),function(t){for(var n=0,r=e;n<r.length;n+=1){t=t[r[n]]}return t}):Be},Me=function(e,t){for(var n in t){var r=t[n],a={base:Le(r.base),key:r.key||n},o=qe(a,r),i=Ue(a,r);Object.defineProperty(e.prototype,n,{get:o,set:i,enumerable:!0,configurable:!1})}return e},Ke=function(){function e(e,t){void 0===t&&(t={});var n={},r={},a={},o={},i={placeholder:null,replace:[],parent:null,key:null},c=de.document.createDocumentFragment();i.placeholder=de.document.createTextNode("");var s=function(){if(i.replace.length>0){for(var e=0,t=i.replace;e<t.length;e+=1){var n=t[e];de.remove(n)}B.empty(i.replace)}de.before(i.placeholder,i.element)},u={scope:t,mount:s,refs:n,data:{},innerData:r,methods:{},handlers:a,subscribers:o,nodeInfo:i,safeZone:c,children:{},state:this,isFragment:0===e[0].t,localNamespaces:this.constructor.__local_namespaces};Object.defineProperty(this,"$ctx",{value:u,enumerable:!1,configurable:!0}),H(),i.element=Se({node:e,ctx:u,innerData:r,refs:n,handlers:a,subscribers:o,namespace:""}),de.append(c,i.placeholder),z(s),Y()}var t={$data:{configurable:!0},$methods:{configurable:!0},$refs:{configurable:!0}};return t.$data.get=function(){return this.$ctx.data},t.$data.set=function(e){H(),te(this.$ctx.data,e),Y()},t.$methods.get=function(){return this.$ctx.methods},t.$methods.set=function(e){this.$ctx.methods=e},t.$refs.get=function(){return this.$ctx.refs},e.prototype.$mount=function(e){var t=e.target,n=e.option,r=e.parent,a=e.key,o=this.$ctx,i=o.nodeInfo,c=o.mount;if("string"==typeof t&&(t=document.querySelector(t)),H(),i.parent&&this.$umount(),r||(r=t),a||(a="__DIRECTMOUNT__"),i.parent=r,i.key=a,z(c),!t)return Y(),i.placeholder;switch(n){case Fe.BEFORE:de.before(t,i.placeholder);break;case Fe.AFTER:de.after(t,i.placeholder);break;case Fe.REPLACE:de.before(t,i.placeholder),i.replace.push(t);break;case Fe.APPEND:default:se(r,ve)?de.append(t,i.element):de.append(t,i.placeholder)}return Y()},e.prototype.$umount=function(){var e=this.$ctx,t=e.nodeInfo,n=e.safeZone,r=e.mount,a=t.parent,o=t.key;return t.parent=null,t.key=null,H(),a&&("__DIRECTMOUNT__"!==o?a[o]&&(B.isArray(a[o])?B.remove(a[o],this):a[o]=Re):se(a,ve)&&a.$ctx.nodeInfo.element.removeChild(t.element)),de.append(n,t.placeholder),z(r),Y()},e.prototype.$subscribe=function(e,t){var n=this.$ctx,r=n.handlers,a=n.subscribers,o=n.innerData,i=e.split("."),c=ce({bind:[i],ctx:n,handlers:r,subscribers:a,innerData:o}),s=c.dataNode,u=c.subscriberNode,p=c._key;H();try{t({state:this,value:s[p]}),u.push(t)}catch(e){ie.error("Error caught when registering subscriber:\n",e)}Y()},e.prototype.$unsubscribe=function(e,t){!function(e,t,n){var r=function(e,t){for(var n=e.split("."),r=n.pop(),a=0,o=n;a<o.length;a+=1){var i=o[a];t[i]||(t[i]={}),t=t[i]}return t[r]}(e,n);B.remove(r,t)}(e,t,this.$ctx.subscribers)},e.prototype.$update=function(e){H(),ee(this,e),Y()},e.prototype.$dispatch=function(e){return this.$ctx.nodeInfo.placeholder.dispatchEvent(e)},e.prototype.$emit=function(e,t){return this.$dispatch(be(e,t))},e.prototype.$on=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=this.$ctx.nodeInfo.placeholder).addEventListener.apply(e,t)},e.prototype.$off=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=this.$ctx.nodeInfo.placeholder).removeEventListener.apply(e,t)},e.prototype.$destroy=function(){var e=this.$ctx,t=e.nodeInfo,n=e.children;for(var r in H(),this.$umount(),n)he.delete(n[r].anchor);for(var a in this)"array"===L(this[a])?this[a].clear():this[a]=null;return delete this.$ctx,z((function(){de.remove(t.element),de.remove(t.placeholder)})),Y()},Object.defineProperties(e.prototype,t),e}(),Ze=[{t:0}],Je=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];e.call(this,Ze);var r=this.$ctx.nodeInfo.element;r.$children,r.append.apply(r,t),this.$ctx.elements=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={$el:{configurable:!0}};return n.$el.get=function(){return this.$ctx.elements},Object.defineProperties(t.prototype,n),t}(Ke),Ve=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];e.call(this,[{t:0}].concat(t))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ke),We=[{t:0},[["text"]]],Ge=function(e){function t(t){H(),e.call(this,We),this.text=t,Y()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ke);Me(Ge,{text:{}}),ue(Ke,["$mount","$umount","$subscribe","$unsubscribe","$update","$dispatch","$emit","$on","$off","$destroy"]),ue(Je,["$el"]);var Xe=function(e){return null==e||e instanceof Ke?e:e!==Re?e instanceof Node?new Je(e):new Ge("string"==typeof e?e:JSON.stringify(e)):void 0};fe.EFBaseComponent=Ke,fe.toEFComponent=Xe;var ze=function(e,t){return B.isArray(t)?e.push.apply(e,t.map(Xe)):e.push(Xe(t)),e},He=function(e,t){var n,r,a,o=L(e);switch(o){case"array":var i=e[0],c=e.slice(1);if("object"===L(i)){i.a&&function(e,t){for(var n in e)if(0===n.indexOf("xmlns:")){var r=n.split(":")[1];t.__local_namespaces[r]=e[n]}}(i.a,t);for(var s=0,u=c;s<u.length;s+=1){var p=u[s];He(p,t)}}break;case"object":if(e.t>1)throw new TypeError("[EF] Not a standard ef.js AST: Unknown mounting point type '"+e.t+"'");n=e.t,r=e.n,a=t,Object.defineProperty(a.prototype,r,{get:function(){return this.$ctx.children[r].node},set:function(e){var t=this.$ctx;Ae[n]({ctx:t,key:r,value:e})},enumerable:!0});break;case"string":break;default:throw new TypeError("[EF] Not a standard ef.js AST: Unknown node type '"+o+"'")}},Qe=S,Ye=function(e){var t,n,r=L(e);if("string"===r)e=function(e,t){return t||(t=S),t(e)}(e,Qe);else if("array"!==r)throw new TypeError("Cannot create new component without proper template or AST!");return t=e,n=function(e){function n(n,r){H(),e.call(this,t,r),n&&this.$update(n),Y()}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n}(Ke),Object.defineProperty(n.prototype,"constructor",{enumerable:!1}),Object.defineProperty(n,"__local_namespaces",{enumerable:!1,value:{}}),He(t,n),n};e.EFNodeWrapper=Je,e.EFTextFragment=Ge,e.Fragment=Ve,e.bundle=function(e){H();try{Y(e(H,Y))}catch(e){return Y(),e}},e.create=Ye,e.createElement=function(e,t){for(var n=[],r=arguments.length-2;r-- >0;)n[r]=arguments[r+2];if(e===Ve)return new(Function.prototype.bind.apply(Ve,[null].concat(n)));if(Object.isPrototypeOf.call(Ke,e))return n.length<=0?new e(t):new e(te({children:n.reduce(ze,[])},t||{}));var a=te({},t);for(var o in a)!0===a[o]&&(a[o]="");return new Ke([{t:e,a:a}].concat(n))},e.declareNamespace=function(e,t){if(xe[e])throw new Error('[EF] Namespace "'+e+'" has already been declared as "'+xe[e]+'".');xe[e]=t},e.exec=Y,e.inform=H,e.isPaused=function(){return G>0},e.mapAttrs=Me,e.mountOptions=Fe,e.onNextRender=function(e){return W.push(e)},e.parseEft=S,e.scoped=function(e,t){return function(e){function n(n,r){void 0===r&&(r={});var a=te({},t);e.call(this,n,te(a,r))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n}(e)},e.setDOMImpl=ge,e.setParser=function(e){Qe=e},e.t=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Ye(M.apply(void 0,e))},e.version="0.13.4",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ef.min.js.map
