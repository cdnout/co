!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SimpleKeyboard=e():t.SimpleKeyboard=e()}(this,function(){"use strict";var o={d:function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},t={};function r(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}o.r(t),o.d(t,{default:function(){return C}});n=[{key:"bindMethods",value:function(t,e){var n,o=function(t){var e,n,o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=r(t)))return o&&(t=o),e=0,{s:n=function(){},n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return s=t.done,t},e:function(t){a=!0,i=t},f:function(){try{s||null==o.return||o.return()}finally{if(a)throw i}}}}(Object.getOwnPropertyNames(t.prototype));try{for(o.s();!(n=o.n()).done;){var i=n.value;"constructor"!==i&&"bindMethods"!==i&&(e[i]=e[i].bind(e))}}catch(t){o.e(t)}finally{o.f()}}}],e((E=u).prototype,[{key:"getButtonType",value:function(t){return t.includes("{")&&t.includes("}")&&"{//}"!==t?"functionBtn":"standardBtn"}},{key:"getButtonClass",value:function(t){var e=this.getButtonType(t),t=t.replace("{","").replace("}",""),n="";return"standardBtn"!==e&&(n=" hg-button-".concat(t)),"hg-".concat(e).concat(n)}},{key:"getDefaultDiplay",value:function(){return{"{bksp}":"backspace","{backspace}":"backspace","{enter}":"< enter","{shift}":"shift","{shiftleft}":"shift","{shiftright}":"shift","{alt}":"alt","{s}":"shift","{tab}":"tab","{lock}":"caps","{capslock}":"caps","{accept}":"Submit","{space}":" ","{//}":" ","{esc}":"esc","{escape}":"esc","{f1}":"f1","{f2}":"f2","{f3}":"f3","{f4}":"f4","{f5}":"f5","{f6}":"f6","{f7}":"f7","{f8}":"f8","{f9}":"f9","{f10}":"f10","{f11}":"f11","{f12}":"f12","{numpaddivide}":"/","{numlock}":"lock","{arrowup}":"↑","{arrowleft}":"←","{arrowdown}":"↓","{arrowright}":"→","{prtscr}":"print","{scrolllock}":"scroll","{pause}":"pause","{insert}":"ins","{home}":"home","{pageup}":"up","{delete}":"del","{forwarddelete}":"del","{end}":"end","{pagedown}":"down","{numpadmultiply}":"*","{numpadsubtract}":"-","{numpadadd}":"+","{numpadenter}":"enter","{period}":".","{numpaddecimal}":".","{numpad0}":"0","{numpad1}":"1","{numpad2}":"2","{numpad3}":"3","{numpad4}":"4","{numpad5}":"5","{numpad6}":"6","{numpad7}":"7","{numpad8}":"8","{numpad9}":"9"}}},{key:"getButtonDisplayName",value:function(t,e,n){return(e=n?Object.assign({},this.getDefaultDiplay(),e):e||this.getDefaultDiplay())[t]||t}},{key:"getUpdatedInput",value:function(t,e,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n,i=4<arguments.length&&void 0!==arguments[4]&&arguments[4],s=this.getOptions(),n=[n,o,i],o=e;return("{bksp}"===t||"{backspace}"===t)&&0<o.length?o=this.removeAt.apply(this,[o].concat(n)):("{delete}"===t||"{forwarddelete}"===t)&&0<o.length?o=this.removeForwardsAt.apply(this,[o].concat(n)):"{space}"===t?o=this.addStringAt.apply(this,[o," "].concat(n)):"{tab}"!==t||"boolean"==typeof s.tabCharOnTab&&!1===s.tabCharOnTab?"{enter}"!==t&&"{numpadenter}"!==t||!s.newLineOnEnter?t.includes("numpad")&&Number.isInteger(Number(t[t.length-2]))?o=this.addStringAt.apply(this,[o,t[t.length-2]].concat(n)):"{numpaddivide}"===t?o=this.addStringAt.apply(this,[o,"/"].concat(n)):"{numpadmultiply}"===t?o=this.addStringAt.apply(this,[o,"*"].concat(n)):"{numpadsubtract}"===t?o=this.addStringAt.apply(this,[o,"-"].concat(n)):"{numpadadd}"===t?o=this.addStringAt.apply(this,[o,"+"].concat(n)):"{numpaddecimal}"===t?o=this.addStringAt.apply(this,[o,"."].concat(n)):"{"!==t&&"}"!==t&&(t.includes("{")||t.includes("}"))||(o=this.addStringAt.apply(this,[o,t].concat(n))):o=this.addStringAt.apply(this,[o,"\n"].concat(n)):o=this.addStringAt.apply(this,[o,"\t"].concat(n)),o}},{key:"updateCaretPos",value:function(t){var e=this.updateCaretPosAction(t,1<arguments.length&&void 0!==arguments[1]&&arguments[1]);this.dispatch(function(t){t.setCaretPosition(e)})}},{key:"updateCaretPosAction",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.getOptions(),o=this.getCaretPosition();return null!=o&&(e?0<o&&(o-=t):o+=t),n.debug&&console.log("Caret at:",o),o}},{key:"addStringAt",value:function(t,e){var n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.length,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:t.length,s=4<arguments.length&&void 0!==arguments[4]&&arguments[4];return o||0===o?(n=[t.slice(0,o),e,t.slice(i)].join(""),this.isMaxLengthReached()||s&&this.updateCaretPos(e.length)):n=t+e,n}},{key:"removeAt",value:function(t){var e,n,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t.length,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.length,s=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return 0===o&&0===i?t:(o===i?(n=/([\uD800-\uDBFF][\uDC00-\uDFFF])/g,o&&0<=o?t.substring(o-2,o).match(n)?(e=t.substr(0,o-2)+t.substr(o),s&&this.updateCaretPos(2,!0)):(e=t.substr(0,o-1)+t.substr(o),s&&this.updateCaretPos(1,!0)):t.slice(-2).match(n)?(e=t.slice(0,-2),s&&this.updateCaretPos(2,!0)):(e=t.slice(0,-1),s&&this.updateCaretPos(1,!0))):(e=t.slice(0,o)+t.slice(i),s&&this.dispatch(function(t){t.setCaretPosition(o)})),e)}},{key:"removeForwardsAt",value:function(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t.length,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.length,i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return null!=t&&t.length&&null!==n?(n===o?e=t.substring(n,n+2).match(/([\uD800-\uDBFF][\uDC00-\uDFFF])/g)?t.substr(0,n)+t.substr(n+2):t.substr(0,n)+t.substr(n+1):(e=t.slice(0,n)+t.slice(o),i&&this.dispatch(function(t){t.setCaretPosition(n)})),e):t}},{key:"handleMaxLength",value:function(t,e){var n=this.getOptions(),o=n.maxLength,t=t[n.inputName||"default"],i=e.length-1>=o;return!(e.length<=t.length)&&(Number.isInteger(o)?(n.debug&&console.log("maxLength (num) reached:",i),i?this.maxLengthReached=!0:this.maxLengthReached=!1):"object"===s(o)?(t=e.length-1>=o[n.inputName||"default"],n.debug&&console.log("maxLength (obj) reached:",t),t?this.maxLengthReached=!0:this.maxLengthReached=!1):void 0)}},{key:"isMaxLengthReached",value:function(){return Boolean(this.maxLengthReached)}},{key:"isTouchDevice",value:function(){return"ontouchstart"in window||navigator.maxTouchPoints}},{key:"pointerEventsSupported",value:function(){return!!window.PointerEvent}},{key:"camelCase",value:function(t){return t?t.toLowerCase().trim().split(/[.\-_\s]/g).reduce(function(t,e){return e.length?t+e[0].toUpperCase()+e.slice(1):t}):""}},{key:"chunkArray",value:function(n,o){return(function(t){if(Array.isArray(t))return i(t)}(t=Array(Math.ceil(n.length/o)))||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map(function(t,e){return n.slice(o*e,o+o*e)});var t}}]),e(E,n),Object.defineProperty(E,"prototype",{writable:!1});var n=u;function u(t){var e=t.getOptions,n=t.getCaretPosition,o=t.getCaretPositionEnd,t=t.dispatch;if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");a(this,"isStandardButton",function(t){return t&&!("{"===t[0]&&"}"===t[t.length-1])}),this.getOptions=e,this.getCaretPosition=n,this.getCaretPositionEnd=o,this.dispatch=t,u.bindMethods(u,this)}a(n,"noop",function(){});var l=n;function c(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}c((E=h).prototype,[{key:"handleHighlightKeyDown",value:function(s){var a=this.getOptions(),r=this.getSimpleKeyboardLayoutKey(s);this.dispatch(function(t){var e,n,o=t.getButtonElement(r),i=t.getButtonElement("{".concat(r,"}"));if(o)e=o,n=r;else{if(!i)return;e=i,n="{".concat(r,"}")}e&&(e.style.backgroundColor=a.physicalKeyboardHighlightBgColor||"#dadce4",e.style.color=a.physicalKeyboardHighlightTextColor||"black",a.physicalKeyboardHighlightPress&&(a.physicalKeyboardHighlightPressUsePointerEvents?e.onpointerdown():a.physicalKeyboardHighlightPressUseClick?e.click():t.handleButtonClicked(n,s)))})}},{key:"handleHighlightKeyUp",value:function(t){var e=this.getOptions(),n=this.getSimpleKeyboardLayoutKey(t);this.dispatch(function(t){t=t.getButtonElement(n)||t.getButtonElement("{".concat(n,"}"));t&&t.removeAttribute&&(t.removeAttribute("style"),e.physicalKeyboardHighlightPressUsePointerEvents&&t.onpointerup())})}},{key:"getSimpleKeyboardLayoutKey",value:function(t){var e=t.code||t.key||this.keyCodeToKey(null==t?void 0:t.keyCode);return 1<(e=null!=e&&e.includes("Numpad")||null!=e&&e.includes("Shift")||null!=e&&e.includes("Space")||null!=e&&e.includes("Backspace")||null!=e&&e.includes("Control")||null!=e&&e.includes("Alt")||null!=e&&e.includes("Meta")?t.code||"":t.key||this.keyCodeToKey(null==t?void 0:t.keyCode)||"").length?null==(t=e)?void 0:t.toLowerCase():e}},{key:"keyCodeToKey",value:function(t){return{8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Meta",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}[t]}}]),Object.defineProperty(E,"prototype",{writable:!1});var d=h;function h(t){var e=t.dispatch,t=t.getOptions;if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");this.dispatch=e,this.getOptions=t,l.bindMethods(h,this)}function p(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}p((n=y).prototype,[{key:"destroy",value:function(){this.candidateBoxElement&&(this.candidateBoxElement.remove(),this.pageIndex=0)}},{key:"show",value:function(t){var n=this,e=t.candidateValue,o=t.targetElement,i=t.onSelect;e&&e.length&&(t=this.utilities.chunkArray(e.split(" "),this.pageSize),this.renderPage({candidateListPages:t,targetElement:o,pageIndex:this.pageIndex,nbPages:t.length,onItemSelected:function(t,e){i(t,e),n.destroy()}}))}},{key:"renderPage",value:function(t){var e=this,n=t.candidateListPages,o=t.targetElement,i=t.pageIndex,s=t.nbPages,a=t.onItemSelected,r=(null!=(t=this.candidateBoxElement)&&t.remove(),this.candidateBoxElement=document.createElement("div"),this.candidateBoxElement.className="hg-candidate-box",document.createElement("ul")),u=(r.className="hg-candidate-box-list",n[i].forEach(function(e){var n=document.createElement("li");n.className="hg-candidate-box-list-item",n.textContent=e,n.onclick=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:(t=new MouseEvent("click"),Object.defineProperty(t,"target",{value:n}),t);return a(e,t)},r.appendChild(n)}),0<i),t=document.createElement("div"),l=(t.classList.add("hg-candidate-box-prev"),u&&t.classList.add("hg-candidate-box-btn-active"),t.onclick=function(){u&&e.renderPage({candidateListPages:n,targetElement:o,pageIndex:i-1,nbPages:s,onItemSelected:a})},this.candidateBoxElement.appendChild(t),this.candidateBoxElement.appendChild(r),i<s-1),t=document.createElement("div");t.classList.add("hg-candidate-box-next"),l&&t.classList.add("hg-candidate-box-btn-active"),t.onclick=function(){l&&e.renderPage({candidateListPages:n,targetElement:o,pageIndex:i+1,nbPages:s,onItemSelected:a})},this.candidateBoxElement.appendChild(t),o.prepend(this.candidateBoxElement)}}]),Object.defineProperty(n,"prototype",{writable:!1});var f=y;function y(t){var e,t=t.utilities;if(!(this instanceof y))throw new TypeError("Cannot call a class as a function");(e="pageIndex")in this?Object.defineProperty(this,e,{value:0,enumerable:!0,configurable:!0,writable:!0}):this[e]=0,this.utilities=t,l.bindMethods(y,this),this.pageSize=this.utilities.getOptions().layoutCandidatesPageSize||5}function g(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return m(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?m(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)),o}function k(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function w(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}k((E=O).prototype,[{key:"setCaretPosition",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.caretPosition=t,this.caretPositionEnd=e}},{key:"getInputCandidates",value:function(n){var o=this,t=this.options,e=t.layoutCandidates,i=t.layoutCandidatesCaseSensitiveMatch;if(!e||"object"!==b(e))return{};var s,t=Object.keys(e).filter(function(t){var e=n.substring(0,o.getCaretPositionEnd()||0)||n,t=new RegExp("".concat(t,"$"),i?"g":"gi");return!!g(e.matchAll(t)).length});return 1<t.length?{candidateKey:s=t.sort(function(t,e){return e.length-t.length})[0],candidateValue:e[s]}:t.length?{candidateKey:s=t[0],candidateValue:e[s]}:{}}},{key:"showCandidatesBox",value:function(a,t,e){var r=this;this.candidateBox&&this.candidateBox.show({candidateValue:t,targetElement:e,onSelect:function(t,e){var n=r.options.layoutCandidatesCaseSensitiveMatch,t=t.normalize("NFD"),o=r.getInput(r.options.inputName,!0),i=r.getCaretPositionEnd()||0,s=o.substring(0,i||0)||o,n=new RegExp("".concat(a,"$"),n?"g":"gi"),n=s.replace(n,t),t=o.replace(s,n),n=n.length-s.length,s=(i||o.length)+n;s<0&&(s=0),r.setInput(t,r.options.inputName,!0),r.setCaretPosition(s),"function"==typeof r.options.onChange&&r.options.onChange(r.getInput(r.options.inputName,!0),e),"function"==typeof r.options.onChangeAll&&r.options.onChangeAll(r.getAllInputs(),e)}})}},{key:"handleButtonClicked",value:function(t,e){var n=this.options,o=n.inputName,o=void 0===o?this.defaultName:o,n=n.debug;if("{//}"!==t){this.input[o]||(this.input[o]="");var i=this.utilities.getUpdatedInput(t,this.input[o],this.caretPosition,this.caretPositionEnd);if(this.utilities.isStandardButton(t)&&this.activeInputElement&&this.input[o]&&this.input[o]===i&&0===this.caretPosition&&this.caretPositionEnd===i.length)return this.setInput("",this.options.inputName,!0),this.setCaretPosition(0),this.activeInputElement.value="",this.activeInputElement.setSelectionRange(0,0),void this.handleButtonClicked(t,e);if("function"==typeof this.options.onKeyPress&&this.options.onKeyPress(t,e),this.input[o]!==i&&(!this.options.inputPattern||this.options.inputPattern&&this.inputPatternIsValid(i))){if(this.options.maxLength&&this.utilities.handleMaxLength(this.input,i))return;var o=this.utilities.getUpdatedInput(t,this.input[o],this.caretPosition,this.caretPositionEnd,!0);this.setInput(o,this.options.inputName,!0),n&&console.log("Input changed:",this.getAllInputs()),this.options.debug&&console.log("Caret at: ",this.getCaretPosition(),this.getCaretPositionEnd(),"(".concat(this.keyboardDOMClass,")")),this.options.syncInstanceInputs&&this.syncInstanceInputs(),"function"==typeof this.options.onChange&&this.options.onChange(this.getInput(this.options.inputName,!0),e),"function"==typeof this.options.onChangeAll&&this.options.onChangeAll(this.getAllInputs(),e),null!=e&&e.target&&this.options.enableLayoutCandidates&&(e=(o=this.getInputCandidates(i)).candidateKey,i=o.candidateValue,e&&i?this.showCandidatesBox(e,i,this.keyboardDOM):null!=(o=this.candidateBox)&&o.destroy())}n&&console.log("Key pressed:",t)}}},{key:"getMouseHold",value:function(){return this.isMouseHold}},{key:"setMouseHold",value:function(e){this.options.syncInstanceInputs?this.dispatch(function(t){t.isMouseHold=e}):this.isMouseHold=e}},{key:"handleButtonMouseDown",value:function(t,e){var n=this;e&&(this.options.preventMouseDownDefault&&e.preventDefault(),this.options.stopMouseDownPropagation&&e.stopPropagation(),e.target.classList.add(this.activeButtonClass)),this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),this.holdTimeout&&clearTimeout(this.holdTimeout),this.setMouseHold(!0),this.options.disableButtonHold||(this.holdTimeout=window.setTimeout(function(){(!n.getMouseHold()||(t.includes("{")||t.includes("}"))&&"{delete}"!==t&&"{backspace}"!==t&&"{bksp}"!==t&&"{space}"!==t&&"{tab}"!==t)&&"{arrowright}"!==t&&"{arrowleft}"!==t&&"{arrowup}"!==t&&"{arrowdown}"!==t||(n.options.debug&&console.log("Button held:",t),n.handleButtonHold(t)),clearTimeout(n.holdTimeout)},500))}},{key:"handleButtonMouseUp",value:function(t,e){var n=this;e&&(this.options.preventMouseUpDefault&&e.preventDefault&&e.preventDefault(),this.options.stopMouseUpPropagation&&e.stopPropagation&&e.stopPropagation(),e.target===this.keyboardDOM||e.target&&this.keyboardDOM.contains(e.target)||this.candidateBox&&this.candidateBox.candidateBoxElement&&(e.target===this.candidateBox.candidateBoxElement||e.target&&this.candidateBox.candidateBoxElement.contains(e.target))||!this.candidateBox||this.candidateBox.destroy()),this.recurseButtons(function(t){t.classList.remove(n.activeButtonClass)}),this.setMouseHold(!1),this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),t&&"function"==typeof this.options.onKeyReleased&&this.options.onKeyReleased(t)}},{key:"handleKeyboardContainerMouseDown",value:function(t){this.options.preventMouseDownDefault&&t.preventDefault()}},{key:"handleButtonHold",value:function(t){var e=this;this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),this.holdInteractionTimeout=window.setTimeout(function(){e.getMouseHold()?(e.handleButtonClicked(t),e.handleButtonHold(t)):clearTimeout(e.holdInteractionTimeout)},100)}},{key:"syncInstanceInputs",value:function(){var e=this;this.dispatch(function(t){t.replaceInput(e.input),t.setCaretPosition(e.caretPosition,e.caretPositionEnd)})}},{key:"clearInput",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.inputName||this.defaultName;this.input[t]="",this.setCaretPosition(0),this.options.syncInstanceInputs&&this.syncInstanceInputs()}},{key:"getInput",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.inputName||this.defaultName;return this.options.syncInstanceInputs&&!(1<arguments.length&&void 0!==arguments[1]&&arguments[1])&&this.syncInstanceInputs(),this.options.rtl?"‫"+this.input[t].replace("‫","").replace("‬","")+"‬":this.input[t]}},{key:"getAllInputs",value:function(){var e=this,n={};return Object.keys(this.input).forEach(function(t){n[t]=e.getInput(t,!0)}),n}},{key:"setInput",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.options.inputName||this.defaultName,n=2<arguments.length?arguments[2]:void 0;this.input[e]=t,!n&&this.options.syncInstanceInputs&&this.syncInstanceInputs()}},{key:"replaceInput",value:function(t){this.input=t}},{key:"setOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.changedOptions(t);this.options=Object.assign(this.options,t),e.length&&(this.options.debug&&console.log("changedOptions",e),this.onSetOptions(e),this.render())}},{key:"changedOptions",value:function(e){var n=this;return Object.keys(e).filter(function(t){return JSON.stringify(e[t])!==JSON.stringify(n.options[t])})}},{key:"onSetOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];t.includes("layoutName")&&this.candidateBox&&this.candidateBox.destroy(),(t.includes("layoutCandidatesPageSize")||t.includes("layoutCandidates"))&&this.candidateBox&&(this.candidateBox.destroy(),this.candidateBox=new f({utilities:this.utilities}))}},{key:"resetRows",value:function(){this.keyboardRowsDOM&&this.keyboardRowsDOM.remove(),this.keyboardDOM.className=this.keyboardDOMClass,this.buttonElements={}}},{key:"dispatch",value:function(e){if(window.SimpleKeyboardInstances)return Object.keys(window.SimpleKeyboardInstances).forEach(function(t){e(window.SimpleKeyboardInstances[t],t)});throw console.warn("SimpleKeyboardInstances is not defined. Dispatch cannot be called."),new Error("INSTANCES_VAR_ERROR")}},{key:"addButtonTheme",value:function(t,e){var s=this;e&&t&&(t.split(" ").forEach(function(i){e.split(" ").forEach(function(n){s.options.buttonTheme||(s.options.buttonTheme=[]);var o=!1;s.options.buttonTheme.map(function(t){var e;return null!=t&&t.class.split(" ").includes(n)&&(o=!0,(e=t.buttons.split(" ")).includes(i)||(o=!0,e.push(i),t.buttons=e.join(" "))),t}),o||s.options.buttonTheme.push({class:n,buttons:t})})}),this.render())}},{key:"removeButtonTheme",value:function(t,i){var s=this;if(!t&&!i)return this.options.buttonTheme=[],void this.render();t&&Array.isArray(this.options.buttonTheme)&&this.options.buttonTheme.length&&(t.split(" ").forEach(function(o){var t;null!=(t=s.options)&&null!=(t=t.buttonTheme)&&t.map(function(t,e){var n;return(t&&i&&i.includes(t.class)||!i)&&(n=null==(n=t)?void 0:n.buttons.split(" ").filter(function(t){return t!==o}),t&&null!=n&&n.length?t.buttons=n.join(" "):(null!=(n=s.options.buttonTheme)&&n.splice(e,1),t=null)),t})}),this.render())}},{key:"getButtonElement",value:function(t){var e,t=this.buttonElements[t];return e=t?1<t.length?t:t[0]:e}},{key:"inputPatternIsValid",value:function(t){var e=this.options.inputPattern;return!(e=e instanceof RegExp?e:e[this.options.inputName||this.defaultName])||!t||(t=e.test(t),this.options.debug&&console.log('inputPattern ("'.concat(e,'"): ').concat(t?"passed":"did not pass!")),t)}},{key:"setEventListeners",value:function(){!this.isFirstKeyboardInstance&&this.allKeyboardInstances||(this.options.debug&&console.log("Caret handling started (".concat(this.keyboardDOMClass,")")),document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("touchend",this.handleTouchEnd),document.addEventListener("select",this.handleSelect),document.addEventListener("selectionchange",this.handleSelectionChange))}},{key:"handleKeyUp",value:function(t){this.caretEventHandler(t),this.options.physicalKeyboardHighlight&&this.physicalKeyboard.handleHighlightKeyUp(t)}},{key:"handleKeyDown",value:function(t){this.options.physicalKeyboardHighlight&&this.physicalKeyboard.handleHighlightKeyDown(t)}},{key:"handleMouseUp",value:function(t){this.caretEventHandler(t)}},{key:"handleTouchEnd",value:function(t){this.caretEventHandler(t)}},{key:"handleSelect",value:function(t){this.caretEventHandler(t)}},{key:"handleSelectionChange",value:function(t){this.caretEventHandler(t)}},{key:"caretEventHandler",value:function(n){var o,i=this;n.target.tagName&&(o=n.target.tagName.toLowerCase()),this.dispatch(function(t){var e=n.target===t.keyboardDOM||n.target&&t.keyboardDOM.contains(n.target);("textarea"===o||"input"===o&&["text","search","url","tel","password"].includes(n.target.type))&&!t.options.disableCaretPositioning?(t.setCaretPosition(n.target.selectionStart,n.target.selectionEnd),i.activeInputElement=n.target,t.options.debug&&console.log("Caret at: ",t.getCaretPosition(),t.getCaretPositionEnd(),n&&n.target.tagName.toLowerCase(),"(".concat(t.keyboardDOMClass,")"))):!t.options.disableCaretPositioning&&e||"selectionchange"===(null==n?void 0:n.type)||(t.setCaretPosition(null),i.activeInputElement=null,t.options.debug&&console.log('Caret position reset due to "'.concat(null==n?void 0:n.type,'" event'),n))})}},{key:"recurseButtons",value:function(e){var n=this;e&&Object.keys(this.buttonElements).forEach(function(t){return n.buttonElements[t].forEach(e)})}},{key:"destroy",value:function(){this.options.debug&&console.log("Destroying simple-keyboard instance: ".concat(this.currentInstanceName)),document.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("touchend",this.handleTouchEnd),document.removeEventListener("select",this.handleSelect),document.removeEventListener("selectionchange",this.handleSelectionChange),document.onpointerup=null,document.ontouchend=null,document.ontouchcancel=null,document.onmouseup=null,this.recurseButtons(function(t){t&&(t.onpointerdown=null,t.onpointerup=null,t.onpointercancel=null,t.ontouchstart=null,t.ontouchend=null,t.ontouchcancel=null,t.onclick=null,t.onmousedown=null,t.onmouseup=null,t.remove())}),this.keyboardDOM.onpointerdown=null,this.keyboardDOM.ontouchstart=null,this.keyboardDOM.onmousedown=null,this.resetRows(),this.candidateBox&&(this.candidateBox.destroy(),this.candidateBox=null),this.activeInputElement=null,this.keyboardDOM.innerHTML="",window.SimpleKeyboardInstances[this.currentInstanceName]=null,delete window.SimpleKeyboardInstances[this.currentInstanceName],this.initialized=!1}},{key:"getButtonThemeClasses",value:function(n){var t=this.options.buttonTheme,o=[];return Array.isArray(t)&&t.forEach(function(t){var e;t&&t.class&&"string"==typeof t.class&&t.buttons&&"string"==typeof t.buttons?(e=t.class.split(" "),t.buttons.split(" ").includes(n)&&(o=[].concat(g(o),g(e)))):console.warn('Incorrect "buttonTheme". Please check the documentation.',t)}),o}},{key:"setDOMButtonAttributes",value:function(e,n){var t=this.options.buttonAttributes;Array.isArray(t)&&t.forEach(function(t){t.attribute&&"string"==typeof t.attribute&&t.value&&"string"==typeof t.value&&t.buttons&&"string"==typeof t.buttons?t.buttons.split(" ").includes(e)&&n(t.attribute,t.value):console.warn('Incorrect "buttonAttributes". Please check the documentation.',t)})}},{key:"onTouchDeviceDetected",value:function(){this.processAutoTouchEvents(),this.disableContextualWindow()}},{key:"disableContextualWindow",value:function(){window.oncontextmenu=function(t){if(t.target.classList.contains("hg-button"))return t.preventDefault(),t.stopPropagation(),!1}}},{key:"processAutoTouchEvents",value:function(){this.options.autoUseTouchEvents&&(this.options.useTouchEvents=!0,this.options.debug&&console.log("autoUseTouchEvents: Touch device detected, useTouchEvents enabled."))}},{key:"onInit",value:function(){this.options.debug&&console.log("".concat(this.keyboardDOMClass," Initialized")),this.setEventListeners(),"function"==typeof this.options.onInit&&this.options.onInit(this)}},{key:"beforeFirstRender",value:function(){this.utilities.isTouchDevice()&&this.onTouchDeviceDetected(),"function"==typeof this.options.beforeFirstRender&&this.options.beforeFirstRender(this),this.isFirstKeyboardInstance&&this.utilities.pointerEventsSupported()&&!this.options.useTouchEvents&&!this.options.useMouseEvents&&this.options.debug&&console.log("Using PointerEvents as it is supported by this browser"),this.options.useTouchEvents&&this.options.debug&&console.log("useTouchEvents has been enabled. Only touch events will be used.")}},{key:"beforeRender",value:function(){"function"==typeof this.options.beforeRender&&this.options.beforeRender(this)}},{key:"onRender",value:function(){"function"==typeof this.options.onRender&&this.options.onRender(this)}},{key:"onModulesLoaded",value:function(){"function"==typeof this.options.onModulesLoaded&&this.options.onModulesLoaded(this)}},{key:"loadModules",value:function(){var e=this;Array.isArray(this.options.modules)&&(this.options.modules.forEach(function(t){t=new t(e);t.init&&t.init(e)}),this.keyboardPluginClasses="modules-loaded",this.render(),this.onModulesLoaded())}},{key:"getModuleProp",value:function(t,e){return!!this.modules[t]&&this.modules[t][e]}},{key:"getModulesList",value:function(){return Object.keys(this.modules)}},{key:"parseRowDOMContainers",value:function(i,s,t,a){var r=this,u=Array.from(i.children),l=0;return u.length&&t.forEach(function(t,e){var n=a[e];if(!(n&&t<n))return!1;var t=t-l,n=n-l,o=document.createElement("div"),e=(o.className+="hg-button-container","".concat(r.options.layoutName,"-r").concat(s,"c").concat(e)),e=(o.setAttribute("data-skUID",e),u.splice(t,n-t+1));l=n-t,e.forEach(function(t){return o.appendChild(t)}),u.splice(t,0,o),i.innerHTML="",u.forEach(function(t){return i.appendChild(t)}),r.options.debug&&console.log("rowDOMContainer",e,t,n,l+1)}),i}},{key:"render",value:function(){var c=this,t=(this.resetRows(),this.initialized||this.beforeFirstRender(),this.beforeRender(),"hg-layout-".concat(this.options.layoutName)),e=this.options.layout||{default:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","{lock} a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}",".com @ {space}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'{lock} A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}",".com @ {space}"]},d=this.options.useTouchEvents||!1,h=this.options.useMouseEvents||!1,p=this.options.disableRowButtonContainers;this.keyboardDOM.className=this.getKeyboardClassString(this.options.theme,t,this.keyboardPluginClasses,d?"hg-touch-events":""),this.keyboardRowsDOM=document.createElement("div"),this.keyboardRowsDOM.className="hg-rows",e[this.options.layoutName||this.defaultName].forEach(function(t,a){var t=t.split(" "),r=(c.options.excludeFromLayout&&c.options.excludeFromLayout[c.options.layoutName||c.defaultName]&&(t=t.filter(function(t){return c.options.excludeFromLayout&&!c.options.excludeFromLayout[c.options.layoutName||c.defaultName].includes(t)})),document.createElement("div")),u=(r.className+="hg-row",[]),l=[];t.forEach(function(e,t){var n=!p&&"string"==typeof e&&1<e.length&&0===e.indexOf("["),o=!p&&"string"==typeof e&&1<e.length&&e.indexOf("]")===e.length-1,n=(n&&(u.push(t),e=e.replace(/\[/g,"")),o&&(l.push(t),e=e.replace(/\]/g,"")),c.utilities.getButtonClass(e)),o=c.utilities.getButtonDisplayName(e,c.options.display,c.options.mergeDisplay),i=c.options.useButtonTag?"button":"div",s=document.createElement(i),n=(s.className+="hg-button ".concat(n),(i=s.classList).add.apply(i,g(c.getButtonThemeClasses(e))),c.setDOMButtonAttributes(e,function(t,e){s.setAttribute(t,e)}),c.activeButtonClass="hg-activeButton",!c.utilities.pointerEventsSupported()||d||h?d?(s.ontouchstart=function(t){c.handleButtonClicked(e,t),c.handleButtonMouseDown(e,t)},s.ontouchend=function(t){c.handleButtonMouseUp(e,t)},s.ontouchcancel=function(t){c.handleButtonMouseUp(e,t)}):(s.onclick=function(t){c.setMouseHold(!1),c.handleButtonClicked(e,t)},s.onmousedown=function(t){c.handleButtonMouseDown(e,t)},s.onmouseup=function(t){c.handleButtonMouseUp(e,t)}):(s.onpointerdown=function(t){c.handleButtonClicked(e,t),c.handleButtonMouseDown(e,t)},s.onpointerup=function(t){c.handleButtonMouseUp(e,t)},s.onpointercancel=function(t){c.handleButtonMouseUp(e,t)}),s.setAttribute("data-skBtn",e),"".concat(c.options.layoutName,"-r").concat(a,"b").concat(t)),i=(s.setAttribute("data-skBtnUID",n),document.createElement("span"));i.innerHTML=o,s.appendChild(i),c.buttonElements[e]||(c.buttonElements[e]=[]),c.buttonElements[e].push(s),r.appendChild(s)}),r=c.parseRowDOMContainers(r,a,u,l),c.keyboardRowsDOM.appendChild(r)}),this.keyboardDOM.appendChild(this.keyboardRowsDOM),this.onRender(),this.initialized||(this.initialized=!0,!this.utilities.pointerEventsSupported()||d||h?d?(document.ontouchend=function(t){return c.handleButtonMouseUp(void 0,t)},document.ontouchcancel=function(t){return c.handleButtonMouseUp(void 0,t)},this.keyboardDOM.ontouchstart=function(t){return c.handleKeyboardContainerMouseDown(t)}):(document.onmouseup=function(t){return c.handleButtonMouseUp(void 0,t)},this.keyboardDOM.onmousedown=function(t){return c.handleKeyboardContainerMouseDown(t)}):(document.onpointerup=function(t){return c.handleButtonMouseUp(void 0,t)},this.keyboardDOM.onpointerdown=function(t){return c.handleKeyboardContainerMouseDown(t)}),this.onInit())}}]),Object.defineProperty(E,"prototype",{writable:!1});var E,C=O;function O(t,e){var o=this;if(!(this instanceof O))throw new TypeError("Cannot call a class as a function");if(w(this,"defaultName","default"),w(this,"activeInputElement",null),w(this,"handleParams",function(t,e){var n,o,i;if("string"==typeof t)n=t.split(".").join(""),o=document.querySelector(".".concat(n)),i=e;else if(t instanceof HTMLDivElement){if(!t.className)throw console.warn("Any DOM element passed as parameter must have a class."),new Error("KEYBOARD_DOM_CLASS_ERROR");n=t.className.split(" ")[0],o=t,i=e}else n="simple-keyboard",o=document.querySelector(".".concat(n)),i=t;return{keyboardDOMClass:n,keyboardDOM:o,options:i}}),w(this,"getOptions",function(){return o.options}),w(this,"getCaretPosition",function(){return o.caretPosition}),w(this,"getCaretPositionEnd",function(){return o.caretPositionEnd}),w(this,"registerModule",function(t,e){o.modules[t]||(o.modules[t]={}),e(o.modules[t])}),w(this,"getKeyboardClassString",function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return[o.keyboardDOMClass].concat(e).filter(function(t){return!!t}).join(" ")}),"undefined"!=typeof window){var t=this.handleParams(t,e),e=t.keyboardDOMClass,n=t.keyboardDOM,t=t.options,t=void 0===t?{}:t,n=(this.utilities=new l({getOptions:this.getOptions,getCaretPosition:this.getCaretPosition,getCaretPositionEnd:this.getCaretPositionEnd,dispatch:this.dispatch}),this.caretPosition=null,this.caretPositionEnd=null,this.keyboardDOM=n,this.options=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({layoutName:"default",theme:"hg-theme-default",inputName:"default",preventMouseDownDefault:!1,enableLayoutCandidates:!0,excludeFromLayout:{}},t),this.keyboardPluginClasses="",l.bindMethods(O,this),this.options.inputName),t=void 0===n?this.defaultName:n;if(this.input={},this.input[t]="",this.keyboardDOMClass=e,this.buttonElements={},window.SimpleKeyboardInstances||(window.SimpleKeyboardInstances={}),this.currentInstanceName=this.utilities.camelCase(this.keyboardDOMClass),(window.SimpleKeyboardInstances[this.currentInstanceName]=this).allKeyboardInstances=window.SimpleKeyboardInstances,this.keyboardInstanceNames=Object.keys(window.SimpleKeyboardInstances),this.isFirstKeyboardInstance=this.keyboardInstanceNames[0]===this.currentInstanceName,this.physicalKeyboard=new d({dispatch:this.dispatch,getOptions:this.getOptions}),this.candidateBox=this.options.enableLayoutCandidates?new f({utilities:this.utilities}):null,!this.keyboardDOM)throw console.warn('".'.concat(e,'" was not found in the DOM.')),new Error("KEYBOARD_DOM_ERROR");this.render(),this.modules={},this.loadModules()}}return t});