L.Control.Permalink.include({initialize_line:function(){this.on("update",this._set_line,this),this.on("add",this._onadd_line,this)},_onadd_line:function(){this.options.line&&(this.options.line.on("edit",this._update_line,this),this._update_line())},_update_line:function(){if(this.options.line){var i=this.options.line;if(i){var n,t=[],e=i.getLatLngs();if(!e.length)return this._update({line:null});for(n in e)t.push(e[n].lat.toFixed(4)+","+e[n].lng.toFixed(4));this._update({line:t.join(";")})}}},_set_line:function(i){var n=i.params,i=this.options.line;if(i&&n.line){var t,e=[],s=n.line.split(";");for(t in s){var l=s[t].split(",");2===l.length&&e.push(new L.LatLng(l[0],l[1]))}e.length&&(i.setLatLngs(e),this._map.hasLayer(i)||this._map.addLayer(i))}}});