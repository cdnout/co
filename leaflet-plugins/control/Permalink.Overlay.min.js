L.Control.Permalink.include({initialize_overlay:function(){this.on("update",this._set_overlays,this),this.on("add",this._onadd_overlay,this)},_onadd_overlay:function(){this._map.on("overlayadd",this._update_overlay,this),this._map.on("overlayremove",this._update_overlay,this),this._update_overlay()},_update_overlay:function(){var a;!this.options.layers||(a=this.options.layers.overlayFlags())&&""!==a&&this._update({overlays:a})},_set_overlays:function(a){a=a.params;this.options.layers&&a.overlays&&this.options.layers.setOverlays(a.overlays)}}),L.Control.Layers.include({setOverlays:function(a){var e,s,r,t=0;for(e in this._layers)this._layers.hasOwnProperty(e)&&(r=this._layers[e]).overlay&&(s=t>=a.length||"T"===a[t],t++,!s&&this._map.hasLayer(r.layer)?this._map.removeLayer(r.layer):s&&!this._map.hasLayer(r.layer)&&this._map.addLayer(r.layer))},overlayFlags:function(){var a,e,s="";for(a in this._layers)this._layers.hasOwnProperty(a)&&((e=this._layers[a]).overlay&&e.overlay&&(this._map.hasLayer(e.layer)?s+="T":s+="F"));return s}});