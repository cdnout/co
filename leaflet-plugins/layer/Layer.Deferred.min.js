L.DeferredLayer=L.LayerGroup.extend({options:{js:[],init:null},_script_cache:{},initialize:function(t){L.Util.setOptions(this,t),L.LayerGroup.prototype.initialize.apply(this),this._loaded=!1},onAdd:function(t){L.LayerGroup.prototype.onAdd.apply(this,[t]),this._loaded||this._loadScripts(this.options.js.reverse(),L.Util.bind(function(){this._loaded=!0;var t=this.options.init();t&&this.addLayer(t)},this))},_loadScripts:function(t,i,e){if(!t||0===t.length)return i(e);var a,o,n=this,r=t.pop();function s(){n._loadScripts(t,i,e)}void 0===(a=this._script_cache[r])&&(a={url:r,wait:[]},(o=document.createElement("script")).src=r,o.type="text/javascript",o.onload=function(){a.e.readyState="completed";for(var t=0,t=0;t<a.wait.length;t++)a.wait[t]()},a.e=o,document.getElementsByTagName("head")[0].appendChild(o)),a.wait.push(s),"completed"===a.e.readyState&&s(),this._script_cache[r]=a}});