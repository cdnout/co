L.Yandex.include({_initLoader:function(i){var n;this._loader||((n=(i=i||this.options).apiLoader)?n.then&&(n={loading:n}):n=(i=this._makeUrl(i))&&this._loadScript.bind(this,i),n&&(L.Yandex.prototype._loader=n))},loadApi:function(i){if("undefined"!=typeof ymaps)return this;this._initLoader(i);i=this._loader;if(!i)throw new Error("api params expected in options");return i.loading||(i.loading=i()),this},_initApi:function(i){var n=this._loader;if("undefined"!=typeof ymaps)return ymaps.ready(this._initMapObject,this);if(i||!n)throw new Error("API is not available");i=n.loading;i||(i=n(),n.loading=i),i.then(this._initApi.bind(this,"afterload"))},_apiDefaults:{url:"https://api-maps.yandex.ru/{version}/",version:"2.1",params:{lang:"ru_RU",onerror:"console.error"}},_makeUrl:function(i){var n=i.apiUrl,t=i.apiParams,e=this._apiDefaults;return!(!n&&!t)&&(t&&("string"==typeof t&&(t={apikey:t}),t=L.extend({},e.params,t),n=(n||e.url)+L.Util.getParamString(t,n)),L.Util.template(n,{version:i.apiVersion||e.version}))},_loadScript:function(e){return new Promise(function(i,n){var t=document.createElement("script");t.onload=i,t.onerror=function(){n("API loading failed")},t.src=e,document.body.appendChild(t)})}}),L.Yandex.addInitHook(L.Yandex.prototype._initLoader);