L.Yandex.include({_initLoader:function(i){var n,r;this._loader||((r=(i=i||this.options).apiLoader)?r.then&&(r={loading:r}):r=(n=this._makeUrl(i))&&this._loadScript.bind(this,n),r&&(L.Yandex.prototype._loader=r))},loadApi:function(i){if("undefined"!=typeof ymaps)return this;this._initLoader(i);var n=this._loader;if(!n)throw new Error("api params expected in options");return n.loading||(n.loading=n()),this},_initApi:function(i){var n=this._loader;if("undefined"!=typeof ymaps)return ymaps.ready(this._initMapObject,this);if(i||!n)throw new Error("API is not available");var r=n.loading;r||(r=n(),n.loading=r),r.then(this._initApi.bind(this,"afterload"))},_apiDefaults:{url:"https://api-maps.yandex.ru/{version}/",version:"2.1",params:{lang:"ru_RU",onerror:"console.error"}},_makeUrl:function(i){var n=i.apiUrl,r=i.apiParams,t=this._apiDefaults;return!(!n&&!r)&&(r&&("string"==typeof r&&(r={apikey:r}),r=L.extend({},t.params,r),n=(n||t.url)+L.Util.getParamString(r,n)),L.Util.template(n,{version:i.apiVersion||t.version}))},_loadScript:function(t){return new Promise(function(i,n){var r=document.createElement("script");r.onload=i,r.onerror=function(){n("API loading failed")},r.src=t,document.body.appendChild(r)})}}),L.Yandex.addInitHook(L.Yandex.prototype._initLoader);