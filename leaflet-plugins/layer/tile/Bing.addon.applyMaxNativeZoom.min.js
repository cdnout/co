L.BingLayer.mergeOptions({applyMaxNativeZoom:"auto",applyMaxNativeZoom_validityRadius:1e7}),L.BingLayer.addInitHook(function(){var t=this.options;"auto"!==t.applyMaxNativeZoom||t.maxNativeZoom||(t.applyMaxNativeZoom="Road"===t.imagerySet||"Aerial"===t.imagerySet.substring(0,6)),t.applyMaxNativeZoom&&this.on("add",function(){this.applyMaxNativeZoom(this._map.getCenter())})}),L.BingLayer.include({applyMaxNativeZoom:function(e){var o=this.options,t=this._makeApiUrl("Imagery/BasicMetadata",L.Util.template("{imagerySet}/{centerPoint}",{imagerySet:o.imagerySet,centerPoint:L.Util.template("{lat},{lng}",e)})),n=o.zoomOffset||0;return this._findVintage(t,o.maxZoom+n,function(t){var a,i;t&&this._map&&(i=this._map.getCenter(),a=this.options.applyMaxNativeZoom_validityRadius,i.distanceTo(e)>a?this.applyMaxNativeZoom(i):(t-=n,a=o.maxNativeZoom||o.maxZoom,o.maxNativeZoom=t,i=this._map.getZoom(),(t<a&&t<i||a<t&&a<i)&&this._resetView(),this.fire("maxNativeZoomApplied",{latlng:e,value:t,oldValue:a})))}),this},_findVintage:function(a,i,e,o){this.callRestService(a+"&zoomLevel="+i,function(t){return t.resourceSets[0].resources[0].vintageStart||0===i?e.call(o||this,i):void this._findVintage(a,i-1,e,o)})}});