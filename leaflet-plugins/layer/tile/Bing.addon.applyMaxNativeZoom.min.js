L.BingLayer.mergeOptions({applyMaxNativeZoom:"auto",applyMaxNativeZoom_validityRadius:1e7}),L.BingLayer.addInitHook(function(){var t=this.options;"auto"!==t.applyMaxNativeZoom||t.maxNativeZoom||(t.applyMaxNativeZoom="Road"===t.imagerySet||"Aerial"===t.imagerySet.substring(0,6)),t.applyMaxNativeZoom&&this.on("add",function(){this.applyMaxNativeZoom(this._map.getCenter())})}),L.BingLayer.include({applyMaxNativeZoom:function(n){var m=this.options,t=this._makeApiUrl("Imagery/BasicMetadata",L.Util.template("{imagerySet}/{centerPoint}",{imagerySet:m.imagerySet,centerPoint:L.Util.template("{lat},{lng}",n)})),s=m.zoomOffset||0;return this._findVintage(t,m.maxZoom+s,function(t){var a,i,e,o;t&&this._map&&(a=this._map.getCenter(),i=this.options.applyMaxNativeZoom_validityRadius,a.distanceTo(n)>i?this.applyMaxNativeZoom(a):(t-=s,e=m.maxNativeZoom||m.maxZoom,m.maxNativeZoom=t,o=this._map.getZoom(),(t<e&&t<o||e<t&&e<o)&&this._resetView(),this.fire("maxNativeZoomApplied",{latlng:n,value:t,oldValue:e})))}),this},_findVintage:function(a,i,e,o){this.callRestService(a+"&zoomLevel="+i,function(t){if(t.resourceSets[0].resources[0].vintageStart||0===i)return e.call(o||this,i);this._findVintage(a,i-1,e,o)})}});