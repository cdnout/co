!function(e){function t(t,s,i){i=i||{},i.axesDefaults=i.axesDefaults||{},i.legend=i.legend||{},i.seriesDefaults=i.seriesDefaults||{};var n=!1;if(i.seriesDefaults.renderer==e.jqplot.FunnelRenderer)n=!0;else if(i.series)for(var r=0;r<i.series.length;r++)i.series[r].renderer==e.jqplot.FunnelRenderer&&(n=!0);n&&(i.axesDefaults.renderer=e.jqplot.FunnelAxisRenderer,i.legend.renderer=e.jqplot.FunnelLegendRenderer,i.legend.preDraw=!0,i.sortData=!1,i.seriesDefaults.pointLabels={show:!1})}function s(t,s,i){for(var n=0;n<this.series.length;n++)this.series[n].renderer.constructor==e.jqplot.FunnelRenderer&&this.series[n].highlightMouseOver&&(this.series[n].highlightMouseDown=!1)}function i(t){for(var s=0;s<this.series.length;s++)this.series[s].seriesColors=this.seriesColors,this.series[s].colorGenerator=e.jqplot.colorGenerator}function n(e,t,s){var i=e.series[t],n=e.plugins.funnelRenderer.highlightCanvas;n._ctx.clearRect(0,0,n._ctx.canvas.width,n._ctx.canvas.height),i._highlightedPoint=s,e.plugins.funnelRenderer.highlightedSeriesIndex=t,i.renderer.drawSection.call(i,n._ctx,i._vertices[s],i.highlightColors[s],!1)}function r(e){var t=e.plugins.funnelRenderer.highlightCanvas;t._ctx.clearRect(0,0,t._ctx.canvas.width,t._ctx.canvas.height);for(var s=0;s<e.series.length;s++)e.series[s]._highlightedPoint=null;e.plugins.funnelRenderer.highlightedSeriesIndex=null,e.target.trigger("jqplotDataUnhighlight")}function h(e,t,s,i,h){if(i){var a=[i.seriesIndex,i.pointIndex,i.data],l=jQuery.Event("jqplotDataMouseOver");if(l.pageX=e.pageX,l.pageY=e.pageY,h.target.trigger(l,a),h.series[a[0]].highlightMouseOver&&(a[0]!=h.plugins.funnelRenderer.highlightedSeriesIndex||a[1]!=h.series[a[0]]._highlightedPoint)){var o=jQuery.Event("jqplotDataHighlight");o.which=e.which,o.pageX=e.pageX,o.pageY=e.pageY,h.target.trigger(o,a),n(h,a[0],a[1])}}else null==i&&r(h)}function a(e,t,s,i,h){if(i){var a=[i.seriesIndex,i.pointIndex,i.data];if(h.series[a[0]].highlightMouseDown&&(a[0]!=h.plugins.funnelRenderer.highlightedSeriesIndex||a[1]!=h.series[a[0]]._highlightedPoint)){var l=jQuery.Event("jqplotDataHighlight");l.which=e.which,l.pageX=e.pageX,l.pageY=e.pageY,h.target.trigger(l,a),n(h,a[0],a[1])}}else null==i&&r(h)}function l(e,t,s,i,n){var h=n.plugins.funnelRenderer.highlightedSeriesIndex;null!=h&&n.series[h].highlightMouseDown&&r(n)}function o(e,t,s,i,n){if(i){var r=[i.seriesIndex,i.pointIndex,i.data],h=jQuery.Event("jqplotDataClick");h.which=e.which,h.pageX=e.pageX,h.pageY=e.pageY,n.target.trigger(h,r)}}function d(e,t,s,i,n){if(i){var h=[i.seriesIndex,i.pointIndex,i.data],a=n.plugins.funnelRenderer.highlightedSeriesIndex;null!=a&&n.series[a].highlightMouseDown&&r(n);var l=jQuery.Event("jqplotDataRightClick");l.which=e.which,l.pageX=e.pageX,l.pageY=e.pageY,n.target.trigger(l,h)}}function g(){this.plugins.funnelRenderer&&this.plugins.funnelRenderer.highlightCanvas&&(this.plugins.funnelRenderer.highlightCanvas.resetCanvas(),this.plugins.funnelRenderer.highlightCanvas=null),this.plugins.funnelRenderer={},this.plugins.funnelRenderer.highlightCanvas=new e.jqplot.GenericCanvas;var t=e(this.targetId+" .jqplot-data-label");t.length?e(t[0]).before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this)):this.eventCanvas._elem.before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this));this.plugins.funnelRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(e){r(e.data.plot)})}e.jqplot.FunnelRenderer=function(){e.jqplot.LineRenderer.call(this)},e.jqplot.FunnelRenderer.prototype=new e.jqplot.LineRenderer,e.jqplot.FunnelRenderer.prototype.constructor=e.jqplot.FunnelRenderer,e.jqplot.FunnelRenderer.prototype.init=function(t,n){this.padding={top:20,right:20,bottom:20,left:20},this.sectionMargin=6,this.fill=!0,this.shadowOffset=2,this.shadowAlpha=.07,this.shadowDepth=5,this.highlightMouseOver=!0,this.highlightMouseDown=!1,this.highlightColors=[],this.widthRatio=.2,this.lineWidth=2,this.dataLabels="percent",this.showDataLabels=!1,this.dataLabelFormatString=null,this.dataLabelThreshold=3,this._type="funnel",this.tickRenderer=e.jqplot.FunnelTickRenderer,t.highlightMouseDown&&null==t.highlightMouseOver&&(t.highlightMouseOver=!1),e.extend(!0,this,t),this._highlightedPoint=null,this._bases=[],this._atot,this._areas=[],this._lengths=[],this._angle,this._dataIndices=[],this._unorderedData=e.extend(!0,[],this.data);for(var r=e.extend(!0,[],this.data),p=0;p<r.length;p++)r[p].push(p);this.data.sort(function(e,t){return t[1]-e[1]}),r.sort(function(e,t){return t[1]-e[1]});for(var p=0;p<r.length;p++)this._dataIndices.push(r[p][2]);if(0==this.highlightColors.length)for(var p=0;p<this.seriesColors.length;p++){for(var u=e.jqplot.getColorComponents(this.seriesColors[p]),c=[u[0],u[1],u[2]],f=c[0]+c[1]+c[2],v=0;v<3;v++)c[v]=f>570?.8*c[v]:c[v]+.4*(255-c[v]),c[v]=parseInt(c[v],10);this.highlightColors.push("rgb("+c[0]+","+c[1]+","+c[2]+")")}n.postParseOptionsHooks.addOnce(i),n.postInitHooks.addOnce(s),n.eventListenerHooks.addOnce("jqplotMouseMove",h),n.eventListenerHooks.addOnce("jqplotMouseDown",a),n.eventListenerHooks.addOnce("jqplotMouseUp",l),n.eventListenerHooks.addOnce("jqplotClick",o),n.eventListenerHooks.addOnce("jqplotRightClick",d),n.postDrawHooks.addOnce(g)},e.jqplot.FunnelRenderer.prototype.setGridData=function(e){for(var t=0,s=[],i=0;i<this.data.length;i++)t+=this.data[i][1],s.push([this.data[i][0],this.data[i][1]]);for(var i=0;i<s.length;i++)s[i][1]=s[i][1]/t;this._bases=new Array(s.length+1),this._lengths=new Array(s.length),this.gridData=s},e.jqplot.FunnelRenderer.prototype.makeGridData=function(e,t){for(var s=0,i=[],n=0;n<this.data.length;n++)s+=this.data[n][1],i.push([this.data[n][0],this.data[n][1]]);for(var n=0;n<i.length;n++)i[n][1]=i[n][1]/s;return this._bases=new Array(i.length+1),this._lengths=new Array(i.length),i},e.jqplot.FunnelRenderer.prototype.drawSection=function(e,t,s,i){function n(){e.beginPath(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=h,e.moveTo(t[0][0],t[0][1]);for(var i=1;i<4;i++)e.lineTo(t[i][0],t[i][1]);e.closePath(),r?e.fill():e.stroke()}var r=this.fill,h=this.lineWidth;if(e.save(),i)for(var a=0;a<this.shadowDepth;a++)e.save(),e.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI)),n();else n();if(i)for(var a=0;a<this.shadowDepth;a++)e.restore();e.restore()},e.jqplot.FunnelRenderer.prototype.draw=function(t,s,i,n){function r(e){var t=(L[1]-k[1])/(L[0]-k[0]),s=L[1]-t*L[0],i=e+L[1];return[(i-s)/t,i]}function h(e){var t=(C[1]-F[1])/(C[0]-F[0]),s=C[1]-t*C[0],i=e+C[1];return[(i-s)/t,i]}var a,l=void 0!=i?i:{},o=0,d=0,g=1;if(this._areas=[],i.legendInfo&&"insideGrid"==i.legendInfo.placement){var p=i.legendInfo;switch(p.location){case"nw":o=p.width+p.xoffset;break;case"w":o=p.width+p.xoffset;break;case"sw":o=p.width+p.xoffset;break;case"ne":o=p.width+p.xoffset,g=-1;break;case"e":o=p.width+p.xoffset,g=-1;break;case"se":o=p.width+p.xoffset,g=-1;break;case"n":d=p.height+p.yoffset;break;case"s":d=p.height+p.yoffset,g=-1}}var u=1==g?this.padding.left+o:this.padding.left,c=1==g?this.padding.top+d:this.padding.top,f=g==-1?this.padding.right+o:this.padding.right,v=g==-1?this.padding.bottom+d:this.padding.bottom,b=(void 0!=l.shadow?l.shadow:this.shadow,void 0!=l.showLine?l.showLine:this.showLine,void 0!=l.fill?l.fill:this.fill,t.canvas.width),_=t.canvas.height;this._bases[0]=b-u-f;var w=this._length=_-c-v,j=this._bases[0]*this.widthRatio;for(this._atot=w/2*(this._bases[0]+this._bases[0]*this.widthRatio),this._angle=Math.atan((this._bases[0]-j)/2/w),a=0;a<s.length;a++)this._areas.push(s[a][1]*this._atot);var R,q,m,x=0,y=1e-4;for(a=0;a<this._areas.length;a++){for(R=this._areas[a]/this._bases[a],q=999999,this._lengths[a]=R,m=0;q>this._lengths[a]*y&&m<100;)this._lengths[a]=this._areas[a]/(this._bases[a]-this._lengths[a]*Math.tan(this._angle)),q=Math.abs(this._lengths[a]-R),this._bases[a+1]=this._bases[a]-2*this._lengths[a]*Math.tan(this._angle),R=this._lengths[a],m++;x+=this._lengths[a]}this._vertices=new Array(s.length);var L=[u,c],C=[u+this._bases[0],c],k=[u+(this._bases[0]-this._bases[this._bases.length-1])/2,c+this._length],F=[k[0]+this._bases[this._bases.length-1],k[1]],D=o,M=d,I=0,T=0;for(a=0;a<s.length;a++){this._vertices[a]=new Array;var A=this._vertices[a],S=this.sectionMargin;0==a&&(T=0),1==a?T=S/3:a>0&&a<s.length-1?T=S/2:a==s.length-1&&(T=2*S/3),A.push(r(I+T)),A.push(h(I+T)),I+=this._lengths[a],0==a?T=-2*S/3:a>0&&a<s.length-1?T=-S/2:a==s.length-1&&(T=0),A.push(h(I+T)),A.push(r(I+T))}if(this.shadow)for(var O="rgba(0,0,0,"+this.shadowAlpha+")",a=0;a<s.length;a++)this.renderer.drawSection.call(this,t,this._vertices[a],O,!0);for(var a=0;a<s.length;a++){var A=this._vertices[a];if(this.renderer.drawSection.call(this,t,A,this.seriesColors[a]),this.showDataLabels&&100*s[a][1]>=this.dataLabelThreshold){var P,H;"label"==this.dataLabels?(P=this.dataLabelFormatString||"%s",H=e.jqplot.sprintf(P,s[a][0])):"value"==this.dataLabels?(P=this.dataLabelFormatString||"%d",H=e.jqplot.sprintf(P,this.data[a][1])):"percent"==this.dataLabels?(P=this.dataLabelFormatString||"%d%%",H=e.jqplot.sprintf(P,100*s[a][1])):this.dataLabels.constructor==Array&&(P=this.dataLabelFormatString||"%s",H=e.jqplot.sprintf(P,this.dataLabels[this._dataIndices[a]]));var D=(this._radius*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge,(A[0][0]+A[1][0])/2+this.canvas._offsets.left),M=(A[1][1]+A[2][1])/2+this.canvas._offsets.top,X=e('<span class="jqplot-funnel-series jqplot-data-label" style="position:absolute;">'+H+"</span>").insertBefore(n.eventCanvas._elem);D-=X.width()/2,M-=X.height()/2,D=Math.round(D),M=Math.round(M),X.css({left:D,top:M})}}},e.jqplot.FunnelAxisRenderer=function(){e.jqplot.LinearAxisRenderer.call(this)},e.jqplot.FunnelAxisRenderer.prototype=new e.jqplot.LinearAxisRenderer,e.jqplot.FunnelAxisRenderer.prototype.constructor=e.jqplot.FunnelAxisRenderer,e.jqplot.FunnelAxisRenderer.prototype.init=function(t){this.tickRenderer=e.jqplot.FunnelTickRenderer,e.extend(!0,this,t),this._dataBounds={min:0,max:100},this.min=0,this.max=100,this.showTicks=!1,this.ticks=[],this.showMark=!1,this.show=!1},e.jqplot.FunnelLegendRenderer=function(){e.jqplot.TableLegendRenderer.call(this)},e.jqplot.FunnelLegendRenderer.prototype=new e.jqplot.TableLegendRenderer,e.jqplot.FunnelLegendRenderer.prototype.constructor=e.jqplot.FunnelLegendRenderer,e.jqplot.FunnelLegendRenderer.prototype.init=function(t){this.numberRows=null,this.numberColumns=null,e.extend(!0,this,t)},e.jqplot.FunnelLegendRenderer.prototype.draw=function(){if(this.show){var t=this._series,s="position:absolute;";s+=this.background?"background:"+this.background+";":"",s+=this.border?"border:"+this.border+";":"",s+=this.fontSize?"font-size:"+this.fontSize+";":"",s+=this.fontFamily?"font-family:"+this.fontFamily+";":"",s+=this.textColor?"color:"+this.textColor+";":"",s+=null!=this.marginTop?"margin-top:"+this.marginTop+";":"",s+=null!=this.marginBottom?"margin-bottom:"+this.marginBottom+";":"",s+=null!=this.marginLeft?"margin-left:"+this.marginLeft+";":"",s+=null!=this.marginRight?"margin-right:"+this.marginRight+";":"",this._elem=e('<table class="jqplot-table-legend" style="'+s+'"></table>');var i,n,r=!1,h=!1,a=t[0],l=new e.jqplot.ColorGenerator(a.seriesColors);if(a.show){var o=a.data;this.numberRows?(i=this.numberRows,n=this.numberColumns?this.numberColumns:Math.ceil(o.length/i)):this.numberColumns?(n=this.numberColumns,i=Math.ceil(o.length/this.numberColumns)):(i=o.length,n=1);var d,g,p,u,c,f,v,b,_=0;for(d=0;d<i;d++)for(p=h?e('<tr class="jqplot-table-legend"></tr>').prependTo(this._elem):e('<tr class="jqplot-table-legend"></tr>').appendTo(this._elem),g=0;g<n;g++)_<o.length&&(f=this.labels[_]||o[_][0].toString(),b=l.next(),r=h?d!=i-1:d>0,v=r?this.rowSpacing:"0",u=e('<td class="jqplot-table-legend" style="text-align:center;padding-top:'+v+';"><div><div class="jqplot-table-legend-swatch" style="border-color:'+b+';"></div></div></td>'),c=e('<td class="jqplot-table-legend" style="padding-top:'+v+';"></td>'),this.escapeHtml?c.text(f):c.html(f),h?(c.prependTo(p),u.prependTo(p)):(u.appendTo(p),c.appendTo(p)),r=!0),_++}}return this._elem},e.jqplot.preInitHooks.push(t),e.jqplot.FunnelTickRenderer=function(){e.jqplot.AxisTickRenderer.call(this)},e.jqplot.FunnelTickRenderer.prototype=new e.jqplot.AxisTickRenderer,e.jqplot.FunnelTickRenderer.prototype.constructor=e.jqplot.FunnelTickRenderer}(jQuery);