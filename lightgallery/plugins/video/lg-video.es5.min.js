var __assign=function(){return(__assign=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},videoSettings={autoplayFirstVideo:!0,youTubePlayerParams:!1,vimeoPlayerParams:!1,wistiaPlayerParams:!1,gotoNextSlideOnVideoEnd:!0,autoplayVideoOnSlide:!1,videojs:!1,videojsTheme:"",videojsOptions:{}},lGEvents={afterAppendSlide:"lgAfterAppendSlide",init:"lgInit",hasVideo:"lgHasVideo",containerResize:"lgContainerResize",updateSlides:"lgUpdateSlides",afterAppendSubHtml:"lgAfterAppendSubHtml",beforeOpen:"lgBeforeOpen",afterOpen:"lgAfterOpen",slideItemLoad:"lgSlideItemLoad",beforeSlide:"lgBeforeSlide",afterSlide:"lgAfterSlide",posterClick:"lgPosterClick",dragStart:"lgDragStart",dragMove:"lgDragMove",dragEnd:"lgDragEnd",beforeNextSlide:"lgBeforeNextSlide",beforePrevSlide:"lgBeforePrevSlide",beforeClose:"lgBeforeClose",afterClose:"lgAfterClose",rotateLeft:"lgRotateLeft",rotateRight:"lgRotateRight",flipHorizontal:"lgFlipHorizontal",flipVertical:"lgFlipVertical",autoplay:"lgAutoplay",autoplayStart:"lgAutoplayStart",autoplayStop:"lgAutoplayStop"},param=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},getVimeoURLParams=function(e,t){if(!t||!t.vimeo)return"";var o=t.vimeo[2]||"",e=e&&0!==Object.keys(e).length?"&"+param(e):"",i=((t.vimeo[0].split("/").pop()||"").split("?")[0]||"").split("#")[0],t=t.vimeo[1]!==i;return"?autoplay=0&muted=1"+(t?"&h="+i:"")+e+(o="?"==(o=t?o.replace("/"+i,""):o)[0]?"&"+o.slice(1):o||"")},Video=function(){function e(e){return this.core=e,this.settings=__assign(__assign({},videoSettings),this.core.settings),this}return e.prototype.init=function(){var t=this;this.core.LGel.on(lGEvents.hasVideo+".video",this.onHasVideo.bind(this)),this.core.LGel.on(lGEvents.posterClick+".video",function(){var e=t.core.getSlideItem(t.core.index);t.loadVideoOnPosterClick(e)}),this.core.LGel.on(lGEvents.slideItemLoad+".video",this.onSlideItemLoad.bind(this)),this.core.LGel.on(lGEvents.beforeSlide+".video",this.onBeforeSlide.bind(this)),this.core.LGel.on(lGEvents.afterSlide+".video",this.onAfterSlide.bind(this))},e.prototype.onSlideItemLoad=function(e){var t=this,e=e.detail,o=e.isFirstSlide,i=e.index;this.settings.autoplayFirstVideo&&o&&i===this.core.index&&setTimeout(function(){t.loadAndPlayVideo(i)},200),!o&&this.settings.autoplayVideoOnSlide&&i===this.core.index&&this.loadAndPlayVideo(i)},e.prototype.onHasVideo=function(e){var e=e.detail,t=e.index,o=e.src,i=e.html5Video;e.hasPoster||(this.appendVideos(this.core.getSlideItem(t),{src:o,addClass:"lg-object",index:t,html5Video:i}),this.gotoNextSlideOnVideoEnd(o,t))},e.prototype.onBeforeSlide=function(e){this.core.lGalleryOn&&(e=e.detail.prevIndex,this.pauseVideo(e))},e.prototype.onAfterSlide=function(e){var t=this,e=e.detail,o=e.index,e=e.prevIndex,i=this.core.getSlideItem(o);this.settings.autoplayVideoOnSlide&&o!==e&&i.hasClass("lg-complete")&&setTimeout(function(){t.loadAndPlayVideo(o)},100)},e.prototype.loadAndPlayVideo=function(e){var t=this.core.getSlideItem(e);this.core.galleryItems[e].poster?this.loadVideoOnPosterClick(t,!0):this.playVideo(e)},e.prototype.playVideo=function(e){this.controlVideo(e,"play")},e.prototype.pauseVideo=function(e){this.controlVideo(e,"pause")},e.prototype.getVideoHtml=function(e,t,o,i){var s="",l=this.core.galleryItems[o].__slideVideoInfo||{},r=this.core.galleryItems[o],r=(r=r.title||r.alt)?'title="'+r+'"':"",a='allowtransparency="true"\n            frameborder="0"\n            scrolling="no"\n            allowfullscreen\n            mozallowfullscreen\n            webkitallowfullscreen\n            oallowfullscreen\n            msallowfullscreen';if(l.youtube)var n="lg-youtube"+o,d="?"+(l.youtube[2]?l.youtube[2]+"&":"")+"wmode=opaque&autoplay=0&mute=1&enablejsapi=1"+(this.settings.youTubePlayerParams?"&"+param(this.settings.youTubePlayerParams):""),s='<iframe allow="autoplay" id='+n+' class="lg-video-object lg-youtube '+t+'" '+r+' src="//www.youtube.com/embed/'+(l.youtube[1]+d)+'" '+a+"></iframe>";else if(l.vimeo){n="lg-vimeo"+o,d=getVimeoURLParams(this.settings.vimeoPlayerParams,l);s='<iframe allow="autoplay" id='+n+' class="lg-video-object lg-vimeo '+t+'" '+r+' src="//player.vimeo.com/video/'+(l.vimeo[1]+d)+'" '+a+"></iframe>"}else if(l.wistia){n="lg-wistia"+o,d=param(this.settings.wistiaPlayerParams);s='<iframe allow="autoplay" id="'+n+'" src="//fast.wistia.net/embed/iframe/'+(l.wistia[4]+(d=d?"?"+d:""))+'" '+r+' class="wistia_embed lg-video-object lg-wistia '+t+'" name="wistia_embed" '+a+"></iframe>"}else if(l.html5){for(var c="",g=0;g<i.source.length;g++)c+='<source src="'+i.source[g].src+'" type="'+i.source[g].type+'">';if(i.tracks)for(g=0;g<i.tracks.length;g++)!function(e){var t="",o=i.tracks[e];Object.keys(o||{}).forEach(function(e){t+=e+'="'+o[e]+'" '}),c+="<track "+t+">"}(g);var u="",f=i.attributes||{};Object.keys(f||{}).forEach(function(e){u+=e+'="'+f[e]+'" '}),s='<video class="lg-video-object lg-html5 '+(this.settings.videojs&&this.settings.videojsTheme?this.settings.videojsTheme+" ":"")+" "+(this.settings.videojs?" video-js":"")+'" '+u+">\n                "+c+"\n                Your browser does not support HTML5 video.\n            </video>"}return s},e.prototype.appendVideos=function(e,t){var o=this.getVideoHtml(t.src,t.addClass,t.index,t.html5Video),o=(e.find(".lg-video-cont").append(o),e.find(".lg-video-object").first());if(t.html5Video&&o.on("mousedown.lg.video",function(e){e.stopPropagation()}),this.settings.videojs&&null!=(e=this.core.galleryItems[t.index].__slideVideoInfo)&&e.html5)try{return videojs(o.get(),this.settings.videojsOptions)}catch(e){console.error("lightGallery:- Make sure you have included videojs")}},e.prototype.gotoNextSlideOnVideoEnd=function(e,t){var o=this,i=this.core.getSlideItem(t).find(".lg-video-object").first(),t=this.core.galleryItems[t].__slideVideoInfo||{};if(this.settings.gotoNextSlideOnVideoEnd)if(t.html5)i.on("ended",function(){o.core.goToNextSlide()});else if(t.vimeo)try{new Vimeo.Player(i.get()).on("ended",function(){o.core.goToNextSlide()})}catch(e){console.error("lightGallery:- Make sure you have included //github.com/vimeo/player.js")}else if(t.wistia)try{window._wq=window._wq||[],window._wq.push({id:i.attr("id"),onReady:function(e){e.bind("end",function(){o.core.goToNextSlide()})}})}catch(e){console.error("lightGallery:- Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}},e.prototype.controlVideo=function(e,t){var o=this.core.getSlideItem(e).find(".lg-video-object").first(),e=this.core.galleryItems[e].__slideVideoInfo||{};if(o.get())if(e.youtube)try{o.get().contentWindow.postMessage('{"event":"command","func":"'+t+'Video","args":""}',"*")}catch(e){console.error("lightGallery:- "+e)}else if(e.vimeo)try{new Vimeo.Player(o.get())[t]()}catch(e){console.error("lightGallery:- Make sure you have included //github.com/vimeo/player.js")}else if(e.html5)if(this.settings.videojs)try{videojs(o.get())[t]()}catch(e){console.error("lightGallery:- Make sure you have included videojs")}else o.get()[t]();else if(e.wistia)try{window._wq=window._wq||[],window._wq.push({id:o.attr("id"),onReady:function(e){e[t]()}})}catch(e){console.error("lightGallery:- Make sure you have included //fast.wistia.com/assets/external/E-v1.js")}},e.prototype.loadVideoOnPosterClick=function(e,t){var o,i,s,l=this;e.hasClass("lg-video-loaded")?t&&this.playVideo(this.core.index):e.hasClass("lg-has-video")?this.playVideo(this.core.index):(e.addClass("lg-has-video"),t=void 0,o=this.core.galleryItems[this.core.index].src,(s=this.core.galleryItems[this.core.index].video)&&(t="string"==typeof s?JSON.parse(s):s),i=this.appendVideos(e,{src:o,addClass:"",index:this.core.index,html5Video:t}),this.gotoNextSlideOnVideoEnd(o,this.core.index),s=e.find(".lg-object").first().get(),e.find(".lg-video-cont").first().append(s),e.addClass("lg-video-loading"),i&&i.ready(function(){i.on("loadedmetadata",function(){l.onVideoLoadAfterPosterClick(e,l.core.index)})}),e.find(".lg-video-object").first().on("load.lg error.lg loadedmetadata.lg",function(){setTimeout(function(){l.onVideoLoadAfterPosterClick(e,l.core.index)},50)}))},e.prototype.onVideoLoadAfterPosterClick=function(e,t){e.addClass("lg-video-loaded"),this.playVideo(t)},e.prototype.destroy=function(){this.core.LGel.off(".lg.video"),this.core.LGel.off(".video")},e}();export default Video;