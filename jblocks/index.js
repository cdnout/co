!function(t,n){"object"==typeof module&&module.exports?module.exports=n():t.jBlocks=n()}(this,function(){var t={},n={},e=0,r=function(){},s={};s.destroy=function(t){return this.get(t).destroy(),this},s.define=function(t,e){if(n[t])throw new Error(t+" has already been declared");return n[t]=e||{},this},s.forget=function(t){return n[t]=null,this},s.get=function(n){if(!n)throw new Error("invalid node");var e=n.getAttribute("data-component");if(!e)throw new Error("data-component attribute is missing");var i=n.getAttribute("data-instance");if(!i){try{var r=JSON.parse(n.getAttribute("data-props"))}catch(s){throw s}var h=new o(n,e,r),i=h.__id;t[e]||(t[e]={}),t[e][i]=h}return t[e][i]};var o=function(t,i,r){this.name=i,this.node=t,this.props=r||{},this.__decl=n[this.name]||{},this.__id=++e,this.__events={},this.__handlerDomEvents=this.__handlerDomEvents.bind(this),this.__bindMethods(),this.__bindDomEvents(),this.oninit()};return s.Component=o,o.prototype={on:function(t,n){return this.__events[t]=this.__events[t]||[],-1===this.__events[t].indexOf(n)&&this.__events[t].push(n),this},off:function(t,n){var e=this.__events[t];return e?(e.indexOf(n)>-1?e.splice(e.indexOf(n)-1,1):n||(this.__events[t]=[]),this):this},emit:function(t,n){var e=this.__events[t];if(!e)return this;for(var r=i=e.length;r--;)try{e[r-i+1].call(this,n||{})}catch(s){throw new Error(s.message+" (Check out "+t+" handler of "+this.name+" component)")}return this},destroy:function(){return t[this.name][this.__id]=null,this.__unbindDomEvents(),this.__events=null,this.ondestroy(),null},__bindMethods:function(){var t=this.__decl.methods||{};t.oninit=t.oninit||r,t.ondestroy=t.ondestroy||r;for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);return this},__bindDomEvents:function(){return this.__forEachEvent(function(t){this.node.addEventListener(t,this.__handlerDomEvents)})},__unbindDomEvents:function(){return this.__forEachEvent(function(t){this.node.removeEventListener(t,this.__handlerDomEvents)})},__forEachEvent:function(t){var n=this.__decl.events||{};for(var e in n)if(n.hasOwnProperty(e)){var i=e.split(" ",2),r=i[0],s=i[1],o=n[e];t.call(this,r,s,o)}return this},__handlerDomEvents:function(t){var n=(t.type,t.target);this.__decl.events;this.__forEachEvent(function(t,e,i){if(e){var r=this.node.querySelector(e);this.__contains(r,n)&&this.__tryCall(i)}else this.__tryCall(i)})},__tryCall:function(t){try{return this[t]()}catch(n){throw new Error(n.message+". Check out "+t)}},__contains:function(t,n){return t===n||t.contains(n)}},s});