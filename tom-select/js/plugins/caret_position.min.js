!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).caret_position=t()}(this,function(){"use strict";new RegExp(Object.keys({"æ":"ae","ⱥ":"a","ø":"o"}).join("|"),"g");const i=e=>{var t=[];return((e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)})(e,e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},a=e=>e=Array.isArray(e)?e:[e];return function(){var o=this;o.hook("instead","setCaret",n=>{"single"!==o.settings.mode&&o.control.contains(o.control_input)?(n=Math.max(0,Math.min(o.items.length,n)))==o.caretPos||o.isPending||o.controlChildren().forEach((e,t)=>{t<n?o.control_input.insertAdjacentElement("beforebegin",e):o.control.appendChild(e)}):n=o.items.length,o.caretPos=n}),o.hook("instead","moveCaret",e=>{var t,n,r;o.isFocused&&((n=o.getLastActive(e))?(t=((e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var n=0;e=e.previousElementSibling;)e.matches(t)&&n++;return n})(n),o.setCaret(0<e?t+1:t),o.setActiveItem(),t=n,n=["last-active"],r=i(n),(t=a(t)).map(t=>{r.map(e=>{t.classList.remove(e)})})):o.setCaret(o.caretPos+e))})}});