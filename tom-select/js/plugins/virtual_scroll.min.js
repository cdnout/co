!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).virtual_scroll=t()}(this,function(){"use strict";new RegExp(Object.keys({"æ":"ae","ⱥ":"a","ø":"o"}).join("|"),"g");const d=e=>{var t=[];return((e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)})(e,e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},c=e=>e=Array.isArray(e)?e:[e];return function(){const i=this,t=i.canLoad,e=i.clearActiveOption,r=i.loadCallback;var o,s,l={},n=!1;if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=function(){if(.9<o.clientHeight/(o.scrollHeight-o.scrollTop))return!0;if(i.activeOption){var e=i.selectable();if([...e].indexOf(i.activeOption)>=e.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";function a(e){return!("number"==typeof i.settings.maxOptions&&o.children.length>=i.settings.maxOptions)&&!!(e in l&&l[e])}i.settings.sortField=[{field:"$order"},{field:"$score"}],i.setNextUrl=function(e,t){l[e]=t},i.getUrl=function(e){if(e in l){var t=l[e];return l[e]=!1,t}return l={},i.settings.firstUrl.call(i,e)},i.hook("instead","clearActiveOption",()=>{if(!n)return e.call(i)}),i.hook("instead","canLoad",e=>e in l?a(e):t.call(i,e)),i.hook("instead","loadCallback",(e,t)=>{n?s&&0<e.length&&(s.dataset.value=e[0][i.settings.valueField]):i.clearOptions(),r.call(i,e,t),n=!1}),i.hook("after","refreshOptions",()=>{var e,t,r,n=i.lastValue;a(n)?(e=i.render("loading_more",{query:n}))&&(e.setAttribute("data-selectable",""),s=e):n in l&&!o.querySelector(".no-results")&&(e=i.render("no_more_results",{query:n})),e&&(t=e,n=[i.settings.optionClass],r=d(n),(t=c(t)).map(t=>{r.map(e=>{t.classList.add(e)})}),o.append(e))}),i.on("initialize",()=>{o=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:function(){return'<div class="loading-more-results">Loading more results ... </div>'},no_more_results:function(){return'<div class="no-more-results">No more results</div>'}},i.settings.render),o.addEventListener("scroll",function(){i.settings.shouldLoadMore.call(i)&&a(i.lastValue)&&(n||(n=!0,i.load.call(i,i.lastValue)))})})}});