var Plates="undefined"!=typeof module&&"id"in module&&"undefined"!=typeof exports?exports:{};!function(t,e,r){"use strict";function a(t,e,a,i,n){if(n=e.dataKey||n,e.dataKey&&"function"==typeof e.dataKey)return e.dataKey(t,a||"",i||"",n);if(!~n.indexOf("."))return t[n];for(var l=n,s=t,c=n.split("."),u=0,o=c.length;u<o&&s;u++)l=s[+c[u]||c[u]],s=l;return l!==r?l:t[n]}function i(t){var e=t.slice(0);return e.sort(function(t,e){if(!t.attribute)return 1;if(!e.attribute)return-1;if(t.attribute!==e.attribute)return t.attribute<e.attribute?-1:1;if(t.value!==e.value)return t.value<e.value?-1:1;if(!("replace"in t||"replace"in e))throw new Error("Conflicting mappings for attribute "+t.attribute+" and value "+t.value);return t.replace?1:-1}),e}function n(t,e,r){var a,i,n,l="</"+e+">",s=new RegExp("< *"+e+"( *|>)","g"),c=0,u=-1;for(a=r.search(t),i=a;i>-1&&c!==u;)i=r.indexOf(l,i),i>-1&&(i+=e.length+3,c++,n=r.slice(a,i),u=n.match(s).length);if(i===-1)throw new Error("Unmatched tag "+e+" in "+r);return n}function l(t){return this instanceof l?(this.mappings=[],void(this.conf=t||{})):new l(t)}function s(t){t&&this.mappings.push({});var e=this.mappings[this.mappings.length-1];return e&&e.attribute&&e.value&&e.dataKey&&e.replace?e.re=new RegExp(e.attribute+"=(['\"]?)"+e.value+"\\1"):e&&delete e.re,e}var c=Object.prototype.toString;[].indexOf||(Array.prototype.indexOf=function(t,e,r){for(r=this.length,e=(r+~~e)%r;e<r&&(!(e in this)||this[e]!==t);e++);return e^r?e:-1}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===c.call(t)});var u=function(){};u.prototype={nest:[],tag:new RegExp(["<","(/?)","([-:\\w]+)","((?:[-\\w]+(?:","=","(?:\\w+|[\"|'](?:.*)[\"|']))?)*)","(/?)",">"].join("\\s*")),attr:/([\-\w]*)\s*=\s*(?:(["\'])([\-\.\w\s\/:;&#]*)\2)/gi,selfClosing:/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/,hasClass:function(t,e){return~t.split(" ").indexOf(e)},iterate:function(t,e,r,a,i,l){var s="",c=n(r.input,a,t),u={};if(Array.isArray(e)){for(var o=0,p=e.length;o<p;o++)i?u[i]=e[o]:u=e[o],s+=this.bind(c,u,l);return s}return"object"==typeof e?(c=c.slice(r.input.length,-(a.length+3)),s+=this.bind(c,e,l)):e},bind:function(t,e,n){if(Array.isArray(e)){for(var l="",s=0,u=e.length;s<u;s++)l+=this.bind(t,e[s],n);return l}t=(t||"").toString(),e=e||{};for(var o,p,f,h,d,y,g=this,v=0,b=0,m=n&&i(n.mappings),w=!1,A="",x=!1,P=!1,j=!1,K=!1,E=n&&n.conf&&n.conf.create,O="",s=0,u=t.length;s<u;s++)if(d=t.charAt(s),"!"===d&&w&&!K)w=!1,O+=t.slice(y,s+1);else if("<"!==d||w)if(">"===d&&w){if(w=!1,h=t.slice(y,s+1),o=this.tag.exec(h),!o){w=!0;continue}if(x=o[1],A=o[2],p=o[3],j=o[4],P=this.selfClosing.test(A),K&&(x?v<=0?K=!1:--v:P||++v),!x&&!K)if(m&&m.length>0)for(var C=m.length-1;C>=0;C--){var R=!1,k=m[C],S=k.re&&p.match(k.re);if("tag"in k&&!this.attr.test(h)&&k.tag===A)h+=a(e,k,"",h);else if(h=h.replace(this.attr,function(i,l,s,u,p){var f;if(S&&k.replace!==l||b)return i;if(S||"undefined"!=typeof k.replacePartial1)return R=!0,f="undefined"!=typeof k.replacePartial2?u.replace(k.replacePartial1,k.replacePartial2):"undefined"!=typeof k.replacePartial1&&k.dataKey?u.replace(k.replacePartial1,a(e,k,u,h,l)):a(e,k,u,h,l),l+'="'+(f||"")+'"';if(!k.replace&&k.attribute===l&&(k.value===u||g.hasClass(u,k.value||m.conf.where===l)||"[object RegExp]"===c.call(k.value)&&null!==k.value.exec(u)))if(k.remove)P||b++,K=!0;else if(k.plates){var d=g.bind(k.plates,"string"==typeof k.data?a(e,{dataKey:k.data}):k.data||e,k.mapper);O+=h+g.iterate(t,d,o,A,r,n),K=!0}else{var y=f=a(e,k,u,h,l);f=h+f,Array.isArray(y)?(f=g.iterate(t,y,o,A,u,n),g.nest.push(A)):"object"==typeof y&&(f=h+g.iterate(t,y,o,A,u,n)),O+=f||"",K=!0}return i}),E&&S&&!R){var q=j?2:1,B=j?"/>":">",y=h.substr(0,h.length-q);" "===y[y.length-1]&&(y=y.substr(0,y.length-1),j&&(B=" "+B)),h=[y," ",k.replace,'="',a(e,k),'"',B].join("")}}else h.replace(this.attr,function(r,a,i,l,s){if(a===n&&n.conf.where||e[l]){var c=e[l],u=Array.isArray(c),p=u||"object"==typeof c?g.iterate(t.substr(y),c,o,A,l,n):c;u&&g.nest.push(A),O+=u?p:h+p,K=!0}});K||0!==g.nest.length?!K&&g.nest.length&&this.nest.pop():(b||(O+=h),b&&x&&--b)}else w||K||b||(O+=d);else f=!0,w=!0,y=s;return O}},l.prototype={replace:function(t,e){var r=s.call(this);return r.replacePartial1=t,r.replacePartial2=e,this},use:function(t){return s.call(this).dataKey=t,s.call(this)&&this},where:function(t){return s.call(this,!0).attribute=t,s.call(this)&&this},class:function(t){return this.where("class").is(t)},tag:function(t){return s.call(this,!0).tag=t,this},is:function(t){return s.call(this).value=t,s.call(this)&&this},has:function(t){return s.call(this).value=t,this.replace(t),s.call(this)&&this},insert:function(t){var e=s.call(this);return e.replace=e.attribute,e.dataKey=t,s.call(this)&&this},as:function(t){return s.call(this).replace=t,s.call(this)&&this},remove:function(){return s.call(this).remove=!0,s.call(this,!0)},append:function(a,i,n){var c=s.call(this);return i instanceof l&&(n=i,i=r),/<[^<]+?>/.test(a)||t.cache[a]||("document"in e&&"getElementById"in e.document?t.cache[a]=document.getElementById(a).innerHTML:t.cache[a]=require("fs").readFileSync(require("path").join(process.cwd(),a),"utf8")),c.plates=t.cache[a]||a,c.data=i,c.mapper=n,s.call(this,!0)}},l.prototype.className=l.prototype.class,l.prototype.partial=l.prototype.append,l.prototype.to=l.prototype.use,t.cache={},t.bind=function(t,e,r){var a=new u;return a.bind(t,e,r)},t.Map=l}(Plates,this);
//# sourceMappingURL=plates.min.js.map