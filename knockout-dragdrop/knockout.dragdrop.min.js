!function(t){"function"==typeof define&&define.amd?define(["knockout"],t):"object"==typeof module&&module.exports?module.exports=t(require("knockout")):t(ko)}(function(t){function e(t){t=t||{};for(var e=1;e<arguments.length;e++)if(arguments[e])for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&(t[n]=arguments[e][n]);return t}function n(t,e,n){var i=t.className.split(" "),o=i.indexOf(e);o>=0&&!n&&i.splice(o,1),o<0&&n&&i.push(e),t.className=i.join(" ")}function i(t,e){if(!t.tagName)return null;var n=document.documentElement;return(n.matches||n.matchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector).call(t,e)}function o(t,e){do{if(i(t,e))return t;t=t.parentNode}while(t);return null}function r(t){this.init(t)}function a(t,e){return t.type.indexOf("touch")>=0?t.changedTouches[0][e]:t[e]}function s(t){this.init(t),this.drop=function(e){t.drop(e,t.data)}}function d(t){this.element=t,n(this.element,"drag-element",!0),this.element.style.position="fixed",this.element.style.zIndex=9998,this.element.addEventListener("selectstart",function(){return!1},!0)}function l(t){this.element=t.element,this.name=t.name,this.dragStart=t.dragStart,this.dragEnd=t.dragEnd,this.data=t.data}function c(t,e){var n=t.getBoundingClientRect();this.element=t,this.scrollMarginHeight=Math.floor(n.height/10),this.scrollMarginWidth=Math.floor(n.width/10),this.offset={top:n.top+window.pageYOffset-document.documentElement.clientTop,left:n.left+window.pageXOffset-document.documentElement.clientLeft},this.innerHeight=n.height,this.innerWidth=n.width,this.scrollDeltaMin=5,this.scrollDeltaMax=30,this.delay=e||0,this.inZone="center",this.scrolling=!1}function u(t){if(t.accepts)return[].concat(t.accepts);if(t.name)return[t.name];throw new Error("A drop zone must specify the drag zones it accepts")}var h={},p={},m=t.utils.arrayForEach,f=t.utils.arrayFirst,g=t.utils.arrayFilter,v="ontouchstart"in document.documentElement,y=!1;r.prototype.init=function(t){this.element=t.element,this.data=t.data,this.dragEnter=t.dragEnter,this.dragOver=t.dragOver,this.dragLeave=t.dragLeave,this.active=!1,this.inside=!1,this.dirty=!1},r.prototype.refreshDomInfo=function(){if(this.hidden="none"===this.element.style.display,!this.hidden){var t=this.element.getBoundingClientRect();this.top=t.top+window.pageYOffset-document.documentElement.clientTop,this.left=t.left+window.pageXOffset-document.documentElement.clientLeft,this.width=t.width,this.height=t.height}},r.prototype.isInside=function(t,e){return!this.hidden&&(!(t<this.left||e<this.top)&&(!(this.left+this.width<t)&&!(this.top+this.height<e)))},r.prototype.update=function(t,e){this.isInside(a(t,"pageX"),a(t,"pageY"))?(this.inside||this.enter(t,e),this.dragOver&&this.dragOver(t,e,this.data)):this.leave(t)},r.prototype.enter=function(t,e){this.inside=!0,this.dragEnter?this.active=!1!==this.dragEnter(t,e,this.data):this.active=!0,this.dirty=!0},r.prototype.leave=function(t){t&&(t.target=this.element),this.inside&&this.dragLeave&&this.dragLeave(t,this.data),this.active=!1,this.inside=!1,this.dirty=!0},(s.prototype=r.prototype).updateStyling=function(){this.dirty&&(n(this.element,"drag-over",this.active),n(this.element,"drop-rejected",this.inside&&!this.active)),this.dirty=!1},d.prototype.updatePosition=function(t){this.element.style.top=t.pageY-window.pageYOffset+"px",this.element.style.left=t.pageX-window.pageXOffset+"px",this.element.style.top=a(t,"pageY")-window.pageYOffset+"px",this.element.style.left=a(t,"pageX")-window.pageXOffset+"px"},d.prototype.remove=function(){t.removeNode(this.element)},l.prototype.startDrag=function(t){if(this.dragStart&&!1===this.dragStart(this.data,t))return!1;n(document.body,"drag-active",!0)},l.prototype.drag=function(t){var e=this,n=this.name,i=h[n].concat(p[n]);m(i,function(t){t.refreshDomInfo()}),m(i,function(n){t.target=n.element,n.update(t,e.data)}),m(h[n],function(t){t.updateStyling()})},l.prototype.dropRejected=function(){var t=this.name;return!f(h[t],function(t){return t.inside})||!f(h[t],function(t){return t.active})},l.prototype.cancelDrag=function(t){this.dragEnd&&this.dragEnd(this.data,t),n(document.body,"drag-active",!1)},l.prototype.drop=function(t){var e=this.name,i=o(t.target,".drop-zone"),r=g(h[e],function(t){return t.active}),a=g(r,function(t){return t.element===i})[0];m(h[e].concat(p[e]),function(e){e.leave(t)}),m(h[e],function(t){t.updateStyling()}),a&&a.drop&&a.drop(this.data),this.dragEnd&&this.dragEnd(this.data,t),n(document.body,"drag-active",!1)},c.prototype.scroll=function(t,e){this.x=t,this.y=e,this.topLimit=this.scrollMarginHeight+this.offset.top,this.bottomLimit=this.offset.top+this.innerHeight-this.scrollMarginHeight,this.leftLimit=this.scrollMarginWidth+this.offset.left,this.rightLimit=this.offset.left+this.innerWidth-this.scrollMarginWidth;var n="";e<this.topLimit?n+="top":e>this.bottomLimit&&(n+="bottom"),t<this.leftLimit?n+="left":t>this.rightLimit&&(n+="right"),""===n&&(n="center"),this.updateZone(n)},c.prototype.enter=function(t){var e=this;this.delayTimer=setTimeout(function(){e.scrolling=!0},this.delay)},c.prototype.leave=function(t){this.scrolling=!1,clearTimeout(this.delayTimer)},c.prototype.over=function(t){var e,n=function(t){return t*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin}.bind(this);this.scrolling&&(-1!==t.indexOf("top")?(e=(this.topLimit-this.y)/this.scrollMarginHeight,this.element.scrollTop-=n(e)):-1!==t.indexOf("bottom")&&(e=(this.y-this.bottomLimit)/this.scrollMarginHeight,this.element.scrollTop+=n(e)),-1!==t.indexOf("left")?(e=(this.leftLimit-this.x)/this.scrollMarginWidth,this.element.scrollLeft-=n(e)):-1!==t.indexOf("right")&&(e=(this.x-this.rightLimit)/this.scrollMarginWidth,this.element.scrollLeft+=n(e)))},c.prototype.updateZone=function(t){this.zone!==t&&(this.leave(this.zone),this.enter(t)),this.zone=t,this.over(t)},t.utils.extend(t.bindingHandlers,{dropZone:{init:function(e,i,o,r,a){var d=t.utils.unwrapObservable(i()),l=u(d);n(e,"drop-zone",!0);var c=new s({element:e,data:d.data||a&&a.$data,drop:d.drop,dragEnter:d.dragEnter,dragOver:d.dragOver,dragLeave:d.dragLeave});l.forEach(function(t){h[t]=h[t]||[],h[t].push(c)}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){c.leave(),l.forEach(function(t){h[t].splice(h[t].indexOf(c),1)})})}},dragEvents:{init:function(e,n,i,o,a){var s=t.utils.unwrapObservable(n()),d=u(s),l=new r({element:e,data:s.data||a&&a.$data,dragEnter:s.dragEnter,dragOver:s.dragOver,dragLeave:s.dragLeave});d.forEach(function(t){p[t]=p[t]||[],p[t].push(l)}),t.utils.domNodeDisposal.addDisposeCallback(e,function(){l.leave(),d.forEach(function(t){p[t].splice(p[t].indexOf(l),1)})})}},dragZone:{init:function(i,o,r,s,c){function u(){var t=i.cloneNode(!0);i.parentNode.appendChild(t);var e=window.getComputedStyle(i,null);return t.style.height=e.getPropertyValue("height"),t.style.width=e.getPropertyValue("width"),t.style.opacity=.7,t.style.filter="alpha(opacity=70)",t}function m(){var e=document.createElement("div");document.body.appendChild(e);var n="data"in E?c.createChildContext(E.data):c;return t.renderTemplate(E.element,n,{},e),e}function f(t){t.preventDefault(),t.stopPropagation()}function g(o){function r(t){function i(t){O.drag(t);var e=O.dropRejected();e!==D&&(n(w,"drop-rejected",e),w.style.cursor=e?"no-drop":"move",D=e),b=setTimeout(function(){i(t)},100)}function r(t){return y=!1,clearTimeout(h),clearTimeout(b),L&&L.remove(),w.parentNode.removeChild(w),O.cancelDrag(t),document.removeEventListener("touchmove",p),document.removeEventListener("touchend",g),t.preventDefault(),t.stopPropagation(),!0}function p(t){return t.button>0?r(t):(clearTimeout(b),L&&L.updatePosition(t),i(t),t.preventDefault(),t.stopPropagation(),!1)}function g(t){y=!1,clearTimeout(h),clearTimeout(b),L&&L.remove(),w.parentNode.removeChild(w);var n=e({},t);return n.target=document.elementFromPoint(a(t,"clientX"),a(t,"clientY")),O.drop(n),document.removeEventListener("selectstart",f,!0),document.removeEventListener("touchmove",p),document.removeEventListener("touchend",g),t.preventDefault(),t.stopPropagation(),!1}if(document.removeEventListener("mouseup",s,!0),document.removeEventListener("touchend",s,!0),document.removeEventListener("click",s,!0),document.removeEventListener("mousemove",l,!0),document.removeEventListener("touchmove",c,!0),y)return!0;if(!1===O.startDrag(o))return t.preventDefault(),t.stopPropagation(),!1;y=!0;var L=null;void 0===E.element&&(L=new d(u()));var w=document.createElement("div");w.className="drag-overlay",w.setAttribute("unselectable","on"),w.style.zIndex=9999,w.style.position="fixed",w.style.top=0,w.style.left=0,w.style.right=0,w.style.bottom=0,w.style.cursor="move",w.style.backgroundColor="white",w.style.opacity=0,w.style.filter="alpha(opacity=0)",w.style.userSelect="none",w.style.webkitUserSelect="none",w.style.MozUserSelect="none",w.style.msUserSelect="none",w.style.OUserSelect="none",w.addEventListener("selectstart",f),document.body.appendChild(w),E.element&&(L=new d(m())),L&&L.updatePosition(o);var b=null,D=!1;v||w.addEventListener("mousedown",r),w.addEventListener("mousemove",p),document.addEventListener("touchmove",p),w.addEventListener("mouseup",g),document.addEventListener("touchend",g)}function s(t){return document.removeEventListener("mouseup",s,!0),document.removeEventListener("touchend",s,!0),document.removeEventListener("click",s,!0),document.removeEventListener("mousemove",l,!0),document.removeEventListener("touchmove",c,!0),document.removeEventListener("selectstart",f,!0),!0}function l(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;var e=a(o,"pageX")-a(t,"pageX"),n=a(o,"pageY")-a(t,"pageY");return Math.sqrt(Math.pow(e,2)+Math.pow(n,2))>w&&r(t),t.preventDefault(),t.stopPropagation(),!1}function c(t){if(t.target.tagName&&"input"===t.target.tagName.toLowerCase())return!0;var e=a(o,"pageX")-a(t,"pageX"),n=a(o,"pageY")-a(t,"pageY");Math.sqrt(Math.pow(e,2)+Math.pow(n,2))>w&&clearTimeout(h)}if(o.button>0)return!0;document.addEventListener("selectstart",f,!0),document.addEventListener("mouseup",s,!0),document.addEventListener("touchend",s,!0),document.addEventListener("click",s,!0);var h;return"touchstart"===o.type&&(h=setTimeout(function(){r(o)},t.unwrap(E.longTapDelay)),i.addEventListener("touchend",function(){clearTimeout(h)})),document.addEventListener("mousemove",l,!0),document.addEventListener("touchmove",c,!0),!0}var E=t.utils.unwrapObservable(o()),L=E.name,w="number"==typeof E.dragDistance?E.dragDistance:10;if(h[L]=h[L]||[],p[L]=p[L]||[],!L||"string"!=typeof L)throw new Error("A drag zone must specify a name");if(!E.disabled){var b=E.data||c&&c.$data,O=new l({element:i,name:L,data:b,dragStart:E.dragStart,dragEnd:E.dragEnd});void 0===E.longTapDelay&&(E.longTapDelay=500),i.addEventListener("selectstart",function(t){return!(!t.target.tagName||"input"!==t.target.tagName.toLowerCase()&&"textarea"!==t.target.tagName.toLowerCase())||(t.preventDefault(),t.stopPropagation(),!1)},!0),n(i,"draggable",!0),i.addEventListener("mousedown",g),i.addEventListener("touchstart",g),t.utils.domNodeDisposal.addDisposeCallback(i,function(){document.removeEventListener("selectstart",f,!0)})}}},scrollableOnDragOver:{init:function(e,n,i){function o(){g.scroll(h,p)}function r(t){g=new c(e,l.delay),m=setInterval(o,100)}function s(t){h=a(t,"pageX"),p=a(t,"pageY")}function d(t){clearInterval(m)}var l=t.utils.unwrapObservable(n());("string"==typeof l||Array.isArray(l))&&(l={accepts:l}),l.delay=l.delay||0;var h,p,m,f=u(l),g=null;t.bindingHandlers.dragEvents.init(e,function(){return{accepts:f,dragEnter:r,dragOver:s,dragLeave:d}})}}})});