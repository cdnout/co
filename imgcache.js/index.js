var ImgCache={version:"2.1.1",options:{debug:!1,localCacheFolder:"imgcache",useDataURI:!1,chromeQuota:10485760,usePersistentCache:!0,cacheClearSize:0,headers:{},withCredentials:!1,skipURIencoding:!1,cordovaFilesystemRoot:null,timeout:0},overridables:{hash:function(e){function O(e,t,a){for(;0<a--;)e.push(t)}function y(e,t){return e<<t|e>>>32-t}function F(e,t,a){return e^t^a}function w(e,t){var a=(65535&t)+(65535&e);return(65535&(t>>>16)+(e>>>16)+(a>>>16))<<16|65535&a}var i="0123456789abcdef";return function(e){for(var t,a=[],o=4*e.length,r=0;r<o;r++)t=e[r>>2]>>8*(3-r%4),a.push(i.charAt(t>>4&15)+i.charAt(15&t));return a.join("")}(function(e,t){var a,o,r,i,n,c,s,l,d,u,g,h=e.length,m=1732584193,f=4023233417,C=2562383102,I=271733878,L=3285377520,v=[];O(v,1518500249,20),O(v,1859775393,20),O(v,2400959708,20),O(v,3395469782,20),e[t>>5]|=128<<24-t%32,e[15+(65+t>>9<<4)]=t;for(var E=0;E<h;E+=16){a=m,o=f,r=C,i=I,n=L;for(var b=0,R=[];b<80;b++){R[b]=b<16?e[b+E]:y(R[b-3]^R[b-8]^R[b-14]^R[b-16],1);var p=(c=b<20?o&r^~o&i:b<40?F(o,r,i):b<60?o&r^o&i^r&i:F(o,r,i),s=n,l=v[b],d=R[b],u=y(a,5),void 0,(65535&(u>>>16)+(c>>>16)+(s>>>16)+(l>>>16)+(d>>>16)+((g=(65535&u)+(65535&c)+(65535&s)+(65535&l)+(65535&d))>>>16))<<16|65535&g);n=i,i=r,r=y(o,30),o=a,a=p}m=w(m,a),f=w(f,o),C=w(C,r),I=w(I,i),L=w(L,n)}return[m,f,C,I,L]}(function(e){for(var t=[],a=8*e.length,o=0;o<a;o+=8)t[o>>5]|=(255&e.charCodeAt(o/8))<<24-o%32;return t}(e).slice(),8*e.length))},log:function(e,t){"use strict";ImgCache.options.debug&&(t===LOG_LEVEL_INFO&&(e="INFO: "+e),t===LOG_LEVEL_WARNING&&(e="WARN: "+e),t===LOG_LEVEL_ERROR&&(e="ERROR: "+e),console.log(e))}},ready:!1,attributes:{}},LOG_LEVEL_INFO=1,LOG_LEVEL_WARNING=2,LOG_LEVEL_ERROR=3;!function(a){"use strict";var s={sanitizeURI:function(e){return ImgCache.options.skipURIencoding?e:(2<=e.length&&'"'===e[0]&&'"'===e[e.length-1]&&(e=e.substr(1,e.length-2)),encodeURI(e))},URI:function(e){var t=(e=e||"").match(/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/);this.scheme=t[1]||null,this.authority=t[2]||null,this.path=t[3]||null,this.query=t[4]||null,this.fragment=t[5]||null},URIGetFileName:function(e){if(e){var t=e.lastIndexOf("/");if(t)return e.substr(t+1).toLowerCase()}},URIGetPath:function(e){if(e)return s.URI(e).path.toLowerCase()},fileGetExtension:function(e){if(!e)return"";var t=(e=e.split("?")[0]).split(".").pop();return!t||4<t.length?"":t},appendPaths:function(e,t){return t=t||"",e&&""!==e?e+("/"==e[e.length-1]||0<t.length&&"/"==t[0]?"":"/")+t:(0<t.length&&"/"==t[0]?"":"/")+t},hasJqueryOrJqueryLite:function(){return ImgCache.jQuery||ImgCache.jQueryLite},isCordova:function(){return("undefined"!=typeof cordova||"undefined"!=typeof phonegap)&&"browser"!==(cordova||phonegap).platformId},isCordovaAndroid:function(){return s.isCordova()&&device&&device.platform&&0<=device.platform.toLowerCase().indexOf("android")},isCordovaWindowsPhone:function(){return s.isCordova()&&device&&device.platform&&(0<=device.platform.toLowerCase().indexOf("win32nt")||0<=device.platform.toLowerCase().indexOf("windows"))},isCordovaIOS:function(){return s.isCordova()&&device&&device.platform&&"ios"===device.platform.toLowerCase()},isCordovaAndroidOlderThan3_3:function(){return s.isCordovaAndroid()&&device.version&&(0===device.version.indexOf("2.")||0===device.version.indexOf("3.0")||0===device.version.indexOf("3.1")||0===device.version.indexOf("3.2"))},isCordovaAndroidOlderThan4:function(){return s.isCordovaAndroid()&&device.version&&(0===device.version.indexOf("2.")||0===device.version.indexOf("3."))},EntryToURL:function(e){return s.isCordovaAndroidOlderThan4()&&"function"==typeof e.toNativeURL?e.toNativeURL():"function"==typeof e.toInternalURL?e.toInternalURL():e.toURL()},EntryGetURL:function(e){return"function"==typeof e.toURL?s.EntryToURL(e):e.toURI()},EntryGetPath:function(e){return s.isCordova()?s.isCordovaIOS()?s.isCordovaAndroidOlderThan3_3()?e.fullPath:e.nativeURL:"function"==typeof e.toURL?s.EntryToURL(e):e.fullPath:e.fullPath},getCordovaStorageType:function(e){if("undefined"!=typeof LocalFileSystem){if(e&&LocalFileSystem.hasOwnProperty("PERSISTENT"))return LocalFileSystem.PERSISTENT;if(!e&&LocalFileSystem.hasOwnProperty("TEMPORARY"))return LocalFileSystem.TEMPORARY}return e?window.PERSISTENT:window.TEMPORARY}},r={trigger:function(e,t){ImgCache.jQuery?a(e).trigger(t):(!s.isCordovaWindowsPhone()&&window.CustomEvent||(window.CustomEvent=function(t,a){var o;a=a||{bubbles:!1,cancelable:!1,detail:void 0};try{(o=document.createEvent("CustomEvent")).initCustomEvent(t,a.bubbles,a.cancelable,a.detail)}catch(e){(o=document.createEvent("Event")).initEvent(t,a.bubbles,a.cancelable),o.detail=a.detail}return o}),e.dispatchEvent(new CustomEvent(t)))},removeAttribute:function(e,t){s.hasJqueryOrJqueryLite()?e.removeAttr(t):e.removeAttribute(t)},setAttribute:function(e,t,a){s.hasJqueryOrJqueryLite()?e.attr(t,a):e.setAttribute(t,a)},getAttribute:function(e,t){return s.hasJqueryOrJqueryLite()?e.attr(t):e.getAttribute(t)},getBackgroundImage:function(e){if(s.hasJqueryOrJqueryLite())return e.attr("data-old-background")?"url("+e.attr("data-old-background")+")":e.css("background-image");var t=window.getComputedStyle(e,null);return t?e.getAttribute("data-old-background")?"url("+e.getAttribute("data-old-background")+")":t.backgroundImage:void 0},setBackgroundImage:function(e,t){s.hasJqueryOrJqueryLite()?e.css("background-image",t):e.style.backgroundImage=t}},l={attributes:{},isImgCacheLoaded:function(){return!(!ImgCache.attributes.filesystem||!ImgCache.attributes.dirEntry)||(ImgCache.overridables.log("ImgCache not loaded yet! - Have you called ImgCache.init() first?",LOG_LEVEL_WARNING),!1)}};l.attributes.hasLocalStorage=!1,l.hasLocalStorage=function(){if(l.attributes.hasLocalStorage)return l.attributes.hasLocalStorage;try{var e=ImgCache.overridables.hash("imgcache_test");return localStorage.setItem(e,e),localStorage.removeItem(e),l.attributes.hasLocalStorage=!0}catch(e){return ImgCache.overridables.log("Could not write to local storage: "+e.message,LOG_LEVEL_INFO),!1}},l.setCurrentSize=function(e){ImgCache.overridables.log("current size: "+e,LOG_LEVEL_INFO),l.hasLocalStorage()&&localStorage.setItem("imgcache:"+ImgCache.options.localCacheFolder,e)},l.getCachedFilePath=function(e){return s.appendPaths(ImgCache.options.localCacheFolder,l.getCachedFileName(e))},l.getCachedFileFullPath=function(e){var t=s.EntryGetPath(ImgCache.attributes.dirEntry);return s.appendPaths(t,l.getCachedFileName(e))},l.getCachedFileName=function(e){if(e){var t=ImgCache.overridables.hash(e),a=s.fileGetExtension(s.URIGetFileName(e));return t+(a?"."+a:"")}ImgCache.overridables.log("No source given to getCachedFileName",LOG_LEVEL_WARNING)},l.setNewImgPath=function(e,t,a){r.setAttribute(e,"src",t),r.setAttribute(e,o,a)},l.createCacheDir=function(t,a){if(!ImgCache.attributes.filesystem)return ImgCache.overridables.log("Filesystem instance was not initialised",LOG_LEVEL_ERROR),void(a&&a());function o(e){ImgCache.overridables.log("Failed to get/create local cache directory: "+e.code,LOG_LEVEL_ERROR),a&&a()}ImgCache.attributes.filesystem.root.getDirectory(ImgCache.options.localCacheFolder,{create:!0,exclusive:!1},function(e){if(ImgCache.attributes.dirEntry=e,ImgCache.overridables.log("Local cache folder opened: "+s.EntryGetPath(e),LOG_LEVEL_INFO),s.isCordovaAndroid()){e.getFile(".nomedia",{create:!0,exclusive:!1},function(){ImgCache.overridables.log(".nomedia file created.",LOG_LEVEL_INFO),t&&t()},o)}else s.isCordovaWindowsPhone()||s.isCordovaIOS()&&e.setMetadata&&e.setMetadata(function(){ImgCache.overridables.log("com.apple.MobileBackup metadata set",LOG_LEVEL_INFO)},function(){ImgCache.overridables.log("com.apple.MobileBackup metadata could not be set",LOG_LEVEL_WARNING)},{"com.apple.MobileBackup":1}),t&&t();ImgCache.ready=!0,r.trigger(document,n)},o)},l.FileTransferWrapper=function(e){s.isCordova()&&(this.fileTransfer=new FileTransfer),this.filesystem=e},l.FileTransferWrapper.prototype.download=function(o,r,a,i,e){var t=ImgCache.options.headers||{},n="function"==typeof e;if(this.fileTransfer)return n&&(this.fileTransfer.onprogress=e),this.fileTransfer.download(o,r,a,i,!1,{headers:t});function c(e,t,a){ImgCache.overridables.log(e,t),a&&a({code:0,source:o,target:r})}var s=this.filesystem,l=new XMLHttpRequest;for(var d in l.open("GET",o,!0),n&&(l.onprogress=e),ImgCache.options.withCredentials&&(l.withCredentials=!0),l.timeout=ImgCache.options.timeout,l.responseType="blob",t)l.setRequestHeader(d,t[d]);l.onload=function(){!l.response||200!==l.status&&0!==l.status?c("Image "+o+" could not be downloaded - status: "+l.status,3,i):s.root.getFile(r,{create:!0},function(t){t.createWriter(function(e){e.onerror=i,e.onwriteend=function(){a(t)},e.write(l.response,i)},i)},i)},l.onerror=function(){c("XHR error - Image "+o+" could not be downloaded - status: "+l.status,3,i)},l.ontimeout=function(){c("XHR error - Image "+o+" timed out - status: "+l.status,3,i)},l.send()},l.getBackgroundImageURL=function(e){var t=r.getBackgroundImage(e);if(t){return/url\s?\((.+)\)/.exec(t)[1].replace(/(['"])/g,"")}},l.getBase64DataFromEntry=function(e,a,o,r){e.file(function(e){var t=new FileReader;t.onloadend=function(e){var t=e.target.result;t?(ImgCache.overridables.log("File "+a+" loaded from cache",LOG_LEVEL_INFO),o&&o(t)):(ImgCache.overridables.log("File in cache "+a+" is empty",LOG_LEVEL_WARNING),r&&r(a))},t.readAsDataURL(e)},function(e){ImgCache.overridables.log("Failed to read file "+e.code,LOG_LEVEL_ERROR),r&&r(a)})},l.loadCachedFile=function(a,o,r,i,n){if(l.isImgCacheLoaded())if(a){var c=s.URIGetFileName(o);ImgCache.attributes.filesystem.root.getFile(l.getCachedFilePath(o),{create:!1},function(e){if(ImgCache.options.useDataURI)l.getBase64DataFromEntry(e,c,function(e){r(a,e,o),i&&i(a)},function(){n&&n(a)});else{var t=s.EntryGetURL(e);r(a,t,o),ImgCache.overridables.log("File "+c+" loaded from cache",LOG_LEVEL_INFO),i&&i(a)}},function(){ImgCache.overridables.log("File "+c+" not in cache",LOG_LEVEL_INFO),n&&n(a)})}else ImgCache.overridables.log("First parameter of loadCachedFile is empty, should be a DOM element",LOG_LEVEL_ERROR)},l.setBackgroundImagePath=function(e,t,a){r.setBackgroundImage(e,'url("'+t+'")'),r.setAttribute(e,i,a)};var o="data-old-src",i="data-old-background",n="ImgCacheReady";ImgCache.init=function(e,t){ImgCache.jQuery=!(!window.jQuery&&!window.Zepto),ImgCache.jQueryLite=!(void 0===window.angular||!window.angular.element),ImgCache.attributes.init_callback=e,ImgCache.overridables.log("ImgCache initialising",LOG_LEVEL_INFO);function a(e){ImgCache.overridables.log("LocalFileSystem opened",LOG_LEVEL_INFO),ImgCache.attributes.filesystem=e,l.createCacheDir(function(){!function(e){0<ImgCache.options.cacheClearSize?ImgCache.getCurrentSize()>1024*ImgCache.options.cacheClearSize*1024?ImgCache.clearCache(e,e):e&&e():e&&e()}(ImgCache.attributes.init_callback)},t)}function o(e){ImgCache.overridables.log("Failed to initialise LocalFileSystem "+e.code,LOG_LEVEL_ERROR),t&&t()}if(s.isCordova()&&window.requestFileSystem)if(ImgCache.options.cordovaFilesystemRoot)try{window.resolveLocalFileSystemURL(ImgCache.options.cordovaFilesystemRoot,function(e){a({root:e})},o)}catch(e){o({code:e.message})}else window.requestFileSystem(s.getCordovaStorageType(ImgCache.options.usePersistentCache),0,a,o);else{var r=window.requestFileSystem||window.webkitRequestFileSystem;if(window.storageInfo=window.storageInfo||(ImgCache.options.usePersistentCache?navigator.webkitPersistentStorage:navigator.webkitTemporaryStorage),!window.storageInfo)return ImgCache.overridables.log("Your browser does not support the html5 File API",LOG_LEVEL_WARNING),void(t&&t());var i=ImgCache.options.chromeQuota;window.storageInfo.requestQuota(i,function(){var e=ImgCache.options.usePersistentCache?window.PERSISTENT:window.TEMPORARY;r(e,i,a,o)},function(e){ImgCache.overridables.log("Failed to request quota: "+e.message,LOG_LEVEL_ERROR),t&&t()})}},ImgCache.getCurrentSize=function(){if(l.hasLocalStorage()){var e=localStorage.getItem("imgcache:"+ImgCache.options.localCacheFolder);return null===e?0:parseInt(e,10)}return 0},ImgCache.cacheFile=function(e,t,a,o){if(l.isImgCacheLoaded()&&e){e=s.sanitizeURI(e);var r=l.getCachedFileFullPath(e);new l.FileTransferWrapper(ImgCache.attributes.filesystem).download(e,r,function(e){e.getMetadata(function(e){e&&"size"in e?(ImgCache.overridables.log("Cached file size: "+e.size,LOG_LEVEL_INFO),l.setCurrentSize(ImgCache.getCurrentSize()+parseInt(e.size,10))):ImgCache.overridables.log("No metadata size property available",LOG_LEVEL_INFO)}),ImgCache.overridables.log("Download complete: "+s.EntryGetPath(e),LOG_LEVEL_INFO),e.setMetadata&&e.setMetadata(function(){ImgCache.overridables.log("com.apple.MobileBackup metadata set",LOG_LEVEL_INFO)},function(){ImgCache.overridables.log("com.apple.MobileBackup metadata could not be set",LOG_LEVEL_WARNING)},{"com.apple.MobileBackup":1}),t&&t(e.toURL())},function(e){e.source&&ImgCache.overridables.log("Download error source: "+e.source,LOG_LEVEL_ERROR),e.target&&ImgCache.overridables.log("Download error target: "+e.target,LOG_LEVEL_ERROR),ImgCache.overridables.log("Download error code: "+e.code,LOG_LEVEL_ERROR),a&&a()},o)}},ImgCache.getCachedFile=function(t,a){if(l.isImgCacheLoaded()&&a){var e=t;t=s.sanitizeURI(t);var o=l.getCachedFilePath(t);s.isCordovaAndroid()&&0===o.indexOf("file://")&&(o=o.substr(7)),ImgCache.attributes.filesystem.root.getFile(o,{create:!1},function(e){a(t,e)},function(){a(e,null)})}},ImgCache.getCachedFileURL=function(e,a,o){ImgCache.getCachedFile(e,function(e,t){t?a(e,s.EntryGetURL(t)):o&&o(e)})},ImgCache.getCachedFileBase64Data=function(e,a,o){ImgCache.getCachedFile(e,function(t,e){e?l.getBase64DataFromEntry(e,t,function(e){a(t,e)},o):o&&o(t)})},ImgCache.isCached=function(e,a){ImgCache.getCachedFile(e,function(e,t){a(e,null!==t)})},ImgCache.useOnlineFile=function(e){if(l.isImgCacheLoaded()&&e){var t=r.getAttribute(e,o);t&&r.setAttribute(e,"src",t),r.removeAttribute(e,o)}},ImgCache.useCachedFile=function(e,t,a){if(l.isImgCacheLoaded()){var o=s.sanitizeURI(r.getAttribute(e,"src"));l.loadCachedFile(e,o,l.setNewImgPath,t,a)}},ImgCache.useCachedFileWithSource=function(e,t,a,o){if(l.isImgCacheLoaded()){var r=s.sanitizeURI(t);l.loadCachedFile(e,r,l.setNewImgPath,a,o)}},ImgCache.clearCache=function(e,t){l.isImgCacheLoaded()&&ImgCache.attributes.dirEntry.removeRecursively(function(){ImgCache.overridables.log("Local cache cleared",LOG_LEVEL_INFO),l.setCurrentSize(0),l.createCacheDir(e,t)},function(e){ImgCache.overridables.log("Failed to remove directory or its contents: "+e.code,LOG_LEVEL_ERROR),t&&t()})},ImgCache.removeFile=function(e,t,a){e=s.sanitizeURI(e);function o(e){ImgCache.overridables.log("Failed to remove file due to "+e.code,LOG_LEVEL_ERROR),a&&a()}var r=l.getCachedFilePath(e);ImgCache.attributes.filesystem.root.getFile(r,{create:!1},function(e){e.remove(function(){t&&t()},o)},o)},ImgCache.isBackgroundCached=function(e,a){var t=l.getBackgroundImageURL(e);ImgCache.getCachedFile(t,function(e,t){a(e,null!==t)})},ImgCache.cacheBackground=function(e,t,a,o){if(l.isImgCacheLoaded()){var r=l.getBackgroundImageURL(e);if(!r)return ImgCache.overridables.log("No background to cache",LOG_LEVEL_WARNING),void(a&&a());ImgCache.overridables.log("Background image URL: "+r,LOG_LEVEL_INFO),ImgCache.cacheFile(r,t,a,o)}},ImgCache.useCachedBackground=function(e,t,a){if(l.isImgCacheLoaded()){var o=l.getBackgroundImageURL(e);if(!o)return ImgCache.overridables.log("No background to cache",LOG_LEVEL_WARNING),void(a&&a());l.loadCachedFile(e,o,l.setBackgroundImagePath,t,a)}},ImgCache.useCachedBackgroundWithSource=function(e,t,a,o){l.isImgCacheLoaded()&&l.loadCachedFile(e,t,l.setBackgroundImagePath,a,o)},ImgCache.useBackgroundOnlineFile=function(e){if(e){var t=r.getAttribute(e,i);t&&r.setBackgroundImage(e,'url("'+t+'")'),r.removeAttribute(e,i)}},ImgCache.getCacheFolderURI=function(){if(l.isImgCacheLoaded())return s.EntryGetURL(ImgCache.attributes.dirEntry)},ImgCache.helpers=s,ImgCache.domHelpers=r,ImgCache.private=l,"function"==typeof define&&define.amd?define("imgcache",[],function(){return ImgCache}):"object"==typeof module&&module.exports?module.exports=ImgCache:window.ImgCache=ImgCache}(window.jQuery||window.Zepto||function(){throw"jQuery is not available"});