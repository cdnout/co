!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).IncrementalDOM={})}(this,function(e){"use strict";var i="key";var m=!1,n=!1,t=!1;function c(e){if(!e)throw new Error("Expected value to be defined");return e}function r(e){if(!t)throw new Error("Cannot call "+e+"() unless in patch.")}function l(e){if(m)throw new Error(e+"() can not be called between elementOpenStart() and elementOpenEnd().")}function u(e){if(n)throw new Error(e+"() may not be called inside an element that has called skip().")}function o(e){if(!m)throw new Error(e+"() can only be called after calling elementOpenStart().")}function g(e){t=null!=e}function y(e){var t=m;return m=e,t}function w(e){var t=n;return n=e,t}var s=Object.prototype.hasOwnProperty;function a(){}function f(){return new a}function p(e,t){for(;e.length>t;)e.pop()}a.prototype=Object.create(null);var d={default:"__default"};function h(e,t,n){if(null==n)e.removeAttribute(t);else{var r=0===(o=t).lastIndexOf("xml:",0)?"http://www.w3.org/XML/1998/namespace":0===o.lastIndexOf("xlink:",0)?"http://www.w3.org/1999/xlink":null;r?e.setAttributeNS(r,t,String(n)):e.setAttribute(t,String(n))}var o}function v(e,t,n){e[t]=n}var b=f();function x(e,t,n){(b[t]||b[d.default])(e,t,n)}b[d.default]=function(e,t,n){var r=typeof n;("object"==r||"function"==r?v:h)(e,t,n)},b.style=function(e,t,n){c("style"in e);var r,o,i,a,l,u=e.style;if("string"==typeof n)u.cssText=n;else for(var f in u.cssText="",n)a=n,l=f,s.call(a,l)&&(r=u,i=n[o=f],0<=o.indexOf("-")?r.setProperty(o,i):r[o]=i)};var O={nodesCreated:null,nodesDeleted:null},A=(S.prototype.markCreated=function(e){this.created.push(e)},S.prototype.markDeleted=function(e){this.deleted.push(e)},S.prototype.notifyChanges=function(){O.nodesCreated&&0<this.created.length&&O.nodesCreated(this.created),O.nodesDeleted&&0<this.deleted.length&&O.nodesDeleted(this.deleted)},S);function S(){this.created=[],this.deleted=[]}function E(e){return 1===e.nodeType}var C="undefined"!=typeof Node&&Node.prototype.getRootNode||function(){for(var e=this,t=e;e;)e=(t=e).parentNode;return t};function D(e,t){var n,r,o,i=(n=e,o=C.call(n),11===(r=o).nodeType||9===r.nodeType?o.activeElement:null);return i&&e.contains(i)?function(e,t){for(var n=[],r=e;r!==t;){var o=c(r);n.push(o),r=o.parentNode}return n}(i,t):[]}var _=(k.prototype.hasEmptyAttrsArr=function(){var e=this._attrsArr;return!e||!e.length},k.prototype.getAttrsArr=function(e){return this._attrsArr||(this._attrsArr=(p(t=new Array(e),0),t));var t},k);function k(e,t,n){this._attrsArr=null,this.staticsApplied=!1,this.nameOrCtor=e,this.key=t,this.text=n}function N(e,t,n,r){var o=new _(t,n,r);return e.__incrementalDOMData=o}function M(e,t){if(e.__incrementalDOMData)return e.__incrementalDOMData;var n=E(e)?e.localName:e.nodeName,r=E(e)&&null!=i?e.getAttribute(i):null,o=N(e,n,E(e)?r||t:null);return E(e)&&function(e,t){var n=e.attributes,r=n.length;if(r)for(var o=t.getAttrsArr(r),i=0,a=0;i<r;i+=1,a+=2){var l=n[i],u=l.name,f=l.value;o[a]=u,o[a+1]=f}}(e,o),o}function P(e,t){return M(e,t)}function j(e,t,n,r){var o,i,a;if("function"==typeof n)o=new n;else{var l=(a=t,"svg"===(i=n)?"http://www.w3.org/2000/svg":"math"===i?"http://www.w3.org/1998/Math/MathML":null==a||"foreignObject"===P(a).nameOrCtor?null:a.namespaceURI);o=l?e.createElementNS(l,n):e.createElement(n)}return N(o,n,r),o}function I(e,t,n,r,o){return t==n&&r==o}var T=null,B=null,L=null,R=null,K=[],q=I,z=[],U=[];function V(){return z}function W(){return U}function X(e,t,n){for(var r=e,o=t;o!==n;){var i=o.nextSibling;r.removeChild(o),T.markDeleted(o),o=i}}function F(){return B?B.nextSibling:L.firstChild}function G(){L=B,B=null}function H(){X(L,F(),null),L=(B=L).parentNode}function J(){B=F()}function Q(e,t){var n,r;return n="#text"===e?(N(r=R.createTextNode(""),"#text",null),r):j(R,L,e,t),T.markCreated(n),n}function Y(e,t){J();var n=function(e,t,n){if(!e)return null;var r,o,i,a,l=e;do{if(o=t,a=P(r=l,i=n),q(r,o,a.nameOrCtor,i,a.key))return l}while(n&&(l=l.nextSibling));return null}(B,e,t)||Q(e,t);n!==B&&(0<=K.indexOf(n)?function(e,t,n){for(var r=t.nextSibling,o=n;null!==o&&o!==t;){var i=o.nextSibling;e.insertBefore(o,r),o=i}}(L,n,B):L.insertBefore(n,B),B=n)}function Z(e,t){return Y(e,t),G(),L}function $(){return w(!1),H(),B}function ee(){return r("currentElement"),l("currentElement"),L}function te(h,e){void 0===e&&(e={});var t=e.matches,v=void 0===t?I:t;return function(e,t,n){var r,o,i=T,a=R,l=K,u=z,f=U,c=B,s=L,p=q;R=e.ownerDocument,T=new A,q=v,z=[],U=[],B=null,L=e.parentNode,K=D(e,L),r=y(!1),o=w(!1),g(T);try{var d=h(e,t,n);return function(){if(m)throw new Error("elementOpenEnd() must be called after calling elementOpenStart().")}(),d}finally{T.notifyChanges(),R=a,q=p,z=u,U=f,B=c,L=s,K=l,y(r),w(o),g(T=i)}}}function ne(e){return te(function(e,t,n){return B=e,G(),t(n),H(),function(e,t){if(e!==t){for(var n=e,r=[];n&&n!==t;)r.push(n.nodeName.toLowerCase()),n=n.parentNode;throw new Error("One or more tags were not closed:\n"+r.join("\n"))}}(B,e),e},e)}function re(e){return te(function(e,t,n){var r,o,i={nextSibling:e};return r=e.nextSibling,o=e.previousSibling,B=i,t(n),L||console.warn("patchOuter requires the node have a parent if there is a key."),function(e,t,n,r){var o=c(e),i=c(t),a=i.nextSibling===n&&i.previousSibling===r,l=i.nextSibling===o.nextSibling&&i.previousSibling===r;if(!a&&!l&&!(i===o))throw new Error("There must be exactly one top level call corresponding to the patched element.")}(i,B,r,o),L&&X(L,F(),e.nextSibling),i===B?null:B},e)}var oe=ne(),ie=re(),ae=[],le=0;function ue(e,t,n,r){ae.push(e),ae.push(t),ae.push(n),ae.push(r)}var fe=f();function ce(e,t,n,r){for(var o=!e.length,i=0;i<t.length;i+=2){var a=t[i];if(o)e[i]=a;else if(e[i]!==a)break;var l=t[i+1];!o&&e[i+1]===l||ue(r,n,a,e[i+1]=l)}if(i<t.length||i<e.length){var u=i;for(i=u;i<e.length;i+=2)fe[e[i]]=e[i+1];for(i=u;i<t.length;i+=2){var f=t[i];l=t[i+1];fe[f]!==l&&ue(r,n,f,l),e[i]=f,e[i+1]=l,delete fe[f]}for(var c in p(e,t.length),fe)ue(r,n,c,void 0),delete fe[c]}!function(){var e=le,t=ae.length;le=t;for(var n=e;n<t;n+=4){(0,ae[n])(ae[n+1],ae[n+2],ae[n+3])}p(ae,le=e)}()}var se=3,pe=f();function de(e,t){var n=W();ce(t.getAttrsArr(n.length),n,e,x),p(n,0)}function he(e,t,n){if(!t.staticsApplied&&(t.staticsApplied=!0,n&&n.length))if(t.hasEmptyAttrsArr())for(var r=0;r<n.length;r+=2)x(e,n[r],n[r+1]);else{for(r=0;r<n.length;r+=2)pe[n[r]]=r+1;var o=t.getAttrsArr(0),i=0;for(r=0;r<o.length;r+=2){var a=o[r],l=o[r+1],u=pe[a];u?n[u]===l&&delete pe[a]:(o[i]=a,o[i+1]=l,i+=2)}for(var f in p(o,i),pe)x(e,f,n[pe[f]]),delete pe[f]}}function ve(e,t,n){var r=V();l("elementOpenStart"),y(!0),r[0]=e,r[1]=t,r[2]=n}function me(e,t){var n=W();r("attr"),n.push(e),n.push(t)}function ge(){var e=V();o("elementOpenEnd"),y(!1);var t=Z(e[0],e[1]),n=P(t);return he(t,n,e[2]),de(t,n),p(e,0),t}function ye(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];l("elementOpen"),u("elementOpen"),ve(e,t,n);for(var i=se;i<arguments.length;i+=2)me(arguments[i],arguments[i+1]);return ge()}function we(e){l("elementClose");var t=$();return function(e,t){if(e!==t)throw new Error('Received a call to close "'+t+'" but "'+e+'" was open.')}(P(t).nameOrCtor,e),t}e.applyAttr=h,e.applyProp=v,e.attributes=b,e.alignWithDOM=Y,e.close=$,e.createPatchInner=ne,e.createPatchOuter=re,e.currentElement=ee,e.currentPointer=function(){return r("currentPointer"),l("currentPointer"),F()},e.open=Z,e.patch=oe,e.patchInner=oe,e.patchOuter=ie,e.skip=function(){!function(e,t){if(null!==t)throw new Error(e+"() must come before any child declarations inside the current element.")}("skip",B),w(!0),B=L.lastChild},e.skipNode=J,e.setKeyAttributeName=function(e){i=e},e.clearCache=function e(t){t.__incrementalDOMData=null;for(var n=t.firstChild;n;n=n.nextSibling)e(n)},e.getKey=function(e){return c(e.__incrementalDOMData),P(e).key},e.importNode=function e(t){M(t);for(var n=t.firstChild;n;n=n.nextSibling)e(n)},e.isDataInitialized=function(e){return Boolean(e.__incrementalDOMData)},e.notifications=O,e.symbols=d,e.applyAttrs=function(){var e=ee();de(e,P(e))},e.applyStatics=function(e){var t=ee();he(t,P(t),e)},e.attr=me,e.elementClose=we,e.elementOpen=ye,e.elementOpenEnd=ge,e.elementOpenStart=ve,e.elementVoid=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return ye.apply(null,arguments),we(e)},e.key=function(e){var t=V();o("key"),c(t),t[1]=e},e.text=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l("text"),u("text");var r=(Y("#text",null),B),o=P(r);if(o.text!==e){for(var i=o.text=e,a=1;a<arguments.length;a+=1){i=(0,arguments[a])(i)}r.data!==i&&(r.data=i)}return r},Object.defineProperty(e,"__esModule",{value:!0})});