var SubtitlesOctopus=function(e){var t,a=!1;try{"object"!=typeof WebAssembly||"function"!=typeof WebAssembly.instantiate||(t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0)))instanceof WebAssembly.Module&&(a=new WebAssembly.Instance(t)instanceof WebAssembly.Instance)}catch(e){}console.log("WebAssembly support detected: "+(a?"yes":"no"));var i=this;function r(){var e=i.renderFramesData,t=performance.now();i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);for(var a=0;a<e.canvases.length;a++){var r=e.canvases[a];i.bufferCanvas.width=r.w,i.bufferCanvas.height=r.h;var n=new Uint8ClampedArray(r.buffer);if(i.hasAlphaBug)for(var s=3;s<n.length;s+=4)n[s]=1<=n[s]?n[s]:1;var o=new ImageData(n,r.w,r.h);i.bufferCanvasCtx.putImageData(o,0,0),i.ctx.drawImage(i.bufferCanvas,r.x,r.y)}i.debug&&(t=Math.round(performance.now()-t),console.log(Math.round(e.spentTime)+" ms (+ "+t+" ms draw)"),i.renderStart=performance.now())}function n(){var e=i.renderFramesData,t=performance.now();i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);for(var a=0;a<e.bitmaps.length;a++){var r=e.bitmaps[a];i.ctx.drawImage(r.bitmap,r.x,r.y)}i.debug&&(t=Math.round(performance.now()-t),console.log(e.bitmaps.length+" bitmaps, libass: "+Math.round(e.libassTime)+"ms, decode: "+Math.round(e.decodeTime)+"ms, draw: "+t+"ms"),i.renderStart=performance.now())}i.canvas=e.canvas,i.lossyRender=e.lossyRender,i.isOurCanvas=!1,i.video=e.video,i.canvasParent=null,i.fonts=e.fonts||[],i.availableFonts=e.availableFonts||[],i.onReadyEvent=e.onReady,i.workerUrl=a?e.workerUrl||"subtitles-octopus-worker.js":e.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",i.subUrl=e.subUrl,i.subContent=e.subContent||null,i.onErrorEvent=e.onError,i.debug=e.debug||!1,i.lastRenderTime=0,i.pixelRatio=window.devicePixelRatio||1,i.timeOffset=e.timeOffset||0,i.hasAlphaBug=!1,function(){if("function"==typeof ImageData.prototype.constructor)try{return new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1)}catch(e){console.log("detected that ImageData is not constructable despite browser saying so")}var r=document.createElement("canvas").getContext("2d");window.ImageData=function(){var e,t=0;arguments[0]instanceof Uint8ClampedArray&&(e=arguments[t++]);var a=arguments[t++],t=r.createImageData(a,arguments[t]);return e&&t.data.set(e),t}}(),i.workerError=function(e){if(console.error("Worker error: ",e),i.onErrorEvent&&i.onErrorEvent(e),!i.debug)throw i.dispose(),new Error("Worker error: "+e)},i.init=function(){window.Worker?(i.worker||(i.worker=new Worker(i.workerUrl),i.worker.onmessage=i.onWorkerMessage,i.worker.onerror=i.workerError),i.workerActive=!1,i.createCanvas(),i.setVideo(e.video),i.setSubUrl(e.subUrl),i.worker.postMessage({target:"worker-init",width:i.canvas.width,height:i.canvas.height,URL:document.URL,currentScript:i.workerUrl,preMain:!0,fastRender:i.lossyRender,subUrl:i.subUrl,subContent:i.subContent,fonts:i.fonts,availableFonts:i.availableFonts,debug:i.debug})):i.workerError("worker not supported")},i.createCanvas=function(){i.canvas||(i.video?(i.isOurCanvas=!0,i.canvas=document.createElement("canvas"),i.canvas.className="libassjs-canvas",i.canvas.style.display="none",i.canvasParent=document.createElement("div"),i.canvasParent.className="libassjs-canvas-parent",i.canvasParent.appendChild(i.canvas),i.video.nextSibling?i.video.parentNode.insertBefore(i.canvasParent,i.video.nextSibling):i.video.parentNode.appendChild(i.canvasParent)):i.canvas||i.workerError("Don't know where to render: you should give video or canvas in options.")),i.ctx=i.canvas.getContext("2d"),i.bufferCanvas=document.createElement("canvas"),i.bufferCanvasCtx=i.bufferCanvas.getContext("2d"),i.bufferCanvas.width=1,i.bufferCanvas.height=1;var e=new Uint8ClampedArray([0,255,0,0]),t=new ImageData(e,1,1);i.bufferCanvasCtx.clearRect(0,0,1,1),i.ctx.clearRect(0,0,1,1);e=i.ctx.getImageData(0,0,1,1).data;i.bufferCanvasCtx.putImageData(t,0,0),i.ctx.drawImage(i.bufferCanvas,0,0);t=i.ctx.getImageData(0,0,1,1).data;i.hasAlphaBug=e[1]!=t[1],i.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")},i.setVideo=function(e){var t;i.video=e,i.video&&(t=function(){i.setCurrentTime(e.currentTime+i.timeOffset)},i.video.addEventListener("timeupdate",t,!1),i.video.addEventListener("playing",function(){i.setIsPaused(!1,e.currentTime+i.timeOffset)},!1),i.video.addEventListener("pause",function(){i.setIsPaused(!0,e.currentTime+i.timeOffset)},!1),i.video.addEventListener("seeking",function(){i.video.removeEventListener("timeupdate",t)},!1),i.video.addEventListener("seeked",function(){i.video.addEventListener("timeupdate",t,!1),i.setCurrentTime(e.currentTime+i.timeOffset)},!1),i.video.addEventListener("ratechange",function(){i.setRate(e.playbackRate)},!1),i.video.addEventListener("timeupdate",function(){i.setCurrentTime(e.currentTime+i.timeOffset)},!1),i.video.addEventListener("waiting",function(){i.setIsPaused(!0,e.currentTime+i.timeOffset)},!1),document.addEventListener("fullscreenchange",i.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",i.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",i.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",i.resizeWithTimeout,!1),window.addEventListener("resize",i.resizeWithTimeout,!1),"undefined"!=typeof ResizeObserver&&(i.ro=new ResizeObserver(i.resizeWithTimeout),i.ro.observe(i.video)),0<i.video.videoWidth?i.resize():i.video.addEventListener("loadedmetadata",function(e){e.target.removeEventListener(e.type,arguments.callee),i.resize()},!1))},i.getVideoPosition=function(){var e=i.video.videoWidth/i.video.videoHeight,t=i.video.offsetWidth,a=i.video.offsetHeight,r=t,n=a;return e<t/a?r=Math.floor(a*e):n=Math.floor(t/e),{width:r,height:n,x:(t-r)/2,y:(a-n)/2}},i.setSubUrl=function(e){i.subUrl=e},i.renderFrameData=null,i.workerActive=!1,i.frameId=0,i.onWorkerMessage=function(e){i.workerActive||(i.workerActive=!0,i.onReadyEvent&&i.onReadyEvent());var t=e.data;switch(t.target){case"stdout":console.log(t.content);break;case"console-log":console.log.apply(console,JSON.parse(t.content));break;case"console-debug":console.debug.apply(console,JSON.parse(t.content));break;case"console-info":console.info.apply(console,JSON.parse(t.content));break;case"console-warn":console.warn.apply(console,JSON.parse(t.content));break;case"console-error":console.error.apply(console,JSON.parse(t.content));break;case"stderr":console.error(t.content);break;case"window":window[t.method]();break;case"canvas":switch(t.op){case"getContext":i.ctx=i.canvas.getContext(t.type,t.attributes);break;case"resize":i.resize(t.width,t.height);break;case"renderCanvas":i.lastRenderTime<t.time&&(i.lastRenderTime=t.time,i.renderFramesData=t,window.requestAnimationFrame(r));break;case"renderFastCanvas":i.lastRenderTime<t.time&&(i.lastRenderTime=t.time,i.renderFramesData=t,window.requestAnimationFrame(n));break;case"setObjectProperty":i.canvas[t.object][t.property]=t.value;break;default:throw"eh?"}break;case"tick":i.frameId=t.id,i.worker.postMessage({target:"tock",id:i.frameId});break;case"custom":if(!i.onCustomMessage)throw"Custom message received but client onCustomMessage not implemented.";i.onCustomMessage(e);break;case"setimmediate":i.worker.postMessage({target:"setimmediate"});break;case"get-events":console.log(t.target),console.log(t.events);break;case"get-styles":console.log(t.target),console.log(t.styles);break;default:throw"what? "+t.target}},i.resize=function(e,t,a,r){var n,s=null;a=a||0,r=r||0,e&&t||!i.video||(e=(s=i.getVideoPosition()).width*i.pixelRatio,t=s.height*i.pixelRatio,n=i.canvasParent.getBoundingClientRect().top-i.video.getBoundingClientRect().top,a=s.y-n,r=s.x),e&&t?i.canvas.width==e&&i.canvas.height==t&&i.canvas.style.top==a&&i.canvas.style.left==r||(i.canvas.width=e,i.canvas.height=t,null!=s&&(i.canvasParent.style.position="relative",i.canvas.style.display="block",i.canvas.style.position="absolute",i.canvas.style.width=s.width+"px",i.canvas.style.height=s.height+"px",i.canvas.style.top=a+"px",i.canvas.style.left=r+"px",i.canvas.style.pointerEvents="none"),i.worker.postMessage({target:"canvas",width:i.canvas.width,height:i.canvas.height})):i.video||console.error("width or height is 0. You should specify width & height for resize.")},i.resizeWithTimeout=function(){i.resize(),setTimeout(i.resize,100)},i.runBenchmark=function(){i.worker.postMessage({target:"runBenchmark"})},i.customMessage=function(e,t){i.worker.postMessage({target:"custom",userData:e,preMain:(t=t||{}).preMain})},i.setCurrentTime=function(e){i.worker.postMessage({target:"video",currentTime:e})},i.setTrackByUrl=function(e){i.worker.postMessage({target:"set-track-by-url",url:e})},i.setTrack=function(e){i.worker.postMessage({target:"set-track",content:e})},i.freeTrack=function(e){i.worker.postMessage({target:"free-track"})},i.render=i.setCurrentTime,i.setIsPaused=function(e,t){i.worker.postMessage({target:"video",isPaused:e,currentTime:t})},i.setRate=function(e){i.worker.postMessage({target:"video",rate:e})},i.dispose=function(){i.worker.postMessage({target:"destroy"}),i.worker.terminate(),i.workerActive=!1,i.video&&i.video.parentNode.removeChild(i.canvasParent)},i.createEvent=function(e){i.worker.postMessage({target:"create-event",event:e})},i.getEvents=function(){i.worker.postMessage({target:"get-events"})},i.setEvent=function(e,t){i.worker.postMessage({target:"set-event",event:e,index:t})},i.removeEvent=function(e){i.worker.postMessage({target:"remove-event",index:e})},i.createStyle=function(e){i.worker.postMessage({target:"create-style",style:e})},i.getStyles=function(){i.worker.postMessage({target:"get-styles"})},i.setStyle=function(e,t){i.worker.postMessage({target:"set-style",style:e,index:t})},i.removeStyle=function(e){i.worker.postMessage({target:"remove-style",index:e})},i.init()};"function"==typeof SubtitlesOctopusOnLoad&&SubtitlesOctopusOnLoad(),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=SubtitlesOctopus);