!function(r){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],r):r(jQuery)}(function(H){"use strict";H.jgrid.extend({groupingSetup:function(){return this.each(function(){var r,e,i,t=this,o=t.p.colModel,s=t.p.groupingView,n=H.jgrid.styleUI[t.p.styleUI||"jQueryUI"].grouping;if(null===s||"object"!=typeof s&&!H.isFunction(s))t.p.grouping=!1;else if(s.plusicon||(s.plusicon=n.icon_plus),s.minusicon||(s.minusicon=n.icon_minus),s.groupField.length){for(void 0===s.visibiltyOnNextGrouping&&(s.visibiltyOnNextGrouping=[]),s.lastvalues=[],s._locgr||(s.groups=[]),s.counters=[],r=0;r<s.groupField.length;r++)s.groupOrder[r]||(s.groupOrder[r]="asc"),s.groupText[r]||(s.groupText[r]="{0}"),"boolean"!=typeof s.groupColumnShow[r]&&(s.groupColumnShow[r]=!0),"boolean"!=typeof s.groupSummary[r]&&(s.groupSummary[r]=!1),s.groupSummaryPos[r]||(s.groupSummaryPos[r]="footer"),!0===s.groupColumnShow[r]?(s.visibiltyOnNextGrouping[r]=!0,H(t).jqGrid("showCol",s.groupField[r])):(s.visibiltyOnNextGrouping[r]=H("#"+H.jgrid.jqID(t.p.id+"_"+s.groupField[r])).is(":visible"),H(t).jqGrid("hideCol",s.groupField[r]));for(s.summary=[],s.hideFirstGroupCol&&H.isArray(s.formatDisplayField)&&!H.isFunction(s.formatDisplayField[0])&&(s.formatDisplayField[0]=function(r){return r}),e=0,i=o.length;e<i;e++)s.hideFirstGroupCol&&(o[e].hidden||s.groupField[0]!==o[e].name||(o[e].formatter=function(){return""})),o[e].summaryType&&(o[e].summaryDivider?s.summary.push({nm:o[e].name,st:o[e].summaryType,v:"",sd:o[e].summaryDivider,vd:"",sr:o[e].summaryRound,srt:o[e].summaryRoundType||"round"}):s.summary.push({nm:o[e].name,st:o[e].summaryType,v:"",sr:o[e].summaryRound,srt:o[e].summaryRoundType||"round"}))}else t.p.grouping=!1})},groupingPrepare:function(d,l){return this.each(function(){for(var r,e,i,t=this.p.groupingView,o=this,s=function(){H.isFunction(this.st)?this.v=this.st.call(o,this.v,this.nm,d):(this.v=H(o).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,d),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=H(o).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,d)))},n=t.groupField.length,a=0,u=0;u<n;u++)r=t.groupField[u],i=t.displayField[u],e=d[r],null==(i=null==i?null:d[i])&&(i=e),void 0!==e&&(0===l?(t.groups.push({idx:u,dataIndex:r,value:e,displayValue:i,startRow:l,cnt:1,summary:[]}),t.lastvalues[u]=e,t.counters[u]={cnt:1,pos:t.groups.length-1,summary:H.extend(!0,[],t.summary)}):"object"==typeof e||(H.isArray(t.isInTheSameGroup)&&H.isFunction(t.isInTheSameGroup[u])?t.isInTheSameGroup[u].call(o,t.lastvalues[u],e,u,t):t.lastvalues[u]===e)?1===a?(t.groups.push({idx:u,dataIndex:r,value:e,displayValue:i,startRow:l,cnt:1,summary:[]}),t.lastvalues[u]=e,t.counters[u]={cnt:1,pos:t.groups.length-1,summary:H.extend(!0,[],t.summary)}):(t.counters[u].cnt+=1,t.groups[t.counters[u].pos].cnt=t.counters[u].cnt):(t.groups.push({idx:u,dataIndex:r,value:e,displayValue:i,startRow:l,cnt:1,summary:[]}),t.lastvalues[u]=e,a=1,t.counters[u]={cnt:1,pos:t.groups.length-1,summary:H.extend(!0,[],t.summary)}),H.each(t.counters[u].summary,s),t.groups[t.counters[u].pos].summary=t.counters[u].summary)}),this},groupingToggle:function(y){return this.each(function(){var r=this,e=r.p.groupingView,i=y.split("_"),t=parseInt(i[i.length-2],10);i.splice(i.length-2,2);function o(r){return 0<(r=H.map(r.split(" "),function(r){if(r.substring(0,u.length+1)===u+"_")return parseInt(r.substring(u.length+1),10)})).length?r[0]:void 0}var s,n,a,u=i.join("_"),d=e.minusicon,l=e.plusicon,p=H("#"+H.jgrid.jqID(y)),g=p.length?p[0].nextSibling:null,h=H("#"+H.jgrid.jqID(y)+" span.tree-wrap-"+r.p.direction),i=!1,c=!1,m=!!r.p.frozenColumns&&r.p.id+"_frozen",p=!!m&&H("#"+H.jgrid.jqID(y),"#"+H.jgrid.jqID(m)),f=p&&p.length?p[0].nextSibling:null;if(h.hasClass(d)){if(g)for(;g&&!(void 0!==(s=o(g.className))&&s<=t);)a=parseInt(H(g).attr("jqfootlevel"),10),(c=!isNaN(a)&&e.showSummaryOnHide&&a<=t)||H(g).hide(),g=g.nextSibling,m&&(c||H(f).hide(),f=f.nextSibling);h.removeClass(d).addClass(l),i=!0}else{if(g)for(n=void 0;g;){if(s=o(g.className),void 0===n&&(n=void 0===s),c=H(g).hasClass("ui-subgrid")&&H(g).hasClass("ui-sg-collapsed"),void 0!==s){if(s<=t)break;s===t+1&&(c||(H(g).show().find(">td>span.tree-wrap-"+r.p.direction).removeClass(d).addClass(l),m&&H(f).show().find(">td>span.tree-wrap-"+r.p.direction).removeClass(d).addClass(l)))}else n&&(c||(H(g).show(),m&&H(f).show()));g=g.nextSibling,m&&(f=f.nextSibling)}h.removeClass(l).addClass(d)}H(r).triggerHandler("jqGridGroupingClickGroup",[y,i]),H.isFunction(r.p.onClickGroup)&&r.p.onClickGroup.call(r,y,i)}),!1},groupingRender:function(F,G,S,I){return this.each(function(){function l(r,e,i,t,o){for(var s,n,a,u=function(r,e,i){var t,o=!1;if(0===e)o=i[r];else{var s=i[r].idx;if(0===s)o=i[r];else for(t=r;0<=t;t--)if(i[t].idx===s-e){o=i[t];break}}return o}(r,e,i),d=m.p.colModel,l=u.cnt,p="",g=!1,h=t;h<G;h++)!d[h].hidden&&!g&&o?(n=o,g=!0):n="<td "+m.formatCol(h,1,"")+">&#160;</td>",H.each(u.summary,function(){if(this.nm===d[h].name){a=d[h].summaryTpl||"{0}","string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v=this.v/this.vd:this.v&&0<l&&(this.v=this.v/l));try{this.groupCount=u.cnt,this.groupIndex=u.dataIndex,this.groupValue=u.value,s=m.formatter("",this.v,h,this)}catch(r){s=this.v}return n="<td "+m.formatCol(h,1,"")+">"+H.jgrid.template(a,s,u.cnt,u.dataIndex,u.displayValue)+"</td>",!1}}),p+=n;return p}var p,g,h,c,m=this,f=m.p.groupingView,y="",v=f.groupCollapse?f.plusicon:f.minusicon,j=[],x=f.groupField.length,w=H.jgrid.styleUI[m.p.styleUI||"jQueryUI"].common,v=v+" tree-wrap-"+m.p.direction;H.each(m.p.colModel,function(r,e){for(var i=0;i<x;i++)if(f.groupField[i]===e.name){j[i]=r;break}});var q,C=0,b=H.makeArray(f.groupSummary);b.reverse(),q=m.p.multiselect?' colspan="2"':"",H.each(f.groups,function(r,e){if(f._locgr&&!(e.startRow+e.cnt>(S-1)*I&&e.startRow<S*I))return!0;C++,g=m.p.id+"ghead_"+e.idx,p=g+"_"+r,c="<span style='cursor:pointer;margin-right:8px;margin-left:5px;' class='"+w.icon_base+" "+v+"' onclick=\"jQuery('#"+H.jgrid.jqID(m.p.id)+"').jqGrid('groupingToggle','"+p+"');return false;\"></span>";try{h=H.isArray(f.formatDisplayField)&&H.isFunction(f.formatDisplayField[e.idx])?f.formatDisplayField[e.idx].call(m,e.displayValue,e.value,m.p.colModel[j[e.idx]],e.idx,f):m.formatter(p,e.displayValue,j[e.idx],e.value)}catch(r){h=e.displayValue}var i="";if("string"!=typeof(i=H.isFunction(f.groupText[e.idx])?f.groupText[e.idx].call(m,h,e.cnt,e.summary):H.jgrid.template(f.groupText[e.idx],h,e.cnt,e.summary))&&"number"!=typeof i&&(i=h),"header"===f.groupSummaryPos[e.idx]?(y+='<tr id="'+p+'"'+(f.groupCollapse&&0<e.idx?' style="display:none;" ':" ")+'role="row" class= "'+w.content+" jqgroup ui-row-"+m.p.direction+" "+g+'">',y+=l(r,0,f.groups,q?1:0,'<td style="padding-left:'+12*e.idx+'px;"'+q+">"+c+i+"</td>"),y+="</tr>"):y+='<tr id="'+p+'"'+(f.groupCollapse&&0<e.idx?' style="display:none;" ':" ")+'role="row" class= "'+w.content+" jqgroup ui-row-"+m.p.direction+" "+g+'"><td style="padding-left:'+12*e.idx+'px;" colspan="'+(!1===f.groupColumnShow[e.idx]?G-1:G)+'">'+c+i+"</td></tr>",x-1===e.idx){var t,o,s,n,a=f.groups[r+1],u=0,i=e.startRow,d=void 0!==a?a.startRow:f.groups[r].startRow+f.groups[r].cnt;for(f._locgr&&(u=(S-1)*I)>e.startRow&&(i=u),t=i;t<d&&F[t-u];t++)y+=F[t-u].join("");if("header"!==f.groupSummaryPos[e.idx]){if(void 0!==a){for(s=0;s<f.groupField.length&&a.dataIndex!==f.groupField[s];s++);C=f.groupField.length-s}for(o=0;o<C;o++)b[o]&&(n="",f.groupCollapse&&!f.showSummaryOnHide&&(n=' style="display:none;"'),y+="<tr"+n+' jqfootlevel="'+(e.idx-o)+'" role="row" class="'+w.content+" jqfoot ui-row-"+m.p.direction+'">',y+=l(r,o,f.groups,0,!1),y+="</tr>");C=s}}}),H("#"+H.jgrid.jqID(m.p.id)+" tbody:first").append(y),y=null})},groupingGroupBy:function(t,o){return this.each(function(){var r=this;"string"==typeof t&&(t=[t]);var e,i=r.p.groupingView;for(r.p.grouping=!0,i._locgr=!1,void 0===i.visibiltyOnNextGrouping&&(i.visibiltyOnNextGrouping=[]),e=0;e<i.groupField.length;e++)!i.groupColumnShow[e]&&i.visibiltyOnNextGrouping[e]&&H(r).jqGrid("showCol",i.groupField[e]);for(e=0;e<t.length;e++)i.visibiltyOnNextGrouping[e]=H("#"+H.jgrid.jqID(r.p.id)+"_"+H.jgrid.jqID(t[e])).is(":visible");r.p.groupingView=H.extend(r.p.groupingView,o||{}),i.groupField=t,H(r).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){var r=this;if(void 0===t&&(t=!0),!(r.p.grouping=!1)===t){for(var e=r.p.groupingView,i=0;i<e.groupField.length;i++)!e.groupColumnShow[i]&&e.visibiltyOnNextGrouping[i]&&H(r).jqGrid("showCol",e.groupField);H("tr.jqgroup, tr.jqfoot","#"+H.jgrid.jqID(r.p.id)+" tbody:first").remove(),H("tr.jqgrow:hidden","#"+H.jgrid.jqID(r.p.id)+" tbody:first").show()}else H(r).trigger("reloadGrid")})},groupingCalculations:{handler:function(r,e,i,t,o,s){var n={sum:function(){return parseFloat(e||0)+parseFloat(s[i]||0)},min:function(){return""===e?parseFloat(s[i]||0):Math.min(parseFloat(e),parseFloat(s[i]||0))},max:function(){return""===e?parseFloat(s[i]||0):Math.max(parseFloat(e),parseFloat(s[i]||0))},count:function(){return""===e&&(e=0),s.hasOwnProperty(i)?e+1:0},avg:function(){return n.sum()}};if(!n[r])throw"jqGrid Grouping No such method: "+r;r=n[r]();return null!=t&&(r="fixed"===o?r.toFixed(t):(t=Math.pow(10,t),Math.round(r*t)/t)),r}},setGroupHeaders:function(q){return q=H.extend({useColSpanStyle:!1,groupHeaders:[]},q||{}),this.each(function(){var r,e,i,t,o,s,n,a,u,d,l=this,p=0,g=l.p.colModel,h=g.length,c=l.grid.headers,m=H("table.ui-jqgrid-htable",l.grid.hDiv),f=m.children("thead").children("tr.ui-jqgrid-labels:last").addClass("jqg-second-row-header"),y=m.children("thead"),v=m.find(".jqg-first-row-header"),j=!1,x=H.jgrid.styleUI[l.p.styleUI||"jQueryUI"].base;l.p.groupHeader||(l.p.groupHeader=[]),l.p.groupHeader.push(q),l.p.groupHeaderOn=!0,void 0===v[0]?v=H("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):v.empty();var w;for((H(document.activeElement).is("input")||H(document.activeElement).is("textarea"))&&(j=document.activeElement),H(l).prepend(y),H(l).prepend(y),i=H("<tr>",{role:"row"}).addClass("ui-jqgrid-labels jqg-third-row-header"),r=0;r<h;r++)if(t=c[r].el,o=H(t),e=g[r],u={height:"0px",width:c[r].width+"px",display:e.hidden?"none":""},H("<th>",{role:"gridcell"}).css(u).addClass("ui-first-th-"+l.p.direction).appendTo(v),t.style.width="",0<=(s=function(r,e){for(var i=e.length,t=0;t<i;t++)if(e[t].startColumnName===r)return t;return-1}(e.name,q.groupHeaders))){for(n=(u=q.groupHeaders[s]).numberOfColumns,w=u.titleText,u=u.className||"",s=a=0;s<n&&r+s<h;s++)g[r+s].hidden||a++;w=H("<th>").attr({role:"columnheader"}).addClass(x.headerBox+" ui-th-column-header ui-th-"+l.p.direction+" "+u).html(w),0<a&&w.attr("colspan",String(a)),l.p.headertitles&&w.attr("title",w.text()),0===a&&w.hide(),o.before(w),i.append(t),p=n-1}else 0===p?q.useColSpanStyle?(w=o.attr("rowspan")?parseInt(o.attr("rowspan"),10)+1:2,o.attr("rowspan",w)):(H("<th>",{role:"columnheader"}).addClass(x.headerBox+" ui-th-column-header ui-th-"+l.p.direction).css({display:e.hidden?"none":""}).insertBefore(o),i.append(t)):(i.append(t),p--);if((y=H(l).children("thead")).prepend(v),i.insertAfter(f),m.append(y),q.useColSpanStyle&&(m.find("span.ui-jqgrid-resize").each(function(){var r=H(this).parent();r.is(":visible")&&(this.style.cssText="height: "+r.height()+"px !important; cursor: col-resize;")}),m.find("div.ui-jqgrid-sortable").each(function(){var r=H(this),e=r.parent();e.is(":visible")&&e.is(":has(span.ui-jqgrid-resize)")&&r.css("top",(e.height()-r.outerHeight())/2-4+"px")})),d=y.find("tr.jqg-first-row-header"),H(l).on("jqGridResizeStop.setGroupHeaders",function(r,e,i){d.find("th").eq(i)[0].style.width=e+"px"}),j)try{H(j).focus()}catch(r){}""===H.trim(H("tr.jqg-second-row-header th:eq(0)").text())&&H("tr.jqg-second-row-header th:eq(0)").prepend("&nbsp;")})},destroyGroupHeader:function(p){return void 0===p&&(p=!0),this.each(function(){var r,e,i,t,o,s,n=this,a=n.grid,u=H("table.ui-jqgrid-htable thead",a.hDiv),d=n.p.colModel,l=!1;if(a){for(n.p.frozenColumns&&(H(n).jqGrid("destroyFrozenColumns"),l=!0),H(this).off(".setGroupHeaders"),n.p.groupHeaderOn=!1,r=H("<tr>",{role:"row"}).addClass("ui-jqgrid-labels"),e=0,i=(t=a.headers).length;e<i;e++){s=d[e].hidden?"none":"",o=H(t[e].el).width(H("tr.jqg-first-row-header th:eq("+e+")",u).width()).css("display",s);try{o.removeAttr("rowSpan")}catch(r){o.attr("rowSpan",1)}r.append(o),0<(s=o.children("span.ui-jqgrid-resize")).length&&(s[0].style.height=""),o.children("div")[0].style.top=""}H(u).children("tr.ui-jqgrid-labels").remove(),H(u).children("tr.jqg-first-row-header").remove(),H(u).prepend(r),!0===p&&H(n).jqGrid("setGridParam",{groupHeader:null}),l&&H(n).jqGrid("setFrozenColumns")}})},isGroupHeaderOn:function(){var r=this[0];return!0===r.p.groupHeaderOn&&r.p.groupHeader&&(H.isArray(r.p.groupHeader)||H.isFunction(r.p.groupHeader))}})});