!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.RSVP={})}(this,function(t){"use strict";function i(t){var e=t._promiseCallbacks;return e=e||(t._promiseCallbacks={})}var e={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t._promiseCallbacks=void 0,t},on:function(t,e){if("function"!=typeof e)throw new TypeError("Callback must be a function");var r=i(this),n=r[t];-1===(n=n||(r[t]=[])).indexOf(e)&&n.push(e)},off:function(t,e){var r=i(this);if(e){var n=r[t],o=n.indexOf(e);-1!==o&&n.splice(o,1)}else r[t]=[]},trigger:function(t,e,r){var n=i(this)[t];if(n)for(var o=0;o<n.length;o++)(0,n[o])(e,r)}},a={instrument:!1};function r(t,e){if(2!==arguments.length)return a[t];a[t]=e}e.mixin(a);var n=[];function c(t,e,r){1===n.push({name:t,payload:{key:e._guidKey,id:e._id,eventName:t,detail:e._result,childId:r&&r._id,label:e._label,timeStamp:Date.now(),error:a["instrument-with-stack"]?new Error(e._label):null}})&&setTimeout(function(){for(var t=0;t<n.length;t++){var e=n[t],r=e.payload;r.guid=r.key+r.id,r.childGuid=r.key+r.childId,r.error&&(r.stack=r.error.stack),a.trigger(e.name,e.payload)}n.length=0},50)}function o(t,e){if(t&&"object"==typeof t&&t.constructor===this)return t;var r=new this(l,e);return m(r,t),r}function l(){}var f=void 0,h=1,p=2,y={error:null};function s(t){try{return t.then}catch(t){return y.error=t,y}}var u=void 0;function _(){try{var t=u;return u=null,t.apply(this,arguments)}catch(t){return y.error=t,y}}function v(t){return u=t,_}function d(t,e,r){if(e.constructor===t.constructor&&r===A&&t.constructor.resolve===o)!function(e,r){r._state===h?b(e,r._result):r._state===p?(r._onError=null,g(e,r._result)):j(r,void 0,function(t){r===t?b(e,t):m(e,t)},function(t){return g(e,t)})}(t,e);else if(r===y){var n=y.error;y.error=null,g(t,n)}else"function"==typeof r?function(t,o,i){a.async(function(e){var r=!1,t=v(i).call(o,function(t){r||(r=!0,o===t?b(e,t):m(e,t))},function(t){r||(r=!0,g(e,t))},"Settle: "+(e._label||" unknown promise"));if(!r&&t===y){r=!0;var n=y.error;y.error=null,g(e,n)}},t)}(t,e,r):b(t,e)}function m(t,e){t===e?b(t,e):!function(t){var e=typeof t;return null!==t&&("object"==e||"function"==e)}(e)?b(t,e):d(t,e,s(e))}function w(t){t._onError&&t._onError(t._result),O(t)}function b(t,e){t._state===f&&(t._result=e,t._state=h,0===t._subscribers.length?a.instrument&&c("fulfilled",t):a.async(O,t))}function g(t,e){t._state===f&&(t._state=p,t._result=e,a.async(w,t))}function j(t,e,r,n){var o=t._subscribers,i=o.length;t._onError=null,o[i]=e,o[i+h]=r,o[i+p]=n,0===i&&t._state&&a.async(O,t)}function O(t){var e=t._subscribers,r=t._state;if(a.instrument&&c(r===h?"fulfilled":"rejected",t),0!==e.length){for(var n=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)n=e[s],o=e[s+r],n?E(r,n,o,i):o(i);t._subscribers.length=0}}function E(t,e,r,n){var o="function"==typeof r,i=void 0;if(i=o?v(r)(n):n,e._state!==f);else if(i===e)g(e,new TypeError("A promises callback cannot return that same promise."));else if(i===y){var s=y.error;y.error=null,g(e,s)}else o?m(e,i):t===h?b(e,i):t===p&&g(e,i)}function A(t,e,r){var n=this,o=n._state;if(o===h&&!t||o===p&&!e)return a.instrument&&c("chained",n,n),n;n._onError=null;var i=new n.constructor(l,r),s=n._result;if(a.instrument&&c("chained",n,i),o===f)j(n,i,t,e);else{var u=o===h?t:e;a.async(function(){return E(o,i,u,s)})}return i}var T=(P.prototype._init=function(t,e){var r=e.length||0;this.length=r,this._remaining=r,this._result=new Array(r),this._enumerate(e)},P.prototype._enumerate=function(t){for(var e=this.length,r=this.promise,n=0;r._state===f&&n<e;n++)this._eachEntry(t[n],n,!0);this._checkFullfillment()},P.prototype._checkFullfillment=function(){if(0===this._remaining){var t=this._result;b(this.promise,t),this._result=null}},P.prototype._settleMaybeThenable=function(e,t,r){var n=this._instanceConstructor;if(this._isUsingOwnResolve){var o=s(e);if(o===A&&e._state!==f)e._onError=null,this._settledAt(e._state,t,e._result,r);else if("function"!=typeof o)this._settledAt(h,t,e,r);else if(this._isUsingOwnPromise){var i=new n(l);d(i,e,o),this._willSettleAt(i,t,r)}else this._willSettleAt(new n(function(t){return t(e)}),t,r)}else this._willSettleAt(n.resolve(e),t,r)},P.prototype._eachEntry=function(t,e,r){null!==t&&"object"==typeof t?this._settleMaybeThenable(t,e,r):this._setResultAt(h,e,t,r)},P.prototype._settledAt=function(t,e,r,n){var o=this.promise;o._state===f&&(this._abortOnReject&&t===p?g(o,r):(this._setResultAt(t,e,r,n),this._checkFullfillment()))},P.prototype._setResultAt=function(t,e,r,n){this._remaining--,this._result[e]=r},P.prototype._willSettleAt=function(t,e,r){var n=this;j(t,void 0,function(t){return n._settledAt(h,e,t,r)},function(t){return n._settledAt(p,e,t,r)})},P);function P(t,e,r,n){this._instanceConstructor=t,this.promise=new t(l,n),this._abortOnReject=r,this._isUsingOwnPromise=t===x,this._isUsingOwnResolve=t.resolve===o,this._init.apply(this,arguments)}function S(t,e,r){this._remaining--,this._result[e]=t===h?{state:"fulfilled",value:r}:{state:"rejected",reason:r}}var R="rsvp_"+Date.now()+"-",k=0;var x=(M.prototype._onError=function(t){var e=this;a.after(function(){e._onError&&a.trigger("error",t,e._label)})},M.prototype.catch=function(t,e){return this.then(void 0,t,e)},M.prototype.finally=function(e,t){var r=this.constructor;return"function"==typeof e?this.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):this.then(e,e)},M);function M(t,e){this._id=k++,this._label=e,this._state=void 0,this._result=void 0,this._subscribers=[],a.instrument&&c("created",this),l!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof M?function(e,t){var r=!1;try{t(function(t){r||(r=!0,m(e,t))},function(t){r||(r=!0,g(e,t))})}catch(t){g(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}function C(r,n){return{then:function(t,e){return r.call(n,t,e)}}}function F(a,c){function t(){for(var t=arguments.length,e=new Array(t+1),r=!1,n=0;n<t;++n){var o=arguments[n];if(!r){if((r=N(o))===y){var i=y.error;y.error=null;var s=new x(l);return g(s,i),s}r&&!0!==r&&(o=C(r,o))}e[n]=o}var u=new x(l);return e[t]=function(t,e){t?g(u,t):void 0===c?m(u,e):!0===c?m(u,function(t){for(var e=t.length,r=new Array(e-1),n=1;n<e;n++)r[n-1]=t[n];return r}(arguments)):Array.isArray(c)?m(u,function(t,e){for(var r={},n=t.length,o=new Array(n),i=0;i<n;i++)o[i]=t[i];for(var s=0;s<e.length;s++){r[e[s]]=o[s+1]}return r}(arguments,c)):m(u,e)},r?function(e,t,r,n){return x.all(t).then(function(t){return I(e,t,r,n)})}(u,e,a,this):I(u,e,a,this)}return t.__proto__=a,t}function I(t,e,r,n){if(v(r).apply(n,e)===y){var o=y.error;y.error=null,g(t,o)}return t}function N(t){return null!==t&&"object"==typeof t&&(t.constructor===x||s(t))}function U(t,e){return x.all(t,e)}x.cast=o,x.all=function(t,e){return Array.isArray(t)?new T(this,t,!0,e).promise:this.reject(new TypeError("Promise.all must be called with an array"),e)},x.race=function(t,e){var r=new this(l,e);if(!Array.isArray(t))return g(r,new TypeError("Promise.race must be called with an array")),r;for(var n=0;r._state===f&&n<t.length;n++)j(this.resolve(t[n]),void 0,function(t){return m(r,t)},function(t){return g(r,t)});return r},x.resolve=o,x.reject=function(t,e){var r=new this(l,e);return g(r,t),r},x.prototype._guidKey=R,x.prototype.then=A;var D,K=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(q,D=T),q);function q(t,e,r){return function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,D.call(this,t,e,!1,r))}function G(t,e){return Array.isArray(t)?new K(x,t,e).promise:x.reject(new TypeError("Promise.allSettled must be called with an array"),e)}function L(t,e){return x.race(t,e)}K.prototype._setResultAt=S;var V,W=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Y,V=T),Y.prototype._init=function(t,e){this._result={},this._enumerate(e)},Y.prototype._enumerate=function(t){var e=Object.keys(t),r=e.length,n=this.promise;this._remaining=r;for(var o=void 0,i=void 0,s=0;n._state===f&&s<r;s++)i=t[o=e[s]],this._eachEntry(i,o,!0);this._checkFullfillment()},Y);function Y(t,e){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=arguments[3];return function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,V.call(this,t,e,r,n))}function $(t,e){return x.resolve(t,e).then(function(t){if(null===t||"object"!=typeof t)throw new TypeError("Promise.hash must be called with an object");return new W(x,t,e).promise})}var z,B=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(H,z=W),H);function H(t,e,r){return function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,z.call(this,t,e,!1,r))}function J(t,e){return x.resolve(t,e).then(function(t){if(null===t||"object"!=typeof t)throw new TypeError("hashSettled must be called with an object");return new B(x,t,!1,e).promise})}function Q(t){throw setTimeout(function(){throw t}),t}function X(t){var r={resolve:void 0,reject:void 0};return r.promise=new x(function(t,e){r.resolve=t,r.reject=e},t),r}B.prototype._setResultAt=S;var Z,tt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(et,Z=T),et.prototype._init=function(t,e,r,n,o){var i=e.length||0;this.length=i,this._remaining=i,this._result=new Array(i),this._mapFn=o,this._enumerate(e)},et.prototype._setResultAt=function(t,e,r,n){if(n){var o=v(this._mapFn)(r,e);o===y?this._settledAt(p,e,o.error,!1):this._eachEntry(o,e,!1)}else this._remaining--,this._result[e]=r},et);function et(t,e,r,n){return function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,Z.call(this,t,e,!0,n,r))}function rt(t,e,r){return"function"!=typeof e?x.reject(new TypeError("map expects a function as a second argument"),r):x.resolve(t,r).then(function(t){if(!Array.isArray(t))throw new TypeError("map must be called with an array");return new tt(x,t,e,r).promise})}function nt(t,e){return x.resolve(t,e)}function ot(t,e){return x.reject(t,e)}var it,st={},ut=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(at,it=tt),at.prototype._checkFullfillment=function(){if(0===this._remaining&&null!==this._result){var t=this._result.filter(function(t){return t!==st});b(this.promise,t),this._result=null}},at.prototype._setResultAt=function(t,e,r,n){if(n){this._result[e]=r;var o=v(this._mapFn)(r,e);o===y?this._settledAt(p,e,o.error,!1):this._eachEntry(o,e,!1)}else this._remaining--,r||(this._result[e]=st)},at);function at(){return function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,it.apply(this,arguments))}function ct(t,e,r){return"function"!=typeof e?x.reject(new TypeError("filter expects function as a second argument"),r):x.resolve(t,r).then(function(t){if(!Array.isArray(t))throw new TypeError("filter must be called with an array");return new ut(x,t,e,r).promise})}var lt=0,ft=void 0;function ht(t,e){wt[lt]=t,wt[lt+1]=e,2===(lt+=2)&&Pt()}var pt="undefined"!=typeof window?window:void 0,yt=pt||{},_t=yt.MutationObserver||yt.WebKitMutationObserver,vt="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),dt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function mt(){return function(){return setTimeout(bt,1)}}var wt=new Array(1e3);function bt(){for(var t=0;t<lt;t+=2){(0,wt[t])(wt[t+1]),wt[t]=void 0,wt[t+1]=void 0}lt=0}var gt,jt,Ot,Et,At,Tt,Pt=void 0;Pt=vt?(At=process.nextTick,Tt=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/),Array.isArray(Tt)&&"0"===Tt[1]&&"10"===Tt[2]&&(At=setImmediate),function(){return At(bt)}):_t?(jt=0,Ot=new _t(bt),Et=document.createTextNode(""),Ot.observe(Et,{characterData:!0}),function(){return Et.data=jt=++jt%2}):dt?((gt=new MessageChannel).port1.onmessage=bt,function(){return gt.port2.postMessage(0)}):void 0===pt&&"function"==typeof require?function(){try{var t=Function("return this")().require("vertx");return void 0!==(ft=t.runOnLoop||t.runOnContext)?function(){ft(bt)}:mt()}catch(t){return mt()}}():mt(),a.async=ht,a.after=function(t){return setTimeout(t,0)};function St(t,e){return a.async(t,e)}var Rt=nt;function kt(){a.on.apply(a,arguments)}function xt(){a.off.apply(a,arguments)}if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var Mt=window.__PROMISE_INSTRUMENTATION__;for(var Ct in r("instrument",!0),Mt)Mt.hasOwnProperty(Ct)&&kt(Ct,Mt[Ct])}var Ft={asap:ht,cast:Rt,Promise:x,EventTarget:e,all:U,allSettled:G,race:L,hash:$,hashSettled:J,rethrow:Q,defer:X,denodeify:F,configure:r,on:kt,off:xt,resolve:nt,reject:ot,map:rt,async:St,filter:ct};t.default=Ft,t.asap=ht,t.cast=Rt,t.Promise=x,t.EventTarget=e,t.all=U,t.allSettled=G,t.race=L,t.hash=$,t.hashSettled=J,t.rethrow=Q,t.defer=X,t.denodeify=F,t.configure=r,t.on=kt,t.off=xt,t.resolve=nt,t.reject=ot,t.map=rt,t.async=St,t.filter=ct,Object.defineProperty(t,"__esModule",{value:!0})});