import{ref,Properties}from"framework-utils";import{createPortal,createElement,Component,render}from"react-simple-compat";import Moveable$1,{MOVEABLE_PROPS,MOVEABLE_METHODS,MOVEABLE_EVENTS,getElementInfo as getElementInfo$1}from"react-compat-moveable";import{isObject,findIndex,camelize,isArray}from"@daybrush/utils";var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __decorate(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}var InnerMoveable=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n.state=n.props,n}return __extends(t,e),t.prototype.render=function(){return createPortal(createElement(Moveable$1,__assign({ref:ref(this,"moveable")},this.state)),this.state.parentElement)},t}(Component),PROPERTIES=MOVEABLE_PROPS,METHODS=MOVEABLE_METHODS,EVENTS=MOVEABLE_EVENTS,__assign$1=function(){return(__assign$1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __spreadArrays(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var EventEmitter=function(){function e(){this._events={}}var t=e.prototype;return t.on=function(e,t){if(isObject(e))for(var n in e)this.on(n,e[n]);else this._addEvent(e,t,{});return this},t.off=function(e,t){if(e)if(isObject(e))for(var n in e)this.off(n);else if(t){var r=this._events[e];if(r){var o=findIndex(r,function(e){return e.listener===t});o>-1&&r.splice(o,1)}}else this._events[e]=[];else this._events={};return this},t.once=function(e,t){var n=this;return t&&this._addEvent(e,t,{once:!0}),new Promise(function(t){n._addEvent(e,t,{once:!0})})},t.emit=function(e,t){var n=this;void 0===t&&(t={});var r=this._events[e];if(!e||!r)return!0;var o=!1;return t.eventType=e,t.stop=function(){o=!0},t.currentTarget=this,__spreadArrays(r).forEach(function(r){r.listener(t),r.once&&n.off(e,r.listener)}),!o},t.trigger=function(e,t){return void 0===t&&(t={}),this.emit(e,t)},t._addEvent=function(e,t,n){var r=this._events;r[e]=r[e]||[],r[e].push(__assign$1({listener:t},n))},e}(),MoveableManager=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this)||this;r.tempElement=document.createElement("div");var o=__assign({container:t||document.body},n),i={};EVENTS.forEach(function(e){i[camelize("on "+e)]=function(t){return r.trigger(e,t)}}),render(createElement(InnerMoveable,__assign({ref:ref(r,"innerMoveable"),parentElement:t},o,i)),r.tempElement);var a=o.target;return isArray(a)&&a.length>1&&r.updateRect(),r}__extends(t,e);var n=t.prototype;return n.setState=function(e,t){this.innerMoveable.setState(e,t)},n.destroy=function(){render(null,this.tempElement),this.off(),this.tempElement=null,this.innerMoveable=null},n.getMoveable=function(){return this.innerMoveable.moveable},t=__decorate([Properties(METHODS,function(e,t){e[t]||(e[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=this.getMoveable();if(r&&r[t])return r[t].apply(r,e)})}),Properties(PROPERTIES,function(e,t){Object.defineProperty(e,t,{get:function(){return this.getMoveable().props[t]},set:function(e){var n;this.setState(((n={})[t]=e,n))},enumerable:!0,configurable:!0})})],t)}(EventEmitter),Moveable=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(MoveableManager);function getElementInfo(e,t,n){return getElementInfo$1(e,t,n)}export default Moveable;export{EVENTS,METHODS,PROPERTIES,getElementInfo};