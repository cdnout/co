import{Directive,ElementRef,Input,Output,EventEmitter}from"@angular/core";import{CustomEvent}from"./custom-event-polyfill";var MaterializeDirective=function(){function e(e){this._el=e,this._params=null,this._functionName=null,this.previousValue=null,this.previousDisabled=!1,this._waitFunction={},this.changeListenerShouldBeAdded=!0,this.init=new EventEmitter,this.initialized=!1}return Object.defineProperty(e.prototype,"materializeParams",{set:function(e){this._params=e,this.performElementUpdates()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materializeActions",{set:function(e){var t=this;e.subscribe(function(e){window.setTimeout(function(){"string"==typeof e?t.performLocalElementUpdates(e):t.performLocalElementUpdates(e.action,e.params)},1)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materialize",{set:function(e){this._functionName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materializeSelectOptions",{set:function(e){},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.performElementUpdates()},e.prototype.ngOnChanges=function(e){var t=this;this.isSelect()&&setTimeout(function(){return t.performLocalElementUpdates()},10)},e.prototype.ngOnDestroy=function(){this.performElementRemotion()},e.prototype.ngDoCheck=function(){var e=this._el.nativeElement,t=$(e);if(this.isSelect()){var i=!1;e.disabled!=this.previousDisabled&&(this.previousDisabled=e.disabled,i=!0),t.attr("multiple")||e.value==this.previousValue||(this.previousValue=e.value,i=!0),i&&this.performLocalElementUpdates()}else this.isTextarea()&&e.value!=this.previousValue&&(this.previousValue=e.value,this.performElementUpdates());return!1},e.prototype.performElementRemotion=function(){if(this.isTooltip()){var e=this._el.nativeElement,t=$(e).attr("data-tooltip-id");t&&$("#"+t).remove()}},e.prototype.performElementUpdates=function(){var e=this;if(Materialize&&Materialize.updateTextFields&&Materialize.updateTextFields(),this.isSelect()&&this.changeListenerShouldBeAdded){var t=this._el.nativeElement;(p=$(t)).on("change",function(e){if(!e.originalEvent||!e.originalEvent.internalToMaterialize){var i=document.createEvent("CustomEvent");i.initCustomEvent("change",!1,!1,void 0),i.internalToMaterialize=!0,t.dispatchEvent(i)}}),this.changeListenerShouldBeAdded=!1}if(this.isAutocomplete()){var i=this._el.nativeElement;(p=$(i)).on("change",function(e){return i.dispatchEvent(CustomEvent("input"))})}if(this.isDatePicker()){var n=this._el.nativeElement,r=$(n),a=r[this._functionName].apply(r,this._params).pickadate("picker");setTimeout(function(){if(e.ngModel)a.set("select",e.ngModel);else{var t=r.val();t&&t.length>0&&a.set("select",t)}r.on("change",function(e){return n.dispatchEvent(CustomEvent("input"))})})}if(this.isTimePicker()){var o=this._el.nativeElement,s=$(o),l=s[this._functionName].apply(s,this._params).pickatime("picker");setTimeout(function(){e.ngModel?l.val(e.ngModel):l.val(s.val()),s.on("change",function(e){return o.dispatchEvent(CustomEvent("input"))})})}if(this.isChips()){var p,c=this._el.nativeElement;(p=$(c)).on("chip.add",function(e,t){return c.dispatchEvent(CustomEvent("chip.add",t))}),p.on("chip.delete",function(e,t){return c.dispatchEvent(CustomEvent("chip.delete",t))}),p.on("chip.select",function(e,t){return c.dispatchEvent(CustomEvent("chip.select",t))})}this.isTextarea()&&this._el.nativeElement.dispatchEvent(CustomEvent("autoresize",{bubbles:!0,cancelable:!1,detail:void 0})),this.performLocalElementUpdates()},e.prototype.performLocalElementUpdates=function(e,t){var i=this;void 0===e&&(e=this._functionName),void 0===t&&(t=this._params),this._waitFunction[e]||(this._waitFunction[e]=!0,$(document).ready(function(){if(i._waitFunction[e]=!1,e){var n=$(i._el.nativeElement);if(n[e])if(t){if(!(t instanceof Array))throw new Error("Params has to be an array.");n[e].apply(n,t)}else n[e]();else{if(!Materialize[e])throw new Error("Couldn't find materialize function ''"+e+"' on element or the global Materialize object.");if(t){if(!(t instanceof Array))throw new Error("Params has to be an array.");Materialize[e].apply(Materialize,t)}else Materialize[e]()}i.initialized||(i.initialized=!0,i.init.emit())}}))},e.prototype.isTooltip=function(){return this._functionName&&"tooltip"===this._functionName},e.prototype.isSelect=function(){return this._functionName&&"material_select"===this._functionName},e.prototype.isDatePicker=function(){return this._functionName&&"pickadate"===this._functionName},e.prototype.isTimePicker=function(){return this._functionName&&"pickatime"===this._functionName},e.prototype.isChips=function(){return this._functionName&&"material_chip"===this._functionName},e.prototype.isAutocomplete=function(){return this._functionName&&"autocomplete"===this._functionName},e.prototype.isTextarea=function(){return"TEXTAREA"==this._el.nativeElement.nodeName},e.prototype.enableDPButtons=function(){$(".picker__clear").removeAttr("disabled"),$(".picker__today").removeAttr("disabled"),$(".picker__close").removeAttr("disabled"),$(".picker__select--year").removeAttr("disabled"),$(".picker__select--month").removeAttr("disabled")},e}();export{MaterializeDirective};function MaterializeDirective_tsickle_Closure_declarations(){MaterializeDirective.decorators,MaterializeDirective.ctorParameters,MaterializeDirective.propDecorators,MaterializeDirective.prototype._params,MaterializeDirective.prototype._functionName,MaterializeDirective.prototype.previousValue,MaterializeDirective.prototype.previousDisabled,MaterializeDirective.prototype._waitFunction,MaterializeDirective.prototype.changeListenerShouldBeAdded,MaterializeDirective.prototype.init,MaterializeDirective.prototype.initialized,MaterializeDirective.prototype.ngModel,MaterializeDirective.prototype._el}MaterializeDirective.decorators=[{type:Directive,args:[{selector:"[materialize]"}]}],MaterializeDirective.ctorParameters=function(){return[{type:ElementRef}]},MaterializeDirective.propDecorators={init:[{type:Output}],materializeParams:[{type:Input}],materializeActions:[{type:Input}],materialize:[{type:Input}],materializeSelectOptions:[{type:Input}],ngModel:[{type:Input}]};