!function(t,o){"use strict";"function"==typeof define&&define.amd?define(o):"object"==typeof exports?module.exports=o():t.SAT=o()}(this,function(){"use strict";var t={};function a(t,o){this.x=t||0,this.y=o||0}function o(t,o){this.pos=t||new a,this.r=o||0,this.offset=new a}function r(t,o){this.pos=t||new a,this.angle=0,this.offset=new a,this.setPoints(o||[])}function h(t,o,e){this.pos=t||new a,this.w=o||0,this.h=e||0}function e(){this.a=null,this.b=null,this.overlapN=new a,this.overlapV=new a,this.clear()}t.Vector=a,(t.V=a).prototype.copy=a.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},a.prototype.clone=a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.perp=a.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},a.prototype.rotate=a.prototype.rotate=function(t){var o=this.x,e=this.y;return this.x=o*Math.cos(t)-e*Math.sin(t),this.y=o*Math.sin(t)+e*Math.cos(t),this},a.prototype.reverse=a.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},a.prototype.normalize=a.prototype.normalize=function(){var t=this.len();return 0<t&&(this.x=this.x/t,this.y=this.y/t),this},a.prototype.add=a.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},a.prototype.sub=a.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},a.prototype.scale=a.prototype.scale=function(t,o){return this.x*=t,this.y*=void 0!==o?o:t,this},a.prototype.project=a.prototype.project=function(t){var o=this.dot(t)/t.len2();return this.x=o*t.x,this.y=o*t.y,this},a.prototype.projectN=a.prototype.projectN=function(t){var o=this.dot(t);return this.x=o*t.x,this.y=o*t.y,this},a.prototype.reflect=a.prototype.reflect=function(t){var o=this.x,e=this.y;return this.project(t).scale(2),this.x-=o,this.y-=e,this},a.prototype.reflectN=a.prototype.reflectN=function(t){var o=this.x,e=this.y;return this.projectN(t).scale(2),this.x-=o,this.y-=e,this},a.prototype.dot=a.prototype.dot=function(t){return this.x*t.x+this.y*t.y},a.prototype.len2=a.prototype.len2=function(){return this.dot(this)},a.prototype.len=a.prototype.len=function(){return Math.sqrt(this.len2())},(t.Circle=o).prototype.getAABB=o.prototype.getAABB=function(){var t=this.r;return new h(this.pos.clone().add(this.offset).sub(new a(t,t)),2*t,2*t).toPolygon()},o.prototype.setOffset=o.prototype.setOffset=function(t){return this.offset=t,this},(t.Polygon=r).prototype.setPoints=r.prototype.setPoints=function(t){if(!this.points||this.points.length!==t.length){var o,e=this.calcPoints=[],r=this.edges=[],s=this.normals=[];for(o=0;o<t.length;o++){var n=t[o],p=o<t.length-1?t[o+1]:t[0];n===p||n.x!==p.x||n.y!==p.y?(e.push(new a),r.push(new a),s.push(new a)):(t.splice(o,1),o-=1)}}return this.points=t,this._recalc(),this},r.prototype.setAngle=r.prototype.setAngle=function(t){return this.angle=t,this._recalc(),this},r.prototype.setOffset=r.prototype.setOffset=function(t){return this.offset=t,this._recalc(),this},r.prototype.rotate=r.prototype.rotate=function(t){for(var o=this.points,e=o.length,r=0;r<e;r++)o[r].rotate(t);return this._recalc(),this},r.prototype.translate=r.prototype.translate=function(t,o){for(var e=this.points,r=e.length,s=0;s<r;s++)e[s].x+=t,e[s].y+=o;return this._recalc(),this},r.prototype._recalc=function(){var t,o=this.calcPoints,e=this.edges,r=this.normals,s=this.points,n=this.offset,p=this.angle,i=s.length;for(t=0;t<i;t++){var h=o[t].copy(s[t]);h.x+=n.x,h.y+=n.y,0!==p&&h.rotate(p)}for(t=0;t<i;t++){var a=o[t],u=t<i-1?o[t+1]:o[0],y=e[t].copy(u).sub(a);r[t].copy(y).perp().normalize()}return this},r.prototype.getAABB=r.prototype.getAABB=function(){for(var t=this.calcPoints,o=t.length,e=t[0].x,r=t[0].y,s=t[0].x,n=t[0].y,p=1;p<o;p++){var i=t[p];i.x<e?e=i.x:i.x>s&&(s=i.x),i.y<r?r=i.y:i.y>n&&(n=i.y)}return new h(this.pos.clone().add(new a(e,r)),s-e,n-r).toPolygon()},r.prototype.getCentroid=r.prototype.getCentroid=function(){for(var t=this.calcPoints,o=t.length,e=0,r=0,s=0,n=0;n<o;n++){var p=t[n],i=n===o-1?t[0]:t[n+1],h=p.x*i.y-i.x*p.y;e+=(p.x+i.x)*h,r+=(p.y+i.y)*h,s+=h}return new a(e/=s*=3,r/=s)},(t.Box=h).prototype.toPolygon=h.prototype.toPolygon=function(){var t=this.pos,o=this.w,e=this.h;return new r(new a(t.x,t.y),[new a,new a(o,0),new a(o,e),new a(0,e)])},(t.Response=e).prototype.clear=e.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var w=[],s=0;s<10;s++)w.push(new a);var f=[];for(s=0;s<5;s++)f.push([]);var n=new e,p=new h(new a,1e-6,1e-6).toPolygon();function v(t,o,e){for(var r=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=t.length,p=0;p<n;p++){var i=t[p].dot(o);i<r&&(r=i),s<i&&(s=i)}e[0]=r,e[1]=s}function u(t,o,e,r,s,n){var p=f.pop(),i=f.pop(),h=w.pop().copy(o).sub(t),a=h.dot(s);if(v(e,s,p),v(r,s,i),i[0]+=a,i[1]+=a,p[0]>i[1]||i[0]>p[1])return w.push(h),f.push(p),f.push(i),!0;if(n){var u,y,c=0;if(p[0]<i[0])if(n.aInB=!1,p[1]<i[1])c=p[1]-i[0],n.bInA=!1;else c=(u=p[1]-i[0])<(y=i[1]-p[0])?u:-y;else if(n.bInA=!1,p[1]>i[1])c=p[0]-i[1],n.aInB=!1;else c=(u=p[1]-i[0])<(y=i[1]-p[0])?u:-y;var l=Math.abs(c);l<n.overlap&&(n.overlap=l,n.overlapN.copy(s),c<0&&n.overlapN.reverse())}return w.push(h),f.push(p),f.push(i),!1}function A(t,o){var e=t.len2(),r=o.dot(t);return r<0?P:e<r?I:i}t.isSeparatingAxis=u;var P=-1,i=0,I=1;function y(t,o,e){for(var r=w.pop().copy(o.pos).add(o.offset).sub(t.pos),s=o.r,n=s*s,p=t.calcPoints,i=p.length,h=w.pop(),a=w.pop(),u=0;u<i;u++){var y=u===i-1?0:u+1,c=0===u?i-1:u-1,l=0,f=null;h.copy(t.edges[u]),a.copy(r).sub(p[u]),e&&a.len2()>n&&(e.aInB=!1);var v=A(h,a);if(v===P){h.copy(t.edges[c]);var x=w.pop().copy(r).sub(p[c]);if((v=A(h,x))===I){if(s<(b=a.len()))return w.push(r),w.push(h),w.push(a),w.push(x),!1;e&&(e.bInA=!1,f=a.normalize(),l=s-b)}w.push(x)}else if(v===I){if(h.copy(t.edges[y]),a.copy(r).sub(p[y]),(v=A(h,a))===P){if(s<(b=a.len()))return w.push(r),w.push(h),w.push(a),!1;e&&(e.bInA=!1,f=a.normalize(),l=s-b)}}else{var g=h.perp().normalize(),b=a.dot(g),d=Math.abs(b);if(0<b&&s<d)return w.push(r),w.push(g),w.push(a),!1;e&&(f=g,l=s-b,(0<=b||l<2*s)&&(e.bInA=!1))}f&&e&&Math.abs(l)<Math.abs(e.overlap)&&(e.overlap=l,e.overlapN.copy(f))}return e&&(e.a=t,e.b=o,e.overlapV.copy(e.overlapN).scale(e.overlap)),w.push(r),w.push(h),w.push(a),!0}function c(t,o,e){for(var r=t.calcPoints,s=r.length,n=o.calcPoints,p=n.length,i=0;i<s;i++)if(u(t.pos,o.pos,r,n,t.normals[i],e))return!1;for(i=0;i<p;i++)if(u(t.pos,o.pos,r,n,o.normals[i],e))return!1;return e&&(e.a=t,e.b=o,e.overlapV.copy(e.overlapN).scale(e.overlap)),!0}return t.pointInCircle=function(t,o){var e=w.pop().copy(t).sub(o.pos).sub(o.offset),r=o.r*o.r,s=e.len2();return w.push(e),s<=r},t.pointInPolygon=function(t,o){p.pos.copy(t),n.clear();var e=c(p,o,n);return e=e&&n.aInB},t.testCircleCircle=function(t,o,e){var r=w.pop().copy(o.pos).add(o.offset).sub(t.pos).sub(t.offset),s=t.r+o.r,n=s*s,p=r.len2();if(n<p)return w.push(r),!1;if(e){var i=Math.sqrt(p);e.a=t,e.b=o,e.overlap=s-i,e.overlapN.copy(r.normalize()),e.overlapV.copy(r).scale(e.overlap),e.aInB=t.r<=o.r&&i<=o.r-t.r,e.bInA=o.r<=t.r&&i<=t.r-o.r}return w.push(r),!0},t.testPolygonCircle=y,t.testCirclePolygon=function(t,o,e){var r=y(o,t,e);if(r&&e){var s=e.a,n=e.aInB;e.overlapN.reverse(),e.overlapV.reverse(),e.a=e.b,e.b=s,e.aInB=e.bInA,e.bInA=n}return r},t.testPolygonPolygon=c,t});