Lawnchair.adapter("chrome-storage",function(){function n(e){return{key:e+"._index_",all:function(n){function i(){var e=JSON.stringify([]),t={};return t[a.key]=e,l.set(t),e=JSON.parse(e)}var a=this;l.get(this.key,function(e){var t;if(0<Object.keys(e).length)for(itemKey in e)null==(t=(t=e[itemKey])&&JSON.parse(t))&&(t=i()),n&&n(t);else t=i(),n(t)})},add:function(n){this.all(function(e){e.push(n);var t={};t[this.key]=JSON.stringify(e),l.set(t)})},del:function(a){var r=[];this.all(function(e){for(var t=0,n=e.length;t<n;t++)e[t]!=a&&r.push(e[t]);var i={};i[this.key]=JSON.stringify(r),l.set(i)})},find:function(i,a){this.all(function(e){for(var t=0,n=e.length;t<n;t++)i===e[t]&&a&&a(t);a&&a(!1)})}}}var l=chrome.storage.local;return{valid:function(){return!!l&&function(){var t=!0,e=""+(e=Math.random());try{var n={};n[e]=e,l.set(n)}catch(e){t=!1}return l.remove(e),t}()},init:function(e,t){this.indexer=n(this.name),t&&this.fn(this.name,t).call(this,this)},save:function(e,t){var n=e.key?this.name+"."+e.key:this.name+"."+this.uuid();!1===this.indexer.find(n)&&this.indexer.add(n),delete e.key;var i={};return i[n]=JSON.stringify(e),l.set(i),e.key=n.slice(this.name.length+1),t&&this.lambda(t).call(this,e),this},batch:function(e,t){for(var n=[],i=0,a=e.length;i<a;i++)this.save(e[i],function(e){n.push(e)});return t&&this.lambda(t).call(this,n),this},keys:function(t){var n,i,a;return t&&(i=(n=this).name,this.indexer.all(function(e){a=e.map(function(e){return e.replace(i+".","")}),n.fn("keys",t).call(n,a)})),this},get:function(e,t){var n,i=this;if(this.isArray(e))for(var a=[],r=0,s=e.length;r<s;r++){var h=this.name+"."+e[r];l.get(h,function(e){if(e)for(itemKey in e)n=e[itemKey],(n=JSON.parse(n)).key=itemKey.replace(i.name+".",""),a.push(n);r==s&&t&&i.lambda(t).call(i,a)})}else{h=this.name+"."+e;l.get(h,function(e){if(e)for(itemKey in e)n=e[itemKey],(n=JSON.parse(n)).key=itemKey.replace(i.name+".","");t&&i.lambda(t).call(i,n)})}return this},exists:function(e,t){var n=this;return this.indexer.find(this.name+"."+e,function(e){e=!1!==e,n.lambda(t).call(n,e)}),this},all:function(s){var h=this;return this.indexer.all(function(e){var t,n,i=[];if(0<e.length)for(var a=0,r=e.length;a<r;a++)l.get(e[a],function(e){for(n in e)(t=JSON.parse(e[n])).key=n.replace(h.name+".",""),i.push(t);a==r&&s&&h.fn(h.name,s).call(h,i)});else s&&h.fn(h.name,s).call(h,i)}),this},remove:function(e,t){var n=this.name+"."+(e.key?e.key:e);return this.indexer.del(n),l.remove(n),t&&this.lambda(t).call(this),this},nuke:function(i){return this.all(function(e){for(var t=0,n=e.length;t<n;t++)e[t]=""+e[t],this.remove(e[t]);i&&this.lambda(i).call(this)}),this}}}());