Lawnchair.adapter("indexed-db",function(){function d(t,n){console.error("error in indexed-db adapter!",t,n)}function a(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB}function t(){return window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.oIDBTransaction||window.msIDBTransaction}var c=t()&&"READ_WRITE"in t()?t().READ_WRITE:"readwrite";return{valid:function(){return!!a()},init:function(n,e){this.idb=a(),this.waiting=[],this.useAutoIncrement=!!window.indexedDB;var o=this.idb.open(this.name,3),i=this,t=i.fn(i.name,e);if(t&&"function"!=typeof t)throw"callback not valid";function r(){return o.onupgradeneeded=o.onsuccess=o.error=null,t&&t.call(i,i)}function s(t,n){try{i.db.deleteObjectStore("teststore")}catch(t){}try{i.db.deleteObjectStore(i.record)}catch(t){}var e={};i.useAutoIncrement&&(e.autoIncrement=!0),i.db.createObjectStore(i.record,e),i.store=!0}o.onupgradeneeded=function(t){i.db=o.result,i.transaction=o.transaction,s(t.oldVersion,t.newVersion)},o.onsuccess=function(t){if(i.db=t.target.result,"3"!=i.db.version){i.db.version;var e=i.db.setVersion("3");e.onsuccess=function(t){var n=e.result;e.onsuccess=e.onerror=null,s(),n.oncomplete=function(){for(var t=0;t<i.waiting.length;t++)i.waiting[t].call(i);i.waiting=[],r()}},e.onerror=function(t){e.onsuccess=e.onerror=null,console.error("Failed to create objectstore "+t),d(t)}}else{i.store=!0;for(var n=0;n<i.waiting.length;n++)i.waiting[n].call(i);i.waiting=[],r()}},o.onerror=function(t){if(o.errorCode===(window.IDBDatabaseException||window.webkitIDBDatabaseException||window.mozIDBDatabaseException||window.oIDBDatabaseException||window.msIDBDatabaseException).VERSION_ERR)return i.idb.deleteDatabase(i.name),i.init(n,e);console.error("Failed to open database")}},save:function(n,e){var o=this;if(this.store){for(var i=(this.isArray(n)?n:[n]).map(function(t){return t.key||(t.key=o.uuid()),t}),t=this.db.transaction(this.record,c).objectStore(this.record),r=0;r<i.length;r++){var s=i[r];t.put(s,s.key)}return t.transaction.oncomplete=function(t){e&&o.lambda(e).call(o,o.isArray(n)?i:i[0])},t.transaction.onabort=d,this}this.waiting.push(function(){this.save(n,e)})},batch:function(t,n){return this.save(t,n)},get:function(e,o){if(this.store){var i=this;if(this.isArray(e)){function t(n){i.get(a[n],function(t){r[n]=t,0<--s||o&&i.lambda(o).call(i,r)})}for(var r=[],s=e.length,a=e,n=0,c=a.length;n<c;n++)t(n)}else{var u=this.db.transaction(this.record).objectStore(this.record).get(e);u.onsuccess=function(t){var n;u.onsuccess=u.onerror=null,n=t.target.result,o&&(n&&(n.key=e),i.lambda(o).call(i,n))},u.onerror=function(t){u.onsuccess=u.onerror=null,d(t)}}return this}this.waiting.push(function(){this.get(e,o)})},exists:function(t,n){if(this.store){var e=this,o=this.db.transaction(e.record).objectStore(this.record).openCursor((window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.oIDBKeyRange||window.msIDBKeyRange).only(t));return o.onsuccess=function(t){o.onsuccess=o.onerror=null,e.lambda(n).call(e,null!==t.target.result&&void 0!==t.target.result)},o.onerror=function(t){o.onsuccess=o.onerror=null,d(t)},this}this.waiting.push(function(){this.exists(t,n)})},all:function(t){if(this.store){var e=this.fn(this.name,t)||void 0,o=this,n=this.db.transaction(this.record).objectStore(this.record),i=[];return n.openCursor().onsuccess=function(t){var n=t.target.result;n?(i.push(n.value),n.continue()):e&&e.call(o,i)},this}this.waiting.push(function(){this.all(t)})},keys:function(t){if(this.store){var e=this.fn(this.name,t)||void 0,o=this,n=this.db.transaction(this.record).objectStore(this.record),i=[];return n.openCursor().onsuccess=function(t){var n=t.target.result;n?(i.push(n.key),n.continue()):e&&e.call(o,i)},this}this.waiting.push(function(){this.keys(t)})},remove:function(t,n){if(this.store){var e=this,o=t;this.isArray(t)||(o=[t]);for(var i=this.db.transaction(this.record,c).objectStore(this.record),r=t.key?t.key:t,s=0;s<o.length;s++){r=o[s].key?o[s].key:o[s];i.delete(r)}return i.transaction.oncomplete=function(){n&&e.lambda(n).call(e)},i.transaction.onabort=d,this}this.waiting.push(function(){this.remove(t,n)})},nuke:function(t){if(this.store){var n=this,e=t?function(){n.lambda(t).call(n)}:function(){};try{var o=this.db.transaction(this.record,c).objectStore(this.record);o.clear(),o.transaction.oncomplete=e,o.transaction.onabort=d}catch(t){"NotFoundError"==t.name?e():d(t)}return this}this.waiting.push(function(){this.nuke(t)})}}}());