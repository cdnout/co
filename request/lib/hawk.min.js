"use strict";var crypto=require("crypto");function randomString(a){var e=6*(a+1);return crypto.randomBytes(Math.ceil(e/8)).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"").slice(0,a)}function calculatePayloadHash(a,e,t){var r=crypto.createHash(e);return r.update("hawk.1.payload\n"),r.update((t?t.split(";")[0].trim().toLowerCase():"")+"\n"),r.update(a||""),r.update("\n"),r.digest("base64")}exports.calculateMac=function(a,e){var t="hawk.1.header\n"+e.ts+"\n"+e.nonce+"\n"+(e.method||"").toUpperCase()+"\n"+e.resource+"\n"+e.host.toLowerCase()+"\n"+e.port+"\n"+(e.hash||"")+"\n";return e.ext&&(t+=e.ext.replace("\\","\\\\").replace("\n","\\n")),t+="\n",e.app&&(t=t+e.app+"\n"+(e.dlg||"")+"\n"),crypto.createHmac(a.algorithm,a.key).update(t).digest("base64")},exports.header=function(a,e,t){var r=t.timestamp||Math.floor((Date.now()+(t.localtimeOffsetMsec||0))/1e3),o=t.credentials;if(!(o&&o.id&&o.key&&o.algorithm))return"";if(-1===["sha1","sha256"].indexOf(o.algorithm))return"";var n={ts:r,nonce:t.nonce||randomString(6),method:e,resource:a.pathname+(a.search||""),host:a.hostname,port:a.port||("http:"===a.protocol?80:443),hash:t.hash,ext:t.ext,app:t.app,dlg:t.dlg};n.hash||!t.payload&&""!==t.payload||(n.hash=calculatePayloadHash(t.payload,o.algorithm,t.contentType));var p=exports.calculateMac(o,n),c=null!==n.ext&&void 0!==n.ext&&""!==n.ext,s='Hawk id="'+o.id+'", ts="'+n.ts+'", nonce="'+n.nonce+(n.hash?'", hash="'+n.hash:"")+(c?'", ext="'+n.ext.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'", mac="'+p+'"';return n.app&&(s=s+', app="'+n.app+(n.dlg?'", dlg="'+n.dlg:"")+'"'),s};