!function(t){"object"==typeof module&&module.exports?module.exports=t:t(Highcharts)}(function(t){"use strict";var e=t.each,o=t.pick,n=t.seriesTypes,a=void 0!==document.createElement("a").download;function i(e,o,n,i,r){var s,l,c,p=((e.options.exporting||{}).csv||{}).url||"http://www.highcharts.com/studies/csv-export/download.php";c=e.options.exporting.filename?e.options.exporting.filename:e.title?e.title.textStr.replace(/ /g,"-").toLowerCase():"chart",window.Blob&&window.navigator.msSaveOrOpenBlob?(l=new Blob([i]),window.navigator.msSaveOrOpenBlob(l,c+"."+n)):a?((s=document.createElement("a")).href=o,s.target="_blank",s.download=c+"."+n,e.container.append(s),s.click(),s.remove()):t.post(p,{data:i,type:r,extension:n})}t.setOptions({lang:{downloadCSV:"Download CSV",downloadXLS:"Download XLS",viewData:"View data table"}}),t.Chart.prototype.getDataRows=function(){var n,a,i,r,s=(this.options.exporting||{}).csv||{},l=this.xAxis[0],c={},p=[],x=[],d=s.dateFormat||"%Y-%m-%d %H:%M:%S",m=s.columnHeaderFormatter||function(e,o,n){return e instanceof t.Axis?e.options.title&&e.options.title.text||(e.isDatetimeAxis?"DateTime":"Category"):e.name+(n>1?" ("+o+")":"")};a=0,e(this.series,function(t){var n,i=t.options.keys||t.pointArrayMap||["y"],r=i.length,s=t.requireSorting,l={};if(e(i,function(e){l[e]=t[e+"Axis"]&&t[e+"Axis"].categories||[]}),!1!==t.options.includeInCSVExport&&!1!==t.visible){for(n=0;n<r;)x.push(m(t,i[n],i.length)),n+=1;e(t.points,function(e,p){var x,d,m=s?e.x:p;for(n=0,c[m]||(c[m]=[]),c[m].x=e.x,t.xAxis&&"name"!==t.exportKey||(c[m].name=e.name);n<r;)d=e[x=i[n]],c[m][a+n]=o(l[x][d],d),n+=1}),a+=n}});for(i in c)c.hasOwnProperty(i)&&p.push(c[i]);return p.sort(function(t,e){return t.x-e.x}),r=m(l),n=[[r].concat(x)],e(p,function(e){var a=e.name;a||(l.isDatetimeAxis?(e.x instanceof Date&&(e.x=e.x.getTime()),a=t.dateFormat(d,e.x)):a=l.categories?o(l.names[e.x],l.categories[e.x],e.x):e.x),e.unshift(a),n.push(e)}),n},t.Chart.prototype.getCSV=function(t){var o="",n=this.getDataRows(),a=(this.options.exporting||{}).csv||{},i=a.itemDelimiter||",",r=a.lineDelimiter||"\n";return e(n,function(e,a){for(var s="",l=e.length,c=t?1.1.toLocaleString()[1]:".";l--;)"string"==typeof(s=e[l])&&(s='"'+s+'"'),"number"==typeof s&&","===c&&(s=s.toString().replace(".",",")),e[l]=s;o+=e.join(i),a<n.length-1&&(o+=r)}),o},t.Chart.prototype.getTable=function(t){var o="<table><thead>",n=this.getDataRows();return e(n,function(e,n){var a,i,r=n?"td":"th",s=t?1.1.toLocaleString()[1]:".";for(o+="<tr>",i=0;i<e.length;i+=1)"number"==typeof(a=e[i])?(a=a.toString(),","===s&&(a=a.replace(".",s)),o+="<"+r+' class="number">'+a+"</"+r+">"):o+="<"+r+">"+(void 0===a?"":a)+"</"+r+">";o+="</tr>",n||(o+="</thead><tbody>")}),o+="</tbody></table>",console.log(o),o},t.Chart.prototype.downloadCSV=function(){var t=this.getCSV(!0);i(this,"data:text/csv,\ufeff"+encodeURIComponent(t),"csv",t,"text/csv")},t.Chart.prototype.downloadXLS=function(){var t,e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Ark1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>td{border:none;font-family: Calibri, sans-serif;} .number{mso-number-format:"0.00";}</style><meta name=ProgId content=Excel.Sheet><meta charset=UTF-8></head><body>'+this.getTable(!0)+"</body></html>";i(this,"data:application/vnd.ms-excel;base64,"+(t=e,window.btoa(unescape(encodeURIComponent(t)))),"xls",e,"application/vnd.ms-excel")},t.Chart.prototype.viewData=function(){this.dataTableDiv||(this.dataTableDiv=document.createElement("div"),this.dataTableDiv.className="highcharts-data-table",this.renderTo.parentNode.insertBefore(this.dataTableDiv,this.renderTo.nextSibling)),this.dataTableDiv.innerHTML=this.getTable()},t.getOptions().exporting&&t.getOptions().exporting.buttons.contextButton.menuItems.push({textKey:"downloadCSV",onclick:function(){this.downloadCSV()}},{textKey:"downloadXLS",onclick:function(){this.downloadXLS()}},{textKey:"viewData",onclick:function(){this.viewData()}}),n.map&&(n.map.prototype.exportKey="name"),n.mapbubble&&(n.mapbubble.prototype.exportKey="name")});