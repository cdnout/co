!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("route-recognizer",e):t.RouteRecognizer=e()}(this,function(){"use strict";var e=Object.create;function r(){var t=e(null);return t.__=void 0,delete t.__,t}var i=function(t,e,r){this.path=t,this.matcher=e,this.delegate=r};i.prototype.to=function(t,e){var r=this.delegate;if(r&&r.willAddRoute&&(t=r.willAddRoute(this.matcher.target,t)),this.matcher.add(this.path,t),e){if(0===e.length)throw new Error("You must have an argument in the function passed to `to`");this.matcher.addChild(this.path,t,e,this.delegate)}};function s(t){this.routes=r(),this.children=r(),this.target=t}function h(n,o,a){return function(t,e){var r=n+t;if(!e)return new i(r,o,a);e(h(r,o,a))}}function p(t,e,r){for(var n=0,o=0;o<t.length;o++)n+=t[o].path.length;var a={path:e=e.substr(n),handler:r};t.push(a)}s.prototype.add=function(t,e){this.routes[t]=e},s.prototype.addChild=function(t,e,r,n){var o=new s(e),a=h(t,this.children[t]=o,n);n&&n.contextEntered&&n.contextEntered(e,a),r(a)};function d(t){return t.split("/").map(c).join("/")}var n=/%|\//g;function c(t){return t.length<3||-1===t.indexOf("%")?t:decodeURIComponent(t).replace(n,encodeURIComponent)}var o=/%(?:2(?:4|6|B|C)|3(?:B|D|A)|40)/g;function a(t){return encodeURIComponent(t).replace(o,decodeURIComponent)}var u=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,l=Array.isArray,f=Object.prototype.hasOwnProperty;function v(t,e){if("object"!=typeof t||null===t)throw new Error("You must pass an object as the second argument to `generate`.");if(!f.call(t,e))throw new Error("You must provide param `"+e+"` to `generate`.");var r=t[e],n="string"==typeof r?r:""+r;if(0===n.length)throw new Error("You must provide a param `"+e+"`.");return n}var g=[];g[0]=function(t,e){for(var r=e,n=t.value,o=0;o<n.length;o++){var a=n.charCodeAt(o);r=r.put(a,!1,!1)}return r},g[1]=function(t,e){return e.put(47,!0,!0)},g[2]=function(t,e){return e.put(-1,!1,!0)},g[4]=function(t,e){return e};var y=[];y[0]=function(t){return t.value.replace(u,"\\$1")},y[1]=function(){return"([^/]+)"},y[2]=function(){return"(.+)"},y[4]=function(){return""};var m=[];m[0]=function(t){return t.value},m[1]=function(t,e){var r=v(e,t.value);return R.ENCODE_AND_DECODE_PATH_SEGMENTS?a(r):r},m[2]=function(t,e){return v(e,t.value)},m[4]=function(){return""};var E=Object.freeze({}),S=Object.freeze([]);function w(t,e,r){0<e.length&&47===e.charCodeAt(0)&&(e=e.substr(1));for(var n=e.split("/"),o=void 0,a=void 0,i=0;i<n.length;i++){var s,h=n[i],u=0;12&(s=2<<(u=""===h?4:58===h.charCodeAt(0)?1:42===h.charCodeAt(0)?2:0))&&(h=h.slice(1),(o=o||[]).push(h),(a=a||[]).push(0!=(4&s))),14&s&&r[u]++,t.push({type:u,value:c(h)})}return{names:o||S,shouldDecodes:a||S}}function A(t,e,r){return t.char===e&&t.negate===r}function C(t,e,r,n,o){this.states=t,this.id=e,this.char=r,this.negate=n,this.nextStates=o?e:null,this.pattern="",this._regex=void 0,this.handlers=void 0,this.types=void 0}function _(t,e){return t.negate?t.char!==e&&-1!==t.char:t.char===e||-1===t.char}function x(t,e){for(var r=[],n=0,o=t.length;n<o;n++){var a=t[n];r=r.concat(a.match(e))}return r}C.prototype.regex=function(){return this._regex||(this._regex=new RegExp(this.pattern)),this._regex},C.prototype.get=function(t,e){var r=this.nextStates;if(null!==r)if(l(r))for(var n=0;n<r.length;n++){var o=this.states[r[n]];if(A(o,t,e))return o}else{var a=this.states[r];if(A(a,t,e))return a}},C.prototype.put=function(t,e,r){var n;if(n=this.get(t,e))return n;var o=this.states;return n=new C(o,o.length,t,e,r),o[o.length]=n,null==this.nextStates?this.nextStates=n.id:l(this.nextStates)?this.nextStates.push(n.id):this.nextStates=[this.nextStates,n.id],n},C.prototype.match=function(t){var e=this.nextStates;if(!e)return[];var r=[];if(l(e))for(var n=0;n<e.length;n++){var o=this.states[e[n]];_(o,t)&&r.push(o)}else{var a=this.states[e];_(a,t)&&r.push(a)}return r};function D(t){this.length=0,this.queryParams=t||{}}function O(t){var e;t=t.replace(/\+/gm,"%20");try{e=decodeURIComponent(t)}catch(t){e=""}return e}D.prototype.splice=Array.prototype.splice,D.prototype.slice=Array.prototype.slice,D.prototype.push=Array.prototype.push;var R=function(){this.names=r();var t=[],e=new C(t,0,-1,!0,!1);t[0]=e,this.states=t,this.rootState=e};return R.prototype.add=function(t,e){for(var r,n=this.rootState,o="^",a=[0,0,0],i=new Array(t.length),s=[],h=!0,u=0,c=0;c<t.length;c++){for(var p=t[c],l=w(s,p.path,a),f=l.names,d=l.shouldDecodes;u<s.length;u++){var v=s[u];4!==v.type&&(h=!1,n=n.put(47,!1,!1),o+="/",n=g[v.type](v,n),o+=y[v.type](v))}i[c]={handler:p.handler,names:f,shouldDecodes:d}}h&&(n=n.put(47,!1,!1),o+="/"),n.handlers=i,n.pattern=o+"$",n.types=a,"object"==typeof e&&null!==e&&e.as&&(r=e.as),r&&(this.names[r]={segments:s,handlers:i})},R.prototype.handlersFor=function(t){var e=this.names[t];if(!e)throw new Error("There is no route named "+t);for(var r=new Array(e.handlers.length),n=0;n<e.handlers.length;n++){var o=e.handlers[n];r[n]=o}return r},R.prototype.hasRoute=function(t){return!!this.names[t]},R.prototype.generate=function(t,e){var r=this.names[t],n="";if(!r)throw new Error("There is no route named "+t);for(var o=r.segments,a=0;a<o.length;a++){var i=o[a];4!==i.type&&(n+="/",n+=m[i.type](i,e))}return"/"!==n.charAt(0)&&(n="/"+n),e&&e.queryParams&&(n+=this.generateQueryString(e.queryParams)),n},R.prototype.generateQueryString=function(t){var e=[],r=Object.keys(t);r.sort();for(var n=0;n<r.length;n++){var o=r[n],a=t[o];if(null!=a){var i=encodeURIComponent(o);if(l(a))for(var s=0;s<a.length;s++){var h=o+"[]="+encodeURIComponent(a[s]);e.push(h)}else i+="="+encodeURIComponent(a),e.push(i)}}return 0===e.length?"":"?"+e.join("&")},R.prototype.parseQueryString=function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var o=e[n].split("="),a=O(o[0]),i=a.length,s=!1,h=void 0;h=1===o.length?"true":(2<i&&"[]"===a.slice(i-2)&&(s=!0,r[a=a.slice(0,i-2)]||(r[a]=[])),o[1]?O(o[1]):""),s?r[a].push(h):r[a]=h}return r},R.prototype.recognize=function(t){var e,r=[this.rootState],n={},o=!1,a=t.indexOf("#");-1!==a&&(t=t.substr(0,a));var i=t.indexOf("?");if(-1!==i){var s=t.substr(i+1,t.length);t=t.substr(0,i),n=this.parseQueryString(s)}"/"!==t.charAt(0)&&(t="/"+t);var h=t;R.ENCODE_AND_DECODE_PATH_SEGMENTS?t=d(t):(t=decodeURI(t),h=decodeURI(h));var u=t.length;1<u&&"/"===t.charAt(u-1)&&(t=t.substr(0,u-1),h=h.substr(0,h.length-1),o=!0);for(var c=0;c<t.length&&(r=x(r,t.charCodeAt(c))).length;c++);for(var p=[],l=0;l<r.length;l++)r[l].handlers&&p.push(r[l]);r=p.sort(function(t,e){var r=t.types||[0,0,0],n=r[0],o=r[1],a=r[2],i=e.types||[0,0,0],s=i[0],h=i[1],u=i[2];if(a!==u)return a-u;if(a){if(n!==s)return s-n;if(o!==h)return h-o}return o!==h?o-h:n!==s?s-n:0});var f=p[0];return f&&f.handlers&&(o&&f.pattern&&"(.+)$"===f.pattern.slice(-5)&&(h+="/"),e=function(t,e,r){var n=t.handlers,o=t.regex();if(!o||!n)throw new Error("state not initialized");var a=e.match(o),i=1,s=new D(r);s.length=n.length;for(var h=0;h<n.length;h++){var u=n[h],c=u.names,p=u.shouldDecodes,l=E,f=!1;if(c!==S&&p!==S)for(var d=0;d<c.length;d++){f=!0;var v=c[d],g=a&&a[i++];l===E&&(l={}),R.ENCODE_AND_DECODE_PATH_SEGMENTS&&p[d]?l[v]=g&&decodeURIComponent(g):l[v]=g}s[h]={handler:u.handler,params:l,isDynamic:f}}return s}(f,h,n)),e},R.VERSION="0.3.4",R.ENCODE_AND_DECODE_PATH_SEGMENTS=!0,R.Normalizer={normalizeSegment:c,normalizePath:d,encodePathSegment:a},R.prototype.map=function(t,e){var r=new s;t(h("",r,this.delegate)),function t(e,r,n,o){for(var a=r.routes,i=Object.keys(a),s=0;s<i.length;s++){var h=i[s],u=e.slice();p(u,h,a[h]);var c=r.children[h];c?t(u,c,n,o):n.call(o,u)}}([],r,function(t){e?e(this,t):this.add(t)},this)},R});