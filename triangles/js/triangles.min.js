/**

The MIT License (MIT)

Copyright (c) 2014 Maksim Surguy

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

**/var saveAs=saveAs||function(e){"use strict";if(!(e===void 0||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,r=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},s=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",c=4e4,u=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,c)},h=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var o=e["on"+t[i]];if("function"==typeof o)try{o.call(e,n||e)}catch(r){l(r)}}},f=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},p=function(t,l,c){c||(t=f(t));var p,m=this,g=t.type,_=g===d,b=function(){h(m,"writestart progress write writeend".split(" "))},v=function(){if((a||_&&s)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=a?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;"),n=e.open(t,"_blank");n||(e.location.href=t),t=void 0,m.readyState=m.DONE,b()},i.readAsDataURL(t),m.readyState=m.INIT,void 0}if(p||(p=n().createObjectURL(t)),_)e.location.href=p;else{var o=e.open(p,"_blank");o||(e.location.href=p)}m.readyState=m.DONE,b(),u(p)};return m.readyState=m.INIT,o?(p=n().createObjectURL(t),setTimeout(function(){i.href=p,i.download=l,r(i),b(),u(p),m.readyState=m.DONE}),void 0):(v(),void 0)},m=p.prototype,g=function(e,t,n){return new p(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=f(e)),navigator.msSaveOrOpenBlob(e,t)}:(m.abort=function(){},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});var Delaunay;(function(){"use strict";function e(e){var t,n,i,o,r,s,a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(t=e.length;t--;)a>e[t][0]&&(a=e[t][0]),e[t][0]>d&&(d=e[t][0]),l>e[t][1]&&(l=e[t][1]),e[t][1]>c&&(c=e[t][1]);return n=d-a,i=c-l,o=Math.max(n,i),r=a+.5*n,s=l+.5*i,[[r-20*o,s-o],[r,s+20*o],[r+20*o,s-o]]}function t(e,t,n,o){var r,s,a,l,d,c,u,h,f,p,m=e[t][0],g=e[t][1],_=e[n][0],b=e[n][1],v=e[o][0],y=e[o][1],S=Math.abs(g-b),x=Math.abs(b-y);if(i>S&&i>x)throw Error("Eek! Coincident points!");return i>S?(l=-((v-_)/(y-b)),c=(_+v)/2,h=(b+y)/2,r=(_+m)/2,s=l*(r-c)+h):i>x?(a=-((_-m)/(b-g)),d=(m+_)/2,u=(g+b)/2,r=(v+_)/2,s=a*(r-d)+u):(a=-((_-m)/(b-g)),l=-((v-_)/(y-b)),d=(m+_)/2,c=(_+v)/2,u=(g+b)/2,h=(b+y)/2,r=(a*d-l*c+h-u)/(a-l),s=S>x?a*(r-d)+u:l*(r-c)+h),f=_-r,p=b-s,{i:t,j:n,k:o,x:r,y:s,r:f*f+p*p}}function n(e){var t,n,i,o,r,s;for(n=e.length;n;)for(o=e[--n],i=e[--n],t=n;t;)if(s=e[--t],r=e[--t],i===r&&o===s||i===s&&o===r){e.splice(n,2),e.splice(t,2);break}}var i=1/1048576;Delaunay={triangulate:function(o,r){var s,a,l,d,c,u,h,f,p,m,g,_,b=o.length;if(3>b)return[];if(o=o.slice(0),r)for(s=b;s--;)o[s]=o[s][r];for(l=Array(b),s=b;s--;)l[s]=s;for(l.sort(function(e,t){return o[t][0]-o[e][0]}),d=e(o),o.push(d[0],d[1],d[2]),c=[t(o,b+0,b+1,b+2)],u=[],h=[],s=l.length;s--;h.length=0){for(_=l[s],a=c.length;a--;)f=o[_][0]-c[a].x,f>0&&f*f>c[a].r?(u.push(c[a]),c.splice(a,1)):(p=o[_][1]-c[a].y,f*f+p*p-c[a].r>i||(h.push(c[a].i,c[a].j,c[a].j,c[a].k,c[a].k,c[a].i),c.splice(a,1)));for(n(h),a=h.length;a;)g=h[--a],m=h[--a],c.push(t(o,m,g,_))}for(s=c.length;s--;)u.push(c[s]);for(c.length=0,s=u.length;s--;)b>u[s].i&&b>u[s].j&&b>u[s].k&&c.push(u[s].i,u[s].j,u[s].k);return c},contains:function(e,t){if(t[0]<e[0][0]&&t[0]<e[1][0]&&t[0]<e[2][0]||t[0]>e[0][0]&&t[0]>e[1][0]&&t[0]>e[2][0]||t[1]<e[0][1]&&t[1]<e[1][1]&&t[1]<e[2][1]||t[1]>e[0][1]&&t[1]>e[1][1]&&t[1]>e[2][1])return null;var n=e[1][0]-e[0][0],i=e[2][0]-e[0][0],o=e[1][1]-e[0][1],r=e[2][1]-e[0][1],s=n*r-i*o;if(0===s)return null;var a=(r*(t[0]-e[0][0])-i*(t[1]-e[0][1]))/s,l=(n*(t[1]-e[0][1])-o*(t[0]-e[0][0]))/s;return 0>a||0>l||a+l>1?null:[a,l]}},"undefined"!=typeof module&&(module.exports=Delaunay)})(),function(e,t,n){function i(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function o(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return g[e.which]?g[e.which]:_[e.which]?_[e.which]:String.fromCharCode(e.which).toLowerCase()}function r(e){e=e||{};var t,n=!1;for(t in x)e[t]?n=!0:x[t]=0;n||(F=!1)}function s(e,t,n,i,o,r){var s,a,l=[],d=n.type;if(!y[e])return[];for("keyup"==d&&c(e)&&(t=[e]),s=0;y[e].length>s;++s)if(a=y[e][s],!(!i&&a.seq&&x[a.seq]!=a.level||d!=a.action||("keypress"!=d||n.metaKey||n.ctrlKey)&&t.sort().join(",")!==a.modifiers.sort().join(","))){var u=i&&a.seq==i&&a.level==r;(!i&&a.combo==o||u)&&y[e].splice(s,1),l.push(a)}return l}function a(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function l(e,t,n,i){A.stopCallback(t,t.target||t.srcElement,n,i)||!1!==e(t,n)||(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)}function d(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=o(e);t&&("keyup"==e.type&&w===t?w=!1:A.handleKey(t,a(e),e))}function c(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function u(e,t,n,i){function s(t){return function(){F=t,++x[e],clearTimeout(m),m=setTimeout(r,1e3)}}function a(t){l(n,t,e),"keyup"!==i&&(w=o(t)),setTimeout(r,10)}for(var d=x[e]=0;t.length>d;++d){var c=d+1===t.length?a:s(i||h(t[d+1]).action);f(t[d],c,i,e,d)}}function h(e,t){var n,i,o,r=[];for(n="+"===e?["+"]:e.split("+"),o=0;n.length>o;++o)i=n[o],v[i]&&(i=v[i]),t&&"keypress"!=t&&b[i]&&(i=b[i],r.push("shift")),c(i)&&r.push(i);if(n=i,o=t,!o){if(!p){p={};for(var s in g)s>95&&112>s||g.hasOwnProperty(s)&&(p[g[s]]=s)}o=p[n]?"keydown":"keypress"}return"keypress"==o&&r.length&&(o="keydown"),{key:i,modifiers:r,action:o}}function f(e,t,n,i,o){S[e+":"+n]=t,e=e.replace(/\s+/g," ");var r=e.split(" ");r.length>1?u(e,r,t,n):(n=h(e,n),y[n.key]=y[n.key]||[],s(n.key,n.modifiers,{type:n.action},i,e,o),y[n.key][i?"unshift":"push"]({callback:t,modifiers:n.modifiers,action:n.action,seq:i,level:o,combo:e}))}var p,m,g={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},b={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},v={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},y={},S={},x={},w=!1,C=!1,F=!1;for(n=1;20>n;++n)g[111+n]="f"+n;for(n=0;9>=n;++n)g[n+96]=n;i(t,"keypress",d),i(t,"keydown",d),i(t,"keyup",d);var A={bind:function(e,t,n){e=e instanceof Array?e:[e];for(var i=0;e.length>i;++i)f(e[i],t,n);return this},unbind:function(e,t){return A.bind(e,function(){},t)},trigger:function(e,t){return S[e+":"+t]&&S[e+":"+t]({},e),this},reset:function(){return y={},S={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},handleKey:function(e,t,n){var i,o=s(e,t,n);t={};var a=0,d=!1;for(i=0;o.length>i;++i)o[i].seq&&(a=Math.max(a,o[i].level));for(i=0;o.length>i;++i)o[i].seq?o[i].level==a&&(d=!0,t[o[i].seq]=1,l(o[i].callback,n,o[i].combo,o[i].seq)):d||l(o[i].callback,n,o[i].combo);o="keypress"==n.type&&C,n.type!=F||c(e)||o||r(t),C=d&&"keydown"==n.type}};e.Mousetrap=A,"function"==typeof define&&define.amd&&define(A)}(window,document),function(){function e(e,t){return[].slice.call((t||document).querySelectorAll(e))}if(window.addEventListener){var t=window.StyleFix={link:function(e){try{if("stylesheet"!==e.rel||e.hasAttribute("data-noprefix"))return}catch(n){return}var i,o=e.href||e.getAttribute("data-href"),r=o.replace(/[^\/]+$/,""),s=(/^[a-z]{3,10}:/.exec(r)||[""])[0],a=(/^[a-z]{3,10}:\/\/[^\/]+/.exec(r)||[""])[0],l=/^([^?]*)\??/.exec(o)[1],d=e.parentNode,c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&i()},i=function(){var n=c.responseText;if(n&&e.parentNode&&(!c.status||400>c.status||c.status>600)){if(n=t.fix(n,!0,e),r){n=n.replace(/url\(\s*?((?:"|')?)(.+?)\1\s*?\)/gi,function(e,t,n){return/^([a-z]{3,10}:|#)/i.test(n)?e:/^\/\//.test(n)?'url("'+s+n+'")':/^\//.test(n)?'url("'+a+n+'")':/^\?/.test(n)?'url("'+l+n+'")':'url("'+r+n+'")'});var i=r.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");n=n.replace(RegExp("\\b(behavior:\\s*?url\\('?\"?)"+i,"gi"),"$1")}var o=document.createElement("style");o.textContent=n,o.media=e.media,o.disabled=e.disabled,o.setAttribute("data-href",e.getAttribute("href")),d.insertBefore(o,e),d.removeChild(e),o.media=e.media}};try{c.open("GET",o),c.send(null)}catch(n){"undefined"!=typeof XDomainRequest&&(c=new XDomainRequest,c.onerror=c.onprogress=function(){},c.onload=i,c.open("GET",o),c.send(null))}e.setAttribute("data-inprogress","")},styleElement:function(e){if(!e.hasAttribute("data-noprefix")){var n=e.disabled;e.textContent=t.fix(e.textContent,!0,e),e.disabled=n}},styleAttribute:function(e){var n=e.getAttribute("style");n=t.fix(n,!1,e),e.setAttribute("style",n)},process:function(){e('link[rel="stylesheet"]:not([data-inprogress])').forEach(StyleFix.link),e("style").forEach(StyleFix.styleElement),e("[style]").forEach(StyleFix.styleAttribute)},register:function(e,n){(t.fixers=t.fixers||[]).splice(void 0===n?t.fixers.length:n,0,e)},fix:function(e,n,i){for(var o=0;t.fixers.length>o;o++)e=t.fixers[o](e,n,i)||e;return e},camelCase:function(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}).replace("-","")},deCamelCase:function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}};(function(){setTimeout(function(){e('link[rel="stylesheet"]').forEach(StyleFix.link)},10),document.addEventListener("DOMContentLoaded",StyleFix.process,!1)})()}}(),function(e){function t(e,t,i,o,r){if(e=n[e],e.length){var s=RegExp(t+"("+e.join("|")+")"+i,"gi");r=r.replace(s,o)}return r}if(window.StyleFix&&window.getComputedStyle){var n=window.PrefixFree={prefixCSS:function(e,i){var o=n.prefix;if(n.functions.indexOf("linear-gradient")>-1&&(e=e.replace(/(\s|:|,)(repeating-)?linear-gradient\(\s*(-?\d*\.?\d*)deg/gi,function(e,t,n,i){return t+(n||"")+"linear-gradient("+(90-i)+"deg"})),e=t("functions","(\\s|:|,)","\\s*\\(","$1"+o+"$2(",e),e=t("keywords","(\\s|:)","(\\s|;|\\}|$)","$1"+o+"$2$3",e),e=t("properties","(^|\\{|\\s|;)","\\s*:","$1"+o+"$2:",e),n.properties.length){var r=RegExp("\\b("+n.properties.join("|")+")(?!:)","gi");e=t("valueProperties","\\b",":(.+?);",function(e){return e.replace(r,o+"$1")},e)}return i&&(e=t("selectors","","\\b",n.prefixSelector,e),e=t("atrules","@","\\b","@"+o+"$1",e)),e=e.replace(RegExp("-"+o,"g"),"-"),e=e.replace(/-\*-(?=[a-z]+)/gi,n.prefix)},property:function(e){return(n.properties.indexOf(e)?n.prefix:"")+e},value:function(e){return e=t("functions","(^|\\s|,)","\\s*\\(","$1"+n.prefix+"$2(",e),e=t("keywords","(^|\\s)","(\\s|$)","$1"+n.prefix+"$2$3",e)},prefixSelector:function(e){return e.replace(/^:{1,2}/,function(e){return e+n.prefix})},prefixProperty:function(e,t){var i=n.prefix+e;return t?StyleFix.camelCase(i):i}};(function(){var e={},t=[],i=getComputedStyle(document.documentElement,null),o=document.createElement("div").style,r=function(n){if("-"===n.charAt(0)){t.push(n);var i=n.split("-"),o=i[1];for(e[o]=++e[o]||1;i.length>3;){i.pop();var r=i.join("-");s(r)&&-1===t.indexOf(r)&&t.push(r)}}},s=function(e){return StyleFix.camelCase(e)in o};if(i.length>0)for(var a=0;i.length>a;a++)r(i[a]);else for(var l in i)r(StyleFix.deCamelCase(l));var d={uses:0};for(var c in e){var u=e[c];u>d.uses&&(d={prefix:c,uses:u})}n.prefix="-"+d.prefix+"-",n.Prefix=StyleFix.camelCase(n.prefix),n.properties=[];for(var a=0;t.length>a;a++){var l=t[a];if(0===l.indexOf(n.prefix)){var h=l.slice(n.prefix.length);s(h)||n.properties.push(h)}}"Ms"==n.Prefix&&!("transform"in o)&&!("MsTransform"in o)&&"msTransform"in o&&n.properties.push("transform","transform-origin"),n.properties.sort()})(),function(){function e(e,t){return o[t]="",o[t]=e,!!o[t]}var t={"linear-gradient":{property:"backgroundImage",params:"red, teal"},calc:{property:"width",params:"1px + 5%"},element:{property:"backgroundImage",params:"#foo"},"cross-fade":{property:"backgroundImage",params:"url(a.png), url(b.png), 50%"}};t["repeating-linear-gradient"]=t["repeating-radial-gradient"]=t["radial-gradient"]=t["linear-gradient"];var i={initial:"color","zoom-in":"cursor","zoom-out":"cursor",box:"display",flexbox:"display","inline-flexbox":"display",flex:"display","inline-flex":"display",grid:"display","inline-grid":"display","min-content":"width"};n.functions=[],n.keywords=[];var o=document.createElement("div").style;for(var r in t){var s=t[r],a=s.property,l=r+"("+s.params+")";!e(l,a)&&e(n.prefix+l,a)&&n.functions.push(r)}for(var d in i){var a=i[d];!e(d,a)&&e(n.prefix+d,a)&&n.keywords.push(d)}}(),function(){function t(e){return r.textContent=e+"{}",!!r.sheet.cssRules.length}var i={":read-only":null,":read-write":null,":any-link":null,"::selection":null},o={keyframes:"name",viewport:null,document:'regexp(".")'};n.selectors=[],n.atrules=[];var r=e.appendChild(document.createElement("style"));for(var s in i){var a=s+(i[s]?"("+i[s]+")":"");!t(a)&&t(n.prefixSelector(a))&&n.selectors.push(s)}for(var l in o){var a=l+" "+(o[l]||"");!t("@"+a)&&t("@"+n.prefix+a)&&n.atrules.push(l)}e.removeChild(r)}(),n.valueProperties=["transition","transition-property"],e.className+=" "+n.prefix,StyleFix.register(n.prefixCSS)}}(document.documentElement),FSS={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"},FSS.Array="function"==typeof Float32Array?Float32Array:Array,FSS.Utils={isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;t.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),o=window.setTimeout(function(){t(n+i)},i);return e=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Math.PIM2=2*Math.PI,Math.PID2=Math.PI/2,Math.randomInRange=function(e,t){return e+(t-e)*Math.random()},Math.clamp=function(e,t,n){return e=Math.max(e,t),e=Math.min(e,n)},FSS.Vector3={create:function(e,t,n){var i=new FSS.Array(3);return this.set(i,e,t,n),i},clone:function(e){var t=this.create();return this.copy(t,e),t},set:function(e,t,n,i){return e[0]=t||0,e[1]=n||0,e[2]=i||0,this},setX:function(e,t){return e[0]=t||0,this},setY:function(e,t){return e[1]=t||0,this},setZ:function(e,t){return e[2]=t||0,this},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],this},add:function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],this},addVectors:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],this},addScalar:function(e,t){return e[0]+=t,e[1]+=t,e[2]+=t,this},subtract:function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],this},subtractVectors:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],this},subtractScalar:function(e,t){return e[0]-=t,e[1]-=t,e[2]-=t,this},multiply:function(e,t){return e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],this},multiplyVectors:function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],this},multiplyScalar:function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,this},divide:function(e,t){return e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],this},divideVectors:function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],this},divideScalar:function(e,t){return 0!==t?(e[0]/=t,e[1]/=t,e[2]/=t):(e[0]=0,e[1]=0,e[2]=0),this},cross:function(e,t){var n=e[0],i=e[1],o=e[2];return e[0]=i*t[2]-o*t[1],e[1]=o*t[0]-n*t[2],e[2]=n*t[1]-i*t[0],this},crossVectors:function(e,t,n){return e[0]=t[1]*n[2]-t[2]*n[1],e[1]=t[2]*n[0]-t[0]*n[2],e[2]=t[0]*n[1]-t[1]*n[0],this},min:function(e,t){return t>e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),t>e[2]&&(e[2]=t),this},max:function(e,t){return e[0]>t&&(e[0]=t),e[1]>t&&(e[1]=t),e[2]>t&&(e[2]=t),this},clamp:function(e,t,n){return this.min(e,t),this.max(e,n),this},limit:function(e,t,n){var i=this.length(e);return null!==t&&t>i?this.setLength(e,t):null!==n&&i>n&&this.setLength(e,n),this},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalise:function(e){return this.divideScalar(e,this.length(e))},negate:function(e){return this.multiplyScalar(e,-1)},distanceSquared:function(e,t){var n=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2];return n*n+i*i+o*o},distance:function(e,t){return Math.sqrt(this.distanceSquared(e,t))},lengthSquared:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},length:function(e){return Math.sqrt(this.lengthSquared(e))},setLength:function(e,t){var n=this.length(e);return 0!==n&&t!==n&&this.multiplyScalar(e,t/n),this}},FSS.Vector4={create:function(e,t,n){var i=new FSS.Array(4);return this.set(i,e,t,n),i},set:function(e,t,n,i,o){return e[0]=t||0,e[1]=n||0,e[2]=i||0,e[3]=o||0,this},setX:function(e,t){return e[0]=t||0,this},setY:function(e,t){return e[1]=t||0,this},setZ:function(e,t){return e[2]=t||0,this},setW:function(e,t){return e[3]=t||0,this},add:function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],this},multiplyVectors:function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],this},multiplyScalar:function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},min:function(e,t){return t>e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),t>e[2]&&(e[2]=t),t>e[3]&&(e[3]=t),this},max:function(e,t){return e[0]>t&&(e[0]=t),e[1]>t&&(e[1]=t),e[2]>t&&(e[2]=t),e[3]>t&&(e[3]=t),this},clamp:function(e,t,n){return this.min(e,t),this.max(e,n),this}},FSS.Color=function(e,t){this.rgba=FSS.Vector4.create(),this.hex=e||"#000000",this.opacity=FSS.Utils.isNumber(t)?t:1,this.set(this.hex,this.opacity)},FSS.Color.prototype={set:function(e,t){e=e.replace("#","");var n=e.length/3;return this.rgba[0]=parseInt(e.substring(0*n,1*n),16)/255,this.rgba[1]=parseInt(e.substring(1*n,2*n),16)/255,this.rgba[2]=parseInt(e.substring(2*n,3*n),16)/255,this.rgba[3]=FSS.Utils.isNumber(t)?t:this.rgba[3],this},hexify:function(e){var t=Math.ceil(255*e).toString(16);return 1===t.length&&(t="0"+t),t},format:function(){var e=this.hexify(this.rgba[0]),t=this.hexify(this.rgba[1]),n=this.hexify(this.rgba[2]);return this.hex="#"+e+t+n,this.hex}},FSS.Object=function(){this.position=FSS.Vector3.create()},FSS.Object.prototype={setPosition:function(e,t,n){return FSS.Vector3.set(this.position,e,t,n),this}},FSS.Light=function(e,t){FSS.Object.call(this),this.ambient=new FSS.Color(e||"#FFFFFF"),this.diffuse=new FSS.Color(t||"#FFFFFF"),this.ray=FSS.Vector3.create()},FSS.Light.prototype=Object.create(FSS.Object.prototype),FSS.Vertex=function(e,t,n){this.position=FSS.Vector3.create(e,t,n)},FSS.Vertex.prototype={setPosition:function(e,t,n){return FSS.Vector3.set(this.position,e,t,n),this}},FSS.Triangle=function(e,t,n){this.a=e||new FSS.Vertex,this.b=t||new FSS.Vertex,this.c=n||new FSS.Vertex,this.vertices=[this.a,this.b,this.c],this.u=FSS.Vector3.create(),this.v=FSS.Vector3.create(),this.centroid=FSS.Vector3.create(),this.normal=FSS.Vector3.create(),this.color=new FSS.Color,this.polygon=document.createElementNS(FSS.SVGNS,"polygon"),this.polygon.setAttributeNS(null,"stroke-linejoin","round"),this.polygon.setAttributeNS(null,"stroke-miterlimit","1"),this.polygon.setAttributeNS(null,"stroke-width","1"),this.computeCentroid(),this.computeNormal()},FSS.Triangle.prototype={computeCentroid:function(){return this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0],this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1],this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2],FSS.Vector3.divideScalar(this.centroid,3),this},computeNormal:function(){return FSS.Vector3.subtractVectors(this.u,this.b.position,this.a.position),FSS.Vector3.subtractVectors(this.v,this.c.position,this.a.position),FSS.Vector3.crossVectors(this.normal,this.u,this.v),FSS.Vector3.normalise(this.normal),this}},FSS.Geometry=function(){this.vertices=[],this.triangles=[],this.dirty=!1},FSS.Geometry.prototype={update:function(){if(this.dirty){var e,t;for(e=this.triangles.length-1;e>=0;e--)t=this.triangles[e],t.computeCentroid(),t.computeNormal();this.dirty=!1}return this}},FSS.Plane=function(e,t,n){FSS.Geometry.call(this),this.width=e||100,this.height=t||100;var i,o,r=Array(n);for(offsetX=this.width*-.5,offsetY=.5*this.height,s=r.length;s--;)i=offsetX+Math.random()*e,o=offsetY-Math.random()*t,r[s]=[i,o];r.push([offsetX,offsetY]),r.push([offsetX+e/2,offsetY]),r.push([offsetX+e,offsetY]),r.push([offsetX+e,offsetY-t/2]),r.push([offsetX+e,offsetY-t]),r.push([offsetX+e/2,offsetY-t]),r.push([offsetX,offsetY-t]),r.push([offsetX,offsetY-t/2]);for(var s=6;s>=0;s--)r.push([offsetX+Math.random()*e,offsetY]),r.push([offsetX,offsetY-Math.random()*t]),r.push([offsetX+e,offsetY-Math.random()*t]),r.push([offsetX+Math.random()*e,offsetY-t]);var a=Delaunay.triangulate(r);for(s=a.length;s;)--s,v1=new FSS.Vertex(Math.ceil(r[a[s]][0]),Math.ceil(r[a[s]][1])),--s,v2=new FSS.Vertex(Math.ceil(r[a[s]][0]),Math.ceil(r[a[s]][1])),--s,v3=new FSS.Vertex(Math.ceil(r[a[s]][0]),Math.ceil(r[a[s]][1])),t1=new FSS.Triangle(v1,v2,v3),this.triangles.push(t1),this.vertices.push(v1),this.vertices.push(v2),this.vertices.push(v3)},FSS.Plane.prototype=Object.create(FSS.Geometry.prototype),FSS.Material=function(e,t){this.ambient=new FSS.Color(e||"#444444"),this.diffuse=new FSS.Color(t||"#FFFFFF"),this.slave=new FSS.Color},FSS.Mesh=function(e,t){FSS.Object.call(this),this.geometry=e||new FSS.Geometry,this.material=t||new FSS.Material,this.side=FSS.FRONT,this.visible=!0},FSS.Mesh.prototype=Object.create(FSS.Object.prototype),FSS.Mesh.prototype.update=function(e,t){var n,i,o,r,s;if(this.geometry.update(),t)for(n=this.geometry.triangles.length-1;n>=0;n--){for(i=this.geometry.triangles[n],FSS.Vector4.set(i.color.rgba),o=e.length-1;o>=0;o--)r=e[o],FSS.Vector3.subtractVectors(r.ray,r.position,i.centroid),FSS.Vector3.normalise(r.ray),s=FSS.Vector3.dot(i.normal,r.ray),this.side===FSS.FRONT?s=Math.max(s,0):this.side===FSS.BACK?s=Math.abs(Math.min(s,0)):this.side===FSS.DOUBLE&&(s=Math.max(Math.abs(s),0)),FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.ambient.rgba,r.ambient.rgba),FSS.Vector4.add(i.color.rgba,this.material.slave.rgba),FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.diffuse.rgba,r.diffuse.rgba),FSS.Vector4.multiplyScalar(this.material.slave.rgba,s),FSS.Vector4.add(i.color.rgba,this.material.slave.rgba);FSS.Vector4.clamp(i.color.rgba,0,1)}return this},FSS.Scene=function(){this.meshes=[],this.lights=[]},FSS.Scene.prototype={add:function(e){return e instanceof FSS.Mesh&&!~this.meshes.indexOf(e)?this.meshes.push(e):e instanceof FSS.Light&&!~this.lights.indexOf(e)&&this.lights.push(e),this},remove:function(e){return e instanceof FSS.Mesh&&~this.meshes.indexOf(e)?this.meshes.splice(this.meshes.indexOf(e),1):e instanceof FSS.Light&&~this.lights.indexOf(e)&&this.lights.splice(this.lights.indexOf(e),1),this}},FSS.Renderer=function(){this.width=0,this.height=0,this.halfWidth=0,this.halfHeight=0},FSS.Renderer.prototype={setSize:function(e,t){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this):void 0},clear:function(){return this},render:function(){return this}},FSS.CanvasRenderer=function(){FSS.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.context=this.element.getContext("2d"),this.setSize(this.element.width,this.element.height)},FSS.CanvasRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.CanvasRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.element.width=e,this.element.height=t,this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight),this},FSS.CanvasRenderer.prototype.clear=function(){return FSS.Renderer.prototype.clear.call(this),this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height),this},FSS.CanvasRenderer.prototype.render=function(e){FSS.Renderer.prototype.render.call(this,e);var t,n,i,o,r;for(this.clear(),this.context.lineJoin="round",this.context.lineWidth=1,t=e.meshes.length-1;t>=0;t--)if(n=e.meshes[t],n.visible)for(n.update(e.lights,!0),i=n.geometry.triangles.length-1;i>=0;i--)o=n.geometry.triangles[i],r=o.color.format(),this.context.beginPath(),this.context.moveTo(o.a.position[0],o.a.position[1]),this.context.lineTo(o.b.position[0],o.b.position[1]),this.context.lineTo(o.c.position[0],o.c.position[1]),this.context.closePath(),this.context.strokeStyle=r,this.context.fillStyle=r,this.context.stroke(),this.context.fill();return this},FSS.WebGLRenderer=function(){FSS.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.vertices=null,this.lights=null;var e={preserveDrawingBuffer:!1,premultipliedAlpha:!0,antialias:!0,stencil:!0,alpha:!0};return this.gl=this.getContext(this.element,e),this.unsupported=!this.gl,this.unsupported?"WebGL is not supported by your browser.":(this.gl.clearColor(0,0,0,0),this.gl.enable(this.gl.DEPTH_TEST),this.setSize(this.element.width,this.element.height),void 0)},FSS.WebGLRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.WebGLRenderer.prototype.getContext=function(e,t){var n=!1;try{if(!(n=e.getContext("experimental-webgl",t)))throw"Error creating WebGL context."}catch(i){console.error(i)}return n},FSS.WebGLRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.unsupported?void 0:(this.element.width=e,this.element.height=t,this.gl.viewport(0,0,e,t),this)},FSS.WebGLRenderer.prototype.clear=function(){return FSS.Renderer.prototype.clear.call(this),this.unsupported?void 0:(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this)},FSS.WebGLRenderer.prototype.render=function(e){if(FSS.Renderer.prototype.render.call(this,e),!this.unsupported){var t,n,i,o,r,s,a,l,d,c,u,h,f,p,m,g=!1,_=e.lights.length,b=0;if(this.clear(),this.lights!==_){if(this.lights=_,!(this.lights>0))return;this.buildProgram(_)}if(this.program){for(t=e.meshes.length-1;t>=0;t--)n=e.meshes[t],n.geometry.dirty&&(g=!0),n.update(e.lights,!1),b+=3*n.geometry.triangles.length;if(g||this.vertices!==b){this.vertices=b;for(l in this.program.attributes){for(c=this.program.attributes[l],c.data=new FSS.Array(b*c.size),f=0,t=e.meshes.length-1;t>=0;t--)for(n=e.meshes[t],i=0,o=n.geometry.triangles.length;o>i;i++)for(r=n.geometry.triangles[i],p=0,m=r.vertices.length;m>p;p++){switch(vertex=r.vertices[p],l){case"side":this.setBufferData(f,c,n.side);break;case"position":this.setBufferData(f,c,vertex.position);break;case"centroid":this.setBufferData(f,c,r.centroid);break;case"normal":this.setBufferData(f,c,r.normal);break;case"ambient":this.setBufferData(f,c,n.material.ambient.rgba);break;case"diffuse":this.setBufferData(f,c,n.material.diffuse.rgba)}f++}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,c.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,c.data,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(c.location),this.gl.vertexAttribPointer(c.location,c.size,this.gl.FLOAT,!1,0,0)}}for(this.setBufferData(0,this.program.uniforms.resolution,[this.width,this.height,this.width]),s=_-1;s>=0;s--)a=e.lights[s],this.setBufferData(s,this.program.uniforms.lightPosition,a.position),this.setBufferData(s,this.program.uniforms.lightAmbient,a.ambient.rgba),this.setBufferData(s,this.program.uniforms.lightDiffuse,a.diffuse.rgba);for(d in this.program.uniforms)switch(c=this.program.uniforms[d],h=c.location,u=c.data,c.structure){case"3f":this.gl.uniform3f(h,u[0],u[1],u[2]);break;case"3fv":this.gl.uniform3fv(h,u);break;case"4fv":this.gl.uniform4fv(h,u)}}return this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices),this}},FSS.WebGLRenderer.prototype.setBufferData=function(e,t,n){if(FSS.Utils.isNumber(n))t.data[e*t.size]=n;else for(var i=n.length-1;i>=0;i--)t.data[e*t.size+i]=n[i]},FSS.WebGLRenderer.prototype.buildProgram=function(e){if(!this.unsupported){var t=FSS.WebGLRenderer.VS(e),n=FSS.WebGLRenderer.FS(e),i=t+n;if(!this.program||this.program.code!==i){var o=this.gl.createProgram(),r=this.buildShader(this.gl.VERTEX_SHADER,t),s=this.buildShader(this.gl.FRAGMENT_SHADER,n);if(this.gl.attachShader(o,r),this.gl.attachShader(o,s),this.gl.linkProgram(o),!this.gl.getProgramParameter(o,this.gl.LINK_STATUS)){var a=this.gl.getError(),l=this.gl.getProgramParameter(o,this.gl.VALIDATE_STATUS);return console.error("Could not initialise shader.\nVALIDATE_STATUS: "+l+"\nERROR: "+a),null}return this.gl.deleteShader(s),this.gl.deleteShader(r),o.code=i,o.attributes={side:this.buildBuffer(o,"attribute","aSide",1,"f"),position:this.buildBuffer(o,"attribute","aPosition",3,"v3"),centroid:this.buildBuffer(o,"attribute","aCentroid",3,"v3"),normal:this.buildBuffer(o,"attribute","aNormal",3,"v3"),ambient:this.buildBuffer(o,"attribute","aAmbient",4,"v4"),diffuse:this.buildBuffer(o,"attribute","aDiffuse",4,"v4")},o.uniforms={resolution:this.buildBuffer(o,"uniform","uResolution",3,"3f",1),lightPosition:this.buildBuffer(o,"uniform","uLightPosition",3,"3fv",e),lightAmbient:this.buildBuffer(o,"uniform","uLightAmbient",4,"4fv",e),lightDiffuse:this.buildBuffer(o,"uniform","uLightDiffuse",4,"4fv",e)},this.program=o,this.gl.useProgram(this.program),o}}},FSS.WebGLRenderer.prototype.buildShader=function(e,t){if(!this.unsupported){var n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(console.error(this.gl.getShaderInfoLog(n)),null)}},FSS.WebGLRenderer.prototype.buildBuffer=function(e,t,n,i,o,r){var s={buffer:this.gl.createBuffer(),size:i,structure:o,data:null};switch(t){case"attribute":s.location=this.gl.getAttribLocation(e,n);break;case"uniform":s.location=this.gl.getUniformLocation(e,n)}return r&&(s.data=new FSS.Array(r*i)),s},FSS.WebGLRenderer.VS=function(e){var t=["precision mediump float;","#define LIGHTS "+e,"attribute float aSide;","attribute vec3 aPosition;","attribute vec3 aCentroid;","attribute vec3 aNormal;","attribute vec4 aAmbient;","attribute vec4 aDiffuse;","uniform vec3 uResolution;","uniform vec3 uLightPosition[LIGHTS];","uniform vec4 uLightAmbient[LIGHTS];","uniform vec4 uLightDiffuse[LIGHTS];","varying vec4 vColor;","void main() {","vColor = vec4(0.0);","vec3 position = aPosition / uResolution * 2.0;","for (int i = 0; i < LIGHTS; i++) {","vec3 lightPosition = uLightPosition[i];","vec4 lightAmbient = uLightAmbient[i];","vec4 lightDiffuse = uLightDiffuse[i];","vec3 ray = normalize(lightPosition - aCentroid);","float illuminance = dot(aNormal, ray);","if (aSide == 0.0) {","illuminance = max(illuminance, 0.0);","} else if (aSide == 1.0) {","illuminance = abs(min(illuminance, 0.0));","} else if (aSide == 2.0) {","illuminance = max(abs(illuminance), 0.0);","}","vColor += aAmbient * lightAmbient;","vColor += aDiffuse * lightDiffuse * illuminance;","}","vColor = clamp(vColor, 0.0, 1.0);","gl_Position = vec4(position, 1.0);","}"].join("\n");
return t},FSS.WebGLRenderer.FS=function(){var e=["precision mediump float;","varying vec4 vColor;","void main() {","gl_FragColor = vColor;","}"].join("\n");return e},FSS.SVGRenderer=function(){FSS.Renderer.call(this),this.element=document.createElementNS(FSS.SVGNS,"svg"),this.element.setAttribute("xmlns",FSS.SVGNS),this.element.setAttribute("version","1.1"),this.element.style.display="block",this.setSize(300,150)},FSS.SVGRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.SVGRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.element.setAttribute("width",e),this.element.setAttribute("height",t),this},FSS.SVGRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);for(var e=this.element.childNodes.length-1;e>=0;e--)this.element.removeChild(this.element.childNodes[e]);return this},FSS.SVGRenderer.prototype.render=function(e){FSS.Renderer.prototype.render.call(this,e);var t,n,i,o,r,s;for(t=e.meshes.length-1;t>=0;t--)if(n=e.meshes[t],n.visible)for(n.update(e.lights,!0),i=n.geometry.triangles.length-1;i>=0;i--)o=n.geometry.triangles[i],o.polygon.parentNode!==this.element&&this.element.appendChild(o.polygon),r=this.formatPoint(o.a)+" ",r+=this.formatPoint(o.b)+" ",r+=this.formatPoint(o.c),s=this.formatStyle(o.color.format()),o.polygon.setAttributeNS(null,"points",r),o.polygon.setAttributeNS(null,"style",s);return this},FSS.SVGRenderer.prototype.formatPoint=function(e){return this.halfWidth+e.position[0]+","+(this.halfHeight-e.position[1])},FSS.SVGRenderer.prototype.formatStyle=function(e){var t="fill:"+e+";";return t+="stroke:"+e+";"};var dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},dat.color=dat.color||{},dat.utils.css=function(){return{load:function(e,t){var t=t||document,n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){var t=t||document,n=document.createElement("style");n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}}}(),dat.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var n=t.call(arguments),i=e.length-1;i>=0;i--)n=[e[i].apply(this,n)];return n[0]}},each:function(t,n,i){if(e&&t.forEach===e)t.forEach(n,i);else if(t.length===t.length+0)for(var o=0,r=t.length;r>o&&!(o in t&&n.call(i,t[o],o)===this.BREAK);o++);else for(o in t)if(n.call(i,t[o],o)===this.BREAK)break},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),dat.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onFinishChange=this.__onChange=void 0};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(dat.utils.common),dat.dom.dom=function(e){function t(t){return"0"===t||e.isUndefined(t)?0:(t=t.match(i),e.isNull(t)?0:parseFloat(t[1]))}var n={};e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,i){e.each(t,function(e){n[e]=i})});var i=/(\d+(\.\d+)?)px/,o={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,n,i){e.isUndefined(n)&&(n=!0),e.isUndefined(i)&&(i=!0),t.style.position="absolute",n&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,i,o,r){var o=o||{},s=n[i];if(!s)throw Error("Event type "+i+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":a.initMouseEvent(i,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,o.x||o.clientX||0,o.y||o.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=a.initKeyboardEvent||a.initKeyEvent,e.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(i,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(i,o.bubbles||!1,o.cancelable||!0)}e.defaults(a,r),t.dispatchEvent(a)},bind:function(e,t,n,i){return e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent&&e.attachEvent("on"+t,n),o},unbind:function(e,t,n,i){return e.removeEventListener?e.removeEventListener(t,n,i||!1):e.detachEvent&&e.detachEvent("on"+t,n),o},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1==n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return o},removeClass:function(e,t){if(t){if(void 0!==e.className)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!=i&&(n.splice(i,1),e.className=n.join(" "))}}else e.className=void 0;return o},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){return e=getComputedStyle(e),t(e["border-left-width"])+t(e["border-right-width"])+t(e["padding-left"])+t(e["padding-right"])+t(e.width)},getHeight:function(e){return e=getComputedStyle(e),t(e["border-top-width"])+t(e["border-bottom-width"])+t(e["padding-top"])+t(e["padding-bottom"])+t(e.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return o}(dat.utils.common),dat.controllers.OptionController=function(e,t,n){var i=function(e,o,r){i.superclass.call(this,e,o);var s=this;if(this.__select=document.createElement("select"),n.isArray(r)){var a={};n.each(r,function(e){a[e]=e}),r=a}n.each(r,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),this.updateDisplay(),t.bind(this.__select,"change",function(){s.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return i.superclass=e,n.extend(i.prototype,e.prototype,{setValue:function(e){return e=i.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),i.superclass.prototype.updateDisplay.call(this)}}),i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(e,t){var n=function(e,i,o){n.superclass.call(this,e,i),o=o||{},this.__min=o.min,this.__max=o.max,this.__step=o.step,e=this.__impliedStep=t.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,e=""+e,this.__precision=e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0};return n.superclass=e,t.extend(n.prototype,e.prototype,{setValue:function(e){return void 0!==this.__min&&this.__min>e?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&0!=e%this.__step&&(e=Math.round(e/this.__step)*this.__step),n.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),n}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(e,t,n){var i=function(e,o,r){function s(){var e=parseFloat(c.__input.value);n.isNaN(e)||c.setValue(e)}function a(e){var t=d-e.clientY;c.setValue(c.getValue()+t*c.__impliedStep),d=e.clientY}function l(){t.unbind(window,"mousemove",a),t.unbind(window,"mouseup",l)}this.__truncationSuspended=!1,i.superclass.call(this,e,o,r);var d,c=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",s),t.bind(this.__input,"blur",function(){s(),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}),t.bind(this.__input,"mousedown",function(e){t.bind(window,"mousemove",a),t.bind(window,"mouseup",l),d=e.clientY}),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return i.superclass=e,n.extend(i.prototype,e.prototype,{updateDisplay:function(){var e,t=this.__input;if(this.__truncationSuspended)e=this.getValue();else{e=this.getValue();var n=Math.pow(10,this.__precision);e=Math.round(e*n)/n}return t.value=e,i.superclass.prototype.updateDisplay.call(this)}}),i}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(e,t,n,i,o){var r=function(e,n,i,o,s){function a(e){e.preventDefault();var n=t.getOffset(d.__background),i=t.getWidth(d.__background);return d.setValue(d.__min+(d.__max-d.__min)*((e.clientX-n.left)/(n.left+i-n.left))),!1}function l(){t.unbind(window,"mousemove",a),t.unbind(window,"mouseup",l),d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())}r.superclass.call(this,e,n,{min:i,max:o,step:s});var d=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",function(e){t.bind(window,"mousemove",a),t.bind(window,"mouseup",l),a(e)}),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return r.superclass=e,r.useDefaultStyles=function(){n.inject(o)},i.extend(r.prototype,e.prototype,{updateDisplay:function(){return this.__foreground.style.width=100*((this.getValue()-this.__min)/(this.__max-this.__min))+"%",r.superclass.prototype.updateDisplay.call(this)}}),r}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),dat.controllers.FunctionController=function(e,t,n){var i=function(e,n,o){i.superclass.call(this,e,n);var r=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===o?"Fire":o,t.bind(this.__button,"click",function(e){return e.preventDefault(),r.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return i.superclass=e,n.extend(i.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(e,t,n){var i=function(e,n){i.superclass.call(this,e,n);var o=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",function(){o.setValue(!o.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return i.superclass=e,n.extend(i.prototype,e.prototype,{setValue:function(e){return e=i.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,i.superclass.prototype.updateDisplay.call(this)}}),i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(t=t.hex.toString(16);6>t.length;)t="0"+t;return"#"+t}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(dat.utils.common),dat.color.interpret=function(e,t){var n,i,o=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i),null===e?!1:{space:"HEX",hex:parseInt("0x"+(""+e[1])+(""+e[1])+(""+e[2])+(""+e[2])+(""+e[3])+(""+e[3]))}},write:e},SIX_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9]{6})$/i),null===e?!1:{space:"HEX",hex:parseInt("0x"+(""+e[1]))}},write:e},CSS_RGB:{read:function(e){return e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/),null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:e},CSS_RGBA:{read:function(e){return e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/),null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return function(){i=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(o,function(o){return o.litmus(e)?(t.each(o.conversions,function(o,r){return n=o.read(e),i===!1&&n!==!1?(i=n,n.conversionName=r,n.conversion=o,t.BREAK):void 0}),t.BREAK):void 0}),i}}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(e,t,n,i,o,r,s,a,l,d,c,u,h,f,p){function m(e,t,n,r){if(void 0===t[n])throw Error("Object "+t+' has no property "'+n+'"');r.color?t=new c(t,n):(t=[t,n].concat(r.factoryArgs),t=i.apply(e,t)),r.before instanceof o&&(r.before=r.before.__li),b(e,t),f.addClass(t.domElement,"c"),n=document.createElement("span"),f.addClass(n,"property-name"),n.innerHTML=t.property;var s=document.createElement("div");return s.appendChild(n),s.appendChild(t.domElement),r=g(e,s,r.before),f.addClass(r,V.CLASS_CONTROLLER_ROW),f.addClass(r,typeof t.getValue()),_(e,r,t),e.__controllers.push(t),t}function g(e,t,n){var i=document.createElement("li");return t&&i.appendChild(t),n?e.__ul.insertBefore(i,params.before):e.__ul.appendChild(i),e.onResize(),i}function _(e,t,n){if(n.__li=t,n.__gui=e,p.extend(n,{options:function(t){return arguments.length>1?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[p.toArray(arguments)]})):p.isArray(t)||p.isObject(t)?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})):void 0},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof l){var i=new a(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});p.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],o=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(n,e),o.apply(i,e)}}),f.addClass(t,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof a){var o=function(t){return p.isNumber(n.__min)&&p.isNumber(n.__max)?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=p.compose(o,n.min),n.max=p.compose(o,n.max)}else n instanceof r?(f.bind(t,"click",function(){f.fakeEvent(n.__checkbox,"click")}),f.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof s?(f.bind(t,"click",function(){f.fakeEvent(n.__button,"click")}),f.bind(t,"mouseover",function(){f.addClass(n.__button,"hover")}),f.bind(t,"mouseout",function(){f.removeClass(n.__button,"hover")})):n instanceof c&&(f.addClass(t,"color"),n.updateDisplay=p.compose(function(e){return t.style.borderLeftColor=""+n.__color,e},n.updateDisplay),n.updateDisplay());n.setValue=p.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&C(e.getRoot(),!0),t},n.setValue)}function b(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!=i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[t.property]=t,n.load&&n.load.remembered){if(n=n.load.remembered,n[e.preset])n=n[e.preset];else{if(!n[E])return;n=n[E]}n[i]&&void 0!==n[i][t.property]&&(i=n[i][t.property],t.initialValue=i,t.setValue(i))}}}function v(e){var t=e.__save_row=document.createElement("li");f.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),f.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",f.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",f.addClass(i,"button"),f.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",f.addClass(o,"button"),f.addClass(o,"save-as");var r=document.createElement("span");r.innerHTML="Revert",f.addClass(r,"button"),f.addClass(r,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?p.each(e.load.remembered,function(t,n){w(e,n,n==e.preset)}):w(e,E,!1),f.bind(s,"change",function(){for(var t=0;e.__preset_select.length>t;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(n),t.appendChild(i),t.appendChild(o),t.appendChild(r),A){var t=document.getElementById("dg-save-locally"),a=document.getElementById("dg-local-explain");t.style.display="block",t=document.getElementById("dg-local-storage"),"true"===localStorage.getItem(document.location.href+".isLocal")&&t.setAttribute("checked","checked");var l=function(){a.style.display=e.useLocalStorage?"block":"none"};l(),f.bind(t,"change",function(){e.useLocalStorage=!e.useLocalStorage,l()})}var d=document.getElementById("dg-new-constructor");f.bind(d,"keydown",function(e){e.metaKey&&(67===e.which||67==e.keyCode)&&R.hide()}),f.bind(n,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),R.show(),d.focus(),d.select()}),f.bind(i,"click",function(){e.save()}),f.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),f.bind(r,"click",function(){e.revert()})}function y(e){function t(t){return t.preventDefault(),o=t.clientX,f.addClass(e.__closeButton,V.CLASS_DRAG),f.bind(window,"mousemove",n),f.bind(window,"mouseup",i),!1}function n(t){return t.preventDefault(),e.width+=o-t.clientX,e.onResize(),o=t.clientX,!1}function i(){f.removeClass(e.__closeButton,V.CLASS_DRAG),f.unbind(window,"mousemove",n),f.unbind(window,"mouseup",i)}e.__resize_handle=document.createElement("div"),p.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var o;f.bind(e.__resize_handle,"mousedown",t),f.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function S(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function x(e,t){var n={};return p.each(e.__rememberedObjects,function(i,o){var r={};p.each(e.__rememberedObjectIndecesToControllers[o],function(e,n){r[n]=t?e.initialValue:e.getValue()}),n[o]=r}),n}function w(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function C(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function F(e){0!=e.length&&u(function(){F(e)}),p.each(e,function(e){e.updateDisplay()})}e.inject(n);var A,E="Default";try{A="localStorage"in window&&null!==window.localStorage}catch(k){A=!1}var R,L,T=!0,N=!1,O=[],V=function(e){function t(){localStorage.setItem(document.location.href+".gui",JSON.stringify(i.getSaveObject()))}function n(){var e=i.getRoot();e.width+=1,p.defer(function(){e.width-=1})}var i=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),f.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=p.defaults(e,{autoPlace:!0,width:V.DEFAULT_WIDTH}),e=p.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),p.isUndefined(e.load)?e.load={preset:E}:e.preset&&(e.load.preset=e.preset),p.isUndefined(e.parent)&&e.hideable&&O.push(this),e.resizable=p.isUndefined(e.parent)&&e.resizable,e.autoPlace&&p.isUndefined(e.scrollable)&&(e.scrollable=!0);var o=A&&"true"===localStorage.getItem(document.location.href+".isLocal");if(Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return i.parent?i.getRoot().preset:e.load.preset},set:function(t){for(i.parent?i.getRoot().preset=t:e.load.preset=t,t=0;this.__preset_select.length>t;t++)this.__preset_select[t].value==this.preset&&(this.__preset_select.selectedIndex=t);i.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t,S(i,t)}},name:{get:function(){return e.name},set:function(t){e.name=t,s&&(s.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t,e.closed?f.addClass(i.__ul,V.CLASS_CLOSED):f.removeClass(i.__ul,V.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=t?V.TEXT_OPEN:V.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return o},set:function(e){A&&((o=e)?f.bind(window,"unload",t):f.unbind(window,"unload",t),localStorage.setItem(document.location.href+".isLocal",e))}}}),p.isUndefined(e.parent)){if(e.closed=!1,f.addClass(this.domElement,V.CLASS_MAIN),f.makeSelectable(this.domElement,!1),A&&o){i.useLocalStorage=!0;var r=localStorage.getItem(document.location.href+".gui");r&&(e.load=JSON.parse(r))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=V.TEXT_CLOSED,f.addClass(this.__closeButton,V.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),f.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{void 0===e.closed&&(e.closed=!0);var s=document.createTextNode(e.name);f.addClass(s,"controller-name"),r=g(i,s),f.addClass(this.__ul,V.CLASS_CLOSED),f.addClass(r,"title"),f.bind(r,"click",function(e){return e.preventDefault(),i.closed=!i.closed,!1}),e.closed||(this.closed=!1)}e.autoPlace&&(p.isUndefined(e.parent)&&(T&&(L=document.createElement("div"),f.addClass(L,"dg"),f.addClass(L,V.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(L),T=!1),L.appendChild(this.domElement),f.addClass(this.domElement,V.CLASS_AUTO_PLACE)),this.parent||S(i,e.width)),f.bind(window,"resize",function(){i.onResize()}),f.bind(this.__ul,"webkitTransitionEnd",function(){i.onResize()}),f.bind(this.__ul,"transitionend",function(){i.onResize()}),f.bind(this.__ul,"oTransitionEnd",function(){i.onResize()}),this.onResize(),e.resizable&&y(this),i.getRoot(),e.parent||n()};return V.toggleHide=function(){N=!N,p.each(O,function(e){e.domElement.style.zIndex=N?-999:999,e.domElement.style.opacity=N?0:1})},V.CLASS_AUTO_PLACE="a",V.CLASS_AUTO_PLACE_CONTAINER="ac",V.CLASS_MAIN="main",V.CLASS_CONTROLLER_ROW="cr",V.CLASS_TOO_TALL="taller-than-window",V.CLASS_CLOSED="closed",V.CLASS_CLOSE_BUTTON="close-button",V.CLASS_DRAG="drag",V.DEFAULT_WIDTH=245,V.TEXT_CLOSED="Close Controls",V.TEXT_OPEN="Open Controls",f.bind(window,"keydown",function(e){"text"!==document.activeElement.type&&(72===e.which||72==e.keyCode)&&V.toggleHide()},!1),p.extend(V.prototype,{add:function(e,t){return m(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return m(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;p.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&L.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};return t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),t=new V(t),this.__folders[e]=t,e=g(this,t.domElement),f.addClass(e,"folder"),t},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=f.getOffset(e.__ul).top,n=0;p.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=f.getHeight(t))}),n>window.innerHeight-t-20?(f.addClass(e.domElement,V.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(f.removeClass(e.domElement,V.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&p.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){if(p.isUndefined(R)&&(R=new h,R.domElement.innerHTML=t),this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;p.each(Array.prototype.slice.call(arguments),function(t){0==e.__rememberedObjects.length&&v(e),-1==e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&S(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=x(this)),e.folders={},p.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=x(this),C(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[E]=x(this,!0)),this.load.remembered[e]=x(this),this.preset=e,w(this,e,!0)},revert:function(e){p.each(this.__controllers,function(t){this.getRoot().load.remembered?b(e||this.getRoot(),t):t.setValue(t.initialValue)},this),p.each(this.__folders,function(e){e.revert(e)}),e||C(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e),t&&F(this.__listening)}}),V}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",dat.controllers.factory=function(e,t,n,i,o,r,s){return function(a,l,d,c){var u=a[l];
return s.isArray(d)||s.isObject(d)?new e(a,l,d):s.isNumber(u)?s.isNumber(d)&&s.isNumber(c)?new n(a,l,d,c):new t(a,l,{min:d,max:c}):s.isString(u)?new i(a,l):s.isFunction(u)?new o(a,l,""):s.isBoolean(u)?new r(a,l):void 0}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,t,n){var i=function(e,n){function o(){r.setValue(r.__input.value)}i.superclass.call(this,e,n);var r=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",o),t.bind(this.__input,"change",o),t.bind(this.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return i.superclass=e,n.extend(i.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),i.superclass.prototype.updateDisplay.call(this)}}),i}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,t,n,i,o){function r(e,t,n,i){e.style.background="",o.each(l,function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "})}function s(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var a=function(e,l){function d(e){f(e),t.bind(window,"mousemove",f),t.bind(window,"mouseup",c)}function c(){t.unbind(window,"mousemove",f),t.unbind(window,"mouseup",c)}function u(){var e=i(this.value);e!==!1?(m.__color.__state=e,m.setValue(m.__color.toOriginal())):this.value=""+m.__color}function h(){t.unbind(window,"mousemove",p),t.unbind(window,"mouseup",h)}function f(e){e.preventDefault();var n=t.getWidth(m.__saturation_field),i=t.getOffset(m.__saturation_field),o=(e.clientX-i.left+document.body.scrollLeft)/n,e=1-(e.clientY-i.top+document.body.scrollTop)/n;return e>1?e=1:0>e&&(e=0),o>1?o=1:0>o&&(o=0),m.__color.v=e,m.__color.s=o,m.setValue(m.__color.toOriginal()),!1}function p(e){e.preventDefault();var n=t.getHeight(m.__hue_field),i=t.getOffset(m.__hue_field),e=1-(e.clientY-i.top+document.body.scrollTop)/n;return e>1?e=1:0>e&&(e=0),m.__color.h=360*e,m.setValue(m.__color.toOriginal()),!1}a.superclass.call(this,e,l),this.__color=new n(this.getValue()),this.__temp=new n(0);var m=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){13===e.keyCode&&u.call(this)}),t.bind(this.__input,"blur",u),t.bind(this.__selector,"mousedown",function(){t.addClass(this,"drag").bind(window,"mouseup",function(){t.removeClass(m.__selector,"drag")})});var g=document.createElement("div");o.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),o.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),o.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),o.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),o.extend(g.style,{width:"100%",height:"100%",background:"none"}),r(g,"top","rgba(0,0,0,0)","#000"),o.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),s(this.__hue_field),o.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",d),t.bind(this.__field_knob,"mousedown",d),t.bind(this.__hue_field,"mousedown",function(e){p(e),t.bind(window,"mousemove",p),t.bind(window,"mouseup",h)}),this.__saturation_field.appendChild(g),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};a.superclass=e,o.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=i(this.getValue());if(e!==!1){var t=!1;o.each(n.COMPONENTS,function(n){return o.isUndefined(e[n])||o.isUndefined(this.__color.__state[n])||e[n]===this.__color.__state[n]?void 0:(t=!0,{})},this),t&&o.extend(this.__color.__state,e)}o.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=.5>this.__color.v||this.__color.s>.5?255:0,a=255-s;o.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:""+this.__temp,border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,r(this.__saturation_field,"left","#fff",""+this.__temp),o.extend(this.__input.style,{backgroundColor:this.__input.value=""+this.__color,color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}});var l=["-moz-","-o-","-webkit-","-ms-",""];return a}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,t,n,i){function o(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(s(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(s(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function r(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(a(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(a(this),this.__state.space="HSV"),this.__state[t]=e}})}function s(e,n,o){if("HEX"===e.__state.space)e.__state[n]=t.component_from_hex(e.__state.hex,o);else{if("HSV"!==e.__state.space)throw"Corrupted color state";i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function a(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:n.s,v:n.v}),i.isNaN(n.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var l=function(){if(this.__state=e.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS="r,g,b,h,s,v,hex,a".split(","),i.extend(l.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),o(l.prototype,"r",2),o(l.prototype,"g",1),o(l.prototype,"b",0),r(l.prototype,"h"),r(l.prototype,"s"),r(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),l}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var i=e/60-Math.floor(e/60),o=n*(1-t),r=n*(1-i*t),t=n*(1-(1-i)*t),e=[[n,t,o],[r,n,o],[o,n,t],[o,r,n],[t,o,n],[n,o,r]][Math.floor(e/60)%6];return{r:255*e[0],g:255*e[1],b:255*e[2]}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),o=Math.max(e,t,n),i=o-i;return 0==o?{h:0/0,s:0,v:0}:(e=e==o?(t-n)/i:t==o?2+(n-e)/i:4+(e-t)/i,e/=6,0>e&&(e+=1),{h:360*e,s:i/o,v:o/255})},rgb_to_hex:function(e,t,n){return e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t),e=this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return 255&e>>8*t},hex_with_component:function(t,n,i){return i<<(e=8*n)|t&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,t){var n=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",n),e.unbind(t.domElement,"transitionend",n),e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common),function(){function e(){t(),i(),o(),s(),f(),p(),R.randomize(),d(I.offsetWidth,I.offsetHeight),c()}function t(){C=new FSS.WebGLRenderer,F=new FSS.CanvasRenderer,A=new FSS.SVGRenderer,n(O.renderer)}function n(e){switch(v&&P.removeChild(v.element),e){case L:v=C;break;case T:v=F;break;case N:v=A}v.setSize(I.offsetWidth,I.offsetHeight),P.appendChild(v.element)}function i(){y=new FSS.Scene}function o(){y.remove(S),v.clear(),x=new FSS.Plane(k.width*v.width,k.height*v.height,k.slices),w=new FSS.Material(k.ambient,k.diffuse),S=new FSS.Mesh(x,w),y.add(S);var e,t;for(e=x.vertices.length-1;e>=0;e--)t=x.vertices[e],t.depth=Math.randomInRange(0,k.maxdepth/10),t.anchor=FSS.Vector3.clone(t.position)}function r(e,t,n,i,o){e=e!==void 0?e:R.ambient,t=t!==void 0?t:g(),n=n!==void 0?n:R.xPos,i=i!==void 0?i:R.yPos,o=o!==void 0?o:R.zOffset,v.clear(),light=new FSS.Light(e,t),light.ambientHex=light.ambient.format(),light.diffuseHex=light.diffuse.format(),light.setPosition(n,i,o),y.add(light),R.diffuse=t,R.proxy=light,R.pickedup=!0,R.currIndex++}function s(){for(var e=Math.floor(4*Math.random())+1,t=e-1;t>=0;t--)r(),R.count++}function a(e){for(l=e;y.lights.length>=l;l++)light=y.lights[l],y.remove(light),R.currIndex--;R.proxy=y.lights[R.currIndex-1],R.pickedup=!1,v.clear()}function d(e,t){v.setSize(e,t),FSS.Vector3.set(B,v.halfWidth,v.halfHeight),o()}function c(){u(),h(),requestAnimationFrame(c)}function u(){var e,t,n=k.depth/100;for(e=x.vertices.length-1;e>=0;e--)t=x.vertices[e],FSS.Vector3.set(t.position,1,1,t.depth*n),FSS.Vector3.add(t.position,t.anchor);x.dirty=!0}function h(){v.render(y)}function f(){window.addEventListener("resize",_),I.addEventListener("mousemove",b)}function p(){var e,t,i;E=new dat.GUI({autoPlace:!1}),M.appendChild(E.domElement),renderFolder=E.addFolder("Render"),meshFolder=E.addFolder("Mesh"),lightFolder=E.addFolder("Light"),exportFolder=E.addFolder("Export"),lightFolder.open(),i=renderFolder.add(O,"renderer",{webgl:L,canvas:T,svg:N}),i.onChange(function(e){n(e)}),i=meshFolder.addColor(k,"ambient"),i.onChange(function(n){for(e=0,t=y.meshes.length;t>e;e++)y.meshes[e].material.ambient.set(n)}),i=meshFolder.addColor(k,"diffuse"),i.onChange(function(n){for(e=0,t=y.meshes.length;t>e;e++)y.meshes[e].material.diffuse.set(n)}),i=meshFolder.add(k,"width",.05,2),i.onChange(function(e){x.width!==e*v.width&&o()}),i=meshFolder.add(k,"height",.05,2),i.onChange(function(e){x.height!==e*v.height&&o()}),i=meshFolder.add(k,"depth",0,k.maxdepth).listen(),i=meshFolder.add(k,"slices",1,800),i.step(1),i.onChange(function(e){x.slices!==e&&o()}),i=lightFolder.add(R,"currIndex",{1:1,2:2,3:3,4:4,5:5,6:6,7:7}).name("Current light").listen(),i.onChange(function(e){R.proxy=y.lights[e-1],R.ambient=R.proxy.ambient.hex,R.diffuse=R.proxy.diffuse.hex,R.xPos=R.proxy.position[0],R.yPos=R.proxy.position[1],R.zOffset=R.proxy.position[2],E.__folders.Light.__controllers[1].updateDisplay(),E.__folders.Light.__controllers[2].updateDisplay()}),i=lightFolder.addColor(R,"ambient"),i.onChange(function(e){R.proxy.ambient.set(e),R.proxy.ambientHex=R.proxy.ambient.format()}),i=lightFolder.addColor(R,"diffuse"),i.onChange(function(e){R.proxy.diffuse.set(e),R.proxy.diffuseHex=R.proxy.diffuse.format()}),i=lightFolder.add(R,"count",1,7).listen(),i.step(1),i.onChange(function(e){y.lights.length!==e&&(e>y.lights.length?r():a(e))}),i=lightFolder.add(R,"xPos",-S.geometry.width/2,S.geometry.width/2).listen(),i.step(1),i.onChange(function(e){R.proxy.setPosition(e,R.proxy.position[1],R.proxy.position[2])}),i=lightFolder.add(R,"yPos",-S.geometry.height/2,S.geometry.height/2).listen(),i.step(1),i.onChange(function(e){R.proxy.setPosition(R.proxy.position[0],e,R.proxy.position[2])}),i=lightFolder.add(R,"zOffset",0,1e3).name("Distance").listen(),i.step(1),i.onChange(function(e){R.proxy.setPosition(R.proxy.position[0],R.proxy.position[1],e)}),i=lightFolder.add(R,"randomize"),i=exportFolder.add(V,"width",100,3e3),i.step(100),i=exportFolder.add(V,"height",100,3e3),i.step(100),i=exportFolder.add(V,"export").name("export big"),i=exportFolder.add(V,"exportCurrent").name("export this")}function m(e){var t=document.getElementById(e);t.style.display="block"==t.style.display?"none":"block"}function g(){return"#"+(Math.random().toString(16)+"000000").slice(2,8)}function _(){d(I.offsetWidth,I.offsetHeight),h()}function b(e){R.pickedup&&(R.xPos=e.x-v.width/2,R.yPos=v.height/2-e.y,R.proxy.setPosition(R.xPos,R.yPos,R.proxy.position[2]))}var v,y,S,x,w,C,F,A,E,k={width:1.2,height:1.2,slices:250,depth:0,maxdepth:200,ambient:"#555555",diffuse:"#FFFFFF"},R={count:0,xPos:0,yPos:200,zOffset:100,ambient:"#880066",diffuse:"#FF8800",pickedup:!0,proxy:!1,currIndex:0,randomize:function(){var e,t,n,i=Math.floor(3*Math.random())+1;for(1==i&&(k.depth=0),2==i&&(k.depth=Math.randomInRange(0,150)),3==i&&(k.depth=Math.randomInRange(150,200)),l=y.lights.length-1;l>=0;l--){e=Math.randomInRange(-S.geometry.width/2,S.geometry.width/2),t=Math.randomInRange(-S.geometry.height/2,S.geometry.height/2),n=y.lights.length>2?Math.randomInRange(10,80):Math.randomInRange(10,100),light=y.lights[l],FSS.Vector3.set(light.position,e,t,n);var o=g(),r=g();light.diffuse.set(o),light.diffuseHex=light.diffuse.format(),light.ambient.set(r),light.ambientHex=light.ambient.format(),R.xPos=e,R.yPos=t,R.zOffset=n,R.diffuse=o,R.ambient=r,E.__folders.Light.__controllers[1].updateDisplay(),E.__folders.Light.__controllers[2].updateDisplay()}}},L="webgl",T="canvas",N="svg",O={renderer:T},V={width:2e3,height:1e3,exportCurrent:function(){switch(O.renderer){case L:C.element.toBlob(function(e){saveAs(e,"triangles-download.png")},"image/png");break;case T:F.element.toBlob(function(e){saveAs(e,"triangles-download.png")},"image/png");break;case N:var e=new Blob([P.innerHTML],{type:"image/svg+xml"});saveAs(e,"triangles-download.svg")}},"export":function(){var e,t,n,i,o=this.width/v.width,r=this.height/v.height,s=k.slices;for(k.slices=Math.ceil(1.4*s*o),d(this.width,this.height),k.slices=s,e=y.lights.length-1;e>=0;e--)i=y.lights[e],t=i.position[0],n=i.position[1],z=i.position[2],FSS.Vector3.set(i.position,t*o,n*r,z*o);switch(u(),h(),O.renderer){case L:C.element.toBlob(function(e){saveAs(e,"triangles-download.png")},"image/png");break;case T:F.element.toBlob(function(e){saveAs(e,"triangles-download.png")},"image/png");break;case N:var a=new Blob([P.innerHTML],{type:"image/svg+xml"});saveAs(a,"triangles-download.svg")}for(d(I.offsetWidth,I.offsetHeight),e=y.lights.length-1;e>=0;e--)i=y.lights[e],t=i.position[0],n=i.position[1],z=i.position[2],FSS.Vector3.set(i.position,t/o,n/r,z/o)}},B=FSS.Vector3.create(),I=document.getElementById("container"),M=document.getElementById("controls"),P=document.getElementById("output");Mousetrap.bind("H",function(){m("controls"),m("links")}),Mousetrap.bind("enter",function(){R.count++,r()}),Mousetrap.bind("space",function(){R.pickedup=!R.pickedup}),e()}();