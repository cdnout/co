L.TileLayer.Ajax=L.TileLayer.extend({_requests:[],_addTile:function(e){var t={datum:null,processed:!1};this._tiles[e.x+":"+e.y]=t,this._loadTile(t,e)},_xhrHandler:function(e,t,i,a){return function(){if(4===e.readyState){var r=e.status;r>=200&&r<300&&204!=r||304===r?(i.datum=JSON.parse(e.responseText),t._tileLoaded(i,a)):t._tileLoaded(i,a)}}},_loadTile:function(e,t){this._adjustTilePoint(t);var i=this,a=new XMLHttpRequest;this._requests.push(a),a.onreadystatechange=this._xhrHandler(a,i,e,t),a.open("GET",this.getTileUrl(t),!0),a.send()},_reset:function(){L.TileLayer.prototype._reset.apply(this,arguments);for(var e=0;e<this._requests.length;e++)this._requests[e].abort();this._requests=[]},_update:function(){this._map&&this._map._panTransition&&this._map._panTransition._inProgress||(this._tilesToLoad<0&&(this._tilesToLoad=0),L.TileLayer.prototype._update.apply(this,arguments))}}),L.TileLayer.GeoJSON=L.TileLayer.Ajax.extend({_keyLayers:{},_clipPathRectangles:{},initialize:function(e,t,i){L.TileLayer.Ajax.prototype.initialize.call(this,e,t),this.geojsonLayer=new L.GeoJSON(null,i)},onAdd:function(e){this._map=e,L.TileLayer.Ajax.prototype.onAdd.call(this,e),e.addLayer(this.geojsonLayer)},onRemove:function(e){e.removeLayer(this.geojsonLayer),L.TileLayer.Ajax.prototype.onRemove.call(this,e)},_reset:function(){this.geojsonLayer.clearLayers(),this._keyLayers={},this._removeOldClipPaths(),L.TileLayer.Ajax.prototype._reset.apply(this,arguments)},_getUniqueId:function(){return String(this._leaflet_id||"")},_removeOldClipPaths:function(){for(var e in this._clipPathRectangles){var t=e.split("tileClipPath")[0];if(this._getUniqueId()===t){var i=e.split("_").slice(1),a=parseInt(i[0],10);if(a!==this._map.getZoom()){var r=this._clipPathRectangles[e];this._map.removeLayer(r);var s=document.getElementById(e);null!==s&&s.parentNode.removeChild(s),delete this._clipPathRectangles[e]}}}},_recurseLayerUntilPath:function(e,t){t instanceof L.Path?e(t):t instanceof L.LayerGroup&&t.getLayers().forEach(this._recurseLayerUntilPath.bind(this,e),this)},_clipLayerToTileBoundary:function(e,t){if(L.Path.SVG&&this._map){this._map._pathRoot||(this._map._pathRoot=L.Path.prototype._createElement("svg"),this._map._panes.overlayPane.appendChild(this._map._pathRoot));var i=this._map._pathRoot,a=null;0===i.getElementsByTagName("defs").length?(a=document.createElementNS(L.Path.SVG_NS,"defs"),i.insertBefore(a,i.firstChild)):a=i.getElementsByTagName("defs")[0];var r=this._getUniqueId()+"tileClipPath_"+t.z+"_"+t.x+"_"+t.y,s=document.getElementById(r);if(null===s){s=document.createElementNS(L.Path.SVG_NS,"clipPath"),s.id=r;var o=this.options.tileSize,n=t.multiplyBy(o),l=n.add([o,o]),h=this._map.unproject(n),p=this._map.unproject(l);this._clipPathRectangles[r]=new L.Rectangle(new L.LatLngBounds([h,p]),{opacity:0,fillOpacity:0,clickable:!1,noClip:!0}),this._map.addLayer(this._clipPathRectangles[r]);var y=document.createElementNS(L.Path.SVG_NS,"path"),u=this._clipPathRectangles[r].getPathString();y.setAttribute("d",u),s.appendChild(y),a.appendChild(s)}this._recurseLayerUntilPath(function(e){e._container.setAttribute("clip-path","url("+window.location.href+"#"+r+")")},e)}},addTileData:function(e,t){var i,a,r,s=L.Util.isArray(e)?e:e.features;if(s){for(i=0,a=s.length;i<a;i++)r=s[i],(r.geometries||r.geometry||r.features||r.coordinates)&&this.addTileData(s[i],t);return this}var o=this.geojsonLayer.options;if(!o.filter||o.filter(e)){var n=this.geojsonLayer,l=null;if(this.options.unique&&"function"==typeof this.options.unique){var h=this.options.unique(e);h in this._keyLayers&&"GeometryCollection"!==e.geometry.type||(e.geometry={type:"GeometryCollection",geometries:[e.geometry]});try{l=L.GeoJSON.geometryToLayer(e,o.pointToLayer,o.coordsToLatLng)}catch(e){return this}l.feature=L.GeoJSON.asFeature(e),h in this._keyLayers?(n=this._keyLayers[h],n.feature.geometry.geometries.push(e.geometry)):this._keyLayers[h]=l}else{try{l=L.GeoJSON.geometryToLayer(e,o.pointToLayer,o.coordsToLatLng)}catch(e){return this}l.feature=L.GeoJSON.asFeature(e)}return l.defaultOptions=l.options,this.geojsonLayer.resetStyle(l),o.onEachFeature&&o.onEachFeature(e,l),n.addLayer(l),this.options.clipTiles&&this._clipLayerToTileBoundary(l,t),this}},_tileLoaded:function(e,t){return L.TileLayer.Ajax.prototype._tileLoaded.apply(this,arguments),null===e.datum?null:void this.addTileData(e.datum,t)}});
//# sourceMappingURL=TileLayer.GeoJSON.min.js.map