"use strict";var Record=require("./record"),EventEmitter=require("component-emitter2"),AnonymousRecord=function(r){this.name=null,this._recordHandler=r,this._record=null,this._subscriptions=[],this._proxyMethod("delete"),this._proxyMethod("set"),this._proxyMethod("discard")};EventEmitter(AnonymousRecord.prototype),AnonymousRecord.prototype.get=function(r){if(null!==this._record)return this._record.get(r)},AnonymousRecord.prototype.subscribe=function(){var r=Record.prototype._normalizeArguments(arguments);r.triggerNow=!0,this._subscriptions.push(r),null!==this._record&&this._record.subscribe(r)},AnonymousRecord.prototype.unsubscribe=function(){var r=Record.prototype._normalizeArguments(arguments),o=[],t=void 0;for(t=0;t<this._subscriptions.length;t++)this._subscriptions[t].path===r.path&&this._subscriptions[t].callback===r.callback||o.push(this._subscriptions[t]);this._subscriptions=o,null!==this._record&&this._record.unsubscribe(r)},AnonymousRecord.prototype.setName=function(r){if(this.name!==r){this.name=r;var o=void 0;if(null!==this._record&&!this._record.isDestroyed){for(o=0;o<this._subscriptions.length;o++)this._record.unsubscribe(this._subscriptions[o]);this._record.discard()}for(this._record=this._recordHandler.getRecord(r),o=0;o<this._subscriptions.length;o++)this._record.subscribe(this._subscriptions[o]);this._record.whenReady(this.emit.bind(this,"ready")),this.emit("nameChanged",r)}},AnonymousRecord.prototype._proxyMethod=function(r){this[r]=this._callMethodOnRecord.bind(this,r)},AnonymousRecord.prototype._callMethodOnRecord=function(r){if(null===this._record)throw new Error("Can`t invoke "+r+". AnonymousRecord not initialised. Call setName first");if("function"!=typeof this._record[r])throw new Error(r+" is not a method on the record");var o=Array.prototype.slice.call(arguments,1);return this._record[r].apply(this._record,o)},module.exports=AnonymousRecord;