"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},utils=require("../utils/utils"),PARTS_REG_EXP=/([^.[\]\s]+)/g,cache=Object.create(null);function patch(e,t,r){var o=void 0,n=void 0;if(null===e||null===t)return t;if(Array.isArray(e)&&Array.isArray(t)){var i=void 0;for(o=0;o<t.length;o++){var u=patch(e[o],t[o],!1);if(!i){if(u===e[o])continue;for(i=[],n=0;n<o;++n)i[n]=e[n]}i[o]=u}return i=(i=i&&!1!==r?utils.deepCopy(i):i)||(e.length===t.length?e:t)}if(Array.isArray(t)||"object"!==(void 0===e?"undefined":_typeof(e))||"object"!==(void 0===t?"undefined":_typeof(t)))return t!==e?!1!==r?utils.deepCopy(t):t:e;var l=void 0,a=Object.keys(t);for(o=0;o<a.length;o++){var c=patch(e[a[o]],t[a[o]],!1);if(!l){if(c===e[a[o]])continue;for(l=Object.create(null),n=0;n<o;++n)l[a[n]]=e[a[n]]}l[a[o]]=t[a[o]]}return l=(l=l&&!1!==r?utils.deepCopy(l):l)||(Object.keys(e).length===a.length?e:t)}function tokenize(e){if(cache[e])return cache[e];var t="undefined"!==String(e)?String(e).match(PARTS_REG_EXP):[];if(!t)throw new Error("invalid path "+e);return cache[e]=t,cache[e]}module.exports.get=function(e,t,r){for(var o=tokenize(t),n=e,i=0;i<o.length;i++){if(void 0===n)return;if("object"!==(void 0===n?"undefined":_typeof(n)))throw new Error("invalid data or path");n=n[o[i]]}return!1!==r?utils.deepCopy(n):n},module.exports.set=function(e,t,r,o){var n=tokenize(t);if(0===n.length)return patch(e,r,o);var i=module.exports.get(e,t,!1),u=patch(i,r,o);if(u===i)return e;for(var l=utils.shallowCopy(e),a=l,c=0;c<n.length;c++)c===n.length-1?a[n[c]]=u:a=void 0!==a[n[c]]?a[n[c]]=utils.shallowCopy(a[n[c]]):n[c+1]&&!isNaN(n[c+1])?a[n[c]]=[]:a[n[c]]=Object.create(null);return l};