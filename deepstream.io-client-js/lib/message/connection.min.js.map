{"version":3,"sources":["connection.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","BrowserWebSocket","global","WebSocket","MozWebSocket","NodeWebSocket","require","messageParser","messageBuilder","utils","C","Connection","client","url","options","this","_client","_options","_authParams","_authCallback","_deliberateClose","_redirecting","_tooManyAuthAttempts","_connectionAuthenticationTimeout","_challengeDenied","_queuedMessages","_reconnectTimeout","_reconnectionAttempt","_currentPacketMessageCount","_sendNextPacketTimeout","_currentMessageResetTimeout","_endpoint","_lastHeartBeat","_heartbeatInterval","_originalUrl","parseUrl","path","_url","_state","CONNECTION_STATE","CLOSED","_createEndpoint","getState","authenticate","authParams","callback","AWAITING_AUTHENTICATION","_sendAuthParams","_$onError","TOPIC","ERROR","EVENT","IS_CLOSED","INVALID_AUTH_MSG","sendMsg","topic","action","data","send","getMsg","message","push","nextTick","_resetCurrentMessageCount","bind","OPEN","length","maxMessagesPerPacket","_sendQueuedMessages","_queueNextPacket","close","clearInterval","_setState","nodeSocketOptions","onopen","_onOpen","onerror","_onError","onclose","_onClose","onmessage","_onMessage","readyState","splice","join","_submit","fn","delay","timeBetweenSendingQueuedPackages","setTimeout","AUTHENTICATING","authMessage","AUTH","ACTIONS","REQUEST","_checkHeartBeat","heartBeatTolerance","heartbeatInterval","Date","now","CONNECTION","CONNECTION_ERROR","_clearReconnect","setInterval","AWAITING_CONNECTION","error","_this","msg","code","JSON","stringify","e","toString","_tryReconnect","parsedMessages","parse","i","_handleConnectionResponse","_handleAuthResponse","_$onMessage","PING","PONG","ACK","CHALLENGE","CHALLENGING","CHALLENGE_RESPONSE","REJECTION","REDIRECT","CONNECTION_AUTHENTICATION_TIMEOUT","TOO_MANY_AUTH_ATTEMPTS","_getAuthData","undefined","convertTyped","state","emit","CONNECTION_STATE_CHANGED","maxReconnectAttempts","RECONNECTING","_tryOpen","Math","min","maxReconnectInterval","reconnectIntervalIncrement","MAX_RECONNECTION_ATTEMPTS_REACHED","clearTimeout","module","exports"],"mappings":"AAAA,aAEA,IAAIA,QAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUC,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXF,QAAyBE,EAAIC,cAAgBH,QAAUE,IAAQF,OAAOI,UAAY,gBAAkBF,GAElQG,iBAAmBC,OAAOC,WAAaD,OAAOE,aAC9CC,cAAgBC,QAAQ,MACxBC,cAAgBD,QAAQ,oBACxBE,eAAiBF,QAAQ,qBACzBG,MAAQH,QAAQ,kBAChBI,EAAIJ,QAAQ,0BAWZK,WAAa,SAAoBC,EAAQC,EAAKC,GAChDC,KAAKC,QAAUJ,EACfG,KAAKE,SAAWH,EAChBC,KAAKG,YAAc,KACnBH,KAAKI,cAAgB,KACrBJ,KAAKK,kBAAmB,EACxBL,KAAKM,cAAe,EACpBN,KAAKO,sBAAuB,EAC5BP,KAAKQ,kCAAmC,EACxCR,KAAKS,kBAAmB,EACxBT,KAAKU,gBAAkB,GACvBV,KAAKW,kBAAoB,KACzBX,KAAKY,qBAAuB,EAC5BZ,KAAKa,2BAA6B,EAClCb,KAAKc,uBAAyB,KAC9Bd,KAAKe,4BAA8B,KACnCf,KAAKgB,UAAY,KACjBhB,KAAKiB,eAAiB,KACtBjB,KAAKkB,mBAAqB,KAE1BlB,KAAKmB,aAAezB,MAAM0B,SAAStB,EAAKE,KAAKE,SAASmB,MACtDrB,KAAKsB,KAAOtB,KAAKmB,aAEjBnB,KAAKuB,OAAS5B,EAAE6B,iBAAiBC,OACjCzB,KAAK0B,mBAUP9B,WAAWX,UAAU0C,SAAW,WAC9B,OAAO3B,KAAKuB,QAed3B,WAAWX,UAAU2C,aAAe,SAAUC,EAAYC,GACxD,GAAgF,iBAArD,IAAfD,EAA6B,YAAcjD,QAAQiD,IAA/D,CAQA,GAHA7B,KAAKG,YAAc0B,EACnB7B,KAAKI,cAAgB0B,IAEjB9B,KAAKO,sBAAwBP,KAAKS,kBAAoBT,KAAKQ,kCAGxD,OAA8B,IAA1BR,KAAKK,kBAA6BL,KAAKuB,SAAW5B,EAAE6B,iBAAiBC,QAC9EzB,KAAK0B,uBACL1B,KAAKK,kBAAmB,SAItBL,KAAKuB,SAAW5B,EAAE6B,iBAAiBO,yBACrC/B,KAAKgC,mBATLhC,KAAKC,QAAQgC,UAAUtC,EAAEuC,MAAMC,MAAOxC,EAAEyC,MAAMC,UAAW,4CARzDrC,KAAKC,QAAQgC,UAAUtC,EAAEuC,MAAMC,MAAOxC,EAAEyC,MAAME,iBAAkB,gCAiCpE1C,WAAWX,UAAUsD,QAAU,SAAUC,EAAOC,EAAQC,GACtD1C,KAAK2C,KAAKlD,eAAemD,OAAOJ,EAAOC,EAAQC,KAajD9C,WAAWX,UAAU0D,KAAO,SAAUE,GACpC7C,KAAKU,gBAAgBoC,KAAKD,GAC1B7C,KAAKa,6BAEoC,OAArCb,KAAKe,8BACPf,KAAKe,4BAA8BrB,MAAMqD,SAAS/C,KAAKgD,0BAA0BC,KAAKjD,QAGpFA,KAAKuB,SAAW5B,EAAE6B,iBAAiB0B,MAAQlD,KAAKU,gBAAgByC,OAASnD,KAAKE,SAASkD,sBAAwBpD,KAAKa,2BAA6Bb,KAAKE,SAASkD,qBACjKpD,KAAKqD,sBACoC,OAAhCrD,KAAKc,wBACdd,KAAKsD,oBAYT1D,WAAWX,UAAUsE,MAAQ,WAC3BC,cAAcxD,KAAKkB,oBACnBlB,KAAKK,kBAAmB,EACxBL,KAAKgB,UAAUuC,QACfvD,KAAKyD,UAAU9D,EAAE6B,iBAAiBC,SAUpC7B,WAAWX,UAAUyC,gBAAkB,WACrC1B,KAAKgB,UAAY9B,iBAAmB,IAAIA,iBAAiBc,KAAKsB,MAAQ,IAAIhC,cAAcU,KAAKsB,KAAMtB,KAAKE,SAASwD,mBAEjH1D,KAAKgB,UAAU2C,OAAS3D,KAAK4D,QAAQX,KAAKjD,MAC1CA,KAAKgB,UAAU6C,QAAU7D,KAAK8D,SAASb,KAAKjD,MAC5CA,KAAKgB,UAAU+C,QAAU/D,KAAKgE,SAASf,KAAKjD,MAC5CA,KAAKgB,UAAUiD,UAAYjE,KAAKkE,WAAWjB,KAAKjD,OAgBlDJ,WAAWX,UAAU+D,0BAA4B,WAC/ChD,KAAKa,2BAA6B,EAClCb,KAAKe,4BAA8B,MAWrCnB,WAAWX,UAAUoE,oBAAsB,WACzC,GAAIrD,KAAKuB,SAAW5B,EAAE6B,iBAAiB0B,MAAQlD,KAAKgB,UAAUmD,aAAenE,KAAKgB,UAAUkC,KAI5F,GAAoC,IAAhClD,KAAKU,gBAAgByC,OAAzB,CAKA,IAAIN,EAAU7C,KAAKU,gBAAgB0D,OAAO,EAAGpE,KAAKE,SAASkD,sBAAsBiB,KAAK,IAElD,IAAhCrE,KAAKU,gBAAgByC,OACvBnD,KAAKsD,mBAELtD,KAAKc,uBAAyB,KAGhCd,KAAKsE,QAAQzB,QAZX7C,KAAKc,uBAAyB,MAwBlClB,WAAWX,UAAUqF,QAAU,SAAUzB,GACnC7C,KAAKgB,UAAUmD,aAAenE,KAAKgB,UAAUkC,KAC/ClD,KAAKgB,UAAU2B,KAAKE,GAEpB7C,KAAK8D,SAAS,2DAWlBlE,WAAWX,UAAUqE,iBAAmB,WACtC,IAAIiB,EAAKvE,KAAKqD,oBAAoBJ,KAAKjD,MACnCwE,EAAQxE,KAAKE,SAASuE,iCAE1BzE,KAAKc,uBAAyB4D,WAAWH,EAAIC,IAU/C5E,WAAWX,UAAU+C,gBAAkB,WACrChC,KAAKyD,UAAU9D,EAAE6B,iBAAiBmD,gBAClC,IAAIC,EAAcnF,eAAemD,OAAOjD,EAAEuC,MAAM2C,KAAMlF,EAAEmF,QAAQC,QAAS,CAAC/E,KAAKG,cAC/EH,KAAKsE,QAAQM,IAQfhF,WAAWX,UAAU+F,gBAAkB,WACrC,IAAIC,EAAuD,EAAlCjF,KAAKE,SAASgF,kBAEnCC,KAAKC,MAAQpF,KAAKiB,eAAiBgE,IACrCzB,cAAcxD,KAAKkB,oBACnBlB,KAAKgB,UAAUuC,QACfvD,KAAKC,QAAQgC,UAAUtC,EAAEuC,MAAMmD,WAAY1F,EAAEyC,MAAMkD,iBAAkB,sCAAwCL,EAAqB,mBAYtIrF,WAAWX,UAAU2E,QAAU,WAC7B5D,KAAKuF,kBACLvF,KAAKiB,eAAiBkE,KAAKC,MAC3BpF,KAAKkB,mBAAqBxB,MAAM8F,YAAYxF,KAAKgF,gBAAgB/B,KAAKjD,MAAOA,KAAKE,SAASgF,mBAC3FlF,KAAKyD,UAAU9D,EAAE6B,iBAAiBiE,sBAepC7F,WAAWX,UAAU6E,SAAW,SAAU4B,GACxC,IAAIC,EAAQ3F,KAEZwD,cAAcxD,KAAKkB,oBACnBlB,KAAKyD,UAAU9D,EAAE6B,iBAAiBW,OAMlCuC,WAAW,WACT,IAAIkB,OAAM,EACV,GAAmB,eAAfF,EAAMG,MAAwC,iBAAfH,EAAMG,KACvCD,EAAM,mDAAsDD,EAAMxE,kBAElE,IACEyE,EAAME,KAAKC,UAAUL,GACrB,MAAOM,GACPJ,EAAMF,EAAMO,WAGhBN,EAAM1F,QAAQgC,UAAUtC,EAAEuC,MAAMmD,WAAY1F,EAAEyC,MAAMkD,iBAAkBM,IACrE,IAcLhG,WAAWX,UAAU+E,SAAW,WAC9BR,cAAcxD,KAAKkB,qBAEO,IAAtBlB,KAAKM,cACPN,KAAKM,cAAe,EACpBN,KAAK0B,oBAC8B,IAA1B1B,KAAKK,iBACdL,KAAKyD,UAAU9D,EAAE6B,iBAAiBC,QAElCzB,KAAKkG,iBAYTtG,WAAWX,UAAUiF,WAAa,SAAUrB,GAG1C,IAFA,IAAIsD,EAAiB3G,cAAc4G,MAAMvD,EAAQH,KAAM1C,KAAKC,SAEnDoG,EAAI,EAAGA,EAAIF,EAAehD,OAAQkD,IACf,OAAtBF,EAAeE,KAERF,EAAeE,GAAG7D,QAAU7C,EAAEuC,MAAMmD,WAC7CrF,KAAKsG,0BAA0BH,EAAeE,IACrCF,EAAeE,GAAG7D,QAAU7C,EAAEuC,MAAM2C,KAC7C7E,KAAKuG,oBAAoBJ,EAAeE,IAExCrG,KAAKC,QAAQuG,YAAYL,EAAeE,MA2B9CzG,WAAWX,UAAUqH,0BAA4B,SAAUzD,GACrDA,EAAQJ,SAAW9C,EAAEmF,QAAQ2B,MAC/BzG,KAAKiB,eAAiBkE,KAAKC,MAC3BpF,KAAKsE,QAAQ7E,eAAemD,OAAOjD,EAAEuC,MAAMmD,WAAY1F,EAAEmF,QAAQ4B,QACxD7D,EAAQJ,SAAW9C,EAAEmF,QAAQ6B,KACtC3G,KAAKyD,UAAU9D,EAAE6B,iBAAiBO,yBAC9B/B,KAAKG,aACPH,KAAKgC,mBAEEa,EAAQJ,SAAW9C,EAAEmF,QAAQ8B,WACtC5G,KAAKyD,UAAU9D,EAAE6B,iBAAiBqF,aAClC7G,KAAKsE,QAAQ7E,eAAemD,OAAOjD,EAAEuC,MAAMmD,WAAY1F,EAAEmF,QAAQgC,mBAAoB,CAAC9G,KAAKmB,iBAClF0B,EAAQJ,SAAW9C,EAAEmF,QAAQiC,WACtC/G,KAAKS,kBAAmB,EACxBT,KAAKuD,SACIV,EAAQJ,SAAW9C,EAAEmF,QAAQkC,UACtChH,KAAKsB,KAAOuB,EAAQH,KAAK,GACzB1C,KAAKM,cAAe,EACpBN,KAAKgB,UAAUuC,SACNV,EAAQJ,SAAW9C,EAAEmF,QAAQ3C,OAClCU,EAAQH,KAAK,KAAO/C,EAAEyC,MAAM6E,oCAC9BjH,KAAKK,kBAAmB,EACxBL,KAAKQ,kCAAmC,EACxCR,KAAKC,QAAQgC,UAAUtC,EAAEuC,MAAMmD,WAAYxC,EAAQH,KAAK,GAAIG,EAAQH,KAAK,MAgB/E9C,WAAWX,UAAUsH,oBAAsB,SAAU1D,GACnD,GAAIA,EAAQJ,SAAW9C,EAAEmF,QAAQ3C,MAAO,CAEtC,GAAIU,EAAQH,KAAK,KAAO/C,EAAEyC,MAAM8E,uBAC9BlH,KAAKK,kBAAmB,EACxBL,KAAKO,sBAAuB,MACvB,CAAA,GAAIsC,EAAQH,KAAK,KAAO/C,EAAEyC,MAAME,iBAOrC,OANAtC,KAAKK,kBAAmB,OAEpBL,KAAKI,eACPJ,KAAKI,eAAc,EAAO,mCAK5BJ,KAAKyD,UAAU9D,EAAE6B,iBAAiBO,yBAGhC/B,KAAKI,eACPJ,KAAKI,eAAc,EAAOJ,KAAKmH,aAAatE,EAAQH,KAAK,UAElDG,EAAQJ,SAAW9C,EAAEmF,QAAQ6B,MACtC3G,KAAKyD,UAAU9D,EAAE6B,iBAAiB0B,MAE9BlD,KAAKI,eACPJ,KAAKI,eAAc,EAAMJ,KAAKmH,aAAatE,EAAQH,KAAK,KAG1D1C,KAAKqD,wBAaTzD,WAAWX,UAAUkI,aAAe,SAAUzE,GAC5C,YAAa0E,IAAT1E,EACK,KAEFlD,cAAc6H,aAAa3E,EAAM1C,KAAKC,UAU/CL,WAAWX,UAAUwE,UAAY,SAAU6D,GACzCtH,KAAKuB,OAAS+F,EACdtH,KAAKC,QAAQsH,KAAK5H,EAAEyC,MAAMoF,yBAA0BF,IAatD1H,WAAWX,UAAUiH,cAAgB,WACJ,OAA3BlG,KAAKW,oBAILX,KAAKY,qBAAuBZ,KAAKE,SAASuH,sBAC5CzH,KAAKyD,UAAU9D,EAAE6B,iBAAiBkG,cAClC1H,KAAKW,kBAAoB+D,WAAW1E,KAAK2H,SAAS1E,KAAKjD,MAAO4H,KAAKC,IAAI7H,KAAKE,SAAS4H,qBAAsB9H,KAAKE,SAAS6H,2BAA6B/H,KAAKY,uBAC3JZ,KAAKY,yBAELZ,KAAKuF,kBACLvF,KAAKuD,QACLvD,KAAKC,QAAQsH,KAAK5H,EAAEyC,MAAM4F,kCAAmChI,KAAKY,yBAUtEhB,WAAWX,UAAU0I,SAAW,WAC1B3H,KAAKmB,eAAiBnB,KAAKsB,OAC7BtB,KAAKsB,KAAOtB,KAAKmB,cAEnBnB,KAAK0B,kBACL1B,KAAKW,kBAAoB,MAY3Bf,WAAWX,UAAUsG,gBAAkB,WACrC0C,aAAajI,KAAKW,mBAClBX,KAAKW,kBAAoB,KACzBX,KAAKY,qBAAuB,GAG9BsH,OAAOC,QAAUvI"}