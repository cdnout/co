"use strict";var C=require("../constants/constants"),MessageParser=function(){this._actions=this._getActions()};MessageParser.prototype.parse=function(r,t){for(var s=[],e=r.split(C.MESSAGE_SEPERATOR),E=0;E<e.length;E++)2<e[E].length&&s.push(this._parseMessage(e[E],t));return s},MessageParser.prototype.convertTyped=function(t,s){var r=t.charAt(0);if(r===C.TYPES.STRING)return t.substr(1);if(r===C.TYPES.OBJECT)try{return JSON.parse(t.substr(1))}catch(r){return void s._$onError(C.TOPIC.ERROR,C.EVENT.MESSAGE_PARSE_ERROR,r.toString()+"("+t+")")}return r===C.TYPES.NUMBER?parseFloat(t.substr(1)):r===C.TYPES.NULL?null:r===C.TYPES.TRUE||r!==C.TYPES.FALSE&&void(r!==C.TYPES.UNDEFINED&&s._$onError(C.TOPIC.ERROR,C.EVENT.MESSAGE_PARSE_ERROR,"UNKNOWN_TYPE ("+t+")"))},MessageParser.prototype._getActions=function(){var r={};for(var t in C.ACTIONS)r[C.ACTIONS[t]]=t;return r},MessageParser.prototype._parseMessage=function(r,t){var s=r.split(C.MESSAGE_PART_SEPERATOR),e={};return s.length<2?(t._$onError(C.TOPIC.ERROR,C.EVENT.MESSAGE_PARSE_ERROR,"Insufficiant message parts"),null):void 0===this._actions[s[1]]?(t._$onError(C.TOPIC.ERROR,C.EVENT.MESSAGE_PARSE_ERROR,"Unknown action "+s[1]),null):(e.raw=r,e.topic=s[0],e.action=s[1],e.data=s.splice(2),e)},module.exports=new MessageParser;