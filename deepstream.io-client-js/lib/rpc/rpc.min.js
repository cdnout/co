"use strict";var C=require("../constants/constants"),messageParser=require("../message/message-parser"),Rpc=function(e,t,s,i){this._options=s,this._response=t,this._client=i,this._ackTimeoutRegistry=i._$getAckTimeoutRegistry(),this._ackTimeout=this._ackTimeoutRegistry.add({topic:C.TOPIC.RPC,action:C.ACTIONS.ACK,name:e,timeout:this._options.rpcAckTimeout,callback:this.error.bind(this)}),this._responseTimeout=this._ackTimeoutRegistry.add({topic:C.TOPIC.RPC,action:C.ACTIONS.REQUEST,name:e,event:C.EVENT.RESPONSE_TIMEOUT,timeout:this._options.rpcResponseTimeout,callback:this.error.bind(this)})};Rpc.prototype.ack=function(){this._ackTimeoutRegistry.remove({ackId:this._ackTimeout})},Rpc.prototype.respond=function(e){var t=messageParser.convertTyped(e,this._client);this._response.callback?this._response.callback(null,t):this._response.resolve(t),this._complete()},Rpc.prototype.error=function(e){this._response.callback?this._response.callback(e.event||e):this._response.reject(e.event||e),this._complete()},Rpc.prototype._complete=function(){this._ackTimeoutRegistry.remove({ackId:this._ackTimeout}),this._ackTimeoutRegistry.remove({ackId:this._responseTimeout})},module.exports=Rpc;