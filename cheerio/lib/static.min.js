var serialize=require("dom-serializer"),select=require("css-select"),parse=require("./parse"),_={merge:require("lodash.merge"),defaults:require("lodash.defaults")};function render(e,t,r){if(t)"string"==typeof t&&(t=select(t,e._root,r));else{if(!e._root||!e._root.children)return"";t=e._root.children}return serialize(t,r)}exports.load=function(e,n){var i=require("./cheerio");n=_.defaults(n||{},i.prototype.options);var s=parse(e,n),p=function(e,t,r,o){return this instanceof p?(o=_.defaults(o||{},n),i.call(this,e,t,r||s,o)):new p(e,t,r,o)};return p.prototype=Object.create(i.prototype),(p.prototype.constructor=p).fn=p.prototype,p.prototype._originalRoot=s,_.merge(p,exports),p._root=s,p._options=n,p},exports.html=function(e,t){var r=require("./cheerio");return"[object Object]"!==Object.prototype.toString.call(e)||t||"length"in e||"type"in e||(t=e,e=void 0),render(this,e,t=_.defaults(t||{},this._options,r.prototype.options))},exports.xml=function(e){return render(this,e,_.defaults({xmlMode:!0},this._options))},exports.text=function(e){for(var t,r="",o=(e=e||this.root()).length,n=0;n<o;n++)"text"===(t=e[n]).type?r+=t.data:t.children&&"comment"!==t.type&&(r+=exports.text(t.children));return r},exports.parseHTML=function(e,t,r){var o;return e&&"string"==typeof e?("boolean"==typeof t&&(r=t),o=this.load(e),r||o("script").remove(),o.root()[0].children.slice()):null},exports.root=function(){return this(this._root)},exports.contains=function(e,t){if(t===e)return!1;for(;t&&t!==t.parent;)if((t=t.parent)===e)return!0;return!1};