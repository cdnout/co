"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addBack=exports.add=exports.end=exports.slice=exports.index=exports.toArray=exports.get=exports.eq=exports.last=exports.first=exports.has=exports.not=exports.is=exports.filterArray=exports.filter=exports.map=exports.each=exports.contents=exports.children=exports.siblings=exports.prevUntil=exports.prevAll=exports.prev=exports.nextUntil=exports.nextAll=exports.next=exports.closest=exports.parentsUntil=exports.parents=exports.parent=exports.find=void 0;var tslib_1=require("tslib"),domhandler_1=require("domhandler"),select=tslib_1.__importStar(require("cheerio-select")),utils_1=require("../utils"),static_1=require("../static"),htmlparser2_1=require("htmlparser2"),uniqueSort=htmlparser2_1.DomUtils.uniqueSort,reSiblingSelector=/^\s*[~+]/;function find(t){if(!t)return this._make([]);var r=this.toArray();if("string"!=typeof t){var e=utils_1.isCheerio(t)?t.toArray():[t];return this._make(e.filter(function(e){return r.some(function(t){return static_1.contains(t,e)})}))}var n=reSiblingSelector.test(t)?r:this.children().toArray(),e={context:r,root:null===(e=this._root)||void 0===e?void 0:e[0],xmlMode:this.options.xmlMode};return this._make(select.select(t,n,e))}function _getMatcher(i){return function(r){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return function(t){var e=i(r,this);return t&&(e=filterArray(e,t,this.options.xmlMode,null===(t=this._root)||void 0===t?void 0:t[0])),this._make(1<this.length&&1<e.length?n.reduce(function(t,e){return e(t)},e):e)}}}exports.find=find;var _matcher=_getMatcher(function(t,e){for(var r,n=[],i=0;i<e.length;i++){var s=t(e[i]);n.push(s)}return(r=new Array).concat.apply(r,n)}),_singleMatcher=_getMatcher(function(t,e){for(var r=[],n=0;n<e.length;n++){var i=t(e[n]);null!==i&&r.push(i)}return r});function _matchUntil(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=null,n=_getMatcher(function(r,t){var n=[];return utils_1.domEach(t,function(t){for(var e;(e=r(t))&&(null==i||!i(e,n.length));t=e)n.push(e)}),n}).apply(void 0,tslib_1.__spreadArray([t],e));return function(e,t){var r=this;i="string"==typeof e?function(t){return select.is(t,e,r.options)}:e?getFilterFn(e):null;t=n.call(this,t);return i=null,t}}function _removeDuplicates(t){return Array.from(new Set(t))}function closest(r){var n=this,i=[];return r&&utils_1.domEach(this,function(t){for(var e;t&&"root"!==t.type;){if(!r||filterArray([t],r,n.options.xmlMode,null===(e=n._root)||void 0===e?void 0:e[0]).length){t&&!i.includes(t)&&i.push(t);break}t=t.parent}}),this._make(i)}function contents(){var t=this.toArray().reduce(function(t,e){return domhandler_1.hasChildren(e)?t.concat(e.children):t},[]);return this._make(t)}function each(t){for(var e=0,r=this.length;e<r&&!1!==t.call(this[e],e,this[e]);)++e;return this}function map(t){for(var e=[],r=0;r<this.length;r++){var n=this[r],n=t.call(n,r,n);null!=n&&(e=e.concat(n))}return this._make(e)}function getFilterFn(r){return"function"==typeof r?function(t,e){return r.call(t,e,t)}:utils_1.isCheerio(r)?function(t){return Array.prototype.includes.call(r,t)}:function(t){return r===t}}function filter(t){return this._make(filterArray(this.toArray(),t,this.options.xmlMode,null===(t=this._root)||void 0===t?void 0:t[0]))}function filterArray(t,e,r,n){return"string"==typeof e?select.filter(e,t,{xmlMode:r,root:n}):t.filter(getFilterFn(e))}function is(t){var e=this.toArray();return"string"==typeof t?select.some(e.filter(utils_1.isTag),t,this.options):!!t&&e.some(getFilterFn(t))}function not(t){var e,r,n=this.toArray();return n="string"==typeof t?(e=new Set(select.filter(t,n,this.options)),n.filter(function(t){return!e.has(t)})):(r=getFilterFn(t),n.filter(function(t,e){return!r(t,e)})),this._make(n)}function has(r){var n=this;return this.filter("string"==typeof r?":has("+r+")":function(t,e){return 0<n._make(e).find(r).length})}function first(){return 1<this.length?this._make(this[0]):this}function last(){return 0<this.length?this._make(this[this.length-1]):this}function eq(t){return 0===(t=+t)&&this.length<=1?this:(t<0&&(t=this.length+t),this._make(null!==(t=this[t])&&void 0!==t?t:[]))}function get(t){return null==t?this.toArray():this[t<0?this.length+t:t]}function toArray(){return Array.prototype.slice.call(this)}function index(t){var e,t=null==t?(e=this.parent().children(),this[0]):"string"==typeof t?(e=this._make(t),this[0]):(e=this,utils_1.isCheerio(t)?t[0]:t);return Array.prototype.indexOf.call(e,t)}function slice(t,e){return this._make(Array.prototype.slice.call(this,t,e))}function end(){var t;return null!==(t=this.prevObject)&&void 0!==t?t:this._make([])}function add(t,e){e=this._make(t,e),e=uniqueSort(tslib_1.__spreadArray(tslib_1.__spreadArray([],this.get()),e.get()));return this._make(e)}function addBack(t){return this.prevObject?this.add(t?this.prevObject.filter(t):this.prevObject):this}exports.parent=_singleMatcher(function(t){t=t.parent;return t&&!domhandler_1.isDocument(t)?t:null},_removeDuplicates),exports.parents=_matcher(function(t){for(var e=[];t.parent&&!domhandler_1.isDocument(t.parent);)e.push(t.parent),t=t.parent;return e},uniqueSort,function(t){return t.reverse()}),exports.parentsUntil=_matchUntil(function(t){t=t.parent;return t&&!domhandler_1.isDocument(t)?t:null},uniqueSort,function(t){return t.reverse()}),exports.closest=closest,exports.next=_singleMatcher(function(t){return htmlparser2_1.DomUtils.nextElementSibling(t)}),exports.nextAll=_matcher(function(t){for(var e=[];t.next;)t=t.next,utils_1.isTag(t)&&e.push(t);return e},_removeDuplicates),exports.nextUntil=_matchUntil(function(t){return htmlparser2_1.DomUtils.nextElementSibling(t)},_removeDuplicates),exports.prev=_singleMatcher(function(t){return htmlparser2_1.DomUtils.prevElementSibling(t)}),exports.prevAll=_matcher(function(t){for(var e=[];t.prev;)t=t.prev,utils_1.isTag(t)&&e.push(t);return e},_removeDuplicates),exports.prevUntil=_matchUntil(function(t){return htmlparser2_1.DomUtils.prevElementSibling(t)},_removeDuplicates),exports.siblings=_matcher(function(e){return htmlparser2_1.DomUtils.getSiblings(e).filter(function(t){return utils_1.isTag(t)&&t!==e})},uniqueSort),exports.children=_matcher(function(t){return htmlparser2_1.DomUtils.getChildren(t).filter(utils_1.isTag)},_removeDuplicates),exports.contents=contents,exports.each=each,exports.map=map,exports.filter=filter,exports.filterArray=filterArray,exports.is=is,exports.not=not,exports.has=has,exports.first=first,exports.last=last,exports.eq=eq,exports.get=get,exports.toArray=toArray,exports.index=index,exports.slice=slice,exports.end=end,exports.add=add,exports.addBack=addBack;