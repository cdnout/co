"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clone=exports.text=exports.toString=exports.html=exports.empty=exports.replaceWith=exports.remove=exports.insertBefore=exports.before=exports.insertAfter=exports.after=exports.wrapAll=exports.unwrap=exports.wrapInner=exports.wrap=exports.prepend=exports.append=exports.prependTo=exports.appendTo=exports._makeDomArray=void 0;var tslib_1=require("tslib"),domhandler_1=require("domhandler"),domhandler_2=require("domhandler"),parse_1=tslib_1.__importStar(require("../parse")),static_1=require("../static"),utils_1=require("../utils"),htmlparser2_1=require("htmlparser2");function _makeDomArray(e,r){var n=this;return null==e?[]:utils_1.isCheerio(e)?r?utils_1.cloneDom(e.get()):e.get():Array.isArray(e)?e.reduce(function(e,t){return e.concat(n._makeDomArray(t,r))},[]):"string"==typeof e?parse_1.default(e,this.options,!1).children:r?utils_1.cloneDom([e]):[e]}function _insert(s){return function(){for(var n=this,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var o=this.length-1;return utils_1.domEach(this,function(e,t){var r;domhandler_1.hasChildren(e)&&(r="function"==typeof i[0]?i[0].call(e,t,static_1.html(e.children)):i,t=n._makeDomArray(r,t<o),s(t,e.children,e))})}}function uniqueSplice(e,t,r,n,i){for(var o,s=tslib_1.__spreadArray([t,r],n),a=e[t-1]||null,l=e[t+r]||null,p=0;p<n.length;++p){var h,u=n[p],c=u.parent;!c||-1<(h=c.children.indexOf(n[p]))&&(c.children.splice(h,1),i===c&&h<t&&s[0]--),u.parent=i,u.prev&&(u.prev.next=null!==(o=u.next)&&void 0!==o?o:null),u.next&&(u.next.prev=null!==(o=u.prev)&&void 0!==o?o:null),u.prev=n[p-1]||a,u.next=n[p+1]||l}return a&&(a.next=n[0]),l&&(l.prev=n[n.length-1]),e.splice.apply(e,s)}function appendTo(e){return(utils_1.isCheerio(e)?e:this._make(e)).append(this),this}function prependTo(e){return(utils_1.isCheerio(e)?e:this._make(e)).prepend(this),this}function _wrap(p){return function(e){for(var t=this.length-1,r=this.parents().last(),n=0;n<this.length;n++){var i=this[n],o="function"==typeof e?e.call(i,n,i):"string"!=typeof e||utils_1.isHtml(e)?e:r.find(e).clone(),o=this._makeDomArray(o,n<t)[0];if(o&&htmlparser2_1.DomUtils.hasChildren(o)){for(var s=o,a=0;a<s.children.length;){var l=s.children[a];utils_1.isTag(l)?(s=l,a=0):a++}p(i,s,[o])}}return this}}function unwrap(e){var r=this;return this.parent(e).not("body").each(function(e,t){r._make(t).replaceWith(t.children)}),this}function wrapAll(e){var t=this[0];if(t){for(var r=this._make("function"==typeof e?e.call(t,0,t):e).insertBefore(t),n=void 0,i=0;i<r.length;i++)"tag"===r[i].type&&(n=r[i]);for(var o=0;n&&o<n.children.length;){var s=n.children[o];"tag"===s.type?(n=s,o=0):o++}n&&this._make(n).append(this)}return this}function after(){for(var o=this,s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var a=this.length-1;return utils_1.domEach(this,function(e,t){var r,n,i=e.parent;htmlparser2_1.DomUtils.hasChildren(e)&&i&&((n=(r=i.children).indexOf(e))<0||(e="function"==typeof s[0]?s[0].call(e,t,static_1.html(e.children)):s,uniqueSplice(r,n+1,0,o._makeDomArray(e,t<a),i)))})}function insertAfter(e){var i=this;"string"==typeof e&&(e=this._make(e)),this.remove();var o=[];return this._makeDomArray(e).forEach(function(e){var t,r=i.clone().toArray(),n=e.parent;n&&((e=(t=n.children).indexOf(e))<0||(uniqueSplice(t,e+1,0,r,n),o.push.apply(o,r)))}),this._make(o)}function before(){for(var o=this,s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var a=this.length-1;return utils_1.domEach(this,function(e,t){var r,n,i=e.parent;htmlparser2_1.DomUtils.hasChildren(e)&&i&&((n=(r=i.children).indexOf(e))<0||(e="function"==typeof s[0]?s[0].call(e,t,static_1.html(e.children)):s,uniqueSplice(r,n,0,o._makeDomArray(e,t<a),i)))})}function insertBefore(e){var i=this,e=this._make(e);this.remove();var o=[];return utils_1.domEach(e,function(e){var t,r=i.clone().toArray(),n=e.parent;n&&((e=(t=n.children).indexOf(e))<0||(uniqueSplice(t,e,0,r,n),o.push.apply(o,r)))}),this._make(o)}function remove(e){e=e?this.filter(e):this;return utils_1.domEach(e,function(e){htmlparser2_1.DomUtils.removeElement(e),e.prev=e.next=e.parent=null}),this}function replaceWith(o){var s=this;return utils_1.domEach(this,function(e,t){var r,n,i=e.parent;i&&(r=i.children,n="function"==typeof o?o.call(e,t,e):o,t=s._makeDomArray(n),parse_1.update(t,null),n=r.indexOf(e),uniqueSplice(r,n,1,t,i),t.includes(e)||(e.parent=e.prev=e.next=null))})}function empty(){return utils_1.domEach(this,function(e){htmlparser2_1.DomUtils.hasChildren(e)&&(e.children.forEach(function(e){e.next=e.prev=e.parent=null}),e.children.length=0)})}function html(r){if(void 0===r){var e=this[0];return e&&htmlparser2_1.DomUtils.hasChildren(e)?static_1.html(e.children,this.options):null}var n=tslib_1.__assign(tslib_1.__assign({},this.options),{context:null});return utils_1.domEach(this,function(e){var t;htmlparser2_1.DomUtils.hasChildren(e)&&(e.children.forEach(function(e){e.next=e.prev=e.parent=null}),n.context=e,t=utils_1.isCheerio(r)?r.toArray():parse_1.default(""+r,n,!1).children,parse_1.update(t,e))})}function toString(){return static_1.html(this,this.options)}function text(r){var n=this;return void 0===r?static_1.text(this):"function"==typeof r?utils_1.domEach(this,function(e,t){text.call(n._make(e),r.call(e,t,static_1.text([e])))}):utils_1.domEach(this,function(e){var t;htmlparser2_1.DomUtils.hasChildren(e)&&(e.children.forEach(function(e){e.next=e.prev=e.parent=null}),t=new domhandler_2.Text(r),parse_1.update(t,e))})}function clone(){return this._make(utils_1.cloneDom(this.get()))}exports._makeDomArray=_makeDomArray,exports.appendTo=appendTo,exports.prependTo=prependTo,exports.append=_insert(function(e,t,r){uniqueSplice(t,t.length,0,e,r)}),exports.prepend=_insert(function(e,t,r){uniqueSplice(t,0,0,e,r)}),exports.wrap=_wrap(function(e,t,r){var n,i,o=e.parent;o&&(i=(n=o.children).indexOf(e),parse_1.update([e],t),uniqueSplice(n,i,0,r,o))}),exports.wrapInner=_wrap(function(e,t,r){domhandler_1.hasChildren(e)&&(parse_1.update(e.children,t),parse_1.update(r,e))}),exports.unwrap=unwrap,exports.wrapAll=wrapAll,exports.after=after,exports.insertAfter=insertAfter,exports.before=before,exports.insertBefore=insertBefore,exports.remove=remove,exports.replaceWith=replaceWith,exports.empty=empty,exports.html=html,exports.toString=toString,exports.text=text,exports.clone=clone;