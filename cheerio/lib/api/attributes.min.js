"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.toggleClass=exports.removeClass=exports.addClass=exports.hasClass=exports.removeAttr=exports.val=exports.data=exports.prop=exports.attr=void 0;var static_1=require("../static"),utils_1=require("../utils"),hasOwn=Object.prototype.hasOwnProperty,rspace=/\s+/,dataAttrPrefix="data-",primitives={null:null,true:!0,false:!1},rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,rbrace=/^{[^]*}$|^\[[^]*]$/;function getAttr(t,e,s){var r;if(t&&utils_1.isTag(t))return null!==(r=t.attribs)&&void 0!==r||(t.attribs={}),e?hasOwn.call(t.attribs,e)?!s&&rboolean.test(e)?e:t.attribs[e]:"option"===t.name&&"value"===e?static_1.text(t.children):"input"!==t.name||"radio"!==t.attribs.type&&"checkbox"!==t.attribs.type||"value"!==e?void 0:"on":t.attribs}function setAttr(t,e,s){null===s?removeAttribute(t,e):t.attribs[e]=""+s}function attr(r,a){if("object"!=typeof r&&void 0===a)return 1<arguments.length?this:getAttr(this[0],r,this.options.xmlMode);if("function"!=typeof a)return utils_1.domEach(this,function(s){utils_1.isTag(s)&&("object"==typeof r?Object.keys(r).forEach(function(t){var e=r[t];setAttr(s,t,e)}):setAttr(s,r,a))});if("string"!=typeof r)throw new Error("Bad combination of arguments.");return utils_1.domEach(this,function(t,e){utils_1.isTag(t)&&setAttr(t,r,a.call(t,e,t.attribs[r]))})}function getProp(t,e,s){if(t&&utils_1.isTag(t))return e in t?t[e]:!s&&rboolean.test(e)?void 0!==getAttr(t,e,!1):getAttr(t,e,s)}function setProp(t,e,s,r){e in t?t[e]=s:setAttr(t,e,!r&&rboolean.test(e)?s?"":null:""+s)}function prop(r,a){var i=this;if("string"==typeof r&&void 0===a)switch(r){case"style":var s=this.css(),t=Object.keys(s);return t.forEach(function(t,e){s[e]=t}),s.length=t.length,s;case"tagName":case"nodeName":t=this[0];return utils_1.isTag(t)?t.name.toUpperCase():void 0;case"outerHTML":return this.clone().wrap("<container />").parent().html();case"innerHTML":return this.html();default:return getProp(this[0],r,this.options.xmlMode)}if("object"==typeof r||void 0!==a){if("function"!=typeof a)return utils_1.domEach(this,function(s){utils_1.isTag(s)&&("object"==typeof r?Object.keys(r).forEach(function(t){var e=r[t];setProp(s,t,e,i.options.xmlMode)}):setProp(s,r,a,i.options.xmlMode))});if("object"==typeof r)throw new Error("Bad combination of arguments.");return utils_1.domEach(this,function(t,e){utils_1.isTag(t)&&setProp(t,r,a.call(t,e,getProp(t,r,i.options.xmlMode)),i.options.xmlMode)})}}function setData(t,e,s){var r=t;null!==(t=r.data)&&void 0!==t||(r.data={}),"object"==typeof e?Object.assign(r.data,e):"string"==typeof e&&void 0!==s&&(r.data[e]=s)}function readData(t,e){for(var s,r,a=null==e?(s=Object.keys(t.attribs).filter(function(t){return t.startsWith(dataAttrPrefix)})).map(function(t){return utils_1.camelCase(t.slice(dataAttrPrefix.length))}):(s=[dataAttrPrefix+utils_1.cssCase(e)],[e]),i=0;i<s.length;++i){var o=s[i],n=a[i];if(hasOwn.call(t.attribs,o)&&!hasOwn.call(t.data,n)){if(r=t.attribs[o],hasOwn.call(primitives,r))r=primitives[r];else if(r===String(Number(r)))r=Number(r);else if(rbrace.test(r))try{r=JSON.parse(r)}catch(t){}t.data[n]=r}}return null==e?t.data:r}function data(e,s){var t=this[0];if(t&&utils_1.isTag(t)){var r=t;return null!==(t=r.data)&&void 0!==t||(r.data={}),e?"object"==typeof e||void 0!==s?(utils_1.domEach(this,function(t){utils_1.isTag(t)&&("object"==typeof e?setData(t,e):setData(t,e,s))}),this):hasOwn.call(r.data,e)?r.data[e]:readData(r,e):readData(r)}}function val(t){var e=0===arguments.length,s=this[0];if(!s||!utils_1.isTag(s))return e?void 0:this;switch(s.name){case"textarea":return this.text(t);case"select":var r=this.find("option:selected");if(e)return this.attr("multiple")?r.toArray().map(function(t){return static_1.text(t.children)}):r.attr("value");if(null==this.attr("multiple")&&"object"==typeof t)return this;this.find("option").removeAttr("selected");for(var a="object"!=typeof t?[t]:t,i=0;i<a.length;i++)this.find('option[value="'+a[i]+'"]').attr("selected","");return this;case"input":case"option":return e?this.attr("value"):this.attr("value",t)}}function removeAttribute(t,e){t.attribs&&hasOwn.call(t.attribs,e)&&delete t.attribs[e]}function splitNames(t){return t?t.trim().split(rspace):[]}function removeAttr(t){for(var s=splitNames(t),r=this,e=0;e<s.length;e++)!function(e){utils_1.domEach(r,function(t){utils_1.isTag(t)&&removeAttribute(t,s[e])})}(e);return this}function hasClass(a){return this.toArray().some(function(t){var e=utils_1.isTag(t)&&t.attribs.class,s=-1;if(e&&a.length)for(;-1<(s=e.indexOf(a,s+1));){var r=s+a.length;if((0===s||rspace.test(e[s-1]))&&(r===e.length||rspace.test(e[r])))return!0}return!1})}function addClass(r){if("function"==typeof r)return utils_1.domEach(this,function(t,e){var s;utils_1.isTag(t)&&(s=t.attribs.class||"",addClass.call([t],r.call(t,e,s)))});if(!r||"string"!=typeof r)return this;for(var t=r.split(rspace),e=this.length,s=0;s<e;s++){var a=this[s];if(utils_1.isTag(a)){var i=getAttr(a,"class",!1);if(i){for(var o=" "+i+" ",n=0;n<t.length;n++){var l=t[n]+" ";o.includes(" "+l)||(o+=l)}setAttr(a,"class",o.trim())}else setAttr(a,"class",t.join(" ").trim())}}return this}function removeClass(s){if("function"==typeof s)return utils_1.domEach(this,function(t,e){utils_1.isTag(t)&&removeClass.call([t],s.call(t,e,t.attribs.class||""))});var i=splitNames(s),o=i.length,n=0===arguments.length;return utils_1.domEach(this,function(t){if(utils_1.isTag(t))if(n)t.attribs.class="";else{for(var e=splitNames(t.attribs.class),s=!1,r=0;r<o;r++){var a=e.indexOf(i[r]);0<=a&&(e.splice(a,1),s=!0,r--)}s&&(t.attribs.class=e.join(" "))}})}function toggleClass(s,r){if("function"==typeof s)return utils_1.domEach(this,function(t,e){utils_1.isTag(t)&&toggleClass.call([t],s.call(t,e,t.attribs.class||"",r),r)});if(!s||"string"!=typeof s)return this;for(var t=s.split(rspace),e=t.length,a="boolean"==typeof r?r?1:-1:0,i=this.length,o=0;o<i;o++){var n=this[o];if(utils_1.isTag(n)){for(var l=splitNames(n.attribs.class),u=0;u<e;u++){var c=l.indexOf(t[u]);0<=a&&c<0?l.push(t[u]):a<=0&&0<=c&&l.splice(c,1)}n.attribs.class=l.join(" ")}}return this}exports.attr=attr,exports.prop=prop,exports.data=data,exports.val=val,exports.removeAttr=removeAttr,exports.hasClass=hasClass,exports.addClass=addClass,exports.removeClass=removeClass,exports.toggleClass=toggleClass;