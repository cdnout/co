!function(t,e){var n="function"==typeof define,r="undefined"!=typeof module&&module.exports;n?(define("eventproxy_debug",function(){return function(){}}),define(["eventproxy_debug"],e)):r?module.exports=e(require("debug")("eventproxy")):this.EventProxy=e()}(0,function(t){t=t||function(){};var e=Array.prototype.slice,n=Array.prototype.concat,r=function(){if(!(this instanceof r))return new r;this._callbacks={},this._fired={}};r.prototype.addListener=function(e,n){return t("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push(n),this},r.prototype.bind=r.prototype.addListener,r.prototype.on=r.prototype.addListener,r.prototype.subscribe=r.prototype.addListener,r.prototype.headbind=function(e,n){return t("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].unshift(n),this},r.prototype.removeListener=function(e,n){var r=this._callbacks;if(e)if(n){var i=r[e];if(i)for(var o=i.length,l=0;l<o;l++)n===i[l]&&(t("Remove a listener of %s",e),i[l]=null)}else t("Remove all listeners of %s",e),r[e]=[];else t("Remove all listeners"),this._callbacks={};return this},r.prototype.unbind=r.prototype.removeListener,r.prototype.removeAllListeners=function(t){return this.unbind(t)},r.prototype.bindForAll=function(t){this.bind("__all__",t)},r.prototype.unbindForAll=function(t){this.unbind("__all__",t)},r.prototype.trigger=function(e,n){var r,i,o,l,p,s=2,a=this._callbacks;for(t("Emit event %s with data %j",e,n);s--;)if(i=s?e:"__all__",r=a[i])for(l=0,p=r.length;l<p;l++)if(o=r[l]){for(var u=[],f=s?1:0;f<arguments.length;f++)u.push(arguments[f]);o.apply(this,u)}else r.splice(l,1),l--,p--;return this},r.prototype.emit=r.prototype.trigger,r.prototype.fire=r.prototype.trigger,r.prototype.once=function(t,e){var n=this,r=function(){e.apply(n,arguments),n.unbind(t,r)};return this.bind(t,r),this};var i="undefined"!=typeof setImmediate&&setImmediate||"undefined"!=typeof process&&process.nextTick||function(t){setTimeout(t,0)};r.prototype.emitLater=function(){var t=this,e=arguments;i(function(){t.trigger.apply(t,e)})},r.prototype.immediate=function(t,e,n){return this.bind(t,e),this.trigger(t,n),this},r.prototype.asap=r.prototype.immediate;var o=function(n,r,i,o){var l=this,p=arguments.length,s=0,a={};if(p<3)return this;var u=e.call(arguments,0,-2),f=arguments[p-2],c=arguments[p-1];if("function"!=typeof f)return this;t("Assign listener for events %j, once is %s",u,!!c);for(var y=u.length,d=0;d<y;d++)!function(t){l[c?"once":"bind"](t,function(e){l._fired[t]=l._fired[t]||{},l._fired[t].data=e,a[t]||(a[t]=!0,s++)})}(u[d]);var h=function(e){if(!(s<y)&&a[e]){for(var n=[],r=0;r<y;r++)n.push(l._fired[u[r]].data);c&&l.unbindForAll(h),t("Events %j all emited with data %j",u,n),f.apply(null,n)}};l.bindForAll(h)};return r.prototype.all=function(t,e,r){var i=n.apply([],arguments);return i.push(!0),o.apply(this,i),this},r.prototype.assign=r.prototype.all,r.prototype.fail=function(t){var e=this;return e.once("error",function(){e.unbind(),t.apply(null,arguments)}),this},r.prototype.throw=function(){var t=this;t.emit.apply(t,["error"].concat(e.call(arguments)))},r.prototype.tail=function(){var t=n.apply([],arguments);return t.push(!1),o.apply(this,t),this},r.prototype.assignAll=r.prototype.tail,r.prototype.assignAlways=r.prototype.tail,r.prototype.after=function(e,n,r){if(0===n)return r.call(null,[]),this;var i=this,o=[];this._after=this._after||{};var l=e+"_group";this._after[l]={index:0,results:[]},t("After emit %s times, event %s's listenner will execute",n,e);var p=function(s,a){s===e&&(n--,o.push(a),n<1&&(t("Event %s was emit %s, and execute the listenner",e,n),i.unbindForAll(p),r.apply(null,[o]))),s===l&&(n--,i._after[l].results[a.index]=a.result,n<1&&(t("Event %s was emit %s, and execute the listenner",e,n),i.unbindForAll(p),r.call(null,i._after[l].results)))};return i.bindForAll(p),this},r.prototype.group=function(t,n){var r=this,i=t+"_group",o=r._after[i].index;return r._after[i].index++,function(t,l){if(t)return r.emit.apply(r,["error"].concat(e.call(arguments)));r.emit(i,{index:o,result:n?n.apply(null,e.call(arguments,1)):l})}},r.prototype.any=function(){var n=this,r=arguments[arguments.length-1],i=e.call(arguments,0,-1),o=i.join("_");t("Add listenner for Any of events %j emit",i),n.once(o,r);for(var l=0;l<i.length;l++)!function(e){n.bind(e,function(r){t("One of events %j emited, execute the listenner"),n.trigger(o,{data:r,eventName:e})})}(i[l])},r.prototype.not=function(e,n){var r=this;t("Add listenner for not event %s",e),r.bindForAll(function(r,i){r!==e&&(t("listenner execute of event %s emit, but not event %s.",r,e),n(i))})},r.prototype.done=function(t,n){var r=this;return function(i,o){if(i)return r.emit.apply(r,["error"].concat(e.call(arguments)));var l=e.call(arguments,1);return"string"==typeof t?n?r.emit(t,n.apply(null,l)):r.emit.apply(r,[t].concat(l)):arguments.length<=2?t(o):void t.apply(null,l)}},r.prototype.doneLater=function(t,e){var n=this.done(t,e);return function(t,e){var r=arguments;i(function(){n.apply(null,r)})}},r.create=function(){var t=new r,e=n.apply([],arguments);if(e.length){var i=e[e.length-1],o=e[e.length-2];"function"==typeof i&&"function"==typeof o&&(e.pop(),t.fail(i)),t.assign.apply(t,e)}return t},r.EventProxy=r,r});