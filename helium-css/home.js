var helium={callback:void 0,data:{},init:function(){if(helium.callback=arguments.length>0?arguments[0]:helium.report,!window.localStorage)throw new Error("localStorage API not found");helium.load(),helium.data.timeout=3e3,helium.save(),helium.checkstatus()},checkstatus:function(){if("undefined"==typeof helium.data.status&&(helium.data.status=0),0===helium.data.status){var e=["<h1>Paste a list of pages on your site you want to test</h1>",'<textarea id="cssdetectTextarea"></textarea><input type="button" id="cssdetectStart" value="Start"/>','<input type="button" id="cssdetectRestart" value="Reset to Beginning"/>'];helium.generateCSS();var t=document.createElement("div");return t.id="cssdetectID",t.innerHTML=e.join(""),helium.$("body")[0].appendChild(t),helium.on(helium.$("#cssdetectStart"),"click",function(){var e=document.getElementById("cssdetectTextarea").value.split("\n");helium.setPageList(e),helium.data.status=1,helium.data.findinglist=helium.data.pagelist.slice(0),helium.save(),helium.nav(helium.data.findinglist)},!1),helium.on(helium.$("#cssdetectRestart"),"click",function(){document.getElementById("cssdetectTextarea").value="",helium.reset()},!1),!1}return 1===helium.data.status?(helium.findstylesheets(),!1):2===helium.data.status?(helium.getcss(),!1):3===helium.data.status?(helium.checkcss(),!1):void(4===helium.data.status&&helium.callback())},report:function(){for(var e=!1,t=["<h1>CSS Detection Report</h1>",'<input type="button" id="cssreportResetID" value="New Test (Warning: This erases all data from the current test)"/>','<h2> <a id="cssreportDownloadReport" href="" target="_blank"> Download Report </a> </h2>','<div class="cell" id="cssdetectDesc">','<div class="green">Green: unmatched selectors</div>','<div class="black">Black: matched selectors that are defined with non-matched selectors</div>','<div class="red">Red: a malformed selector. ** Note: not all malformed selectors are bad. Chrome won\'t parse -moz extensions for example.</div>','<div class="blue">Blue: a selector with a pseudo-class. You must test these manually.</div>',"</div>"],s=["{G} Green: unmatched selectors","{B} Black: matched selectors that are defined with non-matched selectors","{R} Red: a malformed selector. ** Note: not all malformed selectors are bad. Chrome won't parse -moz extensions for example.","{BL} Blue: a selector with a pseudo-class. You must test these manually."],a=0;a<helium.data.stylesheets.length;a++){t.push('<h2><a href="'+helium.data.stylesheets[a].url+'">'+helium.data.stylesheets[a].url+"</a></h2>"),s.push("\r\nStylesheet: "+helium.data.stylesheets[a].url+"\r\n");var l=helium.data.stylesheets[a].selectors;if(l.length>0){t.push('<ul class="cell">');for(var i=0;i<l.length;i++){var n=[],o=0;s.push([]);for(var r=s.length-1,c=0;c<l[i].length;c++)l[i][c].s=helium.trim(l[i][c].s),l[i][c].v===!0&&l[i].length>1&&(n.push('<span class="matched_selector selector">'+l[i][c].s+"</span>"),s[r].push("{B}"+l[i][c].s),o++),"pseudo_class"===l[i][c].v&&(n.push('<span class="pseudo_class selector">'+l[i][c].s+"</span>"),s[r].push("{BL}"+l[i][c].s)),"invalid_selector"===l[i][c].v&&(n.push('<span class="invalid_selector selector">'+l[i][c].s+"</span>"),s[r].push("{R}"+l[i][c].s)),l[i][c].v===!1&&(n.push('<span class="selector">'+l[i][c].s+"</span>"),s[r].push("{G}"+l[i][c].s));if(o===l[i].length&&(n=[]),o=0,n.length>0){var u;e?(u=' class="alternate"',e=!1):(u="",e=!0),t.push("<li"+u+">"+n.join(", ")+"</li>"),s[r]=s[r].join(", ")}else s.pop()}t.push("</ul>")}else t.push('<div class="cell">No unmatched selectors found.</div>'),s.push("No unmatched selectors found.")}var d=document.createElement("div");d.id="cssdetectID",d.innerHTML=t.join(""),helium.generateCSS(),helium.$("body")[0].appendChild(d);for(var h=helium.$("#cssdetectID ul li"),m=0;m<h.length;m++)!function(){var e=m;helium.on(h[e],"click",function(){this.style.opacity="0.5"===this.style.opacity?"1":"0.5"},!1)}();if(helium.on(helium.$("#cssreportResetID"),"click",function(){helium.reset()},!1),window.URL.createObjectURL&&window.Blob){var p=new Blob([s.join("\r\n")],{type:"text/rtf"}),f=helium.$("#cssreportDownloadReport");f[0].href=window.URL.createObjectURL(p),f[0].download="helium-report.txt"}else helium.on(helium.$("#cssreportDownloadReport"),"click",function(){alert("Report downloads aren't supported in this browser. The necessary file api's aren't available. Use Chrome or Firefox.")})},generateCSS:function(){var e=["#cssdetectID{",'font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;',"font-size: 16px;","font-weight: bold;","color: #fff;","position: absolute;","z-index: 999999999;","top: 10%;","width: 80%;","left: 10%;","background-color: #3498db;","padding: 10px 20px 20px 20px;","border: none","}","#cssdetectID .cell{","background: #fff;","padding: 10px;","color: #000;","}","#cssdetectID div{","border:none;","}","#cssdetectID .alternate{","border: 1px solid #eee;","border-width: 1px 0 1px 0;","}","#cssdetectID ul{","list-style: none;","padding: 0;","margin: 0;","}","#cssdetectID li:hover{","background: #eee","}","#cssdetectID h1{","margin: 0 0 10px 0;","padding: 0;","font-size: 20px;","}","#cssdetectID h2{","margin: 0 0 0 0;","padding: 0;","font-size: 16px;","}","#cssdetectDesc{","background: #8ac6ed;","}","#cssdetectID textarea{","width: 100%;","height:300px;","border: none;","margin: 0 0 10px 0;","padding: 10px;","resize: none;","outline: 1px none transparent;","border-radius: 0;","}","#cssdetectID input{","background: #fff;","border: none;","padding: 10px 20px 10px 20px;","margin: 0 10px 0 0;","font-size: 18px;","cursor: pointer;","-webkit-appearance: button;","}","#cssdetectID input:hover{","background: #ecf0f1;","pointer: cursor;","}","#cssdetectID a{","color: #fff","}","#cssreportResetID{","position:absolute;","top: 10px;","right: 10px;","}","#cssdetectID .green, #cssdetectID .selector{","color: #009000;","}","#cssdetectID .black, #cssdetectID .matched_selector{","color: #000000;","}","#cssdetectID .red, #cssdetectID .invalid_selector{","color: #cc0000;","}","#cssdetectID .blue, #cssdetectID .pseudo_class{","color: #0000cc","}"],t=document.createElement("style");t.innerHTML=e.join(""),helium.$("body")[0].appendChild(t)},reset:function(){localStorage.removeItem("cssdetect");for(var e=helium.$("#cssdetectID"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);helium.init()},checkcss:function(){setTimeout(function(){for(var e=0;e<helium.data.pages.length;e++)if(helium.data.pages[e].url===helium.data.currenturl){for(var t=0;t<helium.data.pages[e].links.length;t++)for(var s=helium.data.pages[e].links[t],a=0;a<helium.data.stylesheets.length;a++)if(helium.data.stylesheets[a].url===s){for(var l=helium.data.stylesheets[a],i=0;i<l.selectors.length;i++)for(var n=0;n<l.selectors[i].length;n++){var o=helium.find(l.selectors[i][n].s);o===!0&&(l.selectors[i][n].v=!0),"invalid_selector"===o&&(l.selectors[i][n].v="invalid_selector"),"pseudo_class"===o&&(l.selectors[i][n].v="pseudo_class")}a=helium.data.stylesheets.length}e=helium.data.pages.length}helium.save(),helium.data.pagelist.length>0?helium.nav():(helium.data.status=4,helium.save(),helium.callback())},helium.data.timeout)},find:function(e){try{if(helium.$(e).length>0)return!0}catch(t){return"invalid_selector"}var s=e.match(/\:+[\w-]+/gi);return null!==s&&s.hasOwnProperty("length")&&s.length>0?"pseudo_class":!1},findstylesheets:function(){for(var e={url:helium.data.currenturl,links:[]},t=helium.$('link[rel="stylesheet"]'),s=0;s<t.length;s++){var a=t[s].getAttribute("href");if(0!==a.indexOf("http")&&"//"!==a.substr(0,2)){if(0!==a.indexOf("/")){var l,i=window.location.pathname.lastIndexOf("/");l=i>0?window.location.pathname.substring(0,i+1):"/",a=l+a}a=window.location.protocol+"//"+window.location.hostname+":"+window.location.port+a}-1!==a.indexOf(window.location.hostname)&&(e.links.push(a),"undefined"==typeof helium.data.stylesheets&&(helium.data.stylesheets=[]),helium.data.stylesheets.push(a))}if("undefined"==typeof helium.data.pages&&(helium.data.pages=[]),helium.data.pages.push(e),helium.save(),helium.data.findinglist.length>0)helium.nav(helium.data.findinglist);else{helium.data.stylesheets.sort();for(var s=0;s<helium.data.stylesheets.length-1;s++)helium.data.stylesheets[s]===helium.data.stylesheets[s+1]&&helium.data.stylesheets.splice(s--,1);for(var s=0;s<helium.data.stylesheets.length;s++){var n=helium.data.stylesheets[s];helium.data.stylesheets[s]={url:n,selectors:[]}}helium.data.status=2,helium.save(),helium.checkstatus()}},getcss:function(){for(var e=0;e<helium.data.stylesheets.length;e++)helium.get(helium.data.stylesheets[e].url,e,function(e,t){t=t.replace(/\/\*[\s\S]*?\*\//gim,"");for(var s=t.replace(/\n/g,"").match(/[^\}]+[\.\#\-\w]?(?=\{)/gim)||[],a=[],l=0;l<s.length;l++){var i=s[l].split(",");if(i.length>1){for(var n=[],o=0;o<i.length;o++)""!==i[o]&&n.push({s:i[o],v:!1});a.push(n)}else a.push([{s:s[l],v:!1}])}helium.data.stylesheets[e].selectors=a,helium.save(),e===helium.data.stylesheets.length-1&&(helium.data.status=3,helium.nav())})},nav:function(e){e||(e=helium.data.pagelist);var t=e.shift();void 0!==t&&(helium.data.currenturl=t),helium.save(),void 0!==t&&(window.location=t)},setPageList:function(e){helium.data.pagelist=e,helium.save()},trim:function(e){return"function"==typeof String.prototype.trim?e.trim():e.replace(/^\s+/,"").replace(/\s+$/,"")},on:function(e,t,s){e=e[0]||e,e.addEventListener(t,s,!1)},load:function(){localStorage.cssdetect||(localStorage.cssdetect=JSON.stringify({})),helium.data=JSON.parse(localStorage.cssdetect)},save:function(){localStorage.cssdetect=JSON.stringify(helium.data)},clear:function(){delete localStorage.cssdetect},get:function(e,t,s){var a;a=window.attachEvent?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,a.open("GET",e),a.onreadystatechange=function(){4===a.readyState&&s(t,a.responseText)},a.send(null)},$:function(e){return document.querySelectorAll(e)}};