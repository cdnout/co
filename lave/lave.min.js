"use strict";export default function(e,c){c=c||{};var u=new Set,y=Math.random().toString(36).replace(/../,"_"),t=RegExp(y+"(\\d+)","g");let f=new Globals,d=[];e=function r(a){if(f.has(a))return f.get(a);let n=new Object;f.set(a,n);if(Object(a)!==a)return a<0?(n.type="UnaryExpression",n.operator="-",n.argument=r(Math.abs(a))):(n.value=a,n.type="Literal"),n;let o=Object.getPrototypeOf(a);let e=Object.getOwnPropertyNames(a);let p=new Map(e.map(e=>[e,Object.getOwnPropertyDescriptor(a,e)]));switch(o){case String.prototype:for(var s of p)if(p.delete(s[0]),"length"==s[0])break;case Number.prototype:case Boolean.prototype:n.type="CallExpression",n.callee=r(Object),n.arguments=[r(a.valueOf())];break;case RegExp.prototype:p.delete("source"),p.delete("global"),p.delete("ignoreCase"),p.delete("multiline"),p.delete("lastIndex"),n.type="Literal",n.value=a;break;case Date.prototype:n.type="NewExpression",n.callee=r(Date),n.arguments=[r(a.valueOf())];break;case Buffer.prototype:for(var i of p)if(p.delete(i[0]),"length"==i[0])break;n.type="CallExpression",n.callee=r(Buffer),n.arguments=[r(a.toString("base64")),r("base64")];break;case Error.prototype:case EvalError.prototype:case RangeError.prototype:case ReferenceError.prototype:case SyntaxError.prototype:case TypeError.prototype:case URIError.prototype:p.delete("message"),p.delete("stack"),n.type="NewExpression",n.callee=r(a.constructor),n.arguments=[r(a.message)];break;case Function.prototype:if(isNativeFunction(a))throw new Error("Native code cannot be serialized.");if(p.delete("length"),p.delete("name"),p.delete("arguments"),p.delete("caller"),a.prototype&&Object.getOwnPropertyNames(a.prototype).length<2&&p.delete("prototype"),c.generate){u.add(a);let e=Array.from(u).indexOf(a);n.type="Identifier",n.name=y+e;break}n.type="CallExpression",n.callee=r(eval),n.arguments=[r(`(${a.toString()})`)];break;case Array.prototype:n.elements=[];let e=p.get("length").value,t=String(e-1);e&&!p.has(t)||p.delete("length");for(var l of p){if(l[0]!=n.elements.length)break;let e=r(l[1].value);e.type?(n.elements.push(e),p.delete(l[0])):n.elements.push(null)}n.type="ArrayExpression";break;case Set.prototype:case WeakSet.prototype:case Map.prototype:case WeakMap.prototype:n.type="NewExpression",n.callee=r(a.constructor),n.arguments=[r(Array.from(a))];break;case Object.prototype:n.type="ObjectExpression",n.properties=Array.from(p).map(e=>(p.delete(e[0]),{type:"Property",key:r(e[0]),value:r(e[1].value)}));break;default:n.type="CallExpression",n.callee=r(Object.create),n.arguments=[r(o)]}for(var t of p)d.push({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:{type:"MemberExpression",object:n,computed:!isNaN(t[0]),property:{type:"Identifier",name:t[0]}},right:r(t[1].value)}});return n}(e),d.push({type:"ExpressionStatement",expression:e}),e=function(e){let t=function t(r,a,n,o){if(Object(o)===o&&"Identifier"!=o.type&&"Literal"!=o.type){let e=r.get(o);if(e)return e.push({object:a,key:n});for(var p in r.set(o,[{object:a,key:n}]),o)t(r,o,p,o[p]);return r}}(new Map,{"":e},"",e),r=[];for(var a of t)if(!(a[1].length<2)){var n,o={type:"Identifier"};for(n of a[1])n.object[n.key]=o;r.push({type:"VariableDeclarator",id:o,init:a[0]})}r.sort((e,t)=>has(e.init,t.id)-has(t.init,e.id));let p=new Identifiers;for(var s of r)s.id.name=p.next();return r}(d);switch(e.length&&d.unshift({type:"VariableDeclaration",declarations:e,kind:"var"}),c.format||"expression"){case"expression":break;case"module":d.push({type:"ExportDefaultDeclaration",declaration:d.pop().expression});break;case"function":d.push({type:"ReturnStatement",argument:d.pop().expression}),d=[{type:"ExpressionStatement",expression:{type:"FunctionExpression",params:[],body:{type:"BlockStatement",body:d}}}];break;default:throw new Error("Unsupported format: "+c.format)}e={type:"Program",body:d};if(!c.generate)return e;let r=generate(e);return r.replace(t,(e,t)=>Array.from(u)[t].toString().replace(/^function |^/,"function "))}class Identifiers{constructor(){this.id=0}next(){var e=(this.id++).toString(36);try{return Function("var "+e),e}catch(e){return this.next()}}}function has(e,t){if(e===t)return!0;if(Object(e)!==e)return!1;for(var r in e)if(has(e[r],t))return!0;return!1}let nativeCode=String(Object).match(/{.*/)[0];function isNativeFunction(e){let t=String(e);e=t.indexOf(nativeCode);return!(e<0)&&e+nativeCode.length===t.length}function Globals(){return crawl(new Map([[NaN,{type:"Identifier",name:"NaN"}],[null,{type:"Literal",value:null}],[void 0,{type:"Identifier",name:"undefined"}],[1/0,{type:"Identifier",name:"Infinity"}],[(0,eval)("this"),{type:"CallExpression",callee:{type:"SequenceExpression",expressions:[{type:"Literal",value:0},{type:"Identifier",name:"eval"}]},arguments:[{type:"Literal",value:"this"}]}]]),(0,eval)("this"))}function crawl(t,e,r){var a,n;let o=[];for(a of Object.getOwnPropertyNames(e)){var p=Object.getOwnPropertyDescriptor(e,a);if(Object(p.value)===p.value&&!t.has(p.value)){let e={type:"Identifier",name:a};r&&(e={type:"MemberExpression",object:r,property:e}),t.set(p.value,e),o.push({value:p.value,object:e})}}for(n of o)crawl(t,n.value,n.object);return t}