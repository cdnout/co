!function(t){"use strict";var e="object"==typeof process&&process.env?process.env:self;t.parser=function(t){return new u(t)},t.CParser=u,t.CStream=l,t.createStream=function(t){return new l(t)},t.MAX_BUFFER_LENGTH=65536,t.DEBUG="debug"===e.CDEBUG,t.INFO="debug"===e.CDEBUG||"info"===e.CDEBUG,t.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var s,i={textNode:void 0,numberNode:""},n=t.EVENTS.filter(function(t){return"error"!==t&&"end"!==t}),o=0;for(var r in t.STATE={BEGIN:o++,VALUE:o++,OPEN_OBJECT:o++,CLOSE_OBJECT:o++,OPEN_ARRAY:o++,CLOSE_ARRAY:o++,TEXT_ESCAPE:o++,STRING:o++,BACKSLASH:o++,END:o++,OPEN_KEY:o++,CLOSE_KEY:o++,TRUE:o++,TRUE2:o++,TRUE3:o++,FALSE:o++,FALSE2:o++,FALSE3:o++,FALSE4:o++,NULL:o++,NULL2:o++,NULL3:o++,NUMBER_DECIMAL_POINT:o++,NUMBER_DIGIT:o++},t.STATE)t.STATE[t.STATE[r]]=r;o=t.STATE;const h={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125};function a(t){for(var e in i)t[e]=i[e]}Object.create||(Object.create=function(t){function e(){this.__proto__=t}return e.prototype=t,new e}),Object.getPrototypeOf||(Object.getPrototypeOf=function(t){return t.__proto__}),Object.keys||(Object.keys=function(t){var e=[];for(var s in t)t.hasOwnProperty(s)&&e.push(s);return e});var c=/[\\"\n]/g;function u(e){if(!(this instanceof u))return new u(e);a(this),this.bufferCheckPosition=t.MAX_BUFFER_LENGTH,this.q=this.c=this.p="",this.opt=e||{},this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.state=o.BEGIN,this.stack=new Array,this.position=this.column=0,this.line=1,this.slashed=!1,this.unicodeI=0,this.unicodeS=null,this.depth=0,d(this,"onready")}u.prototype={end:function(){b(this)},write:function(e){if(this.error)throw this.error;if(this.closed)return _(this,"Cannot write after close. Assign an onready handler.");if(null===e)return b(this);var s=0,n=e.charCodeAt(0),r=this.p;t.DEBUG&&console.log("write -> ["+e+"]");for(;n&&(r=n,this.c=n=e.charCodeAt(s++),r!==n?this.p=r:r=this.p,n);)switch(t.DEBUG&&console.log(s,n,t.STATE[this.state]),this.position++,n===h.lineFeed?(this.line++,this.column=0):this.column++,this.state){case o.BEGIN:n===h.openBrace?this.state=o.OPEN_OBJECT:n===h.openBracket?this.state=o.OPEN_ARRAY:N(n)||_(this,"Non-whitespace before {[.");continue;case o.OPEN_KEY:case o.OPEN_OBJECT:if(N(n))continue;if(this.state===o.OPEN_KEY)this.stack.push(o.CLOSE_KEY);else{if(n===h.closeBrace){d(this,"onopenobject"),this.depth++,d(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||o.VALUE;continue}this.stack.push(o.CLOSE_OBJECT)}n===h.doubleQuote?this.state=o.STRING:_(this,'Malformed object key should start with "');continue;case o.CLOSE_KEY:case o.CLOSE_OBJECT:if(N(n))continue;this.state,o.CLOSE_KEY;n===h.colon?(this.state===o.CLOSE_OBJECT?(this.stack.push(o.CLOSE_OBJECT),p(this,"onopenobject"),this.depth++):p(this,"onkey"),this.state=o.VALUE):n===h.closeBrace?(f(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||o.VALUE):n===h.comma?(this.state===o.CLOSE_OBJECT&&this.stack.push(o.CLOSE_OBJECT),p(this),this.state=o.OPEN_KEY):_(this,"Bad object");continue;case o.OPEN_ARRAY:case o.VALUE:if(N(n))continue;if(this.state===o.OPEN_ARRAY){if(d(this,"onopenarray"),this.depth++,this.state=o.VALUE,n===h.closeBracket){d(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||o.VALUE;continue}this.stack.push(o.CLOSE_ARRAY)}n===h.doubleQuote?this.state=o.STRING:n===h.openBrace?this.state=o.OPEN_OBJECT:n===h.openBracket?this.state=o.OPEN_ARRAY:n===h.t?this.state=o.TRUE:n===h.f?this.state=o.FALSE:n===h.n?this.state=o.NULL:n===h.minus?this.numberNode+="-":h._0<=n&&n<=h._9?(this.numberNode+=String.fromCharCode(n),this.state=o.NUMBER_DIGIT):_(this,"Bad value");continue;case o.CLOSE_ARRAY:if(n===h.comma)this.stack.push(o.CLOSE_ARRAY),p(this,"onvalue"),this.state=o.VALUE;else if(n===h.closeBracket)f(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||o.VALUE;else{if(N(n))continue;_(this,"Bad array")}continue;case o.STRING:void 0===this.textNode&&(this.textNode="");var a=s-1,u=this.slashed,l=this.unicodeI;t:for(;;){for(t.DEBUG&&console.log(s,n,t.STATE[this.state],u);l>0;)if(this.unicodeS+=String.fromCharCode(n),n=e.charCodeAt(s++),this.position++,4===l?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),l=0,a=s-1):l++,!n)break t;if(n===h.doubleQuote&&!u){this.state=this.stack.pop()||o.VALUE,this.textNode+=e.substring(a,s-1),this.position+=s-1-a;break}if(n===h.backslash&&!u&&(u=!0,this.textNode+=e.substring(a,s-1),this.position+=s-1-a,n=e.charCodeAt(s++),this.position++,!n))break;if(u){if(u=!1,n===h.n?this.textNode+="\n":n===h.r?this.textNode+="\r":n===h.t?this.textNode+="\t":n===h.f?this.textNode+="\f":n===h.b?this.textNode+="\b":n===h.u?(l=1,this.unicodeS=""):this.textNode+=String.fromCharCode(n),n=e.charCodeAt(s++),this.position++,a=s-1,n)continue;break}c.lastIndex=s;var A=c.exec(e);if(null===A){s=e.length+1,this.textNode+=e.substring(a,s-1),this.position+=s-1-a;break}if(s=A.index+1,!(n=e.charCodeAt(A.index))){this.textNode+=e.substring(a,s-1),this.position+=s-1-a;break}}this.slashed=u,this.unicodeI=l;continue;case o.TRUE:n===h.r?this.state=o.TRUE2:_(this,"Invalid true started with t"+n);continue;case o.TRUE2:n===h.u?this.state=o.TRUE3:_(this,"Invalid true started with tr"+n);continue;case o.TRUE3:n===h.e?(d(this,"onvalue",!0),this.state=this.stack.pop()||o.VALUE):_(this,"Invalid true started with tru"+n);continue;case o.FALSE:n===h.a?this.state=o.FALSE2:_(this,"Invalid false started with f"+n);continue;case o.FALSE2:n===h.l?this.state=o.FALSE3:_(this,"Invalid false started with fa"+n);continue;case o.FALSE3:n===h.s?this.state=o.FALSE4:_(this,"Invalid false started with fal"+n);continue;case o.FALSE4:n===h.e?(d(this,"onvalue",!1),this.state=this.stack.pop()||o.VALUE):_(this,"Invalid false started with fals"+n);continue;case o.NULL:n===h.u?this.state=o.NULL2:_(this,"Invalid null started with n"+n);continue;case o.NULL2:n===h.l?this.state=o.NULL3:_(this,"Invalid null started with nu"+n);continue;case o.NULL3:n===h.l?(d(this,"onvalue",null),this.state=this.stack.pop()||o.VALUE):_(this,"Invalid null started with nul"+n);continue;case o.NUMBER_DECIMAL_POINT:n===h.period?(this.numberNode+=".",this.state=o.NUMBER_DIGIT):_(this,"Leading zero not followed by .");continue;case o.NUMBER_DIGIT:h._0<=n&&n<=h._9?this.numberNode+=String.fromCharCode(n):n===h.period?(-1!==this.numberNode.indexOf(".")&&_(this,"Invalid number has two dots"),this.numberNode+="."):n===h.e||n===h.E?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||_(this,"Invalid number has two exponential"),this.numberNode+="e"):n===h.plus||n===h.minus?(r!==h.e&&r!==h.E&&_(this,"Invalid symbol in number"),this.numberNode+=String.fromCharCode(n)):(E(this),s--,this.state=this.stack.pop()||o.VALUE);continue;default:_(this,"Unknown state: "+this.state)}this.position>=this.bufferCheckPosition&&function(e){var s=Math.max(t.MAX_BUFFER_LENGTH,10),n=0;for(var o in i){var r=void 0===e[o]?0:e[o].length;if(r>s)switch(o){case"text":closeText(e);break;default:_(e,"Max buffer length exceeded: "+o)}n=Math.max(n,r)}e.bufferCheckPosition=t.MAX_BUFFER_LENGTH-n+e.position}(this);return this},resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{s=require("stream").Stream}catch(t){s=function(){}}function l(t){if(!(this instanceof l))return new l(t);this._parser=new u(t),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var e=this;s.apply(e),this._parser.onend=function(){e.emit("end")},this._parser.onerror=function(t){e.emit("error",t),e._parser.error=null},n.forEach(function(t){Object.defineProperty(e,"on"+t,{get:function(){return e._parser["on"+t]},set:function(s){if(!s)return e.removeAllListeners(t),e._parser["on"+t]=s,s;e.on(t,s)},enumerable:!0,configurable:!1})})}function d(e,s,i){t.INFO&&console.log("-- emit",s,i),e[s]&&e[s](i)}function f(t,e,s){p(t),d(t,e,s)}function p(t,e){t.textNode=function(t,e){if(void 0===e)return e;t.trim&&(e=e.trim());t.normalize&&(e=e.replace(/\s+/g," "));return e}(t.opt,t.textNode),void 0!==t.textNode&&d(t,e||"onvalue",t.textNode),t.textNode=void 0}function E(t){t.numberNode&&d(t,"onvalue",parseFloat(t.numberNode)),t.numberNode=""}function _(t,e){return p(t),e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c,e=new Error(e),t.error=e,d(t,"onerror",e),t}function b(t){return t.state===o.VALUE&&0===t.depth||_(t,"Unexpected end"),p(t),t.c="",t.closed=!0,d(t,"onend"),u.call(t,t.opt),t}function N(t){return t===h.carriageReturn||t===h.lineFeed||t===h.space||t===h.tab}l.prototype=Object.create(s.prototype,{constructor:{value:l}}),l.prototype.write=function(t){t=new Buffer(t);for(var e=0;e<t.length;e++){var s=t[e];if(this.bytes_remaining>0){for(var i=0;i<this.bytes_remaining;i++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+i]=t[i];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,e=e+i-1,this._parser.write(this.string),this.emit("data",this.string)}else if(0===this.bytes_remaining&&s>=128){if(s>=194&&s<=223&&(this.bytes_in_sequence=2),s>=224&&s<=239&&(this.bytes_in_sequence=3),s>=240&&s<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+e>t.length){for(var n=0;n<=t.length-1-e;n++)this.temp_buffs[this.bytes_in_sequence][n]=t[e+n];return this.bytes_remaining=e+this.bytes_in_sequence-t.length,!0}this.string=t.slice(e,e+this.bytes_in_sequence).toString(),e=e+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string)}else{for(var o=e;o<t.length&&!(t[o]>=128);o++);this.string=t.slice(e,o).toString(),this._parser.write(this.string),this.emit("data",this.string),e=o-1}}},l.prototype.end=function(t){return t&&t.length&&this._parser.write(t.toString()),this._parser.end(),!0},l.prototype.on=function(t,e){var i=this;return i._parser["on"+t]||-1===n.indexOf(t)||(i._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),i.emit.apply(i,e)}),s.prototype.on.call(i,t,e)},l.prototype.destroy=function(){a(this._parser),this.emit("close")}}("undefined"==typeof exports?clarinet={}:exports);