!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/x6"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","@antv/x6","react","react-dom"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).X6ReactShape={},t.X6,t.React,t.ReactDom)}(this,function(r,o,n,t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(n),c=e(t),a=o.Registry.create({type:"react componnet"});o.Graph.registerReactComponent=a.register,o.Graph.unregisterReactComponent=a.unregister,o.Graph.Hook.prototype.getReactComponent=function(t){var e=this.options.getReactComponent;if("function"==typeof e){var n=o.FunctionExt.call(e,this.graph,t);if(null!=n)return n}n=t.getComponent();if("string"==typeof n){t=a.get(n);if(null==t)return a.onNotFound(n);n=t}return n};var p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function u(t,e){function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var l,s,f,d,h=function(){return(h=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function m(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var o=Array(t),r=0,e=0;e<n;e++)for(var i=arguments[e],c=0,a=i.length;c<a;c++,r++)o[r]=i[c];return o}function y(t,e){void 0===e&&(e="rect");e=[{tagName:e,selector:"body"}];return t?e.push(o.Markup.getForeignObjectMarkup()):e.push({tagName:"g",selector:"content"}),e.push({tagName:"text",selector:"label"}),e}function g(){return null!==d&&d.apply(this,arguments)||this}r.ReactShape=(u(g,d=o.Node),Object.defineProperty(g.prototype,"component",{get:function(){return this.getComponent()},set:function(t){this.setComponent(t)},enumerable:!1,configurable:!0}),g.prototype.getComponent=function(){return this.store.get("component")},g.prototype.setComponent=function(t,e){return void 0===e&&(e={}),null==t?this.removeComponent(e):this.store.set("component",t,e),this},g.prototype.removeComponent=function(t){return void 0===t&&(t={}),this.store.remove("component",t),this},g),(t=r.ReactShape||(r.ReactShape={})).config({view:"react-shape-view",markup:y(!0),attrs:{body:{fill:"none",stroke:"none",refWidth:"100%",refHeight:"100%"},fo:{refWidth:"100%",refHeight:"100%"},label:{fontSize:14,fill:"#333",refX:"50%",refY:"50%",textAnchor:"middle",textVerticalAnchor:"middle"}},propHooks:function(t){var e,n;return null==t.markup&&(e=t.primer,n=t.useForeignObject,null==e&&null==n||(t.markup=y(!1!==n,e),!e)||(null==t.attrs&&(t.attrs={}),n={},"circle"===e?n={refCx:"50%",refCy:"50%",refR:"50%"}:"ellipse"===e&&(n={refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%"}),"rect"!==e&&(t.attrs=o.ObjectExt.merge({},t.attrs,{body:h({refWidth:null,refHeight:null},n)})))),t}}),o.Node.registry.register("react-shape",t,!0),t=r.Portal||(r.Portal={}),s=!1,f=function(t,e){var n,o=e.payload;switch(e.type){case"add":return 0<=(n=t.findIndex(function(t){return t.id===o.id}))?(t[n]=o,m(t)):m(t,[o]);case"remove":if(0<=(n=t.findIndex(function(t){return t.id===o.id}))){e=m(t);return e.splice(n,1),e}}return t},t.connect=function(t,e){s&&l({type:"add",payload:{id:t,portal:e}})},t.disconnect=function(t){s&&l({type:"remove",payload:{id:t}})},t.isActive=function(){return s},t.getProvider=function(){return function(){s=!0;var t=n.useReducer(f,[]),e=t[0],t=t[1];return l=t,i.default.createElement(i.default.Fragment,{children:e.map(function(t){return t.portal})})}};var v,C,b=(u(R,v=i.default.PureComponent),R.prototype.componentDidMount=function(){var t=this;this.props.node.on("change:*",function(){t.setState({tick:t.state.tick+1})})},R.prototype.clone=function(t){var e=this.props.node;return"string"==typeof t.type?i.default.cloneElement(t):i.default.cloneElement(t,{node:e})},R.prototype.render=function(){var t=this.props,e=t.graph,n=t.node,t=t.component;if(i.default.isValidElement(t))return this.clone(t);if("function"==typeof t){n=o.FunctionExt.call(t,e,n);if(i.default.isValidElement(n))return this.clone(n)}return t},R);function R(){var t=null!==v&&v.apply(this,arguments)||this;return t.state={tick:0},t}function w(){return null!==C&&C.apply(this,arguments)||this}r.ReactShapeView=(u(w,C=o.NodeView),w.prototype.init=function(){var t=this;C.prototype.init.call(this),this.cell.on("removed",function(){r.Portal.disconnect(t.cell.id)})},w.prototype.getComponentContainer=function(){return!1===this.cell.prop("useForeignObject")?this.selectors.content:this.selectors.foContent},w.prototype.confirmUpdate=function(t){var e=this,t=C.prototype.confirmUpdate.call(this,t);return this.handleAction(t,w.action,function(){return e.renderReactComponent()})},w.prototype.renderReactComponent=function(){this.unmountReactComponent();var t,e=this.getComponentContainer(),n=this.cell,o=this.graph;e&&(t=this.graph.hook.getReactComponent(n),t=i.default.createElement(b,{graph:o,node:n,component:t}),r.Portal.isActive()?r.Portal.connect(this.cell.id,c.default.createPortal(t,e)):c.default.render(t,e))},w.prototype.unmountReactComponent=function(){var t=this.getComponentContainer();return t&&c.default.unmountComponentAtNode(t),t},w.prototype.onMouseDown=function(t,e,n){var o=t.target;if("input"===o.tagName.toLowerCase()){o=o.getAttribute("type");if(null==o||["text","password","number","email","search","tel","url"].includes(o))return}C.prototype.onMouseDown.call(this,t,e,n)},w.prototype.dispose=function(){r.Portal.disconnect(this.cell.id),this.unmountReactComponent()},function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(c=(i<3?r(c):3<i?r(e,n,c):r(e,n))||c);3<i&&c&&Object.defineProperty(e,n,c)}([o.NodeView.dispose()],w.prototype,"dispose",null),w),(t=r.ReactShapeView||(r.ReactShapeView={})).action="react",t.config({bootstrap:[t.action],actions:{component:t.action}}),o.NodeView.registry.register("react-shape-view",t,!0),r.registry=a,Object.defineProperty(r,"__esModule",{value:!0})});