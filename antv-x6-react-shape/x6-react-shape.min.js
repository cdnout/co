!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/x6"),require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","@antv/x6","react","react-dom"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).X6ReactShape={},t.X6,t.React,t.ReactDom)}(this,function(r,o,n,t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(n),c=e(t),a=o.Registry.create({type:"react componnet"});o.Graph.registerReactComponent=a.register,o.Graph.unregisterReactComponent=a.unregister,o.Graph.Hook.prototype.getReactComponent=function(t){var e=this.options.getReactComponent;if("function"==typeof e){var n=o.FunctionExt.call(e,this.graph,t);if(null!=n)return n}n=t.getComponent();if("string"==typeof n){t=a.get(n);if(null==t)return a.onNotFound(n);n=t}return n};var p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function u(t,e){function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var f,l,s,d,h=function(){return(h=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function m(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var o=Array(t),r=0,e=0;e<n;e++)for(var i=arguments[e],c=0,a=i.length;c<a;c++,r++)o[r]=i[c];return o}function y(){return null!==d&&d.apply(this,arguments)||this}r.ReactShape=(u(y,d=o.Node),Object.defineProperty(y.prototype,"component",{get:function(){return this.getComponent()},set:function(t){this.setComponent(t)},enumerable:!1,configurable:!0}),y.prototype.getComponent=function(){return this.store.get("component")},y.prototype.setComponent=function(t,e){return void 0===e&&(e={}),null==t?this.removeComponent(e):this.store.set("component",t,e),this},y.prototype.removeComponent=function(t){return void 0===t&&(t={}),this.store.remove("component",t),this},y),(t=r.ReactShape||(r.ReactShape={})).config({view:"react-shape-view",markup:[{tagName:"rect",selector:"body"},h({},o.Markup.getForeignObjectMarkup()),{tagName:"text",selector:"label"}],attrs:{body:{fill:"none",stroke:"none",refWidth:"100%",refHeight:"100%"},fo:{refWidth:"100%",refHeight:"100%"},label:{fontSize:14,fill:"#333",refX:"50%",refY:"50%",textAnchor:"middle",textVerticalAnchor:"middle"}}}),o.Node.registry.register("react-shape",t,!0),t=r.Portal||(r.Portal={}),l=!1,s=function(t,e){var n,o=e.payload;switch(e.type){case"add":return 0<=(n=t.findIndex(function(t){return t.id===o.id}))?(t[n]=o,m(t)):m(t,[o]);case"remove":if(0<=(n=t.findIndex(function(t){return t.id===o.id}))){e=m(t);return e.splice(n,1),e}}return t},t.connect=function(t,e){l&&f({type:"add",payload:{id:t,portal:e}})},t.disconnect=function(t){l&&f({type:"remove",payload:{id:t}})},t.isActive=function(){return l},t.getProvider=function(){return function(){l=!0;var t=n.useReducer(s,[]),e=t[0],t=t[1];return f=t,i.default.createElement(i.default.Fragment,{children:e.map(function(t){return t.portal})})}};var g,v,C=(u(R,g=i.default.PureComponent),R.prototype.componentDidMount=function(){var t=this;this.props.node.on("change:*",function(){t.setState({tick:t.state.tick+1})})},R.prototype.render=function(){var t=this.props,e=t.graph,n=t.node,t=t.component;if(i.default.isValidElement(t))return i.default.cloneElement(t,{node:n});if("function"==typeof t){e=o.FunctionExt.call(t,e,n);if(i.default.isValidElement(e))return i.default.cloneElement(e,{node:n})}return t},R);function R(){var t=null!==g&&g.apply(this,arguments)||this;return t.state={tick:0},t}function b(){return null!==v&&v.apply(this,arguments)||this}r.ReactShapeView=(u(b,v=o.NodeView),b.prototype.init=function(){var t=this;v.prototype.init.call(this),this.cell.on("removed",function(){r.Portal.disconnect(t.cell.id)})},b.prototype.getComponentContainer=function(){return this.selectors.foContent},b.prototype.confirmUpdate=function(t){var e=this,t=v.prototype.confirmUpdate.call(this,t);return this.handleAction(t,b.action,function(){return e.renderReactComponent()})},b.prototype.renderReactComponent=function(){this.unmountReactComponent();var t,e=this.getComponentContainer(),n=this.cell,o=this.graph;e&&(t=this.graph.hook.getReactComponent(n),t=i.default.createElement(C,{graph:o,node:n,component:t}),r.Portal.isActive()?r.Portal.connect(this.cell.id,c.default.createPortal(t,e)):c.default.render(t,e))},b.prototype.unmountReactComponent=function(){var t=this.getComponentContainer();return t&&c.default.unmountComponentAtNode(t),t},b.prototype.dispose=function(){r.Portal.disconnect(this.cell.id),this.unmountReactComponent()},function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(c=(i<3?r(c):3<i?r(e,n,c):r(e,n))||c);3<i&&c&&Object.defineProperty(e,n,c)}([o.NodeView.dispose()],b.prototype,"dispose",null),b),(t=r.ReactShapeView||(r.ReactShapeView={})).action="react",t.config({bootstrap:[t.action],actions:{component:t.action}}),o.NodeView.registry.register("react-shape-view",t,!0),r.registry=a,Object.defineProperty(r,"__esModule",{value:!0})});