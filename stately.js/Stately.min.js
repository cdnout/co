!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Stately=e()}(this,function(){function t(t,o){function r(t,e){for(var n in i[t])if(i[t].hasOwnProperty(n)&&n.toLowerCase()===e.toLowerCase())return i[t][n]}if("function"==typeof t&&(t=t()),"[object Object]"!==e.call(t))throw new n("Stately.js: Invalid states object: `"+t+"`.");var a,i={getMachineState:function(){return a.name},setMachineState:function t(e){var o,f,c=arguments[1],s=a;if("string"==typeof e&&(e=i[e]),!e||!e.name||!i[e.name])throw new n("Stately.js: Transitioned into invalid state: `"+t.caller+"`.");return a=e,(f=r(s.name,"onLeave"))&&"function"==typeof f&&f.call(i,c,s.name,a.name),(o=r(a.name,"onEnter"))&&"function"==typeof o&&o.call(i,c,s.name,e.name),this},getMachineEvents:function(){var t=[];for(var e in a)a.hasOwnProperty(e)&&"function"==typeof a[e]&&t.push(e);return t}},f={getMachineState:i.getMachineState,getMachineEvents:i.getMachineEvents};for(var c in t)if(t.hasOwnProperty(c)){i[c]=t[c];for(var s in i[c])i[c].hasOwnProperty(s)&&("string"==typeof i[c][s]&&(i[c][s]=function(t){return function(){return this[t]}}(i[c][s])),"function"!=typeof i[c][s]||/^onEnter$/i.test(s)||/^onLeave$/i.test(s)||/^onBefore/i.test(s)||/^onAfter/i.test(s)||(f[s]=function(t,n,o){return function(){var c,s,u,l=f;return i[t]!==a?(o&&(l=o.apply(i,arguments)),l):((c=r(a.name,"onBefore"+n))&&"function"==typeof c&&c.call(i,n,a.name,a.name),void 0===(l=i[t][n].apply(i,arguments))?(u=a,l=f):"string"==typeof l?(u=i[l],l=f):"[object Object]"===e.call(l)?(u=l===i?a:l,l=f):"[object Array]"===e.call(l)&&l.length>=1&&(u="string"==typeof l[0]?i[l[0]]:l[0],l=l[1]),(s=r(a.name,"onAfter"+n))&&"function"==typeof s&&s.call(i,n,a.name,u.name),i.setMachineState(u,n),l)}}(c,s,f[s])));i[c].name=c,a||(a=i[c])}if(void 0!==i[o]&&(a=i[o]),!a)throw new n("Stately.js: Invalid initial state.");return f}var e=Object.prototype.toString,n=function(){function t(t){this.name="InvalidStateError",this.message=t}return t.prototype=new Error,t.prototype.constructor=t,t}();return t.machine=function(e,n){return new t(e,n)},t.InvalidStateError=n,t});