"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.__BackgroundImpl=exports.Background=void 0;var _react=_interopRequireDefault(require("react")),_reactMeasure=_interopRequireWildcard(require("react-measure")),_constructUrl=_interopRequireDefault(require("./constructUrl")),_extractQueryParams3=_interopRequireDefault(require("./extractQueryParams")),_targetWidths=_interopRequireDefault(require("./targetWidths")),_findClosest=_interopRequireDefault(require("./findClosest"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache();if(r&&r.has(e))return r.get(e);var t,n,o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&((n=i?Object.getOwnPropertyDescriptor(e,t):null)&&(n.get||n.set)?Object.defineProperty(o,t,n):o[t]=e[t]);return o.default=e,r&&r.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t,n=arguments[r];for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function ownKeys(r,e){var t,n=Object.keys(r);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(r),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),n.push.apply(n,t)),n}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var PACKAGE_VERSION="9.0.3",noop=function(){},findNearestWidth=function(e){return(0,_findClosest.default)(e,_targetWidths.default)},toFixed=function(e,r){return+r.toFixed(e)},BackgroundImpl=function(e){function r(e){t(e),"function"==typeof _&&_(e)}var t=e.measureRef,n=(e.measure,e.contentRect),o=e.imgixParams,i=void 0===o?{}:o,a=(e.onLoad,e.disableLibraryParam),u=e.src,c=e.children,l=e.className,d=void 0===l?"":l,f=i.w,s=i.h,p=null!=n.bounds.width&&null!=n.bounds.height,y=e.htmlAttributes||{},b=toFixed(2,i.dpr||global.devicePixelRatio||1),_=y.ref,h=function(){if(null!=f&&null!=s)return{width:f,height:s};if(!p)return{width:void 0,height:void 0};var e=n.bounds.width/n.bounds.height;if(null==f&&null==s){var r=findNearestWidth(n.bounds.width);return{width:r,height:Math.ceil(r/e)}}if(null==f)return null!=s?{width:Math.ceil(s*e),height:s}:void 0;e=Math.ceil(f/e);return{width:f,height:e}}(),o=h.width,l=h.height,e=null!=o&&null!=l,h=_objectSpread({},y);if(!e)return _react.default.createElement("div",_extends({},h,{className:"react-imgix-bg-loading ".concat(d),ref:r}),c);e=_slicedToArray((0,_extractQueryParams3.default)(u),2),u=e[0],e=_objectSpread(_objectSpread(_objectSpread(_objectSpread({},e[1]),{},{fit:"crop"},i),a?{}:{ixlib:"react-".concat(PACKAGE_VERSION)}),{},{width:o,height:l,dpr:b}),e=(0,_constructUrl.default)(u,e),y=_objectSpread(_objectSpread({},y.style),{},{backgroundImage:"url(".concat(e,")"),backgroundSize:void 0!==(y.style||{}).backgroundSize?y.style.backgroundSize:"cover"});return _react.default.createElement("div",_extends({},h,{className:d,ref:r,style:y}),c)};exports.__BackgroundImpl=BackgroundImpl;var Background=(0,_reactMeasure.withContentRect)("bounds")(BackgroundImpl);exports.Background=Background;