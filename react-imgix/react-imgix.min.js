"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__PictureImpl=exports.__SourceImpl=exports.Source=exports.Picture=exports.__ReactImgixImpl=exports.default=void 0,require("./array-findindex");var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_targetWidths=_interopRequireDefault(require("./targetWidths")),_constructUrl=_interopRequireDefault(require("./constructUrl")),_extractQueryParams3=_interopRequireDefault(require("./extractQueryParams")),_HOCs=require("./HOCs"),_common=require("./common"),_constants=require("./constants");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,i,o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&((i=n?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(o,r,i):o[r]=e[r]);return o.default=e,t&&t.set(e,o),o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var i=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,i?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectWithoutProperties(e,t){if(null==e)return{};var r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),n=0;n<o.length;n++)r=o[n],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r]);return i}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,i={},o=Object.keys(e),n=0;n<o.length;n++)r=o[n],0<=t.indexOf(r)||(i[r]=e[r]);return i}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],i=!0,o=!1,n=void 0;try{for(var a,u=e[Symbol.iterator]();!(i=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(e){o=!0,n=e}finally{try{i||null==u.return||u.return()}finally{if(o)throw n}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}var PACKAGE_VERSION="9.0.3",NODE_ENV=process.env.NODE_ENV,buildKey=function(e){return"react-imgix-".concat(e)},defaultImgixParams={auto:["format"]},defaultAttributeMap={src:"src",srcSet:"srcSet",sizes:"sizes"},noop=function(){},COMMON_PROP_TYPES={className:_propTypes.default.string,onMounted:_propTypes.default.func,htmlAttributes:_propTypes.default.object},SHARED_IMGIX_AND_SOURCE_PROP_TYPES=_extends({},COMMON_PROP_TYPES,{disableQualityByDPR:_propTypes.default.bool,disableSrcSet:_propTypes.default.bool,disableLibraryParam:_propTypes.default.bool,imgixParams:_propTypes.default.object,sizes:_propTypes.default.string,width:_propTypes.default.number,height:_propTypes.default.number,src:_propTypes.default.string.isRequired});function aspectRatioIsValid(e){return"string"==typeof e&&/^\d+(\.\d+)?:\d+(\.\d+)?$/.test(e)}var setParentRef=function(e,t){e&&("function"==typeof e?e(t):e.current=t)},buildSrcSetPairWithFixedHeight=function(e,t,r){return e+"&h="+r+"&w="+t+" "+t+"w"},buildSrcSetPairWithTargetWidth=function(e,t){return e+"&w="+t+" "+t+"w"},buildDprSrcWithQuality=function(e,t,r){return e+"&q="+t+"&dpr="+r+" "+r+"x"},buildDprSrcWithoutQuality=function(e,t,r){return e+"&dpr="+r+" "+r+"x"},buildDprSrcWithQualityByDpr=function(e,t,r){return e+"&q="+t+"&dpr="+r+" "+r+"x"};function buildSrc(e){var t=e.src,r=e.width,i=e.height,o=e.disableLibraryParam,n=e.disableSrcSet,a=e.imgixParams,u=e.disableQualityByDPR,s=null!=r||null!=i,e=_slicedToArray((0,_extractQueryParams3.default)(t),2),t=e[0],i=_extends({},e[1],a,o?{}:{ixlib:"react-".concat(PACKAGE_VERSION)},s&&i?{height:i}:{},s&&r?{width:r}:{}),r=(0,_constructUrl.default)(t,i);if(n)b=r;else if(s){var c=i.q,s=_objectWithoutProperties(i,["q"]),p=(0,_constructUrl.default)(t,s),l=buildDprSrcWithQualityByDpr;c?l=buildDprSrcWithQuality:u&&(l=buildDprSrcWithoutQuality),b="";for(var f=_constants.DPR_QUALITY_VALUES.length,d=0;d<f;d++){var _=_constants.DPR_QUALITY_VALUES[d];b+=l(p,c||_,d+1)+", "}b=b.slice(0,-2)}else{i.width,i.w;for(var y=i.height,i=_objectWithoutProperties(i,["width","w","height"]),h=(0,_constructUrl.default)(t,i),i=a.ar,a=null!=i&&!1===aspectRatioIsValid(i),m=y?buildSrcSetPairWithFixedHeight:buildSrcSetPairWithTargetWidth,b="",P=_targetWidths.default.length,g=0;g<P;g++)b+=m(h,_targetWidths.default[g],y)+", ";b=b.slice(0,-2),"production"!==NODE_ENV&&a&&_common.config.warnings.invalidARFormat&&console.warn('[Imgix] The aspect ratio passed ("'.concat(i,'") is not in the correct format. The correct format is "W:H".'))}return{src:r,srcSet:b}}function imgixParams(e){e=_extends({},defaultImgixParams,e.imgixParams);return _extends({},e)}var ReactImgix=function(){_inherits(r,_react.Component);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),(e=t.call(this,e)).imgRef=null,e}return _createClass(r,[{key:"componentDidMount",value:function(){this.props.onMounted(this.imgRef)}},{key:"render",value:function(){var t=this,e=this.props,r=e.disableSrcSet,i=(e.type,e.width),o=e.height;"production"!==NODE_ENV&&_common.config.warnings.sizesAttribute&&(null!=this.props.width||null!=this.props.height||null!=this.props.sizes||this.props._inPicture||console.warn("If width and height are not set, a sizes attribute should be passed."));var n=buildSrc(_extends({},this.props,{type:"img",imgixParams:imgixParams(this.props)})),a=n.src,u=n.srcSet,e=_extends({},defaultAttributeMap,this.props.attributeConfig),n=_extends({},this.props.htmlAttributes,(_defineProperty(n={},e.sizes,this.props.sizes),_defineProperty(n,"className",this.props.className),_defineProperty(n,"width",i<=1?null:i),_defineProperty(n,"height",o<=1?null:o),_defineProperty(n,e.src,a),_defineProperty(n,"ref",function(e){t.imgRef=e,void 0!==t.props.htmlAttributes&&"ref"in t.props.htmlAttributes&&setParentRef(t.props.htmlAttributes.ref,t.imgRef)}),n));return r||(n[e.srcSet]=u),_react.default.createElement("img",n)}}]),r}();_defineProperty(exports.__ReactImgixImpl=ReactImgix,"propTypes",_extends({},SHARED_IMGIX_AND_SOURCE_PROP_TYPES)),_defineProperty(ReactImgix,"defaultProps",{disableSrcSet:!1,onMounted:noop}),ReactImgix.displayName="ReactImgix";var PictureImpl=function(){_inherits(r,_react.Component);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),(e=t.call(this,e)).pictureRef=null,e}return _createClass(r,[{key:"componentDidMount",value:function(){this.props.onMounted(this.pictureRef)}},{key:"render",value:function(){var t=this,e=this.props.children,r=_react.default.Children.map(e,function(e,t){return _react.default.cloneElement(e,{key:buildKey(t),_inPicture:!0})})||[],e=r.findIndex(function(e){return"img"===e.type||e.type===ReactImgix||e.type===ReactImgixWrapped});return-1===e&&_common.config.warnings.fallbackImage?console.warn("No fallback <img /> or <Imgix /> found in the children of a <picture> component. A fallback image should be passed to ensure the image renders correctly at all dimensions."):e!==r.length-1&&r.push(r.splice(e,1)[0]),_react.default.createElement("picture",{ref:function(e){return t.pictureRef=e},children:r})}}]),r}();_defineProperty(exports.__PictureImpl=PictureImpl,"propTypes",_extends({},COMMON_PROP_TYPES,{children:_propTypes.default.any})),_defineProperty(PictureImpl,"defaultProps",{onMounted:noop}),PictureImpl.displayName="ReactImgixPicture";var SourceImpl=function(){_inherits(r,_react.Component);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),(e=t.call(this,e)).sourceRef=null,e}return _createClass(r,[{key:"componentDidMount",value:function(){this.props.onMounted(this.sourceRef)}},{key:"render",value:function(){var t=this,e=this.props,r=e.disableSrcSet,i=e.width,o=e.height,n=buildSrc(_extends({},this.props,{type:"source",imgixParams:imgixParams(this.props)})),a=n.src,u=n.srcSet,e=_extends({},defaultAttributeMap,this.props.attributeConfig),n=_extends({},this.props.htmlAttributes,(_defineProperty(n={},e.sizes,this.props.sizes),_defineProperty(n,"className",this.props.className),_defineProperty(n,"width",i<=1?null:i),_defineProperty(n,"height",o<=1?null:o),_defineProperty(n,"ref",function(e){t.sourceRef=e,void 0!==t.props.htmlAttributes&&"ref"in t.props.htmlAttributes&&setParentRef(t.props.htmlAttributes.ref,t.sourceRef)}),n));return n[e.srcSet]=r?a:"".concat(u),_react.default.createElement("source",n)}}]),r}();_defineProperty(exports.__SourceImpl=SourceImpl,"propTypes",_extends({},SHARED_IMGIX_AND_SOURCE_PROP_TYPES)),_defineProperty(SourceImpl,"defaultProps",{disableSrcSet:!1,onMounted:noop}),SourceImpl.displayName="ReactImgixSource";var ReactImgixWrapped=(0,_common.compose)(_HOCs.ShouldComponentUpdateHOC)(ReactImgix),Picture=(0,_common.compose)(_HOCs.ShouldComponentUpdateHOC)(PictureImpl);exports.Picture=Picture;var Source=(0,_common.compose)(_HOCs.ShouldComponentUpdateHOC)(SourceImpl);exports.Source=Source;var _default=ReactImgixWrapped;exports.default=ReactImgixWrapped;