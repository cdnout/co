import{_ as _defineProperty,b as _typeof,d as _toConsumableArray}from"./chunk-1fafdf15.js";import{getValueByPath,toCssWidth,isCustomElement,createAbsoluteElement,removeElement}from"./helpers.js";import{F as FormElementMixin}from"./chunk-1f2cfc27.js";import{_ as __vue_normalize__}from"./chunk-cca88db8.js";import{I as Input}from"./chunk-f28f2092.js";var script={name:"BAutocomplete",components:_defineProperty({},Input.name,Input),mixins:[FormElementMixin],inheritAttrs:!1,props:{value:[Number,String],data:{type:Array,default:function(){return[]}},field:{type:String,default:"value"},keepFirst:Boolean,clearOnSelect:Boolean,openOnFocus:Boolean,customFormatter:Function,checkInfiniteScroll:Boolean,keepOpen:Boolean,clearable:Boolean,maxHeight:[String,Number],dropdownPosition:{type:String,default:"auto"},groupField:String,groupOptions:String,iconRight:String,iconRightClickable:Boolean,appendToBody:Boolean,confirmKeys:{type:Array,default:function(){return["Tab","Enter"]}}},data:function(){return{selected:null,hovered:null,isActive:!1,newValue:this.value,newAutocomplete:this.autocomplete||"off",isListInViewportVertically:!0,hasFocus:!1,style:{},_isAutocomplete:!0,_elementRef:"input",_bodyEl:void 0}},computed:{computedData:function(){var t=this;if(this.groupField){if(this.groupOptions){var e=[];return this.data.forEach(function(i){var o=getValueByPath(i,t.groupField),n=getValueByPath(i,t.groupOptions);e.push({group:o,items:n})}),e}var i={};this.data.forEach(function(e){var o=getValueByPath(e,t.groupField);i[o]||(i[o]=[]),i[o].push(e)});var o=[];return Object.keys(i).forEach(function(t){o.push({group:t,items:i[t]})}),o}return[{items:this.data}]},isEmpty:function(){return!this.computedData||!this.computedData.some(function(t){return t.items&&t.items.length})},whiteList:function(){var t=[];if(t.push(this.$refs.input.$el.querySelector("input")),t.push(this.$refs.dropdown),void 0!==this.$refs.dropdown){var e=this.$refs.dropdown.querySelectorAll("*"),i=!0,o=!1,n=void 0;try{for(var s,r=e[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var c=s.value;t.push(c)}}catch(t){o=!0,n=t}finally{try{i||null==r.return||r.return()}finally{if(o)throw n}}}if(this.$parent.$data._isTaginput){t.push(this.$parent.$el);var l=this.$parent.$el.querySelectorAll("*"),a=!0,u=!1,d=void 0;try{for(var h,p=l[Symbol.iterator]();!(a=(h=p.next()).done);a=!0){var f=h.value;t.push(f)}}catch(t){u=!0,d=t}finally{try{a||null==p.return||p.return()}finally{if(u)throw d}}}return t},hasDefaultSlot:function(){return!!this.$scopedSlots.default},hasGroupSlot:function(){return!!this.$scopedSlots.group},hasEmptySlot:function(){return!!this.$slots.empty},hasHeaderSlot:function(){return!!this.$slots.header},hasFooterSlot:function(){return!!this.$slots.footer},isOpenedTop:function(){return"top"===this.dropdownPosition||"auto"===this.dropdownPosition&&!this.isListInViewportVertically},newIconRight:function(){return this.clearable&&this.newValue?"close-circle":this.iconRight},newIconRightClickable:function(){return!!this.clearable||this.iconRightClickable},contentStyle:function(){return{maxHeight:toCssWidth(this.maxHeight)}}},watch:{isActive:function(t){var e=this;"auto"===this.dropdownPosition&&(t?this.calcDropdownInViewportVertical():setTimeout(function(){e.calcDropdownInViewportVertical()},100))},newValue:function(t){this.$emit("input",t);var e=this.getValue(this.selected);e&&e!==t&&this.setSelected(null,!1),!this.hasFocus||this.openOnFocus&&!t||(this.isActive=!!t)},value:function(t){this.newValue=t},data:function(t){this.keepFirst&&this.selectFirstOption(this.computedData)}},methods:{setHovered:function(t){void 0!==t&&(this.hovered=t)},setSelected:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;void 0!==t&&(this.selected=t,this.$emit("select",this.selected,o),null!==this.selected&&(this.newValue=this.clearOnSelect?"":this.getValue(this.selected),this.setHovered(null)),i&&this.$nextTick(function(){e.isActive=!1}),this.checkValidity())},selectFirstOption:function(t){var e=this;this.$nextTick(function(){if(t.length){var i=t[0].items[0];(e.openOnFocus||""!==e.newValue&&e.hovered!==i)&&e.setHovered(i)}else e.setHovered(null)})},keydown:function(t){var e=t.key;if(this.isActive="Tab"!==e,null!==this.hovered&&this.confirmKeys.indexOf(e)>=0){","===e&&t.preventDefault();var i=!this.keepOpen||"Tab"===e;this.setSelected(this.hovered,i,t)}},clickedOutside:function(t){var e=isCustomElement(this)?t.composedPath()[0]:t.target;!this.hasFocus&&this.whiteList.indexOf(e)<0&&(this.isActive=!1)},getValue:function(t){if(null!==t)return void 0!==this.customFormatter?this.customFormatter(t):"object"===_typeof(t)?getValueByPath(t,this.field):t},checkIfReachedTheEndOfScroll:function(t){t.clientHeight!==t.scrollHeight&&t.scrollTop+t.clientHeight>=t.scrollHeight&&this.$emit("infinite-scroll")},calcDropdownInViewportVertical:function(){var t=this;this.$nextTick(function(){if(void 0!==t.$refs.dropdown){var e=t.$refs.dropdown.getBoundingClientRect();t.isListInViewportVertically=e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight),t.appendToBody&&t.updateAppendToBody()}})},keyArrows:function(t){var e="down"===t?1:-1;if(this.isActive){var i=this.computedData.map(function(t){return t.items}).reduce(function(t,e){return[].concat(_toConsumableArray(t),_toConsumableArray(e))},[]),o=i.indexOf(this.hovered)+e;o=(o=o>i.length-1?i.length-1:o)<0?0:o,this.setHovered(i[o]);var n=this.$refs.dropdown.querySelector(".dropdown-content"),s=n.querySelectorAll("a.dropdown-item:not(.is-disabled)")[o];if(!s)return;var r=n.scrollTop,c=n.scrollTop+n.clientHeight-s.clientHeight;s.offsetTop<r?n.scrollTop=s.offsetTop:s.offsetTop>=c&&(n.scrollTop=s.offsetTop-n.clientHeight+s.clientHeight)}else this.isActive=!0},focused:function(t){this.getValue(this.selected)===this.newValue&&this.$el.querySelector("input").select(),this.openOnFocus&&(this.isActive=!0,this.keepFirst&&this.selectFirstOption(this.computedData)),this.hasFocus=!0,this.$emit("focus",t)},onBlur:function(t){this.hasFocus=!1,this.$emit("blur",t)},onInput:function(t){var e=this.getValue(this.selected);e&&e===this.newValue||(this.$emit("typing",this.newValue),this.checkValidity())},rightIconClick:function(t){this.clearable?(this.newValue="",this.setSelected(null,!1),this.openOnFocus&&this.$refs.input.$el.focus()):this.$emit("icon-right-click",t)},checkValidity:function(){var t=this;this.useHtml5Validation&&this.$nextTick(function(){t.checkHtml5Validity()})},updateAppendToBody:function(){var t=this.$refs.dropdown,e=this.$refs.input.$el;if(t&&e){var i=this.$data._bodyEl;i.classList.forEach(function(t){return i.classList.remove(t)}),i.classList.add("autocomplete"),i.classList.add("control"),this.expandend&&i.classList.add("is-expandend");var o=e.getBoundingClientRect(),n=o.top+window.scrollY,s=o.left+window.scrollX;this.isOpenedTop?n-=t.clientHeight:n+=e.clientHeight,this.style={position:"absolute",top:"".concat(n,"px"),left:"".concat(s,"px"),width:"".concat(e.clientWidth,"px"),maxWidth:"".concat(e.clientWidth,"px"),zIndex:"99"}}}},created:function(){"undefined"!=typeof window&&(document.addEventListener("click",this.clickedOutside),"auto"===this.dropdownPosition&&window.addEventListener("resize",this.calcDropdownInViewportVertical))},mounted:function(){var t=this;if(this.checkInfiniteScroll&&this.$refs.dropdown&&this.$refs.dropdown.querySelector(".dropdown-content")){var e=this.$refs.dropdown.querySelector(".dropdown-content");e.addEventListener("scroll",function(){return t.checkIfReachedTheEndOfScroll(e)})}this.appendToBody&&(this.$data._bodyEl=createAbsoluteElement(this.$refs.dropdown),this.updateAppendToBody())},beforeDestroy:function(){("undefined"!=typeof window&&(document.removeEventListener("click",this.clickedOutside),"auto"===this.dropdownPosition&&window.removeEventListener("resize",this.calcDropdownInViewportVertical)),this.checkInfiniteScroll&&this.$refs.dropdown&&this.$refs.dropdown.querySelector(".dropdown-content"))&&this.$refs.dropdown.querySelector(".dropdown-content").removeEventListener("scroll",this.checkIfReachedTheEndOfScroll);this.appendToBody&&removeElement(this.$data._bodyEl)}};const __vue_script__=script;var __vue_render__=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"autocomplete control",class:{"is-expanded":t.expanded}},[i("b-input",t._b({ref:"input",attrs:{type:"text",size:t.size,loading:t.loading,rounded:t.rounded,icon:t.icon,"icon-right":t.newIconRight,"icon-right-clickable":t.newIconRightClickable,"icon-pack":t.iconPack,maxlength:t.maxlength,autocomplete:t.newAutocomplete,"use-html5-validation":!1},on:{input:t.onInput,focus:t.focused,blur:t.onBlur,"icon-right-click":t.rightIconClick,"icon-click":function(e){return t.$emit("icon-click",e)}},nativeOn:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;e.preventDefault(),t.isActive=!1},keydown:[function(e){return t.keydown(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:(e.preventDefault(),t.keyArrows("up"))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:(e.preventDefault(),t.keyArrows("down"))}]},model:{value:t.newValue,callback:function(e){t.newValue=e},expression:"newValue"}},"b-input",t.$attrs,!1)),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive&&(!t.isEmpty||t.hasEmptySlot||t.hasHeaderSlot),expression:"isActive && (!isEmpty || hasEmptySlot || hasHeaderSlot)"}],ref:"dropdown",staticClass:"dropdown-menu",class:{"is-opened-top":t.isOpenedTop&&!t.appendToBody},style:t.style},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"dropdown-content",style:t.contentStyle},[t.hasHeaderSlot?i("div",{staticClass:"dropdown-item"},[t._t("header")],2):t._e(),t._l(t.computedData,function(e,o){return[e.group?i("div",{key:o+"group",staticClass:"dropdown-item"},[t.hasGroupSlot?t._t("group",null,{group:e.group,index:o}):i("span",{staticClass:"has-text-weight-bold"},[t._v(" "+t._s(e.group)+" ")])],2):t._e(),t._l(e.items,function(e,n){return i("a",{key:o+":"+n,staticClass:"dropdown-item",class:{"is-hovered":e===t.hovered},on:{click:function(i){return t.setSelected(e,void 0,i)}}},[t.hasDefaultSlot?t._t("default",null,{option:e,index:n}):i("span",[t._v(" "+t._s(t.getValue(e,!0))+" ")])],2)})]}),t.isEmpty&&t.hasEmptySlot?i("div",{staticClass:"dropdown-item is-disabled"},[t._t("empty")],2):t._e(),t.hasFooterSlot?i("div",{staticClass:"dropdown-item"},[t._t("footer")],2):t._e()],2)])])],1)},__vue_staticRenderFns__=[];const __vue_inject_styles__=void 0,__vue_scope_id__=void 0,__vue_module_identifier__=void 0,__vue_is_functional_template__=!1;var Autocomplete=__vue_normalize__({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},void 0,__vue_script__,void 0,!1,void 0,void 0,void 0);export{Autocomplete as A};