var f=Object.defineProperty,l=(e,t)=>f(e,"name",{value:t,configurable:!0});class d{constructor(e,t,s){this.isTonicTemplate=!0,this.unsafe=s,this.rawText=e,this.templateStrings=t}valueOf(){return this.rawText}toString(){return this.rawText}}l(d,"TonicTemplate");class s extends window.HTMLElement{constructor(){super();const e=s._states[super.id];delete s._states[super.id],this._state=e||{},this.preventRenderOnReconnect=!1,this.props={},this.elements=[...this.children],this.elements.__children__=!0,this.nodes=[...this.childNodes],this.nodes.__children__=!0,this._events()}static _createId(){return`tonic${s._index++}`}static _splitName(e){return e.match(/[A-Z][a-z]*/g).join("-")}static _normalizeAttrs(e,t={}){return[...e].forEach(e=>t[e.name]=e.value),t}_checkId(){const e=super.id;if(!e){const e=this.outerHTML.replace(this.innerHTML,"...");throw new Error(`Component: ${e} has no id`)}return e}get state(){return this._checkId(),this._state}set state(e){this._state=(this._checkId(),e)}get id(){return this._checkId()}set id(e){super.id=e}_events(){const e=Object.getOwnPropertyNames(window.HTMLElement.prototype);for(const t of this._props)-1!==e.indexOf("on"+t)&&this.addEventListener(t,this)}_prop(e){const t=this._id,n=`__${t}__${s._createId()}__`;return s._data[t]=s._data[t]||{},s._data[t][n]=e,n}_placehold(e){const t=this._id,n=`placehold:${t}:${s._createId()}__`;return s._children[t]=s._children[t]||{},s._children[t][n]=e,n}static match(e,t){return e.matches||(e=e.parentElement),e.matches(t)?e:e.closest(t)}static getPropertyNames(e){const t=[];for(;e&&e!==s.prototype;)t.push(...Object.getOwnPropertyNames(e)),e=Object.getPrototypeOf(e);return t}static add(e,t){if(!(t||e.name&&e.name.length>1))throw Error("Mangling. https://bit.ly/2TkJ6zP");if(t||(t=s._splitName(e.name).toLowerCase()),!s.ssr&&window.customElements.get(t))throw new Error(`Cannot Tonic.add(${e.name}, '${t}') twice`);if(!e.prototype||!e.prototype.isTonicComponent){const t={[e.name]:class extends s{}}[e.name];t.prototype.render=e,e=t}return e.prototype._props=s.getPropertyNames(e.prototype),s._reg[t]=e,s._tags=Object.keys(s._reg).join(),window.customElements.define(t,e),"function"==typeof e.stylesheet&&s.registerStyles(e.stylesheet),e}static registerStyles(e){if(s._stylesheetRegistry.includes(e))return;s._stylesheetRegistry.push(e);const t=document.createElement("style");s.nonce&&t.setAttribute("nonce",s.nonce),t.appendChild(document.createTextNode(e())),document.head&&document.head.appendChild(t)}static escape(e){return e.replace(s.ESC,e=>s.MAP[e])}static unsafeRawString(e,t){return new d(e,t,!0)}dispatch(e,t=null){const s={bubbles:!0,detail:t};this.dispatchEvent(new window.CustomEvent(e,s))}html(e,...t){const n=l(e=>{if(e&&e.__children__)return this._placehold(e);if(e&&e.isTonicTemplate)return e.rawText;switch(Object.prototype.toString.call(e)){case"[object HTMLCollection]":case"[object NodeList]":return this._placehold([...e]);case"[object Array]":return e.every(e=>e.isTonicTemplate&&!e.unsafe)?new d(e.join("\n"),null,!1):this._prop(e);case"[object Object]":case"[object Function]":return this._prop(e);case"[object NamedNodeMap]":return this._prop(s._normalizeAttrs(e));case"[object Number]":return`${e}__float`;case"[object String]":return s.escape(e);case"[object Boolean]":return`${e}__boolean`;case"[object Null]":return`${e}__null`;case"[object HTMLElement]":return this._placehold([e])}return"object"==typeof e&&e&&1===e.nodeType&&"function"==typeof e.cloneNode?this._placehold([e]):e},"refs"),i=[];for(let s=0;s<e.length-1;s++)i.push(e[s],n(t[s]));i.push(e[e.length-1]);const r=i.join("").replace(s.SPREAD,(e,t)=>{const n=s._data[t.split("__")[1]][t];return Object.entries(n).map(([e,t])=>{const n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return!0===t?n:t?`${n}="${s.escape(String(t))}"`:""}).filter(Boolean).join(" ")});return new d(r,e,!1)}scheduleReRender(e){return this.pendingReRender?this.pendingReRender:(this.pendingReRender=new Promise(t=>setTimeout(()=>{if(!this.isInDocument(this.shadowRoot||this))return;const s=this._set(this.shadowRoot||this,this.render);if(this.pendingReRender=null,s&&s.then)return s.then(()=>{this.updated&&this.updated(e),t()});this.updated&&this.updated(e),t()},0)),this.pendingReRender)}reRender(e=this.props){const t={...this.props};return this.props="function"==typeof e?e(t):e,this.scheduleReRender(t)}handleEvent(e){this[e.type](e)}_drainIterator(e,t){return t.next().then(s=>{if(this._set(e,null,s.value),!s.done)return this._drainIterator(e,t)})}_set(e,t,n=""){for(const t of e.querySelectorAll(s._tags)){if(!t.isTonicComponent)continue;const e=t.getAttribute("id");!e||!s._refIds.includes(e)||(s._states[e]=t.state)}return t instanceof s.AsyncFunction?t.call(this).then(t=>this._apply(e,t)):t instanceof s.AsyncFunctionGenerator?this._drainIterator(e,t.call(this)):void(null===t?this._apply(e,n):t instanceof Function&&this._apply(e,t.call(this)||""))}_apply(e,t){if(t&&t.isTonicTemplate?t=t.rawText:"string"==typeof t&&(t=s.escape(t)),"string"==typeof t){if(this.stylesheet&&(t=`<style nonce=${s.nonce||""}>${this.stylesheet()}</style>${t}`),e.innerHTML=t,this.styles){const t=this.styles();for(const s of e.querySelectorAll("[styles]"))for(const e of s.getAttribute("styles").split(/\s+/))Object.assign(s.style,t[e.trim()])}const n=s._children[this._id]||{},i=l((e,t)=>{if(3===e.nodeType){const s=e.textContent.trim();n[s]&&t(e,n[s],s)}const s=e.childNodes;if(s)for(let e=0;e<s.length;e++)i(s[e],t)},"walk");i(e,(e,t,n)=>{for(const s of t)e.parentNode.insertBefore(s,e);delete s._children[this._id][n],e.parentNode.removeChild(e)})}else e.innerHTML="",e.appendChild(t.cloneNode(!0))}connectedCallback(){this.root=this.shadowRoot||this,super.id&&!s._refIds.includes(super.id)&&s._refIds.push(super.id);const e=l(e=>e.replace(/-(.)/g,(e,t)=>t.toUpperCase()),"cc");for(const{name:t,value:n}of this.attributes){const i=e(t),r=this.props[i]=n;if(/__\w+__\w+__/.test(r)){const{1:e}=r.split("__");this.props[i]=s._data[e][r]}else if(/\d+__float/.test(r))this.props[i]=parseFloat(r,10);else if("null__null"===r)this.props[i]=null;else if(/\w+__boolean/.test(r))this.props[i]=r.includes("true");else if(/placehold:\w+:\w+__/.test(r)){const{1:e}=r.split(":");this.props[i]=s._children[e][r][0]}}if(this.props=Object.assign(this.defaults?this.defaults():{},this.props),this._id=this._id||s._createId(),this.willConnect&&this.willConnect(),this.isInDocument(this.root)){if(!this.preventRenderOnReconnect){this._source?this.innerHTML=this._source:this._source=this.innerHTML;const e=this._set(this.root,this.render);if(e&&e.then)return e.then(()=>this.connected&&this.connected())}this.connected&&this.connected()}}isInDocument(e){const t=e.getRootNode();return t===document||"[object ShadowRoot]"===t.toString()}disconnectedCallback(){this.disconnected&&this.disconnected(),delete s._data[this._id],delete s._children[this._id]}}l(s,"Tonic"),s.prototype.isTonicComponent=!0,Object.assign(s,{_tags:"",_refIds:[],_data:{},_states:{},_children:{},_reg:{},_stylesheetRegistry:[],_index:0,version:"undefined"!=typeof require?require("./package").version:null,SPREAD:/\.\.\.\s?(__\w+__\w+__)/g,ESC:/["&'<>`/]/g,AsyncFunctionGenerator:async function*(){}.constructor,AsyncFunction:async function(){}.constructor,MAP:{'"':"&quot;","&":"&amp;","'":"&#x27;","<":"&lt;",">":"&gt;","`":"&#x60;","/":"&#x2F;"}});export default s;