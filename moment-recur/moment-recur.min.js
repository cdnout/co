!function(t,e){"object"==typeof exports?module.exports=e(require("moment")):"function"==typeof define&&define.amd?define("moment-recur",["moment"],e):t.moment=e(t.moment)}(this,function(t){if("undefined"!=typeof module&&null!==module&&null!=module.exports,void 0===t)throw Error("Can't find moment");var e=function(){return{create:function(t,e){for(var r in t)if(t.hasOwnProperty(r)&&parseInt(r,10)<=0)throw Error("Intervals must be greater than zero");return{measure:e.toLowerCase(),units:t}},match:function(t,e,r,n){var s=null;s=n.isBefore(r)?r.diff(n,t,!0):n.diff(r,t,!0),"days"==t&&(s=parseInt(s));for(var a in e)if(e.hasOwnProperty(a)&&(a=parseInt(a,10),s%a==0))return!0;return!1}}}(),r=function(){function e(t,e,r){r.forEach(function(r){if(r<t||r>e)throw Error("Value should be in range "+t+" to "+e)})}function r(e,r){var n,s,a={};for(n in e)e.hasOwnProperty(n)&&(s=parseInt(n,10),isNaN(s)&&(s=n),a[t().set(r,s).get(r)]=e[n]);return a}var n={daysOfMonth:"date",daysOfWeek:"day",weeksOfMonth:"monthWeek",weeksOfMonthByDay:"monthWeekByDay",weeksOfYear:"week",monthsOfYear:"month"},s={daysOfMonth:{low:1,high:31},daysOfWeek:{low:0,high:6},weeksOfMonth:{low:0,high:4},weeksOfMonthByDay:{low:0,high:4},weeksOfYear:{low:0,high:52},monthsOfYear:{low:0,high:11}};return{create:function(t,n){var a=[];"daysOfWeek"===n&&(t=r(t,"days")),"monthsOfYear"===n&&(t=r(t,"months"));for(var i in t)hasOwnProperty.call(t,i)&&a.push(i);return e(s[n].low,s[n].high,a),{measure:n,units:t}},match:function(t,e,r){var s=n[t],a=r[s]();if(e[a])return!0;if("date"===s&&a==r.add(1,"months").date(0).format("D")&&a<31)for(;a<=31;){if(e[a])return!0;a++}return!1}}}(),n=function(){function n(){var t,n=f[this.measure];if(!(this instanceof c))throw Error("Private method trigger() was called directly or not called as instance of Recur!");if(void 0===this.units||null===this.units||!this.measure)return this;if("calendar"!==n&&"interval"!==n)throw Error("Invalid measure provided: "+this.measure);if("interval"===n){if(!this.start)throw Error("Must have a start date set to set an interval!");t=e.create(this.units,this.measure)}if("calendar"===n&&(t=r.create(this.units,this.measure)),this.units=null,this.measure=null,"weeksOfMonthByDay"===t.measure&&!this.hasRule("daysOfWeek"))throw Error("weeksOfMonthByDay must be combined with daysOfWeek");for(var s=0;s<this.rules.length;s++)this.rules[s].measure===t.measure&&this.rules.splice(s,1);return this.rules.push(t),this}function s(t,e,r){var n,s,a=[];if(!(this instanceof c))throw Error("Private method trigger() was called directly or not called as instance of Recur!");if(!this.start&&!this.from)throw Error("Cannot get occurrences without start or from date.");if("all"===r&&!this.end)throw Error("Cannot get all occurrences without an end date.");if(this.end&&this.start>this.end)throw Error("Start date cannot be later than end date.");if("all"!==r&&!(t>0))return a;for(n=(this.from||this.start).clone(),"all"===r&&this.matches(n,!1)&&(s=e?n.format(e):n.clone(),a.push(s));a.length<(null===t?a.length+1:t)&&("next"===r||"all"===r?n.add(1,"day"):n.subtract(1,"day"),this.matches(n,"all"!==r)&&(s=e?n.format(e):n.clone(),a.push(s)),!("all"===r&&n>=this.end)););return a}function a(t,e,r){return(!t||!r.isBefore(t))&&(!e||!r.isAfter(e))}function i(t){var e={};if("[object Array]"==Object.prototype.toString.call(t))t.forEach(function(t){e[t]=!0});else if(t===Object(t))e=t;else{if("[object Number]"!=Object.prototype.toString.call(t)&&"[object String]"!=Object.prototype.toString.call(t))throw Error("Provide an array, object, string or number when passing units!");e[t]=!0}return e}function o(e,r){for(var n=0,s=e.length;n<s;n++)if(t(e[n]).isSame(r))return!0;return!1}function h(t){switch(t){case"day":return"days";case"week":return"weeks";case"month":return"months";case"year":return"years";case"dayOfWeek":return"daysOfWeek";case"dayOfMonth":return"daysOfMonth";case"weekOfMonth":return"weeksOfMonth";case"weekOfMonthByDay":return"weeksOfMonthByDay";case"weekOfYear":return"weeksOfYear";case"monthOfYear":return"monthsOfYear";default:return t}}function u(t,n,s){var a,i,o,h;for(a=0,i=t.length;a<i;a++)if(o=t[a],"interval"===(h=f[o.measure])){if(!e.match(o.measure,o.units,s,n))return!1}else{if("calendar"!==h)return!1;if(!r.match(o.measure,o.units,n))return!1}return!0}var f={days:"interval",weeks:"interval",months:"interval",years:"interval",daysOfWeek:"calendar",daysOfMonth:"calendar",weeksOfMonth:"calendar",weeksOfMonthByDay:"calendar",weeksOfYear:"calendar",monthsOfYear:"calendar"},l={days:"day",weeks:"week",months:"month",years:"year",daysOfWeek:"dayOfWeek",daysOfMonth:"dayOfMonth",weeksOfMonth:"weekOfMonth",weeksOfMonthByDay:"weekOfMonthByDay",weeksOfYear:"weekOfYear",monthsOfYear:"monthOfYear"},c=function(e){e.start&&(this.start=t(e.start).dateOnly()),e.end&&(this.end=t(e.end).dateOnly()),this.rules=e.rules||[];var r=e.exceptions||[];this.exceptions=[];for(var n=0;n<r.length;n++)this.except(r[n]);return this.units=null,this.measure=null,this.from=null,this};c.prototype.startDate=function(e){return null===e?(this.start=null,this):e?(this.start=t(e).dateOnly(),this):this.start},c.prototype.endDate=function(e){return null===e?(this.end=null,this):e?(this.end=t(e).dateOnly(),this):this.end},c.prototype.fromDate=function(e){return null===e?(this.from=null,this):e?(this.from=t(e).dateOnly(),this):this.from},c.prototype.save=function(){var e={};this.start&&t(this.start).isValid()&&(e.start=this.start.format("L")),this.end&&t(this.end).isValid()&&(e.end=this.end.format("L")),e.exceptions=[];for(var r=0,n=this.exceptions.length;r<n;r++)e.exceptions.push(this.exceptions[r].format("L"));return e.rules=this.rules,e},c.prototype.repeats=function(){return this.rules.length>0},c.prototype.every=function(t,e){return void 0!==t&&null!==t&&(this.units=i(t)),void 0!==e&&null!==e&&(this.measure=h(e)),n.call(this)},c.prototype.except=function(e){return e=t(e).dateOnly(),this.exceptions.push(e),this},c.prototype.forget=function(e){var r,n,s=t(e);if(s.isValid()){for(s=s.dateOnly(),r=0,n=this.exceptions.length;r<n;r++)if(s.isSame(this.exceptions[r]))return this.exceptions.splice(r,1),this;return this}for(r=0,n=this.rules.length;r<n;r++)this.rules[r].measure===h(e)&&this.rules.splice(r,1)},c.prototype.hasRule=function(t){var e,r;for(e=0,r=this.rules.length;e<r;e++)if(this.rules[e].measure===h(t))return!0;return!1},c.prototype.matches=function(e,r){var n=t(e).dateOnly();if(!n.isValid())throw Error("Invalid date supplied to match method: "+e);return!(!r&&!a(this.start,this.end,n))&&(!o(this.exceptions,n)&&!!u(this.rules,n,this.start))},c.prototype.next=function(t,e){return s.call(this,t,e,"next")},c.prototype.previous=function(t,e){return s.call(this,t,e,"previous")},c.prototype.all=function(t){return s.call(this,null,t,"all")};for(var d in l)f.hasOwnProperty(d)&&(c.prototype[d]=c.prototype[l[d]]=function(t){return function(e){return this.every.call(this,e,t),this}}(d));return c}();return t.recur=function(e,r){return new n(e!==Object(e)||t.isMoment(e)?{start:e,end:r}:e)},t.fn.recur=function(e,r){return e!==Object(e)||t.isMoment(e)?(r||(r=e,e=void 0),e||(e=this),new n({start:e,end:r,moment:this})):(void 0===e.start&&(e.start=this),new n(e))},t.fn.monthWeek=function(){var t=this.clone().startOf("month").startOf("week");return this.clone().startOf("week").diff(t,"weeks")},t.fn.monthWeekByDay=function(t){var e,r,n,s;return e=this.clone(),r=this.clone().startOf("month").startOf("week"),n=this.clone().startOf("week"),s=n.diff(r,"weeks"),e.subtract(s,"weeks").month()===this.clone().month()?s:s-1},t.fn.dateOnly=function(){return this.tz&&"function"==typeof t.tz?t.tz(this.format("YYYY-MM-DDT00:00:00.000Z"),"UTC"):this.hours(0).minutes(0).seconds(0).milliseconds(0).add(this.utcOffset(),"minute").utcOffset(0)},t});