!function(e){"use strict";function t(t){var n=t.selector;t.each(function(){var t="fancyInput",n=e('<div><b class="caret">&#8203;</b></div>');"TEXTAREA"==this.tagName&&(t+=" textarea"),e(this.parentNode).append(n).addClass(t),this.value&&s.fillText(this.value,this)}),e(document).on("keypress.fi",n,s.keypress).on("keyup.fi select.fi mouseup.fi cut.fi paste.fi",n,s.allEvents).on("mousedown.fi mouseup.fi keydown.fi",n,l.set).on("keydown.fi",n,s.keydown)}var n,i=!!window.ActiveXObject;e.fn.fancyInput=function(){return i||t(this),this};var s={classToggler:"state1",keypress:function(e){var t=String.fromCharCode(e.charCode),n=this.nextElementSibling,i=this.selectionEnd,l="TEXTAREA"==this.tagName&&13==e.keyCode;if(this.selectionEnd-this.selectionStart>0&&e.charCode&&!e.ctrlKey){var a=[this.selectionStart,this.selectionEnd];i=this.selectionStart,"rtl"==r.lastDir&&(a=[this.value.length-this.selectionEnd,this.value.length-this.selectionStart+1]),s.removeChars(n,a)}if(e.charCode&&!e.ctrlKey||l){var o=r.check(t);("rtl"==o||""==o&&"rtl"==r.lastDir)&&(i=this.value.length-this.selectionStart),l&&(t=""),s.writer(t,this,i)}},setCaretHeight:function(t){var i=e(t.nextElementSibling);return i.find("span").length?(n=i.find("span")[0].clientHeight,void i.find("b").height(n)):!1},writer:function(t,n,i){var s=e(n.nextElementSibling).children().not("b"),l=document.createElement("span");if(" "==t&&(t="&nbsp;"),t?(l.innerHTML=t,this.classToggler="state2"==this.classToggler?"state1":"state2",l.className=this.classToggler):l=document.createElement("br"),s.length)if(0==i)e(n.nextElementSibling).prepend(l);else{var r=s.eq(--i);r.after(l)}else n.nextElementSibling.appendChild(l);return t&&setTimeout(function(){l.removeAttribute("class")},20),this},clear:function(t){var n=e(t.parentNode).find(".caret");e(t).html(n)},fillText:function(e,t){var n,i=t.nextElementSibling,l=document.createDocumentFragment();s.clear(t.nextElementSibling),setTimeout(function(){for(var t=e.length,s=0;t>s;s++){var r="span";"\n"==e[s]&&(r="br"),n=document.createElement(r),n.innerHTML=" "==e[s]?"&nbsp;":e[s],l.appendChild(n)}i.appendChild(l)},0)},removeChars:function(t,n){var i,s=e(t).children().not("b").not(".deleted");e(t).find("b");n[0]==n[1]&&n[0]--,i=s.slice(n[0],n[1]),n[1]-n[0]==1?(i.css("position","absolute"),setTimeout(function(){i.addClass("deleted")},0),setTimeout(function(){i.remove()},140)):i.remove()},inputResize:function(t){if("TEXTAREA"==t.tagName){t.style.top="-999px";var n=t.parentNode.scrollHeight;e(t).outerHeight()<t.parentNode.scrollHeight&&(n+=10),t.style.height=n+"px",t.style.top="0",setTimeout(function(){t.scrollTop=0,t.parentNode.scrollTop=9999},50)}if("INPUT"==t.tagName&&"text"==t.type){t.style.width=0;var i=t.parentNode.scrollWidth;t.parentNode.scrollWidth>t.parentNode.clientWidth&&(i+=20),t.style.width=i+"px"}},keydown:function(e){var t=(String.fromCharCode(e.charCode),this.nextElementSibling),n=(this.selectionEnd,e.ctrlKey&&90==e.keyCode),i=e.ctrlKey&&89==e.keyCode,l=e.ctrlKey&&65==e.keyCode;if(s.textLength=this.value.length,s.setCaret(this),l)return!0;if(n||i)return setTimeout(function(){s.fillText(e.target.value,e.target)},50),!0;if(8==e.keyCode||46==e.keyCode){var a=[this.selectionStart,this.selectionEnd];"rtl"==r.lastDir&&(a=[this.value.length-this.selectionEnd,this.value.length-this.selectionStart+1]),setTimeout(function(){e.ctrlKey&&(a=[e.target.selectionStart,a[0]]),s.removeChars(t,a)},0)}return 0==this.selectionStart&&(this.parentNode.scrollLeft=0),!0},allEvents:function(e){s.setCaret(this),"paste"==e.type&&setTimeout(function(){s.fillText(e.target.value,e.target),s.inputResize(e.target)},20),"cut"==e.type&&s.removeChars(this.nextElementSibling,[this.selectionStart,this.selectionEnd]),"select"==e.type,s.textLength!=e.target.value.length&&s.inputResize(e.target),n||setTimeout(function(){s.setCaretHeight(e.target)},150),this.selectionStart==this.value.length&&(this.parentNode.scrollLeft=999999)},setCaret:function(t){var n=e(t.parentNode).find(".caret"),i=e(t.nextElementSibling).children().not("b"),l=i.not(".deleted"),a=s.getCaretPosition(t);"rtl"==r.lastDir&&(a=t.value.length-a);var o=l.eq(a);a==t.value.length?n.appendTo(t.nextElementSibling):n.insertBefore(o)},getCaretPosition:function(e){var t,n=l.direction||"right";return(e.selectionStart||"0"==e.selectionStart)&&(t="left"==n?e.selectionStart:e.selectionEnd),t||0}},l={direction:null,lastOffset:null,set:function(e){var t;e.shiftKey&&37==e.keyCode?t="left":e.shiftKey&&39==e.keyCode&&(t="right"),"mousedown"==e.type?l.lastOffset=e.clientX:"mouseup"==e.type&&(t=e.clientX<l.lastOffset?"left":"right"),l.direction=t}},r={lastDir:null,check:function(e){var t="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿",n="֑-߿יִ-﷽ﹰ-ﻼ",i=new RegExp("^[^"+n+"]*["+t+"]"),s=new RegExp("^[^"+t+"]*["+n+"]"),l=s.test(e)?"rtl":i.test(e)?"ltr":"";return l&&(this.lastDir=l),l}};window.fancyInput=s}(window.jQuery);