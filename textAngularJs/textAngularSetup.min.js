function validElementString(t){try{return 0!==angular.element(t).length}catch(t){return!1}}var taTools={};function registerTextAngularTool(t,e){if(!t||""===t||taTools.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(e.display&&(""===e.display||!validElementString(e.display))||!e.display&&!e.buttontext&&!e.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';taTools[t]=e}angular.module("textAngularSetup",[]).constant("taRegisterTool",registerTextAngularTool).value("taTools",taTools).value("taOptions",{forceTextAngularSanitize:!0,keyMappings:[],toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(t){},htmlEditorSetup:function(t){}},defaultFileDropHandler:function(t,e){var n=new FileReader;return"image"===t.type.substring(0,5)&&(n.onload=function(){""!==n.result&&e("insertImage",n.result,!0)},n.readAsDataURL(t),!0)}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(t){var e=angular.element("<iframe></iframe>"),n=t.prop("attributes");angular.forEach(n,function(t){e.attr(t.name,t.value)}),e.attr("src",e.attr("ta-insert-video")),t.replaceWith(e)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyFull:{tooltip:"Justify text"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(u,c){return{imgOnSelectAction:function(t,e,n){function o(){n.updateTaBindtaTextElement(),n.hidePopover()}t.preventDefault(),n.displayElements.popover.css("width","375px");var i=n.displayElements.popoverContainer;i.empty();var a=angular.element('<div class="btn-group" style="padding-right: 6px;">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');l.on("click",function(t){t.preventDefault(),e.css({width:"100%",height:""}),o()});var r=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');r.on("click",function(t){t.preventDefault(),e.css({width:"50%",height:""}),o()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');s.on("click",function(t){t.preventDefault(),e.css({width:"25%",height:""}),o()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');u.on("click",function(t){t.preventDefault(),e.css({width:"",height:""}),o()}),a.append(l),a.append(r),a.append(s),a.append(u),i.append(a),a=angular.element('<div class="btn-group" style="padding-right: 6px;">');var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');c.on("click",function(t){t.preventDefault(),e.css("float","left"),e.css("cssFloat","left"),e.css("styleFloat","left"),o()});var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');d.on("click",function(t){t.preventDefault(),e.css("float","right"),e.css("cssFloat","right"),e.css("styleFloat","right"),o()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(t){t.preventDefault(),e.css("float",""),e.css("cssFloat",""),e.css("styleFloat",""),o()}),a.append(c),a.append(p),a.append(d),i.append(a),a=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(t){t.preventDefault(),e.remove(),o()}),a.append(f),i.append(a),n.showPopover(e),n.showResizeOverlay(e)},aOnSelectAction:function(t,n,o){t.preventDefault(),o.displayElements.popover.css("width","436px");var e=o.displayElements.popoverContainer;e.empty(),e.css("line-height","28px");var i=angular.element('<a href="'+n.attr("href")+'" target="_blank">'+n.attr("href")+"</a>");i.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),e.append(i);var a=angular.element('<div class="btn-group pull-right">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+c.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');l.on("click",function(t){t.preventDefault();var e=u.prompt(c.insertLink.dialogPrompt,n.attr("href"));e&&""!==e&&"http://"!==e&&(n.attr("href",e),o.updateTaBindtaTextElement()),o.hidePopover()}),a.append(l);var r=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+c.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');r.on("click",function(t){t.preventDefault(),n.replaceWith(n.contents()),o.updateTaBindtaTextElement(),o.hidePopover()}),a.append(r);var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+c.editLink.targetToggle.buttontext+"</button>");"_blank"===n.attr("target")&&s.addClass("active"),s.on("click",function(t){t.preventDefault(),n.attr("target","_blank"===n.attr("target")?"":"_blank"),s.toggleClass("active"),o.updateTaBindtaTextElement()}),a.append(s),e.append(a),o.showPopover(n)},extractYoutubeVideoId:function(t){var e=t.match(/(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);return e&&e[1]||null}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions","$sanitize","taOptions","$log",function(n,o,i,r,a,t,e,l){var s={};if(t("",s),!0===e.forceTextAngularSanitize&&"taSanitize"!==s.version)throw angular.$$minErr("textAngular")("textAngularSetup","The textAngular-sanitize provider has been replaced by another -- have you included angular-sanitize by mistake?");n("html",{iconclass:"fa fa-code",tooltiptext:i.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});function u(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")}angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){var e;n(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:i.heading.tooltip+t.charAt(1),action:u,activeState:(e=t.toLowerCase(),function(){return this.$editor().queryFormatBlockState(e)})})}),n("p",{buttontext:"P",tooltiptext:i.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),n("pre",{buttontext:"pre",tooltiptext:i.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),n("ul",{iconclass:"fa fa-list-ul",tooltiptext:i.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),n("ol",{iconclass:"fa fa-list-ol",tooltiptext:i.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),n("quote",{iconclass:"fa fa-quote-right",tooltiptext:i.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),n("undo",{iconclass:"fa fa-undo",tooltiptext:i.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),n("redo",{iconclass:"fa fa-repeat",tooltiptext:i.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),n("bold",{iconclass:"fa fa-bold",tooltiptext:i.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),n("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:i.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(t){if(t&&"#document"===t.nodeName)return!1;var e=!1;if(t)try{e="left"===t.css("text-align")||"left"===t.attr("align")||"right"!==t.css("text-align")&&"center"!==t.css("text-align")&&"justify"!==t.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")}catch(t){e=!1}return e=e||this.$editor().queryCommandState("justifyLeft")}}),n("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:i.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(t){if(t&&"#document"===t.nodeName)return!1;var e=!1;if(t)try{e="right"===t.css("text-align")}catch(t){e=!1}return e=e||this.$editor().queryCommandState("justifyRight")}}),n("justifyFull",{iconclass:"fa fa-align-justify",tooltiptext:i.justifyFull.tooltip,action:function(){return this.$editor().wrapSelection("justifyFull",null)},activeState:function(t){var e=!1;if(t)try{e="justify"===t.css("text-align")}catch(t){e=!1}return e=e||this.$editor().queryCommandState("justifyFull")}}),n("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:i.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(t){if(t&&"#document"===t.nodeName)return!1;var e=!1;if(t)try{e="center"===t.css("text-align")}catch(t){e=!1}return e=e||this.$editor().queryCommandState("justifyCenter")}}),n("indent",{iconclass:"fa fa-indent",tooltiptext:i.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),n("outdent",{iconclass:"fa fa-outdent",tooltiptext:i.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),n("italics",{iconclass:"fa fa-italic",tooltiptext:i.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),n("underline",{iconclass:"fa fa-underline",tooltiptext:i.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),n("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:i.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),n("clear",{iconclass:"fa fa-ban",tooltiptext:i.clear.tooltip,action:function(t,e){this.$editor().wrapSelection("removeFormat",null);var n=angular.element(r.getSelectionElement()),o=r.getAllSelectedElements(),i=function(t,e){t=angular.element(t);var n=e?e:t;return angular.forEach(t.children(),function(t){var e;n="ul"===t.tagName.toLowerCase()||"ol"===t.tagName.toLowerCase()?i(t,n):((e=angular.element("<p></p>")).html(angular.element(t).html()),n.after(e),e)}),t.remove(),n};angular.forEach(o,function(t){"ul"!==t.nodeName.toLowerCase()&&"ol"!==t.nodeName.toLowerCase()||i(t)}),angular.forEach(n.find("ul"),i),angular.forEach(n.find("ol"),i);var a=this.$editor(),l=function(t){(t=angular.element(t))[0]!==a.displayElements.text[0]&&t.removeAttr("class"),angular.forEach(t.children(),l)};angular.forEach(n,l),n[0]&&"li"!==n[0].tagName.toLowerCase()&&"ol"!==n[0].tagName.toLowerCase()&&"ul"!==n[0].tagName.toLowerCase()&&"true"!==n[0].getAttribute("contenteditable")&&this.$editor().wrapSelection("formatBlock","default"),e()}});function c(t){return-1!==t.toLowerCase().indexOf("javascript")}n("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:i.insertImage.tooltip,action:function(){var t=o.prompt(i.insertImage.dialogPrompt,"http://");if(t&&""!==t&&"http://"!==t&&!c(t)){r.getSelectionElement().tagName&&"a"===r.getSelectionElement().tagName.toLowerCase()&&r.setSelectionAfterElement(r.getSelectionElement());var e='<img src="'+t+'">';return this.$editor().wrapSelection("insertHTML",e,!0)}},onElementSelect:{element:"img",action:a.imgOnSelectAction}}),n("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:i.insertVideo.tooltip,action:function(){var t=o.prompt(i.insertVideo.dialogPrompt,"https://");if(!c(t)&&t&&""!==t&&"https://"!==t&&(videoId=a.extractYoutubeVideoId(t),videoId)){var e="https://www.youtube.com/embed/"+videoId,n='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg" ta-insert-video="'+e+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return r.getSelectionElement().tagName&&"a"===r.getSelectionElement().tagName.toLowerCase()&&r.setSelectionAfterElement(r.getSelectionElement()),this.$editor().wrapSelection("insertHTML",n,!0)}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:a.imgOnSelectAction}}),n("insertLink",{tooltiptext:i.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var t=r.getSelectionElement().tagName&&"a"===r.getSelectionElement().tagName.toLowerCase()?o.prompt(i.insertLink.dialogPrompt,r.getSelectionElement().href):o.prompt(i.insertLink.dialogPrompt,"http://");if(t&&""!==t&&"http://"!==t&&!c(t))return this.$editor().wrapSelection("createLink",t,!0)},activeState:function(t){return!!t&&"A"===t[0].tagName},onElementSelect:{element:"a",action:a.aOnSelectAction}}),n("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var t=this.$editor().displayElements.text[0].innerHTML||"",e=0;return""!==t.replace(/\s*<[^>]*?>\s*/g,"")&&""!==t.trim()&&(e=t.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=e,this.$editor().wordcount=e,!1}}),n("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var t=this.$editor().displayElements.text,e=(t[0].innerText||t[0].textContent).replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=e,this.$editor().charcount=e,!1}})}]);