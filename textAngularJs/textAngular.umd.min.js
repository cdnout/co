!function(n,a){"function"==typeof define&&define.amd?define("textAngular",["rangy","rangy/lib/rangy-selectionsaverestore"],function(e,t){return n["textAngular.name"]=a(e)}):"object"==typeof module&&module.exports?module.exports=a(require("rangy"),require("rangy/lib/rangy-selectionsaverestore")):n.textAngular=a(n.rangy)}(this,function(Q){var n={};angular.module("textAngularSetup",[]).constant("taRegisterTool",function(e,t){if(!e||""===e||n.hasOwnProperty(e))throw"textAngular Error: A unique name is required for a Tool Definition";if(t.display&&(""===t.display||!function(e){try{return 0!==angular.element(e).length}catch(e){return}}(t.display))||!t.display&&!t.buttontext&&!t.iconclass)throw'textAngular Error: Tool Definition for "'+e+'" does not have a valid display/iconclass/buttontext value';n[e]=t}).value("taTools",n).value("taOptions",{forceTextAngularSanitize:!0,keyMappings:[],toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(e){},htmlEditorSetup:function(e){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)&&(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0)}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyFull:{tooltip:"Justify text"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(d,u){return{imgOnSelectAction:function(e,t,n){function a(){n.updateTaBindtaTextElement(),n.hidePopover()}e.preventDefault(),n.displayElements.popover.css("width","375px");var o=n.displayElements.popoverContainer;o.empty();var r=angular.element('<div class="btn-group" style="padding-right: 6px;">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()});var i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');i.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()});var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');d.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),r.append(l),r.append(i),r.append(s),r.append(d),o.append(r),r=angular.element('<div class="btn-group" style="padding-right: 6px;">');var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');u.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()});var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');c.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),r.append(u),r.append(p),r.append(c),o.append(r),r=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(e){e.preventDefault(),t.remove(),a()}),r.append(f),o.append(r),n.showPopover(t),n.showResizeOverlay(t)},aOnSelectAction:function(e,n,a){e.preventDefault(),a.displayElements.popover.css("width","436px");var t=a.displayElements.popoverContainer;t.empty(),t.css("line-height","28px");var o=angular.element('<a href="'+n.attr("href")+'" target="_blank">'+n.attr("href")+"</a>");o.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),t.append(o);var r=angular.element('<div class="btn-group pull-right">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+u.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');l.on("click",function(e){e.preventDefault();var t=d.prompt(u.insertLink.dialogPrompt,n.attr("href"));t&&""!==t&&"http://"!==t&&(n.attr("href",t),a.updateTaBindtaTextElement()),a.hidePopover()}),r.append(l);var i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+u.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');i.on("click",function(e){e.preventDefault(),n.replaceWith(n.contents()),a.updateTaBindtaTextElement(),a.hidePopover()}),r.append(i);var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+u.editLink.targetToggle.buttontext+"</button>");"_blank"===n.attr("target")&&s.addClass("active"),s.on("click",function(e){e.preventDefault(),n.attr("target","_blank"===n.attr("target")?"":"_blank"),s.toggleClass("active"),a.updateTaBindtaTextElement()}),r.append(s),t.append(r),a.showPopover(n)},extractYoutubeVideoId:function(e){var t=e.match(/(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);return t&&t[1]||null}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions","$sanitize","taOptions","$log",function(n,a,o,i,r,e,t,l){var s={};if(e("",s),!0===t.forceTextAngularSanitize&&"taSanitize"!==s.version)throw angular.$$minErr("textAngular")("textAngularSetup","The textAngular-sanitize provider has been replaced by another -- have you included angular-sanitize by mistake?");n("html",{iconclass:"fa fa-code",tooltiptext:o.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});function d(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")}angular.forEach(["h1","h2","h3","h4","h5","h6"],function(e){var t;n(e.toLowerCase(),{buttontext:e.toUpperCase(),tooltiptext:o.heading.tooltip+e.charAt(1),action:d,activeState:(t=e.toLowerCase(),function(){return this.$editor().queryFormatBlockState(t)})})}),n("p",{buttontext:"P",tooltiptext:o.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),n("pre",{buttontext:"pre",tooltiptext:o.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),n("ul",{iconclass:"fa fa-list-ul",tooltiptext:o.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),n("ol",{iconclass:"fa fa-list-ol",tooltiptext:o.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),n("quote",{iconclass:"fa fa-quote-right",tooltiptext:o.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),n("undo",{iconclass:"fa fa-undo",tooltiptext:o.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),n("redo",{iconclass:"fa fa-repeat",tooltiptext:o.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),n("bold",{iconclass:"fa fa-bold",tooltiptext:o.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),n("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:o.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;if(e)try{t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyLeft")}}),n("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:o.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;if(e)try{t="right"===e.css("text-align")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyRight")}}),n("justifyFull",{iconclass:"fa fa-align-justify",tooltiptext:o.justifyFull.tooltip,action:function(){return this.$editor().wrapSelection("justifyFull",null)},activeState:function(e){var t=!1;if(e)try{t="justify"===e.css("text-align")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyFull")}}),n("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:o.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;if(e)try{t="center"===e.css("text-align")}catch(e){t=!1}return t=t||this.$editor().queryCommandState("justifyCenter")}}),n("indent",{iconclass:"fa fa-indent",tooltiptext:o.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),n("outdent",{iconclass:"fa fa-outdent",tooltiptext:o.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),n("italics",{iconclass:"fa fa-italic",tooltiptext:o.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),n("underline",{iconclass:"fa fa-underline",tooltiptext:o.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),n("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:o.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),n("clear",{iconclass:"fa fa-ban",tooltiptext:o.clear.tooltip,action:function(e,t){this.$editor().wrapSelection("removeFormat",null);var n=angular.element(i.getSelectionElement()),a=i.getAllSelectedElements(),o=function(e,t){e=angular.element(e);var n=t?t:e;return angular.forEach(e.children(),function(e){var t;n="ul"===e.tagName.toLowerCase()||"ol"===e.tagName.toLowerCase()?o(e,n):((t=angular.element("<p></p>")).html(angular.element(e).html()),n.after(t),t)}),e.remove(),n};angular.forEach(a,function(e){"ul"!==e.nodeName.toLowerCase()&&"ol"!==e.nodeName.toLowerCase()||o(e)}),angular.forEach(n.find("ul"),o),angular.forEach(n.find("ol"),o);var r=this.$editor(),l=function(e){(e=angular.element(e))[0]!==r.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),l)};angular.forEach(n,l),n[0]&&"li"!==n[0].tagName.toLowerCase()&&"ol"!==n[0].tagName.toLowerCase()&&"ul"!==n[0].tagName.toLowerCase()&&"true"!==n[0].getAttribute("contenteditable")&&this.$editor().wrapSelection("formatBlock","default"),t()}});function u(e){return-1!==e.toLowerCase().indexOf("javascript")}n("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:o.insertImage.tooltip,action:function(){var e=a.prompt(o.insertImage.dialogPrompt,"http://");if(e&&""!==e&&"http://"!==e&&!u(e)){i.getSelectionElement().tagName&&"a"===i.getSelectionElement().tagName.toLowerCase()&&i.setSelectionAfterElement(i.getSelectionElement());var t='<img src="'+e+'">';return this.$editor().wrapSelection("insertHTML",t,!0)}},onElementSelect:{element:"img",action:r.imgOnSelectAction}}),n("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:o.insertVideo.tooltip,action:function(){var e=a.prompt(o.insertVideo.dialogPrompt,"https://");if(!u(e)&&e&&""!==e&&"https://"!==e&&(videoId=r.extractYoutubeVideoId(e),videoId)){var t="https://www.youtube.com/embed/"+videoId,n='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg" ta-insert-video="'+t+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return i.getSelectionElement().tagName&&"a"===i.getSelectionElement().tagName.toLowerCase()&&i.setSelectionAfterElement(i.getSelectionElement()),this.$editor().wrapSelection("insertHTML",n,!0)}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:r.imgOnSelectAction}}),n("insertLink",{tooltiptext:o.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e=i.getSelectionElement().tagName&&"a"===i.getSelectionElement().tagName.toLowerCase()?a.prompt(o.insertLink.dialogPrompt,i.getSelectionElement().href):a.prompt(o.insertLink.dialogPrompt,"http://");if(e&&""!==e&&"http://"!==e&&!u(e))return this.$editor().wrapSelection("createLink",e,!0)},activeState:function(e){return!!e&&"A"===e[0].tagName},onElementSelect:{element:"a",action:r.aOnSelectAction}}),n("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text[0].innerHTML||"",t=0;return""!==e.replace(/\s*<[^>]*?>\s*/g,"")&&""!==e.trim()&&(t=e.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=t,this.$editor().wordcount=t,!1}}),n("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=(e[0].innerText||e[0].textContent).replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=t,this.$editor().charcount=t,!1}})}]);var Z=function(){for(var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",n[0];);return 4<e?e:void 0}(),e=/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent),t=(navigator.userAgent.toLowerCase().indexOf("firefox"),t||{});t.now=t.now||t.mozNow||t.msNow||t.oNow||t.webkitNow||function(){return(new Date).getTime()};var r,ee,te,a,o,l,i,ne=/^(address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,W=/^(ul|li|ol)$/i,ae=/^(#text|span|address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),8<Z||void 0===Z){for(var s=document.styleSheets,d=0;d<s.length;d++)if((0===s[d].media.length||s[d].media.mediaText.match(/(all|screen)/gi))&&s[d].href&&s[d].href.match(/textangular\.(min\.|)css/gi)){r=s[d];break}r||(i=document.createElement("style"),e&&i.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(i),r=i.sheet),ee=function(e,t){return a(r,e,t)},a=function(e,t,n){var a,o;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),r.rules?o=r.rules[a]:r.cssRules&&(o=r.cssRules[a]),o},l=function(e,t){for(var n,a=0;a<t.length;a++)if(t[a].cssText===e.cssText){n=a;break}return n},te=function(e){o(r,e)},o=function(e,t){var n,a=e.cssRules||e.rules;a&&0!==a.length&&(n=l(t,a),e.removeRule?e.removeRule(n):e.deleteRule(n))}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===Z?"div":Z<=8?"P":"p":Z<=8?e.toUpperCase():e:Z<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(t,a){return function(e){var n=angular.element("<div></div>");return n[0].innerHTML=e,angular.forEach(t,function(t){var e=[];t.selector&&""!==t.selector?e=n.find(t.selector):t.customAttribute&&""!==t.customAttribute&&(e=a.getByAttribute(n,t.customAttribute)),angular.forEach(e,function(e){e=angular.element(e),t.selector&&""!==t.selector&&t.customAttribute&&""!==t.customAttribute&&void 0===e.attr(t.customAttribute)||t.renderLogic(e)})}),n[0].innerHTML}}]).factory("taFixChrome",function(){return function(e,t){if(!e||!angular.isString(e)||e.length<=0)return e;for(var n,a,o,r=/style\s?=\s?(["'])(?:(?=(\\?))\2.)*?\1/gi,l=/<span class="Apple-converted-space">([^<]+)<\/span>/gi,i="",s=0;n=l.exec(e);)o=(o=n[1]).replace(/&nbsp;/gi," "),i+=e.substring(s,n.index)+o,s=n.index+n[0].length;if(s&&(e=i+=e.substring(s),i="",s=0),!t){for(;n=r.exec(e);)i+=e.substring(s,n.index-1),a=n[0],(!(n=/font-family: inherit;|line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;|color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi.exec(a))||8<(a=a.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;|( |)color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|( |)background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi,"")).length)&&(i+=" "+a),s=r.lastIndex;i+=e.substring(s)}return 0<s?i.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e}}).factory("taSanitize",["$sanitize",function(u){for(var m=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],e=[],t=0;t<m.length;t++){for(var n="("+m[t].property+":\\s*(",a=0;a<m[t].values.length;a++)0<a&&(n+="|"),n+=m[t].values[a];n+=");)",e.push(n)}var g="("+e.join("|")+")";function h(e,t){for(var n,a=0,o=0,r=/<[^>]*>/gi;n=r.exec(e);)if(o=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,o)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(o)}var c=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi),p=new RegExp(/<span class="rangySelectionBoundary" id="selectionBoundary_\d+_\d+">[^<>]+?<\/span>/gi),f=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi);return function(e,t,n){if(!n)try{e=function e(t){if(!t||!angular.isString(t)||t.length<=0)return t;for(var n,a,o,r,l,i,s=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,d="",u="",c=0;a=s.exec(t);){r=a[3]||a[4];var p=new RegExp(g,"i");if(angular.isString(r)&&p.test(r)){l="";for(var f=new RegExp(g,"ig");o=f.exec(r);)for(n=0;n<m.length;n++)o[2*n+2]&&(l+="<"+m[n].tag+">");i=e(t.substring(c,a.index)),0<d.length?u+=h(i,d):u+=i,r=r.replace(new RegExp(g,"ig"),""),u+="<"+a[1].trim(),0<r.length&&(u+=' style="'+r+'"'),u+=a[5]+">",c=a.index+a[0].length,d=l}}return 0<d.length?u+=h(t.substring(c),d):u+=t.substring(c),u}(e)}catch(e){}if(e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",o=0;t=n.exec(e);){a+=e.substring(o,t.index),o=t.index+t[0].length;var r="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(r)?r=r.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):r+=' style="text-align:'+(t[3]||t[4])+';"',a+=r+=">"}return a+e.substring(o)}(e))try{e=(e=(e=(e=e.replace(c,"")).replace(p,"")).replace(c,"")).replace(f,"")}catch(e){}try{d=u(e),n&&(d=e)}catch(e){d=t||""}for(var a,o=d.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),r=d.replace(/(&#(9|10);)*/gi,""),l=/<pre[^>]*>.*?<\/pre[^>]*>/gi,i=0,s=0,d="";null!==(a=l.exec(r))&&i<o.length;)d+=r.substring(s,a.index)+o[i],s=a.index+a[0].length,i++;return d+r.substring(s)}}]).factory("taToolExecuteAction",["$q","$log",function(r,l){return function(e){void 0!==e&&(this.$editor=function(){return e});var t,n=r.defer(),a=n.promise,o=this.$editor();try{t=this.action(n,o.startAction()),a.finally(function(){o.endAction.call(o)})}catch(e){l.error(e)}!t&&void 0!==t||n.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(k,M,H){function D(e,t){for(var n,a=e.find("li"),o=a.length-1;0<=o;o--)n=angular.element("<"+t+">"+a[o].innerHTML+"</"+t+">"),e.after(n);e.remove(),k.setSelectionToElementEnd(n[0])}function B(e,t,n,a,o){for(var r,l,i,s,d=e.find("li"),u=0;u<d.length;u++)if(d[u].outerHTML===t[0].outerHTML){0<(s=u)&&(l=d[u-1]),u+1<d.length&&(i=d[u+1]);break}var c="";if(a?c+="<"+o+">"+t[0].innerHTML+"</"+o+">":(c+="<"+M(n)+">",c+="<li>"+t[0].innerHTML+"</li>",c+="</"+M(n)+">"),r=angular.element(c),!l)return t.remove(),e.after(angular.element(e[0].outerHTML)),e.after(r),e.remove(),void k.setSelectionToElementEnd(r[0]);if(i){e.parent();var p="",f=e[0].nodeName.toLowerCase();for(p+="<"+f+">",u=0;u<s;u++)p+="<li>"+d[u].innerHTML+"</li>";p+="</"+f+">";var m="";for(m+="<"+f+">",u=s+1;u<d.length;u++)m+="<li>"+d[u].innerHTML+"</li>";m+="</"+f+">",e.after(angular.element(m)),e.after(r),e.after(angular.element(p)),e.remove(),k.setSelectionToElementEnd(r[0])}else t.remove(),e.after(r),k.setSelectionToElementEnd(r[0])}function l(e){/(<br(|\/)>)$/i.test(e.innerHTML.trim())?k.setSelectionBeforeElement(angular.element(e).find("br")[0]):k.setSelectionToElementEnd(e)}function R(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),l(n.find("li")[0])}function K(e,t,n){for(var a="",o=0;o<e.length;o++)a+="<"+M("li")+">"+e[o].innerHTML+"</"+M("li")+">";var r=angular.element("<"+n+">"+a+"</"+n+">");t.after(r),t.remove(),l(r.find("li")[0])}var _=function(e,t){for(var n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];a.tagName&&a.tagName.match(ne)&&_(a,t)}if(null===e.parentNode)return e;if("<br>"===t)return e;var o=angular.element(t);return o[0].innerHTML=e.innerHTML,e.parentNode.insertBefore(o[0],e),e.parentNode.removeChild(e),o};return function($,A){return $=M($),function(e,t,n,a){var o,r,l,i,s,d,u,c,p,f=angular.element("<"+$+">");try{k.getSelection&&(u=k.getSelection()),void 0!==(d=k.getSelectionElement()).tagName&&("div"===d.tagName.toLowerCase()&&/taTextElement.+/.test(d.id)&&u&&u.start&&1===u.start.offset&&1===u.end.offset||"span"===d.tagName.toLowerCase()&&u&&u.start&&1===u.start.offset&&1===u.end.offset?(c=d.innerHTML,/<br>/i.test(c)&&(c=c.replace(/<br>/i,"&#8203;")),/<br\/>/i.test(c)&&(c=c.replace(/<br\/>/i,"&#8203;")),/<span>(<span>)+/i.test(c)&&(c=__.replace(/<span>(<span>)+/i,"<span>")),/<\/span>(<\/span>)+/i.test(c)&&(c=__.replace(/<\/span>(<\/span>)+/i,"</span>")),/<span><\/span>/i.test(c)&&(c=c.replace(/<span><\/span>/i,"")),p="<div>"+c+"</div>",d.innerHTML=p,k.setSelectionToElementEnd(d.childNodes[0]),d=k.getSelectionElement()):"p"===d.tagName.toLowerCase()&&u&&u.start&&1===u.start.offset&&1===u.end.offset?(c=d.innerHTML,/<br>/i.test(c)&&(c=c.replace(/<br>/i,"&#8203;"),d.innerHTML=c)):"li"===d.tagName.toLowerCase()&&u&&u.start&&u.start.offset===u.end.offset&&(c=d.innerHTML,/<br>/i.test(c)&&(c=c.replace(/<br>/i,""),d.innerHTML=c)))}catch(e){}if(d){var m=angular.element(d),g=d&&d.tagName&&d.tagName.toLowerCase()||"";if("insertorderedlist"===e.toLowerCase()||"insertunorderedlist"===e.toLowerCase()){var h=M("insertorderedlist"===e.toLowerCase()?"ol":"ul"),v=k.getOnlySelectedElements();if(1<v.length&&("ol"===g||"ul"===g))return function(e,t,n,a,o){for(var r,l,i,s,d=e.find("li"),u=[],c=0;c<d.length;c++)for(l=0;l<t.length;l++)d[c].isEqualNode(t[l])&&(u[l]=c);0<u[0]&&(i=d[u[0]-1]),u[t.length-1]+1<d.length&&(s=d[u[t.length-1]+1]);var p="";if(a)for(l=0;l<t.length;l++)p+="<"+o+">"+t[l].innerHTML+"</"+o+">",t[l].remove();else{for(p+="<"+M(n)+">",l=0;l<t.length;l++)p+=t[l].outerHTML,t[l].remove();p+="</"+M(n)+">"}if(r=angular.element(p),!i)return e.after(angular.element(e[0].outerHTML)),e.after(r),e.remove(),void k.setSelectionToElementEnd(r[0]);if(!s)return e.after(r),void k.setSelectionToElementEnd(r[0]);var f="",m=e[0].nodeName.toLowerCase();for(f+="<"+m+">",c=0;c<u[0];c++)f+="<li>"+d[c].innerHTML+"</li>";f+="</"+m+">";var g="";for(g+="<"+m+">",c=u[t.length-1]+1;c<d.length;c++)g+="<li>"+d[c].innerHTML+"</li>";g+="</"+m+">",e.after(angular.element(g)),e.after(r),e.after(angular.element(f)),e.remove(),k.setSelectionToElementEnd(r[0])}(m,v,h,h===g,$);if(g===h)return m[0].childNodes.length!==v.length&&1===v.length?(m=angular.element(v[0]),B(m.parent(),m,h,!0,$)):D(m,$);if("li"===g&&m.parent()[0].tagName.toLowerCase()===h&&1===m.parent().children().length)return D(m.parent(),$);if("li"===g&&m.parent()[0].tagName.toLowerCase()!==h&&1===m.parent().children().length)return R(m.parent(),h);if(g.match(ne)&&!m.hasClass("ta-bind")){if(v.length&&m[0].childNodes.length!==v.length&&1===v.length)return m=angular.element(v[0]),B(m.parent(),m,h,h===g,$);if("ol"===g||"ul"===g)return R(m,h);var y=!1;return angular.forEach(m.children(),function(e){e.tagName.match(ne)&&(y=!0)}),K(y?m.children():[angular.element("<div>"+d.innerHTML+"</div>")[0]],m,h)}if(g.match(ne)){if(0===(l=k.getOnlySelectedElements()).length)o=angular.element("<"+h+"><li>"+d.innerHTML+"</li></"+h+">"),m.html(""),m.append(o);else{if(1===l.length&&("ol"===l[0].tagName.toLowerCase()||"ul"===l[0].tagName.toLowerCase()))return l[0].tagName.toLowerCase()===h?D(angular.element(l[0]),$):R(angular.element(l[0]),h);r="";for(var b=[],x=0;x<l.length;x++)if(3!==l[x].nodeType){var E=angular.element(l[x]);if("li"===l[x].tagName.toLowerCase())continue;"ol"===l[x].tagName.toLowerCase()||"ul"===l[x].tagName.toLowerCase()?r+=E[0].innerHTML:"span"!==l[x].tagName.toLowerCase()||"ol"!==l[x].childNodes[0].tagName.toLowerCase()&&"ul"!==l[x].childNodes[0].tagName.toLowerCase()?r+="<"+M("li")+">"+E[0].innerHTML+"</"+M("li")+">":r+=E[0].childNodes[0].innerHTML,b.unshift(E)}o=angular.element("<"+h+">"+r+"</"+h+">"),b.pop().replaceWith(o),angular.forEach(b,function(e){e.remove()})}return void k.setSelectionToElementEnd(o[0])}}else{if("formatblock"===e.toLowerCase()){for("default"===(s=n.toLowerCase().replace(/[<>]/gi,"")).trim()&&(n="<"+(s=$)+">"),o="li"===g?m.parent():m;!o[0].tagName||!o[0].tagName.match(ne)&&!o.parent().attr("contenteditable");)g=((o=o.parent())[0].tagName||"").toLowerCase();if(g===s){l=o.children();var S=!1;for(x=0;x<l.length;x++)S=S||l[x].tagName.match(ne);o=S?(o.after(l),i=o.next(),o.remove(),i):(f.append(o[0].childNodes),o.after(f),o.remove(),f)}else if(o.parent()[0].tagName.toLowerCase()!==s||o.parent().hasClass("ta-bind"))if(g.match(W))o.wrap(n);else{for(0===(l=k.getOnlySelectedElements()).length&&(l=[o[0]]),x=0;x<l.length;x++)if(3===l[x].nodeType||!l[x].tagName.match(ne))for(;3===l[x].nodeType||!l[x].tagName||!l[x].tagName.match(ne);)l[x]=l[x].parentNode;if(1<(l=l.filter(function(e,t,n){return n.indexOf(e)===t})).length&&(l=l.filter(function(e,t,n){return!("div"===e.nodeName.toLowerCase()&&/^taTextElement/.test(e.id))})),angular.element(l[0]).hasClass("ta-bind"))(o=angular.element(n))[0].innerHTML=l[0].innerHTML,l[0].innerHTML=o[0].outerHTML;else if("blockquote"===s){for(r="",x=0;x<l.length;x++)r+=l[x].outerHTML;for((o=angular.element(n))[0].innerHTML=r,l[0].parentNode.insertBefore(o[0],l[0]),x=l.length-1;0<=x;x--)l[x].parentNode&&l[x].parentNode.removeChild(l[x])}else if("pre"===s&&k.getStateShiftKey()){for(r="",x=0;x<l.length;x++)r+=l[x].outerHTML;for((o=angular.element(n))[0].innerHTML=r,l[0].parentNode.insertBefore(o[0],l[0]),x=l.length-1;0<=x;x--)l[x].parentNode&&l[x].parentNode.removeChild(l[x])}else for(x=0;x<l.length;x++){var w=_(l[x],n);l[x]===o[0]&&(o=angular.element(w))}}else{var T=o.parent(),C=T.contents();for(x=0;x<C.length;x++)T.parent().hasClass("ta-bind")&&3===C[x].nodeType&&((f=angular.element("<"+$+">"))[0].innerHTML=C[x].outerHTML,C[x]=f[0]),T.parent()[0].insertBefore(C[x],T[0]);T.remove()}return k.setSelectionToElementEnd(o[0]),void o[0].focus()}if("createlink"===e.toLowerCase()){if("a"===g)return void(k.getSelectionElement().href=n);var N,L='<a href="'+n+'" target="'+(a.a.target?a.a.target:"")+'">';return void(k.getSelection().collapsed?k.insertHtml(L+n+"</a>",A):Q.getSelection().getRangeAt(0).canSurroundContents()&&(N=angular.element(L+"</a>")[0],Q.getSelection().getRangeAt(0).surroundContents(N)))}if("inserthtml"===e.toLowerCase())return void k.insertHtml(n,A)}try{H[0].execCommand(e,t,n)}catch(e){}}}}}]).service("taSelection",["$document","taDOM","$log",function(e,v,t){function a(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}}var n,y=e[0],b={getSelection:function(){var e;try{e=Q.getSelection().getRangeAt(0)}catch(e){return}var t=e.commonAncestorContainer,n={start:a(e.startContainer,e.startOffset),end:a(e.endContainer,e.endOffset),collapsed:e.collapsed};return 3===t.nodeType&&("div"===t.parentNode.nodeName.toLowerCase()&&/^taTextElement/.test(t.parentNode.id)||(t=t.parentNode)),"div"===t.nodeName.toLowerCase()&&/^taTextElement/.test(t.id)?(n.start.element=t.childNodes[n.start.offset],n.end.element=t.childNodes[n.end.offset],n.container=t):t.parentNode===n.start.element||t.parentNode===n.end.element?n.container=t.parentNode:n.container=t,n},updateLeftArrowKey:function(e){var t=Q.getSelection().getRangeAt(0);if(t&&t.collapsed){var n=b.getFlattenedDom(t);if(!n.findIndex)return;var a,o,r=t.startContainer,l=n.findIndex(function(e,t){return e.node===r||-1!==e.parents.indexOf(r)});if(n.forEach(function(e,t){e.parents.forEach(function(e,t){})}),l+1<n.length&&(a=n[l+1].node),a&&a.textContent&&/^\ufeff([^\ufeff]*)$/.exec(a.textContent))return;if(0<l&&(o=n[l-1].node),0===t.startOffset&&o&&/^\ufeff([^\ufeff]*)$/.exec(o.textContent))return void b.setSelectionToElementEnd(o)}},updateRightArrowKey:function(e){},getFlattenedDom:function(e){var t=e.commonAncestorContainer.parentNode;if(!t)return e.commonAncestorContainer.childNodes;var o=Array.prototype.slice.call(t.childNodes),n=o.indexOf(e.startContainer);return n+1<o.length&&0<n||t.parentNode&&(t=t.parentNode),o=[],function n(a){a.node.childNodes.length?Array.prototype.slice.call(a.node.childNodes).forEach(function(e){var t=a.parents.slice();t.slice(-1)[0]!==a.node&&t.push(a.node),n({parents:t,node:e})}):o.push({parents:a.parents,node:a.node})}({parents:[t],node:t}),o},getOnlySelectedElements:function(){var e=Q.getSelection().getRangeAt(0),t=3===(t=e.commonAncestorContainer).nodeType?t.parentNode:t;return e.getNodes([1],function(e){return e.parentNode===t})},getAllSelectedElements:function(){var e=Q.getSelection().getRangeAt(0),t=3===(t=e.commonAncestorContainer).nodeType?t.parentNode:t,n=e.getNodes([1],function(e){return e.parentNode===t});if(t.innerHTML.replace(/<span id=.selectionBoundary[^>]+>\ufeff?<\/span>/gi,"")===e.toHtml()&&("div"!==t.nodeName.toLowerCase()||!/^taTextElement/.test(t.id))){for(var a=[],o=n.length;o--;a.unshift(n[o]));(n=a).push(t)}return n},getSelectionElement:function(){return b.getSelection()?b.getSelection().container:void 0},setSelection:function(e,t,n,a){var o=Q.createRange();o.setStart(e,n),o.setEnd(t,a),Q.getSelection().setSingleRange(o)},setSelectionBeforeElement:function(e){var t=Q.createRange();t.selectNode(e),t.collapse(!0),Q.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=Q.createRange();t.selectNode(e),t.collapse(!1),Q.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=Q.createRange();t.selectNodeContents(e),t.collapse(!0),Q.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=Q.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),Q.getSelection().setSingleRange(t)},setStateShiftKey:function(e){n=e},getStateShiftKey:function(){return n},insertHtml:function(e,t){var n,a,o,r,l,i,s=angular.element("<div>"+e+"</div>"),d=Q.getSelection().getRangeAt(0),u=y.createDocumentFragment(),c=s[0].childNodes,p=!0;if(0<c.length){for(o=[],a=0;a<c.length;a++){var f=c[a];"p"===f.nodeName.toLowerCase()&&""===f.innerHTML.trim()||(p=p&&!ne.test(f.nodeName),o.push(f))}for(var m=0;m<o.length;m++)l=u.appendChild(o[m]);!p&&d.collapsed&&/^(|<br(|\/)>)$/i.test(d.startContainer.innerHTML)&&d.selectNode(d.startContainer)}else p=!0,l=u=y.createTextNode(e);if(p)d.deleteContents();else if(d.collapsed&&d.startContainer!==t)if(d.startContainer.innerHTML&&d.startContainer.innerHTML.match(/^<[^>]*>$/i))n=d.startContainer,1===d.startOffset?(d.setStartAfter(n),d.setEndAfter(n)):(d.setStartBefore(n),d.setEndBefore(n));else{if(3===d.startContainer.nodeType&&d.startContainer.parentNode!==t)for(h=(n=d.startContainer.parentNode).cloneNode(),v.splitNodes(n.childNodes,n,h,d.startContainer,d.startOffset);!ae.test(n.nodeName);){angular.element(n).after(h);var g=h,h=(n=n.parentNode).cloneNode();v.splitNodes(n.childNodes,n,h,g)}else h=(n=d.startContainer).cloneNode(),v.splitNodes(n.childNodes,n,h,void 0,void 0,d.startOffset);if(angular.element(n).after(h),d.setStartAfter(n),d.setEndAfter(n),/^(|<br(|\/)>)$/i.test(n.innerHTML.trim())&&(d.setStartBefore(n),d.setEndBefore(n),angular.element(n).remove()),/^(|<br(|\/)>)$/i.test(h.innerHTML.trim())&&angular.element(h).remove(),"li"===n.nodeName.toLowerCase()){for(i=y.createDocumentFragment(),r=0;r<u.childNodes.length;r++)s=angular.element("<li>"),v.transferChildNodes(u.childNodes[r],s[0]),v.transferNodeAttributes(u.childNodes[r],s[0]),i.appendChild(s[0]);u=i,l=l&&(l=u.childNodes[u.childNodes.length-1]).childNodes[l.childNodes.length-1]}}else d.deleteContents();d.insertNode(u),l&&b.setSelectionToElementEnd(l)}};return b}]).service("taDOM",function(){var d={getByAttribute:function(e,t){var n=[],a=e.children();return a.length&&angular.forEach(a,function(e){n=n.concat(d.getByAttribute(angular.element(e),t))}),void 0!==e.attr(t)&&n.push(e),n},transferChildNodes:function(e,t){for(t.innerHTML="";0<e.childNodes.length;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(e,t,n,a,o,r){if(!a&&isNaN(r))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var l=document.createDocumentFragment(),i=document.createDocumentFragment(),s=0;0<e.length&&(isNaN(r)||r!==s)&&e[0]!==a;)l.appendChild(e[0]),s++;for(!isNaN(o)&&0<=o&&e[0]&&(l.appendChild(document.createTextNode(e[0].nodeValue.substring(0,o))),e[0].nodeValue=e[0].nodeValue.substring(o));0<e.length;)i.appendChild(e[0]);d.transferChildNodes(l,t),d.transferChildNodes(i,n)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return d}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMaxText));if(isNaN(o))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(e){var t=angular.element("<div/>");return t.html(e),t.text().length<=o}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMinText));if(isNaN(o))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(e){var t=angular.element("<div/>");return t.html(e),!t.text().length||t.text().length>=o}}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){return function(e){return!e||""===function(e){var t=document.createElement("DIV");t.innerHTML=e;var n=t.textContent||t.innerText||"";return n.replace("​",""),n=n.trim()}(e)&&!/<img[^>]+>/.test(e)}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(O,F,I,P,e,V,U,j,G,X,Y,t,J){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(x,E,d,e){var s,S,u,w=e[0],c=e[1]||{},a=void 0!==E.attr("contenteditable")&&E.attr("contenteditable"),t=a||"textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase(),p=!1,n=!1,o=!1,T=d.taUnsafeSanitizer||G.disableSanitizer,r=d.taKeepStyles||G.keepStyles,f=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,m=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,g=[{specialKey:"UndoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:4,mustHaveModifiers:[3,8],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:15,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:7,mustHaveModifiers:[8],keyCode:9}];void 0===d.taDefaultWrap&&(d.taDefaultWrap="p"),""===d.taDefaultWrap?u="":(u=void 0===Z||11<=Z?"br"===d.taDefaultWrap.toLowerCase()?"<BR><BR>":"<"+d.taDefaultWrap+"><br></"+d.taDefaultWrap+">":Z<=8?"<"+d.taDefaultWrap.toUpperCase()+"></"+d.taDefaultWrap.toUpperCase()+">":"<"+d.taDefaultWrap+"></"+d.taDefaultWrap+">",void 0===Z||11<=Z?"br"===d.taDefaultWrap.toLowerCase()||(d.taDefaultWrap,d.taDefaultWrap):Z<=8?(d.taDefaultWrap.toUpperCase(),d.taDefaultWrap.toUpperCase()):(d.taDefaultWrap,d.taDefaultWrap)),c.$options||(c.$options={});function l(e){if(X(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+d.taDefaultWrap+">"+e+"</"+d.taDefaultWrap+">";else{for(var n=t[0].childNodes,a=!1,o=0;o<n.length&&!(a=n[o].nodeName.toLowerCase().match(ne));o++);if(a)for(e="",o=0;o<n.length;o++){var r,l,i=n[o],s=i.nodeName.toLowerCase();"#comment"===s?e+="\x3c!--"+i.nodeValue+"--\x3e":"#text"===s?(r=i.textContent).trim()?e+="<"+d.taDefaultWrap+">"+r+"</"+d.taDefaultWrap+">":e+=r:s.match(ne)?e+=i.outerHTML:""!==(l=i.outerHTML||i.nodeValue).trim()?e+="<"+d.taDefaultWrap+">"+l+"</"+d.taDefaultWrap+">":e+=l}else e="<"+d.taDefaultWrap+">"+e+"</"+d.taDefaultWrap+">"}return e}var h;d.taPaste&&(S=Y(d.taPaste)),E.addClass("ta-bind"),x["$undoManager"+(d.id||"")]=w.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return null==e||void 0!==this.current()&&null!==this.current()&&e===this.current()||(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),h&&F.cancel(h),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1),e},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){if(!(e<0||e>this._stack.length-1))return this._index=e,this.current()},current:function(){return this._stack[this._index]}};function C(){if(a)return E[0].innerHTML;if(t)return E.val();throw"textAngular Error: attempting to update non-editable taBind"}function i(e){return x.$emit("ta-element-select",this),e.preventDefault(),!1}function v(e,t,n){o=n||!1,null==t&&(t=a),null==e&&(e=C()),X(e)?(""!==w.$viewValue&&w.$setViewValue(""),t&&""!==w.$undoManager.current()&&w.$undoManager.push("")):(N(),w.$viewValue!==e&&(w.$setViewValue(e),t&&w.$undoManager.push(e))),w.$render()}function y(e){E[0].innerHTML=e}var b,N=x["reApplyOnSelectorHandlers"+(d.id||"")]=function(){p||angular.forEach(U,function(e){E.find(e).off("click",i).on("click",i)})},L=x["$undoTaBind"+(d.id||"")]=function(){var e;p||!a||null!=(e=w.$undoManager.undo())&&(y(e),v(e,!1),b&&F.cancel(b),b=F(function(){E[0].focus(),V.setSelectionToElementEnd(E[0])},1))},$=x["$redoTaBind"+(d.id||"")]=function(){var e;p||!a||null!=(e=w.$undoManager.redo())&&(y(e),v(e,!1),b&&F.cancel(b),b=F(function(){E[0].focus(),V.setSelectionToElementEnd(E[0])},1))};x["updateTaBind"+(d.id||"")]=function(){p||v(void 0,void 0,!0)};function A(e){return w.$oldViewValue=O(P(e,r),w.$oldViewValue,T)}if(E.attr("required")&&(w.$validators.required=function(e,t){return!X(e||t)}),w.$parsers.push(A),w.$parsers.unshift(l),w.$formatters.push(A),w.$formatters.unshift(l),w.$formatters.unshift(function(e){return w.$undoManager.push(e||"")}),t)if(x.events={},a){function k(e){var t=void 0!==e&&e.match(/content=["']*OneNote.File/i);if(e&&e.trim().length){if(e.match(/class=["']*Mso(Normal|List)/i)||e.match(/content=["']*Word.Document/i)||e.match(/content=["']*OneNote.File/i)){var n=e.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);n=(n=n?n[1]:e).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var a=angular.element("<div>"+n+"</div>"),o=angular.element("<div></div>"),r={element:null,lastIndent:[],lastLi:null,isUl:!1};r.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]};function l(e){r.isUl=e,r.element=angular.element(e?"<ul>":"<ol>"),r.lastIndent=[],r.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]},r.lastLevelMatch=null}for(var i=0;i<=a[0].childNodes.length;i++)if(a[0].childNodes[i]&&"#text"!==a[0].childNodes[i].nodeName){var s=a[0].childNodes[i].tagName.toLowerCase();if("p"===s||"ul"===s||"h1"===s||"h2"===s||"h3"===s||"h4"===s||"h5"===s||"h6"===s||"table"===s){var d=angular.element(a[0].childNodes[i]),u=(d.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(u){if(d[0].childNodes.length<2||d[0].childNodes[1].childNodes.length<1)continue;var c="bullet"===u[1].toLowerCase()||"number"!==u[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].childNodes[0].innerHTML)),p=(d.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),f=parseFloat(p?p[1]:0),m=(d.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(m&&m[2]&&(f=parseInt(m[2])),m&&(!r.lastLevelMatch||m[1]!==r.lastLevelMatch[1])||!u[3]||"first"===u[3].toLowerCase()||null===r.lastIndent.peek()||r.isUl!==c&&r.lastIndent.peek()===f)l(c),o.append(r.element);else if(null!=r.lastIndent.peek()&&r.lastIndent.peek()<f)r.element=angular.element(c?"<ul>":"<ol>"),r.lastLi.append(r.element);else if(null!=r.lastIndent.peek()&&r.lastIndent.peek()>f){for(;null!=r.lastIndent.peek()&&r.lastIndent.peek()>f;)if("li"!==r.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(r.element.parent()[0].tagName.toLowerCase()))break;r.element=r.element.parent(),r.lastIndent.pop()}else r.element=r.element.parent();r.isUl="ul"===r.element[0].tagName.toLowerCase(),c!==r.isUl&&(l(c),o.append(r.element))}r.lastLevelMatch=m,f!==r.lastIndent.peek()&&r.lastIndent.push(f),r.lastLi=angular.element("<li>"),r.element.append(r.lastLi),r.lastLi.html(d.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),d.remove()}else l(!1),o.append(d)}}function g(e){for(var t=(e=angular.element(e))[0].childNodes.length-1;0<=t;t--)e.after(e[0].childNodes[t]);e.remove()}angular.forEach(o.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&g(e)}),angular.forEach(o.find("font"),g),e=o.html(),t&&(e=o.html()||a.html()),e=e.replace(/\n/g," ")}else{if((e=e.replace(/<(|\/)meta[^>]*?>/gi,"")).match(/<[^>]*?(ta-bind)[^>]*?>/)){if(e.match(/<[^>]*?(text-angular)[^>]*?>/)){var h=angular.element("<div>"+e+"</div>");h.find("textarea").remove();for(var v=0;v<binds.length;v++){for(var y=binds[v][0].parentNode.parentNode,b=0;b<binds[v][0].childNodes.length;b++)y.parentNode.insertBefore(binds[v][0].childNodes[b],y);y.parentNode.removeChild(y)}e=h.html().replace('<br class="Apple-interchange-newline">',"")}}else e.match(/^<span/)&&(e.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/gi)||(e=e.replace(/<(|\/)span[^>]*?>/gi,"")));e=e.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}/<li(\s.*)?>/i.test(e)&&!1===/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(e)&&(e=e.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>")),e=e.replace(/^[ |\u00A0]+/gm,function(e){for(var t="",n=0;n<e.length;n++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),S&&(e=S(x,{$html:e})||e),e=e.replace(/<span style=("|')([^<]*?)vertical-align\s*:\s*super;?([^>]*?)("|')>([^<]+?)<\/span>/g,"<sup style='$2$3'>$5</sup>"),e=O(e,"",T),V.insertHtml(e,E[0]),F(function(){w.$setViewValue(C()),B=!1,E.removeClass("processing-paste")},0)}else B=!1,E.removeClass("processing-paste")}var M,H,D,B=!1;if(E.on("paste",x.events.paste=function(e,t){if(t&&angular.extend(e,t),p||B)return e.stopPropagation(),e.preventDefault(),!1;var n;B=!0,E.addClass("processing-paste");var a=(e.originalEvent||e).clipboardData;if(!a&&window.clipboardData&&window.clipboardData.getData)return n=window.clipboardData.getData("Text"),k(n),e.stopPropagation(),e.preventDefault(),!1;if(a&&a.getData&&0<a.types.length){for(var o="",r=0;r<a.types.length;r++)o+=" "+a.types[r];return/text\/html/i.test(o)?n=a.getData("text/html"):/text\/plain/i.test(o)&&(n=a.getData("text/plain")),k(n),e.stopPropagation(),e.preventDefault(),!1}var l=Q.saveSelection(),i=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');I.find("body").append(i),i[0].focus(),F(function(){Q.restoreSelection(l),k(i[0].innerHTML),E[0].focus(),i.remove()},0)}),E.on("cut",x.events.cut=function(e){p?e.preventDefault():F(function(){w.$setViewValue(C())},0)}),E.on("keydown",x.events.keydown=function(t,e){var n,a,o;if(e&&angular.extend(t,e),16===t.keyCode?V.setStateShiftKey(!0):V.setStateShiftKey(!1),t.specialKey=(n=t,g.forEach(function(e){if(e.keyCode===n.keyCode){var t=(n.metaKey?2:0)+(n.ctrlKey?1:0)+(n.shiftKey?8:0)+(n.altKey?4:0);if(e.forbiddenModifiers&t)return;e.mustHaveModifiers.every(function(e){return t&e})&&(a=e.specialKey)}}),a),G.keyMappings.forEach(function(e){t.specialKey===e.commandKeyCode&&(t.specialKey=void 0),e.testForKey(t)&&(o=e.commandKeyCode),"UndoKey"!==e.commandKeyCode&&"RedoKey"!==e.commandKeyCode||e.enablePropagation||t.preventDefault()}),void 0!==o&&(t.specialKey=o),void 0===t.specialKey||"UndoKey"===t.specialKey&&"RedoKey"===t.specialKey||(t.preventDefault(),J.sendKeyCommand(x,t)),!(p||("UndoKey"===t.specialKey&&(L(),t.preventDefault()),"RedoKey"===t.specialKey&&($(),t.preventDefault()),13!==t.keyCode||t.shiftKey||t.ctrlKey||t.metaKey||t.altKey))){var r,l=V.getSelectionElement();if(!l.nodeName.match(ae))return;var i,s=angular.element(u);!function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}(["blockquote","ul","ol"],l.parentNode.tagName.toLowerCase())||(/^<br(|\/)>$/i.test(l.innerHTML.trim())&&!l.nextSibling&&((i=(r=angular.element(l)).parent()).after(s),r.remove(),0===i.children().length&&i.remove(),V.setSelectionToElementStart(s[0]),t.preventDefault()),/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(l.innerHTML.trim())&&((r=angular.element(l)).after(s),r.remove(),V.setSelectionToElementStart(s[0]),t.preventDefault()))}}),E.on("keyup",x.events.keyup=function(e,t){if(t&&angular.extend(e,t),V.setStateShiftKey(!1),9!==e.keyCode){if(37!==e.keyCode||e.shiftKey||V.updateLeftArrowKey(E),39!==e.keyCode||e.shiftKey||V.updateRightArrowKey(E),h&&F.cancel(h),!(p||f.test(e.keyCode)||13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey))){if(""!==u&&"<BR><BR>"!==u&&13===e.keyCode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){for(var n,a,o,r=V.getSelectionElement();!r.nodeName.match(ae)&&r!==E[0];)r=r.parentNode;e.shiftKey?(n=r.tagName.toLowerCase())!==d.taDefaultWrap&&"li"!==n&&"pre"!==n&&"div"!==n||/.+<br><br>/.test(r.innerHTML.trim())||(a=r.previousSibling)&&(a.innerHTML=a.innerHTML+"<br><br>",angular.element(r).remove(),V.setSelectionToElementEnd(a)):r.tagName.toLowerCase()===d.taDefaultWrap||"li"===r.nodeName.toLowerCase()||""!==r.innerHTML.trim()&&"<br>"!==r.innerHTML.trim()||(o=angular.element(u),angular.element(r).replaceWith(o),V.setSelectionToElementStart(o[0]))}var l=C();""===u||""!==l.trim()&&"<br>"!==l.trim()?"<"!==l.substring(0,1)&&d.taDefaultWrap:(y(u),V.setSelectionToElementStart(E.children()[0]));var i=s!==e.keyCode&&m.test(e.keyCode);M&&F.cancel(M),M=F(function(){v(l,i,!0)},c.$options.debounce||400),i||(h=F(function(){w.$undoManager.push(l)},250)),s=e.keyCode}}else V.getSelection().start.element===E[0]&&E.children().length&&V.setSelectionToElementStart(E.children()[0])}),E.on("input",function(){C()!==w.$viewValue&&(H&&F.cancel(H),H=F(function(){var e=Q.saveSelection(),t=C();t!==w.$viewValue&&v(t,!0),0!==w.$viewValue.length&&Q.restoreSelection(e)},1e3))}),E.on("blur",x.events.blur=function(){n=!1,p?(o=!0,w.$render()):v(void 0,void 0,!0)}),d.placeholder&&(8<Z||void 0===Z)){if(!d.id)throw"textAngular Error: An unique ID is required for placeholders to work";D=ee("#"+d.id+".placeholder-text:before",'content: "'+d.placeholder+'"'),x.$on("$destroy",function(){te(D)})}E.on("focus",x.events.focus=function(){n=!0,E.removeClass("placeholder-text"),N()}),E.on("mouseup",x.events.mouseup=function(){var e=V.getSelection();e&&e.start.element===E[0]&&E.children().length&&V.setSelectionToElementStart(E.children()[0])}),E.on("mousedown",x.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{E.on("change blur",x.events.change=x.events.blur=function(){p||w.$setViewValue(C())}),E.on("keydown",x.events.keydown=function(e,t){var n,a,o,r,l;t&&angular.extend(e,t),9===e.keyCode&&(n=this.selectionStart,a=this.selectionEnd,o=E.val(),e.shiftKey?(r=o.lastIndexOf("\n",n),-1!==(l=o.lastIndexOf("\t",n))&&r<=l&&(E.val(o.substring(0,l)+o.substring(l+1)),this.selectionStart=this.selectionEnd=n-1)):(E.val(o.substring(0,n)+"\t"+o.substring(a)),this.selectionStart=this.selectionEnd=n+1),e.preventDefault())});function R(e,t){for(var n="",a=0;a<t;a++)n+=e;return n}function K(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])}var _=function(e,a){var o="",t=e.childNodes;return o+=R("\t",++a-1)+e.outerHTML.substring(0,4),K(t,function(e,t){var n=t.nodeName.toLowerCase();"#comment"!==n?"#text"!==n?t.outerHTML&&(o+="ul"===n||"ol"===n?"\n"+_(t,a):"\n"+R("\t",a)+t.outerHTML):o+=t.textContent:o+="\x3c!--"+t.nodeValue+"--\x3e"}),o+="\n"+R("\t",a-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};w.$formatters.unshift(function(a){var e=angular.element("<div>"+a+"</div>")[0].childNodes;return 0<e.length&&(a="",K(e,function(e,t){var n=t.nodeName.toLowerCase();"#comment"!==n?"#text"!==n?t.outerHTML&&(0<a.length&&(a+="\n"),a+="ul"===n||"ol"===n?""+_(t,0):""+t.outerHTML):a+=t.textContent:a+="\x3c!--"+t.nodeValue+"--\x3e"})),a})}function W(e,t){var n;t&&angular.extend(e,t),oe||p||(oe=!0,n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,x.$emit("ta-drop-event",this,e,n),F(function(){v(void 0,void 0,!(oe=!1))},100))}var z,q=!1;w.$render=function(){var e;q||(q=!0,e=w.$viewValue||"",o||(a&&n&&(E.removeClass("placeholder-text"),z&&F.cancel(z),z=F(function(){n||(E[0].focus(),V.setSelectionToElementEnd(E.children()[E.children().length-1])),z=void 0},1)),a?(d.placeholder,y(""===e?u:e),p?E.off("drop",W):(N(),E.on("drop",W))):"textarea"!==E[0].tagName.toLowerCase()&&"input"!==E[0].tagName.toLowerCase()?y(j(e)):E.val(e)),a&&d.placeholder&&(""!==e||n?E.removeClass("placeholder-text"):E.addClass("placeholder-text")),q=o=!1)},d.taReadonly&&((p=x.$eval(d.taReadonly))?(E.addClass("ta-readonly"),"textarea"!==E[0].tagName.toLowerCase()&&"input"!==E[0].tagName.toLowerCase()||E.attr("disabled","disabled"),void 0!==E.attr("contenteditable")&&E.attr("contenteditable")&&E.removeAttr("contenteditable")):(E.removeClass("ta-readonly"),"textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase()?E.removeAttr("disabled"):a&&E.attr("contenteditable","true")),x.$watch(d.taReadonly,function(e,t){t!==e&&(e?(E.addClass("ta-readonly"),"textarea"!==E[0].tagName.toLowerCase()&&"input"!==E[0].tagName.toLowerCase()||E.attr("disabled","disabled"),void 0!==E.attr("contenteditable")&&E.attr("contenteditable")&&E.removeAttr("contenteditable"),angular.forEach(U,function(e){E.find(e).on("click",i)}),E.off("drop",W)):(E.removeClass("ta-readonly"),"textarea"===E[0].tagName.toLowerCase()||"input"===E[0].tagName.toLowerCase()?E.removeAttr("disabled"):a&&E.attr("contenteditable","true"),angular.forEach(U,function(e){E.find(e).off("click",i)}),E.on("drop",W)),p=e)})),a&&!p&&(angular.forEach(U,function(e){E.find(e).on("click",i)}),E.on("drop",W))}}}]);var oe=!1,u=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);return u.config([function(){angular.forEach(n,function(e,t){delete n[t]})}]),u.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$document","$animate","$log","$q","$parse",function(S,w,T,C,N,L,$,A,k,M,H){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(u,t,c,n){var e,a,o,r,l,i,s,d,p,f,m,g=c.serial?c.serial:Math.floor(1e16*Math.random());u._name=c.name?c.name:"textAngularEditor"+g;function h(e,t,n){w(function(){e.one(t,n)},100)}var v=N(c.taDefaultWrap);if(angular.extend(u,angular.copy(T),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?u["$undoTaBindtaTextElement"+g]():"redo"===e.toLowerCase()?u["$redoTaBindtaTextElement"+g]():(v(e,!1,t,u.defaultTagAttributes),n&&u["reApplyOnSelectorHandlerstaTextElement"+g](),u.displayElements.text[0].focus())},showHtml:u.$eval(c.taShowHtml)||!1}),c.taFocussedClass&&(u.classes.focussed=c.taFocussedClass),c.taTextEditorClass&&(u.classes.textEditor=c.taTextEditorClass),c.taHtmlEditorClass&&(u.classes.htmlEditor=c.taHtmlEditorClass),c.taDefaultTagAttributes)try{angular.extend(u.defaultTagAttributes,angular.fromJson(c.taDefaultTagAttributes))}catch(e){k.error(e)}c.taTextEditorSetup&&(u.setup.textEditorSetup=u.$parent.$eval(c.taTextEditorSetup)),c.taHtmlEditorSetup&&(u.setup.htmlEditorSetup=u.$parent.$eval(c.taHtmlEditorSetup)),c.taFileDrop?u.fileDropHandler=u.$parent.$eval(c.taFileDrop):u.fileDropHandler=u.defaultFileDropHandler,s=t[0].innerHTML,t[0].innerHTML="",u.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},u.displayElements.popover.append(u.displayElements.popoverArrow),u.displayElements.popover.append(u.displayElements.popoverContainer),u.displayElements.scrollWindow.append(u.displayElements.popover),u.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),u.handlePopoverEvents=function(){"block"===u.displayElements.popover.css("display")&&(m&&w.cancel(m),m=w(function(){u.reflowPopover(u.resizeElement),u.reflowResizeOverlay(u.resizeElement)},100))},angular.element(window).on("resize",u.handlePopoverEvents),angular.element(window).on("scroll",u.handlePopoverEvents);u.getScrollTop=function(e,t){var n=e.scrollTop;return void 0===n&&(n=0),t&&function(e){var t,n={vertical:!1,horizontal:!1};try{if(null===(t=window.getComputedStyle(e)))return n}catch(e){return n}var a=t["overflow-y"],o=t["overflow-x"];return{vertical:("scroll"===a||"auto"===a)&&e.scrollHeight>e.clientHeight,horizontal:("scroll"===o||"auto"===o)&&e.scrollWidth>e.clientWidth}}(e).vertical&&(e.removeEventListener("scroll",u._scrollListener,!1),e.addEventListener("scroll",u._scrollListener,!1)),0!==n?{node:e.nodeName,top:n}:e.parentNode?u.getScrollTop(e.parentNode,t):{node:"<none>",top:0}},u.showPopover=function(e){u.getScrollTop(u.displayElements.scrollWindow[0],!0),u.displayElements.popover.css("display","block"),w(function(){u.displayElements.resize.overlay.css("display","block")}),u.resizeElement=e,u.reflowPopover(e),A.addClass(u.displayElements.popover,"in"),h($.find("body"),"click keyup",function(){u.hidePopover()})},u._scrollListener=function(e,t){u.handlePopoverEvents()},u.reflowPopover=function(e){var t=u.getScrollTop(u.displayElements.scrollWindow[0],!1);e[0].offsetTop-t.top<51?(u.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+u.displayElements.scrollWindow[0].scrollTop+"px"),u.displayElements.popover.removeClass("top").addClass("bottom")):(u.displayElements.popover.css("top",e[0].offsetTop-54+u.displayElements.scrollWindow[0].scrollTop+"px"),u.displayElements.popover.removeClass("bottom").addClass("top"));var n=u.displayElements.text[0].offsetWidth-u.displayElements.popover[0].offsetWidth,a=e[0].offsetLeft+e[0].offsetWidth/2-u.displayElements.popover[0].offsetWidth/2,o=Math.max(0,Math.min(n,a)),r=Math.min(a,Math.max(0,a-n))-11;o+=window.scrollX,r-=window.scrollX,u.displayElements.popover.css("left",o+"px"),u.displayElements.popoverArrow.css("margin-left",r+"px")},u.hidePopover=function(){u.displayElements.popover.css("display","none"),u.displayElements.popoverContainer.attr("style",""),u.displayElements.popoverContainer.attr("class","popover-content"),u.displayElements.popover.removeClass("in"),u.displayElements.resize.overlay.css("display","none")},u.displayElements.resize.overlay.append(u.displayElements.resize.background),angular.forEach(u.displayElements.resize.anchors,function(e){u.displayElements.resize.overlay.append(e)}),u.displayElements.resize.overlay.append(u.displayElements.resize.info),u.displayElements.scrollWindow.append(u.displayElements.resize.overlay),u.displayElements.resize.background.on("click",function(e){u.displayElements.text[0].focus()}),u.reflowResizeOverlay=function(e){e=angular.element(e)[0],u.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),u.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},u.showResizeOverlay=function(d){var n=$.find("body");p=function(e){var i={width:parseInt(d.attr("width")),height:parseInt(d.attr("height")),x:e.clientX,y:e.clientY};void 0!==i.width&&!isNaN(i.width)||(i.width=d[0].offsetWidth),void 0!==i.height&&!isNaN(i.height)||(i.height=d[0].offsetHeight),u.hidePopover();function t(e){var t,n={x:Math.max(0,i.width+(e.clientX-i.x)),y:Math.max(0,i.height+(e.clientY-i.y))},a=void 0!==c.taResizeForceAspectRatio,o=c.taResizeMaintainAspectRatio;(a||o&&!e.shiftKey)&&(t=n.y/n.x,n.x=t<s?n.x:n.y/s,n.y=t<s?n.x*s:n.y);var r=angular.element(d);function l(e){return Math.round(Math.max(0,e))}r.css("height",l(n.y)+"px"),r.css("width",l(n.x)+"px"),u.reflowResizeOverlay(d)}var s=i.height/i.width;n.on("mousemove",t),h(n,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),n.off("mousemove",t),u.$apply(function(){u.hidePopover(),u.updateTaBindtaTextElement()},100)}),e.stopPropagation(),e.preventDefault()},u.displayElements.resize.anchors[3].off("mousedown"),u.displayElements.resize.anchors[3].on("mousedown",p),u.reflowResizeOverlay(d),h(n,"click",function(){u.hideResizeOverlay()})},u.hideResizeOverlay=function(){u.displayElements.resize.anchors[3].off("mousedown",p),u.displayElements.resize.overlay.css("display","none")},u.setup.htmlEditorSetup(u.displayElements.html),u.setup.textEditorSetup(u.displayElements.text),u.displayElements.html.attr({id:"taHtmlElement"+g,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),u.displayElements.text.attr({id:"taTextElement"+g,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),u.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),c.taDefaultWrap&&u.displayElements.text.attr("ta-default-wrap",c.taDefaultWrap),c.taUnsafeSanitizer&&(u.displayElements.text.attr("ta-unsafe-sanitizer",c.taUnsafeSanitizer),u.displayElements.html.attr("ta-unsafe-sanitizer",c.taUnsafeSanitizer)),c.taKeepStyles&&(u.displayElements.text.attr("ta-keep-styles",c.taKeepStyles),u.displayElements.html.attr("ta-keep-styles",c.taKeepStyles)),u.displayElements.scrollWindow.append(u.displayElements.text),t.append(u.displayElements.scrollWindow),t.append(u.displayElements.html),u.displayElements.forminput.attr("name",u._name),t.append(u.displayElements.forminput),c.tabindex&&(t.removeAttr("tabindex"),u.displayElements.text.attr("tabindex",c.tabindex),u.displayElements.html.attr("tabindex",c.tabindex)),c.placeholder&&(u.displayElements.text.attr("placeholder",c.placeholder),u.displayElements.html.attr("placeholder",c.placeholder)),c.taDisabled&&(u.displayElements.text.attr("ta-readonly","disabled"),u.displayElements.html.attr("ta-readonly","disabled"),u.disabled=u.$parent.$eval(c.taDisabled),u.$parent.$watch(c.taDisabled,function(e){u.disabled=e,u.disabled?t.addClass(u.classes.disabled):t.removeClass(u.classes.disabled)})),c.taPaste&&(u._pasteHandler=function(e){return H(c.taPaste)(u.$parent,{$html:e})},u.displayElements.text.attr("ta-paste","_pasteHandler($html)")),S(u.displayElements.scrollWindow)(u),S(u.displayElements.html)(u),u.updateTaBindtaTextElement=u["updateTaBindtaTextElement"+g],u.updateTaBindtaHtmlElement=u["updateTaBindtaHtmlElement"+g],t.addClass("ta-root"),u.displayElements.scrollWindow.addClass("ta-text ta-editor "+u.classes.textEditor),u.displayElements.html.addClass("ta-html ta-editor "+u.classes.htmlEditor);function y(e,t){t!==$[0].queryCommandState(e)&&$[0].execCommand(e,!1,null)}var b,x,E=u._actionRunning=!1;u.startAction=function(){var e,t,n,a;return u._actionRunning=!0,e=$[0].queryCommandState("bold"),t=$[0].queryCommandState("italic"),n=$[0].queryCommandState("underline"),a=$[0].queryCommandState("strikeThrough"),E=Q.saveSelection(),y("bold",e),y("italic",t),y("underline",n),y("strikeThrough",a),function(){E&&Q.restoreSelection(E)}},u.endAction=function(){u._actionRunning=!1,E&&(u.showHtml?u.displayElements.html[0].focus():u.displayElements.text[0].focus(),Q.removeMarkers(E)),E=!1,u.updateSelectedStyles(),u.showHtml||u["updateTaBindtaTextElement"+g]()},l=function(e){u.focussed=!0,t.addClass(u.classes.focussed),d.focus(),t.triggerHandler("focus"),u.updateSelectedStyles&&!u._bUpdateSelectedStyles&&w(function(){u.updateSelectedStyles()},0)},u.displayElements.html.on("focus",l),u.displayElements.text.on("focus",l),i=function(e){return u._actionRunning||$[0].activeElement===u.displayElements.html[0]||$[0].activeElement===u.displayElements.text[0]||(t.removeClass(u.classes.focussed),d.unfocus(),w(function(){u._bUpdateSelectedStyles=!1,t.triggerHandler("blur"),u.focussed=!1},0)),e.preventDefault(),!1},u.displayElements.html.on("blur",i),u.displayElements.text.on("blur",i),u.displayElements.text.on("paste",function(e){t.triggerHandler("paste",e)}),u.queryFormatBlockState=function(e){return!u.showHtml&&e.toLowerCase()===$[0].queryCommandValue("formatBlock").toLowerCase()},u.queryCommandState=function(e){return u.showHtml?"":$[0].queryCommandState(e)},u.switchView=function(){u.showHtml=!u.showHtml,A.enabled(!1,u.displayElements.html),A.enabled(!1,u.displayElements.text),u.showHtml?w(function(){return A.enabled(!0,u.displayElements.html),A.enabled(!0,u.displayElements.text),u.displayElements.html[0].focus()},100):w(function(){return A.enabled(!0,u.displayElements.html),A.enabled(!0,u.displayElements.text),u.displayElements.text[0].focus()},100)},c.ngModel?(b=!0,n.$render=function(){b&&(b=!1,null==u.$parent.$eval(c.ngModel)&&s&&""!==s&&n.$setViewValue(s)),u.displayElements.forminput.val(n.$viewValue),u.html=n.$viewValue||""},t.attr("required")&&(n.$validators.required=function(e,t){var n=e||t;return!(!n||""===n.trim())})):(u.displayElements.forminput.val(s),u.html=s),u.$watch("html",function(e,t){e!==t&&(c.ngModel&&n.$viewValue!==e&&n.$setViewValue(e),u.displayElements.forminput.val(e))}),d=c.taTargetToolbars?L.registerEditor(u._name,u,c.taTargetToolbars.split(",")):(x=angular.element('<div text-angular-toolbar name="textAngularToolbar'+g+'">'),c.taToolbar&&x.attr("ta-toolbar",c.taToolbar),c.taToolbarClass&&x.attr("ta-toolbar-class",c.taToolbarClass),c.taToolbarGroupClass&&x.attr("ta-toolbar-group-class",c.taToolbarGroupClass),c.taToolbarButtonClass&&x.attr("ta-toolbar-button-class",c.taToolbarButtonClass),c.taToolbarActiveButtonClass&&x.attr("ta-toolbar-active-button-class",c.taToolbarActiveButtonClass),c.taFocussedClass&&x.attr("ta-focussed-class",c.taFocussedClass),t.prepend(x),S(x)(u.$parent),L.registerEditor(u._name,u,["textAngularToolbar"+g])),u.$on("$destroy",function(){L.unregisterEditor(u._name),angular.element(window).off("blur"),angular.element(window).off("resize",u.handlePopoverEvents),angular.element(window).off("scroll",u.handlePopoverEvents)}),u.$on("ta-element-select",function(e,t){d.triggerElementSelect(e,t)&&u["reApplyOnSelectorHandlerstaTextElement"+g]()}),u.$on("ta-drop-event",function(e,t,n,a){a&&a.files&&0<a.files.length?(u.displayElements.text[0].focus(),C.setSelectionToElementEnd(n.target),angular.forEach(a.files,function(e){try{M.when(u.fileDropHandler(e,u.wrapSelection)||u.fileDropHandler!==u.defaultFileDropHandler&&M.when(u.defaultFileDropHandler(e,u.wrapSelection))).then(function(){u["updateTaBindtaTextElement"+g]()})}catch(e){k.error(e)}}),n.preventDefault(),n.stopPropagation()):w(function(){u["updateTaBindtaTextElement"+g]()},0)}),u._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){u._bUpdateSelectedStyles=!1,u.focussed=!1}),u.updateSelectedStyles=function(){var e;f&&w.cancel(f),void 0!==(e=C.getSelectionElement())&&e.parentNode!==u.displayElements.text[0]?d.updateSelectedStyles(angular.element(e)):d.updateSelectedStyles(),u._bUpdateSelectedStyles&&(f=w(u.updateSelectedStyles,200))},e=function(){u.focussed?u._bUpdateSelectedStyles||(u._bUpdateSelectedStyles=!0,u.$apply(function(){u.updateSelectedStyles()})):u._bUpdateSelectedStyles=!1},u.displayElements.html.on("keydown",e),u.displayElements.text.on("keydown",e),a=function(){u._bUpdateSelectedStyles=!1},u.displayElements.html.on("keyup",a),u.displayElements.text.on("keyup",a),o=function(e,t){var n;C.getSelection&&(n=C.getSelection(),C.getSelectionElement()&&"a"===C.getSelectionElement().nodeName.toLowerCase()&&(3===n.start.element.nodeType&&n.start.element.textContent.length===n.end.offset&&C.setSelectionAfterElement(C.getSelectionElement()),3===n.start.element.nodeType&&0===n.start.offset&&C.setSelectionBeforeElement(C.getSelectionElement()))),t&&angular.extend(e,t),u.$apply(function(){if(d.sendKeyCommand(e))return u._bUpdateSelectedStyles||u.updateSelectedStyles(),e.preventDefault(),!1})},u.displayElements.html.on("keypress",o),u.displayElements.text.on("keypress",o),r=function(){u._bUpdateSelectedStyles=!1,w(function(){u.updateSelectedStyles()},0)},u.displayElements.html.on("mouseup",r),u.displayElements.text.on("mouseup",r)}}}]),u.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool","$interval","$rootScope","$log",function(r,f,l,e,t,n){function a(t){angular.forEach(m,function(e){e.editorFunctions.updateSelectedStyles(t)})}var o,i={},m={},s=0;t.$on("destroy",function(){o&&(e.cancel(o),o=void 0)});function d(){50<Math.abs(Date.now()-s)&&(s=Date.now(),o=e(function(){a(),o=void 0},50,1))}return{registerEditor:function(c,p,e){if(!c||""===c)throw"textAngular Error: An editor requires a name";if(!p)throw"textAngular Error: An editor requires a scope";if(m[c])throw'textAngular Error: An Editor with name "'+c+'" already exists';return m[c]={scope:p,toolbars:e,toolbarScopes:[],_registerToolbarScope:function(e){0<=this.toolbars.indexOf(e.name)&&this.toolbarScopes.push(e)},editorFunctions:{disable:function(){angular.forEach(m[c].toolbarScopes,function(e){e.disabled=!0})},enable:function(){angular.forEach(m[c].toolbarScopes,function(e){e.disabled=!1})},focus:function(){angular.forEach(m[c].toolbarScopes,function(e){e._parent=p,e.disabled=!1,e.focussed=!0}),p.focussed=!0},unfocus:function(){angular.forEach(m[c].toolbarScopes,function(e){e.disabled=!0,e.focussed=!1}),p.focussed=!1},updateSelectedStyles:function(n){angular.forEach(m[c].toolbarScopes,function(t){angular.forEach(t.tools,function(e){e.activeState&&(t._parent=p,e.active=e.activeState(n))})})},sendKeyCommand:function(a){var o=!1;return(a.ctrlKey||a.metaKey||a.specialKey)&&angular.forEach(f,function(e,t){if(e.commandKeyCode&&(e.commandKeyCode===a.which||e.commandKeyCode===a.specialKey))for(var n=0;n<m[c].toolbarScopes.length;n++)if(void 0!==m[c].toolbarScopes[n].tools[t]){r.call(m[c].toolbarScopes[n].tools[t],p),o=!0;break}}),o},triggerElementSelect:function(e,n){function a(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n}var o=[],r={},t=!1;n=angular.element(n);var l=!1;if(angular.forEach(f,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(l=l||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!a(n,e.onElementSelect.onlyWithAttrs)||(r[t]=e))}),l?(angular.forEach(r,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&o.push({name:t,tool:e})}),o.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(r,function(e,t){o.push({name:t,tool:e})}),0<o.length)for(var i=0;i<o.length;i++){for(var s=o[i].tool,d=o[i].name,u=0;u<m[c].toolbarScopes.length;u++)if(void 0!==m[c].toolbarScopes[u].tools[d]){s.onElementSelect.action.call(m[c].toolbarScopes[u].tools[d],e,n,p),t=!0;break}if(t)break}return t}}},angular.forEach(e,function(e){i[e]&&m[c].toolbarScopes.push(i[e])}),d(),m[c].editorFunctions},retrieveEditor:function(e){return m[e]},unregisterEditor:function(e){delete m[e],d()},registerToolbar:function(t){if(!t)throw"textAngular Error: A toolbar requires a scope";if(!t.name||""===t.name)throw"textAngular Error: A toolbar requires a name";if(i[t.name])throw'textAngular Error: A toolbar with name "'+t.name+'" already exists';i[t.name]=t,angular.forEach(m,function(e){e._registerToolbarScope(t)}),d()},retrieveToolbar:function(e){return i[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete i[e],d()},updateToolsDisplay:function(e){var n=this;angular.forEach(e,function(e,t){n.updateToolDisplay(t,e)})},resetToolsDisplay:function(){var n=this;angular.forEach(f,function(e,t){n.resetToolDisplay(t)}),d()},updateToolDisplay:function(n,a){var o=this;angular.forEach(i,function(e,t){o.updateToolbarToolDisplay(t,n,a)}),d()},resetToolDisplay:function(n){var a=this;angular.forEach(i,function(e,t){a.resetToolbarToolDisplay(t,n)}),d()},updateToolbarToolDisplay:function(e,t,n){if(!i[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';i[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,t){if(!i[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';i[e].updateToolDisplay(t,f[t],!0)},removeTool:function(o){delete f[o],angular.forEach(i,function(e){delete e.tools[o];for(var t=0;t<e.toolbar.length;t++){for(var n,a=0;a<e.toolbar[t].length;a++){if(e.toolbar[t][a]===o){n={group:t,index:a};break}if(void 0!==n)break}void 0!==n&&(e.toolbar[n.group].slice(n.index,1),e._$element.children().eq(n.group).children().eq(n.index).remove())}}),d()},addTool:function(t,n,a,o){l(t,n),angular.forEach(i,function(e){e.addTool(t,n,a,o)}),d()},addToolToToolbar:function(e,t,n,a,o){l(e,t),i[n].addTool(e,t,a,o),d()},refreshEditor:function(e){if(!m[e])throw'textAngular Error: No Editor with name "'+e+'" exists';m[e].scope.updateTaBindtaTextElement(),m[e].scope.$$phase||m[e].scope.$digest(),d()},sendKeyCommand:function(e,t){var n=m[e._name];if(n&&n.editorFunctions.sendKeyCommand(t))return e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1},updateStyles:a,getVersion:function(){return"v2.1.2"},getToolbarScopes:function(){var t=[];return angular.forEach(m,function(e){t=t.concat(e.toolbarScopes)}),t}}}]),u.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(d,t,n,u,a,o){return{scope:{name:"@"},restrict:"EA",link:function(r,l,e){if(!r.name||""===r.name)throw"textAngular Error: A toolbar requires a name";angular.extend(r,angular.copy(n)),e.taToolbar&&(r.toolbar=r.$parent.$eval(e.taToolbar)),e.taToolbarClass&&(r.classes.toolbar=e.taToolbarClass),e.taToolbarGroupClass&&(r.classes.toolbarGroup=e.taToolbarGroupClass),e.taToolbarButtonClass&&(r.classes.toolbarButton=e.taToolbarButtonClass),e.taToolbarActiveButtonClass&&(r.classes.toolbarButtonActive=e.taToolbarActiveButtonClass),e.taFocussedClass&&(r.classes.focussed=e.taFocussedClass),r.disabled=!0,r.focussed=!1,(r._$element=l)[0].innerHTML="",l.addClass("ta-toolbar "+r.classes.toolbar),r.$watch("focussed",function(){r.focussed?l.addClass(r.classes.focussed):l.removeClass(r.classes.focussed)});function i(e,t){var n,a,o=e&&e.display?angular.element(e.display):angular.element("<button type='button'>");return e&&e.class?o.addClass(e.class):o.addClass(r.classes.toolbarButton),o.attr("name",t.name),o.attr("ta-button","ta-button"),o.attr("ng-disabled","isDisabled()"),o.attr("tabindex","-1"),o.attr("ng-click","executeAction()"),o.attr("ng-class","displayActiveToolClass(active)"),e&&e.tooltiptext&&o.attr("title",e.tooltiptext),!e||e.display||t._display||(o[0].innerHTML="",e.buttontext&&(o[0].innerHTML=e.buttontext),e.iconclass&&(n=angular.element("<i>"),a=o[0].innerHTML,n.addClass(e.iconclass),o[0].innerHTML="",o.append(n),a&&""!==a&&o.append("&nbsp;"+a))),t._lastToolDefinition=angular.copy(e),d(o)(t)}r.tools={},r._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var s={$window:o,$editor:function(){return r._parent},isDisabled:function(){return("html"!==this.name||!r._parent.startAction)&&("function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled)},displayActiveToolClass:function(e){return e?r.classes.toolbarButtonActive:""},executeAction:a};angular.forEach(r.toolbar,function(e){var t=angular.element("<div>");t.addClass(r.classes.toolbarGroup),angular.forEach(e,function(e){r.tools[e]=angular.extend(r.$new(!0),u[e],s,{name:e}),r.tools[e].$element=i(u[e],r.tools[e]),t.append(r.tools[e].$element)}),l.append(t)}),r.updateToolDisplay=function(e,t,n){var a=r.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var o=i(t,a);a.$element.replaceWith(o),a.$element=o}},r.addTool=function(e,t,n,a){var o;r.tools[e]=angular.extend(r.$new(!0),u[e],s,{name:e}),r.tools[e].$element=i(u[e],r.tools[e]),void 0===n&&(n=r.toolbar.length-1),o=angular.element(l.children()[n]),void 0===a?(o.append(r.tools[e].$element),r.toolbar[n][r.toolbar[n].length-1]=e):(o.children().eq(a).after(r.tools[e].$element),r.toolbar[n][a]=e)},t.registerToolbar(r),r.$on("$destroy",function(){t.unregisterToolbar(r.name)})}}}]),u.directive("textAngularVersion",["textAngularManager",function(e){var a=e.getVersion();return{restrict:"EA",link:function(e,t,n){t.html(a)}}}]),u.name});