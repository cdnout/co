!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).snarkdown=n()}(this,function(){var m={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function h(e){return e.replace(RegExp("^"+(e.match(/^(\t| )+/)||"")[0],"gm"),"")}function $(e){return(e+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return function e(n,r){var t,o,a,c,s,l=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,g=[],u="",p=r||{},f=0;function i(e){var n=m[e[1]||""],r=g[g.length-1]==e;return n?n[1]?(r?g.pop():g.push(e),n[0|r]):n[0]:e}function d(){for(var e="";g.length;)e+=i(g[g.length-1]);return e}for(n=n.replace(/^\[(.+?)\]:\s*(.+)$/gm,function(e,n,r){return p[n.toLowerCase()]=r,""}).replace(/^\n+|\n+$/g,"");a=l.exec(n);)o=n.substring(f,a.index),f=l.lastIndex,t=a[0],o.match(/[^\\](\\\\)*\\$/)||((s=a[3]||a[4])?t='<pre class="code '+(a[4]?"poetry":a[2].toLowerCase())+'"><code'+(a[2]?' class="language-'+a[2].toLowerCase()+'"':"")+">"+h($(s).replace(/^\n+|\n+$/g,""))+"</code></pre>":(s=a[6])?(s.match(/\./)&&(a[5]=a[5].replace(/^\d+/gm,"")),c=e(h(a[5].replace(/^\s*[>*+.-]/gm,""))),">"==s?s="blockquote":(s=s.match(/\./)?"ol":"ul",c=c.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),t="<"+s+">"+c+"</"+s+">"):a[8]?t='<img src="'+$(a[8])+'" alt="'+$(a[7])+'">':a[10]?(u=u.replace("<a>",'<a href="'+$(a[11]||p[o.toLowerCase()])+'">'),t=d()+"</a>"):a[9]?t="<a>":a[12]||a[14]?t="<"+(s="h"+(a[14]?a[14].length:"="<a[13]?1:2))+">"+e(a[12]||a[15],p)+"</"+s+">":a[16]?t="<code>"+$(a[16])+"</code>":(a[17]||a[1])&&(t=i(a[17]||"--"))),u+=o,u+=t;return(u+n.substring(f)+d()).replace(/^\n+|\n+$/g,"")}});