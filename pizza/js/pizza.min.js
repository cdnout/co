var Pizza={version:"0.2.1",settings:{donut:false,donut_inner_ratio:0.4,percent_offset:35,show_text:true,animation_speed:500,always_show_text:false,show_grid:true,bar_spacer:100,bar_intervals:6,animation_type:"elastic"},NS:"http://www.w3.org/2000/svg",init:function(c,b){var a=this;this.scope=c||document.body;var d=$("[data-pie-id], [data-line-id], [data-bar-id]",this.scope);$.extend(true,this.settings,b);if(d.length>0){d.each(function(){return a.build($(this),b)})}else{if($(this.scope).is("[data-pie-id]")||$(this.scope).is("[data-line-id]")||$(this.scope).is("[data-bar-id]")){this.build($(this.scope),b)}}this.events()},events:function(){var a=this;$(window).off(".pizza").on("resize.pizza",a.throttle(function(){a.init()},500));$(this.scope).off(".pizza");this.pie_events();this.line_events();this.bar_events()},build:function(b,a){b.data("settings",$.extend({},this.settings,a,b.data("options")));this.data(b,a||{});if(b.data("pie-id")){this.update_DOM(this.pie(b))}else{if(b.data("line-id")){this.update_DOM(this.line(b))}else{if(b.data("bar-id")){this.update_DOM(this.bar(b))}}}},data:function(b,a){var d=[],c=0;$("li",b).each(function(){var e=$(this);if(a.data){d.push({value:a.data[e.index()],text:e.data("text"),color:e.css("color"),segment:e})}else{d.push({x:e.data("x"),y:e.data("y"),value:e.data("value"),text:e.data("text"),color:e.css("color"),segment:e})}});return b.data("graph-data",d)},update_DOM:function(c){var a=c[0],b=c[1];return $(this.identifier(a)).html(b)},animate:function(d,a,f,c,e){var b=this,e=e||1.05;d.hover(function(h){var g=Snap(h.target),j=Snap(g.node.nextSibling);g.animate({transform:"s"+e+" "+e+" "+a+" "+f},c.animation_speed,mina[c.animation_type]);if(!/text/.test(j.node.nodeName)){return}j.touchend(function(){Snap(g).animate({transform:"s"+e+" "+e+" "+a+" "+f},c.animation_speed,mina[c.animation_type])});if(c.show_text){j.animate({opacity:1},c.animation_speed);j.touchend(function(){j.animate({opacity:1},c.animation_speed)})}},function(h){var g=Snap(h.target),j=Snap(g.node.nextSibling);g.animate({transform:"s1 1 "+a+" "+f},c.animation_speed,mina[c.animation_type]);if(!/text/.test(j.node.nodeName)){return}j.animate({opacity:0},c.animation_speed)})},parse_options:function(b,d,f){var e=b.match(/{{(percent|value)}}/g),a="";for(var c=0;c<e.length;c++){if(/percent/i.test(e[c])){a=b.replace(e[c],[Math.ceil(d),"%"].join(""))}if(/value/i.test(e[c])){a=a.replace(e[c],f)}}return a},svg:function(h,g){var c=$(this.identifier(h)),d=$("svg",c),f=c.width(),b=h.attr("data-pie-id"),a=c.height();if(d.length>0){d=d[0]}else{var d=this.svg_obj("svg");d.width=f;d.height=a}if(b){var e="-"+g.percent_offset+" -"+g.percent_offset+" "+(f+(g.percent_offset*1.5))+" "+(f+(g.percent_offset*1.5))}else{var e="-"+g.percent_offset+" -"+g.percent_offset+" "+(f+(g.percent_offset*1.6))+" "+(a+(g.percent_offset*1.6))}this.set_attr(d,{width:"100%",height:"100%",viewBox:e});return d},identifier:function(a){id=a.data("pie-id")||a.data("bar-id")||a.data("line-id");return"#"+id},throttle:function(a,b){var c=null;return function(){var e=this,d=arguments;clearTimeout(c);c=setTimeout(function(){a.apply(e,d)},b)}},svg_obj:function(a){return document.createElementNS(this.NS,a)},ticks:function(c,g,d){var k=g-c,a=Math.pow(10,Math.floor(Math.log(k/d)/Math.LN10)),b=d/k*a;if(b<=0.15){a*=10}else{if(b<=0.35){a*=5}else{if(b<=0.75){a*=2}}}var f=Math.ceil(c/a)*a,e=Math.floor(g/a)*a+a*0.5,j=[],h;for(i=f;i<e;i+=a){j.push(i)}return j},set_attr:function(b,a){for(attr in a){b.setAttribute(attr,a[attr])}return this},flip:function(b,a){b.setAttribute("transform","translate(0, "+a+") scale(1, -1)")}};$.extend(Pizza,{bar:function(b){var q=b.data("settings"),j=this.svg(b,q),t=b.data("graph-data"),k=0,h=$(this.identifier(b)),s=h.outerWidth(),d=h.outerHeight(),n=min=0,u=0,e=q.bar_spacer*(q.bar_spacer/s),r=(s-(t.length*e))/t.length;if(r<10){e=1;r=(s-(t.length*e))/t.length}for(var o=0;o<t.length;o++){if(n<t[o].value){n=t[o].value}if(min>t[o].value){min=t[o].value}u+=t[o].value}var c=$("g[data-id=bars]",j);if(c.length>0){var p=c[0]}else{var p=this.svg_obj("g");p.setAttribute("data-id","bars")}if(q.show_grid){this.assemble_grid(j,min,n,s,d,q)}p.setAttribute("transform","translate(0, "+(d)+") scale(1, -1)");for(var o=0;o<t.length;o++){var f=(d)*(t[o].value/n);var m=$("rect[data-id=r"+o+"]",p);if(m.length>0){var a=m[0]}else{var a=this.svg_obj("rect");a.setAttribute("data-id","r"+o)}if(k===0){var l=k}else{var l=k+e}a.setAttribute("data-y",f);this.set_attr(a,{x:l,y:0,width:r,height:0,fill:t[o].color,stroke:q.stroke_color,strokeWidth:q.stroke_width});Snap(a).animate({height:f},1500,mina[q.animation_type]);k=l+r;if(c.length<1){p.appendChild(a);this.animate_bar(Snap(a),f,q)}}if(c.length<1){j.appendChild(p)}return[b,j]},animate_bar:function(e,f,d){var a=this,c=$(e),b=f+15;e.hover(function(h){var g=Snap(h.target);g.animate({height:b},d.animation_speed,mina[d.animation_type])},function(h){var g=Snap(h.target);g.animate({height:f},d.animation_speed,mina[d.animation_type])})},assemble_grid:function(h,g,l,a,p,e){var b=$("g[data-id=bars]",h);if(b.length>0){var k=$("g[data-id=grid]",h)[0],d=$("g[data-id=labels]",h)[0]}else{var k=this.svg_obj("g"),d=this.svg_obj("g");k.setAttribute("data-id","grid");d.setAttribute("data-id","labels")}var m=this.ticks(g,l,e.bar_intervals),f=i=m.length,c=p/(f-1),j=0;while(i--){if(b.length>0){var q=$("line[data-id=l"+i+"]",k)[0],o=$("text[data-id=t"+i+"]",d)[0]}else{var q=this.svg_obj("line"),o=this.svg_obj("text");q.setAttribute("data-id","l"+i);o.setAttribute("data-id","t"+i)}var n=j+c;this.set_attr(q,{x1:0,x2:a,y1:n,y2:n,stroke:"gray","stroke-width":1,"stroke-dasharray":"5,5"}).set_attr(o,{x:-8,y:n+5,"text-anchor":"end"});o.innerHTML=m[i];if(b.length<1){k.appendChild(q);d.appendChild(o)}j=n}k.setAttribute("transform","translate(0, -"+j/f+")");d.setAttribute("transform","translate(0, -"+j/f+")");if(b.length<1){h.appendChild(k);h.appendChild(d)}},bar_events:function(){var a=this;$(this.scope).on("mouseenter.pizza mouseleave.pizza touchstart.pizza","[data-bar-id] li",function(g){var d=$(this).parent(),f=$("#"+d.attr("data-bar-id")+" rect[data-id=r"+$(this).index()+"]")[0],c=$(this).parent().data("settings"),b=parseInt(f.getAttribute("data-y"),10)+15;if(/start/i.test(g.type)){$(f).siblings("rect").each(function(){if(this.nodeName){Snap(f).animate({height:f.getAttribute("data-y")},c.animation_speed,mina[c.animation_type])}})}if(/enter|start/i.test(g.type)){Snap(f).animate({height:b},c.animation_speed,mina[c.animation_type])}else{Snap(f).animate({height:f.getAttribute("data-y")},c.animation_speed,mina[c.animation_type])}})}});$.extend(Pizza,{line:function(a){var q=a.data("settings"),l=this.svg(a,q),j=$(this.identifier(a)),n=j.outerWidth(),k=j.outerHeight(),s=a.data("graph-data"),r=max_y=min_x=min_y=total_x=total_y=0,p=s.length,o="";for(var p=0;p<s.length;p++){if(s[p].x>r){r=s[p].x}if(s[p].y>max_y){max_y=s[p].y}if(min_x>s[p].x){min_x=s[p].x}if(min_y>s[p].y){min_y=s[p].y}total_x+=s[p].x;total_y+=s[p].y}var b=$("g[data-id=line]",l);if(b.length>0){var e=$("g[data-id=line]",l)[0],d=$("g[data-id=points]",l)[0],m=$("path[data-id=path]",e)[0]}else{var m=this.svg_obj("path"),e=this.svg_obj("g"),d=this.svg_obj("g");e.setAttribute("data-id","line");d.setAttribute("data-id","points");m.setAttribute("data-id","path")}for(var p=0;p<s.length;p++){if(b.length>0){var c=$("circle[data-id=c"+p+"]",d)[0]}else{var c=this.svg_obj("circle");c.setAttribute("data-id","c"+p)}var g=(s[p].x/r)*n,f=(s[p].y/max_y)*k;o+=g+","+f+" ";this.set_attr(c,{cx:g,cy:f,r:0,fill:s[p.color],"data-value":s[p].x+", "+s[p].y,"data-tooltip":"",title:s[p].x+", "+s[p].y,"class":"has-tip tip-top"});Snap(c).animate({r:4},1500,mina[q.animation_type]);this.animate(Snap(c),g,f,q,2);if(b.length<1){d.appendChild(c)}}this.flip(d,k);this.flip(e,k);if(q.show_grid){this.assemble_grid_x(l,min_x,r,n,k,q);this.assemble_grid_y(l,min_y,max_y,n,k,q)}var h=this.points_to_path(o);this.set_attr(m,{d:h,fill:"none",stroke:"black","stroke-width":2});if(b.length<1){e.appendChild(m);l.appendChild(e)}if(b.length<1){l.appendChild(d)}return[a,l]},assemble_grid_x:function(k,h,m,a,p,f){var b=$("g[data-id=gridx]",k);if(b.length>0){var l=b[0],d=$("g[data-id=labelx]",k)[0]}else{var l=this.svg_obj("g"),d=this.svg_obj("g");l.setAttribute("data-id","gridx");d.setAttribute("data-id","labelx")}var n=this.ticks(h,m,f.bar_intervals).reverse(),g=i=n.length,j=0,c=a/(g-1);while(i--){if(b.length>0){var q=$("line[data-id=l"+i+"]",l)[0],o=$("text[data-id=t"+i+"]",d)[0]}else{var q=this.svg_obj("line"),o=this.svg_obj("text");q.setAttribute("data-id","l"+i);o.setAttribute("data-id","t"+i)}var e=j+c;this.set_attr(q,{x1:e,x2:e,y1:0,y2:p,stroke:"gray","stroke-width":1,"stroke-dasharray":"5,5"}).set_attr(o,{y:p+20,x:e-c,"text-anchor":"middle"});if(b.length<1){o.innerHTML=n[i];d.appendChild(o);l.appendChild(q)}j=e}l.setAttribute("transform","translate(-"+c+", 0)");if(b.length<1){k.appendChild(l);k.appendChild(d)}},assemble_grid_y:function(g,f,k,a,o,d){var b=$("g[data-id=gridy]",g);if(b.length>0){var j=b[0],c=$("g[data-id=labely]",g)[0]}else{var j=this.svg_obj("g"),c=this.svg_obj("g");j.setAttribute("data-id","gridy");c.setAttribute("data-id","labely")}var l=this.ticks(f,k,d.bar_intervals),e=i=l.length,h=0;while(i--){if(b.length>0){var p=$("line[data-id=l"+i+"]",j)[0],n=$("text[data-id=t"+i+"]",c)[0]}else{var p=this.svg_obj("line"),n=this.svg_obj("text");p.setAttribute("data-id","l"+i);n.setAttribute("data-id","t"+i)}var m=h+(o/(e-1));this.set_attr(p,{x1:0,x2:a,y1:m,y2:m,stroke:"gray","stroke-width":1,"stroke-dasharray":"5,5"}).set_attr(n,{x:-8,y:m+5,"text-anchor":"end"});if(b.length<1){c.appendChild(n);j.appendChild(p);n.innerHTML=l[i]}h=m}j.setAttribute("transform","translate(0, -"+h/e+")");c.setAttribute("transform","translate(0, -"+h/e+")");if(b.length<1){g.appendChild(j);g.appendChild(c)}},points_to_path:function(c){var c=c.split(/\s+|,/);var b=c.shift(),d=c.shift();var a="M"+b+","+d+"L"+c.join(" ");return["M"+b+","+d+"L"].concat(c).join(" ")},line_events:function(){$(this.scope).on("mouseenter.pizza mouseleave.pizza touchstart.pizza","[data-line-id] li",function(d){var b=$(this).parent(),c=$("#"+b.data("line-id")+' circle[data-id="c'+$(this).index()+'"]')[0],a=$(this).parent().data("settings");if(/start/i.test(d.type)){$(c).siblings("circle").each(function(){if(this.nodeName){Snap(c).animate({transform:"s1 1 "+c.getAttribute("cx")+" "+c.getAttribute("cy")},a.animation_speed,mina[a.animation_type])}})}if(/enter|start/i.test(d.type)){Snap(c).animate({transform:"s2 2 "+c.getAttribute("cx")+" "+c.getAttribute("cy")},a.animation_speed,mina[a.animation_type]);$(c).trigger("mouseenter")}else{Snap(c).animate({transform:"s1 1 "+c.getAttribute("cx")+" "+c.getAttribute("cy")},a.animation_speed,mina[a.animation_type]);$(c).trigger("mouseout")}})}});$.extend(Pizza,{pie:function(c){var A=c.data("settings"),s=this.svg(c,A),E=c.data("graph-data"),F=0,u=[],D=0,o=$(this.identifier(c)),m=o.outerWidth();for(var w=0;w<E.length;w++){F+=E[w].value}for(var w=0;w<E.length;w++){u[w]=E[w].value/F*Math.PI*2}if(u.length==1){u[0]=Math.PI*2-0.0001}for(var w=0;w<E.length;w++){var n=D+u[w];var j=(m/2),f=(m/2),q=((m/2)*0.85);if(!A.donut){var z=j+q*Math.sin(D);var h=f-q*Math.cos(D);var x=j+q*Math.sin(n);var e=f-q*Math.cos(n);var v=0;if(n-D>Math.PI){v=1}var B="M"+j+","+f+" L"+z+","+h+" A"+q+","+q+" 0 "+v+" 1 "+x+","+e+" Z"}var k=$('path[data-id="s'+w+'"]',s);if(k.length>0){var t=k[0]}else{var t=this.svg_obj("path")}var a=(E[w].value/F)*100;var b=$('text[data-id="s'+w+'"]',s);if(b.length>0){var p=b[0];p.setAttribute("x",j+(q+A.percent_offset)*Math.sin(D+(u[w]/2)));p.setAttribute("y",f-(q+A.percent_offset)*Math.cos(D+(u[w]/2)))}else{if(E[w].text){var C=this.parse_options(E[w].text,a,E[w].value)}else{var C=Math.ceil(a)+"%"}var p=this.svg_obj("text");p.setAttribute("x",j+(q+A.percent_offset)*Math.sin(D+(u[w]/2)));p.setAttribute("y",f-(q+A.percent_offset)*Math.cos(D+(u[w]/2)));p.innerHTML=C}p.setAttribute("text-anchor","middle");if(A.always_show_text){Snap(p).animate({opacity:1},A.animation_speed)}else{Snap(p).attr({opacity:0},A.animation_speed)}p.setAttribute("data-id","s"+w);if(A.donut){this.annular_sector(t,{centerX:j,centerY:f,startDegrees:D,endDegrees:n,innerRadius:(q*A.donut_inner_ratio),outerRadius:q})}else{t.setAttribute("d",B)}this.set_attr(t,{fill:E[w].color,stroke:A.stroke_color,strokeWidth:A.stroke_width,"data-cx":j,"data-cy":f,"data-id":"s"+w});var l=$("g[data-id=g"+w+"]",s);if(l.length<1){var y=this.svg_obj("g");y.setAttribute("data-id","g"+w);y.appendChild(t);y.appendChild(p);s.appendChild(y);this.animate(Snap(t),j,f,A)}D=n}return[c,s]},annular_sector:function(h,c){var e=b(c);var g=[[e.cx+e.r2*Math.sin(e.startRadians),e.cy-e.r2*Math.cos(e.startRadians)],[e.cx+e.r2*Math.sin(e.closeRadians),e.cy-e.r2*Math.cos(e.closeRadians)],[e.cx+e.r1*Math.sin(e.closeRadians),e.cy-e.r1*Math.cos(e.closeRadians)],[e.cx+e.r1*Math.sin(e.startRadians),e.cy-e.r1*Math.cos(e.startRadians)],];var d=e.closeRadians-e.startRadians;var f=(d%(Math.PI*2))>Math.PI?1:0;var a=[];a.push("M"+g[0].join());a.push("A"+[e.r2,e.r2,0,f,1,g[1]].join());a.push("L"+g[2].join());a.push("A"+[e.r1,e.r1,0,f,0,g[3]].join());a.push("z");h.setAttribute("d",a.join(" "));function b(l){var k={cx:l.centerX||0,cy:l.centerY||0,startRadians:(l.startDegrees||0),closeRadians:(l.endDegrees||0),};var j=l.thickness!==undefined?l.thickness:100;if(l.innerRadius!==undefined){k.r1=l.innerRadius}else{if(l.outerRadius!==undefined){k.r1=l.outerRadius-j}else{k.r1=200-j}}if(l.outerRadius!==undefined){k.r2=l.outerRadius}else{k.r2=k.r1+j}if(k.r1<0){k.r1=0}if(k.r2<0){k.r2=0}return k}},pie_events:function(){$(this.scope).on("mouseenter.pizza mouseleave.pizza touchstart.pizza","[data-pie-id] li",function(d){var b=$(this).parent(),c=$("#"+b.attr("data-pie-id")+' path[data-id="s'+$(this).index()+'"]')[0],f=c.nextSibling,a=$(this).parent().data("settings");if(/start/i.test(d.type)){$(c).siblings("path").each(function(){if(this.nodeName){Snap(c).animate({transform:"s1 1 "+c.getAttribute("data-cx")+" "+c.getAttribute("data-cy")},a.animation_speed,mina[a.animation_type]);Snap($(this).next()[0]).animate({opacity:0},a.animation_speed)}})}if(/enter|start/i.test(d.type)){Snap(c).animate({transform:"s1.05 1.05 "+c.getAttribute("data-cx")+" "+c.getAttribute("data-cy")},a.animation_speed,mina[a.animation_type]);if(a.show_text){Snap(f).animate({opacity:1},a.animation_speed)}}else{Snap(c).animate({transform:"s1 1 "+c.getAttribute("data-cx")+" "+c.getAttribute("data-cy")},a.animation_speed,mina[a.animation_type]);Snap(f).animate({opacity:0},a.animation_speed)}})}});