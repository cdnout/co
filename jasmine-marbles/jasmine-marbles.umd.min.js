!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/testing"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","rxjs","rxjs/testing","lodash"],t):t(e["jasmine-marbles"]=e["jasmine-marbles"]||{},e.Rx,e.Rx,e._)}(this,function(e,t,r,n){"use strict";function s(e){return JSON.stringify(e,function(e,t){return Array.isArray(t)?"["+t.map(function(e){return"\n\t"+s(e)})+"\n]":t}).replace(/\\"/g,'"').replace(/\\t/g,"\t").replace(/\\n/g,"\n")}function i(e){const{notification:t}=e;if(t){const{kind:e,exception:r}=t;"E"===e&&r instanceof Error&&(t.exception={name:r.name,message:r.message})}return e}function c(e,t){if(Array.isArray(e)&&Array.isArray(t)){e=e.map(i),t=t.map(i);const r=n.isEqual(e,t);if(r)return void expect(r).toBe(!0);let c="\nExpected \n";e.forEach(e=>c+=`\t${s(e)}\n`),c+="\t\nto deep equal \n",t.forEach(e=>c+=`\t${s(e)}\n`),expect(r).toEqual(c)}else expect(e).toEqual(t)}let o;function a(){(o=new r.TestScheduler(c)).runMode=!0}function u(){if(o)return o;throw new Error("No test scheduler initialized")}function f(){o=null}class l extends t.Observable{constructor(e,t,r){super(),this.marbles=e,this.values=t,this.error=r;const n=u().createColdObservable(e,t,r);this.source=n}getSubscriptions(){return this.source.subscriptions}}class m extends t.Observable{constructor(e,t,r){super(),this.marbles=e,this.values=t,this.error=r;const n=u().createHotObservable(e,t,r);this.source=n}getSubscriptions(){return this.source.subscriptions}}function p(){jasmine.addMatchers({toHaveSubscriptions:()=>({compare:function(e,t){const n=("string"==typeof t?[t]:t).map(e=>r.TestScheduler.parseMarblesAsSubscriptions(e));return expect(n).toEqual(e.getSubscriptions()),{pass:!0}}}),toBeObservable:(e,s)=>({compare:function(e,s){const i=[];let c;const o=u();o.schedule(()=>{c=e.subscribe(e=>{let r=e;e instanceof t.Observable&&(r=function(e,r){const n=[],s=u();return e.subscribe(e=>{n.push({frame:s.frame-r,notification:t.Notification.createNext(e)})},e=>{n.push({frame:s.frame-r,notification:t.Notification.createError(e)})},()=>{n.push({frame:s.frame-r,notification:t.Notification.createComplete()})}),n}(r,o.frame)),i.push({frame:o.frame,notification:t.Notification.createNext(r)})},e=>{i.push({frame:o.frame,notification:t.Notification.createError(e)})},()=>{i.push({frame:o.frame,notification:t.Notification.createComplete()})})}),o.flush();const a=r.TestScheduler.parseMarbles(s.marbles,s.values,s.error,!0,!0);if(n.isEqual(i,a))return{pass:!0};const f=function(e,t,r){const n=function(e,t){const r=t.slice(),n={};for(let t=0;t<e.length;t++){const s=e[t];switch(s){case" ":case"-":case"^":case"(":case")":break;case"#":case"|":r.shift();break;default:{if(s.match(/^[0-9]$/)&&0===t||" "===e[t-1]){const r=e.slice(t).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);r&&(t+=r[0].length-1);break}const i=r.shift();n[s]=i.notification}}}return n}(e,t);return e=>{const t=Object.keys(n).find(t=>r(n[t],e));return t||"?"}}(s.marbles,a,n.isEqual),l=function(e,t){let r=0,n="",s=!1,i=0,c=0;const o=()=>{const t=e[c+1];return t&&t.frame===e[c].frame};return e.forEach((e,a)=>{c=a;const u=e.frame-r;switch(n+="-".repeat(u>0?u/10:0),o()&&(s||(n+="("),s=!0),e.notification.kind){case"N":n+=t(e.notification);break;case"E":n+="#";break;case"C":n+="|"}s&&(i+=1),!o()&&s?(n+=")",s=!1,r+=10*(i+1),i=0):r=e.frame+10}),n}(i,f);var m,p,h;return{pass:!1,message:(m=s.marbles,p=a,h=i,`\n    Expected: ${m},\n    Received: ${l},\n    \n    Expected:\n    ${JSON.stringify(p)}\n    \n    Received:\n    ${JSON.stringify(h)},\n  `)}}})})}function h(){jasmine.getEnv().beforeAll(()=>p()),jasmine.getEnv().beforeEach(()=>a()),jasmine.getEnv().afterEach(()=>{u().flush(),f()})}h(),e.hot=function(e,t,r){return new m(e.trim(),t,r)},e.cold=function(e,t,r){return new l(e.trim(),t,r)},e.time=function(e){return u().createTime(e.trim())},e.addMatchers=p,e.setupEnvironment=h,e.getTestScheduler=u,e.initTestScheduler=a,e.resetTestScheduler=f,Object.defineProperty(e,"__esModule",{value:!0})});