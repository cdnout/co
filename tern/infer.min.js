!function(t,e){"object"==typeof exports&&"object"==typeof module?e(exports,require("acorn"),require("acorn-loose"),require("acorn-walk"),require("./def"),require("./signal")):"function"==typeof define&&define.amd?define(["exports","acorn/dist/acorn","acorn-loose/dist/acorn-loose","acorn-walk/dist/walk","./def","./signal"],e):e(t.tern||(t.tern={}),acorn,acorn.loose,acorn.walk,tern.def,tern.signal)}(this,function(u,o,i,h,s,t){"use strict";var p=u.toString=function(t,e,r){return!t||t==r||e&&e<-3?"?":t.toString(e,r)},g=u.ANull=t.mixin({addType:function(){},propagate:function(){},getProp:function(){return g},forAllProps:function(){},hasType:function(){return!1},isEmpty:function(){return!0},getFunctionType:function(){},getObjType:function(){},getSymbolType:function(){},getType:function(){},gatherProperties:function(){},propagatesTo:function(){},typeHint:function(){},propHint:function(){},toString:function(){return"?"}});function e(t,e){var r=Object.create(t);if(e)for(var n in e)r[n]=e[n];return r}var f=1,y=u.AVal=function(){this.types=[],this.forward=null,this.maxWeight=0};function c(t,e,r){var n=t.getType(!1),o=e.getType(!1);return!n||!o||l(n,o,r)}function l(t,r,n){if(!t||5<=n)return r;if(!t||t==r)return t;if(!r)return t;if(t.constructor!=r.constructor)return!1;if(t.constructor!=R){if(t.constructor!=I)return t.constructor==M&&(!!(t.args.length==r.args.length&&t.args.every(function(t,e){return c(t,r.args[e],n+1)})&&c(t.retval,r.retval,n+1)&&c(t.self,r.self,n+1))&&t);var e=0,o=0,i=0;for(var s in t.props)e++,s in r.props&&c(t.props[s],r.props[s],n+1)&&i++;for(var s in r.props)o++;return!(e&&o&&i<Math.max(e,o)/2)&&(o<e?t:r)}var p=t.getProp("<i>").getType(!1);if(!p)return r;var a=r.getProp("<i>").getType(!1);return!a||l(p,a,n+1)?r:void 0}y.prototype=e(g,{addType:function(r,n){if(n=n||100,this.maxWeight<n){if(this.maxWeight=n,1==this.types.length&&this.types[0]==r)return;this.types.length=0}else if(this.maxWeight>n||-1<this.types.indexOf(r))return;this.signal("addType",r),this.types.push(r);var o=this.forward;o&&U(function(t){for(var e=0;e<o.length;++e)t(r,o[e],n)})},propagate:function(r,n){if(!(r==g||r instanceof A&&this.forward&&2<this.forward.length)){n&&100!=n&&(r=new C(r,n)),(this.forward||(this.forward=[])).push(r);var o=this.types;o.length&&U(function(t){for(var e=0;e<o.length;++e)t(o[e],r,n)})}},getProp:function(t){if(H(t))return g;var e=(this.props||(this.props=Object.create(null)))[t];return e||(e=this.props[t]=new y,this.propagate(new a(t,e))),e},forAllProps:function(t){this.propagate(new m(t))},hasType:function(t){return-1<this.types.indexOf(t)},isEmpty:function(){return 0===this.types.length},getFunctionType:function(){for(var t=this.types.length-1;0<=t;--t)if(this.types[t]instanceof M)return this.types[t]},getObjType:function(){for(var t=null,e=this.types.length-1;0<=e;--e){var r=this.types[e];if(r instanceof I){if(r.name)return r;t=t||r}}return t},getSymbolType:function(){for(var t=this.types.length-1;0<=t;--t)if(this.types[t]instanceof L)return this.types[t]},getType:function(t){return 0===this.types.length&&!1!==t?this.makeupType():1===this.types.length?this.types[0]:d(this.types)},toString:function(e,r){if(0==this.types.length)return p(this.makeupType(),e,r);if(1==this.types.length)return p(this.types[0],e,r);var t=n(this.types);return 2<t.length?"?":t.map(function(t){return p(t,e,r)}).join("|")},makeupPropType:function(t){var e=this.propertyName,r=t.proto&&t.proto.hasProp(e);if(r){var n=r.getType();if(n)return n}if("<i>"!=e){var o=t.hasProp("<i>");if(o)return o.getType()}else if(t.props["<i>"]!=this)for(var i in t.props){var s=t.props[i];if(!s.isEmpty())return s.getType()}},makeupType:function(){var t=this.propertyOf&&this.makeupPropType(this.propertyOf);if(t)return t;if(!this.forward)return null;for(var e=this.forward.length-1;0<=e;--e){var r=this.forward[e].typeHint();if(r&&!r.isEmpty())return kt=!0,r}var n=Object.create(null),o=null;for(e=0;e<this.forward.length;++e){(a=this.forward[e].propHint())&&"length"!=a&&"<i>"!=a&&"✖"!=a&&a!=q.completingProperty&&(n[a]=!0,o=a)}if(!o)return null;var i=_(o);if(i){var s=[];t:for(e=0;e<i.length;++e){var p=i[e];for(var a in n)if(!p.hasProp(a))continue t;p.hasCtor&&(p=T(p)),s.push(p)}var u=d(s);if(u)return kt=!0,u}},typeHint:function(){return this.types.length?this.getType():null},propagatesTo:function(){return this},gatherProperties:function(t,e){for(var r=0;r<this.types.length;++r)this.types[r].gatherProperties(t,e)},guessProperties:function(t){if(this.forward)for(var e=0;e<this.forward.length;++e){var r=this.forward[e].propHint();r&&t(r,null,0)}var n=this.makeupType();n&&n.gatherProperties(t)}});var n=u.simplifyTypes=function(t){var e=[];t:for(var r=0;r<t.length;++r){for(var n=t[r],o=0;o<e.length;o++){var i=l(n,e[o],0);if(i){e[o]=i;continue t}}e.push(n)}return e};function d(t){for(var e=0,r=0,n=0,o=null,i=0;i<t.length;++i){if((a=t[i])instanceof R)++e;else if(a instanceof M)++r;else if(a instanceof I)++n;else if(a instanceof F){if(o&&a.name!=o.name)return null;o=a}}if(1<(e&&1)+(r&&1)+(n&&1)+(o&&1))return null;if(o)return o;var s=0,p=null;for(i=0;i<t.length;++i){var a=t[i],u=0;if(e)u=a.getProp("<i>").isEmpty()?1:2;else if(r){u=1;for(var f=0;f<a.args.length;++f)a.args[f].isEmpty()||++u;a.retval.isEmpty()||++u}else n&&(u=a.name?100:2);s<=u&&(s=u,p=a)}return p}var r=u.constraint=function(t){function e(){this.origin=q.curOrigin,this.construct.apply(this,arguments)}for(var r in e.prototype=Object.create(g),t)t.hasOwnProperty(r)&&(e.prototype[r]=t[r]);return e},a=r({construct:function(t,e){this.prop=t,this.target=e},addType:function(t,e){t.getProp&&t.getProp(this.prop).propagate(this.target,e)},propHint:function(){return this.prop},propagatesTo:function(){if("<i>"==this.prop||!/[^\w_]/.test(this.prop))return{target:this.target,pathExt:"."+this.prop}}}),v=u.PropHasSubset=u.DefProp=r({construct:function(t,e,r){this.prop=t,this.type=e,this.originNode=r},addType:function(t,e){if(t instanceof I){var r=t.defProp(this.prop,this.originNode);r.origin||(r.origin=this.origin),this.type.propagate(r,e)}},propHint:function(){return this.prop}}),m=r({construct:function(t){this.c=t},addType:function(t){t instanceof I&&t.forAllProps(this.c)}});var P=u.IsCallee=r({construct:function(t,e,r,n){this.self=t,this.args=e,this.argNodes=r,this.retval=n,this.disabled=q.disabledComputing},addType:function(t,e){if(t instanceof M){for(var r=0;r<this.args.length;++r)r<t.args.length&&this.args[r].propagate(t.args[r],e),t.arguments&&this.args[r].propagate(t.arguments,e);t.isArrowFn()||this.self.propagate(t.self,this.self==q.topScope?90:e);var n=t.computeRet,o=t.retval;if(n)for(var i=this.disabled;i;i=i.prev)(i.fn==t||t.originNode&&i.fn.originNode==t.originNode)&&(n=null);if(n){var s=q.disabledComputing;q.disabledComputing=this.disabled,o=n(this.self,this.args,this.argNodes),q.disabledComputing=s}if(t.async&&!t.generator){var p=o.getType();if(!p||p.constructor!=I||"Promise"!=p.name){var a=q.definitions.ecmascript,u=a&&new I(a["Promise.prototype"]);u&&(u.getType().propagate(new v(":t",o)),o=u)}}St(t,o).propagate(this.retval,e)}},typeHint:function(){for(var t=[],e=0;e<this.args.length;++e)t.push("?");return new M(null,this.self,this.args,t,g)},propagatesTo:function(){return{target:this.retval,pathExt:".!ret"}}}),b=r({construct:function(t,e,r,n){this.propName=t,this.args=e,this.argNodes=r,this.retval=n,this.disabled=q.disabledComputing},addType:function(t,e){var r=new P(t,this.args,this.argNodes,this.retval);r.disabled=this.disabled,t.getProp(this.propName).propagate(r,e)},propHint:function(){return this.propName}}),w=u.IsCtor=r({construct:function(t,e){this.target=t,this.noReuse=e},addType:function(t,e){t instanceof M&&(q.parent&&!q.parent.options.reuseInstances&&(this.noReuse=!0),t.getProp("prototype").propagate(new x(!this.noReuse&&t,this.target),e))}}),T=u.getInstance=function(t,e){if(!1===e)return new I(t);e=e||t.hasCtor,t.instances||(t.instances=[]);for(var r=0;r<t.instances.length;++r){var n=t.instances[r];if(n.ctor==e)return n.instance}var o=new I(t,e&&e.name);return o.origin=t.origin,t.instances.push({ctor:e,instance:o}),o},x=u.IsProto=r({construct:function(t,e){this.ctor=t,this.target=e},addType:function(t,e){t instanceof I&&(8<(this.count=(this.count||0)+1)||(t==q.protos.Array?this.target.addType(new R):this.target.addType(T(t,this.ctor))))}}),E=r({construct:function(t){this.fn=t},addType:function(t,e){if(t instanceof I&&!t.hasCtor){t.hasCtor=this.fn;var n=new O(t,this.fn);n.addType(this.fn),t.forAllProps(function(t,e,r){r&&e.propagate(n)})}}}),S=r({construct:function(t,e){this.other=t,this.target=e},addType:function(t,e){t==q.str?this.target.addType(q.str,e):t==q.num&&this.other.hasType(q.num)&&this.target.addType(q.num,e)},typeHint:function(){return this.other}}),N=u.IfObj=r({construct:function(t){this.target=t},addType:function(t,e){t instanceof I&&this.target.addType(t,e)},propagatesTo:function(){return this.target}}),O=r({construct:function(t,e){this.obj=t,this.ctor=e},addType:function(t){t instanceof M&&t.self&&t.self.addType(T(this.obj,this.ctor),4)}}),j=r({construct:function(t){this.obj=t},addType:function(t){t instanceof I&&this.obj.proto==q.protos.Object&&this.obj.replaceProto(t)}}),C=r({construct:function(t,e){this.inner=t,this.weight=e},addType:function(t,e){this.inner.addType(t,Math.min(e,this.weight))},propagatesTo:function(){return this.inner.propagatesTo()},typeHint:function(){return this.inner.typeHint()},propHint:function(){return this.inner.propHint()}}),A=u.Type=function(){};A.prototype=e(g,{constructor:A,propagate:function(t,e){t.addType(this,e)},hasType:function(t){return t==this},isEmpty:function(){return!1},typeHint:function(){return this},getType:function(){return this}});var F=u.Prim=function(t,e){this.name=e,this.proto=t};function k(t){var e=t.charCodeAt(0);return 48<=e&&e<=57&&!/\D/.test(t)}F.prototype=e(A.prototype,{constructor:F,toString:function(){return this.name},getProp:function(t){return this.proto.hasProp(t)||g},gatherProperties:function(t,e){this.proto&&this.proto.gatherProperties(t,e)}});var I=u.Obj=function(t,e){if(this.props||(this.props=Object.create(null)),this.proto=!0===t?q.protos.Object:t,t&&t!=q.protos.Object&&!e&&t.name&&!(this instanceof M)){var r=/^(.*)\.prototype$/.exec(this.proto.name);r&&(e=r[1])}this.name=e,this.maybeProps=null,this.origin=q.curOrigin};I.prototype=e(A.prototype,{constructor:I,toString:function(t){if(null==t&&(t=0),t<=0&&this.name)return this.name;var e=[],r=!1;for(var n in this.props)if("<i>"!=n){if(5<e.length){r=!0;break}t?e.push(n+": "+p(this.props[n],t-1,this)):e.push(n)}return e.sort(),r&&e.push("..."),"{"+e.join(", ")+"}"},hasProp:function(t,e){k(t)&&(t=this.normalizeIntegerProp(t));var r=this.props[t];if(!1!==e)for(var n=this.proto;n&&!r;n=n.proto)r=n.props[t];return r},defProp:function(t,e){var r=this.hasProp(t,!1);if(r)return e&&!r.originNode&&(r.originNode=e),r;if(H(t))return g;k(t)&&(t=this.normalizeIntegerProp(t));var n=this.maybeProps&&this.maybeProps[t];return n?(delete this.maybeProps[t],this.maybeUnregProtoPropHandler()):((n=new y).propertyOf=this,n.propertyName=t),(this.props[t]=n).originNode=e,n.origin=q.curOrigin,this.broadcastProp(t,n,!0),n},getProp:function(t){var e=this.hasProp(t,!0)||this.maybeProps&&this.maybeProps[t];if(e)return e;if(H(t))return g;k(t)&&(t=this.normalizeIntegerProp(t));var r=this.ensureMaybeProps()[t]=new y;return r.propertyOf=this,r.propertyName=t,r},normalizeIntegerProp:function(t){return"<i>"},broadcastProp:function(t,e,r){var n,o;if(r&&(this.signal("addProp",t,e),this instanceof W||(n=t,o=this,(q.props[n]||(q.props[n]=[])).push(o))),this.onNewProp)for(var i=0;i<this.onNewProp.length;++i){var s=this.onNewProp[i];s.onProtoProp?s.onProtoProp(t,e,r):s(t,e,r)}},onProtoProp:function(t,e,r){var n=this.maybeProps&&this.maybeProps[t];n&&(delete this.maybeProps[t],this.maybeUnregProtoPropHandler(),this.proto.getProp(t).propagate(n)),this.broadcastProp(t,e,!1)},replaceProto:function(t){for(var e=t;e;e=e.proto)if(e==this)return;this.proto&&this.maybeProps&&this.proto.unregPropHandler(this),this.proto=t,this.maybeProps&&this.proto.forAllProps(this)},ensureMaybeProps:function(){return this.maybeProps||(this.proto&&this.proto.forAllProps(this),this.maybeProps=Object.create(null)),this.maybeProps},removeProp:function(t){var e=this.props[t];delete this.props[t],(this.ensureMaybeProps()[t]=e).types.length=0},forAllProps:function(t){this.onNewProp||(this.onNewProp=[],this.proto&&this.proto.forAllProps(this)),this.onNewProp.push(t);for(var e=this;e;e=e.proto)for(var r in e.props)t.onProtoProp?t.onProtoProp(r,e.props[r],e==this):t(r,e.props[r],e==this)},maybeUnregProtoPropHandler:function(){if(this.maybeProps){for(var t in this.maybeProps)return;this.maybeProps=null}!this.proto||this.onNewProp&&this.onNewProp.length||this.proto.unregPropHandler(this)},unregPropHandler:function(t){for(var e=0;e<this.onNewProp.length;++e)if(this.onNewProp[e]==t){this.onNewProp.splice(e,1);break}this.maybeUnregProtoPropHandler()},gatherProperties:function(t,e){for(var r in this.props)"<i>"!=r&&":"!=r.charAt(0)&&t(r,this,e);this.proto&&this.proto.gatherProperties(t,e+1)},getObjType:function(){return this}});var D="undefined"!=typeof StopIteration;function H(t){return"__proto__"==t||"✖"==t||D&&"__iterator__"==t}var M=u.Fn=function(t,e,r,n,o,i,s){I.call(this,q.protos.Function,t),this.self=e,this.args=r,this.argNames=n,this.retval=o,this.generator=i,this.async=s};M.prototype=e(I.prototype,{constructor:M,toString:function(t){null==t&&(t=0);for(var e=this.generator?"fn*(":"fn(",r=0;r<this.args.length;++r){r&&(e+=", ");var n=this.argNames[r];n&&"?"!=n&&(e+=n+": "),e+=-3<t?p(this.args[r],t-1,this):"?"}return e+=")",this.retval.isEmpty()||(e+=" -> "+(-3<t?p(this.retval,t-1,this):"?")),e},getProp:function(t){if("prototype"!=t)return I.prototype.getProp.call(this,t);var e=this.hasProp(t,!1);if(!e){e=this.defProp(t);var r=new I(!0,this.name&&this.name+".prototype");r.origin=this.origin,e.addType(r,10)}return e},defProp:function(t,e){if("prototype"!=t)return I.prototype.defProp.call(this,t,e);var r=this.hasProp(t,!1);return r||((r=I.prototype.defProp.call(this,t,e)).origin=this.origin,r.propagate(new E(this)),r)},getFunctionType:function(){return this},isArrowFn:function(){return this.originNode&&"ArrowFunctionExpression"==this.originNode.type}});var R=u.Arr=function(t){I.call(this,q.protos.Array);var e=this.defProp("<i>");if(Array.isArray(t)){this.tuple=t.length;for(var r=0;r<t.length;r++){var n=this.defProp(String(r));t[r].propagate(n),n.propagate(e)}}else t&&(this.tuple=0,t.propagate(e))};R.prototype=e(I.prototype,{constructor:R,toString:function(t){if(null==t&&(t=0),t<=-3)return"[?]";var e="";if(this.tuple){for(var r,n=0;n in this.props;n++){var o=p(this.getProp(String(n)),t-1,this);r=null==r?o:r==o&&o,e+=(e?", ":"")+o}r&&(e=r)}else e=p(this.getProp("<i>"),t-1,this);return"["+e+"]"},normalizeIntegerProp:function(t){return+t<this.tuple?t:"<i>"}});var L=u.Sym=function(t,e){F.call(this,q.protos.Symbol,"Symbol"),this.symName=t,this.originNode=e};function _(t){return q.props[t]}L.prototype=e(F.prototype,{constructor:L,asPropName:function(){return":"+this.symName},getSymbolType:function(){return this}}),u.getSymbol=function(t,e){var r=t.replace(/[^\w$\.]/g,"_"),n=q.symbols[r];return n?(e&&!n.originNode&&(n.originNode=e),n):q.symbols[r]=new L(r,e)},u.Context=function(e,t){this.parent=t,this.props=Object.create(null),this.protos=Object.create(null),this.origins=[],this.curOrigin="ecmascript",this.paths=Object.create(null),this.definitions=Object.create(null),this.purgeGen=0,this.workList=null,this.disabledComputing=null,this.curSuperCtor=this.curSuper=null,this.symbols=Object.create(null),u.withContext(this,function(){if(q.protos.Object=new I(null,"Object.prototype"),q.topScope=new W,q.topScope.name="<top>",q.protos.Array=new I(!0,"Array.prototype"),q.protos.Function=new M("Function.prototype",g,[],[],g),q.protos.Function.proto=q.protos.Object,q.protos.RegExp=new I(!0,"RegExp.prototype"),q.protos.String=new I(!0,"String.prototype"),q.protos.Number=new I(!0,"Number.prototype"),q.protos.Boolean=new I(!0,"Boolean.prototype"),q.protos.Symbol=new I(!0,"Symbol.prototype"),q.str=new F(q.protos.String,"string"),q.bool=new F(q.protos.Boolean,"bool"),q.num=new F(q.protos.Number,"number"),q.curOrigin=null,e)for(var t=0;t<e.length;++t)s.load(e[t])})},u.Context.prototype.startAnalysis=function(){this.disabledComputing=this.workList=this.curSuperCtor=this.curSuper=null};var V,q=null;u.cx=function(){return q},u.withContext=function(t,e){var r=q;q=t;try{return e()}finally{q=r}},u.TimedOut=function(){this.message="Timed out",this.stack=(new Error).stack},u.TimedOut.prototype=Object.create(Error.prototype),u.TimedOut.prototype.name="infer.TimedOut",u.withTimeout=function(t,e){var r=+new Date+t,n=V;if(n&&n<r)return e();V=r;try{return e()}finally{V=n}},u.addOrigin=function(t){q.origins.indexOf(t)<0&&q.origins.push(t)};var G=20,B=1e-4;function U(t){if(q.workList)return t(q.workList);for(var n=[],o=0,e=t(q.workList=function(t,e,r){o<G-B*n.length&&n.push(t,e,r,o)}),r=0;r<n.length;r+=4){if(V&&+new Date>=V)throw new u.TimedOut;o=n[r+3]+1,n[r+1].addType(n[r],n[r+2])}return q.workList=null,e}function z(t,e,r){var n=q.curSuperCtor,o=q.curSuper;q.curSuperCtor=t,q.curSuper=e;var i=r();return q.curSuperCtor=n,q.curSuper=o,i}var W=u.Scope=function(t,e,r,n){I.call(this,t||!0),this.prev=t,this.originNode=e,this.isBlock=!!r,this.isCatch=!!n};function $(t,e){for(;t.isBlock||t.isCatch||!1===e&&t.fnType&&t.fnType.isArrowFn();)t=t.prev;return t}function Y(t,e){var r=$(t).fnType;r&&(r.instantiateScore=(r.instantiateScore||0)+e)}W.prototype=e(I.prototype,{constructor:W,defVar:function(t,e){for(var r=this;;r=r.proto){var n=r.props[t];if(n)return n;if(!r.prev)return r.defProp(t,e)}}});var J={};function K(t,e){var r=e.instantiateScore;if(!q.disabledComputing&&r&&e.args.length&&function(t,e){try{return h.simple(t,{Expression:function(){if(--e<=0)throw J}}),1}catch(t){if(t==J)return;throw t}}(t,5*r))return Y($(e.originNode.scope.prev),r/2),function(f,c){for(var l=f.scope,t=0;t<c.args.length;++t)c.args[t]=new y;c.self=new y,c.computeRet=function(a,u){return function(t,e){q.disabledComputing={fn:t,prev:q.disabledComputing};var r=e();return q.disabledComputing=q.disabledComputing.prev,r}(c,function(){var t=q.curOrigin;q.curOrigin=c.origin;var e=f.scope?f.scope:l,r=new W(e.prev,e.originNode);for(var n in e.props)for(var o=r.defProp(n,e.props[n].originNode),i=0;i<u.length;++i)c.argNames[i]==n&&i<u.length&&u[i].propagate(o);for(var s=c.argNames.length!=u.length?c.argNames.slice(0,u.length):c.argNames;s.length<u.length;)s.push("?");if(r.fnType=new M(c.name,a,u,s,g,c.generator,c.async),r.fnType.originNode=c.originNode,c.arguments){var p=r.fnType.arguments=new y;r.defProp("arguments").addType(new R(p));for(i=0;i<u.length;++i)u[i].propagate(p)}return f.scope=r,h.recursive(f.body,r,null,rt),h.recursive(f.body,r,null,Tt),q.curOrigin=t,r.fnType.retval})}}(t,e),1;e.instantiateScore=null}function Q(t){var a=t.retval;if(a!=g&&!t.isArrowFn()){var e,r;!a.isEmpty()&&(e=a.getType())instanceof R&&(a=r=e.getProp("<i>"));for(var n=u(t.self,"!this",0),o=0;!n&&o<t.args.length;++o)n=u(t.args[o],"!"+o,0);if(n){r&&(n="["+n+"]");var i=new s.TypeParser(n).parseType(!0);return t.computeRet=i.apply?i:function(){return i},t.computeRetSource=n,1}}function u(t,e,r){if(!(3<r)&&t.forward)for(var n=0;n<t.forward.length;++n){var o=t.forward[n].propagatesTo();if(o){var i,s=e;if(o instanceof y)i=o;else{if(!(o.target instanceof y))continue;s+=o.pathExt,i=o.target}if(i==a)return s;var p=u(i,s,r+1);if(p)return p}}}}function X(t,e){return t.defProp(e.name,e)}function Z(t){return"Identifier"==t.type?t.name:"AssignmentPattern"==t.type?Z(t.left):"ObjectPattern"==t.type?"{"+t.properties.map(function(t){return Z("RestElement"===t.type?t:t.value)}).join(", ")+"}":"ArrayPattern"==t.type?"["+t.elements.map(function(t){return t?Z(t):""}).join(", ")+"]":"RestElement"==t.type?"..."+Z(t.argument):"_"}function tt(t){return"VariableDeclaration"==t.type&&"var"!=t.kind||"FunctionDeclaration"==t.type||"ClassDeclaration"==t.type}function et(t,e){return{inner:t,outer:e||t}}var rt=u.scopeGatherer=h.make({VariablePattern:function(t,e){e.inner&&X(e.inner,t)},AssignmentPattern:function(t,e,r){r(t.left,e,"Pattern"),r(t.right,e.outer,"Expression")},AssignmentExpression:function(t,e,r){"MemberExpression"==t.left.type?r(t.left,e,"Expression"):r(t.left,et(!1,e),"Pattern"),r(t.right,e,"Expression")},MemberPattern:function(t,e,r){r(t,e.outer)},Function:function(t,e,r){for(var n=t.scope=new W(e,t),o=[],i=[],s=0;s<t.params.length;++s){var p=t.params[s];if(i.push(Z(p)),"Identifier"==p.type)o.push(X(n,p));else{var a=new y;o.push(a),r(a.originNode=p,et(n),"Pattern")}}n.fnType=new M(t.id&&t.id.name,new y,o,i,g,t.generator,t.async),(n.fnType.originNode=t).id&&X("FunctionDeclaration"==t.type?e:n,t.id);r(t.body,n,t.expression?"Expression":"Statement")},BlockStatement:function(t,e,r){!t.scope&&t.body.some(tt)&&(e=t.scope=new W(e,t,!0)),h.base.BlockStatement(t,e,r)},CatchClause:function(t,e,r){if(t.param)if(e=t.scope=new W(e,t,!1,!0),"Identifier"==t.param.type){var n=X(e,t.param);r(t.body,e,"Statement");var o=q.definitions.ecmascript;o&&n.isEmpty()&&T(o["Error.prototype"]).propagate(n,6)}else r(t.param,et(e),"Pattern")},VariableDeclaration:function(t,e,r){for(var n="var"==t.kind?$(e):e,o=0;o<t.declarations.length;++o){var i=t.declarations[o];r(i.id,et(n,e),"Pattern"),i.init&&r(i.init,e,"Expression")}},ClassDeclaration:function(t,e,r){t.id&&X(e,t.id),t.superClass&&r(t.superClass,e,"Expression");for(var n=0;n<t.body.body.length;n++)r(t.body.body[n],e)},ForInStatement:function(t,e,r){!t.scope&&tt(t.left)&&(e=t.scope=new W(e,t,!0)),h.base.ForInStatement(t,e,r)},ForStatement:function(t,e,r){!t.scope&&t.init&&tt(t.init)&&(e=t.scope=new W(e,t,!0)),h.base.ForStatement(t,e,r)},ImportDeclaration:function(t,e){for(var r=0;r<t.specifiers.length;r++)X(e,t.specifiers[r].local)}});function nt(t){t.scope&&(t.scope=null)}rt.ForOfStatement=rt.ForInStatement;var ot={BlockStatement:nt,Function:nt,CatchClause:nt,ForInStateMent:nt,ForStatement:nt};u.clearScopes=function(t){h.simple(t,ot)};var it=u.propName=function(t,e){var r=t.property||t.key;if(!t.computed&&"Identifier"==r.type)return r.name;if("Literal"==r.type){if("string"==typeof r.value)return r.value;if("number"==typeof r.value)return String(r.value)}if(e){var n=st(bt(r,e));if(n)return t.propName=n}else if(t.propName)return t.propName;return"<i>"};function st(t){var e=t.getSymbolType();if(e)return e.asPropName()}function pt(t){switch(t){case"+":case"-":case"~":return q.num;case"!":return q.bool;case"typeof":return q.str;case"void":case"delete":return g}}function at(t){switch(t){case"==":case"!=":case"===":case"!==":case"<":case">":case">=":case"<=":case"in":case"instanceof":return 1}}function ut(t){if(t.regex)return T(q.protos.RegExp);switch(typeof t.value){case"boolean":return q.bool;case"number":return q.num;case"string":return q.str;case"object":case"function":return t.value?T(q.protos.RegExp):g}}function ft(t,e){for(var r=0;r<t.params.length;r++){var n=t.params[r];"Identifier"!=n.type&&ht(n,e,t.scope.fnType.args[r])}}function ct(t,e){return e.hasProp(t.name)||q.topScope.defProp(t.name,t)}var lt=u.inferPatternVisitor={Identifier:function(t,e,r){r.propagate(ct(t,e))},MemberExpression:function(t,e,r){var n=bt(t.object,e),o=it(t,e);n.propagate(new v(o,r,t.property))},RestElement:function(t,e,r){ht(t.argument,e,new R(r))},ObjectPattern:function(t,e,r){for(var n=0;n<t.properties.length;++n){var o=t.properties[n];"RestElement"!=o.type&&ht(o.value,e,r.getProp(it(o)))}},ArrayPattern:function(t,e,r){for(var n=0;n<t.elements.length;n++)t.elements[n]&&ht(t.elements[n],e,r.getProp(String(n)))},AssignmentPattern:function(t,e,r){ht(t.left,e,function(t,e){if(t==e||e==g)return t;if(t==g)return e;var r=new y;return t.propagate(r),e.propagate(r),r}(r,bt(t.right,e)))}};function ht(t,e,r){var n=lt[t.type];n&&n(t,e,r)}function gt(t){var e=$(t);return e.fnType?e.fnType.self:e}function yt(u,f,c){!c&&u.id&&(c=u.id.name);var t,e,r=q.protos.Object;if(u.superClass)if("Literal"==u.superClass.type&&null==u.superClass.value)r=null;else{var n,o=bt(u.superClass,f);(t=o.getFunctionType())&&(n=t.getProp("prototype").getObjType())?r=n:e=(t=o).getProp("prototype")}var l=new I(r,c&&c+".prototype");return e&&e.propagate(new j(l)),z(t,e||r,function(){for(var t,e=u.body.body,r=0;r<e.length;r++)"constructor"==e[r].kind&&(t=e[r].value);var n=u.objType=t?bt(t,f):new M(c,g,[],null,g);n.originNode=u.id||t||u;var o=T(l,n);n.self.addType(o),n.defProp("prototype",u).addType(l);for(r=0;r<e.length;r++){var i,s=e[r];if("constructor"!=s.kind){var p=it(s,f);"<i>"==p||"set"==s.kind?i=g:((i=(s.static?n:l).defProp(p,s.key)).initializer=!0,"get"==s.kind&&(i=new P(o,[],null,i))),bt(s.value,f,i);var a=i.getFunctionType();a&&a.self.addType(o)}}return n})}function dt(t,e,r){var n=1<t.length&&t.length<6;if(n){for(var o,i=!0,s=0;s<t.length;s++){var p=t[s];p?"Literal"!=p.type||o&&o!=typeof p.value?i=!1:o=typeof p.value:n=!1}i&&(n=!1)}if(n){var a=[];for(s=0;s<t.length;++s)a.push(r(t[s],e));return new R(a)}if(t.length<2)return new R(t[0]&&r(t[0],e));var u=new y;for(s=0;s<t.length;s++)t[s]&&r(t[s],e).propagate(u);return new R(u)}function vt(i){return function(t,e,r,n){var o=i(t,e,n);return r&&o.propagate(r),o}}function mt(o){return function(t,e,r,n){return r=r||new y,o(t,e,r,n),r}}var Pt=u.inferExprVisitor={ArrayExpression:vt(function(t,e){return dt(t.elements,e,bt)}),ObjectExpression:vt(function(s,p,t){for(var e,r=q.protos.Object,n=0;n<s.properties.length;++n){var o=s.properties[n];if("SpreadElement"!=o.type&&"__proto__"==o.key.name)if("Literal"==o.value.type&&null==o.value.value)r=null;else{var i=bt(o.value,p),a=i.getObjType();a?r=a:e=i}}var u=s.objType=new I(r,t);return e&&e.propagate(new j(u)),u.originNode=s,z(null,e||r,function(){for(var t=0;t<s.properties.length;++t){var e=s.properties[t],r=e.key;if("SpreadElement"!=e.type&&!H(e.key.name)){var n,o=it(e,p);if("<i>"==o||"set"==e.kind)n=g;else{var i=n=u.defProp(o,r);i.initializer=!0,"get"==e.kind&&(n=new P(u,[],null,i))}bt(e.value,p,n,o),"FunctionExpression"==e.value.type&&e.value.scope.fnType.self.addType(u,2)}}}),u}),FunctionExpression:vt(function(t,e,r){var n=t.scope,o=n.fnType;return r&&!o.name&&(o.name=r),ft(t,n),t.expression?bt(t.body,n,n.fnType.retval=new y):h.recursive(t.body,n,null,Tt,"Statement"),"ArrowFunctionExpression"==t.type&&gt(e).propagate(o.self),K(t,o)||Q(o),t.id&&n.getProp(t.id.name).addType(o),o}),ClassExpression:vt(yt),SequenceExpression:vt(function(t,e){for(var r=0,n=t.expressions.length-1;r<n;++r)bt(t.expressions[r],e,g);return bt(t.expressions[n],e)}),UnaryExpression:vt(function(t,e){return bt(t.argument,e,g),pt(t.operator)}),UpdateExpression:vt(function(t,e){return bt(t.argument,e,g),q.num}),BinaryExpression:vt(function(t,e){if("+"!=t.operator)return bt(t.left,e,g),bt(t.right,e,g),at(t.operator)?q.bool:q.num;var r=bt(t.left,e),n=bt(t.right,e);if(r.hasType(q.str)||n.hasType(q.str))return q.str;if(r.hasType(q.num)&&n.hasType(q.num))return q.num;var o=new y;return r.propagate(new S(n,o)),n.propagate(new S(r,o)),o}),AssignmentExpression:vt(function(t,e,r){var n,o;if("MemberExpression"==t.left.type?(o=it(t.left,e),r=r||("Identifier"==t.left.object.type?t.left.object.name+"."+o:o)):r||"Identifier"!=t.left.type||(r=t.left.name),n=t.operator&&"="!=t.operator&&"+="!=t.operator?(bt(t.right,e,g),q.num):bt(t.right,e,null,r),"MemberExpression"==t.left.type){var i=bt(t.left.object,e);if("prototype"==o&&Y(e,20),"<i>"==o){var s=t.left.property.name,p=e.props[s],a=p&&p.iteratesOver;if(a){Y(e,20);var u="MemberExpression"==t.right.type&&t.right.computed&&t.right.property.name==s;return a.forAllProps(function(t,e,r){r&&"prototype"!=t&&"<i>"!=t&&i.propagate(new v(t,u?e:g))}),n}}i.propagate(new v(o,n,t.left.property)),function t(e){e.isEmpty()&&e.propertyOf&&(e.propertyOf.getProp(e.propertyName).addType(new I,f),t(e.propertyOf))}(i),"FunctionExpression"==t.right.type&&i.propagate(t.right.scope.fnType.self,2)}else ht(t.left,e,n);return n}),LogicalExpression:mt(function(t,e,r){bt(t.left,e,r),bt(t.right,e,r)}),ConditionalExpression:mt(function(t,e,r){bt(t.test,e,g),bt(t.consequent,e,r),bt(t.alternate,e,r)}),NewExpression:mt(function(t,e,r,n){"Identifier"==t.callee.type&&t.callee.name in e.props&&Y(e,20);for(var o=0,i=[];o<t.arguments.length;++o)i.push(bt(t.arguments[o],e));var s=bt(t.callee,e),p=new y;s.propagate(new w(p,n&&/\.prototype$/.test(n))),p.propagate(r,90),s.propagate(new P(p,i,t.arguments,new N(r)))}),CallExpression:mt(function(t,e,r){for(var n=0,o=[];n<t.arguments.length;++n)o.push(bt(t.arguments[n],e));var i=$(e).fnType;if("MemberExpression"==t.callee.type){var s=bt(t.callee.object,e),p=it(t.callee,e);i&&("call"==p||"apply"==p)&&-1<i.args.indexOf(s)&&Y(e,30),s.propagate(new b(p,o,t.arguments,r))}else if("Super"==t.callee.type&&q.curSuperCtor)t.callee.superType=q.curSuperCtor,q.curSuperCtor.propagate(new P(gt(e),o,t.arguments,r)),gt(e).propagate(r,90);else{var a=bt(t.callee,e);i&&-1<i.args.indexOf(a)&&Y(e,30);var u=a.getFunctionType();u&&u.instantiateScore&&i&&Y(e,u.instantiateScore/5),a.propagate(new P(q.topScope,o,t.arguments,r))}}),AwaitExpression:mt(function(t,e,r,n){var o=bt(t.argument,e,null,n),i=o.getType();i&&i.constructor==I&&"Promise"==i.name?i.hasProp(":t")&&i.getProp(":t").propagate(r):o.propagate(r)}),MemberExpression:mt(function(t,e,r){var n,o=it(t);if("<i>"==o){var i=bt(t.property,e),s=st(i);s?o=t.propName=s:i.hasType(q.num)||(n=6)}bt(t.object,e).getProp(o).propagate(r,n)}),Identifier:vt(function(t,e){if("arguments"==t.name){var r=$(e,!1);!r.fnType||t.name in r.props||r.defProp(t.name,r.fnType.originNode).addType(new R(r.fnType.arguments=new y))}return e.getProp(t.name)}),ThisExpression:vt(function(t,e){return gt(e)}),Super:vt(function(t){return t.superType=q.curSuper||g}),Literal:vt(function(t){return ut(t)}),TemplateLiteral:vt(function(t,e){for(var r=0;r<t.expressions.length;++r)bt(t.expressions[r],e,g);return q.str}),TaggedTemplateExpression:mt(function(t,e,r){for(var n=[new R(q.str)],o=0;o<t.quasi.expressions.length;++o)n.push(bt(t.quasi.expressions[o],e));bt(t.tag,e,new P(q.topScope,n,t.quasi.expressions,r))}),YieldExpression:vt(function(t,e){var r=g,n=$(e).fnType;return n&&(n.retval==g&&(n.retval=new y),n.yieldval||(n.yieldval=new y),r=n.retval),t.argument&&(t.delegate?bt(t.argument,e,new b("next",[],null,new a("value",r))):bt(t.argument,e,r)),n?n.yieldval:g})};function bt(t,e,r,n){var o=Pt[t.type];return o?o(t,e,r,n):g}function wt(t){return"VariableDeclaration"==t.type?t.declarations[0].id:t}Pt.ArrowFunctionExpression=Pt.FunctionExpression;var Tt=u.inferWrapper=h.make({Expression:function(t,e){bt(t,t.scope||e,g)},ObjectExpression:function(t,e){bt(t,t.scope||e,g)},FunctionDeclaration:function(t,e,r){var n=t.scope,o=n.fnType;ft(t,n),r(t.body,n,"Statement"),K(t,o)||Q(o),t.id&&e.getProp(t.id.name).addType(o)},Statement:function(t,e,r){r(t,t.scope||e)},ExportDefaultDeclaration:function(t,e,r){r(t.declaration,t.scope||e)},VariableDeclaration:function(t,e){for(var r=0;r<t.declarations.length;++r){var n=t.declarations[r];if("Identifier"==n.id.type){var o=e.getProp(n.id.name);n.init&&bt(n.init,e,o,n.id.name)}else n.init&&ht(n.id,e,bt(n.init,e))}},ClassDeclaration:function(t,e){t.id?e.getProp(t.id.name).addType(yt(t,e,t.id.name)):yt(t,e)},ReturnStatement:function(t,e){if(t.argument){var r=g,n=$(e).fnType;n&&(n.retval==g&&(n.retval=new y),r=n.retval),bt(t.argument,e,r)}},ForInStatement:function(t,e,r){var n=bt(t.right,e);if("Identifier"==t.right.type&&t.right.name in e.props||"MemberExpression"==t.right.type&&"prototype"==t.right.property.name){Y(e,5);var o=wt(t.left);"Identifier"==o.type?(o.name in e.props&&(e.getProp(o.name).iteratesOver=n),n.getProp("<i>").propagate(ct(o,e))):ht(o,e,n.getProp("<i>"))}r(t.body,e,"Statement")},ForOfStatement:function(t,e,r){var n,o=wt(t.left);"Identifier"==o.type?n=ct(o,e):ht(o,e,n=new y),t.await?bt(t.right,e,new b(":Symbol.asyncIterator",[],null,new b("next",[],null,new a(":t",new a("value",n))))):bt(t.right,e,new b(":Symbol.iterator",[],null,new b("next",[],null,new a("value",n)))),r(t.body,e,"Statement")}}),xt=u.parse=function(e,r,t){var n;r&&!Array.isArray(r)||(r=t);try{n=o.parse(e,r)}catch(t){n=i.parse(e,r)}return n};function Et(t,e,r){var n=q.definitions.ecmascript,o=new I(!0);o.defProp("done").addType(q.bool),e.propagate(o.defProp("value"));var i=o;r&&n&&(i=new I(n["Promise.prototype"])).getType().propagate(new v(":t",o));var s=new M(null,g,t?[t]:[],t?["?"]:[],i),p=new I(!n||(r?n.async_generator_prototype:n.generator_prototype));return p.defProp("next").addType(s),p}function St(t,e){return t.generator?t.computeRet?Et(t.yieldval,e,t.async):(!0===t.generator&&(t.generator=Et(t.yieldval,e,t.async)),t.generator):e}function Nt(t,e,r){var n=jt(t,r).getFunctionType();if(!n)return g;var o=n.retval;if(n.computeRet){for(var i=0,s=[];i<e.length;++i)s.push(jt(e[i],r));var p=g;"MemberExpression"==t.type&&(p=jt(t.object,r)),o=n.computeRet(p,s,e)}return St(n,o)}u.analyze=function(t,e,r){"string"==typeof t&&(t=xt(t)),e=e||"file#"+q.origins.length,u.addOrigin(q.curOrigin=e),r=r||q.topScope,q.startAnalysis(),h.recursive(t,r,null,rt),q.parent&&q.parent.signal("preInfer",t,r),h.recursive(t,r,null,Tt),q.parent&&q.parent.signal("postInfer",t,r),q.curOrigin=null},u.purge=function(t,e,r){var n=function(r,n,o){var t=Array.isArray(r);t&&1==r.length&&(r=r[0],t=!1);return t?null==o?function(t){return-1<r.indexOf(t.origin)}:function(t,e){return e&&e.start>=n&&e.end<=o&&-1<r.indexOf(t.origin)}:null==o?function(t){return t.origin==r}:function(t,e){return e&&e.start>=n&&e.end<=o&&t.origin==r}}(t,e,r);for(var o in++q.purgeGen,q.topScope.purge(n),q.props){for(var i=q.props[o],s=0;s<i.length;++s){var p=i[s].props[o];p&&!n(p,p.originNode)||i.splice(s--,1)}i.length||delete q.props[o]}},y.prototype.purge=function(t){if(this.purgeGen!=q.purgeGen){this.purgeGen=q.purgeGen;for(var e=0;e<this.types.length;++e){var r=this.types[e];t(r,r.originNode)?this.types.splice(e--,1):r.purge(t)}if(this.types.length||(this.maxWeight=0),this.forward)for(e=0;e<this.forward.length;++e){var n=this.forward[e];t(n)?(this.forward.splice(e--,1),this.props&&(this.props=null)):n.purge&&n.purge(t)}}},g.purge=function(){},I.prototype.purge=function(t){if(this.purgeGen==q.purgeGen)return!0;for(var e in this.purgeGen=q.purgeGen,this.props){var r=this.props[e];t(r,r.originNode)&&this.removeProp(e),r.purge(t)}},M.prototype.purge=function(t){if(!I.prototype.purge.call(this,t)){this.self.purge(t),this.retval.purge(t);for(var e=0;e<this.args.length;++e)this.args[e].purge(t)}};var Ot=u.typeFinder={ArrayExpression:function(t,e){return dt(t.elements,e,jt)},ObjectExpression:function(t){return t.objType},ClassDeclaration:function(t){return t.objType},ClassExpression:function(t){return t.objType},FunctionDeclaration:function(t){return t.scope.fnType},FunctionExpression:function(t){return t.scope.fnType},ArrowFunctionExpression:function(t){return t.scope.fnType},SequenceExpression:function(t,e){return jt(t.expressions[t.expressions.length-1],e)},UnaryExpression:function(t){return pt(t.operator)},UpdateExpression:function(){return q.num},BinaryExpression:function(t,e){if(at(t.operator))return q.bool;if("+"==t.operator){var r=jt(t.left,e),n=jt(t.right,e);if(r.hasType(q.str)||n.hasType(q.str))return q.str}return q.num},AssignmentExpression:function(t,e){return jt(t.right,e)},LogicalExpression:function(t,e){var r=jt(t.left,e);return r.isEmpty()?jt(t.right,e):r},ConditionalExpression:function(t,e){var r=jt(t.consequent,e);return r.isEmpty()?jt(t.alternate,e):r},NewExpression:function(t,e){var r=jt(t.callee,e).getFunctionType(),n=r&&r.getProp("prototype").getObjType();return n?T(n,r):g},CallExpression:function(t,e){return Nt(t.callee,t.arguments,e)},MemberExpression:function(t,e){var r=it(t),n=jt(t.object,e).getType();return n?n.getProp(r):"<i>"==r?g:function(t){kt=!0;var e=_(t);if(e)for(var r=0;r<e.length;++r){var n=e[r].getProp(t);if(!n.isEmpty())return n}return g}(r)},MethodDefinition:function(t){var e=it(t),r=gt(t.value.scope).getType();return r?r.getProp(e):g},Identifier:function(t,e){return e.hasProp(t.name)||g},ThisExpression:function(t,e){return gt(e)},Literal:function(t){return ut(t)},Super:vt(function(t){return t.superType}),TemplateLiteral:function(){return q.str},TaggedTemplateExpression:function(t,e){return Nt(t.tag,t.quasi.expressions,e)},YieldExpression:function(t,e){var r=$(e).fnType;return r?r.yieldval:g}};function jt(t,e){var r=Ot[t.type];return r?r(t,e):g}var Ct=u.searchVisitor=h.make({Function:function(t,e,r){h.base.Function(t,t.scope,r)},CatchClause:function(t,e,r){h.base.CatchClause(t,t.scope,r)},Property:function(t,e,r){t.computed&&r(t.key,e,"Expression"),t.key!=t.value&&r(t.value,e,"Expression")},Statement:function(t,e,r){r(t,t.scope||e)},ImportSpecifier:function(t,e,r){r(t.local,e)},ImportDefaultSpecifier:function(t,e,r){r(t.local,e)},ImportNamespaceSpecifier:function(t,e,r){r(t.local,e)}}),At=u.searchExprVisitor=h.make({MemberExpression:function(t,e,r){r(t.object,e,"Expression"),t.computed&&r(t.property,e,"Expression")},Property:function(t,e,r){t.computed&&r(t.key,e,"Expression"),r(t.value,e,"Expression")}},Ct);u.fullVisitor=h.make({MemberExpression:function(t,e,r){r(t.object,e,"Expression"),r(t.property,e,t.computed?"Expression":null)},Property:function(t,e,r){t.computed&&r(t.key,e,"Expression"),r(t.value,e,"Expression")}},Ct),u.findExpressionAt=function(t,e,r,n,o){var i=o||function(t,e){return("Identifier"!=e.type||"✖"!=e.name)&&Ot.hasOwnProperty(e.type)};return h.findNodeAt(t,e,r,i,At,n||q.topScope)},u.findClosestExpression=function(t,r,e,n,o){var i=o||function(t,e){return!(null!=r&&e.start>r)&&(("Identifier"!=e.type||"✖"!=e.name)&&Ot.hasOwnProperty(e.type))};return h.findNodeAround(t,e,i,At,n||q.topScope)},u.findExpressionAround=function(t,r,e,n,o){var i=o||function(t,e){return!(null!=r&&e.start>r)&&(("Identifier"!=e.type||"✖"!=e.name)&&Ot.hasOwnProperty(e.type))};return h.findNodeAround(t,e,i,Ct,n||q.topScope)},u.expressionType=function(t){return jt(t.node,t.state)},u.parentNode=function(i,t){var s=[];try{!function t(e,r,n){if(e.start<=i.start&&e.end>=i.end){var o=s[s.length-1];if(e==i)throw{found:o};o!=e&&s.push(e),h.base[n||e.type](e,r,t),o!=e&&s.pop()}}(t,null)}catch(t){if(t.found)return t.found;throw t}};var Ft=u.findTypeFromContext={ArrayExpression:function(t,e,r){return r(t,!0).getProp("<i>")},ObjectExpression:function(t,e,r){for(var n=0;n<t.properties.length;++n){var o=e.properties[n];if(o.value==e)return r(t,!0).getProp(it(o))}},UnaryExpression:function(t){return pt(t.operator)},UpdateExpression:function(){return q.num},BinaryExpression:function(t){return at(t.operator)?q.bool:q.num},AssignmentExpression:function(t,e,r){return r(t.left)},LogicalExpression:function(t,e,r){return r(t,!0)},ConditionalExpression:function(t,e,r){if(t.consequent==e||t.alternate==e)return r(t,!0)},CallExpression:function(t,e,r){for(var n=0;n<t.arguments.length;n++){if(t.arguments[n]==e){var o=r(t.callee).getFunctionType();if(o instanceof M)return o.args[n];break}}},ReturnStatement:function(t,e,r){var n=h.findNodeAround(e.sourceFile.ast,e.start-1,"Function");if(n){var o="FunctionDeclaration"!=n.node.type?r(n.node,!0).getFunctionType():n.node.scope.fnType;if(o)return o.retval.getType()}},VariableDeclarator:function(t,e,r){if(t.init==e)return r(t.id)}};Ft.NewExpression=Ft.CallExpression;var kt=!(u.typeFromContext=function(n,o){var t=u.parentNode(o.node,n),e=null;if(Ft.hasOwnProperty(t.type)){var r=Ft[t.type];e=r&&r(t,o.node,function(t,e){var r={node:t,state:o.state};return(e?u.typeFromContext(n,r):u.expressionType(r))||g})}return e||u.expressionType(o)});u.resetGuessing=function(t){kt=t},u.didGuess=function(){return kt},u.forAllPropertiesOf=function(t,e){t.gatherProperties(e,0)},u.findRefs=function(i,t,s,p,a){function e(t,e,r){var n=r[r.length-2];if(("MemberExpression"!=n.type||n.computed||!t.object)&&t.name==s&&(t!=i.id||"FunctionDeclaration"!=i.type)&&n.property!==t)for(var o=e;o;o=o.prev)if(o==p&&a(t,e,r),s in o.props)return}h.ancestor(i,{Identifier:e,VariablePattern:e},u.fullVisitor,t)};var It=h.make({Function:function(t,e,r){r(t.body,t.scope,t.expression?"Expression":"Statement")},Statement:function(t,e,r){r(t,t.scope||e)}});u.findPropRefs=function(t,e,n,o,i){for(;n&&!n.props[o]&&(!n.maybeProps||!n.maybeProps[o]);)n=n.proto;if(!n)throw new Error("Couldn't locate property in the base object type.");function r(t){for(;t&&t!=n;){if(t.props[o]||t.maybeProps&&t.maybeProps[o])return;t=t.proto}return t}h.simple(t,{MemberExpression:function(t,e){t.computed||it(t)!=o||r(jt(t.object,e).getType())&&i(t.property,e)},ObjectExpression:function(t,e){if(jt(t,e).getType()==n)for(var r=0;r<t.properties.length;++r)it(t.properties[r])==o&&i(t.properties[r].key,e)},MethodDefinition:function(t){it(t)==o&&t.value&&r(gt(t.value.scope).getType())&&i(t.key,t.value.scope)}},It,e)};var Dt=u.scopeAt=function(t,e,r){var n=h.findNodeAround(t,e,function(t,e){return e.scope});return n?n.node.scope:r||q.topScope};u.forAllLocalsAt=function(t,e,r,n){Dt(t,e,r).gatherProperties(n,0)},s=u.def=s.init({},u)});