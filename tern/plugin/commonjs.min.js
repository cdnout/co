!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("./modules")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","./modules"],e):e(tern,tern)}(function(n,e){"use strict";function o(e){var o=n.cx().definitions.commonjs;o.require.propagate(e.defProp("require"));var t=new n.Obj(o.Module.getProp("prototype").getType());t.propagate(e.defProp("module"));var r=new n.Obj(!0);t.origin=r.origin=e.origin,t.originNode=r.originNode=e.originNode,r.propagate(e.defProp("exports"));var l=e.exports=t.defProp("exports");r.propagate(l,95)}function l(e){if("CallExpression"==e.type&&"Identifier"==e.callee.type&&"require"==e.callee.name){var o=e.arguments[0];return o&&"Literal"==o.type&&"string"==typeof o.value?o.value:void 0}}function t(e){if("Literal"==e.type&&"string"==typeof e.value){var o=n.findExpressionAround(e.sourceFile.ast,null,e.end,null,function(e,o){return null!=l(o)});return o&&o.node.arguments[0]==e?e.value:void 0}}function r(e){if("Identifier"==e.type){var o,t=n.findExpressionAround(e.sourceFile.ast,null,e.end,null,"VariableDeclarator");if(t&&t.node.id==e){var r=t.node.init;return r&&null!=(o=l(r))?{name:o,prop:null}:r&&"MemberExpression"==r.type&&!r.computed&&null!=(o=l(r.object))?{name:o,prop:r.property.name}:void 0}}}n.registerFunction("require",function(e,o,t){if(!t||!t.length||"Literal"!=t[0].type||"string"!=typeof t[0].value)return n.ANull;var r=n.cx().parent,l=t[0].sourceFile.name,i=t[0].value;return r.mod.modules.resolveModule(i,l)}),e.registerPlugin("commonjs",function(e){e.loadPlugin("modules"),e.mod.modules.on("wrapScope",o),e.mod.modules.on("getExports",function(e,o){var t=e.scope.exports;(1<t.types.length||function(e){if(e)for(var o in e)return 1}(t.getObjType()))&&t.propagate(o)}),e.mod.modules.modNameTests.push(t),e.mod.modules.importTests.push(r),e.mod.modules.completableTypes.Identifier=!0,e.mod.modules.completableTypes.Literal=!0,e.addDefs(i)});var i={"!name":"commonjs","!define":{require:{"!type":"fn(id: string) -> !custom:require",resolve:{"!type":"fn() -> string","!url":"https://nodejs.org/api/globals.html#globals_require_resolve","!doc":"Use the internal require() machinery to look up the location of a module, but rather than loading the module, just return the resolved filename."},cache:{"!url":"https://nodejs.org/api/globals.html#globals_require_cache","!doc":"Modules are cached in this object when they are required. By deleting a key value from this object, the next require will reload the module."},extensions:{"!url":"https://nodejs.org/api/globals.html#globals_require_extensions","!doc":"Instruct require on how to handle certain file extensions."},"!url":"https://nodejs.org/api/globals.html#globals_require","!doc":"To require modules."},Module:{"!type":"fn()","!url":"https://nodejs.org/api/modules.html","!doc":"Node has a simple module loading system. In Node, files and modules are in one-to-one correspondence.",prototype:{exports:{"!type":"?","!url":"https://nodejs.org/api/modules.html#modules_module_exports","!doc":"The exports object is created by the Module system. Sometimes this is not acceptable, many want their module to be an instance of some class. To do this assign the desired export object to module.exports. For example suppose we were making a module called a.js"},require:{"!type":"require","!url":"https://nodejs.org/api/modules.html#modules_module_require_id","!doc":"The module.require method provides a way to load a module as if require() was called from the original module."},id:{"!type":"string","!url":"https://nodejs.org/api/modules.html#modules_module_id","!doc":"The identifier for the module. Typically this is the fully resolved filename."},filename:{"!type":"string","!url":"https://nodejs.org/api/modules.html#modules_module_filename","!doc":"The fully resolved filename to the module."},loaded:{"!type":"bool","!url":"https://nodejs.org/api/modules.html#modules_module_loaded","!doc":"Whether or not the module is done loading, or is in the process of loading."},parent:{"!type":"+Module","!url":"https://nodejs.org/api/modules.html#modules_module_parent","!doc":"The module that required this one."},children:{"!type":"[+Module]","!url":"https://nodejs.org/api/modules.html#modules_module_children","!doc":"The module objects required by this one."}}},module:{}},module:{"!type":"+Module","!url":"https://nodejs.org/api/globals.html#globals_module","!doc":"A reference to the current module. In particular module.exports is the same as the exports object. module isn't actually a global but rather local to each module."}}});