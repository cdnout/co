!function(t,e){"object"==typeof exports&&"object"==typeof module?e(exports,require("./infer")):"function"==typeof define&&define.amd?define(["exports","./infer"],e):e(t.tern||(t.tern={}),tern)}(this,function(t,c){"use strict";function s(t,e,r){this.origins=t,this.cx=c.cx(),this.server=r.server||this.cx.parent||{signal:function(){}},this.maxOrigin=-1/0;for(var n=0;n<t.length;++n)this.maxOrigin=Math.max(this.maxOrigin,this.cx.origins.indexOf(t[n]));this.output={"!name":e,"!define":{}},this.options=r,this.types=Object.create(null),this.altPaths=Object.create(null),this.patchUp=[],this.roots=Object.create(null)}function f(t){for(var e,r=1,n=0;-1!=(e=t.indexOf(".",n));)n=e+1,r+="!"==t.charAt(n)?10:1;return r}function h(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function u(t,e,r,n,i){var o=t.getType(!1);if(o){var a=t.origin||o.origin,p=!1;if(a){if(n.cx.origins.indexOf(a)>n.maxOrigin)return;p=n.isTarget(a)}var s=e?e+"."+r:r,h=o.path;if(!h||f(h)>f(s)){if(o instanceof c.Prim||(o.path=s),o.reached(s,n,!p)&&p){var u=n.types[h];u?(delete n.types[h],n.altPaths[h]=o):u={type:o},u.span=n.getSpan(t)||o!=t&&n.isTarget(o.origin)&&n.getSpan(o)||u.span,u.doc=t.doc||o!=t&&n.isTarget(o.origin)&&o.doc||u.doc,u.data=o.metaData,u.byName=null==u.byName?!!i:u.byName&&i,n.types[s]=u}}else p&&(n.altPaths[s]=o)}}function i(t,e,r,n){var i=t.getType();i&&u(i,e,r,n,!0)}function l(t,e){var r=t.proto.hasCtor.path;for(var n in r?t.nameOverride="+"+r:r=t.path,t.props)u(t.props[n],r,n,e)}function y(t,e){for(var r,n=e.output,i=e.output["!define"],o=0;o<t.length;++o){var a=t[o];r=r?r+"."+a:a;var p=e.types[r];"!"==a.charAt(0)||p&&p.byName?h(i,r)?n=i[r]:i[r]=n={}:n=h(n,t[o])?n[a]:n[a]={}}return n}function v(t,e,r){var n=o(e.type);if(n!=e.type.path&&"?"!=n)t["!type"]=n;else if(e.type.proto&&e.type.proto!=r.cx.protos.Object){var i=o(e.type.proto);"?"!=i&&(t["!proto"]=i)}e.span&&(t["!span"]=e.span),e.doc&&(t["!doc"]=e.doc),e.data&&(t["!data"]=e.data)}function g(t,e,r){var n=t.split("."),i=n.pop();if("!"!=i[0]){var o=r.types[n.join(".")],a=y(n,r);o&&o.type.constructor!=c.Obj||h(a,i)||(a[i]=e.nameOverride||e.path)}}t.condense=function(t,e,r){"string"==typeof t&&(t=[t]);var n=new s(t,e||t[0],r||{});for(var i in n.server.signal("preCondenseReach",n),n.cx.topScope.path="<top>",n.cx.topScope.reached("",n),n.roots)u(n.roots[i],null,i,n);for(var o=0;o<n.patchUp.length;++o)l(n.patchUp[o],n);for(var i in n.server.signal("postCondenseReach",n),n.types)v(y(i.split("."),n),n.types[i],n);for(var i in n.altPaths)g(i,n.altPaths[i],n);var a=!1;for(var p in n.output["!define"]){a=!0;break}return a||delete n.output["!define"],n.server.signal("postCondense",n),function t(e,r){if("object"!=typeof e)return e;var n=!1,i=!1;for(var o in e)"!type"==o?n=!0:i=!0,"!data"!=o&&(e[o]=t(e[o],r));if(n&&!i)return e["!type"];return r?d(e):e}(n.output,n.options.sortOutput)},s.prototype.isTarget=function(t){return-1<this.origins.indexOf(t)},s.prototype.getSpan=function(t){if(0==this.options.spans||!this.isTarget(t.origin))return null;if(t.span)return t.span;var e,r=this.cx.parent;if(!r||!t.originNode||!(e=r.findFile(t.origin)))return null;var n=t.originNode.start,i=t.originNode.end,o=e.asLineChar(n),a=e.asLineChar(i);return n+"["+o.line+":"+o.ch+"]-"+i+"["+a.line+":"+a.ch+"]"},c.Prim.prototype.reached=function(){return!0},c.Arr.prototype.reached=function(t,e,r){if(r)return!0;if(this.tuple)for(var n=0;n<this.tuple;n++)i(this.getProp(String(n)),t,String(n),e);else i(this.getProp("<i>"),t,"<i>",e);return!0},c.Fn.prototype.reached=function(t,e,r){if(c.Obj.prototype.reached.call(this,t,e,r),!r){for(var n=0;n<this.args.length;++n)i(this.args[n],t,"!"+n,e);i(this.retval,t,"!ret",e)}return!0},c.Obj.prototype.reached=function(t,e,r){if(!(!(n=this).proto||n instanceof c.Fn||n.proto==c.cx().protos.Object||!n.proto.hasCtor||n.hasCtor||this.condenseForceInclude))return-1==e.patchUp.indexOf(this)&&e.patchUp.push(this),!0;var n;this.proto&&!r&&u(this.proto,t,"!proto",e);var i=!1;for(var o in this.props)u(this.props[o],t,o,e),i=!0;return!!(i||this.condenseForceInclude||this instanceof c.Fn)||!(this.nameOverride="?")};var n=[];function o(t){var e=t instanceof c.Type;if(e){if(-1<n.indexOf(t))return t.path||"?";n.push(t)}var r=t.typeName();return e&&n.pop(),r}function d(t){var e=[],r={};for(var n in t)e.push(n);e.sort();for(var i=0;i<e.length;++i){r[n=e[i]]=t[n]}return r}c.AVal.prototype.typeName=function(){if(0==this.types.length)return"?";if(1==this.types.length)return o(this.types[0]);var t=c.simplifyTypes(this.types);if(2<t.length)return"?";for(var e=[],r=0;r<t.length;r++)e.push(o(t[r]));return e.join("|")},c.ANull.typeName=function(){return"?"},c.Prim.prototype.typeName=function(){return this.name},c.Sym.prototype.typeName=function(){return this.asPropName},c.Arr.prototype.typeName=function(){if(!this.tuple)return"["+o(this.getProp("<i>"))+"]";for(var t=[],e=0;e<this.tuple;e++)t.push(o(this.getProp(String(e))));return"["+t.join(", ")+"]"},c.Fn.prototype.typeName=function(){for(var t=this.generator?"fn*(":"fn(",e=0;e<this.args.length;++e){e&&(t+=", ");var r=this.argNames[e];r&&"?"!=r&&(t+=r+": "),t+=o(this.args[e])}return t+=")",this.computeRetSource?t+=" -> "+this.computeRetSource:this.retval.isEmpty()||(t+=" -> "+o(this.retval)),t},c.Obj.prototype.typeName=function(){return this.nameOverride?this.nameOverride:this.path?this.path:"?"}});