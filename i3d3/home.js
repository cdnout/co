"use strict";if(!i3d3){var i3d3={}}i3d3=(function(l,i,d){var k={};k.zoom={};k.xscale={};k.yscale={};function m(o,n){return _.filter(o,function(p){return !_.isUndefined(p[n])})}function f(n){return _.flatten(n,"shallow")}function e(n){return f(_.pluck(n,"values"))}function c(o,p){var n=new Date();n.setTime(o.getTime()+p);return n}function h(n){return n!=null}function b(D,z,w,y,F,B){function o(G,H,I){if(G[H].errors){return[G[H].bins[I]-G[H].errors[I][0],G[H].bins[I]+G[H].errors[I][1]]}else{return[G[H].bins[I],G[H].bins[I]]}}var n=f(_.map(_.range(D.length),function(G){return _.map(_.range(D[G].bins.length),function(H){return o(D,G,H)})}));var E=_.map(n,_.first);var t=_.map(n,_.last);var s=_.pluck(f(_.pluck(z,"values")),"y");var q=_.pluck(f(_.pluck(w,"values")),"y");var r=_.flatten(_.pluck(y,"yrange"));var u=f([E,t,s,q,r]);var A=_.min(u);var C=_.max(u);var x=C-A;var p=A-x/10;var v=C+x/10;return[F?B:p,v]}function g(p,o,n,q){var s=e(o.concat(n));var r=_.flatten([_.pluck(p,"range"),_.pluck(s,"x"),_.pluck(q,"xrange")]);return d3.extent(r)}function a(o){var n=$("#"+o);return[n.width(),n.height()]}function j(E){var H,t,Y,M,z,y,x,R,s=_.filter(E.data,function(w){return w.type==="points"}),A=_.filter(E.data,function(w){return w.type==="lines"}),K=_.filter(E.data,function(w){return w.type==="bars"}),G=_.filter(E.data,function(w){return w.type==="range"}),W=h(E.padding_left)&&E.padding_left||50,O=h(E.padding_right)&&E.padding_right||8,v=h(E.padding_bottom)&&E.padding_bottom||50,J=h(E.padding_top)&&E.padding_top||8,U=0.5,u=E.yscale=="log",F=b(K,s,A,G,u,U),D=g(K,s,A,G),S=h(E.size)&&E.size[0]||a(E.div)[0],Z=h(E.size)&&E.size[1]||a(E.div)[1],p=_.every(D,_.isDate),L=(p?d3.time.scale:d3.scale.linear)().domain(D).range([W,S-O]),n=(u?d3.scale.log:d3.scale.linear)().domain(F).range([Z-v,J]),B=m(E.extras,"vbar"),r=m(E.extras,"hbar"),C=m(E.extras,"region"),X=m(E.extras,"note"),N=m(E.extras,"line"),P=m(E.extras,"ellipse"),o=d3.select("#"+E.div).append("svg").attr("width",S).attr("height",Z);var q=function(ae,af,ad,ac){var w;if(p){w=c(af,(ad-af)*ac/ae)}else{w=af+(ad-af)*ac/ae}return L(w)};function T(w){var ac=(w[1].getTime()-w[0].getTime())/1000;if(ac<10){return"%H:%M:%S.%L"}if(ac<600){return"%H:%M:%S"}if(ac<86400){return"%H:%M"}if(ac<31*86400){return"%b, %_d %_Hh"}return"%Y-%m-%d"}H=d3.svg.axis().scale(L).orient("bottom").ticks(5).tickFormat(p?d3.time.format(T(D)):d);t=d3.svg.axis().scale(n).orient("left").ticks(3);o.append("g").attr("class","x axis").attr("transform","translate(0,"+(Z-v)+")").call(H);o.append("g").attr("class","y axis").attr("transform","translate("+W+",0)").call(t);o.append("text").attr("class","label").attr("text-anchor","end").attr("x",S-O+5).attr("y",Z-10).attr("style",E.label_style||"").text(E.xlabel);z=J;M=10;o.append("text").attr("class","label").attr("text-anchor","end").attr("x",M).attr("y",z).text(E.ylabel).attr("style",E.label_style||"").attr("transform",function(ad,ac,w){return"rotate(-90 "+M+", "+z+")"});if(E.title){o.append("text").attr("class","title").attr("x",S/2).attr("y",J-10).text(E.title)}var Q=o.append("clipPath").attr("id","clip_"+E.div).append("rect").attr("x",W).attr("y",J).attr("width",S-(W+O)).attr("height",Z-(J+v));var ab=o.append("g").attr("clip-path","url(#clip_"+E.div+")");_.each(C,function(w,ac){ab.append("svg:rect").attr("id","region-"+E.div+"-"+ac)});_.each(K,function(w,ac){_.each(w.bins,function(ae,ad){ab.append("rect").attr("id","bar-"+E.div+"-"+ac+"-"+ad)});_.each(w.errors,function(ae,ad){ab.append("line").attr("id","bar-error-"+E.div+"-"+ac+"-"+ad)})});_.each(A,function(ac,w){ab.append("path").attr("id","path-"+E.div+"-"+w);_.each(ac.errors,function(ae,ad){ab.append("line").attr("id","line-error-"+E.div+"-"+w+"-"+ad)})});_.each(s,function(ac,w){_.each(ac.errors,function(ae,ad){ab.append("line").attr("id","point-error-"+E.div+"-"+w+"-"+ad)});_.each(ac.values,function(ad,ae){ab.append("circle").attr("id","point-"+E.div+"-"+w+"-"+ae)})});_.each(B,function(w,ac){ab.append("line").attr("id","vbar-"+E.div+"-"+ac)});_.each(r,function(w,ac){ab.append("line").attr("id","hbar-"+E.div+"-"+ac)});_.each(N,function(w,ac){ab.append("line").attr("id","line-"+E.div+"-"+ac)});_.each(P,function(w,ac){ab.append("ellipse").attr("id","ellipse-"+E.div+"-"+ac)});_.each(X,function(w,ac){ab.append("text").attr("id","text-"+E.div+"-"+ac)});function aa(){o.select(".x.axis").call(H);o.select(".y.axis").call(t);_.each(C,function(ac,w){ab.select("#region-"+E.div+"-"+w).attr("x",L(ac.region.min)).attr("y",J).attr("width",L(ac.region.max)-L(ac.region.min)).attr("height",Z).attr("fill",ac.region.color)});_.each(K,function(w,ac){x=w.range[0];R=w.range[1];_.each(w.bins,function(ae,ad){if(u&&ae===0){return}ab.select("#bar-"+E.div+"-"+ac+"-"+ad).attr("x",q(w.bins.length,x,R,ad)).attr("y",n(ae)).attr("fill",w.color||"grey").attr("width",Math.max(0,((L(R)-L(x))/w.bins.length-0.1))).attr("height",Math.max(0,Z-(v+n(ae)))).attr("stroke",w.color||"grey").attr("opacity",w.opacity||1)});_.each(w.errors,function(ae,ad){ab.select("#bar-error-"+E.div+"-"+ac+"-"+ad).attr("x1",q(w.bins.length,x,R,ad+0.5)).attr("x2",q(w.bins.length,x,R,ad+0.5)).attr("y1",n(Math.max(u?U:0,w.bins[ad]-ae[0]))).attr("y2",n(w.bins[ad]+ae[1])).style("stroke",w.error_color||"grey")})});y=d3.svg.line().x(function(w){return L(w.x)}).y(function(w){return n(w.y)});_.each(A,function(ac,w){ab.select("#path-"+E.div+"-"+w).attr("d",y(ac.values)).attr("fill","none").attr("stroke",ac.color||"grey").attr("stroke-width",ac.width||1);_.each(ac.errors,function(ae,ad){ab.select("#line-error-"+E.div+"-"+w+"-"+ad).attr("x1",L(ac.values[ad].x)).attr("x2",L(ac.values[ad].x)).attr("y1",n(Math.max(u?1:0,ac.values[ad].y-ae[0]))).attr("y2",n(Math.max(ac.values[ad].y+ae[1]))).style("stroke",ac.error_color||"grey")})});_.each(s,function(ac,w){_.each(ac.errors,function(ae,ad){ab.select("#point-error-"+E.div+"-"+w+"-"+ad).attr("x1",L(ac.values[ad].x)).attr("x2",L(ac.values[ad].x)).attr("y1",n(Math.max(u?1:0,ac.values[ad].y-ae[0]))).attr("y2",n(Math.max(ac.values[ad].y+ae[1]))).style("stroke",ac.error_color||"grey")});_.each(ac.values,function(ad,ae){ab.select("#point-"+E.div+"-"+w+"-"+ae).attr("cx",L(ad.x)).attr("cy",n(ad.y)).attr("r",ac.size||4).attr("fill",ac.color||"grey")})});_.each(B,function(w,ac){ab.select("#vbar-"+E.div+"-"+ac).attr("x1",L(w.vbar.pos)).attr("y1",J).attr("x2",L(w.vbar.pos)).attr("y2",Z+J).style("stroke",w.vbar.color)});_.each(r,function(ac,w){ab.select("#hbar-"+E.div+"-"+w).attr("x1",W).attr("y1",n(ac.hbar.pos)).attr("x2",W+S).attr("y2",n(ac.hbar.pos)).style("stroke",ac.hbar.color)});_.each(P,function(af,ac){var w,ag,ae,ad;if(af.ellipse.units==="pixels"){w=af.ellipse.x;ag=af.ellipse.y;ae=af.ellipse.rx;ad=af.ellipse.ry}else{w=L(af.ellipse.x);ag=n(af.ellipse.y);ae=L(af.ellipse.rx)-L(0);ad=n(0)-n(af.ellipse.ry)}ab.select("#ellipse-"+E.div+"-"+ac).attr("cx",w).attr("cy",ag).attr("rx",ae).attr("ry",ad).style("stroke",af.ellipse.color||"grey").style("stroke-width",af.ellipse.width).style("fill",af.ellipse.fill||"None")});_.each(N,function(w,ac){ab.select("#line-"+E.div+"-"+ac).attr("x1",L(w.line.x0)).attr("y1",n(w.line.y0)).attr("x2",L(w.line.x1)).attr("y2",n(w.line.y1)).style("stroke",w.line.color||"grey")});_.each(X,function(w,ac){var ae,ad;if(w.note.units==="pixels"){ae=w.note.x;ad=w.note.y}else{ae=L(w.note.x);ad=n(w.note.y)}ab.select("#text-"+E.div+"-"+ac).attr("class","note").attr("x",ae).attr("y",ad).attr("stroke",w.note.color).text(w.note.text).attr("style",w.note.style||"")})}aa();k.zoom[E.div]=d3.behavior.zoom();k.zoom[E.div].x(L);k.zoom[E.div].scaleExtent([0.01,100]);k.zoom[E.div].on("zoom",aa);k.xscale[E.div]=L;k.yscale[E.div]=n;o.append("svg:rect").attr("class","pane").attr("id","pane-"+E.div).attr("width",S-(W+O)).attr("height",Z-(J+v)).attr("cursor","move").attr("fill","none").attr("pointer-events","all").attr("x",W).attr("y",J).on("mouseover",function(){k.hover_div=E.div}).call(k.zoom[E.div]);function I(){if(!k.hover_div){return}if(d3.event.shiftKey){k.zoom[k.hover_div].x(d3.scale.linear());k.zoom[k.hover_div].y(k.yscale[k.hover_div])}}function V(){if(!k.hover_div){return}k.zoom[k.hover_div].y(d3.scale.linear());k.zoom[k.hover_div].x(k.xscale[k.hover_div])}d3.select("body").on("keydown",I);d3.select("body").on("keyup",V);return o}k.plot=j;k.add_time_delta=c;k.existy=h;return k}(i3d3,this));