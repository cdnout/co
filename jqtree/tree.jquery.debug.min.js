var jqtree=function(e,t){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function n(o){if(o&&o.__esModule)return o;var n=Object.create(null);return o&&Object.keys(o).forEach(function(e){var t;"default"!==e&&(t=Object.getOwnPropertyDescriptor(o,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return o[e]}}))}),n.default=o,Object.freeze(n)}var r=o(t),i=n(t),s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var l,d=function(){return(d=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};(t=l=l||{})[t.Before=1]="Before",t[t.After=2]="After",t[t.Inside=3]="Inside",t[t.None=4]="None";function h(e){for(var t in p)if(Object.prototype.hasOwnProperty.call(p,t)&&p[t]===e)return t;return""}var p={before:l.Before,after:l.After,inside:l.Inside,none:l.None},u=(c.prototype.setData=function(e){if(e){if("string"==typeof e)this.name=e;else if("object"==typeof e)for(var t in e){var o;Object.prototype.hasOwnProperty.call(e,t)&&(o=e[t],"label"===t||"name"===t?"string"==typeof o&&(this.name=o):"children"!==t&&"parent"!==t&&(this[t]=o))}}else;},c.prototype.loadFromData=function(e){this.removeChildren();for(var t=0,o=e;t<o.length;t++){var n=o[t],r=this.createNode(n);this.addChild(r),"object"==typeof n&&n.children&&n.children instanceof Array&&(0===n.children.length?r.isEmptyFolder=!0:r.loadFromData(n.children))}return this},c.prototype.addChild=function(e){this.children.push(e),e.setParent(this)},c.prototype.addChildAtPosition=function(e,t){this.children.splice(t,0,e),e.setParent(this)},c.prototype.removeChild=function(e){e.removeChildren(),this.doRemoveChild(e)},c.prototype.getChildIndex=function(e){return this.children.indexOf(e)},c.prototype.hasChildren=function(){return 0!==this.children.length},c.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand},c.prototype.iterate=function(i){var s=function(e,t){if(e.children)for(var o=0,n=e.children;o<n.length;o++){var r=n[o];i(r,t)&&r.hasChildren()&&s(r,t+1)}};s(this,0)},c.prototype.moveNode=function(e,t,o){if(!e.parent||e.isParentOf(t))return!1;switch(e.parent.doRemoveChild(e),o){case l.After:return!!t.parent&&(t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)+1),!0);case l.Before:return!!t.parent&&(t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)),!0);case l.Inside:return t.addChildAtPosition(e,0),!0;default:return!1}},c.prototype.getData=function(e){void 0===e&&(e=!1);var r=function(e){return e.map(function(e){var t,o,n={};for(t in e)-1===["parent","children","element","idMapping","load_on_demand","nodeClass","tree","isEmptyFolder"].indexOf(t)&&Object.prototype.hasOwnProperty.call(e,t)&&(o=e[t],n[t]=o);return e.hasChildren()&&(n.children=r(e.children)),n})};return r(e?[this]:this.children)},c.prototype.getNodeByName=function(t){return this.getNodeByCallback(function(e){return e.name===t})},c.prototype.getNodeByNameMustExist=function(t){var e=this.getNodeByCallback(function(e){return e.name===t});if(!e)throw"Node with name "+t+" not found";return e},c.prototype.getNodeByCallback=function(t){var o=null;return this.iterate(function(e){return!o&&(!t(e)||(o=e,!1))}),o},c.prototype.addAfter=function(e){if(this.parent){var t=this.createNode(e),o=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(t,o+1),"object"==typeof e&&e.children&&e.children instanceof Array&&e.children.length&&t.loadFromData(e.children),t}return null},c.prototype.addBefore=function(e){if(this.parent){var t=this.createNode(e),o=this.parent.getChildIndex(this);return this.parent.addChildAtPosition(t,o),"object"==typeof e&&e.children&&e.children instanceof Array&&e.children.length&&t.loadFromData(e.children),t}return null},c.prototype.addParent=function(e){if(this.parent){var t=this.createNode(e);this.tree&&t.setParent(this.tree);for(var e=this.parent,o=0,n=e.children;o<n.length;o++){var r=n[o];t.addChild(r)}return e.children=[],e.addChild(t),t}return null},c.prototype.remove=function(){this.parent&&(this.parent.removeChild(this),this.parent=null)},c.prototype.append=function(e){var t=this.createNode(e);return this.addChild(t),"object"==typeof e&&e.children&&e.children instanceof Array&&e.children.length&&t.loadFromData(e.children),t},c.prototype.prepend=function(e){var t=this.createNode(e);return this.addChildAtPosition(t,0),"object"==typeof e&&e.children&&e.children instanceof Array&&e.children.length&&t.loadFromData(e.children),t},c.prototype.isParentOf=function(e){for(var t=e.parent;t;){if(t===this)return!0;t=t.parent}return!1},c.prototype.getLevel=function(){for(var e=0,t=this;t.parent;)e+=1,t=t.parent;return e},c.prototype.getNodeById=function(e){return this.idMapping.get(e)||null},c.prototype.addNodeToIndex=function(e){null!=e.id&&this.idMapping.set(e.id,e)},c.prototype.removeNodeFromIndex=function(e){null!=e.id&&this.idMapping.delete(e.id)},c.prototype.removeChildren=function(){var o=this;this.iterate(function(e){var t;return null!==(t=o.tree)&&void 0!==t&&t.removeNodeFromIndex(e),!0}),this.children=[]},c.prototype.getPreviousSibling=function(){if(this.parent){var e=this.parent.getChildIndex(this)-1;return 0<=e?this.parent.children[e]:null}return null},c.prototype.getNextSibling=function(){if(this.parent){var e=this.parent.getChildIndex(this)+1;return e<this.parent.children.length?this.parent.children[e]:null}return null},c.prototype.getNodesByProperty=function(t,o){return this.filter(function(e){return e[t]===o})},c.prototype.filter=function(t){var o=[];return this.iterate(function(e){return t(e)&&o.push(e),!0}),o},c.prototype.getNextNode=function(e){if(void 0===e&&(e=!0),e&&this.hasChildren()&&this.is_open)return this.children[0];if(this.parent){e=this.getNextSibling();return e||this.parent.getNextNode(!1)}return null},c.prototype.getPreviousNode=function(){if(this.parent){var e=this.getPreviousSibling();return e?e.hasChildren()&&e.is_open?e.getLastChild():e:this.getParent()}return null},c.prototype.getParent=function(){return this.parent&&this.parent.parent?this.parent:null},c.prototype.getLastChild=function(){if(this.hasChildren()){var e=this.children[this.children.length-1];return e.hasChildren()&&e.is_open?e.getLastChild():e}return null},c.prototype.initFromData=function(e){var t,i=this,o=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t],r=i.createNode();r.initFromData(n),i.addChild(r)}};t=e,i.setData(t),"object"==typeof t&&t.children&&t.children instanceof Array&&t.children.length&&o(t.children)},c.prototype.setParent=function(e){this.parent=e,this.tree=e.tree,null!==(e=this.tree)&&void 0!==e&&e.addNodeToIndex(this)},c.prototype.doRemoveChild=function(e){var t;this.children.splice(this.getChildIndex(e),1),null!==(t=this.tree)&&void 0!==t&&t.removeNodeFromIndex(e)},c.prototype.getNodeClass=function(){var e;return this.nodeClass||(null===(e=null==this?void 0:this.tree)||void 0===e?void 0:e.nodeClass)||c},c.prototype.createNode=function(e){return new(this.getNodeClass())(e)},c);function c(e,t,o){void 0===e&&(e=null),void 0===t&&(t=!1),void 0===o&&(o=c),this.name="",this.isEmptyFolder=!1,this.load_on_demand=!1,this.setData(e),this.children=[],this.parent=null,t&&(this.idMapping=new Map,(this.tree=this).nodeClass=o)}var f=r.default||i,g=(m.prototype.mouseCapture=function(e){e=f(e.target);if(!this.mustCaptureElement(e))return null;if(this.treeWidget.options.onIsMoveHandle&&!this.treeWidget.options.onIsMoveHandle(e))return null;e=this.treeWidget._getNodeElement(e);return e&&this.treeWidget.options.onCanMove&&(this.treeWidget.options.onCanMove(e.node)||(e=null)),this.currentItem=e,null!=this.currentItem},m.prototype.mouseStart=function(e){if(!this.currentItem||void 0===e.pageX||void 0===e.pageY)return!1;this.refresh();var t=f(e.target).offset(),o=t?t.left:0,n=t?t.top:0,t=this.currentItem.node;return this.dragElement=new _(t.name,e.pageX-o,e.pageY-n,this.treeWidget.element,null===(n=this.treeWidget.options.autoEscape)||void 0===n||n),this.isDragging=!0,this.positionInfo=e,this.currentItem.$element.addClass("jqtree-moving"),!0},m.prototype.mouseDrag=function(e){if(!this.currentItem||!this.dragElement||void 0===e.pageX||void 0===e.pageY)return!1;this.dragElement.move(e.pageX,e.pageY),this.positionInfo=e;var t=this.findHoveredArea(e.pageX,e.pageY);return t&&this.canMoveToArea(t)?(t.node.isFolder()||this.stopOpenFolderTimer(),this.hoveredArea!==t&&(this.hoveredArea=t,this.mustOpenFolderTimer(t)?this.startOpenFolderTimer(t.node):this.stopOpenFolderTimer(),this.updateDropHint())):(this.removeDropHint(),this.stopOpenFolderTimer(),this.hoveredArea=t),t||this.treeWidget.options.onDragMove&&this.treeWidget.options.onDragMove(this.currentItem.node,e.originalEvent),!0},m.prototype.mouseStop=function(e){this.moveItem(e),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas();var t=this.currentItem;return this.currentItem&&(this.currentItem.$element.removeClass("jqtree-moving"),this.currentItem=null),this.isDragging=!1,this.positionInfo=null,!this.hoveredArea&&t&&this.treeWidget.options.onDragStop&&this.treeWidget.options.onDragStop(t.node,e.originalEvent),!1},m.prototype.refresh=function(){this.removeHitAreas(),this.currentItem&&(this.generateHitAreas(),this.currentItem=this.treeWidget._getNodeElementForNode(this.currentItem.node),this.isDragging&&this.currentItem.$element.addClass("jqtree-moving"))},m.prototype.generateHitAreas=function(){var e;this.currentItem?(e=new N(this.treeWidget.tree,this.currentItem.node,this.getTreeDimensions().bottom),this.hitAreas=e.generate()):this.hitAreas=[]},m.prototype.mustCaptureElement=function(e){return!e.is("input,select,textarea")},m.prototype.canMoveToArea=function(e){if(!this.treeWidget.options.onCanMoveTo)return!0;if(!this.currentItem)return!1;var t=h(e.position);return this.treeWidget.options.onCanMoveTo(this.currentItem.node,e.node,t)},m.prototype.removeHitAreas=function(){this.hitAreas=[]},m.prototype.clear=function(){this.dragElement&&(this.dragElement.remove(),this.dragElement=null)},m.prototype.removeDropHint=function(){this.previousGhost&&this.previousGhost.remove()},m.prototype.removeHover=function(){this.hoveredArea=null},m.prototype.findHoveredArea=function(e,t){var o=this.getTreeDimensions();if(e<o.left||t<o.top||e>o.right||t>o.bottom)return null;for(var n=0,r=this.hitAreas.length;n<r;){var i=n+r>>1,s=this.hitAreas[i];if(t<s.top)r=i;else{if(!(t>s.bottom))return s;n=1+i}}return null},m.prototype.mustOpenFolderTimer=function(e){var t=e.node;return t.isFolder()&&!t.is_open&&e.position===l.Inside},m.prototype.updateDropHint=function(){var e;this.hoveredArea&&(this.removeDropHint(),e=this.treeWidget._getNodeElementForNode(this.hoveredArea.node),this.previousGhost=e.addDropHint(this.hoveredArea.position))},m.prototype.startOpenFolderTimer=function(e){var t=this;this.stopOpenFolderTimer(),this.openFolderTimer=window.setTimeout(function(){t.treeWidget._openNode(e,t.treeWidget.options.slide,function(){t.refresh(),t.updateDropHint()})},this.treeWidget.options.openFolderDelay)},m.prototype.stopOpenFolderTimer=function(){this.openFolderTimer&&(clearTimeout(this.openFolderTimer),this.openFolderTimer=null)},m.prototype.moveItem=function(e){var t,o,n,r,i,s=this;this.currentItem&&this.hoveredArea&&this.hoveredArea.position!==l.None&&this.canMoveToArea(this.hoveredArea)&&(t=this.currentItem.node,o=this.hoveredArea.node,n=this.hoveredArea.position,r=t.parent,n===l.Inside&&(this.hoveredArea.node.is_open=!0),i=function(){s.treeWidget.tree.moveNode(t,o,n),s.treeWidget.element.empty(),s.treeWidget._refreshElements(null)},this.treeWidget._triggerEvent("tree.move",{move_info:{moved_node:t,target_node:o,position:h(n),previous_parent:r,do_move:i,original_event:e.originalEvent}}).isDefaultPrevented()||i())},m.prototype.getTreeDimensions=function(){var e=this.treeWidget.element.offset();if(e){var t=this.treeWidget.element,o=t.width()||0,n=t.height()||0,t=e.left+this.treeWidget._getScrollLeft();return{left:t,top:e.top,right:t+o,bottom:e.top+n+16}}return{left:0,top:0,right:0,bottom:0}},m);function m(e){this.treeWidget=e,this.hoveredArea=null,this.hitAreas=[],this.isDragging=!1,this.currentItem=null,this.positionInfo=null}v.prototype.iterate=function(){var i=this,s=!0,a=function(o,e){var n,t=(o.is_open||!o.element)&&o.hasChildren(),r=null;if(o.element){if(!(r=f(o.element)).is(":visible"))return;s&&(i.handleFirstNode(o),s=!1),o.hasChildren()?o.is_open?i.handleOpenFolder(o,r)||(t=!1):i.handleClosedFolder(o,e,r):i.handleNode(o,e,r)}t&&(n=o.children.length,o.children.forEach(function(e,t){a(o.children[t],t===n-1?null:o.children[t+1])}),o.is_open&&r&&i.handleAfterOpenFolder(o,e))};a(this.tree,null)},t=v;function v(e){this.tree=e}var y,N=(a(S,y=t),S.prototype.generate=function(){return this.positions=[],this.lastTop=0,this.iterate(),this.generateHitAreas(this.positions)},S.prototype.generateHitAreas=function(e){for(var t=-1,o=[],n=[],r=0,i=e;r<i.length;r++){var s=i[r];s.top!==t&&o.length&&(o.length&&this.generateHitAreasForGroup(n,o,t,s.top),t=s.top,o=[]),o.push(s)}return this.generateHitAreasForGroup(n,o,t,this.treeBottom),n},S.prototype.handleOpenFolder=function(e,t){return e!==this.currentNode&&(e.children[0]!==this.currentNode&&this.addPosition(e,l.Inside,this.getTop(t)),!0)},S.prototype.handleClosedFolder=function(e,t,o){o=this.getTop(o);e===this.currentNode?this.addPosition(e,l.None,o):(this.addPosition(e,l.Inside,o),t!==this.currentNode&&this.addPosition(e,l.After,o))},S.prototype.handleFirstNode=function(e){e!==this.currentNode&&this.addPosition(e,l.Before,this.getTop(f(e.element)))},S.prototype.handleAfterOpenFolder=function(e,t){e===this.currentNode||t===this.currentNode?this.addPosition(e,l.None,this.lastTop):this.addPosition(e,l.After,this.lastTop)},S.prototype.handleNode=function(e,t,o){o=this.getTop(o);e===this.currentNode?this.addPosition(e,l.None,o):this.addPosition(e,l.Inside,o),t===this.currentNode||e===this.currentNode?this.addPosition(e,l.None,o):this.addPosition(e,l.After,o)},S.prototype.getTop=function(e){e=e.offset();return e?e.top:0},S.prototype.addPosition=function(e,t,o){t={top:o,bottom:0,node:e,position:t};this.positions.push(t),this.lastTop=o},S.prototype.generateHitAreasForGroup=function(e,t,o,n){for(var r=Math.min(t.length,4),i=Math.round((n-o)/r),s=o,a=0;a<r;){var l=t[a];e.push({top:s,bottom:s+i,node:l.node,position:l.position}),s+=i,a+=1}},S);function S(e,t,o){e=y.call(this,e)||this;return e.currentNode=t,e.treeBottom=o,e}var _=(D.prototype.move=function(e,t){this.$element.offset({left:e-this.offsetX,top:t-this.offsetY})},D.prototype.remove=function(){this.$element.remove()},D);function D(e,t,o,n,r){this.offsetX=t,this.offsetY=o,this.$element=f("<span>").addClass("jqtree-title jqtree-dragging"),r?this.$element.text(e):this.$element.html(e),this.$element.css("position","absolute"),n.append(this.$element)}function I(e){return e?"true":"false"}var C=(E.prototype.render=function(e){e&&e.parent?this.renderFromNode(e):this.renderFromRoot()},E.prototype.renderFromRoot=function(){var e=this.treeWidget.element;e.empty(),this.createDomElements(e[0],this.treeWidget.tree.children,!0,1)},E.prototype.renderFromNode=function(e){var t=jQuery(e.element),o=this.createLi(e,e.getLevel());this.attachNodeData(e,o),t.after(o),t.remove(),e.children&&this.createDomElements(o,e.children,!1,e.getLevel()+1)},E.prototype.createDomElements=function(e,t,o,n){var r=this.createUl(o);e.appendChild(r);for(var i=0,s=t;i<s.length;i++){var a=s[i],l=this.createLi(a,n);r.appendChild(l),this.attachNodeData(a,l),a.hasChildren()&&this.createDomElements(l,a.children,!1,n+1)}},E.prototype.attachNodeData=function(e,t){e.element=t,jQuery(t).data("node",e)},E.prototype.createUl=function(e){var t,o;e?(t="jqtree-tree",o="tree",this.treeWidget.options.rtl&&(t+=" jqtree-rtl")):(t="",o="group"),this.treeWidget.options.dragAndDrop&&(t+=" jqtree-dnd");e=document.createElement("ul");return e.className="jqtree_common "+t,e.setAttribute("role",o),e},E.prototype.createLi=function(e,t){var o=Boolean(this.treeWidget.selectNodeHandler.isNodeSelected(e)),t=e.isFolder()||e.isEmptyFolder&&this.treeWidget.options.showEmptyFolder?this.createFolderLi(e,t,o):this.createNodeLi(e,t,o);return this.treeWidget.options.onCreateLi&&this.treeWidget.options.onCreateLi(e,jQuery(t),o),t},E.prototype.createFolderLi=function(e,t,o){var n=this.getButtonClasses(e),r=this.getFolderClasses(e,o),i=e.is_open?this.openedIconElement:this.closedIconElement,s=document.createElement("li");s.className="jqtree_common "+r,s.setAttribute("role","presentation");var a=document.createElement("div");a.className="jqtree-element jqtree_common",a.setAttribute("role","presentation"),s.appendChild(a);r=document.createElement("a");return r.className=n,r.appendChild(i.cloneNode(!0)),r.setAttribute("role","presentation"),r.setAttribute("aria-hidden","true"),this.treeWidget.options.buttonLeft&&a.appendChild(r),a.appendChild(this.createTitleSpan(e.name,t,o,e.is_open,!0)),this.treeWidget.options.buttonLeft||a.appendChild(r),s},E.prototype.createNodeLi=function(e,t,o){var n=["jqtree_common"];o&&n.push("jqtree-selected");var r=n.join(" "),n=document.createElement("li");n.className=r,n.setAttribute("role","presentation");r=document.createElement("div");return r.className="jqtree-element jqtree_common",r.setAttribute("role","presentation"),n.appendChild(r),r.appendChild(this.createTitleSpan(e.name,t,o,e.is_open,!1)),n},E.prototype.createTitleSpan=function(e,t,o,n,r){var i=document.createElement("span"),s="jqtree-title jqtree_common";return r&&(s+=" jqtree-title-folder"),i.className=s,i.setAttribute("role","treeitem"),i.setAttribute("aria-level",""+t),i.setAttribute("aria-selected",I(o)),i.setAttribute("aria-expanded",I(n)),!o||void 0!==(o=this.treeWidget.options.tabIndex)&&i.setAttribute("tabindex",""+o),this.treeWidget.options.autoEscape?i.textContent=e:i.innerHTML=e,i},E.prototype.getButtonClasses=function(e){var t=["jqtree-toggler","jqtree_common"];return e.is_open||t.push("jqtree-closed"),this.treeWidget.options.buttonLeft?t.push("jqtree-toggler-left"):t.push("jqtree-toggler-right"),t.join(" ")},E.prototype.getFolderClasses=function(e,t){var o=["jqtree-folder"];return e.is_open||o.push("jqtree-closed"),t&&o.push("jqtree-selected"),e.is_loading&&o.push("jqtree-loading"),o.join(" ")},E.prototype.createButtonElement=function(e){if("string"!=typeof e)return jQuery(e)[0];var t=document.createElement("div");return t.innerHTML=e,document.createTextNode(t.innerHTML)},E);function E(e){this.treeWidget=e,this.openedIconElement=this.createButtonElement(e.options.openedIcon||"+"),this.closedIconElement=this.createButtonElement(e.options.closedIcon||"-")}var j=(F.prototype.loadFromUrl=function(e,t,o){var n,r,i=this;e&&(n=this.getDomElement(t),this.addLoadingClass(n),this.notifyLoading(!0,t,n),r=function(){i.removeLoadingClass(n),i.notifyLoading(!1,t,n)},this.submitRequest(e,function(e){r(),i.treeWidget.loadData(i.parseData(e),t),o&&"function"==typeof o&&o()},function(e){r(),i.treeWidget.options.onLoadFailed&&i.treeWidget.options.onLoadFailed(e)}))},F.prototype.addLoadingClass=function(e){e&&e.addClass("jqtree-loading")},F.prototype.removeLoadingClass=function(e){e&&e.removeClass("jqtree-loading")},F.prototype.getDomElement=function(e){return e?jQuery(e.element):this.treeWidget.element},F.prototype.notifyLoading=function(e,t,o){this.treeWidget.options.onLoading&&this.treeWidget.options.onLoading(e,t,o),this.treeWidget._triggerEvent("tree.loading_data",{isLoading:e,node:t,$el:o})},F.prototype.submitRequest=function(e,t,o){o=d({method:"GET",cache:!1,dataType:"json",success:t,error:o},"string"==typeof e?{url:e}:e);o.method=(null===(e=o.method)||void 0===e?void 0:e.toUpperCase())||"GET",jQuery.ajax(o)},F.prototype.parseData=function(e){var t=this.treeWidget.options.dataFilter,o="string"==typeof e?JSON.parse(e):e;return t?t(o):o},F);function F(e){this.treeWidget=e}var W=(b.prototype.deinit=function(){jQuery(document).off("keydown.jqtree")},b.prototype.moveDown=function(e){return this.selectNode(e.getNextNode())},b.prototype.moveUp=function(e){return this.selectNode(e.getPreviousNode())},b.prototype.moveRight=function(e){return!e.isFolder()||(e.is_open?this.selectNode(e.getNextNode()):(this.treeWidget.openNode(e),!1))},b.prototype.moveLeft=function(e){return e.isFolder()&&e.is_open?(this.treeWidget.closeNode(e),!1):this.selectNode(e.getParent())},b.prototype.selectNode=function(e){return!e||(this.treeWidget.selectNode(e),this.treeWidget.scrollHandler.isScrolledIntoView(jQuery(e.element).find(".jqtree-element"))||this.treeWidget.scrollToNode(e),!1)},b.prototype.canHandleKeyboard=function(){return!!this.treeWidget.options.keyboardSupport&&this.treeWidget.selectNodeHandler.isFocusOnTree()},b.LEFT=37,b.UP=38,b.RIGHT=39,b.DOWN=40,b);function b(e){var o=this;this.handleKeyDown=function(e){if(!o.canHandleKeyboard())return!0;var t=o.treeWidget.getSelectedNode();if(!t)return!0;switch(e.which){case b.DOWN:return o.moveDown(t);case b.UP:return o.moveUp(t);case b.RIGHT:return o.moveRight(t);case b.LEFT:return o.moveLeft(t);default:return!0}},(this.treeWidget=e).options.keyboardSupport&&jQuery(document).on("keydown.jqtree",this.handleKeyDown)}function T(a,e){function l(){return"simple_widget_"+e}function d(e,t){return(t=jQuery.data(e,t))&&t instanceof w?t:null}function n(e,t){for(var o=l(),n=0,r=e.get();n<r.length;n++){var i,s=r[n];d(s,o)||(i=new a(s,t),jQuery.data(s,o)||jQuery.data(s,o,i),i.init())}return e}jQuery.fn[e]=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(!e)return n(this,null);if("object"==typeof e)return n(this,e);if("string"==typeof e&&"_"!==e[0]){e=e;return"destroy"===e?function(e){for(var t=l(),o=0,n=e.get();o<n.length;o++){var r=n[o],i=d(r,t);i&&i.destroy(),jQuery.removeData(r,t)}}(this):"get_widget_class"===e?a:function(e,t,o){for(var n=null,r=0,i=e.get();r<i.length;r++){var s=i[r],a=jQuery.data(s,l());a&&a instanceof w&&((s=a[t])&&"function"==typeof s&&(n=s.apply(a,o)))}return n}(this,e,t)}}}var w=(L.register=function(e,t){T(e,t)},L.prototype.destroy=function(){this.deinit()},L.prototype.init=function(){},L.prototype.deinit=function(){},L.defaults={},L);function L(e,t){this.$el=jQuery(e);e=this.constructor.defaults;this.options=d(d({},e),t)}function H(e){return{pageX:e.pageX,pageY:e.pageY,target:e.target,originalEvent:e}}function A(e,t){return{pageX:e.pageX,pageY:e.pageY,target:e.target,originalEvent:t}}var M,t=(a(P,M=w),P.prototype.init=function(){var e=this.$el.get(0);e.addEventListener("mousedown",this.mouseDown,{passive:!1}),e.addEventListener("touchstart",this.touchStart,{passive:!1}),this.isMouseStarted=!1,this.mouseDelayTimer=null,this.isMouseDelayMet=!1,this.mouseDownInfo=null},P.prototype.deinit=function(){var e=this.$el.get(0);e.removeEventListener("mousedown",this.mouseDown,{passive:!1}),e.removeEventListener("touchstart",this.touchStart,{passive:!1}),this.removeMouseMoveEventListeners()},P.prototype.handleMouseDown=function(e){return this.isMouseStarted&&this.handleMouseUp(e),this.mouseDownInfo=e,!!this.mouseCapture(e)&&(this.handleStartMouse(),!0)},P.prototype.handleStartMouse=function(){document.addEventListener("mousemove",this.mouseMove,{passive:!1}),document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("mouseup",this.mouseUp,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1});var e=this.getMouseDelay();e?this.startMouseDelayTimer(e):this.isMouseDelayMet=!0},P.prototype.startMouseDelayTimer=function(e){var t=this;this.mouseDelayTimer&&clearTimeout(this.mouseDelayTimer),this.mouseDelayTimer=window.setTimeout(function(){t.mouseDownInfo&&(t.isMouseDelayMet=!0)},e),this.isMouseDelayMet=!1},P.prototype.handleMouseMove=function(e,t){if(this.isMouseStarted)return this.mouseDrag(t),void(e.cancelable&&e.preventDefault());this.isMouseDelayMet&&(this.mouseDownInfo&&(this.isMouseStarted=!1!==this.mouseStart(this.mouseDownInfo)),this.isMouseStarted?(this.mouseDrag(t),e.cancelable&&e.preventDefault()):this.handleMouseUp(t))},P.prototype.handleMouseUp=function(e){this.removeMouseMoveEventListeners(),this.isMouseDelayMet=!1,this.mouseDownInfo=null,this.isMouseStarted&&(this.isMouseStarted=!1,this.mouseStop(e))},P.prototype.removeMouseMoveEventListeners=function(){document.removeEventListener("mousemove",this.mouseMove,{passive:!1}),document.removeEventListener("touchmove",this.touchMove,{passive:!1}),document.removeEventListener("mouseup",this.mouseUp,{passive:!1}),document.removeEventListener("touchend",this.touchEnd,{passive:!1})},P);function P(){var o=null!==M&&M.apply(this,arguments)||this;return o.mouseDown=function(e){0===e.button&&o.handleMouseDown(H(e))&&e.cancelable&&e.preventDefault()},o.mouseMove=function(e){o.handleMouseMove(e,H(e))},o.mouseUp=function(e){o.handleMouseUp(H(e))},o.touchStart=function(e){var t;e&&(1<e.touches.length||(t=e.changedTouches[0],o.handleMouseDown(A(t,e))))},o.touchMove=function(e){var t;e&&(1<e.touches.length||(t=e.changedTouches[0],o.handleMouseMove(e,A(t,e))))},o.touchEnd=function(e){var t;e&&(1<e.touches.length||(t=e.changedTouches[0],o.handleMouseUp(A(t,e))))},o}var O=(q.prototype.saveState=function(){var e=JSON.stringify(this.getState());this.treeWidget.options.onSetStateFromStorage?this.treeWidget.options.onSetStateFromStorage(e):this.supportsLocalStorage()&&localStorage.setItem(this.getKeyName(),e)},q.prototype.getStateFromStorage=function(){var e=this.loadFromStorage();return e?this.parseState(e):null},q.prototype.getState=function(){var t,o,e=this;return{open_nodes:(o=[],e.treeWidget.tree.iterate(function(e){return e.is_open&&e.id&&e.hasChildren()&&o.push(e.id),!0}),o),selected_node:(t=[],e.treeWidget.getSelectedNodes().forEach(function(e){null!=e.id&&t.push(e.id)}),t)}},q.prototype.setInitialState=function(e){if(e){var t=!1;return e.open_nodes&&(t=this.openInitialNodes(e.open_nodes)),e.selected_node&&(this.resetSelection(),this.selectInitialNodes(e.selected_node)),t}return!1},q.prototype.setInitialStateOnDemand=function(e,t){e?this.doSetInitialStateOnDemand(e.open_nodes,e.selected_node,t):t()},q.prototype.getNodeIdToBeSelected=function(){var e=this.getStateFromStorage();return e&&e.selected_node?e.selected_node[0]:null},q.prototype.parseState=function(e){var t=JSON.parse(e);return t&&t.selected_node&&("number"==typeof(e=t.selected_node)&&e%1==0)&&(t.selected_node=[t.selected_node]),t},q.prototype.loadFromStorage=function(){return this.treeWidget.options.onGetStateFromStorage?this.treeWidget.options.onGetStateFromStorage():this.supportsLocalStorage()?localStorage.getItem(this.getKeyName()):null},q.prototype.openInitialNodes=function(e){for(var t=!1,o=0,n=e;o<n.length;o++){var r=n[o],r=this.treeWidget.getNodeById(r);r&&(r.load_on_demand?t=!0:r.is_open=!0)}return t},q.prototype.selectInitialNodes=function(e){for(var t=0,o=0,n=e;o<n.length;o++){var r=n[o],r=this.treeWidget.getNodeById(r);r&&(t+=1,this.treeWidget.selectNodeHandler.addToSelection(r))}return 0!==t},q.prototype.resetSelection=function(){var t=this.treeWidget.selectNodeHandler;t.getSelectedNodes().forEach(function(e){t.removeFromSelection(e)})},q.prototype.doSetInitialStateOnDemand=function(e,i,s){function t(){for(var e=[],t=0,o=d;t<o.length;t++){var n=o[t],r=a.treeWidget.getNodeById(n);r?r.is_loading||(r.load_on_demand?h(r):a.treeWidget._openNode(r,!1,null)):e.push(n)}d=e,a.selectInitialNodes(i)&&a.treeWidget._refreshElements(null),0===l&&s()}var a=this,l=0,d=e,h=function(e){l+=1,a.treeWidget._openNode(e,!1,function(){--l,t()})};t()},q.prototype.getKeyName=function(){return"string"==typeof this.treeWidget.options.saveState?this.treeWidget.options.saveState:"tree"},q.prototype.supportsLocalStorage=function(){return null==this._supportsLocalStorage&&(this._supportsLocalStorage=function(){if(null==localStorage)return!1;try{var e="_storage_test";sessionStorage.setItem(e,"value"),sessionStorage.removeItem(e)}catch(e){return!1}return!0}()),this._supportsLocalStorage},q);function q(e){this.treeWidget=e}var x=($.prototype.checkScrolling=function(){this.ensureInit(),this.checkVerticalScrolling(),this.checkHorizontalScrolling()},$.prototype.scrollToY=function(e){var t;this.ensureInit(),this.$scrollParent?this.$scrollParent[0].scrollTop=e:(t=(t=this.treeWidget.$el.offset())?t.top:0,jQuery(document).scrollTop(e+t))},$.prototype.isScrolledIntoView=function(e){var t;this.ensureInit();var o,n,r,i=e.height()||0;return(this.$scrollParent?(t=0,n=this.$scrollParent.height()||0,(o=((r=e.offset())?r.top:0)-this.scrollParentTop)+i):(n=(t=jQuery(window).scrollTop()||0)+(jQuery(window).height()||0),(o=(r=e.offset())?r.top:0)+i))<=n&&t<=o},$.prototype.getScrollLeft=function(){return this.$scrollParent&&this.$scrollParent.scrollLeft()||0},$.prototype.initScrollParent=function(){function e(){i.scrollParentTop=0,i.$scrollParent=null}var i=this;"fixed"===this.treeWidget.$el.css("position")&&e();var t=function(){function e(e){for(var t=0,o=r;t<o.length;t++){var n=o[t],n=e.css(n);if("auto"===n||"scroll"===n)return 1}}var r=["overflow","overflow-y"];if(e(i.treeWidget.$el))return i.treeWidget.$el;for(var t=0,o=i.treeWidget.$el.parents().get();t<o.length;t++){var n=o[t],n=jQuery(n);if(e(n))return n}return null}();t&&t.length&&"HTML"!==t[0].tagName?(this.$scrollParent=t,t=this.$scrollParent.offset(),this.scrollParentTop=t?t.top:0):e(),this.isInitialized=!0},$.prototype.ensureInit=function(){this.isInitialized||this.initScrollParent()},$.prototype.handleVerticalScrollingWithScrollParent=function(e){var t=this.$scrollParent&&this.$scrollParent[0];t&&(this.scrollParentTop+t.offsetHeight-e.bottom<20?(t.scrollTop+=20,this.treeWidget.refreshHitAreas(),this.previousTop=-1):e.top-this.scrollParentTop<20&&(t.scrollTop-=20,this.treeWidget.refreshHitAreas(),this.previousTop=-1))},$.prototype.handleVerticalScrollingWithDocument=function(e){var t=jQuery(document).scrollTop()||0;e.top-t<20?jQuery(document).scrollTop(t-20):(jQuery(window).height()||0)-(e.bottom-t)<20&&jQuery(document).scrollTop(t+20)},$.prototype.checkVerticalScrolling=function(){var e=this.treeWidget.dndHandler.hoveredArea;e&&e.top!==this.previousTop&&(this.previousTop=e.top,this.$scrollParent?this.handleVerticalScrollingWithScrollParent(e):this.handleVerticalScrollingWithDocument(e))},$.prototype.checkHorizontalScrolling=function(){var e=this.treeWidget.dndHandler.positionInfo;e&&(this.$scrollParent?this.handleHorizontalScrollingWithParent(e):this.handleHorizontalScrollingWithDocument(e))},$.prototype.handleHorizontalScrollingWithParent=function(e){var t,o,n,r,i;void 0!==e.pageX&&void 0!==e.pageY&&(i=(r=this.$scrollParent)&&r.offset(),r&&i&&(o=(t=r[0]).scrollLeft+t.clientWidth<t.scrollWidth,n=0<t.scrollLeft,r=i.left+t.clientWidth,i=i.left,r=e.pageX>r-20,i=e.pageX<i+20,r&&o?t.scrollLeft=Math.min(t.scrollLeft+20,t.scrollWidth):i&&n&&(t.scrollLeft=Math.max(t.scrollLeft-20,0))))},$.prototype.handleHorizontalScrollingWithDocument=function(e){var t,o,n,r;void 0!==e.pageX&&void 0!==e.pageY&&(o=(t=jQuery(document)).scrollLeft()||0,r=jQuery(window).width()||0,n=0<o,r=e.pageX>r-20,e=e.pageX-o<20,r?t.scrollLeft(o+20):e&&n&&t.scrollLeft(Math.max(o-20,0)))},$);function $(e){this.treeWidget=e,this.previousTop=-1,this.isInitialized=!1}var B=(U.prototype.getSelectedNode=function(){var e=this.getSelectedNodes();return!!e.length&&e[0]},U.prototype.getSelectedNodes=function(){var t=this;if(this.selectedSingleNode)return[this.selectedSingleNode];var o=[];return this.selectedNodes.forEach(function(e){e=t.treeWidget.getNodeById(e);e&&o.push(e)}),o},U.prototype.getSelectedNodesUnder=function(e){if(this.selectedSingleNode)return e.isParentOf(this.selectedSingleNode)?[this.selectedSingleNode]:[];var t,o,n=[];for(t in this.selectedNodes)!Object.prototype.hasOwnProperty.call(this.selectedNodes,t)||(o=this.treeWidget.getNodeById(t))&&e.isParentOf(o)&&n.push(o);return n},U.prototype.isNodeSelected=function(e){return null!=e.id?this.selectedNodes.has(e.id):!!this.selectedSingleNode&&this.selectedSingleNode.element===e.element},U.prototype.clear=function(){this.selectedNodes.clear(),this.selectedSingleNode=null},U.prototype.removeFromSelection=function(e,t){var o=this;void 0===t&&(t=!1),null==e.id?this.selectedSingleNode&&e.element===this.selectedSingleNode.element&&(this.selectedSingleNode=null):(this.selectedNodes.delete(e.id),t&&e.iterate(function(){return null!=e.id&&o.selectedNodes.delete(e.id),!0}))},U.prototype.addToSelection=function(e){null!=e.id?this.selectedNodes.add(e.id):this.selectedSingleNode=e},U.prototype.isFocusOnTree=function(){var e=document.activeElement;return Boolean(e&&"SPAN"===e.tagName&&this.treeWidget._containsElement(e))},U);function U(e){this.treeWidget=e,this.selectedNodes=new Set,this.clear()}var k=(Q.prototype.init=function(e,t){this.node=e,this.treeWidget=t,e.element||(e.element=this.treeWidget.element.get(0)),this.$element=jQuery(e.element)},Q.prototype.addDropHint=function(e){return this.mustShowBorderDropHint(e)?new G(this.$element,this.treeWidget._getScrollLeft()):new V(this.node,this.$element,e)},Q.prototype.select=function(e){var t=this.getLi();t.addClass("jqtree-selected"),t.attr("aria-selected","true");var o=this.getSpan();o.attr("tabindex",null!==(t=this.treeWidget.options.tabIndex)&&void 0!==t?t:null),e&&o.trigger("focus")},Q.prototype.deselect=function(){var e=this.getLi();e.removeClass("jqtree-selected"),e.attr("aria-selected","false");e=this.getSpan();e.removeAttr("tabindex"),e.blur()},Q.prototype.getUl=function(){return this.$element.children("ul:first")},Q.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")},Q.prototype.getLi=function(){return this.$element},Q.prototype.mustShowBorderDropHint=function(e){return e===l.Inside},Q);function Q(e,t){this.init(e,t)}var X,Y=(a(z,X=k),z.prototype.open=function(e,t,o){var n,r,i=this;void 0===t&&(t=!0),void 0===o&&(o="fast"),this.node.is_open||(this.node.is_open=!0,(n=this.getButton()).removeClass("jqtree-closed"),n.html(""),(n=n.get(0))&&(r=this.treeWidget.renderer.openedIconElement.cloneNode(!0),n.appendChild(r)),r=function(){i.getLi().removeClass("jqtree-closed"),i.getSpan().attr("aria-expanded","true"),e&&e(i.node),i.treeWidget._triggerEvent("tree.open",{node:i.node})},t?this.getUl().slideDown(o,r):(this.getUl().show(),r()))},z.prototype.close=function(e,t){var o,n,r=this;void 0===e&&(e=!0),void 0===t&&(t="fast"),this.node.is_open&&(this.node.is_open=!1,(o=this.getButton()).addClass("jqtree-closed"),o.html(""),(o=o.get(0))&&(n=this.treeWidget.renderer.closedIconElement.cloneNode(!0),o.appendChild(n)),n=function(){r.getLi().addClass("jqtree-closed"),r.getSpan().attr("aria-expanded","false"),r.treeWidget._triggerEvent("tree.close",{node:r.node})},e?this.getUl().slideUp(t,n):(this.getUl().hide(),n()))},z.prototype.mustShowBorderDropHint=function(e){return!this.node.is_open&&e===l.Inside},z.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")},z);function z(){return null!==X&&X.apply(this,arguments)||this}var G=(R.prototype.remove=function(){this.$hint.remove()},R);function R(e,t){var o=e.children(".jqtree-element"),e=e.width()||0,e=Math.max(e+t-4,0),t=o.outerHeight()||0,t=Math.max(t-4,0);this.$hint=jQuery('<span class="jqtree-border"></span>'),o.append(this.$hint),this.$hint.css({width:e,height:t})}var V=(K.prototype.remove=function(){this.$ghost.remove()},K.prototype.moveAfter=function(){this.$element.after(this.$ghost)},K.prototype.moveBefore=function(){this.$element.before(this.$ghost)},K.prototype.moveInsideOpenFolder=function(){jQuery(this.node.children[0].element).before(this.$ghost)},K.prototype.moveInside=function(){this.$element.after(this.$ghost),this.$ghost.addClass("jqtree-inside")},K);function K(e,t,o){this.$element=t,this.node=e,this.$ghost=jQuery('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span>\n            <span class="jqtree_common jqtree-line"></span></li>'),o===l.After?this.moveAfter():o===l.Before?this.moveBefore():o===l.Inside&&(e.isFolder()&&e.is_open?this.moveInsideOpenFolder():this.moveInside())}var J,Z=r.default||i,ee="Node parameter is empty",te="Parameter is empty: ",t=(a(oe,J=t),oe.prototype.toggle=function(e,t){if(void 0===t&&(t=null),!e)throw Error(ee);t=null!=t?t:this.options.slide;return e.is_open?this.closeNode(e,t):this.openNode(e,t),this.element},oe.prototype.getTree=function(){return this.tree},oe.prototype.selectNode=function(e,t){return this.doSelectNode(e,t),this.element},oe.prototype.getSelectedNode=function(){return this.selectNodeHandler.getSelectedNode()},oe.prototype.toJson=function(){return JSON.stringify(this.tree.getData())},oe.prototype.loadData=function(e,t){return this.doLoadData(e,t),this.element},oe.prototype.loadDataFromUrl=function(e,t,o){return"string"==typeof e?this.doLoadDataFromUrl(e,t,null!=o?o:null):this.doLoadDataFromUrl(null,e,t),this.element},oe.prototype.reload=function(e){return this.doLoadDataFromUrl(null,null,e),this.element},oe.prototype.getNodeById=function(e){return this.tree.getNodeById(e)},oe.prototype.getNodeByName=function(e){return this.tree.getNodeByName(e)},oe.prototype.getNodeByNameMustExist=function(e){return this.tree.getNodeByNameMustExist(e)},oe.prototype.getNodesByProperty=function(e,t){return this.tree.getNodesByProperty(e,t)},oe.prototype.getNodeByHtmlElement=function(e){return this.getNode(Z(e))},oe.prototype.getNodeByCallback=function(e){return this.tree.getNodeByCallback(e)},oe.prototype.openNode=function(e,t,o){var n=this;if(!e)throw Error(ee);var r,i,s,a=("function"==typeof t?(i=t,s=null):(s=t,i=o),null==s&&(s=null!==(r=n.options.slide)&&void 0!==r&&r),[s,i]),l=a[0],a=a[1];return this._openNode(e,l,a),this.element},oe.prototype.closeNode=function(e,t){if(!e)throw Error(ee);t=null!=t?t:this.options.slide;return(e.isFolder()||e.isEmptyFolder)&&(new Y(e,this).close(t,this.options.animationSpeed),this.saveState()),this.element},oe.prototype.isDragging=function(){return this.dndHandler.isDragging},oe.prototype.refreshHitAreas=function(){return this.dndHandler.refresh(),this.element},oe.prototype.addNodeAfter=function(e,t){e=t.addAfter(e);return e&&this._refreshElements(t.parent),e},oe.prototype.addNodeBefore=function(e,t){if(!t)throw Error(te+"existingNode");e=t.addBefore(e);return e&&this._refreshElements(t.parent),e},oe.prototype.addParentNode=function(e,t){if(!t)throw Error(te+"existingNode");e=t.addParent(e);return e&&this._refreshElements(e.parent),e},oe.prototype.removeNode=function(e){if(!e)throw Error(ee);if(!e.parent)throw Error("Node has no parent");this.selectNodeHandler.removeFromSelection(e,!0);var t=e.parent;return e.remove(),this._refreshElements(t),this.element},oe.prototype.appendNode=function(e,t){t=t||this.tree,e=t.append(e);return this._refreshElements(t),e},oe.prototype.prependNode=function(e,t){t=null!=t?t:this.tree,e=t.prepend(e);return this._refreshElements(t),e},oe.prototype.updateNode=function(e,t){if(!e)throw Error(ee);var o="object"==typeof t&&t.id&&t.id!==e.id;o&&this.tree.removeNodeFromIndex(e),e.setData(t),o&&this.tree.addNodeToIndex(e),"object"==typeof t&&t.children&&t.children instanceof Array&&(e.removeChildren(),t.children.length&&e.loadFromData(t.children));o=this.selectNodeHandler.isFocusOnTree(),t=this.isSelectedNodeInSubtree(e);return this._refreshElements(e),t&&this.selectCurrentNode(o),this.element},oe.prototype.isSelectedNodeInSubtree=function(e){var t=this.getSelectedNode();return!!t&&(e===t||e.isParentOf(t))},oe.prototype.moveNode=function(e,t,o){if(!e)throw Error(ee);if(!t)throw Error(te+"targetNode");o=p[o];return void 0!==o&&(this.tree.moveNode(e,t,o),this._refreshElements(null)),this.element},oe.prototype.getStateFromStorage=function(){return this.saveStateHandler.getStateFromStorage()},oe.prototype.addToSelection=function(e,t){if(!e)throw Error(ee);return this.selectNodeHandler.addToSelection(e),this._getNodeElementForNode(e).select(void 0===t||t),this.saveState(),this.element},oe.prototype.getSelectedNodes=function(){return this.selectNodeHandler.getSelectedNodes()},oe.prototype.isNodeSelected=function(e){if(!e)throw Error(ee);return this.selectNodeHandler.isNodeSelected(e)},oe.prototype.removeFromSelection=function(e){if(!e)throw Error(ee);return this.selectNodeHandler.removeFromSelection(e),this._getNodeElementForNode(e).deselect(),this.saveState(),this.element},oe.prototype.scrollToNode=function(e){if(!e)throw Error(ee);var t=Z(e.element).offset(),e=t?t.top:0,t=this.$el.offset(),t=e-(t?t.top:0);return this.scrollHandler.scrollToY(t),this.element},oe.prototype.getState=function(){return this.saveStateHandler.getState()},oe.prototype.setState=function(e){return this.saveStateHandler.setInitialState(e),this._refreshElements(null),this.element},oe.prototype.setOption=function(e,t){return this.options[e]=t,this.element},oe.prototype.moveDown=function(){var e=this.getSelectedNode();return e&&this.keyHandler.moveDown(e),this.element},oe.prototype.moveUp=function(){var e=this.getSelectedNode();return e&&this.keyHandler.moveUp(e),this.element},oe.prototype.getVersion=function(){return"1.6.0"},oe.prototype._triggerEvent=function(e,t){t=Z.Event(e,t);return this.element.trigger(t),t},oe.prototype._openNode=function(e,t,o){var n=this;void 0===t&&(t=!0);function r(e,t,o){new Y(e,n).open(o,t,n.options.animationSpeed)}if(e.isFolder()||e.isEmptyFolder)if(e.load_on_demand)this.loadFolderOnDemand(e,t,o);else{for(var i=e.parent;i;)i.parent&&r(i,!1,null),i=i.parent;r(e,t,o),this.saveState()}},oe.prototype._refreshElements=function(e){this.renderer.render(e),this._triggerEvent("tree.refresh")},oe.prototype._getNodeElementForNode=function(e){return new(e.isFolder()?Y:k)(e,this)},oe.prototype._getNodeElement=function(e){e=this.getNode(e);return e?this._getNodeElementForNode(e):null},oe.prototype._containsElement=function(e){e=this.getNode(Z(e));return null!=e&&e.tree===this.tree},oe.prototype._getScrollLeft=function(){return this.scrollHandler.getScrollLeft()},oe.prototype.init=function(){J.prototype.init.call(this),this.element=this.$el,this.isInitialized=!1,this.options.rtl=this.getRtlOption(),null==this.options.closedIcon&&(this.options.closedIcon=this.getDefaultClosedIcon()),this.renderer=new C(this),this.dataLoader=new j(this),this.saveStateHandler=new O(this),this.selectNodeHandler=new B(this),this.dndHandler=new g(this),this.scrollHandler=new x(this),this.keyHandler=new W(this),this.initData(),this.element.on("click",this.handleClick),this.element.on("dblclick",this.handleDblclick),this.options.useContextMenu&&this.element.on("contextmenu",this.handleContextmenu)},oe.prototype.deinit=function(){this.element.empty(),this.element.off(),this.keyHandler.deinit(),this.tree=new u({},!0),J.prototype.deinit.call(this)},oe.prototype.mouseCapture=function(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseCapture(e)},oe.prototype.mouseStart=function(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseStart(e)},oe.prototype.mouseDrag=function(e){if(this.options.dragAndDrop){e=this.dndHandler.mouseDrag(e);return this.scrollHandler.checkScrolling(),e}return!1},oe.prototype.mouseStop=function(e){return!!this.options.dragAndDrop&&this.dndHandler.mouseStop(e)},oe.prototype.getMouseDelay=function(){var e;return null!==(e=this.options.startDndDelay)&&void 0!==e?e:0},oe.prototype.initData=function(){this.options.data?this.doLoadData(this.options.data,null):this.getDataUrlInfo(null)?this.doLoadDataFromUrl(null,null,null):this.doLoadData([],null)},oe.prototype.getDataUrlInfo=function(n){var r=this,e=this.options.dataUrl||this.element.data("url"),t=function(e){var t,o;null!=n&&n.id?(o={node:n.id},e.data=o):(t=r.getNodeIdToBeSelected())&&(o={selected_node:t},e.data=o)};return"function"==typeof e?e(n):"string"==typeof e?function(e){e={url:e};return t(e),e}(e):e&&"object"==typeof e?(t(e),e):null},oe.prototype.getNodeIdToBeSelected=function(){return this.options.saveState?this.saveStateHandler.getNodeIdToBeSelected():null},oe.prototype.initTree=function(e){function t(){o.isInitialized||(o.isInitialized=!0,o._triggerEvent("tree.init"))}var o=this;this.options.nodeClass&&(this.tree=new this.options.nodeClass(null,!0,this.options.nodeClass),this.selectNodeHandler.clear(),this.tree.loadFromData(e),e=this.setInitialState(),this._refreshElements(null),e?this.setInitialStateOnDemand(t):t())},oe.prototype.setInitialState=function(){var t=this,e=function(){if(t.options.saveState){var e=t.saveStateHandler.getStateFromStorage();return e?[!0,t.saveStateHandler.setInitialState(e)]:[!1,!1]}return[!1,!1]}(),o=e[0],e=e[1];return o||(e=function(){if(!1===t.options.autoOpen)return!1;var o=t.getAutoOpenMaxLevel(),n=!1;return t.tree.iterate(function(e,t){return e.load_on_demand?!(n=!0):!!e.hasChildren()&&(e.is_open=!0,t!==o)}),n}()),e},oe.prototype.setInitialStateOnDemand=function(t){var n,r,i,s=this;!function(){if(s.options.saveState){var e=s.saveStateHandler.getStateFromStorage();return!!e&&(s.saveStateHandler.setInitialStateOnDemand(e,t),!0)}return!1}()&&(n=s.getAutoOpenMaxLevel(),r=0,(i=function(){s.tree.iterate(function(e,t){return e.load_on_demand?(e.is_loading||(o=e,r+=1,s._openNode(o,!1,function(){--r,i()})),!1):(s._openNode(e,!1,null),t!==n);var o}),0===r&&t()})())},oe.prototype.getAutoOpenMaxLevel=function(){return!0===this.options.autoOpen?-1:"number"==typeof this.options.autoOpen?this.options.autoOpen:"string"==typeof this.options.autoOpen?parseInt(this.options.autoOpen,10):0},oe.prototype.getClickTarget=function(e){var t=Z(e),e=t.closest(".jqtree-toggler");if(e.length){if(o=this.getNode(e))return{type:"button",node:o}}else{var o,t=t.closest(".jqtree-element");if(t.length)if(o=this.getNode(t))return{type:"label",node:o}}return null},oe.prototype.getNode=function(e){e=e.closest("li.jqtree_common");return 0===e.length?null:e.data("node")},oe.prototype.saveState=function(){this.options.saveState&&this.saveStateHandler.saveState()},oe.prototype.selectCurrentNode=function(e){var t=this.getSelectedNode();!t||(t=this._getNodeElementForNode(t))&&t.select(e)},oe.prototype.deselectCurrentNode=function(){var e=this.getSelectedNode();e&&this.removeFromSelection(e)},oe.prototype.getDefaultClosedIcon=function(){return this.options.rtl?"&#x25c0;":"&#x25ba;"},oe.prototype.getRtlOption=function(){if(null!=this.options.rtl)return this.options.rtl;var e=this.element.data("rtl");return null!==e&&!1!==e&&void 0!==e},oe.prototype.doSelectNode=function(e,t){function o(){n.options.saveState&&n.saveStateHandler.saveState()}var n=this;if(!e)return this.deselectCurrentNode(),void o();var r,i=d(d({},{mustSetFocus:!0,mustToggle:!0}),t||{});(n.options.onCanSelectNode?!0===n.options.selectable&&n.options.onCanSelectNode(e):!0===n.options.selectable)&&(this.selectNodeHandler.isNodeSelected(e)?i.mustToggle&&(this.deselectCurrentNode(),this._triggerEvent("tree.select",{node:null,previous_node:e})):(t=this.getSelectedNode()||null,this.deselectCurrentNode(),this.addToSelection(e,i.mustSetFocus),this._triggerEvent("tree.select",{node:e,deselected_node:t}),(r=e.parent)&&r.parent&&!r.is_open&&n.openNode(r,!1)),o())},oe.prototype.doLoadData=function(e,t){e&&(this._triggerEvent("tree.load_data",{tree_data:e}),t?(this.deselectNodes(t),this.loadSubtree(e,t)):this.initTree(e),this.isDragging()&&this.dndHandler.refresh())},oe.prototype.deselectNodes=function(e){for(var t=0,o=this.selectNodeHandler.getSelectedNodesUnder(e);t<o.length;t++){var n=o[t];this.selectNodeHandler.removeFromSelection(n)}},oe.prototype.loadSubtree=function(e,t){t.loadFromData(e),t.load_on_demand=!1,t.is_loading=!1,this._refreshElements(t)},oe.prototype.doLoadDataFromUrl=function(e,t,o){e=e||this.getDataUrlInfo(t);this.dataLoader.loadFromUrl(e,t,o)},oe.prototype.loadFolderOnDemand=function(e,t,o){var n=this;void 0===t&&(t=!0),e.is_loading=!0,this.doLoadDataFromUrl(null,e,function(){n._openNode(e,t,o)})},oe.defaults={animationSpeed:"fast",autoEscape:!0,autoOpen:!1,buttonLeft:!0,closedIcon:void 0,data:void 0,dataFilter:void 0,dataUrl:void 0,dragAndDrop:!1,keyboardSupport:!0,nodeClass:u,onCanMove:void 0,onCanMoveTo:void 0,onCanSelectNode:void 0,onCreateLi:void 0,onDragMove:void 0,onDragStop:void 0,onGetStateFromStorage:void 0,onIsMoveHandle:void 0,onLoadFailed:void 0,onLoading:void 0,onSetStateFromStorage:void 0,openedIcon:"&#x25bc;",openFolderDelay:500,rtl:void 0,saveState:!1,selectable:!0,showEmptyFolder:!1,slide:!0,startDndDelay:300,tabIndex:0,useContextMenu:!0},oe);function oe(){var o=null!==J&&J.apply(this,arguments)||this;return o.handleClick=function(e){var t=o.getClickTarget(e.target);t&&("button"===t.type?(o.toggle(t.node,o.options.slide),e.preventDefault(),e.stopPropagation()):"label"===t.type&&(t=t.node,o._triggerEvent("tree.click",{node:t,click_event:e}).isDefaultPrevented()||o.doSelectNode(t)))},o.handleDblclick=function(e){var t=o.getClickTarget(e.target);"label"===(null==t?void 0:t.type)&&o._triggerEvent("tree.dblclick",{node:t.node,click_event:e})},o.handleContextmenu=function(e){var t=Z(e.target).closest("ul.jqtree-tree .jqtree-element");if(t.length){t=o.getNode(t);if(t)return e.preventDefault(),e.stopPropagation(),o._triggerEvent("tree.contextmenu",{node:t,click_event:e}),!1}return null},o}return w.register(t,"tree"),e.JqTreeWidget=t,Object.defineProperty(e,"__esModule",{value:!0}),e}({},jQuery);