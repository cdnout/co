(function(){function s(){var e=this._constructorArg,t=this;this._referenceCount=0,this._objectOptionsByCid={},this._boundDataObjectsByCid={},_.each(p,function(e){t[e.name]=[]}),r[this.cid]=this,this.children={},this._renderCount=0,_.extend(this,e||{}),o.call(this),_.each(p,function(e){e.configure&&e.configure.call(this)},this),this.trigger("configure")}function o(){this.helpers&&_.each(this.helpers,function(e,t){var n=this;this.helpers[t]=function(){var t=_.toArray(arguments),r=_.last(t);return r.context=this,e.apply(n,t)}},this)}function u(e){return'Error "'+e+'". For more information visit http://thoraxjs.org/error-codes.html'+"#"+e}function a(e,t){var n=e.extend;e.extend=function(){var e=n.apply(this,arguments);return e.prototype.name&&(t[e.prototype.name]=e),e}}function f(e,t,n,r){var i=e[t],s;if(_.indexOf(n,".")>=0){var o=n.split(/\./);n=o.pop(),_.each(o,function(e){i=i[e]})}i&&(s=i[n]);if(!s&&!r)throw new Error(t+": "+n+" does not exist.");return s}function l(e,t){var n;_.isString(this[e])?n=i.Util.getViewClass(this[e],!0):this.name&&!_.isFunction(this[e])&&(n=i.Util.getViewClass(this.name+(t.extension||""),!0)),n&&!_.isFunction(this[e])&&(this[e]=n);if(t.required&&!_.isFunction(this[e]))throw new Error("View "+(this.name||this.cid)+" requires: "+e)}function c(e,t){var n;_.isString(this[e])?n=i.Util.getTemplate(this[e],!0):this.name&&!_.isFunction(this[e])&&(n=i.Util.getTemplate(this.name+(t.extension||""),!0)),!n&&e==="template"&&this._defaultTemplate&&(n=this._defaultTemplate),n&&!_.isFunction(this[e])&&(this[e]=n);if(t.required&&!_.isFunction(this[e]))throw new Error("View "+(this.name||this.cid)+" requires: "+e)}function h(e,t,n){return!e||!e[t]?null:_.isFunction(e[t])?e[t].call(n||e):e[t]}function d(e){_.each(p,function(t){e[t.name]||(e[t.name]=[])})}function v(e){_.each(p,function(t){e[t.name]=[]})}function m(e,t,n,r){var i=[];_.has(e,t)&&i.push(e);var s=e;if(n)while(s=s.__parent__)_.has(s,t)&&i.push(s);else{s=s.constructor;while(s)s.prototype&&_.has(s.prototype,t)&&i.push(s.prototype),s=s.__super__&&s.__super__.constructor}var o=i.length;while(o--)_.each(h(i[o],t,e),r)}function g(e,t,n,r){if(_.isObject(n)){var i=p[t];if(i&&i.event)return e&&e.listenTo&&e[t]&&e[t].cid?b(e,n,r,t):b(e["_"+t+"Events"],n,r),!0}}function y(e,t,n,r,i){function u(){if(e.el)s.apply(i,arguments);else{if(o)throw new Error("destroyed-event:"+e.name+":"+n);o++}}var s=q(r,e),o=0;u._callback=s._callback||s,u._thoraxBind=!0,e.listenTo(t,n,u)}function b(e,t,n,r){function i(t,i){r?y(e,e[r],i,t,n||e):e.push([i,t,n])}_.each(t,function(e,t){_.isArray(e)?_.each(e,function(e){i(e,t)}):i(e,t)})}function w(e){if(!e||!e.data)throw new Error(u("handlebars-no-data"));return e.data}function E(e){e.tag&&(e.tagName=e.tag,delete e.tag),e["class"]&&(e.className=e["class"],delete e["class"])}function C(e){T.push.apply(T,e),N=new RegExp("^(nested\\s+)?("+T.join("|")+")(?:\\s|$)")}function k(e,t){return function(n){var r=$(n.target).view({helper:!1});if(r&&r.cid===t)return n.originalContext=this,e(n)}}function L(e,t){function o(){try{return r.apply(s,arguments)}catch(t){i.onException("thorax-exception: "+(s.name||s.cid)+":"+e,t)}}e+=t.originalName;var n=t.handler,r=_.isFunction(n)?n:this[n];if(!r)throw new Error('Event "'+n+'" does not exist '+(this.name||this.cid)+":"+e);var s=t.context||this;return o._callback=r,o._thoraxBind=!0,o}function A(e,t,n){var r={originalName:e,handler:_.isString(t)?this[t]:t};if(e.match(N)){var i=x.exec(e);r.nested=!!i[1],r.name=i[2],r.type="DOM",r.selector=i[3]}else r.name=e,r.type="view";return r.context=n,r}function P(e){while(e._helperName&&e._helperName!=="view")e=e.parent;return e}function H(e){var t=_.pick(e,"fn","inverse","hash","data");return t.data=_.omit(e.data,"cid","view","yield"),t}function B(e,t){function n(e,t){return _.every(e,function(e,n){return t[n]===e})}return e._helperName!==t._helperName?!1:(e=e._helperOptions,t=t._helperOptions,e.args.length===t.args.length&&n(e.args,t.args)&&_.isEqual(_.keys(e.options),_.keys(t.options))&&_.every(e.options,function(r,i){if(i==="data"||i==="hash")return n(e.options[i],t.options[i]);if(i==="fn"||i==="inverse"){if(t.options[i]===r)return!0;var s=t.options[i]||{};return r&&_.has(r,"program")&&!r.depth&&s.program===r.program}return t.options[i]===r}))}function j(e,t){function n(n,r){var i=this[e],s=h(this,t.$el);return n===i?this:(i&&this.unbindDataObject(i),n?(this[e]=n,t.loading&&t.loading.call(this),this.bindDataObject(e,n,_.extend({},this.options,r)),s&&s.attr(t.cidAttrName,n.cid),n.trigger("set",n,i)):(this[e]=!1,t.change&&t.change.call(this,!1),s&&s.removeAttr(t.cidAttrName)),this.trigger("change:data-object",e,n,i),this)}t=p[e]=_.defaults({name:"_"+e+"Events",event:!0},t),t.ctor=function(){if(this[e]){var n=this[e];this[e]=null,this[t.set](n)}},i.View.prototype[t.set]=n}function F(e,t,n){var r=this;m(n,"_"+e+"Events",!0,function(e){y(r,t,e[0],e[1],e[2]||r)})}function I(e,t){e.load?e.load(function(){t&&t.success&&t.success(e)},t):e.fetch(t)}function q(e,t){return _.isFunction(e)?e:t[e]}function U(e,t){if(t&&t.serializing)return;var n=this.getObjectOptions(e)||{};this.conditionalRender(n.render)}function G(e){var t=this.getObjectOptions(e)||undefined;this.shouldRender(t&&t.render)&&this.renderCollection&&this.renderCollection()}function Y(e){var t=this.getObjectOptions(e)||undefined;this.shouldRender(t&&t.render)&&this.ensureRendered()}function Z(){this.itemFilter&&this.collection.forEach(et,this)}function et(e){var t=this.getCollectionElement();this.itemFilter&&t.find("["+R+'="'+e.cid+'"]')[tt.call(this,e)?"show":"hide"]()}function tt(e){return this.itemFilter(e,this.collection.indexOf(e))}function nt(){var e=this.getCollectionElement();this.emptyClass&&e.removeClass(this.emptyClass),e.removeAttr(J),e.empty()}function rt(){var e=this.getCollectionElement();this.emptyClass&&e.addClass(this.emptyClass),e.attr(J,!0),this.appendEmpty()}function st(e,t){return _.each(e,function(n,r){if(_.isObject(n))return st(n,t);t(n,r,e)===!1&&delete e[r]}),e}function ot(){ft.call(this),this.model&&this.model.previousAttributes&&this.model.set(this.model.previousAttributes(),{silent:!0})}function ut(e,t,n){var r=0;$("select,input,textarea",t.root||e.el).each(function(){if(!t.children&&e!==$(this).view({helper:!1}))return;this.type!=="button"&&this.type!=="cancel"&&this.type!=="submit"&&this.name&&(n(this,r),++r)})}function at(e,t,n,r){var i,s=e,o=t.split("["),u=n.mode;for(var a=0;a<o.length-1;++a){i=o[a].replace("]","");if(!s[i]){if(u!=="serialize")return r(undefined,i);s[i]={}}s=s[i]}i=o[o.length-1].replace("]",""),r(s,i)}function ft(){this.$("form").removeAttr("data-submit-wait")}function lt(e){var t=e.getObjectOptions(e.model)||{};return t.populate===!0?{}:t.populate}function ht(e,t){t=t||{},t.target=this,this.trigger(e,t),_.each(this.children,function(n){n.trigger(e,t)})}function pt(){++this._renderCount,this.$el.attr(ct,this.cid)}function dt(){if(!this.$("["+ct+'="'+this.cid+'"]')[0])throw new Error("No layout element found in "+(this.name||this.cid))}function vt(){return this.$("["+ct+'="'+this.cid+'"]')[0]||this.el[0]||this.el}function mt(e){return function(){var t=_.toArray(arguments);t.unshift(e),this.parent.trigger.apply(this.parent,t)}}function yt(e){var t=P(this);if(!this[e]){var n=t[e];n&&(this[e]=n)}}function St(e){var t=$(this),n=t.view({helper:!1}),r=t.attr(bt),i=t.attr(wt),s=!1;r&&(s=n[r].call(n,e)),i&&n.trigger(i,e),this.tagName==="A"&&s===!1&&e.preventDefault()}function Tt(){Nt(),xt=i._fastClickEventName||"click",$(document).on(xt,Et,St)}function Nt(){xt&&$(document).off(xt,Et,St)}function Ot(e,t){function i(){if(n===Backbone.history.getFragment())return;r=!0,o.cancel(),t&&t()}function s(){Backbone.history.off("route",i),r||e.apply(this,arguments)}var n=Backbone.history.getFragment(),r=!1;Backbone.history.on("route",i);var o=_.bind(s,this);return o.cancel=function(){Backbone.history.off("route",i)},o}function Mt(e,t,n){if(this.isPopulated())return _.defer(e,this);arguments.length===2&&!_.isFunction(t)&&_.isObject(t)&&(n=t,t=!1);var r=this,i=!1,s=Ot(_.bind(e,r),function(){i=!0,r._request&&(r._aborted=!0,r._request.abort()),t&&t.call(r,!1)});this.fetch(_.defaults({success:s,error:function(){s.cancel(),!i&&t&&t.apply(r,[!0].concat(_.toArray(arguments)))}},n))}function _t(e,t){if(e.resetQueue)this.fetchQueue=undefined;else if(this.fetchQueue){var n=(this.fetchQueue[0]||{}).reset;if(n!==e.reset)throw new Error(u("mixed-fetch"))}if(!this.fetchQueue)return this.fetchQueue=[e],e=_.defaults({success:Dt(this,this.fetchQueue,"success"),error:Dt(this,this.fetchQueue,"error"),complete:Dt(this,this.fetchQueue,"complete")},e),t&&t.call(this,e),e;this.fetchQueue.push(e)}function Dt(e,t,n){return function(){var r=arguments;_.each(t,function(e){e[n]&&e[n].apply(this,r)},this),e.fetchQueue===t&&(e.fetchQueue=undefined)}}function Ht(){this.render()}function Rt(){}function Ut(){_.each(this._domEvents||[],function(e){var t=e.split(" "),n=t.slice(1).join(" ")||undefined;t[0]==="click"&&$(n||this.el,n&&this.el).forEach(function(e){var t=$(e).attr("data-tappable",!0);It&&!qt[e.tagName]&&t.on("click",Rt)})},this)}$.fn.forEach||($.fn.forEach=function(e,t){$.fn.each.call(this,function(n){e.call(t||this,this,n)})});var e="data-view-name",t="data-view-cid",n="data-view-helper",r={};Handlebars.templates||(Handlebars.templates={});var i=this.Thorax={templatePathPrefix:"",Views:{},onException:function(e,t){throw t},templates:Handlebars.templates};i.View=Backbone.View.extend({constructor:function(){this._constructorArg=arguments[0];var e=Backbone.View.apply(this,arguments);return delete this._constructorArg,_.each(p,function(t){t.ctor&&t.ctor.call(this,e)},this),e},_configure:function(){},_ensureElement:function(){return s.call(this),Backbone.View.prototype._ensureElement.call(this)},toString:function(){return"[object View."+this.name+"]"},setElement:function(){var n=Backbone.View.prototype.setElement.apply(this,arguments);return this.name&&this.$el.attr(e,this.name),this.$el.attr(t,this.cid),n},_addChild:function(e){return this.children[e.cid]?e:(e.retain(),this.children[e.cid]=e,e.parent&&e.parent!==this&&!e._helperOptions&&e.parent._removeChild(e),e.parent=this,this.trigger("child",e),e)},_removeChild:function(e){return delete this.children[e.cid],e.parent=null,e.release(),e},_destroy:function(e){_.each(this._boundDataObjectsByCid,this.unbindDataObject,this),this.trigger("destroyed"),delete r[this.cid],_.each(this.children,function(e){this._removeChild(e)},this),this.el&&(this.undelegateEvents(),this.remove(),this.off()),this.el=this.$el=undefined,this.parent=undefined,this.model=this.collection=this._collection=undefined,this._helperOptions=undefined},render:function(e){if(!this.el)return;if(this._rendering)throw new Error(u("nested-render"));this._previousHelpers=_.filter(this.children,function(e){return e._helperOptions});var t={};_.each(this.children,function(e,n){e._helperOptions||(t[n]=e)}),this.children=t,this.trigger("before:rendered"),this._rendering=!0;try{_.isUndefined(e)||!_.isElement(e)&&!i.Util.is$(e)&&(!e||!e.el)&&!_.isString(e)&&!_.isFunction(e)?(c.call(this,"template",{required:!0}),e=this.renderTemplate(this.template)):_.isFunction(e)&&(e=this.renderTemplate(e)),_.each(this._previousHelpers,function(e){this._removeChild(e)},this),this._previousHelpers=undefined,this.html(e&&e.el||e&&e.string||e),++this._renderCount,this.trigger("rendered")}finally{this._rendering=!1}return e},context:function(){return _.extend({},this.model&&this.model.attributes||{})},_getContext:function(){return _.extend({},this,h(this,"context")||{})},_getData:function(e){return{view:this,cid:_.uniqueId("t"),yield:function(){return e.fn&&e.fn(e)}}},renderTemplate:function(e,t,n){var r;return t=t||this._getContext(),_.isFunction(e)?r=e:r=i.Util.getTemplate(e,n),r?r(t,{helpers:this.helpers,data:this._getData(t)}):""},ensureRendered:function(){!this._renderCount&&this.render()},shouldRender:function(e){return e||e==null&&this._renderCount},conditionalRender:function(e){this.shouldRender(e)&&this.render()},appendTo:function(e){this.ensureRendered(),$(e).append(this.el),this.trigger("ready",{target:this})},html:function(e){if(_.isUndefined(e))return this.el.innerHTML;this.trigger("before:append");var t=this._replaceHTML(e);return this.trigger("append"),t},release:function(){--this._referenceCount,this._referenceCount<=0&&this._destroy()},retain:function(e){++this._referenceCount,e&&this.listenTo(e,"destroyed",e.release)},_replaceHTML:function(e){return this.el.innerHTML="",this.$el.append(e)},_anchorClick:function(e){var t=$(e.currentTarget),n=t.attr("href");return n&&(n[0]==="#"||n[0]==="/"&&n[1]!=="/")?(Backbone.history.navigate(n,{trigger:!0}),!1):!0}}),i.View.extend=function(){d(this);var e=Backbone.View.extend.apply(this,arguments);return e.__parent__=this,v(e),e},a(i.View,i.Views),$.fn.view=function(e){e=_.defaults(e||{},{helper:!0});var i="["+t+"]";e.helper||(i+=":not(["+n+"])");var s=$(this).closest(i);return s&&r[s.attr(t)]||!1};var p={};i.Util={getViewInstance:function(e,t){var n=i.Util.getViewClass(e,!0);return n?new n(t||{}):e},getViewClass:function(e,t){return _.isString(e)?f(i,"Views",e,t):_.isFunction(e)?e:!1},getTemplate:function(e,t){var n=i.templatePathPrefix,r;n&&e.substr(0,n.length)!==n&&(e=n+e),e=e.replace(/\.handlebars$/,""),r=Handlebars.templates[e],r||(e+=".handlebars",r=Handlebars.templates[e]);if(!r&&!t)throw new Error("templates: "+e+" does not exist.");return r},is$:function(e){return _.isObject(e)&&"length"in e},expandToken:function(e,t){if(e&&e.indexOf&&e.indexOf("{{")>=0){var n=/(?:\{?[^{]+)|(?:\{\{([^}]+)\}\})/g,r,i=[];function s(e,t){if(e.match(/^("|')/)&&e.match(/("|')$/))return e.replace(/(^("|')|('|")$)/g,"");var n=e.split("."),r=n.length;for(var i=0;t&&i<r;i++)n[i]!=="this"&&(t=t[n[i]]);return t}while(r=n.exec(e))if(r[1]){var o=r[1].split(/\s+/);if(o.length>1){var u=o.shift();o=_.map(o,function(e){return s(e,t)}),Handlebars.helpers[u]?i.push(Handlebars.helpers[u].apply(t,o)):i.push(r[0])}else i.push(s(o[0],t))}else i.push(r[0]);e=i.join("")}return e},tag:function(e,t,n){var r=_.omit(e,"tagName"),s=e.tagName||"div";return"<"+s+" "+_.map(r,function(e,t){if(_.isUndefined(e)||t==="expand-tokens")return"";var r=e;return n&&(r=i.Util.expandToken(e,n)),(t==="className"?"class":t)+'="'+Handlebars.Utils.escapeExpression(r)+'"'}).join(" ")+">"+(_.isUndefined(t)?"":t)+"</"+s+">"}},i.Mixins={},_.extend(i.View,{mixin:function(e){i.Mixins[e](this)},registerMixin:function(e,t,n){i.Mixins[e]=function(e){var r=!!e.cid;n&&_.extend(r?e:e.prototype,n),r?t.call(e):e.on("configure",t)}}}),i.View.prototype.mixin=function(e){i.Mixins[e](this)};var S=i.View.prototype.on;p.event={name:"_events",configure:function(){var e=this;m(this.constructor,"_events",!0,function(t){e.on.apply(e,t)}),m(this,"events",!1,function(t,n){e.on(n,t,e)})}},_.extend(i.View,{on:function(e,t){return d(this),g(this,e,t)?this:(_.isObject(e)?_.each(e,function(e,t){this.on(t,e)},this):_.isArray(t)?_.each(t,function(t){this._events.push([e,t])},this):this._events.push([e,t]),this)}}),_.extend(i.View.prototype,{on:function(e,t,n){return g(this,e,t,n)?this:(_.isObject(e)&&arguments.length<3?_.each(e,function(e,n){this.on(n,e,t||this)},this):_.each(_.isArray(t)?t:[t],function(t){var r=A.call(this,e,t,n||this);r.type==="DOM"&&!this._eventsDelegated?(this._eventsToDelegate||(this._eventsToDelegate=[]),this._eventsToDelegate.push(r)):this._addEvent(r)},this),this)},delegateEvents:function(e){this.undelegateEvents(),e&&(_.isFunction(e)&&(e=e.call(this)),this._eventsToDelegate=[],this.on(e)),this._eventsToDelegate&&_.each(this._eventsToDelegate,this._addEvent,this),this._eventsDelegated=!0},_addEvent:function(e){if(e.handler._thoraxBind)return S.call(this,e.name,e.handler,e.context||this);var t=L.call(this,e.type+"-event:",e);if(e.type==="view")e.context&&e.context!==this&&e.context instanceof i.View?y(e.context,this,e.name,t,e.context):S.call(this,e.name,t,e.context||this);else{e.nested||(t=k(t,this.cid));var n=e.name+".delegateEvents"+this.cid;e.selector?this.$el.on(n,e.selector,t):this.$el.on(n,t)}}}),i.View.prototype.bind=i.View.prototype.on,i.View.on("ready",function(e){if(!this._isReady){this._isReady=!0;function t(t){t._isReady||t.trigger("ready",e)}_.each(this.children,t),this.on("child",t)}});var x=/^(nested\s+)?(\S+)(?:\s+(.+))?/,T=[],N;C(["mousedown","mouseup","mousemove","mouseover","mouseout","touchstart","touchend","touchmove","click","dblclick","keyup","keydown","keypress","submit","change","input","focus","blur"]);var O="data-view-tmp",M={},D={_ensureElement:function(){i.View.prototype._ensureElement.apply(this,arguments),this.$el.attr(n,this._helperName)},_getContext:function(){return this.parent._getContext.apply(this.parent,arguments)}};i.HelperView=i.View.extend(D),Handlebars.registerViewHelper=function(e,t,n){arguments.length===2&&(t.factory?n=t.callback:(n=t,t=i.HelperView));var r=t.attributeWhiteList;Handlebars.registerHelper(e,function(){var s=_.toArray(arguments),o=s.pop(),u=w(o).view,a=o.hash["expand-tokens"];a&&(delete o.hash["expand-tokens"],_.each(o.hash,function(e,t){o.hash[t]=i.Util.expandToken(e,this)},this));var f={inverse:o.inverse,options:o.hash,declaringView:u,parent:P(u),_helperName:e,_helperOptions:{options:H(o),args:_.clone(s)}};E(o.hash);var l=_.clone(o.hash);r&&_.each(r,function(e,t){delete l[t],_.isUndefined(o.hash[t])||(f[e]=o.hash[t])}),l.tagName&&(f.tagName=l.tagName),f.attributes=function(){var e=t.prototype&&t.prototype.attributes||{};return _.isFunction(e)&&(e=e.apply(this,arguments)),_.extend(e,_.omit(l,["tagName"])),e.className&&(e["class"]=e.className,delete e.className),e},o.fn?f.template=o.fn:t&&t.prototype&&!t.prototype.template&&(f.template=Handlebars.VM.noop);var c=_.find(u._previousHelpers,function(e){return B(f,e)});if(!c){if(t.factory){c=t.factory(s,f);if(!c)return"";c._helperName=f._helperName,c._helperOptions=f._helperOptions}else c=new t(f);if(!c.el)throw new Error("insert-destroyed-factory");u._previousHelpers=_.without(u._previousHelpers,c),s.push(c),u._addChild(c),u.trigger.apply(u,["helper",e].concat(s)),u.trigger.apply(u,["helper:"+e].concat(s)),n&&n.apply(this,s)}else{if(!c.el)throw new Error("insert-destroyed");u._previousHelpers=_.without(u._previousHelpers,c),u.children[c.cid]=c}return l[O]=c.cid,t.modifyHTMLAttributes&&t.modifyHTMLAttributes(l,c),new Handlebars.SafeString(i.Util.tag(l,"",a?this:null))});var s=Handlebars.helpers[e];return s},i.View.on("append",function(e,t){(e||this.$el).find("["+O+"]").forEach(function(e){var n=e.getAttribute(O),r=this.children[n];r&&(M[n]?(r.render(M[n]),delete M[n]):r.ensureRendered(),$(e).replaceWith(r.el),t&&t(r.el))},this)}),_.extend(i.View.prototype,{getObjectOptions:function(e){return e&&this._objectOptionsByCid[e.cid]},bindDataObject:function(e,t,n){if(this._boundDataObjectsByCid[t.cid])return!1;this._boundDataObjectsByCid[t.cid]=t;var n=this._modifyDataObjectOptions(t,_.extend({},p[e].defaultOptions,n));this._objectOptionsByCid[t.cid]=n,F.call(this,e,t,this.constructor),F.call(this,e,t,this);var r=p[e];return r.bindCallback&&r.bindCallback.call(this,t,n),t.shouldFetch&&t.shouldFetch(n)?I(t,n):p[e].change&&p[e].change.call(this,t,n),!0},unbindDataObject:function(e){return this._boundDataObjectsByCid[e.cid]?(delete this._boundDataObjectsByCid[e.cid],this.stopListening(e),delete this._objectOptionsByCid[e.cid],!0):!1},_modifyDataObjectOptions:function(e,t){return t}});var R="data-model-cid";i.Model=Backbone.Model.extend({isEmpty:function(){return!this.isPopulated()},isPopulated:function(){var e=_.clone(this.attributes),t=h(this,"defaults")||{};for(var n in t){if(e[n]!=t[n])return!0;delete e[n]}var r=_.keys(e);return r.length>1||r.length===1&&r[0]!==this.idAttribute},shouldFetch:function(e){var t;try{t=h(this,"url")}catch(n){t=!1}return e.fetch&&!!t&&!this.isPopulated()}}),i.Models={},a(i.Model,i.Models),j("model",{set:"setModel",defaultOptions:{render:undefined,fetch:!0,success:!1,invalid:!0},change:U,$el:"$el",cidAttrName:R}),i.View.on({model:{invalid:function(e,t){this.getObjectOptions(e).invalid&&this.trigger("invalid",t,e)},error:function(e,t,n){this.trigger("error",t,e)},change:function(e,t){p.model.change.call(this,e,t)}}}),$.fn.model=function(e){var t=$(this),n=t.closest("["+R+"]"),r=n&&n.attr(R);if(r){var e=e||t.view();if(e&&e.model&&e.model.cid===r)return e.model||!1;var i=t.collection(e);if(i)return i.get(r)}return!1};var z=Backbone.Collection.prototype.fetch,W=Backbone.Collection.prototype.set,X=i.View.prototype._replaceHTML,V="data-collection-cid",J="data-collection-empty",K="data-collection-element",Q=1;i.Collection=Backbone.Collection.extend({model:i.Model||Backbone.Model,initialize:function(){return this.cid=_.uniqueId("collection"),Backbone.Collection.prototype.initialize.apply(this,arguments)},isEmpty:function(){return this.length>0?!1:this.length===0&&this.isPopulated()},isPopulated:function(){return this._fetched||this.length>0||!this.length&&!h(this,"url")},shouldFetch:function(e){return e.fetch&&!!h(this,"url")&&!this.isPopulated()},fetch:function(e){e=e||{};var t=e.success;return e.success=function(e,n){e._fetched=!0,t&&t(e,n)},z.apply(this,arguments)},set:function(e,t){return this._fetched=!!e,W.call(this,e,t)}}),_.extend(i.View.prototype,{getCollectionViews:function(e){return _.filter(this.children,function(t){return t instanceof i.CollectionView?!e||t.collection===e:!1})},updateFilter:function(e){_.invoke(this.getCollectionViews(e),"updateFilter")}}),i.Collections={},a(i.Collection,i.Collections),j("collection",{set:"setCollection",bindCallback:Y,defaultOptions:{render:undefined,fetch:!0,success:!1,invalid:!0,change:!0},change:G,$el:"getCollectionElement",cidAttrName:V}),i.CollectionView=i.View.extend({_defaultTemplate:Handlebars.VM.noop,_collectionSelector:"["+K+"]",_replaceHTML:function(e){if(!(this.collection&&this.getObjectOptions(this.collection)&&this._renderCount))return X.call(this,e);var t,n=this.getCollectionElement();t=X.call(this,e),n.attr("data-view-cid")||this.getCollectionElement().replaceWith(n)},render:function(){var e=this.shouldRender();i.View.prototype.render.apply(this,arguments),e||this.renderCollection()},appendItem:function(e,t,n){if(!e)return;var r,i=this.getCollectionElement(),s=this.collection;n=_.defaults(n||{},{filter:!0}),t&&t.el&&(t=i.children().indexOf(t.el)+1),e.el||_.isString(e)?(r=e,e=!1):(t=t||s.indexOf(e)||0,r=this.renderItem(e,t));if(r){r.cid&&(r.ensureRendered(),this._addChild(r)),_.isString(r)&&!r.match(/^\s*</m)&&(r="<div>"+r+"</div>");var o=r.$el||$($.trim(r)).filter(function(){return this.nodeType===Q});e&&o.attr(R,e.cid);var u=t>0?s.at(t-1):!1;if(!u)i.prepend(o);else{var a=i.children("["+R+'="'+u.cid+'"]').last();a.after(o)}this.trigger("append",null,function(t){t.setAttribute(R,e.cid)}),n.silent||this.trigger("rendered:item",this,s,e,o,t),n.filter&&et.call(this,e)}return r},updateItem:function(e){var n=this.getCollectionElement(),r=n.find("["+R+'="'+e.cid+'"]');if(r.attr(t))return;this.removeItem(r),this.appendItem(e)},removeItem:function(e){var n=e;if(e.cid){var r=this.getCollectionElement();n=r.find("["+R+'="'+e.cid+'"]')}if(!n.length)return!1;var i=n.find("["+t+"]").map(function(e,n){return $(n).attr(t)});return n.remove(),i.push(n.attr(t)),_.each(i,function(e){var t=this.children[e];t&&this._removeChild(t)},this),!0},renderCollection:function(){this.collection?(this.collection.isEmpty()?rt.call(this):(nt.call(this),this.collection.forEach(function(e,t){this.appendItem(e,t)},this)),this.trigger("rendered:collection",this,this.collection)):rt.call(this)},emptyClass:"empty",renderEmpty:function(){this.emptyView||l.call(this,"emptyView",{extension:"-empty"}),!this.emptyTemplate&&!this.emptyView&&c.call(this,"emptyTemplate",{extension:"-empty",required:!1});if(this.emptyView){var e={};this.emptyTemplate&&(e.template=this.emptyTemplate);var t=i.Util.getViewInstance(this.emptyView,e);return t.ensureRendered(),t}return this.emptyTemplate&&this.renderTemplate(this.emptyTemplate)},renderItem:function(e,t){this.itemView||l.call(this,"itemView",{extension:"-item",required:!1}),!this.itemTemplate&&!this.itemView&&c.call(this,"itemTemplate",{extension:"-item",required:!this.itemView});if(this.itemView){var n={model:e};return this.itemTemplate&&(n.template=this.itemTemplate),i.Util.getViewInstance(this.itemView,n)}return this.renderTemplate(this.itemTemplate,this.itemContext(e,t))},itemContext:function(e){return e.attributes},appendEmpty:function(){var e=this.getCollectionElement();e.empty();var t=this.renderEmpty();t&&this.appendItem(t,0,{silent:!0,filter:!1}),this.trigger("rendered:empty",this,this.collection)},getCollectionElement:function(){var e=this.$(this._collectionSelector);return e.length===0?this.$el:e},updateFilter:function(){Z.call(this)}}),i.CollectionView.on({collection:{reset:G,sort:G,change:function(e){var t=this.getObjectOptions(this.collection);t&&t.change&&this.updateItem(e),et.call(this,e)},add:function(e){var t=this.getCollectionElement();if(t.length){this.collection.length===1&&nt.call(this);var n=this.collection.indexOf(e);this.appendItem(e,n)}},remove:function(e){var t=this.getCollectionElement();this.removeItem(e),this.collection.length===0&&t.length&&rt.call(this)}}}),i.View.on({collection:{invalid:function(e,t){this.getObjectOptions(e).invalid&&this.trigger("invalid",t,e)},error:function(e,t,n){this.trigger("error",t,e)}}}),$.fn.collection=function(e){if(e&&e.collection)return e.collection;var t=$(this),n=t.closest("["+V+"]"),r=n&&n.attr(V);if(r){e=t.view();if(e)return e.collection}return!1},p.model.defaultOptions.populate=!0;var it=p.model.change;p.model.change=function(e,t){this._isChanging=!0,it.apply(this,arguments),this._isChanging=!1;if(t&&t.serializing)return;var n=lt(this);this._renderCount&&n&&this.populate(!n.context&&this.model.attributes,n)},_.extend(i.View.prototype,{serialize:function(){var e,t,n;for(var r=0;r<arguments.length;++r)_.isFunction(arguments[r])?e=arguments[r]:_.isObject(arguments[r])&&("stopPropagation"in arguments[r]&&"preventDefault"in arguments[r]?n=arguments[r]:t=arguments[r]);if(n&&!this._preventDuplicateSubmission(n))return;t=_.extend({set:!0,validate:!0,children:!0},t||{});var i=t.attributes||{},s=this,o=[];ut(this,t,function(e){var n=s._getInputValue(e,t,o);_.isUndefined(n)||at(i,e.name,{mode:"serialize"},function(e,t){e[t]?_.isArray(e[t])?e[t].push(n):e[t]=[e[t],n]:e[t]=n})}),t._silent||this.trigger("serialize",i,t);if(t.validate){var u=this.validateInput(i);u&&u.length&&(o=o.concat(u)),this.trigger("validate",i,o,t);if(o.length){this.trigger("invalid",o);return}}return t.set&&this.model&&!this.model.set(i,{silent:t.silent,serializing:!0})?!1:(e&&e.call(this,i,_.bind(ft,this)),i)},_preventDuplicateSubmission:function(e,t){e.preventDefault();var n=$(e.target);return(e.target.tagName||"").toLowerCase()!=="form"&&(n=$(e.target).closest("form")),n.attr("data-submit-wait")?!1:(n.attr("data-submit-wait","true"),t&&t.call(this,e),!0)},populate:function(e,t){t=_.extend({children:!0},t||{});var n,e=e||this._getContext();ut(this,t,function(t){at(e,t.name,{mode:"populate"},function(e,r){n=e&&e[r];if(!_.isUndefined(n)){var i=t.type==="checkbox"||t.type==="radio";i&&_.isBoolean(n)?t.checked=n:i?t.checked=n==t.value:t.value=n}})}),++this._populateCount,t._silent||this.trigger("populate",e)},validateInput:function(){},_getInputValue:function(e){if(e.type!=="checkbox"&&e.type!=="radio"){if(e.multiple===!0){var t=[];return $("option",e).each(function(){this.selected&&t.push(this.value)}),t}return e.value}if(e.checked)return e.getAttribute("value")||!0},_populateCount:0}),i.View.on({"before:rendered":function(){if(!this._renderCount||(this.model&&this.model.cid)!==this._formModelCid)return;var e=this.getObjectOptions(this.model);this.previousFormData=st(this.serialize(_.extend({set:!1,validate:!1,_silent:!0},e)),function(e){return e!==""&&e!=null})},rendered:function(){var e=lt(this);e&&!this._isChanging&&!this._populateCount&&this.populate(!e.context&&this.model.attributes,e),this.previousFormData&&this.populate(this.previousFormData,_.extend({_silent:!0},e)),this._formModelCid=this.model&&this.model.cid,this.previousFormData=null}}),i.View.on({invalid:ot,error:ot,deactivated:function(){this.$el&&ft.call(this)}});var ct="data-layout-cid";i.LayoutView=i.View.extend({_defaultTemplate:Handlebars.VM.noop,render:function(){var e=i.View.prototype.render.apply(this,arguments);return this.template===Handlebars.VM.noop?pt.call(this):dt.call(this),e},setView:function(e,t){t=_.extend({scroll:!0},t||{}),_.isString(e)&&(e=new(i.Util.registryGet(i,"Views",e,!1))),this.ensureRendered();var n=this._view,r,s,o;return e===n?!1:(this.trigger("change:view:start",e,n,t),s=_.bind(function(){n&&(n.$el&&n.$el.remove(),ht.call(n,"deactivated",t),this._removeChild(n))},this),r=_.bind(function(){if(e){e.ensureRendered(),ht.call(this,"activated",t),e.trigger("activated",t),this._view=e;var n=vt.call(this);this._view.appendTo(n),this._addChild(e)}else this._view=undefined},this),o=_.bind(function(){this.trigger("change:view:end",e,n,t)},this),t.transition?t.transition(e,n,r,s,o):(s(),r(),o()),e)},getView:function(){return this._view}}),Handlebars.registerHelper("layout-element",function(e){var t=w(e).view;if(!t.getView)throw new Error(u("layout-element-helper"));return e.hash[ct]=t.cid,E(e.hash),new Handlebars.SafeString(i.Util.tag.call(this,e.hash,"",this))}),i.CollectionHelperView=i.CollectionView.extend({events:{"rendered:item":mt("rendered:item"),"rendered:collection":mt("rendered:collection"),"rendered:empty":mt("rendered:empty")},getCollectionElement:function(){return this.$el},constructor:function(e){e.options["item-template"]&&(e.itemTemplate=i.Util.getTemplate(e.options["item-template"])),e.options["empty-template"]&&(e.emptyTemplate=i.Util.getTemplate(e.options["empty-template"])),!e.itemTemplate&&e.template&&e.template!==Handlebars.VM.noop&&(e.itemTemplate=e.template,e.template=Handlebars.VM.noop),!e.emptyTemplate&&e.inverse&&e.inverse!==Handlebars.VM.noop&&(e.emptyTemplate=e.inverse,e.inverse=Handlebars.VM.noop);var t=_.isFunction(e.itemContext),n=_.isFunction(e.itemFilter),r=i.HelperView.call(this,e);return t?this.itemContext=_.bind(this.itemContext,this.parent):_.isString(this.itemContext)&&(this.itemContext=_.bind(this.parent[this.itemContext],this.parent)),n?this.itemFilter=_.bind(this.itemFilter,this.parent):_.isString(this.itemFilter)&&(this.itemFilter=_.bind(this.parent[this.itemFilter],this.parent)),this.parent.name&&(!this.emptyView&&!this.parent.renderEmpty&&(this.emptyView=i.Util.getViewClass(this.parent.name+"-empty",!0)),!this.emptyTemplate&&!this.parent.renderEmpty&&(this.emptyTemplate=i.Util.getTemplate(this.parent.name+"-empty",!0)),!this.itemView&&!this.parent.renderItem&&(this.itemView=i.Util.getViewClass(this.parent.name+"-item",!0)),!this.itemTemplate&&!this.parent.renderItem&&(this.itemTemplate=i.Util.getTemplate(this.parent.name+"-item",!!this.itemView))),r},setAsPrimaryCollectionHelper:function(){_.each(gt,function(e){yt.call(this,e)},this);var e=this;_.each(["itemFilter","itemContext","renderItem","renderEmpty"],function(t){e.parent[t]&&(e[t]=function(){return e.parent[t].apply(e.parent,arguments)})})}}),_.extend(i.CollectionHelperView.prototype,D),i.CollectionHelperView.attributeWhiteList={"item-context":"itemContext","item-filter":"itemFilter","item-template":"itemTemplate","empty-template":"emptyTemplate","item-view":"itemView","empty-view":"emptyView","empty-class":"emptyClass"};var gt=["itemTemplate","itemView","emptyTemplate","emptyView"];Handlebars.registerViewHelper("collection",i.CollectionHelperView,function(e,t){arguments.length===1&&(t=e,e=t.parent.collection,e&&t.setAsPrimaryCollectionHelper(),t.$el.attr(K,"true"),t.listenTo(t.parent,"change:data-object",function(e,n){e==="collection"&&(t.setAsPrimaryCollectionHelper(),t.setCollection(n))})),e&&t.setCollection(e)}),Handlebars.registerHelper("collection-element",function(e){if(!w(e).view.renderCollection)throw new Error(u("collection-element-helper"));var t=e.hash;return E(t),t.tagName=t.tagName||"div",t[K]=!0,new Handlebars.SafeString(i.Util.tag.call(this,t,"",this))}),Handlebars.registerHelper("empty",function(e,t){arguments.length===1&&(t=e);var n=w(t).view;return arguments.length===1&&(e=n.model),n._emptyListeners||(n._emptyListeners={}),e&&!n._emptyListeners[e.cid]&&e.models&&"length"in e&&(n._emptyListeners[e.cid]=!0,n.listenTo(e,"remove",function(){e.length===0&&n.render()}),n.listenTo(e,"add",function(){e.length===1&&n.render()}),n.listenTo(e,"reset",function(){n.render()})),!e||e.isEmpty()?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("template",function(e,t){var n=_.extend({fn:t&&t.fn},this,t?t.hash:{}),r=w(t).view.renderTemplate(e,n);return new Handlebars.SafeString(r)}),Handlebars.registerHelper("yield",function(e){return w(e).yield&&e.data.yield()}),Handlebars.registerHelper("url",function(e){e=e||"";var t;if(arguments.length>2)t=_.map(_.head(arguments,arguments.length-1),encodeURIComponent).join("/");else{var n=arguments[1],r=n&&n.hash||n;r&&r["expand-tokens"]?t=i.Util.expandToken(e,this):t=e}if(Backbone.history._hasPushState){var s=Backbone.history.options.root;return s==="/"&&t.substr(0,1)==="/"?t:s+t}return"#"+t}),Handlebars.registerViewHelper("view",{factory:function(e,t){var n=e.length>=1?e[0]:i.View;return i.Util.getViewInstance(n,t.options)},modifyHTMLAttributes:function(e,t){e.tagName=t.el.tagName.toLowerCase()},callback:function(e){var t=arguments[arguments.length-1],n=t._helperOptions.options,r=t.cid;if(!_.isString(e)&&n.hash&&_.keys(n.hash).length>0)throw new Error(u("view-helper-hash-args"));n.fn&&(M[r]=n.fn)}});var bt="data-call-method",wt="data-trigger-event";Handlebars.registerHelper("button",function(e,t){arguments.length===1&&(t=e,e=t.hash.method);var n=t.hash,r=n["expand-tokens"];delete n["expand-tokens"];if(!e&&!t.hash.trigger)throw new Error(u("button-trigger"));return E(n),n.tagName=n.tagName||"button",n.trigger&&(n[wt]=n.trigger),delete n.trigger,e&&(n[bt]=e),new Handlebars.SafeString(i.Util.tag(n,t.fn?t.fn(this):"",r?this:null))}),Handlebars.registerHelper("link",function(){var e=_.toArray(arguments),t=e.pop(),n=t.hash,r=e.length===0?[n.href]:e,s=n["expand-tokens"];delete n["expand-tokens"];if(!r[0]&&r[0]!=="")throw new Error(u("link-href"));return E(n),r.push(t),n.href=Handlebars.helpers.url.apply(this,r),n.tagName=n.tagName||"a",n.trigger&&(n[wt]=t.hash.trigger),delete n.trigger,n[bt]="_anchorClick",new Handlebars.SafeString(i.Util.tag(n,t.fn?t.fn(this):"",s?this:null))});var Et="["+bt+"], ["+wt+"]",xt;$(document).ready(function(){i._fastClickEventName||Tt()});var Ct="data-element-tmp";Handlebars.registerHelper("element",function(e,t){E(t.hash);var n=_.uniqueId("element"),r=w(t).view;return t.hash[Ct]=n,r._elementsByCid||(r._elementsByCid={}),r._elementsByCid[n]=e,new Handlebars.SafeString(i.Util.tag(t.hash))}),i.View.on("append",function(e,t){(e||this.$el).find("["+Ct+"]").forEach(function(e){var n=$(e),r=n.attr(Ct),i=this._elementsByCid[r];_.isFunction(i)&&(i=i.call(this)),n.replaceWith(i),t&&t(i)},this)}),Handlebars.registerHelper("super",function(e){var t=w(e).view,n=t.constructor&&t.constructor.__super__;if(n){var r=n.template;if(!r){if(!n.name)throw new Error(u("super-parent"));r=n.name}return _.isString(r)&&(r=i.Util.getTemplate(r,!1)),new Handlebars.SafeString(r(this,e))}return""});var kt="load:start",Lt="load:end",At;i.setRootObject=function(e){At=e},i.loadHandler=function(e,t,n){var r=_.uniqueId("load");return function(s,o,u){function l(){if(f.timeout&&!f.run)return;var t=a._loadingTimeoutDuration!==undefined?a._loadingTimeoutDuration:i.View.prototype._loadingTimeoutDuration;f.timeout=setTimeout(function(){try{f.events.length&&(f.run=!0,e.call(a,f.message,f.background,f))}catch(t){i.onException("loadStart",t)}},t*1e3)}var a=n||this;a._loadInfo=a._loadInfo||{};var f=a._loadInfo[r];f?(clearTimeout(f.endTimeout),f.message=s,!o&&f.background&&(f.background=!1,l())):(f=a._loadInfo[r]=_.extend({isLoading:function(){return f.events.length},cid:r,events:[],timeout:0,message:s,background:!!o},Backbone.Events),l());if(_.indexOf(f.events,u)>=0)return;f.events.push(u),u.on(Lt,function c(){var e=a._loadingTimeoutEndDuration;e===void 0&&(e=i.View.prototype._loadingTimeoutEndDuration);var n=f.events,s=_.indexOf(n,u);s>=0&&!u.isLoading()&&(n.splice(s,1),_.indexOf(n,u)<0&&u.off(Lt,c)),n.length||(clearTimeout(f.endTimeout),f.endTimeout=setTimeout(function(){try{n.length||(f.run&&(t&&t.call(a,f.background,f),f.trigger(Lt,f)),clearTimeout(f.timeout),f=a._loadInfo[r]=undefined)}catch(e){i.onException("loadEnd",e)}},e*1e3))})}},i.forwardLoadEvents=function(e,t,n){function r(i,s,o){n&&e.off(kt,r),t.trigger(kt,i,s,o)}return e.on(kt,r),{off:function(){e.off(kt,r)}}},i.mixinLoadable=function(e,t){_.extend(e,{_loadingClassName:"loading",_loadingTimeoutDuration:.33,_loadingTimeoutEndDuration:.1,onLoadStart:function(e,n,r){var i=t?this.parent:this;if(!i||!i.el)return;!i.nonBlockingLoad&&!n&&At&&At!==this&&At.trigger(kt,e,n,r),i._isLoading=!0,$(i.el).addClass(i._loadingClassName),i.trigger("change:load-state","start",n)},onLoadEnd:function(){var e=t?this.parent:this;if(!e||!e.el)return;e._isLoading=!1,$(e.el).removeClass(e._loadingClassName),e.trigger("change:load-state","end")}})},i.mixinLoadableEvents=function(e,t){_.extend(e,{_loadCount:0,isLoading:function(){return this._loadCount>0},loadStart:function(e,n){this._loadCount++;var r=t?this.parent:this;r.trigger(kt,e,n,r)},loadEnd:function(){this._loadCount--;var e=t?this.parent:this;e.trigger(Lt,e)}})},i.mixinLoadable(i.View.prototype),i.mixinLoadableEvents(i.View.prototype),i.HelperView&&(i.mixinLoadable(i.HelperView.prototype,!0),i.mixinLoadableEvents(i.HelperView.prototype,!0)),i.CollectionHelperView&&(i.mixinLoadable(i.CollectionHelperView.prototype,!0),i.mixinLoadableEvents(i.CollectionHelperView.prototype,!0)),i.sync=function(e,t,n){var r=this,i=n.complete;return n.complete=function(){r._request=undefined,r._aborted=!1,i&&i.apply(this,arguments)},this._request=Backbone.sync.apply(this,arguments),this._request};var Pt=[];i.Model&&Pt.push(i.Model),i.Collection&&Pt.push(i.Collection),_.each(Pt,function(e){var t=e.prototype.fetch;i.mixinLoadableEvents(e.prototype,!1),_.extend(e.prototype,{sync:i.sync,fetch:function(n){n=n||{},e===i.Collection&&(_.find(["reset","remove","add","update"],function(e){return!_.isUndefined(n[e])})||(n.reset=!0));if(!n.loadTriggered){var r=this;function s(e){var t=n[e];n[e]=function(){r.loadEnd(),t&&t.apply(this,arguments)}}s("success"),s("error"),r.loadStart(undefined,n.background)}return _t.call(this,n||{},t)},load:function(e,t,n){arguments.length===2&&!_.isFunction(t)&&(n=t,t=!1),n=n||{},!n.background&&!this.isPopulated()&&At&&(this.isLoading()?At.trigger(kt,n.message,n.background,this):i.forwardLoadEvents(this,At,!0)),Mt.call(this,e,t,n)}})}),i.Util.bindToRoute=Ot,i.View.prototype._modifyDataObjectOptions=function(e,t){return t.ignoreErrors=this.ignoreFetchError,t.background=this.nonBlockingLoad,t},i.HelperView.prototype._modifyDataObjectOptions=i.CollectionHelperView.prototype._modifyDataObjectOptions=function(e,t){return t.ignoreErrors=this.parent.ignoreFetchError,t.background=this.parent.nonBlockingLoad,t},p.collection.loading=function(){var e=this.loadingView,t=this.loadingTemplate,n=this.loadingPlacement;if(e||t){var r=i.loadHandler(_.bind(function(){var r;this.collection.length===0&&this.$el.empty();if(e){var s=i.Util.getViewInstance(e);this._addChild(s),t?s.render(t):s.render(),r=s}else r=this.renderTemplate(t);var o=n?n.call(this):this.collection.length;this.appendItem(r,o),this.$el.children().eq(o).attr("data-loading-element",this.collection.cid)},this),_.bind(function(){this.$el.find('[data-loading-element="'+this.collection.cid+'"]').remove()},this),this.collection);this.listenTo(this.collection,"load:start",r)}},i.CollectionHelperView&&_.extend(i.CollectionHelperView.attributeWhiteList,{"loading-template":"loadingTemplate","loading-view":"loadingView","loading-placement":"loadingPlacement"}),i.View.on({"load:start":i.loadHandler(function(e,t,n){this.onLoadStart(e,t,n)},function(e,t){this.onLoadEnd(t)}),collection:{"load:start":function(e,t,n){this.trigger(kt,e,t,n)}},model:{"load:start":function(e,t,n){this.trigger(kt,e,t,n)}}}),Handlebars.registerHelper("loading",function(e){var t=w(e).view;return t.off("change:load-state",Ht,t),t.on("change:load-state",Ht,t),t._isLoading?e.fn(this):e.inverse(this)});var Bt=navigator.userAgent.match(/(iPhone|iPod|iPad)/i),jt=navigator.userAgent.toLowerCase().indexOf("android")>-1?1:0,Ft=jt?1:0;i.Util.scrollTo=function(e,t){function n(){window.scrollTo(e,t)}return t=t||Ft,Bt?_.defer(n):n(),[e,t]},i.LayoutView.on("change:view:end",function(e,t,n){n&&n.scroll&&i.Util.scrollTo(0,0)}),i.Util.scrollToTop=function(){return this.scrollTo(0,0)},C(["singleTap","doubleTap","longTap","swipe","swipeUp","swipeDown","swipeLeft","swipeRight"]),i.View.on({"submit form":function(){var e=$(":focus")[0];e&&e.blur()}}),$.fn.tapHoldAndEnd=function(e,t,n){return this.each(function(){function o(e){clearTimeout(i),r&&s&&n(s),s=undefined,r=!1}var r,i,s;$(this).on("touchstart",e,function(e){o(),s=e.currentTarget,i=setTimeout(function(){r=!0,t(s)},50)}).on("touchmove touchend",o),$(document).on("touchcancel",o)})};var It=!jt;i.configureTapHighlight=function(e,t){It=e,t=t||"tap-highlight";if(!e){function n(e){var n=e&&e.tagName.toLowerCase();if(n==="input"||n==="select"||n==="textarea")e=$(e).closest("[data-tappable=true]")[0]||e;if(e)return $(e).addClass(t),!1}function r(){$("."+t).removeClass(t)}$(document.body).tapHoldAndEnd("[data-tappable=true], a, input, button, select, textarea",n,r)}};var qt={A:!0,INPUT:!0,BUTTON:!0,SELECT:!0,TEXTAREA:!0};i.View.on({rendered:Ut,"rendered:collection":Ut,"rendered:item":Ut,"rendered:empty":Ut});var zt=i.View.prototype._addEvent;i.View.prototype._addEvent=function(e){return this._domEvents=this._domEvents||[],e.type==="DOM"&&this._domEvents.push(e.originalName),zt.call(this,e)}})()