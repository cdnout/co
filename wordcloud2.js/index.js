"use strict";window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],i="zero-timeout-message";return window.addEventListener("message",function(t){"string"==typeof t.data&&t.data.substr(0,i.length)===i&&(t.stopImmediatePropagation(),t=parseInt(t.data.substr(i.length),36),a[t]&&(a[t](),a[t]=void 0))},!0),window.clearImmediate=function(t){a[t]&&(a[t]=void 0)},function(t){var e=a.length;return a.push(t),window.postMessage(i+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}),function(t){function e(T,t){if(n){Array.isArray(T)||(T=[T]),T.forEach(function(t,e){if("string"==typeof t){if(T[e]=document.getElementById(t),!T[e])throw new Error("The element id specified is not found.")}else if(!t.tagName&&!t.appendChild)throw new Error("You must pass valid HTML elements, or ID of the element.")});var e,k={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var a in t)a in k&&(k[a]=t[a]);if("function"!=typeof k.weightFactor&&(e=k.weightFactor,k.weightFactor=function(t){return t*e}),"function"!=typeof k.shape)switch(k.shape){case"circle":default:k.shape="circle";break;case"cardioid":k.shape=function(t){return 1-Math.sin(t)};break;case"diamond":k.shape=function(t){t%=2*Math.PI/4;return 1/(Math.cos(t)+Math.sin(t))};break;case"square":k.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":k.shape=function(t){t%=2*Math.PI/3;return 1/(Math.cos(t)+Math.sqrt(3)*Math.sin(t))};break;case"triangle":case"triangle-upright":k.shape=function(t){t=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(t)+Math.sqrt(3)*Math.sin(t))};break;case"pentagon":k.shape=function(t){t=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(t)+.726543*Math.sin(t))};break;case"star":k.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}k.gridSize=Math.max(Math.floor(k.gridSize),4);var I,y,C,m,S,w,E,F,P=k.gridSize,g=P-k.maskGapWidth,o=Math.abs(k.maxRotation-k.minRotation),s=Math.abs(Math.floor(k.rotationSteps)),l=Math.min(k.maxRotation,k.minRotation);switch(k.color){case"random-dark":E=function(){return r(10,50)};break;case"random-light":E=function(){return r(50,90)};break;default:"function"==typeof k.color&&(E=k.color)}"function"==typeof k.fontWeight&&(F=k.fontWeight);var R=null;"function"==typeof k.classes&&(R=k.classes);var v,M=!1,p=[],i=function(t){var e=t.currentTarget,a=e.getBoundingClientRect(),t=t.touches?(i=t.touches[0].clientX,t.touches[0].clientY):(i=t.clientX,t.clientY),i=i-a.left,t=t-a.top,i=Math.floor(i*(e.width/a.width||1)/P),a=Math.floor(t*(e.height/a.height||1)/P);return p[i][a]},x=function(t){var e=i(t);v!==e&&((v=e)?k.hover(e.item,e.dimension,t):k.hover(void 0,void 0,t))},b=function(t){var e=i(t);e&&(k.click(e.item,e.dimension,t),t.preventDefault())},d=[],O=function(){return 0<k.abortThreshold&&(new Date).getTime()-w>k.abortThreshold},z=function(t,e,a,i,o,r){var n,s,l=o.occupied,d=k.drawMask;d&&((n=T[0].getContext("2d")).save(),n.fillStyle=k.maskColor),M&&(s={x:(t+(o=o.bounds)[3])*P,y:(e+o[0])*P,w:(o[1]-o[3]+1)*P,h:(o[2]-o[0]+1)*P});for(var f,c,h,u=l.length;u--;){var m=t+l[u][0],w=e+l[u][1];y<=m||C<=w||m<0||w<0||(f=w,c=d,h=s,w=r,y<=(m=m)||C<=f||m<0||f<0||(I[m][f]=!1,c&&T[0].getContext("2d").fillRect(m*P,f*P,g,g),M&&(p[m][f]={item:w,dimension:h})))}d&&n.restore()},A=function t(r){var n,v,M;Array.isArray(r)?(n=r[0],v=r[1]):(n=r.word,v=r.weight,M=r.attributes);var p=0===k.rotateRatio||Math.random()>k.rotateRatio?0:0===o?l:0<s?l+Math.floor(Math.random()*s)*o/(s-1):l+Math.random()*o,x=function(t,e,a){var i=k.weightFactor(e);if(i<=k.minSize)return!1;var o,r=1;i<L&&(r=function(){for(var t=2;t*i<L;)t+=2;return t}()),o=F?F(t,e,i):k.fontWeight;var n=document.createElement("canvas"),s=n.getContext("2d",{willReadFrequently:!0});s.font=o+" "+(i*r).toString(10)+"px "+k.fontFamily;var l=s.measureText(t).width/r,d=Math.max(i*r,s.measureText("m").width,s.measureText("Ｗ").width)/r,f=l+2*d,c=3*d,h=Math.ceil(f/P),e=Math.ceil(c/P),f=h*P,c=e*P,h=-l/2,e=.4*-d,u=Math.ceil((f*Math.abs(Math.sin(a))+c*Math.abs(Math.cos(a)))/P),f=Math.ceil((f*Math.abs(Math.cos(a))+c*Math.abs(Math.sin(a)))/P),m=f*P,c=u*P;n.setAttribute("width",m),n.setAttribute("height",c),s.scale(1/r,1/r),s.translate(m*r/2,c*r/2),s.rotate(-a),s.font=o+" "+(i*r).toString(10)+"px "+k.fontFamily,s.fillStyle="#000",s.textBaseline="middle",s.fillText(t,h*r,(e+.5*i)*r);var w=s.getImageData(0,0,m,c).data;if(O())return!1;for(var g,v,M,p=[],x=f,b=[u/2,f/2,u/2,f/2];x--;)for(g=u;g--;){M=P;t:for(;M--;)for(v=P;v--;)if(w[4*((g*P+M)*m+(x*P+v))+3]){p.push([x,g]),x<b[3]&&(b[3]=x),x>b[1]&&(b[1]=x),g<b[0]&&(b[0]=g),g>b[2]&&(b[2]=g);break t}0}return{mu:r,occupied:p,bounds:b,gw:f,gh:u,fillTextOffsetX:h,fillTextOffsetY:e,fillTextWidth:l,fillTextHeight:d,fontSize:i}}(n,v,p);if(!x)return!1;if(O())return!1;if(!k.drawOutOfBound&&!k.shrinkToFit){var e=x.bounds;if(e[1]-e[3]+1>y||e[2]-e[0]+1>C)return!1}for(var b=S+1,a=function(t){var s,l,d,f,e,a,c,h,u,m,w,g,i=Math.floor(t[0]-x.gw/2),o=Math.floor(t[1]-x.gh/2);x.gw,x.gh;return!!function(t,e,a){for(var i=a.length;i--;){var o=t+a[i][0],r=e+a[i][1];if(y<=o||C<=r||o<0||r<0){if(!k.drawOutOfBound)return!1}else if(!I[o][r])return!1}return!0}(i,o,x.occupied)&&(s=i,l=o,d=x,f=n,e=v,a=S-b,t=t[2],c=p,h=M,u=d.fontSize,m=E?E(f,e,u,a,t):k.color,w=F?F(f,e,u):k.fontWeight,g=R?R(f,e,u):k.classes,T.forEach(function(t){if(t.getContext){var e=t.getContext("2d"),a=d.mu;e.save(),e.scale(1/a,1/a),e.font=w+" "+(u*a).toString(10)+"px "+k.fontFamily,e.fillStyle=m,e.translate((s+d.gw/2)*P*a,(l+d.gh/2)*P*a),0!==c&&e.rotate(-c),e.textBaseline="middle",e.fillText(f,d.fillTextOffsetX*a,(d.fillTextOffsetY+.5*u)*a),e.restore()}else{var i=document.createElement("span"),e="",e="rotate("+-c/Math.PI*180+"deg) ";1!==d.mu&&(e+="translateX(-"+d.fillTextWidth/4+"px) scale("+1/d.mu+")");var o,r={position:"absolute",display:"block",font:w+" "+u*d.mu+"px "+k.fontFamily,left:(s+d.gw/2)*P+d.fillTextOffsetX+"px",top:(l+d.gh/2)*P+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",lineHeight:u+"px",whiteSpace:"nowrap",transform:e,webkitTransform:e,msTransform:e,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(o in m&&(r.color=m),i.textContent=f,r)i.style[o]=r[o];if(h)for(var n in h)i.setAttribute(n,h[n]);g&&(i.className+=g),t.appendChild(i)}}),z(i,o,0,0,x,r),!0)};b--;){var i=function(t){if(d[t])return d[t];var e=8*t,a=e,i=[];for(0===t&&i.push([m[0],m[1],0]);a--;){var o=1;"circle"!==k.shape&&(o=k.shape(a/e*2*Math.PI)),i.push([m[0]+t*o*Math.cos(-a/e*2*Math.PI),m[1]+t*o*Math.sin(-a/e*2*Math.PI)*k.ellipticity,a/e*2*Math.PI])}return d[t]=i}(S-b);if(k.shuffle&&function(t){for(var e,a,i=t.length;i;)e=Math.floor(Math.random()*i),a=t[--i],t[i]=t[e],t[e]=a}(i=[].concat(i)),i.some(a))return!0}return!!k.shrinkToFit&&(Array.isArray(r)?r[1]=3*r[1]/4:r.weight=3*r.weight/4,t(r))},W=function(a,t,i){if(t)return!T.some(function(t){var e=new CustomEvent(a,{detail:i||{}});return!t.dispatchEvent(e)},this);T.forEach(function(t){var e=new CustomEvent(a,{detail:i||{}});t.dispatchEvent(e)},this)};!function(){var t,a,i,o,e=T[0];if(C=e.getContext?(y=Math.ceil(e.width/P),Math.ceil(e.height/P)):(r=e.getBoundingClientRect(),y=Math.ceil(r.width/P),Math.ceil(r.height/P)),W("wordcloudstart",!0)){if(m=k.origin?[k.origin[0]/P,k.origin[1]/P]:[y/2,C/2],S=Math.floor(Math.sqrt(y*y+C*C)),I=[],!e.getContext||k.clearCanvas)for(T.forEach(function(t){var e;t.getContext?((e=t.getContext("2d")).fillStyle=k.backgroundColor,e.clearRect(0,0,y*(P+1),C*(P+1)),e.fillRect(0,0,y*(P+1),C*(P+1))):(t.textContent="",t.style.backgroundColor=k.backgroundColor,t.style.position="relative")}),f=y;f--;)for(I[f]=[],t=C;t--;)I[f][t]=!0;else{var r=document.createElement("canvas").getContext("2d");r.fillStyle=k.backgroundColor,r.fillRect(0,0,1,1);for(var n,s,l=r.getImageData(0,0,1,1).data,d=e.getContext("2d").getImageData(0,0,y*P,C*P).data,f=y;f--;)for(I[f]=[],t=C;t--;){s=P;t:for(;s--;)for(n=P;n--;)for(a=4;a--;)if(d[4*((t*P+s)*y*P+(f*P+n))+a]!==l[a]){I[f][t]=!1;break t}!1!==I[f][t]&&(I[f][t]=!0)}d=r=l=void 0}if(k.hover||k.click){for(M=!0,f=y+1;f--;)p[f]=[];k.hover&&e.addEventListener("mousemove",x),k.click&&(e.addEventListener("click",b),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",x),e.removeEventListener("click",b),v=void 0})}o=(a=0)!==k.wait?(i=window.setTimeout,window.clearTimeout):(i=window.setImmediate,window.clearImmediate);var c=function(e,a){T.forEach(function(t){t.removeEventListener(e,a)},this)},h=function t(){c("wordcloudstart",t),o(u)};!function(e,a){T.forEach(function(t){t.addEventListener(e,a)},this)}("wordcloudstart",h);var u=i(function t(){if(a>=k.list.length)return o(u),W("wordcloudstop",!1),void c("wordcloudstart",h);w=(new Date).getTime();var e=A(k.list[a]),e=!W("wordclouddrawn",!0,{item:k.list[a],drawn:e});if(O()||e)return o(u),k.abort(),W("wordcloudabort",!1),W("wordcloudstop",!1),void c("wordcloudstart",h);a++,u=i(t,k.wait)},k.wait)}}()}function r(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}}var n=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;t=t.getContext("2d");return!!t&&(!!t.getImageData&&(!!t.fillText&&(!!Array.prototype.some&&!!Array.prototype.push)))}(),L=function(){if(n){for(var t,e,a=document.createElement("canvas").getContext("2d"),i=20;i;){if(a.font=i.toString(10)+"px sans-serif",a.measureText("Ｗ").width===t&&a.measureText("m").width===e)return i+1;t=a.measureText("Ｗ").width,e=a.measureText("m").width,i--}return 0}}();e.isSupported=n,e.minFontSize=L,"function"==typeof define&&define.amd?(t.WordCloud=e,define("wordcloud",[],function(){return e})):"undefined"!=typeof module&&module.exports?module.exports=e:t.WordCloud=e}(this);