var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getAugmentedNamespace(r){if(r.__esModule)return r;var i=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(i,e,t.get?t:{enumerable:!0,get:function(){return r[e]}})}),i}var common$1={};!function(t){var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t,r,i=Array.prototype.slice.call(arguments,1);i.length;){var n=i.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var a in n)t=n,r=a,Object.prototype.hasOwnProperty.call(t,r)&&(e[a]=n[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,r,i,n){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+i),n);else for(var a=0;a<i;a++)e[n+a]=t[r+a]},flattenChunks:function(e){for(var t,r,i,n=0,a=0,s=e.length;a<s;a++)n+=e[a].length;for(i=new Uint8Array(n),a=t=0,s=e.length;a<s;a++)r=e[a],i.set(r,t),t+=r.length;return i}},i={arraySet:function(e,t,r,i,n){for(var a=0;a<i;a++)e[n+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(e)}(common$1);var deflate$4={},deflate$3={},trees$1={},utils$6=common$1,Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(e){for(var t=e.length;0<=--t;)e[t]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES$1+2));zero$1(static_ltree);var static_dtree=new Array(2*D_CODES$1);zero$1(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);var _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);var base_length=new Array(LENGTH_CODES$1);zero$1(base_length);var static_l_desc,static_d_desc,static_bl_desc,base_dist=new Array(D_CODES$1);function StaticTreeDesc(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function d_code(e){return e<256?_dist_code[e]:_dist_code[256+(e>>>7)]}function put_short(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function send_bits(e,t,r){e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function send_code(e,t,r){send_bits(e,r[2*t],r[2*t+1])}function bi_reverse(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function bi_flush(e){16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function gen_bitlen(e,t){for(var r,i,n,a,s,o=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,f=0,m=0;m<=MAX_BITS$1;m++)e.bl_count[m]=0;for(o[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<HEAP_SIZE$1;r++)p<(m=o[2*o[2*(i=e.heap[r])+1]+1]+1)&&(m=p,f++),o[2*i+1]=m,l<i||(e.bl_count[m]++,a=0,d<=i&&(a=u[i-d]),s=o[2*i],e.opt_len+=s*(m+a),h&&(e.static_len+=s*(c[2*i+1]+a)));if(0!==f){do{for(m=p-1;0===e.bl_count[m];)m--}while(e.bl_count[m]--,e.bl_count[m+1]+=2,e.bl_count[p]--,0<(f-=2));for(m=p;0!==m;m--)for(i=e.bl_count[m];0!==i;)l<(n=e.heap[--r])||(o[2*n+1]!==m&&(e.opt_len+=(m-o[2*n+1])*o[2*n],o[2*n+1]=m),i--)}}function gen_codes(e,t,r){for(var i,n=new Array(MAX_BITS$1+1),a=0,s=1;s<=MAX_BITS$1;s++)n[s]=a=a+r[s-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=bi_reverse(n[o]++,o))}}function tr_static_init(){for(var e,t,r,i=new Array(MAX_BITS$1+1),n=0,a=0;a<LENGTH_CODES$1-1;a++)for(base_length[a]=n,e=0;e<1<<extra_lbits[a];e++)_length_code[n++]=a;for(_length_code[n-1]=a,a=r=0;a<16;a++)for(base_dist[a]=r,e=0;e<1<<extra_dbits[a];e++)_dist_code[r++]=a;for(r>>=7;a<D_CODES$1;a++)for(base_dist[a]=r<<7,e=0;e<1<<extra_dbits[a]-7;e++)_dist_code[256+r++]=a;for(t=0;t<=MAX_BITS$1;t++)i[t]=0;for(e=0;e<=143;)static_ltree[2*e+1]=8,e++,i[8]++;for(;e<=255;)static_ltree[2*e+1]=9,e++,i[9]++;for(;e<=279;)static_ltree[2*e+1]=7,e++,i[7]++;for(;e<=287;)static_ltree[2*e+1]=8,e++,i[8]++;for(gen_codes(static_ltree,L_CODES$1+1,i),e=0;e<D_CODES$1;e++)static_dtree[2*e+1]=5,static_dtree[2*e]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)}function init_block(e){for(var t=0;t<L_CODES$1;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D_CODES$1;t++)e.dyn_dtree[2*t]=0;for(t=0;t<BL_CODES$1;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*END_BLOCK]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function bi_windup(e){8<e.bi_valid?put_short(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function copy_block(e,t,r,i){bi_windup(e),i&&(put_short(e,r),put_short(e,~r)),utils$6.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function smaller(e,t,r,i){var n=2*t,a=2*r;return e[n]<e[a]||e[n]===e[a]&&i[t]<=i[r]}function pqdownheap(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&(n<e.heap_len&&smaller(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!smaller(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function compress_block(e,t,r){var i,n,a,s,o=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],n=e.pending_buf[e.l_buf+o],o++,0==i?send_code(e,n,t):(send_code(e,(a=_length_code[n])+LITERALS$1+1,t),0!==(s=extra_lbits[a])&&send_bits(e,n-=base_length[a],s),send_code(e,a=d_code(--i),r),0!==(s=extra_dbits[a])&&send_bits(e,i-=base_dist[a],s)),o<e.last_lit;);send_code(e,END_BLOCK,t)}function build_tree(e,t){var r,i,n,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=HEAP_SIZE$1,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,o&&(e.static_len-=s[2*n+1]);for(t.max_code=c,r=e.heap_len>>1;1<=r;r--)pqdownheap(e,a,r);for(n=l;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,a[2*n]=a[2*r]+a[2*i],e.depth[n]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,a[2*r+1]=a[2*i+1]=n,e.heap[1]=n++,pqdownheap(e,a,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(a,c,e.bl_count)}function scan_tree(e,t,r){var i,n,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=s,s=t[2*(i+1)+1],++o<l&&n===s||(o<c?e.bl_tree[2*n]+=o:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[2*REP_3_6]++):o<=10?e.bl_tree[2*REPZ_3_10]++:e.bl_tree[2*REPZ_11_138]++,a=n,c=(o=0)===s?(l=138,3):n===s?(l=6,3):(l=7,4))}function send_tree(e,t,r){var i,n,a=-1,s=t[1],o=0,l=7,c=4;for(0===s&&(l=138,c=3),i=0;i<=r;i++)if(n=s,s=t[2*(i+1)+1],!(++o<l&&n===s)){if(o<c)for(;send_code(e,n,e.bl_tree),0!=--o;);else 0!==n?(n!==a&&(send_code(e,n,e.bl_tree),o--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,o-3,2)):o<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,o-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,o-11,7));a=n,c=(o=0)===s?(l=138,3):n===s?(l=6,3):(l=7,4)}}function build_bl_tree(e){var t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES$1-1;3<=t&&0===e.bl_tree[2*bl_order[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function send_all_trees(e,t,r,i){var n;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,i-4,4),n=0;n<i;n++)send_bits(e,e.bl_tree[2*bl_order[n]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)}function detect_data_type(e){for(var t=4093624447,r=0;r<=31;r++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*r])return Z_BINARY;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Z_TEXT;for(r=32;r<LITERALS$1;r++)if(0!==e.dyn_ltree[2*r])return Z_TEXT;return Z_BINARY}zero$1(base_dist);var static_init_done=!1;function _tr_init(e){static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)}function _tr_stored_block(e,t,r,i){send_bits(e,(STORED_BLOCK<<1)+(i?1:0),3),copy_block(e,t,r,!0)}function _tr_align(e){send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)}function _tr_flush_block(e,t,r,i){var n,a,s=0;0<e.level?(e.strm.data_type===Z_UNKNOWN$1&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),s=build_bl_tree(e),n=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=n&&(n=a)):n=a=r+5,r+4<=n&&-1!==t?_tr_stored_block(e,t,r,i):e.strategy===Z_FIXED$1||a===n?(send_bits(e,(STATIC_TREES<<1)+(i?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(i?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),i&&bi_windup(e)}function _tr_tally(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(_length_code[r]+LITERALS$1+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1}function adler32$2(e,t,r,i){for(var n=65535&e|0,a=e>>>16&65535|0,s=0;0!==r;){for(r-=s=2e3<r?2e3:r;a=a+(n=n+t[i++]|0)|0,--s;);n%=65521,a%=65521}return n|a<<16|0}trees$1._tr_init=_tr_init,trees$1._tr_stored_block=_tr_stored_block,trees$1._tr_flush_block=_tr_flush_block,trees$1._tr_tally=_tr_tally,trees$1._tr_align=_tr_align;var adler32_1=adler32$2;function makeTable(){for(var e=[],t=0;t<256;t++){for(var r=t,i=0;i<8;i++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}var crcTable=makeTable();function crc32$2(e,t,r,i){var n=crcTable,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^n[255&(e^t[s])];return-1^e}var configuration_table,crc32_1=crc32$2,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},utils$5=common$1,trees=trees$1,adler32$1=adler32_1,crc32$1=crc32_1,msg$2=messages,Z_NO_FLUSH$1=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH$2=4,Z_BLOCK$1=5,Z_OK$2=0,Z_STREAM_END$2=1,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_BUF_ERROR$1=-5,Z_DEFAULT_COMPRESSION$1=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED=4,Z_DEFAULT_STRATEGY$1=0,Z_UNKNOWN=2,Z_DEFLATED$2=8,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3;function err(e,t){return e.msg=msg$2[t],t}function rank(e){return(e<<1)-(4<e?9:0)}function zero(e){for(var t=e.length;0<=--t;)e[t]=0}function flush_pending(e){var t=e.state,r=t.pending;0!==(r=r>e.avail_out?e.avail_out:r)&&(utils$5.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function flush_block_only(e,t){trees._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)}function put_byte(e,t){e.pending_buf[e.pending++]=t}function putShortMSB(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function read_buf(e,t,r,i){var n=e.avail_in;return 0===(n=i<n?i:n)?0:(e.avail_in-=n,utils$5.arraySet(t,e.input,e.next_in,n,r),1===e.state.wrap?e.adler=adler32$1(e.adler,t,n,r):2===e.state.wrap&&(e.adler=crc32$1(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)}function longest_match(e,t){var r,i,n=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,c=e.window,h=e.w_mask,u=e.prev,d=e.strstart+MAX_MATCH,p=c[a+s-1],f=c[a+s];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(r=t)+s]===f&&c[r+s-1]===p&&c[r]===c[a]&&c[++r]===c[a+1]){for(a+=2,r++;c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&a<d;);if(i=MAX_MATCH-(d-a),a=d-MAX_MATCH,s<i){if(e.match_start=t,o<=(s=i))break;p=c[a+s-1],f=c[a+s]}}}while((t=u[t&h])>l&&0!=--n);return s<=e.lookahead?s:e.lookahead}function fill_window(e){var t,r,i,n,a,s=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-MIN_LOOKAHEAD)){for(utils$5.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=r=e.hash_size;i=e.head[--t],e.head[t]=s<=i?i-s:0,--r;);for(t=r=s;i=e.prev[--t],e.prev[t]=s<=i?i-s:0,--r;);n+=s}if(0===e.strm.avail_in)break;if(r=read_buf(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=MIN_MATCH)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+MIN_MATCH-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH)););}while(e.lookahead<MIN_LOOKAHEAD&&0!==e.strm.avail_in)}function deflate_stored(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE;if(e.strstart-e.block_start>=e.w_size-MIN_LOOKAHEAD&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),BS_NEED_MORE)}function deflate_fast(e,t){for(var r,i;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH)if(i=trees._tr_tally(e,e.strstart-e.match_start,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(e,t){for(var r,i,n;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH&&4096<e.strstart-e.match_start)&&(e.match_length=MIN_MATCH-1)),e.prev_length>=MIN_MATCH&&e.match_length<=e.prev_length){for(n=e.strstart+e.lookahead-MIN_MATCH,i=trees._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+MIN_MATCH-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=MIN_MATCH-1,e.strstart++,i&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}else if(e.match_available){if((i=trees._tr_tally(e,0,e.window[e.strstart-1]))&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=trees._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH-1?e.strstart:MIN_MATCH-1,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(e,t){for(var r,i,n,a,s=e.window;;){if(e.lookahead<=MAX_MATCH){if(fill_window(e),e.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$1)return BS_NEED_MORE;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=MIN_MATCH&&0<e.strstart&&(i=s[n=e.strstart-1])===s[++n]&&i===s[++n]&&i===s[++n]){for(a=e.strstart+MAX_MATCH;i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&n<a;);e.match_length=MAX_MATCH-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH?(r=trees._tr_tally(e,1,e.match_length-MIN_MATCH),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(e,t){for(var r;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===Z_NO_FLUSH$1)return BS_NEED_MORE;break}if(e.match_length=0,r=trees._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH$2?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}function lm_init(e){e.window_size=2*e.w_size,zero(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH-1,e.match_available=0,e.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new utils$5.Buf16(2*HEAP_SIZE),this.dyn_dtree=new utils$5.Buf16(2*(2*D_CODES+1)),this.bl_tree=new utils$5.Buf16(2*(2*BL_CODES+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new utils$5.Buf16(MAX_BITS+1),this.heap=new utils$5.Buf16(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new utils$5.Buf16(2*L_CODES+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,e.adler=2===t.wrap?0:1,t.last_flush=Z_NO_FLUSH$1,trees._tr_init(t),Z_OK$2):err(e,Z_STREAM_ERROR$1)}function deflateReset(e){var t=deflateResetKeep(e);return t===Z_OK$2&&lm_init(e.state),t}function deflateSetHeader(e,t){return!e||!e.state||2!==e.state.wrap?Z_STREAM_ERROR$1:(e.state.gzhead=t,Z_OK$2)}function deflateInit2(e,t,r,i,n,a){if(!e)return Z_STREAM_ERROR$1;var s=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),i<0?(s=0,i=-i):15<i&&(s=2,i-=16),n<1||MAX_MEM_LEVEL<n||r!==Z_DEFLATED$2||i<8||15<i||t<0||9<t||a<0||Z_FIXED<a)return err(e,Z_STREAM_ERROR$1);8===i&&(i=9);var o=new DeflateState;return(e.state=o).strm=e,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH-1)/MIN_MATCH),o.window=new utils$5.Buf8(2*o.w_size),o.head=new utils$5.Buf16(o.hash_size),o.prev=new utils$5.Buf16(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new utils$5.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=a,o.method=r,deflateReset(e)}function deflateInit(e,t){return deflateInit2(e,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1)}function deflate$2(e,t){var r,i,n,a;if(!e||!e.state||Z_BLOCK$1<t||t<0)return e?err(e,Z_STREAM_ERROR$1):Z_STREAM_ERROR$1;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===FINISH_STATE&&t!==Z_FINISH$2)return err(e,0===e.avail_out?Z_BUF_ERROR$1:Z_STREAM_ERROR$1);if(r.strm=e,s=r.last_flush,r.last_flush=t,r.status===INIT_STATE&&(2===r.wrap?(e.adler=0,put_byte(r,31),put_byte(r,139),put_byte(r,8),r.gzhead?(put_byte(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),put_byte(r,255&r.gzhead.time),put_byte(r,r.gzhead.time>>8&255),put_byte(r,r.gzhead.time>>16&255),put_byte(r,r.gzhead.time>>24&255),put_byte(r,9===r.level?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(put_byte(r,255&r.gzhead.extra.length),put_byte(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=crc32$1(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=EXTRA_STATE):(put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,0),put_byte(r,9===r.level?2:r.strategy>=Z_HUFFMAN_ONLY||r.level<2?4:0),put_byte(r,OS_CODE),r.status=BUSY_STATE)):(a=Z_DEFLATED$2+(r.w_bits-8<<4)<<8,a|=(r.strategy>=Z_HUFFMAN_ONLY||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(a|=PRESET_DICT),a+=31-a%31,r.status=BUSY_STATE,putShortMSB(r,a),0!==r.strstart&&(putShortMSB(r,e.adler>>>16),putShortMSB(r,65535&e.adler)),e.adler=1)),r.status===EXTRA_STATE)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>i&&(e.adler=crc32$1(e.adler,r.pending_buf,r.pending-i,i)),flush_pending(e),i=r.pending,r.pending!==r.pending_buf_size));)put_byte(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(e.adler=crc32$1(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=NAME_STATE)}else r.status=NAME_STATE;if(r.status===NAME_STATE)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=crc32$1(e.adler,r.pending_buf,r.pending-i,i)),flush_pending(e),i=r.pending,r.pending===r.pending_buf_size)){n=1;break}}while(n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,put_byte(r,n),0!==n);r.gzhead.hcrc&&r.pending>i&&(e.adler=crc32$1(e.adler,r.pending_buf,r.pending-i,i)),0===n&&(r.gzindex=0,r.status=COMMENT_STATE)}else r.status=COMMENT_STATE;if(r.status===COMMENT_STATE)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=crc32$1(e.adler,r.pending_buf,r.pending-i,i)),flush_pending(e),i=r.pending,r.pending===r.pending_buf_size)){n=1;break}}while(n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,put_byte(r,n),0!==n);r.gzhead.hcrc&&r.pending>i&&(e.adler=crc32$1(e.adler,r.pending_buf,r.pending-i,i)),0===n&&(r.status=HCRC_STATE)}else r.status=HCRC_STATE;if(r.status===HCRC_STATE&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&flush_pending(e),r.pending+2<=r.pending_buf_size&&(put_byte(r,255&e.adler),put_byte(r,e.adler>>8&255),e.adler=0,r.status=BUSY_STATE)):r.status=BUSY_STATE),0!==r.pending){if(flush_pending(e),0===e.avail_out)return r.last_flush=-1,Z_OK$2}else if(0===e.avail_in&&rank(t)<=rank(s)&&t!==Z_FINISH$2)return err(e,Z_BUF_ERROR$1);if(r.status===FINISH_STATE&&0!==e.avail_in)return err(e,Z_BUF_ERROR$1);if(0!==e.avail_in||0!==r.lookahead||t!==Z_NO_FLUSH$1&&r.status!==FINISH_STATE){var s=r.strategy===Z_HUFFMAN_ONLY?deflate_huff(r,t):r.strategy===Z_RLE?deflate_rle(r,t):configuration_table[r.level].func(r,t);if(s!==BS_FINISH_STARTED&&s!==BS_FINISH_DONE||(r.status=FINISH_STATE),s===BS_NEED_MORE||s===BS_FINISH_STARTED)return 0===e.avail_out&&(r.last_flush=-1),Z_OK$2;if(s===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?trees._tr_align(r):t!==Z_BLOCK$1&&(trees._tr_stored_block(r,0,0,!1),t===Z_FULL_FLUSH&&(zero(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),flush_pending(e),0===e.avail_out))return r.last_flush=-1,Z_OK$2}return t!==Z_FINISH$2?Z_OK$2:r.wrap<=0?Z_STREAM_END$2:(2===r.wrap?(put_byte(r,255&e.adler),put_byte(r,e.adler>>8&255),put_byte(r,e.adler>>16&255),put_byte(r,e.adler>>24&255),put_byte(r,255&e.total_in),put_byte(r,e.total_in>>8&255),put_byte(r,e.total_in>>16&255),put_byte(r,e.total_in>>24&255)):(putShortMSB(r,e.adler>>>16),putShortMSB(r,65535&e.adler)),flush_pending(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?Z_OK$2:Z_STREAM_END$2)}function deflateEnd(e){var t;return e&&e.state?(t=e.state.status)!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(e,Z_STREAM_ERROR$1):(e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR$1):Z_OK$2):Z_STREAM_ERROR$1}function deflateSetDictionary(e,t){var r,i,n,a,s,o,l,c=t.length;if(!e||!e.state)return Z_STREAM_ERROR$1;if(2===(a=(r=e.state).wrap)||1===a&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR$1;for(1===a&&(e.adler=adler32$1(e.adler,t,c,0)),r.wrap=0,c>=r.w_size&&(0===a&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0),l=new utils$5.Buf8(r.w_size),utils$5.arraySet(l,t,c-r.w_size,r.w_size,0),t=l,c=r.w_size),s=e.avail_in,o=e.next_in,l=e.input,e.avail_in=c,e.next_in=0,e.input=t,fill_window(r);r.lookahead>=MIN_MATCH;){for(i=r.strstart,n=r.lookahead-(MIN_MATCH-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+MIN_MATCH-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--n;);r.strstart=i,r.lookahead=MIN_MATCH-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,e.next_in=o,e.input=l,e.avail_in=s,r.wrap=a,Z_OK$2}configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],deflate$3.deflateInit=deflateInit,deflate$3.deflateInit2=deflateInit2,deflate$3.deflateReset=deflateReset,deflate$3.deflateResetKeep=deflateResetKeep,deflate$3.deflateSetHeader=deflateSetHeader,deflate$3.deflate=deflate$2,deflate$3.deflateEnd=deflateEnd,deflate$3.deflateSetDictionary=deflateSetDictionary,deflate$3.deflateInfo="pako deflate (from Nodeca project)";var strings$2={},utils$4=common$1,STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(e){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}for(var _utf8len=new utils$4.Buf8(256),q=0;q<256;q++)_utf8len[q]=252<=q?6:248<=q?5:240<=q?4:224<=q?3:192<=q?2:1;function buf2binstring(e,t){if(t<65534&&(e.subarray&&STR_APPLY_UIA_OK||!e.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils$4.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}function ZStream$2(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}_utf8len[254]=_utf8len[254]=1,strings$2.string2buf=function(e){for(var t,r,i,n,a=e.length,s=0,o=0;o<a;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new utils$4.Buf8(s),o=n=0;n<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[n++]=r:(r<2048?t[n++]=192|r>>>6:(r<65536?t[n++]=224|r>>>12:(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63),t[n++]=128|r>>>6&63),t[n++]=128|63&r);return t},strings$2.buf2binstring=function(e){return buf2binstring(e,e.length)},strings$2.binstring2buf=function(e){for(var t=new utils$4.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},strings$2.buf2string=function(e,t){for(var r,i,n=t||e.length,a=new Array(2*n),s=0,o=0;o<n;)if((r=e[o++])<128)a[s++]=r;else if(4<(i=_utf8len[r]))a[s++]=65533,o+=i-1;else{for(r&=2===i?31:3===i?15:7;1<i&&o<n;)r=r<<6|63&e[o++],i--;1<i?a[s++]=65533:r<65536?a[s++]=r:(r-=65536,a[s++]=55296|r>>10&1023,a[s++]=56320|1023&r)}return buf2binstring(a,s)},strings$2.utf8border=function(e,t){for(var r=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+_utf8len[e[r]]>t?r:t};var zstream=ZStream$2,zlib_deflate=deflate$3,utils$3=common$1,strings$1=strings$2,msg$1=messages,ZStream$1=zstream,toString$1=Object.prototype.toString,Z_NO_FLUSH=0,Z_FINISH$1=4,Z_OK$1=0,Z_STREAM_END$1=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION=-1,Z_DEFAULT_STRATEGY=0,Z_DEFLATED$1=8;function Deflate(e){if(!(this instanceof Deflate))return new Deflate(e);this.options=utils$3.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:""},e||{});var t=this.options;if(t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream$1,this.strm.avail_out=0,(e=zlib_deflate.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy))!==Z_OK$1)throw new Error(msg$1[e]);if(t.header&&zlib_deflate.deflateSetHeader(this.strm,t.header),t.dictionary){t="string"==typeof t.dictionary?strings$1.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$1.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary;if((e=zlib_deflate.deflateSetDictionary(this.strm,t))!==Z_OK$1)throw new Error(msg$1[e]);this._dict_set=!0}}function deflate$1(e,t){t=new Deflate(t);if(t.push(e,!0),t.err)throw t.msg||msg$1[t.err];return t.result}function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}Deflate.prototype.push=function(e,t){var r,i,n=this.strm,a=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?Z_FINISH$1:Z_NO_FLUSH,"string"==typeof e?n.input=strings$1.string2buf(e):"[object ArrayBuffer]"===toString$1.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new utils$3.Buf8(a),n.next_out=0,n.avail_out=a),(r=zlib_deflate.deflate(n,i))!==Z_STREAM_END$1&&r!==Z_OK$1)return this.onEnd(r),!(this.ended=!0)}while(0!==n.avail_out&&(0!==n.avail_in||i!==Z_FINISH$1&&i!==Z_SYNC_FLUSH)||("string"===this.options.to?this.onData(strings$1.buf2binstring(utils$3.shrinkBuf(n.output,n.next_out))):this.onData(utils$3.shrinkBuf(n.output,n.next_out))),(0<n.avail_in||0===n.avail_out)&&r!==Z_STREAM_END$1);return i===Z_FINISH$1?(r=zlib_deflate.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$1):i!==Z_SYNC_FLUSH||(this.onEnd(Z_OK$1),!(n.avail_out=0))},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===Z_OK$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils$3.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},deflate$4.Deflate=Deflate,deflate$4.deflate=deflate$1,deflate$4.deflateRaw=deflateRaw,deflate$4.gzip=gzip;var inflate$4={},inflate$3={},BAD$1=30,TYPE$1=12,inffast=function(e,t){var r,i,n,a,s,o,l=e.state,c=e.next_in,h=e.input,u=c+(e.avail_in-5),d=e.next_out,p=e.output,f=d-(t-e.avail_out),m=d+(e.avail_out-257),g=l.dmax,_=l.wsize,v=l.whave,y=l.wnext,x=l.window,b=l.hold,w=l.bits,T=l.lencode,E=l.distcode,S=(1<<l.lenbits)-1,M=(1<<l.distbits)-1;e:do{w<15&&(b+=h[c++]<<w,w+=8,b+=h[c++]<<w,w+=8),r=T[b&S];t:for(;;){if(b>>>=i=r>>>24,w-=i,0===(i=r>>>16&255))p[d++]=65535&r;else{if(!(16&i)){if(0==(64&i)){r=T[(65535&r)+(b&(1<<i)-1)];continue t}if(32&i){l.mode=TYPE$1;break e}e.msg="invalid literal/length code",l.mode=BAD$1;break e}n=65535&r,(i&=15)&&(w<i&&(b+=h[c++]<<w,w+=8),n+=b&(1<<i)-1,b>>>=i,w-=i),w<15&&(b+=h[c++]<<w,w+=8,b+=h[c++]<<w,w+=8),r=E[b&M];r:for(;;){if(b>>>=i=r>>>24,w-=i,!(16&(i=r>>>16&255))){if(0==(64&i)){r=E[(65535&r)+(b&(1<<i)-1)];continue r}e.msg="invalid distance code",l.mode=BAD$1;break e}if(a=65535&r,w<(i&=15)&&(b+=h[c++]<<w,(w+=8)<i&&(b+=h[c++]<<w,w+=8)),g<(a+=b&(1<<i)-1)){e.msg="invalid distance too far back",l.mode=BAD$1;break e}if(b>>>=i,w-=i,(i=d-f)<a){if(v<(i=a-i)&&l.sane){e.msg="invalid distance too far back",l.mode=BAD$1;break e}if(o=x,(s=0)===y){if(s+=_-i,i<n){for(n-=i;p[d++]=x[s++],--i;);s=d-a,o=p}}else if(y<i){if(s+=_+y-i,(i-=y)<n){for(n-=i;p[d++]=x[s++],--i;);if(s=0,y<n){for(n-=i=y;p[d++]=x[s++],--i;);s=d-a,o=p}}}else if(s+=y-i,i<n){for(n-=i;p[d++]=x[s++],--i;);s=d-a,o=p}for(;2<n;)p[d++]=o[s++],p[d++]=o[s++],p[d++]=o[s++],n-=3;n&&(p[d++]=o[s++],1<n&&(p[d++]=o[s++]))}else{for(s=d-a;p[d++]=p[s++],p[d++]=p[s++],p[d++]=p[s++],2<(n-=3););n&&(p[d++]=p[s++],1<n&&(p[d++]=p[s++]))}break}}break}}while(c<u&&d<m);b&=(1<<(w-=(n=w>>3)<<3))-1,e.next_in=c-=n,e.next_out=d,e.avail_in=c<u?u-c+5:5-(c-u),e.avail_out=d<m?m-d+257:257-(d-m),l.hold=b,l.bits=w},utils$2=common$1,MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(e,t,r,i,n,a,s,o){for(var l,c,h,u,d,p,f,m,g,_=o.bits,v=0,y=0,x=0,b=0,w=0,T=0,E=0,S=0,M=0,A=0,C=null,L=0,P=new utils$2.Buf16(MAXBITS+1),I=new utils$2.Buf16(MAXBITS+1),R=null,D=0,v=0;v<=MAXBITS;v++)P[v]=0;for(y=0;y<i;y++)P[t[r+y]]++;for(w=_,b=MAXBITS;1<=b&&0===P[b];b--);if(b<w&&(w=b),0===b)return n[a++]=20971520,n[a++]=20971520,o.bits=1,0;for(x=1;x<b&&0===P[x];x++);for(w<x&&(w=x),v=S=1;v<=MAXBITS;v++)if(S<<=1,(S-=P[v])<0)return-1;if(0<S&&(e===CODES$1||1!==b))return-1;for(I[1]=0,v=1;v<MAXBITS;v++)I[v+1]=I[v]+P[v];for(y=0;y<i;y++)0!==t[r+y]&&(s[I[t[r+y]]++]=y);if(p=e===CODES$1?(C=R=s,19):e===LENS$1?(C=lbase,L-=257,R=lext,D-=257,256):(C=dbase,R=dext,-1),v=x,d=a,E=y=A=0,h=-1,u=(M=1<<(T=w))-1,e===LENS$1&&ENOUGH_LENS$1<M||e===DISTS$1&&ENOUGH_DISTS$1<M)return 1;for(;;){for(g=s[y]<p?(m=0,s[y]):s[y]>p?(m=R[D+s[y]],C[L+s[y]]):(m=96,0),l=1<<(f=v-E),x=c=1<<T;n[d+(A>>E)+(c-=l)]=f<<24|m<<16|g|0,0!==c;);for(l=1<<v-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,y++,0==--P[v]){if(v===b)break;v=t[r+s[y]]}if(w<v&&(A&u)!==h){for(d+=x,S=1<<(T=v-(E=0===E?w:E));T+E<b&&!((S-=P[T+E])<=0);)T++,S<<=1;if(M+=1<<T,e===LENS$1&&ENOUGH_LENS$1<M||e===DISTS$1&&ENOUGH_DISTS$1<M)return 1;n[h=A&u]=w<<24|T<<16|d-a|0}}return 0!==A&&(n[d+A]=v-E<<24|64<<16|0),o.bits=w,0},utils$1=common$1,adler32=adler32_1,crc32=crc32_1,inflate_fast=inffast,inflate_table=inftrees,CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils$1.Buf16(320),this.work=new utils$1.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new utils$1.Buf32(ENOUGH_LENS),t.distcode=t.distdyn=new utils$1.Buf32(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK):Z_STREAM_ERROR}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):Z_STREAM_ERROR}function inflateReset2(e,t){var r,i;return e&&e.state?(i=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?Z_STREAM_ERROR:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,inflateReset(e))):Z_STREAM_ERROR}function inflateInit2(e,t){var r;return e?(r=new InflateState,(e.state=r).window=null,(t=inflateReset2(e,t))!==Z_OK&&(e.state=null),t):Z_STREAM_ERROR}function inflateInit(e){return inflateInit2(e,DEF_WBITS)}var lenfix,distfix,virgin=!0;function fixedtables(e){if(virgin){var t;for(lenfix=new utils$1.Buf32(512),distfix=new utils$1.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inflate_table(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inflate_table(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5}function updatewindow(e,t,r,i){var n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new utils$1.Buf8(n.wsize)),i>=n.wsize?(utils$1.arraySet(n.window,t,r-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(i<(e=n.wsize-n.wnext)&&(e=i),utils$1.arraySet(n.window,t,r-i,e,n.wnext),(i-=e)?(utils$1.arraySet(n.window,t,r-i,i,0),n.wnext=i,n.whave=n.wsize):(n.wnext+=e,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=e))),0}function inflate$2(e,t){var r,i,n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x,b,w,T,E,S,M=0,A=new utils$1.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR;(r=e.state).mode===TYPE&&(r.mode=TYPEDO),s=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,i=e.input,o=e.avail_in,c=r.hold,h=r.bits,u=o,d=l,T=Z_OK;e:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;h<16;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(2&r.wrap&&35615===c){A[r.check=0]=255&c,A[1]=c>>>8&255,r.check=crc32(r.check,A,2,0),h=c=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=BAD;break}if((15&c)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(h-=4,w=8+(15&(c>>>=4)),0===r.wbits)r.wbits=w;else if(w>r.wbits){e.msg="invalid window size",r.mode=BAD;break}r.dmax=1<<w,e.adler=r.check=1,r.mode=512&c?DICTID:TYPE,h=c=0;break;case FLAGS:for(;h<16;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(r.flags=c,(255&r.flags)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=BAD;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,r.check=crc32(r.check,A,2,0)),h=c=0,r.mode=TIME;case TIME:for(;h<32;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}r.head&&(r.head.time=c),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,r.check=crc32(r.check,A,4,0)),h=c=0,r.mode=OS;case OS:for(;h<16;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,r.check=crc32(r.check,A,2,0)),h=c=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;h<16;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,r.check=crc32(r.check,A,2,0)),h=c=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&((p=o<(p=r.length)?o:p)&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),utils$1.arraySet(r.head.extra,i,a,p,w)),512&r.flags&&(r.check=crc32(r.check,i,p,a)),o-=p,a+=p,r.length-=p),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===o)break e;for(p=0;w=i[a+p++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w)),w&&p<o;);if(512&r.flags&&(r.check=crc32(r.check,i,p,a)),o-=p,a+=p,w)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===o)break e;for(p=0;w=i[a+p++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w)),w&&p<o;);if(512&r.flags&&(r.check=crc32(r.check,i,p,a)),o-=p,a+=p,w)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;h<16;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(c!==(65535&r.check)){e.msg="header crc mismatch",r.mode=BAD;break}h=c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE;break;case DICTID:for(;h<32;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}e.adler=r.check=zswap32(c),h=c=0,r.mode=DICT;case DICT:if(0===r.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=c,r.bits=h,Z_NEED_DICT;e.adler=r.check=1,r.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(r.last){c>>>=7&h,h-=7&h,r.mode=CHECK;break}for(;h<3;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}switch(r.last=1&c,--h,3&(c>>>=1)){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t!==Z_TREES)break;c>>>=2,h-=2;break e;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD}c>>>=2,h-=2;break;case STORED:for(c>>>=7&h,h-=7&h;h<32;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD;break}if(r.length=65535&c,h=c=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(p=r.length){if(0===(p=l<(p=o<p?o:p)?l:p))break e;utils$1.arraySet(n,i,a,p,s),o-=p,a+=p,l-=p,s+=p,r.length-=p;break}r.mode=TYPE;break;case TABLE:for(;h<14;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(r.nlen=257+(31&c),c>>>=5,h-=5,r.ndist=1+(31&c),c>>>=5,h-=5,r.ncode=4+(15&c),c>>>=4,h-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=BAD;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;h<3;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}r.lens[C[r.have++]]=7&c,c>>>=3,h-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,E={bits:r.lenbits},T=inflate_table(CODES,r.lens,0,19,r.lencode,0,r.work,E),r.lenbits=E.bits,T){e.msg="invalid code lengths set",r.mode=BAD;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;_=(M=r.lencode[c&(1<<r.lenbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=h);){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(v<16)c>>>=g,h-=g,r.lens[r.have++]=v;else{if(16===v){for(S=g+2;h<S;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(c>>>=g,h-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=BAD;break}w=r.lens[r.have-1],p=3+(3&c),c>>>=2,h-=2}else if(17===v){for(S=g+3;h<S;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}h-=g,w=0,p=3+(7&(c>>>=g)),c>>>=3,h-=3}else{for(S=g+7;h<S;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}h-=g,w=0,p=11+(127&(c>>>=g)),c>>>=7,h-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD;break}for(;p--;)r.lens[r.have++]=w}}if(r.mode===BAD)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=BAD;break}if(r.lenbits=9,E={bits:r.lenbits},T=inflate_table(LENS,r.lens,0,r.nlen,r.lencode,0,r.work,E),r.lenbits=E.bits,T){e.msg="invalid literal/lengths set",r.mode=BAD;break}if(r.distbits=6,r.distcode=r.distdyn,E={bits:r.distbits},T=inflate_table(DISTS,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,E),r.distbits=E.bits,T){e.msg="invalid distances set",r.mode=BAD;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(6<=o&&258<=l){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=c,r.bits=h,inflate_fast(e,d),s=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,i=e.input,o=e.avail_in,c=r.hold,h=r.bits,r.mode===TYPE&&(r.back=-1);break}for(r.back=0;_=(M=r.lencode[c&(1<<r.lenbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=h);){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(_&&0==(240&_)){for(y=g,x=_,b=v;_=(M=r.lencode[b+((c&(1<<y+x)-1)>>y)])>>>16&255,v=65535&M,!(y+(g=M>>>24)<=h);){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}c>>>=y,h-=y,r.back+=y}if(c>>>=g,h-=g,r.back+=g,r.length=v,0===_){r.mode=LIT;break}if(32&_){r.back=-1,r.mode=TYPE;break}if(64&_){e.msg="invalid literal/length code",r.mode=BAD;break}r.extra=15&_,r.mode=LENEXT;case LENEXT:if(r.extra){for(S=r.extra;h<S;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,h-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;_=(M=r.distcode[c&(1<<r.distbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=h);){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(0==(240&_)){for(y=g,x=_,b=v;_=(M=r.distcode[b+((c&(1<<y+x)-1)>>y)])>>>16&255,v=65535&M,!(y+(g=M>>>24)<=h);){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}c>>>=y,h-=y,r.back+=y}if(c>>>=g,h-=g,r.back+=g,64&_){e.msg="invalid distance code",r.mode=BAD;break}r.offset=v,r.extra=15&_,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(S=r.extra;h<S;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,h-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD;break}r.mode=MATCH;case MATCH:if(0===l)break e;if(r.offset>(p=d-l)){if((p=r.offset-p)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break}f=p>r.wnext?(p-=r.wnext,r.wsize-p):r.wnext-p,p>r.length&&(p=r.length),m=r.window}else m=n,f=s-r.offset,p=r.length;for(l-=p=l<p?l:p,r.length-=p;n[s++]=m[f++],--p;);0===r.length&&(r.mode=LEN);break;case LIT:if(0===l)break e;n[s++]=r.length,l--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;h<32;){if(0===o)break e;o--,c|=i[a++]<<h,h+=8}if(d-=l,e.total_out+=d,r.total+=d,d&&(e.adler=r.check=(r.flags?crc32:adler32)(r.check,n,d,s-d)),d=l,(r.flags?c:zswap32(c))!==r.check){e.msg="incorrect data check",r.mode=BAD;break}h=c=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;h<32;){if(0===o)break e;o--,c+=i[a++]<<h,h+=8}if(c!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=BAD;break}h=c=0}r.mode=DONE;case DONE:T=Z_STREAM_END;break e;case BAD:T=Z_DATA_ERROR;break e;case MEM:return Z_MEM_ERROR;default:return Z_STREAM_ERROR}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=c,r.bits=h,(r.wsize||d!==e.avail_out&&r.mode<BAD&&(r.mode<CHECK||t!==Z_FINISH))&&updatewindow(e,e.output,e.next_out,d-e.avail_out),u-=e.avail_in,d-=e.avail_out,e.total_in+=u,e.total_out+=d,r.total+=d,r.wrap&&d&&(e.adler=r.check=(r.flags?crc32:adler32)(r.check,n,d,e.next_out-d)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),T=(0==u&&0===d||t===Z_FINISH)&&T===Z_OK?Z_BUF_ERROR:T}function inflateEnd(e){if(!e||!e.state)return Z_STREAM_ERROR;var t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK}function inflateGetHeader(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?Z_STREAM_ERROR:((e.head=t).done=!1,Z_OK)}function inflateSetDictionary(e,t){var r,i=t.length;return!e||!e.state||0!==(r=e.state).wrap&&r.mode!==DICT?Z_STREAM_ERROR:r.mode===DICT&&adler32(1,t,i,0)!==r.check?Z_DATA_ERROR:updatewindow(e,t,i,i)?(r.mode=MEM,Z_MEM_ERROR):(r.havedict=1,Z_OK)}inflate$3.inflateReset=inflateReset,inflate$3.inflateReset2=inflateReset2,inflate$3.inflateResetKeep=inflateResetKeep,inflate$3.inflateInit=inflateInit,inflate$3.inflateInit2=inflateInit2,inflate$3.inflate=inflate$2,inflate$3.inflateEnd=inflateEnd,inflate$3.inflateGetHeader=inflateGetHeader,inflate$3.inflateSetDictionary=inflateSetDictionary,inflate$3.inflateInfo="pako inflate (from Nodeca project)";var constants$3={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader$1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader$1,zlib_inflate=inflate$3,utils=common$1,strings=strings$2,c=constants$3,msg=messages,ZStream=zstream,GZheader=GZheader$1,toString=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;e=zlib_inflate.inflateInit2(this.strm,t.windowBits);if(e!==c.Z_OK)throw new Error(msg[e]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=zlib_inflate.inflateSetDictionary(this.strm,t.dictionary))!==c.Z_OK))throw new Error(msg[e])}function inflate$1(e,t){t=new Inflate(t);if(t.push(e,!0),t.err)throw t.msg||msg[t.err];return t.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate.prototype.push=function(e,t){var r,i,n,a,s,o=this.strm,l=this.options.chunkSize,h=this.options.dictionary,u=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof e?o.input=strings.binstring2buf(e):"[object ArrayBuffer]"===toString.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new utils.Buf8(l),o.next_out=0,o.avail_out=l),(r=(r=zlib_inflate.inflate(o,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&h?zlib_inflate.inflateSetDictionary(this.strm,h):r)===c.Z_BUF_ERROR&&!0===u&&(r=c.Z_OK,u=!1),r!==c.Z_STREAM_END&&r!==c.Z_OK)return this.onEnd(r),!(this.ended=!0)}while(o.next_out&&(0!==o.avail_out&&r!==c.Z_STREAM_END&&(0!==o.avail_in||i!==c.Z_FINISH&&i!==c.Z_SYNC_FLUSH)||("string"===this.options.to?(n=strings.utf8border(o.output,o.next_out),a=o.next_out-n,s=strings.buf2string(o.output,n),o.next_out=a,o.avail_out=l-a,a&&utils.arraySet(o.output,o.output,n,a,0),this.onData(s)):this.onData(utils.shrinkBuf(o.output,o.next_out)))),0===o.avail_in&&0===o.avail_out&&(u=!0),(0<o.avail_in||0===o.avail_out)&&r!==c.Z_STREAM_END);return(i=r===c.Z_STREAM_END?c.Z_FINISH:i)===c.Z_FINISH?(r=zlib_inflate.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c.Z_OK):i!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(o.avail_out=0))},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},inflate$4.Inflate=Inflate,inflate$4.inflate=inflate$1,inflate$4.inflateRaw=inflateRaw,inflate$4.ungzip=inflate$1;var assign=common$1.assign,deflate=deflate$4,inflate=inflate$4,constants$2=constants$3,pako={};assign(pako,deflate$4,inflate$4,constants$3);var pako_1=pako;function loadJSON(a){return fetch(a).then(async e=>{if(!a.endsWith(".gz"))return e.json();{const i=e.body.getReader(),n=new pako_1.Inflate({to:"string"});for(;;){var{done:t,value:r}=await i.read();if(t)return JSON.parse(n.result);n.push(r)}}})}function buildLookup(e,t){const r=t||"id",i={};for(const n of e)i[n[r]]=n;return i}function lerp$3(e,t,r){return e*(1-r)+t*r}function clamp$2(e,t,r){return Math.min(Math.max(e,t),r)}function includes(e,t){let r,i;if(!Array.isArray(e)&&"string"!=typeof e)return!1;if(!Array.isArray(t))return-1!==e.indexOf(t);for(r=0,i=t.length;r<i;r++)if(-1===e.indexOf(t[r]))return!1;return!0}function flat$1(e){return e.reduce((e,t)=>e.concat(t),[])}function normalize$1(e){return e.normalize("NFD").replace(/\(.*\)|<.*>|.*|[\u0300-\u036F]/g,"")}function valueOrDefault(e,t){return void 0===e?t:e}function numberOrDefault(e,t){return isNaN(e)?t:e}function bindAll(e,t){for(const r of e)t[r]&&(t[r]=t[r].bind(t))}function removePrefix(e){return"string"==typeof e?e.replace(/.*:/,""):Array.isArray(e)?e.map(removePrefix):e}function blink(){var e=performance.now()%1500/1500*2;return e<1?e:2-e}function bufferTrapezoid(e,t){var[[r,i],[n,a],[s,o],[l,c]]=e,h=n-r,u=s-n,d=l-s,p=r-l,f=a-i,m=o-a,g=c-o,_=i-c,v=t/Math.sqrt(h*h+f*f),y=t/Math.sqrt(u*u+m*m),x=t/Math.sqrt(d*d+g*g),b=t/Math.sqrt(p*p+_*_),w=r-f*v,T=n-m*y,E=s-g*x,S=l-_*b,M=i+h*v,A=a+u*y,e=o+d*x,t=c+p*b,r=h*m,n=u*g,s=d*_,l=p*f,i=f*u,v=m*d,a=g*p,y=_*h,o=r-i,x=n-v,c=s-a,b=l-y;return[[(h*u*(M-A)+r*T-i*w)/o,(r*M-i*A-f*m*(w-T))/o],[(u*d*(A-e)+n*E-v*T)/x,(n*A-v*e-m*g*(T-E))/x],[(d*p*(e-t)+s*S-a*E)/c,(s*e-a*t-g*_*(E-S))/c],[(p*h*(t-M)+l*w-y*S)/b,(l*t-y*M-_*f*(S-w))/b]]}function pointInTrapezoid(e,t){var[r,i]=e,[[n,a],[s,o],[l,c],[e,t]]=t;return(s-n)*(i-a)<(o-a)*(r-n)&&(l-s)*(i-o)<(c-o)*(r-s)&&(e-l)*(i-c)<(t-c)*(r-l)&&(n-e)*(i-t)<(a-t)*(r-e)}function luminance(e){return.2126*e.r+.7152*e.g+.0722*e.b}function colorToRGBArray(e){e=parseInt(e.replace("#",""),16);return[Math.floor(e/65536)%256,Math.floor(e/256)%256,e%256]}function createElement(e,t,r){e=document.createElement(e);return Object.assign(e,t),r&&r.appendChild(e),e}function showNotification(e,t){const r=createElement("div",{className:"notification",innerHTML:t},e);setTimeout(()=>{r.style.opacity=0},1e3),setTimeout(()=>{e.removeChild(r)},2e3)}function getLang(e){let t=valueOrDefault(e,"");return t.match(/ja|en|ko|zh-Han[st]|th|ne/)||(t=window.navigator.languages&&window.navigator.languages[0]||window.navigator.language||window.navigator.userLanguage||window.navigator.browserLanguage||""),t=t.match(/zh-(Hant|TW|HK|MO)/)?"zh-Hant":t.match(/zh/)?"zh-Hans":t.substring(0,2),t.match(/ja|en|ko|zh-Han[st]|th|ne/)?t:"en"}var mapboxGl$1={exports:{}};!function(){function e(e,t){var r,i;n?a?(r="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",n(i={}),s=t(i),"undefined"!=typeof window&&(s.workerUrl=window.URL.createObjectURL(new Blob([r],{type:"text/javascript"})))):a=t:n=t}var n,a,s;mapboxGl$1.exports=(e(0,function(l){var a=e;function e(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=r,this.p2y=i}e.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},e.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},e.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},e.prototype.solveCurveX=function(e,t){var r,i,n,a,s;for(void 0===t&&(t=1e-6),n=e,s=0;s<8;s++){if(a=this.sampleCurveX(n)-e,Math.abs(a)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=a/o}if((n=e)<(r=0))return r;if(n>(i=1))return i;for(;r<i;){if(a=this.sampleCurveX(n),Math.abs(a-e)<t)return n;a<e?r=n:i=n,n=.5*(i-r)+r}return n},e.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var B=t;function t(e,t){this.x=e,this.y=t}t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,e=e.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),e=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=e,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),e=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-i*(this.y-t.y),this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return!(e instanceof t)&&Array.isArray(e)?new t(e[0],e[1]):e};var u="undefined"!=typeof self?self:{};const r=Math.pow(2,53)-1,c=Math.PI/180,i=180/Math.PI;function C(e){return e*c}function E(e){return e*i}const n=[[0,0],[1,0],[1,1],[0,1]];function o(e){if(e<=0)return 0;if(1<=e)return 1;var t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function s(e,t,r,i){const n=new a(e,t,r,i);return function(e){return n.solve(e)}}var h=s(.25,.1,.25,1);function S(e,t,r){return Math.min(r,Math.max(t,e))}function d(e,t,r){var i=r-t,i=((e-t)%i+i)%i+t;return i===t?r:i}function p(e,t,i){if(!e.length)return i(null,[]);let n=e.length;const a=new Array(e.length);let s=null;e.forEach((e,r)=>{t(e,(e,t)=>{e&&(s=e),a[r]=t,0==--n&&i(s,a)})})}function v(e){const t=[];for(const r in e)t.push(e[r]);return t}function y(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}let f=1;function m(){return f++}function g(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function _(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function x(e){return e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function b(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function w(e,t){return-1!==e.indexOf(t,e.length-t.length)}function T(e,t,r){const i={};for(const n in e)i[n]=t.call(r||this,e[n],n,e);return i}function M(e,t,r){const i={};for(const n in e)t.call(r||this,e[n],n,e)&&(i[n]=e[n]);return i}function A(e){return Array.isArray(e)?e.map(A):"object"==typeof e&&e?T(e,A):e}const L={};function V(e){L[e]||("undefined"!=typeof console&&console.warn(e),L[e]=!0)}function P(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function I(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function R(e){const a={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,t,r,i)=>{const n=r||i;return a[t]=!n||n.toLowerCase(),""}),a["max-age"]){const e=parseInt(a["max-age"],10);isNaN(e)?delete a["max-age"]:a["max-age"]=e}return a}let D,O,k,F=null;function z(e){if(null==F){const t=e.navigator?e.navigator.userAgent:null;F=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return F}function N(e){try{const t=u[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const U={now:()=>void 0!==k?k:u.performance.now(),setNow(e){k=e},restoreNow(){k=void 0},frame(e){const t=u.requestAnimationFrame(e);return{cancel:()=>u.cancelAnimationFrame(t)}},getImageData(e,t=0){const r=u.document.createElement("canvas"),i=r.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,i.drawImage(e,0,0,e.width,e.height),i.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:e=>(D=D||u.document.createElement("a"),D.href=e,D.href),get devicePixelRatio(){return u.devicePixelRatio},get prefersReducedMotion(){return!!u.matchMedia&&(null==O&&(O=u.matchMedia("(prefers-reduced-motion: reduce)")),O.matches)}};let G;const $={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==G){var t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{G=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){G=t}}return G},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(e){!Z&&W&&(q?X(e):H=e)}};let H,W,Z=!1,q=!1;function X(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,W),e.isContextLost())return;j.supported=!0}catch(e){}e.deleteTexture(t),Z=!0}u.document&&(W=u.document.createElement("img"),W.onload=function(){H&&X(H),H=null,q=!0},W.onerror=function(){Z=!0,H=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Y="01",K="NO_ACCESS_TOKEN";function J(e){return 0===e.indexOf("mapbox:")}function Q(e){return $.API_URL_REGEX.test(e)}const ee=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function te(e){const t=e.match(ee);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function re(e){var t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function ie(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(u.atob(t[1]).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(e){return null}}class ne{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){var t=ie($.ACCESS_TOKEN),r=t&&t.u?u.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t)))):$.ACCESS_TOKEN||"";return e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=N("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const e=u.localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));var i=u.localStorage.getItem(r);i&&(this.anonId=i)}catch(e){V("Unable to read from LocalStorage")}}saveEventData(){var e=N("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{u.localStorage.setItem(r,this.anonId),1<=Object.keys(this.eventData).length&&u.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){V("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,i){if($.EVENTS_URL){const n=te($.EVENTS_URL);n.params.push(`access_token=${i||$.ACCESS_TOKEN||""}`);e={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.1",skuId:Y,userId:this.anonId},e=t?y(e,t):e,e={url:re(n),headers:{"Content-Type":"text/plain"},body:JSON.stringify([e])};this.pendingRequest=Se(e,e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(i)})}}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const ae=new class extends ne{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){$.EVENTS_URL&&$.ACCESS_TOKEN&&Array.isArray(e)&&e.some(e=>J(e)||Q(e))&&this.queueRequest(Date.now(),t)}processRequests(t){if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=ie($.ACCESS_TOKEN),i=r?r.u:$.ACCESS_TOKEN;let e=i!==this.eventData.tokenU;x(this.anonId)||(this.anonId=g(),e=!0);const n=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),r=new Date(n),i=(n-this.eventData.lastSuccess)/864e5;e=e||1<=i||i<-1||t.getDate()!==r.getDate()}else e=!0;if(!e)return this.processRequests();this.postEvent(n,{"enabled.telemetry":!1},e=>{e||(this.eventData.lastSuccess=n,this.eventData.tokenU=i)},t)}}},se=ae.postTurnstileEvent.bind(ae),oe=new class extends ne{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,i){this.skuToken=t,this.errorCb=i,$.EVENTS_URL&&(r||$.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(K)))}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),x(this.anonId)||(this.anonId=g()),this.postEvent(r,{skuToken:this.skuToken},e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e))}}},le=oe.postMapLoadEvent.bind(oe),ce=new class extends ne{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,i){if($.API_URL&&$.SESSION_PATH){const n=te($.API_URL+$.SESSION_PATH);n.params.push(`sku=${t||""}`),n.params.push(`access_token=${i||$.ACCESS_TOKEN||""}`);t={url:re(n),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Me(t,e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(i)})}}getSessionAPI(e,t,r,i){this.skuToken=t,this.errorCb=i,$.SESSION_PATH&&$.API_URL&&(r||$.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(K)))}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}}},he=ce.getSessionAPI.bind(ce),ue=new Set,de="mapbox-tiles";let pe,fe,me=500,ge=50;function _e(){u.caches&&!pe&&(pe=u.caches.open(de))}function ve(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}let ye=1/0;const xe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(xe);class be extends Error{constructor(e,t,r){401===t&&Q(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}function we(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Ee())&&!/^\w+:/.test(r))){if(u.fetch&&u.Request&&u.AbortController&&u.Request.prototype.hasOwnProperty("signal"))return function(n,a){const e=new u.AbortController,s=new u.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Ee(),signal:e.signal});let o=!1,l=!1;const c=0<(t=s.url).indexOf("sku=")&&Q(t);var t;"json"===n.type&&s.headers.set("Accept","application/json");const r=(e,t,r)=>{if(!l){if(e&&"SecurityError"!==e.message&&V(e),t&&r)return h(t);const i=Date.now();u.fetch(s).then(e=>{if(e.ok){const n=c?e.clone():null;return h(e,n,i)}return a(new be(e.statusText,e.status,n.url))}).catch(e=>{20!==e.code&&a(new Error(e.message))})}},h=(t,r,i)=>{("arrayBuffer"===n.type?t.arrayBuffer():"json"===n.type?t.json():t.text()).then(e=>{l||(r&&i&&function(r,e,t){if(_e(),pe){const n={status:e.status,statusText:e.statusText,headers:new u.Headers};e.headers.forEach((e,t)=>n.headers.set(t,e));var i=R(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&n.headers.set("Expires",new Date(t+1e3*i["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-t<42e4||function(e,t){if(void 0===fe)try{new Response(new ReadableStream),fe=!0}catch(e){fe=!1}fe?t(e.body):e.blob().then(t)}(e,e=>{const t=new u.Response(e,n);_e(),pe&&pe.then(e=>e.put(ve(r.url),t)).catch(e=>V(e.message))}))}}(s,r,i),o=!0,a(null,e,t.headers.get("Cache-Control"),t.headers.get("Expires")))}).catch(e=>{l||a(new Error(e.message))})};return c?function(e,i){if(_e(),!pe)return i(null);const n=ve(e.url);pe.then(r=>{r.match(n).then(e=>{var t=function(e){if(!e)return!1;var t=new Date(e.headers.get("Expires")||0),e=R(e.headers.get("Cache-Control")||"");return t>Date.now()&&!e["no-cache"]}(e);r.delete(n),t&&r.put(n,e.clone()),i(null,e,t)}).catch(i)}).catch(i)}(s,r):r(null,null),{cancel:()=>{l=!0,o||e.abort()}}}(e,t);if(I()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(t,r){const i=new u.XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer");for(const r in t.headers)i.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{r(new Error(i.statusText))},i.onload=()=>{if((200<=i.status&&i.status<300||0===i.status)&&null!==i.response){let e=i.response;if("json"===t.type)try{e=JSON.parse(i.response)}catch(e){return r(e)}r(null,e,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else r(new be(i.statusText,i.status,t.url))},i.send(t.body),{cancel:()=>i.abort()}}(e,t)}function Te(e,t){return we(y(e,{type:"arrayBuffer"}),t)}const Ee=I()?()=>self.worker&&self.worker.referrer:()=>("blob:"===u.location.protocol?u.parent:u).location.href,Se=function(e,t){return we(y(e,{method:"POST"}),t)},Me=function(e,t){return we(y(e,{method:"GET"}),t)};const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ce,Le;Ce=[],Le=0;function Pe(e,a){if(j.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Le>=$.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return Ce.push(i),i}Le++;let i=!1;const s=()=>{if(!i)for(i=!0,Le--;Ce.length&&Le<$.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Ce.shift(),{requestParameters:t,callback:i,cancelled:r}=e;r||(e.cancel=Pe(t,i).cancel)}},t=Te(e,(e,t,r,i)=>{var n;s(),e?a(e):t&&(u.createImageBitmap?(n=(e,t)=>a(e,t,r,i),e=new u.Blob([new Uint8Array(t)],{type:"image/png"}),u.createImageBitmap(e).then(e=>{n(null,e)}).catch(e=>{n(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})):function(e,t){const r=new u.Image,i=u.URL;r.onload=()=>{t(null,r),i.revokeObjectURL(r.src),r.onload=null,u.requestAnimationFrame(()=>{r.src=Ae})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));var n=new u.Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?i.createObjectURL(n):Ae}(t,(e,t)=>a(e,t,r,i)))});return{cancel:()=>{t.cancel(),s()}}}function Ie(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Re(e,t,r){r&&r[e]&&(-1!==(t=r[e].indexOf(t))&&r[e].splice(t,1))}class De{constructor(e,t={}){y(this,t),this.type=e}}class Oe extends De{constructor(e,t={}){super("error",y({error:e},t))}}class ke{on(e,t){return this._listeners=this._listeners||{},Ie(e,t,this._listeners),this}off(e,t){return Re(e,t,this._listeners),Re(e,t,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Ie(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(e,t){const r=(e="string"==typeof e?new De(e,t||{}):e).type;if(this.listens(r)){const t=(e.target=this)._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);for(const t of this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[])Re(r,t,this._oneTimeListeners),t.call(this,e);const i=this._eventedParent;i&&(y(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof Oe&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&0<this._listeners[e].length||this._oneTimeListeners&&this._oneTimeListeners[e]&&0<this._oneTimeListeners[e].length||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Fe{constructor(e,t,r,i){this.message=(e?`${e}: `:"")+r,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function ze(e){var t=e.value;return t?[new Fe(e.key,t,"constants have been deprecated as of v8")]:[]}function Ne(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}function Ue(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ge(e){if(Array.isArray(e))return e.map(Ge);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Ge(e[r]);return t}return Ue(e)}class Ve extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class $e{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new $e(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const je={kind:"null"},He={kind:"number"},We={kind:"string"},Ze={kind:"boolean"},qe={kind:"color"},Xe={kind:"object"},Ye={kind:"value"},Ke={kind:"collator"},Je={kind:"formatted"},Qe={kind:"resolvedImage"};function et(e,t){return{kind:"array",itemType:e,N:t}}function tt(e){if("array"!==e.kind)return e.kind;var t=tt(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}const rt=[je,He,We,Ze,qe,Je,Xe,et(Ye),Qe];function it(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!it(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of rt)if(!it(e,t))return null}return`Expected ${tt(e)} but found ${tt(t)} instead.`}function nt(t,e){return e.some(e=>e.kind===t.kind)}function at(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function st(e){var t={exports:{}};return e(t,t.exports),t.exports}var ot=st(function(e,t){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(e){return(e=Math.round(e))<0?0:255<e?255:e}function u(e){return h("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function d(e){return(e="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:1<e?1:e}function p(e,t,r){return r<0?r+=1:1<r&&--r,6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{t.parseCSSColor=function(e){var t=e.replace(/ /g,"").toLowerCase();if(t in c)return c[t].slice();if("#"===t[0])return 4===t.length?0<=(i=parseInt(t.substr(1),16))&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===t.length&&0<=(i=parseInt(t.substr(1),16))&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var r=t.indexOf("("),e=t.indexOf(")");if(-1!==r&&e+1===t.length){var i=t.substr(0,r),n=t.substr(r+1,e-(r+1)).split(","),a=1;switch(i){case"rgba":if(4!==n.length)return null;a=d(n.pop());case"rgb":return 3!==n.length?null:[u(n[0]),u(n[1]),u(n[2]),a];case"hsla":if(4!==n.length)return null;a=d(n.pop());case"hsl":if(3!==n.length)return null;var s=(parseFloat(n[0])%360+360)%360/360,o=d(n[1]),l=d(n[2]),o=l<=.5?l*(o+1):l+o-l*o,l=2*l-o;return[h(255*p(l,o,s+1/3)),h(255*p(l,o,s)),h(255*p(l,o,s-1/3)),a];default:return null}}return null}}catch(e){}});class lt{constructor(e,t,r,i=1){this.r=e,this.g=t,this.b=r,this.a=i}static parse(e){if(e){if(e instanceof lt)return e;if("string"==typeof e){e=ot.parseCSSColor(e);return e?new lt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}}}toString(){var[e,t,r,i]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${i})`}toArray(){var{r:e,g:t,b:r,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*r/i,i]}}lt.black=new lt(0,0,0,1),lt.white=new lt(1,1,1,1),lt.transparent=new lt(0,0,0,0),lt.red=new lt(1,0,0,1),lt.blue=new lt(0,0,1,1);class ct{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class ht{constructor(e,t,r,i,n){this.text=e,this.image=t,this.scale=r,this.fontStack=i,this.textColor=n}}class ut{constructor(e){this.sections=e}static fromString(e){return new ut([new ht(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof ut?e:ut.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections)if(t.image)e.push(["image",t.image.name]);else{e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class dt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new dt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function pt(e,t,r,i){return"number"==typeof e&&0<=e&&e<=255&&"number"==typeof t&&0<=t&&t<=255&&"number"==typeof r&&0<=r&&r<=255?void 0===i||"number"==typeof i&&0<=i&&i<=1?null:`Invalid rgba value [${[e,t,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,r,i]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ft(e){if(null===e)return 1;if("string"==typeof e)return 1;if("boolean"==typeof e)return 1;if("number"==typeof e)return 1;if(e instanceof lt)return 1;if(e instanceof ct)return 1;if(e instanceof ut)return 1;if(e instanceof dt)return 1;if(Array.isArray(e)){for(const t of e)if(!ft(t))return;return 1}if("object"==typeof e){for(const r in e)if(!ft(e[r]))return;return 1}}function mt(t){if(null===t)return je;if("string"==typeof t)return We;if("boolean"==typeof t)return Ze;if("number"==typeof t)return He;if(t instanceof lt)return qe;if(t instanceof ct)return Ke;if(t instanceof ut)return Je;if(t instanceof dt)return Qe;if(Array.isArray(t)){var r=t.length;let e;for(const i of t){const t=mt(i);if(e){if(e===t)continue;e=Ye;break}e=t}return et(e||Ye,r)}return Xe}function gt(e){var t=typeof e;return null===e?"":"string"==t||"number"==t||"boolean"==t?String(e):e instanceof lt||e instanceof ut||e instanceof dt?e.toString():JSON.stringify(e)}class _t{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ft(e[1]))return t.error("invalid value");e=e[1];let r=mt(e);t=t.expectedType;return"array"!==r.kind||0!==r.N||!t||"array"!==t.kind||"number"==typeof t.N&&0!==t.N||(r=t),new _t(r,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lt?["rgba"].concat(this.value.toArray()):this.value instanceof ut?this.value.serialize():this.value}}class vt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const yt={string:We,number:He,boolean:Ze,object:Xe};class xt{constructor(e,t){this.type=e,this.args=t}static parse(r,i){if(r.length<2)return i.error("Expected at least one argument.");let n,a=1;var e=r[0];if("array"===e){let e,t;if(2<r.length){const n=r[1];if("string"!=typeof n||!(n in yt)||"object"===n)return i.error('The item type argument of "array" must be one of string, number, boolean',1);e=yt[n],a++}else e=Ye;if(3<r.length){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return i.error('The length argument to "array" must be a positive integer literal',2);t=r[2],a++}n=et(e,t)}else n=yt[e];const t=[];for(;a<r.length;a++){const n=i.parse(r[a],a,Ye);if(!n)return null;t.push(n)}return new xt(n,t)}evaluate(t){for(let e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!it(this.type,mt(r)))return r;if(e===this.args.length-1)throw new vt(`Expected value to be of type ${tt(this.type)}, but found ${tt(mt(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];var r;return"array"===e.kind&&("string"!==(r=e.itemType).kind&&"number"!==r.kind&&"boolean"!==r.kind||(t.push(r.kind),("number"==typeof(r=e.N)||1<this.args.length)&&t.push(r))),t.concat(this.args.map(e=>e.serialize()))}}class bt{constructor(e){this.type=Je,this.sections=e}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");var e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return i.error("First argument must be an image or text section.");const n=[];let a=!1;for(let e=1;e<=t.length-1;++e){var s=t[e];if(a&&"object"==typeof s&&!Array.isArray(s)){a=!1;let e=null;if(s["font-scale"]&&(e=i.parse(s["font-scale"],1,He),!e))return null;let t=null;if(s["text-font"]&&(t=i.parse(s["text-font"],1,et(We)),!t))return null;let r=null;if(s["text-color"]&&(r=i.parse(s["text-color"],1,qe),!r))return null;const o=n[n.length-1];o.scale=e,o.font=t,o.textColor=r}else{var r=i.parse(t[e],1,Ye);if(!r)return null;s=r.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,n.push({content:r,scale:null,font:null,textColor:null})}}return new bt(n)}evaluate(r){return new ut(this.sections.map(e=>{var t=e.content.evaluate(r);return mt(t)===Qe?new ht("",t,null,null,null):new ht(gt(t),null,e.scale?e.scale.evaluate(r):null,e.font?e.font.evaluate(r).join(","):null,e.textColor?e.textColor.evaluate(r):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class wt{constructor(e){this.type=Qe,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");e=t.parse(e[1],1,We);return e?new wt(e):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=dt.fromString(t);return r&&e.availableImages&&(r.available=-1<e.availableImages.indexOf(t)),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Tt={"to-boolean":Ze,"to-color":qe,"to-number":He,"to-string":We};class Et{constructor(e,t){this.type=e,this.args=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");var e=t[0];if(("to-boolean"===e||"to-string"===e)&&2!==t.length)return r.error("Expected one argument.");const i=Tt[e],n=[];for(let e=1;e<t.length;e++){const i=r.parse(t[e],e,Ye);if(!i)return null;n.push(i)}return new Et(i,n)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let e,t;for(const n of this.args){if(e=n.evaluate(r),t=null,e instanceof lt)return e;if("string"==typeof e){var i=r.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(t=e.length<3||4<e.length?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:pt(e[0],e[1],e[2],e[3]),!t))return new lt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new vt(t||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"!==this.type.kind)return"formatted"===this.type.kind?ut.fromString(gt(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?dt.fromString(gt(this.args[0].evaluate(r))):gt(this.args[0].evaluate(r));{let e=null;for(const a of this.args){if(e=a.evaluate(r),null===e)return 0;var t=Number(e);if(!isNaN(t))return t}throw new vt(`Could not convert ${JSON.stringify(e)} to number.`)}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new bt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new wt(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(e=>{t.push(e.serialize())}),t}}const St=["Unknown","Point","LineString","Polygon"];class Mt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?St[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){var e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t=t||(this._parseColorCache[e]=lt.parse(e)),t}}class At{constructor(e,t,r,i){this.name=e,this.type=t,this._evaluate=r,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(r,i){const n=r[0],a=At.definitions[n];if(!a)return i.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(a)?a[0]:a.type,o=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,l=o.filter(([e])=>!Array.isArray(e)||e.length===r.length-1);let c=null;for(const[a,o]of l){c=new Ht(i.registry,i.path,null,i.scope);const l=[];let t=!1;for(let e=1;e<r.length;e++){const n=r[e],s=Array.isArray(a)?a[e-1]:a.type,o=c.parse(n,1+l.length,s);if(!o){t=!0;break}l.push(o)}if(!t)if(Array.isArray(a)&&a.length!==l.length)c.error(`Expected ${a.length} arguments, but found ${l.length} instead.`);else{for(let e=0;e<l.length;e++){const i=Array.isArray(a)?a[e]:a.type,n=l[e];c.concat(e+1).checkSubtype(i,n.type)}if(0===c.errors.length)return new At(n,s,o,l)}}if(1===l.length)i.errors.push(...c.errors);else{const n=(l.length?l:o).map(([e])=>{return e=e,Array.isArray(e)?`(${e.map(tt).join(", ")})`:`(${tt(e.type)}...)`}).join(" | "),a=[];for(let e=1;e<r.length;e++){const s=i.parse(r[e],1+a.length);if(!s)return null;a.push(tt(s.type))}i.error(`Expected arguments of type ${n}, but found (${a.join(", ")}) instead.`)}return null}static register(e,t){for(const r in At.definitions=t)e[r]=At}}class Ct{constructor(e,t,r){this.type=Ke,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");var r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");var i=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Ze);if(!i)return null;e=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Ze);if(!e)return null;let n=null;return r.locale&&(n=t.parse(r.locale,1,We),!n)?null:new Ct(i,e,n)}evaluate(e){return new ct(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Lt=8192;function Pt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function It(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Rt(r,i){let n=!1;for(let e=0,t=i.length;e<t;e++){var a=i[e];for(let e=0,t=a.length;e<t-1;e++){if(s=a[e],c=a[e+1],l=o=void 0,o=r[0]-s[0],l=r[1]-s[1],s=r[0]-c[0],c=r[1]-c[1],o*c-s*l==0&&o*s<=0&&l*c<=0)return;(l=a[e])[1]>r[1]!=(c=a[e+1])[1]>r[1]&&r[0]<(c[0]-l[0])*(r[1]-l[1])/(c[1]-l[1])+l[0]&&(n=!n)}}var s,o,l,c;return n}function Dt(e,t,r,i){var n=i[0]-r[0],i=i[1]-r[1],e=(e[0]-r[0])*i-n*(e[1]-r[1]),r=(t[0]-r[0])*i-n*(t[1]-r[1]);return 0<e&&r<0||e<0&&0<r}function Ot(t,r){for(let e=0;e<t.length;++e)if(!Rt(t[e],r))return;for(let e=0;e<t.length-1;++e)if(function(t,r,e){for(const c of e)for(let e=0;e<c.length-1;++e)if(0!=(o=[(s=c[e+1])[0]-(a=c[e])[0],s[1]-a[1]])[0]*(l=[(n=r)[0]-(i=t)[0],n[1]-i[1]])[1]-o[1]*l[0]&&Dt(i,n,a,s)&&Dt(a,s,i,n))return 1;var i,n,a,s,o,l}(t[e],t[e+1],r))return;return 1}function kt(r,i,n){const e=[];for(let t=0;t<r.length;t++){const l=[];for(let e=0;e<r[t].length;e++){s=(a=r[t][e],s=n,o=void 0,o=(180+a[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,s=Math.pow(2,s.z),[Math.round(o*s*Lt),Math.round(a*s*Lt)]);Pt(i,s),l.push(s)}e.push(l)}var a,s,o;return e}function Bt(t,r,i){const n=[];for(let e=0;e<t.length;e++){var a=kt(t[e],r,i);n.push(a)}return n}function Ft(t,r,i,n){if(t[0]<i[0]||t[0]>i[2]){const r=.5*n;let e=t[0]-i[0]>r?-n:i[0]-t[0]>r?n:0;0===e&&(e=t[0]-i[2]>r?-n:i[2]-t[0]>r?n:0),t[0]+=e}Pt(r,t)}function zt(e,t,r,i){const n=Math.pow(2,i.z)*Lt,a=[i.x*Lt,i.y*Lt],s=[];for(const i of e)for(const e of i){const i=[e.x+a[0],e.y+a[1]];Ft(i,t,r,n),s.push(i)}return s}function Nt(e,t,r,i){const n=Math.pow(2,i.z)*Lt,a=[i.x*Lt,i.y*Lt],s=[];for(const r of e){const o=[];for(const i of r){const r=[i.x+a[0],i.y+a[1]];Pt(t,r),o.push(r)}s.push(o)}if(t[2]-t[0]<=n/2){(e=t)[0]=e[1]=1/0,e[2]=e[3]=-1/0;for(const o of s)for(const i of o)Ft(i,t,r,n)}return s}class Ut{constructor(e,t){this.type=Ze,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ft(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){var r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Ut(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Ut(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Ut(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){var r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){var a=kt(t.coordinates,i,n),s=zt(e.geometry(),r,i,n);if(!It(r,i))return!1;for(const e of s)if(!Rt(e,a))return!1}if("MultiPolygon"===t.type){var o=Bt(t.coordinates,i,n),n=zt(e.geometry(),r,i,n);if(!It(r,i))return!1;for(const e of n)if(!function(t,r){for(let e=0;e<r.length;e++)if(Rt(t,r[e]))return 1}(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){var r=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){var a=kt(t.coordinates,i,n),s=Nt(e.geometry(),r,i,n);if(!It(r,i))return!1;for(const e of s)if(!Ot(e,a))return!1}if("MultiPolygon"===t.type){var o=Bt(t.coordinates,i,n),n=Nt(e.geometry(),r,i,n);if(!It(r,i))return!1;for(const e of n)if(!function(t,r){for(let e=0;e<r.length;e++)if(Ot(t,r[e]))return 1}(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Gt(e){if(e instanceof At){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Ut)return!1;let t=!0;return e.eachChild(e=>{t&&!Gt(e)&&(t=!1)}),t}function Vt(e){if(!(e instanceof At&&"feature-state"===e.name)){let t=!0;return e.eachChild(e=>{t&&!Vt(e)&&(t=!1)}),t}}function $t(e,t){if(e instanceof At&&0<=t.indexOf(e.name))return!1;let r=!0;return e.eachChild(e=>{r&&!$t(e,t)&&(r=!1)}),r}class jt{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");e=e[1];return t.scope.has(e)?new jt(e,t.scope.get(e)):t.error(`Unknown variable "${e}". Make sure "${e}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ht{constructor(e,t=[],r,i=new $e,n=[]){this.registry=e,this.path=t,this.key=t.map(e=>`[${e}]`).join(""),this.scope=i,this.errors=n,this.expectedType=r}parse(e,t,r,i,n={}){return(t?this.concat(t,r,i):this)._parse(e,n)}_parse(t,r){function i(e,t,r){return"assert"===r?new xt(t,[e]):"coerce"===r?new Et(t,[e]):e}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var e=t[0];if("string"!=typeof e)return this.error(`Expression name must be a string, but found ${typeof e} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[e];if(n){let e=n.parse(t,this);if(!e)return null;if(this.expectedType){const t=this.expectedType,a=e.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==a.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==a.kind&&"string"!==a.kind){if(this.checkSubtype(t,a))return null}else e=i(e,t,r.typeAnnotation||"coerce");else e=i(e,t,r.typeAnnotation||"assert")}if(!(e instanceof _t)&&"resolvedImage"!==e.type.kind&&function t(e){if(e instanceof jt)return t(e.boundExpression);if(e instanceof At&&"error"===e.name)return!1;if(e instanceof Ct)return!1;if(e instanceof Ut)return!1;const r=e instanceof Et||e instanceof xt;let i=!0;return e.eachChild(e=>{i=r?i&&t(e):i&&e instanceof _t}),!!i&&Gt(e)&&$t(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}(e)){const t=new Mt;try{e=new _t(e.type,e.evaluate(t))}catch(t){return this.error(t.message),null}}return e}return this.error(`Unknown expression "${e}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(e,t,r){e="number"==typeof e?this.path.concat(e):this.path,r=r?this.scope.concat(r):this.scope;return new Ht(this.registry,e,t||null,r,this.errors)}error(e,...t){t=`${this.key}${t.map(e=>`[${e}]`).join("")}`;this.errors.push(new Ve(t,e))}checkSubtype(e,t){t=it(e,t);return t&&this.error(t),t}}function Wt(e,t){var r=e.length-1;let i,n,a=0,s=r,o;for(;a<=s;)if(i=e[o=Math.floor((a+s)/2)],n=e[o+1],i<=t){if(o===r||t<n)return o;a=o+1}else{if(!(t<i))throw new vt("Input is not a number.");s=o-1}return 0}class Zt{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");var e=r.parse(t[1],1,He);if(!e)return null;const i=[];let n=null;r.expectedType&&"value"!==r.expectedType.kind&&(n=r.expectedType);for(let e=1;e<t.length;e+=2){var a=1===e?-1/0:t[e],s=t[e+1],o=e,l=e+1;if("number"!=typeof a)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(i.length&&i[i.length-1][0]>=a)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);l=r.parse(s,l,n);if(!l)return null;n=n||l.type,i.push([a,l])}return new Zt(n,e,i)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);var i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);var n=t.length;return(i>=t[n-1]?r[n-1]:r[Wt(t,i)]).evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)0<e&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function qt(e,t,r){return e*(1-r)+t*r}var Xt=Object.freeze({__proto__:null,number:qt,color:function(e,t,r){return new lt(qt(e.r,t.r,r),qt(e.g,t.g,r),qt(e.b,t.b,r),qt(e.a,t.a,r))},array:function(e,r,i){return e.map((e,t)=>qt(e,r[t],i))}});const Yt=4/29,Kt=6/29,Jt=3*Kt*Kt,Qt=Math.PI/180,er=180/Math.PI;function tr(e){return.008856451679035631<e?Math.pow(e,1/3):e/Jt+Yt}function rr(e){return e>Kt?e*e*e:Jt*(e-Yt)}function ir(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function nr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ar(e){var t=nr(e.r),r=nr(e.g),i=nr(e.b),n=tr((.4124564*t+.3575761*r+.1804375*i)/.95047),a=tr(.2126729*t+.7151522*r+.072175*i);return{l:116*a-16,a:500*(n-a),b:200*(a-tr((.0193339*t+.119192*r+.9503041*i)/1.08883)),alpha:e.a}}function sr(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=+rr(t),r=.95047*rr(r),i=1.08883*rr(i),new lt(ir(3.2404542*r-1.5371385*t-.4985314*i),ir(-.969266*r+1.8760108*t+.041556*i),ir(.0556434*r-.2040259*t+1.0572252*i),e.alpha)}const or={forward:ar,reverse:sr,interpolate:function(e,t,r){return{l:qt(e.l,t.l,r),a:qt(e.a,t.a,r),b:qt(e.b,t.b,r),alpha:qt(e.alpha,t.alpha,r)}}},lr={forward:function(e){var{l:t,a:r,b:i}=ar(e),n=Math.atan2(i,r)*er;return{h:n<0?360+n:n,c:Math.sqrt(r*r+i*i),l:t,alpha:e.a}},reverse:function(e){var t=e.h*Qt,r=e.c;return sr({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:(i=e.h,n=t.h,i+r*(180<(n-=i)||n<-180?n-360*Math.round(n/360):n)),c:qt(e.c,t.c,r),l:qt(e.l,t.l,r),alpha:qt(e.alpha,t.alpha,r)};var i,n}};var cr=Object.freeze({__proto__:null,lab:or,hcl:lr});class hr{constructor(e,t,r,i,n){this.type=e,this.operator=t,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,i){let n=0;return"exponential"===e.name?n=ur(t,e.base,r,i):"linear"===e.name?n=ur(t,1,r,i):"cubic-bezier"===e.name&&(e=e.controlPoints,n=new a(e[0],e[1],e[2],e[3]).solve(ur(t,1,r,i))),n}static parse(e,t){let[r,i,n,...a]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||1<e))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,He),!n)return null;const s=[];let o=null;"interpolate-hcl"===r||"interpolate-lab"===r?o=qe:t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType);for(let e=0;e<a.length;e+=2){const r=a[e],i=a[e+1],n=e+3,c=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);var l=t.parse(i,c,o);if(!l)return null;o=o||l.type,s.push([r,l])}return"number"===o.kind||"color"===o.kind||"array"===o.kind&&"number"===o.itemType.kind&&"number"==typeof o.N?new hr(o,r,i,n,s):t.error(`Type ${tt(o)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);var i=this.input.evaluate(e);if(i<=t[0])return r[0].evaluate(e);var n=t.length;if(i>=t[n-1])return r[n-1].evaluate(e);var a=Wt(t,i),n=hr.interpolationFactor(this.interpolation,i,t[a],t[a+1]),i=r[a].evaluate(e),e=r[a+1].evaluate(e);return"interpolate"===this.operator?Xt[this.type.kind.toLowerCase()](i,e,n):"interpolate-hcl"===this.operator?lr.reverse(lr.interpolate(lr.forward(i),lr.forward(e),n)):or.reverse(or.interpolate(or.forward(i),or.forward(e),n))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){var e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function ur(e,t,r,i){i-=r,r=e-r;return 0==i?0:1===t?r/i:(Math.pow(t,r)-1)/(Math.pow(t,i)-1)}class dr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const i=t.expectedType;i&&"value"!==i.kind&&(r=i);const n=[];for(const i of e.slice(1)){const a=t.parse(i,1+n.length,r,void 0,{typeAnnotation:"omit"});if(!a)return null;r=r||a.type,n.push(a)}e=i&&n.some(e=>it(i,e.type));return new dr(e?Ye:r,n)}evaluate(e){let t,r=null,i=0;for(const n of this.args)if(i++,r=n.evaluate(e),r&&r instanceof dt&&!r.available&&(t=t||r.name,r=null,i===this.args.length&&(r=t)),null!==r)break;return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class pr{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let e=1;e<t.length-1;e+=2){var n=t[e];if("string"!=typeof n)return r.error(`Expected string, but found ${typeof n} instead.`,e);if(/[^a-zA-Z0-9_]/.test(n))return r.error("Variable names must contain only alphanumeric characters or '_'.",e);var a=r.parse(t[e+1],e+1);if(!a)return null;i.push([n,a])}var e=r.parse(t[t.length-1],t.length-1,r.expectedType,i);return e?new pr(i,e):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(var[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}function fr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function mr(e,t,r,i){return 0===i.compare(t,r)}function gr(i,n,a){const s="=="!==i&&"!="!==i;return class o{constructor(e,t,r){this.type=Ze,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var r=e[0];let i=t.parse(e[1],1,Ye);if(!i)return null;if(!fr(r,i.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${tt(i.type)}'.`);let n=t.parse(e[2],2,Ye);if(!n)return null;if(!fr(r,n.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${tt(n.type)}'.`);if(i.type.kind!==n.type.kind&&"value"!==i.type.kind&&"value"!==n.type.kind)return t.error(`Cannot compare types '${tt(i.type)}' and '${tt(n.type)}'.`);s&&("value"===i.type.kind&&"value"!==n.type.kind?i=new xt(n.type,[i]):"value"!==i.type.kind&&"value"===n.type.kind&&(n=new xt(i.type,[n])));let a=null;if(4===e.length){if("string"!==i.type.kind&&"string"!==n.type.kind&&"value"!==i.type.kind&&"value"!==n.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Ke),!a)return null}return new o(i,n,a)}evaluate(e){var t=this.lhs.evaluate(e),r=this.rhs.evaluate(e);if(s&&this.hasUntypedArgument){const n=mt(t),a=mt(r);if(n.kind!==a.kind||"string"!==n.kind&&"number"!==n.kind)throw new vt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${n.kind}, ${a.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const i=mt(t),a=mt(r);if("string"!==i.kind||"string"!==a.kind)return n(e,t,r)}return this.collator?a(e,t,r,this.collator.evaluate(e)):n(e,t,r)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[i];return this.eachChild(e=>{t.push(e.serialize())}),t}}}var _r=gr("==",function(e,t,r){return t===r},mr),vr=gr("!=",function(e,t,r){return t!==r},function(e,t,r,i){return!mr(0,t,r,i)}),yr=gr("<",function(e,t,r){return t<r},function(e,t,r,i){return i.compare(t,r)<0}),xr=gr(">",function(e,t,r){return r<t},function(e,t,r,i){return 0<i.compare(t,r)}),br=gr("<=",function(e,t,r){return t<=r},function(e,t,r,i){return i.compare(t,r)<=0}),wr=gr(">=",function(e,t,r){return r<=t},function(e,t,r,i){return 0<=i.compare(t,r)});const Tr={"==":_r,"!=":vr,">":xr,"<":yr,">=":wr,"<=":br,array:xt,at:class Ru{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,He),t=t.parse(e[2],2,et(t.expectedType||Ye));return r&&t?new Ru(t.type.itemType,r,t):null}evaluate(e){var t=this.index.evaluate(e),e=this.input.evaluate(e);if(t<0)throw new vt(`Array index out of bounds: ${t} < 0.`);if(t>=e.length)throw new vt(`Array index out of bounds: ${t} > ${e.length-1}.`);if(t!==Math.floor(t))throw new vt(`Array index must be an integer, but found ${t} instead.`);return e[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}},boolean:xt,case:class Du{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let i;r.expectedType&&"value"!==r.expectedType.kind&&(i=r.expectedType);const n=[];for(let e=1;e<t.length-1;e+=2){var a=r.parse(t[e],e,Ze);if(!a)return null;var s=r.parse(t[e+1],e+1,i);if(!s)return null;n.push([a,s]),i=i||s.type}var e=r.parse(t[t.length-1],t.length-1,i);return e?new Du(i,n,e):null}evaluate(e){for(var[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(var[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}},coalesce:dr,collator:Ct,format:bt,image:wt,in:class Ou{constructor(e,t){this.type=Ze,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,Ye),e=t.parse(e[2],2,Ye);return r&&e?nt(r.type,[Ze,We,He,je,Ye])?new Ou(r,e):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${tt(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!at(t,["boolean","string","number","null"]))throw new vt(`Expected first argument to be of type boolean, string, number or null, but found ${tt(mt(t))} instead.`);if(!at(r,["string","array"]))throw new vt(`Expected second argument to be of type array or string, but found ${tt(mt(r))} instead.`);return 0<=r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}},"index-of":class ku{constructor(e,t,r){this.type=He,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||5<=e.length)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,Ye),i=t.parse(e[2],2,Ye);return r&&i?nt(r.type,[Ze,We,He,je,Ye])?4!==e.length?new ku(r,i):(e=t.parse(e[3],3,He))?new ku(r,i,e):null:t.error(`Expected first argument to be of type boolean, string, number or null, but found ${tt(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!at(t,["boolean","string","number","null"]))throw new vt(`Expected first argument to be of type boolean, string, number or null, but found ${tt(mt(t))} instead.`);if(!at(r,["string","array"]))throw new vt(`Expected second argument to be of type array or string, but found ${tt(mt(r))} instead.`);return this.fromIndex?(e=this.fromIndex.evaluate(e),r.indexOf(t,e)):r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null==this.fromIndex||void 0===this.fromIndex)return["index-of",this.needle.serialize(),this.haystack.serialize()];var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}},interpolate:hr,"interpolate-hcl":hr,"interpolate-lab":hr,length:class Bu{constructor(e){this.type=He,this.input=e}static parse(e,t){return 2!==e.length?t.error(`Expected 1 argument, but found ${e.length-1} instead.`):(e=t.parse(e[1],1))?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?t.error(`Expected argument of type string or array, but found ${tt(e.type)} instead.`):new Bu(e):null}evaluate(e){if("string"==typeof(e=this.input.evaluate(e)))return e.length;if(Array.isArray(e))return e.length;throw new vt(`Expected value to be of type string or array, but found ${tt(mt(e))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}},let:pr,literal:_t,match:class Fu{constructor(e,t,r,i,n,a){this.inputType=e,this.type=t,this.input=r,this.cases=i,this.outputs=n,this.otherwise=a}static parse(r,i){if(r.length<5)return i.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return i.error("Expected an even number of arguments.");let n,a;i.expectedType&&"value"!==i.expectedType.kind&&(a=i.expectedType);const s={},o=[];for(let t=2;t<r.length-1;t+=2){let e=r[t];var l=r[t+1];Array.isArray(e)||(e=[e]);const c=i.concat(t);if(0===e.length)return c.error("Expected at least one branch label.");for(const r of e){if("number"!=typeof r&&"string"!=typeof r)return c.error("Branch labels must be numbers or strings.");if("number"==typeof r&&Math.abs(r)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof r&&Math.floor(r)!==r)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,mt(r)))return null}else n=mt(r);if(void 0!==s[String(r)])return c.error("Branch labels must be unique.");s[String(r)]=o.length}if(!(l=i.parse(l,t,a)))return null;a=a||l.type,o.push(l)}var e=i.parse(r[1],1,Ye);if(!e)return null;var t=i.parse(r[r.length-1],r.length-1,a);return!t||"value"!==e.type.kind&&i.concat(1).checkSubtype(n,e.type)?null:new Fu(n,a,e,s,o,t)}evaluate(e){var t=this.input.evaluate(e);return(mt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],i={};for(const e of t){const t=i[this.cases[e]];void 0===t?(i[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[t][1].push(e)}var n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,i]of r)e.push(1===i.length?n(i[0]):i.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}},number:xt,"number-format":class zu{constructor(e,t,r,i,n){this.type=We,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");var r=t.parse(e[1],1,He);if(!r)return null;if("object"!=typeof(e=e[2])||Array.isArray(e))return t.error("NumberFormat options argument must be an object.");let i=null;if(e.locale&&(i=t.parse(e.locale,1,We),!i))return null;let n=null;if(e.currency&&(n=t.parse(e.currency,1,We),!n))return null;let a=null;if(e["min-fraction-digits"]&&(a=t.parse(e["min-fraction-digits"],1,He),!a))return null;let s=null;return e["max-fraction-digits"]&&(s=t.parse(e["max-fraction-digits"],1,He),!s)?null:new zu(r,i,n,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}},object:xt,slice:class Nu{constructor(e,t,r,i){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=i}static parse(e,t){if(e.length<=2||5<=e.length)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);var r=t.parse(e[1],1,Ye),i=t.parse(e[2],2,He);return r&&i?nt(r.type,[et(Ye),We,Ye])?4!==e.length?new Nu(r.type,r,i):(e=t.parse(e[3],3,He))?new Nu(r.type,r,i,e):null:t.error(`Expected first argument to be of type array or string, but found ${tt(r.type)} instead`):null}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!at(t,["string","array"]))throw new vt(`Expected first argument to be of type array or string, but found ${tt(mt(t))} instead.`);return this.endIndex?(e=this.endIndex.evaluate(e),t.slice(r,e)):t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null==this.endIndex||void 0===this.endIndex)return["slice",this.input.serialize(),this.beginIndex.serialize()];var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}},step:Zt,string:xt,"to-boolean":Et,"to-color":Et,"to-number":Et,"to-string":Et,var:jt,within:Ut};function Er(e,[t,r,i,n]){t=t.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);n=n?n.evaluate(e):1,e=pt(t,r,i,n);if(e)throw new vt(e);return new lt(t/255*n,r/255*n,i/255*n,n)}function Sr(e,t){e=t[e];return void 0===e?null:e}function Mr(e){return{type:e}}function Ar(e){return{result:"success",value:e}}function Cr(e){return{result:"error",value:e}}function Lr(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Pr(e){return e.expression&&-1<e.expression.parameters.indexOf("zoom")}function Ir(e){return e.expression&&e.expression.interpolated}function Rr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Dr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Or(e){return e}function kr(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Br(e,t,r,i,n){return kr(typeof r===n?i[r]:void 0,e.default,t.default)}function Fr(e,t,r){if("number"!==Rr(r))return kr(e.default,t.default);t=e.stops.length;if(1===t)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[t-1][0])return e.stops[t-1][1];r=Wt(e.stops.map(e=>e[0]),r);return e.stops[r][1]}function zr(e,r,t){var i=void 0!==e.base?e.base:1;if("number"!==Rr(t))return kr(e.default,r.default);var n,a=e.stops.length;if(1===a)return e.stops[0][1];if(t<=e.stops[0][0])return e.stops[0][1];if(t>=e.stops[a-1][0])return e.stops[a-1][1];const s=Wt(e.stops.map(e=>e[0]),t),o=(n=i,a=e.stops[s][0],i=e.stops[s+1][0]-a,a=t-a,0==i?0:1===n?a/i:(Math.pow(n,a)-1)/(Math.pow(n,i)-1)),l=e.stops[s][1],c=e.stops[s+1][1];let h=Xt[r.type]||Or;if(e.colorSpace&&"rgb"!==e.colorSpace){const r=cr[e.colorSpace];h=(e,t)=>r.reverse(r.interpolate(r.forward(e),r.forward(t),o))}return"function"==typeof l.evaluate?{evaluate(...e){var t=l.evaluate.apply(void 0,e),e=c.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==e)return h(t,e,o)}}:h(l,c,o)}function Nr(e,t,r){return"color"===t.type?r=lt.parse(r):"formatted"===t.type?r=ut.fromString(r.toString()):"resolvedImage"===t.type?r=dt.fromString(r.toString()):Rr(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),kr(r,e.default,t.default)}At.register(Tr,{error:[{kind:"error"},[We],(e,[t])=>{throw new vt(t.evaluate(e))}],typeof:[We,[Ye],(e,[t])=>tt(mt(t.evaluate(e)))],"to-rgba":[et(He,4),[qe],(e,[t])=>t.evaluate(e).toArray()],rgb:[qe,[He,He,He],Er],rgba:[qe,[He,He,He,He],Er],has:{type:Ze,overloads:[[[We],(e,[t])=>t.evaluate(e)in e.properties()],[[We,Xe],(e,[t,r])=>t.evaluate(e)in r.evaluate(e)]]},get:{type:Ye,overloads:[[[We],(e,[t])=>Sr(t.evaluate(e),e.properties())],[[We,Xe],(e,[t,r])=>Sr(t.evaluate(e),r.evaluate(e))]]},"feature-state":[Ye,[We],(e,[t])=>Sr(t.evaluate(e),e.featureState||{})],properties:[Xe,[],e=>e.properties()],"geometry-type":[We,[],e=>e.geometryType()],id:[Ye,[],e=>e.id()],zoom:[He,[],e=>e.globals.zoom],pitch:[He,[],e=>e.globals.pitch||0],"distance-from-center":[He,[],e=>e.distanceFromCenter()],"heatmap-density":[He,[],e=>e.globals.heatmapDensity||0],"line-progress":[He,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[He,[],e=>e.globals.skyRadialProgress||0],accumulated:[Ye,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[He,Mr(He),(e,t)=>{let r=0;for(const i of t)r+=i.evaluate(e);return r}],"*":[He,Mr(He),(e,t)=>{let r=1;for(const i of t)r*=i.evaluate(e);return r}],"-":{type:He,overloads:[[[He,He],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[He],(e,[t])=>-t.evaluate(e)]]},"/":[He,[He,He],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[He,[He,He],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[He,[He],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[He,[He],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[He,[He],(e,[t])=>Math.log(t.evaluate(e))],log2:[He,[He],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[He,[He],(e,[t])=>Math.sin(t.evaluate(e))],cos:[He,[He],(e,[t])=>Math.cos(t.evaluate(e))],tan:[He,[He],(e,[t])=>Math.tan(t.evaluate(e))],asin:[He,[He],(e,[t])=>Math.asin(t.evaluate(e))],acos:[He,[He],(e,[t])=>Math.acos(t.evaluate(e))],atan:[He,[He],(e,[t])=>Math.atan(t.evaluate(e))],min:[He,Mr(He),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[He,Mr(He),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[He,[He],(e,[t])=>Math.abs(t.evaluate(e))],round:[He,[He],(e,[t])=>{e=t.evaluate(e);return e<0?-Math.round(-e):Math.round(e)}],floor:[He,[He],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[He,[He],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ze,[We,Ye],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[Ze,[Ye],(e,[t])=>e.id()===t.value],"filter-type-==":[Ze,[We],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ze,[We,Ye],(e,[t,r])=>{t=e.properties()[t.value],r=r.value;return typeof t==typeof r&&t<r}],"filter-id-<":[Ze,[Ye],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<t}],"filter->":[Ze,[We,Ye],(e,[t,r])=>{t=e.properties()[t.value],r=r.value;return typeof t==typeof r&&r<t}],"filter-id->":[Ze,[Ye],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<e}],"filter-<=":[Ze,[We,Ye],(e,[t,r])=>{t=e.properties()[t.value],r=r.value;return typeof t==typeof r&&t<=r}],"filter-id-<=":[Ze,[Ye],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<=t}],"filter->=":[Ze,[We,Ye],(e,[t,r])=>{t=e.properties()[t.value],r=r.value;return typeof t==typeof r&&r<=t}],"filter-id->=":[Ze,[Ye],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<=e}],"filter-has":[Ze,[Ye],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ze,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Ze,[et(We)],(e,[t])=>0<=t.value.indexOf(e.geometryType())],"filter-id-in":[Ze,[et(Ye)],(e,[t])=>0<=t.value.indexOf(e.id())],"filter-in-small":[Ze,[We,et(Ye)],(e,[t,r])=>0<=r.value.indexOf(e.properties()[t.value])],"filter-in-large":[Ze,[We,et(Ye)],(e,[t,r])=>function(e,t,r,i){for(;r<=i;){var n=r+i>>1;if(t[n]===e)return!0;t[n]>e?i=n-1:r=1+n}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ze,overloads:[[[Ze,Ze],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Mr(Ze),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:Ze,overloads:[[[Ze,Ze],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Mr(Ze),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[Ze,[Ze],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ze,[We],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[We,[We],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[We,[We],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[We,Mr(Ye),(t,e)=>e.map(e=>gt(e.evaluate(t))).join("")],"resolved-locale":[We,[Ke],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Ur{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Mt,this._defaultValue=t?"color"===(e=t).type&&Dr(e.default)?new lt(0,0,0,0):"color"===e.type?lt.parse(e.default)||null:void 0===e.default?null:e.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,i,n,a,s,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=o||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,i,n,a,s,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new vt(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Gr(e){return Array.isArray(e)&&0<e.length&&"string"==typeof e[0]&&e[0]in Tr}function Vr(e,t){const r=new Ht(Tr,[],t?(n=t,a={color:qe,string:We,number:He,enum:We,boolean:Ze,formatted:Je,resolvedImage:Qe},"array"===n.type?et(a[n.value]||Ye,n.length):a[n.type]):void 0),i=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);var n,a;return i?Ar(new Ur(i,t)):Cr(r.errors)}class $r{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Vt(t.expression)}evaluateWithoutErrorHandling(e,t,r,i,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,n,a)}evaluate(e,t,r,i,n,a){return this._styleExpression.evaluate(e,t,r,i,n,a)}}class jr{constructor(e,t,r,i){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Vt(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,r,i,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,i,n,a)}evaluate(e,t,r,i,n,a){return this._styleExpression.evaluate(e,t,r,i,n,a)}interpolationFactor(e,t,r){return this.interpolationType?hr.interpolationFactor(this.interpolationType,e,t,r):0}}function Hr(e,t){if("error"===(e=Vr(e,t)).result)return e;var r=e.value.expression,i=Gt(r);if(!i&&!Lr(t))return Cr([new Ve("","data expressions not supported")]);var n=$t(r,["zoom","pitch","distance-from-center"]);if(!n&&!Pr(t))return Cr([new Ve("","zoom expressions not supported")]);r=function r(e){let i=null;if(e instanceof pr)i=r(e.result);else if(e instanceof dr){for(const t of e.args)if(i=r(t),i)break}else(e instanceof Zt||e instanceof hr)&&e.input instanceof At&&"zoom"===e.input.name&&(i=e);return i instanceof Ve||e.eachChild(e=>{const t=r(e);t instanceof Ve?i=t:!i&&t?i=new Ve("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&t&&i!==t&&(i=new Ve("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}(r);return r||n?r instanceof Ve?Cr([r]):r instanceof hr&&!Ir(t)?Cr([new Ve("",'"interpolate" expressions cannot be used with this property')]):Ar(r?new jr(i?"camera":"composite",e.value,r.labels,r instanceof hr?r.interpolation:void 0):new $r(i?"constant":"source",e.value)):Cr([new Ve("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Wr{constructor(e,t){this._parameters=e,this._specification=t,Ne(this,function e(r,i){const t="color"===i.type,n=r.stops&&"object"==typeof r.stops[0][0],a=n||!(n||void 0!==r.property),s=r.type||(Ir(i)?"exponential":"interval");if(t&&((r=Ne({},r)).stops&&(r.stops=r.stops.map(e=>[e[0],lt.parse(e[1])])),r.default=lt.parse(r.default||i.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!cr[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let o,l,c;if("exponential"===s)o=zr;else if("interval"===s)o=Fr;else if("categorical"===s){o=Br,l=Object.create(null);for(const i of r.stops)l[i[0]]=i[1];c=typeof r.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);o=Nr}if(n){const t={},n=[];for(let e=0;e<r.stops.length;e++){const a=r.stops[e],s=a[0].zoom;void 0===t[s]&&(t[s]={zoom:s,type:r.type,property:r.property,default:r.default,stops:[]},n.push(s)),t[s].stops.push([a[0].value,a[1]])}const a=[];for(const r of n)a.push([t[r].zoom,e(t[r],i)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:hr.interpolationFactor.bind(void 0,s),zoomStops:a.map(e=>e[0]),evaluate:({zoom:e},t)=>zr({stops:a,base:r.base},i,e).evaluate(e,t)}}if(a){const t="exponential"===s?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:hr.interpolationFactor.bind(void 0,t),zoomStops:r.stops.map(e=>e[0]),evaluate:({zoom:e})=>o(r,i,e,l,c)}}return{kind:"source",evaluate(e,t){return void 0===(t=t&&t.properties?t.properties[r.property]:void 0)?kr(r.default,i.default):o(r,i,t,l,c)}}}(this._parameters,this._specification))}static deserialize(e){return new Wr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Zr(t){var r=t.key,i=t.value,n=t.valueSpec||{},a=t.objectElementValidators||{},s=t.style,o=t.styleSpec;let l=[];const c=Rr(i);if("object"!==c)return[new Fe(r,i,`object expected, ${c} found`)];for(const t in i){const c=t.split(".")[0],h=n[c]||n["*"];let e;if(a[c])e=a[c];else if(n[c])e=bi;else if(a["*"])e=a["*"];else{if(!n["*"]){l.push(new Fe(r,i[t],`unknown property "${t}"`));continue}e=bi}l=l.concat(e({key:(r&&`${r}.`)+t,value:i[t],valueSpec:h,style:s,styleSpec:o,object:i,objectKey:t},i))}for(const t in n)a[t]||n[t].required&&void 0===n[t].default&&void 0===i[t]&&l.push(new Fe(r,i,`missing required property "${t}"`));return l}function qr(e){const t=e.value,r=e.valueSpec,i=e.style,n=e.styleSpec,a=e.key,s=e.arrayElementValidator||bi;if("array"!==Rr(t))return[new Fe(a,t,`array expected, ${Rr(t)} found`)];if(r.length&&t.length!==r.length)return[new Fe(a,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Fe(a,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let o={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};n.$version<7&&(o.function=r.function),"object"===Rr(r.value)&&(o=r.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:o,style:i,styleSpec:n,key:`${a}[${e}]`}));return l}function Xr(t){var r=t.key,i=t.value,n=t.valueSpec;let e=Rr(i);if("number"===e&&i!=i&&(e="NaN"),"number"!==e)return[new Fe(r,i,`number expected, ${e} found`)];if("minimum"in n){let e=n.minimum;if("array"===Rr(n.minimum)&&(e=n.minimum[t.arrayIndex]),i<e)return[new Fe(r,i,`${i} is less than the minimum value ${e}`)]}if("maximum"in n){let e=n.maximum;if("array"===Rr(n.maximum)&&(e=n.maximum[t.arrayIndex]),i>e)return[new Fe(r,i,`${i} is greater than the maximum value ${e}`)]}return[]}function Yr(e){const n=e.valueSpec,a=Ue(e.value.type);let s,o,l,c={};const t="categorical"!==a&&void 0===e.value.property,r=!t,h="array"===Rr(e.value.stops)&&"array"===Rr(e.value.stops[0])&&"object"===Rr(e.value.stops[0][0]),i=Zr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===a)return[new Fe(e.key,e.value,'identity function may not have a "stops" property')];let t=[];var r=e.value;return t=t.concat(qr({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:u})),"array"===Rr(r)&&0===r.length&&t.push(new Fe(e.key,r,"array must have at least one stop")),t},default:function(e){return bi({key:e.key,value:e.value,valueSpec:n,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===a&&t&&i.push(new Fe(e.key,e.value,'missing required property "property"')),"identity"===a||e.value.stops||i.push(new Fe(e.key,e.value,'missing required property "stops"')),"exponential"===a&&e.valueSpec.expression&&!Ir(e.valueSpec)&&i.push(new Fe(e.key,e.value,"exponential functions not supported")),8<=e.styleSpec.$version&&(r&&!Lr(e.valueSpec)?i.push(new Fe(e.key,e.value,"property functions not supported")):t&&!Pr(e.valueSpec)&&i.push(new Fe(e.key,e.value,"zoom functions not supported"))),"categorical"!==a&&!h||void 0!==e.value.property||i.push(new Fe(e.key,e.value,'"property" property is required')),i;function u(e){let t=[];var r=e.value,i=e.key;if("array"!==Rr(r))return[new Fe(i,r,`array expected, ${Rr(r)} found`)];if(2!==r.length)return[new Fe(i,r,`array length 2 expected, length ${r.length} found`)];if(h){if("object"!==Rr(r[0]))return[new Fe(i,r,`object expected, ${Rr(r[0])} found`)];if(void 0===r[0].zoom)return[new Fe(i,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Fe(i,r,"object stop key must have value")];if(l&&l>Ue(r[0].zoom))return[new Fe(i,r[0].zoom,"stop zoom values must appear in ascending order")];Ue(r[0].zoom)!==l&&(l=Ue(r[0].zoom),o=void 0,c={}),t=t.concat(Zr({key:`${i}[0]`,value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Xr,value:d}}))}else t=t.concat(d({key:`${i}[0]`,value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return Gr(Ge(r[1]))?t.concat([new Fe(`${i}[1]`,r[1],"expressions are not allowed in function stops.")]):t.concat(bi({key:`${i}[1]`,value:r[1],valueSpec:n,style:e.style,styleSpec:e.styleSpec}))}function d(t,r){var i=Rr(t.value),e=Ue(t.value),r=null!==t.value?t.value:r;if(s){if(i!==s)return[new Fe(t.key,r,`${i} stop domain type must match previous stop domain type ${s}`)]}else s=i;if("number"!==i&&"string"!==i&&"boolean"!==i)return[new Fe(t.key,r,"stop domain value must be a number, string, or boolean")];if("number"===i||"categorical"===a)return"categorical"!==a||"number"!==i||isFinite(e)&&Math.floor(e)===e?"categorical"!==a&&"number"===i&&void 0!==o&&e<o?[new Fe(t.key,r,"stop domain values must appear in ascending order")]:(o=e,"categorical"===a&&e in c?[new Fe(t.key,r,"stop domain values must be unique")]:(c[e]=!0,[])):[new Fe(t.key,r,`integer expected, found ${e}`)];{let e=`number expected, ${i} found`;return Lr(n)&&void 0===a&&(e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(t.key,r,e)]}}}function Kr(t){const e=("property"===t.expressionContext?Hr:Vr)(Ge(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new Fe(`${t.key}${e.key}`,t.value,e.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new Fe(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Vt(r))return[new Fe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return function t(e,r){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const e of r.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const n=[];return e instanceof At&&i.has(e.name)?[new Fe(r.key,r.value,`["${e.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(e.eachChild(e=>{n.push(...t(e,r))}),n)}(r,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!$t(r,["zoom","feature-state"]))return[new Fe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Gt(r))return[new Fe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jr(e){const t=e.key,r=e.value,i=e.valueSpec,n=[];return Array.isArray(i.values)?-1===i.values.indexOf(Ue(r))&&n.push(new Fe(t,r,`expected one of [${i.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(i.values).indexOf(Ue(r))&&n.push(new Fe(t,r,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(r)} found`)),n}function Qr(e){if(!0===e||!1===e)return 1;if(Array.isArray(e)&&0!==e.length)switch(e[0]){case"has":return 2<=e.length&&"$id"!==e[1]&&"$type"!==e[1];case"in":return 3<=e.length&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Qr(t)&&"boolean"!=typeof t)return;return 1;default:return 1}}function ei(a,e="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};var t=a=!Qr(a)?ni(a):a;let r=!0;try{r=function(e){if(!ti(e))return e;e=Ge(e);return function t(r){let i=!1;const n=[];if("case"===r[0]){for(let e=1;e<r.length-1;e+=2)i=i||ti(r[e]),n.push(r[e+1]);n.push(r[r.length-1])}else if("match"===r[0]){i=i||ti(r[1]);for(let e=2;e<r.length-1;e+=2)n.push(r[e+1]);n.push(r[r.length-1])}else if("step"===r[0]){i=i||ti(r[1]);for(let e=1;e<r.length-1;e+=2)n.push(r[e+1])}i&&(r.length=0,r.push("any",...n));for(let e=1;e<r.length;e++)t(r[e])}(e),function t(e){if(!Array.isArray(e))return e;const r=function(t){if(ri.has(t[0]))for(let e=1;e<t.length;e++)if(ti(t[e]))return!0;return t}(e);return!0===r?r:r.map(e=>t(e))}(e)}(t)}catch(a){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(t,null,2)}\n        `)}const i=Be[`filter_${e}`],n=Vr(r,i);e=null;if("error"===n.result)throw new Error(n.value.map(e=>`${e.key}: ${e.message}`).join(", "));e=(e,t,r)=>n.value.evaluate(e,t,{},r);let s=null,o=null;if(r!==t){const a=Vr(t,i);if("error"===a.result)throw new Error(a.value.map(e=>`${e.key}: ${e.message}`).join(", "));s=(e,t,r,i,n)=>a.value.evaluate(e,t,{},r,void 0,void 0,i,n),o=!Gt(a.value.expression)}return{filter:e,dynamicFilter:s||void 0,needGeometry:function t(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let e=1;e<r.length;e++)if(t(r[e]))return!0;return!1}(r),needFeature:!!o}}function ti(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(ti(t[e]))return!0;return!1}const ri=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ii(e,t){return e<t?-1:t<e?1:0}function ni(e){if(!e)return!0;var t,r=e[0];return e.length<=1?"any"!==r:"=="===r?ai(e[1],e[2],"=="):"!="===r?li(ai(e[1],e[2],"==")):"<"===r||">"===r||"<="===r||">="===r?ai(e[1],e[2],r):"any"===r?(t=e.slice(1),["any"].concat(t.map(ni))):"all"===r?["all"].concat(e.slice(1).map(ni)):"none"===r?["all"].concat(e.slice(1).map(ni).map(li)):"in"===r?si(e[1],e.slice(2)):"!in"===r?li(si(e[1],e.slice(2))):"has"===r?oi(e[1]):"!has"===r?li(oi(e[1])):"within"!==r||e}function ai(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function si(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return 200<t.length&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(ii)]]:["filter-in-small",e,["literal",t]]}}function oi(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function li(e){return["!",e]}function ci(e){if(Qr(Ge(e.value))){var t=Ge(e.layerType);return Kr(Ne({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${t||"fill"}`]}))}return function t(r){const i=r.value,n=r.key;if("array"!==Rr(i))return[new Fe(n,i,`array expected, ${Rr(i)} found`)];const a=r.styleSpec;let s,o=[];if(i.length<1)return[new Fe(n,i,"filter array must have at least 1 element")];switch(o=o.concat(Jr({key:`${n}[0]`,value:i[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ue(i[0])){case"<":case"<=":case">":case">=":2<=i.length&&"$type"===Ue(i[1])&&o.push(new Fe(n,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&o.push(new Fe(n,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":2<=i.length&&(s=Rr(i[1]),"string"!==s&&o.push(new Fe(`${n}[1]`,i[1],`string expected, ${s} found`)));for(let e=2;e<i.length;e++)s=Rr(i[e]),"$type"===Ue(i[1])?o=o.concat(Jr({key:`${n}[${e}]`,value:i[e],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&o.push(new Fe(`${n}[${e}]`,i[e],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let e=1;e<i.length;e++)o=o.concat(t({key:`${n}[${e}]`,value:i[e],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":s=Rr(i[1]),2!==i.length?o.push(new Fe(n,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==s&&o.push(new Fe(`${n}[1]`,i[1],`string expected, ${s} found`));break;case"within":s=Rr(i[1]),2!==i.length?o.push(new Fe(n,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==s&&o.push(new Fe(`${n}[1]`,i[1],`object expected, ${s} found`))}return o}(e)}function hi(e,t){const r=e.key,i=e.style,n=e.styleSpec,a=e.value,s=e.objectKey,o=n[`${t}_${e.layerType}`];if(!o)return[];var l=s.match(/^(.*)-transition$/);if("paint"===t&&l&&o[l[1]]&&o[l[1]].transition)return bi({key:r,value:a,valueSpec:n.transition,style:i,styleSpec:n});l=e.valueSpec||o[s];if(!l)return[new Fe(r,a,`unknown property "${s}"`)];let c;if("string"===Rr(a)&&Lr(l)&&!l.tokens&&(c=/^{([^}]+)}$/.exec(a)))return[new Fe(r,a,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===s&&i&&!i.glyphs&&h.push(new Fe(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Dr(Ge(a))&&"identity"===Ue(a.type)&&h.push(new Fe(r,a,'"text-font" does not support identity functions'))),h.concat(bi({key:e.key,value:a,valueSpec:l,style:i,styleSpec:n,expressionContext:"property",propertyType:t,propertyKey:s}))}function ui(e){return hi(e,"paint")}function di(e){return hi(e,"layout")}function pi(t){let r=[];const i=t.value,n=t.key,a=t.style,s=t.styleSpec;i.type||i.ref||r.push(new Fe(n,i,'either "type" or "ref" is required'));let o=Ue(i.type);const l=Ue(i.ref);if(i.id){const s=Ue(i.id);for(let e=0;e<t.arrayIndex;e++){const t=a.layers[e];Ue(t.id)===s&&r.push(new Fe(n,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach(e=>{e in i&&r.push(new Fe(n,i[e],`"${e}" is prohibited for ref layers`))}),a.layers.forEach(e=>{Ue(e.id)===l&&(t=e)}),t?t.ref?r.push(new Fe(n,i.ref,"ref cannot reference another ref layer")):o=Ue(t.type):r.push(new Fe(n,i.ref,`ref layer "${l}" not found`))}else if("background"!==o&&"sky"!==o)if(i.source){const t=a.sources&&a.sources[i.source],s=t&&Ue(t.type);t?"vector"===s&&"raster"===o?r.push(new Fe(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===s&&"raster"!==o?r.push(new Fe(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==s||i["source-layer"]?"raster-dem"===s&&"hillshade"!==o?r.push(new Fe(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!i.paint||!i.paint["line-gradient"]||"geojson"===s&&t.lineMetrics||r.push(new Fe(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Fe(n,i,`layer "${i.id}" must specify a "source-layer"`)):r.push(new Fe(n,i.source,`source "${i.source}" not found`))}else r.push(new Fe(n,i,'missing required property "source"'));return r=r.concat(Zr({key:n,value:i,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bi({key:`${n}.type`,value:i.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:e=>ci(Ne({layerType:o},e)),layout:e=>Zr({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>di(Ne({layerType:o},e))}}),paint:e=>Zr({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ui(Ne({layerType:o},e))}})}})),r}function fi(e){var t=e.value,r=e.key,e=Rr(t);return"string"!==e?[new Fe(r,t,`string expected, ${e} found`)]:[]}const mi={promoteId:function({key:e,value:t}){if("string"===Rr(t))return fi({key:e,value:t});{const r=[];for(const i in t)r.push(...fi({key:`${e}.${i}`,value:t[i]}));return r}}};function gi(e){const t=e.value,r=e.key,i=e.styleSpec,n=e.style;if(!t.type)return[new Fe(r,t,'"type" is required')];const a=Ue(t.type);let s;switch(a){case"vector":case"raster":case"raster-dem":return s=Zr({key:r,value:t,valueSpec:i[`source_${a.replace("-","_")}`],style:e.style,styleSpec:i,objectElementValidators:mi}),s;case"geojson":if(s=Zr({key:r,value:t,valueSpec:i.source_geojson,style:n,styleSpec:i,objectElementValidators:mi}),t.cluster)for(const e in t.clusterProperties){const[i,n]=t.clusterProperties[e],a="string"==typeof i?[i,["accumulated"],["get",e]]:i;s.push(...Kr({key:`${r}.${e}.map`,value:n,expressionContext:"cluster-map"})),s.push(...Kr({key:`${r}.${e}.reduce`,value:a,expressionContext:"cluster-reduce"}))}return s;case"video":return Zr({key:r,value:t,valueSpec:i.source_video,style:n,styleSpec:i});case"image":return Zr({key:r,value:t,valueSpec:i.source_image,style:n,styleSpec:i});case"canvas":return[new Fe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jr({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:i})}}function _i(e){var t=e.value,r=e.styleSpec,i=r.light,n=e.style;let a=[];const s=Rr(t);if(void 0===t)return a;if("object"!==s)return a=a.concat([new Fe("light",t,`object expected, ${s} found`)]),a;for(const e in t){const s=e.match(/^(.*)-transition$/);a=a.concat(s&&i[s[1]]&&i[s[1]].transition?bi({key:e,value:t[e],valueSpec:r.transition,style:n,styleSpec:r}):i[e]?bi({key:e,value:t[e],valueSpec:i[e],style:n,styleSpec:r}):[new Fe(e,t[e],`unknown property "${e}"`)])}return a}function vi(e){const t=e.value,r=e.key,i=e.style,n=e.styleSpec,a=n.terrain;let s=[];e=Rr(t);if(void 0===t)return s;if("object"!==e)return s=s.concat([new Fe("terrain",t,`object expected, ${e} found`)]),s;for(const o in t){const r=o.match(/^(.*)-transition$/);s=s.concat(r&&a[r[1]]&&a[r[1]].transition?bi({key:o,value:t[o],valueSpec:n.transition,style:i,styleSpec:n}):a[o]?bi({key:o,value:t[o],valueSpec:a[o],style:i,styleSpec:n}):[new Fe(o,t[o],`unknown property "${o}"`)])}if(t.source){const o=i.sources&&i.sources[t.source],n=o&&Ue(o.type);o?"raster-dem"!==n&&s.push(new Fe(r,t.source,`terrain cannot be used with a source of type ${n}, it only be used with a "raster-dem" source type`)):s.push(new Fe(r,t.source,`source "${t.source}" not found`))}else s.push(new Fe(r,t,'terrain is missing required property "source"'));return s}function yi(e){var t=e.value,r=e.style,i=e.styleSpec,n=i.fog;let a=[];const s=Rr(t);if(void 0===t)return a;if("object"!==s)return a=a.concat([new Fe("fog",t,`object expected, ${s} found`)]),a;for(const e in t){const s=e.match(/^(.*)-transition$/);a=a.concat(s&&n[s[1]]&&n[s[1]].transition?bi({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i}):n[e]?bi({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}):[new Fe(e,t[e],`unknown property "${e}"`)])}return a}const xi={"*":()=>[],array:qr,boolean:function(e){var t=e.value,r=e.key,e=Rr(t);return"boolean"!==e?[new Fe(r,t,`boolean expected, ${e} found`)]:[]},number:Xr,color:function(e){var t=e.key,r=e.value,e=Rr(r);return"string"!==e?[new Fe(t,r,`color expected, ${e} found`)]:null===ot.parseCSSColor(r)?[new Fe(t,r,`color expected, "${r}" found`)]:[]},constants:ze,enum:Jr,filter:ci,function:Yr,layer:pi,object:Zr,source:gi,light:_i,terrain:vi,fog:yi,string:fi,formatted:function(e){return 0===fi(e).length?[]:Kr(e)},resolvedImage:function(e){return 0===fi(e).length?[]:Kr(e)},projection:function(e){var t=e.value,r=e.styleSpec,i=r.projection,n=e.style;let a=[];e=Rr(t);if("object"===e)for(const s in t)a=a.concat(bi({key:s,value:t[s],valueSpec:i[s],style:n,styleSpec:r}));else"string"!==e&&(a=a.concat([new Fe("projection",t,`object or string expected, ${e} found`)]));return a}};function bi(e){var t=e.value,r=e.valueSpec,i=e.styleSpec;return r.expression&&Dr(Ue(t))?Yr(e):r.expression&&Gr(Ge(t))?Kr(e):r.type&&xi[r.type]?xi[r.type](e):Zr(Ne({},e,{valueSpec:r.type?i[r.type]:r}))}function wi(e){const t=e.value,r=e.key,i=fi(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new Fe(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new Fe(r,t,'"glyphs" url must include a "{range}" token'))),i}function Ti(e,t=Be){let r=[];return r=r.concat(bi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:wi,"*":()=>[]}})),e.constants&&(r=r.concat(ze({key:"constants",value:e.constants,style:e,styleSpec:t}))),Ei(r)}function Ei(e){return[].concat(e).sort((e,t)=>e.line-t.line)}function Si(t){return function(...e){return Ei(t.apply(this,e))}}Ti.source=Si(gi),Ti.light=Si(_i),Ti.terrain=Si(vi),Ti.fog=Si(yi),Ti.layer=Si(pi),Ti.filter=Si(ci),Ti.paintProperty=Si(ui),Ti.layoutProperty=Si(di);const Mi=Ti,Ai=Mi.light,Ci=Mi.fog,Li=Mi.paintProperty,Pi=Mi.layoutProperty;function Ii(e,t){let r=!1;if(t&&t.length)for(const i of t)e.fire(new Oe(new Error(i.message))),r=!0;return r}var Ri=Di;function Di(e,t,r){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(r=n[2]);for(var a=0;a<this.d*this.d;a++){var s=n[3+a],o=n[3+a+1];i.push(s===o?null:n.subarray(s,o))}var l=n[3+i.length+1];this.keys=n.subarray(n[3+i.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;t=r/t*e;this.min=-t,this.max=e+t}Di.prototype.insert=function(e,t,r,i,n){this._forEachCell(t,r,i,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},Di.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Di.prototype._insertCell=function(e,t,r,i,n,a){this.cells[n].push(a)},Di.prototype.query=function(e,t,r,i,n){var a=this.min,s=this.max;if(e<=a&&t<=a&&s<=r&&s<=i&&!n)return Array.prototype.slice.call(this.keys);s=[];return this._forEachCell(e,t,r,i,this._queryCell,s,{},n),s},Di.prototype._queryCell=function(e,t,r,i,n,a,s,o){var l=this.cells[n];if(null!==l)for(var c=this.keys,h=this.bboxes,u=0;u<l.length;u++){var d,p=l[u];void 0===s[p]&&(d=4*p,(o?o(h[0+d],h[1+d],h[2+d],h[3+d]):e<=h[2+d]&&t<=h[3+d]&&r>=h[0+d]&&i>=h[1+d])?(s[p]=!0,a.push(c[p])):s[p]=!1)}},Di.prototype._forEachCell=function(e,t,r,i,n,a,s,o){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),h=this._convertToCellCoord(r),u=this._convertToCellCoord(i),d=l;d<=h;d++)for(var p=c;p<=u;p++){var f=this.d*p+d;if((!o||o(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,r,i,f,a,s,o))return}},Di.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Di.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Di.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var n=new Int32Array(t+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var a=t,s=0;s<e.length;s++){var o=e[s];n[3+s]=a,n.set(o,a),a+=o.length}return n[3+e.length]=a,n.set(this.keys,a),n[3+e.length+1]=a+=this.keys.length,n.set(this.bboxes,a),a+=this.bboxes.length,n.buffer};const{ImageData:Oi,ImageBitmap:ki}=u,Bi={};function Fi(e,t,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Bi[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Fi("Object",Object),Ri.serialize=function(e,t){e=e.toArrayBuffer();return t&&t.push(e),{buffer:e}},Ri.deserialize=function(e){return new Ri(e.buffer)},Fi("Grid",Ri),Fi("Color",lt),Fi("Error",Error),Fi("ResolvedImage",dt),Fi("StylePropertyFunction",Wr),Fi("StyleExpression",Ur,{omit:["_evaluator"]}),Fi("ZoomDependentExpression",jr),Fi("ZoomConstantExpression",$r),Fi("CompoundExpression",At,{omit:["_evaluate"]});for(const l in Tr)Tr[l]._classRegistryKey||Fi(`Expression_${l}`,Tr[l]);function zi(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ni(e){return ki&&e instanceof ki}function Ui(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(zi(e)||Ni(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Oi)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const a of e)n.push(Ui(a,t));return n}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);{const s=e.constructor,o=s._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");const l=s.serialize?s.serialize(e,t):{};if(!s.serialize){for(const c in e){var i;e.hasOwnProperty(c)&&(0<=Bi[o].omit.indexOf(c)||(i=e[c],l[c]=0<=Bi[o].shallow.indexOf(c)?i:Ui(i,t)))}e instanceof Error&&(l.message=e.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==o&&(l.$name=o),l}}function Gi(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||zi(e)||Ni(e)||ArrayBuffer.isView(e)||e instanceof Oi)return e;if(Array.isArray(e))return e.map(Gi);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);{const r=e.$name||"Object",i=Bi[r]["klass"];if(!i)throw new Error(`can't deserialize unregistered class ${r}`);if(i.deserialize)return i.deserialize(e);const n=Object.create(i.prototype);for(const a of Object.keys(e)){var t;"$name"!==a&&(t=e[a],n[a]=0<=Bi[r].shallow.indexOf(a)?t:Gi(t))}return n}}class Vi{constructor(){this.first=!0}update(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const $i=e=>1536<=e&&e<=1791,ji=e=>1872<=e&&e<=1919,Hi=e=>2208<=e&&e<=2303,Wi=e=>11904<=e&&e<=12031,Zi=e=>12032<=e&&e<=12255,qi=e=>12272<=e&&e<=12287,Xi=e=>12288<=e&&e<=12351,Yi=e=>12352<=e&&e<=12447,Ki=e=>12448<=e&&e<=12543,Ji=e=>12544<=e&&e<=12591,Qi=e=>12704<=e&&e<=12735,en=e=>12736<=e&&e<=12783,tn=e=>12784<=e&&e<=12799,rn=e=>12800<=e&&e<=13055,nn=e=>13056<=e&&e<=13311,an=e=>13312<=e&&e<=19903,sn=e=>19968<=e&&e<=40959,on=e=>40960<=e&&e<=42127,ln=e=>42128<=e&&e<=42191,cn=e=>44032<=e&&e<=55215,hn=e=>63744<=e&&e<=64255,un=e=>64336<=e&&e<=65023,dn=e=>65040<=e&&e<=65055,pn=e=>65072<=e&&e<=65103,fn=e=>65104<=e&&e<=65135,mn=e=>65136<=e&&e<=65279,gn=e=>65280<=e&&e<=65519;function _n(e){for(const t of e)if(yn(t.charCodeAt(0)))return!0;return!1}function vn(e){for(const r of e)if(t=r.charCodeAt(0),$i(t)||ji(t)||Hi(t)||un(t)||mn(t))return;var t;return 1}function yn(e){return 746===e||747===e||!(e<4352)&&(Qi(e)||Ji(e)||pn(e)&&!(65097<=e&&e<=65103)||hn(e)||nn(e)||Wi(e)||en(e)||!(!Xi(e)||12296<=e&&e<=12305||12308<=e&&e<=12319||12336===e)||an(e)||sn(e)||rn(e)||12592<=e&&e<=12687||43360<=e&&e<=43391||55216<=e&&e<=55295||4352<=e&&e<=4607||cn(e)||Yi(e)||qi(e)||12688<=e&&e<=12703||Zi(e)||tn(e)||Ki(e)&&12540!==e||!(!gn(e)||65288===e||65289===e||65293===e||65306<=e&&e<=65310||65339===e||65341===e||65343===e||65371<=e&&e<=65503||65507===e||65512<=e&&e<=65519)||!(!fn(e)||65112<=e&&e<=65118||65123<=e&&e<=65126)||5120<=e&&e<=5759||6320<=e&&e<=6399||dn(e)||19904<=e&&e<=19967||on(e)||ln(e))}function xn(e){return!(yn(e)||(128<=(e=e)&&e<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||8192<=e&&e<=8303&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||8448<=e&&e<=8527||8528<=e&&e<=8591||8960<=e&&e<=9215&&(8960<=e&&e<=8967||8972<=e&&e<=8991||8996<=e&&e<=9e3||9003===e||9085<=e&&e<=9114||9150<=e&&e<=9165||9167===e||9169<=e&&e<=9179||9186<=e&&e<=9215)||9216<=e&&e<=9279&&9251!==e||9280<=e&&e<=9311||9312<=e&&e<=9471||9632<=e&&e<=9727||9728<=e&&e<=9983&&!(9754<=e&&e<=9759)||11008<=e&&e<=11263&&(11026<=e&&e<=11055||11088<=e&&e<=11097||11192<=e&&e<=11243)||Xi(e)||Ki(e)||57344<=e&&e<=63743||pn(e)||fn(e)||gn(e)||8734===e||8756===e||8757===e||9984<=e&&e<=10087||10102<=e&&e<=10131||65532===e||65533===e))}function bn(e){return 1424<=e&&e<=2303||un(e)||mn(e)}const wn="deferred",Tn="loading",En="loaded";let Sn=null,Mn="unavailable",An=null;function Cn(e){e&&"string"==typeof e&&-1<e.indexOf("NetworkError")&&(Mn="error"),Sn&&Sn(e)}function Ln(){Rn.fire(new De("pluginStateChange",{pluginStatus:Mn,pluginURL:An}))}function Pn(){return Mn}function In(){if(Mn!==wn||!An)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Mn=Tn,Ln(),An&&Te({url:An},e=>{e?Cn(e):(Mn=En,Ln())})}const Rn=new ke,Dn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Mn===En||null!=Dn.applyArabicShaping,isLoading:()=>Mn===Tn,setState(e){Mn=e.pluginStatus,An=e.pluginURL},isParsed:()=>null!=Dn.applyArabicShaping&&null!=Dn.processBidirectionalText&&null!=Dn.processStyledBidirectionalText,getPluginURL:()=>An};class On{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vi,this.transition={},this.pitch=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(r=n.charCodeAt(0),i=t,!i&&bn(r)||2304<=r&&r<=3583||3840<=r&&r<=4255||6016<=r&&r<=6143)return!1;var r,i;return!0}(e,Dn.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}}}class kn{constructor(e,t){this.property=e,this.value=t,this.expression=function(t,r){if(Dr(t))return new Wr(t,r);if(Gr(t)){const e=Hr(t,r);if("error"===e.result)throw new Error(e.value.map(e=>`${e.key}: ${e.message}`).join(", "));return e.value}{let e=t;return"string"==typeof t&&"color"===r.type&&(e=lt.parse(t)),{kind:"constant",evaluate:()=>e}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class Bn{constructor(e){this.property=e,this.value=new kn(e,void 0)}transitioned(e,t){return new zn(this.property,this.value,t,y({},e.transition,this.transition),e.now)}untransitioned(){return new zn(this.property,this.value,null,{},0)}}class Fn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return A(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Bn(this._values[e].property)),this._values[e].value=new kn(this._values[e].property,null===t?void 0:A(t))}getTransition(e){return A(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Bn(this._values[e].property)),this._values[e].transition=A(t)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){var t=this.getValue(r);void 0!==t&&(e[r]=t);t=this.getTransition(r);void 0!==t&&(e[`${r}-transition`]=t)}return e}transitioned(e,t){const r=new Nn(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].transitioned(e,t._values[i]);return r}untransitioned(){const e=new Nn(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class zn{constructor(e,t,r,i,n){var a=i.delay||0,s=i.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+a,this.end=this.begin+s,e.specification.transition&&(i.delay||i.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const i=e.now||0,n=this.value.possiblyEvaluate(e,t,r),a=this.prior;if(a){if(i>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(i<this.begin)return a.possiblyEvaluate(e,t,r);var s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,r),n,o(s))}return n}}class Nn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const i=new Vn(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(e,t,r);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Un{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return A(this._values[e].value)}setValue(e,t){this._values[e]=new kn(this._values[e].property,null===t?void 0:A(t))}serialize(){const e={};for(const r of Object.keys(this._values)){var t=this.getValue(r);void 0!==t&&(e[r]=t)}return e}possiblyEvaluate(e,t,r){const i=new Vn(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].possiblyEvaluate(e,t,r);return i}}class Gn{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,i){return this.property.evaluate(this.value,this.parameters,e,t,r,i)}}class Vn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class $n{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const i=Xt[this.specification.type];return i?i(e,t,r):e}}class jn{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,i){return new Gn(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,i)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Gn(this,{kind:"constant",value:void 0},e.parameters);const i=Xt[this.specification.type];return i?new Gn(this,{kind:"constant",value:i(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,i,n,a){return"constant"===e.kind?e.value:e.evaluate(t,r,i,n,a)}}class Hn extends jn{possiblyEvaluate(e,t,r,i){if(void 0===e.value)return new Gn(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){i=e.expression.evaluate(t,null,{},r,i),i="resolvedImage"===e.property.specification.type&&"string"!=typeof i?i.name:i,i=this._calculate(i,i,i,t);return new Gn(this,{kind:"constant",value:i},t)}if("camera"!==e.expression.kind)return new Gn(this,e.expression,t);{const r=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Gn(this,{kind:"constant",value:r},t)}}evaluate(e,t,r,i,n,a){if("source"!==e.kind)return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},r,i),e.evaluate({zoom:Math.floor(t.zoom)},r,i),e.evaluate({zoom:Math.floor(t.zoom)+1},r,i),t):e.value;a=e.evaluate(t,r,i,n,a);return this._calculate(a,a,a,t)}_calculate(e,t,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t,other:r}:{from:r,to:t,other:e}}interpolate(e){return e}}class Wn{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,i){if(void 0!==e.value){if("constant"!==e.expression.kind)return this._calculate(e.expression.evaluate(new On(Math.floor(t.zoom-1),t)),e.expression.evaluate(new On(Math.floor(t.zoom),t)),e.expression.evaluate(new On(Math.floor(t.zoom+1),t)),t);i=e.expression.evaluate(t,null,{},r,i);return this._calculate(i,i,i,t)}}_calculate(e,t,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class Zn{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,i){return!!e.expression.evaluate(t,null,{},r,i)}interpolate(){return!1}}class qn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){var t=e[r];t.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new kn(t,void 0),n=this.defaultTransitionablePropertyValues[r]=new Bn(t);this.defaultTransitioningPropertyValues[r]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate({})}}}function Xn(e,t){return 256*(e=S(Math.floor(e),0,255))+S(Math.floor(t),0,255)}Fi("DataDrivenProperty",jn),Fi("DataConstantProperty",$n),Fi("CrossFadedDataDrivenProperty",Hn),Fi("CrossFadedProperty",Wn),Fi("ColorRampProperty",Zn);const Yn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kn{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){e>this.capacity&&(this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),e=this.uint8,this._refreshViews(),e&&this.uint8.set(e))}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Qn(e,n=1){let a=0,s=0;return{members:e.map(e=>{var t=Yn[e.type].BYTES_PER_ELEMENT,r=a=ea(a,Math.max(n,t)),i=e.components||1;return s=Math.max(s,t),a+=t*i,{name:e.name,type:e.type,components:i,offset:r}}),size:ea(a,Math.max(s,n)),alignment:n}}function ea(e,t){return Math.ceil(e/t)*t}class ta extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var i=2*e;return this.int16[0+i]=t,this.int16[1+i]=r,e}}ta.prototype.bytesPerElement=4,Fi("StructArrayLayout2i4",ta);class ra extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){var a=4*e;return this.int16[0+a]=t,this.int16[1+a]=r,this.int16[2+a]=i,this.int16[3+a]=n,e}}ra.prototype.bytesPerElement=8,Fi("StructArrayLayout4i8",ra);class ia extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,i,n,a,s)}emplace(e,t,r,i,n,a,s,o){var l=6*e,c=12*e,h=3*e;return this.int16[0+l]=t,this.int16[1+l]=r,this.uint8[4+c]=i,this.uint8[5+c]=n,this.uint8[6+c]=a,this.uint8[7+c]=s,this.float32[2+h]=o,e}}ia.prototype.bytesPerElement=12,Fi("StructArrayLayout2i4ub1f12",ia);class na extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=3*e;return this.float32[0+n]=t,this.float32[1+n]=r,this.float32[2+n]=i,e}}na.prototype.bytesPerElement=12,Fi("StructArrayLayout3f12",na);class aa extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,i,n,a,s,o,l,c)}emplace(e,t,r,i,n,a,s,o,l,c,h){var u=10*e;return this.uint16[0+u]=t,this.uint16[1+u]=r,this.uint16[2+u]=i,this.uint16[3+u]=n,this.uint16[4+u]=a,this.uint16[5+u]=s,this.uint16[6+u]=o,this.uint16[7+u]=l,this.uint16[8+u]=c,this.uint16[9+u]=h,e}}aa.prototype.bytesPerElement=20,Fi("StructArrayLayout10ui20",aa);class sa extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o){var l=this.length;return this.resize(l+1),this.emplace(l,e,t,r,i,n,a,s,o)}emplace(e,t,r,i,n,a,s,o,l){var c=8*e;return this.uint16[0+c]=t,this.uint16[1+c]=r,this.uint16[2+c]=i,this.uint16[3+c]=n,this.uint16[4+c]=a,this.uint16[5+c]=s,this.uint16[6+c]=o,this.uint16[7+c]=l,e}}sa.prototype.bytesPerElement=16,Fi("StructArrayLayout8ui16",sa);class oa extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m){var g=this.length;return this.resize(g+1),this.emplace(g,e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m)}emplace(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g){var _=16*e;return this.int16[0+_]=t,this.int16[1+_]=r,this.int16[2+_]=i,this.int16[3+_]=n,this.uint16[4+_]=a,this.uint16[5+_]=s,this.uint16[6+_]=o,this.uint16[7+_]=l,this.int16[8+_]=c,this.int16[9+_]=h,this.int16[10+_]=u,this.int16[11+_]=d,this.int16[12+_]=p,this.int16[13+_]=f,this.int16[14+_]=m,this.int16[15+_]=g,e}}oa.prototype.bytesPerElement=32,Fi("StructArrayLayout4i4ui4i4i32",oa);class la extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[+e+0]=t,e}}la.prototype.bytesPerElement=4,Fi("StructArrayLayout1ul4",la);class ca extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,c,h,u,d){var p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,i,n,a,s,o,l,c,h,u,d)}emplace(e,t,r,i,n,a,s,o,l,c,h,u,d,p){var f=20*e,m=10*e;return this.int16[0+f]=t,this.int16[1+f]=r,this.int16[2+f]=i,this.int16[3+f]=n,this.int16[4+f]=a,this.float32[3+m]=s,this.float32[4+m]=o,this.float32[5+m]=l,this.float32[6+m]=c,this.int16[14+f]=h,this.uint32[8+m]=u,this.uint16[18+f]=d,this.uint16[19+f]=p,e}}ca.prototype.bytesPerElement=40,Fi("StructArrayLayout5i4f1i1ul2ui40",ca);class ha extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,i,n,a,s)}emplace(e,t,r,i,n,a,s,o){var l=8*e;return this.int16[0+l]=t,this.int16[1+l]=r,this.int16[2+l]=i,this.int16[4+l]=n,this.int16[5+l]=a,this.int16[6+l]=s,this.int16[7+l]=o,e}}ha.prototype.bytesPerElement=16,Fi("StructArrayLayout3i2i2i16",ha);class ua extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,i,n)}emplace(e,t,r,i,n,a){var s=4*e,o=8*e;return this.float32[0+s]=t,this.float32[1+s]=r,this.float32[2+s]=i,this.int16[6+o]=n,this.int16[7+o]=a,e}}ua.prototype.bytesPerElement=16,Fi("StructArrayLayout2f1f2i16",ua);class da extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){var a=12*e,s=3*e;return this.uint8[0+a]=t,this.uint8[1+a]=r,this.float32[1+s]=i,this.float32[2+s]=n,e}}da.prototype.bytesPerElement=12,Fi("StructArrayLayout2ub2f12",da);class pa extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=3*e;return this.uint16[0+n]=t,this.uint16[1+n]=r,this.uint16[2+n]=i,e}}pa.prototype.bytesPerElement=6,Fi("StructArrayLayout3ui6",pa);class fa extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x){var b=this.length;return this.resize(b+1),this.emplace(b,e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x)}emplace(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x,b){var w=30*e,T=15*e,E=60*e;return this.int16[0+w]=t,this.int16[1+w]=r,this.int16[2+w]=i,this.float32[2+T]=n,this.float32[3+T]=a,this.uint16[8+w]=s,this.uint16[9+w]=o,this.uint32[5+T]=l,this.uint32[6+T]=c,this.uint32[7+T]=h,this.uint16[16+w]=u,this.uint16[17+w]=d,this.uint16[18+w]=p,this.float32[10+T]=f,this.float32[11+T]=m,this.uint8[48+E]=g,this.uint8[49+E]=_,this.uint8[50+E]=v,this.uint32[13+T]=y,this.int16[28+w]=x,this.uint8[58+E]=b,e}}fa.prototype.bytesPerElement=60,Fi("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",fa);class ma extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x,b,w,T,E,S,M,A,C,L){var P=this.length;return this.resize(P+1),this.emplace(P,e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x,b,w,T,E,S,M,A,C,L)}emplace(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x,b,w,T,E,S,M,A,C,L,P){var I=38*e,R=19*e;return this.int16[0+I]=t,this.int16[1+I]=r,this.int16[2+I]=i,this.float32[2+R]=n,this.float32[3+R]=a,this.int16[8+I]=s,this.int16[9+I]=o,this.int16[10+I]=l,this.int16[11+I]=c,this.int16[12+I]=h,this.int16[13+I]=u,this.uint16[14+I]=d,this.uint16[15+I]=p,this.uint16[16+I]=f,this.uint16[17+I]=m,this.uint16[18+I]=g,this.uint16[19+I]=_,this.uint16[20+I]=v,this.uint16[21+I]=y,this.uint16[22+I]=x,this.uint16[23+I]=b,this.uint16[24+I]=w,this.uint16[25+I]=T,this.uint16[26+I]=E,this.uint16[27+I]=S,this.uint16[28+I]=M,this.uint32[15+R]=A,this.float32[16+R]=C,this.float32[17+R]=L,this.float32[18+R]=P,e}}ma.prototype.bytesPerElement=76,Fi("StructArrayLayout3i2f6i15ui1ul3f76",ma);class ga extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[+e+0]=t,e}}ga.prototype.bytesPerElement=4,Fi("StructArrayLayout1f4",ga);class _a extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r)}emplace(e,t,r,i){var n=3*e;return this.int16[0+n]=t,this.int16[1+n]=r,this.int16[2+n]=i,e}}_a.prototype.bytesPerElement=6,Fi("StructArrayLayout3i6",_a);class va extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){var a=6*e;return this.uint32[3*e+0]=t,this.uint16[2+a]=r,this.uint16[3+a]=i,this.uint16[4+a]=n,e}}va.prototype.bytesPerElement=12,Fi("StructArrayLayout1ul3ui12",va);class ya extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var i=2*e;return this.uint16[0+i]=t,this.uint16[1+i]=r,e}}ya.prototype.bytesPerElement=4,Fi("StructArrayLayout2ui4",ya);class xa extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[+e+0]=t,e}}xa.prototype.bytesPerElement=2,Fi("StructArrayLayout1ui2",xa);class ba extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var i=2*e;return this.float32[0+i]=t,this.float32[1+i]=r,e}}ba.prototype.bytesPerElement=8,Fi("StructArrayLayout2f8",ba);class wa extends Jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,i)}emplace(e,t,r,i,n){var a=4*e;return this.float32[0+a]=t,this.float32[1+a]=r,this.float32[2+a]=i,this.float32[3+a]=n,e}}wa.prototype.bytesPerElement=16,Fi("StructArrayLayout4f16",wa);class Ta extends Kn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ta.prototype.size=40;class Ea extends ca{get(e){return new Ta(this,e)}}Fi("CollisionBoxArray",Ea);class Sa extends Kn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Sa.prototype.size=60;class Ma extends fa{get(e){return new Sa(this,e)}}Fi("PlacedSymbolArray",Ma);class Aa extends Kn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Aa.prototype.size=76;class Ca extends ma{get(e){return new Aa(this,e)}}Fi("SymbolInstanceArray",Ca);class La extends ga{getoffsetX(e){return this.float32[+e+0]}}Fi("GlyphOffsetArray",La);class Pa extends _a{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Fi("SymbolLineVertexArray",Pa);class Ia extends Kn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ia.prototype.size=12;class Ra extends va{get(e){return new Ia(this,e)}}Fi("FeatureIndexArray",Ra);class Da extends Kn{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Da.prototype.size=4;class Oa extends ya{get(e){return new Da(this,e)}}Fi("FillExtrusionCentroidArray",Oa);const ka=Qn([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ba=Qn([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Fa=st(function(e){e.exports=function(e,t){for(var r,i,n,a=e.length-(r=3&e.length),s=t,o=3432918353,l=461845907,c=0;c<a;)n=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,s=27492+(65535&(i=5*(65535&(s=(s^=n=(65535&(n=(n=(65535&n)*o+(((n>>>16)*o&65535)<<16)&4294967295)<<15|n>>>17))*l+(((n>>>16)*l&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(i>>>16)&65535)<<16);switch(n=0,r){case 3:n^=(255&e.charCodeAt(c+2))<<16;case 2:n^=(255&e.charCodeAt(c+1))<<8;case 1:s^=n=(65535&(n=(n=(65535&(n^=255&e.charCodeAt(c)))*o+(((n>>>16)*o&65535)<<16)&4294967295)<<15|n>>>17))*l+(((n>>>16)*l&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,((s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295)^s>>>16)>>>0}}),za=st(function(e){e.exports=function(e,t){for(var r,i=e.length,n=t^i,a=0;4<=i;)r=1540483477*(65535&(r=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16),i-=4,++a;switch(i){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16)}return((n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16))^n>>>15)>>>0}}),Na=Fa,Ua=za;Na.murmur3=Fa,Na.murmur2=Ua;class Ga{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,i){this.ids.push(Va(e)),this.positions.push(t,r,i)}getPositions(e){var t=Va(e);let r=0,i=this.ids.length-1;for(;r<i;){const e=r+i>>1;this.ids[e]>=t?i=e:r=1+e}const n=[];for(;this.ids[r]===t;)n.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return n}static serialize(e,t){var r=new Float64Array(e.ids),e=new Uint32Array(e.positions);return function r(i,n,a,s){for(;a<s;){const o=i[a+s>>1];let e=a-1,t=s+1;for(;;){for(;e++,i[e]<o;);for(;t--,i[t]>o;);if(e>=t)break;$a(i,e,t),$a(n,3*e,3*t),$a(n,3*e+1,3*t+1),$a(n,3*e+2,3*t+2)}t-a<s-t?(r(i,n,a,t),a=t+1):(r(i,n,t+1,s),s=t)}}(r,e,0,r.length-1),t&&t.push(r.buffer,e.buffer),{ids:r,positions:e}}static deserialize(e){const t=new Ga;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Va(e){var t=+e;return!isNaN(t)&&t<=r?t:Na(String(e))}function $a(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}Fi("FeaturePositionMap",Ga);class ja{constructor(e,t){this.gl=e.gl,this.location=t}}class Ha extends ja{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Wa extends ja{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Za extends ja{constructor(e,t){super(e,t),this.current=lt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const qa=new Float32Array(16),Xa=new Float32Array(9),Ya=new Float32Array(4);function Ka(e){return[Xn(255*e.r,255*e.g),Xn(255*e.b,255*e.a)]}class Ja{constructor(e,t,r){this.value=e,this.uniformNames=t.map(e=>`u_${e}`),this.type=r}setUniform(e,t,r){e.set(r.constantOr(this.value))}getBinding(e,t,r){return new("color"===this.type?Za:Ha)(e,t)}}class Qa{constructor(e,t){this.uniformNames=t.map(e=>`u_${e}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,r,i){i="u_pattern_to"===i||"u_dash_to"===i?this.patternTo:"u_pattern_from"===i||"u_dash_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;i&&e.set(i)}getBinding(e,t,r){return new("u_pattern_from"===r||"u_pattern_to"===r||"u_dash_from"===r||"u_dash_to"===r?Wa:Ha)(e,t)}}class es{constructor(e,t,r,i){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,r,i,n,a){var s=this.paintVertexArray.length,a=this.expression.evaluate(new On(0),t,{},n,i,a);this.paintVertexArray.resize(e),this._setPaintValue(s,e,a)}updatePaintArray(e,t,r,i,n){n=this.expression.evaluate({zoom:0},r,i,void 0,n);this._setPaintValue(e,t,n)}_setPaintValue(t,r,i){if("color"===this.type){var n=Ka(i);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,n[0],n[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ts{constructor(e,t,r,i,n,a){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=r,this.useIntegerZoom=i,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,t,r,i,n,a){var s=this.expression.evaluate(new On(this.zoom),t,{},n,i,a),i=this.expression.evaluate(new On(this.zoom+1),t,{},n,i,a),a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(a,e,s,i)}updatePaintArray(e,t,r,i,n){var a=this.expression.evaluate({zoom:this.zoom},r,i,void 0,n),n=this.expression.evaluate({zoom:this.zoom+1},r,i,void 0,n);this._setPaintValue(e,t,a,n)}_setPaintValue(t,r,i,n){if("color"===this.type){var a=Ka(i),s=Ka(n);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,a[0],a[1],s[0],s[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){t=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,t=S(this.expression.interpolationFactor(t,this.zoom,this.zoom+1),0,1);e.set(t)}getBinding(e,t,r){return new Ha(e,t)}}class rs{constructor(e,t,r,i,n,a,s){this.expression=e,this.type=r,this.useIntegerZoom=i,this.zoom=n,this.layerId=s,this.paintVertexAttributes=("array"===r?Ba:ka).members;for(let e=0;e<t.length;++e);this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a}populatePaintArray(e,t,r){var i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,i,n,a){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],a)}_setPaintValues(t,r,e,i){if(i&&e){var{min:n,mid:a,max:e}=e,s=i[n],o=i[a],l=i[e];if(s&&o&&l)for(let e=t;e<r;e++)this._setPaintValue(this.zoomInPaintVertexArray,e,o,s),this._setPaintValue(this.zoomOutPaintVertexArray,e,o,l)}}_setPaintValue(e,t,r,i){e.emplace(t,r.tl[0],r.tl[1],r.br[0],r.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],r.pixelRatio,i.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class is{constructor(e,t,r=()=>!0){this.binders={},this._buffers=[];const i=[];for(const h in e.paint._values)if(r(h)){var n=e.paint.get(h);if(n instanceof Gn&&Lr(n.property.specification)){var a=(l=h,c=e.type,as[l]||[l.replace(`${c}-`,"").replace(/-/g,"_")]),s=n.value,o=n.property.specification.type,l=n.property.useIntegerZoom,c=n.property.specification["property-type"],n="cross-faded"===c||"cross-faded-data-driven"===c,c="line-dasharray"===String(h)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||c)if("source"===s.kind||c||n){const r=ls(h,o,"source");this.binders[h]=n?new rs(s,a,o,l,t,r,e.id):new es(s,a,o,r),i.push(`/a_${h}`)}else{const e=ls(h,o,"composite");this.binders[h]=new ts(s,a,o,l,t,e),i.push(`/z_${h}`)}else this.binders[h]=n?new Qa(s.value,a):new Ja(s.value,a,o),i.push(`/u_${h}`)}}var l,c;this.cacheKey=i.sort().join("")}getMaxValue(e){e=this.binders[e];return e instanceof es||e instanceof ts?e.maxValue:0}populatePaintArrays(e,t,r,i,n,a){for(const s in this.binders){const o=this.binders[s];(o instanceof es||o instanceof ts||o instanceof rs)&&o.populatePaintArray(e,t,r,i,n,a)}}setConstantPatternPositions(e,t){for(const r in this.binders){const i=this.binders[r];i instanceof Qa&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,r,i,n,a){let s=!1;for(const h in e){var o=t.getPositions(h);for(const t of o){var l,c=r.feature(t.index);for(const r in this.binders){const u=this.binders[r];(u instanceof es||u instanceof ts||u instanceof rs)&&!0===u.expression.isStateDependent&&(l=i.paint.get(r),u.expression=l.value,u.updatePaintArray(t.start,t.end,c,e[h],n,a),s=!0)}}}return s}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Ja||r instanceof Qa)&&e.push(...r.uniformNames.map(e=>`#define HAS_UNIFORM_${e}`))}return e}getBinderAttributes(){const t=[];for(const e in this.binders){var r=this.binders[e];if(r instanceof es||r instanceof ts||r instanceof rs)for(let e=0;e<r.paintVertexAttributes.length;e++)t.push(r.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const e=[];for(const r in this.binders){var t=this.binders[r];if(t instanceof Ja||t instanceof Qa||t instanceof ts)for(const i of t.uniformNames)e.push(i)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const r=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Ja||a instanceof Qa||a instanceof ts)for(const s of a.uniformNames){var i;t[s]&&(i=a.getBinding(e,t[s],s),r.push({name:s,property:n,binding:i}))}}return r}setUniforms(e,t,r,i){for(const{name:e,property:n,binding:a}of t)this.binders[n].setUniform(a,i,r.get(n),e)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){var t,r=this.binders[i];e&&r instanceof rs?(t=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer)&&this._buffers.push(t):(r instanceof es||r instanceof ts)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof es||r instanceof ts||r instanceof rs)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof es||t instanceof ts||t instanceof rs)&&t.destroy()}}}class ns{constructor(e,t,r=()=>!0){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new is(i,t,r);this.needsUpload=!1,this._featureMap=new Ga,this._bufferOffset=0}populatePaintArrays(e,t,r,i,n,a,s){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,i,n,a,s);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,i,n){for(const a of r)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,t,a,i,n)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const as={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};const ss={"line-pattern":{source:aa,composite:aa},"fill-pattern":{source:aa,composite:aa},"fill-extrusion-pattern":{source:aa,composite:aa},"line-dasharray":{source:sa,composite:sa}},os={color:{source:ba,composite:wa},number:{source:ga,composite:ba}};function ls(e,t,r){e=ss[e];return e&&e[r]||os[t][r]}Fi("ConstantBinder",Ja),Fi("CrossFadedConstantBinder",Qa),Fi("SourceExpressionBinder",es),Fi("CrossFadedCompositeBinder",rs),Fi("CompositeExpressionBinder",ts),Fi("ProgramConfiguration",is,{omit:["_buffers"]}),Fi("ProgramConfigurationSet",ns);const cs="-transition";class hs extends ke{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Un(t.layout)),t.paint)){this._transitionablePaint=new Fn(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vn(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){null!=t&&this._validate(Pi,`layers.${this.id}.layout.${e}`,e,t,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return w(e,cs)?this._transitionablePaint.getTransition(e.slice(0,-cs.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t&&this._validate(Li,`layers.${this.id}.paint.${e}`,e,t,r))return!1;if(w(e,cs))return this._transitionablePaint.setTransition(e.slice(0,-cs.length),t||void 0),!1;{const r=this._transitionablePaint._values[e],i="cross-faded-data-driven"===r.property.specification["property-type"],n=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||n||i||this._handleOverridablePaintPropertyUpdate(e,a,s)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),M(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(e,t,r,i,n={}){return(!n||!1!==n.validate)&&Ii(this,e.call(Mi,{key:t,layerType:this.type,objectKey:r,value:i,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){var e=this.paint.get(t);if(e instanceof Gn&&Lr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ei(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const us=Qn([{name:"a_pos",components:2,type:"Int16"}],4),ds=us["members"];class ps{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,i){let n=this.segments[this.segments.length-1];return e>ps.MAX_VERTEX_ARRAY_LENGTH&&V(`Max vertices per segment is ${ps.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!n||n.vertexLength+e>ps.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==i)&&(n={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==i&&(n.sortKey=i),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,i){return new ps([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])}}ps.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fi("SegmentVector",ps);var fs=8192;class ms{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof _s?new _s(e.lng,e.lat):_s.convert(e),this}setSouthWest(e){return this._sw=e instanceof _s?new _s(e.lng,e.lat):_s.convert(e),this}extend(e){const t=this._sw,r=this._ne;let i,n;if(e instanceof _s)i=e,n=e;else{if(!(e instanceof ms))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(ms.convert(e)):this.extend(_s.convert(e)):this;if(i=e._sw,n=e._ne,!i||!n)return this}return t||r?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new _s(i.lng,i.lat),this._ne=new _s(n.lng,n.lat)),this}getCenter(){return new _s((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _s(this.getWest(),this.getNorth())}getSouthEast(){return new _s(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){var{lng:t,lat:e}=_s.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=e&&e<=this._ne.lat&&r}static convert(e){return!e||e instanceof ms?e:new ms(e)}}const gs=6371008.8;class _s{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _s(d(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){var t=Math.PI/180,r=this.lat*t,i=e.lat*t,t=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return gs*Math.acos(Math.min(t,1))}toBounds(e=0){var t=360*e/40075017,e=t/Math.cos(Math.PI/180*this.lat);return new ms(new _s(this.lng-e,this.lat-t),new _s(this.lng+e,this.lat+t))}static convert(e){if(e instanceof _s)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new _s(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new _s(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vs=2*Math.PI*gs;function ys(e){return vs*Math.cos(e*Math.PI/180)}function xs(e){return(180+e)/360}function bs(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ws(e,t){return e/ys(t)}function Ts(e){return 360*e-180}function Es(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Ss(e,t){return e*ys(Es(t))}const Ms=85.051129;class As{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){e=_s.convert(e);return new As(xs(e.lng),bs(e.lat),ws(t,e.lat))}toLngLat(){return new _s(Ts(this.x),Es(this.y))}toAltitude(){return Ss(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vs*(e=Es(this.y),1/Math.cos(e*Math.PI/180));var e}}function Cs(e,t,r){const i=[];let n,a,s;for(const o of e){const{x:e,y:l}=o;t(o),s?function e(t,r,i,n,a,s,o,l,c){var h,u,d,p,f,m,g=(r+n)/2,_=(i+a)/2,v=new B(g,_);l(v),h=v.x,u=v.y,d=s.x,p=s.y,f=d-o.x,m=p-o.y,Math.abs((p-u)*f-(d-h)*m)/Math.hypot(f,m)>=c?(e(t,r,i,g,_,s,v,l,c),e(t,g,_,n,a,v,o,l,c)):t.push(o)}(i,n,a,e,l,s,o,t,r):i.push(o),n=e,a=l,s=o}return i}const Ls=Math.pow(2,14)-1,Ps=-Ls-1;function Is(t,i,r){const n=t.loadGeometry(),a=t.extent,s=fs/a;if(i&&r&&"mercator"!==r.projection.name){const s=1<<i.z,{scale:c,x:h,y:u,projection:d}=r,p=e=>{var t=Ts((i.x+e.x/a)/s),r=Es((i.y+e.y/a)/s),r=d.project(t,r);e.x=(r.x*c-h)*a,e.y=(r.y*c-u)*a};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=Cs(n[e],p,1);else{const t=[];for(const r of n[e])r.x<0||r.x>=a||r.y<0||r.y>=a||(p(r),t.push(r));n[e]=t}}for(const t of n)for(const i of t)e=i,o=s,l=void 0,l=Math.round(e.x*o),o=Math.round(e.y*o),e.x=S(l,Ps,Ls),e.y=S(o,Ps,Ls),(l<e.x||l>e.x+1||o<e.y||o>e.y+1)&&V("Geometry exceeds allowed extent, reduce your vector tile buffer size");var e,o,l;return n}function Rs(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Is(e):[]}}function Ds(e,t,r,i,n){e.emplaceBack(2*t+(i+1)/2,2*r+(n+1)/2)}class Os{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ta,this.indexArray=new pa,this.segments=new ps,this.programConfigurations=new ns(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r,i){const n=this.layers[0],a=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:t,id:n,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,h=Rs(t,e);var o;this.layers[0]._featureFilter.filter(new On(this.zoom),h,r)&&(o=s?s.evaluate(h,{},r):void 0,o={id:n,properties:t.properties,type:t.type,sourceLayerIndex:c,index:l,geometry:e?h.geometry:Is(t,r,i),patterns:{},sortKey:o},a.push(o))}s&&a.sort((e,t)=>e.sortKey-t.sortKey);for(const i of a){const{geometry:n,index:a,sourceLayerIndex:s}=i,u=e[a].feature;this.addFeature(i,n,a,t.availableImages,r),t.featureIndex.insert(u,n,a,s,this.index)}}update(e,t,r,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ds),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,i,n){for(const r of t)for(const t of r){const r=t.x,i=t.y;if(!(r<0||r>=fs||i<0||i>=fs)){const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=n.vertexLength;Ds(this.layoutVertexArray,r,i,-1,-1),Ds(this.layoutVertexArray,r,i,1,-1),Ds(this.layoutVertexArray,r,i,1,1),Ds(this.layoutVertexArray,r,i,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+3,a+2),n.vertexLength+=4,n.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},i,n)}}function ks(t,r){for(let e=0;e<t.length;e++)if(Gs(r,t[e]))return!0;for(let e=0;e<r.length;e++)if(Gs(t,r[e]))return!0;return!!Fs(t,r)}function Bs(t,r){if(1===t.length)return Us(r,t[0]);for(let e=0;e<r.length;e++){var i=r[e];for(let e=0;e<i.length;e++)if(Gs(t,i[e]))return!0}for(let e=0;e<t.length;e++)if(Us(r,t[e]))return!0;for(let e=0;e<r.length;e++)if(Fs(t,r[e]))return!0;return!1}function Fs(t,r){var i,n,a,s;if(0!==t.length&&0!==r.length)for(let e=0;e<t.length-1;e++){var o=t[e],l=t[e+1];for(let e=0;e<r.length-1;e++)if(i=o,n=l,a=r[e],s=r[e+1],P(i,a,s)!==P(n,a,s)&&P(i,n,a)!==P(i,n,s))return 1}}function zs(t,r,e){var i=e*e;if(1===r.length)return t.distSqr(r[0])<i;for(let e=1;e<r.length;e++)if(Ns(t,r[e-1],r[e])<i)return 1}function Ns(e,t,r){var i=t.distSqr(r);if(0===i)return e.distSqr(t);i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/i;return e.distSqr(i<0?t:1<i?r:r.sub(t)._mult(i)._add(t))}function Us(i,n){let a,s,o,l=!1;for(let r=0;r<i.length;r++)for(let e=0,t=(a=i[r]).length-1;e<a.length;t=e++)s=a[e],o=a[t],s.y>n.y!=o.y>n.y&&n.x<(o.x-s.x)*(n.y-s.y)/(o.y-s.y)+s.x&&(l=!l);return l}function Gs(r,i){let n=!1;for(let e=0,t=r.length-1;e<r.length;t=e++){var a=r[e],s=r[t];a.y>i.y!=s.y>i.y&&i.x<(s.x-a.x)*(i.y-a.y)/(s.y-a.y)+a.x&&(n=!n)}return n}function Vs(t,e,r,i,n){for(const B of t)if(e<=B.x&&r<=B.y&&i>=B.x&&n>=B.y)return!0;var a=[new B(e,r),new B(e,n),new B(i,n),new B(i,r)];if(2<t.length)for(const e of a)if(Gs(t,e))return!0;for(let e=0;e<t.length-1;e++)if(function(e,t,r){var i=r[0],n=r[2];if(e.x<i.x&&t.x<i.x||e.x>n.x&&t.x>n.x||e.y<i.y&&t.y<i.y||e.y>n.y&&t.y>n.y)return!1;n=P(e,t,r[0]);return n!==P(e,t,r[1])||n!==P(e,t,r[2])||n!==P(e,t,r[3])}(t[e],t[e+1],a))return!0;return!1}function $s(e,t,r){var i=t.paint.get(e).value;return"constant"===i.kind?i.value:r.programConfigurations.get(t.id).getMaxValue(e)}function js(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Hs(t,e,r,i,n){if(!e[0]&&!e[1])return t;const a=B.convert(e)._mult(n);"viewport"===r&&a._rotate(-i);const s=[];for(let e=0;e<t.length;e++)s.push(t[e].sub(a));return s}function Ws(e,t,r,i){const n=B.convert(e)._mult(i);return"viewport"===t&&n._rotate(-r),n}Fi("CircleBucket",Os,{omit:["layers"]});var Zs=new qn({"circle-sort-key":new jn(Be.layout_circle["circle-sort-key"])}),qs={paint:new qn({"circle-radius":new jn(Be.paint_circle["circle-radius"]),"circle-color":new jn(Be.paint_circle["circle-color"]),"circle-blur":new jn(Be.paint_circle["circle-blur"]),"circle-opacity":new jn(Be.paint_circle["circle-opacity"]),"circle-translate":new $n(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new $n(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $n(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $n(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jn(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jn(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jn(Be.paint_circle["circle-stroke-opacity"])}),layout:Zs},Xs="undefined"!=typeof Float32Array?Float32Array:Array;function Ys(){var e=new Xs(9);return Xs!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Ks(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Js(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=r[0],x=r[1],b=r[2],t=r[3];return e[0]=y*i+x*o+b*u+t*m,e[1]=y*n+x*l+b*d+t*g,e[2]=y*a+x*c+b*p+t*_,e[3]=y*s+x*h+b*f+t*v,e[4]=(y=r[4])*i+(x=r[5])*o+(b=r[6])*u+(t=r[7])*m,e[5]=y*n+x*l+b*d+t*g,e[6]=y*a+x*c+b*p+t*_,e[7]=y*s+x*h+b*f+t*v,e[8]=(y=r[8])*i+(x=r[9])*o+(b=r[10])*u+(t=r[11])*m,e[9]=y*n+x*l+b*d+t*g,e[10]=y*a+x*c+b*p+t*_,e[11]=y*s+x*h+b*f+t*v,e[12]=(y=r[12])*i+(x=r[13])*o+(b=r[14])*u+(t=r[15])*m,e[13]=y*n+x*l+b*d+t*g,e[14]=y*a+x*c+b*p+t*_,e[15]=y*s+x*h+b*f+t*v,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});_r=Js;function Qs(){var e=new Xs(3);return Xs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function eo(e){return Math.hypot(e[0],e[1],e[2])}function to(e,t,r){var i=new Xs(3);return i[0]=e,i[1]=t,i[2]=r,i}function ro(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function io(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function no(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function ao(e,t){var r=t[0],i=t[1],n=t[2],n=r*r+i*i+n*n;return 0<n&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function so(e,t,r){var i=r[0],n=r[1],a=r[2],s=t[0],o=t[1],l=t[2],c=n*l-a*o,h=a*s-i*l,u=i*o-n*s,t=n*u-a*h,a=a*c-i*u,n=i*h-n*c,r=2*r[3];return h*=r,u*=r,a*=2,n*=2,e[0]=s+(c*=r)+(t*=2),e[1]=o+h+a,e[2]=l+u+n,e}vr=ro,xr=io,yr=eo;function oo(e,t,r){var i=t[0],n=t[1],a=t[2],t=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*t,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*t,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*t,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*t,e}function lo(){var e=new Xs(4);return Xs!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function co(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ho(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],t=Math.sin(r),r=Math.cos(r);return e[0]=i*r+s*t,e[1]=n*r+a*t,e[2]=a*r-n*t,e[3]=s*r-i*t,e}function uo(e,t){return e[0]===t[0]&&e[1]===t[1]}function po(e,t,r,i,n,a,s,o,l){if(a&&e.queryGeometry.isAboveHorizon)return!1;a&&(l*=e.pixelToTileUnitsFactor);for(const d of t)for(const t of d){const p=t.add(o),f=n&&r.elevation?r.elevation.exaggeration()*n.getElevationAt(p.x,p.y,!0):0,m=a?p:function(e,t,r){r=oo([],[e.x,e.y,t,1],r);return new B(r[0]/r[3],r[1]/r[3])}(p,f,i),g=a?e.tilespaceRays.map(e=>function(e,t){var r=Qs();return fo[2]=t,e.intersectsPlane(fo,mo,r),new B(r[0],r[1])}(e,f)):e.queryGeometry.screenGeometry,_=oo([],[t.x,t.y,f,1],i);if(!s&&a?l*=_[3]/r.cameraToCenterDistance:s&&!a&&(l*=r.cameraToCenterDistance/_[3]),u=l,Gs(c=g,h=m)||zs(h,c,u))return!0}var c,h,u;return!1}Qs(),wr=new Xs(4),Xs!=Float32Array&&(wr[0]=0,wr[1]=0,wr[2]=0,wr[3]=0),Qs(),to(1,0,0),to(0,1,0),lo(),lo(),Ys(),br=new Xs(2),Xs!=Float32Array&&(br[0]=0,br[1]=0);const fo=to(0,0,0),mo=to(0,0,1);class go extends Os{}function _o(e,{width:t,height:r},i,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*r*i)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*r*i);return e.width=t,e.height=r,e.data=n,e}function vo(e,{width:t,height:r},i){var n;t===e.width&&r===e.height||(yo(e,n=_o({},{width:t,height:r},i),{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,r)},i),e.width=t,e.height=r,e.data=n.data)}function yo(t,r,i,n,a,s){if(0===a.width||0===a.height)return r;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>r.width||a.height>r.height||n.x>r.width-a.width||n.y>r.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,l=r.data;for(let e=0;e<a.height;e++){var c=((i.y+e)*t.width+i.x)*s,h=((n.y+e)*r.width+n.x)*s;for(let e=0;e<a.width*s;e++)l[h+e]=o[c+e]}return r}Fi("HeatmapBucket",go,{omit:["layers"]});class xo{constructor(e,t){_o(this,e,1,t)}resize(e){vo(this,e,1)}clone(){return new xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,n){yo(e,t,r,i,n,1)}}class bo{constructor(e,t){_o(this,e,4,t)}resize(e){vo(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,i,n){yo(e,t,r,i,n,4)}}Fi("AlphaImage",xo),Fi("RGBAImage",bo);var wo={paint:new qn({"heatmap-radius":new jn(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jn(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $n(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zn(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $n(Be.paint_heatmap["heatmap-opacity"])})};function To(n){const i={},a=n.resolution||256,e=n.clips?n.clips.length:1,s=n.image||new bo({width:a,height:e}),o=(e,t,r)=>{i[n.evaluationKey]=r;r=n.expression.evaluate(i);s.data[e+t+0]=Math.floor(255*r.r/r.a),s.data[e+t+1]=Math.floor(255*r.g/r.a),s.data[e+t+2]=Math.floor(255*r.b/r.a),s.data[e+t+3]=Math.floor(255*r.a)};if(n.clips)for(let r=0,i=0;r<e;++r,i+=4*a)for(let e=0,t=0;e<a;e++,t+=4){var l=e/(a-1),{start:c,end:h}=n.clips[r];o(i,t,c*(1-l)+h*l)}else for(let e=0,t=0;e<a;e++,t+=4)o(0,t,e/(a-1));return s}var Eo={paint:new qn({"hillshade-illumination-direction":new $n(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $n(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $n(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $n(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $n(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $n(Be.paint_hillshade["hillshade-accent-color"])})};const So=Qn([{name:"a_pos",components:2,type:"Int16"}],4),Mo=So["members"];var Ao=Co,za=Co;function Co(e,t,r){r=r||2;var i,n,a,s,o,l=t&&t.length,c=l?t[0]*r:e.length,h=Lo(e,0,c,r,!0),u=[];if(!h||h.next===h.prev)return u;if(l&&(h=function(e,t,r,i){for(var n,a=[],s=0,o=t.length;s<o;s++)(n=Lo(e,t[s]*i,s<o-1?t[s+1]*i:e.length,i,!1))===n.next&&(n.steiner=!0),a.push(function(e){var t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next,t!==e;);return r}(n));for(a.sort(Ro),s=0;s<a.length;s++)r=Po(r=function(e,t){var r=function(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&s<o){if((s=o)===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}}while((i=i.next)!==t);if(!r)return null;if(n===s)return r;for(var l,c,h,u=r,d=r.x,p=r.y,f=1/0,i=r;n>=i.x&&i.x>=d&&n!==i.x&&Oo(a<p?n:s,a,d,p,a<p?s:n,a,i.x,i.y)&&(l=Math.abs(a-i.y)/(n-i.x),Uo(i,e)&&(l<f||l===f&&(i.x>r.x||i.x===r.x&&(h=i,ko((c=r).prev,c,h.prev)<0&&ko(h.next,c,c.next)<0)))&&(r=i,f=l)),(i=i.next)!==u;);return r}(e,t);if(!r)return t;var i=Go(r,e),e=Po(r,r.next);return Po(i,i.next),t===r?e:t}(a[s],r),r.next);return r}(e,t,h,r)),e.length>80*r){for(var d=i=e[0],p=n=e[1],f=r;f<c;f+=r)(a=e[f])<d&&(d=a),(s=e[f+1])<p&&(p=s),i<a&&(i=a),n<s&&(n=s);o=0!==(o=Math.max(i-d,n-p))?1/o:0}return Io(h,u,r,d,p,o),u}function Lo(e,t,r,i,n){var a,s;if(n===0<Ho(e,t,r,i))for(a=t;a<r;a+=i)s=Vo(a,e[a],e[a+1],s);else for(a=r-i;t<=a;a-=i)s=Vo(a,e[a],e[a+1],s);return s&&Bo(s,s.next)&&($o(s),s=s.next),s}function Po(e,t){if(!e)return e;t=t||e;var r,i=e;do{if(r=!1,i.steiner||!Bo(i,i.next)&&0!==ko(i.prev,i,i.next))i=i.next;else{if($o(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function Io(e,t,r,i,n,a,s){if(e){!s&&a&&function(e,t,r,i){for(var n=e;null===n.z&&(n.z=Do(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,(n=n.next)!==e;);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,a,s,o,l,c=1;do{for(r=e,a=e=null,s=0;r;){for(s++,i=r,t=o=0;t<c&&(o++,i=i.nextZ);t++);for(l=c;0<o||0<l&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(r=(n=r).nextZ,o--):(i=(n=i).nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}}while(a.nextZ=null,c*=2,1<s)}(n)}(e,i,n,a);for(var o,l,c=e;e.prev!==e.next;)if(o=e.prev,l=e.next,a?function(e,t,r,i){var n=e.prev,a=e,s=e.next;if(0<=ko(n,a,s))return!1;for(var o=(n.x>a.x?n.x>s.x?n:s:a.x>s.x?a:s).x,l=(n.y>a.y?n.y>s.y?n:s:a.y>s.y?a:s).y,c=Do((n.x<a.x?n.x<s.x?n:s:a.x<s.x?a:s).x,(n.y<a.y?n.y<s.y?n:s:a.y<s.y?a:s).y,t,r,i),h=Do(o,l,t,r,i),u=e.prevZ,d=e.nextZ;u&&u.z>=c&&d&&d.z<=h;){if(u!==e.prev&&u!==e.next&&Oo(n.x,n.y,a.x,a.y,s.x,s.y,u.x,u.y)&&0<=ko(u.prev,u,u.next))return!1;if(u=u.prevZ,d!==e.prev&&d!==e.next&&Oo(n.x,n.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=ko(d.prev,d,d.next))return!1;d=d.nextZ}for(;u&&u.z>=c;){if(u!==e.prev&&u!==e.next&&Oo(n.x,n.y,a.x,a.y,s.x,s.y,u.x,u.y)&&0<=ko(u.prev,u,u.next))return!1;u=u.prevZ}for(;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&Oo(n.x,n.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=ko(d.prev,d,d.next))return!1;d=d.nextZ}return!0}(e,i,n,a):function(e){var t=e.prev,r=e,i=e.next;if(0<=ko(t,r,i))return!1;for(var n=e.next.next;n!==e.prev;){if(Oo(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&0<=ko(n.prev,n,n.next))return!1;n=n.next}return!0}(e))t.push(o.i/r),t.push(e.i/r),t.push(l.i/r),$o(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Io(e=function(e,t,r){var i=e;do{var n=i.prev,a=i.next.next}while(!Bo(n,a)&&Fo(n,i,i.next,a)&&Uo(n,a)&&Uo(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),$o(i),$o(i.next),i=e=a),i=i.next,i!==e);return Po(i)}(Po(e),t,r),t,r,i,n,a,2):2===s&&function(e,t,r,i,n,a){var s=e;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Fo(r,r.next,e,t))return 1}while((r=r.next)!==e)}(e,t)&&(Uo(e,t)&&Uo(t,e)&&function(e,t){for(var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),(r=r.next)!==e;);return i}(e,t)&&(ko(e.prev,e,t.prev)||ko(e,t.prev,t))||Bo(e,t)&&0<ko(e.prev,e,e.next)&&0<ko(t.prev,t,t.next))}(s,o)){var l=Go(s,o);return s=Po(s,s.next),l=Po(l,l.next),Io(s,t,r,i,n,a),Io(l,t,r,i,n,a)}o=o.next}}while(s=s.next,s!==e)}(e,t,r,i,n,a):Io(Po(e),t,r,i,n,a,1);break}}}function Ro(e,t){return e.x-t.x}function Do(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Oo(e,t,r,i,n,a,s,o){return 0<=(n-s)*(t-o)-(e-s)*(a-o)&&0<=(e-s)*(i-o)-(r-s)*(t-o)&&0<=(r-s)*(a-o)-(n-s)*(i-o)}function ko(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Bo(e,t){return e.x===t.x&&e.y===t.y}function Fo(e,t,r,i){var n=No(ko(e,t,r)),a=No(ko(e,t,i)),s=No(ko(r,i,e)),o=No(ko(r,i,t));return n!==a&&s!==o||0===n&&zo(e,r,t)||0===a&&zo(e,i,t)||0===s&&zo(r,e,i)||0===o&&zo(r,t,i)}function zo(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function No(e){return 0<e?1:e<0?-1:0}function Uo(e,t){return ko(e.prev,e,e.next)<0?0<=ko(e,t,e.next)&&0<=ko(e,e.prev,t):ko(e,t,e.prev)<0||ko(e,e.next,t)<0}function Go(e,t){var r=new jo(e.i,e.x,e.y),i=new jo(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(a.next=i).prev=a,i}function Vo(e,t,r,i){r=new jo(e,t,r);return i?(r.next=i.next,(r.prev=i).next.prev=r,i.next=r):(r.prev=r).next=r,r}function $o(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jo(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ho(e,t,r,i){for(var n=0,a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}function Wo(e,t,r,i,n){!function e(t,r,i,n,a){for(;i<n;){var s,o,l,c;600<n-i&&(s=n-i+1,o=r-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),c=.5*Math.sqrt(c*l*(s-l)/s)*(o-s/2<0?-1:1),e(t,r,Math.max(i,Math.floor(r-o*l/s+c)),Math.min(n,Math.floor(r+(s-o)*l/s+c)),a));var h=t[r],u=i,d=n;for(Zo(t,i,r),0<a(t[n],h)&&Zo(t,i,n);u<d;){for(Zo(t,u,d),u++,d--;a(t[u],h)<0;)u++;for(;0<a(t[d],h);)d--}0===a(t[i],h)?Zo(t,i,d):Zo(t,++d,n),d<=r&&(i=d+1),r<=d&&(n=d-1)}}(e,t,r||0,i||e.length-1,n||qo)}function Zo(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function qo(e,t){return e<t?-1:t<e?1:0}function Xo(t,r){const i=t.length;if(i<=1)return[t];const n=[];let a,s;for(let e=0;e<i;e++){const i=function(a){let s=0;for(let e,t,r=0,i=a.length,n=i-1;r<i;n=r++)e=a[r],t=a[n],s+=(t.x-e.x)*(e.y+t.y);return s}(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===s&&(s=i<0),s===i<0?(a&&n.push(a),a=[t[e]]):a.push(t[e]))}if(a&&n.push(a),1<r)for(let e=0;e<n.length;e++)n[e].length<=r||(Wo(n[e],r,1,n[e].length-1,Yo),n[e]=n[e].slice(0,r));return n}function Yo(e,t){return t.area-e.area}function Ko(e,t,r){const i=r.patternDependencies;let n=!1;for(const r of t){const t=r.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);var a=t.constantOr(null);a&&(n=!0,i[a.to]=!0,i[a.from]=!0)}return n}function Jo(e,i,n,a,s){const o=s.patternDependencies;for(const l of i){const i=l.paint.get(`${e}-pattern`).value;if("constant"!==i.kind){let e=i.evaluate({zoom:a-1},n,{},s.availableImages),t=i.evaluate({zoom:a},n,{},s.availableImages),r=i.evaluate({zoom:a+1},n,{},s.availableImages);e=e&&e.name?e.name:e,t=t&&t.name?t.name:t,r=r&&r.name?r.name:r,o[e]=!0,o[t]=!0,o[r]=!0,n.patterns[l.id]={min:e,mid:t,max:r}}}return n}Co.deviation=function(e,t,r,i){var n=t&&t.length,a=Math.abs(Ho(e,0,n?t[0]*r:e.length,r));if(n)for(var s=0,o=t.length;s<o;s++)a-=Math.abs(Ho(e,t[s]*r,s<o-1?t[s+1]*r:e.length,r));for(var l=0,s=0;s<i.length;s+=3){var c=i[s]*r,h=i[s+1]*r,u=i[s+2]*r;l+=Math.abs((e[c]-e[u])*(e[1+h]-e[1+c])-(e[c]-e[h])*(e[1+u]-e[1+c]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},Co.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[n][a][s]);0<n&&r.holes.push(i+=e[n-1].length)}return r},Ao.default=za;class Qo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ta,this.indexArray=new pa,this.indexArray2=new ya,this.programConfigurations=new ns(e.layers,e.zoom),this.segments=new ps,this.segments2=new ps,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r,i){this.hasPattern=Ko("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),a=[];for(var{feature:s,id:o,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Rs(s,e);var h;this.layers[0]._featureFilter.filter(new On(this.zoom),u,r)&&(h=n?n.evaluate(u,{},r,t.availableImages):void 0,h={id:o,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Is(s,r,i),patterns:{},sortKey:h},a.push(h))}n&&a.sort((e,t)=>e.sortKey-t.sortKey);for(const i of a){const{geometry:n,index:a,sourceLayerIndex:d}=i;if(this.hasPattern){const e=Jo("fill",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,n,a,r,{},t.availableImages);t.featureIndex.insert(e[a].feature,n,a,d,this.index)}}update(e,t,r,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,i)}addFeatures(e,t,r,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mo),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,i,n,a,s=[]){for(const t of Xo(r,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=i.vertexLength,a=[],s=[];for(const r of t)if(0!==r.length){r!==t[0]&&s.push(a.length/2);const i=this.segments2.prepareSegment(r.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(r[0].x,r[0].y),this.indexArray2.emplaceBack(n+r.length-1,n),a.push(r[0].x),a.push(r[0].y);for(let e=1;e<r.length;e++)this.layoutVertexArray.emplaceBack(r[e].x,r[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),a.push(r[e].x),a.push(r[e].y);i.vertexLength+=r.length,i.primitiveLength+=r.length}var o=Ao(a,s);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(n+o[e],n+o[e+1],n+o[e+2]);i.vertexLength+=e,i.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,a,s,n)}}Fi("FillBucket",Qo,{omit:["layers","patternFeatures"]});var Fa=new qn({"fill-sort-key":new jn(Be.layout_fill["fill-sort-key"])}),el={paint:new qn({"fill-antialias":new $n(Be.paint_fill["fill-antialias"]),"fill-opacity":new jn(Be.paint_fill["fill-opacity"]),"fill-color":new jn(Be.paint_fill["fill-color"]),"fill-outline-color":new jn(Be.paint_fill["fill-outline-color"]),"fill-translate":new $n(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new $n(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hn(Be.paint_fill["fill-pattern"])}),layout:Fa};const tl=Qn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),rl=Qn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),il=tl["members"];var nl=al;function al(e,t,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=n,e.readFields(sl,this,t)}function sl(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[i]=n}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}al.types=["Unknown","Point","LineString","Polygon"],al.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r,i=e.readVarint()+e.pos,n=1,a=0,s=0,o=0,l=[];e.pos<i;)if(a<=0&&(n=7&(r=e.readVarint()),a=r>>3),a--,1===n||2===n)s+=e.readSVarint(),o+=e.readSVarint(),1===n&&(t&&l.push(t),t=[]),t.push(new B(s,o));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}return t&&l.push(t),l},al.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,n=0,a=0,s=0,o=1/0,l=-1/0,c=1/0,h=-1/0;e.pos<r;)if(n<=0&&(i=7&(t=e.readVarint()),n=t>>3),n--,1===i||2===i)(a+=e.readSVarint())<o&&(o=a),l<a&&(l=a),(s+=e.readSVarint())<c&&(c=s),h<s&&(h=s);else if(7!==i)throw new Error("unknown command "+i);return[o,c,l,h]},al.prototype.toGeoJSON=function(e,t,r){var i,n=this.extent*Math.pow(2,r),a=this.extent*e,s=this.extent*t,o=this.loadGeometry(),t=al.types[this.type];function l(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+a)/n-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/n)*Math.PI/180))-90]}}switch(this.type){case 1:for(var c=[],h=0;h<o.length;h++)c[h]=o[h][0];l(o=c);break;case 2:for(h=0;h<o.length;h++)l(o[h]);break;case 3:for(o=function(e){var t=e.length;if(t<=1)return[e];for(var r,i,n=[],a=0;a<t;a++){var s=function(e){for(var t,r,i=0,n=0,a=e.length,s=a-1;n<a;s=n++)i+=((r=e[s]).x-(t=e[n]).x)*(t.y+r.y);return i}(e[a]);0!==s&&((i=void 0===i?s<0:i)===s<0?(r&&n.push(r),r=[e[a]]):r.push(e[a]))}return r&&n.push(r),n}(o),h=0;h<o.length;h++)for(i=0;i<o[h].length;i++)l(o[h][i])}1===o.length?o=o[0]:t="Multi"+t;t={type:"Feature",geometry:{type:t,coordinates:o},properties:this.properties};return"id"in this&&(t.id=this.id),t};var ol=ll;function ll(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(cl,this,t),this.length=this._features.length}function cl(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;)var i=e.readVarint()>>3,t=1==i?e.readString():2==i?e.readFloat():3==i?e.readDouble():4==i?e.readVarint64():5==i?e.readVarint():6==i?e.readSVarint():7==i?e.readBoolean():null;return t}(r))}function hl(e,t,r){3!==e||(r=new ol(r,r.readVarint()+r.pos)).length&&(t[r.name]=r)}ll.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];e=this._pbf.readVarint()+this._pbf.pos;return new nl(this._pbf,e,this.extent,this._keys,this._values)};var ul={VectorTile:function(e,t){this.layers=e.readFields(hl,{},t)},VectorTileFeature:nl,VectorTileLayer:ol};const dl=ul.VectorTileFeature.types,pl=Math.pow(2,13);function fl(e,t,r,i,n,a,s,o){e.emplaceBack((t<<1)+s,(r<<1)+a,(Math.floor(i*pl)<<1)+n,Math.round(o))}class ml{constructor(){this.acc=new B(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new B(e.x,e.y),this.max=new B(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);let r=!!this.borders;const i=this.min,n=this.max;e.x<i.x?(i.x=e.x,r=!0):e.x>n.x&&(n.x=e.x,r=!0),e.y<i.y?(i.y=e.y,r=!0):e.y>n.y&&(n.y=e.y,r=!0),((0===e.x||e.x===fs)&&e.x===t.x)!=((0===e.y||e.y===fs)&&e.y===t.y)&&this.processBorderOverlap(e,t),r&&this.checkBorderIntersection(e,t)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,qt(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>fs!=e.x>fs&&this.addBorderIntersection(1,qt(t.y,e.y,(fs-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,qt(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>fs!=e.y>fs&&this.addBorderIntersection(3,qt(t.x,e.x,(fs-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){var r;e.x===t.x?e.y!==t.y&&(r=0===e.x?0:1,this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)):(r=0===e.y?2:3,this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x))}centroid(){var e=this.polyCount.reduce((e,t)=>e+t.edges,0);return 0!==e?this.acc.div(e)._round():new B(0,0)}span(){return new B(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class gl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ra,this.centroidVertexArray=new Oa,this.indexArray=new pa,this.programConfigurations=new ns(e.layers,e.zoom),this.segments=new ps,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.enableTerrain=e.enableTerrain}populate(e,t,r,i){var n,a,s,o,l,c,h,u;this.features=[],this.hasPattern=Ko("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=(n=r,80150034*(a=Math.exp(Math.PI*(1-n.y/(1<<n.z)*2)))/(a*a+1)/fs/(1<<n.z));for({feature:s,id:o,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,d=Rs(s,e);this.layers[0]._featureFilter.filter(new On(this.zoom),d,r)&&(h={id:o,sourceLayerIndex:c,index:l,geometry:e?d.geometry:Is(s,r,i),properties:s.properties,type:s.type,patterns:{}},u=this.layoutVertexArray.length,this.hasPattern?this.features.push(Jo("fill-extrusion",this.layers,h,this.zoom,t)):this.addFeature(h,h.geometry,l,r,{},t.availableImages),t.featureIndex.insert(s,h.geometry,l,c,this.index,u))}this.sortBorders()}addFeatures(e,t,r,i){for(const e of this.features){var n=e["geometry"];this.addFeature(e,n,e.index,t,r,i)}this.sortBorders()}update(e,t,r,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,il),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rl.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,s,e,o,t){const l=this.enableTerrain?new ml:null;for(const s of Xo(a,500)){let r=0,i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(!(0===s.length||(d=s[0]).every(e=>e.x<=0)||d.every(e=>e.x>=fs)||d.every(e=>e.y<=0)||d.every(e=>e.y>=fs))){for(let e=0;e<s.length;e++){const o=s[e];if(0!==o.length){r+=o.length;let t=0;l&&l.startRing(o[0]);for(let e=0;e<o.length;e++){const a=o[e];if(1<=e){const s=o[e-1];if(h=a,u=s,!(h.x===u.x&&(h.x<0||h.x>fs)||h.y===u.y&&(h.y<0||h.y>fs))){l&&l.append(a,s),i.vertexLength+4>ps.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const n=a.sub(s)._perp(),o=n.x/(Math.abs(n.x)+Math.abs(n.y)),d=0<n.y?1:0,p=s.dist(a);32768<t+p&&(t=0),fl(this.layoutVertexArray,a.x,a.y,o,d,0,0,t),fl(this.layoutVertexArray,a.x,a.y,o,d,0,1,t),t+=p,fl(this.layoutVertexArray,s.x,s.y,o,d,0,0,t),fl(this.layoutVertexArray,s.x,s.y,o,d,0,1,t);h=i.vertexLength;this.indexArray.emplaceBack(h,h+2,h+1),this.indexArray.emplaceBack(h+1,h+2,h+3),i.vertexLength+=4,i.primitiveLength+=2}}}}}if(i.vertexLength+r>ps.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(r,this.layoutVertexArray,this.indexArray)),"Polygon"===dl[n.type]){const o=[],t=[],f=i.vertexLength;for(let e=0;e<s.length;e++){const a=s[e];if(0!==a.length){a!==s[0]&&t.push(o.length/2);for(let e=0;e<a.length;e++){const s=a[e];fl(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),o.push(s.x),o.push(s.y),l&&l.currentPolyCount.top++}}}var c=Ao(o,t);for(let e=0;e<c.length;e+=3)this.indexArray.emplaceBack(f+c[e],f+c[e+2],f+c[e+1]);i.primitiveLength+=c.length/3,i.vertexLength+=r}}}var h,u,d;if(l&&0<l.polyCount.length){if(l.borders){l.vertexArrayOffset=this.centroidVertexArray.length;const n=l.borders,a=this.featuresOnBorder.push(l)-1;for(let e=0;e<4;e++)n[e][0]!==Number.MAX_VALUE&&this.borders[e].push(a)}this.encodeCentroid(l.borders?void 0:l.centroid(),l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,o,t,e)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((e,t)=>this.featuresOnBorder[e].borders[r][0]-this.featuresOnBorder[t].borders[r][0])}encodeCentroid(t,e,r=!0){let i,n;if(t)if(0!==t.y){const r=e.span()._mult(this.tileToMeter);i=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(r.x/10)),n=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(r.y/10))}else i=Math.ceil(7*(t.x+450)),n=0;else i=0,n=+r;let a=r?this.centroidVertexArray.length:e.vertexArrayOffset;for(const t of e.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*t.edges+t.top);for(let e=0;e<2*t.edges;e++)this.centroidVertexArray.emplace(a++,0,n),this.centroidVertexArray.emplace(a++,i,n);for(let e=0;e<t.top;e++)this.centroidVertexArray.emplace(a++,i,n)}}}Fi("FillExtrusionBucket",gl,{omit:["layers","features"]}),Fi("PartMetadata",ml);var _l={paint:new qn({"fill-extrusion-opacity":new $n(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jn(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $n(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $n(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hn(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new jn(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jn(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $n(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function vl(e,t){return e.x*t.x+e.y*t.y}function yl(r,i){if(1===r.length){let e=0;const n=i[e++];let t;for(;!t||n.equals(t);)if(t=i[e++],!t)return 1/0;for(;e<i.length;e++){const a=i[e],s=r[0],o=t.sub(n),l=a.sub(n),c=s.sub(n),h=vl(o,o),u=vl(o,l),d=vl(l,l),p=vl(c,o),f=vl(c,l),m=h*d-u*u,g=(d*p-u*f)/m,_=(h*f-u*p)/m,v=n.z*(1-g-_)+t.z*g+a.z*_;if(isFinite(v))return v}return 1/0}{let e=1/0;for(const t of i)e=Math.min(e,t.z);return e}}function xl(e){const t=new B(e[0],e[1]);return t.z=e[2],t}const bl=Qn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),wl=bl["members"],Tl=Qn([{name:"a_packed",components:3,type:"Float32"}]),El=Tl["members"],Sl=ul.VectorTileFeature.types,Ml=Math.cos(Math.PI/180*37.5);class Al{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new ia,this.layoutVertexArray2=new na,this.indexArray=new pa,this.programConfigurations=new ns(e.layers,e.zoom),this.segments=new ps,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r,i){this.hasPattern=Ko("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),a=[];for(const{feature:t,id:o,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,h=Rs(t,e);var s;this.layers[0]._featureFilter.filter(new On(this.zoom),h,r)&&(s=n?n.evaluate(h,{},r):void 0,s={id:o,properties:t.properties,type:t.type,sourceLayerIndex:c,index:l,geometry:e?h.geometry:Is(t,r,i),patterns:{},sortKey:s},a.push(s))}n&&a.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:o,featureIndex:l}=t,c=this.addConstantDashes(o);for(const i of a){const{geometry:n,index:a,sourceLayerIndex:u}=i;if(c&&this.addFeatureDashes(i,o),this.hasPattern){const e=Jo("line",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,n,a,r,o.positions,t.availableImages);l.insert(e[a].feature,n,a,u,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){var r=n.paint.get("line-dasharray").value,i=n.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==i.kind)t=!0;else{const t=i.value,a=r.value;a&&(e.addDash(a.from,t),e.addDash(a.to,t),a.other&&e.addDash(a.other,t))}}return t}addFeatureDashes(s,o){var l=this.zoom;for(const d of this.layers){const p=d.paint.get("line-dasharray").value,f=d.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==f.kind){let e,t,r,i,n,a;if("constant"===p.kind){const s=p.value;if(!s)continue;e=s.other||s.to,t=s.to,r=s.from}else e=p.evaluate({zoom:l-1},s),t=p.evaluate({zoom:l},s),r=p.evaluate({zoom:l+1},s);"constant"===f.kind?i=n=a=f.value:(i=f.evaluate({zoom:l-1},s),n=f.evaluate({zoom:l},s),a=f.evaluate({zoom:l+1},s)),o.addDash(e,i),o.addDash(t,n),o.addDash(r,a);var c=o.getKey(e,i),h=o.getKey(t,n),u=o.getKey(r,a);s.patterns[d.id]={min:c,mid:h,max:u}}}}update(e,t,r,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,i)}addFeatures(e,t,r,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,El)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wl),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,i,n,a){const s=this.layers[0].layout,o=s.get("line-join").evaluate(e,{}),l=s.get("line-cap").evaluate(e,{}),c=s.get("line-miter-limit"),h=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const r of t)this.addLine(r,e,o,l,c,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,a,i)}addLine(l,c,h,u,d,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<l.length-1;e++)this.totalDistance+=l[e].dist(l[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var f="Polygon"===Sl[c.type];let m=l.length;for(;2<=m&&l[m-1].equals(l[m-2]);)m--;let g=0;for(;g<m-1&&l[g].equals(l[g+1]);)g++;if(!(m<(f?3:2))){"bevel"===h&&(d=1.05);var _=this.overscaling<=16?122880/(512*this.overscaling):0,v=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let i,n,a,s,o;this.e1=this.e2=-1,f&&(i=l[m-2],o=l[g].sub(i)._unit()._perp());for(let r=g;r<m;r++)if(a=r===m-1?f?l[g+1]:void 0:l[r+1],!a||!l[r].equals(a)){o&&(s=o),i&&(n=i),i=l[r],o=a?a.sub(i)._unit()._perp():s,s=s||o;let e=s.add(o);0===e.x&&0===e.y||e._unit();var y=s.x*o.x+s.y*o.y,x=e.x*o.x+e.y*o.y,b=0!=x?1/x:1/0,w=2*Math.sqrt(2-2*x),T=x<Ml&&n&&a,E=0<s.x*o.y-s.y*o.x;if(T&&r>g){const l=i.dist(n);if(l>2*_){const c=i.sub(i.sub(n)._mult(_/l)._round());this.updateDistance(n,c),this.addCurrentVertex(c,s,0,0,v),n=c}}x=n&&a;let t=x?h:f?"butt":u;if(x&&"round"===t&&(b<p?t="miter":b<=2&&(t="fakeround")),"miter"===t&&d<b&&(t="bevel"),"bevel"===t&&(2<b&&(t="flipbevel"),b<d&&(t="miter")),n&&this.updateDistance(n,i),"miter"===t)e._mult(b),this.addCurrentVertex(i,e,0,0,v);else if("flipbevel"===t){if(100<b)e=o.mult(-1);else{const l=b*s.add(o).mag()/s.sub(o).mag();e._perp()._mult(l*(E?-1:1))}this.addCurrentVertex(i,e,0,0,v),this.addCurrentVertex(i,e.mult(-1),0,0,v)}else if("bevel"===t||"fakeround"===t){const l=-Math.sqrt(b*b-1),c=E?l:0,h=E?0:l;if(n&&this.addCurrentVertex(i,s,c,h,v),"fakeround"===t){const l=Math.round(180*w/Math.PI/20);for(let t=1;t<l;t++){let e=t/l;if(.5!==e){const l=e-.5;e+=e*l*(e-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*l*l+(.848013+y*(.215638*y-1.06021)))}const u=o.sub(s)._mult(e)._add(s)._unit()._mult(E?-1:1);this.addHalfVertex(i,u.x,u.y,!1,E,0,v)}}a&&this.addCurrentVertex(i,o,-c,-h,v)}else if("butt"===t)this.addCurrentVertex(i,e,0,0,v);else if("square"===t){const l=n?1:-1;n||this.addCurrentVertex(i,e,l,l,v),this.addCurrentVertex(i,e,0,0,v),n&&this.addCurrentVertex(i,e,l,l,v)}else"round"===t&&(n&&(this.addCurrentVertex(i,s,0,0,v),this.addCurrentVertex(i,s,1,1,v,!0)),a&&(this.addCurrentVertex(i,o,-1,-1,v,!0),this.addCurrentVertex(i,o,0,0,v)));if(T&&r<m-1){const l=i.dist(a);if(l>2*_){const c=i.add(a.sub(i)._mult(_/l)._round());this.updateDistance(i,c),this.addCurrentVertex(c,o,0,0,v),i=c}}}}}addCurrentVertex(e,t,r,i,n,a=!1){var s=t.y*i-t.x,o=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,a,!1,r,n),this.addHalfVertex(e,s,o,a,!0,-i,n)}addHalfVertex({x:e,y:t},r,i,n,a,s,o){this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(a?1:0),Math.round(63*r)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);s=o.vertexLength++;0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,s),o.primitiveLength++),a?this.e2=s:this.e1=s}updateScaledDistance(){var e;this.lineClips?(e=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Fi("LineBucket",Al,{omit:["layers","patternFeatures"]});var Ua=new qn({"line-cap":new jn(Be.layout_line["line-cap"]),"line-join":new jn(Be.layout_line["line-join"]),"line-miter-limit":new $n(Be.layout_line["line-miter-limit"]),"line-round-limit":new $n(Be.layout_line["line-round-limit"]),"line-sort-key":new jn(Be.layout_line["line-sort-key"])}),Cl={paint:new qn({"line-opacity":new jn(Be.paint_line["line-opacity"]),"line-color":new jn(Be.paint_line["line-color"]),"line-translate":new $n(Be.paint_line["line-translate"]),"line-translate-anchor":new $n(Be.paint_line["line-translate-anchor"]),"line-width":new jn(Be.paint_line["line-width"]),"line-gap-width":new jn(Be.paint_line["line-gap-width"]),"line-offset":new jn(Be.paint_line["line-offset"]),"line-blur":new jn(Be.paint_line["line-blur"]),"line-dasharray":new Hn(Be.paint_line["line-dasharray"]),"line-pattern":new Hn(Be.paint_line["line-pattern"]),"line-gradient":new Zn(Be.paint_line["line-gradient"])}),layout:Ua};const Ll=new class extends jn{possiblyEvaluate(e,t){return t=new On(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,i){return t=y({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,i)}}(Cl.paint.properties["line-width"].specification);function Pl(e,t){return 0<t?t+2*e:e}Ll.useIntegerZoom=!0;const Il=Qn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Rl=Qn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Qn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Dl=Qn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ol=Qn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kl=Qn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bl=Qn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qn([{name:"triangle",components:3,type:"Uint16"}]),Qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Qn([{type:"Float32",name:"offsetX"}]),Qn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Fl=24;const zl=128;function Nl(r,i){const n=i["expression"];if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new On(r+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:o}=n;let e=0;for(;e<s.length&&s[e]<=r;)e++;e=Math.max(0,e-1);let t=e;for(;t<s.length&&s[t]<r+1;)t++;t=Math.min(s.length-1,t);var a=s[e],i=s[t];return"composite"===n.kind?{kind:"composite",minZoom:a,maxZoom:i,interpolationType:o}:{kind:"camera",minZoom:a,maxZoom:i,minSize:n.evaluate(new On(a)),maxSize:n.evaluate(new On(i)),interpolationType:o}}}function Ul(e,{uSize:t,uSizeT:r},{lowerSize:i,upperSize:n}){return"source"===e.kind?i/zl:"composite"===e.kind?qt(i/zl,n/zl,r):t}function Gl(e,t){let r=0,i=0;var n,a,s;return"constant"===e.kind?i=e.layoutSize:"source"!==e.kind&&({interpolationType:n,minZoom:a,maxZoom:s}=e,s=n?S(hr.interpolationFactor(n,t,a,s),0,1):0,"camera"===e.kind?i=qt(e.minSize,e.maxSize,s):r=s),{uSizeT:r,uSize:i}}Zs=Object.freeze({__proto__:null,getSizeData:Nl,evaluateSizeForFeature:Ul,evaluateSizeForZoom:Gl,SIZE_PACK_FACTOR:zl});const Vl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function $l(e,t,r,i,n){var a,s,o=8*n-i-1,l=(1<<o)-1,c=l>>1,h=-7,u=r?n-1:0,d=r?-1:1,r=e[t+u];for(u+=d,a=r&(1<<-h)-1,r>>=-h,h+=o;0<h;a=256*a+e[t+u],u+=d,h-=8);for(s=a&(1<<-h)-1,a>>=-h,h+=i;0<h;s=256*s+e[t+u],u+=d,h-=8);if(0===a)a=1-c;else{if(a===l)return s?NaN:1/0*(r?-1:1);s+=Math.pow(2,i),a-=c}return(r?-1:1)*s*Math.pow(2,a-i)}function jl(e,t,r,i,n,a){var s,o,l=8*a-n-1,c=(1<<l)-1,h=c>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,p=i?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(i=Math.pow(2,-s))<1&&(s--,i*=2),2<=(t+=1<=s+h?u/i:u*Math.pow(2,1-h))*i&&(s++,i/=2),c<=s+h?(o=0,s=c):1<=s+h?(o=(t*i-1)*Math.pow(2,n),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));8<=n;e[r+d]=255&o,d+=p,o/=256,n-=8);for(s=s<<n|o,l+=n;0<l;e[r+d]=255&s,d+=p,s/=256,l-=8);e[r+d-p]|=128*a}var Hl=Wl;function Wl(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Wl.Varint=0,Wl.Fixed64=1,Wl.Bytes=2,Wl.Fixed32=5;var Zl=4294967296,ql=1/Zl,Xl="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Yl(e){return e.type===Wl.Bytes?e.readVarint()+e.pos:e.pos+1}function Kl(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Jl(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;e<=n;n--)r.buf[n+i]=r.buf[n]}function Ql(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function ec(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function tc(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function rc(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function ic(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function nc(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function ac(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function sc(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function oc(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function lc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function cc(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function hc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function uc(e,t,r){t.glyphs=[],1===e&&r.readMessage(dc,t)}function dc(e,t,r){if(3===e){const{id:e,bitmap:i,width:n,height:a,left:s,top:o,advance:l}=r.readMessage(pc,{});t.glyphs.push({id:e,bitmap:new xo({width:n+6,height:a+6},i),metrics:{width:n,height:a,left:s,top:o,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function pc(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}function fc(e){let t=0,r=0;for(const i of e)t+=i.w*i.h,r=Math.max(r,i.w);e.sort((e,t)=>t.h-e.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let n=0,a=0;for(const t of e)for(let e=i.length-1;0<=e;e--){const r=i[e];if(!(t.w>r.w||t.h>r.h)){if(t.x=r.x,t.y=r.y,a=Math.max(a,t.y+t.h),n=Math.max(n,t.x+t.w),t.w===r.w&&t.h===r.h){const t=i.pop();e<i.length&&(i[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):(t.w===r.w||i.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:n,h:a,fill:t/(n*a)||0}}Wl.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=7&i,e(n,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=lc(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=hc(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=lc(this.buf,this.pos)+lc(this.buf,this.pos+4)*Zl;return this.pos+=8,e},readSFixed64:function(){var e=lc(this.buf,this.pos)+hc(this.buf,this.pos+4)*Zl;return this.pos+=8,e},readFloat:function(){var e=$l(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=$l(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r=this.buf,i=127&(t=r[this.pos++]);return t<128?i:(i|=(127&(t=r[this.pos++]))<<7,t<128?i:(i|=(127&(t=r[this.pos++]))<<14,t<128?i:(i|=(127&(t=r[this.pos++]))<<21,t<128?i:function(e,t,r){var i,n=r.buf,a=(112&(i=n[r.pos++]))>>4;if(i<128)return Kl(e,a,t);if(a|=(127&(i=n[r.pos++]))<<3,i<128)return Kl(e,a,t);if(a|=(127&(i=n[r.pos++]))<<10,i<128)return Kl(e,a,t);if(a|=(127&(i=n[r.pos++]))<<17,i<128)return Kl(e,a,t);if(a|=(127&(i=n[r.pos++]))<<24,i<128)return Kl(e,a,t);if(a|=(1&(i=n[r.pos++]))<<31,i<128)return Kl(e,a,t);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&r[this.pos])<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e,t=this.readVarint()+this.pos,h=this.pos;return 12<=(this.pos=t)-h&&Xl?(e=this.buf,Xl.decode(e.subarray(h,t))):function(e,t){for(var r="",i=h;i<t;){var n,a,s,o=e[i],l=null,c=239<o?4:223<o?3:191<o?2:1;if(t<i+c)break;1===c?o<128&&(l=o):2===c?128==(192&(n=e[i+1]))&&(l=(31&o)<<6|63&n)<=127&&(l=null):3===c?(a=e[i+2],128==(192&(n=e[i+1]))&&128==(192&a)&&((l=(15&o)<<12|(63&n)<<6|63&a)<=2047||55296<=l&&l<=57343)&&(l=null)):4===c&&(a=e[i+2],s=e[i+3],128==(192&(n=e[i+1]))&&128==(192&a)&&128==(192&s)&&((l=(15&o)<<18|(63&n)<<12|(63&a)<<6|63&s)<=65535||1114112<=l)&&(l=null)),null===l?(l=65533,c=1):65535<l&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Wl.Bytes)return e.push(this.readVarint(t));var r=Yl(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Wl.Bytes)return e.push(this.readSVarint());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Wl.Bytes)return e.push(this.readBoolean());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Wl.Bytes)return e.push(this.readFloat());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Wl.Bytes)return e.push(this.readDouble());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Wl.Bytes)return e.push(this.readFixed32());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Wl.Bytes)return e.push(this.readSFixed32());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Wl.Bytes)return e.push(this.readFixed64());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Wl.Bytes)return e.push(this.readSFixed64());var t=Yl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){e&=7;if(e===Wl.Varint)for(;127<this.buf[this.pos++];);else if(e===Wl.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Wl.Fixed32)this.pos+=4;else{if(e!==Wl.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t,r=this.length||16;r<this.pos+e;)r*=2;r!==this.length&&((t=new Uint8Array(r)).set(this.buf),this.buf=t,this.length=r)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),cc(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),cc(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),cc(this.buf,-1&e,this.pos),cc(this.buf,Math.floor(e*ql),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),cc(this.buf,-1&e,this.pos),cc(this.buf,Math.floor(e*ql),this.pos+4),this.pos+=8},writeVarint:function(n){268435455<(n=+n||0)||n<0?function(e){var t,r,i;if(0<=n?(i=n%4294967296|0,t=n/4294967296|0):(t=~(-n/4294967296),4294967295^(i=~(-n%4294967296))?i=i+1|0:t=t+1|(i=0)),0x10000000000000000<=n||n<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),r=i,(i=e).buf[i.pos++]=127&r|128,r>>>=7,i.buf[i.pos++]=127&r|128,r>>>=7,i.buf[i.pos++]=127&r|128,r>>>=7,i.buf[i.pos++]=127&r|128,i.buf[i.pos]=127&(r>>>=7),t=(7&(r=t))<<4,(e=e).buf[e.pos++]|=t|((r>>>=3)?128:0),r&&(e.buf[e.pos++]=127&r|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=127&r|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=127&r|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=127&r|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=127&r)))))}(this):(this.realloc(4),this.buf[this.pos++]=127&n|(127<n?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(127<n?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(127<n?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var i,n,a=0;a<t.length;a++){if(55295<(i=t.charCodeAt(a))&&i<57344){if(!n){56319<i||a+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):n=i;continue}if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(e[r++]=239,e[r++]=191,e[r++]=189,n=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=63&i|128)}return r}(this.buf,e,this.pos);e=this.pos-t;128<=e&&Jl(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(e){this.realloc(4),jl(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),jl(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);t=this.pos-r;128<=t&&Jl(r,t,this),this.pos=r-1,this.writeVarint(t),this.pos+=t},writeMessage:function(e,t,r){this.writeTag(e,Wl.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Ql,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,ec,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,ic,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,tc,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,rc,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,nc,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,ac,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,sc,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,oc,t)},writeBytesField:function(e,t){this.writeTag(e,Wl.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Wl.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Wl.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Wl.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Wl.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Wl.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Wl.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Wl.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Wl.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Wl.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class mc{constructor(e,{pixelRatio:t,version:r,stretchX:i,stretchY:n,content:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=n,this.content=a,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class gc{constructor(e,t){const r={},i={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,r,n),this.addImages(t,i,n);const{w:a,h:s}=fc(n),o=new bo({width:a||1,height:s||1});for(const t in e){const i=e[t],n=r[t].paddedRect;bo.copy(i.data,o,{x:0,y:0},{x:n.x+1,y:n.y+1},i.data)}for(const e in t){const r=t[e],n=i[e].paddedRect,a=n.x+1,s=n.y+1,l=r.data.width,c=r.data.height;bo.copy(r.data,o,{x:0,y:0},{x:a,y:s},r.data),bo.copy(r.data,o,{x:0,y:c-1},{x:a,y:s-1},{width:l,height:1}),bo.copy(r.data,o,{x:0,y:0},{x:a,y:s+c},{width:l,height:1}),bo.copy(r.data,o,{x:l-1,y:0},{x:a-1,y:s},{width:1,height:c}),bo.copy(r.data,o,{x:0,y:0},{x:a+l,y:s},{width:1,height:c})}this.image=o,this.iconPositions=r,this.patternPositions=i}addImages(e,t,r){for(const a in e){var i=e[a],n={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(n),t[a]=new mc(n,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){var i;e&&t&&e.version!==t.version&&(e.version=t.version,[i,e]=e.tl,r.update(t.data,void 0,{x:i,y:e}))}}Fi("ImagePosition",mc),Fi("ImageAtlas",gc);const _c={horizontal:1,vertical:2,horizontalOnly:3};class vc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new vc;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new vc;return t.imageName=e,t}}class yc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const i=new yc;for(let e=0;e<t.sections.length;e++){var n=t.sections[e];n.image?i.addImageSection(n):i.addTextSection(n,r)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,r){let i="";for(let e=0;e<t.length;e++){var n=t.charCodeAt(e+1)||null,a=t.charCodeAt(e-1)||null;i+=!r&&(n&&xn(n)&&!Vl[t[e+1]]||a&&xn(a)&&!Vl[t[e-1]])||!Vl[t[e]]?t[e]:Vl[t[e]]}return i}(this.text,e)}trim(){let t=0;for(let e=0;e<this.text.length&&bc[this.text.charCodeAt(e)];e++)t++;let r=this.text.length;for(let e=this.text.length-1;0<=e&&e>=t&&bc[this.text.charCodeAt(e)];e--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(e,t){const r=new yc;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(vc.forText(t.scale,t.fontStack||e));var r=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(r)}addImageSection(e){var t=e.image?e.image.name:"";0!==t.length?(e=this.getNextImageSectionCharCode())?(this.text+=String.fromCharCode(e),this.sections.push(vc.forImage(t)),this.sectionIndex.push(this.sections.length-1)):V("Reached maximum number of images 6401"):V("Can't add FormattedSection with an empty image.")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xc(t,r,e,i,n,a,s,o,l,c,h,u,d,p,f,m){const g=yc.fromFeature(t,n);let _;u===_c.vertical&&g.verticalizePunctuation(d);const{processBidirectionalText:v,processStyledBidirectionalText:y}=Dn;if(v&&1===g.sections.length){_=[];const t=v(g.toString(),Mc(g,c,a,r,i,p,f));for(const r of t){const t=new yc;t.text=r,t.sections=g.sections;for(let e=0;e<r.length;e++)t.sectionIndex.push(0);_.push(t)}}else if(y){_=[];const t=y(g.text,g.sectionIndex,Mc(g,c,a,r,i,p,f));for(const r of t){const t=new yc;t.text=r[0],t.sectionIndex=r[1],t.sections=g.sections,_.push(t)}}else _=function(e,t){const r=[],i=e.text;let n=0;for(const i of t)r.push(e.substring(n,i)),n=i;return n<i.length&&r.push(e.substring(n,i.length)),r}(g,Mc(g,c,a,r,i,p,f));var x=[],h={positionedLines:x,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:u,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(h,u,d,p,f,m,g,_,v,y,x,b){let w=0,T=0,E=0;const S="right"===_?1:"left"===_?0:.5;let M=!1;for(const h of f){const d=h.getSections();for(const h of d)if(!h.imageName){const d=u[h.fontStack];if(d&&(M=void 0!==d.ascender&&void 0!==d.descender,!M))break}if(!M)break}let e=0;for(const g of f){g.trim();const f=g.getMaxScale(),_=(f-1)*Fl,s={positionedGlyphs:[],lineOffset:0};h.positionedLines[e]=s;const C=s.positionedGlyphs;let c=0;if(g.length()){let o=0,l=0;for(let s=0;s<g.length();s++){const _=g.getSection(s),E=g.getSectionIndex(s),S=g.getCharCode(s);let e=_.scale,t=null,r=null,i=null,n=Fl,a=0;A=!(v===_c.horizontal||!x&&!yn(S)||x&&(bc[S]||(A=S,$i(A)||ji(A)||Hi(A)||un(A)||mn(A))));if(_.imageName){const u=p[_.imageName];if(!u)continue;i=_.imageName,h.iconsInText=h.iconsInText||!0,r=u.paddedRect;const d=u.displaySize;e=e*Fl/b,t={width:d[0],height:d[1],left:1,top:-3,advance:A?d[1]:d[0],localGlyph:!1},a=M?-t.height*e:f*Fl-17-d[1]*e,n=t.advance;const m=(A?d[0]:d[1])*e-Fl*f;0<m&&m>c&&(c=m)}else{const h=d[_.fontStack];if(!h)continue;h[S]&&(r=h[S]);const p=u[_.fontStack];if(!p)continue;const m=p.glyphs[S];if(!m)continue;if(t=m.metrics,n=8203!==S?Fl:0,M){const h=void 0!==p.ascender?Math.abs(p.ascender):0,u=void 0!==p.descender?Math.abs(p.descender):0,d=(h+u)*e;o<d&&(o=d,l=(h-u)/2*e),a=-h*e}else a=(f-e)*Fl-17}A?(h.verticalizable=!0,C.push({glyph:S,imageName:i,x:w,y:T+a,vertical:A,scale:e,localGlyph:t.localGlyph,fontStack:_.fontStack,sectionIndex:E,metrics:t,rect:r}),w+=n*e+y):(C.push({glyph:S,imageName:i,x:w,y:T+a,vertical:A,scale:e,localGlyph:t.localGlyph,fontStack:_.fontStack,sectionIndex:E,metrics:t,rect:r}),w+=t.advance*e+y)}0!==C.length&&(E=Math.max(w-y,E),M?Cc(C,S,c,l,m*f/2):Cc(C,S,c,0,m/2)),w=0;var t=m*f+c;s.lineOffset=Math.max(c,_),T+=t,++e}else T+=m,++e}var A;const s=T,{horizontalAlign:C,verticalAlign:r}=Ac(g);(function(e,t,r,i){var n=(t-r)*E,a=-s*i;for(const t of e)for(const e of t.positionedGlyphs)e.x+=n,e.y+=a})(h.positionedLines,S,C,r),h.top+=-r*s,h.bottom=h.top+s,h.left+=-C*E,h.right=h.left+E,h.hasBaseline=M}(h,r,e,i,_,s,o,l,u,c,d,m),!function(){for(const e of x)if(0!==e.positionedGlyphs.length)return;return 1}()&&h}const bc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wc={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Tc(e,t,r,i,n,a){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*Fl/a+n:0}{const i=r[t.fontStack],a=i&&i.glyphs[e];return a?a.metrics.advance*t.scale+n:0}}function Ec(e,t,r,i){var n=Math.pow(e-t,2);return i?e<t?n/2:2*n:n+Math.abs(r)*r}function Sc(e,t,r,i,n,a){let s=null,o=Ec(t,r,n,a);for(const e of i){const i=Ec(t-e.x,r,n,a)+e.badness;i<=o&&(s=e,o=i)}return{index:e,x:t,priorBreak:s,badness:o}}function Mc(t,r,e,i,n,a,s){if("point"!==a)return[];if(!t)return[];const o=[],l=function(t,r,e,i,n,a){let s=0;for(let e=0;e<t.length();e++){var o=t.getSection(e);s+=Tc(t.getCharCode(e),o,i,n,r,a)}return s/Math.max(1,Math.ceil(s/e))}(t,r,e,i,n,s),c=0<=t.text.indexOf("");let h=0;for(let e=0;e<t.length();e++){const a=t.getSection(e),d=t.getCharCode(e);if(bc[d]||(h+=Tc(d,a,i,n,r,s)),e<t.length()-1){const r=!((u=d)<11904||!(Qi(u)||Ji(u)||pn(u)||hn(u)||nn(u)||Wi(u)||en(u)||Xi(u)||an(u)||sn(u)||rn(u)||gn(u)||Yi(u)||qi(u)||Zi(u)||tn(u)||Ki(u)||dn(u)||ln(u)||on(u)));(wc[d]||r||a.imageName)&&o.push(Sc(e+1,h,l,o,function(e,t,r){let i=0;return 10===e&&(i-=1e4),r&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}(d,t.getCharCode(e+1),r&&c),!1))}}var u;return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(Sc(t.length(),h,l,o,0,!0))}function Ac(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Cc(t,e,r,i,n){if(e||r||i||n){var a=t.length-1,s=t[a],o=(s.x+s.metrics.advance*s.scale)*e;for(let e=0;e<=a;e++)t[e].x-=o,t[e].y+=r+i+n}}function Lc(e,t,r,i,n,a){var s=e.image;let o;if(s.content){const p=s.content,t=s.pixelRatio||1;o=[p[0]/t,p[1]/t,s.displaySize[0]-p[2]/t,s.displaySize[1]-p[3]/t]}var l=t.left*a,e=t.right*a;let c,h,u,d;h="width"===r||"both"===r?(d=n[0]+l-i[3],n[0]+e+i[1]):(d=n[0]+(l+e-s.displaySize[0])/2,d+s.displaySize[0]);e=t.top*a,a=t.bottom*a;return u="height"===r||"both"===r?(c=n[1]+e-i[0],n[1]+a+i[2]):(c=n[1]+(e+a-s.displaySize[1])/2,c+s.displaySize[1]),{image:s,top:c,right:h,bottom:u,left:d,collisionPadding:o}}class Pc extends B{constructor(e,t,r,i,n){super(e,t),this.angle=i,this.z=r,void 0!==n&&(this.segment=n)}clone(){return new Pc(this.x,this.y,this.z,this.angle,this.segment)}}function Ic(e,t,r,i,n){if(void 0===t.segment)return 1;let a=t,s=t.segment+1,o=0;for(;o>-r/2;){if(s--,s<0)return;o-=e[s].dist(a),a=e[s]}o+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;o<r/2;){const t=e[s],r=e[s+1];if(!r)return;var h=e[s-1].angleTo(t)-t.angleTo(r),h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI);for(l.push({distance:o,angleDelta:h}),c+=h;o-l[0].distance>i;)c-=l.shift().angleDelta;if(c>n)return;s++,o+=t.dist(r)}return 1}function Rc(t){let r=0;for(let e=0;e<t.length-1;e++)r+=t[e].dist(t[e+1]);return r}function Dc(e,t,r){return e?.6*t*r:0}function Oc(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function kc(e,t,r,i,n,a,s,o,l){var c=Dc(i,a,s),h=Oc(i,n),i=h*s,n=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-i<t/4&&(t=i+t/4),function e(t,r,i,n,a,s,o,l,c){const h=s/2,u=Rc(t);let d=0,p=r-i,f=[];for(let e=0;e<t.length-1;e++){const o=t[e],l=t[e+1],m=o.dist(l),g=l.angleTo(o);for(;p+i<d+m;){p+=i;const _=(p-d)/m,v=qt(o.x,l.x,_),y=qt(o.y,l.y,_);if(0<=v&&v<c&&0<=y&&y<c&&0<=p-h&&p+h<=u){const i=new Pc(v,y,0,g,e);i._round(),n&&!Ic(t,i,s,n,a)||f.push(i)}}d+=m}return l||f.length||o||(f=e(t,d/2,i,n,a,s,o,!0,c)),f}(e,n?t/2*o%t:(h/2+2*a)*s*o%t,t,c,r,i,n,!1,l)}function Bc(t,n,a,s,o){const l=[];for(let e=0;e<t.length;e++){var c=t[e];let i;for(let r=0;r<c.length-1;r++){let e=c[r],t=c[r+1];e.x<n&&t.x<n||(e.x<n?e=new B(n,e.y+(n-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x<n&&(t=new B(n,e.y+(n-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y<a&&t.y<a||(e.y<a?e=new B(e.x+(a-e.y)/(t.y-e.y)*(t.x-e.x),a)._round():t.y<a&&(t=new B(e.x+(a-e.y)/(t.y-e.y)*(t.x-e.x),a)._round()),e.x>=s&&t.x>=s||(e.x>=s?e=new B(s,e.y+(s-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x>=s&&(t=new B(s,e.y+(s-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y>=o&&t.y>=o||(e.y>=o?e=new B(e.x+(o-e.y)/(t.y-e.y)*(t.x-e.x),o)._round():t.y>=o&&(t=new B(e.x+(o-e.y)/(t.y-e.y)*(t.x-e.x),o)._round()),i&&e.equals(i[i.length-1])||(i=[e],l.push(i)),i.push(t)))))}}return l}Fi("Anchor",Pc);const Fc=1e20;function zc(t,r,i,n,a,s,o,l,c){for(let e=r;e<r+n;e++)Nc(t,i*s+e,s,a,o,l,c);for(let e=i;e<i+a;e++)Nc(t,e*s+r,1,n,o,l,c)}function Nc(i,n,a,s,o,l,c){c[l[0]=0]=-Fc,c[1]=Fc,o[0]=i[n];for(let e=1,t=0,r=0;e<s;e++){o[e]=i[n+e*a];const s=e*e;do{const i=l[t];r=(o[e]-o[i]+s-i*i)/(e-i)/2}while(r<=c[t]&&-1<--t);t++,l[t]=e,c[t]=r,c[t+1]=Fc}for(let e=0,t=0;e<s;e++){for(;c[t+1]<e;)t++;const s=l[t],r=e-s;i[n+e*a]=o[s]+r*r}}const Uc={none:0,ideographs:1,all:2};class Gc{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const t=[];for(const n in e)for(const r of e[n])t.push({stack:n,id:r});p(t,({stack:r,id:n},a)=>{let s=this.entries[r];s=s||(this.entries[r]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let e=s.glyphs[n];if(void 0===e){if(e=this._tinySDF(s,r,n),e)return s.glyphs[n]=e,void a(null,{stack:r,id:n,glyph:e});const o=Math.floor(n/256);if(65535<256*o)a(new Error("glyphs > 65535 not supported"));else if(s.ranges[o])a(null,{stack:r,id:n,glyph:e});else{let i=s.requests[o];i||(i=s.requests[o]=[],Gc.loadGlyphRange(r,o,this.url,this.requestManager,(e,t)=>{if(t){s.ascender=t.ascender,s.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(s.glyphs[+e]=t.glyphs[+e]);s.ranges[o]=!0}for(const r of i)r(e,t);delete s.requests[o]})),i.push((e,t)=>{e?a(e):t&&a(null,{stack:r,id:n,glyph:t.glyphs[n]||null})})}}else a(null,{stack:r,id:n,glyph:e})},(e,t)=>{if(e)n(e);else if(t){const e={};for(const{stack:n,id:r,glyph:i}of t)void 0===e[n]&&(e[n]={}),void 0===e[n].glyphs&&(e[n].glyphs={}),e[n].glyphs[r]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},e[n].ascender=this.entries[n].ascender,e[n].descender=this.entries[n].descender;n(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Uc.none&&(this.localGlyphMode===Uc.all?!!this.localFontFamily:!!this.localFontFamily&&(sn(e)||cn(e)||Yi(e)||Ki(e))||Xi(e))}_tinySDF(r,i,e){var n=this.localFontFamily;if(n&&this._doesCharSupportLocalGlyph(e)){let t=r.tinySDF;if(!t){let e="400";/bold/i.test(i)?e="900":/medium/i.test(i)?e="500":/light/i.test(i)&&(e="200"),t=r.tinySDF=new Gc.TinySDF({fontFamily:n,fontWeight:e,fontSize:48,buffer:6,radius:16}),t.fontWeight=e}if(this.localGlyphs[t.fontWeight][e])return this.localGlyphs[t.fontWeight][e];var a=String.fromCharCode(e),{data:s,width:o,height:l,glyphWidth:c,glyphHeight:i,glyphLeft:r,glyphTop:n,glyphAdvance:a}=t.draw(a);return this.localGlyphs[t.fontWeight][e]={id:e,bitmap:new xo({width:o,height:l},s),metrics:{width:c/2,height:i/2,left:r/2,top:n/2-27,advance:a/2,localGlyph:!0}}}}}function Vc(y,x,b,t){const r=[],w=y.image,T=w.pixelRatio,e=w.paddedRect.w-2,i=w.paddedRect.h-2,E=y.right-y.left,S=y.bottom-y.top,n=w.stretchX||[[0,e]],a=w.stretchY||[[0,i]],s=(e,t)=>e+t[1]-t[0],M=n.reduce(s,0),A=a.reduce(s,0),o=e-M,l=i-A;let C=0,L=M,P=0,I=A,R=0,D=o,O=0,k=l;if(w.content&&t){const y=w.content;C=$c(n,0,y[0]),P=$c(a,0,y[1]),L=$c(n,y[0],y[2]),I=$c(a,y[1],y[3]),R=y[0]-C,O=y[1]-P,D=y[2]-y[0]-L,k=y[3]-y[1]-I}var c=(e,t,r,i)=>{const n=(e.stretch-C)/L*E+y.left,a=e.fixed-R-D*e.stretch/M,s=(t.stretch-P)/I*S+y.top,o=t.fixed-O-k*t.stretch/A,l=(r.stretch-C)/L*E+y.left,c=r.fixed-R-D*r.stretch/M,h=(i.stretch-P)/I*S+y.top,u=i.fixed-O-k*i.stretch/A,d=new B(n,s),p=new B(l,s),f=new B(l,h),m=new B(n,h),g=new B(a/T,o/T),_=new B(c/T,u/T),v=x*Math.PI/180;if(v){const y=Math.sin(v),x=Math.cos(v),b=[x,-y,y,x];d._matMult(b),p._matMult(b),m._matMult(b),f._matMult(b)}e=e.stretch+e.fixed,t=t.stretch+t.fixed;return{tl:d,tr:p,bl:m,br:f,tex:{x:w.paddedRect.x+1+e,y:w.paddedRect.y+1+t,w:r.stretch+r.fixed-e,h:i.stretch+i.fixed-t},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:g,pixelOffsetBR:_,minFontScaleX:D/T/E,minFontScaleY:k/T/S,isSDF:b}};if(t&&(w.stretchX||w.stretchY)){const y=jc(n,o,M),x=jc(a,l,A);for(let e=0;e<y.length-1;e++){const t=y[e],B=y[e+1];for(let e=0;e<x.length-1;e++)r.push(c(t,x[e],B,x[e+1]))}}else r.push(c({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+e},{fixed:0,stretch:1+i}));return r}function $c(e,t,r){let i=0;for(const n of e)i+=Math.max(t,Math.min(r,n[1]))-Math.max(t,Math.min(r,n[0]));return i}function jc(e,t,r){const i=[{fixed:-1,stretch:0}];for(const[t,r]of e){const e=i[i.length-1];i.push({fixed:t-e.stretch,stretch:e.stretch}),i.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return i.push({fixed:t+1,stretch:r}),i}Gc.loadGlyphRange=function(e,t,r,i,n){var a=256*t,t=255+a,t=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${a}-${t}`),xe.Glyphs);Te(t,(e,t)=>{if(e)n(e);else if(t){const e={},r=new Hl(t).readFields(uc,{});for(const t of r.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}})},Gc.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:n="sans-serif",fontWeight:a="normal",fontStyle:s="normal"}){this.buffer=t,this.cutoff=i,this.radius=r;const o=this.size=e+4*t,l=this._createCanvas(o),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${a} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Uint16Array(o)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(r){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:e,actualBoundingBoxRight:a}=this.ctx.measureText(r),s=Math.floor(i),o=Math.min(this.size-this.buffer,Math.ceil(a-e)),l=Math.min(this.size-this.buffer,Math.ceil(i)+Math.ceil(n)),c=o+2*this.buffer,h=l+2*this.buffer,u=c*h,d=new Uint8ClampedArray(u),p={data:d,width:c,height:h,glyphWidth:o,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===o||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,o,l),f.fillText(r,m,m+s+1);var v=f.getImageData(m,m,o,l);_.fill(Fc,0,u),g.fill(0,0,u);for(let t=0;t<l;t++)for(let e=0;e<o;e++){const i=v.data[4*(t*o+e)+3]/255;if(0!=i){const n=(t+m)*c+e+m;if(1==i)_[n]=0,g[n]=Fc;else{const r=.5-i;_[n]=0<r?r*r:0,g[n]=r<0?r*r:0}}}zc(_,0,0,c,h,c,this.f,this.v,this.z),zc(g,m,m,o,l,c,this.f,this.v,this.z);for(let e=0;e<u;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class Hc{constructor(e=[],t=function(e,t){return e<t?-1:t<e?1:0}){if(this.data=e,this.length=this.data.length,this.compare=t,0<this.length)for(let e=(this.length>>1)-1;0<=e;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,0<this.length&&(this.data[0]=t,this._down(0)),e}}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,i=t[e];for(;0<e;){var n=e-1>>1,a=t[n];if(0<=r(i,a))break;t[e]=a,e=n}t[e]=i}_down(r){const{data:i,compare:n}=this,e=this.length>>1,a=i[r];for(;r<e;){let e=1+(r<<1),t=i[e];var s=e+1;if(s<this.length&&n(i[s],t)<0&&(e=s,t=i[s]),0<=n(t,a))break;i[r]=t,r=e}i[r]=a}}function Wc(e,t){return t.max-e.max}function Zc(e,t,r,i){this.p=new B(e,t),this.h=r,this.d=function(i,t){let n=!1,a=1/0;for(let e=0;e<t.length;e++){var s=t[e];for(let e=0,t=s.length,r=t-1;e<t;r=e++){var o=s[e],l=s[r];o.y>i.y!=l.y>i.y&&i.x<(l.x-o.x)*(i.y-o.y)/(l.y-o.y)+o.x&&(n=!n),a=Math.min(a,Ns(i,o,l))}}return(n?1:-1)*Math.sqrt(a)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const qc=Number.POSITIVE_INFINITY,Xc=Math.sqrt(2);function Yc(e,t){return t[1]!==qc?function(e,t,r){let i=0,n=0;switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":n=r-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-r}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}return[i,n]}(e,t[0],t[1]):function(e,t){let r=0,i=0;var n=(t=t<0?0:t)/Xc;switch(e){case"top-right":case"top-left":i=n-7;break;case"bottom-right":case"bottom-left":i=7-n;break;case"bottom":i=7-t;break;case"top":i=t-7}switch(e){case"top-right":case"bottom-right":r=-n;break;case"top-left":case"bottom-left":r=n;break;case"left":r=t;break;case"right":r=-t}return[r,i]}(e,t[0])}function Kc(i,n,a,s,o,l,c,h,u){i.createArrays(),i.tilePixelRatio=fs/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const d=i.layers[0].layout,p=i.layers[0]._unevaluatedLayout._values,f={};if("composite"===i.textSizeData.kind){const{minZoom:n,maxZoom:a}=i.textSizeData;f.compositeTextSizes=[p["text-size"].possiblyEvaluate(new On(n),h),p["text-size"].possiblyEvaluate(new On(a),h)]}if("composite"===i.iconSizeData.kind){const{minZoom:n,maxZoom:a}=i.iconSizeData;f.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new On(n),h),p["icon-size"].possiblyEvaluate(new On(a),h)]}f.layoutTextSize=p["text-size"].possiblyEvaluate(new On(u+1),h),f.layoutIconSize=p["icon-size"].possiblyEvaluate(new On(u+1),h),f.textMaxSize=p["text-size"].possiblyEvaluate(new On(18),h);const m="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),g=d.get("text-size");for(const l of i.features){const u=d.get("text-font").evaluate(l,{},h).join(","),p=g.evaluate(l,{},h),v=f.layoutTextSize.evaluate(l,{},h),y=(f.layoutIconSize.evaluate(l,{},h),{horizontal:{},vertical:void 0}),x=l.text;let e,r=[0,0];if(x){const s=x.toString(),c=d.get("text-letter-spacing").evaluate(l,{},h)*Fl,f=d.get("text-line-height").evaluate(l,{},h)*Fl,g=vn(s)?c:0,b=d.get("text-anchor").evaluate(l,{},h),w=d.get("text-variable-anchor");if(!w){const i=d.get("text-radial-offset").evaluate(l,{},h);r=i?Yc(b,[i*Fl,qc]):d.get("text-offset").evaluate(l,{},h).map(e=>e*Fl)}let e=m?"center":d.get("text-justify").evaluate(l,{},h);const T=d.get("symbol-placement"),E="point"===T,S="point"===T?d.get("text-max-width").evaluate(l,{},h)*Fl:0,M=e=>{i.allowVerticalPlacement&&_n(s)&&(y.vertical=xc(x,n,a,o,u,S,f,b,e,g,r,_c.vertical,!0,T,v,p))};if(!m&&w){const i="auto"===e?w.map(e=>Jc(e)):[e];let t=!1;for(let e=0;e<i.length;e++){const c=i[e];if(!y.horizontal[c])if(t)y.horizontal[c]=y.horizontal[0];else{const i=xc(x,n,a,o,u,S,f,"center",c,g,r,_c.horizontal,!1,T,v,p);i&&(y.horizontal[c]=i,t=1===i.positionedLines.length)}}M("left")}else{if("auto"===e&&(e=Jc(b)),E||0<=d.get("text-writing-mode").indexOf("horizontal")||!_n(s)){const i=xc(x,n,a,o,u,S,f,b,e,g,r,_c.horizontal,!1,T,v,p);i&&(y.horizontal[e]=i)}M("point"===T?"left":e)}}let t=!1;if(l.icon&&l.icon.name){const n=s[l.icon.name];n&&(e=function(e,t,r){var{horizontalAlign:i,verticalAlign:r}=Ac(r),i=t[0]-e.displaySize[0]*i,r=t[1]-e.displaySize[1]*r;return{image:e,top:r,bottom:r+e.displaySize[1],left:i,right:i+e.displaySize[0]}}(o[l.icon.name],d.get("icon-offset").evaluate(l,{},h),d.get("icon-anchor").evaluate(l,{},h)),t=n.sdf,void 0===i.sdfIcons?i.sdfIcons=n.sdf:i.sdfIcons!==n.sdf&&V("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),n.pixelRatio===i.pixelRatio&&0===d.get("icon-rotate").constantOr(1)||(i.iconsNeedLinear=!0))}var _=th(y.horizontal)||y.vertical;i.iconsInText||(i.iconsInText=!!_&&_.iconsInText),(_||e)&&function(r,i,n,a,s,o,e,l,c,h,u){let t=o.textMaxSize.evaluate(i,{},u);void 0===t&&(t=e);const d=r.layers[0].layout,p=d.get("icon-offset").evaluate(i,{},u),f=th(n.horizontal)||n.vertical,m=e/24,g=r.tilePixelRatio*t/24,_=r.tilePixelRatio*d.get("symbol-spacing"),v=d.get("text-padding")*r.tilePixelRatio,y=d.get("icon-padding")*r.tilePixelRatio,x=C(d.get("text-max-angle")),b="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),w="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),T=d.get("symbol-placement"),E=_/2,S=d.get("icon-text-fit");let M;a&&"none"!==S&&(r.allowVerticalPlacement&&n.vertical&&(M=Lc(a,n.vertical,S,d.get("icon-text-fit-padding"),p,m)),f&&(a=Lc(a,f,S,d.get("icon-text-fit-padding"),p,m)));var A=(e,t)=>{t.x<0||t.x>=fs||t.y<0||t.y>=fs||function(t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,e,g,_,v,y,x,b,w,T){var E=t.addToLineVertexArray(r,n);let S,M,A,C,L,P,I,R=0,D=0,O=0,k=0,B=-1,F=-1;var z={};let N=Na(""),U=0,G=0;if(void 0===c._unevaluatedLayout.getValue("text-radial-offset")?[U,G]=c.layout.get("text-offset").evaluate(y,{},T).map(e=>e*Fl):(U=c.layout.get("text-radial-offset").evaluate(y,{},T)*Fl,G=qc),t.allowVerticalPlacement&&a.vertical){const t=a.vertical;if(m)P=ih(t),l&&(I=ih(l));else{const n=c.layout.get("text-rotate").evaluate(y,{},T)+90;A=rh(h,i,r,u,d,p,t,f,n,e),l&&(C=rh(h,i,r,u,d,p,l,g,n))}}if(s){const n=c.layout.get("icon-rotate").evaluate(y,{},T),a="none"!==c.layout.get("icon-text-fit"),o=Vc(s,n,b,a),f=l?Vc(l,n,b,a):void 0;M=rh(h,i,r,u,d,p,s,g,n),R=4*o.length;const m=t.iconSizeData;let e=null;"source"===m.kind?(e=[zl*c.layout.get("icon-size").evaluate(y,{},T)],e[0]>Qc&&V(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===m.kind&&(e=[zl*x.compositeIconSizes[0].evaluate(y,{},T),zl*x.compositeIconSizes[1].evaluate(y,{},T)],(e[0]>Qc||e[1]>Qc)&&V(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,o,e,v,_,y,!1,i,r,E.lineStartIndex,E.lineLength,-1,w,T),B=t.icon.placedSymbolArray.length-1,f&&(D=4*f.length,t.addSymbols(t.icon,f,e,v,_,y,_c.vertical,i,r,E.lineStartIndex,E.lineLength,-1,w,T),F=t.icon.placedSymbolArray.length-1)}for(const n in a.horizontal){const s=a.horizontal[n];S||(N=Na(s.text),m?L=ih(s):S=rh(h,i,r,u,d,p,s,f,c.layout.get("text-rotate").evaluate(y,{},T),e));const l=1===s.positionedLines.length;if(O+=eh(t,i,r,s,o,c,m,y,e,E,a.vertical?_c.horizontal:_c.horizontalOnly,l?Object.keys(a.horizontal):[n],z,B,x,w,T),l)break}a.vertical&&(k+=eh(t,i,r,a.vertical,o,c,m,y,e,E,_c.vertical,["vertical"],z,F,x,w,T));_=(e,t)=>e?Math.max(e,t):t,v=_(L,-1);v=_(P,v);_=-1<(v=_(I,v))?1:0;t.glyphOffsetArray.length>=uh.MAX_GLYPHS&&V("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==y.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,y.sortKey),t.symbolInstances.emplaceBack(i.x,i.y,i.z,r.x,r.y,0<=z.right?z.right:-1,0<=z.center?z.center:-1,0<=z.left?z.left:-1,0<=z.vertical?z.vertical:-1,B,F,N,void 0!==S?S:t.collisionBoxArray.length,void 0!==S?S+1:t.collisionBoxArray.length,void 0!==A?A:t.collisionBoxArray.length,void 0!==A?A+1:t.collisionBoxArray.length,void 0!==M?M:t.collisionBoxArray.length,void 0!==M?M+1:t.collisionBoxArray.length,C||t.collisionBoxArray.length,C?C+1:t.collisionBoxArray.length,u,O,k,R,D,_,0,U,G,v)}(r,t,t,e,n,a,s,M,r.layers[0],r.collisionBoxArray,i.index,i.sourceLayerIndex,r.index,v,b,l,y,w,p,i,o,c,h,u)};if("line"===T)for(const s of Bc(i.geometry,0,0,fs,fs)){const i=kc(s,_,x,n.vertical||f,a,24,g,r.overscaling,fs);for(const n of i){const i=f;i&&function(t,e,r,i){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;0<=e;e--)if(i.dist(t[e])<r)return!0}else n[e]=[];return n[e].push(i),!1}(r,i.text,E,n)||A(s,n)}}else if("line-center"===T){for(const r of i.geometry)if(1<r.length){const i=function(t,r,e,i,n,a){var s=Dc(e,n,a),o=Oc(e,i)*a;let l=0;var c=Rc(t)/2;for(let e=0;e<t.length-1;e++){const i=t[e],n=t[e+1],a=i.dist(n);if(l+a>c){var h=(c-l)/a,u=qt(i.x,n.x,h),h=qt(i.y,n.y,h),h=new Pc(u,h,0,n.angleTo(i),e);return!s||Ic(t,h,o,s,r)?h:void 0}l+=a}}(r,x,n.vertical||f,a,24,g);i&&A(r,i)}}else if("Polygon"===i.type)for(const r of Xo(i.geometry,0)){const i=function(r,t,e=!1){let i=1/0,n=1/0,a=-1/0,s=-1/0;var o=r[0];for(let e=0;e<o.length;e++){const t=o[e];(!e||t.x<i)&&(i=t.x),(!e||t.y<n)&&(n=t.y),(!e||t.x>a)&&(a=t.x),(!e||t.y>s)&&(s=t.y)}var l=Math.min(a-i,s-n);let c=l/2;const h=new Hc([],Wc);if(0===l)return new B(i,n);for(let t=i;t<a;t+=l)for(let e=n;e<s;e+=l)h.push(new Zc(t+c,e+c,c,r));let u=function(e){let i=0,n=0,a=0;var s=e[0];for(let e=0,t=s.length,r=t-1;e<t;r=e++){var o=s[e],l=s[r],c=o.x*l.y-l.x*o.y;n+=(o.x+l.x)*c,a+=(o.y+l.y)*c,i+=3*c}return new Zc(n/i,a/i,0,e)}(r),d=h.length;for(;h.length;){const i=h.pop();(i.d>u.d||!u.d)&&(u=i,e&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-u.d<=t||(c=i.h/2,h.push(new Zc(i.p.x-c,i.p.y-c,c,r)),h.push(new Zc(i.p.x+c,i.p.y-c,c,r)),h.push(new Zc(i.p.x-c,i.p.y+c,c,r)),h.push(new Zc(i.p.x+c,i.p.y+c,c,r)),d+=4)}return e&&(console.log(`num probes: ${d}`),console.log(`best distance: ${u.d}`)),u.p}(r,16);A(r[0],new Pc(i.x,i.y,0,0,void 0))}else if("LineString"===i.type)for(const r of i.geometry)A(r,new Pc(r[0].x,r[0].y,0,0,void 0));else if("Point"===i.type)for(const r of i.geometry)for(const i of r)A([i],new Pc(i.x,i.y,0,0,void 0))}(i,l,y,e,s,f,v,r,t,c,h)}l&&i.generateCollisionDebugBuffers(u,i.collisionBoxArray)}function Jc(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}const Qc=32640;function eh(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m,g){i=function(u,d,e,p,t,f,m){const g=[];if(0===u.positionedLines.length)return g;var r,_=e.layout.get("text-rotate").evaluate(t,{})*Math.PI/180,v=(r=d[0],e=d[1],0<(t=r*e)?[r,-e]:t<0?[-r,e]:0===r?[e,r]:[e,-r]);let i=Math.abs(u.top-u.bottom);for(const C of u.positionedLines)i-=C.lineOffset;var n,a,s,o,l,c=u.positionedLines.length,h=i/c;let y=u.top-d[1];for(let e=0;e<c;++e){const L=u.positionedLines[e];y=(n=u,a=h,s=y,o=e,l=void 0,l=a+n.positionedLines[o].lineOffset,0===o?s+l/2:s+(l+(a+n.positionedLines[o-1].lineOffset))/2);for(const C of L.positionedGlyphs)if(C.rect){const L=C.rect||{};let o=4,l=!0,c=1,h=0;if(C.imageName){const u=f[C.imageName];if(!u)continue;if(u.sdf){V("SDF images are not supported in formatted text and will be ignored.");continue}l=!1,c=u.pixelRatio,o=1/c}var x=(p||m)&&C.vertical,b=C.metrics.advance*C.scale/2,w=C.metrics,T=C.rect;if(null!==T){m&&u.verticalizable&&(h=C.imageName?b-C.metrics.width*C.scale/2:0);var E=p?[C.x+b,C.y]:[0,0];let e=[0,0],t=[0,0],r=!1;p||(x?(t=[C.x+b+v[0],C.y+v[1]-h],r=!0):e=[C.x+b+d[0],C.y+d[1]-h]);var S=T.w*C.scale/(c*(C.localGlyph?2:1)),M=T.h*C.scale/(c*(C.localGlyph?2:1));let i,n,a,s;if(x){const u=C.y-y,d=new B(-b,b-u),L=-Math.PI/2,p=new B(...t);i=new B(-b+e[0],e[1]),i._rotateAround(L,d)._add(p),i.x+=-u+b,i.y-=(w.left-o)*C.scale;const f=C.imageName?w.advance*C.scale:Fl*C.scale,m=String.fromCharCode(C.glyph);""===(x=m)||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x?i.x+=(1-o)*C.scale:(x=m,i.x+=""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x||""===x?f-w.height*C.scale+(-o-1)*C.scale:C.imageName||w.width+2*o===T.w&&w.height+2*o===T.h?(f-M)/2:(f-(w.height+2*o)*C.scale)/2),n=new B(i.x,i.y-S),a=new B(i.x+M,i.y),s=new B(i.x+M,i.y-S)}else{const u=(w.left-o)*C.scale-b+e[0],d=(-w.top-o)*C.scale+e[1],L=u+S,p=d+M;i=new B(u,d),n=new B(L,d),a=new B(u,p),s=new B(L,p)}_&&(A=p?new B(0,0):r?new B(v[0],v[1]):new B(d[0],d[1]),i._rotateAround(_,A),n._rotateAround(_,A),a._rotateAround(_,A),s._rotateAround(_,A));var M=new B(0,0),A=new B(0,0);g.push({tl:i,tr:n,bl:a,br:s,tex:L,writingMode:u.writingMode,glyphOffset:E,sectionIndex:C.sectionIndex,isSDF:l,pixelOffsetTL:M,pixelOffsetBR:A,minFontScaleX:0,minFontScaleY:0})}}}return g}(i,l,a,s,o,n,e.allowVerticalPlacement),n=e.textSizeData;let _=null;"source"===n.kind?(_=[zl*a.layout.get("text-size").evaluate(o,{},g)],_[0]>Qc&&V(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===n.kind&&(_=[zl*f.compositeTextSizes[0].evaluate(o,{},g),zl*f.compositeTextSizes[1].evaluate(o,{},g)],(_[0]>Qc||_[1]>Qc)&&V(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,i,_,l,s,o,h,t,r,c.lineStartIndex,c.lineLength,p,m,g);for(const t of u)d[t]=e.text.placedSymbolArray.length-1;return 4*i.length}function th(e){for(const t in e)return e[t];return null}function rh(t,r,i,n,a,e,s,o,l,c){let h=s.top,u=s.bottom,d=s.left,p=s.right;s=s.collisionPadding;if(s&&(d-=s[0],h-=s[1],p+=s[2],u+=s[3]),l){const t=new B(d,h),r=new B(p,h),i=new B(d,u),n=new B(p,u),a=C(l);let e=new B(0,0);c&&(e=new B(c[0],c[1])),t._rotateAround(a,e),r._rotateAround(a,e),i._rotateAround(a,e),n._rotateAround(a,e),d=Math.min(t.x,r.x,i.x,n.x),p=Math.max(t.x,r.x,i.x,n.x),h=Math.min(t.y,r.y,i.y,n.y),u=Math.max(t.y,r.y,i.y,n.y)}return t.emplaceBack(r.x,r.y,r.z,i.x,i.y,d,h,p,u,o,n,a,e),t.length-1}function ih(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);e=e.bottom-e.top;return 0<e?Math.max(10,e):null}const nh=ul.VectorTileFeature.types,ah=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sh(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m){var g=h?Math.min(Qc,Math.round(h[0])):0,h=h?Math.min(Qc,Math.round(h[1])):0;e.emplaceBack(t,r,Math.round(32*s),Math.round(32*o),l,c,(g<<1)+(u?1:0),h,16*d,16*p,256*f,256*m,i,n,a,0)}function oh(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function lh(e){for(const t of e.sections)if(function(e){for(const t of e)if(bn(t.charCodeAt(0)))return 1}(t.text))return 1}class ch{constructor(e){this.layoutVertexArray=new oa,this.indexArray=new pa,this.programConfigurations=e,this.segments=new ps,this.dynamicLayoutVertexArray=new na,this.opacityVertexArray=new la,this.placedSymbolArray=new Ma}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,i){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Il.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Rl.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ah,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Fi("SymbolBuffers",ch);class hh{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new ps,this.collisionVertexArray=new da,this.collisionVertexArrayExt=new na}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Dl.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ol.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Fi("CollisionBuffers",hh);class uh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ks([]),this.placementViewportMatrix=Ks([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nl(this.zoom,t["text-size"]),this.iconSizeData=Nl(this.zoom,t["icon-size"]);const r=this.layers[0].layout,i=r.get("symbol-sort-key"),n=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(e=>_c[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID}createArrays(){this.text=new ch(new ns(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ch(new ns(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new La,this.lineVertexArray=new Pa,this.symbolInstances=new Ca}calculateGlyphDependencies(t,r,e,i,n){for(let e=0;e<t.length;e++)if(r[t.charCodeAt(e)]=!0,i&&n){const i=Vl[t.charAt(e)];i&&(r[i.charCodeAt(0)]=!0)}}populate(r,i,n,a){const s=this.layers[0],o=s.layout,l=o.get("text-font"),c=o.get("text-field"),h=o.get("icon-image"),u=("constant"!==c.value.kind||c.value.value instanceof ut&&!c.value.value.isEmpty()||0<c.value.value.toString().length)&&("constant"!==l.value.kind||0<l.value.value.length),d="constant"!==h.value.kind||!!h.value.value||0<Object.keys(h.parameters).length,p=o.get("symbol-sort-key");if(this.features=[],u||d){const m=i.iconDependencies,g=i.glyphDependencies,_=i.availableImages,e=new On(this.zoom);for(const{feature:i,id:c,index:h,sourceLayerIndex:v}of r){const r=s._featureFilter.needGeometry,y=Rs(i,r);if(s._featureFilter.filter(e,y,n)){let e,t;if(r||(y.geometry=Is(i,n,a)),u){const r=s.getValueAndResolveTokens("text-field",y,n,_),i=ut.factory(r);lh(i)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Mn||this.hasRTLText&&Dn.isParsed())&&(e=function(e,r,t){return e.sections.forEach(e=>{e.text=function(e,t){t=r.layout.get("text-transform").evaluate(t,{});return"uppercase"===t?e=e.toLocaleUpperCase():"lowercase"===t&&(e=e.toLocaleLowerCase()),e=Dn.applyArabicShaping?Dn.applyArabicShaping(e):e}(e.text,t)}),e}(i,s,y))}if(d){const r=s.getValueAndResolveTokens("icon-image",y,n,_);t=r instanceof dt?r:dt.fromString(r)}if(e||t){var f=this.sortFeaturesByKey?p.evaluate(y,{},n):void 0;if(this.features.push({id:c,text:e,icon:t,index:h,sourceLayerIndex:v,geometry:y.geometry,properties:i.properties,type:nh[i.type],sortKey:f}),t&&(m[t.name]=!0),e){const r=l.evaluate(y,{},n).join(","),i="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(_c.vertical);for(const n of e.sections)if(n.image)m[n.image.name]=!0;else{const a=_n(e.toString()),s=n.fontStack||r,o=g[s]=g[s]||{};this.calculateGlyphDependencies(n.text,o,i,this.allowVerticalPlacement,a)}}}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const n={},a={},s=[];let r=0;function i(e){s.push(t[e]),r++}function o(e,t,r){var i=a[e];return delete a[e],a[t]=i,s[i].geometry[0].pop(),s[i].geometry[0]=s[i].geometry[0].concat(r[0]),i}function l(e,t,r){var i=n[t];return delete n[t],n[e]=i,s[i].geometry[0].shift(),s[i].geometry[0]=r[0].concat(s[i].geometry[0]),i}function c(e,t,r){t=r?t[0][t[0].length-1]:t[0][0];return`${e}:${t.x}:${t.y}`}for(let e=0;e<t.length;e++){const d=t[e],p=d.geometry,f=d.text?d.text.toString():null;if(f){var h=c(f,p),u=c(f,p,!0);if(h in a&&u in n&&a[h]!==n[u]){const t=l(h,u,p),r=o(h,u,s[t].geometry);delete n[h],delete a[u],a[c(f,s[r].geometry,!0)]=r,s[t].geometry=null}else h in a?o(h,u,p):u in n?l(h,u,p):(i(e),n[h]=r-1,a[u]=r-1)}else i(e)}return s.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}}update(e,t,r,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,n){var e=this.lineVertexArray.length;if(void 0!==i.segment){let t=i.dist(n[i.segment+1]),r=i.dist(n[i.segment]);const a={};for(let e=i.segment+1;e<n.length;e++)a[e]={x:n[e].x,y:n[e].y,tileUnitDistanceFromAnchor:t},e<n.length-1&&(t+=n[e+1].dist(n[e]));for(let e=i.segment||0;0<=e;e--)a[e]={x:n[e].x,y:n[e].y,tileUnitDistanceFromAnchor:r},0<e&&(r+=n[e-1].dist(n[e]));for(let e=0;e<n.length;e++){const n=a[e];this.lineVertexArray.emplaceBack(n.x,n.y,n.tileUnitDistanceFromAnchor)}}return{lineStartIndex:e,lineLength:this.lineVertexArray.length-e}}addSymbols(t,r,i,e,n,a,s,o,l,c,h,u,d,p){const f=t.indexArray,m=t.layoutVertexArray,g=t.segments.prepareSegment(4*r.length,m,f,this.canOverlap?a.sortKey:void 0),_=this.glyphOffsetArray.length,v=g.vertexLength,y=this.allowVerticalPlacement&&s===_c.vertical?Math.PI/2:0,x=a.text&&a.text.sections;for(let e=0;e<r.length;e++){const{tl:n,tr:s,bl:c,br:h,tex:u,pixelOffsetTL:_,pixelOffsetBR:v,minFontScaleX:b,minFontScaleY:w,glyphOffset:T,isSDF:E,sectionIndex:S}=r[e],M=g.vertexLength,A=T[1];sh(m,o.x,o.y,o.z,l.x,l.y,n.x,A+n.y,u.x,u.y,i,E,_.x,_.y,b,w),sh(m,o.x,o.y,o.z,l.x,l.y,s.x,A+s.y,u.x+u.w,u.y,i,E,v.x,_.y,b,w),sh(m,o.x,o.y,o.z,l.x,l.y,c.x,A+c.y,u.x,u.y+u.h,i,E,_.x,v.y,b,w),sh(m,o.x,o.y,o.z,l.x,l.y,h.x,A+h.y,u.x+u.w,u.y+u.h,i,E,v.x,v.y,b,w),oh(t.dynamicLayoutVertexArray,o,y),f.emplaceBack(M,M+1,M+2),f.emplaceBack(M+1,M+2,M+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),e!==r.length-1&&S===r[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(m.length,a,a.index,{},d,p,x&&x[S])}t.placedSymbolArray.emplaceBack(o.x,o.y,o.z,l.x,l.y,_,this.glyphOffsetArray.length-_,v,c,h,l.segment,i?i[0]:0,i?i[1]:0,e[0],e[1],s,0,!1,0,u,0)}_commitLayoutVertex(e,t,r,i,n,a,s){e.emplaceBack(t,r,i,n,a,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,r,i,n,a,s){const o=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=o.vertexLength,c=s.tileAnchorX,h=s.tileAnchorY;for(let e=0;e<4;e++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,i,n,a,c,h,new B(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,n,a,c,h,new B(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,n,a,c,h,new B(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,i,n,a,c,h,new B(e.x1,e.y2)),o.vertexLength+=4;const u=r.indexArray;u.emplaceBack(l,l+1),u.emplaceBack(l+1,l+2),u.emplaceBack(l+2,l+3),u.emplaceBack(l+3,l),o.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,i,n,a,s){for(let e=n;e<a;e++){const n=i.get(e),a=this.getSymbolInstanceTextSize(t,s,r,e);this._addCollisionDebugVertices(n,a,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(t,r,i,n,a,s){for(let e=n;e<a;e++){const n=i.get(e),a=this.getSymbolInstanceIconSize(t,r,e);this._addCollisionDebugVertices(n,a,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hh(ha,kl.members,ya),this.iconCollisionBox=new hh(ha,kl.members,ya);var i=Gl(this.iconSizeData,t),n=Gl(this.textSizeData,t);for(let e=0;e<this.symbolInstances.length;e++){var a=this.symbolInstances.get(e);this._addTextDebugCollisionBoxes(n,t,r,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(n,t,r,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,t,r,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,t,r,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,r,i){i=this.text.placedSymbolArray.get(0<=t.rightJustifiedTextSymbolIndex?t.rightJustifiedTextSymbolIndex:0<=t.centerJustifiedTextSymbolIndex?t.centerJustifiedTextSymbolIndex:0<=t.leftJustifiedTextSymbolIndex?t.leftJustifiedTextSymbolIndex:0<=t.verticalPlacedTextSymbolIndex?t.verticalPlacedTextSymbolIndex:i),i=Ul(this.textSizeData,e,i)/Fl;return this.tilePixelRatio*i}getSymbolInstanceIconSize(e,t,r){r=this.icon.placedSymbolArray.get(r),r=Ul(this.iconSizeData,e,r);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}_updateTextDebugCollisionBoxes(t,r,i,n,a,s){for(let e=n;e<a;e++){const n=i.get(e),a=this.getSymbolInstanceTextSize(t,s,r,e);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,a,n.padding)}}_updateIconDebugCollisionBoxes(t,r,i,n,a){for(let e=n;e<a;e++){const n=i.get(e),a=this.getSymbolInstanceIconSize(t,r,e);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,a,n.padding)}}updateCollisionDebugBuffers(t,r){if(this.hasDebugData()){this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();var i=Gl(this.iconSizeData,t),n=Gl(this.textSizeData,t);for(let e=0;e<this.symbolInstances.length;e++){var a=this.symbolInstances.get(e);this._updateTextDebugCollisionBoxes(n,t,r,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(n,t,r,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(i,t,r,a.iconBoxStartIndex,a.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(i,t,r,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}}_deserializeCollisionBoxesForSymbol(t,r,i,n,a,s,o,l,c){const h={};for(let e=r;e<i;e++){const r=t.get(e);h.textBox={x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,padding:r.padding,projectedAnchorX:r.projectedAnchorX,projectedAnchorY:r.projectedAnchorY,projectedAnchorZ:r.projectedAnchorZ,tileAnchorX:r.tileAnchorX,tileAnchorY:r.tileAnchorY},h.textFeatureIndex=r.featureIndex;break}for(let e=n;e<a;e++){const i=t.get(e);h.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},h.verticalTextFeatureIndex=i.featureIndex;break}for(let e=s;e<o;e++){const i=t.get(e);h.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},h.iconFeatureIndex=i.featureIndex;break}for(let e=l;e<c;e++){const i=t.get(e);h.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},h.verticalIconFeatureIndex=i.featureIndex;break}return h}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}addIndicesForPlacedSymbol(t,r){var r=t.placedSymbolArray.get(r),i=r.vertexStartIndex+4*r.numGlyphs;for(let e=r.vertexStartIndex;e<i;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),i=[],n=[],a=[];for(let e=0;e<this.symbolInstances.length;++e){a.push(e);var s=this.symbolInstances.get(e);i.push(0|Math.round(t*s.tileAnchorX+r*s.tileAnchorY)),n.push(s.featureIndex)}return a.sort((e,t)=>i[e]-i[t]||n[t]-n[e]),a}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach((e,t,r)=>{0<=e&&r.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)}),0<=t.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),0<=t.placedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),0<=t.verticalPlacedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Fi("SymbolBucket",uh,{omit:["layers","collisionBoxArray","features","compareText"]}),uh.MAX_GLYPHS=65535,uh.addDynamicAttributes=oh;var wr=new qn({"symbol-placement":new $n(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new $n(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $n(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jn(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $n(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $n(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $n(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new $n(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $n(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new jn(Be.layout_symbol["icon-size"]),"icon-text-fit":new $n(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $n(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new jn(Be.layout_symbol["icon-image"]),"icon-rotate":new jn(Be.layout_symbol["icon-rotate"]),"icon-padding":new $n(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new $n(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new jn(Be.layout_symbol["icon-offset"]),"icon-anchor":new jn(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $n(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $n(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $n(Be.layout_symbol["text-rotation-alignment"]),"text-field":new jn(Be.layout_symbol["text-field"]),"text-font":new jn(Be.layout_symbol["text-font"]),"text-size":new jn(Be.layout_symbol["text-size"]),"text-max-width":new jn(Be.layout_symbol["text-max-width"]),"text-line-height":new jn(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new jn(Be.layout_symbol["text-letter-spacing"]),"text-justify":new jn(Be.layout_symbol["text-justify"]),"text-radial-offset":new jn(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $n(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new jn(Be.layout_symbol["text-anchor"]),"text-max-angle":new $n(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new $n(Be.layout_symbol["text-writing-mode"]),"text-rotate":new jn(Be.layout_symbol["text-rotate"]),"text-padding":new $n(Be.layout_symbol["text-padding"]),"text-keep-upright":new $n(Be.layout_symbol["text-keep-upright"]),"text-transform":new jn(Be.layout_symbol["text-transform"]),"text-offset":new jn(Be.layout_symbol["text-offset"]),"text-allow-overlap":new $n(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $n(Be.layout_symbol["text-ignore-placement"]),"text-optional":new $n(Be.layout_symbol["text-optional"])}),dh={paint:new qn({"icon-opacity":new jn(Be.paint_symbol["icon-opacity"]),"icon-color":new jn(Be.paint_symbol["icon-color"]),"icon-halo-color":new jn(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new jn(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jn(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new $n(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new $n(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new jn(Be.paint_symbol["text-opacity"]),"text-color":new jn(Be.paint_symbol["text-color"],{runtimeType:qe,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new jn(Be.paint_symbol["text-halo-color"]),"text-halo-width":new jn(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new jn(Be.paint_symbol["text-halo-blur"]),"text-translate":new $n(Be.paint_symbol["text-translate"]),"text-translate-anchor":new $n(Be.paint_symbol["text-translate-anchor"])}),layout:wr};class ph{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:je,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fi("FormatSectionOverride",ph,{omit:["defaultValue"]});class fh extends hs{constructor(e){super(e,dh)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));t=this.layout.get("text-writing-mode");if(t){const e=[];for(const r of t)e.indexOf(r)<0&&e.push(r);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,i){const n=this.layout.get(e).evaluate(t,{},r,i),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Gr(a.value)||!n?n:(s=t.properties,n.replace(/{([^{}]+)}/g,(e,t)=>t in s?String(s[t]):""));var s}createBucket(e){return new uh(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of dh.paint.overridableProperties){var e,t,r;fh.hasPaintOverride(this.layout,i)&&(e=this.paint.get(i),r=new ph(e),t=new Ur(r,e.property.specification),r=null,r="constant"===e.value.kind||"source"===e.value.kind?new $r("source",t):new jr("composite",t,e.value.zoomStops,e.value._interpolationType),this.paint._values[i]=new Gn(e.property,r,e.parameters))}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&fh.hasPaintOverride(this.layout,e)}static hasPaintOverride(t,e){const r=t.get("text-field"),i=dh.paint.properties[e];let n=!1;const a=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(n=!0)};if("constant"===r.value.kind&&r.value.value instanceof ut)a(r.value.value.sections);else if("source"===r.value.kind){const t=e=>{n||(e instanceof _t&&mt(e.value)===Je?a(e.value.sections):e instanceof bt?a(e.sections):e.eachChild(t))},e=r.value;e._styleExpression&&t(e._styleExpression.expression)}return n}getProgramConfiguration(e){return new is(this,e)}}var mh={paint:new qn({"background-color":new $n(Be.paint_background["background-color"]),"background-pattern":new Wn(Be.paint_background["background-pattern"]),"background-opacity":new $n(Be.paint_background["background-opacity"])})},gh={paint:new qn({"raster-opacity":new $n(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new $n(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $n(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $n(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new $n(Be.paint_raster["raster-saturation"]),"raster-contrast":new $n(Be.paint_raster["raster-contrast"]),"raster-resampling":new $n(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new $n(Be.paint_raster["raster-fade-duration"])})};class _h extends hs{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var vh={paint:new qn({"sky-type":new $n(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new $n(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $n(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $n(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $n(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Zn(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $n(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $n(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $n(Be.paint_sky["sky-opacity"])})};function yh(e,t,r){var i=to(0,0,1),n=co(lo());return function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],t=Math.sin(r),r=Math.cos(r);e[0]=i*r-a*t,e[1]=n*r+s*t,e[2]=a*r+i*t,e[3]=s*r-n*t}(n,n,r?-C(e)+Math.PI:C(e)),ho(n,n,-C(t)),so(i,i,n),ao(i,i)}const xh={circle:class extends hs{constructor(e){super(e,qs)}createBucket(e){return new Os(e)}queryRadius(e){return $s("circle-radius",this,e)+$s("circle-stroke-width",this,e)+js(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,i,n,a,s,o){var l=Ws(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),r=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return po(e,i,a,s,o,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,r)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new is(this,e)}},heatmap:class extends hs{createBucket(e){return new go(e)}constructor(e){super(e,wo),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=To({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return $s("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,i,n,a,s,o){r=this.paint.get("heatmap-radius").evaluate(t,r);return po(e,i,a,s,o,!0,!0,new B(0,0),r)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new is(this,e)}},hillshade:class extends hs{constructor(e){super(e,Eo)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(e){return new is(this,e)}},fill:class extends hs{constructor(e){super(e,el)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(e){return new is(this,e)}recalculate(e,t){super.recalculate(e,t);t=this.paint._values["fill-outline-color"];"constant"===t.value.kind&&void 0===t.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Qo(e)}queryRadius(){return js(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,i,n,a){return!e.queryGeometry.isAboveHorizon&&Bs(Hs(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends hs{constructor(e){super(e,_l)}createBucket(e){return new gl(e)}queryRadius(){return js(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new is(this,e)}queryIntersectsFeature(e,t,r,i,n,a,s,o,l){const c=Ws(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(t,r),u=this.paint.get("fill-extrusion-base").evaluate(t,r),d=[0,0],p=o&&a.elevation,f=a.elevation?a.elevation.exaggeration():1;if(p){const v=e.tile.getBucket(this).centroidVertexArray,y=l+1;if(y<v.length){const e=v.get(y);d[0]=e.a_centroid_pos0,d[1]=e.a_centroid_pos1}}if(0===d[0]&&1===d[1])return!1;const m=(_=i,t=u,r=h,l=c,i=s,s=p?o:null,o=d,a=a.center.lat,s?function(e,t,r,i,n,a,s,o,l){const c=[],h=[],u=[0,0,0,1];for(const A of e){const e=[],C=[];for(const c of A){const h=c.x+i.x,L=c.y+i.y,P=(d=h,p=L,f=t,m=r,_=s,y=l,M=S=E=T=w=b=x=void 0,E=(v=o)*(g=a).getElevationAt(d,p,!0,!0),S=0!==_[0],M=S?0===_[1]?v*(_[0]/7-450):v*(x=g,b=_,w=y,T=Math.floor(b[0]/8),d=Math.floor(b[1]/8),p=10*(b[0]-8*T),M=10*(b[1]-8*d),v=x.getElevationAt(T,d,!0,!0),g=x.getMeterToDEM(w),_=Math.floor(.5*(p*g-1)),y=Math.floor(.5*(M*g-1)),b=x.tileCoordToPixel(T,d),w=2*_+1,T=2*y+1,d=x,x=b.x-_,_=b.y-y,b=w,y=T,b=[d.getElevationAtPixel(x,_,!0),d.getElevationAtPixel(x+y,_,!0),d.getElevationAtPixel(x,_+y,!0),d.getElevationAtPixel(x+b,_+y,!0)],_=Math.abs(b[0]-b[1]),y=Math.abs(b[2]-b[3]),b=Math.abs(b[0]-b[2])+Math.abs(b[1]-b[3]),w=Math.min(.25,.5*g*(_+y)/w),T=Math.min(.25,.5*g*b/T),v+Math.max(w*p,T*M)):E,{base:E+(0===f)?-1:f,top:S?Math.max(M+m,E+f+2):E+m});u[0]=h,u[1]=L,u[2]=P.base,u[3]=1,oo(u,u,n),u[3]=Math.max(u[3],1e-5);E=xl([u[0]/u[3],u[1]/u[3],u[2]/u[3]]);u[0]=h,u[1]=L,u[2]=P.top,u[3]=1,oo(u,u,n),u[3]=Math.max(u[3],1e-5);m=xl([u[0]/u[3],u[1]/u[3],u[2]/u[3]]);e.push(E),C.push(m)}c.push(e),h.push(C)}var d,p,f,m,g,_,v,y,x,b,w,T,E,S,M;return[c,h]}(_,t,r,l,i,s,o,f,a):function(e,t,r,i,n){const a=[],s=[],o=n[8]*t,l=n[9]*t,c=n[10]*t,h=n[11]*t,u=n[8]*r,d=n[9]*r,p=n[10]*r,f=n[11]*r;for(const t of e){const e=[],r=[];for(const a of t){const t=a.x+i.x,s=a.y+i.y,m=n[0]*t+n[4]*s+n[12],g=n[1]*t+n[5]*s+n[13],_=n[2]*t+n[6]*s+n[14],v=n[3]*t+n[7]*s+n[15],y=m+o,x=g+l,b=_+c,w=Math.max(v+h,1e-5),T=m+u,E=g+d,S=_+p,M=Math.max(v+f,1e-5),A=new B(y/w,x/w);A.z=b/w,e.push(A);const C=new B(T/M,E/M);C.z=S/M,r.push(C)}a.push(e),s.push(r)}return[a,s]}(_,t,r,l,i)),g=e.queryGeometry;var _;return function(t,r,i){let n=1/0;Bs(i,r)&&(n=yl(i,r[0]));for(let e=0;e<r.length;e++){var a=r[e],s=t[e];for(let e=0;e<a.length-1;e++){const r=a[e],o=[r,a[e+1],s[e+1],s[e],r];ks(i,o)&&(n=Math.min(n,yl(i,o)))}}return n!==1/0&&n}(m[0],m[1],g.isPointQuery()?g.screenBounds:g.screenGeometry)}},line:class extends hs{constructor(e){super(e,Cl),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Zt,this.gradientVersion=(this.gradientVersion+1)%r}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Ll.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Al(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new is(this,e)}queryRadius(e){var t=e,e=Pl($s("line-width",this,t),$s("line-gap-width",this,t)),t=$s("line-offset",this,t);return e/2+Math.abs(t)+js(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,i,n,a){if(e.queryGeometry.isAboveHorizon)return!1;var s=Hs(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Pl(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),r=this.paint.get("line-offset").evaluate(t,r);return function(t,r,i){for(let e=0;e<r.length;e++){var n=r[e];if(3<=t.length)for(let e=0;e<n.length;e++)if(Gs(t,n[e]))return!0;if(function(t,r,i){if(1<t.length){if(Fs(t,r))return 1;for(let e=0;e<r.length;e++)if(zs(r[e],t,i))return 1}for(let e=0;e<t.length;e++)if(zs(t[e],r,i))return 1}(t,n,i))return!0}return!1}(s,i=r?function(t,r){const i=[],n=new B(0,0);for(let e=0;e<t.length;e++){const a=t[e],s=[];for(let e=0;e<a.length;e++){const i=a[e-1],B=a[e],o=a[e+1],l=0===e?n:B.sub(i)._unit()._perp(),c=e===a.length-1?n:o.sub(B)._unit()._perp(),h=l._add(c)._unit();h._mult(1/(h.x*c.x+h.y*c.y)),s.push(h._mult(r)._add(B))}i.push(s)}return i}(i,r*e.pixelToTileUnitsFactor):i,a)}isTileClipped(){return!0}},symbol:fh,background:class extends hs{constructor(e){super(e,mh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends hs{constructor(e){super(e,gh)}getProgramIds(){return["raster"]}},sky:class extends hs{constructor(e){super(e,vh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=To({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){e=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(e,t){const r=this.paint.get("sky-type");if("atmosphere"===r){const r=this.paint.get("sky-atmosphere-sun"),i=!r,n=e.style.light,a=n.properties.get("position");return i&&"viewport"===n.properties.get("anchor")&&V("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?yh(a.azimuthal,90-a.polar,t):yh(r[0],90-r[1],t)}if("gradient"===r){const e=this.paint.get("sky-gradient-center");return yh(e[0],90-e[1],t)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){var e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}},{HTMLImageElement:bh,HTMLCanvasElement:wh,HTMLVideoElement:Th,ImageData:Eh,ImageBitmap:Sh}=u;class Mh{constructor(e,t,r,i){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,r){const{width:i,height:n}=e,a=this["context"],s=a["gl"];if(s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),r||this.size&&this.size[0]===i&&this.size[1]===n){const{x:t,y:a}=r||{x:0,y:0};e instanceof bh||e instanceof wh||e instanceof Th||e instanceof Eh||Sh&&e instanceof Sh?s.texSubImage2D(s.TEXTURE_2D,0,t,a,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,t,a,i,n,s.RGBA,s.UNSIGNED_BYTE,e.data)}else this.size=[i,n],e instanceof bh||e instanceof wh||e instanceof Th||e instanceof Eh||Sh&&e instanceof Sh?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,i,n,0,this.format,s.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t){const r=this["context"],i=r["gl"];i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const e=this.context["gl"];e.deleteTexture(this.texture),this.texture=null}}class Ah{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new xo({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){t=this.getKey(e,t);return this.positions[t]}trim(){var e=this.width,t=this.height=_(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(t,e,r){const i=[];let n=t.length%2==1?-t[t.length-1]*r:0,a=t[0]*r,s=!0;i.push({left:n,right:a,isDash:s,zeroLength:0===t[0]});let o=t[0];for(let e=1;e<t.length;e++){s=!s;var l=t[e];n=o*r,o+=l,a=o*r,i.push({left:n,right:a,isDash:s,zeroLength:0===l})}return i}addRoundDash(a,e,s){var o=e/2;for(let n=-s;n<=s;n++){var l=this.width*(this.nextRow+s+n);let r=0,i=a[r];for(let t=0;t<this.width;t++){1<t/i.right&&(i=a[++r]);var c=Math.abs(t-i.left),h=Math.abs(t-i.right),c=Math.min(c,h);let e;h=n/s*(1+o);if(i.isDash){const a=o-Math.abs(h);e=Math.sqrt(c*c+a*a)}else e=o-Math.sqrt(c*c+h*h);this.image.data[l+t]=Math.max(0,Math.min(255,e+128))}}}addRegularDash(t,r){for(let e=t.length-1;0<=e;--e){const i=t[e],n=t[e+1];i.zeroLength?t.splice(e,1):n&&n.isDash===i.isDash&&(n.left=i.left,t.splice(e,1))}const i=t[0],n=t[t.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);var a=this.width*this.nextRow;let s=0,o=t[s];for(let e=0;e<this.width;e++){1<e/o.right&&(o=t[++s]);const n=Math.abs(e-o.left),l=Math.abs(e-o.right),c=Math.min(n,l);this.image.data[a+e]=Math.max(0,Math.min(255,(o.isDash?c:-c)+r+128))}}addDash(t,e){const r=this.getKey(t,e);if(this.positions[r])return this.positions[r];const i="round"===e,n=i?7:0,a=2*n+1;if(this.nextRow+a>this.height)return V("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let e=0;e<t.length;e++)t[e]<0&&(V("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),s+=t[e];if(0!==s){const r=this.width/s,a=this.getDashRanges(t,this.width,r);i?this.addRoundDash(a,r,n):this.addRegularDash(a,"square"===e?.5*r:0)}e=this.nextRow+n;this.nextRow+=a;e={tl:[e,n],br:[s,0]};return this.positions[r]=e}}Fi("LineAtlas",Ah);class Ch{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Lh=u.performance;function Ph(e){e=e?e.url.toString():void 0;return Lh.getEntriesByName(e)}class Ih{constructor(){this.tasks={},this.taskQueue=[],b(["process"],this),this.invoker=new Ch(this.process),this.nextId=0}add(e,t){const r=this.nextId++,i=([{type:n,isSymbolTile:a,zoom:s}]=[t],s=s||0,"message"===n?0:"maybePrepare"!==n||a?"parseTile"!==n||a?"parseTile"===n&&a?300-s:"maybePrepare"===n&&a?400-s:500:200-s:100-s);var n,a,s;return 0==i?(I(),e(),{cancel:()=>{}}):(this.tasks[r]={fn:e,metadata:t,priority:i,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}})}process(){I();{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;var e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}}pick(){let t=null,r=1/0;for(let e=0;e<this.taskQueue.length;e++){var i=this.tasks[this.taskQueue[e]];i.priority<r&&(r=i.priority,t=e)}if(null===t)return null;var e=this.taskQueue[t];return this.taskQueue.splice(t,1),e}remove(){this.invoker.remove()}}function Rh(e,h){var t=Math.pow(2,-e.z),r=e.x*t,i=(e.x+1)*t,n=e.y*t,a=(e.y+1)*t;if("mercator"===h.name)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:h};var s=Ts(r),o=Ts(i),l=Es(n),c=Es(a),e=h.project(s,l),l=h.project(o,l),o=h.project(o,c),c=h.project(s,c);let u=Math.min(e.x,l.x,o.x,c.x),d=Math.min(e.y,l.y,o.y,c.y),p=Math.max(e.x,l.x,o.x,c.x),f=Math.max(e.y,l.y,o.y,c.y);const m=t/16;function g(e,t,r,i,n,a){var s=(r+n)/2,o=(i+a)/2,l=h.project(Ts(s),Es(o)),c=Math.max(0,u-l.x,d-l.y,l.x-p,l.y-f);u=Math.min(u,l.x),p=Math.max(p,l.x),d=Math.min(d,l.y),f=Math.max(f,l.y),c>m&&(g(e,l,r,i,s,o),g(l,t,s,o,n,a))}g(e,l,r,n,i,n),g(l,o,i,n,i,a),g(o,c,i,a,r,a),g(c,e,r,a,r,n),u-=m,d-=m,p+=m,f+=m;n=1/Math.max(p-u,f-d);return{scale:n,x:u*n,y:d*n,x2:p*n,y2:f*n,projection:h}}function Dh(e,t,r){r=2*Math.PI*6378137/256/Math.pow(2,r);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class Oh{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Fh(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){var r,i,n,n=(i=this.y,a=this.z,n=Dh(256*(r=this.x),256*(i=Math.pow(2,a)-i-1),a),a=Dh(256*(r+1),256*(1+i),a),n[0]+","+n[1]+","+a[0]+","+a[1]),a=function(t,r,i){let n,a="";for(let e=t;0<e;e--)n=1<<e-1,a+=(r&n?1:0)+(i&n?2:0);return a}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Fh(e,t.z,t.z,t.x,t.y)}}class Bh{constructor(e,t,r,i,n){this.overscaledZ=e,this.wrap=t,this.canonical=new Oh(r,+i,+n),this.key=0===t&&e===r?this.canonical.key:Fh(t,e,r,i,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){var t=this.canonical.z-e;return e>this.canonical.z?new Bh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Fh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);var r=this.canonical.z-e;return Fh(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}isChildOf(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Bh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,e=2*this.canonical.y;return[new Bh(t,this.wrap,t,r,e),new Bh(t,this.wrap,t,1+r,e),new Bh(t,this.wrap,t,r,1+e),new Bh(t,this.wrap,t,1+r,1+e)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Bh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Bh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Fh(e,t,r,i,n){var a=1<<Math.min(r,22);let s=n%a*a+i%a;return e&&r<22&&(s+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*s+r)+(t-r)}Fi("CanonicalTileID",Oh),Fi("OverscaledTileID",Bh,{omit:["projMatrix"]});class zh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Nh{constructor(e,t,r,i,n){this.type="Feature",(this._vectorTileFeature=e)._z=t,e._x=r,e._y=i,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}br=Qn([{name:"a_pos",type:"Int16",components:2}]);const Uh=new Uint16Array(8184);for(let o=0;o<2046;o++){let e=o+2,t=0,r=0,i=0,n=0,a=0,s=0;for(1&e?i=n=a=32:t=r=s=32;1<(e>>=1);){const l=t+i>>1,c=r+n>>1;1&e?(i=t,n=r,t=a,r=s):(t=i,r=n,i=a,n=s),a=l,s=c}const c=4*o;Uh[0+c]=t,Uh[1+c]=r,Uh[2+c]=i,Uh[3+c]=n}const Gh=new Uint16Array(2178),Vh=new Uint8Array(1089),$h=new Uint16Array(1089);function jh(e){return 0===e?-.03125:32===e?.03125:0}var Hh=Qn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Wh={type:2,extent:fs,loadGeometry:()=>[[new B(0,0),new B(8193,0),new B(8193,8193),new B(0,8193),new B(0,0)]]};class Zh{constructor(e,t,r,i,n){this.tileID=e,this.uid=f++,this.uses=0,this.tileSize=t,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(e){e+=this.timeAdded;e<U.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Rh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const r={};if(!t)return r;for(const i of e){const e=i.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)r[t.id]=i}}return r}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof uh){if(this.hasSymbolBuckets=!0,!r)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof uh&&t.hasRTLText){this.hasRTLText=!0,Dn.isLoading()||Dn.isLoaded()||"deferred"!==Mn||In();break}}this.queryPadding=0;for(const e in this.buckets){const r=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(r))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ea}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const r=this.buckets[t];r.uploadPending()&&r.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mh(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mh(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Mh(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,r,i,n,a,s,o){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:s,transform:a,params:n,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(t,e){const r=this.latestFeatureIndex;if(r&&r.rawTileData){const i=r.loadVTLayers(),n=e?e.sourceLayer:"",a=i._geojsonTileLayer||i[n];if(a){const s=ei(e&&e.filter),{z:o,x:l,y:c}=this.tileID.canonical,h={z:o,x:l,y:c};for(let e=0;e<a.length;e++){const i=a.feature(e);if(s.needGeometry){const t=Rs(i,!0);if(!s.filter(new On(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new On(this.tileID.overscaledZ),i))continue;const u=r.getId(i,n),d=new Nh(i,o,l,c,u);d.tile=h,t.push(d)}}}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const r=R(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;var i;this.expirationTime>t?e=!1:r&&!(this.expirationTime<r)&&(i=this.expirationTime-r)?this.expirationTime=t+Math.max(i,3e4):e=!0,e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t){var r=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages();for(const n in this.buckets)if(t.style.hasLayer(n)){const a=this.buckets[n],s=a.layers[0].sourceLayer||"_geojsonTileLayer",o=r[s],l=e[s];if(o&&l&&0!==Object.keys(l).length){if(a.update(l,o,i,this.imageAtlas&&this.imageAtlas.patternPositions||{}),a instanceof Al||a instanceof Qo){const e=t.style._getSourceCache(a.layers[0].source);t._terrain&&t._terrain.enabled&&e&&a.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const c=t&&t.style&&t.style.getLayer(n);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(a)))}}}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<U.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=U.now()+e}setDependencies(e,t){const r={};for(const e of t)r[e]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(t&&"mercator"!==t.name&&!this._tileDebugBuffer){const r=Is(Wh,this.tileID.canonical,this.tileTransform)[0],i=new ta,n=new xa;for(let e=0;e<r.length;e++){const{x:t,y:a}=r[e];i.emplaceBack(t,a),n.emplaceBack(e)}n.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(n),this._tileDebugBuffer=e.createVertexBuffer(i,Hh.members),this._tileDebugSegments=ps.simpleSegment(0,0,i.length,n.length)}}_makeTileBoundsBuffers(r,i){if(!this._tileBoundsBuffer&&i&&"mercator"!==i.name){var n=Is(Wh,this.tileID.canonical,this.tileTransform)[0];let e,t;if(this.isRaster){const r=function(r,i){const n=Rh(r,i),a=Math.pow(2,r.z);for(let t=0;t<33;t++)for(let e=0;e<33;e++){const o=Ts((r.x+(e+jh(e))/32)/a),c=Es((r.y+(t+jh(t))/32)/a),h=i.project(o,c),u=33*t+e;Gh[2*u+0]=Math.round((h.x*n.scale-n.x)*fs),Gh[2*u+1]=Math.round((h.y*n.scale-n.y)*fs)}Vh.fill(0),$h.fill(0);for(let e=2045;0<=e;e--){const i=4*e,n=Uh[0+i],a=Uh[1+i],s=Uh[2+i],l=Uh[3+i],o=n+s>>1,c=a+l>>1,h=o+c-a,t=c+n-o,d=33*a+n,p=33*l+s,f=33*c+o,m=16<=Math.hypot((Gh[2*d+0]+Gh[2*p+0])/2-Gh[2*f+0],(Gh[2*d+1]+Gh[2*p+1])/2-Gh[2*f+1]);if(Vh[f]=Vh[f]||(m?1:0),e<1022){const r=33*(a+t>>1)+(n+h>>1),i=33*(l+t>>1)+(s+h>>1);Vh[f]=Vh[f]||Vh[r]||Vh[i]}}const s=new ra,l=new pa;let o=0;function c(e,t){var r=33*t+e;return 0===$h[r]&&(s.emplaceBack(Gh[2*r+0],Gh[2*r+1],e*fs/32,t*fs/32),$h[r]=++o),$h[r]-1}function h(e,t,r,i,n,a){const s=e+r>>1,o=t+i>>1;if(1<Math.abs(e-n)+Math.abs(t-a)&&Vh[33*o+s])h(n,a,e,t,s,o),h(r,i,n,a,s,o);else{const h=c(e,t),s=c(r,i),o=c(n,a);l.emplaceBack(h,s,o)}}return h(0,0,32,32,32,0),h(32,32,0,0,0,32),{vertices:s,indices:l}}(this.tileID.canonical,i);e=r.vertices,t=r.indices}else{e=new ra,t=new pa;for(const{x:r,y:i}of n)e.emplaceBack(r,i,0,0);const r=Ao(e.int16,void 0,4);for(let e=0;e<r.length;e+=3)t.emplaceBack(r[e],r[e+1],r[e+2])}this._tileBoundsBuffer=r.createVertexBuffer(e,Hh.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(t),this._tileBoundsSegments=ps.simpleSegment(0,0,e.length,t.length)}}}class qh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){var i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},y(this.stateChanges[e][i],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])r[t]||(this.deletedStates[e][i][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][t]&&delete this.deletedStates[e][i][t]}removeFeatureState(e,t,r){if(null!==this.deletedStates[e]){var i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(r in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][r]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}}getState(e,t){const r=String(t),i=y({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const r=this.deletedStates[e][t];if(null===r)return{};for(const e in r)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),y(this.state[e][r],this.stateChanges[e][r]),t[r]=this.state[e][r];r[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const r in this.state[e])t[r]={},this.state[e][r]={};else for(const r in this.deletedStates[e]){if(null===this.deletedStates[e][r])this.state[e][r]={};else for(const t of Object.keys(this.deletedStates[e][r]))delete this.state[e][r][t];t[r]=this.state[e][r]}r[e]=r[e]||{},y(r[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const i in e)e[i].setFeatureState(r,t)}}class Xh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){t=this.toIdx(e,t);return{min:this.minimums[t],max:this.maximums[t]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Yh(i,n,a,s){let o=0,l=Number.MAX_VALUE;for(let r=0;r<3;r++)if(Math.abs(s[r])<1e-15){if(a[r]<i[r]||a[r]>n[r])return null}else{var c=1/s[r];let e=(i[r]-a[r])*c,t=(n[r]-a[r])*c;if(e>t){const i=e;e=t,t=i}if(e>o&&(o=e),t<l&&(l=t),o>l)return null}return o}function Kh(e,t,r,i,n,a,s,o,l,c,h){var u=i-e,d=n-t,p=a-r,f=s-e,i=o-t,n=l-r,a=h[1]*n-h[2]*i,s=h[2]*f-h[0]*n,o=h[0]*i-h[1]*f,l=u*a+d*s+p*o;if(Math.abs(l)<1e-15)return null;l=1/l,e=c[0]-e,t=c[1]-t,r=c[2]-r,s=(e*a+t*s+r*o)*l;if(s<0||1<s)return null;o=t*p-r*d,p=r*u-e*p,u=e*d-t*u,h=(h[0]*o+h[1]*p+h[2]*u)*l;return h<0||1<s+h?null:(f*o+i*p+n*u)*l}function Jh(e,t,r){return(e-t)/(r-t)}function Qh(e,t,r,i,n,a,s,o,l){var c=1<<r,h=a-i,r=s-n,a=(e+1)/c*h+i,s=(t+0)/c*r+n,n=(t+1)/c*r+n;o[0]=(e+0)/c*h+i,o[1]=s,l[0]=a,l[1]=n}class eu{constructor(e){var t,r;this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],this.dem&&(e=(t=function(t){const e=Math.ceil(Math.log2(t.dim/8)),r=[];let i=Math.ceil(Math.pow(2,e));const n=1/i,a=(e,t,r,i,n)=>{var a=i?1:0,s=(e+1)*r-a,i=t*r,a=(t+1)*r-a;n[0]=e*r,n[1]=i,n[2]=s,n[3]=a};let s=new Xh(i);var o=[];for(let e=0;e<i*i;e++){a(e%i,Math.floor(e/i),n,!1,o);const r=ru(o[0],o[1],t),l=ru(o[2],o[1],t),c=ru(o[2],o[3],t),h=ru(o[0],o[3],t);s.minimums.push(Math.min(r,l,c,h)),s.maximums.push(Math.max(r,l,c,h)),s.leaves.push(1)}for(r.push(s),i/=2;1<=i;i/=2){const t=r[r.length-1];s=new Xh(i);for(let e=0;e<i*i;e++){a(e%i,Math.floor(e/i),2,!0,o);const r=t.getElevation(o[0],o[1]),n=t.getElevation(o[2],o[1]),u=t.getElevation(o[2],o[3]),d=t.getElevation(o[0],o[3]),p=t.isLeaf(o[0],o[1]),f=t.isLeaf(o[2],o[1]),m=t.isLeaf(o[2],o[3]),g=t.isLeaf(o[0],o[3]),_=Math.min(r.min,n.min,u.min,d.min),v=Math.max(r.max,n.max,u.max,d.max),y=p&&f&&m&&g;s.maximums.push(v),s.minimums.push(_),s.leaves.push(v-_<=5&&y?1:0)}r.push(s)}return r}(this.dem))[r=t.length-1],this._addNode(e.minimums[0],e.maximums[0],e.leaves[0]),this._construct(t,0,0,r,0))}raycastRoot(e,t,r,i,n,a,s=1){return Yh([e,t,-100],[r,i,this.maximums[0]*s],n,a)}raycast(n,t,e,a,s,o,l=1){if(!this.nodeCount)return null;const c=this.raycastRoot(n,t,e,a,s,o,l);if(null==c)return null;const h=[],u=[],d=[],p=[],r=[{idx:0,t:c,nodex:0,nodey:0,depth:0}];for(;0<r.length;){const{idx:c,t:i,nodex:m,nodey:g,depth:_}=r.pop();if(this.leaves[c]){Qh(m,g,_,n,t,e,a,d,p);const c=1<<_,h=(m+0)/c,u=(m+1)/c,r=(g+0)/c,v=(g+1)/c,y=ru(h,r,this.dem)*l,x=ru(u,r,this.dem)*l,b=ru(u,v,this.dem)*l,w=ru(h,v,this.dem)*l,T=Kh(d[0],d[1],y,p[0],d[1],x,p[0],p[1],b,s,o),E=Kh(p[0],p[1],b,d[0],p[1],w,d[0],d[1],y,s,o),S=Math.min(null!==T?T:Number.MAX_VALUE,null!==E?E:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const n=no([],s,o,i);if(tu(y,x,w,b,Jh(n[0],d[0],p[0]),Jh(n[1],d[1],p[1]))>=n[2])return i}}else{let i=0;for(let r=0;r<this._siblingOffset.length;r++){Qh((m<<1)+this._siblingOffset[r][0],(g<<1)+this._siblingOffset[r][1],_+1,n,t,e,a,d,p),d[2]=-100,p[2]=this.maximums[this.childOffsets[c]+r]*l;var f=Yh(d,p,s,o);if(null!=f){const n=f;h[r]=n;let t=!1;for(let e=0;e<i&&!t;e++)n>=h[u[e]]&&(u.splice(e,0,r),t=!0);t||(u[i]=r),i++}}for(let e=0;e<i;e++){const t=u[e];r.push({idx:this.childOffsets[c]+t,t:h[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(g<<1)+this._siblingOffset[t][1],depth:_+1})}}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(i,n,a,s,o){if(1!==i[s].isLeaf(n,a)){this.childOffsets[o]||(this.childOffsets[o]=this.nodeCount);const l=s-1,c=i[l];let t,r=0;for(let e=0;e<this._siblingOffset.length;e++){const s=2*n+this._siblingOffset[e][0],o=2*a+this._siblingOffset[e][1],l=c.getElevation(s,o),h=c.isLeaf(s,o),u=this._addNode(l.min,l.max,h);h&&(r|=1<<e),t=t||u}for(let e=0;e<this._siblingOffset.length;e++)r&1<<e||this._construct(i,2*n+this._siblingOffset[e][0],2*a+this._siblingOffset[e][1],l,t+e)}}}function tu(e,t,r,i,n,a){return qt(qt(e,r,a),qt(t,i,a),n)}function ru(e,t,r){var i=r.dim,n=S(e*i-.5,0,i-1),a=S(t*i-.5,0,i-1),s=Math.floor(n),e=Math.floor(a),t=Math.min(s+1,i-1),i=Math.min(e+1,i-1);return tu(r.get(s,e),r.get(t,e),r.get(s,i),r.get(t,i),n-s,a-e)}const iu={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class nu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r,i=!1,n=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return V(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;var a=this.dim=t.height-2;if(this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox",!(this.borderReady=i)){for(let e=0;e<a;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(a,e)]=this.data[this._idx(a-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,a)]=this.data[this._idx(e,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],n&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new eu(this)}get(e,t,r=!1){var i=new Uint8Array(this.data.buffer);r&&(e=S(e,-1,this.dim),t=S(t,-1,this.dim));t=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[t],i[1+t],i[2+t])}static getUnpackVector(e){return iu[e]}get unpackVector(){return iu[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,r){return(256*e*256+256*t+r)/10-1e4}_unpackTerrarium(e,t,r){return 256*e+t+r/256-32768}static pack(e,t){const r=[0,0,0,0],i=nu.getUnpackVector(t);e=Math.floor((e+i[3])/i[2]);return r[2]=e%256,e=Math.floor(e/256),r[1]=e%256,e=Math.floor(e/256),r[0]=e,r}getPixels(){return new bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,e,t){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,n=e*this.dim+this.dim,a=t*this.dim,s=t*this.dim+this.dim;switch(e){case-1:i=n-1;break;case 1:n=i+1}switch(t){case-1:a=s-1;break;case 1:s=a+1}var o=-e*this.dim,l=-t*this.dim;for(let t=a;t<s;t++)for(let e=i;e<n;e++)this.data[this._idx(e,t)]=r.data[this._idx(e+o,t+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Fi("DEMData",nu),Fi("DemMinMaxQuadTree",eu,{omit:["dem"]});class au{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){var i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const n={value:t,timeout:void 0};if(void 0!==r&&(n.timeout=setTimeout(()=>{this.remove(e,n)},r)),this.data[i].push(n),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){e=this.data[e];return e?e[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;var r=e.wrapped().key,e=void 0===t?0:this.data[r].indexOf(t),t=this.data[r][e];return this.data[r].splice(e,1),t.timeout&&clearTimeout(t.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(t.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const i of this.data[r])e(i.value)||t.push(i);for(const e of t)this.remove(e.value.tileID,e)}}class su{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}su.ReadOnly=!1,su.ReadWrite=!0,su.disabled=new su(519,su.ReadOnly,[0,1]);class ou{constructor(e,t,r,i,n,a){this.test=e,this.ref=t,this.mask=r,this.fail=i,this.depthFail=n,this.pass=a}}ou.disabled=new ou({func:519,mask:0},0,0,7680,7680,7680);class lu{constructor(e,t,r){this.blendFunction=e,this.blendColor=t,this.mask=r}}lu.disabled=new lu(lu.Replace=[1,0],lt.transparent,[!1,!1,!1,!1]),lu.unblended=new lu(lu.Replace,lt.transparent,[!0,!0,!0,!0]),lu.alphaBlended=new lu([1,771],lt.transparent,[!0,!0,!0,!0]);class cu{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}cu.disabled=new cu(!1,1029,2305),cu.backCCW=new cu(!0,1029,2305),cu.backCW=new cu(!0,1029,2304),cu.frontCW=new cu(!0,1028,2304),cu.frontCCW=new cu(!0,1028,2305);class hu extends ke{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new au(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qh}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){var e;this._paused&&(e=this._shouldReloadOnResume,this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform))}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return v(this._tiles).map(e=>e.tileID).sort(uu).map(e=>e.key)}getRenderableIds(e){const t=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&t.push(this._tiles[r]);return e?t.sort((e,t)=>{var r=e.tileID,i=t.tileID,e=new B(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),t=new B(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-i.overscaledZ||t.y-e.y||t.x-e.x}).map(e=>e.tileID.key):t.map(e=>e.tileID).sort(uu).map(e=>e.key)}hasRenderableParent(e){e=this.findLoadedParent(e,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(e,t,r,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new Oe(i,{tile:e})):this.update(this.transform));e.timeAdded=U.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new De("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let e=0;e<r.length;e++){var i=r[e];if(t.neighboringTiles&&t.neighboringTiles[i]){const r=this.getTileByID(i);n(t,r),n(r,t)}}function n(t,r){if(t.dem&&!t.dem.borderReady){t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let e=r.tileID.canonical.x-t.tileID.canonical.x;var i=r.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),a=r.tileID.key;0===e&&0==i||1<Math.abs(i)||(1<Math.abs(e)&&(1===Math.abs(e+n)?e+=n:1===Math.abs(e-n)&&(e-=n)),r.dem&&t.dem&&(t.dem.backfillBorder(r.dem,e,i),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(i,n,e,a){for(const t in this._tiles){let r=this._tiles[t];if(!(a[t]||!r.hasData()||r.tileID.overscaledZ<=n||r.tileID.overscaledZ>e)){let e=r.tileID;for(;r&&r.tileID.overscaledZ>n+1;){const i=r.tileID.scaledTo(r.tileID.overscaledZ-1);r=this._tiles[i.key],r&&r.hasData()&&(e=i)}let t=e;for(;t.overscaledZ>n;)if(t=t.scaledTo(t.overscaledZ-1),i[t.key]){a[e.key]=e;break}}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){var e=this._loadedParentTiles[t.key];return e&&e.tileID.overscaledZ>=r?e:null}for(let e=t.overscaledZ-1;e>=r;e--){const r=t.scaledTo(e),i=this._getLoadedTile(r);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey((this._source.reparseOverscaled?e.wrapped():e.canonical).key)}updateCacheSize(e,t){t=t||this._source.tileSize;var r=Math.ceil(e.width/t)+1,t=Math.ceil(e.height/t)+1,t=Math.floor(r*t*5),t="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,t):t;this._cache.setMaxSize(t)}handleWrapJump(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,r,i){if(this.transform=t,this._sourceLoaded&&!this._paused&&!this.transform.freezeTileCoverage&&(!this.usedForTerrain||i)){let e;this.updateCacheSize(t,r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?e=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(e=>new Bh(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)):(e=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(e=e.filter(e=>this._source.hasTile(e)))):e=[];const a=this._updateRetainedTiles(e);if(du(this._source.type)&&0!==e.length){const t={},r={},i=Object.keys(a);for(const e of i){const i=a[e],s=this._tiles[e];var n;!s||s.fadeEndTime&&s.fadeEndTime<=U.now()||((n=this.findLoadedParent(i,Math.max(i.overscaledZ-hu.maxOverzooming,this._source.minzoom)))&&(this._addTile(n.tileID),t[n.tileID.key]=n.tileID),r[e]=i)}const s=e[e.length-1].overscaledZ;for(const t in this._tiles){const i=this._tiles[t];if(!a[t]&&i.hasData()){let e=i.tileID;for(;e.overscaledZ>s;){e=e.scaledTo(e.overscaledZ-1);const s=this._tiles[e.key];if(s&&s.hasData()&&r[e.key]){a[t]=i.tileID;break}}}}for(const r in t)a[r]||(this._coveredTiles[r]=!0,a[r]=t[r])}for(const t in a)this._tiles[t].clearFadeHold();const s=function(e,t){const r=[];for(const i in e)i in t||r.push(i);return r}(this._tiles,a);for(const t of s){const r=this._tiles[t];r.hasSymbolBuckets&&!r.holdingForFade()?r.setHoldDuration(this.map._fadeDuration):r.hasSymbolBuckets&&!r.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const n={},a=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),t=e[0].overscaledZ,s=Math.max(t-hu.maxOverzooming,this._source.minzoom),r=Math.max(t+hu.maxUnderzooming,this._source.minzoom),o={};for(const n of e){const e=this._addTile(n);i[n.key]=n,e.hasData()||a<this._source.maxzoom&&(o[n.key]=n)}this._retainLoadedChildren(o,a,r,i);for(const a of e){let r=this._tiles[a.key];if(!r.hasData()){if(a.canonical.z>=this._source.maxzoom){const e=a.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){i[e.key]=e;continue}}else{const e=a.children(this._source.maxzoom);if(i[e[0].key]&&i[e[1].key]&&i[e[2].key]&&i[e[3].key])continue}let t=r.wasRequested();for(let e=a.overscaledZ-1;e>=s;--e){const s=a.scaledTo(e);if(n[s.key])break;if(n[s.key]=!0,r=this.getTile(s),!r&&t&&(r=this._addTile(s)),r&&(i[s.key]=s,t=r.wasRequested(),r.hasData()))break}}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const n=[];let e,t=this._tiles[i].tileID;for(;0<t.overscaledZ;){if(t.key in this._loadedParentTiles){e=this._loadedParentTiles[t.key];break}n.push(t.key);var r=t.scaledTo(t.overscaledZ-1);if(e=this._getLoadedTile(r),e)break;t=r}for(const a of n)this._loadedParentTiles[a]=e}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const r=Boolean(t);if(!r){const r=this.map?this.map.painter:null;t=new Zh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,r,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,r||this._source.fire(new De("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);t=t.getExpiryTimeout();t&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},t))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),0<t.uses||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,t,r){const i=[],n=this.transform;if(!n)return i;for(const s in this._tiles){const o=this._tiles[s];var a;r&&o.clearQueryDebugViz(),o.holdingForFade()||(a=e.containsTile(o,n,t))&&i.push(a)}return i}getVisibleCoordinates(e){e=this.getRenderableIds(e).map(e=>this._tiles[e].tileID);for(const t of e)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(du(this._source.type))for(const t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=U.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const i=this._tiles[e];i&&i.setDependencies(t,r)}reloadTilesForDependencies(t,r){for(const e in this._tiles)this._tiles[e].hasDependency(t,r)&&this._reloadTile(+e,"reloading");this._cache.filter(e=>!e.hasDependency(t,r))}}function uu(e,t){var r=Math.abs(2*e.wrap)-(e.wrap<0),i=Math.abs(2*t.wrap)-(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function du(e){return"raster"===e||"image"===e||"video"===e}hu.maxOverzooming=10,hu.maxUnderzooming=3;class pu{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){var i=r||e.findDEMTileFor(t);if(i&&i.dem){var n=i.dem,r=i.tileID,e=1<<t.canonical.z-r.canonical.z;return new pu(i,i.tileSize/fs/e,[(t.canonical.x/e-r.canonical.x)*n.dim,(t.canonical.y/e-r.canonical.y)*n.dim])}}tileCoordToPixel(e,t){t=t*this._scale+this._offset[1],e=Math.floor(e*this._scale+this._offset[0]),t=Math.floor(t);return new B(e,t)}getElevationAt(e,t,r,i){const n=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],s=Math.floor(n),o=Math.floor(a),l=this._dem;return i=!!i,r?qt(qt(l.get(s,o,i),l.get(s,o+1,i),a-o),qt(l.get(s+1,o,i),l.get(s+1,o+1,i),a-o),n-s):l.get(s,o,i)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ws(1,e)*this._dem.stride}}class fu{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ri(fs,16,0),this.featureIndexArray=new Ra,this.promoteId=t}insert(e,t,r,i,n,a=0){var s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,n,a);const o=this.grid;for(let e=0;e<t.length;e++){const r=t[e],i=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){const t=r[e];i[0]=Math.min(i[0],t.x),i[1]=Math.min(i[1],t.y),i[2]=Math.max(i[2],t.x),i[3]=Math.max(i[3],t.y)}i[0]<fs&&i[1]<fs&&0<=i[2]&&0<=i[3]&&o.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ul.VectorTile(new Hl(this.rawTileData)).layers,this.sourceLayerCoder=new zh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(a,t,r,i){this.loadVTLayers();const s=a.params||{},o=ei(s.filter),l=a.tileResult,e=a.transform,c=l.bufferedTilespaceBounds,n=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(e,t,r,i)=>Vs(l.bufferedTilespaceGeometry,e,t,r,i));n.sort(gu);let h=null;e.elevation&&0<n.length&&(h=pu.create(e.elevation,this.tileID));var u={};let d;for(let e=0;e<n.length;e++){const c=n[e];if(c!==d){d=c;var p=this.featureIndexArray.get(c);let n=null;this.loadMatchingFeature(u,p,o,s.layers,s.availableImages,t,r,i,(e,t,r,i=0)=>(n=n||Is(e,this.tileID.canonical,a.tileTransform),t.queryIntersectsFeature(l,e,r,n,this.z,a.transform,a.pixelPosMatrix,h,i)))}}return u}loadMatchingFeature(t,e,r,i,n,a,s,o,l){const{featureIndex:c,bucketIndex:h,sourceLayerIndex:u,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[h];if(!i||function(t,r){for(let e=0;e<t.length;e++)if(0<=r.indexOf(t[e]))return 1}(i,p)){const g=this.sourceLayerCoder.decode(u),_=this.vtLayers[g].feature(c);if(r.needGeometry){const t=Rs(_,!0);if(!r.filter(new On(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new On(this.tileID.overscaledZ),_))return;var f=this.getId(_,g);for(let e=0;e<p.length;e++){const r=p[e];if(!(i&&i.indexOf(r)<0)){const h=a[r];if(h){let e={};void 0!==f&&o&&(e=o.getState(h.sourceLayer||"_geojsonTileLayer",f));const g=y({},s[r]);g.paint=mu(g.paint,h.paint,_,e,n),g.layout=mu(g.layout,h.layout,_,e,n);var m=!l||l(_,h,e,d);if(m){const v=new Nh(_,this.z,this.x,this.y,f);v.layer=g;let e=t[r];void 0===e&&(e=t[r]=[]),e.push({featureIndex:c,feature:v,intersectionZ:m})}}}}}}lookupSymbolFeatures(e,t,r,i,n,a,s,o){var l={};this.loadVTLayers();var c=ei(n);for(const n of e)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:i,featureIndex:n,layoutVertexArrayOffset:0},c,a,s,o,t);return l}loadFeature(e){var{featureIndex:t,sourceLayerIndex:e}=e;this.loadVTLayers();const r=this.sourceLayerCoder.decode(e),i=this.vtFeatures[r];if(i[t])return i[t];e=this.vtLayers[r].feature(t);return i[t]=e}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof r&&(r=Number(r))),r}}function mu(e,i,n,a,s){return T(e,(e,t)=>{const r=i instanceof Vn?i.get(t):null;return r&&r.evaluate?r.evaluate(n,a,s):r})}function gu(e,t){return t-e}Fi("FeatureIndex",fu,{omit:["rawTileData","sourceLayerCoder"]});class _u{constructor(e){const t={},r=[];for(const i in e){const n=e[i],a=t[i]={};for(const e in n.glyphs){const t=n.glyphs[+e];if(t&&0!==t.bitmap.width&&0!==t.bitmap.height){const i=t.metrics.localGlyph?2:1,l={x:0,y:0,w:t.bitmap.width+2*i,h:t.bitmap.height+2*i};r.push(l),a[e]=l}}}const{w:i,h:n}=fc(r),a=new xo({width:i||1,height:n||1});for(const r in e){const i=e[r];for(const e in i.glyphs){const n=i.glyphs[+e];var s,o;n&&0!==n.bitmap.width&&0!==n.bitmap.height&&(s=t[r][e],o=n.metrics.localGlyph?2:1,xo.copy(n.bitmap,a,{x:0,y:0},{x:s.x+o,y:s.y+o},n.bitmap))}}this.image=a,this.positions=t}}Fi("GlyphAtlas",_u);class vu{constructor(e){this.tileID=new Bh(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,e.projection&&(this.tileTransform=Rh(e.tileID.canonical,e.projection))}parse(r,e,i,n,a){this.status="parsing",this.data=r,this.collisionBoxArray=new Ea;const s=new zh(Object.keys(r.layers).sort()),o=new fu(this.tileID,this.promoteId);o.bucketLayerIDs=[];const l={},c=new Ah(256,256),h={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:c,availableImages:i},u=e.familiesBySource[this.source];for(const _ in u){const n=r.layers[_];if(n){let e=!1,t=!1;for(const r of u[_])"symbol"===r[0].type?e=!0:t=!0;if((!0!==this.isSymbolTile||e)&&(!1!==this.isSymbolTile||t)){1===n.version&&V(`Vector tile source "${this.source}" layer "${_}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const d=s.encode(_),p=[];for(let e=0;e<n.length;e++){const i=n.feature(e),a=o.getId(i,_);p.push({feature:i,id:a,index:e,sourceLayerIndex:d})}for(const r of u[_]){const _=r[0];void 0!==this.isSymbolTile&&"symbol"===_.type!==this.isSymbolTile||_.minzoom&&this.zoom<Math.floor(_.minzoom)||_.maxzoom&&this.zoom>=_.maxzoom||"none"!==_.visibility&&(yu(r,this.zoom,i),(l[_.id]=_.createBucket({index:o.bucketLayerIDs.length,layers:r,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:d,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:i})).populate(p,h,this.tileID.canonical,this.tileTransform),o.bucketLayerIDs.push(r.map(e=>e.id)))}}}}let d,p,f,m;c.trim();var t={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},e=T(h.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(e).length?n.send("getGlyphs",{uid:this.uid,stacks:e},(e,t)=>{d||(d=e,p=t,g.call(this))},void 0,!1,t):p={};e=Object.keys(h.iconDependencies);e.length?n.send("getImages",{icons:e,source:this.source,tileID:this.tileID,type:"icons"},(e,t)=>{d||(d=e,f=t,g.call(this))},void 0,!1,t):f={};e=Object.keys(h.patternDependencies);function g(){if(d)return a(d);if(p&&f&&m){var e=new _u(p),t=new gc(f,m);for(const r in l){const a=l[r];a instanceof uh?(yu(a.layers,this.zoom,i),Kc(a,p,e.positions,f,t.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom)):a.hasPattern&&(a instanceof Al||a instanceof Qo||a instanceof gl)&&(yu(a.layers,this.zoom,i),a.addFeatures(h,this.tileID.canonical,t.patternPositions,i))}this.status="done",a(null,{buckets:v(l).filter(e=>!e.isEmpty()),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:c,imageAtlas:t,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}e.length?n.send("getImages",{icons:e,source:this.source,tileID:this.tileID,type:"patterns"},(e,t)=>{d||(d=e,m=t,g.call(this))},void 0,!1,t):m={},g.call(this)}}function yu(e,t,r){var i=new On(t);for(const t of e)t.recalculate(i,r)}class xu{constructor(e){this.entries={},this.scheduler=e}request(r,i,e,t){const n=this.entries[r]=this.entries[r]||{callbacks:[]};if(n.result){const[r,e]=n.result;return this.scheduler?this.scheduler.add(()=>{t(r,e)},i):t(r,e),()=>{}}return n.callbacks.push(t),n.cancel||(n.cancel=e((e,t)=>{n.result=[e,t];for(const r of n.callbacks)this.scheduler?this.scheduler.add(()=>{r(e,t)},i):r(e,t);setTimeout(()=>delete this.entries[r],3e3)})),()=>{n.result||(n.callbacks=n.callbacks.filter(e=>e!==t),n.callbacks.length||(n.cancel(),delete this.entries[r]))}}}function bu(t,e,a){var r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},n=>{const e=Te(t.request,(e,t,r,i)=>{e?n(e):t&&n(null,{vectorTile:a?void 0:new ul.VectorTile(new Hl(t)),rawData:t,cacheControl:r,expires:i})});return()=>{e.cancel(),n()}},e)}za={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){var e,t,r;this.constants&&uo(this.parallels,this.constants.parallels)||(t=1+(r=Math.sin(C(this.parallels[0])))*(2*(e=(r+Math.sin(C(this.parallels[1])))/2)-r),r=Math.sqrt(t)/e,this.constants={n:e,c:t,r0:r,parallels:this.parallels})},project(e,t){this.initializeConstants();var r=C(e-this.center[0]),i=C(t),{n,c:e,r0:t}=this.constants,i=Math.sqrt(e-2*n*Math.sin(i))/n;return{x:i*Math.sin(r*n),y:i*Math.cos(r*n)-t}},unproject(e,t){this.initializeConstants();var{n:r,c:i,r0:n}=this.constants,n=n+t;let a=Math.atan2(e,Math.abs(n))*Math.sign(n);n*r<0&&(a-=Math.PI*Math.sign(e)*Math.sign(n));t=C(this.center[0])*r;a=d(a,-Math.PI-t,Math.PI-t);t=E(a/r)+this.center[0],r=Math.asin(S((i-(e*e+n*n)*r*r)/(2*r),-1,1)),r=S(E(r),-85.051129,Ms);return new _s(t,r)}};const wu=1.340264,Tu=-.081106,Eu=893e-6,Su=.003796,Mu=Math.sqrt(3)/2;Fa={name:"equalEarth",center:[0,0],range:[3.5,7],project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;var r=Math.asin(Mu*Math.sin(t)),i=r*r,t=i*i*i;return{x:.5*(e*Math.cos(r)/(Mu*(wu+3*Tu*i+t*(7*Eu+9*Su*i)))/Math.PI+.5),y:1-.5*(r*(wu+Tu*i+t*(Eu+Su*i))/Math.PI+1)}},unproject(e,r){e=(2*e-.5)*Math.PI;let i=r=(2*(1-r)-1)*Math.PI,n=i*i,a=n*n*n;for(let e,t=0;t<12&&(e=(i*(wu+Tu*n+a*(Eu+Su*n))-r)/(wu+3*Tu*n+a*(7*Eu+9*Su*n)),i=S(i-e,-Math.PI/3,Math.PI/3),n=i*i,a=n*n*n,!(Math.abs(e)<1e-12));++t);var t=Mu*e*(wu+3*Tu*n+a*(7*Eu+9*Su*n))/Math.cos(i),e=Math.asin(Math.sin(i)/Mu),t=S(180*t/Math.PI,-180,180),e=S(180*e/Math.PI,-85.051129,Ms);return new _s(t,e)}};const Au=Math.PI/2;function Cu(e){return Math.tan((Au+e)/2)}Ua={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){var e,t,r;this.constants&&uo(this.parallels,this.constants.parallels)||(r=C(this.parallels[0]),t=C(this.parallels[1]),e=Math.cos(r),t=r===t?Math.sin(r):Math.log(e/Math.cos(t))/Math.log(Cu(t)/Cu(r)),r=e*Math.pow(Cu(r),t)/t,this.constants={n:t,f:r,parallels:this.parallels})},project(e,t){this.initializeConstants(),t=C(t),e=C(e-this.center[0]);var{n:r,f:i}=this.constants;0<i?t<1e-6-Au&&(t=1e-6-Au):t>Au-1e-6&&(t=Au-1e-6);var n=i/Math.pow(Cu(t),r),t=n*Math.sin(r*e),e=i-n*Math.cos(r*e);return{x:.5*(t/Math.PI+.5),y:1-.5*(e/Math.PI+.5)}},unproject(e,t){this.initializeConstants(),e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;var{n:r,f:i}=this.constants,n=i-t,a=Math.sign(n),t=Math.sign(r)*Math.sqrt(e*e+n*n);let s=Math.atan2(e,Math.abs(n))*a;n*r<0&&(s-=Math.PI*Math.sign(e)*a);a=S(E(s/r)+this.center[0],-180,180),r=S(E(2*Math.atan(Math.pow(i/t,1/r))-Au),-85.051129,Ms);return new _s(a,r)}};const Lu=C(Ms);wr={name:"naturalEarth",center:[0,0],range:[3.5,7],project(e,t){var r=(t=C(t))*t,i=r*r;return{x:.5*((e=C(e))*(.8707-.131979*r+i*(i*(.003971*r-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+i*(.028874*r-.044475-.005916*i)))/Math.PI+1)}},unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,i=25,n,a=r*r;do{a=r*r;const o=a*a;n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o))),r=S(r-n,-Lu,Lu)}while(1e-6<Math.abs(n)&&0<--i);a=r*r;var s=S(E(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),e=E(r);return new _s(s,e)}};const Pu=C(Ms),Iu={albers:za,equalEarth:Fa,equirectangular:{name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(e,t)=>({x:.5+e/360,y:.5-t/360}),unproject(e,t){e=360*(e-.5),t=S(360*(.5-t),-85.051129,Ms);return new _s(e,t)}},lambertConformalConic:Ua,mercator:{name:"mercator",wrap:!0,center:[0,0],project:(e,t)=>({x:xs(e),y:bs(t)}),unproject(e,t){e=Ts(e),t=Es(t);return new _s(e,t)}},naturalEarth:wr,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(e,t){t=C(t),e=C(e);var r=Math.cos(t),i=2/Math.PI,n=Math.acos(r*Math.cos(e/2)),n=Math.sin(n)/n,e=.5*(e*i+2*r*Math.sin(e/2)/n)||0,n=.5*(t+Math.sin(t)/n)||0;return{x:.5*(e/Math.PI+.5),y:1-.5*(n/Math.PI+1)}},unproject(e,t){let r=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,n=25;const a=1e-6;var s,o;do{const n=Math.cos(i),a=Math.sin(i),l=2*a*n,c=a*a,h=n*n,E=Math.cos(r/2),u=Math.sin(r/2),d=2*E*u,p=u*u,f=1-h*E*E,m=f?1/f:0,g=f?Math.acos(n*E)*Math.sqrt(1/f):0,_=.5*(2*g*n*u+2*r/Math.PI)-e,v=.5*(g*a+i)-t,y=.5*m*(h*p+g*n*E*c)+1/Math.PI,x=m*(d*l/4-g*a*u),b=.125*m*(l*u-g*a*h*d),w=.5*m*(c*E+g*p*n)+.5,T=x*b-w*y;s=(v*x-_*w)/T,o=(_*b-v*y)/T,r=S(r-s,-Math.PI,Math.PI),i=S(i-o,-Pu,Pu)}while((Math.abs(s)>a||Math.abs(o)>a)&&0<--n);return new _s(E(r),E(i))}}};l.ARRAY_TYPE=Xs,l.AUTH_ERR_MSG=K,l.Actor=class{constructor(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},b(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=I()?e:u,this.scheduler=new Ih}send(e,t,r,i,n=!1,a){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=a,this.callbacks[s]=r);a=z(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!r,targetMapId:i,mustQueue:n,sourceMapId:this.mapId,data:Ui(t,a)},a),{cancel:()=>{r&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||I()){const e=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,t),e&&e.metadata||{type:"message"})}else this.processTask(r,t)}processTask(r,e){if("<response>"===e.type){const t=this.callbacks[r];delete this.callbacks[r],t&&(e.error?t(Gi(e.error)):t(null,Gi(e.data)))}else{const i=z(this.globalScope)?void 0:[],n=e.hasCallback?(e,t)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:e?Ui(e):null,data:Ui(t,i)},i)}:e=>{},a=Gi(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,n);else if(this.parent.getWorkerSource){const r=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,r[0],a.source)[r[1]](a,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=Oh,l.Color=lt,l.ColorMode=lu,l.CullFaceMode=cu,l.DEMData=nu,l.DataConstantProperty=$n,l.DedupedRequest=xu,l.DepthMode=su,l.EXTENT=fs,l.Elevation=class{getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,r=!0){null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||1<e.y)return t;var n=i.getSource().maxzoom,a=1<<n,s=Math.floor(e.x),o=e.x-s,a=new Bh(n,s,n,Math.floor(o*a),Math.floor(e.y*a)),a=this.findDEMTileFor(a);if(!a||!a.dem)return t;const l=a.dem,c=1<<a.tileID.canonical.z,h=(o*c-a.tileID.canonical.x)*l.dim,u=(e.y*c-a.tileID.canonical.y)*l.dim,d=Math.floor(h),p=Math.floor(u);return(r?this.exaggeration():1)*qt(qt(l.get(d,p),l.get(d,p+1),u-p),qt(l.get(d+1,p),l.get(d+1,p+1),u-p),h-d)}getAtTileOffset(e,t,r){var i=1<<e.canonical.z;return this.getAtPointOrZero(new As(e.wrap+(e.canonical.x+t/fs)/i,(e.canonical.y+r/fs)/i))}getForTilePoints(e,t,r,i){const n=pu.create(this,e,i);return!!n&&(t.forEach(e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],r)}),!0)}getMinMaxForTile(t){var e=this.findDEMTileFor(t);if(!e||!e.dem)return null;var r=e.dem.tree,i=e.tileID,e=1<<t.canonical.z-i.canonical.z;let n=t.canonical.x/e-i.canonical.x,a=t.canonical.y/e-i.canonical.y,s=0;for(let e=0;e<t.canonical.z-i.canonical.z&&!r.leaves[s];e++){n*=2,a*=2;const t=2*Math.floor(a)+Math.floor(n);s=r.childOffsets[s]+t,n%=1,a%=1}return{min:this.exaggeration()*r.minimums[s],max:this.exaggeration()*r.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=Oe,l.EvaluationParameters=On,l.Event=De,l.Evented=ke,l.GlyphManager=Gc,l.ImagePosition=mc,l.LineAtlas=Ah,l.LngLat=_s,l.LngLatBounds=ms,l.LocalGlyphMode=Uc,l.MAX_MERCATOR_LATITUDE=Ms,l.MAX_SAFE_INTEGER=r,l.MercatorCoordinate=As,l.ONE_EM=Fl,l.OverscaledTileID=Bh,l.Properties=qn,l.RGBAImage=bo,l.RequestManager=class{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){var e=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Y,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!J(e))return e;const r=te(e);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!J(e))return e;const r=te(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(e,t){if(!J(e))return e;const r=te(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,r,i){const n=te(e);return J(e)?(n.path=`/styles/v1${n.path}/sprite${t}${r}`,this._makeAPIURL(n,this._customAccessToken||i)):(n.path+=`${t}${r}`,re(n))}normalizeTileURL(e,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!J(e))return e;const i=te(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&"raster"!==i.authority&&512===r?"@2x":""}${j.supported?".webp":"$1"}`),"raster"===i.authority?i.path=`/${$.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${$.TILE_URL_VERSION}${i.path}`);r=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||$.ACCESS_TOKEN;return $.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,r)}canonicalizeTileURL(e,t){const r=te(e);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let i="mapbox://";r.path.match(/^\/raster\/v1\//)?i+=`raster/${r.path.replace(`/${$.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${r.path.replace(`/${$.TILE_URL_VERSION}/`,"")}`;let n=r.params;return t&&(n=n.filter(e=>!e.match(/^access_token=/))),n.length&&(i+=`?${n.join("&")}`),i}canonicalizeTileset(e,t){const r=!!t&&J(t),i=[];for(const t of e.tiles||[])Q(t)?i.push(this.canonicalizeTileURL(t,r)):i.push(t);return i}_makeAPIURL(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=te($.API_URL);if(e.protocol=i.protocol,e.authority=i.authority,"http"===e.protocol){const t=e.params.indexOf("secure");0<=t&&e.params.splice(t,1)}if("/"!==i.path&&(e.path=`${i.path}${e.path}`),!$.REQUIRE_ACCESS_TOKEN)return re(e);if(t=t||$.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter(e=>-1===e.indexOf("access_token")),e.params.push(`access_token=${t||""}`),re(e)}},l.ResourceType=xe,l.SegmentVector=ps,l.SourceCache=hu,l.StencilMode=ou,l.StructArrayLayout1ui2=xa,l.StructArrayLayout2f1f2i16=ua,l.StructArrayLayout2i4=ta,l.StructArrayLayout2ui4=ya,l.StructArrayLayout3f12=na,l.StructArrayLayout3ui6=pa,l.StructArrayLayout4i8=ra,l.Texture=Mh,l.Tile=Zh,l.Transitionable=Fn,l.Uniform1f=Ha,l.Uniform1i=class extends ja{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},l.Uniform2f=class extends ja{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},l.Uniform3f=class extends ja{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},l.Uniform4f=Wa,l.UniformColor=Za,l.UniformMatrix2f=class extends ja{constructor(e,t){super(e,t),this.current=Ya}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},l.UniformMatrix3f=class extends ja{constructor(e,t){super(e,t),this.current=Xa}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},l.UniformMatrix4f=class extends ja{constructor(e,t){super(e,t),this.current=qa}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},l.UnwrappedTileID=kh,l.ValidationError=Fe,l.VectorTileWorkerSource=class extends ke{constructor(e,t,r,i,n){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=n||bu,this.loading={},this.loaded={},this.deduped=new xu(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler}loadTile(s,o){const l=s.uid,c=s&&s.request,h=c&&c.collectResourceTiming,u=this.loading[l]=new vu(s);u.abort=this.loadVectorData(s,(e,t)=>{var r=!this.loading[l];if(delete this.loading[l],r||e||!t)return u.status="done",r||(this.loaded[l]=u),o(e);const i=t.rawData,n={};t.expires&&(n.expires=t.expires),t.cacheControl&&(n.cacheControl=t.cacheControl),u.vectorTile=t.vectorTile||new ul.VectorTile(new Hl(i));const a=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(e,t)=>{if(e||!t)return o(e);const r={};if(h){const e=Ph(c);0<e.length&&(r.resourceTiming=JSON.parse(JSON.stringify(e)))}o(null,y({rawTileData:i.slice(0)},t,n,r))})};this.isSpriteLoaded?a():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(a,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):a()}),this.loaded=this.loaded||{},this.loaded[l]=u})}reloadTile(e,i){const t=this.loaded,r=e.uid,n=this;if(t&&t[r]){const a=t[r];a.showCollisionBoxes=e.showCollisionBoxes,a.enableTerrain=!!e.enableTerrain;e=(e,t)=>{var r=a.reloadCallback;r&&(delete a.reloadCallback,a.parse(a.vectorTile,n.layerIndex,this.availableImages,n.actor,r)),i(e,t)};"parsing"===a.status?a.reloadCallback=e:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,e):e())}}abortTile(e,t){const r=e.uid,i=this.loading[r];i&&(i.abort&&i.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,i=e.uid;r&&r[i]&&delete r[i],t()}},l.WritingMode=_c,l.ZoomHistory=Vi,l.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},l.addDynamicAttributes=oh,l.altitudeFromMercatorZ=Ss,l.asyncAll=p,l.bezier=s,l.bindAll=b,l.boundsAttributes=Hh,l.bufferConvexPolygon=function(t,r){const i=[];for(let e=0;e<t.length;e++){const n=d(e-1,-1,t.length-1),a=d(e+1,-1,t.length-1),s=t[e],o=t[a],l=t[n].sub(s).unit(),c=o.sub(s).unit(),h=c.angleWithSep(l.x,l.y),u=l.add(c).unit().mult(-1*r/Math.sin(h/2));i.push(s.add(u))}return i},l.cacheEntryPossiblyAdded=function(e){ye++,ye>ge&&(e.getActor().send("enforceCacheSizeLimit",me),ye=0)},l.clamp=S,l.clearTileCache=function(e){const t=u.caches.delete(de);e&&t.catch(e).then(()=>e())},l.clipLine=Bc,l.clone=function(e){var t=new Xs(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},l.clone$1=function(e){var t=new Xs(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.clone$2=A,l.collisionCircleLayout=Bl,l.config=$,l.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},l.create=Qs,l.create$1=function(){var e=new Xs(16);return Xs!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},l.create$2=Ys,l.createExpression=Vr,l.createLayout=Qn,l.createStyleLayer=function(e){return new("custom"===e.type?_h:xh[e.type])(e)},l.cross=function(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],t=r[1],r=r[2];return e[0]=n*r-a*t,e[1]=a*s-i*r,e[2]=i*t-n*s,e},l.degToRad=C,l.div=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},l.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},l.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},l.ease=h,l.easeCubicInOut=o,l.emitValidationErrors=Ii,l.endsWith=w,l.enforceCacheSizeLimit=function(i){_e(),pe&&pe.then(r=>{r.keys().then(t=>{for(let e=0;e<t.length-i;e++)r.delete(t[e])})})},l.evaluateSizeForFeature=Ul,l.evaluateSizeForZoom=Gl,l.evaluateVariableOffset=Yc,l.evented=Rn,l.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},l.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},l.exported=U,l.exported$1=j,l.extend=y,l.filterObject=M,l.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},l.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,l=n+n,c=r*s,h=i*s,t=i*o,r=n*s,i=n*o,n=n*l,s=a*s,o=a*o,l=a*l;return e[0]=1-t-n,e[1]=h+l,e[2]=r-o,e[3]=0,e[4]=h-l,e[5]=1-c-n,e[6]=i+s,e[7]=0,e[8]=r+o,e[9]=i-s,e[10]=1-c-t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},l.fromRotation=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=r,e[2]=0,e[3]=-r,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},l.furthestTileCorner=function(e){e=Math.round((e+45+360)%360/90)%4;return n[e]},l.getAABBPointSquareDist=function(t,r,i){let n=0;for(let e=0;e<2;++e){var a=i?i[e]:0;t[e]>a&&(n+=(t[e]-a)*(t[e]-a)),r[e]<a&&(n+=(a-r[e])*(a-r[e]))}return n},l.getAnchorAlignment=Ac,l.getAnchorJustification=Jc,l.getBounds=function(e){let t=1/0,r=1/0,i=-1/0,n=-1/0;for(const B of e)t=Math.min(t,B.x),r=Math.min(r,B.y),i=Math.max(i,B.x),n=Math.max(n,B.y);return{min:new B(t,r),max:new B(i,n)}},l.getImage=Pe,l.getJSON=function(e,t){return we(y(e,{type:"json"}),t)},l.getMapSessionAPI=he,l.getPerformanceMeasurement=Ph,l.getProjection=function(e){var t=Iu[e.name];if(!t)throw new Error(`Invalid projection name: ${e.name}`);return t.conic?function(t,r){if(r.parallels&&Math.abs(r.parallels[0]+r.parallels[1])<.01){let e=function(e){const r=Math.max(.01,Math.cos(C(e))),i=1/(2*Math.max(Math.PI*r,1/r));return{wrap:!0,project(e,t){e=C(e)*r,t=Math.sin(C(t))/r;return{x:e*i+.5,y:-t*i+.5}},unproject(e,t){t=-(t-.5)/i,e=S(E((e-.5)/i)/r,-180,180),t=Math.asin(S(t*r,-1,1)),t=S(E(t),-85.051129,Ms);return new _s(e,t)}}}(r.parallels[0]);if("lambertConformalConic"===r.name){const{project:t,unproject:r}=Iu.mercator;e={wrap:!0,project:t,unproject:r}}return y({},t,r,e)}return y({},t,r)}(t,e):t},l.getRTLTextPluginStatus=Pn,l.getReferrer=Ee,l.getTilePoint=function(e,{x:t,y:r},i=0){return new B(((t-i)*e.scale-e.x)*fs,(r*e.scale-e.y)*fs)},l.getTileVec3=function(e,t,r=0){return to(((t.x-r)*e.scale-e.x)*fs,(t.y*e.scale-e.y)*fs,Ss(t.z,t.y))},l.getVideo=function(t,e){const r=u.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let e=0;e<t.length;e++){const i=u.document.createElement("source");!function(e){const t=u.document.createElement("a");return t.href=e,t.protocol===u.document.location.protocol&&t.host===u.document.location.host}(t[e])&&(r.crossOrigin="Anonymous"),i.src=t[e],r.appendChild(i)}return{cancel:()=>{}}},l.identity=Ks,l.identity$1=co,l.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=r*o-i*s,y=r*l-n*s,x=r*c-a*s,b=i*l-n*o,w=i*c-a*o,T=n*c-a*l,E=h*m-u*f,S=h*g-d*f,M=h*_-p*f,A=u*g-d*m,C=u*_-p*m,L=d*_-p*g,t=v*L-y*C+x*A+b*M-w*S+T*E;return t?(e[0]=(o*L-l*C+c*A)*(t=1/t),e[1]=(n*C-i*L-a*A)*t,e[2]=(m*T-g*w+_*b)*t,e[3]=(d*w-u*T-p*b)*t,e[4]=(l*M-s*L-c*S)*t,e[5]=(r*L-n*M+a*S)*t,e[6]=(g*x-f*T-_*y)*t,e[7]=(h*T-d*x+p*y)*t,e[8]=(s*C-o*M+c*E)*t,e[9]=(i*M-r*C-a*E)*t,e[10]=(f*w-m*x+_*v)*t,e[11]=(u*x-h*w-p*v)*t,e[12]=(o*S-s*A-l*E)*t,e[13]=(r*A-i*S+n*E)*t,e[14]=(m*y-f*b-g*v)*t,e[15]=(h*b-u*y+d*v)*t,e):null},l.isMapAuthenticated=function(e){return ue.has(e)},l.isMapboxURL=J,l.latFromMercatorY=Es,l.len=yr,l.length=eo,l.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},l.loadVectorTile=bu,l.makeRequest=we,l.mercatorXfromLng=xs,l.mercatorYfromLat=bs,l.mercatorZfromAltitude=ws,l.mul=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},l.mul$1=_r,l.mul$2=xr,l.multiply=Js,l.multiply$1=io,l.nextPowerOfTwo=_,l.normalize=ao,l.normalize$1=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],t=r*r+i*i+n*n+a*a;return 0<t&&(t=1/Math.sqrt(t)),e[0]=r*t,e[1]=i*t,e[2]=n*t,e[3]=a*t,e},l.number=qt,l.ortho=function(e,t,r,i,n,a,s){var o=1/(t-r),l=1/(i-n),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(s+a)*c,e[15]=1,e},l.pbf=Hl,l.perspective=function(e,t,r,i,n){var t=1/Math.tan(t/2);return e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+i)*(t=1/(i-n)),e[14]=2*n*i*t):(e[10]=-1,e[14]=-2*i),e},l.pick=function(t,r){const i={};for(let e=0;e<r.length;e++){var n=r[e];n in t&&(i[n]=t[n])}return i},l.plugin=Dn,l.pointGeometry=B,l.polygonIntersectsBox=Vs,l.polygonIntersectsPolygon=ks,l.polygonizeBounds=function(e,t,r=0,i=!0){const n=new B(r,r),a=e.sub(n),s=t.add(n),o=[a,new B(s.x,a.y),s,new B(a.x,s.y)];return i&&o.push(a),o},l.posAttributes=br,l.postMapLoadEvent=le,l.postTurnstileEvent=se,l.potpack=fc,l.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},l.radToDeg=E,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(e){return e({pluginStatus:Mn,pluginURL:An}),Rn.on("pluginStateChange",e),e},l.removeAuthState=function(e){ue.delete(e)},l.renderColorRamp=To,l.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],s=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],r=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*i,e[5]=s*n+h*i,e[6]=o*n+u*i,e[7]=l*n+r*i,e[8]=c*n-a*i,e[9]=h*n-s*i,e[10]=u*n-o*i,e[11]=r*n-l*i,e},l.rotateX$1=ho,l.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],c=t[8],h=t[9],u=t[10],r=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-c*i,e[1]=s*n-h*i,e[2]=o*n-u*i,e[3]=l*n-r*i,e[8]=a*i+c*n,e[9]=s*i+h*n,e[10]=o*i+u*n,e[11]=l*i+r*n,e},l.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],c=t[4],h=t[5],u=t[6],r=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*i,e[1]=s*n+h*i,e[2]=o*n+u*i,e[3]=l*n+r*i,e[4]=c*n-a*i,e[5]=h*n-s*i,e[6]=u*n-o*i,e[7]=r*n-l*i,e},l.rotateZ$1=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],s=t[3],t=Math.sin(r),r=Math.cos(r);return e[0]=i*r+n*t,e[1]=n*r-i*t,e[2]=a*r+s*t,e[3]=s*r-a*t,e},l.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},l.scale$1=function(e,t,r){var i=r[0],n=r[1],r=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},l.scaleAndAdd=no,l.setCacheLimits=function(e,t){me=e,ge=t},l.setRTLTextPlugin=function(e,t,r=!1){if(Mn===wn||Mn===Tn||Mn===En)throw new Error("setRTLTextPlugin cannot be called multiple times.");An=U.resolveURL(e),Mn=wn,Sn=t,Ln(),r||In()},l.smoothstep=function(e,t,r){return(r=S((r-e)/(t-e),0,1))*r*(3-2*r)},l.spec=Be,l.storeAuthState=function(e,t){t?ue.add(e):ue.delete(e)},l.sub=vr,l.subtract=ro,l.symbolSize=Zs,l.tileTransform=Rh,l.transformMat3=function(e,t,r){var i=t[0],n=t[1],t=t[2];return e[0]=i*r[0]+n*r[3]+t*r[6],e[1]=i*r[1]+n*r[4]+t*r[7],e[2]=i*r[2]+n*r[5]+t*r[8],e},l.transformMat4=oo,l.transformMat4$1=function(e,t,r){var i=t[0],n=t[1],a=t[2],t=r[3]*i+r[7]*n+r[11]*a+r[15];return e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/(t=t||1),e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/t,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/t,e},l.transformQuat=so,l.translate=function(e,t,r){var i,n,a,s,o,l,c,h,u,d,p,f=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*f+t[4]*m+t[8]*g+t[12],e[13]=t[1]*f+t[5]*m+t[9]*g+t[13],e[14]=t[2]*f+t[6]*m+t[10]*g+t[14],e[15]=t[3]*f+t[7]*m+t[11]*g+t[15]):(i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],e[0]=r=t[0],e[1]=i,e[2]=n,e[3]=a,e[4]=s,e[5]=o,e[6]=l,e[7]=c,e[8]=h,e[9]=u,e[10]=d,e[11]=p,e[12]=r*f+s*m+h*g+t[12],e[13]=i*f+o*m+u*g+t[13],e[14]=n*f+l*m+d*g+t[14],e[15]=a*f+c*m+p*g+t[15]),e},l.triggerPluginCompletionEvent=Cn,l.uniqueId=m,l.validateCustomStyleLayer=function(e){const t=[],r=e.id;return void 0===r&&t.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},l.validateFog=Ci,l.validateLight=Ai,l.validateStyle=Mi,l.values=v,l.vectorTile=ul,l.version="2.6.1",l.warnOnce=V,l.window=u,l.wrap=d}),e(0,function(l){function s(e){let t="";for(const r of l.refProperties)t+=`/${function t(r){var e=typeof r;if("number"==e||"boolean"==e||"string"==e||null==r)return JSON.stringify(r);if(Array.isArray(r)){let e="[";for(const i of r)e+=`${t(i)},`;return`${e}]`}const i=Object.keys(r).sort();let n="{";for(let e=0;e<i.length;e++)n+=`${JSON.stringify(i[e])}:${t(r[i[e]])},`;return`${n}}`}(e[r])}`;return t}class r{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(r,e){for(const s of r)this._layerConfigs[s.id]=s,(this._layers[s.id]=l.createStyleLayer(s)).compileFilter(),this.keyCache[s.id]&&delete this.keyCache[s.id];for(const l of e)delete this.keyCache[l],delete this._layerConfigs[l],delete this._layers[l];this.familiesBySource={};e=function(r,i){const n={};for(let t=0;t<r.length;t++){var a=i&&i[r[t].id]||s(r[t]);i&&(i[r[t].id]=a);let e=n[a];e=e||(n[a]=[]),e.push(r[t])}const e=[];for(const r in n)e.push(n[r]);return e}(l.values(this._layerConfigs),this.keyCache);for(const l of e){const r=l.map(e=>this._layers[e.id]),s=r[0];if("none"!==s.visibility){const n=s.source||"";let e=this.familiesBySource[n];e=e||(this.familiesBySource[n]={});var i=s.sourceLayer||"_geojsonTileLayer";let t=e[i];t=t||(e[i]=[]),t.push(r)}}}}const o=l.window["ImageBitmap"];class i{loadTile(e,t){var{uid:r,encoding:i,rawImageData:n,padding:a,buildQuadTree:e}=e,n=o&&n instanceof o?this.getImageData(n,a):n;t(null,new l.DEMData(r,n,i,a<1,e))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);t=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:t.width,height:t.height},t.data)}}function c(e,t){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)c(e.features[r],t);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)c(e.geometries[r],t);else if("Feature"===i)c(e.geometry,t);else if("Polygon"===i)n(e.coordinates,t);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)n(e.coordinates[r],t);return e}function n(e,t){if(0!==e.length){a(e[0],t);for(var r=1;r<e.length;r++)a(e[r],!t)}}function a(e,t){for(var r=0,i=0,n=0,a=e.length,s=a-1;n<a;s=n++){var o=(e[n][0]-e[s][0])*(e[s][1]+e[n][1]),l=r+o;i+=Math.abs(r)>=Math.abs(o)?r-l+o:o-l+r,r=l}0<=r+i!=!!t&&e.reverse()}const h=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class t{constructor(e){this._feature=e,this.extent=l.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const t of this._feature.geometry)e.push([new l.pointGeometry(t[0],t[1])]);return e}{const r=[];for(const i of this._feature.geometry){const n=[];for(const a of i)n.push(new l.pointGeometry(a[0],a[1]));r.push(n)}return r}}toGeoJSON(e,t,r){return h.call(this,e,t,r)}}class u{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=e.length,this._features=e}feature(e){return new t(this._features[e])}}var e=l.vectorTile.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],i=[],n=0;n<r.length;n++)i.push(new l.pointGeometry(r[n][0],r[n][1]));this.geometry.push(i)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,i=1/0,n=-1/0,a=0;a<e.length;a++)for(var s=e[a],o=0;o<s.length;o++)var l=s[o],t=Math.min(t,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y);return[t,i,r,n]},f.prototype.toGeoJSON=e.prototype.toGeoJSON;var m,g=_,e=d;function _(e){var t=new l.pbf;return function(e,t){for(var r in e.layers)t.writeMessage(3,v,e.layers[r])}(e,t),t.finish()}function v(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);for(var r={keys:[],values:[],keycache:{},valuecache:{}},i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,y,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var a=r.values;for(i=0;i<a.length;i++)t.writeMessage(4,E,a[i])}function y(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,x,e),t.writeVarintField(3,r.type),t.writeMessage(4,T,r)}function x(e,t){var r,i=e.feature,n=e.keys,a=e.values,s=e.keycache,o=e.valuecache;for(r in i.properties){var l,c=i.properties[r],h=s[r];null!==c&&(void 0===h&&(n.push(r),s[r]=h=n.length-1),t.writeVarint(h),void 0===(l=o[h=(l=typeof c)+":"+(c="string"!=l&&"boolean"!=l&&"number"!=l?JSON.stringify(c):c)])&&(a.push(c),o[h]=l=a.length-1),t.writeVarint(l))}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function T(e,t){for(var r=e.loadGeometry(),i=e.type,n=0,a=0,s=r.length,o=0;o<s;o++){var l=r[o],c=1;1===i&&(c=l.length),t.writeVarint(b(1,c));for(var h=3===i?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==i&&t.writeVarint(b(2,h-1));var d=l[u].x-n,p=l[u].y-a;t.writeVarint(w(d)),t.writeVarint(w(p)),n+=d,a+=p}3===i&&t.writeVarint(15)}}function E(e,t){var r=typeof e;"string"==r?t.writeStringField(1,e):"boolean"==r?t.writeBooleanField(7,e):"number"==r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function S(e,t,r,i,n,a){var s;n-i<=r||(function r(i,n,a,s,o,l){for(;s<o;){if(600<o-s){const h=o-s+1,u=a-s+1,d=Math.log(h),p=.5*Math.exp(2*d/3),f=.5*Math.sqrt(d*p*(h-p)/h)*(u-h/2<0?-1:1);r(i,n,a,Math.max(s,Math.floor(a-u*p/h+f)),Math.min(o,Math.floor(a+(h-u)*p/h+f)),l)}const c=n[2*a+l];let e=s,t=o;for(M(i,n,s,a),n[2*o+l]>c&&M(i,n,s,o);e<t;){for(M(i,n,e,t),e++,t--;n[2*e+l]<c;)e++;for(;n[2*t+l]>c;)t--}n[2*s+l]===c?M(i,n,s,t):(t++,M(i,n,t,o)),t<=a&&(s=t+1),a<=t&&(o=t-1)}}(e,t,s=i+n>>1,i,n,a%2),S(e,t,r,i,s-1,a+1),S(e,t,r,1+s,n,a+1))}function M(e,t,r,i){A(e,r,i),A(t,2*r,2*i),A(t,2*r+1,2*i+1)}function A(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function C(e,t,r,i){r=e-r,i=t-i;return r*r+i*i}g.fromVectorTileJs=_,g.fromGeojsonVt=function(e,t){t=t||{};var r,i={};for(r in e)i[r]=new d(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return _({layers:i})},g.GeoJSONWrapper=e;class L{constructor(t,r=e=>e[0],i=e=>e[1],e=64,n=Float64Array){this.nodeSize=e;const a=(this.points=t).length<65536?Uint16Array:Uint32Array,s=this.ids=new a(t.length),o=this.coords=new n(2*t.length);for(let e=0;e<t.length;e++)s[e]=e,o[2*e]=r(t[e]),o[2*e+1]=i(t[e]);S(s,o,e,0,s.length-1,0)}range(e,t,r,i){return function(t,r,i,n,a,s,e){const o=[0,t.length-1,0],l=[];let c,h;for(;o.length;){var u=o.pop(),d=o.pop(),p=o.pop();if(d-p<=e)for(let e=p;e<=d;e++)c=r[2*e],h=r[2*e+1],c>=i&&c<=a&&h>=n&&h<=s&&l.push(t[e]);else{var f=Math.floor((p+d)/2);c=r[2*f],h=r[2*f+1],c>=i&&c<=a&&h>=n&&h<=s&&l.push(t[f]);var m=(u+1)%2;(0===u?i<=c:n<=h)&&(o.push(p),o.push(f-1),o.push(m)),(0===u?a>=c:s>=h)&&(o.push(f+1),o.push(d),o.push(m))}}return l}(this.ids,this.coords,e,t,r,i,this.nodeSize)}within(e,t,r){return function(t,r,i,n,e,a){const s=[0,t.length-1,0],o=[],l=e*e;for(;s.length;){var c=s.pop(),h=s.pop(),u=s.pop();if(h-u<=a)for(let e=u;e<=h;e++)C(r[2*e],r[2*e+1],i,n)<=l&&o.push(t[e]);else{var d=Math.floor((u+h)/2),p=r[2*d],f=r[2*d+1];C(p,f,i,n)<=l&&o.push(t[d]);var m=(c+1)%2;(0===c?i-e<=p:n-e<=f)&&(s.push(u),s.push(d-1),s.push(m)),(0===c?p<=i+e:f<=n+e)&&(s.push(d+1),s.push(h),s.push(m))}}return o}(this.ids,this.coords,e,t,r,this.nodeSize)}}const P={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},I=Math.fround||(m=new Float32Array(1),e=>(m[0]=+e,m[0]));class R{constructor(e){this.options=F(Object.create(P),e),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:r,minZoom:i,maxZoom:n,nodeSize:a}=this.options;r&&console.time("total time");var e=`prepare ${t.length} points`;r&&console.time(e),this.points=t;let s=[];for(let e=0;e<t.length;e++)t[e].geometry&&s.push(function(e,t){var[r,e]=e.geometry.coordinates;return{x:I(k(r)),y:I(B(e)),zoom:1/0,index:t,parentId:-1}}(t[e],e));this.trees[n+1]=new L(s,z,N,a,Float32Array),r&&console.timeEnd(e);for(let e=n;e>=i;e--){const i=+Date.now();s=this._cluster(s,e),this.trees[e]=new L(s,z,N,a,Float32Array),r&&console.log("z%d: %d clusters in %dms",e,s.length,+Date.now()-i)}return r&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;var i=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;var a=Math.max(-90,Math.min(90,e[3]));if(360<=e[2]-e[0])r=-180,n=180;else if(r>n){const e=this.getClusters([r,i,180,a],t),s=this.getClusters([-180,i,n,a],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],o=s.range(k(r),B(a),k(n),B(i)),l=[];for(const e of o){const t=s.points[e];l.push(t.numPoints?D(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);var a=n.points[t];if(!a)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),o=n.within(a.x,a.y,s),l=[];for(const t of o){const r=n.points[t];r.parentId===e&&l.push(r.numPoints?D(r):this.points[r.index])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,r){var i=[];return this._appendLeaves(i,e,t=t||10,r=r||0,0),i}getTile(e,t,r){const i=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:a,radius:s}=this.options,o=s/a,l=(r-o)/n,c=(r+1+o)/n,h={features:[]};return this._addTileFeatures(i.range((t-o)/n,l,(t+1+o)/n,c),i.points,t,r,n,h),0===t&&this._addTileFeatures(i.range(1-o/n,l,1,c),i.points,n,r,n,h),t===n-1&&this._addTileFeatures(i.range(0,l,o/n,c),i.points,-1,r,n,h),h.features.length?h:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){var r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,i,n){const a=this.getChildren(t);for(const t of a){const a=t.properties;if(a&&a.cluster?n+a.point_count<=i?n+=a.point_count:n=this._appendLeaves(e,a.cluster_id,r,i,n):n<i?n++:e.push(t),e.length===r)break}return n}_addTileFeatures(n,a,s,o,l,c){for(const h of n){const n=a[h],u=n.numPoints;let e,t,r;if(u)e=O(n),t=n.x,r=n.y;else{const a=this.points[n.index];e=a.properties,t=k(a.geometry.coordinates[0]),r=B(a.geometry.coordinates[1])}const d={type:1,geometry:[[Math.round(this.options.extent*(t*l-s)),Math.round(this.options.extent*(r*l-o))]],tags:e};let i;u?i=n.id:this.options.generateId?i=n.index:this.points[n.index].id&&(i=this.points[n.index].id),void 0!==i&&(d.id=i),c.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,a){const s=[],{radius:o,extent:l,reduce:c,minPoints:t}=this.options,r=o/(l*Math.pow(2,a));for(let n=0;n<e.length;n++){const l=e[n];if(!(l.zoom<=a)){l.zoom=a;const _=this.trees[a+1],v=_.within(l.x,l.y,r),y=l.numPoints||1;let i=y;for(const e of v){const s=_.points[e];s.zoom>a&&(i+=s.numPoints||1)}if(i>y&&i>=t){let e=l.x*y,t=l.y*y,r=c&&1<y?this._map(l,!0):null;var h,u=(n<<5)+(a+1)+this.points.length;for(const s of v){const o=_.points[s];o.zoom<=a||(o.zoom=a,h=o.numPoints||1,e+=o.x*h,t+=o.y*h,o.parentId=u,c&&(r=r||this._map(l,!0),c(r,this._map(o))))}l.parentId=u,s.push((d=e/i,p=t/i,f=u,m=i,g=r,{x:I(d),y:I(p),zoom:1/0,id:f,parentId:-1,numPoints:m,properties:g}))}else if(s.push(l),1<i)for(const e of v){const o=_.points[e];o.zoom<=a||(o.zoom=a,s.push(o))}}}var d,p,f,m,g;return s}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?F({},e.properties):e.properties;var r=this.points[e.index].properties,e=this.options.map(r);return t&&e===r?F({},e):e}}function D(e){return{type:"Feature",id:e.id,properties:O(e),geometry:{type:"Point",coordinates:[360*(e.x-.5),function(e){e=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(e.y)]}}}function O(e){var t=e.numPoints,r=1e4<=t?`${Math.round(t/1e3)}k`:1e3<=t?Math.round(t/100)/10+"k":t;return F(F({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:r})}function k(e){return e/360+.5}function B(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function F(e,t){for(const r in t)e[r]=t[r];return e}function z(e){return e.x}function N(e){return e.y}function U(e,t,r,i){for(var n,a=i,s=r-t>>1,o=r-t,l=e[t],c=e[t+1],h=e[r],u=e[r+1],d=t+3;d<r;d+=3){var p=function(e,t,r,i,n,a){var s=n-r,o=a-i;{var l;0===s&&0===o||(1<(l=((e-r)*s+(t-i)*o)/(s*s+o*o))?(r=n,i=a):0<l&&(r+=s*l,i+=o*l))}return(s=e-r)*s+(o=t-i)*o}(e[d],e[d+1],l,c,h,u);a<p?(n=d,a=p):p!==a||(p=Math.abs(d-s))<o&&(n=d,o=p)}i<a&&(3<n-t&&U(e,t,n,i),e[n+2]=a,3<r-n&&U(e,n,r,i))}function G(e,t,r,i){i={id:void 0===e?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)V(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<t.length;i++)V(e,t[i]);else if("MultiPolygon"===r)for(i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++)V(e,t[i][n])}(i),i}function V(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function $(e,t,r,i){if(t.geometry){var n=t.geometry.coordinates,a=t.geometry.type,s=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),o=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===a)j(n,o);else if("MultiPoint"===a)for(var c=0;c<n.length;c++)j(n[c],o);else if("LineString"===a)H(n,o,s,!1);else if("MultiLineString"===a){if(r.lineMetrics){for(c=0;c<n.length;c++)H(n[c],o=[],s,!1),e.push(G(l,"LineString",o,t.properties));return}W(n,o,s,!1)}else if("Polygon"===a)W(n,o,s,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"!==a)throw new Error("Input data is not a valid GeoJSON object.");for(c=0;c<t.geometry.geometries.length;c++)$(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},r,i);return}for(c=0;c<n.length;c++){var h=[];W(n[c],h,s,!0),o.push(h)}}e.push(G(l,a,o,t.properties))}}function j(e,t){t.push(Z(e[0])),t.push(q(e[1])),t.push(0)}function H(e,t,r,i){for(var n,a,s=0,o=0;o<e.length;o++){var l=Z(e[o][0]),c=q(e[o][1]);t.push(l),t.push(c),t.push(0),0<o&&(s+=i?(n*c-l*a)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-a,2))),n=l,a=c}var h=t.length-3;t[2]=1,U(t,0,h,r),t[2+h]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function W(e,t,r,i){for(var n=0;n<e.length;n++){var a=[];H(e[n],a,r,i),t.push(a)}}function Z(e){return e/360+.5}function q(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function X(e,t,r,i,n,a,s,o){if(i/=t,a>=(r/=t)&&s<i)return e;if(s<r||i<=a)return null;for(var l=[],c=0;c<e.length;c++){var h=e[c],u=h.geometry,d=h.type,p=0===n?h.minX:h.minY,f=0===n?h.maxX:h.maxY;if(r<=p&&f<i)l.push(h);else if(!(f<r||i<=p)){var m=[];if("Point"===d||"MultiPoint"===d)!function(e,t,r,i,n){for(var a=0;a<e.length;a+=3){var s=e[a+n];r<=s&&s<=i&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}(u,m,r,i,n);else if("LineString"===d)Y(u,m,r,i,n,!1,o.lineMetrics);else if("MultiLineString"===d)J(u,m,r,i,n,!1);else if("Polygon"===d)J(u,m,r,i,n,!0);else if("MultiPolygon"===d)for(var g=0;g<u.length;g++){var _=[];J(u[g],_,r,i,n,!0),_.length&&m.push(_)}if(m.length)if(o.lineMetrics&&"LineString"===d)for(g=0;g<m.length;g++)l.push(G(h.id,d,m[g],h.tags));else"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(G(h.id,d,m,h.tags))}}return l.length?l:null}function Y(e,t,r,i,n,a,s){for(var o,l,c=K(e),h=0===n?ee:te,u=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],_=e[d+4],v=0===n?p:f,y=0===n?g:_,x=!1;s&&(o=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-_,2))),v<r?r<y&&(l=h(c,p,f,g,_,r),s&&(c.start=u+o*l)):i<v?y<i&&(l=h(c,p,f,g,_,i),s&&(c.start=u+o*l)):Q(c,p,f,m),y<r&&r<=v&&(l=h(c,p,f,g,_,r),x=!0),i<y&&v<=i&&(l=h(c,p,f,g,_,i),x=!0),!a&&x&&(s&&(c.end=u+o*l),t.push(c),c=K(e)),s&&(u+=o)}var b=e.length-3,p=e[b],f=e[1+b],m=e[2+b];(v=0===n?p:f)>=r&&v<=i&&Q(c,p,f,m),b=c.length-3,a&&3<=b&&(c[b]!==c[0]||c[1+b]!==c[1])&&Q(c,c[0],c[1],c[2]),c.length&&t.push(c)}function K(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function J(e,t,r,i,n,a){for(var s=0;s<e.length;s++)Y(e[s],t,r,i,n,a,!1)}function Q(e,t,r,i){e.push(t),e.push(r),e.push(i)}function ee(e,t,r,i,n,a){t=(a-t)/(i-t);return e.push(a),e.push(r+(n-r)*t),e.push(1),t}function te(e,t,r,i,n,a){r=(a-r)/(n-r);return e.push(t+(i-t)*r),e.push(a),e.push(1),r}function re(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i],a=n.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)s=ie(n.geometry,t);else if("MultiLineString"===a||"Polygon"===a)for(var s=[],o=0;o<n.geometry.length;o++)s.push(ie(n.geometry[o],t));else if("MultiPolygon"===a)for(s=[],o=0;o<n.geometry.length;o++){for(var l=[],c=0;c<n.geometry[o].length;c++)l.push(ie(n.geometry[o][c],t));s.push(l)}r.push(G(n.id,a,s,n.tags))}return r}function ie(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function ne(e,t){if(e.transformed)return e;for(var r,i=1<<e.z,n=e.x,a=e.y,s=0;s<e.features.length;s++){var o=e.features[s],l=o.geometry,c=o.type;if(o.geometry=[],1===c)for(r=0;r<l.length;r+=2)o.geometry.push(ae(l[r],l[r+1],t,i,n,a));else for(r=0;r<l.length;r++){for(var h=[],u=0;u<l[r].length;u+=2)h.push(ae(l[r][u],l[r][u+1],t,i,n,a));o.geometry.push(h)}}return e.transformed=!0,e}function ae(e,t,r,i,n,a){return[Math.round(r*(e*i-n)),Math.round(r*(t*i-a))]}function se(e,t,r,i,n){for(var a=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},o=0;o<e.length;o++){s.numFeatures++,function(e,t,r,i){var n=t.geometry,a=t.type,s=[];if("Point"===a||"MultiPoint"===a)for(var o=0;o<n.length;o+=3)s.push(n[o]),s.push(n[o+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)oe(s,n,e,r,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(o=0;o<n.length;o++)oe(s,n[o],e,r,"Polygon"===a,0===o);else if("MultiPolygon"===a)for(var l=0;l<n.length;l++){var c=n[l];for(o=0;o<c.length;o++)oe(s,c[o],e,r,!0,0===o)}if(s.length){var h=t.tags||null;if("LineString"===a&&i.lineMetrics){for(var u in h={},t.tags)h[u]=t.tags[u];h.mapbox_clip_start=n.start/n.size,h.mapbox_clip_end=n.end/n.size}i={geometry:s,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:h};null!==t.id&&(i.id=t.id),e.features.push(i)}}(s,e[o],a,n);var l=e[o].minX,c=e[o].minY,h=e[o].maxX,u=e[o].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),h>s.maxX&&(s.maxX=h),u>s.maxY&&(s.maxY=u)}return s}function oe(e,t,r,i,n,a){var s=i*i;if(0<i&&t.size<(n?s:i))r.numPoints+=t.length/3;else{for(var o=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(r.numSimplified++,o.push(t[l]),o.push(t[l+1])),r.numPoints++;n&&function(e,t){for(var r=0,i=0,n=e.length,a=n-2;i<n;a=i,i+=2)r+=(e[i]-e[a])*(e[i+1]+e[a+1]);if(0<r===t)for(i=0,n=e.length;i<n/2;i+=2){var s=e[i],o=e[i+1];e[i]=e[n-2-i],e[i+1]=e[n-1-i],e[n-2-i]=s,e[n-1-i]=o}}(o,a),e.push(o)}}function le(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||24<t.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i,n,a,s,o=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)$(r,e.features[i],t,i);else $(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=o,a=(n=t).buffer/n.extent,e=X(s=i,1,-1-a,a,0,-1,2,n),t=X(i,1,1-a,2+a,0,-1,2,n),(e||t)&&(s=X(i,1,-a,1+a,0,-1,2,n)||[],e&&(s=re(e,1).concat(s)),t&&(s=s.concat(re(t,-1)))),(o=s).length&&this.splitTile(o,0,0,0),r&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ce(e,t,r){return 32*((1<<e)*r+t)+e}function he(e,t){e=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);e=this._geoJSONIndex.getTile(e.z,e.x,e.y);if(!e)return t(null,null);e=new u(e.features);let r=g(e);0===r.byteOffset&&r.byteLength===r.buffer.byteLength||(r=new Uint8Array(r)),t(null,{vectorTile:e,rawData:r.buffer})}le.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},le.prototype.splitTile=function(e,t,r,i,n,a,s){for(var o=[e,t,r,i],l=this.options,c=l.debug;o.length;){i=o.pop(),r=o.pop(),t=o.pop(),e=o.pop();var h,u,d,p,f,m,g,_,v=1<<t,y=ce(t,r,i),x=this.tiles[y];if(!x&&(1<c&&console.time("creation"),x=this.tiles[y]=se(e,t,r,i,l),this.tileCoords.push({z:t,x:r,y:i}),c)&&(1<c&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,x.numFeatures,x.numPoints,x.numSimplified),console.timeEnd("creation")),this.stats[_="z"+t]=(this.stats[_]||0)+1,this.total++),x.source=e,n){if(t===l.maxZoom||t===n)continue;var b=1<<n-t;if(r!==Math.floor(a/b)||i!==Math.floor(s/b))continue}else if(t===l.indexMaxZoom||x.numPoints<=l.indexMaxPoints)continue;x.source=null,0!==e.length&&(1<c&&console.time("clipping"),f=.5-(p=.5*l.buffer/l.extent),m=1+p,g=h=u=d=null,_=X(e,v,r-p,r+(y=.5+p),0,x.minX,x.maxX,l),b=X(e,v,r+f,r+m,0,x.minX,x.maxX,l),e=null,_&&(g=X(_,v,i-p,i+y,1,x.minY,x.maxY,l),h=X(_,v,i+f,i+m,1,x.minY,x.maxY,l),_=null),b&&(u=X(b,v,i-p,i+y,1,x.minY,x.maxY,l),d=X(b,v,i+f,i+m,1,x.minY,x.maxY,l),b=null),1<c&&console.timeEnd("clipping"),o.push(g||[],t+1,2*r,2*i),o.push(h||[],t+1,2*r,2*i+1),o.push(u||[],t+1,2*r+1,2*i),o.push(d||[],t+1,2*r+1,2*i+1))}},le.prototype.getTile=function(e,t,r){var i=this.options,n=i.extent,a=i.debug;if(e<0||24<e)return null;i=1<<e,i=ce(e,t=(t%i+i)%i,r);if(this.tiles[i])return ne(this.tiles[i],n);1<a&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var s,o=e,l=t,c=r;!s&&0<o;)o--,l=Math.floor(l/2),c=Math.floor(c/2),s=this.tiles[ce(o,l,c)];return s&&s.source?(1<a&&console.log("found parent tile z%d-%d-%d",o,l,c),1<a&&console.time("drilling down"),this.splitTile(s.source,o,l,c,e,t,r),1<a&&console.timeEnd("drilling down"),this.tiles[i]?ne(this.tiles[i],n):null):null};class ue extends l.VectorTileWorkerSource{constructor(e,t,r,i,n){super(e,t,r,i,he),n&&(this.loadGeoJSON=n)}loadData(i,n){const a=i&&i.request,s=a&&a.collectResourceTiming;this.loadGeoJSON(i,(e,t)=>{if(e||!t)return n(e);if("object"!=typeof t)return n(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{c(t,!0);try{if(i.filter){const n=l.createExpression(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(e=>`${e.key}: ${e.message}`).join(", "));const a=t.features.filter(e=>n.value.evaluate({zoom:0},e));t={type:"FeatureCollection",features:a}}this._geoJSONIndex=i.cluster?new R(function({superclusterOptions:e,clusterProperties:t}){if(!t||!e)return e;const r={},i={},n={accumulated:null,zoom:0},a={properties:null},s=Object.keys(t);for(const e of s){const[n,a]=t[e],s=l.createExpression(a),o=l.createExpression("string"==typeof n?[n,["accumulated"],["get",e]]:n);r[e]=s.value,i[e]=o.value}return e.map=e=>{a.properties=e;const t={};for(const e of s)t[e]=r[e].evaluate(n,a);return t},e.reduce=(e,t)=>{a.properties=t;for(const t of s)n.accumulated=e[t],e[t]=i[t].evaluate(n,a)},e}(i)).load(t.features):new le(t,i.geojsonVtOptions)}catch(e){return n(e)}this.loaded={};const r={};if(s){const n=l.getPerformanceMeasurement(a);n&&(r.resourceTiming={},r.resourceTiming[i.source]=JSON.parse(JSON.stringify(n)))}n(null,r)}})}reloadTile(e,t){var r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)l.getJSON(t.request,r);else{if("string"!=typeof t.data)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class de{constructor(e){this.self=e,this.actor=new l.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:ue},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=e=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=e.applyArabicShaping,l.plugin.processBidirectionalText=e.processBidirectionalText,l.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(e,t){this.isSpriteLoaded[e]=t;for(const r in this.workerSources[e]){const i=this.workerSources[e][r];for(const e in i)i[e]instanceof l.VectorTileWorkerSource&&(i[e].isSpriteLoaded=t,i[e].fire(new l.Event("isSpriteLoaded")))}}setImages(e,t,r){this.availableImages[e]=t;for(const r in this.workerSources[e]){const i=this.workerSources[e][r];for(const e in i)i[e].availableImages=t}r()}enableTerrain(e,t,r){this.terrain=t,r()}setProjection(e,t){this.projections[e]=l.getProjection(t)}setLayers(e,t,r){this.getLayerIndex(e).replace(t),r()}updateLayers(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r()}loadTile(e,t,r){const i=this.enableTerrain?l.extend({enableTerrain:this.terrain},t):t;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).loadTile(i,r)}loadDEMTile(e,t,r){var i=this.enableTerrain?l.extend({buildQuadTree:this.terrain},t):t;this.getDEMWorkerSource(e,t.source).loadTile(i,r)}reloadTile(e,t,r){const i=this.enableTerrain?l.extend({enableTerrain:this.terrain},t):t;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).reloadTile(i,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r)}removeSource(e,t,r){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){const i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,r):r()}}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(e,t,r){try{l.plugin.setState(t);const e=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=e){this.self.importScripts(e);const t=l.plugin.isParsed();r(t?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),t)}}catch(e){r(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t=t||[],t}getLayerIndex(e){let t=this.layerIndexes[e];return t=t||(this.layerIndexes[e]=new r),t}getWorkerSource(s,e,t){return this.workerSources[s]||(this.workerSources[s]={}),this.workerSources[s][e]||(this.workerSources[s][e]={}),this.workerSources[s][e][t]||(this.workerSources[s][e][t]=new this.workerSourceTypes[e]({send:(e,t,r,i,n,a)=>{this.actor.send(e,t,r,s,n,a)},scheduler:this.actor.scheduler},this.getLayerIndex(s),this.getAvailableImages(s),this.isSpriteLoaded[s])),this.workerSources[s][e][t]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new i),this.demWorkerSources[e][t]}enforceCacheSizeLimit(e,t){l.enforceCacheSizeLimit(t)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new de(self)),de}),e(0,function(re){var t=a;function a(e){return e=e,!("undefined"==typeof window||"undefined"==typeof document||(!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||(!Function.prototype||!Function.prototype.bind||(!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||(!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||(!function(){if("Worker"in window&&"Blob"in window&&"URL"in window){var e,t,r=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(r);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}}()||(!("Uint8ClampedArray"in window)||(!ArrayBuffer.isView||(!function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(t){t=t.getImageData(0,0,1,1);return t&&t.width===e.width}}()||(void 0===r[n=e&&e.failIfMajorPerformanceCaveat]&&(r[n]=function(){var e,t,r,i,i=(t=n,r=document.createElement("canvas"),(i=Object.create(a.webGLContextAttributes)).failIfMajorPerformanceCaveat=t,r.getContext("webgl",i)||r.getContext("experimental-webgl",i));if(!i)return!1;try{e=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!e||i.isContextLost())&&(i.shaderSource(e,"void main() {}"),i.compileShader(e),!0===i.getShaderParameter(e,i.COMPILE_STATUS))}()),!r[n]||!!document.documentMode))))))))));var n}var r={};function g(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return;for(let e=0;e<t.length;e++)if(!g(t[e],r[e]))return;return 1}if("object"!=typeof t||null===t||null===r)return t===r;if("object"==typeof r&&Object.keys(t).length===Object.keys(r).length){for(const e in t)if(!g(t[e],r[e]))return;return 1}}a.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const f={create:function(e,t,r){const i=re.window.document.createElement(e);return void 0!==t&&(i.className=t),r&&r.appendChild(i),i},createNS:function(e,t){return re.window.document.createElementNS(e,t)}},e=re.window.document&&re.window.document.documentElement.style,i=e&&void 0!==e.userSelect?"userSelect":"WebkitUserSelect";let n;f.disableDrag=function(){e&&i&&(n=e[i],e[i]="none")},f.enableDrag=function(){e&&i&&(e[i]=n)};let s=!(f.setTransform=function(e,t){e.style.transform=t});try{const t=Object.defineProperty({},"passive",{get(){s=!0}});re.window.addEventListener("test",t,t),re.window.removeEventListener("test",t,t)}catch(re){s=!1}f.addEventListener=function(e,t,r,i={}){e.addEventListener(t,r,"passive"in i&&s?i:i.capture)},f.removeEventListener=function(e,t,r,i={}){e.removeEventListener(t,r,"passive"in i&&s?i:i.capture)};function o(e){e.preventDefault(),e.stopPropagation(),re.window.removeEventListener("click",o,!0)}function l(e,t,r){e=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new re.pointGeometry((r.clientX-t.left)*e,(r.clientY-t.top)*e)}function T(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],t=r*a-n*i;return t?(e[0]=a*(t=1/t),e[1]=-i*t,e[2]=-n*t,e[3]=r*t,e):null}f.suppressClick=function(){re.window.addEventListener("click",o,!0),re.window.setTimeout(()=>{re.window.removeEventListener("click",o,!0)},0)},f.mousePos=function(e,t){var r=e.getBoundingClientRect();return l(e,r,t)},f.touchPos=function(t,r){const i=t.getBoundingClientRect(),n=[];for(let e=0;e<r.length;e++)n.push(l(t,i,r[e]));return n},f.mouseButton=function(e){return void 0!==re.window.InstallTrigger&&2===e.button&&e.ctrlKey&&0<=re.window.navigator.platform.toUpperCase().indexOf("MAC")?0:e.button},f.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};class d{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){var i=re.dot(t,this.dir);if(Math.abs(i)<1e-6)return!1;i=re.dot(re.sub(re.create(),e,this.pos),t)/i,i=re.scaleAndAdd(re.create(),this.pos,this.dir,i);return re.copy(r,i),!0}}class L{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(r,i,e){const n=Math.pow(2,e),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(e=>{var t=re.transformMat4([],e,r),e=1/t[3]/i*n;return re.mul(t,t,[e,e,1/t[3],e])}),t=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const t=re.sub([],a[e[0]],a[e[1]]),r=re.sub([],a[e[2]],a[e[1]]),i=re.normalize([],re.cross([],t,r)),n=-re.dot(i,a[e[1]]);return i.concat(n)});return new L(a,t)}}class P{constructor(e,t){this.min=e,this.max=t,this.center=re.scale([],re.add([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],r=re.clone(this.min),i=re.clone(this.max);for(let e=0;e<t.length;e++)r[e]=(t[e]?this.min:this.center)[e],i[e]=(t[e]?this.center:this.max)[e];return i[2]=this.max[2],new P(r,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}intersects(n){var r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let i=!0;for(let e=0;e<n.planes.length;e++){var a=n.planes[e];let t=0;for(let e=0;e<r.length;e++)t+=0<=re.dot$1(a,r[e]);if(0===t)return 0;t!==r.length&&(i=!1)}if(i)return 2;for(let i=0;i<3;i++){let t=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let e=0;e<n.points.length;e++){var s=n.points[e][i]-this.min[i];t=Math.min(t,s),r=Math.max(r,s)}if(r<0||t>this.max[i]-this.min[i])return 0}return 1}}class c extends re.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new re.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(e,t){let r=!0;return this._validateStretch(t.stretchX,t.data&&t.data.width)||(this.fire(new re.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(t.stretchY,t.data&&t.data.height)||(this.fire(new re.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(t.content,t)||(this.fire(new re.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let r=0;for(const i of e){if(i[0]<r||i[1]<i[0]||t<i[1])return!1;r=i[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let r=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(r=!1);this.isLoaded()||r?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(e,t){const r={};for(const t of e){this.images[t]||this.fire(new re.Event("styleimagemissing",{id:t}));const e=this.images[t];e?r[t]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:re.warnOnce(`Image "${t}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}t(null,r)}getPixelSize(){var{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const t=this.patterns[e],r=this.getImage(e);if(!r)return null;if(t&&t.position.version===r.version)return t.position;if(t)t.position.version=r.version;else{const t={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new re.ImagePosition(t,r);this.patterns[e]={bin:t,position:i}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){var t=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new re.Texture(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const re in this.patterns)e.push(this.patterns[re].bin);const{w:t,h:r}=re.potpack(e),i=this.atlasImage;i.resize({width:t||1,height:r||1});for(const e in this.patterns){const t=this.patterns[e]["bin"],r=t.x+1,n=t.y+1,a=this.images[e].data,s=a.width,o=a.height;re.RGBAImage.copy(a,i,{x:0,y:0},{x:r,y:n},{width:s,height:o}),re.RGBAImage.copy(a,i,{x:0,y:o-1},{x:r,y:n-1},{width:s,height:1}),re.RGBAImage.copy(a,i,{x:0,y:0},{x:r,y:n+o},{width:s,height:1}),re.RGBAImage.copy(a,i,{x:s-1,y:0},{x:r-1,y:n},{width:1,height:o}),re.RGBAImage.copy(a,i,{x:0,y:0},{x:r+s,y:n},{width:1,height:o})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e)if(!this.callbackDispatchedThisFrame[t]){this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];!function(e){const t=e["userImage"];return t&&t.render&&t.render()&&(e.data.replace(new Uint8Array(t.data.buffer)),1)}(e)||this.updateImage(t,e)}}}const h=new re.Properties({anchor:new re.DataConstantProperty(re.spec.light.anchor),position:new class{constructor(){this.specification=re.spec.light.position}possiblyEvaluate(e,t){return[[r,i,n]]=[e.expression.evaluate(t)],e=re.degToRad(i+90),t=re.degToRad(n),{x:r*Math.cos(e)*Math.sin(t),y:r*Math.sin(e)*Math.sin(t),z:r*Math.cos(t),azimuthal:i,polar:n};var r,i,n}interpolate(e,t,r){return{x:re.number(e.x,t.x,r),y:re.number(e.y,t.y,r),z:re.number(e.z,t.z,r),azimuthal:re.number(e.azimuthal,t.azimuthal,r),polar:re.number(e.polar,t.polar,r)}}},color:new re.DataConstantProperty(re.spec.light.color),intensity:new re.DataConstantProperty(re.spec.light.intensity)}),u="-transition";class p extends re.Evented{constructor(e){super(),this._transitionable=new re.Transitionable(h),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t={}){if(!this._validate(re.validateLight,e,t))for(const t in e){var r=e[t];re.endsWith(t,u)?this._transitionable.setTransition(t.slice(0,-u.length),r):this._transitionable.setValue(t,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,r){return(!r||!1!==r.validate)&&re.emitValidationErrors(this,e.call(re.validateStyle,re.extend({value:t,style:{glyphs:!0,sprite:!0},styleSpec:re.spec})))}}const m=new re.Properties({source:new re.DataConstantProperty(re.spec.terrain.source),exaggeration:new re.DataConstantProperty(re.spec.terrain.exaggeration)}),_="-transition";class v extends re.Evented{constructor(e){super(),this._transitionable=new re.Transitionable(m),this.set(e),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(e){for(const r in e){var t=e[r];re.endsWith(r,_)?this._transitionable.setTransition(r.slice(0,-_.length),t):this._transitionable.setValue(r,t)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function y(e,t,r,i){var n=re.smoothstep(45,65,r),[r,i]=x(e,i),t=re.length(t),r=1-Math.min(1,Math.exp((t-r)/(i-r)*-6));return r*=r*r,(r=Math.min(1,1.00747*r))*n*e.alpha}function x(e,t){t=.5/Math.tan(.5*t);return[e.range[0]+t,e.range[1]+t]}const b=new re.Properties({range:new re.DataConstantProperty(re.spec.fog.range),color:new re.DataConstantProperty(re.spec.fog.color),"horizon-blend":new re.DataConstantProperty(re.spec.fog["horizon-blend"])}),w="-transition";class E extends re.Evented{constructor(e,t){super(),this._transitionable=new re.Transitionable(b),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=t}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,t={}){if(!this._validate(re.validateFog,e,t))for(const t in e){var r=e[t];re.endsWith(t,w)?this._transitionable.setTransition(t.slice(0,-w.length),r):this._transitionable.setValue(t,r)}}getOpacity(e){if(this.isSoftDisabled())return 0;var t=this.properties&&this.properties.get("color")||1;return re.smoothstep(45,65,e)*t.a}getOpacityAtLatLng(e,t){return this.isSoftDisabled()?0:(r=this.state,i=t,t=re.MercatorCoordinate.fromLngLat(e),e=i.elevation?i.elevation.getAtPointOrZero(t):0,e=[t.x,t.y,e],re.transformMat4$1(e,e,i.mercatorFogMatrix),y(r,e,i.pitch,i._fov));var r,i}getFovAdjustedRange(e){return this.isSoftDisabled()?[0,1]:x(this.state,e)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,r){return(!r||!1!==r.validate)&&re.emitValidationErrors(this,e.call(re.validateStyle,re.extend({value:t,style:{glyphs:!0,sprite:!0},styleSpec:re.spec})))}}class S{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=re.uniqueId();var i=this.workerPool.acquire(this.id);for(let e=0;e<i.length;e++){const t=new S.Actor(i[e],r,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,i,e){re.asyncAll(this.actors,(e,t)=>{e.send(r,i,t)},e=e||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}function M(e,t,r){return t*(re.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}S.Actor=re.Actor;class A{constructor(e,t,r,i){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(e=>i.pointCoordinate3D(e)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(e,t){let r,i;var n;return i=e instanceof re.pointGeometry||"number"==typeof e[0]?(n=re.pointGeometry.convert(e),r=[re.pointGeometry.convert(e)],t.isPointAboveHorizon(n)):(n=re.pointGeometry.convert(e[0]),e=re.pointGeometry.convert(e[1]),r=[n,e],re.polygonizeBounds(n,e).every(e=>t.isPointAboveHorizon(e))),new A(r,t.getCameraPoint(),i,t)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return re.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const t=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new re.pointGeometry(1,1)):this.screenBounds[1],i=re.polygonizeBounds(t,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>t.x&&this.cameraPoint.x<r.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?i[2]=this.cameraPoint:this.cameraPoint.x<=t.x&&(i[3]=this.cameraPoint)),re.bufferConvexPolygon(i,e)}containsTile(t,e,r){const i=t.queryPadding+1,n=t.tileID.wrap,a=r?this._bufferedCameraMercator(i,e).map(e=>re.getTilePoint(t.tileTransform,e,n)):this._bufferedScreenMercator(i,e).map(e=>re.getTilePoint(t.tileTransform,e,n)),s=this.screenGeometryMercator.map(e=>re.getTileVec3(t.tileTransform,e,n)),o=s.map(e=>new re.pointGeometry(e[0],e[1])),l=e.getFreeCameraOptions().position||new re.MercatorCoordinate(0,0,0),c=re.getTileVec3(t.tileTransform,l,n),h=s.map(e=>{e=re.sub(e,e,c);return re.normalize(e,e),new d(c,e)}),u=M(t,1,e.zoom);if(re.polygonIntersectsBox(a,0,0,re.EXTENT,re.EXTENT))return{queryGeometry:this,tilespaceGeometry:o,tilespaceRays:h,bufferedTilespaceGeometry:a,bufferedTilespaceBounds:((e=re.getBounds(a)).min.x=re.clamp(e.min.x,0,re.EXTENT),e.min.y=re.clamp(e.min.y,0,re.EXTENT),e.max.x=re.clamp(e.max.x,0,re.EXTENT),e.max.y=re.clamp(e.max.y,0,re.EXTENT),e),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:u}}_bufferedScreenMercator(e,t){var r=C(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];e=this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e));return this._screenRaycastCache[r]=e}_bufferedCameraMercator(e,t){var r=C(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];e=this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e));return this._cameraRaycastCache[r]=e}}function C(e){return 100*e|0}function I(r,i,n){function e(e,t){if(e)return n(e);if(t){const e=re.pick(re.extend(t,r),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);t.vector_layers&&(e.vectorLayers=t.vector_layers,e.vectorLayerIds=e.vectorLayers.map(e=>e.id)),e.tiles=i.canonicalizeTileset(e,r.url),n(null,e)}}return r.url?re.getJSON(i.transformRequest(i.normalizeSourceURL(r.url),re.ResourceType.Source),e):re.exported.frame(()=>e(null,r))}class R{constructor(e,t,r){this.bounds=re.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){var t=Math.pow(2,e.z),r=Math.floor(re.mercatorXfromLng(this.bounds.getWest())*t),i=Math.floor(re.mercatorYfromLat(this.bounds.getNorth())*t),n=Math.ceil(re.mercatorXfromLng(this.bounds.getEast())*t),t=Math.ceil(re.mercatorYfromLat(this.bounds.getSouth())*t);return e.x>=r&&e.x<n&&e.y>=i&&e.y<t}}class D{constructor(e,t,r){const i=(this.context=e).gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const O={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class k{constructor(e,t,r,i){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=i;const n=(this.context=e).gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(t,r){for(let e=0;e<this.attributes.length;e++){var i=r.attributes[this.attributes[e].name];void 0!==i&&t.enableVertexAttribArray(i)}}setVertexAttribPointers(t,r,i){for(let e=0;e<this.attributes.length;e++){var n=this.attributes[e],a=r.attributes[n.name];void 0!==a&&t.vertexAttribPointer(a,n.components,t[O[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class B{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class F extends B{getDefault(){return re.Color.transparent}set(e){var t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!this.dirty||(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class z extends B{getDefault(){return 1}set(e){e===this.current&&!this.dirty||(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class N extends B{getDefault(){return 0}set(e){e===this.current&&!this.dirty||(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class U extends B{getDefault(){return[!0,!0,!0,!0]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!this.dirty||(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class G extends B{getDefault(){return!0}set(e){e===this.current&&!this.dirty||(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class V extends B{getDefault(){return 255}set(e){e===this.current&&!this.dirty||(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class $ extends B{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){var t=this.current;e.func===t.func&&e.ref===t.ref&&e.mask===t.mask&&!this.dirty||(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class j extends B{getDefault(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&!this.dirty||(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class H extends B{getDefault(){return!1}set(e){if(e!==this.current||this.dirty){const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}}class W extends B{getDefault(){return[0,1]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&!this.dirty||(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Z extends B{getDefault(){return!1}set(e){if(e!==this.current||this.dirty){const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}}class q extends B{getDefault(){return this.gl.LESS}set(e){e===this.current&&!this.dirty||(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class X extends B{getDefault(){return!1}set(e){if(e!==this.current||this.dirty){const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}}class Y extends B{getDefault(){var e=this.gl;return[e.ONE,e.ZERO]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&!this.dirty||(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class K extends B{getDefault(){return re.Color.transparent}set(e){var t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!this.dirty||(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class J extends B{getDefault(){return this.gl.FUNC_ADD}set(e){e===this.current&&!this.dirty||(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Q extends B{getDefault(){return!1}set(e){if(e!==this.current||this.dirty){const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}}class ee extends B{getDefault(){return this.gl.BACK}set(e){e===this.current&&!this.dirty||(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class te extends B{getDefault(){return this.gl.CCW}set(e){e===this.current&&!this.dirty||(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ie extends B{getDefault(){return null}set(e){e===this.current&&!this.dirty||(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ne extends B{getDefault(){return this.gl.TEXTURE0}set(e){e===this.current&&!this.dirty||(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ae extends B{getDefault(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!this.dirty||(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class se extends B{getDefault(){return null}set(e){if(e!==this.current||this.dirty){const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}}class oe extends B{getDefault(){return null}set(e){if(e!==this.current||this.dirty){const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}}class le extends B{getDefault(){return null}set(e){if(e!==this.current||this.dirty){const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}}class ce extends B{getDefault(){return null}set(e){if(e!==this.current||this.dirty){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}}class he extends B{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ue extends B{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class de extends B{getDefault(){return 4}set(e){if(e!==this.current||this.dirty){const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}}class pe extends B{getDefault(){return!1}set(e){if(e!==this.current||this.dirty){const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}}class fe extends B{getDefault(){return!1}set(e){if(e!==this.current||this.dirty){const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}}class me extends B{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class ge extends me{setDirty(){this.dirty=!0}set(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}}class _e extends me{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}}class ve extends _e{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ye{constructor(e,t,r,i){this.context=e,this.width=t,this.height=r;r=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new ge(e,r),i&&(this.depthAttachment=new _e(e,r))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class xe{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new F(this),this.clearDepth=new z(this),this.clearStencil=new N(this),this.colorMask=new U(this),this.depthMask=new G(this),this.stencilMask=new V(this),this.stencilFunc=new $(this),this.stencilOp=new j(this),this.stencilTest=new H(this),this.depthRange=new W(this),this.depthTest=new Z(this),this.depthFunc=new q(this),this.blend=new X(this),this.blendFunc=new Y(this),this.blendColor=new K(this),this.blendEquation=new J(this),this.cullFace=new Q(this),this.cullFaceSide=new ee(this),this.frontFace=new te(this),this.program=new ie(this),this.activeTexture=new ne(this),this.viewport=new ae(this),this.bindFramebuffer=new se(this),this.bindRenderbuffer=new oe(this),this.bindTexture=new le(this),this.bindVertexBuffer=new ce(this),this.bindElementBuffer=new he(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ue(this),this.pixelStoreUnpack=new de(this),this.pixelStoreUnpackPremultiplyAlpha=new pe(this),this.pixelStoreUnpackFlipY=new fe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new D(this,e,t)}createVertexBuffer(e,t,r){return new k(this,e,t,r)}createRenderbuffer(e,t,r){const i=this.gl,n=i.createRenderbuffer();return this.bindRenderbuffer.set(n),i.renderbufferStorage(i.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,r){return new ye(this,e,t,r)}clear({color:e,depth:t,stencil:r}){const i=this.gl;let n=0;e&&(n|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(n|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==r&&(n|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),i.clear(n)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){g(e.blendFunction,re.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class be extends re.Evented{constructor(e,t,r,i){super(),this.id=e,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=re.extend({type:"raster"},t),re.extend(this,re.pick(t,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new re.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,(e,t)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new re.ErrorEvent(e)):t&&(re.extend(this,t),t.bounds&&(this.tileBounds=new R(t.bounds,this.minzoom,this.maxzoom)),re.postTurnstileEvent(t.tiles),this.fire(new re.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new re.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return re.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(a,s){var e=2<=re.exported.devicePixelRatio,e=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),e,this.tileSize);a.request=re.getImage(this.map._requestManager.transformRequest(e,re.ResourceType.Tile),(e,t,r,i)=>{if(delete a.request,a.aborted)a.state="unloaded",s(null);else if(e)a.state="errored",s(e);else if(t){this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:r,expires:i});const e=this.map.painter.context,n=e.gl;a.texture=this.map.painter.getTileTexture(t.width),a.texture?a.texture.update(t,{useMipmap:!0}):(a.texture=new re.Texture(e,t,n.RGBA,{useMipmap:!0}),a.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax)),a.state="loaded",re.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}let we;class Te extends re.Evented{constructor(e,t,r,i){super(),this.id=e,this.dispatcher=r,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=t}load(r,i){this._loaded=!1,this.fire(new re.Event("dataloading",{dataType:"source"})),this.url=this.options.url,re.getImage(this.map._requestManager.transformRequest(this.url,re.ResourceType.Image),(e,t)=>{this._loaded=!0,e?this.fire(new re.ErrorEvent(e)):t&&(this.image=re.exported.getImageData(t),r&&(this.coordinates=r),i&&i(),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url&&(this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new re.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}setCoordinates(e){this.coordinates=e,delete this._boundsArray;var s=e.map(re.MercatorCoordinate.fromLngLat);return this.tileID=function(){let e=1/0,t=1/0,r=-1/0,i=-1/0;for(const re of s)e=Math.min(e,re.x),t=Math.min(t,re.y),r=Math.max(r,re.x),i=Math.max(i,re.y);var n=Math.max(r-e,i-t),a=Math.max(0,Math.floor(-Math.log(n)/Math.LN2)),n=Math.pow(2,a);return new re.CanonicalTileID(a,Math.floor((e+r)/2*n),Math.floor((t+i)/2*n))}(),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new re.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const t=re.tileTransform(this.tileID,this.map.transform.projection),e=this.coordinates.map(e=>{e=t.projection.project(e[0],e[1]);return re.getTilePoint(t,e)._round()});return this._boundsArray=new re.StructArrayLayout4i8,this._boundsArray.emplaceBack(e[0].x,e[0].y,0,0),this._boundsArray.emplaceBack(e[1].x,e[1].y,re.EXTENT,0),this._boundsArray.emplaceBack(e[3].x,e[3].y,0,re.EXTENT),this._boundsArray.emplaceBack(e[2].x,e[2].y,re.EXTENT,re.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0!==Object.keys(this.tiles).length&&this.image){const e=this.map.painter.context,t=e.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,re.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=re.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new re.Texture(e,this.image,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const re in this.tiles){const e=this.tiles[re];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e).buckets={}:e.state="errored",t(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}function Ee(e,t,r,i){if((i=new Se[t.type](e,t,r,i)).id!==e)throw new Error(`Expected Source id to be ${e} instead of ${i.id}`);return re.bindAll(["load","abort","unload","serialize","prepare"],i),i}const Se={vector:class extends re.Evented{constructor(e,t,r,i){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,re.extend(this,re.pick(t,["url","scheme","tileSize","promoteId"])),this._options=re.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new re.DedupedRequest}load(){this._loaded=!1,this.fire(new re.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,(e,t)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new re.ErrorEvent(e)):t&&(re.extend(this,t),t.bounds&&(this.tileBounds=new R(t.bounds,this.minzoom,this.maxzoom)),re.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new re.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new re.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e();for(const e of this.map.style._getSourceCaches(this.id))e.clearTiles();this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return re.extend({},this._options)}loadTile(r,i){const e=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(e,re.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:re.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(n.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=i:r.request=r.actor.send("reloadTile",n,a.bind(this));else if(r.actor=this._tileWorkers[e]=this._tileWorkers[e]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",n,a.bind(this),void 0,!0);else{const i=re.loadVectorTile.call({deduped:this._deduped},n,(e,t)=>{e||!t?a.call(this,e):(n.data={cacheControl:t.cacheControl,expires:t.expires,rawData:t.rawData.slice(0)},r.actor&&r.actor.send("loadTile",n,a.bind(this),void 0,!0))},!0);r.request={cancel:i}}function a(e,t){return delete r.request,r.aborted?i(null):e&&404!==e.status?i(e):(t&&t.resourceTiming&&(r.resourceTiming=t.resourceTiming),this.map._refreshExpiredTiles&&t&&r.setExpiryData(t),r.loadVectorData(t,this.map.painter),re.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:be,"raster-dem":class extends be{constructor(e,t,r,i){super(e,t,r,i),this.type="raster-dem",this.maxzoom=22,this._options=re.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(n,a){var e=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function s(e,t){e&&(n.state="errored",a(e)),t&&(n.dem=t,n.dem.onDeserialize(),n.needsHillshadePrepare=!0,n.needsDEMTextureUpload=!0,n.state="loaded",a(null))}n.request=re.getImage(this.map._requestManager.transformRequest(e,re.ResourceType.Tile),function(e,t,r,i){if(delete n.request,n.aborted)n.state="unloaded",a(null);else if(e)n.state="errored",a(e);else if(t){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:r,expires:i});const a=re.window.ImageBitmap&&t instanceof re.window.ImageBitmap&&(null==we&&(we=re.window.OffscreenCanvas&&new re.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof re.window.createImageBitmap),we),e=1-(t.width-re.prevPowerOfTwo(t.width))/2;e<1||n.neighboringTiles||(n.neighboringTiles=this._getNeighboringTiles(n.tileID));t=a?t:re.exported.getImageData(t,e),t={uid:n.uid,coord:n.tileID,source:this.id,rawImageData:t,encoding:this.encoding,padding:e};n.actor&&"expired"!==n.state||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",t,s.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const t=e.canonical,r=Math.pow(2,t.z),i=(t.x-1+r)%r,n=0===t.x?e.wrap-1:e.wrap,a=(t.x+1+r)%r,s=t.x+1===r?e.wrap+1:e.wrap,o={};return o[new re.OverscaledTileID(e.overscaledZ,n,t.z,i,t.y).key]={backfilled:!1},o[new re.OverscaledTileID(e.overscaledZ,s,t.z,a,t.y).key]={backfilled:!1},0<t.y&&(o[new re.OverscaledTileID(e.overscaledZ,n,t.z,i,t.y-1).key]={backfilled:!1},o[new re.OverscaledTileID(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},o[new re.OverscaledTileID(e.overscaledZ,s,t.z,a,t.y-1).key]={backfilled:!1}),t.y+1<r&&(o[new re.OverscaledTileID(e.overscaledZ,n,t.z,i,t.y+1).key]={backfilled:!1},o[new re.OverscaledTileID(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},o[new re.OverscaledTileID(e.overscaledZ,s,t.z,a,t.y+1).key]={backfilled:!1}),o}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends re.Evented{constructor(e,t,r,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(i),this._data=t.data,this._options=re.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;i=re.EXTENT/this.tileSize;this.workerOptions=re.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*i,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*i,extent:re.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:re.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*i,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,r,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:r},i),this}_updateWorkerData(){if(this._pendingLoad)this._coalesce=!0;else{this.fire(new re.Event("dataloading",{dataType:"source"})),this._loaded=!1;const e=re.extend({},this.workerOptions),t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(re.exported.resolveURL(t),re.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(e,t)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new re.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&t&&t.resourceTiming&&t.resourceTiming[this.id]&&(e.resourceTiming=t.resourceTiming[this.id]),this.fire(new re.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}}loaded(){return this._loaded}loadTile(r,i){const n=r.actor?"reloadTile":"loadTile";r.actor=this.actor,r.request=this.actor.send(n,{type:this.type,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:re.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(e,t)=>(delete r.request,r.unloadVectorData(),r.aborted?i(null):e?i(e):(r.loadVectorData(t,this.map.painter,"reloadTile"==n),i(null))),void 0,"loadTile"==n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return re.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Te{constructor(e,t,r,i){super(e,t,r,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;var e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,re.ResourceType.Source).url);re.getVideo(this.urls,(e,t)=>{this._loaded=!0,e?this.fire(new re.ErrorEvent(e)):t&&(this.video=t,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new re.ErrorEvent(new re.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){const e=this.map.painter.context,t=e.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,re.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=re.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new re.Texture(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const re in this.tiles){const e=this.tiles[re];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Te,canvas:class extends Te{constructor(e,t,r,i){super(e,t,r,i),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new re.ErrorEvent(new re.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new re.ErrorEvent(new re.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new re.ErrorEvent(new re.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof re.window.HTMLCanvasElement||this.fire(new re.ErrorEvent(new re.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new re.ErrorEvent(new re.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof re.window.HTMLCanvasElement?this.options.canvas:re.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new re.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){const t=this.map.painter.context,r=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,re.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=re.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new re.Texture(t,this.canvas,r.RGBA,{premultiply:!0});for(const re in this.tiles){const e=this.tiles[re];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}};function Me(i,e,t,r,n,a,s,o=!1){const l=i.tilesIn(r,s,o);l.sort(Ae);const c=[];for(const r of l)c.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,t,i._state,r,n,a,(h=i.transform,u=r.tile.tileID,d=void 0,d=re.identity([]),re.scale$1(d,d,[.5*h.width,.5*-h.height,1]),re.translate(d,d,[1,-1,0]),re.multiply(d,d,h.calculateProjMatrix(u.toUnwrapped()))),o)});var h,u,d;const p=function(e){const t={},r={};for(const i of e){const e=i.queryResults,n=i.wrappedTileID,a=r[n]=r[n]||{};for(const r in e){const s=e[r],o=a[r]=a[r]||{},l=t[r]=t[r]||[];for(const e of s)o[e.featureIndex]||(o[e.featureIndex]=!0,l.push(e))}}return t}(c);for(const e in p)p[e].forEach(e=>{const t=e.feature,r=i.getFeatureState(t.layer["source-layer"],t.id);t.source=t.layer.source,t.layer["source-layer"]&&(t.sourceLayer=t.layer["source-layer"]),t.state=r});return p}function Ae(e,t){e=e.tileID,t=t.tileID;return e.overscaledZ-t.overscaledZ||e.canonical.y-t.canonical.y||e.wrap-t.wrap||e.canonical.x-t.canonical.x}function Ce(){return null!=An.workerClass?new An.workerClass:new re.window.Worker(An.workerUrl)}const Le="mapboxgl_preloaded_worker_pool";class Pe{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Pe.workerCount;)this.workers.push(new Ce);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Le]}numActive(){return Object.keys(this.active).length}}let Ie;function Re(){return Ie=Ie||new Pe,Ie}function De(t){t=t.slice();const r=Object.create(null);for(let e=0;e<t.length;e++)r[t[e].id]=t[e];for(let e=0;e<t.length;e++)"ref"in t[e]&&(t[e]=function(e,t){const r={};for(const re in e)"ref"!==re&&(r[re]=e[re]);return re.refProperties.forEach(e=>{e in t&&(r[e]=t[e])}),r}(t[e],r[t[e].ref]));return t}Pe.workerCount=2;const Oe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ke(e,t,r){r.push({command:Oe.addSource,args:[e,t[e]]})}function Be(e,t,r){t.push({command:Oe.removeSource,args:[e]}),r[e]=!0}function Fe(e,t,r,i,n,a){let s;for(s in t=t||{},e=e||{})e.hasOwnProperty(s)&&(g(e[s],t[s])||r.push({command:a,args:[i,s,t[s],n]}));for(s in t)t.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(g(e[s],t[s])||r.push({command:a,args:[i,s,t[s],n]}))}function ze(e){return e.id}function Ne(e,t){return e[t.id]=t,e}class Ue{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=re.clamp(e,0,1);let t=1,r=this._distances[t];for(var i=e*this.paddedLength+this.padding;r<i&&t<this._distances.length;)r=this._distances[++t];var n=t-1,a=this._distances[n],e=r-a,e=0<e?(i-a)/e:0;return this.points[n].mult(1-e).add(this.points[t].mult(e))}}class Ge{constructor(e,t,r){const i=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let e=0;e<this.xCellCount*this.yCellCount;e++)i.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,i,n){this._forEachCell(t,r,i,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)}insertCircle(e,t,r,i){this._forEachCell(t-i,r-i,t+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(i)}_insertBoxCell(e,t,r,i,n,a){this.boxCells[n].push(a)}_insertCircleCell(e,t,r,i,n,a){this.circleCells[n].push(a)}_query(e,t,r,i,n,a){if(r<0||e>this.width||i<0||t>this.height)return!n&&[];const s=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=i){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],r=this.circles[3*e+1],i=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-i,y1:r-i,x2:t+i,y2:r+i})}return a?s.filter(a):s}return this._forEachCell(e,t,r,i,this._queryCell,s,{hitTest:n,seenUids:{box:{},circle:{}}},a),n?0<s.length:s}_queryCircle(e,t,r,i,n){var a=e-r,s=e+r,o=t-r,l=t+r;if(s<0||a>this.width||l<0||o>this.height)return!i&&[];var c=[];return this._forEachCell(a,o,s,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},n),i?0<c.length:c}query(e,t,r,i,n){return this._query(e,t,r,i,!1,n)}hitTest(e,t,r,i,n){return this._query(e,t,r,i,!0,n)}hitTestCircle(e,t,r,i){return this._queryCircle(e,t,r,!0,i)}_queryCell(e,t,r,i,n,a,s,o){const l=s.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const h of c)if(!l.box[h]){l.box[h]=!0;const c=4*h;if(e<=n[2+c]&&t<=n[3+c]&&r>=n[0+c]&&i>=n[1+c]&&(!o||o(this.boxKeys[h]))){if(s.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[h],x1:n[c],y1:n[1+c],x2:n[2+c],y2:n[3+c]})}}}const h=this.circleCells[n];if(null!==h){const n=this.circles;for(const c of h)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(n[h],n[1+h],n[2+h],e,t,r,i)&&(!o||o(this.circleKeys[c]))){if(s.hitTest)return a.push(!0),!0;{const e=n[h],t=n[1+h],r=n[2+h];a.push({key:this.circleKeys[c],x1:e-r,y1:t-r,x2:e+r,y2:t+r})}}}}}_queryCellCircle(e,t,r,i,n,a,s,o){const l=s.circle,c=s.seenUids,h=this.boxCells[n];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const r=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[0+r],e[1+r],e[2+r],e[3+r])&&(!o||o(this.boxKeys[t])))return a.push(!0),!0}}n=this.circleCells[n];if(null!==n){const e=this.circles;for(const t of n)if(!c.circle[t]){c.circle[t]=!0;const r=3*t;if(this._circlesCollide(e[r],e[1+r],e[2+r],l.x,l.y,l.radius)&&(!o||o(this.circleKeys[t])))return a.push(!0),!0}}}_forEachCell(r,i,n,a,s,o,l,c){var e=this._convertToXCellCoord(r),h=this._convertToYCellCoord(i),u=this._convertToXCellCoord(n),d=this._convertToYCellCoord(a);for(let t=e;t<=u;t++)for(let e=h;e<=d;e++)if(s.call(this,r,i,n,a,this.xCellCount*e+t,o,l,c))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,i,n,a){e=i-e,t=n-t,a=r+a;return e*e+t*t<a*a}_circleAndRectCollide(e,t,r,i,n,a,s){a=(a-i)/2,i=Math.abs(e-(i+a));if(a+r<i)return!1;s=(s-n)/2,n=Math.abs(t-(n+s));if(s+r<n)return!1;if(i<=a||n<=s)return!0;a=i-a,s=n-s;return a*a+s*s<=r*r}}const Ve=Math.tan(85*Math.PI/180);function $e(e,t,r,i,n){const a=re.create$1();if(t){const e=T([],n);a[0]=e[0],a[1]=e[1],a[4]=e[2],a[5]=e[3],r||re.rotateZ(a,a,i.angle)}else re.multiply(a,i.labelPlaneMatrix,e);return a}function je(e,t,r,i,n){if(t){const t=re.clone$1(e),a=re.identity([]);return a[0]=n[0],a[1]=n[1],a[4]=n[2],a[5]=n[3],re.multiply(t,t,a),r||re.rotateZ(t,t,-i.angle),t}return i.glCoordMatrix}function He(e,t,r=0){e=[e.x,e.y,r,1];r?re.transformMat4(e,e,t):rt(e,e,t);t=e[3];return{point:new re.pointGeometry(e[0]/t,e[1]/t),signedDistanceFromCamera:t}}function We(e,t){return Math.min(.5+e/t*.5,1.5)}function Ze(t,r,i,e,n,a,s,o,l){const c=e?t.textSizeData:t.iconSizeData,h=re.evaluateSizeForZoom(c,i.transform.zoom),u=[256/i.width*2+1,256/i.height*2+1],d=(e?t.text:t.icon).dynamicLayoutVertexArray;d.clear();const p=t.lineVertexArray,f=(e?t.text:t.icon).placedSymbolArray,m=i.transform.width/i.transform.height;let g=!1;for(let e=0;e<f.length;e++){var _=f.get(e);if(_.writingMode!==re.WritingMode.vertical||g||0!==e&&f.get(e-1).writingMode===re.WritingMode.horizontal||(g=!0),_.hidden||_.writingMode===re.WritingMode.vertical&&!g)tt(_.numGlyphs,d);else{g=!1;var v=new re.pointGeometry(_.tileAnchorX,_.tileAnchorY),y=l?l(v):0,x=[v.x,v.y,y],b=[...x,1];if(re.transformMat4(b,b,r),w=u,T=void 0,T=(y=b)[0]/y[3],y=y[1]/y[3],T>=-w[0]&&T<=w[0]&&y>=-w[1]&&y<=w[1]){y=We(i.transform.cameraToCenterDistance,b[3]),w=re.evaluateSizeForFeature(c,h,_),b=s?w/y:w*y,w=He(new re.pointGeometry(x[0],x[1]),n,x[2]);if(w.signedDistanceFromCamera<=0)tt(_.numGlyphs,d);else{let e={};y=s?null:l,x=Ye(_,b,!1,o,r,n,a,t.glyphOffsetArray,p,d,w.point,v,e,m,y);g=x.useVertical,y&&x.needsFlipping&&(e={}),(x.notEnoughRoom||g||x.needsFlipping&&Ye(_,b,!0,o,r,n,a,t.glyphOffsetArray,p,d,w.point,v,e,m,y).notEnoughRoom)&&tt(_.numGlyphs,d)}}else tt(_.numGlyphs,d)}}var w,T;(e?t.text:t.icon).dynamicLayoutVertexBuffer.updateData(d)}function qe(e,t,r,i,n,a,s,o,l,c,h,u,d){var p=o.glyphStartIndex+o.numGlyphs,f=o.lineStartIndex,m=o.lineStartIndex+o.lineLength,g=t.getoffsetX(o.glyphStartIndex),p=t.getoffsetX(p-1),g=Qe(e*g,r,i,n,a,s,o.segment,f,m,l,c,h,u,d,!0);if(!g)return null;d=Qe(e*p,r,i,n,a,s,o.segment,f,m,l,c,h,u,d,!0);return d?{first:g,last:d}:null}function Xe(e,t,r,i){return e.writingMode===re.WritingMode.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*i?{useVertical:!0}:e.writingMode===re.WritingMode.vertical?t.y<r.y?{needsFlipping:!0}:null:0!==e.flipState&&(0==(i=(r.x-t.x)*i)||Math.abs((r.y-t.y)/i)>Ve)?1===e.flipState?{needsFlipping:!0}:null:t.x>r.x?{needsFlipping:!0}:null}function Ye(t,e,r,i,n,a,s,o,l,c,h,u,d,p,f){var m=e/24,g=t.lineOffsetX*m,_=t.lineOffsetY*m;let v;if(1<t.numGlyphs){const re=t.glyphStartIndex+t.numGlyphs,y=t.lineStartIndex,n=t.lineStartIndex+t.lineLength,c=qe(m,o,g,_,r,h,u,t,l,a,d,f,!1);if(!c)return{notEnoughRoom:!0};e=He(c.first.point,s).point,s=He(c.last.point,s).point;if(i&&!r){const re=Xe(t,e,s,p);if(t.flipState=re&&re.needsFlipping?1:2,re)return re}v=[c.first];for(let e=t.glyphStartIndex+1;e<re-1;e++)v.push(Qe(m*o.getoffsetX(e),g,_,r,h,u,t.segment,y,n,l,a,d,f,!1,!1));v.push(c.last)}else{if(i&&!r){const y=He(u,n).point,r=t.lineStartIndex+t.segment+1,i=new re.pointGeometry(l.getx(r),l.gety(r)),a=He(i,n),x=Xe(t,y,0<a.signedDistanceFromCamera?a.point:Je(u,i,y,1,n,void 0),p);if(t.flipState=x&&x.needsFlipping?1:2,x)return x}const y=Qe(m*o.getoffsetX(t.glyphStartIndex),g,_,r,h,u,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,l,a,d,f,!1,!1);if(!y)return{notEnoughRoom:!0};v=[y]}for(const t of v)re.addDynamicAttributes(c,t.point,t.angle);return{}}function Ke(e,t,r){var i={x:e.x,y:e.y,z:0};if(!r)return He(i,t,i.z);e=r(e);return He(new re.pointGeometry(i.x,i.y),t,i.z+e)}function Je(e,t,r,i,n,a){const s=Ke(e.add(e.sub(t)._unit()),n,a).point,o=r.sub(s);return r.add(o._mult(i/o.mag()))}function Qe(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f){t=i?e-t:e+t;let m=0<t?1:-1,g=0;i&&(m*=-1,g=Math.PI),m<0&&(g+=Math.PI);let _=0<m?o+s:o+s+1,v=n,y=n,x=0,b=0;const w=Math.abs(t),T=[],E=[];let S=a;const M=()=>{var e=_-m;return 0===x?a:new re.pointGeometry(c.getx(e),c.gety(e))},A=()=>Je(M(),S,y,w-x+1,h,d);for(;x+b<=w;){if(_+=m,_<o||_>=l)return null;if(y=v,T.push(v),p&&E.push(S||M()),v=u[_],void 0===v){S=new re.pointGeometry(c.getx(_),c.gety(_));const e=Ke(S,h,d);v=0<e.signedDistanceFromCamera?u[_]=e.point:A()}else S=null;x+=b,b=y.dist(v)}f&&d&&(S=S||new re.pointGeometry(c.getx(_),c.gety(_)),u[_]=v=void 0===u[_]?v:A(),b=y.dist(v));const C=(w-x)/b,L=v.sub(y),P=L.mult(C)._add(y);r&&P._add(L._unit()._perp()._mult(r*m));n=g+Math.atan2(v.y-y.y,v.x-y.x);return T.push(P),p&&(S=S||new re.pointGeometry(c.getx(_),c.gety(_)),E.push((t=0<E.length?E[E.length-1]:S,f=S,r=1-C,new re.pointGeometry(t.x*r+f.x*C,t.y*r+f.y*C)))),{point:P,angle:n,path:T,tilePath:E}}const et=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function tt(t,r){for(let e=0;e<t;e++){const t=r.length;r.resize(t+4),r.float32.set(et,3*t)}}function rt(e,t,r){var i=t[0],t=t[1];return e[0]=r[0]*i+r[4]*t+r[12],e[1]=r[1]*i+r[5]*t+r[13],e[3]=r[3]*i+r[7]*t+r[15],e}class it{constructor(e,t,r=new Ge(e.width+200,e.height+200,25),i=new Ge(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,r,i,n,a,s){let o=t.projectedAnchorZ;t.elevation&&(o+=t.elevation);var l=this.projectAndGetPerspectiveRatio(a,t.projectedAnchorX,t.projectedAnchorY,o,t.tileID),c=n*l.perspectiveRatio,h=(t.x1*e+r.x-t.padding)*c+l.point.x,a=(t.y1*e+r.y-t.padding)*c+l.point.y,n=(t.x2*e+r.x+t.padding)*c+l.point.x,c=(t.y2*e+r.y+t.padding)*c+l.point.y,l=l.perspectiveRatio<=.55||l.aboveHorizon;return!this.isInsideGrid(h,a,n,c)||!i&&this.grid.hitTest(h,a,n,c,s)||l?{box:[],offscreen:!1}:{box:[h,a,n,c],offscreen:this.isOffscreen(h,a,n,c)}}placeCollisionCircles(r,i,n,a,s,o,l,c,h,u,d,p,f,m){const g=[],_=this.transform.elevation,v=_?e=>_.getAtTileOffset(m,e.x,e.y):e=>0,e=new re.pointGeometry(i.tileAnchorX,i.tileAnchorY),t=v(e),y=this.projectAndGetPerspectiveRatio(o,e.x,e.y,t,m),x=y["perspectiveRatio"],b=(u?s/x:s*x)/re.ONE_EM,w=He(e,l,t).point,T=0<y.signedDistanceFromCamera?qe(b,a,i.lineOffsetX*b,i.lineOffsetY*b,!1,w,e,i,n,l,{},_&&!u?v:null,u&&!!_):null;let E=!1,S=!1,M=!0;if(T&&!y.aboveHorizon){const i=.5*p*x+f,n=new re.pointGeometry(-100,-100),a=new re.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),s=new Ue,o=T.first,l=T.last;let t=[];for(let e=o.path.length-1;1<=e;e--)t.push(o.path[e]);for(let e=1;e<l.path.length;e++)t.push(l.path[e]);const m=2.5*i;if(c){const re=t.map(_?(e,t)=>{t=v(t<o.path.length-1?o.tilePath[o.path.length-1-t]:l.tilePath[t-o.path.length+2]);return He(e,c,t)}:e=>He(e,c));t=re.some(e=>e.signedDistanceFromCamera<=0)?[]:re.map(e=>e.point)}let e=[];if(0<t.length){const r=t[0].clone(),i=t[0].clone();for(let e=1;e<t.length;e++)r.x=Math.min(r.x,t[e].x),r.y=Math.min(r.y,t[e].y),i.x=Math.max(i.x,t[e].x),i.y=Math.max(i.y,t[e].y);e=r.x>=n.x&&i.x<=a.x&&r.y>=n.y&&i.y<=a.y?[t]:i.x<n.x||r.x>a.x||i.y<n.y||r.y>a.y?[]:re.clipLine([t],n.x,n.y,a.x,a.y)}for(const re of e){s.reset(re,.25*i);var A=s.length<=.5*i?1:Math.ceil(s.paddedLength/m)+1;for(let e=0;e<A;e++){const a=e/Math.max(A-1,1),o=s.lerp(a),l=o.x+100,c=o.y+100;g.push(l,c,i,0);const u=l-i,p=c-i,f=l+i,m=c+i;if(M=M&&this.isOffscreen(u,p,f,m),S=S||this.isInsideGrid(u,p,f,m),!r&&this.grid.hitTestCircle(l,c,i,d)&&(E=!0,!h))return{circles:[],offscreen:!1,collisionDetected:E}}}}return{circles:!h&&E||!S?[]:g,offscreen:M,collisionDetected:E}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const t=[];let r=1/0,i=1/0,n=-1/0,a=-1/0;for(const s of e){const e=new re.pointGeometry(s.x+100,s.y+100);r=Math.min(r,e.x),i=Math.min(i,e.y),n=Math.max(n,e.x),a=Math.max(a,e.y),t.push(e)}const s=this.grid.query(r,i,n,a).concat(this.ignoredGrid.query(r,i,n,a)),o={},l={};for(const e of s){const r=e.key;if(void 0===o[r.bucketInstanceId]&&(o[r.bucketInstanceId]={}),!o[r.bucketInstanceId][r.featureIndex]){const i=[new re.pointGeometry(e.x1,e.y1),new re.pointGeometry(e.x2,e.y1),new re.pointGeometry(e.x2,e.y2),new re.pointGeometry(e.x1,e.y2)];re.polygonIntersectsPolygon(t,i)&&(o[r.bucketInstanceId][r.featureIndex]=!0,void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]=[]),l[r.bucketInstanceId].push(r.featureIndex))}}return l}insertCollisionBox(e,t,r,i,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(t,e,r,i,n){const a=e?this.ignoredGrid:this.grid,s={bucketInstanceId:r,featureIndex:i,collisionGroupID:n};for(let e=0;e<t.length;e+=4)a.insertCircle(s,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(t,r,i,n,a){var s=[r,i,n||0,1];let o=!1;if(n||0<this.transform.pitch){re.transformMat4(s,s,t);let e=!1;this.fogState&&a&&(e=.9<function(e,t,r,i,n,a){n=a.calculateFogTileMatrix(n),i=[t,r,i];return re.transformMat4$1(i,i,n),y(e,i,a.pitch,a._fov)}(this.fogState,r,i,n||0,a.toUnwrapped(),this.transform)),o=s[3]<s[2]||e}else rt(s,s,t);return{point:new re.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+100,(-s[1]/s[3]+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/s[3]*.5,1.5),signedDistanceFromCamera:s[3],aboveHorizon:o}}isOffscreen(e,t,r,i){return r<100||e>=this.screenRightBoundary||i<100||t>this.screenBottomBoundary}isInsideGrid(e,t,r,i){return 0<=r&&e<this.gridRightBoundary&&0<=i&&t<this.gridBottomBoundary}getViewportMatrix(){var e=re.identity([]);return re.translate(e,e,[-100,-100,0]),e}}class nt{constructor(e,t,r,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class at{constructor(e,t,r,i,n,a=!1){this.text=new nt(e?e.text:null,t,r,n),this.icon=new nt(e?e.icon:null,t,i,n),this.clipped=a}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class st{constructor(e,t,r,i=!1){this.text=e,this.icon=t,this.skipFade=r,this.clipped=i}}class ot{constructor(){this.invProjMatrix=re.create$1(),this.viewportMatrix=re.create$1(),this.circles=[]}}class lt{constructor(e,t,r,i,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=n}}class ct{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function ht(e,t,r,i,n){var{horizontalAlign:a,verticalAlign:s}=re.getAnchorAlignment(e),t=-(a-.5)*t,r=-(s-.5)*r,i=re.evaluateVariableOffset(e,i);return new re.pointGeometry(t+i[0]*n,r+i[1]*n)}function ut(e,t,r,i,n){const a=new re.pointGeometry(e,t);return r&&a._rotate(i?n:-n),a}class dt{constructor(e,t,r,i,n){this.transform=e.clone(),this.collisionIndex=new it(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new ct(r),this.collisionCircleArrays={},(this.prevPlacement=i)&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,i,n,a){var s=n.getBucket(i),o=n.latestFeatureIndex;if(s&&o&&i.id===s.layerIds[0]){const d=s.layers[0].layout,p=n.collisionBoxArray,f=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),m=n.tileSize/re.EXTENT,g=n.tileID.toUnwrapped(),_=this.transform.calculateProjMatrix(g),v="map"===d.get("text-pitch-alignment"),y="map"===d.get("text-rotation-alignment");i.compileFilter();var l=i.dynamicFilter(),c=i.dynamicFilterNeedsFeature(),h=this.transform.calculatePixelsToTileUnitsMatrix(n),i=$e(_,v,y,this.transform,h);let e=null;if(v){const r=je(_,v,y,this.transform,h);e=re.multiply([],this.transform.labelPlaneMatrix,r)}let t=null;l&&n.latestFeatureIndex&&(t={unwrappedTileID:g,dynamicFilter:l,dynamicFilterNeedsFeature:c,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[s.bucketInstanceId]=new lt(s.bucketInstanceId,o,s.sourceLayerIndex,s.index,n.tileID);var u={bucket:s,layout:d,posMatrix:_,textLabelPlaneMatrix:i,labelToScreenMatrix:e,clippingData:t,scale:f,textPixelRatio:m,holdingForFade:n.holdingForFade(),collisionBoxArray:p,partiallyEvaluatedTextSize:re.evaluateSizeForZoom(s.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:re.evaluateSizeForZoom(s.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(s.sourceID)};if(a)for(const re of s.sortKeyRanges){const{sortKey:x,symbolInstanceStart:n,symbolInstanceEnd:a}=re;r.push({sortKey:x,symbolInstanceStart:n,symbolInstanceEnd:a,parameters:u})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:u})}}attemptAnchorPlacement(t,r,i,n,a,e,s,o,l,c,h,u,d,p,f,m,g,_){var v=[u.textOffset0,u.textOffset1],y=ht(t,i,n,v,a),r=this.collisionIndex.placeCollisionBox(a,r,ut(y.x,y.y,e,s,this.transform.angle),h,o,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p.getSymbolInstanceIconSize(_,this.transform.zoom,d),m,ut(y.x,y.y,e,s,this.transform.angle),h,o,l,c.predicate).box.length)&&0<r.box.length){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[u.crossTileID]&&this.prevPlacement.placements[u.crossTileID]&&this.prevPlacement.placements[u.crossTileID].text&&(e=this.prevPlacement.variableOffsets[u.crossTileID].anchor),this.variableOffsets[u.crossTileID]={textOffset:v,width:i,height:n,anchor:t,textScale:a,prevAnchor:e},this.markUsedJustification(p,t,u,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,u),this.placedOrientations[u.crossTileID]=f),{shift:y,placedGlyphBoxes:r}}}placeLayerBucketPart(t,y,x,e){const{bucket:b,layout:w,posMatrix:T,textLabelPlaneMatrix:E,labelToScreenMatrix:S,clippingData:M,textPixelRatio:A,holdingForFade:r,collisionBoxArray:i,partiallyEvaluatedTextSize:C,partiallyEvaluatedIconSize:L,collisionGroup:P}=t.parameters,I=w.get("text-optional"),R=w.get("icon-optional"),D=w.get("text-allow-overlap"),O=w.get("icon-allow-overlap"),k="map"===w.get("text-rotation-alignment"),B="map"===w.get("text-pitch-alignment"),F="none"!==w.get("icon-text-fit"),n="viewport-y"===w.get("symbol-z-order"),z=D&&(O||!b.hasIconData()||R),N=O&&(D||!b.hasTextData()||I);!b.collisionArrays&&i&&b.deserializeCollisionBoxes(i),x&&e&&b.updateCollisionDebugBuffers(this.transform.zoom,i);var a=(d,p,f)=>{if(M){const x={zoom:this.transform.zoom,pitch:this.transform.pitch};let e=null;if(M.dynamicFilterNeedsFeature){const re=this.retainedQueryData[b.bucketInstanceId];e=M.featureIndex.loadFeature({featureIndex:d.featureIndex,bucketIndex:re.bucketIndex,sourceLayerIndex:re.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,M.dynamicFilter)(x,e,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new re.pointGeometry(d.tileAnchorX,d.tileAnchorY),this.transform.calculateDistanceTileData(M.unwrappedTileID)))return this.placements[d.crossTileID]=new st(!1,!1,!1,!0),void(y[d.crossTileID]=!0)}if(!y[d.crossTileID])if(r)this.placements[d.crossTileID]=new st(!1,!1,!1);else{let h=!1,e=!1,t=!0,u=null,r={box:null,offscreen:null},i={box:null,offscreen:null},n,a=null,s=null,o=0,l=0,c=0;f.textFeatureIndex?o=f.textFeatureIndex:d.useRuntimeCollisionCircles&&(o=d.featureIndex),f.verticalTextFeatureIndex&&(l=f.verticalTextFeatureIndex);const _=e=>{e.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||e.elevation)&&(e.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,e.tileAnchorX,e.tileAnchorY):0)},v=f.textBox;if(v){_(v);const y=e=>{let t=re.WritingMode.horizontal;if(b.allowVerticalPlacement&&!e&&this.prevPlacement){const re=this.prevPlacement.placedOrientations[d.crossTileID];re&&(this.placedOrientations[d.crossTileID]=re,t=re,this.markUsedOrientation(b,t,d))}return t},x=(e,t)=>{if(b.allowVerticalPlacement&&0<d.numVerticalGlyphVertices&&f.verticalTextBox){for(const d of b.writingModes)if(d===re.WritingMode.vertical?(r=t(),i=r):r=e(),r&&r.box&&r.box.length)break}else r=e()};if(w.get("text-variable-anchor")){let c=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[d.crossTileID]){const re=this.prevPlacement.variableOffsets[d.crossTileID];0<c.indexOf(re.anchor)&&(c=c.filter(e=>e!==re.anchor),c.unshift(re.anchor))}const S=(t,e,r)=>{var i=b.getSymbolInstanceTextSize(C,d,this.transform.zoom,p),n=(t.x2-t.x1)*i+2*t.padding,a=(t.y2-t.y1)*i+2*t.padding,s=F&&!O?e:null;s&&_(s);let o={box:[],offscreen:!1};const l=D?2*c.length:c.length;for(let e=0;e<l;++e){const l=this.attemptAnchorPlacement(c[e%c.length],t,n,a,i,k,B,A,T,P,e>=c.length,d,p,b,r,s,C,L);if(l&&(o=l.placedGlyphBoxes,o&&o.box&&o.box.length)){h=!0,u=l.shift;break}}return o};x(()=>S(v,f.iconBox,re.WritingMode.horizontal),()=>{var e=f.verticalTextBox;return e&&_(e),b.allowVerticalPlacement&&!(r&&r.box&&r.box.length)&&0<d.numVerticalGlyphVertices&&e?S(e,f.verticalIconBox,re.WritingMode.vertical):{box:null,offscreen:null}}),r&&(h=r.box,t=r.offscreen);const M=y(r&&r.box);if(!h&&this.prevPlacement){const re=this.prevPlacement.variableOffsets[d.crossTileID];re&&(this.variableOffsets[d.crossTileID]=re,this.markUsedJustification(b,re.anchor,d,M))}}else{const w=(e,t)=>{var r=b.getSymbolInstanceTextSize(C,d,this.transform.zoom,p),e=this.collisionIndex.placeCollisionBox(r,e,new re.pointGeometry(0,0),D,A,T,P.predicate);return e&&e.box&&e.box.length&&(this.markUsedOrientation(b,t,d),this.placedOrientations[d.crossTileID]=t),e};x(()=>w(v,re.WritingMode.horizontal),()=>{var e=f.verticalTextBox;return b.allowVerticalPlacement&&0<d.numVerticalGlyphVertices&&e?(_(e),w(e,re.WritingMode.vertical)):{box:null,offscreen:null}}),y(r&&r.box&&r.box.length)}}if(n=r,h=n&&n.box&&0<n.box.length,t=n&&n.offscreen,d.useRuntimeCollisionCircles){const y=b.text.placedSymbolArray.get(0<=d.centerJustifiedTextSymbolIndex?d.centerJustifiedTextSymbolIndex:d.verticalPlacedTextSymbolIndex),p=re.evaluateSizeForFeature(b.textSizeData,C,y),M=w.get("text-padding");a=this.collisionIndex.placeCollisionCircles(D,y,b.lineVertexArray,b.glyphOffsetArray,p,T,E,S,x,B,P.predicate,d.collisionCircleDiameter*p/re.ONE_EM,M,this.retainedQueryData[b.bucketInstanceId].tileID),h=D||0<a.circles.length&&!a.collisionDetected,t=t&&a.offscreen}if(f.iconFeatureIndex&&(c=f.iconFeatureIndex),f.iconBox){const d=e=>{_(e);var t=F&&u?ut(u.x,u.y,k,B,this.transform.angle):new re.pointGeometry(0,0),r=b.getSymbolInstanceIconSize(L,this.transform.zoom,p);return this.collisionIndex.placeCollisionBox(r,e,t,O,A,T,P.predicate)};e=(s=i&&i.box&&i.box.length&&f.verticalIconBox?d(f.verticalIconBox):d(f.iconBox),0<s.box.length),t=t&&s.offscreen}var m=I||0===d.numHorizontalGlyphVertices&&0===d.numVerticalGlyphVertices,g=R||0===d.numIconVertices;if(m||g?g?m||(e=e&&h):h=e&&h:e=h=e&&h,h&&n&&n.box&&this.collisionIndex.insertCollisionBox(n.box,w.get("text-ignore-placement"),b.bucketInstanceId,i&&i.box&&l?l:o,P.ID),e&&s&&this.collisionIndex.insertCollisionBox(s.box,w.get("icon-ignore-placement"),b.bucketInstanceId,c,P.ID),a&&(h&&this.collisionIndex.insertCollisionCircles(a.circles,w.get("text-ignore-placement"),b.bucketInstanceId,o,P.ID),x)){const re=b.bucketInstanceId;let t=this.collisionCircleArrays[re];void 0===t&&(t=this.collisionCircleArrays[re]=new ot);for(let e=0;e<a.circles.length;e+=4)t.circles.push(a.circles[e+0]),t.circles.push(a.circles[e+1]),t.circles.push(a.circles[e+2]),t.circles.push(a.collisionDetected?1:0)}this.placements[d.crossTileID]=new st(h||z,e||N,t||b.justReloaded),y[d.crossTileID]=!0}};if(n){const re=b.getSortedSymbolIndexes(this.transform.angle);for(let e=re.length-1;0<=e;--e){const y=re[e];a(b.symbolInstances.get(y),y,b.collisionArrays[y])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)a(b.symbolInstances.get(e),e,b.collisionArrays[e]);if(x&&b.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[b.bucketInstanceId];re.invert(t.invProjMatrix,T),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(e,t,r,i){var n=i===re.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[re.getAnchorJustification(t)];for(const re of[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex])0<=re&&(e.text.placedSymbolArray.get(re).crossTileID=0<=n&&re!==n?0:r.crossTileID)}markUsedOrientation(e,t,r){var i=t===re.WritingMode.horizontal||t===re.WritingMode.horizontalOnly?t:0,t=t===re.WritingMode.vertical?t:0;for(const re of[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex])e.text.placedSymbolArray.get(re).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=t)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},a=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],a=n[e];r=a?(this.opacities[e]=new at(a,i,t.text,t.icon,null,t.clipped),r||t.text!==a.text.placed||t.icon!==a.icon.placed):(this.opacities[e]=new at(null,i,t.text,t.icon,t.skipFade,t.clipped),r||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new at(t,i,!1,!1);n.isHidden()||(this.opacities[e]=n,r=r||t.text.placed||t.icon.placed)}}for(const e in a)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=a[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){var r={};for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,r,i.collisionBoxArray)}}updateBucketOpacities(i,n,t){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const a=i.layers[0].layout,s=!!i.layers[0].dynamicFilter(),o=new at(null,0,!1,!1,!0),l=a.get("text-allow-overlap"),c=a.get("icon-allow-overlap"),h=a.get("text-variable-anchor"),u="map"===a.get("text-rotation-alignment"),d="map"===a.get("text-pitch-alignment"),p="none"!==a.get("icon-text-fit"),f=new at(null,0,l&&(c||!i.hasIconData()||a.get("icon-optional")),c&&(l||!i.hasTextData()||a.get("text-optional")),!0);!i.collisionArrays&&t&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(t);var m=(t,r,i)=>{for(let e=0;e<r/4;e++)t.opacityVertexArray.emplaceBack(i)};for(let e=0;e<i.symbolInstances.length;e++){const a=i.symbolInstances.get(e),{numHorizontalGlyphVertices:l,numVerticalGlyphVertices:c,crossTileID:g}=a;let r=this.opacities[g];n[g]?r=o:r||(r=f,this.opacities[g]=r),n[g]=!0;const _=0<a.numIconVertices,v=this.placedOrientations[a.crossTileID],y=v===re.WritingMode.vertical,x=v===re.WritingMode.horizontal||v===re.WritingMode.horizontalOnly;if(0<l||0<c){const re=bt(r.text);m(i.text,l,y?wt:re),m(i.text,c,x?wt:re);const n=r.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(e=>{0<=e&&(i.text.placedSymbolArray.get(e).hidden=n||y?1:0)}),0<=a.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=n||x?1:0);const t=this.variableOffsets[a.crossTileID];t&&this.markUsedJustification(i,t.anchor,a,v);const s=this.placedOrientations[a.crossTileID];s&&(this.markUsedJustification(i,"left",a,s),this.markUsedOrientation(i,s,a))}if(_){const re=bt(r.icon);0<=a.placedIconSymbolIndex&&(m(i.icon,a.numIconVertices,y?wt:re),i.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=r.icon.isHidden()),0<=a.verticalPlacedIconSymbolIndex&&(m(i.icon,a.numVerticalIconVertices,x?wt:re),i.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=r.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const n=i.collisionArrays[e];if(n){let e=new re.pointGeometry(0,0),t=!0;if(n.textBox||n.verticalTextBox){if(h){const re=this.variableOffsets[g];re?(e=ht(re.anchor,re.width,re.height,re.textOffset,re.textScale),u&&e._rotate(d?this.transform.angle:-this.transform.angle)):t=!1}s&&(t=!r.clipped),n.textBox&&pt(i.textCollisionBox.collisionVertexArray,r.text.placed,!t||y,e.x,e.y),n.verticalTextBox&&pt(i.textCollisionBox.collisionVertexArray,r.text.placed,!t||x,e.x,e.y)}const o=t&&Boolean(!x&&n.verticalIconBox);n.iconBox&&pt(i.iconCollisionBox.collisionVertexArray,r.icon.placed,o,p?e.x:0,p?e.y:0),n.verticalIconBox&&pt(i.iconCollisionBox.collisionVertexArray,r.icon.placed,!o,p?e.x:0,p?e.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=re.invProjMatrix,i.placementViewportMatrix=re.viewportMatrix,i.collisionCircleArray=re.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){var r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function pt(e,t,r,i,n){e.emplaceBack(t?1:0,r?1:0,i||0,n||0),e.emplaceBack(t?1:0,r?1:0,i||0,n||0),e.emplaceBack(t?1:0,r?1:0,i||0,n||0),e.emplaceBack(t?1:0,r?1:0,i||0,n||0)}const ft=Math.pow(2,25),mt=Math.pow(2,24),gt=Math.pow(2,17),_t=Math.pow(2,16),vt=Math.pow(2,9),yt=Math.pow(2,8),xt=Math.pow(2,1);function bt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;var t=e.placed?1:0,e=Math.floor(127*e.opacity);return e*ft+t*mt+e*gt+t*_t+e*vt+t*yt+e*xt+t}const wt=0;class Tt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,r,i,n){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<a.length;){const e=a[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class Et{constructor(e,t,r,i,n,a,s,o){this.placement=new dt(e,n,a,s,o),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(e,t,r){const i=re.exported.now(),n=()=>{var e=re.exported.now()-i;return!this._forceFullPlacement&&2<e};for(;0<=this._currentPlacementIndex;){const re=t[e[this._currentPlacementIndex]],i=this.placement.collisionIndex.transform.zoom;if("symbol"===re.type&&(!re.minzoom||re.minzoom<=i)&&(!re.maxzoom||re.maxzoom>i)){if(this._inProgressLayer||(this._inProgressLayer=new Tt(re)),this._inProgressLayer.continuePlacement(r[re.source],this.placement,this._showCollisionBoxes,re,n))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const St=512/re.EXTENT/2;class Mt{constructor(t,r,e){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=e;for(let e=0;e<r.length;e++){var i=r.get(e),n=i.key;this.indexedSymbolInstances[n]||(this.indexedSymbolInstances[n]=[]),this.indexedSymbolInstances[n].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}}getScaledCoordinates(e,t){var r=St/Math.pow(2,t.canonical.z-this.tileID.canonical.z);return{x:Math.floor((t.canonical.x*re.EXTENT+e.tileAnchorX)*r),y:Math.floor((t.canonical.y*re.EXTENT+e.tileAnchorY)*r)}}findMatches(t,r,i){var n=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let e=0;e<t.length;e++){const o=t.get(e);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a){var s=this.getScaledCoordinates(o,r);for(const t of a)if(Math.abs(t.coord.x-s.x)<=n&&Math.abs(t.coord.y-s.y)<=n&&!i[t.crossTileID]){i[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}}}class At{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ct{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const r=this.indexes[e],i={};for(const e in r){const n=r[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),i[n.tileID.key]=n}this.indexes[e]=i}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const i=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){var n=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in n){const a=n[r];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,i)}else{const s=n[e.scaledTo(Number(r)).key];s&&s.findMatches(t.symbolInstances,e,i)}}for(let e=0;e<t.symbolInstances.length;e++){const o=t.symbolInstances.get(e);o.crossTileID||(o.crossTileID=r.generate(),i[o.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Mt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const r in t.indexedSymbolInstances)for(const i of t.indexedSymbolInstances[r])delete this.usedCrossTileIDs[e][i.crossTileID]}removeStaleBuckets(e){let t=!1;for(const r in this.indexes){const i=this.indexes[r];for(const n in i)e[i[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[n]),delete i[n],t=!0)}return t}}class Lt{constructor(){this.layerIndexes={},this.crossTileIDs=new At,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new Ct);let n=!1;const a={};i.handleWrapJump(r);for(const r of t){const t=r.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(r.tileID,t,this.crossTileIDs)&&(n=!0),a[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(n=!0),n}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Pt=(e,t)=>re.emitValidationErrors(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),It=re.pick(Oe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Rt=re.pick(Oe,["setCenter","setZoom","setBearing","setPitch"]),Dt=function(){const e={},t=re.spec.$version;for(const n in re.spec.$root){var r,i=re.spec.$root[n];!i.required||(r=null)!=(r="version"===n?t:"array"===i.type?[]:{})&&(e[n]=r)}return e}(),Ot={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class kt extends re.Evented{constructor(e,t={}){super(),this.map=e,this.dispatcher=new S(Re(),this),this.imageManager=new c,this.imageManager.setEventedParent(this),this.glyphManager=new re.GlyphManager(e._requestManager,t.localFontFamily?re.LocalGlyphMode.all:t.localIdeographFontFamily?re.LocalGlyphMode.ideographs:re.LocalGlyphMode.none,t.localFontFamily||t.localIdeographFontFamily),this.lineAtlas=new re.LineAtlas(256,512),this.crossTileSymbolIndex=new Lt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new re.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",re.getReferrer());const r=this;this._rtlTextPluginCallback=kt.registerForPluginStateChange(e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,t)=>{if(re.triggerPluginCompletionEvent(e),t&&t.every(e=>e))for(const re in r._sourceCaches){const e=r._sourceCaches[re],t=e.getSource().type;"vector"!==t&&"geojson"!==t||e.reload()}})}),this.on("data",e=>{if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){var r=this._layers[e];r.source===t.id&&this._validateLayer(r)}}})}loadURL(e,t={}){this.fire(new re.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof t.validate?t.validate:!re.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,t.accessToken);e=this.map._requestManager.transformRequest(e,re.ResourceType.Style);this._request=re.getJSON(e,(e,t)=>{this._request=null,e?this.fire(new re.ErrorEvent(e)):t&&this._load(t,r)})}loadJSON(e,t={}){this.fire(new re.Event("dataloading",{dataType:"style"})),this._request=re.exported.frame(()=>{this._request=null,this._load(e,!1!==t.validate)})}loadEmpty(){this.fire(new re.Event("dataloading",{dataType:"style"})),this._load(Dt,!1)}_updateLayerCount(e,t){t=t?1:-1;e.is3D()&&(this._num3DLayers+=t),"circle"===e.type&&(this._numCircleLayers+=t),"symbol"===e.type&&(this._numSymbolLayers+=t)}_load(e,t){if(!t||!Pt(this,re.validateStyle(e))){this._loaded=!0,this.stylesheet=e,this.updateProjection();for(const re in e.sources)this.addSource(re,e.sources[re],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);const i=De(this.stylesheet.layers);this._order=i.map(e=>e.id),this._layers={},this._serializedLayers={};for(var r of i)r=re.createStyleLayer(r),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize(),this._updateLayerCount(r,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new p(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new re.Event("data",{dataType:"style"})),this.fire(new re.Event("style.load"))}}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const e=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),e){this.map.painter.clearBackgroundTiles();for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles();this.map._update(!0)}}_loadSprite(e){this._spriteRequest=function(e,t,h){let u,d,p;var r=1<re.exported.devicePixelRatio?"@2x":"";let i=re.getJSON(t.transformRequest(t.normalizeSpriteURL(e,r,".json"),re.ResourceType.SpriteJSON),(e,t)=>{i=null,p||(p=e,u=t,a())}),n=re.getImage(t.transformRequest(t.normalizeSpriteURL(e,r,".png"),re.ResourceType.SpriteImage),(e,t)=>{n=null,p||(p=e,d=t,a())});function a(){if(p)h(p);else if(u&&d){const e=re.exported.getImageData(d),t={};for(const h in u){const{width:d,height:p,x:r,y:i,sdf:n,pixelRatio:a,stretchX:s,stretchY:o,content:l}=u[h],c=new re.RGBAImage({width:d,height:p});re.RGBAImage.copy(e,c,{x:r,y:i},{x:0,y:0},{width:d,height:p}),t[h]={data:c,pixelRatio:a,sdf:n,stretchX:s,stretchY:o,content:l}}h(null,t)}}return{cancel(){i&&(i.cancel(),i=null),n&&(n.cancel(),n=null)}}}(e,this.map._requestManager,(e,t)=>{if(this._spriteRequest=null,e)this.fire(new re.ErrorEvent(e));else if(t)for(const re in t)this.imageManager.addImage(re,t[re]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new re.Event("data",{dataType:"style"}))})}_validateLayer(e){const t=this.getSource(e.source);var r;!t||(r=e.sourceLayer)&&("geojson"===t.type||t.vectorLayerIds&&-1===t.vectorLayerIds.indexOf(r))&&this.fire(new re.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${t.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const r of e){const e=this._layers[r];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&Ot[e.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(this._loaded){const r=this._changed;if(this._changed){const re=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);(re.length||r.length)&&this._updateWorkerLayers(re,r);for(const re in this._updatedSources){const e=this._updatedSources[re];"reload"===e?this._reloadSource(re):"clear"===e&&this._clearSource(re)}this._updateTilesForChangedImages();for(const re in this._updatedPaintProps)this._layers[re].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const i={};for(const re in this._sourceCaches){const e=this._sourceCaches[re];i[re]=e.used,e.used=!1}for(const re of this._order){const r=this._layers[re];if(r.recalculate(e,this._availableImages),!r.isHidden(e.zoom)){const re=this._getLayerSourceCache(r);re&&(re.used=!0)}const i=this.map.painter;if(i){const re=r.getProgramIds();if(re){var t=r.getProgramConfiguration(e.zoom);for(const e of re)i.useProgram(e,t)}}}for(const e in i){const r=this._sourceCaches[e];i[e]!==r.used&&r.getSource().fire(new re.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:r.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new re.Event("data",{dataType:"style"}))}}_updateTilesForChangedImages(){var e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),Pt(this,re.validateStyle(e)))return!1;(e=re.clone$2(e)).layers=De(e.layers);const t=function(t,r){if(!t)return[{command:Oe.setStyle,args:[r]}];let i=[];try{if(!g(t.version,r.version))return[{command:Oe.setStyle,args:[r]}];g(t.center,r.center)||i.push({command:Oe.setCenter,args:[r.center]}),g(t.zoom,r.zoom)||i.push({command:Oe.setZoom,args:[r.zoom]}),g(t.bearing,r.bearing)||i.push({command:Oe.setBearing,args:[r.bearing]}),g(t.pitch,r.pitch)||i.push({command:Oe.setPitch,args:[r.pitch]}),g(t.sprite,r.sprite)||i.push({command:Oe.setSprite,args:[r.sprite]}),g(t.glyphs,r.glyphs)||i.push({command:Oe.setGlyphs,args:[r.glyphs]}),g(t.transition,r.transition)||i.push({command:Oe.setTransition,args:[r.transition]}),g(t.light,r.light)||i.push({command:Oe.setLight,args:[r.light]}),g(t.fog,r.fog)||i.push({command:Oe.setFog,args:[r.fog]}),g(t.projection,r.projection)||i.push({command:Oe.setProjection,args:[r.projection]});const n={},a=[];!function(e,t,r,i){let n;for(n in t=t||{},e=e||{})e.hasOwnProperty(n)&&(t.hasOwnProperty(n)||Be(n,r,i));for(n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)?g(e[n],t[n])||("geojson"===e[n].type&&"geojson"===t[n].type&&function(e,t,r){let i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!g(e[r][i],t[r][i]))return;for(i in t[r])if(t[r].hasOwnProperty(i)&&"data"!==i&&!g(e[r][i],t[r][i]))return;return 1}(e,t,n)?r.push({command:Oe.setGeoJSONSourceData,args:[n,t[n].data]}):(a=n,s=t,o=r,l=i,Be(a,o,l),ke(a,s,o))):ke(n,t,r));var a,s,o,l}(t.sources,r.sources,a,n);const s=[];t.layers&&t.layers.forEach(e=>{n[e.source]?i.push({command:Oe.removeLayer,args:[e.id]}):s.push(e)});let e=t.terrain;e&&n[e.source]&&(i.push({command:Oe.setTerrain,args:[void 0]}),e=void 0),i=i.concat(a),g(e,r.terrain)||i.push({command:Oe.setTerrain,args:[r.terrain]}),function(e,t,r){t=t||[];const i=(e=e||[]).map(ze),n=t.map(ze),a=e.reduce(Ne,{}),s=t.reduce(Ne,{}),o=i.slice(),l=Object.create(null);let c,h,u,d,p,f,m;for(c=0,h=0;c<i.length;c++)u=i[c],s.hasOwnProperty(u)?h++:(r.push({command:Oe.removeLayer,args:[u]}),o.splice(o.indexOf(u,h),1));for(c=0,h=0;c<n.length;c++)u=n[n.length-1-c],o[o.length-1-c]!==u&&(a.hasOwnProperty(u)?(r.push({command:Oe.removeLayer,args:[u]}),o.splice(o.lastIndexOf(u,o.length-h),1)):h++,f=o[o.length-c],r.push({command:Oe.addLayer,args:[s[u],f]}),o.splice(o.length-c,0,u),l[u]=!0);for(c=0;c<n.length;c++)if(u=n[c],d=a[u],p=s[u],!l[u]&&!g(d,p))if(g(d.source,p.source)&&g(d["source-layer"],p["source-layer"])&&g(d.type,p.type)){for(m in Fe(d.layout,p.layout,r,u,null,Oe.setLayoutProperty),Fe(d.paint,p.paint,r,u,null,Oe.setPaintProperty),g(d.filter,p.filter)||r.push({command:Oe.setFilter,args:[u,p.filter]}),g(d.minzoom,p.minzoom)&&g(d.maxzoom,p.maxzoom)||r.push({command:Oe.setLayerZoomRange,args:[u,p.minzoom,p.maxzoom]}),d)d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?Fe(d[m],p[m],r,u,m.slice(6),Oe.setPaintProperty):g(d[m],p[m])||r.push({command:Oe.setLayerProperty,args:[u,m,p[m]]}));for(m in p)p.hasOwnProperty(m)&&!d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?Fe(d[m],p[m],r,u,m.slice(6),Oe.setPaintProperty):g(d[m],p[m])||r.push({command:Oe.setLayerProperty,args:[u,m,p[m]]}))}else r.push({command:Oe.removeLayer,args:[u]}),f=o[o.lastIndexOf(u)+1],r.push({command:Oe.addLayer,args:[p,f]})}(s,r.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Oe.setStyle,args:[r]}]}return i}(this.serialize(),e).filter(e=>!(e.command in Rt));if(0===t.length)return!1;const r=t.filter(e=>!(e.command in It));if(0<r.length)throw new Error(`Unimplemented: ${r.map(e=>e.command).join(", ")}.`);return t.forEach(e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args)}),this.stylesheet=e,!0}addImage(e,t){if(this.getImage(e))return this.fire(new re.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,t),this._afterImageUpdated(e)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new re.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new re.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,e,t={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!e.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(e).join(", ")}.`);if(!(0<=["vector","raster","geojson","video","image"].indexOf(e.type)&&this._validate(re.validateStyle.source,`sources.${i}`,e,null,t))){this.map&&this.map._collectResourceTiming&&(e.collectResourceTiming=!0);const n=Ee(i,e,this.dispatcher,this);n.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:n.serialize(),sourceId:i}));t=e=>{const t=(e?"symbol:":"other:")+i,r=this._sourceCaches[t]=new re.SourceCache(t,n,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[i]=r,r.style=this,r.onAdd(this.map)};t(!1),"vector"!==e.type&&"geojson"!==e.type||t(!0),n.onAdd&&n.onAdd(this.map),this._changed=!0}}removeSource(e){this._checkLoaded();const t=this.getSource(e);if(void 0===t)throw new Error("There is no source with this ID");for(const t in this._layers)if(this._layers[t].source===e)return this.fire(new re.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${t}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new re.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));var r=this._getSourceCaches(e);for(const e of r)delete this._sourceCaches[e.id],delete this._updatedSources[e.id],e.fire(new re.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles();delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],t.setEventedParent(null),t.onRemove&&t.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}addLayer(t,r,i={}){this._checkLoaded();var n=t.id;if(this.getLayer(n))this.fire(new re.ErrorEvent(new Error(`Layer with id "${n}" already exists on this map`)));else{let e;if("custom"===t.type){if(Pt(this,re.validateCustomStyleLayer(t)))return;e=re.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=re.clone$2(t),t=re.extend(t,{source:n})),this._validate(re.validateStyle.layer,`layers.${n}`,t,{arrayIndex:-1},i))return;e=re.createStyleLayer(t),this._validateLayer(e),e.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[e.id]=e.serialize(),this._updateLayerCount(e,!0)}t=r?this._order.indexOf(r):this._order.length;if(r&&-1===t)this.fire(new re.ErrorEvent(new Error(`Layer with id "${r}" does not exist on this map.`)));else{this._order.splice(t,0,n),this._layerOrderChanged=!0,this._layers[n]=e;const a=this._getLayerSourceCache(e);if(this._removedLayers[n]&&e.source&&a&&"custom"!==e.type){const re=this._removedLayers[n];delete this._removedLayers[n],re.type!==e.type?this._updatedSources[e.source]="clear":(this._updatedSources[e.source]="reload",a.pause())}this._updateLayer(e),e.onAdd&&e.onAdd(this.map),this._updateDrapeFirstLayers()}}}moveLayer(e,t){var r;this._checkLoaded(),this._changed=!0,this._layers[e]?e!==t&&(r=this._order.indexOf(e),this._order.splice(r,1),r=t?this._order.indexOf(t):this._order.length,t&&-1===r?this.fire(new re.ErrorEvent(new Error(`Layer with id "${t}" does not exist on this map.`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())):this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)))}removeLayer(e){this._checkLoaded();const t=this._layers[e];var r;t?(t.setEventedParent(null),this._updateLayerCount(t,!1),r=this._order.indexOf(e),this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=t,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],t.onRemove&&t.onRemove(this.map),this._updateDrapeFirstLayers()):this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)))}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,r){this._checkLoaded();const i=this.getLayer(e);i?i.minzoom===t&&i.maxzoom===r||(null!=t&&(i.minzoom=t),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,t,r={}){this._checkLoaded();const i=this.getLayer(e);if(i){if(!g(i.filter,t))return null==t?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(re.validateStyle.filter,`layers.${i.id}.filter`,t,{layerType:i.type},r)||(i.filter=re.clone$2(t),this._updateLayer(i)))}else this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){return re.clone$2(this.getLayer(e).filter)}setLayoutProperty(e,t,r,i={}){this._checkLoaded();const n=this.getLayer(e);n?g(n.getLayoutProperty(t),r)||(n.setLayoutProperty(t,r,i),this._updateLayer(n)):this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,t){const r=this.getLayer(e);if(r)return r.getLayoutProperty(t);this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,t,r,i={}){this._checkLoaded();const n=this.getLayer(e);n?g(n.getPaintProperty(t),r)||(n.setPaintProperty(t,r,i)&&this._updateLayer(n),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(e,t){this._checkLoaded();var r=e.source,i=e.sourceLayer,n=this.getSource(r);if(void 0!==n){n=n.type;if("geojson"===n&&i)this.fire(new re.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));else if("vector"!==n||i){void 0===e.id&&this.fire(new re.ErrorEvent(new Error("The feature id parameter must be provided.")));for(const re of this._getSourceCaches(r))re.setFeatureState(i,e.id,t)}else this.fire(new re.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new re.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}removeFeatureState(e,t){this._checkLoaded();var r=e.source,i=this.getSource(r);if(void 0!==i){var i=i.type,n="vector"===i?e.sourceLayer:void 0;if("vector"!==i||n)if(t&&"string"!=typeof e.id&&"number"!=typeof e.id)this.fire(new re.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));else for(const re of this._getSourceCaches(r))re.removeFeatureState(n,e.id,t);else this.fire(new re.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new re.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getFeatureState(e){this._checkLoaded();var t=e.source,r=e.sourceLayer,i=this.getSource(t);if(void 0!==i){if("vector"!==i.type||r)return void 0===e.id&&this.fire(new re.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(t)[0].getFeatureState(r,e.id);this.fire(new re.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new re.ErrorEvent(new Error(`The source '${t}' does not exist in the map's style.`)))}getTransition(){return re.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const re in this._sourceCaches){const t=this._sourceCaches[re].getSource();e[t.id]||(e[t.id]=t.serialize())}return re.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:e,layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const i=e=>"fill-extrusion"===this._layers[e].type,n={},a=[];for(let e=this._order.length-1;0<=e;e--){var t=this._order[e];if(i(t)){n[t]=e;for(const i of r){const r=i[t];if(r)for(const i of r)a.push(i)}}}a.sort((e,t)=>t.intersectionZ-e.intersectionZ);const s=[];for(let t=this._order.length-1;0<=t;t--){var e=this._order[t];if(i(e))for(let e=a.length-1;0<=e;e--){const i=a[e].feature;if(n[i.layer.id]<t)break;s.push(i),a.pop()}else for(const i of r){const r=i[e];if(r)for(const i of r)s.push(i.feature)}}return s}queryRenderedFeatures(e,t,r){t&&t.filter&&this._validate(re.validateStyle.filter,"queryRenderedFeatures.filter",t.filter,null,t);const i={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new re.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of t.layers){const t=this._layers[e];if(!t)return this.fire(new re.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];i[t.source]=!0}}const n=[];t.availableImages=this._availableImages;var a=t&&t.layers?t.layers.some(e=>{const t=this.getLayer(e);return t&&t.is3D()}):this.has3DLayers(),s=A.createFromScreenPoints(e,r);for(const re in this._sourceCaches){const e=this._sourceCaches[re].getSource().id;t.layers&&!i[e]||n.push(Me(this._sourceCaches[re],this._layers,this._serializedLayers,s,t,r,a,!!this.map._showQueryGeometry))}return this.placement&&n.push(function(i,n,a,e,t,r,s){const o={},l=r.queryRenderedSymbols(e),c=[];for(const i of Object.keys(l).map(Number))c.push(s[i]);c.sort(Ae);for(const a of c){const e=a.featureIndex.lookupSymbolFeatures(l[a.bucketInstanceId],n,a.bucketIndex,a.sourceLayerIndex,t.filter,t.layers,t.availableImages,i);for(const i in e){const n=o[i]=o[i]||[],t=e[i];t.sort((e,t)=>{const r=a.featureSortOrder;if(r){const a=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-a}return t.featureIndex-e.featureIndex});for(const i of t)n.push(i)}}for(const n in o)o[n].forEach(e=>{const t=e.feature,r=a(i[n]).getFeatureState(t.layer["source-layer"],t.id);t.source=t.layer.source,t.layer["source-layer"]&&(t.sourceLayer=t.layer["source-layer"]),t.state=r});return o}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),s.screenGeometry,t,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(n)}querySourceFeatures(e,t){t&&t.filter&&this._validate(re.validateStyle.filter,"querySourceFeatures.filter",t.filter,null,t);let r=[];for(const re of this._getSourceCaches(e))r=r.concat(function(t,r){const i=t.getRenderableIds().map(e=>t.getTileByID(e)),n=[],a={};for(let e=0;e<i.length;e++){const s=i[e],o=s.tileID.canonical.key;a[o]||(a[o]=!0,s.querySourceFeatures(n,r))}return n}(re,t));return r}addSourceType(e,t,r){return kt.getSourceType(e)?r(new Error(`A source type called "${e}" already exists.`)):(kt.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getLight(){return this.light.getLight()}setLight(e,t={}){this._checkLoaded();var r,i=this.light.getLight();let n=!1;for(const re in e)if(!g(e[re],i[re])){n=!0;break}n&&(r={now:re.exported.now(),transition:re.extend({duration:300,delay:0},this.stylesheet.transition)},this.light.setLight(e,t),this.light.updateTransitions(r))}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(e){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);var t;if("object"==typeof e.source&&(this.addSource(t="terrain-dem-src",e.source),e=re.clone$2(e),e=re.extend(e,{source:t})),!this._validate(re.validateStyle.terrain,"terrain",e)){if(this.terrain){const i=this.terrain,n=i.get();for(const a in e)if(!g(e[a],n[a])){i.set(e),this.stylesheet.terrain=e;var r={now:re.exported.now(),transition:re.extend({duration:0},this.stylesheet.transition)};i.updateTransitions(r);break}}else this._createTerrain(e);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(e){const t=this.fog=new E(e,this.map.transform);this.stylesheet.fog=e;e={now:re.exported.now(),transition:re.extend({duration:0},this.stylesheet.transition)};t.updateTransitions(e)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog,i=r.get();for(const n in e)if(!g(e[n],i[n])){r.set(e),this.stylesheet.fog=e;var t={now:re.exported.now(),transition:re.extend({duration:0},this.stylesheet.transition)};r.updateTransitions(t);break}}else this._createFog(e);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){var e,t;this.map._optimizeForTerrain&&this.terrain&&(e=this._order.filter(e=>this.isLayerDraped(this._layers[e])),t=this._order.filter(e=>!this.isLayerDraped(this._layers[e])),this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t))}_createTerrain(e){const t=this.terrain=new v(e);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();e={now:re.exported.now(),transition:re.extend({duration:0},this.stylesheet.transition)};t.updateTransitions(e)}_force3DLayerUpdate(){for(const t in this._layers){var e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_validate(e,t,r,i,n={}){return(!n||!1!==n.validate)&&Pt(this,e.call(re.validateStyle,re.extend({key:t,style:this.serialize(),value:r,styleSpec:re.spec},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),re.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const re in this._layers)this._layers[re].setEventedParent(null);for(const re in this._sourceCaches)this._sourceCaches[re].clearTiles(),this._sourceCaches[re].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){e=this._getSourceCaches(e);for(const t of e)t.clearTiles()}_reloadSource(e){e=this._getSourceCaches(e);for(const t of e)t.resume(),t.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(e,t,r,i,n=!1){let a=!1,s=!1;const o={};for(const re of this._order){const t=this._layers[re];if("symbol"===t.type){if(!o[t.source]){const re=this._getLayerSourceCache(t);if(!re)continue;o[t.source]=re.getRenderableIds(!0).map(e=>re.getTileByID(e)).sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const r=this.crossTileSymbolIndex.addLayer(t,o[t.source],e.center.lng);a=a||r}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),n=n||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new re.Event("neworder")),(n||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(re.exported.now(),e.zoom))&&(this.pauseablePlacement=new Et(e,this._order,n,t,r,i,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,o),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(re.exported.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const re of this._order){const e=this._layers[re];"symbol"===e.type&&this.placement.updateLayerOpacities(e,o[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(re.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,r){this.imageManager.getImages(t.icons,r),this._updateTilesForChangedImages();r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,r)}getResource(e,t,r){return re.makeRequest(t,r)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return("symbol"===e.type?this._symbolSourceCaches:this._otherSourceCaches)[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}has3DLayers(){return 0<this._num3DLayers}hasSymbolLayers(){return 0<this._numSymbolLayers}hasCircleLayers(){return 0<this._numCircleLayers}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}kt.getSourceType=function(e){return Se[e]},kt.setSourceType=function(e,t){Se[e]=t},kt.registerForPluginStateChange=re.registerForPluginStateChange;var Bt="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ft="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let zt={},Nt={};zt=$t("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Nt=$t("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Ut=$t("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Gt=Bt;var Vt={background:$t("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:$t("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:$t("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:$t("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$t("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:$t("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$t("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$t("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:$t("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:$t("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:$t("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:$t("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:$t("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:$t("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:$t("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:$t("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:$t("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:$t("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:$t("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:$t("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:$t("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:$t("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:$t("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:$t("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ft),skyboxGradient:$t("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ft),skyboxCapture:$t("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$t("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:$t("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:$t("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function $t(e,t,r){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,a=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=e.match(n),o=t.match(n),l=Bt.match(n);let c=o?o.concat(s):s;r||(zt.staticUniforms&&(c=zt.staticUniforms.concat(c)),Nt.staticUniforms&&(c=Nt.staticUniforms.concat(c))),c=c&&c.concat(l);const h={};return{fragmentSource:e=e.replace(i,(e,t,r,i,n)=>(h[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nvarying ${r} ${i} ${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = u_${n};\n#endif\n`)),vertexSource:t=t.replace(i,(e,t,r,i,n)=>{var a="float"===i?"vec2":"vec4",s=n.match(/color/)?"color":a;return h[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${r} ${a} a_${n};\nvarying ${r} ${i} ${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"vec4"==s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${r} ${a} a_${n};\n#else\nuniform ${r} ${i} u_${n};\n#endif\n`:"vec4"==s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = a_${n};\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${i} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${r} ${i} ${n} = u_${n};\n#endif\n`}),staticAttributes:a,staticUniforms:c}}class jt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,r,i,n,a,s,o){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let e=0;!l&&e<i.length;e++)this.boundPaintVertexBuffers[e]!==i[e]&&(l=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===r&&!l&&this.boundIndexBuffer===n&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===o?(e.bindVertexArrayOES.set(this.vao),s&&s.bind(),n&&n.dynamicDraw&&n.bind(),o&&o.bind()):this.freshBind(t,r,i,n,a,s,o)}freshBind(e,t,r,i,n,a,s){let o;const l=e.numAttributes,c=this.context,h=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),o=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=s;else{o=c.currentNumAttributes||0;for(let e=l;e<o;e++)h.disableVertexAttribArray(e)}t.enableAttributes(h,e);for(const t of r)t.enableAttributes(h,e);a&&a.enableAttributes(h,e),s&&s.enableAttributes(h,e),t.bind(),t.setVertexAttribPointers(h,e,n);for(const t of r)t.bind(),t.setVertexAttribPointers(h,e,n);a&&(a.bind(),a.setVertexAttribPointers(h,e,n)),i&&i.bind(),s&&(s.bind(),s.setVertexAttribPointers(h,e,n)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ht(e,t,r,i,n,a,s){const o=e.context,l=o.gl,c=r.fbo;if(c){e.prepareDrawTile(t);const u=e.useProgram("hillshade");o.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());var h=((e,t,r,i)=>{var n=r.paint.get("hillshade-shadow-color"),a=r.paint.get("hillshade-highlight-color"),s=r.paint.get("hillshade-accent-color");let o=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(o-=e.transform.angle);var l=!e.options.moving;return{u_matrix:i||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:(l=t.tileID,t=Math.pow(2,l.canonical.z),l=l.canonical.y,[new re.MercatorCoordinate(0,l/t).toLngLat().lat,new re.MercatorCoordinate(0,(l+1)/t).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),o],u_shadow:n,u_highlight:a,u_accent:s}})(e,r,i,e.terrain?t.projMatrix:null);e.prepareDrawProgram(o,u,t.toUnwrapped());var{tileBoundsBuffer:t,tileBoundsIndexBuffer:e,tileBoundsSegments:r}=e.getTileBoundsBuffers(r);u.draw(o,l.TRIANGLES,n,a,s,re.CullFaceMode.disabled,h,i.id,t,e,r)}}function Wt(e,t,r){if(t.needsDEMTextureUpload){const i=e.context,n=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(r.stride);r=r.getPixels();t.demTexture?t.demTexture.update(r,{premultiply:!1}):t.demTexture=new re.Texture(i,r,n.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}}const Zt=(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_image0:new re.Uniform1i(e,t.u_image0),u_skirt_height:new re.Uniform1f(e,t.u_skirt_height)}),qt=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),Xt=new class{constructor(){this.operations={}}newMorphing(e,t,r,i,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==r.tileID.key&&(t.queued=r)}else this.operations[e]={startTime:i,phase:0,duration:n,from:t,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;e=this.operations[e];return{from:e.from,to:e.to,phase:e.phase}}update(e){for(const t in this.operations){const r=this.operations[t];for(r.phase=(e-r.startTime)/r.duration;1<=r.phase||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},Yt={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};const Kt=e=>({u_matrix:e});function Jt(e,t,r,i,n){if(0<n){var a=re.exported.now(),s=(a-e.timeAdded)/n,n=t?(a-t.timeAdded)/n:-1,r=r.getSource(),r=i.coveringZoomLevel({tileSize:r.tileSize,roundZoom:r.roundZoom}),r=!t||Math.abs(t.tileID.overscaledZ-r)>Math.abs(e.tileID.overscaledZ-r),n=r&&e.refreshedUponExpiration?1:re.clamp(r?s:1-n,0,1);return e.refreshedUponExpiration&&1<=s&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-n}:{opacity:n,mix:0}}return{opacity:1,mix:0}}class Qt extends re.SourceCache{constructor(e){const t=Ee("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new S(Re(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,e,t){if(!r.freezeTileCoverage){var i=(this.transform=r).coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((e,t)=>{if(e[t.key]="",!this._tiles[t.key]){const e=new re.Tile(t,this._source.tileSize*t.overscaleFactor(),r.tileZoom);e.state="loaded",this._tiles[t.key]=e}return e},{});for(const re in this._tiles)re in i||(this.freeFBO(re),this._tiles[re].unloadVectorData(),delete this._tiles[re])}}freeFBO(e){var t=this.proxyCachedFBO[e];void 0!==t&&(t=Object.values(t),this.renderCachePool.push(...t),delete this.proxyCachedFBO[e])}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class er extends re.OverscaledTileID{constructor(e,t,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=r}}class tr extends re.Elevation{constructor(e,t){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,i,n]=function(){const r=new re.StructArrayLayout4i8,i=new re.StructArrayLayout3ui6,n=131;r.reserve(17161),i.reserve(33800);const a=re.EXTENT/128,s=re.EXTENT+a/2,o=s+a;for(let t=-a;t<o;t+=a)for(let e=-a;e<o;e+=a){const n=e<0||e>s||t<0||t>s?24575:0,a=re.clamp(Math.round(e),0,re.EXTENT),o=re.clamp(Math.round(t),0,re.EXTENT);r.emplaceBack(a+n,o,a,o)}const l=(e,t)=>{e=t*n+e;i.emplaceBack(e+1,e,e+n),i.emplaceBack(e+n,e+n+1,e+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)}),[r,i,32768]}(),a=e.context;this.gridBuffer=a.createVertexBuffer(r,re.boundsAttributes.members),this.gridIndexBuffer=a.createIndexBuffer(i),this.gridSegments=re.SegmentVector.simpleSegment(0,0,r.length,i.length),this.gridNoSkirtSegments=re.SegmentVector.simpleSegment(0,0,r.length,n),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qt(t.map),this.orthoMatrix=re.create$1(),re.ortho(this.orthoMatrix,0,re.EXTENT,0,re.EXTENT,0,1);var s=a.gl;this._overlapStencilMode=new re.StencilMode({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=t,this._useVertexMorphing=!0,this._exaggeration=1}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency()}update(e,r,t){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;const i=e.terrain.properties;this.sourceCache=e._getSourceCache(i.get("source")),this._exaggeration=i.get("exaggeration");e=()=>{this.sourceCache.used&&re.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);var e=this.sourceCache.getSource().tileSize/128,t=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(r,e*t,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,e(),this._initializing=!0),e(),r.updateElevation(!t),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){var e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&re.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){var e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(this.enabled){this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(re.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const a=this.proxyCoords=i.getIds().map(e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=n.calculateProjMatrix(t.toUnwrapped()),t});!function(e,t){const r=t.transform.pointCoordinate(t.transform.getCameraPoint()),a=new re.pointGeometry(r.x,r.y);e.sort((e,t)=>{if(t.overscaledZ-e.overscaledZ)return t.overscaledZ-e.overscaledZ;const r=new re.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),i=new re.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),n=a.mult(1<<e.canonical.z);return n.x-=.5,n.y-=.5,n.distSqr(r)-n.distSqr(i)})}(a,this.painter),this._previousZoom=n.zoom;var t=this.proxyToSource||{};this.proxyToSource={},a.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};var r=this._style._sourceCaches;for(const re in r){const i=r[re];if(i.used&&(i!==this.sourceCache&&(this._findCoveringTileCache[i.id]={}),this._setupProxiedCoordsForOrtho(i,e[re],t),!i.usedForTerrain)){const n=e[re];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}}this.proxiedCoords[i.id]=a.map(e=>new er(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(t),this.renderingToTexture=!1,this._updateTimestamp=re.exported.now();const s={};this._visibleDemTiles=[];for(const re of this.proxyCoords){const e=this.terrainTileForTile[re.key];if(e){const i=e.tileID.key;i in s||(this._visibleDemTiles.push(e),s[i]=i)}}}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{var t;this.terrainTileForTile[e.key]||(t=this._findTileCoveringTileID(e,this.sourceCache))&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){var r=this.terrainTileForTile[n],i=r.dem;!i||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Wt(this.painter,r,i))}}_prepareDemTileUniforms(e,t,r,i){if(!t||null==t.demTexture)return!1;e=e.tileID.canonical,t=Math.pow(2,t.tileID.canonical.z-e.z),i=i||"";return r[`u_dem_tl${i}`]=[e.x*t%1,e.y*t%1],r[`u_dem_scale${i}`]=t,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let r=0;var e=this._visibleDemTiles.reduce((e,t)=>{if(!t.dem)return e;t=t.dem.tree.minimums[0];return 0<t&&r++,e+t},0);return r?e/r:0}_updateEmptyDEMTexture(){const e=this.painter.context,t=e.gl;e.activeTexture.set(t.TEXTURE2);var r=this._getLoadedAreaMinimum(),r={width:1,height:1,data:new Uint8Array(re.DEMData.pack(r,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let i=this._emptyDEMTexture;return i?i.update(r,{premultiply:!1}):i=this._emptyDEMTexture=new re.Texture(e,r,t.RGBA,{premultiply:!1}),i}setupElevationDraw(e,t,r){const i=this.painter.context,n=i.gl,a=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:re.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var s;a.u_dem_size=this.sourceCache.getSource().tileSize,a.u_exaggeration=this.exaggeration();let o=null,l=null,c=1;if(r&&r.morphing&&this._useVertexMorphing){const re=r.morphing.srcDemTile,t=r.morphing.dstDemTile;c=r.morphing.phase,re&&t&&(this._prepareDemTileUniforms(e,re,a,"_prev")&&(l=re),this._prepareDemTileUniforms(e,t,a)&&(o=t))}if(l&&o?(i.activeTexture.set(n.TEXTURE2),o.demTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE,n.NEAREST),i.activeTexture.set(n.TEXTURE4),l.demTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE,n.NEAREST),a.u_dem_lerp=c):(o=this.terrainTileForTile[e.tileID.key],i.activeTexture.set(n.TEXTURE2),(this._prepareDemTileUniforms(e,o,a)?o.demTexture:this.emptyDEMTexture).bind(n.NEAREST,n.CLAMP_TO_EDGE)),r&&r.useDepthForOcclusion&&(i.activeTexture.set(n.TEXTURE3),this._depthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),r&&r.useMeterToDem&&o){const e=(1<<o.tileID.canonical.z)*re.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=e}r&&r.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),t.setTerrainUniformValues(i,a)}renderToBackBuffer(e){const t=this.painter,r=this.painter.context;0!==e.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]),this.renderingToTexture=!1,function(d,p,f,m,g){const _=d.context,v=_.gl;let y,x;const i=d.options.showTerrainWireframe?2:0,b=(e,t)=>{if(x!==e){const r=[Yt[e]];t&&r.push(Yt[i]),y=d.useProgram("terrainRaster",null,r),x=e}},w=d.colorModeForRenderPass(),T=new re.DepthMode(v.LEQUAL,re.DepthMode.ReadWrite,d.depthRangeFor3D);Xt.update(g);const E=d.transform,S=6*Math.pow(1.5,22-E.zoom)*p.exaggeration();(i?[!1,!0]:[!1]).forEach(t=>{x=-1;var r,i,n=t?v.LINES:v.TRIANGLES,[a,s]=t?p.getWirefameBuffer():[p.gridIndexBuffer,p.gridSegments];for(const x of m){const m=f.getTile(x),c=re.StencilMode.disabled,h=p.prevTerrainTileForTile[x.key],u=p.terrainTileForTile[x.key];i=u,null!=(r=h)&&null!=i&&r.hasData()&&i.hasData()&&null!=r.demTexture&&null!=i.demTexture&&r.tileID.key!==i.tileID.key&&Xt.newMorphing(x.key,h,u,g,250),_.activeTexture.set(v.TEXTURE0),m.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE);var o=Xt.getMorphValuesForProxy(x.key),l=o?1:0;let e;o&&(e={morphing:{srcDemTile:o.from,dstDemTile:o.to,phase:re.easeCubicInOut(o.phase)}});o=qt(x.projMatrix,(r=x.canonical,i=E.renderWorldCopies,o=void 0,o=1<<r.z,(i||0!==r.x&&r.x!==o-1)&&0!==r.y&&r.y!==o-1?S:S/10));b(l,t),p.setupElevationDraw(m,y,e),d.prepareDrawProgram(_,y,x.toUnwrapped()),y.draw(_,n,T,c,w,re.CullFaceMode.backCCW,o,"terrain_raster",p.gridBuffer,a,s)}})}(t,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,e.splice(0,e.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,a=this.proxySourceCache,s=this.proxiedCoords[a.id],o=this._drapedRenderBatches.shift(),e=[],l=i.style.order;let c=0;for(const h of s){const s=a.getTileByID(h.proxyTileKey),t=a.proxyCachedFBO[h.key]?a.proxyCachedFBO[h.key][r]:void 0,u=void 0!==t?a.renderCache[t]:this.pool[c++],d=void 0!==t;if(s.texture=u.tex,!d||u.dirty){let t;n.bindFramebuffer.set(u.fb.framebuffer),this.renderedToTile=!1,u.dirty&&(n.clear({color:re.Color.transparent}),u.dirty=!1);for(let e=o.start;e<=o.end;++e){const r=i.style._layers[l[e]];if(!r.isHidden(i.transform.zoom)){const a=i.style._getLayerSourceCache(r),s=a?this.proxyToSource[h.key][a.id]:[h];if(s){const o=s;n.viewport.set([0,0,u.fb.width,u.fb.height]),t!==(a?a.id:null)&&(this._setupStencil(u,s,r,a),t=a?a.id:null),i.renderLayer(i,a,r,o)}}}this.renderedToTile?(u.dirty=!0,e.push(s.tileID)):d||--c,5===c&&(c=0,this.renderToBackBuffer(e))}else e.push(s.tileID)}return this.renderToBackBuffer(e),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),o.end+1}postRender(){}renderCacheEfficiency(t){const r=t.order.length;if(0===r)return{efficiency:100};let i,n=0,a=0,s=!1;for(let e=0;e<r;++e){const r=t._layers[t.order[e]];this._style.isLayerDraped(r)?(s&&++n,++a):s||(s=!0,i=r.id)}return 0===a?{efficiency:100}:{efficiency:100*(1-n/a),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(s,o,l){if(!this._visibleDemTiles)return null;const e=this._visibleDemTiles.filter(e=>e.dem).map(e=>{var t=e.tileID,r=Math.pow(2,t.overscaledZ),{x:i,y:n}=t.canonical,a=i/r,t=(i+1)/r,i=n/r,r=(n+1)/r;return{minx:a,miny:i,maxx:t,maxy:r,t:e.dem.tree.raycastRoot(a,i,t,r,s,o,l),tile:e}});e.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const t of e){if(null==t.t)return null;const e=t.tile.dem.tree.raycast(t.minx,t.miny,t.maxx,t.maxy,s,o,l);if(null!=e)return e}return null}_createFBO(){const e=this.painter.context,t=e.gl,r=this.drapeBufferSize;e.activeTexture.set(t.TEXTURE0);const i=new re.Texture(e,{width:r[0],height:r[1],data:null},t.RGBA);i.bind(t.LINEAR,t.CLAMP_TO_EDGE);const n=e.createFramebuffer(r[0],r[1],!1);return n.colorAttachment.set(i.texture),n.depthAttachment=new ve(e,n.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,n.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):n.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&t.texParameterf(t.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:n,tex:i,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const t=this._style._layers[e],r=t.isHidden(this.painter.transform.zoom),i=t.getCrossfadeParameters(),n=!!i&&1!==i.t,a=t.hasTransition();return"custom"!==t.type&&!r&&(n||a)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e]._source instanceof be){t=!0;break}if(t)for(let e=0;e<this._style.order.length;++e){const a=this._style._layers[this._style.order[e]],s=a.isHidden(this.painter.transform.zoom),o=this._style._getLayerSourceCache(a);if("raster"===a.type&&!s&&o){var r=a.paint.get("raster-fade-duration");for(const t of this.proxyCoords){var i=this.proxyToSource[t.key][o.id];if(i)for(const t of i){var n=Jt(o.getTile(t),o.findLoadedParent(t,0),o,this.painter.transform,r);1===n.opacity&&0===n.mix||this._clearRenderCacheForTile(o.id,t)}}}}}_setupDrapedRenderBatches(){const i=this._style.order,n=i.length;if(0!==n){const a=[];let e,t=0,r=this._style._layers[i[t]];for(;!this._style.isLayerDraped(r)&&r.isHidden(this.painter.transform.zoom)&&++t<n;)r=this._style._layers[i[t]];for(;t<n;++t){const n=this._style._layers[i[t]];n.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(n)?void 0===e&&(e=t):void 0!==e&&(a.push({start:e,end:t-1}),e=void 0))}void 0!==e&&a.push({start:e,end:t-1}),this._drapedRenderBatches=a}}_setupRenderCache(r){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const r=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let e=0;e<r.length;++e){const n=Object.values(r[e]);t.renderCachePool.push(...n)}}}else{this._clearRasterFadeFromRenderCache();const a=this.proxyCoords,n=this._tilesDirty;for(let e=a.length-1;0<=e;e--){var i=a[e];if(t.getTileByID(i.key),void 0!==t.proxyCachedFBO[i.key]){const a=r[i.key],s=this.proxyToSource[i.key];let e=0;for(const r in s){const t=s[r],o=a[r];if(!o||o.length!==t.length||t.some((e,t)=>e!==o[t]||n[r]&&n[r].hasOwnProperty(e.key))){e=-1;break}++e}for(const r in t.proxyCachedFBO[i.key])t.renderCache[t.proxyCachedFBO[i.key][r]].dirty=e<0||e!==Object.values(a).length}}const s=[...this._drapedRenderBatches];s.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const r of s)for(const n of a)if(!t.proxyCachedFBO[n.key]){let e=t.renderCachePool.pop();void 0===e&&t.renderCache.length<50&&(e=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==e&&(t.proxyCachedFBO[n.key]={},t.proxyCachedFBO[n.key][r.start]=e,t.renderCache[e].dirty=!0)}this._tilesDirty={}}}_setupStencil(e,t,r,i){if(i&&this._sourceTilesOverlap[i.id]){const n=this.painter.context,a=n.gl;if(t.length<=1)this._overlapStencilType=!1;else{let e;if(r.isTileClipped())e=t.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);e=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}255<this._stencilRef+e&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=e,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}}else this._overlapStencilType&&(this._overlapStencilType=!1)}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):re.StencilMode.disabled}_renderTileClippingMasks(e,t){const r=this.painter,i=this.painter.context,n=i.gl;r._tileClippingMaskIDs={},i.setColorMode(re.ColorMode.disabled),i.setDepthMode(re.DepthMode.disabled);const a=r.useProgram("clippingMask");for(const s of e){const e=r._tileClippingMaskIDs[s.key]=--t;a.draw(i,n.TRIANGLES,re.DepthMode.disabled,new re.StencilMode({func:n.ALWAYS,mask:0},e,255,n.KEEP,n.KEEP,n.REPLACE),re.ColorMode.disabled,re.CullFaceMode.disabled,Kt(s.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){var t=this.painter.transform;if(e.x<0||e.x>t.width||e.y<0||e.y>t.height)return null;const r=[e.x,e.y,1,1];re.transformMat4(r,r,t.pixelMatrixInverse),re.scale$2(r,r,1/r[3]),r[0]/=t.worldSize,r[1]/=t.worldSize;const i=t._camera.position,n=re.mercatorZfromAltitude(1,t.center.lat),a=[i[0],i[1],i[2]/n,0],s=re.subtract([],r.slice(0,3),a);re.normalize(s,s);t=this.raycast(a,s,this._exaggeration);return null!==t&&t?(re.scaleAndAdd(a,a,s,t),a[3]=a[2],a[2]*=n,a):null}drawDepth(){const e=this.painter,t=e.context,r=this.proxySourceCache,i=Math.ceil(e.width),n=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===n||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const e=t.gl,r=t.createFramebuffer(i,n,!0);t.activeTexture.set(e.TEXTURE0);const s=new re.Texture(t,{width:i,height:n,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),r.colorAttachment.set(s.texture);var a=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,i,n);r.depthAttachment.set(a),this._depthFBO=r,this._depthTexture=s}t.bindFramebuffer.set(this._depthFBO.framebuffer),t.viewport.set([0,0,i,n]),function(e,t,r,i){const n=e.context,a=n.gl;n.clear({depth:1});const s=e.useProgram("terrainDepth"),o=new re.DepthMode(a.LESS,re.DepthMode.ReadWrite,e.depthRangeFor3D);for(const e of i){const i=r.getTile(e),l=qt(e.projMatrix,0);t.setupElevationDraw(i,s),s.draw(n,a.TRIANGLES,o,re.StencilMode.disabled,re.ColorMode.unblended,re.CullFaceMode.backCCW,l,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,r,i){if(t.getSource()instanceof Te)return this._setupProxiedCoordsForImageSource(t,r,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],a=this.proxyCoords;for(let e=0;e<a.length;e++){const s=a[e],l=this._findTileCoveringTileID(s,t);if(l){const r=this._createProxiedId(s,l,i[s.key]&&i[s.key][t.id]);n.push(r),this.proxyToSource[s.key][t.id]=[r]}}let s=!1;for(let e=0;e<r.length;e++){const c=t.getTile(r[e]);if(c&&c.hasData()){var o=this._findTileCoveringTileID(c.tileID,this.proxySourceCache);if(o&&o.tileID.canonical.z!==c.tileID.canonical.z){const r=this.proxyToSource[o.tileID.key][t.id],a=this._createProxiedId(o.tileID,c,i[o.tileID.key]&&i[o.tileID.key][t.id]);r?r.splice(r.length-1,0,a):this.proxyToSource[o.tileID.key][t.id]=[a],n.push(a),s=!0}}}this._sourceTilesOverlap[t.id]=s}_setupProxiedCoordsForImageSource(t,r,i){if(t.getSource().loaded()){const n=this.proxiedCoords[t.id]=[],a=this.proxyCoords,s=t.getSource(),o=new re.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(re.MercatorCoordinate.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-o.x),e.min.y=Math.min(e.min.y,t.y-o.y),e.max.x=Math.max(e.max.x,t.x-o.x),e.max.y=Math.max(e.max.y,t.y-o.y),e),{min:new re.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new re.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,t)=>{var r=e.wrap+e.canonical.x/(1<<e.canonical.z),i=e.canonical.y/(1<<e.canonical.z),n=re.EXTENT/(1<<e.canonical.z),e=t.wrap+t.canonical.x/(1<<t.canonical.z),t=t.canonical.y/(1<<t.canonical.z);return r+n<e+l.min.x||r>e+l.max.x||i+n<t+l.min.y||i>t+l.max.y};for(let e=0;e<a.length;e++){const s=a[e];for(let e=0;e<r.length;e++){const a=t.getTile(r[e]);if(a&&a.hasData()&&!c(s,a.tileID)){const o=this._createProxiedId(s,a,i[s.key]&&i[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(o):this.proxyToSource[s.key][t.id]=[o],n.push(o)}}}}}_createProxiedId(i,n,a){let s=this.orthoMatrix;if(a){const re=a.find(e=>e.key===n.tileID.key);if(re)return re}if(n.tileID.key!==i.key){const o=i.canonical.z-n.tileID.canonical.z;let e,t,r;s=re.create$1();a=n.tileID.wrap-i.wrap<<i.overscaledZ;r=0<o?(e=re.EXTENT>>o,t=e*((n.tileID.canonical.x<<o)-i.canonical.x+a),e*((n.tileID.canonical.y<<o)-i.canonical.y)):(e=re.EXTENT<<-o,t=re.EXTENT*(n.tileID.canonical.x-(i.canonical.x+a<<-o)),re.EXTENT*(n.tileID.canonical.y-(i.canonical.y<<-o))),re.ortho(s,0,e,0,e,0,1),re.translate(s,s,[t,r,0])}return new er(n.tileID,i.key,s)}_findTileCoveringTileID(e,t){let r=t.getTile(e);if(r&&r.hasData())return r;const i=this._findCoveringTileCache[t.id],n=i[e.key];if(r=n?t.getTileByID(n):null,r&&r.hasData()||null===n)return r;let a=r?r.tileID:e,s=a.overscaledZ;const o=t.getSource().minzoom,l=[];if(!n){const i=t.getSource().maxzoom;if(e.canonical.z>=i){const r=e.canonical.z-i;t.getSource().reparseOverscaled?(s=Math.max(e.canonical.z+2,t.transform.tileZoom),a=new re.OverscaledTileID(s,e.wrap,i,e.canonical.x>>r,e.canonical.y>>r)):0!=r&&(s=i,a=new re.OverscaledTileID(s,e.wrap,i,e.canonical.x>>r,e.canonical.y>>r))}a.key!==e.key&&(l.push(a.key),r=t.getTile(a))}var c=t=>{l.forEach(e=>{i[e]=t}),l.length=0};for(--s;s>=o&&(!r||!r.hasData());s--){r&&c(r.tileID.key);const re=a.calculateScaledKey(s);if(r=t.getTileByID(re),r&&r.hasData())break;const e=i[re];if(null===e)break;void 0===e?l.push(re):r=t.getTileByID(e)}return c(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(e){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let r=this._tilesDirty[e];r=r||(this._tilesDirty[e]={}),r[t.key]=!0}getWirefameBuffer(){var e;return this.wireframeSegments||(e=function(){let e,t,r;const i=new re.StructArrayLayout2ui4;for(t=1;t<129;t++){for(e=1;e<129;e++)r=131*t+e,i.emplaceBack(r,r+1),i.emplaceBack(r,r+131),i.emplaceBack(r+1,r+131),128===t&&i.emplaceBack(r+131,r+131+1);i.emplaceBack(r+1,r+1+131)}return i}(),this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=re.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)),[this.wireframeIndexBuffer,this.wireframeSegments]}}function rr(t){const r=[];for(let e=0;e<t.length;e++)if(null!==t[e]){const i=t[e].split(" ");r.push(i.pop())}return r}class ir{static cacheKey(e,t,r){let i=`${e}${r?r.cacheKey:""}`;for(const e of t)i+=`/${e}`;return i}constructor(e,t,r,i,n,a){const s=e.gl;this.program=s.createProgram();const o=rr(r.staticAttributes),l=i?i.getBinderAttributes():[],c=o.concat(l),h=r.staticUniforms?rr(r.staticUniforms):[],u=i?i.getBinderUniforms():[],d=h.concat(u),p=[];for(const re of d)p.indexOf(re)<0&&p.push(re);let f=i?i.defines():[];f=f.concat(a.map(e=>`#define ${e}`));var m=f.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Gt,Ut.fragmentSource,Nt.fragmentSource,r.fragmentSource).join("\n"),g=f.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Gt,Ut.vertexSource,Nt.vertexSource,zt.vertexSource,r.vertexSource).join("\n"),r=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(r,m),s.compileShader(r),s.attachShader(this.program,r);m=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(m,g),s.compileShader(m),s.attachShader(this.program,m),this.attributes={};const _={};this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)c[e]&&(s.bindAttribLocation(this.program,e,c[e]),this.attributes[c[e]]=e);s.linkProgram(this.program),s.deleteShader(m),s.deleteShader(r);for(let e=0;e<p.length;e++){const v=p[e];if(v&&!_[v]){const re=s.getUniformLocation(this.program,v);re&&(_[v]=re)}}this.fixedUniforms=n(e,_),this.binderUniforms=i?i.getUniforms(e,_):[],-1!==a.indexOf("TERRAIN")&&(this.terrainUniforms=(n=e,i=_,{u_dem:new re.Uniform1i(n,i.u_dem),u_dem_prev:new re.Uniform1i(n,i.u_dem_prev),u_dem_unpack:new re.Uniform4f(n,i.u_dem_unpack),u_dem_tl:new re.Uniform2f(n,i.u_dem_tl),u_dem_scale:new re.Uniform1f(n,i.u_dem_scale),u_dem_tl_prev:new re.Uniform2f(n,i.u_dem_tl_prev),u_dem_scale_prev:new re.Uniform1f(n,i.u_dem_scale_prev),u_dem_size:new re.Uniform1f(n,i.u_dem_size),u_dem_lerp:new re.Uniform1f(n,i.u_dem_lerp),u_exaggeration:new re.Uniform1f(n,i.u_exaggeration),u_depth:new re.Uniform1i(n,i.u_depth),u_depth_size_inv:new re.Uniform2f(n,i.u_depth_size_inv),u_meter_to_dem:new re.Uniform1f(n,i.u_meter_to_dem),u_label_plane_matrix_inv:new re.UniformMatrix4f(n,i.u_label_plane_matrix_inv),u_tile_tl_up:new re.Uniform3f(n,i.u_tile_tl_up),u_tile_tr_up:new re.Uniform3f(n,i.u_tile_tr_up),u_tile_br_up:new re.Uniform3f(n,i.u_tile_br_up),u_tile_bl_up:new re.Uniform3f(n,i.u_tile_bl_up),u_tile_up_scale:new re.Uniform1f(n,i.u_tile_up_scale)})),-1!==a.indexOf("FOG")&&(this.fogUniforms=(a=e,e=_,{u_fog_matrix:new re.UniformMatrix4f(a,e.u_fog_matrix),u_fog_range:new re.Uniform2f(a,e.u_fog_range),u_fog_color:new re.Uniform4f(a,e.u_fog_color),u_fog_horizon_blend:new re.Uniform1f(a,e.u_fog_horizon_blend),u_fog_temporal_offset:new re.Uniform1f(a,e.u_fog_temporal_offset)}))}}}setTerrainUniformValues(e,t){if(this.terrainUniforms){const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(t[e])}}}setFogUniformValues(e,t){if(this.fogUniforms){const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].location&&r[e].set(t[e])}}}draw(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m){const g=e.gl;if(!this.failedToCreate){e.program.set(this.program),e.setDepthMode(r),e.setStencilMode(i),e.setColorMode(n),e.setCullFace(a);for(const e in this.fixedUniforms)this.fixedUniforms[e].set(s[e]);p&&p.setUniforms(e,this.binderUniforms,u,{zoom:d});var _={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t];for(const r of h.get()){const i=r.vaos||(r.vaos={});(i[o]||(i[o]=new jt)).bind(e,this,l,p?p.getPaintVertexBuffers():[],c,r.vertexOffset,f,m),g.drawElements(t,r.primitiveLength*_,g.UNSIGNED_SHORT,r.primitiveOffset*_*2)}}}}function nr(e,t,r){var i=1/M(r,1,t.transform.tileZoom),n=Math.pow(2,r.tileID.overscaledZ),t=r.tileSize*Math.pow(2,t.transform.tileZoom)/n,n=t*(r.tileID.canonical.x+r.tileID.wrap*n),t=t*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[n>>16,t>>16],u_pixel_coord_lower:[65535&n,65535&t]}}const ar=(e,t,r,i)=>{const n=t.style.light,a=n.properties.get("position"),s=[a.x,a.y,a.z],o=re.create$2();"viewport"===n.properties.get("anchor")&&(re.fromRotation(o,-t.transform.angle),re.transformMat3(s,s,o));t=n.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:n.properties.get("intensity"),u_lightcolor:[t.r,t.g,t.b],u_vertical_gradient:+r,u_opacity:i}},sr=e=>({u_matrix:e}),or=(e,t,r,i)=>re.extend(sr(e),nr(r,t,i)),lr=(e,t,r,i,n)=>re.extend(or(e,t,r,i),{u_world:n}),cr=(e,t,r=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:r});function hr(e,t){return 1/M(e,1,t.tileZoom)}function ur(e,t,r,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}function dr(e){e=e.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const pr=(e,t,r,i,n)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:r,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:0<(i=n.paint.get("raster-saturation"))?1-1/(1.001-i):-i,u_contrast_factor:0<(i=n.paint.get("raster-contrast"))?1/(1-i):1+i,u_spin_weights:function(e){e*=Math.PI/180;var t=Math.sin(e),e=Math.cos(e);return[(2*e+1)/3,(-Math.sqrt(3)*t-e+1)/3,(Math.sqrt(3)*t-e+1)/3]}(n.paint.get("raster-hue-rotate"))}};const fr=(e,t,r,i,n,a,s,o,l,c,h,u,d,p)=>{var f=n.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:f.cameraToCenterDistance,u_pitch:f.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:f.width/f.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:s,u_coord_matrix:o,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_tile_id:h,u_zoom_transition:u,u_inv_rot_matrix:d,u_merc_center:p,u_texture:0}},mr=(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f)=>{var{cameraToCenterDistance:m,_pitch:g}=n.transform;return re.extend(fr(e,t,r,i,n,a,s,o,l,c,u,d,p,f),{u_gamma_scale:i?m*Math.cos(n.terrain?0:g):1,u_device_pixel_ratio:re.exported.devicePixelRatio,u_is_halo:+h})},gr={fillExtrusion:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_lightpos:new re.Uniform3f(e,t.u_lightpos),u_lightintensity:new re.Uniform1f(e,t.u_lightintensity),u_lightcolor:new re.Uniform3f(e,t.u_lightcolor),u_vertical_gradient:new re.Uniform1f(e,t.u_vertical_gradient),u_opacity:new re.Uniform1f(e,t.u_opacity)}),fillExtrusionPattern:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_lightpos:new re.Uniform3f(e,t.u_lightpos),u_lightintensity:new re.Uniform1f(e,t.u_lightintensity),u_lightcolor:new re.Uniform3f(e,t.u_lightcolor),u_vertical_gradient:new re.Uniform1f(e,t.u_vertical_gradient),u_height_factor:new re.Uniform1f(e,t.u_height_factor),u_image:new re.Uniform1i(e,t.u_image),u_texsize:new re.Uniform2f(e,t.u_texsize),u_pixel_coord_upper:new re.Uniform2f(e,t.u_pixel_coord_upper),u_pixel_coord_lower:new re.Uniform2f(e,t.u_pixel_coord_lower),u_scale:new re.Uniform3f(e,t.u_scale),u_fade:new re.Uniform1f(e,t.u_fade),u_opacity:new re.Uniform1f(e,t.u_opacity)}),fill:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix)}),fillPattern:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_image:new re.Uniform1i(e,t.u_image),u_texsize:new re.Uniform2f(e,t.u_texsize),u_pixel_coord_upper:new re.Uniform2f(e,t.u_pixel_coord_upper),u_pixel_coord_lower:new re.Uniform2f(e,t.u_pixel_coord_lower),u_scale:new re.Uniform3f(e,t.u_scale),u_fade:new re.Uniform1f(e,t.u_fade)}),fillOutline:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_world:new re.Uniform2f(e,t.u_world)}),fillOutlinePattern:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_world:new re.Uniform2f(e,t.u_world),u_image:new re.Uniform1i(e,t.u_image),u_texsize:new re.Uniform2f(e,t.u_texsize),u_pixel_coord_upper:new re.Uniform2f(e,t.u_pixel_coord_upper),u_pixel_coord_lower:new re.Uniform2f(e,t.u_pixel_coord_lower),u_scale:new re.Uniform3f(e,t.u_scale),u_fade:new re.Uniform1f(e,t.u_fade)}),circle:(e,t)=>({u_camera_to_center_distance:new re.Uniform1f(e,t.u_camera_to_center_distance),u_extrude_scale:new re.UniformMatrix2f(e,t.u_extrude_scale),u_device_pixel_ratio:new re.Uniform1f(e,t.u_device_pixel_ratio),u_matrix:new re.UniformMatrix4f(e,t.u_matrix)}),collisionBox:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_camera_to_center_distance:new re.Uniform1f(e,t.u_camera_to_center_distance),u_extrude_scale:new re.Uniform2f(e,t.u_extrude_scale)}),collisionCircle:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_inv_matrix:new re.UniformMatrix4f(e,t.u_inv_matrix),u_camera_to_center_distance:new re.Uniform1f(e,t.u_camera_to_center_distance),u_viewport_size:new re.Uniform2f(e,t.u_viewport_size)}),debug:(e,t)=>({u_color:new re.UniformColor(e,t.u_color),u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_overlay:new re.Uniform1i(e,t.u_overlay),u_overlay_scale:new re.Uniform1f(e,t.u_overlay_scale)}),clippingMask:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix)}),heatmap:(e,t)=>({u_extrude_scale:new re.Uniform1f(e,t.u_extrude_scale),u_intensity:new re.Uniform1f(e,t.u_intensity),u_matrix:new re.UniformMatrix4f(e,t.u_matrix)}),heatmapTexture:(e,t)=>({u_image:new re.Uniform1i(e,t.u_image),u_color_ramp:new re.Uniform1i(e,t.u_color_ramp),u_opacity:new re.Uniform1f(e,t.u_opacity)}),hillshade:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_image:new re.Uniform1i(e,t.u_image),u_latrange:new re.Uniform2f(e,t.u_latrange),u_light:new re.Uniform2f(e,t.u_light),u_shadow:new re.UniformColor(e,t.u_shadow),u_highlight:new re.UniformColor(e,t.u_highlight),u_accent:new re.UniformColor(e,t.u_accent)}),hillshadePrepare:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_image:new re.Uniform1i(e,t.u_image),u_dimension:new re.Uniform2f(e,t.u_dimension),u_zoom:new re.Uniform1f(e,t.u_zoom),u_unpack:new re.Uniform4f(e,t.u_unpack)}),line:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_pixels_to_tile_units:new re.UniformMatrix2f(e,t.u_pixels_to_tile_units),u_device_pixel_ratio:new re.Uniform1f(e,t.u_device_pixel_ratio),u_units_to_pixels:new re.Uniform2f(e,t.u_units_to_pixels),u_dash_image:new re.Uniform1i(e,t.u_dash_image),u_gradient_image:new re.Uniform1i(e,t.u_gradient_image),u_image_height:new re.Uniform1f(e,t.u_image_height),u_texsize:new re.Uniform2f(e,t.u_texsize),u_scale:new re.Uniform3f(e,t.u_scale),u_mix:new re.Uniform1f(e,t.u_mix)}),linePattern:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_texsize:new re.Uniform2f(e,t.u_texsize),u_pixels_to_tile_units:new re.UniformMatrix2f(e,t.u_pixels_to_tile_units),u_device_pixel_ratio:new re.Uniform1f(e,t.u_device_pixel_ratio),u_image:new re.Uniform1i(e,t.u_image),u_units_to_pixels:new re.Uniform2f(e,t.u_units_to_pixels),u_scale:new re.Uniform3f(e,t.u_scale),u_fade:new re.Uniform1f(e,t.u_fade)}),raster:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_tl_parent:new re.Uniform2f(e,t.u_tl_parent),u_scale_parent:new re.Uniform1f(e,t.u_scale_parent),u_buffer_scale:new re.Uniform1f(e,t.u_buffer_scale),u_fade_t:new re.Uniform1f(e,t.u_fade_t),u_opacity:new re.Uniform1f(e,t.u_opacity),u_image0:new re.Uniform1i(e,t.u_image0),u_image1:new re.Uniform1i(e,t.u_image1),u_brightness_low:new re.Uniform1f(e,t.u_brightness_low),u_brightness_high:new re.Uniform1f(e,t.u_brightness_high),u_saturation_factor:new re.Uniform1f(e,t.u_saturation_factor),u_contrast_factor:new re.Uniform1f(e,t.u_contrast_factor),u_spin_weights:new re.Uniform3f(e,t.u_spin_weights)}),symbolIcon:(e,t)=>({u_is_size_zoom_constant:new re.Uniform1i(e,t.u_is_size_zoom_constant),u_is_size_feature_constant:new re.Uniform1i(e,t.u_is_size_feature_constant),u_size_t:new re.Uniform1f(e,t.u_size_t),u_size:new re.Uniform1f(e,t.u_size),u_camera_to_center_distance:new re.Uniform1f(e,t.u_camera_to_center_distance),u_pitch:new re.Uniform1f(e,t.u_pitch),u_rotate_symbol:new re.Uniform1i(e,t.u_rotate_symbol),u_aspect_ratio:new re.Uniform1f(e,t.u_aspect_ratio),u_fade_change:new re.Uniform1f(e,t.u_fade_change),u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_label_plane_matrix:new re.UniformMatrix4f(e,t.u_label_plane_matrix),u_coord_matrix:new re.UniformMatrix4f(e,t.u_coord_matrix),u_is_text:new re.Uniform1i(e,t.u_is_text),u_pitch_with_map:new re.Uniform1i(e,t.u_pitch_with_map),u_texsize:new re.Uniform2f(e,t.u_texsize),u_tile_id:new re.Uniform3f(e,t.u_tile_id),u_zoom_transition:new re.Uniform1f(e,t.u_zoom_transition),u_inv_rot_matrix:new re.UniformMatrix4f(e,t.u_inv_rot_matrix),u_merc_center:new re.Uniform2f(e,t.u_merc_center),u_texture:new re.Uniform1i(e,t.u_texture)}),symbolSDF:(e,t)=>({u_is_size_zoom_constant:new re.Uniform1i(e,t.u_is_size_zoom_constant),u_is_size_feature_constant:new re.Uniform1i(e,t.u_is_size_feature_constant),u_size_t:new re.Uniform1f(e,t.u_size_t),u_size:new re.Uniform1f(e,t.u_size),u_camera_to_center_distance:new re.Uniform1f(e,t.u_camera_to_center_distance),u_pitch:new re.Uniform1f(e,t.u_pitch),u_rotate_symbol:new re.Uniform1i(e,t.u_rotate_symbol),u_aspect_ratio:new re.Uniform1f(e,t.u_aspect_ratio),u_fade_change:new re.Uniform1f(e,t.u_fade_change),u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_label_plane_matrix:new re.UniformMatrix4f(e,t.u_label_plane_matrix),u_coord_matrix:new re.UniformMatrix4f(e,t.u_coord_matrix),u_is_text:new re.Uniform1i(e,t.u_is_text),u_pitch_with_map:new re.Uniform1i(e,t.u_pitch_with_map),u_texsize:new re.Uniform2f(e,t.u_texsize),u_texture:new re.Uniform1i(e,t.u_texture),u_gamma_scale:new re.Uniform1f(e,t.u_gamma_scale),u_device_pixel_ratio:new re.Uniform1f(e,t.u_device_pixel_ratio),u_tile_id:new re.Uniform3f(e,t.u_tile_id),u_zoom_transition:new re.Uniform1f(e,t.u_zoom_transition),u_inv_rot_matrix:new re.UniformMatrix4f(e,t.u_inv_rot_matrix),u_merc_center:new re.Uniform2f(e,t.u_merc_center),u_is_halo:new re.Uniform1i(e,t.u_is_halo)}),symbolTextAndIcon:(e,t)=>({u_is_size_zoom_constant:new re.Uniform1i(e,t.u_is_size_zoom_constant),u_is_size_feature_constant:new re.Uniform1i(e,t.u_is_size_feature_constant),u_size_t:new re.Uniform1f(e,t.u_size_t),u_size:new re.Uniform1f(e,t.u_size),u_camera_to_center_distance:new re.Uniform1f(e,t.u_camera_to_center_distance),u_pitch:new re.Uniform1f(e,t.u_pitch),u_rotate_symbol:new re.Uniform1i(e,t.u_rotate_symbol),u_aspect_ratio:new re.Uniform1f(e,t.u_aspect_ratio),u_fade_change:new re.Uniform1f(e,t.u_fade_change),u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_label_plane_matrix:new re.UniformMatrix4f(e,t.u_label_plane_matrix),u_coord_matrix:new re.UniformMatrix4f(e,t.u_coord_matrix),u_is_text:new re.Uniform1i(e,t.u_is_text),u_pitch_with_map:new re.Uniform1i(e,t.u_pitch_with_map),u_texsize:new re.Uniform2f(e,t.u_texsize),u_texsize_icon:new re.Uniform2f(e,t.u_texsize_icon),u_texture:new re.Uniform1i(e,t.u_texture),u_texture_icon:new re.Uniform1i(e,t.u_texture_icon),u_gamma_scale:new re.Uniform1f(e,t.u_gamma_scale),u_device_pixel_ratio:new re.Uniform1f(e,t.u_device_pixel_ratio),u_is_halo:new re.Uniform1i(e,t.u_is_halo)}),background:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_opacity:new re.Uniform1f(e,t.u_opacity),u_color:new re.UniformColor(e,t.u_color)}),backgroundPattern:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_opacity:new re.Uniform1f(e,t.u_opacity),u_image:new re.Uniform1i(e,t.u_image),u_pattern_tl_a:new re.Uniform2f(e,t.u_pattern_tl_a),u_pattern_br_a:new re.Uniform2f(e,t.u_pattern_br_a),u_pattern_tl_b:new re.Uniform2f(e,t.u_pattern_tl_b),u_pattern_br_b:new re.Uniform2f(e,t.u_pattern_br_b),u_texsize:new re.Uniform2f(e,t.u_texsize),u_mix:new re.Uniform1f(e,t.u_mix),u_pattern_size_a:new re.Uniform2f(e,t.u_pattern_size_a),u_pattern_size_b:new re.Uniform2f(e,t.u_pattern_size_b),u_scale_a:new re.Uniform1f(e,t.u_scale_a),u_scale_b:new re.Uniform1f(e,t.u_scale_b),u_pixel_coord_upper:new re.Uniform2f(e,t.u_pixel_coord_upper),u_pixel_coord_lower:new re.Uniform2f(e,t.u_pixel_coord_lower),u_tile_units_to_pixels:new re.Uniform1f(e,t.u_tile_units_to_pixels)}),terrainRaster:Zt,terrainDepth:Zt,skybox:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_sun_direction:new re.Uniform3f(e,t.u_sun_direction),u_cubemap:new re.Uniform1i(e,t.u_cubemap),u_opacity:new re.Uniform1f(e,t.u_opacity),u_temporal_offset:new re.Uniform1f(e,t.u_temporal_offset)}),skyboxGradient:(e,t)=>({u_matrix:new re.UniformMatrix4f(e,t.u_matrix),u_color_ramp:new re.Uniform1i(e,t.u_color_ramp),u_center_direction:new re.Uniform3f(e,t.u_center_direction),u_radius:new re.Uniform1f(e,t.u_radius),u_opacity:new re.Uniform1f(e,t.u_opacity),u_temporal_offset:new re.Uniform1f(e,t.u_temporal_offset)}),skyboxCapture:(e,t)=>({u_matrix_3f:new re.UniformMatrix3f(e,t.u_matrix_3f),u_sun_direction:new re.Uniform3f(e,t.u_sun_direction),u_sun_intensity:new re.Uniform1f(e,t.u_sun_intensity),u_color_tint_r:new re.Uniform4f(e,t.u_color_tint_r),u_color_tint_m:new re.Uniform4f(e,t.u_color_tint_m),u_luminance:new re.Uniform1f(e,t.u_luminance)})};let _r;function vr(r,i,n,a,s,o,t){const l=r.context,c=l.gl,h=r.useProgram("collisionBox"),u=[];let d=0,p=0;for(let e=0;e<a.length;e++){const m=a[e],g=i.getTile(m),_=g.getBucket(n);if(_){let e=m.projMatrix;0===s[0]&&0===s[1]||(e=r.translatePosMatrix(m.projMatrix,g,s,o));const f=t?_.textCollisionBox:_.iconCollisionBox,v=_.collisionCircleArray;if(0<v.length){const i=re.create$1(),n=e;re.mul$1(i,_.placementInvProjMatrix,r.transform.glCoordMatrix),re.mul$1(i,i,_.placementViewportMatrix),u.push({circleArray:v,circleOffset:p,transform:n,invTransform:i}),d+=v.length/4,p=d}f&&(r.terrain&&r.terrain.setupElevationDraw(g,h),h.draw(l,c.LINES,re.DepthMode.disabled,re.StencilMode.disabled,r.colorModeForRenderPass(),re.CullFaceMode.disabled,((e,t,r)=>{r=re.EXTENT/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/r,t.pixelsToGLUnits[1]/r]}})(e,r.transform,g),n.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,null,r.transform.zoom,null,f.collisionVertexBuffer,f.collisionVertexBufferExt))}}if(t&&u.length){const e=r.useProgram("collisionCircle"),m=new re.StructArrayLayout2f1f2i16;m.resize(4*d),m._trim();let t=0;for(const re of u)for(let e=0;e<re.circleArray.length/4;e++){const i=4*e,n=re.circleArray[0+i],a=re.circleArray[1+i],s=re.circleArray[2+i],o=re.circleArray[3+i];m.emplace(t++,n,a,s,o,0),m.emplace(t++,n,a,s,o,1),m.emplace(t++,n,a,s,o,2),m.emplace(t++,n,a,s,o,3)}(!_r||_r.length<2*d)&&(_r=function(t){const r=2*t,i=new re.StructArrayLayout3ui6;i.resize(r),i._trim();for(let e=0;e<r;e++){const t=6*e;i.uint16[0+t]=4*e+0,i.uint16[1+t]=4*e+1,i.uint16[2+t]=4*e+2,i.uint16[3+t]=4*e+2,i.uint16[4+t]=4*e+3,i.uint16[5+t]=4*e+0}return i}(d));const _=l.createIndexBuffer(_r,!0),y=l.createVertexBuffer(m,re.collisionCircleLayout.members,!0);for(const i of u){const a={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(f=r.transform).cameraToCenterDistance,u_viewport_size:[f.width,f.height]};e.draw(l,c.TRIANGLES,re.DepthMode.disabled,re.StencilMode.disabled,r.colorModeForRenderPass(),re.CullFaceMode.disabled,a,n.id,y,_,re.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,r.transform.zoom,null,null,null)}var f;y.destroy(),_.destroy()}}const yr=re.identity(new Float32Array(16));function xr(t,r,i,n,a,s,o,l,c,h,u,d){const p=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,g={};f.clear();for(let e=0;e<p.length;e++){var _=p.get(e),v=t.allowVerticalPlacement&&!_.placedOrientation,v=_.hidden||!_.crossTileID||v?null:n[_.crossTileID];if(v){const n=new re.pointGeometry(_.tileAnchorX,_.tileAnchorY),p=d(n),m=He(n,i?l:o,p),y=We(s.cameraToCenterDistance,m.signedDistanceFromCamera);let e=a.evaluateSizeForFeature(t.textSizeData,h,_)*y/re.ONE_EM;i&&(e*=t.tilePixelRatio/c);const{width:x,height:b,anchor:w,textOffset:T,textScale:E}=v,S=function(e,t,r,i,n,a){var{horizontalAlign:s,verticalAlign:o}=re.getAnchorAlignment(e),t=-(s-.5)*t,r=-(o-.5)*r,i=re.evaluateVariableOffset(e,i);return new re.pointGeometry((t/n+i[0])*a,(r/n+i[1])*a)}(w,x,b,T,E,e),M=i?He(n.add(S),o,p).point:m.point.add(r?S.rotate(-s.angle):S),A=t.allowVerticalPlacement&&_.placedOrientation===re.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<_.numGlyphs;e++)re.addDynamicAttributes(f,M,A);u&&0<=_.associatedIconIndex&&(g[_.associatedIconIndex]={shiftedAnchor:M,angle:A})}else tt(_.numGlyphs,f)}if(u){m.clear();const r=t.icon.placedSymbolArray;for(let e=0;e<r.length;e++){const i=r.get(e);if(i.hidden)tt(i.numGlyphs,m);else{const r=g[e];if(r)for(let e=0;e<i.numGlyphs;e++)re.addDynamicAttributes(m,r.shiftedAnchor,r.angle);else tt(i.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function br(s,o,l,c,h,u,d,p,f,m,g,_){const v=s.context,y=v.gl,x=s.transform,b="map"===p,w="map"===f,T=b&&"point"!==l.layout.get("symbol-placement"),E=b&&!w&&!T,S=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let M=!1;const A=s.depthModeForSublayer(0,re.DepthMode.ReadOnly),C=[0,0],L=l.layout.get("text-variable-anchor"),P=[],I=[];s.terrain&&w&&I.push("PITCH_WITH_MAP_TERRAIN"),T&&I.push("PROJECTED_POS_ON_VIEWPORT");for(const p of c){const c=o.getTile(p),f=c.getBucket(l);if(f){const g=h?f.text:f.icon;if(g&&g.segments.get().length){const _=g.programConfigurations.get(l.id),v=h||f.sdfIcons,A=h?f.textSizeData:f.iconSizeData,J=w||0!==x.pitch,Q=s.useProgram((Y=v,K=h,f.iconsInText&&K?"symbolTextAndIcon":Y?"symbolSDF":"symbolIcon"),_,I),ee=re.evaluateSizeForZoom(A,x.zoom),te=[p.canonical.x,p.canonical.y,1<<p.canonical.z];let e,t,r,i,n=[0,0],a=null;if(h){if(t=c.glyphAtlasTexture,r=y.LINEAR,e=c.glyphAtlasTexture.size,f.iconsInText){n=c.imageAtlasTexture.size,a=c.imageAtlasTexture;const re="composite"===A.kind||"camera"===A.kind;i=J||s.options.rotating||s.options.zooming||re?y.LINEAR:y.NEAREST}}else{const re=1!==l.layout.get("icon-size").constantOr(0)||f.iconsNeedLinear;t=c.imageAtlasTexture,r=v||s.options.rotating||s.options.zooming||re||J?y.LINEAR:y.NEAREST,e=c.imageAtlasTexture.size}var R=s.transform.calculatePixelsToTileUnitsMatrix(c),D=$e(p.projMatrix,w,b,s.transform,R),O=s.terrain&&w&&T?re.invert(new Float32Array(16),D):yr,k=je(p.projMatrix,w,b,s.transform,R),B=L&&f.hasTextData(),F="none"!==l.layout.get("icon-text-fit")&&B&&f.hasIconData();if(T){const re=x.elevation;Ze(f,p.projMatrix,s,h,D,k,w,m,re?e=>re.getAtTileOffset(p,e.x,e.y):null)}var z=s.translatePosMatrix(p.projMatrix,c,u,d),N=T||h&&L||F?yr:D,U=s.translatePosMatrix(k,c,u,d,!0),G=v&&0!==l.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1),U=v?f.iconsInText?($=A.kind,j=ee,H=E,W=w,Z=s,q=z,X=N,K=U,Y=e,R=n,B=te,F=0,D=s.identityMat,k=C,re.extend(mr($,j,H,W,Z,q,X,K,!0,Y,!0,B,F,D,k),{u_texsize_icon:R,u_texture_icon:1})):mr(A.kind,ee,E,w,s,z,N,U,h,e,!0,te,0,s.identityMat,C):fr(A.kind,ee,E,w,s,z,N,U,h,e,te,0,s.identityMat,C),V={program:Q,buffers:g,uniformValues:U,atlasTexture:t,atlasTextureIcon:a,atlasInterpolation:r,atlasInterpolationIcon:i,isSDF:v,hasHalo:G,tile:c,labelPlaneMatrixInv:O};if(S&&f.canOverlap){M=!0;const s=g.segments.get();for(const o of s)P.push({segments:new re.SegmentVector([o]),sortKey:o.sortKey,state:V})}else P.push({segments:g.segments,sortKey:0,state:V})}}}var $,j,H,W,Z,q,X,Y,K;M&&P.sort((e,t)=>e.sortKey-t.sortKey);for(const re of P){const o=re.state;if(s.terrain&&s.terrain.setupElevationDraw(o.tile,o.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:o.labelPlaneMatrixInv}),v.activeTexture.set(y.TEXTURE0),o.atlasTexture.bind(o.atlasInterpolation,y.CLAMP_TO_EDGE),o.atlasTextureIcon&&(v.activeTexture.set(y.TEXTURE1),o.atlasTextureIcon&&o.atlasTextureIcon.bind(o.atlasInterpolationIcon,y.CLAMP_TO_EDGE)),o.isSDF){const c=o.uniformValues;o.hasHalo&&(c.u_is_halo=1,wr(o.buffers,re.segments,l,s,o.program,A,g,_,c)),c.u_is_halo=0}wr(o.buffers,re.segments,l,s,o.program,A,g,_,o.uniformValues)}}function wr(e,t,r,i,n,a,s,o,l){var c=i.context;n.draw(c,c.gl.TRIANGLES,a,s,o,re.CullFaceMode.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,i.transform.zoom,e.programConfigurations.get(r.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function Tr(e,t,r,i,n,a,s){const o=e.context.gl,l=r.paint.get("fill-pattern"),c=l&&l.constantOr(1),h=r.getCrossfadeParameters();let u,d,p,f,m;u=s?(d=c&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",o.LINES):(d=c?"fillPattern":"fill",o.TRIANGLES);for(const _ of i){const i=t.getTile(_);if(!c||i.patternsLoaded()){const v=i.getBucket(r);if(v){e.prepareDrawTile(_);const y=v.programConfigurations.get(r.id),x=e.useProgram(d,y);c&&(e.context.activeTexture.set(o.TEXTURE0),i.imageAtlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),y.updatePaintBuffers(h));const b=l.constantOr(null);if(b&&i.imageAtlas){const re=i.imageAtlas,e=re.patternPositions[b.to.toString()],t=re.patternPositions[b.from.toString()];e&&t&&y.setConstantPatternPositions(e,t)}var g=e.translatePosMatrix(_.projMatrix,i,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(s){f=v.indexBuffer2,m=v.segments2;const re=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[o.drawingBufferWidth,o.drawingBufferHeight];p="fillOutlinePattern"===d&&c?lr(g,e,h,i,re):{u_matrix:g,u_world:re}}else f=v.indexBuffer,m=v.segments,p=c?or(g,e,h,i):sr(g);e.prepareDrawProgram(e.context,x,_.toUnwrapped()),x.draw(e.context,u,n,e.stencilModeForClipping(_),a,re.CullFaceMode.disabled,p,r.id,v.layoutVertexBuffer,f,m,r.paint,e.transform.zoom,y)}}}}function Er(e,t,r,i,n,a,s){const o=e.context,l=o.gl,c=r.paint.get("fill-extrusion-pattern"),h=c.constantOr(1),u=r.getCrossfadeParameters(),d=r.paint.get("fill-extrusion-opacity");for(const w of i){const i=t.getTile(w),T=i.getBucket(r);if(T){const E=T.programConfigurations.get(r.id),S=e.useProgram(h?"fillExtrusionPattern":"fillExtrusion",E);if(e.terrain){const re=e.terrain;if(!T.enableTerrain)continue;if(re.setupElevationDraw(i,S,{useMeterToDem:!0}),Sr(o,t,w,T,r,re),!T.centroidVertexBuffer){const re=S.attributes.a_centroid_pos;void 0!==re&&l.vertexAttrib2f(re,0,0)}}h&&(e.context.activeTexture.set(l.TEXTURE0),i.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),E.updatePaintBuffers(u));const M=c.constantOr(null);if(M&&i.imageAtlas){const re=i.imageAtlas,e=re.patternPositions[M.to.toString()],t=re.patternPositions[M.from.toString()];e&&t&&E.setConstantPatternPositions(e,t)}var p=e.translatePosMatrix(w.projMatrix,i,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),f=r.paint.get("fill-extrusion-vertical-gradient"),f=h?(m=p,g=e,_=f,v=d,y=w,x=u,b=i,re.extend(ar(m,g,_,v),nr(x,g,b),{u_height_factor:-Math.pow(2,y.overscaledZ)/b.tileSize/8})):ar(p,e,f,d);e.prepareDrawProgram(o,S,w.toUnwrapped()),S.draw(o,o.gl.TRIANGLES,n,a,s,re.CullFaceMode.backCCW,f,r.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,r.paint,e.transform.zoom,E,e.terrain?T.centroidVertexBuffer:null)}}var m,g,_,v,y,x,b}function Sr(e,s,l,n,o,c){const t=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new re.OverscaledTileID(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new re.OverscaledTileID(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new re.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new re.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],a=e=>{var t=s.getSource().maxzoom,r=e=>{const t=s.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)};let i,n,a;return(e.overscaledZ===e.canonical.z||e.overscaledZ>=t)&&(i=r(e.key)),e.overscaledZ>=t&&(n=r(e.calculateScaledKey(e.overscaledZ+1))),e.overscaledZ>t&&(a=r(e.calculateScaledKey(e.overscaledZ-1))),i||n||a},h=[0,0,0],u=(e,t)=>(h[0]=Math.min(e.min.y,t.min.y),h[1]=Math.max(e.max.y,t.max.y),h[2]=re.EXTENT-t.min.x>e.max.x?t.min.x-re.EXTENT:e.max.x,h),d=(e,t)=>(h[0]=Math.min(e.min.x,t.min.x),h[1]=Math.max(e.max.x,t.max.x),h[2]=re.EXTENT-t.min.y>e.max.y?t.min.y-re.EXTENT:e.max.y,h),p=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>d(e,t),(e,t)=>d(t,e)],f=new re.pointGeometry(0,0);let m,g,_;var v=(e,t,r,i,n)=>{const a=[[i?r:e,i?e:r,0],[i?r:t,i?t:r,0]],s=n<0?re.EXTENT+n:n,o=[i?s:(e+t)/2,i?(e+t)/2:s,0];return 0===r&&n<0||0!==r&&0<n?c.getForTilePoints(_,[o],!0,g):a.push(o),c.getForTilePoints(l,a,!0,m),Math.max(a[0][2],a[1][2],o[2])/c.exaggeration()};for(let i=0;i<4;i++){const s=n.borders[i];if(0===s.length&&(n.borderDone[i]=!0),!n.borderDone[i]){const o=_=t[i](l),h=a(o);if(h&&h.enableTerrain&&(g=c.findDEMTileFor(o),g&&g.dem)){if(!m){const re=c.findDEMTileFor(l);if(!re||!re.dem)return;m=re}const u=(i<2?1:5)-i,d=h.borders[u];let r=0;for(let e=0;e<s.length;e++){const o=n.featuresOnBorder[s[e]],c=o.borders[i];let t;for(;r<d.length&&(t=h.featuresOnBorder[d[r]],!(t.borders[u][1]>c[0]+3));)h.borderDone[u]||h.encodeCentroid(void 0,t,!1),r++;if(t&&r<d.length){const s=r;let e=0;for(;!(t.borders[u][0]>c[1]-3)&&(e++,++r!==d.length);)t=h.featuresOnBorder[d[r]];if(t=h.featuresOnBorder[d[s]],1<o.intersectsCount()||1<t.intersectsCount()||1!==e)1!==e&&(r=s),n.encodeCentroid(void 0,o,!1),h.borderDone[u]||h.encodeCentroid(void 0,t,!1);else{const a=p[i](o,t),m=i%2?re.EXTENT-1:0;f.x=v(a[0],Math.min(re.EXTENT-1,a[1]),m,i<2,a[2]),f.y=0,n.encodeCentroid(f,o,!1),h.borderDone[u]||h.encodeCentroid(f,t,!1)}}else n.encodeCentroid(void 0,o,!1)}n.borderDone[i]=n.needsCentroidUpdate=!0,h.borderDone[u]||(h.borderDone[u]=h.needsCentroidUpdate=!0)}}}(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(e)}const Mr=new re.Color(1,0,0,1),Ar=new re.Color(0,1,0,1),Cr=new re.Color(0,0,1,1),Lr=new re.Color(1,0,1,1),Pr=new re.Color(0,1,1,1);function Ir(e,t,r,i){Dr(e,0,t+r/2,e.transform.width,r,i)}function Rr(e,t,r,i){Dr(e,t-r/2,0,r,e.transform.height,i)}function Dr(e,t,r,i,n,a){const s=e.context,o=s.gl;o.enable(o.SCISSOR_TEST),o.scissor(t*re.exported.devicePixelRatio,r*re.exported.devicePixelRatio,i*re.exported.devicePixelRatio,n*re.exported.devicePixelRatio),s.clear({color:a}),o.disable(o.SCISSOR_TEST)}function Or(e,t,r){const i=e.context,n=i.gl,a=r.projMatrix,s=e.useProgram("debug"),o=t.getTileByID(r.key);e.terrain&&e.terrain.setupElevationDraw(o,s);var l=re.DepthMode.disabled,c=re.StencilMode.disabled,h=e.colorModeForRenderPass();i.activeTexture.set(n.TEXTURE0),e.emptyTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE),o._makeDebugTileBoundsBuffers(e.context,e.transform.projection);var u=o._tileDebugBuffer||e.debugBuffer,d=o._tileDebugIndexBuffer||e.debugIndexBuffer,p=o._tileDebugSegments||e.debugSegments;s.draw(i,n.LINE_STRIP,l,c,h,re.CullFaceMode.disabled,cr(a,re.Color.red),"$debug",u,d,p);p=o.latestRawTileData,p=Math.floor((p&&p.byteLength||0)/1024),t=t.getTile(r).tileSize,t=512/Math.min(t,512)*(r.overscaledZ/e.transform.zoom)*.5;let f=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(f+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const r=e.debugOverlayCanvas,i=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,r.width,r.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,`${f} ${p}kb`),s.draw(i,n.TRIANGLES,l,c,re.ColorMode.alphaBlended,re.CullFaceMode.disabled,cr(a,re.Color.transparent,t),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}const kr=re.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),Br=kr["members"];function Fr(e,t,r,i){e.emplaceBack(t,r,i)}class zr{constructor(e){this.vertexArray=new re.StructArrayLayout3f12,this.indices=new re.StructArrayLayout3ui6,Fr(this.vertexArray,-1,-1,1),Fr(this.vertexArray,1,-1,1),Fr(this.vertexArray,-1,1,1),Fr(this.vertexArray,1,1,1),Fr(this.vertexArray,-1,-1,-1),Fr(this.vertexArray,1,-1,-1),Fr(this.vertexArray,-1,1,-1),Fr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Br),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=re.SegmentVector.simpleSegment(0,0,36,12)}}function Nr(e,t,r,i,n,a){const s=e.gl,o=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),c=t.paint.get("sky-atmosphere-sun-intensity"),h={u_matrix_3f:re.fromMat4([],i),u_sun_direction:n,u_sun_intensity:c,u_color_tint_r:[o.r,o.g,o.b,o.a],u_color_tint_m:[l.r,l.g,l.b,l.a],u_luminance:5e-5};s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,t.skyboxTexture,0),r.draw(e,s.TRIANGLES,re.DepthMode.disabled,re.StencilMode.disabled,re.ColorMode.unblended,re.CullFaceMode.frontCW,h,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ur={symbol:function(e,t,r,i,n){var a,s;"translucent"===e.renderPass&&(a=re.StencilMode.disabled,s=e.colorModeForRenderPass(),r.layout.get("text-variable-anchor")&&function(e,t,r,i,n,a,s){var o=t.transform,l="map"===n,c="map"===a;for(const n of e){const e=i.getTile(n),a=e.getBucket(r);if(a&&a.text&&a.text.segments.get().length){var h=re.evaluateSizeForZoom(a.textSizeData,o.zoom),u=t.transform.calculatePixelsToTileUnitsMatrix(e),d=$e(n.projMatrix,c,l,t.transform,u),u="none"!==r.layout.get("icon-text-fit")&&a.hasIconData();if(h){const t=Math.pow(2,o.zoom-e.tileID.overscaledZ),r=o.elevation;xr(a,l,c,s,re.symbolSize,o,d,n.projMatrix,t,h,u,r?e=>r.getAtTileOffset(n,e.x,e.y):e=>0)}}}}(i,e,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),n),0!==r.paint.get("icon-opacity").constantOr(1)&&br(e,t,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&br(e,t,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),t.map.showCollisionBoxes&&(vr(e,t,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),vr(e,t,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1)))},circle:function(t,r,i,n){if("translucent"===t.renderPass){const e=i.paint.get("circle-opacity"),a=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),o=void 0!==i.layout.get("circle-sort-key").constantOr(1);if(0!==e.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){const l=t.context,c=l.gl,h=t.depthModeForSublayer(0,re.DepthMode.ReadOnly),u=re.StencilMode.disabled,d=t.colorModeForRenderPass(),p=[];for(let e=0;e<n.length;e++){const a=n[e],s=r.getTile(a),l=s.getBucket(i);if(l){const c=l.programConfigurations.get(i.id),h=(e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t})(i),u={programConfiguration:c,program:t.useProgram("circle",c,h),layoutVertexBuffer:l.layoutVertexBuffer,indexBuffer:l.indexBuffer,uniformValues:((e,t,r,i)=>{const n=e.transform;var a="map"===i.paint.get("circle-pitch-alignment")?n.calculatePixelsToTileUnitsMatrix(r):new Float32Array([n.pixelsToGLUnits[0],0,0,n.pixelsToGLUnits[1]]);return{u_camera_to_center_distance:n.cameraToCenterDistance,u_matrix:e.translatePosMatrix(t.projMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_device_pixel_ratio:re.exported.devicePixelRatio,u_extrude_scale:a}})(t,a,s,i),tile:s};if(o){const t=l.segments.get();for(const r of t)p.push({segments:new re.SegmentVector([r]),sortKey:r.sortKey,state:u})}else p.push({segments:l.segments,sortKey:0,state:u})}}o&&p.sort((e,t)=>e.sortKey-t.sortKey);for(const r of p){const{programConfiguration:n,program:e,layoutVertexBuffer:a,indexBuffer:s,uniformValues:o,tile:p}=r.state,f=r.segments;t.terrain&&t.terrain.setupElevationDraw(p,e,{useDepthForOcclusion:!0}),t.prepareDrawProgram(l,e,p.tileID.toUnwrapped()),e.draw(l,c.TRIANGLES,h,u,d,re.CullFaceMode.disabled,o,i.id,a,s,f,i.paint,t.transform.zoom,n)}}}},heatmap:function(t,r,i,n){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const c=t.context,h=c.gl,u=re.StencilMode.disabled,d=new re.ColorMode([h.ONE,h.ONE],re.Color.transparent,[!0,!0,!0,!0]);!function(e,t,r){const i=e.gl;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);let n=r.heatmapFbo;var a;n?(i.bindTexture(i.TEXTURE_2D,n.colorAttachment.get()),e.bindFramebuffer.set(n.framebuffer)):(a=i.createTexture(),i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),n=r.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,r,i){const n=e.gl;n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width/4,t.height/4,0,n.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:n.UNSIGNED_BYTE,null),i.colorAttachment.set(r)}(e,t,a,n))}(c,t,i),c.clear({color:re.Color.transparent});for(let e=0;e<n.length;e++){const p=n[e];if(!r.hasRenderableParent(p)){const f=r.getTile(p),m=f.getBucket(i);if(m){const g=m.programConfigurations.get(i.id),_=t.useProgram("heatmap",g),v=t.transform["zoom"];t.terrain&&t.terrain.setupElevationDraw(f,_),t.prepareDrawProgram(c,_,p.toUnwrapped()),_.draw(c,h.TRIANGLES,re.DepthMode.disabled,u,d,re.CullFaceMode.disabled,(a=p.projMatrix,s=f,o=v,l=i.paint.get("heatmap-intensity"),{u_matrix:a,u_extrude_scale:M(s,1,o),u_intensity:l}),i.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,i.paint,t.transform.zoom,g)}}}c.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,r){const i=t.context,n=i.gl,a=r.heatmapFbo;if(a){i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(n.TEXTURE1);let e=r.colorRampTexture;e=e||(r.colorRampTexture=new re.Texture(i,r.colorRamp,n.RGBA)),e.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(i,n.TRIANGLES,re.DepthMode.disabled,re.StencilMode.disabled,t.colorModeForRenderPass(),re.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:r.paint.get("heatmap-opacity")},r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,r.paint,t.transform.zoom)}}(t,i));var a,s,o,l},line:function(r,i,n,a){if("translucent"===r.renderPass){const s=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0!==s.constantOr(1)&&0!==o.constantOr(1)){const l=r.depthModeForSublayer(0,re.DepthMode.ReadOnly),c=r.colorModeForRenderPass(),h=n.paint.get("line-dasharray"),u=h.constantOr(1),d=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),m=n.paint.get("line-gradient"),g=n.getCrossfadeParameters(),_=f?"linePattern":"line",v=r.context,y=v.gl;for(const s of a){const a=i.getTile(s);if(!f||a.patternsLoaded()){const o=a.getBucket(n);if(o){r.prepareDrawTile(s);const x=o.programConfigurations.get(n.id),b=(e=>{const t=[];return dr(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),t})(n),w=r.useProgram(_,x,b),T=p.constantOr(null);if(T&&a.imageAtlas){const re=a.imageAtlas,r=re.patternPositions[T.to.toString()],i=re.patternPositions[T.from.toString()];r&&i&&x.setConstantPatternPositions(r,i)}var e=h.constantOr(null),t=d.constantOr(null);if(!f&&e&&t&&a.lineAtlas){const re=a.lineAtlas,r=re.getDash(e.to,t),i=re.getDash(e.from,t);r&&i&&x.setConstantPatternPositions(r,i)}t=r.terrain?s.projMatrix:null,t=f?((e,t,r,i,n)=>{const a=e.transform,s=hr(t,a);return{u_matrix:ur(e,t,r,n),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:a.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:re.exported.devicePixelRatio,u_image:0,u_scale:[s,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}})(r,a,n,g,t):((e,t,r,i,n,a)=>{const s=e.transform,o=s.calculatePixelsToTileUnitsMatrix(t),l={u_matrix:ur(e,t,r,n),u_pixels_to_tile_units:o,u_device_pixel_ratio:re.exported.devicePixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(dr(r)){const re=hr(t,e.transform);l.u_texsize=t.lineAtlasTexture.size,l.u_scale=[re,i.fromScale,i.toScale],l.u_mix=i.t}return l})(r,a,n,g,t,o.lineClipsArray.length);if(m){const a=o.gradients[n.id];let t=a.texture;if(n.gradientVersion!==a.version){let e=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,a=s.canonical.z===n?Math.ceil(1<<r.transform.maxZoom-s.canonical.z):1;e=re.clamp(re.nextPowerOfTwo(o.maxLineLength/re.EXTENT*1024*a),256,v.maxTextureSize)}a.gradient=re.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:e,image:a.gradient||void 0,clips:o.lineClipsArray}),a.texture?a.texture.update(a.gradient):a.texture=new re.Texture(v,a.gradient,y.RGBA),a.version=n.gradientVersion,t=a.texture}v.activeTexture.set(y.TEXTURE1),t.bind(n.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}u&&(v.activeTexture.set(y.TEXTURE0),a.lineAtlasTexture.bind(y.LINEAR,y.REPEAT),x.updatePaintBuffers(g)),f&&(v.activeTexture.set(y.TEXTURE0),a.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),x.updatePaintBuffers(g)),r.prepareDrawProgram(v,w,s.toUnwrapped()),w.draw(v,y.TRIANGLES,l,r.stencilModeForClipping(s),c,re.CullFaceMode.disabled,t,n.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,n.paint,r.transform.zoom,x,o.layoutVertexBuffer2)}}}}}},fill:function(e,t,r,i){const n=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){const s=e.colorModeForRenderPass(),o=r.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!o.constantOr(1)&&1===n.constantOr(re.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){const n=e.depthModeForSublayer(1,"opaque"===e.renderPass?re.DepthMode.ReadWrite:re.DepthMode.ReadOnly);Tr(e,t,r,i,n,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const n=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,re.DepthMode.ReadOnly);Tr(e,t,r,i,n,s,!0)}}},"fill-extrusion":function(e,t,r,i){const n=r.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===e.renderPass){var a=new re.DepthMode(e.context.gl.LEQUAL,re.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==n||r.paint.get("fill-extrusion-pattern").constantOr(1))Er(e,t,r,i,a,re.StencilMode.disabled,re.ColorMode.disabled),Er(e,t,r,i,a,e.stencilModeFor3D(),e.colorModeForRenderPass());else{const n=e.colorModeForRenderPass();Er(e,t,r,i,a,re.StencilMode.disabled,n)}}},hillshade:function(e,t,r,i){if("offscreen"===e.renderPass||"translucent"===e.renderPass){const n=e.context,a=e.depthModeForSublayer(0,re.DepthMode.ReadOnly),s=e.colorModeForRenderPass(),o=e.terrain&&e.terrain.renderingToTexture,[l,c]="translucent"!==e.renderPass||o?[{},i]:e.stencilConfigForOverlap(i);for(const i of c){const n=t.getTile(i);if(n.needsHillshadePrepare&&"offscreen"===e.renderPass)!function(t,r,i,n,a,s){const o=t.context,l=o.gl;if(r.dem){var c=r.dem;if(o.activeTexture.set(l.TEXTURE1),Wt(t,r,c),r.demTexture){r.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);var h=c.dim;o.activeTexture.set(l.TEXTURE0);let e=r.fbo;if(!e){const t=new re.Texture(o,{width:h,height:h,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),e=r.fbo=o.createFramebuffer(h,h,!0),e.colorAttachment.set(t.texture)}o.bindFramebuffer.set(e.framebuffer),o.viewport.set([0,0,h,h]);var{tileBoundsBuffer:u,tileBoundsIndexBuffer:d,tileBoundsSegments:h}=t.getMercatorTileBoundsBuffers();t.useProgram("hillshadePrepare").draw(o,l.TRIANGLES,n,a,s,re.CullFaceMode.disabled,(n=r.tileID,s=(a=c).stride,c=re.create$1(),re.ortho(c,0,re.EXTENT,-re.EXTENT,0,0,1),re.translate(c,c,[0,-re.EXTENT,0]),{u_matrix:c,u_image:1,u_dimension:[s,s],u_zoom:n.overscaledZ,u_unpack:a.unpackVector}),i.id,u,d,h),r.needsHillshadePrepare=!1}}}(e,n,r,a,re.StencilMode.disabled,s);else if("translucent"===e.renderPass){const re=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(i):l[i.overscaledZ];Ht(e,i,n,r,a,re,s)}}n.viewport.set([0,0,e.width,e.height])}},raster:function(r,i,n,a,s,o){if("translucent"===r.renderPass&&0!==n.paint.get("raster-opacity")&&a.length){const u=r.context,d=u.gl,p=i.getSource(),f=r.useProgram("raster"),m=r.colorModeForRenderPass(),g=r.terrain&&r.terrain.renderingToTexture,[_,v]=p instanceof Te||g?[{},a]:r.stencilConfigForOverlap(a),e=v[v.length-1].overscaledZ,y=!r.options.moving;for(const a of v){const s=g?re.DepthMode.disabled:r.depthModeForSublayer(a.overscaledZ-e,1===n.paint.get("raster-opacity")?re.DepthMode.ReadWrite:re.DepthMode.ReadOnly,d.LESS),v=a.toUnwrapped(),x=i.getTile(a);if(!g||x&&x.hasData()){var l=g?a.projMatrix:r.transform.calculateProjMatrix(v,y),c=r.terrain&&g?r.terrain.stencilModeForRTTOverlap(a):_[a.overscaledZ],h=o?0:n.paint.get("raster-fade-duration");x.registerFadeDuration(h);const b=i.findLoadedParent(a,0),w=Jt(x,b,i,r.transform,h);let e,t;r.terrain&&r.terrain.prepareDrawTile(a);h="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;u.activeTexture.set(d.TEXTURE0),x.texture.bind(h,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),b?(b.texture.bind(h,d.CLAMP_TO_EDGE),e=Math.pow(2,b.tileID.overscaledZ-x.tileID.overscaledZ),t=[x.tileID.canonical.x*e%1,x.tileID.canonical.y*e%1]):x.texture.bind(h,d.CLAMP_TO_EDGE);l=pr(l,t||[0,0],e||1,w,n);if(r.prepareDrawProgram(u,f,v),p instanceof Te)f.draw(u,d.TRIANGLES,s,re.StencilMode.disabled,m,re.CullFaceMode.disabled,l,n.id,p.boundsBuffer,r.quadTriangleIndexBuffer,p.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:a,tileBoundsSegments:o}=r.getTileBoundsBuffers(x);f.draw(u,d.TRIANGLES,s,c,m,re.CullFaceMode.disabled,l,n.id,i,a,o)}}}}},background:function(r,i,n,a){var s=n.paint.get("background-color"),o=n.paint.get("background-opacity");if(0!==o){const p=r.context,f=p.gl,m=r.transform,g=m.tileSize,_=n.paint.get("background-pattern");if(!r.isPatternMissing(_)){const v=!_&&1===s.a&&1===o&&r.opaquePassEnabledForLayer()?"opaque":"translucent";if(r.renderPass===v){const y=re.StencilMode.disabled,x=r.depthModeForSublayer(0,"opaque"===v?re.DepthMode.ReadWrite:re.DepthMode.ReadOnly),b=r.colorModeForRenderPass(),w=r.useProgram(_?"backgroundPattern":"background");let t,e=a;e||(t=r.getBackgroundTiles(),e=Object.values(t).map(e=>e.tileID)),_&&(p.activeTexture.set(f.TEXTURE0),r.imageManager.bind(r.context));var l=n.getCrossfadeParameters();for(const v of e){const e=v.toUnwrapped(),T=a?v.projMatrix:r.transform.calculateProjMatrix(e);r.prepareDrawTile(v);var c=i?i.getTile(v):t?t[v.key]:new re.Tile(v,g,m.zoom,r),h=_?(u=T,d=o,h={tileID:v,tileSize:g},re.extend(function(e,t,r,i){var n=r.imageManager.getPattern(e.from.toString()),a=r.imageManager.getPattern(e.to.toString()),{width:s,height:o}=r.imageManager.getPixelSize(),l=Math.pow(2,i.tileID.overscaledZ),e=i.tileSize*Math.pow(2,r.transform.tileZoom)/l,l=e*(i.tileID.canonical.x+i.tileID.wrap*l),e=e*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,o],u_mix:t.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/M(i,1,r.transform.tileZoom),u_pixel_coord_upper:[l>>16,e>>16],u_pixel_coord_lower:[65535&l,65535&e]}}(_,l,r,h),{u_matrix:u,u_opacity:d})):{u_matrix:T,u_opacity:o,u_color:s};r.prepareDrawProgram(p,w,e);var{tileBoundsBuffer:u,tileBoundsIndexBuffer:d,tileBoundsSegments:c}=r.getTileBoundsBuffers(c);w.draw(p,f.TRIANGLES,x,y,b,re.CullFaceMode.disabled,h,n.id,u,d,c)}}}}},sky:function(e,t,r){var i,n=e.transform,a="mercator"===n.projection.name?1:re.smoothstep(7,8,n.zoom),s=r.paint.get("sky-opacity")*a;0!=s&&(i=e.context,n=r.paint.get("sky-type"),a=new re.DepthMode(i.gl.LEQUAL,re.DepthMode.ReadOnly,[0,1]),i=e.frameCounter/1e3%1,"atmosphere"===n?"offscreen"===e.renderPass?r.needsSkyboxCapture(e)&&(function(e,t){const r=e.context,i=r.gl;let n=t.skyboxFbo;if(!n){n=t.skyboxFbo=r.createFramebuffer(32,32,!1),t.skyboxGeometry=new zr(r),t.skyboxTexture=r.gl.createTexture(),i.bindTexture(i.TEXTURE_CUBE_MAP,t.skyboxTexture),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);for(let e=0;e<6;++e)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i.RGBA,32,32,0,i.RGBA,i.UNSIGNED_BYTE,null)}r.bindFramebuffer.set(n.framebuffer),r.viewport.set([0,0,32,32]);var a=t.getCenter(e,!0),s=e.useProgram("skyboxCapture"),o=new Float64Array(16);re.identity(o),re.rotateY(o,o,.5*-Math.PI),Nr(r,t,s,o,a,0),re.identity(o),re.rotateY(o,o,.5*Math.PI),Nr(r,t,s,o,a,1),re.identity(o),re.rotateX(o,o,.5*-Math.PI),Nr(r,t,s,o,a,2),re.identity(o),re.rotateX(o,o,.5*Math.PI),Nr(r,t,s,o,a,3),re.identity(o),Nr(r,t,s,o,a,4),re.identity(o),re.rotateY(o,o,Math.PI),Nr(r,t,s,o,a,5),r.viewport.set([0,0,e.width,e.height])}(e,r),r.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,t,r,i,n){const a=e.context,s=a.gl,o=e.transform,l=e.useProgram("skybox");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);n={u_matrix:o.skyboxMatrix,u_sun_direction:t.getCenter(e,!1),u_cubemap:0,u_opacity:i,u_temporal_offset:n};e.prepareDrawProgram(a,l),l.draw(a,s.TRIANGLES,r,re.StencilMode.disabled,e.colorModeForRenderPass(),re.CullFaceMode.backCW,n,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,r,a,s,i):"gradient"===n&&"sky"===e.renderPass&&function(e,t,r,i,n){const a=e.context,s=a.gl,o=e.transform,l=e.useProgram("skyboxGradient");t.skyboxGeometry||(t.skyboxGeometry=new zr(a)),a.activeTexture.set(s.TEXTURE0);let c=t.colorRampTexture;c=c||(t.colorRampTexture=new re.Texture(a,t.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);var h,u,d,n=(h=o.skyboxMatrix,u=t.getCenter(e,!1),d=t.paint.get("sky-gradient-radius"),i=i,n=n,{u_matrix:h,u_color_ramp:0,u_center_direction:u,u_radius:re.degToRad(d),u_opacity:i,u_temporal_offset:n});e.prepareDrawProgram(a,l),l.draw(a,s.TRIANGLES,r,re.StencilMode.disabled,e.colorModeForRenderPass(),re.CullFaceMode.backCW,n,"skyboxGradient",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,r,a,s,i))},debug:function(t,r,i){for(let e=0;e<i.length;e++)Or(t,r,i[e])},custom:function(e,t,r){const i=e.context,n=r.implementation;if("mercator"===e.transform.projection.name){if("offscreen"===e.renderPass){const re=n.prerender;re&&(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),re.call(n,i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(re.StencilMode.disabled);const t="3d"===n.renderingMode?new re.DepthMode(e.context.gl.LEQUAL,re.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,re.DepthMode.ReadOnly);i.setDepthMode(t),n.render(i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}else re.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class Gr{constructor(e,t){this.context=new xe(e),this.transform=t,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=re.SourceCache.maxUnderzooming+re.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Lt,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(e,t){var r=!!e&&!!e.terrain&&"mercator"===this.transform.projection.name;if(r||this._terrain&&this._terrain.enabled){this._terrain||(this._terrain=new tr(this,e));const i=this._terrain;this.transform.elevation=r?i:null,i.update(e,this.transform,t)}}_updateFog(e){const t=e.fog;var r;!t||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03?this.transform.fogCullDistSq=null:([r,e]=t.getFovAdjustedRange(this.transform._fov),this.transform.fogCullDistSq=e<r?null:(r=r+.78*(e-r))*r)}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,t){if(this.width=e*re.exported.devicePixelRatio,this.height=t*re.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const re of this.style.order)this.style._layers[re].resize()}setup(){const e=this.context,t=new re.StructArrayLayout2i4;t.emplaceBack(0,0),t.emplaceBack(re.EXTENT,0),t.emplaceBack(0,re.EXTENT),t.emplaceBack(re.EXTENT,re.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(t,re.posAttributes.members),this.tileExtentSegments=re.SegmentVector.simpleSegment(0,0,4,2);const r=new re.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(re.EXTENT,0),r.emplaceBack(0,re.EXTENT),r.emplaceBack(re.EXTENT,re.EXTENT),this.debugBuffer=e.createVertexBuffer(r,re.posAttributes.members),this.debugSegments=re.SegmentVector.simpleSegment(0,0,4,5);const i=new re.StructArrayLayout2i4;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(i,re.posAttributes.members),this.viewportSegments=re.SegmentVector.simpleSegment(0,0,4,2);const n=new re.StructArrayLayout4i8;n.emplaceBack(0,0,0,0),n.emplaceBack(re.EXTENT,0,re.EXTENT,0),n.emplaceBack(0,re.EXTENT,0,re.EXTENT),n.emplaceBack(re.EXTENT,re.EXTENT,re.EXTENT,re.EXTENT),this.mercatorBoundsBuffer=e.createVertexBuffer(n,re.boundsAttributes.members),this.mercatorBoundsSegments=re.SegmentVector.simpleSegment(0,0,4,2);const a=new re.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a);const s=new re.StructArrayLayout1ui2;for(const re of[0,1,3,2,0])s.emplaceBack(re);this.debugIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new re.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA),this.identityMat=re.create$1();var o=this.context.gl;this.stencilClearMode=new re.StencilMode({func:o.ALWAYS,mask:0},0,255,o.ZERO,o.ZERO,o.ZERO),this.loadTimeStamps.push(re.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){var e=this.context,t=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(e,t.TRIANGLES,re.DepthMode.disabled,this.stencilClearMode,re.ColorMode.disabled,re.CullFaceMode.disabled,Kt(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t,r){if(t&&this.currentStencilSource!==t.id&&e.isTileClipped()&&r&&r.length){this.currentStencilSource=t.id;const i=this.context,n=i.gl;256<this.nextStencilID+r.length&&this.clearStencil(),i.setColorMode(re.ColorMode.disabled),i.setDepthMode(re.DepthMode.disabled);const a=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of r){const r=t.getTile(e),s=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:o,tileBoundsIndexBuffer:l,tileBoundsSegments:c}=this.getTileBoundsBuffers(r);a.draw(i,n.TRIANGLES,re.DepthMode.disabled,new re.StencilMode({func:n.ALWAYS,mask:0},s,255,n.KEEP,n.KEEP,n.REPLACE),re.ColorMode.disabled,re.CullFaceMode.disabled,Kt(e.projMatrix),"$clipping",o,l,c)}}}stencilModeFor3D(){this.currentStencilSource=void 0,256<this.nextStencilID+1&&this.clearStencil();var e=this.nextStencilID++,t=this.context.gl;return new re.StencilMode({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);var t=this.context.gl;return new re.StencilMode({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){var t=this.context.gl,e=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),r=e[e.length-1].overscaledZ,i=e[0].overscaledZ-r+1;if(1<i){this.currentStencilSource=void 0,256<this.nextStencilID+i&&this.clearStencil();const n={};for(let e=0;e<i;e++)n[e+r]=new re.StencilMode({func:t.GEQUAL,mask:255},e+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[n,e]}return[{[r]:re.StencilMode.disabled},e]}colorModeForRenderPass(){var e=this.context.gl;if(this._showOverdrawInspector)return new re.ColorMode([e.CONSTANT_COLOR,e.ONE],new re.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]);return"opaque"===this.renderPass?re.ColorMode.unblended:re.ColorMode.alphaBlended}depthModeForSublayer(e,t,r){if(!this.opaquePassEnabledForLayer())return re.DepthMode.disabled;e=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new re.DepthMode(r||this.context.gl.LEQUAL,t,[e,e])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,t){this.style=i,this.options=t,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(re.exported.now()),this.imageManager.beginFrame();const r=this.style.order,n=this.style._sourceCaches;for(const re in n){const i=n[re];i.used&&i.prepare(this.context)}const a={},s={},o={};for(const re in n){const i=n[re];a[re]=i.getVisibleCoordinates(),s[re]=a[re].slice().reverse(),o[re]=i.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<r.length;e++)if(this.style._layers[r[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(o),this.opaquePassCutoff=0),re.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const re of r){const t=this.style._layers[re],r=i._getLayerSourceCache(t);if(t.hasOffscreenPass()&&!t.isHidden(this.transform.zoom)){const n=r?s[r.id]:void 0;("custom"===t.type||t.isSky()||n&&n.length)&&this.renderLayer(this,r,t,n)}}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let e=re.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(e=this.style.fog.properties.get("color")),this.context.clear({color:t.showOverdrawInspector?re.Color.black:e,depth:1}),this.clearStencil(),this._showOverdrawInspector=t.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=r.length-1;0<=this.currentLayer;this.currentLayer--){const re=this.style._layers[r[this.currentLayer]],t=i._getLayerSourceCache(re);if(!re.isSky()){const n=t?s[t.id]:void 0;this._renderTileClippingMasks(re,t,n),this.renderLayer(this,t,re,n)}}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const re=this.style._layers[r[this.currentLayer]],t=i._getLayerSourceCache(re);re.isSky()&&this.renderLayer(this,t,re,t?s[t.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;){const re=this.style._layers[r[this.currentLayer]],t=i._getLayerSourceCache(re);if(re.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(re))re.isHidden(this.transform.zoom)?++this.currentLayer:this.currentLayer=this.terrain.renderBatch(this.currentLayer);else{const n=t?("symbol"===re.type?o:s)[t.id]:void 0;this._renderTileClippingMasks(re,t,t?a[t.id]:void 0),this.renderLayer(this,t,re,n),++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let r=null;re.values(this.style._layers).forEach(e=>{const t=i._getLayerSourceCache(e);t&&!e.isHidden(this.transform.zoom)&&(!r||r.getSource().maxzoom<t.getSource().maxzoom)&&(r=t)}),r&&this.options.showTileBoundaries&&Ur.debug(this,r,r.getVisibleCoordinates())}this.options.showPadding&&function(e){var t=e.transform.padding;Ir(e,e.transform.height-(t.top||0),3,Mr),Ir(e,t.bottom||0,3,Ar),Rr(e,t.left||0,3,Cr),Rr(e,e.transform.width-(t.right||0),3,Lr);var r,i=e.transform.centerPoint;r=e,t=i.x,e=e.transform.height-i.y,i=Pr,Dr(r,t-1,e-10,2,20,i),Dr(r,t-10,e-1,20,2,i)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%re.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(re.window.performance.now()),this.saveCanvasCopy())}}renderLayer(e,t,r,i){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||i&&i.length)&&(this.id=r.id,this.gpuTimingStart(r),Ur[r.type](e,t,r,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(this.options.gpuTiming){const r=this.context.extTimerQuery;let e=this.gpuTimers[t.id];e=e||(this.gpuTimers[t.id]={calls:0,cpuTime:0,query:r.createQueryEXT()}),e.calls++,r.beginQueryEXT(r.TIME_ELAPSED_EXT,e.query)}}gpuTimingEnd(){if(this.options.gpuTiming){const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}}collectGpuTimers(){var e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){const t={};for(const r in e){const i=e[r],n=this.context.extTimerQuery,a=n.getQueryObjectEXT(i.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i.query),t[r]=a}return t}translatePosMatrix(e,t,r,i,n){if(!r[0]&&!r[1])return e;i=n?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(i){const re=Math.sin(i),e=Math.cos(i);r=[r[0]*e-r[1]*re,r[0]*re+r[1]*e]}t=[n?r[0]:M(t,r[0],this.transform.zoom),n?r[1]:M(t,r[1],this.transform.zoom),0],r=new Float32Array(16);return re.translate(r,e,t),r}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&0<t.length?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;var t=this.imageManager.getPattern(e.from.toString()),e=this.imageManager.getPattern(e.to.toString());return!t||!e}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.style&&this.style.fog,r=[];return this.terrain&&!this.terrain.renderingToTexture&&r.push("TERRAIN"),t&&!e&&0!==t.getOpacity(this.transform.pitch)&&r.push("FOG"),e&&r.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&r.push("OVERDRAW_INSPECTOR"),r}useProgram(e,t,r){this.cache=this.cache||{};var i=r||[],r=this.currentGlobalDefines().concat(i),i=ir.cacheKey(e,r,t);return this.cache[i]||(this.cache[i]=new ir(this.context,e,Vt[e],t,gr[e],r)),this.cache[i]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=re.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new re.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(e){this.terrain&&this.terrain.prepareDrawTile(e)}prepareDrawProgram(e,t,r){if(!this.terrain||!this.terrain.renderingToTexture){const s=this.style.fog;var i,n,a;!s||0!==(a=s.getOpacity(this.transform.pitch))&&t.setFogUniformValues(e,(i=this,n=s,t=r,e=a,r=n.properties.get("color"),a=i.frameCounter/1e3%1,e=[r.r/r.a,r.g/r.a,r.b/r.a,e],{u_fog_matrix:t?i.transform.calculateFogTileMatrix(t):i.identityMat,u_fog_range:n.getFovAdjustedRange(i.transform._fov),u_fog_color:e,u_fog_horizon_blend:n.properties.get("horizon-blend"),u_fog_temporal_offset:a}))}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const i of r)t[i.key]=e[i.key]||new re.Tile(i,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}}class Vr{constructor(e=0,t=0,r=0,i=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=i}interpolate(e,t,r){return null!=t.top&&null!=e.top&&(this.top=re.number(e.top,t.top,r)),null!=t.bottom&&null!=e.bottom&&(this.bottom=re.number(e.bottom,t.bottom,r)),null!=t.left&&null!=e.left&&(this.left=re.number(e.left,t.left,r)),null!=t.right&&null!=e.right&&(this.right=re.number(e.right,t.right,r)),this}getCenter(e,t){e=re.clamp((this.left+e-this.right)/2,0,e),t=re.clamp((this.top+t-this.bottom)/2,0,t);return new re.pointGeometry(e,t)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Vr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function $r(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function jr(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]}function Hr(e,t){var r=$r(e,3);re.fromQuat(e,t),jr(e,3,r)}function Wr(e,t){jr(e,3,[t[0],t[1],t[2],1])}function Zr(e,t){var r=re.identity$1([]);return re.rotateZ$1(r,r,-t),re.rotateX$1(r,r,-e),r}function qr(e,t){var r=[e[0],e[1],0],i=[t[0],t[1],0];if(1e-15<=re.length(r)){const e=re.normalize([],r);re.scale(i,e,re.dot(i,e)),t[0]=i[0],t[1]=i[1]}t=re.cross([],t,e);if(re.len(t)<1e-15)return null;t=Math.atan2(-t[1],t[0]);return Zr(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),t)}class Xr{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(e){this._position=this._renderWorldCopies?function(e){if(e){const t=Array.isArray(e)?new re.MercatorCoordinate(e[0],e[1],e[2]):e;return t.x=re.wrap(t.x,0,1),t}}(e):e}lookAtPoint(e,t){var r,i;this.orientation=null,this.position&&(r=this._elevation?this._elevation.getAtPointOrZero(re.MercatorCoordinate.fromLngLat(e)):0,i=this.position,i=[(r=re.MercatorCoordinate.fromLngLat(e,r)).x-i.x,r.y-i.y,r.z-i.z],(t=t||[0,0,1])[2]=Math.abs(t[2]),this.orientation=qr(i,t))}setPitchBearing(e,t){this.orientation=Zr(re.degToRad(e),re.degToRad(-t))}}class Yr{constructor(e,t){this._transform=re.identity([]),this._orientation=re.identity$1([]),t&&(this._orientation=t,Hr(this._transform,this._orientation)),e&&Wr(this._transform,e)}get mercatorPosition(){var e=this.position;return new re.MercatorCoordinate(e[0],e[1],e[2])}get position(){var e=$r(this._transform,3);return[e[0],e[1],e[2]]}set position(e){Wr(this._transform,e)}get orientation(){return this._orientation}set orientation(e){this._orientation=e,Hr(this._transform,this._orientation)}getPitchBearing(){var e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Zr(e,t),Hr(this._transform,this._orientation)}forward(){var e=$r(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){var e=$r(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){var e=$r(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,t){var r=new Float64Array(16);return re.invert(r,this.getWorldToCamera(e,t)),r}getWorldToCameraPosition(e,t,r){var i=this.position;re.scale(i,i,-e);const n=new Float64Array(16);return re.fromScaling(n,[r,r,r]),re.translate(n,n,i),n[10]*=t,n}getWorldToCamera(e,t){const r=new Float64Array(16),i=new Float64Array(4),n=this.position;return re.conjugate(i,this._orientation),re.scale(n,n,-e),re.fromQuat(r,i),re.translate(r,r,n),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=t,r[9]*=t,r[10]*=t,r[11]*=t,r}getCameraToClipPerspective(e,t,r,i){var n=new Float64Array(16);return re.perspective(n,e,t,r,i),n}getDistanceToElevation(e){var t=0===e?0:re.mercatorZfromAltitude(e,this.position[1]),e=this.forward();return(t-this.position[2])/e[2]}clone(){return new Yr([...this.position],[...this.orientation])}}function Kr(e,t){var r=Qr(e),t=function(e,t,r,i){const n=new re.LngLat(t.lng-180*ei,t.lat),a=new re.LngLat(t.lng+180*ei,t.lat),s=e.project(n.lng,n.lat),o=e.project(a.lng,a.lat),l=-Math.atan2(o.y-s.y,o.x-s.x),c=re.MercatorCoordinate.fromLngLat(t);c.y=re.clamp(c.y,-.999975,.999975);const h=c.toLngLat(),u=e.project(h.lng,h.lat),d=re.MercatorCoordinate.fromLngLat(h);d.x+=ei;const p=d.toLngLat(),f=e.project(p.lng,p.lat),m=ri(f.x-u.x,f.y-u.y,l),g=re.MercatorCoordinate.fromLngLat(h);g.y+=ei;var _=g.toLngLat(),t=e.project(_.lng,_.lat),e=ri(t.x-u.x,t.y-u.y,l),_=Math.abs(m.x)/Math.abs(e.y),t=re.identity([]);re.rotateZ(t,t,-l*(1-(i?0:r)));const v=re.identity([]);return re.scale$1(v,v,[1,1-(1-_)*r,1]),v[4]=-e.x/e.y*r,re.rotateZ(v,v,l),re.multiply(v,t,v),v}(e.projection,e.center,r,t),e=Jr(e);return re.scale$1(t,t,[e,e,1]),t}function Jr(e){var t=e.projection,r=Qr(e),e=ti(t,e.center),t=ti(t,re.LngLat.convert(t.center));return Math.pow(2,e*r+(1-r)*t)}function Qr(e){var t=e.projection.range;if(!t)return 0;var r=Math.max(e.width,e.height),r=Math.log(r/1024)/Math.LN2;return re.smoothstep(t[0]+r,t[1]+r,e.zoom)}const ei=25e-6;function ti(e,t){var r=re.clamp(t.lat,-re.MAX_MERCATOR_LATITUDE,re.MAX_MERCATOR_LATITUDE),i=new re.LngLat(t.lng-180*ei,r),n=new re.LngLat(t.lng+180*ei,r),t=e.project(i.lng,r),e=e.project(n.lng,r),r=re.MercatorCoordinate.fromLngLat(i),i=re.MercatorCoordinate.fromLngLat(n),n=e.x-t.x,e=e.y-t.y,t=i.x-r.x,r=i.y-r.y,e=Math.sqrt((t*t+r*r)/(n*n+e*e));return Math.log(e)/Math.LN2}function ri(e,t,r){var i=Math.cos(r),r=Math.sin(r);return{x:e*i-t*r,y:e*r+t*i}}class ii{constructor(e,t,r,i,n){this.tileSize=512,this._renderWorldCopies=void 0===n||n,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new re.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Vr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Yr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const e=new ii(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e.tileSize=this.tileSize,e.setMaxBounds(this.getMaxBounds()),e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._cameraZoom=this._cameraZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.setProjection(this.getProjection()),e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&((this._elevation=e)?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(e){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),e&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return re.pick(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e=null==e?{name:"mercator"}:e;var t=this.projection?this.getProjection():void 0;return this.projection=re.getProjection(e),!g(t,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){var e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return re.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return re.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new re.pointGeometry(this.width,this.height)}get bearing(){return re.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){var t,r,i,n,a,s=-e*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(a=new re.ARRAY_TYPE(4),re.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a),t=this.rotationMatrix,r=this.rotationMatrix,i=this.angle,n=r[0],e=r[1],s=r[2],a=r[3],r=Math.sin(i),i=Math.cos(i),t[0]=n*i+s*r,t[1]=e*i+a*r,t[2]=n*-r+s*i,t[3]=e*-r+a*i)}get pitch(){return this._pitch/Math.PI*180}set pitch(e){e=re.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(e){e=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;var e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===e?(this._cameraZoom=null,!1):(this._centerAltitude=e,!0)}_updateCameraOnTerrain(){var e=this.cameraToCenterDistance/this.worldSize,t=re.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(t+e)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let n=0,a=0;for(let e=0;e<r.length;e++){var s=new re.pointGeometry(r[e][0]*this.width,i+r[e][1]*(this.height-i)),o=t.pointCoordinate(s);o&&(s=1/Math.hypot(o[0]-this._camera.position[0],o[1]-this._camera.position[1]),n+=o[3]*s,a+=s)}return 0===a?NaN:n/a}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){var e,t,r;null!=this._cameraZoom&&this._elevation&&(r=this._cameraZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),e=re.mercatorZfromAltitude(t,this.center.lat),t=this._mercatorZfromZoom(r),r=this._mercatorZfromZoom(this._maxZoom),r=Math.max(t-e,r),this._setZoom(this._zoomFromMercatorZ(r)))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){var t=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude())),e=e.z<this._camera.position[2]?[t.x,t.y,t.z]:[e.x,e.y,e.z],e=re.length(re.sub([],this._camera.position,e));return re.clamp(this._zoomFromMercatorZ(e),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(this.height&&(t.position||t.orientation)){this._updateCameraState();let e=!1;t.orientation&&!re.exactEquals(t.orientation,this._camera.orientation)&&(e=this._setCameraOrientation(t.orientation)),t.position&&(t=[t.position.x,t.position.y,t.position.z],re.exactEquals$1(t,this._camera.position)||(this._setCameraPosition(t),e=!0)),e&&(this._updateStateFromCamera(),this.recenterOnTerrain())}}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,t=new Xr;return t.position=new re.MercatorCoordinate(e[0],e[1],e[2]),t.orientation=this._camera.orientation,t._elevation=this.elevation,t._renderWorldCopies=this.renderWorldCopies,t}_setCameraOrientation(e){if(!re.length$1(e))return!1;re.normalize$1(e,e);var t=re.transformQuat([],[0,0,-1],e),e=re.transformQuat([],[0,-1,0],e);if(e[2]<0)return!1;e=qr(t,e);return!!e&&(this._camera.orientation=e,!0)}_setCameraPosition(e){var t=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;e[2]=re.clamp(e[2],i/r,i/t),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){e=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(t){const r=[new re.UnwrappedTileID(0,t)];if(this.renderWorldCopies){var e=this.pointCoordinate(new re.pointGeometry(0,0)),i=this.pointCoordinate(new re.pointGeometry(this.width,0)),n=this.pointCoordinate(new re.pointGeometry(this.width,this.height)),a=this.pointCoordinate(new re.pointGeometry(0,this.height)),s=Math.floor(Math.min(e.x,i.x,n.x,a.x)),o=Math.floor(Math.max(e.x,i.x,n.x,a.x));for(let e=s-1;e<=o+1;e++)0!==e&&r.push(new re.UnwrappedTileID(e,t))}return r}coveringTiles(o){let l=this.coveringZoomLevel(o);const c=l,s=this.elevation&&!o.isTerrainDEM,h="mercator"===this.projection.name;if(void 0!==o.minzoom&&l<o.minzoom)return[];void 0!==o.maxzoom&&l>o.maxzoom&&(l=o.maxzoom);const r=this.locationCoordinate(this.center),u=1<<l,i=[u*r.x,u*r.y,0],n=L.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l),e=this.pointCoordinate(this.getCameraPoint()),d=u*re.mercatorZfromAltitude(1,this.center.lat),t=this._camera.position[2]/re.mercatorZfromAltitude(1,this.center.lat),p=[u*e.x,u*e.y,t],f=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),m=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&h?l:0,g=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_=o.isTerrainDEM?-g:this._elevation?this._elevation.getMinElevationBelowMSL():0,v=Jr(this),y=e=>{const t=new re.MercatorCoordinate(e.x+25e-6,e.y,e.z),r=new re.MercatorCoordinate(e.x,e.y+25e-6,e.z),i=e.toLngLat(),n=t.toLngLat(),a=r.toLngLat(),s=this.locationCoordinate(i),o=this.locationCoordinate(n),l=this.locationCoordinate(a),c=Math.hypot(o.x-s.x,o.y-s.y),h=Math.hypot(l.x-s.x,l.y-s.y);return Math.sqrt(c*h)*v/25e-6},a=(e,t,r,i,n,a)=>{r=re.tileTransform({z:e,x:t,y:r},this.projection);return new P([(i+r.x/r.scale)*u,u*(r.y/r.scale),n],[(i+r.x2/r.scale)*u,u*(r.y2/r.scale),a])},x=e=>({aabb:a(0,0,0,e,_,g),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),b=[];let w=[];const T=l,E=o.reparseOverscaled?c:l,S=e=>{if(this._elevation&&e.tileID){const t=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb;t?(r.min[2]=t.min,r.max[2]=t.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=C(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))}},M=e=>e*e,A=M((t-this._centerAltitude)*d),C=e=>{if(e.zoom<m)return!0;if(e.zoom===T)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(p),r=e.aabb.distanceY(p);let i=A;s&&(i=M(e.aabb.distanceZ(p)*d));let n=1;if(!h&&c<=5){const t=Math.pow(2,e.zoom),c=y(new re.MercatorCoordinate((e.x+.5)/t,(e.y+.5)/t));n=.85<c?1:c}var a=t*t+r*r+i;return a<M((1<<T-e.zoom)*f*n*((e,t)=>{if(t*M(.707)<e)return 1;e=Math.sqrt(t/e);return e/(1.4144271570014144+(Math.pow(1.1,e-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(i,A),a))};if(this.renderWorldCopies)for(let e=1;e<=3;e++)b.push(x(-e)),b.push(x(e));for(b.push(x(0));0<b.length;){const c=b.pop(),h=c.x,r=c.y;let t=c.fullyVisible;if(!t){const re=c.aabb.intersects(n);if(0===re)continue;t=2===re}if(c.zoom!==T&&C(c))for(let e=0;e<4;e++){const l=(h<<1)+e%2,i=(r<<1)+(e>>1),n={aabb:"mercator"===this.projection.name?c.aabb.quadrant(e):a(c.zoom+1,l,i,c.wrap,0,0),zoom:c.zoom+1,x:l,y:i,wrap:c.wrap,fullyVisible:t,tileID:void 0,shouldSplit:void 0};s&&(n.tileID=new re.OverscaledTileID(c.zoom+1===T?E:c.zoom+1,c.wrap,c.zoom+1,l,i),S(n)),b.push(n)}else{const s=c.zoom===T?E:c.zoom;if(!(o.minzoom&&o.minzoom>s)){const u=i[0]-(.5+h+(c.wrap<<c.zoom))*(1<<l-c.zoom),n=i[1]-.5-r,e=c.tileID||new re.OverscaledTileID(s,c.wrap,c.zoom,h,r);w.push({tileID:e,distanceSq:u*u+n*n})}}}if(this.fogCullDistSq){const l=this.fogCullDistSq,c=this.horizonLineFromTop();w=w.filter(t=>{const e=[0,0,0,1],r=[re.EXTENT,re.EXTENT,0,1],i=this.calculateFogTileMatrix(t.tileID.toUnwrapped());re.transformMat4(e,e,i),re.transformMat4(r,r,i);var n=re.getAABBPointSquareDist(e,r);if(0===n)return!0;let a=!1;const s=this._elevation;if(s&&n>l&&0!==c){const l=this.calculateProjMatrix(t.tileID.toUnwrapped());let e;o.isTerrainDEM||(e=s.getMinMaxForTile(t.tileID)),e=e||{min:_,max:g};const r=re.furthestTileCorner(this.rotation),i=[r[0]*re.EXTENT,r[1]*re.EXTENT,e.max];re.transformMat4$1(i,i,l),a=(1-i[1])*this.height*.5<c}return n<l||a})}return w.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){var t=re.clamp(e.lat,-re.MAX_MERCATOR_LATITUDE,re.MAX_MERCATOR_LATITUDE),t=this.projection.project(e.lng,t);return new re.pointGeometry(t.x*this.worldSize,t.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(e,t){var r=this.pointCoordinate(t),t=this.pointCoordinate(this.centerPoint),e=this.locationCoordinate(e);this.setLocation(new re.MercatorCoordinate(e.x-(r.x-t.x),e.y-(r.y-t.y)))}setLocation(e){this.center=this.coordinateLocation(e),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e){return this._coordinatePoint(this.locationCoordinate(e),!1)}locationPoint3D(e){return this._coordinatePoint(this.locationCoordinate(e),!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,t){t=t?re.mercatorZfromAltitude(t,e.lat):void 0,e=this.projection.project(e.lng,e.lat);return new re.MercatorCoordinate(e.x,e.y,t)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,t){var r=null!=t?t:this._centerAltitude,i=[e.x,e.y,0,1],n=[e.x,e.y,1,1];re.transformMat4(i,i,this.pixelMatrixInverse),re.transformMat4(n,n,this.pixelMatrixInverse);t=n[3];re.scale$2(i,i,1/i[3]),re.scale$2(n,n,1/t);e=i[2],t=n[2];return{p0:i,p1:n,t:e===t?0:(r-e)/(t-e)}}screenPointToMercatorRay(e){const t=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return re.transformMat4(t,t,this.pixelMatrixInverse),re.transformMat4(r,r,this.pixelMatrixInverse),re.scale$2(t,t,1/t[3]),re.scale$2(r,r,1/r[3]),t[2]=re.mercatorZfromAltitude(t[2],this._center.lat)*this.worldSize,r[2]=re.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,re.scale$2(t,t,1/this.worldSize),re.scale$2(r,r,1/this.worldSize),new d([t[0],t[1],t[2]],re.normalize([],re.sub([],r,t)))}rayIntersectionCoordinate(e){var{p0:t,p1:r,t:i}=e,n=re.mercatorZfromAltitude(t[2],this._center.lat),e=re.mercatorZfromAltitude(r[2],this._center.lat);return new re.MercatorCoordinate(re.number(t[0],r[0],i)/this.worldSize,re.number(t[1],r[1],i)/this.worldSize,re.number(n,e,i))}pointCoordinate(e,t=this._centerAltitude){var r=this.horizonLineFromTop(!1),e=new re.pointGeometry(e.x,Math.max(r,e.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(e,t))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const r=this.elevation;let i=this.elevation.pointCoordinate(t);if(i)return new re.MercatorCoordinate(i[0],i[1],i[2]);let n=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);const s=.02*a,o=t.clone();for(let e=0;e<10&&a-n>s;e++){o.y=re.number(n,a,.66);const t=r.pointCoordinate(o);t?(a=o.y,i=t):n=o.y}return i?new re.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){if(this.elevation)return!this.elevation.pointCoordinate(e);var t=this.horizonLineFromTop();return e.y<t}_coordinatePoint(e,t){t=t&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,e=[e.x*this.worldSize,e.y*this.worldSize,t+e.toAltitude(),1];return re.transformMat4(e,e,this.pixelMatrix),0<e[3]?new re.pointGeometry(e[0]/e[3],e[1]/e[3]):new re.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(e,t){var r=new re.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),i=new re.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),n=new re.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),a=new re.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let s=this.pointCoordinate(r,e),o=this.pointCoordinate(i,e);n=this.pointCoordinate(n,t),a=this.pointCoordinate(a,t),t=(e,t)=>(t.y-e.y)/(t.x-e.x);return 1<s.y&&0<=o.y?s=new re.MercatorCoordinate((1-a.y)/t(a,s)+a.x,1):s.y<0&&o.y<=1&&(s=new re.MercatorCoordinate(-a.y/t(a,s)+a.x,0)),1<o.y&&0<=s.y?o=new re.MercatorCoordinate((1-n.y)/t(n,o)+n.x,1):o.y<0&&s.y<=1&&(o=new re.MercatorCoordinate(-n.y/t(n,o)+n.x,0)),(new re.LngLatBounds).extend(this.coordinateLocation(s)).extend(this.coordinateLocation(o)).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(n))}_getBounds3D(){const e=this.elevation,t=e.visibleDemTiles.reduce((e,t)=>{return t.dem&&(t=t.dem.tree,e.min=Math.min(e.min,t.minimums[0]),e.max=Math.max(e.max,t.maximums[0])),e},{min:Number.MAX_VALUE,max:0});return this._getBounds(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(e=!0){var t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,t=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,t):t}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-re.MAX_MERCATOR_LATITUDE,this.maxLat=re.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=re.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=re.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=re.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=re.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){let r,i,n;var a=e.canonical,s=re.identity(new Float64Array(16));if("mercator"===this.projection.name)r=t/this.zoomScale(a.z),i=(a.x+Math.pow(2,a.z)*e.wrap)*r,n=a.y*r;else{const t=re.tileTransform(a,this.projection);r=1,i=t.x+e.wrap*t.scale,n=t.y,re.scale$1(s,s,[r/t.scale,r/t.scale,this.pixelsPerMeter/this.worldSize])}return re.translate(s,s,[i,n,0]),re.scale$1(s,s,[r/re.EXTENT,r/re.EXTENT,1]),s}calculateDistanceTileData(e){const t=e.key,r=this._distanceTileDataCache;if(r[t])return r[t];var i=e.canonical,n=1/this.height,a=this.cameraWorldSize/this.zoomScale(i.z),s=(i.x+Math.pow(2,i.z)*e.wrap)*a,o=i.y*a,l=this.point,e=this.angle,i=Math.sin(-e),e=-Math.cos(-e);return r[t]={bearing:[i,e],center:[(l.x-s)*n,(l.y-o)*n],scale:a/re.EXTENT*n},r[t]}calculateFogTileMatrix(e){const t=e.key,r=this._fogTileMatrixCache;if(r[t])return r[t];e=this.calculatePosMatrix(e,this.cameraWorldSize);return re.multiply(e,this.worldToFogMatrix,e),r[t]=new Float32Array(e),r[t]}calculateProjMatrix(e,t=!1){const r=e.key,i=t?this._alignedProjMatrixCache:this._projMatrixCache;if(i[r])return i[r];e=this.calculatePosMatrix(e,this.worldSize);return re.multiply(e,"mercator"===this.projection.name?t?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,e),i[r]=new Float32Array(e),i[r]}calculatePixelsToTileUnitsMatrix(e){const t=e.tileID.key,r=this._pixelsToTileUnitsCache;if(r[t])return r[t];var i,n,a,s,o,l,n=(i=this,o=e.tileTransform.scale,l=o*re.EXTENT/(e.tileSize*Math.pow(2,i.zoom-e.tileID.overscaledZ+e.tileID.canonical.z)),n=new Float32Array(4),s=(a=i.inverseAdjustmentMatrix)[1],e=a[2],o=a[3],l=(i=[l,l])[1],n[0]=a[0]*(i=i[0]),n[1]=s*i,n[2]=e*l,n[3]=o*l,n);return r[t]=n,r[t]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(this._elevation){const t=this._elevation;this._updateCameraState();const r=this._camera.position,i=this._camera.forward();if(!(r[2]<=0||0<=i[2])){const n=re.mercatorZfromAltitude(1,this._center.lat);r[2]/=n,i[2]/=n,re.normalize(i,i);var e=t.raycast(r,i,t.exaggeration());if(e){const t=re.scaleAndAdd([],r,i,e),n=new re.MercatorCoordinate(t[0],t[1],re.mercatorZfromAltitude(t[2],re.latFromMercatorY(t[1]))),a=this._camera.position,s=n.z+re.length([n.x-a[0],n.y-a[1],n.z-a[2]]);this._cameraZoom=this._zoomFromMercatorZ(s),this._centerAltitude=n.toAltitude(),this._center=this.coordinateLocation(n),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}}}_constrainCameraAltitude(){if(this._elevation){const t=this._elevation;this._updateCameraState();const r=t.getAtPointOrZero(this._camera.mercatorPosition),i=this._minimumHeightOverTerrain()*Math.cos(re.degToRad(this._maxPitch)),n=re.mercatorZfromAltitude(r,this._center.lat),a=this._camera.position[2]-n;if(a<i){const t=this.locationCoordinate(this._center,this._centerAltitude),r=this._camera.mercatorPosition,n=[t.x-r.x,t.y-r.y,t.z-r.z],s=re.length(n);n[2]-=i-a;var e=re.length(n);0!==e&&(re.scale(n,n,s/e),this._camera.position=[t.x-n[0],t.y-n[1],t.z-n[2]],this._camera.orientation=qr(n,this._camera.up()),this._updateStateFromCamera())}}}_constrain(){if(this.center&&this.width&&this.height&&!this._constraining){if(this._constraining=!0,"mercator"!==this.projection.name){const o=this.center;return o.lat=re.clamp(o.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(o.lng=re.clamp(o.lng,this.minLng,this.maxLng)),this.center=o,void(this._constraining=!1)}const o=this._unmodified,{x:l,y:c}=this.point;let e=0,t=l,r=c;var i=this.width/2,n=this.height/2,a=this.worldMinY*this.scale,s=this.worldMaxY*this.scale;if(c-n<a&&(r=a+n),c+n>s&&(r=s-n),s-a<this.height&&(e=Math.max(e,this.height/(s-a)),r=(s+a)/2),this.maxBounds||!this.renderWorldCopies){const re=this.worldMinX*this.scale,o=this.worldMaxX*this.scale,c=this.worldSize/2-(re+o)/2;t=(l+c+this.worldSize)%this.worldSize-c,t-i<re&&(t=re+i),t+i>o&&(t=o-i),o-re<this.width&&(e=Math.max(e,this.width/(o-re)),t=(o+re)/2)}t===l&&r===c||(this.center=this.unproject(new re.pointGeometry(t,r))),e&&(this.zoom+=this.scaleZoom(e)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(this.height){const s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const o=this.pixelsPerMeter;this._updateCameraState();const l=Math.PI/2+this._pitch,c=this.fovAboveCenter,h=this.elevation?this.elevation.getMinElevationBelowMSL()*o:0,u=(this._camera.position[2]*this.worldSize-h)/Math.cos(this._pitch),d=Math.sin(c)*u/Math.sin(re.clamp(Math.PI-l-c,.01,Math.PI-.01)),p=this.point,f=p.x,m=p.y,g=Math.cos(Math.PI/2-this._pitch)*d+u,_=Math.min(2*g,u*(1/this._horizonShift)),v=this.height/50,y=this._camera.getWorldToCamera(this.worldSize,o),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,v,_);x[8]=2*-s.x/this.width,x[9]=2*s.y/this.height;let e=re.mul$1([],x,y);if("mercator"!==this.projection.name){const s=this.locationCoordinate(this.center),o=re.identity([]);re.translate(o,o,[s.x*this.worldSize,s.y*this.worldSize,0]),re.multiply(o,o,Kr(this)),re.translate(o,o,[-s.x*this.worldSize,-s.y*this.worldSize,0]),re.multiply(e,e,o),this.inverseAdjustmentMatrix=function(e){e=Kr(e,!0);return T([],[e[0],e[1],e[4],e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=re.scale$1([],e,[this.worldSize,this.worldSize,this.worldSize/o]),this.projMatrix=e,this.invProjMatrix=re.invert(new Float64Array(16),this.projMatrix);var t=new Float32Array(16);re.identity(t),re.scale$1(t,t,[1,-1,1]),re.rotateX(t,t,this._pitch),re.rotateZ(t,t,this.angle);const b=re.perspective(new Float32Array(16),this._fov,this.width/this.height,v,_),w=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;b[8]=2*-s.x/this.width,b[9]=2*(s.y+w)/this.height,this.skyboxMatrix=re.multiply(t,b,t);var r=this.width%2/2,i=this.height%2/2,n=Math.cos(this.angle),a=Math.sin(this.angle),t=f-Math.round(f)+n*r+a*i,a=m-Math.round(m)+n*i+a*r,r=new Float64Array(e);if(re.translate(r,r,[.5<t?t-1:t,.5<a?a-1:a,0]),this.alignedProjMatrix=r,e=re.create$1(),re.scale$1(e,e,[this.width/2,-this.height/2,1]),re.translate(e,e,[1,-1,0]),this.labelPlaneMatrix=e,e=re.create$1(),re.scale$1(e,e,[1,-1,1]),re.translate(e,e,[-1,-1,0]),re.scale$1(e,e,[2/this.width,2/this.height,1]),this.glCoordMatrix=e,this.pixelMatrix=re.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},e=re.invert(new Float64Array(16),this.pixelMatrix),!e)throw new Error("failed to invert matrix");this.pixelMatrixInverse=e,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}}_calcFogMatrices(){this._fogTileMatrixCache={};var e=this.cameraWorldSize,t=this.cameraPixelsPerMeter,r=this._camera.position,i=1/this.height,n=[e,e,t];re.scale(n,n,i),re.scale(r,r,-1),re.multiply$1(r,r,n);var a=re.create$1();re.translate(a,a,r),re.scale$1(a,a,n),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,t,i)}_updateCameraState(){var e,t,r,i;this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),e=this._camera.forward(),t=this.cameraToCenterDistance,r=this.point,i=this._mercatorZfromZoom(this._cameraZoom||this._zoom)-re.mercatorZfromAltitude(this._centerAltitude,this.center.lat),i=this.cameraToCenterDistance/i,this._camera.position=[r.x/this.worldSize-e[0]*t/i,r.y/this.worldSize-e[1]*t/i,re.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-e[2]*t/i])}_translateCameraConstrained(e){var t=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=e[2];let i=1;0<r&&(i=Math.min((t-this._camera.position[2])/r,1)),this._camera.position=re.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera()}_updateStateFromCamera(){var e=this._camera.position,t=this._camera.forward(),{pitch:r,bearing:i}=this._camera.getPitchBearing(),n=re.mercatorZfromAltitude(this._centerAltitude,this.center.lat),a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(re.degToRad(this._maxPitch)),n=Math.max((e[2]-n)/Math.cos(r),a),a=this._zoomFromMercatorZ(n);re.scaleAndAdd(e,e,t,n),this._pitch=re.clamp(r,re.degToRad(this.minPitch),re.degToRad(this.maxPitch)),this.angle=re.wrap(i,-Math.PI,Math.PI),this._setZoom(re.clamp(a,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new re.MercatorCoordinate(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){var e=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(re.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(e,t){var r=Math.min(e.x,t.x),i=Math.max(e.x,t.x),n=Math.min(e.y,t.y),t=Math.max(e.y,t.y);if(n<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;var n=[new re.pointGeometry(r,n),new re.pointGeometry(i,t),new re.pointGeometry(r,t),new re.pointGeometry(i,n)],a=this.renderWorldCopies?-3:0,s=this.renderWorldCopies?4:1;for(const re of n){const e=this.pointRayIntersection(re);if(e.t<0)return!0;const o=this.rayIntersectionCoordinate(e);if(o.x<a||o.y<0||o.x>s||1<o.y)return!0}return!1}isHorizonVisible(){return 88<this.pitch+re.radToDeg(this.fovAboveCenter)||this.anyCornerOffEdge(new re.pointGeometry(0,0),new re.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,t){e=re.length(re.sub([],this._camera.position,e)),t=this._zoomFromMercatorZ(e)+t;return e-this._mercatorZfromZoom(t)}getCameraPoint(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new re.pointGeometry(0,e))}}function ni(e,t){let r=!1,i=null;const n=()=>{i=null,r&&(e(),i=setTimeout(n,t),r=!1)};return()=>(r=!0,i||n(),i)}class ai{constructor(e){this._hashName=e&&encodeURIComponent(e),re.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ni(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,re.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return re.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const e=this._map.getCenter(),t=Math.round(100*this._map.getZoom())/100,r=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,r),a=Math.round(e.lng*n)/n,s=Math.round(e.lat*n)/n,o=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=i?`/${a}/${s}/${t}`:`${t}/${s}/${a}`,(o||l)&&(c+="/"+Math.round(10*o)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const i=this._hashName;let r=!1;const t=re.window.location.hash.slice(1).split("&").map(e=>{var t=e.split("=")[0];return t===i?(r=!0,`${t}=${c}`):e}).filter(e=>e);return r||t.push(`${i}=${c}`),`#${t.join("&")}`}return`#${c}`}_getCurrentHash(){const e=re.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._getCurrentHash();if(3<=e.length&&!e.some(e=>isNaN(e))){var t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){var e=re.window.location.href.replace(/(#.+)?$/,this.getHashString());re.window.history.replaceState(re.window.history.state,null,e)}}const si={linearity:.3,easing:re.bezier(0,0,.3,1)},oi=re.extend({deceleration:2500,maxSpeed:1400},si),li=re.extend({deceleration:20,maxSpeed:1400},si),ci=re.extend({deceleration:1e3,maxSpeed:360},si),hi=re.extend({deceleration:1e3,maxSpeed:90},si);class ui{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:re.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=re.exported.now();for(;0<e.length&&160<t-e[0].time;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){const t={zoom:0,bearing:0,pitch:0,pan:new re.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:re}of this._inertiaBuffer)t.zoom+=re.zoomDelta||0,t.bearing+=re.bearingDelta||0,t.pitch+=re.pitchDelta||0,re.panDelta&&t.pan._add(re.panDelta),re.around&&(t.around=re.around),re.pinchAround&&(t.pinchAround=re.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(t.pan.mag()&&(e=pi(t.pan.mag(),r,re.extend({},oi,e||{})),i.offset=t.pan.mult(e.amount/t.pan.mag()),i.center=this._map.transform.center,di(i,e)),t.zoom){const re=pi(t.zoom,r,li);i.zoom=this._map.transform.zoom+re.amount,di(i,re)}if(t.bearing){const n=pi(t.bearing,r,ci);i.bearing=this._map.transform.bearing+re.clamp(n.amount,-179,179),di(i,n)}if(t.pitch){const re=pi(t.pitch,r,hi);i.pitch=this._map.transform.pitch+re.amount,di(i,re)}if(i.zoom||i.bearing){const re=void 0===t.pinchAround?t.around:t.pinchAround;i.around=re?this._map.unproject(re):this._map.getCenter()}return this.clear(),re.extend(i,{noMoveStart:!0})}}}function di(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function pi(e,t,r){var{maxSpeed:i,linearity:n,deceleration:a}=r,i=re.clamp(e*n/(t/1e3),-i,i),n=Math.abs(i)/(a*n);return{easing:r.easing,duration:1e3*n,amount:i*(n/2)}}class fi extends re.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r,i={}){var n=f.mousePos(t.getCanvasContainer(),r),a=t.unproject(n);super(e,re.extend({point:n,lngLat:a,originalEvent:r},i)),this._defaultPrevented=!1,this.target=t}}class mi extends re.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){const i="touchend"===e?r.changedTouches:r.touches,n=f.touchPos(t.getCanvasContainer(),i),a=n.map(e=>t.unproject(e)),s=n.reduce((e,t,r,i)=>e.add(t.div(i.length)),new re.pointGeometry(0,0));super(e,{points:n,point:s,lngLats:a,lngLat:t.unproject(s),originalEvent:r}),this._defaultPrevented=!1}}class gi extends re.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class _i{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new gi(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new fi(e.type,this._map,e))}mouseup(e){this._map.fire(new fi(e.type,this._map,e))}preclick(e){const t=re.extend({},e);t.type="preclick",this._map.fire(new fi(t.type,this._map,t))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new fi(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new fi(e.type,this._map,e))}mouseover(e){this._map.fire(new fi(e.type,this._map,e))}mouseout(e){this._map.fire(new fi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new mi(e.type,this._map,e))}touchmove(e){this._map.fire(new mi(e.type,this._map,e))}touchend(e){this._map.fire(new mi(e.type,this._map,e))}touchcancel(e){this._map.fire(new mi(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(e){this._map.fire(new fi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new fi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yi{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(f.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(this._active){const r=t;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){t=this._startPos;this._lastPos=r,this._box||(this._box=f.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const i=Math.min(t.x,r.x),n=Math.max(t.x,r.x),a=Math.min(t.y,r.y),s=Math.max(t.y,r.y);this._map._requestDomTask(()=>{this._box&&(f.setTransform(this._box,`translate(${i}px,${a}px)`),this._box.style.width=n-i+"px",this._box.style.height=s-a+"px")})}}}mouseupWindow(e,t){if(this._active&&0===e.button){const r=this._startPos,i=t;if(this.reset(),f.suppressClick(),r.x!==i.x||r.y!==i.y)return this._map.fire(new re.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(r,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(f.remove(this._box),this._box=null),f.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new re.Event(e,{originalEvent:t}))}}function xi(t,r){const i={};for(let e=0;e<t.length;e++)i[t[e].identifier]=r[e];return i}class bi{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,t,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const t=new re.pointGeometry(0,0);for(const re of e)t._add(re);return t.div(e.length)}(t),this.touches=xi(r,t)))}touchmove(e,t,r){if(!this.aborted&&this.centroid){var i=xi(r,t);for(const e in this.touches){const t=this.touches[e],r=i[e];(!r||30<r.dist(t))&&(this.aborted=!0)}}}touchend(e,t,r){if((!this.centroid||500<e.timeStamp-this.startTime)&&(this.aborted=!0),0===r.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class wi{constructor(e){this.singleTap=new bi(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){r=this.singleTap.touchend(e,t,r);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Ti{constructor(){this._zoomIn=new wi({numTouches:1,numTaps:2}),this._zoomOut=new wi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(t,e,r){const i=this._zoomIn.touchend(t,e,r),n=this._zoomOut.touchend(t,e,r);return i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ei={0:1,2:2};class Si{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){var r;this._lastPoint||(r=f.mouseButton(e),this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r))}mousemoveWindow(e,t){var r=this._lastPoint;if(r)if(e.preventDefault(),function(e,t){t=Ei[t];return void 0===e.buttons||(e.buttons&t)!==t}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(r,t)}mouseupWindow(e){this._lastPoint&&f.mouseButton(e)===this._eventButton&&(this._moved&&f.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mi extends Si{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Ai extends Si{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){e=.8*(t.x-e.x);if(e)return this._active=!0,{bearingDelta:e}}contextmenu(e){e.preventDefault()}}class Ci extends Si{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){e=-.5*(t.y-e.y);if(e)return this._active=!0,{pitchDelta:e}}contextmenu(e){e.preventDefault()}}class Li{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset(),re.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new re.pointGeometry(0,0)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(e,t,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.preventDefault(),this._calculateTransform(e,t,r)}}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,r){0<r.length&&(this._active=!0);const i=xi(r,t),n=new re.pointGeometry(0,0),a=new re.pointGeometry(0,0);let s=0;for(const re in i){const e=i[re],o=this._touches[re];o&&(n._add(e),a._add(e.sub(o)),s++,i[re]=e)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){t=a.div(s);return this._sum._add(t),this._sum.mag()<this._clickTolerance?void 0:{around:n.div(s),panDelta:t}}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=f.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Pi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,t,r){return{}}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){if(this._firstTwoTouches){e.preventDefault();const[i,n]=this._firstTwoTouches,a=Ii(r,t,i),s=Ii(r,t,n);if(a&&s){t=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],t,e)}}}touchend(e,t,r){var i,n;this._firstTwoTouches&&([i,n]=this._firstTwoTouches,i=Ii(r,t,i),n=Ii(r,t,n),i&&n||(this._active&&f.suppressClick(),this.reset()))}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ii(t,r,i){for(let e=0;e<t.length;e++)if(t[e].identifier===i)return r[e]}function Ri(e,t){return Math.log(e/t)/Math.LN2}class Di extends Pi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){var r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ri(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ri(this._distance,r),pinchAround:t}}}function Oi(e,t){return 180*e.angleWith(t)/Math.PI}class ki extends Pi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){var r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oi(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,e=Oi(e,this._startVector);return Math.abs(e)<t}}function Bi(e){return Math.abs(e.y)>Math.abs(e.x)}class Fi extends Pi{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(e){Bi((this._lastPoints=e)[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,r){var i=e[0].sub(this._lastPoints[0]),n=e[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&r.touches.length<3)&&(this._valid=this.gestureBeginsVertically(i,n,r.timeStamp),this._valid))return this._lastPoints=e,this._active=!0,{pitchDelta:(i.y+n.y)/2*-.5}}gestureBeginsVertically(e,t,r){if(void 0!==this._valid)return this._valid;var i=2<=e.mag(),n=2<=t.mag();if(i||n){if(!i||!n)return void 0===this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;r=0<e.y==0<t.y;return Bi(e)&&Bi(t)&&r}}}const zi={panStep:100,bearingStep:15,pitchStep:10};class Ni{constructor(){var e=zi;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(!(o.altKey||o.ctrlKey||o.metaKey)){let r=0,i=0,n=0,a=0,s=0;switch(o.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:o.shiftKey?i=-1:(o.preventDefault(),a=-1);break;case 39:o.shiftKey?i=1:(o.preventDefault(),a=1);break;case 38:o.shiftKey?n=1:(o.preventDefault(),s=-1);break;case 40:o.shiftKey?n=-1:(o.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:e=>{var t=e.getZoom();e.easeTo({duration:300,easeId:"keyboardHandler",easing:Ui,zoom:r?Math.round(t)+r*(o.shiftKey?2:1):t,bearing:e.getBearing()+i*this._bearingStep,pitch:e.getPitch()+n*this._pitchStep,offset:[-a*this._panStep,-s*this._panStep],center:e.getCenter()},{originalEvent:o})}}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ui(e){return e*(2-e)}const Gi=4.000244140625;class Vi{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._handler=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,re.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(this.isEnabled()){if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let e=t.deltaMode===re.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;var r=re.exported.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==e&&e%Gi==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":400<i?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){this._delta&&(this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout),e=f.mousePos(this._el,e),this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame()))}renderFrame(){if(this._frameId&&(this._frameId=null,this.isActive())){const r=this._map.transform,i=()=>r._terrainEnabled()?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const re="wheel"===this._type&&Math.abs(this._delta)>Gi?this._wheelZoomRate:this._defaultZoomRate;let e=2/(1+Math.exp(-Math.abs(this._delta*re)));this._delta<0&&0!==e&&(e=1/e);const a=i(),s=Math.pow(2,a),t="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(t*e))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),a=this._startZoom,s=this._easing;let e,t=!1;if("wheel"===this._type&&a&&s){const r=Math.min((re.exported.now()-this._lastWheelEventTime)/200,1),i=s(r);e=re.number(a,n,i),r<1?this._frameId||(this._frameId=!0):t=!0}else e=n,t=!0;return this._active=!0,t&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!t,zoomDelta:e-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}}_smoothOutEasing(e){let t=re.ease;if(this._prevEase){const e=this._prevEase,r=(re.exported.now()-e.start)/e.duration,i=e.easing(.01+r)-e.easing(r),n=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-n*n);t=re.bezier(n,a,.25,1)}return this._prevEase={start:re.exported.now(),duration:e,easing:t},t}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=f.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(re.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!re.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class $i{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ji{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:e=>{e.easeTo({duration:300,zoom:e.getZoom()+(t.shiftKey?-1:1),around:e.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hi{constructor(){this._tap=new wi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,t,r){this._swipePoint||(this._tapTime&&500<e.timeStamp-this._tapTime&&this.reset(),this._tapTime?0<r.length&&(this._swipePoint=t[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,t,r))}touchmove(e,t,r){if(this._tapTime){if(this._swipePoint&&r[0].identifier===this._swipeTouch){var i=t[0],n=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,t,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wi{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zi{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qi{constructor(e,t,r,i){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xi=e=>e.zoom||e.drag||e.pitch||e.rotate;class Yi extends re.Event{}class Ki{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,t){e=re.sub([],t,e);this.radius=re.length(e[2]<0?re.div([],e,this.constants):[e[0],e[1],0])}projectRay(e){re.div(e,e,this.constants),re.normalize(e,e),re.mul$2(e,e,this.constants);const t=re.scale([],e,this.radius);if(0<t[2]){const e=re.scale([],[0,0,1],re.dot(t,[0,0,1])),r=re.scale([],re.normalize([],[t[0],t[1],0]),this.radius),i=re.add([],t,re.scale([],re.sub([],re.add([],r,e),t),2));t[0]=i[0],t[1]=i[1]}return t}}function Ji(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Qi{constructor(e,t){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ui(e),this._bearingSnap=t.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ki,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(t),re.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[re.window.document,"mousemove",{capture:!0}],[re.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[re.window,"blur",void 0]];for(const[e,t,r]of this._listeners)f.addEventListener(e,t,e===re.window.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(var[e,t,r]of this._listeners)f.removeEventListener(e,t,e===re.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new _i(t,e));var i=t.boxZoom=new yi(t,e);this._add("boxZoom",i);var n=new Ti,a=new ji;t.doubleClickZoom=new $i(a,n),this._add("tapZoom",n),this._add("clickZoom",a);i=new Hi;this._add("tapDragZoom",i);n=t.touchPitch=new Fi(t);this._add("touchPitch",n);a=new Ai(e),n=new Ci(e);t.dragRotate=new Zi(e,a,n),this._add("mouseRotate",a,["mousePitch"]),this._add("mousePitch",n,["mouseRotate"]);a=new Mi(e),n=new Li(t,e);t.dragPan=new Wi(r,a,n),this._add("mousePan",a),this._add("touchPan",n,["touchZoom","touchRotate"]);a=new ki,n=new Di;t.touchZoomRotate=new qi(r,n,a,i),this._add("touchRotate",a,["touchPan","touchZoom"]),this._add("touchZoom",n,["touchPan","touchRotate"]),this._add("blockableMapEvent",new vi(t));n=t.scrollZoom=new Vi(t,this);this._add("scrollZoom",n,["mousePan"]);n=t.keyboard=new Ni;this._add("keyboard",n);for(const r of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[r]&&t[r].enable(e[r])}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(var{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Xi(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,r){for(const i in e)if(i!==r&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const r of e)this._el.contains(r.target)&&t.push(r);return t}handleEvent(t,r){this._updatingCamera=!0;const i="renderFrame"===t.type,n=i?void 0:t,a={needsRenderFrame:!1},s={},o={},l=t.touches?this._getMapTouches(t.touches):void 0,c=l?f.touchPos(this._el,l):i?void 0:f.mousePos(this._el,t);for(const{handlerName:i,handler:f,allowed:h}of this._handlers)if(f.isEnabled()){let e;this._blockedByActive(o,h,i)?f.reset():f[r||t.type]&&(e=f[r||t.type](t,c,l),this.mergeHandlerResult(a,s,e,i,n),e&&e.needsRenderFrame&&this._triggerRenderFrame()),(e||f.isActive())&&(o[i]=f)}const h={};for(const t in this._previousActiveHandlers)o[t]||(h[t]=n);this._previousActiveHandlers=o,(Object.keys(h).length||Ji(a))&&(this._changes.push([a,s,h]),this._triggerRenderFrame()),(Object.keys(o).length||Ji(a))&&this._map._stop(!0),this._updatingCamera=!1;const e=a["cameraAnimation"];e&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],e(this._map))}mergeHandlerResult(e,t,r,i,n){r&&(re.extend(e,r),n={handlerName:i,originalEvent:r.originalEvent||n},void 0!==r.zoomDelta&&(t.zoom=n),void 0!==r.panDelta&&(t.drag=n),void 0!==r.pitchDelta&&(t.pitch=n),void 0!==r.bearingDelta&&(t.rotate=n))}_applyChanges(){const e={},t={},r={};for(var[i,n,a]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new re.pointGeometry(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.aroundCoord&&(e.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),re.extend(t,n),re.extend(r,a);this._updateMapTransform(e,t,r),this._changes=[]}_updateMapTransform(e,t,r){const i=this._map,n=i.transform,a=e=>[e.x,e.y,e.z];if((m=this._eventsInProgress.drag)&&!this._handlersById[m.handlerName].isActive()&&!Ji(e)){const re=n.zoom;n.cameraElevationReference="sea",n.recenterOnTerrain(),n.cameraElevationReference="ground",re!==n.zoom&&this._map._update(!0)}if(!Ji(e))return this._fireEvents(t,r,!0);let{panDelta:s,zoomDelta:o,bearingDelta:l,pitchDelta:c,around:h,aroundCoord:u,pinchAround:d}=e;void 0!==d&&(h=d),t.drag&&!this._eventsInProgress.drag&&h&&(this._dragOrigin=a(n.pointCoordinate3D(h)),this._trackingEllipsoid.setup(n._camera.position,this._dragOrigin)),n.cameraElevationReference="sea",i._stop(!0),h=h||i.transform.centerPoint,l&&(n.bearing+=l),c&&(n.pitch+=c),n._updateCameraState();const p=[0,0,0];if(s){const re=n.screenPointToMercatorRay(h),e=n.screenPointToMercatorRay(h.sub(s)),t=this._trackingEllipsoid.projectRay(re.dir),r=this._trackingEllipsoid.projectRay(e.dir);p[0]=r[0]-t[0],p[1]=r[1]-t[1]}var f=n.zoom,m=[0,0,0];if(o){const e=a(u||n.pointCoordinate3D(h)),t={dir:re.normalize([],re.sub([],e,n._camera.position))},r=n.screenPointToMercatorRay(n.centerPoint);if(t.dir[2]<0){const i=re.altitudeFromMercatorZ(e[2],e[1]),s=n.rayIntersectionCoordinate(n.pointRayIntersection(n.centerPoint,i)),l=n.zoomDeltaToMovement(a(s),o)*(r.dir[2]/t.dir[2]);re.scale(m,t.dir,l)}else if(n._terrainEnabled()){const r=n.zoomDeltaToMovement(e,o);re.scale(m,t.dir,r)}}m=re.add(p,p,m);n._translateCameraConstrained(m),o&&1e-4<Math.abs(n.zoom-f)&&n.recenterOnTerrain(),n.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,r,!0)}_fireEvents(e,t,r){const i=Xi(this._eventsInProgress),n=Xi(e),a={};for(const re in e){const t=e[re]["originalEvent"];this._eventsInProgress[re]||(a[`${re}start`]=t),this._eventsInProgress[re]=e[re]}!i&&n&&this._fireEvent("movestart",n.originalEvent);for(const re in a)this._fireEvent(re,a[re]);n&&this._fireEvent("move",n.originalEvent);for(const re in e){const t=e[re]["originalEvent"];this._fireEvent(re,t)}const s={};let o;for(const re in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[re];this._handlersById[e].isActive()||(delete this._eventsInProgress[re],o=t[e]||r,s[`${re}end`]=o)}for(const re in s)this._fireEvent(re,s[re]);var l=Xi(this._eventsInProgress);if(r&&(i||n)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;e?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:o})):(this._map.fire(new re.Event("moveend",{originalEvent:o})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new re.Event(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Yi("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const en="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class tn extends re.Evented{constructor(e,t){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,re.bindAll(["_renderFrameCallback"],this)}getCenter(){return new re.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,r){return e=re.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,re.extend({offset:e},t),r)}panTo(e,t,r){return this.easeTo(re.extend({center:e},t),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,r){return this.easeTo(re.extend({zoom:e},t),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,r){return this.easeTo(re.extend({bearing:e},t),r)}resetNorth(e,t){return this.rotateTo(0,re.extend({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(re.extend({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=re.LngLatBounds.convert(e);var r=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,t)}_extendCameraOptions(e){var t={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=re.extend({padding:t,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const re=e.padding;e.padding={top:re,bottom:re,right:re,left:re}}return e.padding=re.extend(t,e.padding),e}_cameraForBoxAndBearing(e,t,r,i){const n=this._extendCameraOptions(i),a=this.transform,s=a.padding,o=a.project(re.LngLat.convert(e)),l=a.project(re.LngLat.convert(t)),c=o.rotate(-re.degToRad(r)),h=l.rotate(-re.degToRad(r)),u=new re.pointGeometry(Math.max(c.x,h.x),Math.max(c.y,h.y)),d=new re.pointGeometry(Math.min(c.x,h.x),Math.min(c.y,h.y)),p=u.sub(d),f=(a.width-(s.left+s.right+n.padding.left+n.padding.right))/p.x,m=(a.height-(s.top+s.bottom+n.padding.top+n.padding.bottom))/p.y;if(!(m<0||f<0)){const g=Math.min(a.scaleZoom(a.scale*Math.min(f,m)),n.maxZoom),_="number"==typeof n.offset.x?new re.pointGeometry(n.offset.x,n.offset.y):re.pointGeometry.convert(n.offset),v=new re.pointGeometry((n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2).rotate(r*Math.PI/180),y=_.add(v).mult(a.scale/a.zoomScale(g));return{center:a.unproject(o.add(l).div(2).sub(y)),zoom:g,bearing:r}}re.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}_cameraForBox(r,i,n,a,s){const o=this._extendCameraOptions(s);n=n||0,a=a||0,r=re.LngLat.convert(r),i=re.LngLat.convert(i);const l=this.transform.clone();l.padding=o.padding;const c=this.getFreeCameraOptions(),h=new re.LngLat(.5*(r.lng+i.lng),.5*(r.lat+i.lat)),u=.5*(n+a);if(!(l._camera.position[2]<re.mercatorZfromAltitude(u,h.lat))){c.lookAtPoint(h),l.setFreeCameraOptions(c);const p=re.MercatorCoordinate.fromLngLat(r),f=re.MercatorCoordinate.fromLngLat(i),m=l.pointRayIntersection(l.centerPoint,u),g=[(i=l.rayIntersectionCoordinate(m)).x,i.y,i.z];var d=l.screenPointToMercatorRay(l.centerPoint);let e,t=0;do{const r=Math.floor(l.zoom),_=1<<r,s=Math.min(_*p.x,_*f.x),o=Math.min(_*p.y,_*f.y),c=Math.max(_*p.x,_*f.x),h=Math.max(_*p.y,_*f.y),u=new P([s,o,n],[c,h,a]),m=L.fromInvProjectionMatrix(l.invProjMatrix,l.worldSize,r);if(2!==u.intersects(m)){e&&(l._camera.position=re.scaleAndAdd([],l._camera.position,d.dir,-e),l._updateStateFromCamera());break}const i=re.sub([],l._camera.position,g);e=.5*re.length(i),l._camera.position=re.scaleAndAdd([],l._camera.position,d.dir,e);try{l._updateStateFromCamera()}catch(r){return void re.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++t<10);return{center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}}re.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}fitBounds(e,t,r){return this._fitInternal(this.cameraForBounds(e,t),t,r)}_raycastElevationBox(e,t){const r=this.transform.elevation;if(r){var i=new re.pointGeometry(e.x,t.y),n=new re.pointGeometry(t.x,e.y),a=r.pointCoordinate(e);if(a){var s=r.pointCoordinate(t);if(s){var o=r.pointCoordinate(i);if(o){var l=r.pointCoordinate(n);if(l){var c=new re.MercatorCoordinate(a[0],a[1]).toLngLat(),h=new re.MercatorCoordinate(s[0],s[1]).toLngLat(),u=new re.MercatorCoordinate(o[0],o[1]).toLngLat(),e=new re.MercatorCoordinate(l[0],l[1]).toLngLat(),t=Math.min(c.lng,Math.min(h.lng,Math.min(u.lng,e.lng))),i=Math.min(c.lat,Math.min(h.lat,Math.min(u.lat,e.lat))),n=Math.max(c.lng,Math.max(h.lng,Math.max(u.lng,e.lng))),u=Math.max(c.lat,Math.max(h.lat,Math.max(u.lat,e.lat))),e=Math.min(a[3],Math.min(s[3],Math.min(o[3],l[3]))),l=Math.max(a[3],Math.max(s[3],Math.max(o[3],l[3])));return{minLngLat:new re.LngLat(t,i),maxLngLat:new re.LngLat(n,u),minAltitude:e,maxAltitude:l}}}}}}}fitScreenCoordinates(e,t,r,i,n){let a,s,o,l;var c=re.pointGeometry.convert(e),h=re.pointGeometry.convert(t),u=this._raycastElevationBox(c,h);if(u)a=u.minLngLat,s=u.maxLngLat,o=u.minAltitude,l=u.maxAltitude;else{if(this.transform.anyCornerOffEdge(c,h))return this;a=this.transform.pointLocation(c),s=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(re.pointGeometry.convert(e)),this.transform.pointLocation(re.pointGeometry.convert(t)),r,i):this._cameraForBox(a,s,o,l,i),i,n)}_fitInternal(e,t,r){return e?(delete(t=re.extend(e,t)).padding,t.linear?this.easeTo(t,r):this.flyTo(t,r)):this}jumpTo(e,t){this.stop();const r=this.transform;let i=!1,n=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=re.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(n=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new re.Event("movestart",t)).fire(new re.Event("move",t)),i&&this.fire(new re.Event("zoomstart",t)).fire(new re.Event("zoom",t)).fire(new re.Event("zoomend",t)),n&&this.fire(new re.Event("rotatestart",t)).fire(new re.Event("rotate",t)).fire(new re.Event("rotateend",t)),a&&this.fire(new re.Event("pitchstart",t)).fire(new re.Event("pitch",t)).fire(new re.Event("pitchend",t)),this.fire(new re.Event("moveend",t))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&re.warnOnce(en),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,t){const r=this.transform;if("mercator"===r.projection.name){this.stop();var i=r.zoom,n=r.pitch,a=r.bearing;r.setFreeCameraOptions(e);i=i!==r.zoom,n=n!==r.pitch,a=a!==r.bearing;return this.fire(new re.Event("movestart",t)).fire(new re.Event("move",t)),i&&this.fire(new re.Event("zoomstart",t)).fire(new re.Event("zoom",t)).fire(new re.Event("zoomend",t)),a&&this.fire(new re.Event("rotatestart",t)).fire(new re.Event("rotate",t)).fire(new re.Event("rotateend",t)),n&&this.fire(new re.Event("pitchstart",t)).fire(new re.Event("pitch",t)).fire(new re.Event("pitchend",t)),this.fire(new re.Event("moveend",t)),this}re.warnOnce(en)}easeTo(e,t){this._stop(!1,e.easeId),(!1===(e=re.extend({offset:[0,0],duration:500,easing:re.ease},e)).animate||!e.essential&&re.exported.prefersReducedMotion)&&(e.duration=0);const r=this.transform,i=this.getZoom(),n=this.getBearing(),a=this.getPitch(),s=this.getPadding(),o="zoom"in e?+e.zoom:i,l="bearing"in e?this._normalizeBearing(e.bearing,n):n,c="pitch"in e?+e.pitch:a,h=("padding"in e?e:r).padding,u=re.pointGeometry.convert(e.offset);let d=r.centerPoint.add(u);var p=r.pointLocation(d),f=re.LngLat.convert(e.center||p);this._normalizeCenter(f);const m=r.project(p),g=r.project(f).sub(m),_=r.zoomScale(o-i);let v,y;e.around&&(v=re.LngLat.convert(e.around),y=r.locationPoint(v));f={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||o!==i,this._rotating=this._rotating||n!==l,this._pitching=this._pitching||c!==a,this._padding=!r.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(t,e.noMoveStart,f),this._ease(e=>{if(this._zooming&&(r.zoom=re.number(i,o,e)),this._rotating&&(r.bearing=re.number(n,l,e)),this._pitching&&(r.pitch=re.number(a,c,e)),this._padding&&(r.interpolatePadding(s,h,e),d=r.centerPoint.add(u)),v)r.setLocationAtPoint(v,y);else{const re=r.zoomScale(r.zoom-i),t=o>i?Math.min(2,_):Math.max(.5,_),n=Math.pow(t,1-e),a=r.unproject(m.add(g.mult(e*n)).mult(re));r.setLocationAtPoint(r.renderWorldCopies?a.wrap():a,d)}this._fireMoveEvents(t)},e=>{r.recenterOnTerrain(),this._afterEase(t,e)},e),this}_prepareEase(e,t,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",t||r.moving||this.fire(new re.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new re.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new re.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new re.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new re.Event("move",e)),this._zooming&&this.fire(new re.Event("zoom",e)),this._rotating&&this.fire(new re.Event("rotate",e)),this._pitching&&this.fire(new re.Event("pitch",e))}_afterEase(e,t){var r,i;this._easeId&&t&&this._easeId===t||(delete this._easeId,this.transform.cameraElevationReference="ground",r=this._zooming,i=this._rotating,t=this._pitching,this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new re.Event("zoomend",e)),i&&this.fire(new re.Event("rotateend",e)),t&&this.fire(new re.Event("pitchend",e)),this.fire(new re.Event("moveend",e)))}flyTo(e,n){if(!e.essential&&re.exported.prefersReducedMotion){const a=re.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(a,n)}this.stop(),e=re.extend({offset:[0,0],speed:1.2,curve:1.42,easing:re.ease},e);const a=this.transform,s=this.getZoom(),o=this.getBearing(),l=this.getPitch(),c=this.getPadding(),h="zoom"in e?re.clamp(+e.zoom,a.minZoom,a.maxZoom):s,u="bearing"in e?this._normalizeBearing(e.bearing,o):o,d="pitch"in e?+e.pitch:l,p=("padding"in e?e:a).padding,t=a.zoomScale(h-s),f=re.pointGeometry.convert(e.offset);let m=a.centerPoint.add(f);const r=a.pointLocation(m),g=re.LngLat.convert(e.center||r);this._normalizeCenter(g);const _=a.project(r),v=a.project(g).sub(_);let i=e.curve;const y=Math.max(a.width,a.height),x=y/t,b=v.mag();if("minZoom"in e){const n=re.clamp(Math.min(e.minZoom,s,h),a.minZoom,a.maxZoom),o=y/a.zoomScale(n-s);i=Math.sqrt(o/b*2)}const w=i*i;function T(e){e=(x*x-y*y+(e?-1:1)*w*w*b*b)/(2*(e?x:y)*w*b);return Math.log(Math.sqrt(e*e+1)-e)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function S(e){return(Math.exp(e)+Math.exp(-e))/2}const M=T(0);let A=function(e){return S(M)/S(M+i*e)},C=function(e){return y*((S(M)*(E(e=M+i*e)/S(e))-E(M))/w)/b},L=(T(1)-M)/i;if(Math.abs(b)<1e-6||!isFinite(L)){if(Math.abs(y-x)<1e-6)return this.easeTo(e,n);const re=x<y?-1:1;L=Math.abs(Math.log(x/y))/i,C=function(){return 0},A=function(e){return Math.exp(re*i*e)}}return e.duration="duration"in e?+e.duration:1e3*L/("screenSpeed"in e?+e.screenSpeed/i:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==u,this._pitching=d!==l,this._padding=!a.isPaddingEqual(p),this._prepareEase(n,!1),this._ease(e=>{var t=e*L,r=1/A(t);a.zoom=1===e?h:s+a.scaleZoom(r),this._rotating&&(a.bearing=re.number(o,u,e)),this._pitching&&(a.pitch=re.number(l,d,e)),this._padding&&(a.interpolatePadding(c,p,e),m=a.centerPoint.add(f));const i=1===e?g:a.unproject(_.add(v.mult(C(t))).mult(r));a.setLocationAtPoint(a.renderWorldCopies?i.wrap():i,m),a._updateCenterElevation(),this._fireMoveEvents(n)},()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(e,t,r){!1===r.animate||0===r.duration?(e(1),t()):(this._easeStart=re.exported.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){var e=Math.min((re.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,t){e=re.wrap(e,-180,180);var r=Math.abs(e-t);return Math.abs(e-360-t)<r&&(e-=360),Math.abs(e+360-t)<r&&(e+=360),e}_normalizeCenter(e){var t=this.transform;t.renderWorldCopies&&!t.maxBounds&&(t=e.lng-t.center.lng,e.lng+=180<t?-360:t<-180?360:0)}}class rn{constructor(e={}){this.options=e,re.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){var t=this.options&&this.options.compact;return this._map=e,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=f.create("button","mapboxgl-ctrl-attrib-button",this._container),f.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=f.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){f.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){t=this._map._getUIString(`AttributionControl.${t}`);e.setAttribute("aria-label",t),e.firstElementChild&&e.firstElementChild.setAttribute("title",t)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e=e||(this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||re.config.ACCESS_TOKEN}];var t;e&&(t=i.reduce((e,t,r)=>(t.value&&(e+=`${t.key}=${t.value}${r<i.length-1?"&":""}`),e),"?"),e.href=`${re.config.FEEDBACK_URL}/${t}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback"))}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(this._map.style){let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(e=>"string"!=typeof e?"":e)):"string"==typeof this.options.customAttribution&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const e=this._map.style._sourceCaches;for(const t in e){const r=e[t];if(r.used){const e=r.getSource();e.attribution&&i.indexOf(e.attribution)<0&&i.push(e.attribution)}}i.sort((e,t)=>e.length-t.length),i=i.filter((t,r)=>{for(let e=r+1;e<i.length;e++)if(0<=i[e].indexOf(t))return!1;return!0});const t=i.join(" | ");t!==this._attribHTML&&(this._attribHTML=t,i.length?(this._innerContainer.innerHTML=t,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class nn{constructor(){re.bindAll(["_updateLogo"],this),re.bindAll(["_updateCompact"],this)}onAdd(e){this._map=e,this._container=f.create("div","mapboxgl-ctrl");const t=f.create("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){f.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const r=e[t].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){var e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class an{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,r=t?this._queue.concat(t):this._queue;for(const t of r)if(t.id===e)return void(t.cancelled=!0)}run(e=0){var t=this._currentlyRunning=this._queue;this._queue=[];for(const r of t)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sn(e,t,r){var i,n,a,s,o;for(e=new re.LngLat(e.lng,e.lat),t&&(i=new re.LngLat(e.lng-360,e.lat),n=new re.LngLat(e.lng+360,e.lat),a=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),s=r.locationPoint(e).distSqr(t),o=t.x<0||t.y<0||t.x>r.width||t.y>r.height,r.locationPoint(i).distSqr(t)<s&&(o||Math.abs(i.lng-r.center.lng)<a)?e=i:r.locationPoint(n).distSqr(t)<s&&(o||Math.abs(n.lng-r.center.lng)<a)&&(e=n));180<Math.abs(e.lng-r.center.lng);){const re=r.locationPoint(e);if(0<=re.x&&0<=re.y&&re.x<=r.width&&re.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const on={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ln extends re.Evented{constructor(e,t){if(super(),(e instanceof re.window.HTMLElement||t)&&(e=re.extend({element:e},t)),re.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=re.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=f.create("div"),this._element.setAttribute("aria-label","Map marker");const t=f.createNS("http://www.w3.org/2000/svg","svg"),r=41;t.setAttributeNS(null,"display","block"),t.setAttributeNS(null,"height","41px"),t.setAttributeNS(null,"width","27px"),t.setAttributeNS(null,"viewBox","0 0 27 41");const i=f.createNS("http://www.w3.org/2000/svg","g");i.setAttributeNS(null,"stroke","none"),i.setAttributeNS(null,"stroke-width","1"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"fill-rule","evenodd");const n=f.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"fill-rule","nonzero");const a=f.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000");for(const re of[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}]){const e=f.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",re.rx),e.setAttributeNS(null,"ry",re.ry),a.appendChild(e)}const s=f.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill",this._color);const o=f.createNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),s.appendChild(o);const l=f.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"opacity","0.25"),l.setAttributeNS(null,"fill","#000000");const c=f.createNS("http://www.w3.org/2000/svg","path");c.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),l.appendChild(c);const h=f.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"transform","translate(6.0, 7.0)"),h.setAttributeNS(null,"fill","#FFFFFF");const u=f.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(8.0, 8.0)");const d=f.createNS("http://www.w3.org/2000/svg","circle");d.setAttributeNS(null,"fill","#000000"),d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"cx","5.5"),d.setAttributeNS(null,"cy","5.5"),d.setAttributeNS(null,"r","5.4999962");const p=f.createNS("http://www.w3.org/2000/svg","circle");p.setAttributeNS(null,"fill","#FFFFFF"),p.setAttributeNS(null,"cx","5.5"),p.setAttributeNS(null,"cy","5.5"),p.setAttributeNS(null,"r","5.4999962"),u.appendChild(d),u.appendChild(p),n.appendChild(a),n.appendChild(s),n.appendChild(l),n.appendChild(h),n.appendChild(u),t.appendChild(n),t.setAttributeNS(null,"height",41*this._scale+"px"),t.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(t),this._offset=re.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const r=this._element.classList;for(const re in on)r.remove(`mapboxgl-marker-anchor-${re}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return this.remove(),(this._map=e).getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),f.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=re.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){var t;return this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e&&("offset"in e.options||(t=Math.sqrt(Math.pow(13.5,2)/2),e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset),this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")),this}_onKeyPress(e){var t=e.code,e=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==e&&13!==e||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,r=this._element;this._popup&&(t===r||r.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e&&(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):(e.addTo(this._map),this._element.setAttribute("aria-expanded","true"))),this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(this._withinScreenBounds(t)){var r=this._map.unproject(t);let e=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const t=this._map.getFreeCameraOptions();if(t.position){const i=t.position.toLngLat();e=i.distanceTo(r)<.9*i.distanceTo(this._lngLat)}}const i=(1-this._map._queryFogOpacity(r))*(e?.2:1);this._element.style.opacity=`${i}`,this._popup&&this._popup._setOpacity(`${i}`),this._fadeTimer=null}else this._clearFadeTimer()}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(e){var t=this._map.transform;return!!e&&0<=e.x&&e.x<t.width&&0<=e.y&&e.y<t.height}_update(r){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=sn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(e=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let t="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?t="rotateX(0deg)":"map"===this._pitchAlignment&&(t=`rotateX(${this._map.getPitch()}deg)`),r&&"moveend"!==r.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&f.setTransform(this._element,`${on[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${t} ${e}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}}_transformedOffset(){if(!this._defaultMarker)return this._offset;const e=this._map.transform,t=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&t._rotate(e.angle),"map"===this._pitchAlignment&&(t.y*=Math.cos(e._pitch)),t}getOffset(){return this._offset}setOffset(e){return this._offset=re.pointGeometry.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const re=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=re}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new re.Event("dragstart"))),this.fire(new re.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new re.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class cn{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;e=re.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-e)+this._end*e}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,r){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+r}}const hn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:un,HTMLElement:dn,ImageBitmap:pn}=re.window,fn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function mn(e){e.parentNode&&e.parentNode.removeChild(e)}const gn={showCompass:!0,showZoom:!0,visualizePitch:!1};class _n{constructor(e,t,r=!1){this._clickTolerance=10,this.element=t,this.mouseRotate=new Ai({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new Ci({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),re.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener(t,"mousedown",this.mousedown),f.addEventListener(t,"touchstart",this.touchstart,{passive:!1}),f.addEventListener(t,"touchmove",this.touchmove),f.addEventListener(t,"touchend",this.touchend),f.addEventListener(t,"touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),f.disableDrag()}move(e,t){const r=this.map,i=this.mouseRotate.mousemoveWindow(e,t);if(i&&i.bearingDelta&&r.setBearing(r.getBearing()+i.bearingDelta),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t);i&&i.pitchDelta&&r.setPitch(r.getPitch()+i.pitchDelta)}}off(){var e=this.element;f.removeEventListener(e,"mousedown",this.mousedown),f.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),f.removeEventListener(e,"touchmove",this.touchmove),f.removeEventListener(e,"touchend",this.touchend),f.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){f.enableDrag(),f.removeEventListener(re.window,"mousemove",this.mousemove),f.removeEventListener(re.window,"mouseup",this.mouseup)}mousedown(e){this.down(re.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),f.mousePos(this.element,e)),f.addEventListener(re.window,"mousemove",this.mousemove),f.addEventListener(re.window,"mouseup",this.mouseup)}mousemove(e){this.move(e,f.mousePos(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=f.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=f.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let yn,xn=0,bn=!1;const wn={maxWidth:100,unit:"metric"};function Tn(e,t,r){const i=r&&r.maxWidth||100,n=e._container.getBoundingClientRect().height/2,a=e.unproject([0,n]),s=e.unproject([i,n]),o=a.distanceTo(s);if(r&&"imperial"===r.unit){const r=3.2808*o;5280<r?En(t,i,r/5280,e._getUIString("ScaleControl.Miles"),e):En(t,i,r,e._getUIString("ScaleControl.Feet"),e)}else r&&"nautical"===r.unit?En(t,i,o/1852,e._getUIString("ScaleControl.NauticalMiles"),e):1e3<=o?En(t,i,o/1e3,e._getUIString("ScaleControl.Kilometers"),e):En(t,i,o,e._getUIString("ScaleControl.Meters"),e)}function En(e,t,r,i,n){const a=function(e){var t,r=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/r;return i=10<=i?10:5<=i?5:3<=i?3:2<=i?2:1<=i?1:(t=i,e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10)),Math.round(t*e)/e),r*i}(r),s=a/r;n._requestDomTask(()=>{e.style.width=t*s+"px",e.innerHTML=`${a}&nbsp;${i}`})}const Sn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Mn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),An={version:re.version,supported:t,setRTLTextPlugin:re.setRTLTextPlugin,getRTLTextPluginStatus:re.getRTLTextPluginStatus,Map:class extends tn{constructor(e){if(null!=(e=re.extend({},fn,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&85<e.maxPitch)throw new Error("maxPitch must be less than or equal to 85");if(super(new ii(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._renderTaskQueue=new an,this._domRenderTaskQueue=new an,this._controls=[],this._markers=[],this._mapId=re.uniqueId(),this._locale=re.extend({},hn,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new cn(0),this._requestManager=new re.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=re.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof dn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),re.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==re.window&&(re.window.addEventListener("online",this._onWindowOnline,!1),re.window.addEventListener("resize",this._onWindowResize,!1),re.window.addEventListener("orientationchange",this._onWindowResize,!1),re.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Qi(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),this._hash=e.hash&&new ai("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,re.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),e.attributionControl&&this.addControl(new rn({customAttribution:e.customAttribution})),this._logoControl=new nn,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new re.Event(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new re.Event(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new re.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[t];return-1!==t.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new re.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var t=this._controls.indexOf(e);return-1<t&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return-1<this._controls.indexOf(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){var[t,r]=this._containerDimensions();if(t===this.transform.width&&r===this.transform.height)return this;this._resizeCanvas(t,r),this.transform.resize(t,r),this.painter.resize(Math.ceil(t),Math.ceil(r));r=!this._moving;return r&&this.fire(new re.Event("movestart",e)).fire(new re.Event("move",e)),this.fire(new re.Event("resize",e)),r&&this.fire(new re.Event("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(re.LngLatBounds.convert(e)),this._update()}setMinZoom(e){if(-2<=(e=null==e?-2:e)&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new re.Event("zoomstart")).fire(new re.Event("zoom")).fire(new re.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new re.Event("zoomstart")).fire(new re.Event("zoom")).fire(new re.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(0<=e&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new re.Event("pitchstart")).fire(new re.Event("pitch")).fire(new re.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if(85<(e=null==e?85:e))throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new re.Event("pitchstart")).fire(new re.Event("pitch")).fire(new re.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}getProjection(){return this.transform.getProjection()}setProjection(e){this._lazyInitEmptyStyle(),this._runtimeProjection=e="string"==typeof e?{name:e}:e,this.style.updateProjection()}project(e){return this.transform.locationPoint3D(re.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(re.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(i,n,a){if("mouseenter"===i||"mouseover"===i){let r=!1;return{layers:new Set(n),listener:a,delegates:{mousemove:e=>{var t=n.filter(e=>this.getLayer(e)),t=t.length?this.queryRenderedFeatures(e.point,{layers:t}):[];t.length?r||(r=!0,a.call(this,new fi(i,this,e.originalEvent,{features:t}))):r=!1},mouseout:()=>{r=!1}}}}if("mouseleave"===i||"mouseout"===i){let r=!1;return{layers:new Set(n),listener:a,delegates:{mousemove:e=>{var t=n.filter(e=>this.getLayer(e));(t.length?this.queryRenderedFeatures(e.point,{layers:t}):[]).length?r=!0:r&&(r=!1,a.call(this,new fi(i,this,e.originalEvent)))},mouseout:e=>{r&&(r=!1,a.call(this,new fi(i,this,e.originalEvent)))}}}}return{layers:new Set(n),listener:a,delegates:{[i]:e=>{var t=n.filter(e=>this.getLayer(e)),t=t.length?this.queryRenderedFeatures(e.point,{layers:t}):[];t.length&&(e.features=t,a.call(this,e),delete e.features)}}}}on(e,t,r){if(void 0===r)return super.on(e,t);Array.isArray(t)||(t=[t]);var i=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const e in i.delegates)this.on(e,i.delegates[e]);return this}once(e,t,r){if(void 0===r)return super.once(e,t);Array.isArray(t)||(t=[t]);var i=this._createDelegatedListener(e,t,r);for(const e in i.delegates)this.once(e,i.delegates[e]);return this}off(e,i,n){if(void 0===n)return super.off(e,i);i=new Set(Array.isArray(i)?i:[i]);const t=this._delegatedListeners?this._delegatedListeners[e]:void 0;return t&&(t=>{for(let e=0;e<t.length;e++){var r=t[e];if(r.listener===n&&((e,t)=>{if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0})(r.layers,i)){for(const t in r.delegates)this.off(t,r.delegates[t]);return t.splice(e,1)}}})(t),this}queryRenderedFeatures(e,t){return this.style?(void 0!==t||void 0===e||e instanceof re.pointGeometry||Array.isArray(e)||(t=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}queryTerrainElevation(e,t){const r=this.transform.elevation;return r?(t=re.extend({},{exaggerated:!0},t),r.getAtPoint(re.MercatorCoordinate.fromLngLat(e),null,t.exaggerated)):null}setStyle(e,t){return!1!==(t=re.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){var t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),e&&(this.style=new kt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new kt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,r){var t;"string"==typeof e?(t=this._requestManager.normalizeStyleURL(e),t=this._requestManager.transformRequest(t,re.ResourceType.Style),re.getJSON(t,(e,t)=>{e?this.fire(new re.ErrorEvent(e)):t&&this._updateDiff(t,r)})):"object"==typeof e&&this._updateDiff(e,r)}_updateDiff(t,r){try{this.style.setState(t)&&this._update(!0)}catch(e){re.warnOnce(`Unable to perform style diff: ${e.message||e.error||e}.  Rebuilding the style from scratch.`),this._updateStyle(t,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():re.warnOnce("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){const t=this.style&&this.style._getSourceCaches(e);if(0!==t.length)return t.every(e=>e.loaded());this.fire(new re.ErrorEvent(new Error(`There is no source with ID '${e}'`)))}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const i in e){var t=e[i]._tiles;for(const e in t){var r=t[e];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0}addSourceType(e,t,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(e,t,{pixelRatio:r=1,sdf:i=!1,stretchX:n,stretchY:a,content:s}={}){if(this._lazyInitEmptyStyle(),t instanceof un||pn&&t instanceof pn){var{width:o,height:l,data:c}=re.exported.getImageData(t);this.style.addImage(e,{data:new re.RGBAImage({width:o,height:l},c),pixelRatio:r,stretchX:n,stretchY:a,content:s,sdf:i,version:0})}else{if(void 0===t.width||void 0===t.height)return this.fire(new re.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:h,height:u,data:d}=t,p=t;this.style.addImage(e,{data:new re.RGBAImage({width:h,height:u},new Uint8Array(d)),pixelRatio:r,stretchX:n,stretchY:a,content:s,sdf:i,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e)}}}updateImage(e,t){const r=this.style.getImage(e);if(!r)return this.fire(new re.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var{width:i,height:n,data:a}=t instanceof un||pn&&t instanceof pn?re.exported.getImageData(t):t;return void 0===i||void 0===n?this.fire(new re.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):i!==r.data.width||n!==r.data.height?this.fire(new re.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(a,!(t instanceof un||pn&&t instanceof pn)),void this.style.updateImage(e,r))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new re.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,r){re.getImage(this._requestManager.transformRequest(e,re.ResourceType.Image),(e,t)=>{r(e,t instanceof un?re.exported.getImageData(t):t)})}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,r){return this.style.setLayerZoomRange(e,t,r),this._update(!0)}setFilter(e,t,r={}){return this.style.setFilter(e,t,r),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,r,i={}){return this.style.setPaintProperty(e,t,r,i),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,r,i={}){return this.style.setLayoutProperty(e,t,r,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(re.LngLat.convert(e),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300),[e,t]}_detectMissingCSS(){"rgb(250, 128, 114)"!==re.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&re.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=f.create("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=f.create("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=f.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);const i=this._controlContainer=f.create("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(e=>{n[e]=f.create("div",`mapboxgl-ctrl-${e}`,i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){var r=re.exported.devicePixelRatio||1;this._canvas.width=r*Math.ceil(e),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){e=this._markers.indexOf(e);-1!==e&&this._markers.splice(e,1)}_setupPainter(){var e=re.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e);e?(re.storeAuthState(e,!0),this.painter=new Gr(e,this.transform),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),re.exported$1.testSupport(e)):this.fire(new re.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new re.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new re.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let r;const i=this.painter.context.extTimerQuery,n=re.exported.now();this.listens("gpu-timing-frame")&&(r=i.createQueryEXT(),i.beginQueryEXT(i.TIME_ELAPSED_EXT,r));let a=this._updateAverageElevation(n);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),!this._removed){let e=!1;t=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const s=this.transform.zoom,r=this.transform.pitch,i=re.exported.now();this.style.zoomHistory.update(s,i);const n=new re.EvaluationParameters(s,{now:i,fadeDuration:t,pitch:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=n.crossFadingFactor();1===a&&a===this._crossFadingFactor||(e=!0,this._crossFadingFactor=a),this.style.update(n)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new re.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new re.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const s=re.exported.now()-n;i.endQueryEXT(i.TIME_ELAPSED_EXT,r),setTimeout(()=>{var e=i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r),this.fire(new re.Event("gpu-timing-frame",{cpuTime:s,gpuTime:e}))},50)}if(this.listens("gpu-timing-layer")){const s=this.painter.collectGpuTimers();setTimeout(()=>{var e=this.painter.queryGpuTimers(s);this.fire(new re.Event("gpu-timing-layer",{layerTimes:e}))},50)}t=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(t||this._repaint)this.triggerRepaint();else{const s=!this.isMoving()&&this.loaded();if(s&&(a=this._updateAverageElevation(n,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),s&&(this.fire(new re.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const s=this._calculateSpeedIndex();this.fire(new re.Event("speedindexcompleted",{speedIndex:s})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||t||(this._fullyLoaded=!0,this._authenticate()),this}}_forceMarkerUpdate(){for(const e of this._markers)e._update()}_updateAverageElevation(t,r=!1){var i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((r||500<t-this._averageElevationLastSampledAt)&&!this._averageElevation.isEasing(t)){const n=this.transform.averageElevation;let e=this.transform.sampleAverageElevation();isNaN(e)?e=0:this._averageElevationLastSampledAt=t;r=Math.abs(n-e);if(1<r){if(this._isInitialLoad)return this._averageElevation.jumpTo(e),i(e);this._averageElevation.easeTo(e,t,300)}else if(1e-4<r)return this._averageElevation.jumpTo(e),i(e)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){re.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===re.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;re.storeAuthState(e,!1),this._logoControl instanceof nn&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new re.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),re.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,i=r.createFramebuffer();function n(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);e=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,e),e}return r.bindFramebuffer(r.FRAMEBUFFER,i),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(r,i,n){let a=n[1]-n[0];var s=r.length/4;for(let e=0;e<i.length;e++){var o=i[e];let t=0;for(let e=0;e<o.length;e+=4)o[e]===r[e]&&o[e+1]===r[e+1]&&o[e+2]===r[e+2]&&o[e+3]===r[e+3]&&(t+=1);a+=(n[e+2]-n[e+1])*(1-t/s)}return a}remove(){this._hash&&this._hash.remove();for(const re of this._controls)re.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==re.window&&(re.window.removeEventListener("resize",this._onWindowResize,!1),re.window.removeEventListener("orientationchange",this._onWindowResize,!1),re.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),re.window.removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),mn(this._canvasContainer),mn(this._controlContainer),mn(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),re.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new re.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=re.exported.frame(e=>{var t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&((this._showCollisionBoxes=e)?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}_setCacheLimits(e,t){re.setCacheLimits(e,t)}get version(){return re.version}},NavigationControl:class{constructor(e){this.options=re.extend({},gn,e),this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(re.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),f.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),f.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(re.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=f.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),r=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _n(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){f.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const r=f.create("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(e,t){t=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",t),e.firstElementChild&&e.firstElementChild.setAttribute("title",t)}},GeolocateControl:class extends re.Evented{constructor(e){super(),this.options=re.extend({},vn,e),re.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=ni(this._updateMarkerRotation,20)}onAdd(e){var t;return this._map=e,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,void 0!==yn?t(yn):void 0!==re.window.navigator.permissions?re.window.navigator.permissions.query({name:"geolocation"}).then(e=>{yn="denied"!==e.state,t(yn)}):(yn=!!re.window.navigator.geolocation,t(yn)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(re.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),f.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xn=0,bn=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),r=e.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new re.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new re.Event("geolocate",e)),this._finish()}}_updateCamera(e){const t=new re.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),n=re.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),n,{geolocateSource:!0})}_updateMarker(e){var t;e?(t=new re.LngLat(e.coords.longitude,e.coords.latitude),this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()):(this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove())}_updateCircleRadius(){const e=this._map._container.getBoundingClientRect().height/2,t=this._map.unproject([0,e]),r=this._map.unproject([100,e]),i=t.distanceTo(r)/100,n=Math.ceil(2*this._accuracy/i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const re=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",re),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",re),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&bn)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new re.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=f.create("button","mapboxgl-ctrl-geolocate",this._container),f.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),!(this._geolocateButton.type="button")===e){re.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const re=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",re),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",re)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=f.create("div","mapboxgl-user-location"),this._dotElement.appendChild(f.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(f.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ln({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=f.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ln({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new re.Event("trackuserlocationend")))})}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return re.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new re.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xn--,bn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new re.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new re.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xn++,bn=1<xn?(e={maximumAge:6e5,timeout:0},!0):(e=this.options.positionOptions,!1),this._geolocationWatchID=re.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else re.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{re.window.addEventListener("ondeviceorientationabsolute"in re.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==re.window.DeviceMotionEvent&&"function"==typeof re.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&t()}).catch(console.error):t()}_clearWatch(){re.window.navigator.geolocation.clearWatch(this._geolocationWatchID),re.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),re.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:rn,ScaleControl:class{constructor(e){this.options=re.extend({},wn,e),re.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Tn(this._map,this._container,this.options)}onAdd(e){return this._map=e,this._container=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){f.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(e){this.options.unit=e,Tn(this._map,this._container,this.options)}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof re.window.HTMLElement?this._container=e.container:re.warnOnce("Full screen control 'container' must be a DOM element.")),re.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in re.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in re.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=f.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",re.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){f.remove(this._controlContainer),this._map=null,re.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!re.window.document.fullscreenEnabled&&!re.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=f.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);f.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),re.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){var e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(re.window.document.fullscreenElement||re.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?re.window.document.exitFullscreen?re.window.document.exitFullscreen():re.window.document.webkitCancelFullScreen&&re.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends re.Evented{constructor(e){super(),this.options=re.extend(Object.create(Sn),e),re.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new re.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&f.remove(this._content),this._container&&(f.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new re.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=re.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(re.window.document.createTextNode(e))}setHTML(e){const t=re.window.document.createDocumentFragment(),r=re.window.document.createElement("body");var i;for(r.innerHTML=e;i=r.firstChild;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=f.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._container&&this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._container&&this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return t=!this._classList.delete(e)&&(this._classList.add(e),!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=f.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(e){this._update(e.point)}_onMouseMove(e){this._update(e.point)}_onDrag(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;var t=this._pos,r=this._container.offsetWidth,i=this._container.offsetHeight;let n;return n=t.y+e.bottom.y<i?["top"]:t.y>this._map.transform.height-i?["bottom"]:[],t.x<r/2?n.push("left"):t.x>this._map.transform.width-r/2&&n.push("right"),0===n.length?"bottom":n.join("-")}_updateClassList(){const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),this._container.className=e.join(" ")}_update(e){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=f.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=f.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sn(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e){const t=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),r=function(e){if("number"==typeof(e=e||new re.pointGeometry(0,0))){var t=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new re.pointGeometry(0,0),top:new re.pointGeometry(0,e),"top-left":new re.pointGeometry(t,t),"top-right":new re.pointGeometry(-t,t),bottom:new re.pointGeometry(0,-e),"bottom-left":new re.pointGeometry(t,-t),"bottom-right":new re.pointGeometry(-t,-t),left:new re.pointGeometry(e,0),right:new re.pointGeometry(-e,0)}}if(e instanceof re.pointGeometry||Array.isArray(e)){t=re.pointGeometry.convert(e);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:re.pointGeometry.convert(e.center||[0,0]),top:re.pointGeometry.convert(e.top||[0,0]),"top-left":re.pointGeometry.convert(e["top-left"]||[0,0]),"top-right":re.pointGeometry.convert(e["top-right"]||[0,0]),bottom:re.pointGeometry.convert(e.bottom||[0,0]),"bottom-left":re.pointGeometry.convert(e["bottom-left"]||[0,0]),"bottom-right":re.pointGeometry.convert(e["bottom-right"]||[0,0]),left:re.pointGeometry.convert(e.left||[0,0]),right:re.pointGeometry.convert(e.right||[0,0])}}(this.options.offset),i=this._anchor=this._getAnchor(r),n=t.add(r[i]).round();this._map._requestDomTask(()=>{this._container&&i&&f.setTransform(this._container,`${on[i]} translate(${n.x}px,${n.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(this.options.focusAfterOpen&&this._container){const e=this._container.querySelector(Mn);e&&e.focus()}}_onClose(){this.remove()}_setOpacity(e){this._content&&(this._content.style.opacity=e),this._tip&&(this._tip.style.opacity=e)}},Marker:ln,Style:kt,LngLat:re.LngLat,LngLatBounds:re.LngLatBounds,Point:re.pointGeometry,MercatorCoordinate:re.MercatorCoordinate,FreeCameraOptions:Xr,Evented:re.Evented,config:re.config,prewarm:function(){Re().acquire(Le)},clearPrewarmedResources:function(){const e=Ie;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Le),Ie=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return re.config.ACCESS_TOKEN},set accessToken(e){re.config.ACCESS_TOKEN=e},get baseApiUrl(){return re.config.API_URL},set baseApiUrl(e){re.config.API_URL=e},get workerCount(){return Pe.workerCount},set workerCount(e){Pe.workerCount=e},get maxParallelImageRequests(){return re.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){re.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){re.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:re.exported.setNow,restoreNow:re.exported.restoreNow};return An}),s)}();var mapboxGl=mapboxGl$1.exports;class marker extends mapboxGl$1.exports.Evented{constructor(e){super();var e=e["element"];this._marker=new mapboxGl$1.exports.Marker({element:e}),bindAll(["_onClick","_onMouseEnter","_onMouseLeave"],this)}addTo(e){const t=this._marker,r=t.getElement();return t.addTo(e.map),r.addEventListener("click",this._onClick),r.addEventListener("mouseenter",this._onMouseEnter),r.addEventListener("mouseleave",this._onMouseLeave),r.addEventListener("mousemove",this._onMouseMove),this}remove(){const e=this._marker,t=e.getElement();return t.removeEventListener("click",this._onClick),t.removeEventListener("mouseenter",this._onMouseEnter),t.removeEventListener("mouseleave",this._onMouseLeave),t.removeEventListener("mousemove",this._onMouseMove),e.remove(),this}setLngLat(e){return this._marker.setLngLat(e),this}setActivity(e){const t=this._marker.getElement()["classList"];return e?t.add("active"):t.remove("active"),this}setVisibility(e){return this._marker.getElement().style.visibility=e?"visible":"hidden",this}_onClick(e){this.fire({type:"click"}),e.stopPropagation()}_onMouseEnter(){this.fire({type:"mouseenter"})}_onMouseLeave(){this.fire({type:"mouseleave"})}_onMouseMove(e){e.stopPropagation()}}function assert$9(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const globals$4={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},global_$3=globals$4.global||globals$4.self||globals$4.window||{},isBrowser$6="object"!=typeof process||"[object process]"!==String(process)||process.browser,matches$2="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);matches$2&&parseFloat(matches$2[1]);const VERSION$3="3.0.10";function assert$8(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"object"!=typeof process||String(process);const isMobile$1="undefined"!=typeof window&&void 0!==window.orientation,matches$1="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}matches$1&&parseFloat(matches$1[1]);class WorkerJob{constructor(e,t){_defineProperty(this,"name",void 0),_defineProperty(this,"workerThread",void 0),_defineProperty(this,"isRunning",void 0),_defineProperty(this,"result",void 0),_defineProperty(this,"_resolve",void 0),_defineProperty(this,"_reject",void 0),this.name=e,this.workerThread=t,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){assert$8(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){assert$8(this.isRunning),this.isRunning=!1,this._reject(e)}}const workerURLCache=new Map;function getLoadableWorkerURL(e){assert$8(e.source&&!e.url||!e.source&&e.url);let t=workerURLCache.get(e.source||e.url);return t||(e.url&&(t=getLoadableWorkerURLFromURL(e.url),workerURLCache.set(e.url,t)),e.source&&(t=getLoadableWorkerURLFromSource(e.source),workerURLCache.set(e.source,t))),assert$8(t),t}function getLoadableWorkerURLFromURL(e){return e.startsWith("http")?getLoadableWorkerURLFromSource(buildScriptSource(e)):e}function getLoadableWorkerURLFromSource(e){e=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(e)}function buildScriptSource(e){return`\
try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function getTransferList(e,t=!0,r){const i=r||new Set;if(e){if(isTransferable(e))i.add(e);else if(isTransferable(e.buffer))i.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&"object"==typeof e)for(const n in e)getTransferList(e[n],t,i)}else;return void 0===r?Array.from(i):[]}function isTransferable(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const NOOP$1=()=>{};class WorkerThread{static isSupported(){return"undefined"!=typeof Worker}constructor(e){_defineProperty(this,"name",void 0),_defineProperty(this,"source",void 0),_defineProperty(this,"url",void 0),_defineProperty(this,"terminated",!1),_defineProperty(this,"worker",void 0),_defineProperty(this,"onMessage",void 0),_defineProperty(this,"onError",void 0),_defineProperty(this,"_loadableURL","");var{name:t,source:r,url:e}=e;assert$8(r||e),this.name=t,this.source=r,this.url=e,this.onMessage=NOOP$1,this.onError=e=>console.log(e),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=NOOP$1,this.onError=NOOP$1,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||getTransferList(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=getLoadableWorkerURL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}}class WorkerPool{constructor(e){_defineProperty(this,"name","unnamed"),_defineProperty(this,"source",void 0),_defineProperty(this,"url",void 0),_defineProperty(this,"maxConcurrency",1),_defineProperty(this,"maxMobileConcurrency",1),_defineProperty(this,"onDebug",()=>{}),_defineProperty(this,"reuseWorkers",!0),_defineProperty(this,"props",{}),_defineProperty(this,"jobQueue",[]),_defineProperty(this,"idleQueue",[]),_defineProperty(this,"count",0),_defineProperty(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(t,r=(e,t,r)=>e.done(r),i=(e,t)=>e.error(t)){var e=new Promise(e=>(this.jobQueue.push({name:t,onMessage:r,onError:i,onStart:e}),this));return this._startQueuedJob(),e}async _startQueuedJob(){if(this.jobQueue.length){const e=this._getAvailableWorker();if(e){const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new WorkerJob(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(0<this.idleQueue.length)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new WorkerThread({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return isMobile$1?this.maxMobileConcurrency:this.maxConcurrency}}const DEFAULT_PROPS$2={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class WorkerFarm{static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(e={}){return WorkerFarm._workerFarm=WorkerFarm._workerFarm||new WorkerFarm({}),WorkerFarm._workerFarm.setProps(e),WorkerFarm._workerFarm}constructor(e){_defineProperty(this,"props",void 0),_defineProperty(this,"workerPools",new Map),this.props={...DEFAULT_PROPS$2},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){var{name:t,source:r,url:e}=e;let i=this.workerPools.get(t);return i||(i=new WorkerPool({name:t,source:r,url:e}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}_defineProperty(WorkerFarm,"_workerFarm",void 0);const NPM_TAG="latest";function getWorkerURL(t,r={}){var e=r[t.id]||{},i=`${t.id}-worker.js`;let n=e.workerUrl;if("test"===r._workerType&&(n=`modules/${t.module}/dist/${i}`),!n){let e=t.version;"latest"===e&&(e=NPM_TAG);r=e?`@${e}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${r}/dist/${i}`}return assert$8(n),n}function validateWorkerVersion(e,t=VERSION$3){assert$8(e,"no worker provided");e=e.version;return!(!t||!e)}function canParseWithWorker(e,t){return!!WorkerFarm.isSupported()&&(e.worker&&(null==t?void 0:t.worker))}async function parseWithWorker(e,t,r,i,n){var a=e.id,e=getWorkerURL(e,r);const s=WorkerFarm.getWorkerFarm(r),o=s.getWorkerPool({name:a,url:e});r=JSON.parse(JSON.stringify(r));const l=await o.startJob("process-on-worker",onMessage.bind(null,n));return l.postMessage("process",{input:t,options:r}),(await l.result).result}async function onMessage(e,t,r,i){switch(r){case"done":t.done(i);break;case"error":t.error(i.error);break;case"process":var{id:n,input:a,options:s}=i;try{var o=await e(a,s);t.postMessage("done",{id:n,result:o})}catch(e){o=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:n,error:o})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function toArrayBuffer$1(e){return Buffer.isBuffer(e)?new Uint8Array(e).buffer:e}function toArrayBuffer(e){if((e=toArrayBuffer$1?toArrayBuffer$1(e):e)instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){var t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function compareArrayBuffers(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;var i=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==n[e])return!1;return!0}function concatenateArrayBuffers(...e){const t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e);e=t.reduce((e,t)=>e+t.byteLength,0);const r=new Uint8Array(e);let i=0;for(const n of t)r.set(n,i),i+=n.byteLength;return r.buffer}async function concatenateArrayBuffersAsync(e){const t=[];for await(const r of e)t.push(r);return concatenateArrayBuffers(...t)}function getHiResTimestamp$1(){let e;var t;return e="undefined"!=typeof window&&window.performance?window.performance.now():"undefined"!=typeof process&&process.hrtime?1e3*(t=process.hrtime())[0]+t[1]/1e6:Date.now(),e}class Stat{constructor(e,t){this.name=e,this.type=t,this.sampleSize=1,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=getHiResTimestamp$1(),this._timerPending=!0,this}timeEnd(){return this._timerPending&&(this.addTime(getHiResTimestamp$1()-this._startTime),this._timerPending=!1,this._checkSampling()),this}getSampleAverageCount(){return 0<this.sampleSize?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return 0<this.sampleSize?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return 0<this.lastSampleTime?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return 0<this.samples?this.count/this.samples:0}getAverageTime(){return 0<this.samples?this.time/this.samples:0}getHz(){return 0<this.time?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Stats{constructor({id:e,stats:t}){this.id=e,this.stats={},this._initializeStats(t),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(e=[]){e.forEach(e=>this._getOrCreate(e))}_getOrCreate(e){if(!e||!e.name)return null;var{name:t,type:r}=e;return this.stats[t]||(e instanceof Stat?this.stats[t]=e:this.stats[t]=new Stat(t,r)),this.stats[t]}}let pathPrefix$1="";const fileAliases={};function resolvePath(e){for(const r in fileAliases){var t;e.startsWith(r)&&(t=fileAliases[r],e=e.replace(r,t))}return e=!e.startsWith("http://")&&!e.startsWith("https://")?`${pathPrefix$1}${e}`:e}const isBoolean=e=>"boolean"==typeof e,isFunction=e=>"function"==typeof e,isObject$4=e=>null!==e&&"object"==typeof e,isPureObject=e=>isObject$4(e)&&e.constructor==={}.constructor,isIterable=e=>e&&"function"==typeof e[Symbol.iterator],isAsyncIterable$1=e=>e&&"function"==typeof e[Symbol.asyncIterator],isResponse=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,isBlob=e=>"undefined"!=typeof Blob&&e instanceof Blob,isReadableDOMStream=e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||isObject$4(e)&&isFunction(e.tee)&&isFunction(e.cancel)&&isFunction(e.getReader),isBuffer=e=>e&&"object"==typeof e&&e.isBuffer,isReadableNodeStream=e=>isObject$4(e)&&isFunction(e.read)&&isFunction(e.pipe)&&isBoolean(e.readable),isReadableStream=e=>isReadableDOMStream(e)||isReadableNodeStream(e),DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function parseMIMEType(e){var t=MIME_TYPE_PATTERN.exec(e);return t?t[1]:e}function parseMIMETypeFromURL(e){e=DATA_URL_PATTERN.exec(e);return e?e[1]:""}const QUERY_STRING_PATTERN=/\?.*/;function getResourceUrlAndType(e){if(isResponse(e)){var t=stripQueryString(e.url||"");return{url:t,type:parseMIMEType(e.headers.get("content-type")||"")||parseMIMETypeFromURL(t)}}return isBlob(e)?{url:stripQueryString(e.name||""),type:e.type||""}:"string"==typeof e?{url:stripQueryString(e),type:parseMIMETypeFromURL(e)}:{url:"",type:""}}function getResourceContentLength(e){return isResponse(e)?e.headers["content-length"]||-1:isBlob(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function stripQueryString(e){return e.replace(QUERY_STRING_PATTERN,"")}async function makeResponse(e){if(isResponse(e))return e;const t={};var r=getResourceContentLength(e);0<=r&&(t["content-length"]=String(r));var{url:i,type:r}=getResourceUrlAndType(e);r&&(t["content-type"]=r);r=await getInitialDataUrl(e);r&&(t["x-first-bytes"]=r),"string"==typeof e&&(e=(new TextEncoder).encode(e));e=new Response(e,{headers:t});return Object.defineProperty(e,"url",{value:i}),e}async function checkResponse(e){if(!e.ok){e=await getResponseError(e);throw new Error(e)}}async function getResponseError(t){let r=`Failed to fetch resource ${t.url} (${t.status}): `;try{const i=t.headers.get("Content-Type");let e=t.statusText;i.includes("application/json")&&(e+=` ${await t.text()}`),r+=e,r=60<r.length?`${r.slice(60)}...`:r}catch(e){}return r}async function getInitialDataUrl(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return new Promise(r=>{const e=new FileReader;e.onload=e=>{var t;return r(null==e||null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(t)})}return e instanceof ArrayBuffer?`data:base64,${arrayBufferToBase64(e.slice(0,5))}`:null}function arrayBufferToBase64(e){let t="";var r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}async function fetchFile(t,r){if("string"!=typeof t)return makeResponse(t);{t=resolvePath(t);let e=r;return null!=r&&r.fetch&&"function"!=typeof(null==r?void 0:r.fetch)&&(e=r.fetch),fetch(t,e)}}function isElectron$2(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;var t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;const r=e||t;return!!(r&&0<=r.indexOf("Electron"))}function isBrowser$5(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||isElectron$2()}const globals$3={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},window_$2=globals$3.window||globals$3.self||globals$3.global,process_$1=globals$3.process||{},VERSION$2="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",isBrowser$4=isBrowser$5();function getStorage(e){try{const r=window[e];var t="__storage_test__";return r.setItem(t,t),r.removeItem(t),r}catch(e){return null}}class LocalStorage{constructor(e,t,r="sessionStorage"){this.storage=getStorage(r),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){return Object.assign(this.config,e),this.storage&&(e=JSON.stringify(this.config),this.storage.setItem(this.id,e)),this}_loadConfiguration(){let e={};var t;return this.storage&&(t=this.storage.getItem(this.id),e=t?JSON.parse(t):{}),Object.assign(this.config,e),this}}function formatTime(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}function leftPad(e,t=8){t=Math.max(t-e.length,0);return"".concat(" ".repeat(t)).concat(e)}function formatImage(e,t,r,i=600){var n=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(r=Math.min(r,i/e.width));i=e.width*r,r=e.height*r,r=["font-size:1px;","padding:".concat(Math.floor(r/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(r,"px;"),"background:url(".concat(n,");"),"background-size:".concat(i,"px ").concat(r,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),r]}const COLOR={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function getColor(e){return"string"==typeof e?COLOR[e.toUpperCase()]||COLOR.WHITE:e}function addColor(e,t,r){return isBrowser$4||"string"!=typeof e||(t&&(t=getColor(t),e="[".concat(t,"m").concat(e,"[39m")),r&&(t=getColor(r),e="[".concat(r+10,"m").concat(e,"[49m"))),e}function autobind(e,t=["constructor"]){var r=Object.getPrototypeOf(e);for(const i of Object.getOwnPropertyNames(r))"function"==typeof e[i]&&(t.find(e=>i===e)||(e[i]=e[i].bind(e)))}function assert$7(e,t){if(!e)throw new Error(t||"Assertion failed")}function getHiResTimestamp(){let e;var t;return e=isBrowser$4&&window_$2.performance?window_$2.performance.now():process_$1.hrtime?1e3*(t=process_$1.hrtime())[0]+t[1]/1e6:Date.now(),e}const originalConsole={debug:isBrowser$4&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DEFAULT_SETTINGS$1={enabled:!0,level:0};function noop$4(){}const cache$1={},ONCE={once:!0};function getTableHeader(e){for(const t in e)for(const r in e[t])return r||"untitled";return"empty"}class Log{constructor({id:e}={id:""}){this.id=e,this.VERSION=VERSION$2,this._startTs=getHiResTimestamp(),this._deltaTs=getHiResTimestamp(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new LocalStorage("__probe-".concat(this.id,"__"),DEFAULT_SETTINGS$1),this.userData={},this.timeStamp("".concat(this.id," started")),autobind(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((getHiResTimestamp()-this._startTs).toPrecision(10))}getDelta(){return Number((getHiResTimestamp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}assert(e,t){assert$7(e,t)}warn(e){return this._getLogFunction(0,e,originalConsole.warn,arguments,ONCE)}error(e){return this._getLogFunction(0,e,originalConsole.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,originalConsole.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,originalConsole.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,originalConsole.debug||originalConsole.info,arguments,ONCE)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||noop$4,r&&[r],{tag:getTableHeader(t)}):noop$4}image({logLevel:e,priority:t,image:r,message:i="",scale:n=1}){return this._shouldLog(e||t)?(isBrowser$4?logImageInBrowser:logImageInNode)({image:r,message:i,scale:n}):noop$4}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}time(e,t){return this._getLogFunction(e,t,console.time||console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd||console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||noop$4)}group(e,t,r={collapsed:!1}){var t=(r=normalizeArguments({logLevel:e,message:t,opts:r}))["collapsed"];return r.method=(t?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||noop$4)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=normalizeLogLevel(e)}_getLogFunction(e,t,r,i=[],n){if(this._shouldLog(e)){n=normalizeArguments({logLevel:e,message:t,args:i,opts:n}),assert$7(r=r||n.method),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=getHiResTimestamp();i=n.tag||n.message;if(n.once){if(cache$1[i])return noop$4;cache$1[i]=getHiResTimestamp()}return t=decorateMessage(this.id,n.message,n),r.bind(console,t,...n.args)}return noop$4}}function normalizeLogLevel(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return assert$7(Number.isFinite(t)&&0<=t),t}function normalizeArguments(e){var{logLevel:t,message:r}=e;e.logLevel=normalizeLogLevel(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==r;);switch(e.args=i,typeof t){case"string":case"function":void 0!==r&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var n=typeof e.message;return assert$7("string"==n||"object"==n),Object.assign(e,e.opts)}function decorateMessage(e,t,r){var i;return"string"==typeof t&&(i=r.time?leftPad(formatTime(r.total)):"",t=addColor(t=(r.time?"".concat(e,": ").concat(i,"  "):"".concat(e,": ")).concat(t),r.color,r.background)),t}function logImageInNode({image:e,scale:t=1}){let r=null;try{r=module.require("asciify-image")}catch(e){}return r?()=>r(e,{fit:"box",width:"".concat(Math.round(80*t),"%")}).then(e=>console.log(e)):noop$4}function logImageInBrowser({image:e,message:t="",scale:r=1}){if("string"==typeof e){const n=new Image;return n.onload=()=>{var e=formatImage(n,t,r);console.log(...e)},n.src=e,noop$4}const i=e.nodeName||"";if("img"===i.toLowerCase())return console.log(...formatImage(e,t,r)),noop$4;if("canvas"!==i.toLowerCase())return noop$4;{const a=new Image;return a.onload=()=>console.log(...formatImage(a,t,r)),a.src=e.toDataURL(),noop$4}}function getBrowser$3(e){if(!e&&!isBrowser$5())return"Node";if(isElectron$2(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{};const r=e||t.userAgent||"";if(-1<r.indexOf("Edge"))return"Edge";e=-1!==r.indexOf("MSIE "),t=-1!==r.indexOf("Trident/");return e||t?"IE":window_$2.chrome?"Chrome":window_$2.safari?"Safari":window_$2.mozInnerScreenX?"Firefox":"Unknown"}Log.VERSION=VERSION$2;const probeLog=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ConsoleLog{constructor(){_defineProperty(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){global_$3.loaders=global_$3.loaders||{};const e=global_$3["loaders"];return e._state=e._state||{},e._state}const getGlobalLoaderOptions=()=>{const e=getGlobalLoaderState();return e.globalOptions=e.globalOptions||{...DEFAULT_LOADER_OPTIONS},e.globalOptions};function normalizeOptions(e,t,r,i){return r=r||[],validateOptions(e,r=Array.isArray(r)?r:[r]),normalizeOptionsInternal(t,e,i)}function getFetchFunction(e,t){var r=getGlobalLoaderOptions();const i=e||r;return"function"==typeof i.fetch?i.fetch:isObject$4(i.fetch)?e=>fetchFile(e,i):null!=t&&t.fetch?null==t?void 0:t.fetch:fetchFile}function validateOptions(e,t){validateOptionsObject(e,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,t);for(const a of t){var r=e&&e[a.id]||{},i=a.options&&a.options[a.id]||{},n=a.deprecatedOptions&&a.deprecatedOptions[a.id]||{};validateOptionsObject(r,a.id,i,n,t)}}function validateOptionsObject(e,t,r,i,n){var a=t||"Top level",s=t?`${t}.`:"";for(const h in e){var o=!t&&isObject$4(e[h]),l="baseUri"===h&&!t,c="workerUrl"===h&&t;h in r||l||c||(h in i?probeLog.warn(`${a} loader option \'${s}${h}\' no longer supported, use \'${i[h]}\'`)():o||(o=findSimilarOption(h,n),probeLog.warn(`${a} loader option \'${s}${h}\' not recognized. ${o}`)()))}}function findSimilarOption(e,t){const r=e.toLowerCase();let i="";for(const n of t)for(const a in n.options){if(e===a)return`Did you mean \'${n.id}.${a}\'?`;const s=a.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(i=i||`Did you mean \'${n.id}.${a}\'?`)}return i}function normalizeOptionsInternal(e,t,r){const i={...e.options||{}};return addUrlOptions(i,r),null===i.log&&(i.log=new NullLog),mergeNestedFields(i,getGlobalLoaderOptions()),mergeNestedFields(i,t),i}function mergeNestedFields(e,t){for(const i in t){var r;i in t&&(r=t[i],isPureObject(r)&&isPureObject(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i])}}function addUrlOptions(e,t){!t||"baseUri"in e||(e.baseUri=t)}function isLoaderObject(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===e||void 0===e?void 0:e.extensions))}function normalizeLoader(e){var t;return assert$9(e,"null loader"),assert$9(isLoaderObject(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(null!==e&&void 0!==e&&e.parseTextSync||null!==e&&void 0!==e&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const getGlobalLoaderRegistry=()=>{const e=getGlobalLoaderState();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function registerLoaders(e){const t=getGlobalLoaderRegistry();for(const r of e=Array.isArray(e)?e:[e]){const i=normalizeLoader(r);t.find(e=>i===e)||t.unshift(i)}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}const EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(e,t=[],r,i){if(!validHTTPResponse(e))return null;let n=selectLoaderSync(e,t,{...r,nothrow:!0},i);if(n)return n;if(isBlob(e)&&(e=await e.slice(0,10).arrayBuffer(),n=selectLoaderSync(e,t,r,i)),!(n||null!=r&&r.nothrow))throw new Error(getNoValidLoaderMessage(e));return n}function selectLoaderSync(e,t=[],r,i){if(!validHTTPResponse(e))return null;if(t&&!Array.isArray(t))return normalizeLoader(t);let n=[];t&&(n=n.concat(t)),null!=r&&r.ignoreRegisteredLoaders||n.push(...getRegisteredLoaders()),normalizeLoaders(n);i=selectLoaderInternal(e,n,r,i);if(!(i||null!=r&&r.nothrow))throw new Error(getNoValidLoaderMessage(e));return i}function selectLoaderInternal(e,t,r,i){var{url:n,type:a}=getResourceUrlAndType(e),i=n||(null==i?void 0:i.url);let s=null;return null!=r&&r.mimeType&&(s=findLoaderByMIMEType(t,null==r?void 0:r.mimeType)),s=s||findLoaderByUrl(t,i),s=s||findLoaderByMIMEType(t,a),s=s||findLoaderByInitialBytes(t,e),s=s||findLoaderByMIMEType(t,null==r?void 0:r.fallbackMimeType),s}function validHTTPResponse(e){return!(e instanceof Response&&204===e.status)}function getNoValidLoaderMessage(e){var{url:t,type:r}=getResourceUrlAndType(e);let i="No valid loader found";return e&&(i+=` data: "${getFirstCharacters(e)}", contentType: "${r}"`),t&&(i+=` url: ${t}`),i}function normalizeLoaders(e){for(const t of e)normalizeLoader(t)}function findLoaderByUrl(e,t){t=t&&EXT_PATTERN.exec(t),t=t&&t[1];return t?findLoaderByExtension(e,t):null}function findLoaderByExtension(e,t){t=t.toLowerCase();for(const r of e)for(const i of r.extensions)if(i.toLowerCase()===t)return r;return null}function findLoaderByMIMEType(e,t){for(const r of e){if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t===`application/x.${r.id}`)return r}return null}function findLoaderByInitialBytes(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(testDataAgainstText(t,r))return r}else if(ArrayBuffer.isView(t)){if(testDataAgainstBinary(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer)if(testDataAgainstBinary(t,0,r))return r;return null}function testDataAgainstText(t,e){if(e.testText)return e.testText(t);const r=Array.isArray(e.tests)?e.tests:[e.tests];return r.some(e=>t.startsWith(e))}function testDataAgainstBinary(t,r,i){const e=Array.isArray(i.tests)?i.tests:[i.tests];return e.some(e=>testBinary(t,r,i,e))}function testBinary(e,t,r,i){if(i instanceof ArrayBuffer)return compareArrayBuffers(i,e,i.byteLength);switch(typeof i){case"function":return i(e,r);case"string":return i===getMagicString(e,t,i.length);default:return!1}}function getFirstCharacters(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return getMagicString(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return getMagicString(e,0,t);return""}function getMagicString(e,t,r){if(e.byteLength<t+r)return"";const i=new DataView(e);let n="";for(let e=0;e<r;e++)n+=String.fromCharCode(i.getUint8(t+e));return n}const DEFAULT_CHUNK_SIZE$2=262144;function*makeStringIterator(e,t){var r=(null==t?void 0:t.chunkSize)||DEFAULT_CHUNK_SIZE$2;let i=0;const n=new TextEncoder;for(;i<e.length;){var a=Math.min(e.length-i,r),s=e.slice(i,i+a);i+=a,yield n.encode(s)}}const DEFAULT_CHUNK_SIZE$1=262144;function*makeArrayBufferIterator(e,t={}){var{chunkSize:r=DEFAULT_CHUNK_SIZE$1}=t;let i=0;for(;i<e.byteLength;){var n=Math.min(e.byteLength-i,r),a=new ArrayBuffer(n),s=new Uint8Array(e,i,n);const o=new Uint8Array(a);o.set(s),i+=n,yield a}}const DEFAULT_CHUNK_SIZE=1048576;async function*makeBlobIterator(e,t){var r=(null==t?void 0:t.chunkSize)||DEFAULT_CHUNK_SIZE;let i=0;for(;i<e.size;){var n=i+r,a=await e.slice(i,n).arrayBuffer();i=n,yield a}}function makeStreamIterator(e,t){return isBrowser$6?makeBrowserStreamIterator(e,t):makeNodeStreamIterator(e)}async function*makeBrowserStreamIterator(e,t){const r=e.getReader();let i;try{for(;;){var n=i||r.read();null!=t&&t._streamReadAhead&&(i=r.read());var{done:a,value:s}=await n;if(a)return;yield toArrayBuffer(s)}}catch(e){r.releaseLock()}}async function*makeNodeStreamIterator(e,t){for await(const r of e)yield toArrayBuffer(r)}function makeIterator(e,t){if("string"==typeof e)return makeStringIterator(e,t);if(e instanceof ArrayBuffer)return makeArrayBufferIterator(e,t);if(isBlob(e))return makeBlobIterator(e,t);if(isReadableStream(e))return makeStreamIterator(e,t);if(isResponse(e))return makeStreamIterator(e.body,t);throw new Error("makeIterator")}const ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(t,r,e){if(r.text&&"string"==typeof t)return t;if((t=isBuffer(t)?t.buffer:t)instanceof ArrayBuffer){var i=t;if(!r.text||r.binary)return i;{const n=new TextDecoder("utf8");return n.decode(i)}}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){const a=new TextDecoder("utf8");return a.decode(t)}let e=t.buffer;r=t.byteLength||t.length;return 0===t.byteOffset&&r===e.byteLength||(e=e.slice(t.byteOffset,t.byteOffset+r)),e}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(e,t,r){var i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return getArrayBufferOrStringFromDataSync(e,t);if(isBlob(e)&&(e=await makeResponse(e)),isResponse(e)){const n=e;return await checkResponse(n),t.binary?await n.arrayBuffer():await n.text()}if(isReadableStream(e)&&(e=makeIterator(e,r)),isIterable(e)||isAsyncIterable$1(e))return concatenateArrayBuffersAsync(e);throw new Error(ERR_DATA)}function getLoaderContext(e,t,r=null){if(r)return r;const i={fetch:getFetchFunction(t,e),...e};return Array.isArray(i.loaders)||(i.loaders=null),i}function getLoadersFromContext(e,t){if(!t&&e&&!Array.isArray(e))return e;let r;return e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders&&(t=Array.isArray(t.loaders)?t.loaders:[t.loaders],r=r?[...r,...t]:t),r&&r.length?r:null}async function parse(e,t,r,i){assert$8(!i||"object"==typeof i),!t||Array.isArray(t)||isLoaderObject(t)||(r=t,t=i=void 0),r=r||{};var n=getResourceUrlAndType(e=await e)["url"],a=getLoadersFromContext(t,i),t=await selectLoader(e,a,r);return t?parseWithLoader(t,e,r=normalizeOptions(r,t,a,n),i=getLoaderContext({url:n,parse:parse,loaders:a},r,i)):null}async function parseWithLoader(e,t,r,i){if(validateWorkerVersion(e),t=await getArrayBufferOrStringFromData(t,e,r),e.parseTextSync&&"string"==typeof t)return r.dataType="text",e.parseTextSync(t,r,i,e);if(canParseWithWorker(e,r))return parseWithWorker(e,t,r,i,parse);if(e.parseText&&"string"==typeof t)return e.parseText(t,r,i,e);if(e.parse)return e.parse(t,r,i,e);throw assert$8(!e.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function load(e,t,r,i){Array.isArray(t)||isLoaderObject(t)||(r=t,t=void 0);const n=getFetchFunction(r);let a=e;return"string"==typeof e&&(a=await n(e)),isBlob(e)&&(a=await n(e)),parse(a,t,r)}const VERSION$1="3.0.10";function assert$6(e,t){if(!e)throw new Error(t)}const globals$2={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},global_$2=globals$2.global||globals$2.self||globals$2.window,isBrowser$3="object"!=typeof process||"[object process]"!==String(process)||process.browser,matches="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);matches&&parseFloat(matches[1]);const _parseImageNode=global_$2["_parseImageNode"],IMAGE_SUPPORTED="undefined"!=typeof Image,IMAGE_BITMAP_SUPPORTED="undefined"!=typeof ImageBitmap,NODE_IMAGE_SUPPORTED=Boolean(_parseImageNode),DATA_SUPPORTED=!!isBrowser$3||NODE_IMAGE_SUPPORTED;function isImageTypeSupported(e){switch(e){case"auto":return IMAGE_BITMAP_SUPPORTED||IMAGE_SUPPORTED||DATA_SUPPORTED;case"imagebitmap":return IMAGE_BITMAP_SUPPORTED;case"image":return IMAGE_SUPPORTED;case"data":return DATA_SUPPORTED;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function getDefaultImageType(){if(IMAGE_BITMAP_SUPPORTED)return"imagebitmap";if(IMAGE_SUPPORTED)return"image";if(DATA_SUPPORTED)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function getImageType(e){e=getImageTypeOrNull(e);if(!e)throw new Error("Not an image");return e}function getImageData(e){switch(getImageType(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function getImageTypeOrNull(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}const SVG_DATA_URL_PATTERN=/^data:image\/svg\+xml/,SVG_URL_PATTERN=/\.svg((\?|#).*)?$/;function isSVG(e){return e&&(SVG_DATA_URL_PATTERN.test(e)||SVG_URL_PATTERN.test(e))}function getBlobOrSVGDataUrl(t,e){if(isSVG(e)){const r=new TextDecoder;let e=r.decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return getBlob(t,e)}function getBlob(e,t){if(isSVG(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function parseToImage(e,t,r){e=getBlobOrSVGDataUrl(e,r);const i=self.URL||self.webkitURL;r="string"!=typeof e&&i.createObjectURL(e);try{return await loadToImage(r||e,t)}finally{r&&i.revokeObjectURL(r)}}async function loadToImage(r,e){const i=new Image;return i.src=r,e.image&&e.image.decode&&i.decode?(await i.decode(),i):new Promise((e,t)=>{try{i.onload=()=>e(i),i.onerror=e=>t(new Error(`Could not load image ${r}: ${e}`))}catch(e){t(e)}})}const EMPTY_OBJECT={};let imagebitmapOptionsSupported=!0;async function parseToImageBitmap(e,t,r){let i;i=isSVG(r)?await parseToImage(e,t,r):getBlob(e,r);t=t&&t.imagebitmap;return safeCreateImageBitmap(i,t)}async function safeCreateImageBitmap(e,t=null){if(t=isEmptyObject(t)||!imagebitmapOptionsSupported?null:t)try{return createImageBitmap(e,t)}catch(e){console.warn(e),imagebitmapOptionsSupported=!1}return createImageBitmap(e)}function isEmptyObject(e){for(const t in e||EMPTY_OBJECT)return!1;return!0}const BIG_ENDIAN=!1,LITTLE_ENDIAN=!0;function getBinaryImageMetadata(e){e=toDataView(e);return getPngMetadata(e)||getJpegMetadata(e)||getGifMetadata(e)||getBmpMetadata(e)}function getPngMetadata(e){const t=toDataView(e);return 24<=t.byteLength&&2303741511===t.getUint32(0,BIG_ENDIAN)?{mimeType:"image/png",width:t.getUint32(16,BIG_ENDIAN),height:t.getUint32(20,BIG_ENDIAN)}:null}function getGifMetadata(e){const t=toDataView(e);return 10<=t.byteLength&&1195984440===t.getUint32(0,BIG_ENDIAN)?{mimeType:"image/gif",width:t.getUint16(6,LITTLE_ENDIAN),height:t.getUint16(8,LITTLE_ENDIAN)}:null}function getBmpMetadata(e){const t=toDataView(e);return 14<=t.byteLength&&16973===t.getUint16(0,BIG_ENDIAN)&&t.getUint32(2,LITTLE_ENDIAN)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,LITTLE_ENDIAN),height:t.getUint32(22,LITTLE_ENDIAN)}:null}function getJpegMetadata(e){const t=toDataView(e);if(!(3<=t.byteLength&&65496===t.getUint16(0,BIG_ENDIAN)&&255===t.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:i}=getJpegMarkers();let n=2;for(;n+9<t.byteLength;){var a=t.getUint16(n,BIG_ENDIAN);if(i.has(a))return{mimeType:"image/jpeg",height:t.getUint16(n+5,BIG_ENDIAN),width:t.getUint16(n+7,BIG_ENDIAN)};if(!r.has(a))return null;n+=2,n+=t.getUint16(n,BIG_ENDIAN)}return null}function getJpegMarkers(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}function toDataView(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}function parseToNodeImage(e,t){var r=(getBinaryImageMetadata(e)||{})["mimeType"];const i=global_$2["_parseImageNode"];return assert$6(i),i(e,r,t)}async function parseImage(e,t,r){var i=((t=t||{}).image||{}).type||"auto",n=(r||{})["url"];let a;switch(getLoadableImageType(i)){case"imagebitmap":a=await parseToImageBitmap(e,t,n);break;case"image":a=await parseToImage(e,t,n);break;case"data":a=await parseToNodeImage(e,t);break;default:assert$6(!1)}return"data"===i&&(a=getImageData(a)),a}function getLoadableImageType(e){switch(e){case"auto":case"data":return getDefaultImageType();default:return isImageTypeSupported(e),e}}const EXTENSIONS$1=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],MIME_TYPES=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],ImageLoader$1={id:"image",module:"images",name:"Images",version:VERSION$1,mimeTypes:MIME_TYPES,extensions:EXTENSIONS$1,parse:parseImage,tests:[e=>Boolean(getBinaryImageMetadata(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};var env$1={},interopRequireDefault={exports:{}};!function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0}(interopRequireDefault);var _typeof$1={exports:{}};!function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.default=t.exports,t.exports.__esModule=!0,r(e)}t.exports=r,t.exports.default=t.exports,t.exports.__esModule=!0}(_typeof$1);var globals$1={},_interopRequireDefault$3=interopRequireDefault.exports;Object.defineProperty(globals$1,"__esModule",{value:!0}),globals$1.console=globals$1.process=globals$1.document=globals$1.global=globals$1.window=globals$1.self=void 0;var _typeof2$2=_interopRequireDefault$3(_typeof$1.exports),globals={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==commonjsGlobal&&commonjsGlobal,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":(0,_typeof2$2.default)(process))&&process},self_=globals.self||globals.window||globals.global;globals$1.self=self_;var window_$1=globals.window||globals.self||globals.global;globals$1.window=window_$1;var global_$1=globals.global||globals.self||globals.window;globals$1.global=global_$1;var document_=globals.document||{};globals$1.document=document_;var process_=globals.process||{};globals$1.process=process_;var console_=console;globals$1.console=console_;var isBrowser$2={},isElectron$1={},_interopRequireDefault$2=interopRequireDefault.exports;Object.defineProperty(isElectron$1,"__esModule",{value:!0}),isElectron$1.default=isElectron;var _typeof2$1=_interopRequireDefault$2(_typeof$1.exports);function isElectron(e){if("undefined"!=typeof window&&"object"===(0,_typeof2$1.default)(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===(0,_typeof2$1.default)(process.versions)&&Boolean(process.versions.electron))return!0;var t="object"===("undefined"==typeof navigator?"undefined":(0,_typeof2$1.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,t=e||t;return!!(t&&0<=t.indexOf("Electron"))}var _interopRequireDefault$1=interopRequireDefault.exports;Object.defineProperty(isBrowser$2,"__esModule",{value:!0}),isBrowser$2.default=isBrowser$1,isBrowser$2.isBrowserMainThread=isBrowserMainThread;var _typeof2=_interopRequireDefault$1(_typeof$1.exports),_isElectron$1=_interopRequireDefault$1(isElectron$1);function isBrowser$1(){return!("object"===("undefined"==typeof process?"undefined":(0,_typeof2.default)(process))&&"[object process]"===String(process)&&!process.browser)||(0,_isElectron$1.default)()}function isBrowserMainThread(){return isBrowser$1()&&"undefined"!=typeof document}var getBrowser$2={},_interopRequireDefault=interopRequireDefault.exports;Object.defineProperty(getBrowser$2,"__esModule",{value:!0}),getBrowser$2.isMobile=isMobile,getBrowser$2.default=getBrowser$1;var _globals=globals$1,_isBrowser=_interopRequireDefault(isBrowser$2),_isElectron=_interopRequireDefault(isElectron$1);function isMobile(){return void 0!==_globals.window.orientation}function getBrowser$1(e){if(!e&&!(0,_isBrowser.default)())return"Node";if((0,_isElectron.default)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},e=e||t.userAgent||"";if(-1<e.indexOf("Edge"))return"Edge";t=-1!==e.indexOf("MSIE "),e=-1!==e.indexOf("Trident/");return t||e?"IE":_globals.window.chrome?"Chrome":_globals.window.safari?"Safari":_globals.window.mozInnerScreenX?"Firefox":"Unknown"}!function(e){var t=interopRequireDefault.exports,s=_typeof$1.exports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return r.self}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return r.window}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return r.global}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return r.document}}),Object.defineProperty(e,"process",{enumerable:!0,get:function(){return r.process}}),Object.defineProperty(e,"console",{enumerable:!0,get:function(){return r.console}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"isBrowserMainThread",{enumerable:!0,get:function(){return i.isBrowserMainThread}}),Object.defineProperty(e,"getBrowser",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"isMobile",{enumerable:!0,get:function(){return n.isMobile}}),Object.defineProperty(e,"isElectron",{enumerable:!0,get:function(){return a.default}});var r=globals$1,i=l(isBrowser$2),n=l(getBrowser$2),a=t(isElectron$1);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};t=o(t);if(t&&t.has(e))return t.get(e);var r,i,n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=a?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}}(env$1);var env=env$1,log$2=new Log({id:"deck"});let loggers={};function register(e){loggers=e}function debug(e){0<log$2.level&&loggers[e]&&loggers[e].call(...arguments)}function isJSON(e){var t=e[0],e=e[e.length-1];return"{"===t&&"}"===e||"["===t&&"]"===e}var jsonLoader={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:isJSON,parseTextSync:JSON.parse};const version="8.6.4",existingVersion=env.global.deck&&env.global.deck.VERSION;if(existingVersion&&existingVersion!==version)throw new Error("deck.gl - multiple versions detected: ".concat(existingVersion," vs ").concat(version));existingVersion||(log$2.log(1,"deck.gl ".concat(version))(),env.global.deck=Object.assign(env.global.deck||{},{VERSION:version,version:version,log:log$2,_registerLoggers:register}),registerLoaders([jsonLoader,[ImageLoader$1,{imagebitmap:{premultiplyAlpha:"none"}}]]));var deckGlobal=env.global.deck;const log$1=new Log({id:"luma.gl"});function assert$5(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const ERR_CONTEXT="Invalid WebGLRenderingContext",ERR_WEBGL2="Requires WebGL2";function isWebGL(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version)))}function isWebGL2$1(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function getWebGL2Context(e){return isWebGL2$1(e)?e:null}function assertWebGLContext(e){return assert$5(isWebGL(e),ERR_CONTEXT),e}function assertWebGL2Context(e){return assert$5(isWebGL2$1(e),ERR_WEBGL2),e}const glErrorShadow={};function error(e){env.global.console&&env.global.console.error&&env.global.console.error(e)}function log(e){env.global.console&&env.global.console.log&&env.global.console.log(e)}function synthesizeGLError(e,t){glErrorShadow[e]=!0,void 0!==t&&error(t)}function wrapGLError(t){const r=t.getError;t.getError=function(){let e;for(;e=r.apply(t),0!==e&&(glErrorShadow[e]=!0),0!==e;);for(e in glErrorShadow)if(glErrorShadow[e])return delete glErrorShadow[e],parseInt(e,10);return 0}}const WebGLVertexArrayObjectOES=function t(e){var r=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let e=0;e<this.attribs.length;e++){var i=new t.VertexAttrib(r);this.attribs[e]=i}this.maxAttrib=0};WebGLVertexArrayObjectOES.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},WebGLVertexArrayObjectOES.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const OESVertexArrayObject=function(e){const l=this;wrapGLError(this.gl=e);const c=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===l.VERTEX_ARRAY_BINDING_OES?l.currentVertexArrayObject===l.defaultVertexArrayObject?null:l.currentVertexArrayObject:c.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){const t=l.currentVertexArrayObject;t.maxAttrib=Math.max(t.maxAttrib,e);const r=t.attribs[e];return r.enabled=!0,c.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){const t=l.currentVertexArrayObject;t.maxAttrib=Math.max(t.maxAttrib,e);const r=t.attribs[e];return r.enabled=!1,c.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(e,t){switch(e){case 34962:l.currentArrayBuffer=t;break;case 34963:l.currentVertexArrayObject.elementArrayBuffer=t}return c.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(e,t){var r=l.currentVertexArrayObject.attribs[e];switch(t){case 34975:return r.buffer;case 34338:return r.enabled;case 34339:return r.size;case 34340:return r.stride;case 34341:return r.type;case 34922:return r.normalized;default:return c.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,t,r,i,n,a){const s=l.currentVertexArrayObject;s.maxAttrib=Math.max(s.maxAttrib,e);const o=s.attribs[e];return o.buffer=l.currentArrayBuffer,o.size=t,o.type=r,o.normalized=i,o.stride=n,o.offset=a,o.recache(),c.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{log("OESVertexArrayObject emulation library context restored"),l.reset_()},!0),this.reset_()};function polyfillVertexArrayObject(r){if("function"!=typeof r.createVertexArray){const t=r.getSupportedExtensions;r.getSupportedExtensions=function(){const e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};const i=r.getExtension;r.getExtension=function(e){var t=i.call(this,e);return t||("OES_vertex_array_object"!==e?null:(r.__OESVertexArrayObject||(this.__OESVertexArrayObject=new OESVertexArrayObject(this)),this.__OESVertexArrayObject))}}}OESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES=34229,OESVertexArrayObject.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new WebGLVertexArrayObjectOES(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},OESVertexArrayObject.prototype.createVertexArrayOES=function(){var e=new WebGLVertexArrayObjectOES(this);return this.vertexArrayObjects.push(e),e},OESVertexArrayObject.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},OESVertexArrayObject.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof WebGLVertexArrayObjectOES&&e.hasBeenBound&&e.ext===this)},OESVertexArrayObject.prototype.bindVertexArrayOES=function(e){var i=this.gl;if(!e||e.isAlive){const c=this.original;var n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var a=this.currentVertexArrayObject;if(n!==a){n&&a.elementArrayBuffer===n.elementArrayBuffer||c.bindBuffer.call(i,34963,a.elementArrayBuffer);let r=this.currentArrayBuffer;var s=Math.max(n?n.maxAttrib:0,a.maxAttrib);for(let t=0;t<=s;t++){var o=a.attribs[t],l=n?n.attribs[t]:null;if(n&&o.enabled===l.enabled||(o.enabled?c.enableVertexAttribArray:c.disableVertexAttribArray).call(i,t),o.enabled){let e=!1;n&&o.buffer===l.buffer||(r!==o.buffer&&(c.bindBuffer.call(i,34962,o.buffer),r=o.buffer),e=!0),!e&&o.cached===l.cached||c.vertexAttribPointer.call(i,t,o.size,o.type,o.normalized,o.stride,o.offset)}}this.currentArrayBuffer!==r&&c.bindBuffer.call(i,34962,this.currentArrayBuffer)}}else synthesizeGLError(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject")};const OES_element_index="OES_element_index",WEBGL_draw_buffers$1="WEBGL_draw_buffers",EXT_disjoint_timer_query$1="EXT_disjoint_timer_query",EXT_disjoint_timer_query_webgl2="EXT_disjoint_timer_query_webgl2",EXT_texture_filter_anisotropic$1="EXT_texture_filter_anisotropic",WEBGL_debug_renderer_info="WEBGL_debug_renderer_info",GL_FRAGMENT_SHADER_DERIVATIVE_HINT=35723,GL_DONT_CARE=4352,GL_GPU_DISJOINT_EXT$1=36795,GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,GL_UNMASKED_VENDOR_WEBGL=37445,GL_UNMASKED_RENDERER_WEBGL=37446,getWebGL2ValueOrZero=e=>isWebGL2$1(e)?void 0:0,WEBGL_PARAMETERS={[3074]:e=>isWebGL2$1(e)?void 0:36064,[GL_FRAGMENT_SHADER_DERIVATIVE_HINT]:e=>isWebGL2$1(e)?void 0:GL_DONT_CARE,35977:getWebGL2ValueOrZero,32937:getWebGL2ValueOrZero,[GL_GPU_DISJOINT_EXT$1]:(e,t)=>{e=isWebGL2$1(e)?e.getExtension(EXT_disjoint_timer_query_webgl2):e.getExtension(EXT_disjoint_timer_query$1);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[GL_UNMASKED_VENDOR_WEBGL]:(e,t)=>{e=e.getExtension(WEBGL_debug_renderer_info);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[GL_UNMASKED_RENDERER_WEBGL]:(e,t)=>{e=e.getExtension(WEBGL_debug_renderer_info);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT]:(e,t)=>{e=e.luma.extensions[EXT_texture_filter_anisotropic$1];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:getWebGL2ValueOrZero,35071:getWebGL2ValueOrZero,37447:getWebGL2ValueOrZero,36063:(e,t)=>{if(!isWebGL2$1(e)){e=e.getExtension(WEBGL_draw_buffers$1);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:getWebGL2ValueOrZero,35374:getWebGL2ValueOrZero,35377:getWebGL2ValueOrZero,34852:e=>{if(!isWebGL2$1(e)){e=e.getExtension(WEBGL_draw_buffers$1);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:e=>e.getExtension(OES_element_index)?2147483647:65535,33001:e=>e.getExtension(OES_element_index)?16777216:65535,33e3:e=>16777216,37157:getWebGL2ValueOrZero,35373:getWebGL2ValueOrZero,35657:getWebGL2ValueOrZero,36183:getWebGL2ValueOrZero,37137:getWebGL2ValueOrZero,34045:getWebGL2ValueOrZero,35978:getWebGL2ValueOrZero,35979:getWebGL2ValueOrZero,35968:getWebGL2ValueOrZero,35376:getWebGL2ValueOrZero,35375:getWebGL2ValueOrZero,35659:getWebGL2ValueOrZero,37154:getWebGL2ValueOrZero,35371:getWebGL2ValueOrZero,35658:getWebGL2ValueOrZero,35076:getWebGL2ValueOrZero,35077:getWebGL2ValueOrZero,35380:getWebGL2ValueOrZero};function getParameterPolyfill(e,t,r){const i=WEBGL_PARAMETERS[r];e="function"==typeof i?i(e,t,r):i;return void 0!==e?e:t(r)}const OES_vertex_array_object="OES_vertex_array_object",ANGLE_instanced_arrays="ANGLE_instanced_arrays",WEBGL_draw_buffers="WEBGL_draw_buffers",EXT_disjoint_timer_query="EXT_disjoint_timer_query",EXT_texture_filter_anisotropic="EXT_texture_filter_anisotropic",ERR_VAO_NOT_SUPPORTED="VertexArray requires WebGL2 or OES_vertex_array_object extension";function getExtensionData(e,t){return{webgl2:isWebGL2$1(e),ext:e.getExtension(t)}}const WEBGL2_CONTEXT_POLYFILLS={[OES_vertex_array_object]:{meta:{suffix:"OES"},createVertexArray:()=>{assert$5(!1,ERR_VAO_NOT_SUPPORTED)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[ANGLE_instanced_arrays]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){assert$5(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[WEBGL_draw_buffers]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{assert$5(!1)}},[EXT_disjoint_timer_query]:{meta:{suffix:"EXT"},createQuery:()=>{assert$5(!1)},deleteQuery:()=>{assert$5(!1)},beginQuery:()=>{assert$5(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},WEBGL2_CONTEXT_OVERRIDES={readBuffer:(e,t,r)=>{isWebGL2$1(e)&&t(r)},getVertexAttrib:(e,t,r,i)=>{var{webgl2:n,ext:a}=getExtensionData(e,ANGLE_instanced_arrays);let s;switch(i){case 35069:s=!!n&&void 0;break;case 35070:s=n||a?void 0:0}return void 0!==s?s:t(r,i)},getProgramParameter:(e,t,r,i)=>{if(!isWebGL2$1(e))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return t(r,i)},getInternalformatParameter:(e,t,r,i,n)=>isWebGL2$1(e)||32937!==n?e.getInternalformatParameter(r,i,n):new Int32Array([0]),getTexParameter(e,t,r,i){return 34046===i&&(e=e.luma["extensions"],i=(e=e[EXT_texture_filter_anisotropic])&&e.TEXTURE_MAX_ANISOTROPY_EXT||34046),t(r,i)},getParameter:getParameterPolyfill,hint(e,t,r,i){return t(r,i)}};function polyfillContext(e){e.luma=e.luma||{};const t=e["luma"];return t.polyfilled||(polyfillVertexArrayObject(e),initializeExtensions(e),installPolyfills(e,WEBGL2_CONTEXT_POLYFILLS),installOverrides(e,{target:t,target2:e}),t.polyfilled=!0),e}const global_="undefined"!=typeof global?global:window;function initializeExtensions(e){e.luma.extensions={};for(const t of e.getSupportedExtensions()||[])e.luma[t]=e.getExtension(t)}function installOverrides(r,{target:i,target2:n}){Object.keys(WEBGL2_CONTEXT_OVERRIDES).forEach(e=>{var t;"function"==typeof WEBGL2_CONTEXT_OVERRIDES[e]&&(t=r[e]?r[e].bind(r):()=>{},t=WEBGL2_CONTEXT_OVERRIDES[e].bind(null,r,t),i[e]=t,n[e]=t)})}function installPolyfills(e,t){for(const r of Object.getOwnPropertyNames(t))"overrides"!==r&&polyfillExtension(e,{extension:r,target:e.luma,target2:e})}function polyfillExtension(t,{extension:e,target:r,target2:i}){const n=WEBGL2_CONTEXT_POLYFILLS[e];assert$5(n);var{meta:a={}}=n,{suffix:s=""}=a;const o=t.getExtension(e);for(const l of Object.keys(n)){const c=`${l}${s}`;let e=null;"meta"===l||"function"==typeof t[l]||(o&&"function"==typeof o[c]?e=(...e)=>o[c](...e):"function"==typeof n[l]&&(e=n[l].bind(r))),e&&(r[l]=e,i[l]=e)}}global_.polyfillContext=polyfillContext;const GL_PARAMETER_DEFAULTS={[3042]:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},enable=(e,t,r)=>t?e.enable(r):e.disable(r),hint=(e,t,r)=>e.hint(r,t),pixelStorei=(e,t,r)=>e.pixelStorei(r,t),drawFramebuffer=(e,t)=>{var r=isWebGL2$1(e)?36009:36160;return e.bindFramebuffer(r,t)},readFramebuffer=(e,t)=>e.bindFramebuffer(36008,t);function isArray$2(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const GL_PARAMETER_SETTERS={[3042]:enable,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:enable,2885:(e,t)=>e.cullFace(t),2929:enable,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:enable,35723:hint,36006:drawFramebuffer,2886:(e,t)=>e.frontFace(t),33170:hint,2849:(e,t)=>e.lineWidth(t),32823:enable,32824:"polygonOffset",10752:"polygonOffset",35977:enable,32938:"sampleCoverage",32939:"sampleCoverage",3089:enable,3088:(e,t)=>e.scissor(...t),2960:enable,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),3333:pixelStorei,3317:pixelStorei,37440:pixelStorei,37441:pixelStorei,37443:pixelStorei,3330:pixelStorei,3332:pixelStorei,3331:pixelStorei,36010:readFramebuffer,3314:pixelStorei,32878:pixelStorei,3316:pixelStorei,3315:pixelStorei,32877:pixelStorei,framebuffer:(e,t)=>{t=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,t)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=isArray$2(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=isArray$2(t)&&2===t.length?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{var[r,t]=t=isArray$2(t)?t:[t,t];e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,t)},stencilFunc:(e,t)=>{var[r,i,n,a,s,t]=t=isArray$2(t)&&3===t.length?[...t,...t]:t;e.stencilFuncSeparate(1028,r,i,n),e.stencilFuncSeparate(1029,a,s,t)},stencilOp:(e,t)=>{var[r,i,n,a,s,t]=t=isArray$2(t)&&3===t.length?[...t,...t]:t;e.stencilOpSeparate(1028,r,i,n),e.stencilOpSeparate(1029,a,s,t)},viewport:(e,t)=>e.viewport(...t)};function getValue(e,t,r){return(void 0!==t[e]?t:r)[e]}const GL_COMPOSITE_PARAMETER_SETTERS={blendEquation:(e,t,r)=>e.blendEquationSeparate(getValue(32777,t,r),getValue(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(getValue(32969,t,r),getValue(32968,t,r),getValue(32971,t,r),getValue(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(getValue(32824,t,r),getValue(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(getValue(32938,t,r),getValue(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,getValue(2962,t,r),getValue(2967,t,r),getValue(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,getValue(34816,t,r),getValue(36003,t,r),getValue(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,getValue(2964,t,r),getValue(2965,t,r),getValue(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,getValue(34817,t,r),getValue(34818,t,r),getValue(34819,t,r))},GL_HOOKED_SETTERS={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({[36006]:r,36010:r});case 36009:return e({[36006]:r});case 36008:return e({[36010]:r});default:return null}},blendColor:(e,t,r,i,n)=>e({[32773]:new Float32Array([t,r,i,n])}),blendEquation:(e,t)=>e({[32777]:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({[32777]:t,34877:r}),blendFunc:(e,t,r)=>e({[32969]:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,i,n)=>e({[32969]:t,32968:r,32971:i,32970:n}),clearColor:(e,t,r,i,n)=>e({[3106]:new Float32Array([t,r,i,n])}),clearDepth:(e,t)=>e({[2931]:t}),clearStencil:(e,t)=>e({[2961]:t}),colorMask:(e,t,r,i,n)=>e({[3107]:[t,r,i,n]}),cullFace:(e,t)=>e({[2885]:t}),depthFunc:(e,t)=>e({[2932]:t}),depthRange:(e,t,r)=>e({[2928]:new Float32Array([t,r])}),depthMask:(e,t)=>e({[2930]:t}),frontFace:(e,t)=>e({[2886]:t}),lineWidth:(e,t)=>e({[2849]:t}),polygonOffset:(e,t,r)=>e({[32824]:t,10752:r}),sampleCoverage:(e,t,r)=>e({[32938]:t,32939:r}),scissor:(e,t,r,i,n)=>e({[3088]:new Int32Array([t,r,i,n])}),stencilMask:(e,t)=>e({[2968]:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[1028===t?2968:36005]:r}),stencilFunc:(e,t,r,i)=>e({[2962]:t,2967:r,2963:i,34816:t,36003:r,36004:i}),stencilFuncSeparate:(e,t,r,i,n)=>e({[1028===t?2962:34816]:r,[1028===t?2967:36003]:i,[1028===t?2963:36004]:n}),stencilOp:(e,t,r,i)=>e({[2964]:t,2965:r,2966:i,34817:t,34818:r,34819:i}),stencilOpSeparate:(e,t,r,i,n)=>e({[1028===t?2964:34817]:r,[1028===t?2965:34818]:i,[1028===t?2966:34819]:n}),viewport:(e,t,r,i,n)=>e({[2978]:[t,r,i,n]})},isEnabled=(e,t)=>e.isEnabled(t),GL_PARAMETER_GETTERS={[3042]:isEnabled,2884:isEnabled,2929:isEnabled,3024:isEnabled,32823:isEnabled,32926:isEnabled,32928:isEnabled,3089:isEnabled,2960:isEnabled,35977:isEnabled};function isObjectEmpty$1(e){for(const t in e)return!1;return!0}function deepArrayEqual(t,r){if(t===r)return!0;var e=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(r)||ArrayBuffer.isView(r);if(e&&i&&t.length===r.length){for(let e=0;e<t.length;++e)if(t[e]!==r[e])return!1;return!0}return!1}function installGetterOverride(r,e){const i=r[e].bind(r);r[e]=function(...e){var t=e[0];return t in r.state.cache&&r.state.enable?r.state.cache[t]:i(...e)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function installSetterSpy(i,e,n){const a=i[e].bind(i);i[e]=function(...e){var{valueChanged:t,oldValue:r}=n(i.state._updateCache,...e);return t&&a(...e),r},Object.defineProperty(i[e],"name",{value:`${e}-to-cache`,configurable:!1})}function installProgramSpy(t){const r=t.useProgram.bind(t);t.useProgram=function(e){t.state.program!==e&&(r(e),t.state.program=e)}}class GLState{constructor(e,{copyState:t=!1,log:r=()=>{}}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?getParameters(e):Object.assign({},GL_PARAMETER_DEFAULTS),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e=0){this.stateStack.push({})}pop(){assert$5(0<this.stateStack.length);var e=this.stateStack[this.stateStack.length-1];setParameters(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const i=0<this.stateStack.length&&this.stateStack[this.stateStack.length-1];for(const s in e){assert$5(void 0!==s);var n=e[s],a=this.cache[s];deepArrayEqual(n,a)||(t=!0,r=a,!i||s in i||(i[s]=a),this.cache[s]=n)}return{valueChanged:t,oldValue:r}}}function trackContextState(e,t={}){var{enable:r=!0,copyState:t}=t;if(assert$5(void 0!==t),!e.state){const n=("undefined"!=typeof global?global:window)["polyfillContext"];n&&n(e),e.state=new GLState(e,{copyState:t}),installProgramSpy(e);for(const a in GL_HOOKED_SETTERS){var i=GL_HOOKED_SETTERS[a];installSetterSpy(e,a,i)}installGetterOverride(e,"getParameter"),installGetterOverride(e,"isEnabled")}return e.state.enable=r,e}function pushContextState(e){e.state||trackContextState(e,{copyState:!1}),e.state.push()}function popContextState(e){assert$5(e.state),e.state.pop()}function setParameters(e,t){if(assert$5(isWebGL(e),"setParameters requires a WebGL context"),!isObjectEmpty$1(t)){const n={};for(const a in t){var r=Number(a);const s=GL_PARAMETER_SETTERS[a];s&&("string"==typeof s?n[s]=!0:s(e,t[a],r))}var i=e.state&&e.state.cache;if(i)for(const o in n){const l=GL_COMPOSITE_PARAMETER_SETTERS[o];l(e,t,i)}}}function getParameters(e,t){if("number"==typeof(t=t||GL_PARAMETER_DEFAULTS)){var r=t;const n=GL_PARAMETER_GETTERS[r];return n?n(e,r):e.getParameter(r)}const i={};for(const a of Array.isArray(t)?t:Object.keys(t)){const s=GL_PARAMETER_GETTERS[a];i[a]=s?s(e,Number(a)):e.getParameter(Number(a))}return i}function resetParameters(e){setParameters(e,GL_PARAMETER_DEFAULTS)}function withParameters(e,t,r){if(isObjectEmpty$1(t))return r(e);var{nocatch:i=!0}=t;pushContextState(e),setParameters(e,t);let n;if(i)n=r(e),popContextState(e);else try{n=r(e)}finally{popContextState(e)}return n}function cssToDeviceRatio(e){var t=e["luma"];if(e.canvas&&t){var t=t.canvasSizeInfo["clientWidth"];return t?e.drawingBufferWidth/t:1}return 1}function cssToDevicePixels(e,t,r=!0){return scalePixels$1(t,cssToDeviceRatio(e),e.drawingBufferWidth,e.drawingBufferHeight,r)}function getDevicePixelRatio(e){var t="undefined"!=typeof window&&window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}function scalePixels$1(e,t,r,i,n){var a=scaleX(e[0],t,r);let s=scaleY(e[1],t,i,n),o=scaleX(e[0]+1,t,r);r=o===r-1?o:o-1;o=scaleY(e[1]+1,t,i,n);let l;return n?(o=0===o?o:o+1,l=s,s=o):l=o===i-1?o:o-1,{x:a,y:s,width:Math.max(r-a+1,1),height:Math.max(l-s+1,1)}}function scaleX(e,t,r){return Math.min(Math.round(e*t),r-1)}function scaleY(e,t,r,i){return i?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}const isBrowser=env.isBrowser(),isPage$1=isBrowser&&"undefined"!=typeof document,CONTEXT_DEFAULTS={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function createGLContext(t={}){assert$5(isBrowser,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils");var{width:e,height:r}=t=Object.assign({},CONTEXT_DEFAULTS,t);function i(e){if(t.throwOnError)throw new Error(e);return console.error(e),null}t.onError=i;var n=t["canvas"];return(r=createBrowserContext(getCanvas({canvas:n,width:e,height:r,onError:i}),t))?(logInfo(r=instrumentGLContext(r,t)),r):null}function instrumentGLContext(e,t={}){if(!e||e._instrumented)return e;e._version=e._version||getVersion(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};var{manageState:r,debug:i}=t=Object.assign({},CONTEXT_DEFAULTS,t);return r&&trackContextState(e,{copyState:!1,log:(...e)=>log$1.log(1,...e)()}),isBrowser&&i&&(env.global.makeDebugContext?(e=env.global.makeDebugContext(e,t),log$1.level=Math.max(log$1.level,1)):log$1.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function getContextDebugInfo(e){var t=e.getParameter(7936),r=e.getParameter(7937),i=e.getExtension("WEBGL_debug_renderer_info");return{vendor:i&&e.getParameter(i.UNMASKED_VENDOR_WEBGL||7936)||t,renderer:i&&e.getParameter(i.UNMASKED_RENDERER_WEBGL||7937)||r,vendorMasked:t,rendererMasked:r,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}function resizeGLContext(e,t={}){if(e.canvas)setDevicePixelRatio(e,getDevicePixelRatio(t.useDevicePixels),t);else{const r=e.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in t&&"height"in t&&r.resize(t.width,t.height)}}function createBrowserContext(e,t){const r=t["onError"];let i=null;var n=e=>i=e.statusMessage||i;e.addEventListener("webglcontextcreationerror",n,!1);var{webgl1:a=!0,webgl2:s=!0}=t;let o=null;return s&&(o=o||e.getContext("webgl2",t),o=o||e.getContext("experimental-webgl2",t)),a&&(o=o||e.getContext("webgl",t),o=o||e.getContext("experimental-webgl",t)),e.removeEventListener("webglcontextcreationerror",n,!1),o?(t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1),o):r(`Failed to create ${s&&!a?"WebGL2":"WebGL"} context: ${i||"Unknown error"}`)}function getCanvas({canvas:e,width:t=800,height:r=600,onError:i}){let n;return"string"==typeof e?(isPage$1&&"complete"===document.readyState||i(`createGLContext called on canvas '${e}' before page was loaded`),n=document.getElementById(e)):e?n=e:(n=document.createElement("canvas"),n.id="lumagl-canvas",n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",document.body.insertBefore(n,document.body.firstChild)),n}function logInfo(e){var t=isWebGL2$1(e)?"WebGL2":"WebGL1",r=getContextDebugInfo(e),r=r?`(${r.vendor},${r.renderer})`:"",e=e.debug?" debug":"";log$1.info(1,`${t}${e} context ${r}`)()}function getVersion(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?2:1}function setDevicePixelRatio(e,t,r){let i="width"in r?r.width:e.canvas.clientWidth,n="height"in r?r.height:e.canvas.clientHeight;i&&n||(log$1.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=e.canvas.width||1,n=e.canvas.height||1),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};var a,s=e.luma.canvasSizeInfo;s.clientWidth===i&&s.clientHeight===n&&s.devicePixelRatio===t||(a=t,r=Math.floor(i*a),s=Math.floor(n*a),e.canvas.width=r,e.canvas.height=s,e.drawingBufferWidth===r&&e.drawingBufferHeight===s||(log$1.warn("Device pixel ratio clamped")(),a=Math.min(e.drawingBufferWidth/i,e.drawingBufferHeight/n),e.canvas.width=Math.floor(i*a),e.canvas.height=Math.floor(n*a)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:i,clientHeight:n,devicePixelRatio:t}))}const VERSION="8.5.10",STARTUP_MESSAGE="set luma.log.level=1 (or higher) to trace rendering";class StatsManager{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Stats({id:e})),this.stats.get(e)}}const lumaStats=new StatsManager;if(env.global.luma&&env.global.luma.VERSION!==VERSION)throw new Error(`luma.gl - multiple VERSIONs detected: ${env.global.luma.VERSION} vs ${VERSION}`);function requestAnimationFrame$1(e){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function cancelAnimationFrame(e){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}function assert$4(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function getKeyValue(e,t){if("string"!=typeof t)return t;var r=Number(t);if(!isNaN(r))return r;e=e[t=t.replace(/^.*\./,"")];return assert$4(void 0!==e,`Accessing undefined constant GL.${t}`),e}function getKey(e,t){t=Number(t);for(const r in e)if(e[r]===t)return`GL.${r}`;return String(t)}env.global.luma||(env.isBrowser()&&log$1.log(1,`luma.gl ${VERSION} - ${STARTUP_MESSAGE}`)(),env.global.luma=env.global.luma||{VERSION:VERSION,version:VERSION,log:log$1,stats:lumaStats,globals:{modules:{},nodeIO:{}}}),env.global.luma;const uidCounters={};function uid(e="id"){return uidCounters[e]=uidCounters[e]||1,`${e}-${uidCounters[e]++}`}function isPowerOfTwo$1(e){return assert$4("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function isObjectEmpty(e){let t=!0;for(const r in e){t=!1;break}return t}function stubRemovedMethods(e,t,r,i){const n=`See luma.gl ${r} Upgrade Guide at \
https://luma.gl/docs/upgrade-guide`,a=Object.getPrototypeOf(e);i.forEach(e=>{a.methodName||(a[e]=()=>{throw log$1.removed(`Calling removed method ${t}.${e}: `,n)(),new Error(e)})})}const ERR_RESOURCE_METHOD_UNDEFINED="Resource subclass must define virtual methods";class Resource$1{constructor(e,t={}){assertWebGLContext(e);var{id:r,userData:i={}}=t;this.gl=e,this.gl2=e,this.id=r||uid(this.constructor.name),this.userData=i,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(e=>e.delete()),this}bind(e=this.handle){if("function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t={}){assert$4(e=getKeyValue(this.gl,e));var r=(this.constructor.PARAMETERS||{})[e];if(r){var i=isWebGL2$1(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){var n=r.webgl1,r="webgl2"in r?r.webgl2:r.webgl1;return i?r:n}}return this._getParameter(e,t)}getParameters(e={}){var{parameters:t,keys:r}=e,i=this.constructor.PARAMETERS||{},n=isWebGL2$1(this.gl);const a={};for(const l of t||Object.keys(i)){var s,o=i[l];o&&(!("webgl2"in o)||n)&&(!("extension"in o)||this.gl.getExtension(o.extension))&&(s=r?getKey(this.gl,l):l,a[s]=this.getParameter(l,e),r&&"GLenum"===o.type&&(a[s]=getKey(this.gl,a[s])))}return a}setParameter(e,t){assert$4(e=getKeyValue(this.gl,e));var r=(this.constructor.PARAMETERS||{})[e];if(r){var i=isWebGL2$1(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(t=getKeyValue(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return stubRemovedMethods(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_deleteHandle(){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_bindHandle(e){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_getOptsFromHandle(){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_getParameter(e,t){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_setParameter(e,t){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){var e=this.constructor.name;const t=lumaStats.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}_removeStats(){var e=this.constructor.name;const t=lumaStats.get("Resource Counts");t.get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,t=this.constructor.name){const r=lumaStats.get("Memory Usage");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const t=lumaStats.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const ERR_TYPE_DEDUCTION="Failed to deduce GL constant from typed array";function getGLTypeFromTypedArray(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(ERR_TYPE_DEDUCTION)}}function getTypedArrayFromGLType(e,{clamped:t=!0}={}){switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function flipRows({data:t,width:e,height:r,bytesPerPixel:i=4,temp:n}){var a=e*i;n=n||new Uint8Array(a);for(let e=0;e<r/2;++e){var s=e*a,o=(r-e-1)*a;n.set(t.subarray(s,s+a)),t.copyWithin(s,o,o+a),t.set(n,o)}}function scalePixels({data:i,width:n,height:e}){var a=Math.round(n/2),t=Math.round(e/2);const s=new Uint8Array(a*t*4);for(let r=0;r<t;r++)for(let t=0;t<a;t++)for(let e=0;e<4;e++)s[4*(r*a+t)+e]=i[4*(2*r*n+2*t)+e];return{data:s,width:a,height:t}}function checkProps(e,t,r){var i,n,a,{removedProps:s={},deprecatedProps:o={},replacedProps:l={}}=r;for(const h in s)h in t&&(i=s[h]?`${e}.${s[h]}`:"N/A",log$1.removed(`${e}.${h}`,i)());for(const u in o)u in t&&(n=o[u],log$1.deprecated(`${e}.${u}`,`${e}.${n}`)());let c=null;for(const d in l)d in t&&(a=l[d],log$1.deprecated(`${e}.${d}`,`${e}.${a}`)(),c=c||Object.assign({},t),c[a]=t[d],delete c[d]);return c||t}const DEFAULT_ACCESSOR_VALUES={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},PROP_CHECKS={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Accessor{static getBytesPerElement(e){return getTypedArrayFromGLType(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return assert$4(e.size),getTypedArrayFromGLType(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Accessor(DEFAULT_ACCESSOR_VALUES,...e)}constructor(...e){e.forEach(e=>this._assign(e)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Accessor.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Accessor.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=checkProps("Accessor",e,PROP_CHECKS)).type&&(this.type=e.type,5124!==e.type&&5125!==e.type||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const DEBUG_DATA_LENGTH=10,DEPRECATED_PROPS={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},PROP_CHECKS_INITIALIZE={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:DEPRECATED_PROPS},PROP_CHECKS_SET_PROPS={removedProps:DEPRECATED_PROPS};class Buffer$1 extends Resource$1{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/Accessor.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/Accessor.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),e=checkProps("Buffer",e=Number.isFinite(e)?{byteLength:e}:e,PROP_CHECKS_INITIALIZE),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=checkProps("Buffer",e,PROP_CHECKS_SET_PROPS))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new Accessor(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){var{data:t,offset:r=0,srcOffset:i=0}=e=ArrayBuffer.isView(e)?{data:e}:e,n=e.byteLength||e.length;assert$4(t);e=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(e,this.handle),0!==i||void 0!==n?(assertWebGL2Context(this.gl),this.gl.bufferSubData(this.target,r,t,i,n)):this.gl.bufferSubData(e,r,t),this.gl.bindBuffer(e,null),this.debugData=null,this._inferType(t),this}copyData({sourceBuffer:e,readOffset:t=0,writeOffset:r=0,size:i}){const n=this["gl"];return assertWebGL2Context(n),n.bindBuffer(36662,e.handle),n.bindBuffer(36663,this.handle),n.copyBufferSubData(36662,36663,t,r,i),n.bindBuffer(36662,null),n.bindBuffer(36663,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:i=0}={}){assertWebGL2Context(this.gl);const n=getTypedArrayFromGLType(this.accessor.type||5126,{clamped:!1});var a=this._getAvailableElementCount(t),s=r;let o,l;e?(l=e.length,o=l-s):(o=Math.min(a,i||a),l=s+o);a=Math.min(a,o);return assert$4((i=i||a)<=a),e=e||new n(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,i),this.gl.bindBuffer(36662,null),e}bind({target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:i}={}){return 35345===e||35982===e?void 0!==i?this.gl.bindBufferRange(e,t,this.handle,r,i):(assert$4(0===r),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:t=this.accessor&&this.accessor.index}={}){return 35345===e||35982===e?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(DEBUG_DATA_LENGTH,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,t=0,r=e.byteLength+t){assert$4(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();var i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,DEBUG_DATA_LENGTH),this.bytesUsed=r,this._trackAllocatedMemory(r);r=getGLTypeFromTypedArray(e);return assert$4(r),this.setAccessor(new Accessor(this.accessor,{type:r})),this}_setByteLength(e,t=this.usage){assert$4(0<=e),this._trackDeallocatedMemory();let r=e;0===e&&(r=new Float32Array(0));var i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){e/=getTypedArrayFromGLType(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(e){this.accessor.type||this.setAccessor(new Accessor(this.accessor,{type:getGLTypeFromTypedArray(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);e=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),e}get type(){return log$1.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return log$1.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return log$1.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return log$1.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Accessor(this.accessor,e),this}}const TEXTURE_FORMATS={[6407]:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},DATA_FORMAT_CHANNELS={[6403]:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},TYPE_SIZES={[5126]:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function isFormatSupported$1(e,t){t=TEXTURE_FORMATS[t];if(!t)return!1;if(void 0===t.gl1&&void 0===t.gl2)return!0;t=isWebGL2$1(e)&&t.gl2||t.gl1;return"string"==typeof t?e.getExtension(t):t}function isLinearFilteringSupported(e,t){t=TEXTURE_FORMATS[t];switch(t&&t.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}}const NPOT_MIN_FILTERS=[9729,9728],WebGLBuffer=env.global.WebGLBuffer||function(){};class Texture$1 extends Resource$1{static isSupported(e,t={}){var{format:r,linearFiltering:t}=t;let i=!0;return r&&(i=i&&isFormatSupported$1(e,r),i=i&&(!t||isLinearFilteringSupported(e,r))),i}constructor(e,t){var{id:r=uid("texture"),handle:i,target:t}=t;super(e,{id:r,handle:i}),this.target=t,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(t={}){let e=t.data;if(e instanceof Promise)return e.then(e=>this.initialize(Object.assign({},t,{pixels:e,data:e}))),this;var r="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement;if(r&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;var{pixels:i=null,format:n=6408,border:a=0,recreate:s=!1,parameters:o={},pixelStore:l={},textureUnit:c=void 0}=t;e=e||i;let{width:h,height:u,dataFormat:d,type:p,compressed:f=!1,mipmaps:m=!0}=t;var{depth:i=0}=t;return{width:h,height:u,compressed:f,dataFormat:d,type:p}=this._deduceParameters({format:n,type:p,dataFormat:d,compressed:f,data:e,width:h,height:u}),this.width=h,this.height=u,this.depth=i,this.format=n,this.type=p,this.dataFormat=d,this.border=a,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),m&&this._isNPOT()&&(log$1.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),m=!1,this._updateForNPOT(o)),this.mipmaps=m,this.setImageData({data:e,width:h,height:u,depth:i,format:n,type:p,dataFormat:d,border:a,mipmaps:m,parameters:l,compressed:f}),m&&this.generateMipmap(),this.setParameters(o),s&&(this.data=e),r&&(this._video={video:e,parameters:o,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){var e,t,r;this._video&&({video:e,parameters:t,lastTime:r}=this._video,r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA||(this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime))}resize({height:e,width:t,mipmaps:r=!1}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(e={}){return this._isNPOT()?log$1.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)():(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),withParameters(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null)),this}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:t=null,level:i=0,format:n=this.format,border:a=this.border,offset:s=0,parameters:o={}}=e;let{data:l=null,type:c=this.type,width:h=this.width,height:u=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=e;l=l||t,{type:c,dataFormat:d,compressed:p,width:h,height:u}=this._deduceParameters({format:n,type:c,dataFormat:d,compressed:p,data:l,width:h,height:u});const f=this["gl"];f.bindTexture(this.target,this.handle);let m=null;({data:l,dataType:m}=this._getDataType({data:l,compressed:p}));let g;var _;return withParameters(this.gl,o,()=>{switch(m){case"null":f.texImage2D(r,i,n,h,u,a,d,c,l);break;case"typed-array":f.texImage2D(r,i,n,h,u,a,d,c,l,s);break;case"buffer":g=assertWebGL2Context(f),g.bindBuffer(35052,l.handle||l),g.texImage2D(r,i,n,h,u,a,d,c,s),g.bindBuffer(35052,null);break;case"browser-object":isWebGL2$1(f)?f.texImage2D(r,i,n,h,u,a,d,c,l):f.texImage2D(r,i,n,d,c,l);break;case"compressed":for(var[e,t]of l.entries())f.compressedTexImage2D(r,e,t.format,t.width,t.height,a,t.data);break;default:assert$4(!1,"Unknown image data type")}}),l&&l.byteLength?this._trackAllocatedMemory(l.byteLength,"Texture"):(_=DATA_FORMAT_CHANNELS[this.dataFormat]||4,e=TYPE_SIZES[this.type]||1,this._trackAllocatedMemory(this.width*this.height*_*e,"Texture")),this.loaded=!0,this}setSubImageData({target:r=this.target,pixels:e=null,data:i=null,x:n=0,y:a=0,width:s=this.width,height:o=this.height,level:l=0,format:c=this.format,type:h=this.type,dataFormat:u=this.dataFormat,compressed:d=!1,offset:p=0,border:t=this.border,parameters:f={}}){({type:h,dataFormat:u,compressed:d,width:s,height:o}=this._deduceParameters({format:c,type:h,dataFormat:u,compressed:d,data:i,width:s,height:o})),assert$4(0===this.depth,"texSubImage not supported for 3D textures"),(i=i||e)&&i.data&&(i=(e=i).data,s=e.shape[0],o=e.shape[1]),i instanceof Buffer$1&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),withParameters(this.gl,f,()=>{if(d)this.gl.compressedTexSubImage2D(r,l,n,a,s,o,c,i);else if(null===i)this.gl.texSubImage2D(r,l,n,a,s,o,u,h,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(r,l,n,a,s,o,u,h,i,p);else if(i instanceof WebGLBuffer){const e=assertWebGL2Context(this.gl);e.bindBuffer(35052,i),e.texSubImage2D(r,l,n,a,s,o,u,h,p),e.bindBuffer(35052,null)}else if(isWebGL2$1(this.gl)){const t=assertWebGL2Context(this.gl);t.texSubImage2D(r,l,n,a,s,o,u,h,i)}else this.gl.texSubImage2D(r,l,n,a,u,h,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e=0){return null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const t=this["gl"];return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const t=this["gl"];return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Buffer$1?{data:e.handle,dataType:"buffer"}:e instanceof WebGLBuffer?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){var{format:t,data:r}=e,{width:i,height:n,dataFormat:a,type:s,compressed:o}=e,e=TEXTURE_FORMATS[t],a=a||e&&e.dataFormat,s=s||e&&e.types[0],o=o||e&&e.compressed;return{width:i,height:n}=this._deduceImageSize(r,i,n),{dataFormat:a,type:s,compressed:o,width:i,height:n,format:t,data:r}}_deduceImageSize(e,t,r){let i;return i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:r}:{width:0<=t?t:1,height:0<=r?r:1},assert$4(i,"Could not deduced texture size"),assert$4(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),assert$4(void 0===r||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:assert$4(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!isWebGL2$1(this.gl)&&(!(!this.width||!this.height)&&(!isPowerOfTwo$1(this.width)||!isPowerOfTwo$1(this.height)))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:-1===NPOT_MIN_FILTERS.indexOf(t)&&(t=9729);break;case 10242:case 10243:33071!==t&&(t=33071)}return t}}let pathPrefix="";function loadImage$1(i,n){return assert$4("string"==typeof i),i=pathPrefix+i,new Promise((e,t)=>{try{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error(`Could not load image ${i}.`)),r.crossOrigin=n&&n.crossOrigin||"anonymous",r.src=i}catch(e){t(e)}})}class Texture2D extends Texture$1{static isSupported(e,t){return Texture$1.isSupported(e,t)}constructor(e,t={}){assertWebGLContext(e),"string"==typeof(t=t instanceof Promise||"string"==typeof t?{data:t}:t).data&&(t=Object.assign({},t,{data:loadImage$1(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const FACES=[34069,34070,34071,34072,34073,34074];class TextureCube extends Texture$1{constructor(e,t={}){assertWebGLContext(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(e={}){const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage({face:e,data:t,x:r=0,y:i=0,mipmapLevel:n=0}){return this._subImage({target:e,data:t,x:r,y:i,mipmapLevel:n})}async setCubeMapImageData({width:i,height:n,pixels:e,data:t,border:a=0,format:s=6408,type:o=5121}){const l=this["gl"],r=e||t,c=await Promise.all(FACES.map(e=>{e=r[e];return Promise.all(Array.isArray(e)?e:[e])}));this.bind(),FACES.forEach((r,e)=>{1<c[e].length&&!1!==this.opts.mipmaps&&log$1.warn(`${this.id} has mipmap and multiple LODs.`)(),c[e].forEach((e,t)=>{i&&n?l.texImage2D(r,t,s,i,n,a,s,o,e):l.texImage2D(r,t,s,s,o,e)})}),this.unbind()}setImageDataForFace(t){const{face:r,width:e,height:i,pixels:n,data:a,border:s=0,format:o=6408,type:l=5121}=t,c=this["gl"],h=n||a;return this.bind(),h instanceof Promise?h.then(e=>this.setImageDataForFace(Object.assign({},t,{face:r,data:e,pixels:e}))):this.width||this.height?c.texImage2D(r,0,o,e,i,s,o,l,h):c.texImage2D(r,0,o,o,l,h),this}}TextureCube.FACES=FACES;class Texture3D extends Texture$1{static isSupported(e){return isWebGL2$1(e)}constructor(e,t={}){assertWebGL2Context(e),super(e,t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1})),this.initialize(t),Object.seal(this)}setImageData({level:e=0,dataFormat:t=6408,width:r,height:i,depth:n=1,border:a=0,format:s,type:o=5121,offset:l=0,data:c,parameters:h={}}){var u;return this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),withParameters(this.gl,h,()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,e,t,r,i,n,a,s,o,c),c instanceof Buffer$1&&(this.gl.bindBuffer(35052,c.handle),this.gl.texImage3D(this.target,e,t,r,i,n,a,s,o,l))}),c&&c.byteLength?this._trackAllocatedMemory(c.byteLength,"Texture"):(u=DATA_FORMAT_CHANNELS[this.dataFormat]||4,h=TYPE_SIZES[this.type]||1,this._trackAllocatedMemory(this.width*this.height*this.depth*u*h,"Texture")),this.loaded=!0,this}}const EXT_FLOAT_WEBGL2="EXT_color_buffer_float";var RENDERBUFFER_FORMATS={[33189]:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:EXT_FLOAT_WEBGL2,bpp:2},33327:{gl2:EXT_FLOAT_WEBGL2,bpp:4},34842:{gl2:EXT_FLOAT_WEBGL2,bpp:8},33326:{gl2:EXT_FLOAT_WEBGL2,bpp:4},33328:{gl2:EXT_FLOAT_WEBGL2,bpp:8},34836:{gl2:EXT_FLOAT_WEBGL2,bpp:16},35898:{gl2:EXT_FLOAT_WEBGL2,bpp:4}};function isFormatSupported(e,t,r){t=r[t];if(!t)return!1;t=isWebGL2$1(e)&&t.gl2||t.gl1;return"string"==typeof t?e.getExtension(t):t}class Renderbuffer extends Resource$1{static isSupported(e,{format:t}={format:null}){return!t||isFormatSupported(e,t,RENDERBUFFER_FORMATS)}static getSamplesForFormat(e,{format:t}){return e.getInternalformatParameter(36161,t,32937)}constructor(e,t={}){super(e,t),this.initialize(t),Object.seal(this)}initialize({format:e,width:t=1,height:r=1,samples:i=0}){return assert$4(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==i&&isWebGL2$1(this.gl)?this.gl.renderbufferStorageMultisample(36161,i,e,t,r):this.gl.renderbufferStorage(36161,e,t,r),this.format=e,this.width=t,this.height=r,this.samples=i,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*RENDERBUFFER_FORMATS[this.format].bpp),this}resize({width:e,height:t}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const GL_DEPTH_BUFFER_BIT=256,GL_STENCIL_BUFFER_BIT=1024,GL_COLOR_BUFFER_BIT=16384,GL_COLOR=6144,GL_DEPTH=6145,GL_STENCIL=6146,GL_DEPTH_STENCIL=34041,ERR_ARGUMENTS="clear: bad arguments";function clear(e,{framebuffer:t=null,color:r=null,depth:i=null,stencil:n=null}={}){const a={};t&&(a.framebuffer=t);let s=0;r&&(s|=GL_COLOR_BUFFER_BIT,!0!==r&&(a.clearColor=r)),i&&(s|=GL_DEPTH_BUFFER_BIT,!0!==i&&(a.clearDepth=i)),n&&(s|=GL_STENCIL_BUFFER_BIT,!0!==i&&(a.clearStencil=i)),assert$4(0!==s,ERR_ARGUMENTS),withParameters(e,a,()=>{e.clear(s)})}function clearBuffer(r,{framebuffer:e=null,buffer:i=GL_COLOR,drawBuffer:n=0,value:a=[0,0,0,0]}={}){assertWebGL2Context(r),withParameters(r,{framebuffer:e},()=>{switch(i){case GL_COLOR:switch(a.constructor){case Int32Array:r.clearBufferiv(i,n,a);break;case Uint32Array:r.clearBufferuiv(i,n,a);break;default:Float32Array;r.clearBufferfv(i,n,a)}break;case GL_DEPTH:r.clearBufferfv(GL_DEPTH,0,[a]);break;case GL_STENCIL:r.clearBufferiv(GL_STENCIL,0,[a]);break;case GL_DEPTH_STENCIL:var[e,t]=a;r.clearBufferfi(GL_DEPTH_STENCIL,0,e,t);break;default:assert$4(!1,ERR_ARGUMENTS)}})}function glFormatToComponents(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return assert$4(!1),0}}function readPixelsToArray(e,t={}){var{sourceX:r=0,sourceY:i=0,sourceFormat:n=6408}=t;let{sourceAttachment:a=36064,target:s=null,sourceWidth:o,sourceHeight:l,sourceType:c}=t;const{framebuffer:h,deleteFramebuffer:u}=getFramebuffer$1(e);assert$4(h);const{gl:d,handle:p,attachments:f}=h;o=o||h.width,l=l||h.height,36064===a&&null===p&&(a=1028),assert$4(f[a]),s=getPixelArray(s,c=c||f[a].type,n,o,l),c=c||getGLTypeFromTypedArray(s);e=d.bindFramebuffer(36160,p);return d.readPixels(r,i,o,l,n,c,s),d.bindFramebuffer(36160,e||null),u&&h.delete(),s}function copyToDataUrl(e,{sourceAttachment:t=36064,targetMaxHeight:r=Number.MAX_SAFE_INTEGER}={}){let i=readPixelsToArray(e,{sourceAttachment:t}),{width:n,height:a}=e;for(;a>r;)({data:i,width:n,height:a}=scalePixels({data:i,width:n,height:a}));flipRows({data:i,width:n,height:a});const s=document.createElement("canvas");s.width=n,s.height=a;const o=s.getContext("2d"),l=o.createImageData(n,a);return l.data.set(i),o.putImageData(l,0,0),s.toDataURL()}function copyToTexture(e,t,r={}){var{sourceX:i=0,sourceY:n=0,targetMipmaplevel:a=0,targetInternalFormat:s=6408}=r;let{targetX:o,targetY:l,targetZ:c,width:h,height:u}=r;const{framebuffer:d,deleteFramebuffer:p}=getFramebuffer$1(e);assert$4(d);const{gl:f,handle:m}=d;r=void 0!==o||void 0!==l||void 0!==c;o=o||0,l=l||0,c=c||0;e=f.bindFramebuffer(36160,m);assert$4(t);let g=null;if(t instanceof Texture$1&&(g=t,h=Number.isFinite(h)?h:g.width,u=Number.isFinite(u)?u:g.height,g.bind(0),t=g.target),r)switch(t){case 3553:case 34067:f.copyTexSubImage2D(t,a,o,l,i,n,h,u);break;case 35866:case 32879:const _=assertWebGL2Context(f);_.copyTexSubImage3D(t,a,o,l,c,i,n,h,u)}else f.copyTexImage2D(t,a,s,i,n,h,u,0);return g&&g.unbind(),f.bindFramebuffer(36160,e||null),p&&d.delete(),g}function getFramebuffer$1(e){return e instanceof Framebuffer?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:toFramebuffer(e),deleteFramebuffer:!0}}function getPixelArray(e,t,r,i,n){if(e)return e;const a=getTypedArrayFromGLType(t=t||5121,{clamped:!1});r=glFormatToComponents(r);return new a(i*n*r)}const FEATURES$1={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function checkFloat32ColorAttachment(e){const t=new Texture2D(e,{format:6408,type:5126,dataFormat:6408}),r=new Framebuffer(e,{id:"test-framebuffer",check:!1,attachments:{[36064]:t}});e=r.getStatus();return t.delete(),r.delete(),36053===e}var WEBGL_FEATURES$1={[FEATURES$1.WEBGL2]:[!1,!0],[FEATURES$1.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[FEATURES$1.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[FEATURES$1.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[FEATURES$1.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[FEATURES$1.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[FEATURES$1.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[FEATURES$1.FLOAT_BLEND]:["EXT_float_blend"],[FEATURES$1.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[FEATURES$1.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[FEATURES$1.TEXTURE_FLOAT]:["OES_texture_float",!0],[FEATURES$1.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[FEATURES$1.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[FEATURES$1.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[FEATURES$1.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[FEATURES$1.COLOR_ATTACHMENT_RGBA32F]:[checkFloat32ColorAttachment,"EXT_color_buffer_float"],[FEATURES$1.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[FEATURES$1.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[FEATURES$1.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[FEATURES$1.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[FEATURES$1.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[FEATURES$1.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const LOG_UNSUPPORTED_FEATURE=2;function hasFeature(e,t){return hasFeatures$1(e,t)}function hasFeatures$1(t,e){return(e=Array.isArray(e)?e:[e]).every(e=>isFeatureSupported(t,e))}function getFeatures(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in WEBGL_FEATURES$1)void 0===e.luma.caps[t]&&(e.luma.caps[t]=isFeatureSupported(e,t));return e.luma.caps}function isFeatureSupported(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},void 0===e.luma.caps[t]&&(e.luma.caps[t]=queryFeature(e,t)),e.luma.caps[t]||log$1.log(LOG_UNSUPPORTED_FEATURE,`Feature: ${t} not supported`)(),e.luma.caps[t]}function queryFeature(e,t){var r=WEBGL_FEATURES$1[t];assert$4(r,t);let i;const n=isWebGL2$1(e)&&r[1]||r[0];if("function"==typeof n)i=n(e);else if(Array.isArray(n)){i=!0;for(const a of n)i=i&&Boolean(e.getExtension(a))}else"string"==typeof n?i=Boolean(e.getExtension(n)):"boolean"==typeof n?i=n:assert$4(!1);return i}const ERR_MULTIPLE_RENDERTARGETS="Multiple render targets not supported";class Framebuffer extends Resource$1{static isSupported(e,t={}){var{colorBufferFloat:r,colorBufferHalfFloat:t}=t;let i=!0;return r&&(i=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),t&&(i=i&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),i}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Framebuffer(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=assertWebGL2Context(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=assertWebGL2Context(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e,t={}){super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize({width:e=1,height:t=1,attachments:r=null,color:i=!0,depth:n=!0,stencil:a=!1,check:s=!0,readBuffer:o=void 0,drawBuffers:l=void 0}){if(assert$4(0<=e&&0<=t,"Width and height need to be integers"),this.width=e,this.height=t,r)for(const h in r){var c=r[h];const u=Array.isArray(c)?c[0]:c;u.resize({width:e,height:t})}else r=this._createDefaultAttachments(i,n,a,e,t);this.update({clearAttachments:!0,attachments:r,readBuffer:o,drawBuffers:l}),r&&s&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update({attachments:e={},readBuffer:t,drawBuffers:r,clearAttachments:i=!1,resizeAttachments:n=!0}){this.attach(e,{clearAttachments:i,resizeAttachments:n});const a=this["gl"];n=a.bindFramebuffer(36160,this.handle);return t&&this._setReadBuffer(t),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,n||null),this}resize(e={}){let{width:t,height:r}=e;if(null===this.handle)return assert$4(void 0===t&&void 0===r),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===t&&(t=this.gl.drawingBufferWidth),void 0===r&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&log$1.log(2,`Resizing framebuffer ${this.id} to ${t}x${r}`)();for(const i in this.attachments)this.attachments[i].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e,{clearAttachments:t=!1,resizeAttachments:r=!0}={}){const i={};t&&Object.keys(this.attachments).forEach(e=>{i[e]=null}),Object.assign(i,e);t=this.gl.bindFramebuffer(36160,this.handle);for(const l in i){assert$4(void 0!==l,"Misspelled framebuffer binding point?");var n,a,s=Number(l),o=i[s];let e=o;e?e instanceof Renderbuffer?this._attachRenderbuffer({attachment:s,renderbuffer:e}):Array.isArray(o)?([n,a=0,o=0]=o,e=n,this._attachTexture({attachment:s,texture:n,layer:a,level:o})):this._attachTexture({attachment:s,texture:e,layer:0,level:0}):this._unattach(s),r&&e&&e.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,t||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(e=>!this.attachments[e]).forEach(e=>{delete this.attachments[e]})}checkStatus(){var e=this.getStatus();if(36053!==e)throw new Error(_getFrameBufferStatus(e));return this}getStatus(){const e=this["gl"];var t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(e={}){const{color:t,depth:r,stencil:i,drawBuffers:n=[]}=e;e=this.gl.bindFramebuffer(36160,this.handle);return(t||r||i)&&clear(this.gl,{color:t,depth:r,stencil:i}),n.forEach((e,t)=>{clearBuffer(this.gl,{drawBuffer:t,value:e})}),this.gl.bindFramebuffer(36160,e||null),this}readPixels(e=0){return null}readPixelsToBuffer(e=0){return null}copyToDataUrl(e=0){return null}copyToImage(e=0){return null}copyToTexture(e=0){return null}blit(e=0){return null}invalidate({attachments:e=[],x:t=0,y:r=0,width:i,height:n}){const a=assertWebGL2Context(this.gl);var s=a.bindFramebuffer(36008,this.handle);return 0===t&&0===r&&void 0===i&&void 0===n?a.invalidateFramebuffer(36008,e):a.invalidateFramebuffer(36008,e,t,r,i,n),a.bindFramebuffer(36008,s),this}getAttachmentParameter(e,t,r){let i=this._getAttachmentParameterFallback(t);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&1e3<i&&(i=getKey(this.gl,i)),i}getAttachmentParameters(e=36064,t,r=this.constructor.ATTACHMENT_PARAMETERS||[]){const i={};for(const a of r){var n=t?getKey(this.gl,a):a;i[n]=this.getAttachmentParameter(e,a,t)}return i}getParameters(e=!0){const t={};for(const n of Object.keys(this.attachments)){var r=Number(n),i=e?getKey(this.gl,r):r;t[i]=this.getAttachmentParameters(r,e)}return t}show(){return"undefined"!=typeof window&&window.open(copyToDataUrl(this),"luma-debug-texture"),this}log(e=0,t=""){if(e>log$1.level||"undefined"==typeof window)return this;t=t||`Framebuffer ${this.id}`;var r=copyToDataUrl(this,{targetMaxHeight:100});return log$1.image({logLevel:e,message:t,image:r},t)(),this}bind({target:e=36160}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=36160}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,i,n){let a=null;return e&&(a=a||{},a[36064]=new Texture2D(this.gl,{id:`${this.id}-color0`,pixels:null,format:6408,type:5121,width:i,height:n,mipmaps:!1,parameters:{[10241]:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),t&&r?(a=a||{},a[33306]=new Renderbuffer(this.gl,{id:`${this.id}-depth-stencil`,format:35056,width:i,height:111}),this.ownResources.push(a[33306])):t?(a=a||{},a[36096]=new Renderbuffer(this.gl,{id:`${this.id}-depth`,format:33189,width:i,height:n}),this.ownResources.push(a[36096])):r&&assert$4(!1),a}_unattach(e){var t=this.attachments[e];t&&(t instanceof Renderbuffer?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=36064,renderbuffer:t}){const r=this["gl"];r.framebufferRenderbuffer(36160,e,36161,t.handle),this.attachments[e]=t}_attachTexture({attachment:e=36064,texture:t,layer:r,level:i}){const n=this["gl"];switch(n.bindTexture(t.target,t.handle),t.target){case 35866:case 32879:const s=assertWebGL2Context(n);s.framebufferTextureLayer(36160,e,t.target,i,r);break;case 34067:var a=mapIndexToCubeMapFace(r);n.framebufferTexture2D(36160,e,a,t.handle,i);break;case 3553:n.framebufferTexture2D(36160,e,3553,t.handle,i);break;default:assert$4(!1,"Illegal texture type")}n.bindTexture(t.target,null),this.attachments[e]=t}_setReadBuffer(e){const t=getWebGL2Context(this.gl);t?t.readBuffer(e):assert$4(36064===e||1029===e,ERR_MULTIPLE_RENDERTARGETS),this.readBuffer=e}_setDrawBuffers(e){const t=this["gl"],r=assertWebGL2Context(t);if(r)r.drawBuffers(e);else{const i=t.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):assert$4(1===e.length&&(36064===e[0]||1029===e[0]),ERR_MULTIPLE_RENDERTARGETS)}this.drawBuffers=e}_getAttachmentParameterFallback(e){var t=getFeatures(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return t.WEBGL2||t.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function mapIndexToCubeMapFace(e){return e<34069?e+34069:e}function _getFrameBufferStatus(e){return(Framebuffer.STATUS||{})[e]||`Framebuffer error ${e}`}const FRAMEBUFFER_ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];function cloneTextureFrom(e,t){assert$4(e instanceof Texture2D||e instanceof TextureCube||e instanceof Texture3D);const r=e.constructor;var{gl:i,width:n,height:a,format:s,type:o,dataFormat:l,border:c,mipmaps:e}=e,t=Object.assign({width:n,height:a,format:s,type:o,dataFormat:l,border:c,mipmaps:e},t);return new r(i,t)}function toFramebuffer(e,t){var{gl:r,width:i,height:n,id:a}=e;return new Framebuffer(r,Object.assign({},t,{id:`framebuffer-for-${a}`,width:i,height:n,attachments:{[36064]:e}}))}function getShaderName$1(e,t="unnamed"){e=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return e?e[1]:t}Framebuffer.ATTACHMENT_PARAMETERS=FRAMEBUFFER_ATTACHMENT_PARAMETERS;const GL_FRAGMENT_SHADER=35632,GL_VERTEX_SHADER=35633;function getShaderTypeName(e){switch(e){case GL_FRAGMENT_SHADER:return"fragment";case GL_VERTEX_SHADER:return"vertex";default:return"unknown type"}}function parseGLSLCompilerError(t,e,r,i){var n=t.split(/\r?\n/);const a={},s={};var i=i||getShaderName$1(e)||"(unnamed)",o=`${getShaderTypeName(r)} shader ${i}`;for(let e=0;e<n.length;e++){const h=n[e];if(!(h.length<=1)){var l=h.split(":"),c=l[0],l=parseInt(l[2],10);if(isNaN(l))throw new Error(`GLSL compilation error in ${o}: ${t}`);"WARNING"!==c?a[l]=h:s[l]=h}}e=addLineNumbers$1(e);return{shaderName:o,errors:formatErrors(a,e),warnings:formatErrors(s,e)}}function formatErrors(t,r){let i="";for(let e=0;e<r.length;e++){var n=r[e];if((t[e+3]||t[e+2]||t[e+1])&&(i+=`${n}\n`,t[e+1])){const o=t[e+1],l=o.split(":",3);var a=l[0],s=parseInt(l[1],10)||0,n=o.substring(l.join(":").length+1).trim();i+=padLeft(`^^^ ${a}: ${n}\n\n`,s)}}return i}function addLineNumbers$1(e,i=1,n=": "){const t=e.split(/\r?\n/),a=String(t.length+i-1).length;return t.map((e,t)=>{var r=String(t+i),t=r.length;return padLeft(r,a-t)+n+e})}function padLeft(e,t){let r="";for(let e=0;e<t;++e)r+=" ";return`${r}${e}`}function getShaderVersion(e){let t=100;e=e.match(/[^\s]+/g);return 2<=e.length&&"#version"===e[0]&&(e=parseInt(e[1],10),Number.isFinite(e)&&(t=e)),t}const ERR_SOURCE="Shader: GLSL source code must be a JavaScript string";class Shader extends Resource$1{static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return assert$4(!1),"unknown"}}constructor(e,t){assertWebGLContext(e),assert$4("string"==typeof t.source,ERR_SOURCE),super(e,{id:getShaderName$1(t.source,null)||t.id||uid(`unnamed ${Shader.getTypeName(t.shaderType)}`)}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize({source:e}){var t=getShaderName$1(e,null);t&&(this.id=uid(t)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${Shader.getTypeName(this.shaderType)}:${this.id}`}getName(){return getShaderName$1(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(e=this.source){if(e.startsWith("#version ")||(e=`#version 100\n${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var{shaderName:t,warnings:e}=parseGLSLCompilerError(this.gl.getShaderInfoLog(this.handle),this.source,this.shaderType,this.id);throw log$1.warn(`GLSL compilation warnings in ${t}\n${e}`)(),new Error(`GLSL compilation errors in ${t}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class VertexShader extends Shader{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class FragmentShader extends Shader{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const UNIFORM_SETTERS={[5126]:getArraySetter.bind(null,"uniform1fv",toFloatArray,1,setVectorUniform),35664:getArraySetter.bind(null,"uniform2fv",toFloatArray,2,setVectorUniform),35665:getArraySetter.bind(null,"uniform3fv",toFloatArray,3,setVectorUniform),35666:getArraySetter.bind(null,"uniform4fv",toFloatArray,4,setVectorUniform),5124:getArraySetter.bind(null,"uniform1iv",toIntArray,1,setVectorUniform),35667:getArraySetter.bind(null,"uniform2iv",toIntArray,2,setVectorUniform),35668:getArraySetter.bind(null,"uniform3iv",toIntArray,3,setVectorUniform),35669:getArraySetter.bind(null,"uniform4iv",toIntArray,4,setVectorUniform),35670:getArraySetter.bind(null,"uniform1iv",toIntArray,1,setVectorUniform),35671:getArraySetter.bind(null,"uniform2iv",toIntArray,2,setVectorUniform),35672:getArraySetter.bind(null,"uniform3iv",toIntArray,3,setVectorUniform),35673:getArraySetter.bind(null,"uniform4iv",toIntArray,4,setVectorUniform),35674:getArraySetter.bind(null,"uniformMatrix2fv",toFloatArray,4,setMatrixUniform),35675:getArraySetter.bind(null,"uniformMatrix3fv",toFloatArray,9,setMatrixUniform),35676:getArraySetter.bind(null,"uniformMatrix4fv",toFloatArray,16,setMatrixUniform),35678:getSamplerSetter,35680:getSamplerSetter,5125:getArraySetter.bind(null,"uniform1uiv",toUIntArray,1,setVectorUniform),36294:getArraySetter.bind(null,"uniform2uiv",toUIntArray,2,setVectorUniform),36295:getArraySetter.bind(null,"uniform3uiv",toUIntArray,3,setVectorUniform),36296:getArraySetter.bind(null,"uniform4uiv",toUIntArray,4,setVectorUniform),35685:getArraySetter.bind(null,"uniformMatrix2x3fv",toFloatArray,6,setMatrixUniform),35686:getArraySetter.bind(null,"uniformMatrix2x4fv",toFloatArray,8,setMatrixUniform),35687:getArraySetter.bind(null,"uniformMatrix3x2fv",toFloatArray,6,setMatrixUniform),35688:getArraySetter.bind(null,"uniformMatrix3x4fv",toFloatArray,12,setMatrixUniform),35689:getArraySetter.bind(null,"uniformMatrix4x2fv",toFloatArray,8,setMatrixUniform),35690:getArraySetter.bind(null,"uniformMatrix4x3fv",toFloatArray,12,setMatrixUniform),35678:getSamplerSetter,35680:getSamplerSetter,35679:getSamplerSetter,35682:getSamplerSetter,36289:getSamplerSetter,36292:getSamplerSetter,36293:getSamplerSetter,36298:getSamplerSetter,36299:getSamplerSetter,36300:getSamplerSetter,36303:getSamplerSetter,36306:getSamplerSetter,36307:getSamplerSetter,36308:getSamplerSetter,36311:getSamplerSetter},FLOAT_ARRAY={},INT_ARRAY={},UINT_ARRAY={},array1=[0];function toTypedArray(t,e,r,i){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(array1[0]=t,t=array1);var n=t.length;if(n%e&&log$1.warn(`Uniform size should be multiples of ${e}`,t)(),t instanceof r)return t;let a=i[n];a||(a=new r(n),i[n]=a);for(let e=0;e<n;e++)a[e]=t[e];return a}function toFloatArray(e,t){return toTypedArray(e,t,Float32Array,FLOAT_ARRAY)}function toIntArray(e,t){return toTypedArray(e,t,Int32Array,INT_ARRAY)}function toUIntArray(e,t){return toTypedArray(e,t,Uint32Array,UINT_ARRAY)}function getUniformSetter(e,t,r){const i=UNIFORM_SETTERS[r.type];if(!i)throw new Error(`Unknown GLSL uniform type ${r.type}`);return i().bind(null,e,t)}function parseUniformName(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function checkUniformValues(e,t,r){for(const n in e){var i=e[n];if((!r||Boolean(r[n]))&&!checkUniformValue(i))throw t=t?`${t} `:"",console.error(`${t} Bad uniform ${n}`,i),new Error(`${t} Bad uniform ${n}`)}return!0}function checkUniformValue(e){return Array.isArray(e)||ArrayBuffer.isView(e)?checkUniformArray(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof Texture$1||(e instanceof Renderbuffer||e instanceof Framebuffer&&Boolean(e.texture))))}function copyUniform(e,t,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(e[t]){const i=e[t];for(let e=0,t=r.length;e<t;++e)i[e]=r[e]}else e[t]=r.slice();else e[t]=r}function checkUniformArray(t){if(0===t.length)return!1;var r=Math.min(t.length,16);for(let e=0;e<r;++e)if(!Number.isFinite(t[e]))return!1;return!0}function getSamplerSetter(){let n=null;return(e,t,r)=>{var i=n!==r;return i&&(e.uniform1i(t,r),n=r),i}}function getArraySetter(s,o,l,c){let h=null,u=null;return(e,t,r)=>{var i=o(r,l),n=i.length;let a=!1;if(null===h)h=new Float32Array(n),u=n,a=!0;else{assert$4(u===n,"Uniform length cannot change.");for(let e=0;e<n;++e)if(i[e]!==h[e]){a=!0;break}}return a&&(c(e,s,t,i),h.set(i)),a}}function setVectorUniform(e,t,r,i){e[t](r,i)}function setMatrixUniform(e,t,r,i){e[t](r,!1,i)}const GL_BYTE=5120,GL_UNSIGNED_BYTE=5121,GL_SHORT=5122,GL_UNSIGNED_SHORT=5123,GL_POINTS=0,GL_LINES=1,GL_LINE_LOOP=2,GL_LINE_STRIP=3,GL_TRIANGLES=4,GL_TRIANGLE_STRIP=5,GL_TRIANGLE_FAN=6,GL_FLOAT=5126,GL_FLOAT_VEC2=35664,GL_FLOAT_VEC3=35665,GL_FLOAT_VEC4=35666,GL_INT=5124,GL_INT_VEC2=35667,GL_INT_VEC3=35668,GL_INT_VEC4=35669,GL_UNSIGNED_INT=5125,GL_UNSIGNED_INT_VEC2=36294,GL_UNSIGNED_INT_VEC3=36295,GL_UNSIGNED_INT_VEC4=36296,GL_BOOL=35670,GL_BOOL_VEC2=35671,GL_BOOL_VEC3=35672,GL_BOOL_VEC4=35673,GL_FLOAT_MAT2=35674,GL_FLOAT_MAT3=35675,GL_FLOAT_MAT4=35676,GL_FLOAT_MAT2x3=35685,GL_FLOAT_MAT2x4=35686,GL_FLOAT_MAT3x2=35687,GL_FLOAT_MAT3x4=35688,GL_FLOAT_MAT4x2=35689,GL_FLOAT_MAT4x3=35690,COMPOSITE_GL_TYPES={[GL_FLOAT]:[GL_FLOAT,1,"float"],[GL_FLOAT_VEC2]:[GL_FLOAT,2,"vec2"],[GL_FLOAT_VEC3]:[GL_FLOAT,3,"vec3"],[GL_FLOAT_VEC4]:[GL_FLOAT,4,"vec4"],[GL_INT]:[GL_INT,1,"int"],[GL_INT_VEC2]:[GL_INT,2,"ivec2"],[GL_INT_VEC3]:[GL_INT,3,"ivec3"],[GL_INT_VEC4]:[GL_INT,4,"ivec4"],[GL_UNSIGNED_INT]:[GL_UNSIGNED_INT,1,"uint"],[GL_UNSIGNED_INT_VEC2]:[GL_UNSIGNED_INT,2,"uvec2"],[GL_UNSIGNED_INT_VEC3]:[GL_UNSIGNED_INT,3,"uvec3"],[GL_UNSIGNED_INT_VEC4]:[GL_UNSIGNED_INT,4,"uvec4"],[GL_BOOL]:[GL_FLOAT,1,"bool"],[GL_BOOL_VEC2]:[GL_FLOAT,2,"bvec2"],[GL_BOOL_VEC3]:[GL_FLOAT,3,"bvec3"],[GL_BOOL_VEC4]:[GL_FLOAT,4,"bvec4"],[GL_FLOAT_MAT2]:[GL_FLOAT,8,"mat2"],[GL_FLOAT_MAT2x3]:[GL_FLOAT,8,"mat2x3"],[GL_FLOAT_MAT2x4]:[GL_FLOAT,8,"mat2x4"],[GL_FLOAT_MAT3]:[GL_FLOAT,12,"mat3"],[GL_FLOAT_MAT3x2]:[GL_FLOAT,12,"mat3x2"],[GL_FLOAT_MAT3x4]:[GL_FLOAT,12,"mat3x4"],[GL_FLOAT_MAT4]:[GL_FLOAT,16,"mat4"],[GL_FLOAT_MAT4x2]:[GL_FLOAT,16,"mat4x2"],[GL_FLOAT_MAT4x3]:[GL_FLOAT,16,"mat4x3"]};function getPrimitiveDrawMode(e){switch(e){case GL_POINTS:return GL_POINTS;case GL_LINES:case GL_LINE_STRIP:case GL_LINE_LOOP:return GL_LINES;case GL_TRIANGLES:case GL_TRIANGLE_STRIP:case GL_TRIANGLE_FAN:return GL_TRIANGLES;default:return assert$4(!1),0}}function decomposeCompositeGLType(e){var t=COMPOSITE_GL_TYPES[e];if(!t)return null;var[e,t]=t;return{type:e,components:t}}function getCompositeGLType(e,t){switch(e){case GL_BYTE:case GL_UNSIGNED_BYTE:case GL_SHORT:case GL_UNSIGNED_SHORT:e=GL_FLOAT}for(const a in COMPOSITE_GL_TYPES){var[r,i,n]=COMPOSITE_GL_TYPES[a];if(r===e&&i===t)return{glType:a,name:n}}return null}class ProgramConfiguration{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){var t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){e=this.getAttributeInfo(e);return e?e.location:-1}getAttributeAccessor(e){e=this.getAttributeInfo(e);return e?e.accessor:null}getVaryingInfo(e){var t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){var t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){var t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(t){const r=t["gl"];var i=r.getProgramParameter(t.handle,35721);for(let e=0;e<i;e++){var{name:n,type:a,size:s}=r.getActiveAttrib(t.handle,e),o=r.getAttribLocation(t.handle,n);0<=o&&this._addAttribute(o,n,a,s)}this.attributeInfos.sort((e,t)=>e.location-t.location)}_readVaryingsFromProgram(t){const r=t["gl"];if(isWebGL2$1(r)){var i=r.getProgramParameter(t.handle,35971);for(let e=0;e<i;e++){var{name:n,type:a,size:s}=r.getTransformFeedbackVarying(t.handle,e);this._addVarying(e,n,a,s)}this.varyingInfos.sort((e,t)=>e.location-t.location)}}_addAttribute(e,t,r,i){var{type:n,components:r}=decomposeCompositeGLType(r),r={type:n,size:i*r};this._inferProperties(e,t,r);r={location:e,name:t,accessor:new Accessor(r)};this.attributeInfos.push(r),this.attributeInfosByLocation[e]=r,this.attributeInfosByName[r.name]=r}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,i){var{type:n,components:r}=decomposeCompositeGLType(r),r={location:e,name:t,accessor:new Accessor({type:n,size:i*r})};this.varyingInfos.push(r),this.varyingInfosByName[r.name]=r}}const LOG_PROGRAM_PERF_PRIORITY=4,GL_SEPARATE_ATTRIBS=35981,V6_DEPRECATED_METHODS=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Program extends Resource$1{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Program","v6.0",V6_DEPRECATED_METHODS),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(e={}){var{hash:t,vs:r,fs:i,varyings:n,bufferMode:a=GL_SEPARATE_ATTRIBS}=e;return this.hash=t||"",this.vs="string"==typeof r?new VertexShader(this.gl,{id:`${e.id}-vs`,source:r}):r,this.fs="string"==typeof i?new FragmentShader(this.gl,{id:`${e.id}-fs`,source:i}):i,assert$4(this.vs instanceof VertexShader),assert$4(this.fs instanceof FragmentShader),this.uniforms={},this._textureUniforms={},n&&0<n.length&&(assertWebGL2Context(this.gl),this.varyings=n,this.gl2.transformFeedbackVaryings(this.handle,n,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new ProgramConfiguration(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:t=4,vertexCount:r,offset:i=0,start:n,end:a,isIndexed:s=!1,indexType:o=5123,instanceCount:l=0,isInstanced:c=0<l,vertexArray:h=null,transformFeedback:u,framebuffer:d,parameters:p={},uniforms:f,samplers:m}){return(f||m)&&(log$1.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(f||{})),log$1.priority>=e&&(f=d?d.id:"default",f=`mode=${getKey(this.gl,t)} verts=${r} `+`instances=${l} indexType=${getKey(this.gl,o)} `+`isInstanced=${c} isIndexed=${s} `+`Framebuffer=${f}`,log$1.log(e,f)()),assert$4(h),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===r||c&&0===l)&&(h.bindForDraw(r,l,()=>{var e;void 0!==d&&(p=Object.assign({},p,{framebuffer:d})),u&&(e=getPrimitiveDrawMode(t),u.begin(e)),this._bindTextures(),withParameters(this.gl,p,()=>{s&&c?this.gl2.drawElementsInstanced(t,r,o,i,l):s&&isWebGL2$1(this.gl)&&!isNaN(n)&&!isNaN(a)?this.gl2.drawRangeElements(t,n,a,r,o,i):s?this.gl.drawElements(t,r,o,i):c?this.gl2.drawArraysInstanced(t,i,r,l):this.gl.drawArrays(t,i,r)}),u&&u.end()}),!0)}setUniforms(e={}){2<=log$1.priority&&checkUniformValues(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){var r=e[n];const a=this._uniformSetters[n];if(a){let e=r,t=!1;if(e instanceof Framebuffer&&(e=e.texture),e instanceof Texture$1)if(t=this.uniforms[n]!==r,t){void 0===a.textureIndex&&(a.textureIndex=this._textureIndexCounter++);const s=e;var i=a["textureIndex"];s.bind(i),e=i,this._textureUniforms[n]=s}else e=a.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(a(e)||t)&&copyUniform(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const t in this._textureUniforms){var e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t={};for(const r of this.gl.getAttachedShaders(e))switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:t.vs=new VertexShader({handle:r});break;case 35632:t.fs=new FragmentShader({handle:r})}return t}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){e||(e=this._getName(),this.id=uid(e))}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?`${e}-program`:"program",e}_compileAndLink(){const e=this["gl"];if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),log$1.time(LOG_PROGRAM_PERF_PRIORITY,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),log$1.timeEnd(LOG_PROGRAM_PERF_PRIORITY,`linkProgram for ${this._getName()}`)(),e.debug||0<log$1.level){if(!e.getProgramParameter(this.handle,35714))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`);if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error(`Error validating: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const t=this["gl"];this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){var r=this.gl.getActiveUniform(this.handle,e),i=parseUniformName(r.name)["name"],n=t.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=getUniformSetter(t,n,r),1<r.size)for(let e=0;e<r.size;e++)n=t.getUniformLocation(this.handle,`${i}[${e}]`),this._uniformSetters[`${i}[${e}]`]=getUniformSetter(t,n,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const GL_QUERY_RESULT=34918,GL_QUERY_RESULT_AVAILABLE=34919,GL_TIME_ELAPSED_EXT=35007,GL_GPU_DISJOINT_EXT=36795,GL_TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976,GL_ANY_SAMPLES_PASSED=35887,GL_ANY_SAMPLES_PASSED_CONSERVATIVE=36202;class Query extends Resource$1{static isSupported(e,t=[]){var r=isWebGL2$1(e),i=hasFeatures$1(e,FEATURES$1.TIMER_QUERY);let n=r||i;for(const a of t)switch(a){case"queries":n=n&&r;break;case"timers":n=n&&i;break;default:assert$4(!1)}return n}constructor(e,t={}){super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(GL_TIME_ELAPSED_EXT)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?GL_ANY_SAMPLES_PASSED_CONSERVATIVE:GL_ANY_SAMPLES_PASSED)}beginTransformFeedbackQuery(){return this.begin(GL_TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN)}begin(e){return this._queryPending||(this.target=e,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;var e=this.gl2.getQueryParameter(this.handle,GL_QUERY_RESULT_AVAILABLE);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(GL_GPU_DISJOINT_EXT)}getResult(){return this.gl2.getQueryParameter(this.handle,GL_QUERY_RESULT)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((e,t)=>{const r=()=>{this.isResultAvailable()?(e(this.getResult()),this._pollingPromise=null):n++>i?(t("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}_createHandle(){return Query.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class TransformFeedback extends Resource$1{static isSupported(e){return isWebGL2$1(e)}constructor(e,t={}){assertWebGL2Context(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,isObjectEmpty(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"buffers"in(e="bindOnUse"in e?e.bindOnUse:e)&&this.setBuffers(e.buffers)}setBuffers(t={}){return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(e,t){var r=this._getVaryingIndex(e),{buffer:i,byteSize:n,byteOffset:a}=this._getBufferParams(t);return r<0?(this.unused[e]=i,log$1.warn(()=>`${this.id} unused varying buffer ${e}`)()):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,i,a,n)),this}begin(e=0){return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,i;return e instanceof Buffer$1==!1?(i=e.buffer,r=e.byteSize,t=e.byteOffset):i=e,void 0===t&&void 0===r||(t=t||0,r=r||i.byteLength-t),{buffer:i,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;e=Number(e);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const i in this.buffers){var{buffer:e,byteSize:t,byteOffset:r}=this._getBufferParams(this.buffers[i]);this._bindBuffer(i,e,r,t)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t,r=0,i){t=t&&t.handle;return t&&void 0!==i?this.gl.bindBufferRange(35982,e,t,r,i):this.gl.bindBufferBase(35982,e,t),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let arrayBuffer=null;function getScratchArrayBuffer(e){return(!arrayBuffer||arrayBuffer.byteLength<e)&&(arrayBuffer=new ArrayBuffer(e)),arrayBuffer}function getScratchArray(e,t){return new e(getScratchArrayBuffer(e.BYTES_PER_ELEMENT*t),0,t)}function fillArray$1({target:t,source:r,start:i=0,count:e=1}){var n=r.length,a=e*n;let s=0;for(let e=i;s<n;s++)t[e++]=r[s];for(;s<a;)s<a-s?(t.copyWithin(i+s,i,i+s),s*=2):(t.copyWithin(i+s,i,i+a-s),s=a);return t}const ERR_ELEMENTS="elements must be GL.ELEMENT_ARRAY_BUFFER";class VertexArrayObject extends Resource$1{static isSupported(e,t={}){return!t.constantAttributeZero||(isWebGL2$1(e)||"Chrome"===getBrowser$3())}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new VertexArrayObject(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return VertexArrayObject.MAX_ATTRIBUTES=VertexArrayObject.MAX_ATTRIBUTES||e.getParameter(34921),VertexArrayObject.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:VertexArrayObject._setConstantFloatArray(e,t,r);break;case Int32Array:VertexArrayObject._setConstantIntArray(e,t,r);break;case Uint32Array:VertexArrayObject._setConstantUintArray(e,t,r);break;default:assert$4(!1)}}constructor(e,t={}){var r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return VertexArrayObject.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,t){return assert$4(!e||34963===e.target,ERR_ELEMENTS),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(34963===t.target)return this.setElementBuffer(t,r);const{size:i,type:n,stride:a,offset:s,normalized:o,integer:l,divisor:c}=r,{gl:h,gl2:u}=this;return e=Number(e),this.bind(()=>{h.bindBuffer(34962,t.handle),l?(assert$4(isWebGL2$1(h)),u.vertexAttribIPointer(e,i,n,a,s)):h.vertexAttribPointer(e,i,n,o,a,s),h.enableVertexAttribArray(e),u.vertexAttribDivisor(e,c||0)}),this}enable(e,t=!0){return!t&&0===e&&!VertexArrayObject.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){var r=this._normalizeConstantArrayValue(t),i=r.byteLength*e,n=r.length*e,e=!this.buffer;return this.buffer=this.buffer||new Buffer$1(this.gl,i),(e=(e=e||this.buffer.reallocate(i))||!this._compareConstantArrayValues(r,this.bufferValue))&&(fillArray$1({target:e=getScratchArray(t.constructor,n),source:r,start:0,count:n}),this.buffer.subData(e),this.bufferValue=t),this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(t,r){if(!t||!r||t.length!==r.length||t.constructor!==r.constructor)return!1;for(let e=0;e<t.length;++e)if(t[e]!==r[e])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:assert$4(!1)}}static _setConstantIntArray(e,t,r){switch(assert$4(isWebGL2$1(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:assert$4(!1)}}static _setConstantUintArray(e,t,r){switch(assert$4(isWebGL2$1(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:assert$4(!1)}}_createHandle(){const e=this.gl;return e.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,{location:t}){return assert$4(Number.isFinite(t)),this.bind(()=>34373!==e?this.gl.getVertexAttrib(t,e):this.gl.getVertexAttribOffset(t,e))}}const ERR_ATTRIBUTE_TYPE="VertexArray: attributes must be Buffers or constants (i.e. typed array)",MULTI_LOCATION_ATTRIBUTE_REGEXP=/^(.+)__LOCATION_([0-9]+)$/,DEPRECATIONS_V6=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class VertexArray{constructor(e,t={}){var r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new VertexArrayObject(e),stubRemovedMethods(this,"VertexArray","v6.0",DEPRECATIONS_V6),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;var e=this.vertexArrayObject["MAX_ATTRIBUTES"];return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(r){return Object.assign(this.attributes,r),this.vertexArrayObject.bind(()=>{for(const t in r){var e=r[t];this._setAttribute(t,e)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(e=null,t={}){return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t,r={}){if(34963===t.target)return this.setElementBuffer(t,r);var{location:e,accessor:r}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return 0<=e&&(this.values[e]=t,this.accessors[e]=r,this.clearDrawParams(),this.vertexArrayObject.setBuffer(e,t,r)),this}setConstant(e,t,r={}){var{location:e,accessor:r}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return 0<=e&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[e]=t,this.accessors[e]=r,this.clearDrawParams(),this.vertexArrayObject.enable(e,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Buffer$1(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Buffer$1&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){var t=this.values[e];t instanceof Buffer$1&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),i=r()}),i}_resolveLocationAndAccessor(e,t,r,i){var n={location:-1,accessor:null},{location:a,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,log$1.once(3,()=>`unused value ${e} in ${this.id}`)(),n;s=this._getAttributeInfo(s||a);if(!s)return n;var n=this.accessors[a]||{},n=Accessor.resolve(s.accessor,n,r,i),{size:r,type:i}=n;return assert$4(Number.isFinite(r)&&Number.isFinite(i)),{location:a,accessor:n}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){var t=Number(e);if(Number.isFinite(t))return{location:t};t=MULTI_LOCATION_ATTRIBUTE_REGEXP.exec(e),e=t?t[1]:e,t=t?Number(t[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(e)+t,name:e}:{location:-1}}_setAttribute(e,t){if(t instanceof Buffer$1)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof Buffer$1){var r=t[0],i=t[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(t)||Array.isArray(t))this.setConstant(e,t);else{if(!(t.buffer instanceof Buffer$1))throw new Error(ERR_ATTRIBUTE_TYPE);this.setBuffer(e,t.buffer,t)}}_setConstantAttributes(e,t){t=Math.max(0|e,0|t);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,t);for(let e=1;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)r=this.values[e],ArrayBuffer.isView(r)&&this._setConstantAttribute(e,r)}_setConstantAttributeZero(e,t){VertexArrayObject.isSupported(this.gl,{constantAttributeZero:!0})?this._setConstantAttribute(0,e):(e=this.vertexArrayObject.getConstantBuffer(t,e),this.vertexArrayObject.setBuffer(0,e,this.accessors[0]))}_setConstantAttribute(e,t){VertexArrayObject.setConstant(this.gl,e,t)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(e,t){var r=this.values[t],i=this.accessors[t];if(r){var t=i["divisor"],t=0<t;if(e.isInstanced=e.isInstanced||t,r instanceof Buffer$1){const n=r;t?(t=n.getVertexCount(i),e.instanceCount=Math.min(e.instanceCount,t)):(i=n.getVertexCount(i),e.vertexCount=Math.min(e.vertexCount,i))}}}setElements(e=null,t={}){return log$1.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function formatArrayValue(t,r){var{maxElts:i=16,size:n=1}=r;let a="[";for(let e=0;e<t.length&&e<i;++e)0<e&&(a+=`,${e%n==0?" ":""}`),a+=formatValue$1(t[e],r);var e=t.length>i?"...":"]";return`${a}${e}`}function formatValue$1(e,t={}){var{isInteger:r=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return formatArrayValue(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return r?"0":"0.";if(r)return e.toFixed(0);if(100<Math.abs(e)&&Math.abs(e)<1e4)return e.toFixed(0);const i=e.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function getDebugTableForUniforms({header:e="Uniforms",program:t,uniforms:r,undefinedOnly:i=!1}){assert$4(t);var t=t._uniformSetters,n={},t=Object.keys(t).sort();let a=0;for(const c of t)c.match(".*_.*")||c.match(".*Matrix")||addUniformToTable({table:n,header:e,uniforms:r,uniformName:c,undefinedOnly:i})&&a++;for(const h of t)h.match(".*Matrix")&&addUniformToTable({table:n,header:e,uniforms:r,uniformName:h,undefinedOnly:i})&&a++;for(const u of t)n[u]||addUniformToTable({table:n,header:e,uniforms:r,uniformName:u,undefinedOnly:i})&&a++;let s=0;const o={};if(!i)for(const d in r){var l=r[d];n[d]||(s++,o[d]={Type:`NOT USED: ${l}`,[e]:formatValue$1(l)})}return{table:n,count:a,unusedTable:o,unusedCount:s}}function addUniformToTable({table:e,header:t,uniforms:r,uniformName:i,undefinedOnly:n}){var a=r[i],r=isUniformDefined(a);return(!n||!r)&&(e[i]={[t]:r?formatValue$1(a):"N/A","Uniform Type":r?a:"NOT PROVIDED"},!0)}function isUniformDefined(e){return null!=e}function getDebugTableForVertexArray({vertexArray:t,header:r="Attributes"}){if(!t.configuration)return{};const i={};t.elements&&(i.ELEMENT_ARRAY_BUFFER=getDebugTableRow(t,t.elements,null,r));var n=t.values;for(const o in n){var a=t._getAttributeInfo(o);if(a){let e=`${o}: ${a.name}`;var s=t.accessors[a.location];s&&(e=`${o}: ${getGLSLDeclaration$1(a.name,s)}`),i[e]=getDebugTableRow(t,n[o],s,r)}}return i}function getDebugTableRow(t,r,i,n){var a=t["gl"];if(!r)return{[n]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1;var l,c;let h,u;if(i&&(s=i.type,o=i.size,s=String(s).replace("Array",""),h=-1!==s.indexOf("nt")),r instanceof Buffer$1){const p=r;var{data:d,changed:t}=p.getDebugData(),t=t?"*":"";u=d,l=(c=p.byteLength)/d.BYTES_PER_ELEMENT/o;let e;return e=i?`${0<i.divisor?"I ":"P "} ${l} (x${o}=${c} bytes ${getKey(a,s)})`:(h=!0,`${c} bytes`),{[n]:`${t}${formatValue$1(u,{size:o,isInteger:h})}`,"Format ":e}}return u=r,o=r.length,s=String(r.constructor.name).replace("Array",""),h=-1!==s.indexOf("nt"),{[n]:`${formatValue$1(u,{size:o,isInteger:h})} (constant)`,"Format ":`${o}x${s} (constant)`}}function getGLSLDeclaration$1(e,t){var{type:r,size:t}=t,t=getCompositeGLType(r,t);return t?`${e} (${t.name})`:e}function getDebugTableForProgramConfiguration(e){const t={};var r,i,n=`Accessors for ${e.id}`;for(const a of e.attributeInfos)a&&(r=getGLSLDeclaration(a),t[`in ${r}`]={[n]:JSON.stringify(a.accessor)});for(const s of e.varyingInfos)s&&(i=getGLSLDeclaration(s),t[`out ${i}`]={[n]:JSON.stringify(s.accessor)});return t}function getGLSLDeclaration(e){var{type:t,size:r}=e.accessor,r=getCompositeGLType(t,r);return r?`${r.name} ${e.name}`:e.name}const isPage=env.isBrowser()&&"undefined"!=typeof document;let statIdCounter=0;class AnimationLoop{constructor(e={}){var{onCreateContext:t=e=>createGLContext(e),onAddHTML:r=null,onInitialize:i=()=>{},onRender:n=()=>{},onFinalize:a=()=>{},onError:s,gl:o=null,glOptions:l={},debug:c=!1,createFramebuffer:h=!1,autoResizeViewport:u=!0,autoResizeDrawingBuffer:d=!0,stats:p=lumaStats.get(`animation-loop-${statIdCounter++}`)}=e;let{useDevicePixels:f=!0}=e;"useDevicePixelRatio"in e&&(log$1.deprecated("useDevicePixelRatio","useDevicePixels")(),f=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:i,onRender:n,onFinalize:a,onError:s,gl:o,glOptions:l,debug:c,createFramebuffer:h},this.gl=o,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:u,autoResizeDrawingBuffer:d,useDevicePixels:f}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return assert$4("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Query.isSupported(this.gl,["timers"])?new Query(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(e=>{this._running&&(this._addCallbackData(e||{}),!1!==e&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,t=1){e=document.getElementById(e);return e?Number(e.value):t}setViewParameters(){return log$1.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=isPage?new Promise((e,t)=>{isPage&&"complete"===document.readyState?e(document):window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):cancelAnimationFrame(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):requestAnimationFrame$1(e)}_renderFrame(...e){this.display?this.display._renderFrame(...e):this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){var{width:e,height:t,aspect:r}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){"object"==typeof e&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?instrumentGLContext(this.props.gl,e):this.onCreateContext(e),!isWebGL(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");resetParameters(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(r);var e=this.props.onAddHTML(r);e&&(r.innerHTML=e)}}_getSizeAndAspect(){var e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;var i=this.gl["canvas"];return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:0<e&&0<t&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&resizeGLContext(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Framebuffer(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const e=this.gl["canvas"];e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const VERTEX_SHADER$1="vs",FRAGMENT_SHADER$1="fs";function assert$3(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const TYPE_DEFINITIONS$1={number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},array:{validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function parsePropTypes$1(e){const t={};for(const i in e){var r=parsePropType$1(e[i]);t[i]=r}return t}function parsePropType$1(e){let t=getTypeOf$1(e);return"object"===t?e?"type"in e?Object.assign({},e,TYPE_DEFINITIONS$1[e.type]):"value"in e?(t=getTypeOf$1(e.value),Object.assign({type:t},e,TYPE_DEFINITIONS$1[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},TYPE_DEFINITIONS$1[t])}function getTypeOf$1(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const VERTEX_SHADER="vs",FRAGMENT_SHADER="fs";class ShaderModule{constructor({name:e,vs:t,fs:r,dependencies:i=[],uniforms:n,getUniforms:a,deprecations:s=[],defines:o={},inject:l={},vertexShader:c,fragmentShader:h}){assert$3("string"==typeof e),this.name=e,this.vs=t||c,this.fs=r||h,this.getModuleUniforms=a,this.dependencies=i,this.deprecations=this._parseDeprecationDefinitions(s),this.defines=o,this.injections=normalizeInjections(l),n&&(this.uniforms=parsePropTypes$1(n))}getModuleSource(e){let t;switch(e){case VERTEX_SHADER:t=this.vs||"";break;case FRAGMENT_SHADER:t=this.fs||"";break;default:assert$3(!1)}return`\
#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}
${t}\
// END MODULE_${this.name}

`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(t,r){this.deprecations.forEach(e=>{e.regex.test(t)&&(e.deprecated?r.deprecated(e.old,e.new):r.removed(e.old,e.new))()})}_parseDeprecationDefinitions(e){return e.forEach(e=>{"function"===e.type?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),e}_defaultGetUniforms(e={}){const t={};var r=this.uniforms;for(const i in r){const n=r[i];i in e&&!n.private?(n.validate&&assert$3(n.validate(e[i],n),`${this.name}: invalid ${i}`),t[i]=e[i]):t[i]=n.value}return t}}function normalizeInjections(t){const r={vs:{},fs:{}};for(const n in t){let e=t[n];var i=n.slice(0,2);"string"==typeof e&&(e={order:0,injection:e}),r[i][n]=e}return r}function resolveModules(e){return getShaderDependencies(instantiateModules(e))}function getShaderDependencies(e){const t={},r={};return getDependencyGraph({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((e,t)=>r[t]-r[e]).map(e=>t[e])}function getDependencyGraph({modules:e,level:t,moduleMap:r,moduleDepth:i}){if(5<=t)throw new Error("Possible loop in shader dependency graph");for(const n of e)r[n.name]=n,(void 0===i[n.name]||i[n.name]<t)&&(i[n.name]=t);for(const a of e)a.dependencies&&getDependencyGraph({modules:a.dependencies,level:t+1,moduleMap:r,moduleDepth:i})}function instantiateModules(e,t){return e.map(e=>(e instanceof ShaderModule||(assert$3("string"!=typeof e,`Shader module use by name is deprecated. Import shader module '${e}' and use it directly.`),assert$3(e.name,"shader module has no name"),(e=new ShaderModule(e)).dependencies=instantiateModules(e.dependencies)),e))}function isOldIE(e={}){var t="undefined"!=typeof window&&window.navigator||{};const r=e.userAgent||t.userAgent||"";e=-1!==r.indexOf("MSIE "),t=-1!==r.indexOf("Trident/");return e||t}const GL_VENDOR=7936,GL_RENDERER=7937,GL_VERSION=7938,GL_SHADING_LANGUAGE_VERSION=35724,WEBGL_FEATURES={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},FEATURES={};function isWebGL2(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function getContextInfo(e){var t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||GL_VENDOR),t=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||GL_RENDERER);return{gpuVendor:identifyGPUVendor(r,t),vendor:r,renderer:t,version:e.getParameter(GL_VERSION),shadingLanguageVersion:e.getParameter(GL_SHADING_LANGUAGE_VERSION)}}function identifyGPUVendor(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}Object.keys(WEBGL_FEATURES).forEach(e=>{FEATURES[e]=e});const compiledGlslExtensions={};function canCompileGLGSExtension(e,t,r={}){var i=WEBGL_FEATURES[t];if(assert$3(i,t),!isOldIE(r))return!0;if(t in compiledGlslExtensions)return compiledGlslExtensions[t];i=`#extension GL_${i[0]} : ${r.behavior||"enable"}\nvoid main(void) {}`,r=e.createShader(35633);e.shaderSource(r,i),e.compileShader(r);i=e.getShaderParameter(r,35713);return e.deleteShader(r),compiledGlslExtensions[t]=i}function getFeature(e,t){var r=WEBGL_FEATURES[t];assert$3(r,t);r=isWebGL2(e)&&r[1]||r[0],r="string"==typeof r?Boolean(e.getExtension(r)):r;return assert$3(!1===r||!0===r),r}function hasFeatures(t,e){return(e=Array.isArray(e)?e:[e]).every(e=>getFeature(t,e))}function getPlatformShaderDefines(e){const t=getContextInfo(e);switch(t.gpuVendor.toLowerCase()){case"nvidia":return`\
#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`\
#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return"#define AMD_GPU\n";default:return`\
#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function getVersionDefines(e,t,r){let i=`\
#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return hasFeatures(e,FEATURES.GLSL_FRAG_DEPTH)&&(i+=`\

// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),hasFeatures(e,FEATURES.GLSL_DERIVATIVES)&&canCompileGLGSExtension(e,FEATURES.GLSL_DERIVATIVES)&&(i+=`\

// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),hasFeatures(e,FEATURES.GLSL_FRAG_DATA)&&canCompileGLGSExtension(e,FEATURES.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`\

// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),hasFeatures(e,FEATURES.GLSL_TEXTURE_LOD)&&(i+=`\
// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const MODULE_INJECTORS_VS=`\
#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,MODULE_INJECTORS_FS=`\
#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,MODULE_INJECTORS={[VERTEX_SHADER$1]:MODULE_INJECTORS_VS,[FRAGMENT_SHADER$1]:MODULE_INJECTORS_FS},DECLARATION_INJECT_MARKER="__LUMA_INJECT_DECLARATIONS__",REGEX_START_OF_MAIN$1=/void\s+main\s*\([^)]*\)\s*\{\n?/,REGEX_END_OF_MAIN=/}\n?[^{}]*$/,fragments=[];function injectShader(e,t,r,i=!1){var n=t===VERTEX_SHADER$1;for(const a in r){const s=r[a];s.sort((e,t)=>e.order-t.order),fragments.length=s.length;for(let e=0,t=s.length;e<t;++e)fragments[e]=s[e].injection;const o=`${fragments.join("\n")}\n`;switch(a){case"vs:#decl":n&&(e=e.replace(DECLARATION_INJECT_MARKER,o));break;case"vs:#main-start":n&&(e=e.replace(REGEX_START_OF_MAIN$1,e=>e+o));break;case"vs:#main-end":n&&(e=e.replace(REGEX_END_OF_MAIN,e=>o+e));break;case"fs:#decl":n||(e=e.replace(DECLARATION_INJECT_MARKER,o));break;case"fs:#main-start":n||(e=e.replace(REGEX_START_OF_MAIN$1,e=>e+o));break;case"fs:#main-end":n||(e=e.replace(REGEX_END_OF_MAIN,e=>o+e));break;default:e=e.replace(a,e=>e+o)}}return e=e.replace(DECLARATION_INJECT_MARKER,""),e=i?e.replace(/\}\s*$/,e=>e+MODULE_INJECTORS[t]):e}function combineInjects(e){const r={};return assert$3(Array.isArray(e)&&1<e.length),e.forEach(e=>{for(const t in e)r[t]=r[t]?`${r[t]}\n${e[t]}`:e[t]}),r}function testVariable(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}const ES300_REPLACEMENTS=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ES300_VERTEX_REPLACEMENTS=[...ES300_REPLACEMENTS,[testVariable("attribute"),"in $1"],[testVariable("varying"),"out $1"]],ES300_FRAGMENT_REPLACEMENTS=[...ES300_REPLACEMENTS,[testVariable("varying"),"in $1"]],ES100_REPLACEMENTS=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],ES100_VERTEX_REPLACEMENTS=[...ES100_REPLACEMENTS,[testVariable("in"),"attribute $1"],[testVariable("out"),"varying $1"]],ES100_FRAGMENT_REPLACEMENTS=[...ES100_REPLACEMENTS,[testVariable("in"),"varying $1"]],ES100_FRAGMENT_OUTPUT_NAME="gl_FragColor",ES300_FRAGMENT_OUTPUT_REGEX=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,REGEX_START_OF_MAIN=/void\s+main\s*\([^)]*\)\s*\{\n?/;function transpileShader(e,t,r){switch(t){case 300:return r?convertShader(e,ES300_VERTEX_REPLACEMENTS):convertFragmentShaderTo300(e);case 100:return r?convertShader(e,ES100_VERTEX_REPLACEMENTS):convertFragmentShaderTo100(e);default:throw new Error(`unknown GLSL version ${t}`)}}function convertShader(e,t){for(var[r,i]of t)e=e.replace(r,i);return e}function convertFragmentShaderTo300(e){var t=(e=convertShader(e,ES300_FRAGMENT_REPLACEMENTS)).match(ES300_FRAGMENT_OUTPUT_REGEX);if(t){t=t[1];e=e.replace(new RegExp(`\\b${ES100_FRAGMENT_OUTPUT_NAME}\\b`,"g"),t)}else{const r="fragmentColor";e=e.replace(REGEX_START_OF_MAIN,e=>`out vec4 ${r};\n${e}`).replace(new RegExp(`\\b${ES100_FRAGMENT_OUTPUT_NAME}\\b`,"g"),r)}return e}function convertFragmentShaderTo100(e){var t=(e=convertShader(e,ES100_FRAGMENT_REPLACEMENTS)).match(ES300_FRAGMENT_OUTPUT_REGEX);return t&&(t=t[1],e=e.replace(ES300_FRAGMENT_OUTPUT_REGEX,"").replace(new RegExp(`\\b${t}\\b`,"g"),ES100_FRAGMENT_OUTPUT_NAME)),e}const INJECT_SHADER_DECLARATIONS=`\n\n${DECLARATION_INJECT_MARKER}\n\n`,SHADER_TYPE={[VERTEX_SHADER$1]:"vertex",[FRAGMENT_SHADER$1]:"fragment"},FRAGMENT_SHADER_PROLOGUE="precision highp float;\n\n";function assembleShaders(e,t){var{vs:r,fs:i}=t,n=resolveModules(t.modules||[]);return{gl:e,vs:assembleShader(e,Object.assign({},t,{source:r,type:VERTEX_SHADER$1,modules:n})),fs:assembleShader(e,Object.assign({},t,{source:i,type:FRAGMENT_SHADER$1,modules:n})),getUniforms:assembleGetUniforms(n)}}function assembleShader(e,{id:t,source:r,type:i,modules:n,defines:a={},hookFunctions:s=[],inject:o={},transpileToGLSL100:l=!1,prologue:c=!0,log:h}){assert$3("string"==typeof r,"shader source must be a string");var u=i===VERTEX_SHADER$1;const d=r.split("\n");let p=100,f="",m=r;0===d[0].indexOf("#version ")?(p=300,f=d[0],m=d.slice(1).join("\n")):f=`#version ${p}`;const g={};n.forEach(e=>{Object.assign(g,e.getDefines())}),Object.assign(g,a);let _=c?`\
${f}
${getShaderName({id:t,source:r,type:i})}
${getShaderType({type:i})}
${getPlatformShaderDefines(e)}
${getVersionDefines(e)}
${getApplicationDefines(g)}
${u?"":FRAGMENT_SHADER_PROLOGUE}
`:`${f}
`;s=normalizeHookFunctions(s);const v={},y={},x={};for(const A in o){var b,w="string"==typeof o[A]?{injection:o[A],order:0}:o[A],T=A.match(/^(v|f)s:(#)?([\w-]+)$/);T?(b=T[2],T=T[3],b?"decl"===T?y[A]=[w]:x[A]=[w]:v[A]=[w]):x[A]=[w]}for(const C of n){h&&C.checkDeprecations(m,h);var E=C.getModuleSource(i,p);_+=E;var S=C.injections[i];for(const L in S){var M=L.match(/^(v|f)s:#([\w-]+)$/);if(M){const P="decl"===M[2]?y:x;P[L]=P[L]||[],P[L].push(S[L])}else v[L]=v[L]||[],v[L].push(S[L])}}return _+=INJECT_SHADER_DECLARATIONS,_=injectShader(_,i,y),_+=getHookFunctions(s[i],v),_+=m,_=injectShader(_,i,x),_=transpileShader(_,l?100:p,u),_}function assembleGetUniforms(n){return function(e){var t={};for(const i of n){var r=i.getUniforms(e,t);Object.assign(t,r)}return t}}function getShaderType({type:e}){return`
#define SHADER_TYPE_${SHADER_TYPE[e].toUpperCase()}
`}function getShaderName({id:e,source:t,type:r}){return e&&"string"==typeof e&&-1===t.indexOf("SHADER_NAME")?`
#define SHADER_NAME ${e}_${SHADER_TYPE[r]}

`:""}function getApplicationDefines(e={}){let t=0,r="";for(const n in e){0===t&&(r+="\n// APPLICATION DEFINES\n"),t++;var i=e[n];(i||Number.isFinite(i))&&(r+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return 0===t&&(r+="\n"),r}function getHookFunctions(e,t){let r="";for(const n in e){var i=e[n];if(r+=`void ${i.signature} {\n`,i.header&&(r+=`  ${i.header}`),t[n]){const a=t[n];a.sort((e,t)=>e.order-t.order);for(const s of a)r+=`  ${s.injection}\n`}i.footer&&(r+=`  ${i.footer}`),r+="}\n"}return r}function normalizeHookFunctions(e){const n={vs:{},fs:{}};return e.forEach(e=>{let t;"string"!=typeof e?(t=e,e=t.hook):t={};var[r,i]=(e=e.trim()).split(":"),e=e.replace(/\(.+/,"");n[r][e]=Object.assign(t,{signature:i})}),n}const FS100="void main() {gl_FragColor = vec4(0);}",FS_GLES=`\
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,FS300=`#version 300 es\n${FS_GLES}`;function getQualifierDetails(e,t){t=Array.isArray(t)?t:[t];const[r,i,n]=e.replace(/^\s+/,"").split(/\s+/);return t.includes(r)&&i&&n?{qualifier:r,type:i,name:n.split(";")[0]}:null}function getPassthroughFS(e={}){var{version:t=100,input:r,inputType:i,output:n}=e;if(!r)return 300===t?FS300:300<t?`#version ${t}\n${FS_GLES}`:FS100;e=convertToVec4(r,i);return 300<=t?`\
#version ${t} ${300===t?"es":""}
in ${i} ${r};
out vec4 ${n};
void main() {
  ${n} = ${e};
}`:`\
varying ${i} ${r};
void main() {
  gl_FragColor = ${e};
}`}function typeToChannelSuffix(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return assert$3(!1),null}}function typeToChannelCount(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return assert$3(!1),null}}function convertToVec4(e,t){switch(t){case"float":return`vec4(${e}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${e}, 0.0, 1.0)`;case"vec3":return`vec4(${e}, 1.0)`;case"vec4":return e;default:return assert$3(!1),null}}const fp32shader=`\
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fp32={name:"fp32",vs:fp32shader,fs:null};function assert$2(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}const config={};function round(e){return Math.round(e/config.EPSILON)*config.EPSILON}function formatValue(e,{precision:t=config.precision||4}={}){return e=round(e),`${parseFloat(e.toPrecision(t))}`}function isArray$1(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function duplicateArray(e){return e.clone?e.clone():new Array(e.length)}function map$2(t,r,i){if(isArray$1(t)){i=i||duplicateArray(t);for(let e=0;e<i.length&&e<t.length;++e)i[e]=r(t[e],e,i);return i}return r(t)}function clamp$1(e,t,r){return map$2(e,e=>Math.max(t,Math.min(r,e)))}function lerp$2(e,r,i){return isArray$1(e)?e.map((e,t)=>lerp$2(e,r[t],i)):i*r+(1-i)*e}function equals$3(t,r,e){var i=config.EPSILON;e&&(config.EPSILON=e);try{if(t===r)return!0;if(isArray$1(t)&&isArray$1(r)){if(t.length!==r.length)return!1;for(let e=0;e<t.length;++e)if(!equals$3(t[e],r[e]))return!1;return!0}return t&&t.equals?t.equals(r):r&&r.equals?r.equals(t):!(!Number.isFinite(t)||!Number.isFinite(r))&&Math.abs(t-r)<=config.EPSILON*Math.max(1,Math.abs(t),Math.abs(r))}finally{config.EPSILON=i}}function _extendableBuiltin(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}config.EPSILON=1e-12,config.debug=!1,config.precision=4,config.printTypes=!1,config.printDegrees=!1,config.printRowMajor=!0;class MathArray extends _extendableBuiltin(Array){get ELEMENTS(){return assert$2(!1),0}clone(){return(new this.constructor).copy(this)}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}fromArray(t,r=0){for(let e=0;e<this.ELEMENTS;++e)this[e]=t[e+r];return this.check()}to(e){return e===this?this:isArray$1(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toArray(t=[],r=0){for(let e=0;e<this.ELEMENTS;++e)t[r+e]=this[e];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(config)}formatString(t){let r="";for(let e=0;e<this.ELEMENTS;++e)r+=(0<e?", ":"")+formatValue(this[e],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!equals$3(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(t,r,i){void 0===i&&(i=r,r=t,t=this);for(let e=0;e<this.ELEMENTS;++e){var n=t[e];this[e]=n+i*(r[e]-n)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,r){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(Math.max(this[e],t[e]),r[e]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(e){return this.subtract(e)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(e){return this.scale(1/e)}clampScalar(t,r){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(Math.max(this[e],t),r);return this.check()}multiplyByScalar(e){return this.scale(e)}get elements(){return this}check(){if(config.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function validateVector(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}function checkNumber(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${e}`);return e}function checkVector(e,t,r=""){if(config.debug&&!validateVector(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}const map$1={};function deprecated(e,t){map$1[e]||(map$1[e]=!0,console.warn(`${e} has been removed in version ${t}, see upgrade guide for more information`))}class Vector extends MathArray{get ELEMENTS(){return assert$2(!1),0}copy(e){return assert$2(!1),this}get x(){return this[0]}set x(e){this[0]=checkNumber(e)}get y(){return this[1]}set y(e){this[1]=checkNumber(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(t){let r=0;for(let e=0;e<this.ELEMENTS;++e){var i=this[e]-t[e];r+=i*i}return checkNumber(r)}dot(t){let r=0;for(let e=0;e<this.ELEMENTS;++e)r+=this[e]*t[e];return checkNumber(r)}normalize(){var t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return assert$2(0<=e&&e<this.ELEMENTS,"index is out of range"),checkNumber(this[e])}setComponent(e,t){return assert$2(0<=e&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var EPSILON$1=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;function create$2(){var e=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function add$2(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function negate$1(e,t){return e[0]=-t[0],e[1]=-t[1],e}function lerp$1(e,t,r,i){var n=t[0],t=t[1];return e[0]=n+i*(r[0]-n),e[1]=t+i*(r[1]-t),e}function transformMat4$2(e,t,r){var i=t[0],t=t[1];return e[0]=r[0]*i+r[4]*t+r[12],e[1]=r[1]*i+r[5]*t+r[13],e}function vec2_transformMat4AsVector(e,t,r){var i=t[0],n=t[1],t=r[3]*i+r[7]*n||1;return e[0]=(r[0]*i+r[4]*n)/t,e[1]=(r[1]*i+r[5]*n)/t,e}function vec3_transformMat4AsVector(e,t,r){var i=t[0],n=t[1],a=t[2],t=r[3]*i+r[7]*n+r[11]*a||1;return e[0]=(r[0]*i+r[4]*n+r[8]*a)/t,e[1]=(r[1]*i+r[5]*n+r[9]*a)/t,e[2]=(r[2]*i+r[6]*n+r[10]*a)/t,e}function vec3_transformMat2(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e[2]=t[2],e}function create$1(){var e=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function add$1(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function subtract(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function multiply$1(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function negate(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cross$1(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],t=r[1],r=r[2];return e[0]=n*r-a*t,e[1]=a*s-i*r,e[2]=i*t-n*s,e}function transformMat4$1(e,t,r){var i=t[0],n=t[1],a=t[2],t=r[3]*i+r[7]*n+r[11]*a+r[15];return e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/(t=t||1),e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/t,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/t,e}function transformMat3(e,t,r){var i=t[0],n=t[1],t=t[2];return e[0]=i*r[0]+n*r[3]+t*r[6],e[1]=i*r[1]+n*r[4]+t*r[7],e[2]=i*r[2]+n*r[5]+t*r[8],e}function transformQuat(e,t,r){var i=r[0],n=r[1],a=r[2],s=r[3],o=t[0],l=t[1],c=t[2],h=n*c-a*l,u=a*o-i*c,r=i*l-n*o,t=n*r-a*u,a=a*h-i*r,n=i*u-n*h,s=2*s;return u*=s,r*=s,a*=2,n*=2,e[0]=o+(h*=s)+(t*=2),e[1]=l+u+a,e[2]=c+r+n,e}function rotateX$1(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function rotateY$1(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function rotateZ$1(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function angle(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],s=t[1],o=t[2],o=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(a*a+s*s+o*o),o=o&&dot(e,t)/o;return Math.acos(Math.min(Math.max(o,-1),1))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),create$2();var sub=subtract,mul=multiply$1;create$1();const ORIGIN=[0,0,0],constants$1={};class Vector3$1 extends Vector{static get ZERO(){return constants$1.ZERO=constants$1.ZERO||Object.freeze(new Vector3$1(0,0,0,0))}constructor(e=0,t=0,r=0){super(-0,-0,-0),1===arguments.length&&isArray$1(e)?this.copy(e):(config.debug&&(checkNumber(e),checkNumber(t),checkNumber(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return config.debug&&(checkNumber(e.x),checkNumber(e.y),checkNumber(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=checkNumber(e)}angle(e){return angle(this,e)}cross(e){return cross$1(this,this,e),this.check()}rotateX({radians:e,origin:t=ORIGIN}){return rotateX$1(this,this,t,e),this.check()}rotateY({radians:e,origin:t=ORIGIN}){return rotateY$1(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=ORIGIN}){return rotateZ$1(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return transformMat4$1(this,this,e),this.check()}transformAsVector(e){return vec3_transformMat4AsVector(this,this,e),this.check()}transformByMatrix3(e){return transformMat3(this,this,e),this.check()}transformByMatrix2(e){return vec3_transformMat2(this,this,e),this.check()}transformByQuaternion(e){return transformQuat(this,this,e),this.check()}}class Matrix extends MathArray{get ELEMENTS(){return assert$2(!1),0}get RANK(){return assert$2(!1),0}toString(){let r="[";if(config.printRowMajor){r+="row-major:";for(let t=0;t<this.RANK;++t)for(let e=0;e<this.RANK;++e)r+=` ${this[e*this.RANK+t]}`}else{r+="column-major:";for(let e=0;e<this.ELEMENTS;++e)r+=` ${this[e]}`}return r+="]",r}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=checkNumber(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){var r=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[r+e];return t}setColumn(e,t){var r=e*this.RANK;for(let e=0;e<this.RANK;++e)this[r+e]=t[e];return this}}function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function transpose(e,t){var r,i,n,a,s,o;return e===t?(r=t[1],i=t[2],n=t[3],a=t[6],s=t[7],o=t[11],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o):(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]),e}function invert(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=r*o-i*s,y=r*l-n*s,x=r*c-a*s,b=i*l-n*o,w=i*c-a*o,T=n*c-a*l,E=h*m-u*f,S=h*g-d*f,M=h*_-p*f,A=u*g-d*m,C=u*_-p*m,L=d*_-p*g,t=v*L-y*C+x*A+b*M-w*S+T*E;return t?(e[0]=(o*L-l*C+c*A)*(t=1/t),e[1]=(n*C-i*L-a*A)*t,e[2]=(m*T-g*w+_*b)*t,e[3]=(d*w-u*T-p*b)*t,e[4]=(l*M-s*L-c*S)*t,e[5]=(r*L-n*M+a*S)*t,e[6]=(g*x-f*T-_*y)*t,e[7]=(h*T-d*x+p*y)*t,e[8]=(s*C-o*M+c*E)*t,e[9]=(i*M-r*C-a*E)*t,e[10]=(f*w-m*x+_*v)*t,e[11]=(u*x-h*w-p*v)*t,e[12]=(o*S-s*A-l*E)*t,e[13]=(r*A-i*S+n*E)*t,e[14]=(m*y-f*b-g*v)*t,e[15]=(h*b-u*y+d*v)*t,e):null}function determinant(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],e=e[15];return(t*s-r*a)*(u*e-d*m)-(t*o-i*a)*(h*e-d*f)+(t*l-n*a)*(h*m-u*f)+(r*o-i*s)*(c*e-d*p)-(r*l-n*s)*(c*m-u*p)+(i*l-n*o)*(c*f-h*p)}function multiply(e,t,r){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=r[0],x=r[1],b=r[2],t=r[3];return e[0]=y*i+x*o+b*u+t*m,e[1]=y*n+x*l+b*d+t*g,e[2]=y*a+x*c+b*p+t*_,e[3]=y*s+x*h+b*f+t*v,y=r[4],x=r[5],b=r[6],t=r[7],e[4]=y*i+x*o+b*u+t*m,e[5]=y*n+x*l+b*d+t*g,e[6]=y*a+x*c+b*p+t*_,e[7]=y*s+x*h+b*f+t*v,y=r[8],x=r[9],b=r[10],t=r[11],e[8]=y*i+x*o+b*u+t*m,e[9]=y*n+x*l+b*d+t*g,e[10]=y*a+x*c+b*p+t*_,e[11]=y*s+x*h+b*f+t*v,y=r[12],x=r[13],b=r[14],t=r[15],e[12]=y*i+x*o+b*u+t*m,e[13]=y*n+x*l+b*d+t*g,e[14]=y*a+x*c+b*p+t*_,e[15]=y*s+x*h+b*f+t*v,e}function translate$1(e,t,r){var i,n,a,s,o,l,c,h,u,d,p,f=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*f+t[4]*m+t[8]*g+t[12],e[13]=t[1]*f+t[5]*m+t[9]*g+t[13],e[14]=t[2]*f+t[6]*m+t[10]*g+t[14],e[15]=t[3]*f+t[7]*m+t[11]*g+t[15]):(i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],r=t[11],e[0]=i,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=p,e[11]=r,e[12]=i*f+o*m+u*g+t[12],e[13]=n*f+l*m+d*g+t[13],e[14]=a*f+c*m+p*g+t[14],e[15]=s*f+h*m+r*g+t[15]),e}function scale$1(e,t,r){var i=r[0],n=r[1],r=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rotate(e,t,r,i){var n,a,s,o,l,c,h,u,d,p,f,m,g,_,v,y,x,b,w,T=i[0],E=i[1],S=i[2],M=Math.hypot(T,E,S);return M<EPSILON$1?null:(T*=M=1/M,E*=M,S*=M,v=Math.sin(r),_=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],c=t[4],h=t[5],u=t[6],d=t[7],p=t[8],f=t[9],m=t[10],g=t[11],y=T*E*(n=1-_)-S*v,x=E*E*n+_,b=S*E*n+T*v,w=T*S*n+E*v,i=E*S*n-T*v,M=S*S*n+_,e[0]=a*(r=T*T*n+_)+c*(_=E*T*n+S*v)+p*(v=S*T*n-E*v),e[1]=s*r+h*_+f*v,e[2]=o*r+u*_+m*v,e[3]=l*r+d*_+g*v,e[4]=a*y+c*x+p*b,e[5]=s*y+h*x+f*b,e[6]=o*y+u*x+m*b,e[7]=l*y+d*x+g*b,e[8]=a*w+c*i+p*M,e[9]=s*w+h*i+f*M,e[10]=o*w+u*i+m*M,e[11]=l*w+d*i+g*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function rotateX(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],s=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],r=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*i,e[5]=s*n+h*i,e[6]=o*n+u*i,e[7]=l*n+r*i,e[8]=c*n-a*i,e[9]=h*n-s*i,e[10]=u*n-o*i,e[11]=r*n-l*i,e}function rotateY(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],c=t[8],h=t[9],u=t[10],r=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-c*i,e[1]=s*n-h*i,e[2]=o*n-u*i,e[3]=l*n-r*i,e[8]=a*i+c*n,e[9]=s*i+h*n,e[10]=o*i+u*n,e[11]=l*i+r*n,e}function rotateZ(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],s=t[1],o=t[2],l=t[3],c=t[4],h=t[5],u=t[6],r=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*i,e[1]=s*n+h*i,e[2]=o*n+u*i,e[3]=l*n+r*i,e[4]=c*n-a*i,e[5]=h*n-s*i,e[6]=u*n-o*i,e[7]=r*n-l*i,e}function fromQuat(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],s=r+r,o=i+i,l=n+n,c=r*s,h=i*s,t=i*o,r=n*s,i=n*o,n=n*l,s=a*s,o=a*o,l=a*l;return e[0]=1-t-n,e[1]=h+l,e[2]=r-o,e[3]=0,e[4]=h-l,e[5]=1-c-n,e[6]=i+s,e[7]=0,e[8]=r+o,e[9]=i-s,e[10]=1-c-t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function frustum(e,t,r,i,n,a,s){var o=1/(r-t),l=1/(n-i),c=1/(a-s);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(s+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*c,e[15]=0,e}function perspective(e,t,r,i,n){t=1/Math.tan(t/2);return e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+i)*(t=1/(i-n)),e[14]=2*n*i*t):(e[10]=-1,e[14]=-2*i),e}function ortho(e,t,r,i,n,a,s){var o=1/(t-r),l=1/(i-n),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(s+a)*c,e[15]=1,e}function lookAt(e,t,r,i){var n,a=t[0],s=t[1],o=t[2],l=i[0],c=i[1],h=i[2],u=r[0],d=r[1],p=r[2];return Math.abs(a-u)<EPSILON$1&&Math.abs(s-d)<EPSILON$1&&Math.abs(o-p)<EPSILON$1?identity(e):(n=a-u,t=s-d,i=o-p,u=c*(i*=r=1/Math.hypot(n,t,i))-h*(t*=r),d=h*(n*=r)-l*i,p=l*t-c*n,(r=Math.hypot(u,d,p))?(u*=r=1/r,d*=r,p*=r):p=d=u=0,h=t*p-i*d,l=i*u-n*p,c=n*d-t*u,(r=Math.hypot(h,l,c))?(h*=r=1/r,l*=r,c*=r):c=l=h=0,e[0]=u,e[1]=h,e[2]=n,e[3]=0,e[4]=d,e[5]=l,e[6]=t,e[7]=0,e[8]=p,e[9]=c,e[10]=i,e[11]=0,e[12]=-(u*a+d*s+p*o),e[13]=-(h*a+l*s+c*o),e[14]=-(n*a+t*s+i*o),e[15]=1,e)}function equals$2(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],v=t[0],y=t[1],x=t[2],b=t[3],w=t[4],T=t[5],E=t[6],S=t[7],M=t[8],A=t[9],C=t[10],L=t[11],P=t[12],I=t[13],e=t[14],t=t[15];return Math.abs(r-v)<=EPSILON$1*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-y)<=EPSILON$1*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-x)<=EPSILON$1*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-b)<=EPSILON$1*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-w)<=EPSILON$1*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-T)<=EPSILON$1*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-E)<=EPSILON$1*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-S)<=EPSILON$1*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-M)<=EPSILON$1*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(u-A)<=EPSILON$1*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(d-C)<=EPSILON$1*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-L)<=EPSILON$1*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(f-P)<=EPSILON$1*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-I)<=EPSILON$1*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(g-e)<=EPSILON$1*Math.max(1,Math.abs(g),Math.abs(e))&&Math.abs(_-t)<=EPSILON$1*Math.max(1,Math.abs(_),Math.abs(t))}function create(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function scale(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function transformMat4(e,t,r){var i=t[0],n=t[1],a=t[2],t=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*t,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*t,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*t,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*t,e}create();const IDENTITY$1=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ZERO=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),INDICES=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),constants={};class Matrix4$1 extends Matrix{static get IDENTITY(){return constants.IDENTITY=constants.IDENTITY||Object.freeze(new Matrix4$1(IDENTITY$1)),constants.IDENTITY}static get ZERO(){return constants.ZERO=constants.ZERO||Object.freeze(new Matrix4$1(ZERO)),constants.ZERO}get INDICES(){return INDICES}get ELEMENTS(){return 16}get RANK(){return 4}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=n,this[5]=a,this[6]=s,this[7]=o,this[8]=l,this[9]=c,this[10]=h,this[11]=u,this[12]=d,this[13]=p,this[14]=f,this[15]=m,this.check()}setRowMajor(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m){return this[0]=e,this[1]=n,this[2]=l,this[3]=d,this[4]=t,this[5]=a,this[6]=c,this[7]=p,this[8]=r,this[9]=s,this[10]=h,this[11]=f,this[12]=i,this[13]=o,this[14]=u,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(IDENTITY$1)}fromQuaternion(e){return fromQuat(this,e),this.check()}frustum({left:e,right:t,bottom:r,top:i,near:n,far:a}){return a===1/0?Matrix4$1._computeInfinitePerspectiveOffCenter(this,e,t,r,i,n):frustum(this,e,t,r,i,n,a),this.check()}static _computeInfinitePerspectiveOffCenter(e,t,r,i,n,a){var s=2*a/(n-i),o=(r+t)/(r-t),n=(n+i)/(n-i),i=-2*a;return e[0]=2*a/(r-t),e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=o,e[9]=n,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=i,e[15]=0,e}lookAt(e,t,r){return 1===arguments.length&&({eye:e,center:t,up:r}=e),lookAt(this,e,t=t||[0,0,0],r=r||[0,1,0]),this.check()}ortho({left:e,right:t,bottom:r,top:i,near:n=.1,far:a=500}){return ortho(this,e,t,r,i,n,a),this.check()}orthographic({fovy:e=45*Math.PI/180,aspect:t=1,focalDistance:r=1,near:i=.1,far:n=500}){if(e>2*Math.PI)throw Error("radians");e=r*Math.tan(e/2),t*=e;return(new Matrix4$1).ortho({left:-t,right:t,bottom:-e,top:e,near:i,far:n})}perspective({fovy:e=void 0,fov:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:n=500}={}){if((e=e||t)>2*Math.PI)throw Error("radians");return perspective(this,e,r,i,n),this.check()}determinant(){return determinant(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=null){var r=this.getScale(t||[-0,-0,-0]),i=1/r[0],t=1/r[1],r=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*t,e[2]=this[2]*r,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*t,e[6]=this[6]*r,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*t,e[10]=this[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=null){var r=this.getScale(t||[-0,-0,-0]),i=1/r[0],t=1/r[1],r=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*t,e[2]=this[2]*r,e[3]=this[4]*i,e[4]=this[5]*t,e[5]=this[6]*r,e[6]=this[8]*i,e[7]=this[9]*t,e[8]=this[10]*r,e}transpose(){return transpose(this,this),this.check()}invert(){return invert(this,this),this.check()}multiplyLeft(e){return multiply(this,e,this),this.check()}multiplyRight(e){return multiply(this,this,e),this.check()}rotateX(e){return rotateX(this,this,e),this.check()}rotateY(e){return rotateY(this,this,e),this.check()}rotateZ(e){return rotateZ(this,this,e),this.check()}rotateXYZ([e,t,r]){return this.rotateX(e).rotateY(t).rotateZ(r)}rotateAxis(e,t){return rotate(this,this,e,t),this.check()}scale(e){return Array.isArray(e)?scale$1(this,this,e):scale$1(this,this,[e,e,e]),this.check()}translate(e){return translate$1(this,this,e),this.check()}transform(e,t){return 4===e.length?(checkVector(t=transformMat4(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){var r=e["length"];switch(r){case 2:t=transformMat4$2(t||[-0,-0],e,this);break;case 3:t=transformMat4$1(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return checkVector(t,e.length),t}transformAsVector(e,t){switch(e.length){case 2:t=vec2_transformMat4AsVector(t||[-0,-0],e,this);break;case 3:t=vec3_transformMat4AsVector(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return checkVector(t,e.length),t}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}transformPoint(e,t){return deprecated("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,t)}transformVector(e,t){return deprecated("Matrix4.transformVector","3.0"),this.transformAsPoint(e,t)}transformDirection(e,t){return deprecated("Matrix4.transformDirection","3.0"),this.transformAsVector(e,t)}}var lightingShader$1=`\
#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;const INITIAL_MODULE_OPTIONS$2={lightSources:{}};function convertColor({color:e=[0,0,0],intensity:t=1}={}){return e.map(e=>e*t/255)}function getLightSourceUniforms({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){const i={};return i["lighting_uAmbientLight.color"]=e?convertColor(e):[0,0,0],t.forEach((e,t)=>{i[`lighting_uPointLight[${t}].color`]=convertColor(e),i[`lighting_uPointLight[${t}].position`]=e.position,i[`lighting_uPointLight[${t}].attenuation`]=e.attenuation||[1,0,0]}),i.lighting_uPointLightCount=t.length,r.forEach((e,t)=>{i[`lighting_uDirectionalLight[${t}].color`]=convertColor(e),i[`lighting_uDirectionalLight[${t}].direction`]=e.direction}),i.lighting_uDirectionalLightCount=r.length,i}function getUniforms$3(e=INITIAL_MODULE_OPTIONS$2){if("lightSources"in e){var{ambientLight:t,pointLights:r,directionalLights:i}=e.lightSources||{};return t||r&&0<r.length||i&&0<i.length?Object.assign({},getLightSourceUniforms({ambientLight:t,pointLights:r,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const n={pointLights:[],directionalLights:[]};for(const a of e.lights||[])switch(a.type){case"ambient":n.ambientLight=a;break;case"directional":n.directionalLights.push(a);break;case"point":n.pointLights.push(a)}return getUniforms$3({lightSources:n})}return{}}const lights={name:"lights",vs:lightingShader$1,fs:lightingShader$1,getUniforms:getUniforms$3,defines:{MAX_LIGHTS:3}},DEFAULT_HIGHLIGHT_COLOR=new Uint8Array([0,255,255,255]),DEFAULT_MODULE_OPTIONS={pickingSelectedColor:null,pickingHighlightColor:DEFAULT_HIGHLIGHT_COLOR,pickingActive:!1,pickingAttribute:!1};function getUniforms$2(e=DEFAULT_MODULE_OPTIONS){const t={};var r;if(void 0!==e.pickingSelectedColor&&(e.pickingSelectedColor?(r=e.pickingSelectedColor.slice(0,3),t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=r):t.picking_uSelectedColorValid=0),e.pickingHighlightColor){const i=Array.from(e.pickingHighlightColor,e=>e/255);Number.isFinite(i[3])||(i[3]=1),t.picking_uHighlightColor=i}return void 0!==e.pickingActive&&(t.picking_uActive=Boolean(e.pickingActive),t.picking_uAttribute=Boolean(e.pickingAttribute)),t}const vs$9=`\
uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs$8=`\
uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,picking$1={name:"picking",vs:vs$9,fs:fs$8,getUniforms:getUniforms$2};var lightingShader=`\

uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;const INITIAL_MODULE_OPTIONS$1={};function getMaterialUniforms(e){const{ambient:t=.35,diffuse:r=.6,shininess:i=32,specularColor:n=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:r,lighting_uShininess:i,lighting_uSpecularColor:n.map(e=>e/255)}}function getUniforms$1(e=INITIAL_MODULE_OPTIONS$1){if(!("material"in e))return{};var e=e["material"];return e?getMaterialUniforms(e):{lighting_uEnabled:!1}}const gouraudLighting={name:"gouraud-lighting",dependencies:[lights],vs:lightingShader,defines:{LIGHTING_VERTEX:1},getUniforms:getUniforms$1};lights;const vs$8=`\
attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,transform$1={name:"transform",vs:vs$8,fs:null};class ProgramManager{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new ProgramManager(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:t="",fs:r="",defines:i={},inject:n={},varyings:a=[],bufferMode:s=35981,transpileToGLSL100:o=!1}=e,l=this._getModuleList(e.modules);var c=this._getHash(t),h=this._getHash(r);const u=l.map(e=>this._getHash(e.name)).sort(),d=a.map(e=>this._getHash(e));var p=Object.keys(i).sort(),e=Object.keys(n).sort();const f=[],m=[];for(const g of p)f.push(this._getHash(g)),f.push(this._getHash(i[g]));for(const _ of e)m.push(this._getHash(_)),m.push(this._getHash(n[_]));c=`${c}/${h}D${f.join("/")}M${u.join("/")}I${m.join("/")}V${d.join("/")}H${this.stateHash}B${s}${o?"T":""}`;return this._programCache[c]||(h=assembleShaders(this.gl,{vs:t,fs:r,modules:l,inject:n,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:o}),this._programCache[c]=new Program(this.gl,{hash:c,vs:h.vs,fs:h.fs,varyings:a,bufferMode:s}),this._getUniforms[c]=h.getUniforms||(e=>{}),this._useCounts[c]=0),this._useCounts[c]++,this._programCache[c]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){e=e.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(r=[]){const i=new Array(this._defaultModules.length+r.length),n={};let a=0;for(let e=0,t=this._defaultModules.length;e<t;++e){var s=this._defaultModules[e],o=s.name;i[a++]=s,n[o]=!0}for(let e=0,t=r.length;e<t;++e){var l=r[e],c=l.name;n[c]||(i[a++]=l,n[c]=!0)}return i.length=a,i}}const GLTF_TO_LUMA_ATTRIBUTE_MAP={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function getBuffersFromGeometry(e,t,r){const i={};let n=t.indices;for(const h in t.attributes){var a=t.attributes[h],s=mapAttributeName(h,r);if("indices"===h)n=a;else if(a.constant)i[s]=a.value;else{var o=a.value;const u={...a};delete u.value,i[s]=[new Buffer$1(e,o),u],inferAttributeAccessor(h,u)}}var l,c;return n&&(assert$4((l=n.value||n)instanceof Uint16Array||l instanceof Uint32Array,'attribute array for "indices" must be of integer type'),c={size:1,isIndexed:void 0===n.isIndexed||n.isIndexed},i.indices=[new Buffer$1(e,{data:l,target:34963}),c]),i}function mapAttributeName(e,t){var{attributeMap:t=GLTF_TO_LUMA_ATTRIBUTE_MAP}=t||{};return t&&t[e]||e}function inferAttributeAccessor(e,t){let r;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":r="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":r="vectors"}switch(r){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2}assert$4(Number.isFinite(t.size),`attribute ${e} needs size`)}const LOG_DRAW_PRIORITY=2,LOG_DRAW_TIMEOUT=1e4,ERR_MODEL_PARAMS="Model needs drawMode and vertexCount",NOOP=()=>{},DRAW_PARAMS={};class Model{constructor(e,t={}){var{id:r=uid("model")}=t;assert$4(isWebGL(e)),this.id=r,this.gl=e,this.id=t.id||uid("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||ProgramManager.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var{program:t=null,vs:r,fs:i,modules:n,defines:a,inject:s,varyings:o,bufferMode:l,transpileToGLSL100:c}=e;this.programProps={program:t,vs:r,fs:i,modules:n,defines:a,inject:s,varyings:o,bufferMode:l,transpileToGLSL100:c},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=void 0!==e.drawMode?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||0<e.instanceCount,this._setModelProps(e),this.geometry={},assert$4(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),ERR_MODEL_PARAMS)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){var{program:t,vs:r,fs:i,modules:n,defines:a,inject:s,varyings:o,bufferMode:l,transpileToGLSL100:e}=e;this.programProps={program:t,vs:r,fs:i,modules:n,defines:a,inject:s,varyings:o,bufferMode:l,transpileToGLSL100:e},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return assert$4(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return assert$4(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=getBuffersFromGeometry(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(isObjectEmpty(e))return this;const t={};for(const r in e){const i=e[r];t[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(t),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){e=this.getModuleUniforms(e||{});return this.setUniforms(e)}clear(e){return clear(this.program.gl,e),this}draw(e={}){this._checkProgram();var{moduleSettings:t=null,framebuffer:r,uniforms:i={},attributes:n={},transformFeedback:a=this.transformFeedback,parameters:s={},vertexArray:o=this.vertexArray}=e;this.setAttributes(n),this.updateModuleSettings(t),this.setUniforms(i);let l;log$1.priority>=LOG_DRAW_PRIORITY&&(l=this._logDrawCallStart(LOG_DRAW_PRIORITY));var c=this.vertexArray.getDrawParams(),{isIndexed:h=c.isIndexed,indexType:n=c.indexType,indexOffset:t=c.indexOffset,vertexArrayInstanced:i=c.isInstanced}=this.props;i&&!this.isInstanced&&log$1.warn("Found instanced attributes on non-instanced model",this.id)();var{isInstanced:c,instanceCount:i}=this;const{onBeforeRender:u=NOOP,onAfterRender:d=NOOP}=this.props;u(),this.program.setUniforms(this.uniforms);t=this.program.draw(Object.assign(DRAW_PARAMS,e,{logPriority:l,uniforms:null,framebuffer:r,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:o,transformFeedback:a,isIndexed:h,indexType:n,isInstanced:c,instanceCount:i,offset:h?t:0}));return d(),log$1.priority>=LOG_DRAW_PRIORITY&&this._logDrawCallEnd(l,o,r),t}transform(e={}){const{discard:t=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let n=e["parameters"];r&&this._setFeedbackBuffers(r),t&&(n=Object.assign({},n,{[35977]:t})),i.forEach(e=>e.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:n}))}finally{i.forEach(e=>e.vertexArray.bindBuffers())}return this}render(e={}){return log$1.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){var t,r,i,n,a,s,o,l;if(this._programDirty||this.programManager.stateHash!==this._programManagerState){let e=this.programProps["program"];e?this._managedProgram=!1:({vs:t,fs:r,modules:i,inject:n,defines:a,varyings:s,bufferMode:o,transpileToGLSL100:l}=this.programProps,e=this.programManager.get({vs:t,fs:r,modules:i,inject:n,defines:a,varyings:s,bufferMode:o,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0),assert$4(e instanceof Program,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new VertexArray(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof Buffer$1&&t.delete()}}_setAnimationProps(e){this.animated&&assert$4(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(e={}){if(isObjectEmpty(e))return this;var t=this.program["gl"];return this.transformFeedback=this.transformFeedback||new TransformFeedback(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){var t=3<e?0:LOG_DRAW_TIMEOUT;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),log$1.group(LOG_DRAW_PRIORITY,`>>> DRAWING MODEL ${this.id}`,{collapsed:log$1.level<=2})(),e}_logDrawCallEnd(e,t,r,i){var n,a,s,o;void 0!==e&&(n=getDebugTableForVertexArray({vertexArray:t,header:`${this.id} attributes`,attributes:this._attributes}),{table:a,unusedTable:o,unusedCount:s}=getDebugTableForUniforms({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:t,count:r}=getDebugTableForUniforms({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0}),0<r&&log$1.log("MISSING UNIFORMS",Object.keys(t))(),0<s&&log$1.log("UNUSED UNIFORMS",Object.keys(o))(),o=getDebugTableForProgramConfiguration(this.vertexArray.configuration),log$1.table(e,n)(),log$1.table(e,a)(),log$1.table(e+1,o)(),i&&i.log({logLevel:LOG_DRAW_PRIORITY,message:`Rendered to ${i.id}`}),log$1.groupEnd(LOG_DRAW_PRIORITY,`>>> DRAWING MODEL ${this.id}`)())}}class BufferTransform{constructor(e,t={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(e={}){var t=this["varyings"];return e=0<t.length?Object.assign({},e,{varyings:t}):e}getDrawOptions(e={}){var{sourceBuffers:t,transformFeedback:r}=this.bindings[this.currentIndex];return{attributes:Object.assign({},t,e.attributes),transformFeedback:r}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupBuffers(e)}getBuffer(e){var t=this.bindings[this.currentIndex]["feedbackBuffers"],e=e?t[e]:null;return e?e instanceof Buffer$1?e:e.buffer:null}getData(e={}){var e=e["varyingName"];const t=this.getBuffer(e);return t?t.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),0<this.varyings.length&&assert$4(isWebGL2$1(this.gl))}_getFeedbackBuffers(e){var{sourceBuffers:t={}}=e;const r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const o in this.feedbackMap){var i=this.feedbackMap[o];o in t&&(r[i]=o)}Object.assign(r,e.feedbackBuffers);for(const l in r){var n,a,s=r[l];"string"==typeof s&&({byteLength:n,usage:a,accessor:s}=t[s],r[l]=this._createNewBuffer(l,{byteLength:n,usage:a,accessor:s}))}return r}_setupBuffers(e={}){var{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);e=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:e})}_setupTransformFeedback(e,{model:t}){var t=t["program"];e.transformFeedback=new TransformFeedback(this.gl,{program:t,buffers:e.feedbackBuffers})}_updateBindings(e){var t,r;this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap&&({sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),e=this._getNextIndex(),this.bindings[e]=this._updateBinding(this.bindings[e],{sourceBuffers:t,feedbackBuffers:r}))}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){var i=this.feedbackMap[n];t[n]=e.feedbackBuffers[i],r[i]=e.sourceBuffers[n],assert$4(r[i]instanceof Buffer$1)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){t=new Buffer$1(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=t}_getNextIndex(){return(this.currentIndex+1)%2}}const SAMPLER_UNIFORM_PREFIX="transform_uSampler_",SIZE_UNIFORM_PREFIX="transform_uSize_",VS_POS_VARIABLE="transform_position";function updateForTextures({vs:e,sourceTextureMap:s,targetTextureVarying:o,targetTexture:t}){let l=Object.keys(s).length,c=null;const h={};let r=e,u={};if(0<l||o){const i=r.split("\n"),d=i.slice();i.forEach((e,t,r)=>{var i,n,a;0<l&&((i=processAttributeDefinition(e,s))&&({updatedLine:n,inject:a}=i,d[t]=n,u=combineInjects([u,a]),Object.assign(h,i.samplerTextureMap),l--)),o&&!c&&(c=getVaryingType(e,o))}),o&&(assert$4(t),t=`uniform vec2 ${e=`${SIZE_UNIFORM_PREFIX}${o}`};\n`,e=`\
     vec2 ${VS_POS_VARIABLE} = transform_getPos(${e});
     gl_Position = vec4(${VS_POS_VARIABLE}, 0, 1.);\n`,u=combineInjects([u,{"vs:#decl":t,"vs:#main-start":e}])),r=d.join("\n")}return{vs:r,targetTextureType:c,inject:u,samplerTextureMap:h}}function getSizeUniforms({sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}){const i={};let n,a;t&&({width:n,height:a}=r,i[`${SIZE_UNIFORM_PREFIX}${t}`]=[n,a]);for(const s in e)({width:n,height:a}=e[s]),i[`${SIZE_UNIFORM_PREFIX}${s}`]=[n,a];return i}function getAttributeDefinition(e){return getQualifierDetails(e,["attribute","in"])}function getSamplerDeclerations(e){var t=`${SAMPLER_UNIFORM_PREFIX}${e}`,e=`${SIZE_UNIFORM_PREFIX}${e}`;return{samplerName:t,sizeName:e,uniformDeclerations:`\
  uniform sampler2D ${t};
  uniform vec2 ${e};`}}function getVaryingType(e,t){e=getQualifierDetails(e,["varying","out"]);return e&&e.name===t?e.type:null}function processAttributeDefinition(e,t){const r={};var i=getAttributeDefinition(e);if(!i)return null;var{type:n,name:a}=i;if(a&&t[a]){var s=`\// ${e} => Replaced by Transform with a sampler`,{samplerName:i,sizeName:t,uniformDeclerations:e}=getSamplerDeclerations(a),n=`  ${n} ${a} = transform_getInput(${i}, ${t}).${typeToChannelSuffix(n)};\n`;return r[i]=a,{updatedLine:s,inject:{"vs:#decl":e,"vs:#main-start":n},samplerTextureMap:r}}return null}const SRC_TEX_PARAMETER_OVERRIDES={[10241]:9728,10240:9728,10242:33071,10243:33071},FS_OUTPUT_VARIABLE="transform_output";class TextureTransform{constructor(e,t={}){this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(e={}){var t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(e={}){var{sourceBuffers:t,sourceTextures:r,framebuffer:i,targetTexture:n}=this.bindings[this.currentIndex];const a=Object.assign({},t,e.attributes),s=Object.assign({},e.uniforms),o=Object.assign({},e.parameters);let l=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const h in this.samplerTextureMap){var c=this.samplerTextureMap[h];s[h]=r[c]}this._setSourceTextureParameters();n=getSizeUniforms({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:n});Object.assign(s,n)}return this.hasTargetTexture&&(l=!1,o.viewport=[0,0,i.width,i.height]),{attributes:a,framebuffer:i,uniforms:s,discard:l,parameters:o}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupTextures(e)}getTargetTexture(){var e=this.bindings[this.currentIndex]["targetTexture"];return e}getData({packed:e=!1}={}){var t=this.bindings[this.currentIndex]["framebuffer"],r=readPixelsToArray(t);if(!e)return r;const i=r.constructor;var n=typeToChannelCount(this.targetTextureType);const a=new i(r.length*n/4);let s=0;for(let t=0;t<r.length;t+=4)for(let e=0;e<n;e++)a[s++]=r[t+e];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){var{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){var{sourceTextures:t,textureOrReference:e}=e;if(e instanceof Texture2D)return e;t=t[e];return t?(this._targetRefTexName=e,this._createNewTexture(t)):null}_setupTextures(e={}){var{sourceBuffers:t,_sourceTextures:r={},_targetTexture:i}=e,i=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&0<Object.keys(r).length,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:i}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(!("number"!=typeof e||this.elementCount>=e)){const t=new Float32Array(e);t.forEach((e,t,r)=>{r[t]=t}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new Buffer$1(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}}_updateBindings(e){var t,r;this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture&&({sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),e=this._getNextIndex(),this.bindings[e]=this._updateBinding(this.bindings[e],{sourceTextures:t,targetTexture:r}))}_updateBinding(e,t){var{sourceBuffers:r,sourceTextures:i,targetTexture:t}=t;if(e=e||{sourceBuffers:{},sourceTextures:{},targetTexture:null},Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),t){var{width:i,height:r}=e.targetTexture=t;const n=e["framebuffer"];n?(n.update({attachments:{[36064]:t},resizeAttachments:!1}),n.resize({width:i,height:r})):e.framebuffer=new Framebuffer(this.gl,{id:"transform-framebuffer",width:i,height:r,attachments:{[36064]:t}})}return e}_setSourceTextureParameters(){var e=this.currentIndex;const t=this.bindings[e]["sourceTextures"];for(const r in t)t[r].setParameters(SRC_TEX_PARAMETER_OVERRIDES)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;e=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:e}}_createNewTexture(e){e=cloneTextureFrom(e,{parameters:{[10241]:9728,10240:9728,10242:33071,10243:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){var{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:n,targetTextureType:a,inject:t,samplerTextureMap:r}=updateForTextures({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),t=combineInjects([e.inject||{},t]);return this.targetTextureType=a,this.samplerTextureMap=r,{vs:i,fs:e._fs||getPassthroughFS({version:getShaderVersion(i),input:this.targetTextureVarying,inputType:a,output:FS_OUTPUT_VARIABLE}),modules:this.hasSourceTextures||this.targetTextureVarying?[transform$1].concat(e.modules||[]):e.modules,uniforms:n,inject:t}}}class Transform{static isSupported(e){return isWebGL2$1(e)}constructor(e,t={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(e={}){var{clearRenderTarget:t=!0}=e;const r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;for(const t of[this.bufferTransform,this.textureTransform].filter(Boolean))e=e||t.swap();assert$4(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){for(const r of[this.bufferTransform,this.textureTransform].filter(Boolean)){var t=r.getData(e);if(t)return t}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);for(const t of[this.bufferTransform,this.textureTransform].filter(Boolean))t.update(e)}_initialize(e={}){var t=this["gl"];this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Model(t,Object.assign({},e,{fs:e.fs||getPassthroughFS({version:getShaderVersion(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);for(const r of[this.bufferTransform,this.textureTransform].filter(Boolean))t=r.updateModelProps(t);return t}_buildResourceTransforms(e,t){canCreateBufferTransform(t)&&(this.bufferTransform=new BufferTransform(e,t)),canCreateTextureTransform(t)&&(this.textureTransform=new TextureTransform(e,t)),assert$4(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);for(const r of[this.bufferTransform,this.textureTransform].filter(Boolean))t=Object.assign(t,r.getDrawOptions(t));return t}}function canCreateBufferTransform(e){return!(isObjectEmpty(e.feedbackBuffers)&&isObjectEmpty(e.feedbackMap)&&!(e.varyings&&0<e.varyings.length))}function canCreateTextureTransform(e){return!(isObjectEmpty(e._sourceTextures)&&!e._targetTexture&&!e._targetTextureVarying)}const DRAW_MODE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Geometry{static get DRAW_MODE(){return DRAW_MODE}constructor(e={}){var{id:t=uid("geometry"),drawMode:r=DRAW_MODE.TRIANGLES,attributes:i={},indices:n=null,vertexCount:e=null}=e;this.id=t,this.drawMode=0|r,this.attributes={},this.userData={},this._setAttributes(i,n),this.vertexCount=e||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const r in t){let e=t[r];e=ArrayBuffer.isView(e)?{value:e}:e,assert$4(ArrayBuffer.isView(e.value),`${this._print(r)}: must be typed array or object with value as typed array`),"POSITION"!==r&&"positions"!==r||e.size||(e.size=3),"indices"===r?(assert$4(!this.indices),this.indices=e):this.attributes[r]=e}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const s in e){var{value:i,size:n,constant:a}=e[s];!a&&i&&1<=n&&(r=Math.min(r,i.length/n))}return assert$4(Number.isFinite(r)),r}}let channelHandles=1,animationHandles=1;class Timeline{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){var{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:n=1}=e,e=channelHandles++,n={time:0,delay:t,duration:r,rate:i,repeat:n};return this._setChannelTime(n,this.time),this.channels.set(e,n),e}removeChannel(e){this.channels.delete(e);for(var[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){e=this.channels.get(e);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}getTime(e){if(void 0===e)return this.time;e=this.channels.get(e);return void 0===e?-1:e.time}setTime(e){this.time=Math.max(0,e);for(const t of this.channels.values())this._setChannelTime(t,this.time);for(const r of this.animations.values()){const{animation:i,channel:n}=r;i.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){var r=animationHandles++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){t-=e.delay;e.duration*e.repeat<=t?e.time=e.duration*e.rate:(e.time=Math.max(0,t)%e.duration,e.time*=e.rate)}}const vs$7="\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n",fs$7="\n#define SMOOTH_EDGE_RADIUS 0.5\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n";var geometry={name:"geometry",vs:vs$7,fs:fs$7};const COORDINATE_SYSTEM={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(COORDINATE_SYSTEM,"IDENTITY",{get:()=>log$2.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0});const PROJECTION_MODE={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},UNIT={common:0,meters:1,pixels:2},EVENTS={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},COORDINATE_SYSTEM_GLSL_CONSTANTS=Object.keys(COORDINATE_SYSTEM).map(e=>"const int COORDINATE_SYSTEM_".concat(e," = ").concat(COORDINATE_SYSTEM[e],";")).join(""),PROJECTION_MODE_GLSL_CONSTANTS=Object.keys(PROJECTION_MODE).map(e=>"const int PROJECTION_MODE_".concat(e," = ").concat(PROJECTION_MODE[e],";")).join(""),UNIT_GLSL_CONSTANTS=Object.keys(UNIT).map(e=>"const int UNIT_".concat(e.toUpperCase()," = ").concat(UNIT[e],";")).join("");var projectShader="".concat(COORDINATE_SYSTEM_GLSL_CONSTANTS,"\n").concat(PROJECTION_MODE_GLSL_CONSTANTS,"\n").concat(UNIT_GLSL_CONSTANTS,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n    \n    if (geometry.position.w == 0.0) {\n      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);\n      return 1.0 / cos(radians(y));\n    }\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n");function isEqual(t,r){if(t===r)return!0;if(Array.isArray(t)){var i=t.length;if(!r||r.length!==i)return!1;for(let e=0;e<i;e++)if(t[e]!==r[e])return!1;return!0}return!1}function memoize(r){let i={},n;return e=>{for(const t in e)if(!isEqual(e[t],i[t])){n=r(e),i=e;break}return n}}const ZERO_VECTOR$1=[0,0,0,0],VECTOR_TO_POINT_MATRIX$1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],IDENTITY_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],DEFAULT_PIXELS_PER_UNIT2=[0,0,0],DEFAULT_COORDINATE_ORIGIN=[0,0,0],getMemoizedViewportUniforms=memoize(calculateViewportUniforms);function getOffsetOrigin(e,t,r=DEFAULT_COORDINATE_ORIGIN){let i=r,n,a=!0;switch(n=t===COORDINATE_SYSTEM.LNGLAT_OFFSETS||t===COORDINATE_SYSTEM.METER_OFFSETS?r:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case PROJECTION_MODE.WEB_MERCATOR:t!==COORDINATE_SYSTEM.LNGLAT&&t!==COORDINATE_SYSTEM.CARTESIAN||(n=[0,0,0],a=!1);break;case PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:t===COORDINATE_SYSTEM.LNGLAT?i=n:t===COORDINATE_SYSTEM.CARTESIAN&&(i=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],n=e.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case PROJECTION_MODE.IDENTITY:i=e.position.map(Math.fround);break;case PROJECTION_MODE.GLOBE:a=!1,n=null;break;default:a=!1}return i[2]=i[2]||0,{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:a}}function calculateMatrixAndOffset(e,t,r){var{viewMatrixUncentered:i,projectionMatrix:n}=e;let{viewMatrix:a,viewProjectionMatrix:s}=e,o=ZERO_VECTOR$1,l=ZERO_VECTOR$1,c=e.cameraPosition;var{geospatialOrigin:h,shaderCoordinateOrigin:t,offsetMode:r}=getOffsetOrigin(e,t,r);return r&&(l=e.projectPosition(h||t),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,o=transformMat4([],l,s),a=i||a,s=multiply([],n,a),s=multiply([],s,VECTOR_TO_POINT_MATRIX$1)),{viewMatrix:a,viewProjectionMatrix:s,projectionCenter:o,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:t,geospatialOrigin:h}}function getUniformsFromViewport({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:i=COORDINATE_SYSTEM.DEFAULT,coordinateOrigin:n,autoWrapLongitude:a=!1}={}){i===COORDINATE_SYSTEM.DEFAULT&&(i=e.isGeospatial?COORDINATE_SYSTEM.LNGLAT:COORDINATE_SYSTEM.CARTESIAN);const s=getMemoizedViewportUniforms({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:n});return s.project_uWrapLongitude=a,s.project_uModelMatrix=r||IDENTITY_MATRIX,s}function calculateViewportUniforms({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:i}){const{projectionCenter:n,viewProjectionMatrix:a,originCommon:s,cameraPosCommon:o,shaderCoordinateOrigin:l,geospatialOrigin:c}=calculateMatrixAndOffset(e,r,i);var h=e.getDistanceScales(),u=[e.width*t,e.height*t],i=transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1;const d={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:s.slice(0,3),project_uCenter:n,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:u,project_uDevicePixelRatio:t,project_uFocalDistance:i,project_uCommonUnitsPerMeter:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:DEFAULT_PIXELS_PER_UNIT2,project_uScale:e.scale,project_uViewProjectionMatrix:a,project_uCameraPosition:o};if(c){var p=e.getDistanceScales(c);switch(r){case COORDINATE_SYSTEM.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case COORDINATE_SYSTEM.LNGLAT:case COORDINATE_SYSTEM.LNGLAT_OFFSETS:e._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case COORDINATE_SYSTEM.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]]}}return d}const INITIAL_MODULE_OPTIONS={};function getUniforms(e=INITIAL_MODULE_OPTIONS){return e.viewport?getUniformsFromViewport(e):{}}var project={name:"project",dependencies:[fp32,geometry],vs:projectShader,getUniforms:getUniforms};const vs$6="\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    mat3 rotation = project_get_orientation_matrix(projectedPosition);\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n";var project32={name:"project32",dependencies:[project],vs:vs$6};function createMat4$1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function transformVector(e,t){e=transformMat4([],t,e);return scale(e,e,1/e[3]),e}function mod(e,t){e%=t;return e<0?t+e:e}function ieLog2(e){return Math.log(e)*Math.LOG2E}const log2=Math.log2||ieLog2;function assert$1(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const PI=Math.PI,PI_4=PI/4,DEGREES_TO_RADIANS$3=PI/180,RADIANS_TO_DEGREES=180/PI,TILE_SIZE$1=512,EARTH_CIRCUMFERENCE$1=4003e4,DEFAULT_ALTITUDE=1.5;function zoomToScale(e){return Math.pow(2,e)}function scaleToZoom(e){return log2(e)}function lngLatToWorld([e,t]){assert$1(Number.isFinite(e)),assert$1(Number.isFinite(t)&&-90<=t&&t<=90,"invalid latitude");e*=DEGREES_TO_RADIANS$3,t*=DEGREES_TO_RADIANS$3;return[TILE_SIZE$1*(e+PI)/(2*PI),TILE_SIZE$1*(PI+Math.log(Math.tan(PI_4+.5*t)))/(2*PI)]}function worldToLngLat([e,t]){e=e/TILE_SIZE$1*(2*PI)-PI,t=2*(Math.atan(Math.exp(t/TILE_SIZE$1*(2*PI)-PI))-PI_4);return[e*RADIANS_TO_DEGREES,t*RADIANS_TO_DEGREES]}function getMeterZoom({latitude:e}){assert$1(Number.isFinite(e));e=Math.cos(e*DEGREES_TO_RADIANS$3);return scaleToZoom(EARTH_CIRCUMFERENCE$1*e)-9}function getDistanceScales({latitude:e,longitude:t,highPrecision:r=!1}){assert$1(Number.isFinite(e)&&Number.isFinite(t));const i={};var n=TILE_SIZE$1,a=Math.cos(e*DEGREES_TO_RADIANS$3),s=n/360,o=s/a,t=n/EARTH_CIRCUMFERENCE$1/a;return i.unitsPerMeter=[t,t,t],i.metersPerUnit=[1/t,1/t,1/t],i.unitsPerDegree=[s,o,t],i.degreesPerUnit=[1/s,1/o,1/t],r&&(a=s*(e=DEGREES_TO_RADIANS$3*Math.tan(e*DEGREES_TO_RADIANS$3)/a)/2,t=(e=n/EARTH_CIRCUMFERENCE$1*e)/o*t,i.unitsPerDegree2=[0,a,e],i.unitsPerMeter2=[t,0,t]),i}function addMetersToLngLat(e,t){var[r,i,n]=e,[a,s,t]=t,{unitsPerMeter:r,unitsPerMeter2:i}=getDistanceScales({longitude:r,latitude:i,highPrecision:!0});const o=lngLatToWorld(e);o[0]+=a*(r[0]+i[0]*s),o[1]+=s*(r[1]+i[1]*s);i=worldToLngLat(o),s=(n||0)+(t||0);return Number.isFinite(n)||Number.isFinite(t)?[i[0],i[1],s]:i}function getViewMatrix({height:e,pitch:t,bearing:r,altitude:i,scale:n,center:a=null}){var s=createMat4$1();return translate$1(s,s,[0,0,-i]),rotateX(s,s,-t*DEGREES_TO_RADIANS$3),rotateZ(s,s,r*DEGREES_TO_RADIANS$3),scale$1(s,s,[n/=e,n,n]),a&&translate$1(s,s,negate([],a)),s}function getProjectionParameters({width:e,height:t,fovy:r=altitudeToFovy(DEFAULT_ALTITUDE),altitude:i,pitch:n=0,nearZMultiplier:a=1,farZMultiplier:s=1}){var o=.5*(r=void 0!==i?altitudeToFovy(i):r)*DEGREES_TO_RADIANS$3,i=fovyToAltitude(r),r=n*DEGREES_TO_RADIANS$3,n=Math.sin(o)*i/Math.sin(Math.min(Math.max(Math.PI/2-r-o,.01),Math.PI-.01));return{fov:2*o,aspect:e/t,focalDistance:i,near:a,far:(Math.sin(r)*n+i)*s}}function getProjectionMatrix({width:e,height:t,pitch:r,altitude:i,fovy:n,nearZMultiplier:a,farZMultiplier:s}){var{fov:n,aspect:r,near:a,far:s}=getProjectionParameters({width:e,height:t,altitude:i,fovy:n,pitch:r,nearZMultiplier:a,farZMultiplier:s});return perspective([],n,r,a,s)}function altitudeToFovy(e){return 2*Math.atan(.5/e)*RADIANS_TO_DEGREES}function fovyToAltitude(e){return.5/Math.tan(.5*e*DEGREES_TO_RADIANS$3)}function worldToPixels(e,t){var[r,i,e=0]=e;return assert$1(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(e)),transformVector(t,[r,i,e,1])}function pixelsToWorld(e,t,r=0){var[i,n,e]=e;if(assert$1(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(e))return transformVector(t,[i,n,e,1]);e=transformVector(t,[i,n,0,1]),t=transformVector(t,[i,n,1,1]),i=e[2],n=t[2];return lerp$1([],e,t,i===n?0:((r||0)-i)/(n-i))}function fitBounds({width:e,height:t,bounds:r,minExtent:i=0,maxZoom:n=24,padding:a=0,offset:s=[0,0]}){var[[o,l],[c,r]]=r;Number.isFinite(a)?a={top:a,bottom:a,left:a,right:a}:assert$1(Number.isFinite(a.top)&&Number.isFinite(a.bottom)&&Number.isFinite(a.left)&&Number.isFinite(a.right));const h=new WebMercatorViewport$1({width:e,height:t,longitude:0,latitude:0,zoom:0});r=h.project([o,r]),l=h.project([c,l]),i=[Math.max(Math.abs(l[0]-r[0]),i),Math.max(Math.abs(l[1]-r[1]),i)],t=[e-a.left-a.right-2*Math.abs(s[0]),t-a.top-a.bottom-2*Math.abs(s[1])];assert$1(0<t[0]&&0<t[1]);s=t[0]/i[0],t=t[1]/i[1],i=(a.right-a.left)/2/s,a=(a.bottom-a.top)/2/t,a=[(l[0]+r[0])/2+i,(l[1]+r[1])/2+a],a=h.unproject(a),t=Math.min(n,h.zoom+log2(Math.abs(Math.min(s,t))));return assert$1(Number.isFinite(t)),{longitude:a[0],latitude:a[1],zoom:t}}const DEGREES_TO_RADIANS$2=Math.PI/180;function getBounds$1(e,t=0){const{width:r,height:i,unproject:n}=e;var a={targetZ:t},s=n([0,i],a),o=n([r,i],a);let l,c;var h=e.fovy?.5*e.fovy*DEGREES_TO_RADIANS$2:Math.atan(.5/e.altitude),u=(90-e.pitch)*DEGREES_TO_RADIANS$2;return c=u-.01<h?(l=unprojectOnFarPlane(e,0,t),unprojectOnFarPlane(e,r,t)):(l=n([0,0],a),n([r,0],a)),[s,o,c,l]}function unprojectOnFarPlane(e,t,r){var i=e["pixelUnprojectionMatrix"],n=transformVector(i,[t,0,1,1]),t=transformVector(i,[t,e.height,1,1]);const a=worldToLngLat(lerp$1([],n,t,(r*e.distanceScales.unitsPerMeter[2]-n[2])/(t[2]-n[2])));return a[2]=r,a}class WebMercatorViewport$1{constructor({width:e,height:t,latitude:r=0,longitude:i=0,zoom:n=0,pitch:a=0,bearing:s=0,altitude:o=null,fovy:l=null,position:c=null,nearZMultiplier:h=.02,farZMultiplier:u=1.01}={width:1,height:1}){e=e||1,t=t||1,null===l&&null===o?l=altitudeToFovy(o=DEFAULT_ALTITUDE):null===l?l=altitudeToFovy(o):null===o&&(o=fovyToAltitude(l));var d=zoomToScale(n);o=Math.max(.75,o);var p=getDistanceScales({longitude:i,latitude:r});const f=lngLatToWorld([i,r]);f[2]=0,c&&add$1(f,f,mul([],c,p.unitsPerMeter)),this.projectionMatrix=getProjectionMatrix({width:e,height:t,pitch:a,fovy:l,nearZMultiplier:h,farZMultiplier:u}),this.viewMatrix=getViewMatrix({height:t,scale:d,center:f,pitch:a,bearing:s,altitude:o}),this.width=e,this.height=t,this.scale=d,this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=a,this.bearing=s,this.altitude=o,this.fovy=l,this.center=f,this.meterOffset=c||[0,0,0],this.distanceScales=p,this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}_initMatrices(){var{width:e,height:t,projectionMatrix:r,viewMatrix:i}=this,n=createMat4$1();multiply(n,n,r),multiply(n,n,i),this.viewProjectionMatrix=n;i=createMat4$1();scale$1(i,i,[e/2,-t/2,1]),translate$1(i,i,[1,-1,0]),multiply(i,i,n);n=invert(createMat4$1(),i);if(!n)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=i,this.pixelUnprojectionMatrix=n}equals(e){return e instanceof WebMercatorViewport$1&&(e.width===this.width&&e.height===this.height&&equals$2(e.projectionMatrix,this.projectionMatrix)&&equals$2(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){var r=worldToPixels(this.projectPosition(e),this.pixelProjectionMatrix),[i,n]=r,n=t?n:this.height-n;return 2===e.length?[i,n]:[i,n,r[2]]}unproject(e,{topLeft:t=!0,targetZ:r=void 0}={}){var[i,n,e]=e,t=t?n:this.height-n,n=r&&r*this.distanceScales.unitsPerMeter[2],i=pixelsToWorld([i,t,e],this.pixelUnprojectionMatrix,n),[t,n,i]=this.unprojectPosition(i);return Number.isFinite(e)?[t,n,i]:Number.isFinite(r)?[t,n,r]:[t,n]}projectPosition(e){var[t,r]=lngLatToWorld(e);return[t,r,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){var[t,r]=worldToLngLat(e);return[t,r,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){return lngLatToWorld(e)}unprojectFlat(e){return worldToLngLat(e)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){t=pixelsToWorld(t,this.pixelUnprojectionMatrix),t=add$2([],lngLatToWorld(e),negate$1([],t));return worldToLngLat(add$2([],this.center,t))}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}fitBounds(e,t={}){var{width:r,height:i}=this,{longitude:n,latitude:e,zoom:t}=fitBounds(Object.assign({width:r,height:i,bounds:e},t));return new WebMercatorViewport$1({width:r,height:i,longitude:n,latitude:e,zoom:t})}getBounds(e){const t=this.getBoundingRegion(e);var r=Math.min(...t.map(e=>e[0])),e=Math.max(...t.map(e=>e[0]));return[[r,Math.min(...t.map(e=>e[1]))],[e,Math.max(...t.map(e=>e[1]))]]}getBoundingRegion(e={}){return getBounds$1(this,e.z||0)}}const MAX_LATITUDE=85.05113,MIN_LATITUDE=-85.05113;function normalizeViewportProps({width:e,height:t,longitude:r,latitude:i,zoom:n,pitch:a=0,bearing:s=0}){(r<-180||180<r)&&(r=mod(r+180,360)-180),(s<-180||180<s)&&(s=mod(s+180,360)-180);let o=new WebMercatorViewport$1({width:e,height:t,longitude:r,latitude:i,zoom:n}),l=o.project([r,MAX_LATITUDE])[1],c=o.project([r,MIN_LATITUDE])[1],h=0;return c-l<t&&(n+=log2(t/(c-l)),o=new WebMercatorViewport$1({width:e,height:t,longitude:r,latitude:i,zoom:n}),l=o.project([r,MAX_LATITUDE])[1],c=o.project([r,MIN_LATITUDE])[1]),0<l?h=l:c<t&&(h=c-t),{width:e,height:t,longitude:r,latitude:i=h?o.unproject([e/2,t/2+h])[1]:i,zoom:n,pitch:a,bearing:s}}const vs$5="\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs$6="\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",getMemoizedViewportCenterPosition=memoize(getViewportCenterPosition),getMemoizedViewProjectionMatrices=memoize(getViewProjectionMatrices),DEFAULT_SHADOW_COLOR$1=[0,0,0,1],VECTOR_TO_POINT_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function screenToCommonSpace(e,t){var[r,i,e]=e,t=pixelsToWorld([r,i,e],t);return Number.isFinite(e)?t:[t[0],t[1],0]}function getViewportCenterPosition({viewport:e,center:t}){return new Matrix4$1(e.viewProjectionMatrix).invert().transform(t)}function getViewProjectionMatrices({viewport:e,shadowMatrices:t}){const r=[],i=e.pixelUnprojectionMatrix,n=e.isGeospatial?void 0:1,a=[[0,0,n],[e.width,0,n],[0,e.height,n],[e.width,e.height,n],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>screenToCommonSpace(e,i));for(const s of t){const o=s.clone().translate(new Vector3$1(e.center).negate()),l=a.map(e=>o.transform(e)),c=(new Matrix4$1).ortho({left:Math.min(...l.map(e=>e[0])),right:Math.max(...l.map(e=>e[0])),bottom:Math.min(...l.map(e=>e[1])),top:Math.max(...l.map(e=>e[1])),near:Math.min(...l.map(e=>-e[2])),far:Math.max(...l.map(e=>-e[2]))});r.push(c.multiplyRight(s))}return r}function createShadowUniforms(t={},r={}){const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&0<t.shadowMaps.length,shadow_uColor:t.shadowColor||DEFAULT_SHADOW_COLOR$1,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length};var n=getMemoizedViewportCenterPosition({viewport:t.viewport,center:r.project_uCenter});const a=[],s=getMemoizedViewProjectionMatrices({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let e=0;e<t.shadowMatrices.length;e++){const o=s[e],l=o.clone().translate(new Vector3$1(t.viewport.center).negate());r.project_uCoordinateSystem===COORDINATE_SYSTEM.LNGLAT&&r.project_uProjectionMode===PROJECTION_MODE.WEB_MERCATOR?(s[e]=l,a[e]=n):(s[e]=o.clone().multiplyRight(VECTOR_TO_POINT_MATRIX),a[e]=l.transform(n))}for(let e=0;e<s.length;e++)i["shadow_uViewProjectionMatrices[".concat(e,"]")]=s[e],i["shadow_uProjectCenters[".concat(e,"]")]=a[e],t.shadowMaps&&0<t.shadowMaps.length?i["shadow_uShadowMap".concat(e)]=t.shadowMaps[e]:i["shadow_uShadowMap".concat(e)]=t.dummyShadowMap;return i}var shadow={name:"shadow",dependencies:[project],vs:vs$5,fs:fs$6,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(e={},t={})=>{if(e.drawToShadowMap||e.shadowMaps&&0<e.shadowMaps.length){var{shadowEnabled:r=!0}=e;return r&&e.shadowMatrices&&0<e.shadowMatrices.length?createShadowUniforms(e,t):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}},picking={inject:{"vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  // for picking depth values\n  picking_setPickingAttribute(geometry.position.z);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...picking$1};const DEFAULT_MODULES=[project],SHADER_HOOKS=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function createProgramManager(e){const t=ProgramManager.getDefaultProgramManager(e);for(const r of DEFAULT_MODULES)t.addDefaultModule(r);for(const i of SHADER_HOOKS)t.addShaderHook(i);return t}const DEFAULT_LIGHT_COLOR$1=[255,255,255],DEFAULT_LIGHT_INTENSITY$1=1;let idCount$1=0;class AmbientLight$1{constructor(e={}){var{color:t=DEFAULT_LIGHT_COLOR$1}=e,{intensity:r=DEFAULT_LIGHT_INTENSITY$1}=e;this.id=e.id||"ambient-".concat(idCount$1++),this.color=t,this.intensity=r,this.type="ambient"}}const DEFAULT_LIGHT_COLOR=[255,255,255],DEFAULT_LIGHT_INTENSITY=1,DEFAULT_LIGHT_DIRECTION=[0,0,-1];let idCount=0;class DirectionalLight$1{constructor(e={}){var{color:t=DEFAULT_LIGHT_COLOR}=e,{intensity:r=DEFAULT_LIGHT_INTENSITY}=e,{direction:i=DEFAULT_LIGHT_DIRECTION}=e,{_shadow:n=!1}=e;this.id=e.id||"directional-".concat(idCount++),this.color=t,this.intensity=r,this.type="directional",this.direction=new Vector3$1(i).normalize().toArray(),this.shadow=n}getProjectedLight(){return this}}class Effect{constructor(e={}){var{id:t="effect"}=e;this.id=t,this.props={...e}}preRender(){}getModuleParameters(){}cleanup(){}}class Pass{constructor(e,t={}){var{id:r="pass"}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(){}cleanup(){}}class LayersPass extends Pass{render(e){return setParameters(this.gl,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{viewports:t,views:r,onViewportActive:i,clearCanvas:n=!0}=e;e.pass=e.pass||"unknown";var a=this.gl;n&&clearGLCanvas(a);const s=[];for(const u of t){var o=u.viewport||u,l=r&&r[o.id];i(o);var c=this._getDrawLayerParams(o,e);e.view=l;for(const d of o.subViewports||[o]){e.viewport=d;var h=this._drawLayersInViewport(a,e,c);s.push(h)}}return s}_getDrawLayerParams(t,{layers:r,pass:i,layerFilter:n,effects:a,moduleParameters:s}){const o=[],l=layerIndexResolver();var c={viewport:t,isPicking:i.startsWith("picking"),renderPass:i},h={};for(let e=0;e<r.length;e++){var u=r[e],d=this._shouldDrawLayer(u,c,n,h);const p={shouldDrawLayer:d,layerRenderIndex:l(u,d)};d&&(p.moduleParameters=this._getModuleParameters(u,a,i,s),p.layerParameters=this.getLayerParameters(u,e,t)),o[e]=p}return o}_drawLayersInViewport(e,{layers:t,pass:r,viewport:i,view:n},a){var s=getGLViewport(e,{viewport:i});if(n&&n.props.clear){const l=!0===n.props.clear?{color:!0,depth:!0}:n.props.clear;withParameters(e,{scissorTest:!0,scissor:s},()=>clear(e,l))}const o={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};setParameters(e,{viewport:s});for(let e=0;e<t.length;e++){const c=t[e],{shouldDrawLayer:h,layerRenderIndex:u,moduleParameters:d,layerParameters:p}=a[e];if(h&&c.props.pickable&&o.pickableCount++,c.isComposite)o.compositeCount++;else if(h){o.visibleCount++,d.viewport=i;try{c.drawLayer({moduleParameters:d,uniforms:{layerIndex:u},parameters:p})}catch(e){c.raiseError(e,"drawing ".concat(c," to ").concat(r))}}}return o}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(this.shouldDrawLayer(e)&&e.props.visible))return!1;let n=(t.layer=e).parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(t))return!1;t.layer=n,n=n.parent}if(r){var a=t.layer.id;if(a in i||(i[a]=r(t)),!i[a])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,i){var n=Object.assign(Object.create(e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:cssToDeviceRatio(this.gl)});if(t)for(const a of t)Object.assign(n,a.getModuleParameters(e));return Object.assign(n,this.getModuleParameters(e,t),i)}}function layerIndexResolver(o=0,l={}){const c={},h=(e,t)=>{var r=e.props._offset,i=e.id,n=e.parent&&e.parent.id;let a;if(!n||n in l||h(e.parent,!1),n in c){const s=c[n]=c[n]||layerIndexResolver(l[n],l);a=s(e,t),c[i]=s}else Number.isFinite(r)?(a=r+(l[n]||0),c[i]=null):a=o;return t&&a>=o&&(o=a+1),l[i]=a,a};return h}function getGLViewport(e,{viewport:t}){var r=e.canvas?e.canvas.clientHeight||e.canvas.height:100,t=t,e=cssToDeviceRatio(e);return[t.x*e,(r-t.y-t.height)*e,t.width*e,t.height*e]}function clearGLCanvas(e){setParameters(e,{viewport:[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}),e.clear(16640)}class ShadowPass extends LayersPass{constructor(e,t){super(e,t),this.shadowMap=new Texture2D(e,{width:1,height:1,parameters:{[10241]:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Renderbuffer(e,{format:33189,width:1,height:1}),this.fbo=new Framebuffer(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,36096:this.depthBuffer}})}render(i){const n=this.fbo;withParameters(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{var e=i.viewports[0],t=cssToDeviceRatio(this.gl),r=e.width*t,t=e.height*t;r===n.width&&t===n.height||n.resize({width:r,height:t}),super.render({...i,target:n,pass:"shadow"})})}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const DEFAULT_AMBIENT_LIGHT_PROPS={color:[255,255,255],intensity:1},DEFAULT_DIRECTIONAL_LIGHT_PROPS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],DEFAULT_SHADOW_COLOR=[0,0,0,200/255];class LightingEffect extends Effect{constructor(e){super(e),this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowColor=DEFAULT_SHADOW_COLOR,this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.shadow=!1,this.programManager=null;for(const r in e){var t=e[r];switch(t.type){case"ambient":this.ambientLight=t;break;case"directional":this.directionalLights.push(t);break;case"point":this.pointLights.push(t)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow)}preRender(e,{layers:t,layerFilter:r,viewports:i,onViewportActive:n,views:a}){if(this.shadow){this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(e),this.programManager||(this.programManager=ProgramManager.getDefaultProgramManager(e),shadow&&this.programManager.addDefaultModule(shadow)),this.dummyShadowMap||(this.dummyShadowMap=new Texture2D(e,{width:1,height:1}));for(let e=0;e<this.shadowPasses.length;e++){const s=this.shadowPasses[e];s.render({layers:t,layerFilter:r,viewports:i,onViewportActive:n,views:a,moduleParameters:{shadowLightId:e,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(e=>e.getProjectedLight({layer:t})),pointLights:this.pointLights.map(e=>e.getProjectedLight({layer:t}))},e}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(shadow),this.programManager=null)}_createLightMatrix(){const e=[];for(const r of this.directionalLights){var t=(new Matrix4$1).lookAt({eye:new Vector3$1(r.direction).negate()});e.push(t)}return e}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){var r=new ShadowPass(t);this.shadowPasses[e]=r,this.shadowMaps[e]=r.shadowMap}}_applyDefaultLights(){var{ambientLight:e,pointLights:t,directionalLights:r}=this;e||0!==t.length||0!==r.length||(this.ambientLight=new AmbientLight$1(DEFAULT_AMBIENT_LIGHT_PROPS),this.directionalLights.push(new DirectionalLight$1(DEFAULT_DIRECTIONAL_LIGHT_PROPS[0]),new DirectionalLight$1(DEFAULT_DIRECTIONAL_LIGHT_PROPS[1])))}}class TypedArrayManager{constructor(e){this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(e)}setProps(e){Object.assign(this.props,e)}allocate(e,t,{size:r=1,type:i,padding:n=0,copy:a=!1,initialize:s=!1,maxCount:o}){const l=i||e&&e.constructor||Float32Array;t=t*r+n;if(ArrayBuffer.isView(e)){if(t<=e.length)return e;if(t*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,t)}let c;o&&(c=o*r+n);const h=this._allocate(l,t,s,c);return e&&a?h.set(e):s||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,r,i){let n=Math.max(Math.ceil(t*this.props.overAlloc),1);n>i&&(n=i);const a=this._pool,s=e.BYTES_PER_ELEMENT*n;i=a.findIndex(e=>e.byteLength>=s);if(0<=i){const o=new e(a.splice(i,1)[0],0,n);return r&&o.fill(0),o}return new e(n)}_release(e){if(ArrayBuffer.isView(e)){const r=this._pool;var t=e["buffer"];const i=t["byteLength"];e=r.findIndex(e=>e.byteLength>=i);e<0?r.push(t):(0<e||r.length<this.props.poolSize)&&r.splice(e,0,t),r.length>this.props.poolSize&&r.shift()}}}var defaultTypedArrayManager=new TypedArrayManager;function createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function getCameraPosition(e){return[e[12],e[13],e[14]]}function getFrustumPlanes(e){const t={};return t.left=getFrustumPlane(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),t.right=getFrustumPlane(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),t.bottom=getFrustumPlane(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),t.top=getFrustumPlane(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),t.near=getFrustumPlane(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),t.far=getFrustumPlane(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]),t}const scratchVector=new Vector3$1;function getFrustumPlane(e,t,r,i){scratchVector.set(e,t,r);var n=scratchVector.len();return{distance:i/n,normal:new Vector3$1(-e/n,-t/n,-r/n)}}function fp64LowPart(e){return e-Math.fround(e)}let scratchArray;function toDoublePrecisionArray(t,{size:r=1,startIndex:e=0,endIndex:i}){var n=((i=!Number.isFinite(i)?t.length:i)-e)/r;scratchArray=defaultTypedArrayManager.allocate(scratchArray,n,{type:Float32Array,size:2*r});let a=e,s=0;for(;a<i;){for(let e=0;e<r;e++){var o=t[a++];scratchArray[s+e]=o,scratchArray[s+e+r]=fp64LowPart(o)}s+=2*r}return scratchArray.subarray(0,n*r*2)}const DEGREES_TO_RADIANS$1=Math.PI/180,IDENTITY=createMat4(),ZERO_VECTOR=[0,0,0],DEFAULT_ZOOM=0,DEFAULT_DISTANCE_SCALES={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Viewport{constructor(e={}){var{id:t=null,x:r=0,y:i=0,width:n=1,height:a=1}=e;this.id=t||this.constructor.displayName||"viewport",this.x=r,this.y=i,this.width=n||1,this.height=a||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?PROJECTION_MODE.WEB_MERCATOR:PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:PROJECTION_MODE.IDENTITY}equals(e){return e instanceof Viewport&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&equals$3(e.projectionMatrix,this.projectionMatrix)&&equals$3(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){var r=worldToPixels(this.projectPosition(e),this.pixelProjectionMatrix),[i,n]=r,n=t?n:this.height-n;return 2===e.length?[i,n]:[i,n,r[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){var[i,n,e]=e,t=t?n:this.height-n,n=r&&r*this.distanceScales.unitsPerMeter[2],i=pixelsToWorld([i,t,e],this.pixelUnprojectionMatrix,n),[t,n,i]=this.unprojectPosition(i);return Number.isFinite(e)?[t,n,i]:Number.isFinite(r)?[t,n,r]:[t,n]}projectPosition(e){var[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){var[t,r]=this.unprojectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){return this.isGeospatial?lngLatToWorld(e):e}unprojectFlat(e){return this.isGeospatial?worldToLngLat(e):e}getBounds(e={}){var t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),e=this.unproject([0,this.height],t),t=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],e[0],t[0]),Math.min(r[1],i[1],e[1],t[1]),Math.max(r[0],i[0],e[0],t[0]),Math.max(r[1],i[1],e[1],t[1])]}getDistanceScales(e=null){return e?getDistanceScales({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,getFrustumPlanes(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(e,t){return null}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_createProjectionMatrix({orthographic:e,fovyRadians:t,aspect:r,focalDistance:i,near:n,far:a}){return e?(new Matrix4$1).orthographic({fovy:t,aspect:r,focalDistance:i,near:n,far:a}):(new Matrix4$1).perspective({fovy:t,aspect:r,near:n,far:a})}_initViewMatrix(e){const{viewMatrix:t=IDENTITY,longitude:r=null,latitude:i=null,zoom:n=null,position:a=null,modelMatrix:s=null,focalDistance:o=1,distanceScales:l=null}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this.zoom=n,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?getMeterZoom({latitude:i})+Math.log2(o):DEFAULT_ZOOM);e=Math.pow(2,this.zoom);this.scale=e,this.distanceScales=this.isGeospatial?getDistanceScales({latitude:i,longitude:r}):l||DEFAULT_DISTANCE_SCALES,this.focalDistance=o,this.distanceScales.metersPerUnit=new Vector3$1(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new Vector3$1(this.distanceScales.unitsPerMeter),this.position=ZERO_VECTOR,this.meterOffset=ZERO_VECTOR,a&&(this.position=a,this.modelMatrix=s,this.meterOffset=s?s.transformVector(a):a),this.isGeospatial?(this.longitude=r,this.latitude=i,this.center=this._getCenterInWorld({longitude:r,latitude:i})):this.center=a?this.projectPosition(a):[0,0,0],this.viewMatrixUncentered=t,this.viewMatrix=(new Matrix4$1).multiplyRight(this.viewMatrixUncentered).translate(new Vector3$1(this.center||ZERO_VECTOR).negate())}_getCenterInWorld({longitude:e,latitude:t}){var{meterOffset:r,distanceScales:i}=this;const n=new Vector3$1(this.projectPosition([e,t,0]));return r&&(i=new Vector3$1(r).scale(i.unitsPerMeter),n.add(i)),n}_initProjectionMatrix(e){var{projectionMatrix:t=null,orthographic:r=!1,fovyRadians:i,fovy:n=75,near:a=.1,far:s=1e3,focalDistance:e=1}=e;this.projectionMatrix=t||this._createProjectionMatrix({orthographic:r,fovyRadians:i||n*DEGREES_TO_RADIANS$1,aspect:this.width/this.height,focalDistance:e,near:a,far:s})}_initPixelMatrices(){var e=createMat4();multiply(e,e,this.projectionMatrix),multiply(e,e,this.viewMatrix),this.viewProjectionMatrix=e,this.viewMatrixInverse=invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=getCameraPosition(this.viewMatrixInverse);var t=createMat4(),e=createMat4();scale$1(t,t,[this.width/2,-this.height/2,1]),translate$1(t,t,[1,-1,0]),multiply(e,t,this.viewProjectionMatrix),this.pixelProjectionMatrix=e,this.viewportMatrix=t,this.pixelUnprojectionMatrix=invert(createMat4(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||log$2.warn("Pixel project matrix not invertible")()}}Viewport.displayName="Viewport";const TILE_SIZE=512,EARTH_CIRCUMFERENCE=4003e4,DEGREES_TO_RADIANS=Math.PI/180;function unitsPerMeter(e){e=Math.cos(e*DEGREES_TO_RADIANS);return TILE_SIZE/EARTH_CIRCUMFERENCE/e}class WebMercatorViewport extends Viewport{constructor(e={}){var{latitude:t=0,longitude:r=0,zoom:i=11,pitch:n=0,bearing:a=0,nearZMultiplier:s=.1,farZMultiplier:o=1.01,orthographic:l=!1,projectionMatrix:c,repeat:h=!1,worldOffset:u=0,legacyMeterSizes:d=!1}=e;let{width:p,height:f,altitude:m=1.5}=e;var g=Math.pow(2,i);p=p||1,f=f||1;let _,v=null;c?(m=c[5]/2,_=altitudeToFovy(m)):(e.fovy?(_=e.fovy,m=fovyToAltitude(_)):_=altitudeToFovy(m),v=getProjectionParameters({width:p,height:f,pitch:n,fovy:_,nearZMultiplier:s,farZMultiplier:o}));let y=getViewMatrix({height:f,pitch:n,bearing:a,scale:g,altitude:m});if(u){const x=(new Matrix4$1).translate([512*u,0,0]);y=x.multiplyLeft(y)}super({...e,width:p,height:f,viewMatrix:y,longitude:r,latitude:t,zoom:i,...v,fovy:_,focalDistance:m}),this.latitude=t,this.longitude=r,this.zoom=i,this.pitch=n,this.bearing=a,this.altitude=m,this.fovy=_,this.orthographic=l,this._subViewports=h?[]:null,this._pseudoMeters=d,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){var e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let e=t;e<=r;e++){var i=e?new WebMercatorViewport({...this,worldOffset:e}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);var[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*unitsPerMeter(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);var[t,r]=this.unprojectFlat(e);return[t,r,(e[2]||0)/unitsPerMeter(r)]}addMetersToLngLat(e,t){return addMetersToLngLat(e,t)}panByPosition(e,t){var t=pixelsToWorld(t,this.pixelUnprojectionMatrix),e=add$2([],this.projectFlat(e),negate$1([],t)),t=add$2([],this.center,e),[e,t]=this.unprojectFlat(t);return{longitude:e,latitude:t}}getBounds(e={}){e=getBounds$1(this,e.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(e,t={}){var{width:r,height:i}=this,{longitude:n,latitude:e,zoom:t}=fitBounds({width:r,height:i,bounds:e,...t});return new WebMercatorViewport({width:r,height:i,longitude:n,latitude:e,zoom:t})}}function lngLatZToWorldPosition(e,t,r=!1){const i=t.projectPosition(e);var n;return r&&t instanceof WebMercatorViewport&&([n,r,e=0]=e,r=t.getDistanceScales([n,r]),i[2]=e*r.unitsPerMeter[2]),i}function normalizeParameters(e){const t={...e};let r=e["coordinateSystem"];var{viewport:i,coordinateOrigin:n,fromCoordinateSystem:a,fromCoordinateOrigin:e}=e;return r===COORDINATE_SYSTEM.DEFAULT&&(r=i.isGeospatial?COORDINATE_SYSTEM.LNGLAT:COORDINATE_SYSTEM.CARTESIAN),void 0===a&&(t.fromCoordinateSystem=r),void 0===e&&(t.fromCoordinateOrigin=n),t.coordinateSystem=r,t}function getWorldPosition(e,{viewport:t,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:a}){let[s,o,l=0]=e;switch(r&&([s,o,l]=transformMat4([],[s,o,l,1],r)),i){case COORDINATE_SYSTEM.LNGLAT:return lngLatZToWorldPosition([s,o,l],t,a);case COORDINATE_SYSTEM.LNGLAT_OFFSETS:return lngLatZToWorldPosition([s+n[0],o+n[1],l+(n[2]||0)],t,a);case COORDINATE_SYSTEM.METER_OFFSETS:return lngLatZToWorldPosition(addMetersToLngLat(n,[s,o,l]),t,a);default:COORDINATE_SYSTEM.CARTESIAN;return t.isGeospatial?[s+n[0],o+n[1],l+n[2]]:t.projectPosition([s,o,l])}}function projectPosition(e,t){const{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:a,fromCoordinateSystem:s,fromCoordinateOrigin:o}=normalizeParameters(t);var{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:t}=getOffsetOrigin(r,i,n),e=getWorldPosition(e,{viewport:r,modelMatrix:a,coordinateSystem:s,coordinateOrigin:o,offsetMode:t});return t&&(c=r.projectPosition(l||c),sub(e,e,c)),e}WebMercatorViewport.displayName="WebMercatorViewport";const LIFECYCLE={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},PROP_SYMBOLS={COMPONENT:Symbol.for("component"),ASYNC_DEFAULTS:Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL:Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED:Symbol.for("asyncPropResolved")};function flatten$1(e,t=()=>!0){return Array.isArray(e)?flattenArray(e,t,[]):t(e)?[e]:[]}function flattenArray(e,t,r){let i=-1;for(;++i<e.length;){var n=e[i];Array.isArray(n)?flattenArray(n,t,r):t(n)&&r.push(n)}return r}function fillArray({target:t,source:r,start:i=0,count:e=1}){var n=r.length,a=e*n;let s=0;for(let e=i;s<n;s++)t[e++]=r[s];for(;s<a;)s<a-s?(t.copyWithin(i+s,i,i+s),s*=2):(t.copyWithin(i+s,i,i+a-s),s=a);return t}class Resource{constructor(e,t,r){this.id=e,this.context=r,this._loadCount=0,this._subscribers=new Set,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return 0<this._subscribers.size}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t!==this._data||e){this._data=t;const r=++this._loadCount;let e=t;"string"==typeof t&&(e=load(t)),e instanceof Promise?(this.isLoaded=!1,this._loader=e.then(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=null,this._content=e)}).catch(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=null,this._content=t);for(const i of this._subscribers)i.onChange(this.getData())}}}class ResourceManager{constructor({gl:e,protocol:t}){this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let n=this._resources[e];n?n.setData(t,r):(n=new Resource(e,t,this._context),this._resources[e]=n),n.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){var t=this._consumers[e];if(t){for(const r in t){const i=t[r];i.resource&&i.resource.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){var{_resources:n,protocol:a}=this;e.startsWith(a)&&(n[e=e.replace(a,"")]||this.add({resourceId:e,data:null,persistent:!1}));const s=n[e];if(this._track(r,i,s,t),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,i){const n=this._consumers,a=n[e]=n[e]||{},s=a[t]||{};s.resource&&(s.resource.unsubscribe(s),s.resource=null,this.prune()),r&&(a[t]=s,s.onChange=i,(s.resource=r).subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}const TRACE_SET_LAYERS="layerManager.setLayers",TRACE_ACTIVATE_VIEWPORT="layerManager.activateViewport",INITIAL_CONTEXT=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}});class LayerManager{constructor(e,{deck:t,stats:r,viewport:i,timeline:n}={}){this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new ResourceManager({gl:e,protocol:"deck://"}),this.context={...INITIAL_CONTEXT,layerManager:this,gl:e,deck:t,programManager:e&&createProgramManager(e),stats:r||new Stats({id:"deck.gl"}),viewport:i||new Viewport({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:n||new Timeline,resourceManager:this.resourceManager},this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){var r=i.getNeedsRedraw(e);t=t||r}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e=null}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){debug(TRACE_SET_LAYERS,this,t,e);for(const r of e=flatten$1(this.lastRenderedLayers=e,Boolean))r.context=this.context;return this._updateLayers(this.layers,e),this}updateLayers(){var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this.lastRenderedLayers,e)),this._nextLayers=null}activateViewport(e){return debug(TRACE_ACTIVATE_VIEWPORT,this,e),e&&(this.context.viewport=e),this}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const n of e)r[n.id]?log$2.warn("Multiple old layers with same id ".concat(n.id))():r[n.id]=n;e=[];this._updateSublayersRecursively(t,r,e),this._finalizeOldLayers(r);let i=!1;for(const a of e)if(a.hasUniformTransition()){i=!0;break}this._needsUpdate=i,this.layers=e}_updateSublayersRecursively(e,t,r){for(const n of e){n.context=this.context;var i=t[n.id];null===i&&log$2.warn("Multiple new layers with same id ".concat(n.id))();let e=t[n.id]=null;try{this._debug&&i!==n&&n.validateProps(),i?(this._transferLayerState(i,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),e=n.isComposite&&n.getSubLayers()}catch(e){this._handleError("matching",e,n)}e&&this._updateSublayersRecursively(e,t,r)}}_finalizeOldLayers(e){for(const r in e){var t=e[r];t&&this._finalizeLayer(t)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=LIFECYCLE.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=LIFECYCLE.MATCHED,t!==e&&(e.lifecycle=LIFECYCLE.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=LIFECYCLE.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=LIFECYCLE.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function deepEqual(e,t){if(e===t)return!0;if(!e||!t)return!1;for(const n in e){var r=e[n],i=t[n];if(!(r===i||Array.isArray(r)&&Array.isArray(i)&&deepEqual(r,i)))return!1}return!0}class ViewManager{constructor(e={}){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers)this.controllers[e]&&this.controllers[e].finalize();this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){var t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return"string"==typeof t?this.views.find(e=>e.id===t):t}getViewState(e){const t=this.getView(e);e=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(e):e}getViewport(e){return this._viewportMap[e]}unproject(t,r){var i=this.getViewports(),n={x:t[0],y:t[1]};for(let e=i.length-1;0<=e;--e){const a=i[e];if(a.containsPixel(n)){const s=t.slice();return s[0]-=a.x,s[1]-=a.y,a.unproject(s,r)}}return null}setProps(e){"views"in e&&this._setViews(e.views),"viewState"in e&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=flatten$1(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(deepEqual(e,this.viewState)||this.setNeedsUpdate("viewState changed"),this.viewState=e):log$2.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){t.viewId=e,this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(t)}_createController(t,e){const r=e.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:e=>t._getViewport(e,{width:e.width,height:e.height}),...e})}_updateController(e,t,r,i){var n=e.controller;return n?(n={...t,...e.props,...n,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height},i?i.setProps(n):i=this._createController(e,n),i):null}_rebuildViewports(){var{width:r,height:i,views:n}=this;const a=this.controllers;this._viewports=[];let s=!(this.controllers={});for(let t=n.length;t--;){const c=n[t];var o=this.getViewState(c),l=c.makeViewport({width:r,height:i,viewState:o});let e=a[c.id];c.controller&&!e&&(s=!0),!s&&c.controller||!e||(e.finalize(),e=null),this.controllers[c.id]=this._updateController(c,o,l,e),this._viewports.unshift(l)}for(const e in a)a[e]&&!this.controllers[e]&&a[e].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(r,i){return r.length!==i.length||r.some((e,t)=>!r[t].equals(i[t]))}}const PERCENT_OR_PIXELS_REGEX=/([0-9]+\.?[0-9]*)(%|px)/;function parsePosition(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":var t=e.match(PERCENT_OR_PIXELS_REGEX);if(t&&3<=t.length){var r="%"===t[2],t=parseFloat(t[1]);return{position:r?t/100:t,relative:r}}default:throw new Error("Could not parse position string ".concat(e))}}function getPosition(e,t){return e.relative?Math.round(e.position*t):e.position}function assert(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class View{constructor(e={}){var{id:t=null,x:r=0,y:i=0,width:n="100%",height:a="100%",viewportInstance:s,type:o=Viewport}=e;assert(!s||s instanceof Viewport),this.viewportInstance=s,this.id=t||this.constructor.displayName||"view",this.type=o,this.props={...e,id:this.id},this._parseDimensions({x:r,y:i,width:n,height:a}),this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||(this.viewportInstance?e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance):deepEqual(this.props,e.props))}makeViewport({width:e,height:t,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);t=this.getDimensions({width:e,height:t});return this._getViewport(r,t)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)"id"!==r&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){return{x:getPosition(this._x,e),y:getPosition(this._y,t),width:getPosition(this._width,e),height:getPosition(this._height,t)}}_getControllerProps(e){let t=this.props.controller;return t?!0===t?e:("function"==typeof t&&(t={type:t}),{...e,...t}):null}_getViewport(e,t){const r=this["type"];return new r({...e,...this.props,...t})}_parseDimensions({x:e,y:t,width:r,height:i}){this._x=parsePosition(e),this._y=parsePosition(t),this._width=parsePosition(r),this._height=parsePosition(i)}}function noop$3(){}const DEFAULT_SETTINGS={onStart:noop$3,onUpdate:noop$3,onInterrupt:noop$3,onEnd:noop$3};class Transition{constructor(e){this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings={...DEFAULT_SETTINGS,...e},this._inProgress=!0,this.settings.onStart(this)}end(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}cancel(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const noop$2=()=>{},TRANSITION_EVENTS={BREAK:1,SNAP_TO_END:2,IGNORE:3},DEFAULT_PROPS$1={transitionEasing:e=>e,transitionInterruption:TRANSITION_EVENTS.BREAK,onTransitionStart:noop$2,onTransitionInterrupt:noop$2,onTransitionEnd:noop$2};class TransitionManager{constructor(e,t={}){this.ControllerState=e,this.props={...DEFAULT_PROPS$1,...t},this.propsInTransition=null,this.transition=new Transition(t.timeline),this.onViewStateChange=t.onViewStateChange||noop$2,this.onStateChange=t.onStateChange||noop$2,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;var r,i,n=this.props;return e={...DEFAULT_PROPS$1,...e},this.props=e,this._shouldIgnoreViewportChange(n,e)||(this._isTransitionEnabled(e)?({interruption:r,endProps:i}=this.transition.settings,n={...n,...r===TRANSITION_EVENTS.SNAP_TO_END?i:this.propsInTransition||n},this._triggerTransition(n,e),t=!0):this.transition.cancel()),t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){var{transitionDuration:t,transitionInterpolator:e}=e;return(0<t||"auto"===t)&&Boolean(e)}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===TRANSITION_EVENTS.IGNORE||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){var r=new this.ControllerState(e),i=new this.ControllerState(t).shortestPathFrom(r);const n=t["transitionInterpolator"];r=n.getDuration?n.getDuration(e,t):t.transitionDuration;0!==r&&(i=t.transitionInterpolator.initializeProps(e,i),this.propsInTransition={},this.duration=r,this.transition.start({duration:r,easing:t.transitionEasing,interpolator:t.transitionInterpolator,interruption:t.transitionInterruption,startProps:i.start,endProps:i.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition())}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t(e)}}_onTransitionUpdate(e){const{time:t,settings:{interpolator:r,startProps:i,endProps:n,duration:a,easing:s}}=e;e=s(t/a),e=r.interpolateProps(i,n,e);this.propsInTransition=new this.ControllerState({...this.props,...e}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}class TransitionInterpolator{constructor(e={}){var{compare:t,extract:r,required:e}=e=Array.isArray(e)?{compare:e,extract:e,required:e}:e;this._propsToCompare=t,this._propsToExtract=r,this._requiredProps=e}arePropsEqual(e,t){for(const r of this._propsToCompare||Object.keys(t))if(!(r in e&&r in t&&equals$3(e[r],t[r])))return!1;return!0}initializeProps(e,t){let r;if(this._propsToExtract){const i={},n={};for(const a of this._propsToExtract)i[a]=e[a],n[a]=t[a];r={start:i,end:n}}else r={start:e,end:t};return this._checkRequiredProps(r.start),this._checkRequiredProps(r.end),r}interpolateProps(e,t,r){return t}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(r){this._requiredProps&&this._requiredProps.forEach(e=>{var t=r[e];assert(Number.isFinite(t)||Array.isArray(t),"".concat(e," is required for transition"))})}}const DEFAULT_PROPS=["longitude","latitude","zoom","bearing","pitch"],DEFAULT_REQUIRED_PROPS=["longitude","latitude","zoom"];class LinearInterpolator extends TransitionInterpolator{constructor(e={}){super((Array.isArray(e)?e:e.transitionProps)||{compare:DEFAULT_PROPS,extract:DEFAULT_PROPS,required:DEFAULT_REQUIRED_PROPS}),this.opts=e}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:i,around:n}=this.opts;if(i&&n){const a=i(e),s=i(t);e=a.unproject(n);r.start.around=n,Object.assign(r.end,{around:s.project(e),aroundPosition:e,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const i={};for(const n of this._propsToExtract)i[n]=lerp$2(e[n]||0,t[n]||0,r);if(t.aroundPosition){const a=this.opts.makeViewport({...t,...i});Object.assign(i,a.panByPosition(t.aroundPosition,lerp$2(e.around,t.around,r)))}return i}}const NO_TRANSITION_PROPS={transitionDuration:0},LINEAR_TRANSITION_PROPS={transitionDuration:300,transitionEasing:e=>e,transitionInterruption:TRANSITION_EVENTS.BREAK},DEFAULT_INERTIA=300,INERTIA_EASING=e=>1-(1-e)*(1-e),EVENT_TYPES={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]};class Controller{constructor(e,t={}){this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new TransitionManager(e,{...t,onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)});e=this.linearTransitionProps;this._transition=e&&{...LINEAR_TRANSITION_PROPS,transitionInterpolator:new LinearInterpolator({transitionProps:e})},this._events=null,this._interactionState={isDragging:!1},this._customEvents=[],this.onViewStateChange=null,this.onStateChange=null,this.handleEvent=this.handleEvent.bind(this),this.setProps(t)}get linearTransitionProps(){return null}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.setProps(this.controllerStateProps)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){const t=this["ControllerState"];this.controllerState=new t({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state});var r=this._eventStartBlocked;switch(e.type){case"panstart":return!r&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!r&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!r&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}getCenter(e){var{x:t,y:r}=this.controllerStateProps,e=e["offsetCenter"];return[e.x-t,e.y-r]}isPointInBounds(e,t){var{width:r,height:i}=this.controllerStateProps;if(t&&t.handled)return!1;i=0<=e[0]&&e[0]<=r&&0<=e[1]&&e[1]<=i;return i&&t&&t.stopPropagation(),i}isFunctionKeyPressed(e){var e=e["srcEvent"];return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){"onViewStateChange"in e&&(this.onViewStateChange=e.onViewStateChange),"onStateChange"in e&&(this.onStateChange=e.onStateChange),"makeViewport"in e&&(this.makeViewport=e.makeViewport),"dragMode"in e&&(this.dragMode=e.dragMode),"eventManager"in(this.controllerStateProps=e)&&this.eventManager!==e.eventManager&&(this.eventManager=e.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let t=e["inertia"];!0===t&&(t=DEFAULT_INERTIA),this.inertia=t;var{scrollZoom:r=!0,dragPan:i=!0,dragRotate:n=!0,doubleClickZoom:a=!0,touchZoom:s=!0,touchRotate:o=!1,keyboard:l=!0}=e,e=Boolean(this.onViewStateChange);this.toggleEvents(EVENT_TYPES.WHEEL,e&&r),this.toggleEvents(EVENT_TYPES.PAN,e&&(i||n)),this.toggleEvents(EVENT_TYPES.PINCH,e&&(s||o)),this.toggleEvents(EVENT_TYPES.TRIPLE_PAN,e&&o),this.toggleEvents(EVENT_TYPES.DOUBLE_TAP,e&&a),this.toggleEvents(EVENT_TYPES.KEYBOARD,e&&l),this.scrollZoom=r,this.dragPan=i,this.dragRotate=n,this.doubleClickZoom=a,this.touchZoom=s,this.touchRotate=o,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&((this._events[e]=t)?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t={},r={}){var i={...e.getViewportProps(),...t},t=this.controllerState!==e;this._state=e.getState(),this._setInteractionState(r),t&&(t=this.controllerState?this.controllerState.getViewportProps():null,this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:t}))}_onTransition(e){this.onViewStateChange&&(e.interactionState=this._interactionState,this.onViewStateChange(e))}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange&&this.onStateChange(this._interactionState)}_onPanStart(e){var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton;!this.invertPan&&"pan"!==this.dragMode||(r=!r);t=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(t,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;e=this.getCenter(e),e=this.controllerState.pan({pos:e});return this.updateViewport(e,NO_TRANSITION_PROPS,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){var t,r=this["inertia"];return this.dragPan&&r&&e.velocity?(e=[(t=this.getCenter(e))[0]+e.velocityX*r/2,t[1]+e.velocityY*r/2],e=this.controllerState.pan({pos:e}).panEnd(),this.updateViewport(e,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:INERTIA_EASING},{isDragging:!1,isPanning:!0})):(r=this.controllerState.panEnd(),this.updateViewport(r,null,{isDragging:!1,isPanning:!1})),!0}_onPanRotate(e){if(!this.dragRotate)return!1;e=this.getCenter(e),e=this.controllerState.rotate({pos:e});return this.updateViewport(e,NO_TRANSITION_PROPS,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){var t,r=this["inertia"];return this.dragRotate&&r&&e.velocity?(e=[(t=this.getCenter(e))[0]+e.velocityX*r/2,t[1]+e.velocityY*r/2],e=this.controllerState.rotate({pos:e}).rotateEnd(),this.updateViewport(e,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:INERTIA_EASING},{isDragging:!1,isRotating:!0})):(r=this.controllerState.rotateEnd(),this.updateViewport(r,null,{isDragging:!1,isRotating:!1})),!0}_onWheel(e){if(!this.scrollZoom)return!1;e.preventDefault();var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;var{speed:r=.01,smooth:i=!1}=this.scrollZoom,e=e["delta"];let n=2/(1+Math.exp(-Math.abs(e*r)));e<0&&0!==n&&(n=1/n);e=this.controllerState.zoom({pos:t,scale:n});return this.updateViewport(e,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;t=this.controllerState.rotateStart({pos:t});return this.updateViewport(t,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;e=this.controllerState.rotate({pos:t});return this.updateViewport(e,NO_TRANSITION_PROPS,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;var t=this["inertia"];if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e);e=[r[0],r[1]+=e.velocityY*t/2],e=this.controllerState.rotate({pos:e});this.updateViewport(e,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:INERTIA_EASING},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{t=this.controllerState.rotateEnd();this.updateViewport(t,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;t=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return this._startPinchRotation=e.rotation,this._lastPinchEvent=e,this.updateViewport(t,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;var r,i;return this.touchZoom&&(i=e["scale"],r=this.getCenter(e),t=t.zoom({pos:r,scale:i})),this.touchRotate&&(i=e["rotation"],t=t.rotate({deltaAngleX:this._startPinchRotation-i})),this.updateViewport(t,NO_TRANSITION_PROPS,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=e,!0}_onPinchEnd(t){if(!this.isDragging())return!1;var{inertia:r,_lastPinchEvent:i}=this;if(this.touchZoom&&r&&i&&t.scale!==i.scale){var n=this.getCenter(t);let e=this.controllerState.rotateEnd();var a=Math.log2(t.scale),i=(a-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),i=Math.pow(2,a+i*r/2);e=e.zoom({pos:n,scale:i}).zoomEnd(),this.updateViewport(e,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:INERTIA_EASING},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,!(this._lastPinchEvent=null)}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;var t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e=this.isFunctionKeyPressed(e),e=this.controllerState.zoom({pos:t,scale:e?.5:2});return this.updateViewport(e,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;var t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:n,rotateSpeedY:a}=this.keyboard;const s=this["controllerState"];let o;const l={};switch(e.srcEvent.code){case"Minus":o=(t?s.zoomOut(r):s).zoomOut(r),l.isZooming=!0;break;case"Equal":o=(t?s.zoomIn(r):s).zoomIn(r),l.isZooming=!0;break;case"ArrowLeft":t?(o=s.rotateLeft(n),l.isRotating=!0):(o=s.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":t?(o=s.rotateRight(n),l.isRotating=!0):(o=s.moveRight(i),l.isPanning=!0);break;case"ArrowUp":t?(o=s.rotateUp(a),l.isRotating=!0):(o=s.moveUp(i),l.isPanning=!0);break;case"ArrowDown":t?(o=s.rotateDown(a),l.isRotating=!0):(o=s.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(o,this._getTransitionProps(),l),!0}_getTransitionProps(e){var t=this["_transition"];return t?e?{...t,transitionInterpolator:new LinearInterpolator({...e,transitionProps:this.linearTransitionProps,makeViewport:this.controllerState.makeViewport})}:t:NO_TRANSITION_PROPS}}class ViewState{constructor(e){this._viewportProps=this._applyConstraints(e)}getViewportProps(){return this._viewportProps}getState(){return this._state}shortestPathFrom(e){return this._viewportProps}_applyConstraints(e){return e}}const PITCH_MOUSE_THRESHOLD=5,PITCH_ACCEL=1.2,DEFAULT_STATE={pitch:0,bearing:0,altitude:1.5,minZoom:0,maxZoom:20,minPitch:0,maxPitch:60};class MapState extends ViewState{constructor({makeViewport:e,width:t,height:r,latitude:i,longitude:n,zoom:a,bearing:s=DEFAULT_STATE.bearing,pitch:o=DEFAULT_STATE.pitch,altitude:l=DEFAULT_STATE.altitude,maxZoom:c=DEFAULT_STATE.maxZoom,minZoom:h=DEFAULT_STATE.minZoom,maxPitch:u=DEFAULT_STATE.maxPitch,minPitch:d=DEFAULT_STATE.minPitch,startPanLngLat:p,startZoomLngLat:f,startRotatePos:m,startBearing:g,startPitch:_,startZoom:v,normalize:y}={}){assert(Number.isFinite(n)),assert(Number.isFinite(i)),assert(Number.isFinite(a)),super({width:t,height:r,latitude:i,longitude:n,zoom:a,bearing:s,pitch:o,altitude:l,maxZoom:c,minZoom:h,maxPitch:u,minPitch:d,normalize:y}),this._state={startPanLngLat:p,startZoomLngLat:f,startRotatePos:m,startBearing:g,startPitch:_,startZoom:v},this.makeViewport=e}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){t=this._state.startPanLngLat||this._unproject(t);if(!t)return this;const r=this.makeViewport(this._viewportProps);e=r.panByPosition(t,e);return this._getUpdatedState(e)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){var{startRotatePos:i,startBearing:n,startPitch:a}=this._state;if(!i||!Number.isFinite(n)||!Number.isFinite(a))return this;let s;return s=e?this._calculateNewPitchAndBearing({...this._getRotationParams(e,i),startBearing:n,startPitch:a}):{bearing:n+t,pitch:a+r},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:n}=this._state;Number.isFinite(i)||(i=this._viewportProps.zoom,n=this._unproject(t)||this._unproject(e));r=this._calculateNewZoom({scale:r,startZoom:i});const a=this.makeViewport({...this._viewportProps,zoom:r});return this._getUpdatedState({zoom:r,...a.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this._viewportProps.bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this._viewportProps.bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this._viewportProps.pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this._viewportProps.pitch-e})}shortestPathFrom(e){var t=e.getViewportProps();const r={...this._viewportProps};var{bearing:i,longitude:e}=r;return 180<Math.abs(i-t.bearing)&&(r.bearing=i<0?i+360:i-360),180<Math.abs(e-t.longitude)&&(r.longitude=e<0?e+360:e-360),r}_zoomFromCenter(e){var{width:t,height:r}=this._viewportProps;return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){var{width:t,height:r}=this._viewportProps;return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this._viewportProps,...this._state,...e})}_applyConstraints(e){var{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=clamp$1(i,r,t);var{maxPitch:i,minPitch:r,pitch:t}=e;e.pitch=clamp$1(t,r,i);var{normalize:i=!0}=e;return i&&Object.assign(e,normalizeViewportProps(e)),e}_unproject(e){const t=this.makeViewport(this._viewportProps);return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){var{maxZoom:r,minZoom:i}=this._viewportProps;return clamp$1(t+Math.log2(e),i,r)}_calculateNewPitchAndBearing({deltaScaleX:e,deltaScaleY:t,startBearing:r,startPitch:i}){t=clamp$1(t,-1,1);var{minPitch:n,maxPitch:a}=this._viewportProps;let s=i;return 0<t?s=i+t*(a-i):t<0&&(s=i-t*(n-i)),{pitch:s,bearing:r+180*e}}_getRotationParams(e,t){var r=e[0]-t[0],i=e[1]-t[1],n=e[1],a=t[1],{width:e,height:t}=this._viewportProps,e=r/e;let s=0;return 0<i?Math.abs(t-a)>PITCH_MOUSE_THRESHOLD&&(s=i/(a-t)*PITCH_ACCEL):i<0&&a>PITCH_MOUSE_THRESHOLD&&(s=1-n/a),s=Math.min(1,Math.max(-1,s)),{deltaScaleX:e,deltaScaleY:s}}}class MapController extends Controller{constructor(e){e.dragMode=e.dragMode||"pan",super(MapState,e)}setProps(e){var t=this.controllerStateProps;super.setProps(e),t&&t.height===e.height||this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state}))}get linearTransitionProps(){return["longitude","latitude","zoom","bearing","pitch"]}}class MapView extends View{constructor(e){super({...e,type:WebMercatorViewport})}get controller(){return this._getControllerProps({type:MapController})}}MapView.displayName="MapView";const DEFAULT_LIGHTING_EFFECT=new LightingEffect;class EffectManager{constructor(){this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length===this.effects.length&&deepEqual(e.effects,this.effects)||(this.setEffects(e.effects),this._needsRedraw="effects changed"))}needsRedraw(e={clearRedrawFlags:!1}){var t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._createInternalEffects()}cleanup(){for(const e of this.effects)e.cleanup();for(const t of this._internalEffects)t.cleanup();this.effects.length=0,this._internalEffects.length=0}_createInternalEffects(){this._internalEffects=this.effects.slice(),this.effects.some(e=>e instanceof LightingEffect)||this._internalEffects.push(DEFAULT_LIGHTING_EFFECT)}}class DrawLayersPass extends LayersPass{}const PICKING_PARAMETERS={blendFunc:[1,0,32771,0],blendEquation:32774};class PickLayersPass extends LayersPass{render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:n,pickingFBO:a,deviceRect:{x:s,y:o,width:l,height:c},pass:h="picking",redrawReason:u,pickZ:d}){var p=this.gl,f=!(this.pickZ=d)&&{byLayer:new Map,byAlpha:[]};this._colors=f;d=withParameters(p,{scissorTest:!0,scissor:[s,o,l,c],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...PICKING_PARAMETERS,blend:!d},()=>super.render({target:a,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:n,pass:h,redrawReason:u}));return this._colors=null,{decodePickingColor:f&&decodeColor.bind(null,f),stats:d}}shouldDrawLayer(e){return e.props.pickable}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const i={...e.props.parameters};return this.pickZ?i.blend=!1:(Object.assign(i,PICKING_PARAMETERS),i.blend=!0,i.blendColor=encodeColor(this._colors,e,r)),i}}function encodeColor(e,t,r){const{byLayer:i,byAlpha:n}=e;let a;if(i.has(t)){const s=i.get(t);s.viewports.push(r),a=s.a}else a=i.size+1,a<=255?(r={a:a,layer:t,viewports:[r]},i.set(t,r),n[a]=r):(log$2.warn("Too many pickable layers, only picking the first 255")(),a=0);return[0,0,0,a/255]}function decodeColor(e,t){const r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}const TRACE_RENDER_LAYERS$1="deckRenderer.renderLayers";class DeckRenderer{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new DrawLayersPass(e),this.pickLayersPass=new PickLayersPass(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||Framebuffer.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);var r=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,r=t.render({...e,target:r});this._postRender(e.effects,e),this.renderCount++,debug(TRACE_RENDER_LAYERS$1,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){var t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const e=this["renderBuffers"];for(const t of e)t.delete();e.length=0}_preRender(e,t){let r=null;for(const i of e)i.preRender(this.gl,t),i.postRender&&(r=i);r&&this._resizeRenderBuffers(),this.lastPostProcessEffect=r}_resizeRenderBuffers(){const e=this["renderBuffers"];0===e.length&&e.push(new Framebuffer(this.gl),new Framebuffer(this.gl));for(const t of e)t.resize()}_postRender(e,t){var r=this["renderBuffers"];const i={inputBuffer:r[0],swapBuffer:r[1],target:null};for(const a of e)if(a.postRender){if(a===this.lastPostProcessEffect){i.target=t.target,a.postRender(this.gl,i);break}var n=a.postRender(this.gl,i);i.inputBuffer=n,i.swapBuffer=n===r[0]?r[1]:r[0]}}}const NO_PICKED_OBJECT={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function getClosestObject({pickedColors:n,decodePickingColor:e,deviceX:a,deviceY:s,deviceRadius:o,deviceRect:l}){if(n){var{x:c,y:h,width:u,height:d}=l;let t=o*o,r=-1,i=0;for(let e=0;e<d;e++){var p,f=e+h-s,m=f*f;if(m>t)i+=4*u;else for(let e=0;e<u;e++)0<=n[i+3]-1&&((p=(p=e+c-a)*p+m)<=t&&(t=p,r=i)),i+=4}if(0<=r){var g=n.slice(r,r+4),l=e(g);if(l){o=Math.floor(r/4/u),e=r/4-o*u;return{...l,pickedColor:g,pickedX:c+e,pickedY:h+o}}}}return NO_PICKED_OBJECT}function getUniqueObjects({pickedColors:t,decodePickingColor:r}){const i=new Map;if(t)for(let e=0;e<t.length;e+=4)if(0<=t[e+3]-1){const s=t.slice(e,e+4);var n,a=s.join(",");i.has(a)||(n=r(s))&&i.set(a,{...n,pickedColor:s})}return Array.from(i.values())}function getEmptyPickingInfo({pickInfo:e,viewports:t,pixelRatio:r,x:i,y:n,z:a}){let s=t[0];1<t.length&&(s=getViewportFromCoordinates((null==e?void 0:e.pickedViewports)||t,{x:i,y:n}));a=s&&s.unproject([i-s.x,n-s.y],{targetZ:a});return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:null,pixelRatio:r}}function processPickInfo(e){const{pickInfo:t,lastPickedInfo:r,mode:i,layers:n}=e,{pickedColor:a,pickedLayer:s,pickedObjectIndex:o}=t,l=s?[s]:[];if("hover"===i){var c=r.index;const p=r.layerId;var h=s&&s.props.id;h===p&&o===c||(h===p||(c=n.find(e=>e.props.id===p))&&l.unshift(c),r.layerId=h,r.index=o,r.info=null)}const u=getEmptyPickingInfo(e),d=new Map;return d.set(null,u),l.forEach(e=>{let t={...u};e===s&&(t.color=a,t.index=o,t.picked=!0),t=getLayerPickingInfo({layer:e,info:t,mode:i}),e===s&&"hover"===i&&(r.info=t),d.set(t.layer.id,t),"hover"===i&&t.layer.updateAutoHighlight(t)}),d}function getLayerPickingInfo({layer:e,info:t,mode:r}){for(;e&&t;){var i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:i}),e=e.parent}return t}function getViewportFromCoordinates(t,r){for(let e=t.length-1;0<=e;e--){const i=t[e];if(i.containsPixel(r))return i}return t[0]}class DeckPicker{constructor(e){this.gl=e,this.pickingFBO=null,this.pickLayersPass=new PickLayersPass(e),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},n=this.lastPickedInfo.info){const a=n&&n.layer&&n.layer.id,s=n&&n.viewport&&n.viewport.id;r=a?r.find(e=>e.id===a):null;const o=s&&i.find(e=>e.id===s)||i[0];i=o&&o.unproject([e-o.x,t-o.y]),r={x:e,y:t,viewport:o,coordinate:i,layer:r};return{...n,...r}}_resizeBuffer(){var e=this["gl"];return this.pickingFBO||(this.pickingFBO=new Framebuffer(e),Framebuffer.isSupported(e,{colorBufferFloat:!0})&&(this.depthFBO=new Framebuffer(e),this.depthFBO.attach({[36064]:new Texture2D(e,{format:isWebGL2$1(e)?34836:6408,type:5126})}))),this.pickingFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.pickingFBO}_getPickable(e){if(!1===this._pickable)return null;e=e.filter(e=>e.isPickable()&&!e.isComposite);return e.length?e:null}_pickClosestObject({layers:r,views:i,viewports:n,x:a,y:s,radius:e=0,depth:o=1,mode:l="query",unproject3D:c,onViewportActive:h}){if(!(r=this._getPickable(r)))return{result:[],emptyInfo:getEmptyPickingInfo({viewports:n,x:a,y:s})};this._resizeBuffer();var u,d=cssToDeviceRatio(this.gl),t=cssToDevicePixels(this.gl,[a,s],!0),p=[t.x+Math.floor(t.width/2),t.y+Math.floor(t.height/2)],f=Math.round(e*d),{width:t,height:e}=this.pickingFBO,m=this._getPickingRect({deviceX:p[0],deviceY:p[1],deviceRadius:f,deviceWidth:t,deviceHeight:e});let g;const _=[],v=new Set;for(let t=0;t<o;t++){const y=getClosestObject({...m&&this._drawAndSample({layers:r,views:i,viewports:n,onViewportActive:h,deviceRect:m,pass:"picking:".concat(l),redrawReason:l}),deviceX:p[0],deviceY:p[1],deviceRadius:f,deviceRect:m});let e;y.pickedLayer&&c&&this.depthFBO&&(u=this._drawAndSample({layers:[y.pickedLayer],views:i,viewports:n,onViewportActive:h,deviceRect:{x:y.pickedX,y:y.pickedY,width:1,height:1},pass:"picking:".concat(l),redrawReason:"pick-z",pickZ:!0}),e=u.pickedColors[0]*n[0].distanceScales.metersPerUnit[2]+n[0].position[2]),y.pickedLayer&&t+1<o&&(v.add(y.pickedLayer),y.pickedLayer.disablePickingIndex(y.pickedObjectIndex)),g=processPickInfo({pickInfo:y,lastPickedInfo:this.lastPickedInfo,mode:l,layers:r,viewports:n,x:a,y:s,z:e,pixelRatio:d});for(const x of g.values())x.layer&&_.push(x);if(!y.pickedColor)break}for(const b of v)b.restorePickingColors();return{result:_,emptyInfo:g&&g.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:n,width:a=1,height:s=1,mode:o="query",maxObjects:l=null,onViewportActive:c}){if(!(e=this._getPickable(e)))return[];this._resizeBuffer();var h=cssToDeviceRatio(this.gl),u=cssToDevicePixels(this.gl,[i,n],!0),d=u.x,p=u.y+u.height,f=cssToDevicePixels(this.gl,[i+a,n+s],!0),u=f.x+f.width,f=f.y,m=getUniqueObjects(this._drawAndSample({layers:e,views:t,viewports:r,onViewportActive:c,deviceRect:{x:d,y:f,width:u-d,height:p-f},pass:"picking:".concat(o),redrawReason:o}));const g=new Map;var _=Number.isFinite(l);for(let e=0;e<m.length&&!(_&&g.size>=l);e++){var v=m[e],y={color:v.pickedColor,layer:null,index:v.pickedObjectIndex,picked:!0,x:i,y:n,width:a,height:s,pixelRatio:h},y=getLayerPickingInfo({layer:v.pickedLayer,info:y,mode:o});g.has(y.object)||g.set(y.object,y)}return Array.from(g.values())}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:n,pass:a,redrawReason:s,pickZ:o}){var l=o?this.depthFBO:this.pickingFBO,r=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:l,deviceRect:n,pass:a,redrawReason:s,pickZ:o})["decodePickingColor"],{x:i,y:a,width:s,height:n}=n,o=new(o?Float32Array:Uint8Array)(s*n*4);return readPixelsToArray(l,{sourceX:i,sourceY:a,sourceWidth:s,sourceHeight:n,target:o}),{pickedColors:o,decodePickingColor:r}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:n}){var a=Math.max(0,e-r),s=Math.max(0,t-r),e=Math.min(i,e+r+1)-a,r=Math.min(n,t+r+1)-s;return e<=0||r<=0?null:{x:a,y:s,width:e,height:r}}}const defaultStyle={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"};class Tooltip{constructor(e){const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,defaultStyle),t.appendChild(this.el)),this.isVisible=!1}setTooltip(e,t,r){const i=this.el;if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");"text"in e&&(i.innerText=e.text),"html"in e&&(i.innerHTML=e.html),"className"in e&&(i.className=e.className),Object.assign(i.style,e.style)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(t,"px, ").concat(r,"px)")}remove(){this.el&&this.el.remove()}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,a=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(i=r.next()).done)&&(a.push(i.value),!t||a.length!==t);s=!0);}catch(e){o=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return a}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray$1(e,t)||_nonIterableRest()}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function HammerManagerMock(e){function t(){return r}var r={};return r.get=function(){return null},r.set=t,r.on=t,r.off=t,r.destroy=t,r.emit=t,r}var Manager=HammerManagerMock,RECOGNIZERS=null,RECOGNIZER_COMPATIBLE_MAP={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},RECOGNIZER_FALLBACK_MAP={doubletap:["tap"]},BASIC_EVENT_ALIASES={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},INPUT_EVENT_TYPES={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},EVENT_RECOGNIZER_MAP={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},GESTURE_EVENT_ALIASES={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},userAgent="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",window_="undefined"!=typeof window?window:global,passiveSupported=!1;try{var options={get passive(){return passiveSupported=!0}};window_.addEventListener("test",options,options),window_.removeEventListener("test",options,options)}catch(err){}var firefox=-1!==userAgent.indexOf("firefox"),WHEEL_EVENTS=INPUT_EVENT_TYPES.WHEEL_EVENTS,EVENT_TYPE$1="wheel",WHEEL_DELTA_MAGIC_SCALER=4.000244140625,WHEEL_DELTA_PER_LINE=40,SHIFT_MULTIPLIER=.25,WheelInput=function(){function n(t,e){var r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,n),this.element=t,this.callback=e,this.options=Object.assign({enable:!0},i),this.events=WHEEL_EVENTS.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(e){return t.addEventListener(e,r.handleEvent,!!passiveSupported&&{passive:!1})})}return _createClass(n,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(e,t){e===EVENT_TYPE$1&&(this.options.enable=t)}},{key:"handleEvent",value:function(e){var t,r;this.options.enable&&(t=e.deltaY,window_.WheelEvent&&(firefox&&e.deltaMode===window_.WheelEvent.DOM_DELTA_PIXEL&&(t/=window_.devicePixelRatio),e.deltaMode===window_.WheelEvent.DOM_DELTA_LINE&&(t*=WHEEL_DELTA_PER_LINE)),r={x:e.clientX,y:e.clientY},0!==t&&t%WHEEL_DELTA_MAGIC_SCALER==0&&(t=Math.floor(t/WHEEL_DELTA_MAGIC_SCALER)),e.shiftKey&&t&&(t*=SHIFT_MULTIPLIER),this._onWheel(e,-t,r))}},{key:"_onWheel",value:function(e,t,r){this.callback({type:EVENT_TYPE$1,center:r,delta:t,srcEvent:e,pointerType:"mouse",target:e.target})}}]),n}(),MOUSE_EVENTS$1=INPUT_EVENT_TYPES.MOUSE_EVENTS,MOVE_EVENT_TYPE="pointermove",OVER_EVENT_TYPE="pointerover",OUT_EVENT_TYPE="pointerout",LEAVE_EVENT_TYPE="pointerleave",MoveInput=function(){function n(t,e){var r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,n),this.element=t,this.callback=e,this.pressed=!1,this.options=Object.assign({enable:!0},i),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=MOUSE_EVENTS$1.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(e){return t.addEventListener(e,r.handleEvent)})}return _createClass(n,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(e,t){e===MOVE_EVENT_TYPE&&(this.enableMoveEvent=t),e===OVER_EVENT_TYPE&&(this.enableOverEvent=t),e===OUT_EVENT_TYPE&&(this.enableOutEvent=t),e===LEAVE_EVENT_TYPE&&(this.enableLeaveEvent=t)}},{key:"handleEvent",value:function(e){this.handleOverEvent(e),this.handleOutEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)}},{key:"handleOverEvent",value:function(e){this.enableOverEvent&&"mouseover"===e.type&&this.callback({type:OVER_EVENT_TYPE,srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleOutEvent",value:function(e){this.enableOutEvent&&"mouseout"===e.type&&this.callback({type:OUT_EVENT_TYPE,srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleLeaveEvent",value:function(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this.callback({type:LEAVE_EVENT_TYPE,srcEvent:e,pointerType:"mouse",target:e.target})}},{key:"handleMoveEvent",value:function(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":0<=e.button&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this.callback({type:MOVE_EVENT_TYPE,srcEvent:e,pointerType:"mouse",target:e.target});break;case"mouseup":this.pressed=!1}}}]),n}(),KEY_EVENTS=INPUT_EVENT_TYPES.KEY_EVENTS,DOWN_EVENT_TYPE="keydown",UP_EVENT_TYPE="keyup",KeyInput=function(){function n(t,e){var r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,n),this.element=t,this.callback=e,this.options=Object.assign({enable:!0},i),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=KEY_EVENTS.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),t.tabIndex=i.tabIndex||0,t.style.outline="none",this.events.forEach(function(e){return t.addEventListener(e,r.handleEvent)})}return _createClass(n,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(e,t){e===DOWN_EVENT_TYPE&&(this.enableDownEvent=t),e===UP_EVENT_TYPE&&(this.enableUpEvent=t)}},{key:"handleEvent",value:function(e){var t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:DOWN_EVENT_TYPE,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:UP_EVENT_TYPE,srcEvent:e,key:e.key,target:e.target}))}}]),n}(),EVENT_TYPE="contextmenu",ContextmenuInput=function(){function i(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,i),this.element=e,this.callback=t,this.options=Object.assign({enable:!0},r),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return _createClass(i,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(e,t){e===EVENT_TYPE&&(this.options.enable=t)}},{key:"handleEvent",value:function(e){this.options.enable&&this.callback({type:EVENT_TYPE,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}]),i}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var DOWN_EVENT=1,MOVE_EVENT=2,UP_EVENT=4,MOUSE_EVENTS={pointerdown:DOWN_EVENT,pointermove:MOVE_EVENT,pointerup:UP_EVENT,mousedown:DOWN_EVENT,mousemove:MOVE_EVENT,mouseup:UP_EVENT},MOUSE_EVENT_WHICH_LEFT=1,MOUSE_EVENT_WHICH_MIDDLE=2,MOUSE_EVENT_WHICH_RIGHT=3,MOUSE_EVENT_BUTTON_LEFT=0,MOUSE_EVENT_BUTTON_MIDDLE=1,MOUSE_EVENT_BUTTON_RIGHT=2,MOUSE_EVENT_BUTTONS_LEFT_MASK=1,MOUSE_EVENT_BUTTONS_RIGHT_MASK=2,MOUSE_EVENT_BUTTONS_MIDDLE_MASK=4;function whichButtons(e){var t=MOUSE_EVENTS[e.srcEvent.type];if(!t)return null;var r=e.srcEvent,i=r.buttons,n=r.button,a=r.which,s=!1,e=!1,r=!1;return t===UP_EVENT||t===MOVE_EVENT&&!Number.isFinite(i)?(s=a===MOUSE_EVENT_WHICH_LEFT,e=a===MOUSE_EVENT_WHICH_MIDDLE,r=a===MOUSE_EVENT_WHICH_RIGHT):t===MOVE_EVENT?(s=Boolean(i&MOUSE_EVENT_BUTTONS_LEFT_MASK),e=Boolean(i&MOUSE_EVENT_BUTTONS_MIDDLE_MASK),r=Boolean(i&MOUSE_EVENT_BUTTONS_RIGHT_MASK)):t===DOWN_EVENT&&(s=n===MOUSE_EVENT_BUTTON_LEFT,e=n===MOUSE_EVENT_BUTTON_MIDDLE,r=n===MOUSE_EVENT_BUTTON_RIGHT),{leftButton:s,middleButton:e,rightButton:r}}function getOffsetPosition(e,t){var r=e.srcEvent;if(!e.center&&!Number.isFinite(r.clientX))return null;var i=e.center||{x:r.clientX,y:r.clientY},n=t.getBoundingClientRect(),e=n.width/t.offsetWidth||1,r=n.height/t.offsetHeight||1;return{center:i,offsetCenter:{x:(i.x-n.left-t.clientLeft)/e,y:(i.y-n.top-t.clientTop)/r}}}var DEFAULT_OPTIONS$1={srcElement:"root",priority:0},EventRegistrar=function(){function t(e){_classCallCheck(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}return _createClass(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],n=4<arguments.length&&void 0!==arguments[4]&&arguments[4],a=this.handlers,s=this.handlersByElement;r=(r=r&&("object"!==_typeof(r)||r.addEventListener)?{srcElement:r}:r)?Object.assign({},DEFAULT_OPTIONS$1,r):DEFAULT_OPTIONS$1;var o=s.get(r.srcElement);o||s.set(r.srcElement,o=[]);var l={type:e,handler:t,srcElement:r.srcElement,priority:r.priority};i&&(l.once=!0),n&&(l.passive=!0),a.push(l),this._active=this._active||!l.passive;for(var c=o.length-1;0<=c&&!(o[c].priority>=l.priority);)c--;o.splice(c+1,0,l)}},{key:"remove",value:function(e,t){for(var r=this.handlers,i=this.handlersByElement,n=r.length-1;0<=n;n--){var a,s=r[n];s.type===e&&s.handler===t&&(r.splice(n,1),(a=i.get(s.srcElement)).splice(a.indexOf(s),1),0===a.length&&i.delete(s.srcElement))}this._active=r.some(function(e){return!e.passive})}},{key:"handleEvent",value:function(e){if(!this.isEmpty()){for(var t=this._normalizeEvent(e),r=e.srcEvent.target;r&&r!==t.rootElement;){if(this._emit(t,r),t.handled)return;r=r.parentNode}this._emit(t,"root")}}},{key:"_emit",value:function(e,t){var r=this.handlersByElement.get(t);if(r){function i(){e.handled=!0}function n(){e.handled=!0,a=!0}for(var a=!1,s=[],o=0;o<r.length;o++){var l=r[o],c=l.type,h=l.handler,l=l.once;if(h(Object.assign({},e,{type:c,stopPropagation:i,stopImmediatePropagation:n})),l&&s.push(r[o]),a)break}for(var u=0;u<s.length;u++){var d=s[u],p=d.type,d=d.handler;this.remove(p,d)}}}},{key:"_normalizeEvent",value:function(e){var t=this.eventManager.element;return Object.assign({},e,whichButtons(e),getOffsetPosition(e,t),{handled:!1,rootElement:t})}}]),t}();function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,t=function(){};return{s:t,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,n=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var DEFAULT_OPTIONS={events:null,recognizers:null,recognizerOptions:{},Manager:Manager,touchAction:"none",tabIndex:0},EventManager=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,r),this.options=Object.assign({},DEFAULT_OPTIONS,t),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);t=t.events;t&&this.on(t)}return _createClass(r,[{key:"setElement",value:function(e){var r=this;if(this.element&&this.destroy(),this.element=e){var t,i=this.options,n=i.Manager;for(t in this.manager=new n(e,{touchAction:i.touchAction,recognizers:i.recognizers||RECOGNIZERS}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(RECOGNIZER_COMPATIBLE_MAP).forEach(function(e){var t=r.manager.get(e);t&&RECOGNIZER_COMPATIBLE_MAP[e].forEach(function(e){t.recognizeWith(e)})}),i.recognizerOptions){var a,s=this.manager.get(t);s&&(delete(a=i.recognizerOptions[t]).enable,s.set(a))}this.wheelInput=new WheelInput(e,this._onOtherEvent,{enable:!1}),this.moveInput=new MoveInput(e,this._onOtherEvent,{enable:!1}),this.keyInput=new KeyInput(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new ContextmenuInput(e,this._onOtherEvent,{enable:!1});var o,l=_createForOfIteratorHelper(this.events);try{for(l.s();!(o=l.n()).done;){var c=_slicedToArray(o.value,2),h=c[0],u=c[1];u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(h,u.handleEvent))}}catch(e){l.e(e)}finally{l.f()}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(e,t,r){this._addEventHandler(e,t,r,!1)}},{key:"once",value:function(e,t,r){this._addEventHandler(e,t,r,!0)}},{key:"watch",value:function(e,t,r){this._addEventHandler(e,t,r,!1,!0)}},{key:"off",value:function(e,t){this._removeEventHandler(e,t)}},{key:"_toggleRecognizer",value:function(r,i){var n,e,a=this.manager;a&&((n=a.get(r))&&n.options.enable!==i&&(n.set({enable:i}),(e=RECOGNIZER_FALLBACK_MAP[r])&&!this.options.recognizers&&e.forEach(function(e){var t=a.get(e);i?(t.requireFailure(r),n.dropRequireFailure(e)):t.dropRequireFailure(r)})),this.wheelInput.enableEventType(r,i),this.moveInput.enableEventType(r,i),this.keyInput.enableEventType(r,i),this.contextmenuInput.enableEventType(r,i))}},{key:"_addEventHandler",value:function(e,t,r,i,n){if("string"==typeof e){var a=this.manager,s=this.events,o=GESTURE_EVENT_ALIASES[e]||e,l=s.get(o);l||(l=new EventRegistrar(this),s.set(o,l),l.recognizerName=EVENT_RECOGNIZER_MAP[o]||o,a&&a.on(o,l.handleEvent)),l.add(e,t,r,i,n),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}else for(var c in r=t,e)this._addEventHandler(c,e[c],r,i,n)}},{key:"_removeEventHandler",value:function(e,t){if("string"==typeof e){var r=this.events,i=GESTURE_EVENT_ALIASES[e]||e,i=r.get(i);if(i&&(i.remove(e,t),i.isEmpty())){var n,a=i.recognizerName,s=!1,o=_createForOfIteratorHelper(r.values());try{for(o.s();!(n=o.n()).done;){var l=n.value;if(l.recognizerName===a&&!l.isEmpty()){s=!0;break}}}catch(e){o.e(e)}finally{o.f()}s||this._toggleRecognizer(a,!1)}}else for(var c in e)this._removeEventHandler(c,e[c])}},{key:"_onBasicInput",value:function(e){var t=e.srcEvent,t=BASIC_EVENT_ALIASES[t.type];t&&this.manager.emit(t,e)}},{key:"_onOtherEvent",value:function(e){this.manager.emit(e.type,e)}}]),r}();function noop$1(){}const getCursor=({isDragging:e})=>e?"grabbing":"grab";function getPropTypes$1(e){return{id:e.string,width:e.oneOfType([e.number,e.string]),height:e.oneOfType([e.number,e.string]),layers:e.oneOfType([e.object,e.array]),layerFilter:e.func,views:e.oneOfType([e.object,e.array]),viewState:e.object,effects:e.arrayOf(e.instanceOf(Effect)),controller:e.oneOfType([e.func,e.bool,e.object]),gl:e.object,glOptions:e.object,parameters:e.object,pickingRadius:e.number,useDevicePixels:e.oneOfType([e.bool,e.number]),touchAction:e.string,eventRecognizerOptions:e.object,onWebGLInitialized:e.func,onResize:e.func,onViewStateChange:e.func,onInteractionStateChange:e.func,onBeforeRender:e.func,onAfterRender:e.func,onLoad:e.func,onError:e.func,debug:e.bool,drawPickingColors:e.bool,_framebuffer:e.object,_animate:e.bool,_pickable:e.bool,_typedArrayManagerProps:e.object}}const defaultProps$a={id:"",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:noop$1,onResize:noop$1,onViewStateChange:noop$1,onInteractionStateChange:noop$1,onBeforeRender:noop$1,onAfterRender:noop$1,onLoad:noop$1,onError:(e,t)=>{},_onMetrics:null,getCursor:getCursor,debug:!1,drawPickingColors:!1};class Deck{constructor(e){e={...defaultProps$a,...e},this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),e.viewState&&e.initialViewState&&log$2.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===env.getBrowser()&&log$2.warn("IE 11 support will be deprecated in v8.0")(),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&defaultTypedArrayManager.setProps(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&log$2.removed("onLayerHover","onHover")(),"onLayerClick"in e&&log$2.removed("onLayerClick","onClick")(),e.initialViewState&&!deepEqual(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(this.props._animate)return"Deck._animate";var t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),n=this.effectManager.needsRedraw(e),e=this.deckRenderer.needsRedraw(e);return t=t||r||i||n||e}redraw(e){!this.layerManager||(e=e||this.needsRedraw({clearRedrawFlags:!0}))&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}getViews(){return this.viewManager.views}getViewports(e){return this.viewManager.getViewports(e)}pickObject(e){e=this._pick("pickObject","pickObject Time",e).result;return e.length?e[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_pick(e,t,r){const i=this["stats"];i.get("Pick Count").incrementCount(),i.get(t).timeStart();r=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,...r});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;if("string"==typeof t&&(t=document.getElementById(t),assert(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay";const r=e.parent||document.body;r.appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(r){if(this.canvas){let{width:e,height:t}=r;!e&&0!==e||(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),!t&&0!==t||(t=Number.isFinite(t)?"".concat(t,"px"):t,this.canvas.style.position="absolute",this.canvas.style.height=t)}}_updateCanvasSize(){var e,t;this._checkForCanvasSizeChange()&&({width:e,height:t}=this,this.viewManager.setProps({width:e,height:t}),this.props.onResize({width:this.width,height:this.height}))}_checkForCanvasSizeChange(){var e=this["canvas"];if(!e)return!1;var t=e.clientWidth||e.width,e=e.clientHeight||e.height;return(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,!0)}_createAnimationLoop(e){const{width:t,height:r,gl:i,glOptions:n,debug:a,onError:s,onBeforeRender:o,onAfterRender:l,useDevicePixels:c,autoResizeDrawingBuffer:h}=e;return new AnimationLoop({width:t,height:r,useDevicePixels:c,autoResizeDrawingBuffer:h,autoResizeViewport:!1,gl:i,onCreateContext:e=>createGLContext({...n,...e,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:e=>this._setGLContext(e.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:o,onAfterRender:l,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new MapView({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const e=this.props["onError"];this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_onPointerMove(e){const t=this["_pickRequest"];if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;var r=e.offsetCenter;if(!r)return;t.x=r.x,t.y=r.y,t.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e,t.mode="hover"}_pickAndCallback(){const r=this["_pickRequest"];if(r.event){var{result:i,emptyInfo:n}=this._pick("pickObject","pickObject Time",r);this.interactiveState.isHovering=0<i.length;let e=n,t=!1;for(const a of i)e=a,t=a.layer.onHover(a,r.event);!t&&this.props.onHover&&this.props.onHover(e,r.event),this.props.getTooltip&&(i=this.props.getTooltip(e),this.tooltip.setTooltip(i,e.x,e.y)),r.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.interactiveState))}_setGLContext(e){if(!this.layerManager){this.canvas||(this.canvas=e.canvas,instrumentGLContext(e,{enable:!0,copyState:!0})),this.tooltip=new Tooltip(this.canvas),setParameters(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const r=new Timeline;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new EventManager(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in EVENTS)this.eventManager.on(i,this._onEvent);this.viewManager=new ViewManager({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var t=this.viewManager.getViewports()[0];this.layerManager=new LayerManager(e,{deck:this,stats:this.stats,viewport:t,timeline:r}),this.effectManager=new EffectManager,this.deckRenderer=new DeckRenderer(e),this.deckPicker=new DeckPicker(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}_drawLayers(e,t){var r=this.layerManager.context["gl"];setParameters(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),log$2.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){var t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.interactiveState.isDragging=e.isDragging,this.props.onInteractionStateChange(e)}_onEvent(t){var r=EVENTS[t.type],i=t.offsetCenter;if(r&&i){var n=this.layerManager.getLayers(),n=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:n,viewports:this.getViewports(i)},this._lastPointerDownInfo),i=n["layer"];const a=i&&(i[r.handler]||i.props[r.handler]),s=this.props[r.handler];let e=!1;a&&(e=a.call(i,n,t)),!e&&s&&s(n,t)}}_onPointerDown(e){e=e.offsetCenter,e=this._pick("pickObject","pickObject Time",{x:e.x,y:e.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=e.result[0]||e.emptyInfo}_getFrameStats(){const e=this["stats"];e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=lumaStats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Deck.getPropTypes=getPropTypes$1,Deck.defaultProps=defaultProps$a,Deck.VERSION=deckGlobal.VERSION;class ShaderAttribute{constructor(e,t){this.opts=t,this.source=e}get value(){return this.source.value}getValue(){var e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];var r=this.source["value"],i=t["size"];let n=r;if(r&&r.length!==i){n=new Float32Array(i);var a=t.elementOffset||0;for(let e=0;e<i;++e)n[e]=r[a+e]}return n}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function glArrayFromType(e){switch(e){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function getStride(e){return e.stride||e.size*e.bytesPerElement}function resolveShaderAttribute(e,t){t.offset&&log$2.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var r=getStride(e),e=("vertexOffset"in t?t.vertexOffset:e.vertexOffset||0)*r+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:e,stride:r}}function resolveDoublePrecisionShaderAttributes(e,t){t=resolveShaderAttribute(e,t);return{high:t,low:{...t,offset:t.offset+4*e.size}}}class DataColumn{constructor(e,t){this.gl=e,this.id=t.id,this.size=t.size;var r=t.logicalType||t.type,i=5130===r;let n=t["defaultValue"];n=Number.isFinite(n)?[n]:n||new Array(this.size).fill(0),t.defaultValue=n;let a=r;a=i?5126:!a&&t.isIndexed?e&&hasFeature(e,FEATURES$1.ELEMENT_INDEX_UINT32)?5125:5123:a||5126,t.logicalType=r,t.type=a;let s=glArrayFromType(r||a||5126);this.shaderAttributes={},(this.doublePrecision=i)&&!1===t.fp64&&(s=Float32Array),t.bytesPerElement=s.BYTES_PER_ELEMENT,this.defaultType=s,this.value=null,this.settings=t,this.state={externalBuffer:null,bufferAccessor:t,allocatedValue:null,constant:!1},this._buffer=null,this.setData(t)}get buffer(){var e,t;return this._buffer||({isIndexed:e,type:t}=this.settings,this._buffer=new Buffer$1(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})),this._buffer}get byteOffset(){var e=this.getAccessor();return e.vertexOffset?e.vertexOffset*getStride(e):0}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),defaultTypedArrayManager.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const n={};var r=this.value instanceof Float64Array,i=resolveDoublePrecisionShaderAttributes(this.getAccessor(),t||{});return n[e]=new ShaderAttribute(this,i.high),n["".concat(e,"64Low")]=r?new ShaderAttribute(this,i.low):new Float32Array(this.size),n}if(t){t=resolveShaderAttribute(this.getAccessor(),t);return{[e]:new ShaderAttribute(this,t)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}setData(t){const r=this["state"];ArrayBuffer.isView(t)?t={value:t}:t instanceof Buffer$1&&(t={buffer:t});const i={...this.settings,...t};if(r.bufferAccessor=i,t.constant){let e=t.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this._normalizeConstant(e)),!(!r.constant||!this._areValuesEqual(e,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=e}else if(t.buffer){var e=t.buffer;r.externalBuffer=e,r.constant=!1,this.value=t.value;var n=t.value instanceof Float64Array;i.type=t.type||e.accessor.type,i.bytesPerElement=e.accessor.BYTES_PER_ELEMENT*(n?2:1),i.stride=getStride(i)}else if(t.value){this._checkExternalBuffer(t);let e=t.value;r.externalBuffer=null,r.constant=!1,this.value=e,i.bytesPerElement=e.BYTES_PER_ELEMENT,i.stride=getStride(i);const{buffer:a,byteOffset:s}=this;this.doublePrecision&&e instanceof Float64Array&&(e=toDoublePrecisionArray(e,i));n=e.byteLength+s+2*i.stride;a.byteLength<n&&a.reallocate(n),a.setAccessor(null),a.subData({data:e,offset:s}),i.type=t.type||a.accessor.type}return!0}updateSubBuffer(e={}){const t=this["value"];var{startOffset:r=0,endOffset:e}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?toDoublePrecisionArray(t,{size:this.size,startIndex:r,endIndex:e}):t.subarray(r,e),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate({numInstances:e,copy:t=!1}){const r=this["state"];var i=r.allocatedValue,e=defaultTypedArrayManager.allocate(i,e+1,{size:this.size,type:this.defaultType,copy:t});this.value=e;const{buffer:n,byteOffset:a}=this;return n.byteLength<e.byteLength+a&&(n.reallocate(e.byteLength+a),t&&i&&n.subData({data:i instanceof Float64Array?toDoublePrecisionArray(i,this):i,offset:a})),r.allocatedValue=e,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){var r=t["value"];if(!t.constant&&r){var i=this.defaultType;let e=!1;if(this.doublePrecision&&(e=r.BYTES_PER_ELEMENT<4),e)throw new Error("Attribute ".concat(this.id," does not support ").concat(r.constructor.name));r instanceof i||!this.settings.normalized||"normalized"in t||log$2.warn("Attribute ".concat(this.id," is normalized"))()}}_normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(e).map(e=>e/255);case 5123:return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(t,r,i){var{defaultValue:n,size:a}=this.settings;if(Number.isFinite(t))return r[i]=t,r;if(!t)return r[i]=n[0],r;switch(a){case 4:r[i+3]=(Number.isFinite(t[3])?t:n)[3];case 3:r[i+2]=(Number.isFinite(t[2])?t:n)[2];case 2:r[i+1]=(Number.isFinite(t[1])?t:n)[1];case 1:r[i+0]=(Number.isFinite(t[0])?t:n)[0];break;default:let e=a;for(;0<=--e;)r[i+e]=(Number.isFinite(t[e])?t:n)[e]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;var i=this["size"];for(let e=0;e<i;e++)if(t[e]!==r[e])return!1;return!0}}const EMPTY_ARRAY$2=[],placeholderArray=[];function createIterable(e,t=0,r=1/0){let i=EMPTY_ARRAY$2;const n={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:0<e.length&&(placeholderArray.length=e.length,i=placeholderArray):i=EMPTY_ARRAY$2,(0<t||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,r),n.index=t-1),{iterable:i,objectInfo:n}}function isAsyncIterable(e){return e&&e[Symbol.asyncIterator]}function getAccessorFromBuffer(c,{size:h,stride:e,offset:t,startIndices:u,nested:d}){var r=c.BYTES_PER_ELEMENT;const p=e?e/r:h,f=t?t/r:0,m=Math.floor((c.length-f)/p);return(e,{index:t,target:r})=>{if(!u){var i=t*p+f;for(let e=0;e<h;e++)r[e]=c[i+e];return r}var n=u[t],a=u[t+1]||m;let s;if(d){s=new Array(a-n);for(let e=n;e<a;e++){var o=e*p+f;r=new Array(h);for(let e=0;e<h;e++)r[e]=c[o+e];s[e-n]=r}}else if(p===h)s=c.subarray(n*h+f,a*h+f);else{s=new c.constructor((a-n)*h);let t=0;for(let e=n;e<a;e++){var l=e*p+f;for(let e=0;e<h;e++)s[t++]=c[l+e]}}return s}}const EMPTY=[],FULL=[[0,1/0]];function add(t,r){if(t===FULL)return t;if(r[0]<0&&(r[0]=0),r[0]>=r[1])return t;const i=[];var n=t.length;let a=0;for(let e=0;e<n;e++){var s=t[e];s[1]<r[0]?(i.push(s),a=e+1):s[0]>r[1]?i.push(s):r=[Math.min(s[0],r[0]),Math.max(s[1],r[1])]}return i.splice(a,0,r),i}function padArrayChunk({source:e,target:r,start:i=0,end:t,size:n,getData:a}){t=t||r.length;var s=e.length,o=t-i;if(o<s)r.set(e.subarray(0,o),i);else if(r.set(e,i),a){let t=s;for(;t<o;){var l=a(t,e);for(let e=0;e<n;e++)r[i+t]=l[e]||0,t++}}}function padArray({source:t,target:r,size:i,getData:n,sourceStartIndices:a,targetStartIndices:s}){if(!Array.isArray(s))return padArrayChunk({source:t,target:r,size:i,getData:n}),r;let o=0,l=0;var c=n&&((e,t)=>n(e+l,t)),h=Math.min(a.length,s.length);for(let e=1;e<h;e++){var u=a[e]*i,d=s[e]*i;padArrayChunk({source:t.subarray(o,u),target:r,start:l,end:d,size:i,getData:c}),o=u,l=d}return l<r.length&&padArrayChunk({source:[],target:r,start:l,size:i,getData:c}),r}const DEFAULT_TRANSITION_SETTINGS={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function normalizeTransitionSettings(e,t){return e?((e=Number.isFinite(e)?{duration:e}:e).type=e.type||"interpolation",{...DEFAULT_TRANSITION_SETTINGS[e.type],...t,...e}):null}function getSourceBufferAttribute(e,t){return t.getBuffer()?[t.getBuffer(),{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function getAttributeTypeFromSize(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}}function cycleBuffers(e){e.push(e.shift())}function getAttributeBufferLength(e,t){var{doublePrecision:r,settings:i,value:n,size:e}=e,r=r&&n instanceof Float64Array?2:1;return(i.noAlloc?n.length:t*e)*r}function padBuffer({buffer:e,numInstances:t,attribute:r,fromLength:i,fromStartIndices:n,getData:a=e=>e}){var s=r.doublePrecision&&r.value instanceof Float64Array?2:1;const o=r.size*s;var l=r.byteOffset,c=r.startIndices,h=n&&c,s=getAttributeBufferLength(r,t),t=r.state.constant;if(h||!(s<=i)){const u=t?r.value:r.getBuffer().getData({srcByteOffset:l});if(r.settings.normalized&&!t){const d=a;a=(e,t)=>r._normalizeConstant(d(e,t))}t=t?(e,t)=>a(u,t):(e,t)=>a(u.subarray(e,e+o),t),i=e.getData({length:i}),s=new Float32Array(s);padArray({source:i,target:s,sourceStartIndices:n,targetStartIndices:c,size:o,getData:t}),e.byteLength<s.byteLength+l&&e.reallocate(s.byteLength+l),e.subData({data:s,offset:l})}}class Attribute extends DataColumn{constructor(e,t={}){super(e,t);var{transition:r=!1,noAlloc:i=!1,update:n=null,accessor:a=null,transform:e=null,startIndices:t=null}=t;Object.assign(this.settings,{transition:r,noAlloc:i,update:n||a&&this._autoUpdater,accessor:a,transform:e}),Object.assign(this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:FULL,startIndices:t}),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){var t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){var e=this.settings["accessor"];return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const e=this.settings["accessor"];var r=this.settings.transition;return normalizeTransitionSettings(Array.isArray(e)?t[e.find(e=>t[e])]:t[e],r)}setNeedsUpdate(e=this.id,t){this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t?({startRow:e=0,endRow:t=1/0}=t,this.state.updateRanges=add(this.state.updateRanges,[e,t])):this.state.updateRanges=FULL}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=EMPTY}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}update(e){this.setData(e)}allocate(e){var{state:t,settings:r}=this;return!r.noAlloc&&(!!r.update&&(super.allocate({numInstances:e,copy:t.updateRanges!==FULL}),!0))}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:n},settings:{update:a,noAlloc:s}}=this;let o=!0;if(a){for(var[l,c]of n)a.call(i,this,{data:t,startRow:l,endRow:c,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(var[h,u]of n){h=Number.isFinite(h)?this.getVertexOffset(h):0,u=Number.isFinite(u)?this.getVertexOffset(u):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:u})}else;this._checkAttributeArray()}else o=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),o}setConstantValue(e){return void 0!==e&&"function"!=typeof e&&(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const t=this["state"];return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),ArrayBuffer.isView(e)&&(e={value:e}),i.transform||t!==this.startIndices){assert(ArrayBuffer.isView(e.value),"invalid ".concat(i.accessor));var n=e.size&&e.size!==this.size;return r.binaryAccessor=getAccessorFromBuffer(e.value,{size:e.size||this.size,stride:e.stride,offset:e.offset,startIndices:t,nested:n}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){var t=this["startIndices"];return(t?t[e]:e)*this.size}getShaderAttributes(){var e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(i,{data:e,startRow:t,endRow:n,props:a,numInstances:s}){if(!i.constant){const{settings:l,state:c,value:h,size:u,startIndices:d}=i,{accessor:p,transform:f}=l,m=c.binaryAccessor||("function"==typeof p?p:a[p]);assert("function"==typeof m,'accessor "'.concat(p,'" is not a function'));let r=i.getVertexOffset(t);const{iterable:g,objectInfo:_}=createIterable(e,t,n);for(const v of g){_.index++;let t=m(v,_);if(f&&(t=f.call(this,t)),d){var o=(_.index<d.length-1?d[_.index+1]:s)-d[_.index];if(t&&Array.isArray(t[0])){let e=r;for(const y of t)i._normalizeValue(y,h,e),e+=u}else t&&t.length>u?h.set(t,r):(i._normalizeValue(t,_.target,0),fillArray({target:h,source:_.target,start:r,count:o}));r+=o*u}else i._normalizeValue(t,h,r),r+=u}}}_validateAttributeUpdaters(){var e=this["settings"];if(!(e.noAlloc||"function"==typeof e.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){var t=this["value"],r=Math.min(4,this.size);if(t&&t.length>=r){let e=!0;switch(r){case 4:e=e&&Number.isFinite(t[3]);case 3:e=e&&Number.isFinite(t[2]);case 2:e=e&&Number.isFinite(t[1]);case 1:e=e&&Number.isFinite(t[0]);break;default:e=!1}if(!e)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class GPUInterpolationTransition{constructor({gl:e,attribute:t,timeline:r}){this.gl=e,this.type="interpolation",this.transition=new Transition(r),this.attribute=t,this.attributeInTransition=new Attribute(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=getTransform$1(e,t);t={byteLength:0,usage:35050};this.buffers=[new Buffer$1(e,t),new Buffer$1(e,t)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0)this.transition.cancel();else{var{gl:r,buffers:i,attribute:n}=this;cycleBuffers(i);var a={numInstances:t,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of i)padBuffer({buffer:s,...a});this.currentStartIndices=n.startIndices,this.currentLength=getAttributeBufferLength(n,t),this.attributeInTransition.update({buffer:i[1],value:n.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aFrom:i[0],aTo:getSourceBufferAttribute(r,n)},feedbackBuffers:{vCurrent:i[1]}})}}update(){var e=this.transition.update();if(e){const{time:r,settings:{duration:i,easing:n}}=this.transition;var t=n(r/i);this.transform.run({uniforms:{time:t}})}return e}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}}const vs$4="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";function getTransform$1(e,t){t=getAttributeTypeFromSize(t.size);return new Transform(e,{vs:vs$4,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class GPUSpringTransition{constructor({gl:e,attribute:t,timeline:r}){this.gl=e,this.type="spring",this.transition=new Transition(r),this.attribute=t,this.attributeInTransition=new Attribute(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=getTexture(e),this.framebuffer=getFramebuffer(e,this.texture),this.transform=getTransform(e,t,this.framebuffer);t={byteLength:0,usage:35050};this.buffers=[new Buffer$1(e,t),new Buffer$1(e,t),new Buffer$1(e,t)]}get inProgress(){return this.transition.inProgress}start(e,t){var{gl:r,buffers:i,attribute:n}=this,a={numInstances:t,attribute:n,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of i)padBuffer({buffer:s,...a});this.currentStartIndices=n.startIndices,this.currentLength=getAttributeBufferLength(n,t),this.attributeInTransition.update({buffer:i[1],value:n.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/n.size),sourceBuffers:{aTo:getSourceBufferAttribute(r,n)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:i}=this;return!!i.update()&&(t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:i.settings.stiffness,damping:i.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),cycleBuffers(e),this.attributeInTransition.update({buffer:e[1],value:this.attribute.value}),0<readPixelsToArray(r)[0]||i.end(),!0)}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}function getTransform(e,t,r){t=getAttributeTypeFromSize(t.size);return new Transform(e,{framebuffer:r,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:t},varyings:["vNext"]})}function getTexture(e){return new Texture2D(e,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function getFramebuffer(e,t){return new Framebuffer(e,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:t}})}const TRANSITION_TYPES$1={interpolation:GPUInterpolationTransition,spring:GPUSpringTransition};class AttributeTransitionManager{constructor(e,{id:t,timeline:r}){this.id=t,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Transform.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const n in e){const a=e[n];var i=a.getTransitionSetting(t);i&&this._updateAttribute(n,a,i)}for(const s in this.transitions){const o=e[s];o&&o.getTransitionSetting(t)||this._removeTransition(s)}}hasAttribute(e){e=this.transitions[e];return e&&e.inProgress}getAttributes(){const e={};for(const r in this.transitions){var t=this.transitions[r];t.inProgress&&(e[r]=t.attributeInTransition)}return e}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);var e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){var i=this.transitions[e];let n=!i||i.type!==r.type;if(n){if(!this.isSupported)return void log$2.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();i&&this._removeTransition(e);const a=TRANSITION_TYPES$1[r.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,gl:this.gl}):("unsupported transition type '".concat(r.type,"'"),n=!1)}(n||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const TRACE_INVALIDATE="attributeManager.invalidate",TRACE_UPDATE_START="attributeManager.updateStart",TRACE_UPDATE_END="attributeManager.updateEnd",TRACE_ATTRIBUTE_UPDATE_START="attribute.updateStart",TRACE_ATTRIBUTE_ALLOCATE="attribute.allocate",TRACE_ATTRIBUTE_UPDATE_END="attribute.updateEnd";class AttributeManager{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new AttributeTransitionManager(e,{id:"".concat(t,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){var t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(e=0){return this.needsRedraw=!0,this}add(e,t){this._add(e,t)}addInstanced(e,t){this._add(e,t,{instanced:1})}remove(t){for(let e=0;e<t.length;e++){var r=t[e];void 0!==this.attributes[r]&&(this.attributes[r].delete(),delete this.attributes[r])}}invalidate(e,t){t=this._invalidateTrigger(e,t);debug(TRACE_INVALIDATE,this,e,t)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);debug(TRACE_INVALIDATE,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:n={},buffers:a={},context:s={}}={}){let o=!1;debug(TRACE_UPDATE_START,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const h=this.attributes[c];var l=h.settings.accessor;h.startIndices=r,n[c]&&log$2.removed("props.".concat(c),"data.attributes.".concat(c))(),h.setExternalBuffer(a[c])||h.setBinaryValue(a[l],e.startIndices)||!a[l]&&h.setConstantValue(n[l])||h.needsUpdate()&&(o=!0,this._updateAttribute({attribute:h,numInstances:t,data:e,props:n,context:s})),this.needsRedraw|=h.needsRedraw()}o&&debug(TRACE_UPDATE_END,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const e=this["attributeTransitionManager"];var t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const n in t){const a=t[n];a.needsRedraw(e)&&!r.hasAttribute(n)&&(i[n]=a)}return i}getShaderAttributes(e,t={}){var r={};for(const i in e=e||this.getAttributes())t[i]||Object.assign(r,e[i].getShaderAttributes());return r}getAccessors(){return this.updateTriggers}_add(e,t,r={}){t&&log$2.warn("AttributeManager.add({updaters}) - updater map no longer supported")();for(const n in e){var i=e[n];this.attributes[n]=this._createAttribute(n,i,r)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){t={...t,id:e,isIndexed:t.isIndexed||t.elements||!1,constant:t.constant||!1,size:(t.elements?1:t.size)||1,value:t.value||null,divisor:t.instanced||r.instanced?1:t.divisor||0};return new Attribute(this.gl,t)}_mapUpdateTriggersToAttributes(){const t={};for(const r in this.attributes){const e=this.attributes[r];e.getUpdateTriggers().forEach(e=>{t[e]||(t[e]=[]),t[e].push(r)})}this.updateTriggers=t}_invalidateTrigger(e,r){const{attributes:i,updateTriggers:t}=this,n=t[e];return n&&n.forEach(e=>{const t=i[e];t&&t.setNeedsUpdate(t.id,r)}),n}_updateAttribute(e){const{attribute:t,numInstances:r}=e;debug(TRACE_ATTRIBUTE_UPDATE_START,t),t.constant?t.setConstantValue(t.value):(t.allocate(r)&&debug(TRACE_ATTRIBUTE_ALLOCATE,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,debug(TRACE_ATTRIBUTE_UPDATE_END,t,r)))}}class CPUInterpolationTransition extends Transition{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:n}}=this;var a=n(e/i);this._value=lerp$2(t,r,a)}}const EPSILON=1e-5;function updateSpringElement(e,t,r,i,n){e=t-e;return(r-t)*n+-e*i+e+t}function updateSpring(t,r,i,n,a){if(Array.isArray(i)){const s=[];for(let e=0;e<i.length;e++)s[e]=updateSpringElement(t[e],r[e],i[e],n,a);return s}return updateSpringElement(t,r,i,n,a)}function distance$1(r,i){if(Array.isArray(r)){let t=0;for(let e=0;e<r.length;e++){var n=r[e]-i[e];t+=n*n}return Math.sqrt(t)}return Math.abs(r-i)}class CPUSpringTransition extends Transition{get value(){return this._currValue}_onUpdate(){var{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:n=e,_currValue:e=e}=this;let a=updateSpring(n,e,t,r,i);r=distance$1(a,t),i=distance$1(a,e);r<EPSILON&&i<EPSILON&&(a=t,this.end()),this._prevValue=e,this._currValue=a}}const TRANSITION_TYPES={interpolation:CPUInterpolationTransition,spring:CPUSpringTransition};class UniformTransitionManager{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return 0<this.transitions.size}add(e,t,r,i){const n=this["transitions"];if(n.has(e)){const s=n.get(e);var{value:a=s.settings.fromValue}=s;t=a,this.remove(e)}if(i=normalizeTransitionSettings(i)){const o=TRANSITION_TYPES[i.type];if(o){const s=new o(this.timeline);s.start({...i,fromValue:t,toValue:r}),n.set(e,s)}else"unsupported transition type '".concat(i.type,"'")}}remove(e){const t=this["transitions"];t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(var[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}const COMPONENT$1=PROP_SYMBOLS["COMPONENT"];function validateProps(e){var t=getPropTypes(e);for(const i in t){var r=t[i];const n=r["validate"];if(n&&!n(e[i],r))throw new Error("Invalid prop ".concat(i,": ").concat(e[i]))}}function diffProps(e,t){var r=compareProps({newProps:e,oldProps:t,propTypes:getPropTypes(e),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=diffDataProps(e,t);let n=!1;return i||(n=diffUpdateTriggers(e,t)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:diffExtensions(e,t),transitionsChanged:diffTransitions(e,t)}}function diffTransitions(e,t){if(!e.transitions)return null;const r={};var i=getPropTypes(e);for(const s in e.transitions){var n=i[s],a=n&&n.type;("number"===a||"color"===a||"array"===a)&&comparePropValues(e[s],t[s],n)&&(r[s]=!0)}return r}function compareProps({newProps:e,oldProps:t,ignoreProps:r={},propTypes:i={},triggerName:n="props"}={}){if(t===e)return null;if("object"!=typeof e||null===e)return"".concat(n," changed shallowly");if("object"!=typeof t||null===t)return"".concat(n," changed shallowly");for(const o of Object.keys(e))if(!(o in r)){if(!(o in t))return"".concat(n,".").concat(o," added");var a=comparePropValues(e[o],t[o],i[o]);if(a)return"".concat(n,".").concat(o," ").concat(a)}for(const l of Object.keys(t))if(!(l in r)){if(!(l in e))return"".concat(n,".").concat(l," dropped");if(!Object.hasOwnProperty.call(e,l)){var s=comparePropValues(e[l],t[l],i[l]);if(s)return"".concat(n,".").concat(l," ").concat(s)}}return null}function comparePropValues(e,t,r){let i=r&&r.equal;return(!i||i(e,t,r))&&(i||(i=e&&t&&e.equals,!i||i.call(e,t)))?i||t===e?null:"changed shallowly":"changed deeply"}function diffDataProps(e,t){if(null===t)return"oldProps is null, initial diff";let r=null;const{dataComparator:i,_dataDiff:n}=e;return i?i(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&n&&(r=n(e.data,t.data)||r),r}function diffUpdateTriggers(e,t){if(null===t)return"oldProps is null, initial diff";if("all"in e.updateTriggers&&diffUpdateTrigger(e,t,"all"))return{all:!0};const r={};let i=!1;for(const n in e.updateTriggers)"all"!==n&&diffUpdateTrigger(e,t,n)&&(r[n]=!0,i=r);return i}function diffExtensions(e,t){if(null===t)return"oldProps is null, initial diff";var r=t.extensions;const i=e["extensions"];if(i===r)return!1;if(i.length!==r.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(r[e]))return!0;return!1}function diffUpdateTrigger(e,t,r){let i=e.updateTriggers[r];i=void 0===i||null===i?{}:i;let n=t.updateTriggers[r];return n=void 0===n||null===n?{}:n,compareProps({oldProps:n,newProps:i,triggerName:r})}function getPropTypes(e){e=e[COMPONENT$1],e=e&&e.constructor;return e?e._propTypes:{}}const ERR_NOT_OBJECT="count(): argument not an object",ERR_NOT_CONTAINER="count(): argument not a container";function count(e){if(!isObject$3(e))throw new Error(ERR_NOT_OBJECT);if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(isPlainObject(e))return Object.keys(e).length;throw new Error(ERR_NOT_CONTAINER)}function isPlainObject(e){return null!==e&&"object"==typeof e&&e.constructor===Object}function isObject$3(e){return null!==e&&"object"==typeof e}function mergeShaders(e,t){if(!t)return e;const r={...e,...t};var i;if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),!t.modules.some(e=>"project64"===e.name)||0<=(i=r.modules.findIndex(e=>"project32"===e.name))&&r.modules.splice(i,1)),"inject"in t)if(e.inject){const n={...e.inject};for(const a in t.inject)n[a]=(n[a]||"")+t.inject[a];r.inject=n}else r.inject=t.inject;return r}const DEFAULT_TEXTURE_PARAMETERS$1={[10241]:9987,10240:9729,10242:33071,10243:33071},internalTextures={};function createTexture(e,t){var r=e.context&&e.context.gl;if(!r||!t)return null;if(t instanceof Texture2D)return t;let i=null;(t=t.constructor&&"Object"!==t.constructor.name?{data:t}:t).compressed&&(i={[10241]:1<t.data.length?9985:9729});e=new Texture2D(r,{...t,parameters:{...DEFAULT_TEXTURE_PARAMETERS$1,...i,...e.props.textureParameters}});return internalTextures[e.id]=!0,e}function destroyTexture(e){e&&e instanceof Texture2D&&internalTextures[e.id]&&(e.delete(),delete internalTextures[e.id])}const TYPE_DEFINITIONS={boolean:{validate(e,t){return!0},equal(e,t,r){return Boolean(e)===Boolean(t)}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||isArray(e)&&(3===e.length||4===e.length)},equal(e,t,r){return arrayEqual(e,t)}},accessor:{validate(e,t){e=getTypeOf(e);return"function"===e||e===getTypeOf(t.value)},equal(e,t,r){return"function"==typeof t||arrayEqual(e,t)}},array:{validate(e,t){return t.optional&&!e||isArray(e)},equal(e,t,r){return r.compare?arrayEqual(e,t):e===t}},function:{validate(e,t){return t.optional&&!e||"function"==typeof e},equal(e,t,r){return!r.compare||e===t}},data:{transform:(e,t,r)=>{const i=(r?r.props:{})["dataTransform"];return i&&e?i(e):e}},image:{transform:(e,t,r)=>createTexture(r,e),release:e=>{destroyTexture(e)}}};function arrayEqual(t,r){if(t===r)return!0;if(!isArray(t)||!isArray(r))return!1;var i=t.length;if(i!==r.length)return!1;for(let e=0;e<i;e++)if(t[e]!==r[e])return!1;return!0}function parsePropTypes(e){const t={},r={},i={};for(var[n,a]of Object.entries(e))a&&a.deprecatedFor?i[n]=Array.isArray(a.deprecatedFor)?a.deprecatedFor:[a.deprecatedFor]:(a=parsePropType(n,a),t[n]=a,r[n]=a.value);return{propTypes:t,defaultProps:r,deprecatedProps:i}}function parsePropType(e,t){switch(getTypeOf(t)){case"object":return normalizePropDefinition(e,t);case"array":return normalizePropDefinition(e,{type:"array",value:t,compare:!1});case"boolean":return normalizePropDefinition(e,{type:"boolean",value:t});case"number":return normalizePropDefinition(e,{type:"number",value:t});case"function":return normalizePropDefinition(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function normalizePropDefinition(e,t){return"type"in t?{name:e,...TYPE_DEFINITIONS[t.type],...t}:"value"in t?{name:e,type:getTypeOf(t.value),...t}:{name:e,type:"object",value:t}}function isArray(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function getTypeOf(e){return isArray(e)?"array":null===e?"null":typeof e}const{COMPONENT,ASYNC_ORIGINAL:ASYNC_ORIGINAL$2,ASYNC_RESOLVED:ASYNC_RESOLVED$2,ASYNC_DEFAULTS:ASYNC_DEFAULTS$2}=PROP_SYMBOLS;function createProps(){var e=getPropsPrototype(this.constructor);const t=Object.create(e);t[COMPONENT]=this,t[ASYNC_ORIGINAL$2]={},t[ASYNC_RESOLVED$2]={};for(let e=0;e<arguments.length;++e){var r=arguments[e];for(const i in r)t[i]=r[i]}return Object.freeze(t),t}function getPropsPrototype(e){var t=getOwnProperty(e,"_mergedDefaultProps");return t||(createPropsPrototypeAndTypes(e),e._mergedDefaultProps)}function createPropsPrototypeAndTypes(e){var t,r,i,n;e.prototype&&(i=getPropsPrototype(t=Object.getPrototypeOf(e)),addAsyncPropsToPropPrototype(r=createPropsPrototype((n=parsePropTypes(getOwnProperty(e,"defaultProps")||{})).defaultProps,i,e),i={...t._propTypes,...n.propTypes}),addDeprecatedPropsToPropPrototype(r,n={...t._deprecatedProps,...n.deprecatedProps}),e._mergedDefaultProps=r,e._propTypes=i,e._deprecatedProps=n)}function createPropsPrototype(e,t,r){var i=Object.create(null);Object.assign(i,t,e);r=getComponentName(r);return delete e.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}function addDeprecatedPropsToPropPrototype(e,i){for(const n in i)Object.defineProperty(e,n,{enumerable:!1,set(e){var t="".concat(this.id,": ").concat(n);for(const r of i[n])hasOwnProperty(this,r)||(this[r]=e);log$2.deprecated(t,i[n].join("/"))()}})}function addAsyncPropsToPropPrototype(e,t){const r={},i={};for(const o in t){var n=t[o],{name:a,value:s}=n;n.async&&(r[a]=s,i[a]=getDescriptorForAsyncProp(a))}e[ASYNC_DEFAULTS$2]=r,e[ASYNC_ORIGINAL$2]={},Object.defineProperties(e,i)}function getDescriptorForAsyncProp(t){return{enumerable:!0,set(e){"string"==typeof e||e instanceof Promise||isAsyncIterable(e)?this[ASYNC_ORIGINAL$2][t]=e:this[ASYNC_RESOLVED$2][t]=e},get(){if(this[ASYNC_RESOLVED$2]){if(t in this[ASYNC_RESOLVED$2])return this[ASYNC_RESOLVED$2][t]||this[ASYNC_DEFAULTS$2][t];if(t in this[ASYNC_ORIGINAL$2]){const e=this[COMPONENT]&&this[COMPONENT].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[ASYNC_DEFAULTS$2][t]}}return this[ASYNC_DEFAULTS$2][t]}}}function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function getOwnProperty(e,t){return hasOwnProperty(e,t)&&e[t]}function getComponentName(e){var t=getOwnProperty(e,"layerName")||getOwnProperty(e,"componentName");return t||log$2.once(0,"".concat(e.name,".componentName not specified"))(),t||e.name}const{ASYNC_ORIGINAL:ASYNC_ORIGINAL$1,ASYNC_RESOLVED:ASYNC_RESOLVED$1,ASYNC_DEFAULTS:ASYNC_DEFAULTS$1}=PROP_SYMBOLS,EMPTY_PROPS=Object.freeze({});class ComponentState{constructor(e=null){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=EMPTY_PROPS,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}freezeAsyncOldProps(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){e=this.asyncProps[e];return e&&e.resolvedValue}isAsyncPropLoading(e){if(e){e=this.asyncProps[e];return Boolean(e&&0<e.pendingLoadCount&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){const t=e[ASYNC_RESOLVED$1]||{};var r=e[ASYNC_ORIGINAL$1]||e,i=e[ASYNC_DEFAULTS$1]||{};for(const s in t){var n=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,n),t[s]=this.getAsyncProp(s)}for(const o in r){var a=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,a)}}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t){var r;const i=null===(r=this.layer)||void 0===r?void 0:r.props.fetch;i&&(t=i(t,{propName:e,layer:this.layer}))}t instanceof Promise?this._watchPromise(e,t):isAsyncIterable(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t)}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t!==r.resolvedValue&&t!==r.lastValue&&(r.lastValue=t,!0)}_setPropValue(e,t){this.freezeAsyncOldProps();const r=this.asyncProps[e];t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount}_setAsyncPropValue(e,t,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&void 0!==t&&(this.freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(i,e){const n=this.asyncProps[i];n.pendingLoadCount++;const a=n.pendingLoadCount;e.then(e=>{var t;e=this._postProcessValue(n,e),this._setAsyncPropValue(i,e,a);const r=null===(t=this.layer)||void 0===t?void 0:t.props.onDataLoad;"data"===i&&r&&r(e,{propName:i,layer:this.layer})}).catch(e=>{var t;null!==(t=this.layer)&&void 0!==t&&t.raiseError(e,"loading ".concat(i," of ").concat(this.layer))})}async _resolveAsyncIterable(e,t){"data"!==e&&this._setPropValue(e,t);const r=this.asyncProps[e];r.pendingLoadCount++;var i=r.pendingLoadCount;let n=[],a=0;for await(const o of t){const l=(this.component?this.component.props:{})["dataTransform"];n=l?l(o,n):n.concat(o),Object.defineProperty(n,"__diff",{enumerable:!1,value:[{startRow:a,endRow:n.length}]}),a=n.length,this._setAsyncPropValue(e,n,i)}const s=null===(t=this.layer)||void 0===t?void 0:t.props.onDataLoad;s&&s(n,{propName:e,layer:this.layer})}_postProcessValue(e,t){const r=e.type;return r&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){var r;this.asyncProps[e]||(r=this.component&&this.component.constructor._propTypes,this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0})}}const{ASYNC_ORIGINAL,ASYNC_RESOLVED,ASYNC_DEFAULTS}=PROP_SYMBOLS,defaultProps$9={};let counter=0;class Component{constructor(){this.props=createProps.apply(this,arguments),this.id=this.props.id,this.count=counter++,this.lifecycle=LIFECYCLE.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}clone(e){var t=this["props"];const r={};for(const i in t[ASYNC_DEFAULTS])i in t[ASYNC_RESOLVED]?r[i]=t[ASYNC_RESOLVED][i]:i in t[ASYNC_ORIGINAL]&&(r[i]=t[ASYNC_ORIGINAL][i]);return new this.constructor({...t,...r,...e})}get stats(){return this.internalState.stats}_initState(){this.internalState=new ComponentState({})}}Component.componentName="Component",Component.defaultProps=defaultProps$9;class LayerState extends ComponentState{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.model=null,this.needsRedraw=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}}const TRACE_CHANGE_FLAG="layer.changeFlag",TRACE_INITIALIZE="layer.initialize",TRACE_UPDATE="layer.update",TRACE_FINALIZE="layer.finalize",TRACE_MATCHED="layer.matched",MAX_PICKING_COLOR_CACHE_SIZE=2**24-1,EMPTY_ARRAY$1=Object.freeze([]),areViewportsEqual=memoize(({oldViewport:e,viewport:t})=>e.equals(t));let pickingColorCache=new Uint8ClampedArray(0);const defaultProps$8={data:{type:"data",value:EMPTY_ARRAY$1,async:!0},dataComparator:null,_dataDiff:{type:"function",value:e=>e&&e.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:i,loadOptions:n,signal:a})=>{const s=r.context["resourceManager"];var o;n=n||r.getLoadOptions(),i=i||r.props.loaders,a&&(n={...n,fetch:{...null===(o=n)||void 0===o?void 0:o.fetch,signal:a}});let l=s.contains(e);return l||n||(s.add({resourceId:e,data:load(e,i),persistent:!1}),l=!0),l?s.subscribe({resourceId:e,onChange:e=>r.internalState.reloadAsyncProp(t,e),consumerId:r.id,requestId:t}):load(e,i,n)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:COORDINATE_SYSTEM.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e],compare:!1},highlightedObjectIndex:-1,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Layer extends Component{toString(){var e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}raiseError(e,t){var r,i;t&&(e.message="".concat(t,": ").concat(e.message)),null!==(t=(i=this.props).onError)&&void 0!==t&&t.call(i,e)||null===(r=this.context)||void 0===r||null!==(i=r.onError)&&void 0!==i&&i.call(r,e,this)}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(e=!0){this.internalState&&(this.internalState.needsRedraw=e)}setNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}hasUniformTransition(){return this.internalState.uniformTransitions.active}get isLoaded(){return this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}project(e){var t=this.context["viewport"],[r,i,t]=worldToPixels(getWorldPosition(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),t.pixelProjectionMatrix);return 2===e.length?[r,i]:[r,i,t]}unproject(e){const t=this.context["viewport"];return t.unproject(e)}projectPosition(e){return projectPosition(e,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}use64bitPositions(){var e=this.props["coordinateSystem"];return e===COORDINATE_SYSTEM.DEFAULT||e===COORDINATE_SYSTEM.LNGLAT||e===COORDINATE_SYSTEM.CARTESIAN}onHover(e,t){return!!this.props.onHover&&this.props.onHover(e,t)}onClick(e,t){return!!this.props.onClick&&this.props.onClick(e,t)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){assert(e instanceof Uint8Array);var[t,r,e]=e;return t+256*r+65536*e-1}initializeState(){throw new Error("Layer ".concat(this," has not defined initializeState"))}getShaders(e){for(const t of this.props.extensions)e=mergeShaders(e,t.getShaders.call(this,t));return e}shouldUpdateState({changeFlags:e}){return e.propsOrDataChanged}updateState({oldProps:e,props:t,changeFlags:r}){const i=this.getAttributeManager();if(r.dataChanged&&i){var n=r["dataChanged"];if(Array.isArray(n))for(const a of n)i.invalidateAll(a);else i.invalidateAll()}n=0<=e.highlightedObjectIndex||e.pickable,e=0<=t.highlightedObjectIndex||t.pickable;if(n!==e&&i){var{pickingColors:t,instancePickingColors:n}=i.attributes;const s=t||n;s&&(e&&s.constant&&(s.constant=!1,i.invalidate(s.id)),s.value||e||(s.constant=!0,s.value=[0,0,0]))}}finalizeState(){for(const t of this.getModels())t.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e}){var t=e["index"];return 0<=t&&Array.isArray(this.props.data)&&(e.object=this.props.data[t]),e}activateViewport(e){var t=this.internalState.viewport;this.internalState.viewport=e,t&&areViewportsEqual({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all",t){const r=this.getAttributeManager();r&&("all"===e?r.invalidateAll():r.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(e){const t=this.getAttributeManager();var r,i;t&&(r=this.getNumInstances(e),i=this.getStartIndices(e),t.update({data:e.data,numInstances:r,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this,ignoreUnknownAttributes:!0}),e=t.getChangedAttributes({clearChangedFlags:!0}),this.updateAttributes(e))}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const e=this.internalState["uniformTransitions"];if(e.active){var t=e.update(),r=Object.create(this.props);for(const i in t)Object.defineProperty(r,i,{value:t[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(!e.constant){var r=Math.floor(pickingColorCache.length/3);if(this.internalState.usesPickingColorCache=!0,r<t){t>MAX_PICKING_COLOR_CACHE_SIZE&&log$2.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),pickingColorCache=defaultTypedArrayManager.allocate(pickingColorCache,t,{size:3,copy:!0,maxCount:Math.max(t,MAX_PICKING_COLOR_CACHE_SIZE)});var i=Math.floor(pickingColorCache.length/3),n=[];for(let e=r;e<i;e++)this.encodePickingColor(e,n),pickingColorCache[3*e+0]=n[0],pickingColorCache[3*e+1]=n[1],pickingColorCache[3*e+2]=n[2]}e.value=pickingColorCache.subarray(0,3*t)}}_setModelAttributes(e,t){const r=this.getAttributeManager();var i=e.userData.excludeAttributes||{},i=r.getShaderAttributes(t,i);e.setAttributes(i)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){var{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes;const i=t||r;r=i.getVertexOffset(e),e=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(e-r),offset:r})}restorePickingColors(){var{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes;const r=e||t;this.internalState.usesPickingColorCache&&r.value.buffer!==pickingColorCache.buffer&&(r.value=pickingColorCache.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0})}getNumInstances(e){return void 0!==(e=e||this.props).numInstances?e.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:count(e.data)}getStartIndices(e){return void 0!==(e=e||this.props).startIndices?e.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}_initialize(){debug(TRACE_INITIALIZE,this),this._initState(),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}_update(){var e=this.needsUpdate();debug(TRACE_UPDATE,this,e),e&&this._updateState()}_updateState(){var e=this.props,t=this.context.viewport,r=this._updateUniformTransition();this.internalState.propsInTransition=r,this.context.viewport=this.internalState.viewport||t,this.props=r;try{var i=this._getUpdateParams(),n=this.getModels();if(this.context.gl)this.updateState(i);else try{this.updateState(i)}catch(e){}for(const s of this.props.extensions)s.updateState.call(this,i,s);var a=this.getModels()[0]!==n[0];this._updateModules(i,a),this.isComposite?this._renderLayers(i):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=t,this.props=e,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}_finalize(){debug(TRACE_FINALIZE,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}drawLayer({moduleParameters:r=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();var e=this.props;this.props=this.internalState.propsInTransition||e;var t=this.props["opacity"];i.opacity=Math.pow(t,1/2.2);try{r&&this.setModuleParameters(r);const s=this.props["getPolygonOffset"];var a=s&&s(i)||[0,0];setParameters(this.context.gl,{polygonOffset:a}),withParameters(this.context.gl,n,()=>{var e={moduleParameters:r,uniforms:i,parameters:n,context:this.context};for(const t of this.props.extensions)t.draw.call(this,e,t);this.draw(e)})}finally{this.props=e}}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(t){const r=this.internalState["changeFlags"];for(const i in t)if(t[i]){let e=!1;"dataChanged"===i&&Array.isArray(r[i])&&(r[i]=Array.isArray(t[i])?r[i].concat(t[i]):t[i],e=!0),r[i]||(r[i]=t[i],e=!0),e&&debug(TRACE_CHANGE_FLAG,this,i,t)}var e=r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged;r.propsOrDataChanged=e,r.somethingChanged=e||t.viewportChanged||t.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}diffProps(e,t){var r=diffProps(e,t);if(r.updateTriggersChanged)for(const i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(r.transitionsChanged)for(const n in r.transitionsChanged)this.internalState.uniformTransitions.add(n,t[n],e[n],e.transitions[n]);return this.setChangeFlags(r)}validateProps(){validateProps(this.props)}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}updateAutoHighlight(e){this.props.autoHighlight&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},r=this.props["highlightColor"];e.picked&&"function"==typeof r&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_updateModules({props:e,oldProps:t},r){var{autoHighlight:i,highlightedObjectIndex:n,highlightColor:e}=e;if(r||t.autoHighlight!==i||t.highlightedObjectIndex!==n||t.highlightColor!==e){const a={};i||(a.pickingSelectedColor=null),Array.isArray(e)&&(a.pickingHighlightColor=e),Number.isInteger(n)&&(a.pickingSelectedColor=0<=n?this.encodePickingColor(n):null),this.setModuleParameters(a)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;var t=this.internalState.needsRedraw&&this.id;this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const r=this.getAttributeManager();e=r&&r.getNeedsRedraw(e);return t||e}_getAttributeManager(){return new AttributeManager(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}_initState(){assert(!this.internalState&&!this.state),assert(isFinite(this.props.coordinateSystem));const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new LayerState({attributeManager:e,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(log$2.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),e)}),(this.internalState.layer=this).internalState.uniformTransitions=new UniformTransitionManager(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(e){debug(TRACE_MATCHED,this,this===e);var{state:t,internalState:r}=e;this!==e&&(this.internalState=r,(this.internalState.layer=this).state=t,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Layer.layerName="Layer",Layer.defaultProps=defaultProps$8;const TRACE_RENDER_LAYERS="compositeLayer.renderLayers";class CompositeLayer extends Layer{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){var t=e["object"];return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){var r=this.props["_subLayerProps"];return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(r){if("function"!=typeof r)return r;{const i={data:this.props.data,target:[]};return(e,t)=>e&&e.__source?(i.index=e.__source.index,r(e.__source.object,i)):r(e,t)}}getSubLayerProps(e={}){var{opacity:t,pickable:r,visible:i,parameters:n,getPolygonOffset:a,highlightedObjectIndex:s,autoHighlight:o,highlightColor:l,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:u,positionFormat:d,modelMatrix:p,extensions:f,fetch:m,_subLayerProps:g}=this.props;const _={opacity:t,pickable:r,visible:i,parameters:n,getPolygonOffset:a,highlightedObjectIndex:s,autoHighlight:o,highlightColor:l,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:u,positionFormat:d,modelMatrix:p,extensions:f,fetch:m},v=g&&g[e.id];m=v&&v.updateTriggers,g=e.id||"sublayer";if(v){var y=this.constructor._propTypes,x=e.type?e.type._propTypes:{};for(const T in v){var b=x[T]||y[T];b&&"accessor"===b.type&&(v[T]=this.getSubLayerAccessor(v[T]))}}Object.assign(_,e,v),_.id="".concat(this.props.id,"-").concat(g),_.updateTriggers={all:this.props.updateTriggers.all,...e.updateTriggers,...m};for(const E of f){var w=E.getSubLayerProps.call(this,E);w&&Object.assign(_,w,{updateTriggers:Object.assign(_.updateTriggers,w.updateTriggers)})}return _}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let e=this.internalState["subLayers"];var t=!e||this.needsUpdate();t&&(e=this.renderLayers(),e=flatten$1(e,Boolean),this.internalState.subLayers=e),debug(TRACE_RENDER_LAYERS,this,t,e);for(const r of e)r.parent=this}}CompositeLayer.layerName="CompositeLayer";class Tesselator{constructor(e={}){var{attributes:t={}}=e;this.typedArrayManager=defaultTypedArrayManager,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e),Object.seal(this)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:i,geometryBuffer:n,positionFormat:a,dataChanged:s,normalize:o=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=n&&n.size||("XY"===a?2:3),this.buffers=r,this.normalize=o,n&&(assert(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(n),o||(r.positions=n)),this.geometryBuffer=r.positions,Array.isArray(s))for(const l of s)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}normalizeGeometry(e){return e}updateGeometryAttributes(e,t,r){throw new Error("Not implemented")}getGeometrySize(e){throw new Error("Not implemented")}getGeometryFromBuffer(e){var t=e.value||e;return assert(ArrayBuffer.isView(t)),getAccessorFromBuffer(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices})}_allocate(e,t){const{attributes:r,buffers:i,_attributeDefs:n,typedArrayManager:a}=this;for(const s in n)if(s in i)a.release(r[s]),r[s]=null;else{const o=n[s];o.copy=t,r[s]=a.allocate(r[s],e,o)}}_forEachGeometry(e,t,r){const{data:i,getGeometry:n}=this,{iterable:a,objectInfo:s}=createIterable(i,t,r);for(const o of a)s.index++,e(n(o,s),s.index)}_rebuildGeometry(e){if(this.data&&this.getGeometry){let{indexStarts:i,vertexStarts:n,instanceCount:a}=this;var t,{data:r,geometryBuffer:s}=this,{startRow:o=0,endRow:l=1/0}=e||{};const c={};e||(i=[0],n=[0]),a=this.normalize||!s?(this._forEachGeometry((e,t)=>{e=this.normalizeGeometry(e),c[t]=e,n[t+1]=n[t]+this.getGeometrySize(e)},o,l),n[n.length-1]):s.buffer instanceof Buffer$1?(t=s.stride||4*this.positionSize,n=r.startIndices,n[r.length]||s.buffer.byteLength/t):(t=s.value||s,s=s.stride/t.BYTES_PER_ELEMENT||this.positionSize,n=r.startIndices,n[r.length]||t.length/s),this._allocate(a,Boolean(e)),this.indexStarts=i,this.vertexStarts=n,this.instanceCount=a;const h={};this._forEachGeometry((e,t)=>{e=c[t]||e,h.vertexStart=n[t],h.indexStart=i[t];var r=t<n.length-1?n[t+1]:a;h.geometrySize=r-n[t],h.geometryIndex=t,this.updateGeometryAttributes(e,h)},o,l),this.vertexCount=i[i.length-1]}}}function getDeckInstance({map:e,gl:t,deck:r}){if(e.__deck)return e.__deck;const i=r&&r.props._customRender;var n={useDevicePixels:!0,_customRender:()=>{e.triggerRepaint(),i&&i()},parameters:{depthMask:!0,depthTest:!0,blendFunc:[770,771,1,771],blendEquation:32774},userData:{isExternal:!1,mapboxLayers:new Set}};return r?(r.setProps(n),r.props.userData.isExternal=!0):(Object.assign(n,{gl:t,width:!1,height:!1,touchAction:"unset",viewState:getViewState(e)}),r=new Deck(n),e.on("move",()=>onMapMove(r,e)),e.on("remove",()=>{r.finalize(),e.__deck=null})),r.props.userData.mapboxVersion=getMapboxVersion(e),e.__deck=r,e.on("render",()=>{r.layerManager&&afterRender(r,e)}),r}function addLayer(e,t){e.props.userData.mapboxLayers.add(t),updateLayers(e)}function removeLayer(e,t){e.props.userData.mapboxLayers.delete(t),updateLayers(e)}function updateLayer(e,t){updateLayers(e)}function drawLayer(e,t,r){let i=e.props.userData["currentViewport"];i||(i=getViewport$1(e,t,!0),e.props.userData.currentViewport=i),e.layerManager&&e._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:e})=>r.id===e.id,clearCanvas:!1})}function getViewState(e){var{lng:t,lat:r}=e.getCenter();return{longitude:t,latitude:r,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}}function getMapboxVersion(e){let t=0,r=0;return e.version&&([t,r]=e.version.split(".").slice(0,2).map(Number)),{major:t,minor:r}}function getViewport$1(e,t,r=!0){var i=e.props.userData["mapboxVersion"];return new WebMercatorViewport(Object.assign({x:0,y:0,width:e.width,height:e.height,repeat:!0},getViewState(t),r?{nearZMultiplier:1===i.major&&3<=i.minor||2<=i.major?.02:1/(e.height||1)}:{nearZMultiplier:.1}))}function afterRender(e,t){var{mapboxLayers:r,isExternal:i}=e.props.userData;if(i){const n=Array.from(r,e=>e.id);e.props.layers.some(e=>!n.includes(e.id))&&e._drawLayers("mapbox-repaint",{viewports:[getViewport$1(e,t,!1)],layerFilter:({layer:e})=>!n.includes(e.id),clearCanvas:!1})}e.props.userData.currentViewport=null}function onMapMove(e,t){e.setProps({viewState:getViewState(t)}),e.needsRedraw({clearRedrawFlags:!0})}function updateLayers(e){if(!e.props.userData.isExternal){const r=[];e.props.userData.mapboxLayers.forEach(e=>{const t=e.props.type;e=new t(e.props);r.push(e)}),e.setProps({layers:r})}}class MapboxLayer{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=getDeckInstance({map:e,gl:t,deck:this.props.deck}),addLayer(this.deck,this)}onRemove(){removeLayer(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&updateLayer(this.deck)}render(e,t){drawLayer(this.deck,this.map,this)}}var vs$3="#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs$5="#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n";const DEFAULT_CANVAS_WIDTH=1024,DEFAULT_BUFFER$2=4,noop=()=>{},DEFAULT_TEXTURE_PARAMETERS={[10241]:9987,10240:9729,10242:33071,10243:33071};function nextPowOfTwo$1(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function resizeImage(e,t,r,i){return r===t.width&&i===t.height?t:(e.canvas.height=i,e.canvas.width=r,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,r,i),e.canvas)}function getIconId(e){return e&&(e.id||e.url)}function resizeTexture(e,t,r,i){var n=t.width,a=t.height,i=cloneTextureFrom(t,{width:r,height:i});return copyToTexture(t,i,{targetY:0,width:n,height:a}),t.delete(),i}function buildRowMapping(t,r,i){for(let e=0;e<r.length;e++){var{icon:n,xOffset:a}=r[e];t[getIconId(n)]={...n,x:a,y:i}}}function buildMapping$1({icons:t,buffer:r,mapping:i={},xOffset:n=0,yOffset:a=0,rowHeight:s=0,canvasWidth:o}){let l=[];for(let e=0;e<t.length;e++){var c,h,u=t[e];i[getIconId(u)]||({height:c,width:h}=u,o<n+h+r&&(buildRowMapping(i,l,a),a=s+a+r,s=n=0,l=[]),l.push({icon:u,xOffset:n}),n=n+h+r,s=Math.max(s,c))}return 0<l.length&&buildRowMapping(i,l,a),{mapping:i,rowHeight:s,xOffset:n,yOffset:a,canvasWidth:o,canvasHeight:nextPowOfTwo$1(s+a+r)}}function getDiffIcons(e,t,r){if(!e||!t)return null;r=r||{};const i={},{iterable:n,objectInfo:a}=createIterable(e);for(const l of n){a.index++;var s=t(l,a),o=getIconId(s);if(!s)throw new Error("Icon is missing.");if(!s.url)throw new Error("Icon url is missing.");i[o]||r[o]&&s.url===r[o].url||(i[o]={...s,source:l,sourceIndex:a.index})}return i}class IconManager{constructor(e,{onUpdate:t=noop,onError:r=noop}){this.gl=e,this.onUpdate=t,this.onError=r,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=DEFAULT_BUFFER$2,this._canvasWidth=DEFAULT_CANVAS_WIDTH,this._canvasHeight=0,this._canvas=null}finalize(){var e;null!==(e=this._texture)&&void 0!==e&&e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){e=this._autoPacking?getIconId(e):e;return this._mapping[e]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:i,data:n,getIcon:a}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),a&&(this._getIcon=a),i&&(this._mapping=i),r&&this._updateIconAtlas(r),this._autoPacking&&(n||a)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(n))}get isLoaded(){return 0===this._pendingCount}_updateIconAtlas(e){var t;null!==(t=this._texture)&&void 0!==t&&t.delete(),this._texture=null,this._externalTexture=e,this.onUpdate()}_updateAutoPacking(e){var t,r,i,n,a=Object.values(getDiffIcons(e,this._getIcon,this._mapping)||{});0<a.length&&({mapping:t,xOffset:r,yOffset:i,rowHeight:n,canvasHeight:e}=buildMapping$1({icons:a,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),this._rowHeight=n,this._mapping=t,this._xOffset=r,this._yOffset=i,this._canvasHeight=e,this._texture||(this._texture=new Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:DEFAULT_TEXTURE_PARAMETERS})),this._texture.height!==this._canvasHeight&&(this._texture=resizeTexture(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(a))}_loadIcons(e){const a=this._canvas.getContext("2d");for(const s of e)this._pendingCount++,load(s.url,ImageLoader$1,this._loadOptions).then(e=>{var t=getIconId(s),{x:r,y:i,width:n,height:t}=this._mapping[t],e=resizeImage(a,e,n,t);this._texture.setSubImageData({data:e,x:r,y:i,width:n,height:t}),this._texture.generateMipmap(),this.onUpdate()}).catch(e=>{this.onError({url:s.url,source:s.source,sourceIndex:s.sourceIndex,loadOptions:this._loadOptions,error:e})}).finally(()=>{this._pendingCount--})}}const DEFAULT_COLOR$4=[0,0,0,255],defaultProps$7={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:DEFAULT_COLOR$4},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class IconLayer extends Layer{getShaders(){return super.getShaders({vs:vs$3,fs:fs$5,modules:[project32,picking]})}initializeState(){this.state={iconManager:new IconManager(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};const e=this.getAttributeManager();e.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:DEFAULT_COLOR$4},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState({oldProps:e,props:t,changeFlags:r}){super.updateState({props:t,oldProps:e,changeFlags:r});const i=this.getAttributeManager();var{iconAtlas:n,iconMapping:a,data:s,getIcon:o}=t;const l=this.state["iconManager"];l.setProps({loadOptions:t.loadOptions});let c=!1;n||this.internalState.isAsyncPropLoading("iconAtlas")?(e.iconAtlas!==t.iconAtlas&&l.setProps({iconAtlas:n,autoPacking:!1}),e.iconMapping!==t.iconMapping&&(l.setProps({iconMapping:a}),c=!0)):l.setProps({autoPacking:!0}),(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&l.setProps({data:s,getIcon:o}),c&&(i.invalidate("instanceOffsets"),i.invalidate("instanceIconFrames"),i.invalidate("instanceColorModes")),r.extensionsChanged&&(o=this.context["gl"],null!==(r=this.state.model)&&void 0!==r&&r.delete(),this.state.model=this._getModel(o),i.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw({uniforms:e}){var{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:n,billboard:a,alphaCutoff:s}=this.props;const o=this.state["iconManager"];var l=o.getTexture();l&&this.state.model.setUniforms(e).setUniforms({iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:UNIT[n],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:i,billboard:a,alphaCutoff:s}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer().props["onIconError"];t?t(e):e.error}getInstanceOffset(e){e=this.state.iconManager.getIconMapping(e);return[e.width/2-e.anchorX||0,e.height/2-e.anchorY||0]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){e=this.state.iconManager.getIconMapping(e);return[e.x||0,e.y||0,e.width||0,e.height||0]}}IconLayer.layerName="IconLayer",IconLayer.defaultProps=defaultProps$7;var vs$2="#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs$4="#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = antialiasing ? \n    smoothedge(distToCenter, outerRadiusPixels) : \n    step(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = antialiasing ? \n      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\n      step(innerUnitRadius * outerRadiusPixels, distToCenter);\n\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n";const DEFAULT_COLOR$3=[0,0,0,255],defaultProps$6={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:DEFAULT_COLOR$3},getLineColor:{type:"accessor",value:DEFAULT_COLOR$3},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ScatterplotLayer extends Layer{getShaders(){return super.getShaders({vs:vs$2,fs:fs$4,modules:[project32,picking]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:r}){super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged&&(t=this.context["gl"],null!==(r=this.state.model)&&void 0!==r&&r.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){var{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:n,stroked:a,filled:s,billboard:o,antialiasing:l,lineWidthUnits:c,lineWidthScale:h,lineWidthMinPixels:u,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:a?1:0,filled:s,billboard:o,antialiasing:l,radiusUnits:UNIT[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:n,lineWidthUnits:UNIT[c],lineWidthScale:h,lineWidthMinPixels:u,lineWidthMaxPixels:d}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}ScatterplotLayer.layerName="ScatterplotLayer",ScatterplotLayer.defaultProps=defaultProps$6;const WINDING={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function modifyPolygonWindingDirection(e,t,r={}){return getPolygonWindingDirection(e,r)!==t&&(reversePolygon(e,r),!0)}function getPolygonWindingDirection(e,t={}){return Math.sign(getPolygonSignedArea(e,t))}function getPolygonSignedArea(r,e={}){var{start:i=0,end:n=r.length}=e,a=e.size||2;let s=0;for(let e=i,t=n-a;e<n;e+=a)s+=(r[e]-r[t])*(r[e+1]+r[t+1]),t=e;return s/2}function reversePolygon(t,e){var{start:r=0,end:e=t.length,size:i=2}=e,n=(e-r)/i,a=Math.floor(n/2);for(let e=0;e<a;++e){var s=r+e*i,o=r+(n-1-e)*i;for(let e=0;e<i;++e){var l=t[s+e];t[s+e]=t[o+e],t[o+e]=l}}}function push(r,i){var n=i.length,a=r.length;if(0<a){let t=!0;for(let e=0;e<n;e++)if(r[a-n+e]!==i[e]){t=!1;break}if(t)return!1}for(let e=0;e<n;e++)r[a+e]=i[e];return!0}function copy(t,r){var i=r.length;for(let e=0;e<i;e++)t[e]=r[e]}function getPointAtIndex(t,e,r,i,n=[]){var a=i+e*r;for(let e=0;e<r;e++)n[e]=t[a+e];return n}function intersect(t,r,e,i,n=[]){let a,s;if(8&e)a=(i[3]-t[1])/(r[1]-t[1]),s=3;else if(4&e)a=(i[1]-t[1])/(r[1]-t[1]),s=1;else if(2&e)a=(i[2]-t[0])/(r[0]-t[0]),s=2;else{if(!(1&e))return null;a=(i[0]-t[0])/(r[0]-t[0]),s=0}for(let e=0;e<t.length;e++)n[e]=(1&s)===e?i[s]:a*(r[e]-t[e])+t[e];return n}function bitCode(e,t){let r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}function cutPolylineByGrid(t,e={}){var{size:r=2,broken:i=!1,gridResolution:n=10,gridOffset:a=[0,0],startIndex:s=0,endIndex:e=t.length}=e,o=(e-s)/r;let l=[];const c=[l];var h=getPointAtIndex(t,0,r,s);let u,d;var p=getGridCell(h,n,a,[]),f=[];push(l,h);for(let e=1;e<o;e++){for(u=getPointAtIndex(t,e,r,s,u),d=bitCode(u,p);d;){intersect(h,u,d,p,f);var m=bitCode(f,p);m&&(intersect(h,f,m,p,f),d=m),push(l,f),copy(h,f),moveToNeighborCell(p,n,d),i&&l.length>r&&(l=[],c.push(l),push(l,h)),d=bitCode(u,p)}push(l,u),copy(h,u)}return i?c:c[0]}const TYPE_INSIDE=0,TYPE_BORDER=1;function concatInPlace(t,r){for(let e=0;e<r.length;e++)t.push(r[e]);return t}function cutPolygonByGrid(e,t,r={}){if(!e.length)return[];var{size:i=2,gridResolution:n=10,gridOffset:a=[0,0],edgeTypes:s=!1}=r;const o=[],l=[{pos:e,types:s&&new Array(e.length/i).fill(TYPE_BORDER),holes:t||[]}];var c=[[],[]];let h=[];for(;l.length;){var{pos:u,types:d,holes:p}=l.shift();getBoundingBox(u,i,p[0]||u.length,c),h=getGridCell(c[0],n,a,h);var f=bitCode(c[1],h);if(f){var m=bisectPolygon(u,d,i,0,p[0]||u.length,h,f);const g={pos:m[0].pos,types:m[0].types,holes:[]},_={pos:m[1].pos,types:m[1].types,holes:[]};l.push(g,_);for(let e=0;e<p.length;e++)(m=bisectPolygon(u,d,i,p[e],p[e+1]||u.length,h,f))[0]&&(g.holes.push(g.pos.length),g.pos=concatInPlace(g.pos,m[0].pos),s&&(g.types=concatInPlace(g.types,m[0].types))),m[1]&&(_.holes.push(_.pos.length),_.pos=concatInPlace(_.pos,m[1].pos),s&&(_.types=concatInPlace(_.types,m[1].types)))}else{const v={positions:u};s&&(v.edgeTypes=d),p.length&&(v.holeIndices=p),o.push(v)}}return o}function bisectPolygon(t,r,i,n,e,a,s){var o=(e-n)/i,l=[],c=[];const h=[],u=[];var d,p,f=[];let m;var g=getPointAtIndex(t,o-1,i,n);let _=Math.sign(8&s?g[1]-a[3]:g[0]-a[2]),v=r&&r[o-1],y=0,x=0;for(let e=0;e<o;e++)m=getPointAtIndex(t,e,i,n,m),d=Math.sign(8&s?m[1]-a[3]:m[0]-a[2]),p=r&&r[n/i+e],d&&_&&_!==d&&(intersect(g,m,s,a,f),push(l,f)&&h.push(v),push(c,f)&&u.push(v)),d<=0?(push(l,m)&&h.push(p),y-=d):h.length&&(h[h.length-1]=TYPE_INSIDE),0<=d?(push(c,m)&&u.push(p),x+=d):u.length&&(u[u.length-1]=TYPE_INSIDE),copy(g,m),_=d,v=p;return[y?{pos:l,types:r&&h}:null,x?{pos:c,types:r&&u}:null]}function getGridCell(e,t,r,i){var n=Math.floor((e[0]-r[0])/t)*t+r[0],r=Math.floor((e[1]-r[1])/t)*t+r[1];return i[0]=n,i[1]=r,i[2]=n+t,i[3]=r+t,i}function moveToNeighborCell(e,t,r){8&r?(e[1]+=t,e[3]+=t):4&r?(e[1]-=t,e[3]-=t):2&r?(e[0]+=t,e[2]+=t):1&r&&(e[0]-=t,e[2]-=t)}function getBoundingBox(t,r,i,e){let n=1/0,a=-1/0,s=1/0,o=-1/0;for(let e=0;e<i;e+=r){var l=t[e],c=t[e+1];n=l<n?l:n,a=l>a?l:a,s=c<s?c:s,o=c>o?c:o}return e[0][0]=n,e[0][1]=s,e[1][0]=a,e[1][1]=o,e}const DEFAULT_MAX_LATITUDE=85.051129;function cutPolylineByMercatorBounds(e,t={}){var{size:r=2,startIndex:i=0,endIndex:n=e.length,normalize:t=!0}=t,e=e.slice(i,n);wrapLongitudesForShortestPath(e,r,0,n-i);e=cutPolylineByGrid(e,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(t)for(const a of e)shiftLongitudesIntoRange(a,r);return e}function cutPolygonByMercatorBounds(t,r,i={}){var{size:n=2,normalize:e=!0,edgeTypes:a=!1}=i;r=r||[];const s=[],o=[];let l=0,c=0;for(let e=0;e<=r.length;e++){var h=r[e]||t.length,u=c,d=findSplitIndex(t,n,l,h);for(let e=d;e<h;e++)s[c++]=t[e];for(let e=l;e<d;e++)s[c++]=t[e];wrapLongitudesForShortestPath(s,n,u,c),insertPoleVertices(s,n,u,c,i.maxLatitude),l=h,o[e]=c}o.pop();a=cutPolygonByGrid(s,o,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:a});if(e)for(const p of a)shiftLongitudesIntoRange(p.positions,n);return a}function findSplitIndex(t,r,i,n){let a=-1,s=-1;for(let e=i+1;e<n;e+=r){var o=Math.abs(t[e]);o>a&&(a=o,s=e-1)}return s}function insertPoleVertices(e,t,r,i,n=DEFAULT_MAX_LATITUDE){var a=e[r],i=e[i-t];if(180<Math.abs(a-i)){const s=getPointAtIndex(e,0,t,r);s[0]+=360*Math.round((i-a)/360),push(e,s),s[1]=Math.sign(s[1])*n,push(e,s),s[0]=a,push(e,s)}}function wrapLongitudesForShortestPath(t,r,i,n){let a=t[0],s;for(let e=i;e<n;e+=r){s=t[e];var o=s-a;(180<o||o<-180)&&(s-=360*Math.round(o/360)),t[e]=a=s}}function shiftLongitudesIntoRange(t,r){let i;var n=t.length/r;for(let e=0;e<n&&(i=t[e*r],(i+180)%360==0);e++);var a=360*-Math.round(i/360);if(0!=a)for(let e=0;e<n;e++)t[e*r]+=a}function normalizePath(r,i,e,t){let n=r;if(Array.isArray(r[0])){var a=r.length*i;n=new Array(a);for(let t=0;t<r.length;t++)for(let e=0;e<i;e++)n[t*i+e]=r[t][e]||0}return e?cutPolylineByGrid(n,{size:i,gridResolution:e}):t?cutPolylineByMercatorBounds(n,{size:i}):n}const START_CAP=1,END_CAP=2,INVALID=4;class PathTesselator extends Tesselator{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):()=>null}normalizeGeometry(e){return this.normalize?normalizePath(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}get(e){return this.attributes[e]}getGeometrySize(t){if(Array.isArray(t[0])){let e=0;for(const r of t)e+=this.getGeometrySize(r);return e}var e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&Array.isArray(e[0]))for(const i of e){var r=this.getGeometrySize(i);t.geometrySize=r,this.updateGeometryAttributes(i,t),t.vertexStart+=r}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes["segmentTypes"];var i=this.isClosed(e),{vertexStart:e,geometrySize:t}=t;r.fill(0,e,e+t),i?(r[e]=INVALID,r[e+t-2]=INVALID):(r[e]+=START_CAP,r[e+t-2]+=END_CAP),r[e+t-1]=INVALID}_updatePositions(r,i){const n=this.attributes["positions"];if(n){var{vertexStart:i,geometrySize:a}=i,s=new Array(3);for(let e=i,t=0;t<a;e++,t++)this.getPointOnPath(r,t,s),n[3*e]=s[0],n[3*e+1]=s[1],n[3*e+2]=s[2]}}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){var i=this["positionSize"];t*i>=e.length&&(t+=1-e.length/i);t*=i;return r[0]=e[t],r[1]=e[1+t],r[2]=3===i&&e[2+t]||0,r}isClosed(e){if(!this.normalize)return this.opts.loop;var t=this["positionSize"],r=e.length-t;return e[0]===e[r]&&e[1]===e[1+r]&&(2===t||e[2]===e[2+r])}}var vs$1="#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.pickingColor = instancePickingColors;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  geometry.worldPosition = currPosition;\n  vec2 widthPixels = vec2(clamp(\n    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs$3="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n";const DEFAULT_COLOR$2=[0,0,0,255],defaultProps$5={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:DEFAULT_COLOR$2},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ATTRIBUTE_TRANSITION$1={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class PathLayer extends Layer{getShaders(){return super.getShaders({vs:vs$1,fs:fs$3,modules:[project32,picking]})}get wrapLongitude(){return!1}initializeState(){const e=this.getAttributeManager();e.addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:ATTRIBUTE_TRANSITION$1,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ATTRIBUTE_TRANSITION$1,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:ATTRIBUTE_TRANSITION$1,defaultValue:DEFAULT_COLOR$2},instancePickingColors:{size:3,type:5121,accessor:(e,{index:t,target:r})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,r)}}),this.setState({pathTesselator:new PathTesselator({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&log$2.removed("getDashArray","PathStyleExtension")()}updateState({oldProps:e,props:t,changeFlags:r}){super.updateState({props:t,oldProps:e,changeFlags:r});const i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const n=this.state["pathTesselator"];e=t.data.attributes||{};n.updateGeometry({data:t.data,geometryBuffer:e.getPath,buffers:e,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:n.instanceCount,startIndices:n.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&(t=this.context["gl"],null!==(r=this.state.model)&&void 0!==r&&r.delete(),this.state.model=this._getModel(t),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),r=t["index"],i=this.props["data"];return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===r)),t}disablePickingIndex(t){var r=this.props["data"];if(r[0]&&r[0].__source)for(let e=0;e<r.length;e++)r[e].__source.index===t&&this._disablePickingIndex(e);else this._disablePickingIndex(t)}draw({uniforms:e}){var{jointRounded:t,capRounded:r,billboard:i,miterLimit:n,widthUnits:a,widthScale:s,widthMinPixels:o,widthMaxPixels:l}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(t),capType:Number(r),billboard:i,widthUnits:UNIT[a],widthScale:s,miterLimit:n,widthMinPixels:o,widthMaxPixels:l}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const t=this.state["pathTesselator"];e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const t=this.state["pathTesselator"];e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}PathLayer.layerName="PathLayer",PathLayer.defaultProps=defaultProps$5;var earcut$2={exports:{}};function earcut(e,t,r){r=r||2;var i,n,a,s,o,l=t&&t.length,c=l?t[0]*r:e.length,h=linkedList$1(e,0,c,r,!0),u=[];if(!h||h.next===h.prev)return u;if(l&&(h=eliminateHoles$1(e,t,h,r)),e.length>80*r){for(var d=i=e[0],p=n=e[1],f=r;f<c;f+=r)(a=e[f])<d&&(d=a),(s=e[f+1])<p&&(p=s),i<a&&(i=a),n<s&&(n=s);o=0!==(o=Math.max(i-d,n-p))?1/o:0}return earcutLinked$1(h,u,r,d,p,o),u}function linkedList$1(e,t,r,i,n){var a,s;if(n===0<signedArea$1(e,t,r,i))for(a=t;a<r;a+=i)s=insertNode$2(a,e[a],e[a+1],s);else for(a=r-i;t<=a;a-=i)s=insertNode$2(a,e[a],e[a+1],s);return s&&equals$1(s,s.next)&&(removeNode$1(s),s=s.next),s}function filterPoints$1(e,t){if(!e)return e;t=t||e;var r,i=e;do{if(r=!1,i.steiner||!equals$1(i,i.next)&&0!==area$1(i.prev,i,i.next))i=i.next;else{if(removeNode$1(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function earcutLinked$1(e,t,r,i,n,a,s){if(e){!s&&a&&indexCurve$1(e,i,n,a);for(var o,l,c=e;e.prev!==e.next;)if(o=e.prev,l=e.next,a?isEarHashed$1(e,i,n,a):isEar$1(e))t.push(o.i/r),t.push(e.i/r),t.push(l.i/r),removeNode$1(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?earcutLinked$1(e=cureLocalIntersections$1(filterPoints$1(e),t,r),t,r,i,n,a,2):2===s&&splitEarcut$1(e,t,r,i,n,a):earcutLinked$1(filterPoints$1(e),t,r,i,n,a,1);break}}}function isEar$1(e){var t=e.prev,r=e,i=e.next;if(0<=area$1(t,r,i))return!1;for(var n=e.next.next;n!==e.prev;){if(pointInTriangle$1(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&0<=area$1(n.prev,n,n.next))return!1;n=n.next}return!0}function isEarHashed$1(e,t,r,i){var n=e.prev,a=e,s=e.next;if(0<=area$1(n,a,s))return!1;for(var o=(n.x<a.x?n.x<s.x?n:s:a.x<s.x?a:s).x,l=(n.y<a.y?n.y<s.y?n:s:a.y<s.y?a:s).y,c=(n.x>a.x?n.x>s.x?n:s:a.x>s.x?a:s).x,h=(n.y>a.y?n.y>s.y?n:s:a.y>s.y?a:s).y,u=zOrder$1(o,l,t,r,i),d=zOrder$1(c,h,t,r,i),p=e.prevZ,f=e.nextZ;p&&p.z>=u&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle$1(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&0<=area$1(p.prev,p,p.next))return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&pointInTriangle$1(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=area$1(f.prev,f,f.next))return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&pointInTriangle$1(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&0<=area$1(p.prev,p,p.next))return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&pointInTriangle$1(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=area$1(f.prev,f,f.next))return!1;f=f.nextZ}return!0}function cureLocalIntersections$1(e,t,r){var i=e;do{var n=i.prev,a=i.next.next}while(!equals$1(n,a)&&intersects$3(n,i,i.next,a)&&locallyInside$1(n,a)&&locallyInside$1(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),removeNode$1(i),removeNode$1(i.next),i=e=a),(i=i.next)!==e);return filterPoints$1(i)}function splitEarcut$1(e,t,r,i,n,a){var s=e;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&isValidDiagonal$1(s,o)){var l=splitPolygon$1(s,o),s=filterPoints$1(s,s.next),l=filterPoints$1(l,l.next);return earcutLinked$1(s,t,r,i,n,a),void earcutLinked$1(l,t,r,i,n,a)}o=o.next}}while((s=s.next)!==e)}function eliminateHoles$1(e,t,r,i){for(var n,a=[],s=0,o=t.length;s<o;s++)(n=linkedList$1(e,t[s]*i,s<o-1?t[s+1]*i:e.length,i,!1))===n.next&&(n.steiner=!0),a.push(getLeftmost$1(n));for(a.sort(compareX$1),s=0;s<a.length;s++)r=filterPoints$1(r=eliminateHole$1(a[s],r),r.next);return r}function compareX$1(e,t){return e.x-t.x}function eliminateHole$1(e,t){var r=findHoleBridge$1(e,t);if(!r)return t;var i=splitPolygon$1(r,e),e=filterPoints$1(r,r.next);return filterPoints$1(i,i.next),t===r?e:t}function findHoleBridge$1(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&s<o){if((s=o)===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}}while((i=i.next)!==t);if(!r)return null;if(n===s)return r;for(var l,c=r,h=r.x,u=r.y,d=1/0,i=r;n>=i.x&&i.x>=h&&n!==i.x&&pointInTriangle$1(a<u?n:s,a,h,u,a<u?s:n,a,i.x,i.y)&&(l=Math.abs(a-i.y)/(n-i.x),locallyInside$1(i,e)&&(l<d||l===d&&(i.x>r.x||i.x===r.x&&sectorContainsSector$1(r,i)))&&(r=i,d=l)),(i=i.next)!==c;);return r}function sectorContainsSector$1(e,t){return area$1(e.prev,e,t.prev)<0&&area$1(t.next,e,e.next)<0}function indexCurve$1(e,t,r,i){for(var n=e;null===n.z&&(n.z=zOrder$1(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,(n=n.next)!==e;);n.prevZ.nextZ=null,n.prevZ=null,sortLinked$1(n)}function sortLinked$1(e){var t,r,i,n,a,s,o,l,c=1;do{for(r=e,a=e=null,s=0;r;){for(s++,i=r,t=o=0;t<c&&(o++,i=i.nextZ);t++);for(l=c;0<o||0<l&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(r=(n=r).nextZ,o--):(i=(n=i).nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}}while(a.nextZ=null,c*=2,1<s);return e}function zOrder$1(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost$1(e){for(var t=e,r=e;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),(t=t.next)!==e;);return r}function pointInTriangle$1(e,t,r,i,n,a,s,o){return 0<=(n-s)*(t-o)-(e-s)*(a-o)&&0<=(e-s)*(i-o)-(r-s)*(t-o)&&0<=(r-s)*(a-o)-(n-s)*(i-o)}function isValidDiagonal$1(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon$1(e,t)&&(locallyInside$1(e,t)&&locallyInside$1(t,e)&&middleInside$1(e,t)&&(area$1(e.prev,e,t.prev)||area$1(e,t.prev,t))||equals$1(e,t)&&0<area$1(e.prev,e,e.next)&&0<area$1(t.prev,t,t.next))}function area$1(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals$1(e,t){return e.x===t.x&&e.y===t.y}function intersects$3(e,t,r,i){var n=sign$1(area$1(e,t,r)),a=sign$1(area$1(e,t,i)),s=sign$1(area$1(r,i,e)),o=sign$1(area$1(r,i,t));return n!==a&&s!==o||(!(0!==n||!onSegment$1(e,r,t))||(!(0!==a||!onSegment$1(e,i,t))||(!(0!==s||!onSegment$1(r,e,i))||!(0!==o||!onSegment$1(r,t,i)))))}function onSegment$1(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sign$1(e){return 0<e?1:e<0?-1:0}function intersectsPolygon$1(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects$3(r,r.next,e,t))return!0}while((r=r.next)!==e);return!1}function locallyInside$1(e,t){return area$1(e.prev,e,e.next)<0?0<=area$1(e,t,e.next)&&0<=area$1(e,e.prev,t):area$1(e,t,e.prev)<0||area$1(e,e.next,t)<0}function middleInside$1(e,t){for(var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),(r=r.next)!==e;);return i}function splitPolygon$1(e,t){var r=new Node$1(e.i,e.x,e.y),i=new Node$1(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(a.next=i).prev=a,i}function insertNode$2(e,t,r,i){r=new Node$1(e,t,r);return i?(r.next=i.next,(r.prev=i).next.prev=r,i.next=r):(r.prev=r).next=r,r}function removeNode$1(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node$1(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea$1(e,t,r,i){for(var n=0,a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}earcut$2.exports=earcut,(earcut$2.exports.default=earcut).deviation=function(e,t,r,i){var n=t&&t.length,a=n?t[0]*r:e.length,s=Math.abs(signedArea$1(e,0,a,r));if(n)for(var o=0,l=t.length;o<l;o++){var c=t[o]*r,h=o<l-1?t[o+1]*r:e.length;s-=Math.abs(signedArea$1(e,c,h,r))}for(var u=0,o=0;o<i.length;o+=3){var d=i[o]*r,p=i[o+1]*r,f=i[o+2]*r;u+=Math.abs((e[d]-e[f])*(e[1+p]-e[1+d])-(e[d]-e[p])*(e[1+f]-e[1+d]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},earcut.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[n][a][s]);0<n&&(i+=e[n-1].length,r.holes.push(i))}return r};var earcut$1=earcut$2.exports;const OUTER_POLYGON_WINDING=WINDING.CLOCKWISE,HOLE_POLYGON_WINDING=WINDING.COUNTER_CLOCKWISE,windingOptions={isClosed:!0};function validate(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function isSimple(e){return 1<=e.length&&2<=e[0].length&&Number.isFinite(e[0][0])}function isNestedRingClosed(e){var t=e[0],e=e[e.length-1];return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function isFlatRingClosed(t,r,i,n){for(let e=0;e<r;e++)if(t[i+e]!==t[n-r+e])return!1;return!0}function copyNestedRing(r,e,i,n,t){let a=e;var s=i.length;for(let t=0;t<s;t++)for(let e=0;e<n;e++)r[a++]=i[t][e]||0;if(!isNestedRingClosed(i))for(let e=0;e<n;e++)r[a++]=i[0][e]||0;return windingOptions.start=e,windingOptions.end=a,windingOptions.size=n,modifyPolygonWindingDirection(r,t,windingOptions),a}function copyFlatRing(t,e,r,i,n=0,a,s){var o=(a=a||r.length)-n;if(o<=0)return e;let l=e;for(let e=0;e<o;e++)t[l++]=r[n+e];if(!isFlatRingClosed(r,i,n,a))for(let e=0;e<i;e++)t[l++]=r[n+e];return windingOptions.start=e,windingOptions.end=l,windingOptions.size=i,modifyPolygonWindingDirection(t,s,windingOptions),l}function normalize(t,r){validate(t);var i=[];const n=[];if(t.positions){var{positions:a,holeIndices:s}=t;if(s){let t=0;for(let e=0;e<=s.length;e++)t=copyFlatRing(i,t,a,r,s[e-1],s[e],0===e?OUTER_POLYGON_WINDING:HOLE_POLYGON_WINDING),n.push(t);return n.pop(),{positions:i,holeIndices:n}}t=a}if(Number.isFinite(t[0]))return copyFlatRing(i,0,t,r,0,i.length,OUTER_POLYGON_WINDING),i;if(isSimple(t))return copyNestedRing(i,0,t,r,OUTER_POLYGON_WINDING),i;{let e=0;for(var[o,l]of t.entries())e=copyNestedRing(i,e,l,r,0===o?OUTER_POLYGON_WINDING:HOLE_POLYGON_WINDING),n.push(e);return n.pop(),{positions:i,holeIndices:n}}}function getSurfaceIndices(e,t,r){let i=null;e.holeIndices&&(i=e.holeIndices.map(e=>e/t));let n=e.positions||e;if(r){var a=n.length;n=n.slice();const o=[];for(let e=0;e<a;e+=t){o[0]=n[e],o[1]=n[e+1];var s=r(o);n[e]=s[0],n[e+1]=s[1]}}return earcut$1(n,i,t)}class PolygonTesselator extends Tesselator{constructor(e){var{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e){const t=this["attributes"];return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);e=this.buffers.indices;e&&(this.vertexCount=(e.value||e).length)}normalizeGeometry(e){if(this.normalize){if(e=normalize(e,this.positionSize),this.opts.resolution)return cutPolygonByGrid(e.positions||e,e.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return cutPolygonByMercatorBounds(e.positions||e,e.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return e}getGeometrySize(t){if(!Array.isArray(t)||Number.isFinite(t[0]))return(t.positions||t).length/this.positionSize;{let e=0;for(const r of t)e+=this.getGeometrySize(r);return e}}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):()=>null}updateGeometryAttributes(e,t){if(Array.isArray(e)&&!Number.isFinite(e[0]))for(const i of e){var r=this.getGeometrySize(i);t.geometrySize=r,this.updateGeometryAttributes(i,t),t.vertexStart+=r,t.indexStart=this.indexStarts[t.geometryIndex+1]}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}_updateIndices(e,{geometryIndex:r,vertexStart:i,indexStart:n}){const{attributes:a,indexStarts:s,typedArrayManager:o}=this;let l=a.indices;if(l){let t=n;var c=getSurfaceIndices(e,this.positionSize,this.opts.preproject);l=o.allocate(l,n+c.length,{copy:!0});for(let e=0;e<c.length;e++)l[t++]=c[e]+i;s[r+1]=n+c.length,a.indices=l}}_updatePositions(e,{vertexStart:r,geometrySize:i}){const{attributes:{positions:n},positionSize:a}=this;if(n){var s=e.positions||e;for(let e=r,t=0;t<i;e++,t++){var o=s[t*a],l=s[t*a+1],c=2<a?s[t*a+2]:0;n[3*e]=o,n[3*e+1]=l,n[3*e+2]=c}}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{attributes:{vertexValid:i},positionSize:n}=this;var a=e&&e.holeIndices;if(e&&e.edgeTypes?i.set(e.edgeTypes,t):i.fill(1,t,t+r),a)for(let e=0;e<a.length;e++)i[t+a[e]/n-1]=0;i[t+r-1]=0}}var main="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n#ifdef IS_SIDE_VERTEX\n  if(vertexValid < 0.5){\n    gl_Position = vec4(0.);\n    return;\n  }\n#endif\n\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",vsTop="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(main,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),vsSide="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(main,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  #if RING_WINDING_ORDER_CW == 1\n    props.positions = instancePositions;\n    props.positions64Low = instancePositions64Low;\n    props.nextPositions = nextPositions;\n    props.nextPositions64Low = nextPositions64Low;\n  #else\n    props.positions = nextPositions;\n    props.positions64Low = nextPositions64Low;\n    props.nextPositions = instancePositions;\n    props.nextPositions64Low = instancePositions64Low;\n  #endif\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n\n  calculatePosition(props);\n}\n"),fs$2="#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n";const DEFAULT_COLOR$1=[0,0,0,255],defaultProps$4={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:DEFAULT_COLOR$1},getLineColor:{type:"accessor",value:DEFAULT_COLOR$1},material:!0},ATTRIBUTE_TRANSITION={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class SolidPolygonLayer extends Layer{getShaders(e){return super.getShaders({vs:"top"===e?vsTop:vsSide,fs:fs$2,defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[project32,gouraudLighting,picking]})}get wrapLongitude(){return!1}initializeState(){var{gl:e,viewport:t}=this.context;let r=this.props["coordinateSystem"];t.isGeospatial&&r===COORDINATE_SYSTEM.DEFAULT&&(r=COORDINATE_SYSTEM.LNGLAT),this.setState({numInstances:0,polygonTesselator:new PolygonTesselator({preproject:r===COORDINATE_SYSTEM.LNGLAT&&t.projectFlat,fp64:this.use64bitPositions(),IndexType:!e||hasFeatures$1(e,FEATURES$1.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const i=this.getAttributeManager();i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:ATTRIBUTE_TRANSITION,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:ATTRIBUTE_TRANSITION,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ATTRIBUTE_TRANSITION,accessor:"getFillColor",defaultValue:DEFAULT_COLOR$1,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:ATTRIBUTE_TRANSITION,accessor:"getLineColor",defaultValue:DEFAULT_COLOR$1,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(e,{index:t,target:r})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,r),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const t=super.getPickingInfo(e),r=t["index"],i=this.props["data"];return i[0]&&i[0].__source&&(t.object=i.find(e=>e.__source.index===r)),t}disablePickingIndex(t){var r=this.props["data"];if(r[0]&&r[0].__source)for(let e=0;e<r.length;e++)r[e].__source.index===t&&this._disablePickingIndex(e);else this._disablePickingIndex(t)}draw({uniforms:e}){var{extruded:t,filled:r,wireframe:i,elevationScale:n}=this.props;const{topModel:a,sideModel:s,polygonTesselator:o}=this.state;n={...e,extruded:Boolean(t),elevationScale:n};s&&(s.setInstanceCount(o.instanceCount-1),s.setUniforms(n),i&&(s.setDrawMode(3),s.setUniforms({isWireframe:!0}).draw()),r&&(s.setDrawMode(6),s.setUniforms({isWireframe:!1}).draw())),a&&(a.setVertexCount(o.vertexCount),a.setUniforms(n).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);var{props:t,oldProps:r,changeFlags:e}=e;const i=this.getAttributeManager();!e.extensionsChanged&&t.filled===r.filled&&t.extruded===r.extruded||(null!==(r=this.state.models)&&void 0!==r&&r.forEach(e=>e.delete()),this.setState(this._getModels(this.context.gl)),i.invalidateAll())}updateGeometry({props:e,changeFlags:t}){if(t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon)){const i=this.state["polygonTesselator"];var r=e.data.attributes||{};i.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:r.getPolygon,buffers:r,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:t.dataChanged}),this.setState({numInstances:i.instanceCount,startIndices:i.vertexStarts}),t.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){var{id:t,filled:r,extruded:i}=this.props;let n,a;if(r){const s=this.getShaders("top");s.defines.NON_INSTANCED_MODEL=1,n=new Model(e,{...s,id:"".concat(t,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(a=new Model(e,{...this.getShaders("side"),id:"".concat(t,"-side"),geometry:new Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),a.userData.excludeAttributes={indices:!0}),{models:[a,n].filter(Boolean),topModel:n,sideModel:a}}calculateIndices(e){const t=this.state["polygonTesselator"];e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const t=this.state["polygonTesselator"];e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}function replaceInRange({data:t,getIndex:r,dataRange:e,replace:i}){var{startRow:n=0,endRow:a=1/0}=e,s=t.length;let o=s,l=s;for(let e=0;e<s;e++){var c=r(t[e]);if(o>e&&n<=c&&(o=e),a<=c){l=e;break}}let h=o;var e=l-o!==i.length,u=e&&t.slice(l);for(let e=0;e<i.length;e++)t[h++]=i[e];if(e){for(let e=0;e<u.length;e++)t[h++]=u[e];t.length=h}return{startRow:o,endRow:o+i.length}}function binaryToFeatureForAccesor(e,t){if(!e)return null;var r="startIndices"in e?e.startIndices[t]:t,t=e.featureIds.value[r];return-1!==r?getPropertiesForIndex(e,t,r):null}function getPropertiesForIndex(e,t,r){const i={properties:{...e.properties[t]}};for(const n in e.numericProps)i.properties[n]=e.numericProps[n].value[r];return i}function calculatePickingColors(e,t){const r={points:null,lines:null,polygons:null};for(const a in r){var i=e[a].globalFeatureIds.value;r[a]=new Uint8ClampedArray(3*i.length);var n=[];for(let e=0;e<i.length;e++)t(i[e],n),r[a][3*e+0]=n[0],r[a][3*e+1]=n[1],r[a][3*e+2]=n[2]}return r}SolidPolygonLayer.layerName="SolidPolygonLayer",SolidPolygonLayer.defaultProps=defaultProps$4;var fs$1="#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float buffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n";const DEFAULT_BUFFER$1=.75,EMPTY_ARRAY=[],defaultProps$3={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class MultiIconLayer extends IconLayer{getShaders(){return{...super.getShaders(),fs:fs$1}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(e,{index:t,target:r})=>this.encodePickingColor(t,r)}})}updateState(e){super.updateState(e);var{props:t,oldProps:e}=e;let r=t["outlineColor"];r!==e.outlineColor&&(r=r.map(e=>e/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!t.sdf&&t.outlineWidth&&log$2.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){var{sdf:t,smoothing:r,outlineWidth:i}=this.props,n=this.state["outlineColor"];e.uniforms={...e.uniforms,buffer:DEFAULT_BUFFER$1,outlineBuffer:i?Math.max(r,DEFAULT_BUFFER$1*(1-i)):-1,gamma:r,sdf:Boolean(t),outlineColor:n},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).map(e=>super.getInstanceOffset(e)):EMPTY_ARRAY}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).map(e=>super.getInstanceIconFrame(e)):EMPTY_ARRAY}}MultiIconLayer.layerName="MultiIconLayer",MultiIconLayer.defaultProps=defaultProps$3;var tinySdf={exports:{}};tinySdf.exports=TinySDF,tinySdf.exports.default=TinySDF;var INF=1e20;function TinySDF(e,t,r,i,n,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=i||.25,this.fontFamily=n||"sans-serif",this.fontWeight=a||"normal",this.radius=r||8;a=this.size=this.fontSize+2*this.buffer,r=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(r*r),this.gridInner=new Float64Array(r*r),this.f=new Float64Array(r),this.z=new Float64Array(r+1),this.v=new Uint16Array(r),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(0<=navigator.userAgent.indexOf("Gecko/")?1.2:1))}function prepareGrids(e,t,r,i,n,a,s){a.fill(INF,0,t*r),s.fill(0,0,t*r);for(var o=(t-i)/2,l=0;l<n;l++)for(var c=0;c<i;c++){var h,u=(l+o)*t+c+o,d=e.data[4*(l*i+c)+3]/255;1==d?(a[u]=0,s[u]=INF):0==d?(a[u]=INF,s[u]=0):(h=Math.max(0,.5-d),d=Math.max(0,d-.5),a[u]=h*h,s[u]=d*d)}}function extractAlpha(e,t,r,i,n,a,s){for(var o=0;o<t*r;o++){var l=Math.sqrt(i[o])-Math.sqrt(n[o]);e[o]=Math.round(255-255*(l/a+s))}}function edt(e,t,r,i,n,a){for(var s=0;s<t;s++)edt1d(e,s,t,r,i,n,a);for(var o=0;o<r;o++)edt1d(e,o*t,1,t,i,n,a)}function edt1d(e,t,r,i,n,a,s){var o,l,c,h;for(s[a[0]=0]=-INF,s[1]=INF,o=0;o<i;o++)n[o]=e[t+o*r];for(o=1,c=l=0;o<i;o++){for(;h=a[l],(c=(n[o]-n[h]+o*o-h*h)/(o-h)/2)<=s[l]&&-1<--l;);a[++l]=o,s[l]=c,s[l+1]=INF}for(l=o=0;o<i;o++){for(;s[l+1]<o;)l++;h=a[l],e[t+o*r]=n[h]+(o-h)*(o-h)}}TinySDF.prototype._draw=function(e,t){var r,i,n,a,s,o,l,c,h=this.ctx.measureText(e),u=h.width,d=2*this.buffer;t&&this.useMetrics?(s=Math.floor(h.actualBoundingBoxAscent),l=this.buffer+Math.ceil(h.actualBoundingBoxAscent),p=this.buffer,o=this.buffer,r=(i=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+d,n=(a=Math.min(this.size-p,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+d,this.ctx.textBaseline="alphabetic"):(r=i=this.size,n=a=this.size,s=19*this.fontSize/24,p=o=0,l=this.middle,this.ctx.textBaseline="middle"),i&&a&&(this.ctx.clearRect(o,p,i,a),this.ctx.fillText(e,this.buffer,l),c=this.ctx.getImageData(o,p,i,a));var p=new Uint8ClampedArray(r*n);return prepareGrids(c,r,n,i,a,this.gridOuter,this.gridInner),edt(this.gridOuter,r,n,this.f,this.v,this.z),edt(this.gridInner,r,n,this.f,this.v,this.z),extractAlpha(p,r,n,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:p,metrics:{width:i,height:a,sdfWidth:r,sdfHeight:n,top:s,left:0,advance:u}}},TinySDF.prototype.draw=function(e){return this._draw(e,!1).data},TinySDF.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};var TinySDF$1=tinySdf.exports;const MISSING_CHAR_WIDTH=32,SINGLE_LINE=[];function nextPowOfTwo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function buildMapping({characterSet:e,getFontWidth:t,fontHeight:r,buffer:i,maxCanvasWidth:n,mapping:a={},xOffset:s=0,yOffset:o=0}){let l=0,c=s,h=0;for(const d of e){var u;a[d]||(u=t(d,h++),c+u+2*i>n&&(c=0,l++),a[d]={x:c+i,y:o+l*(r+2*i)+i,width:u,height:r},c+=u+2*i)}e=r+2*i;return{mapping:a,xOffset:c,yOffset:o+l*e,canvasHeight:nextPowOfTwo(o+(l+1)*e)}}function getTextWidth(r,e,i,n){let a=0;for(let t=e;t<i;t++){var s=r[t];let e=null;s=n&&n[s];s&&(e=s.width),a+=e}return a}function breakAll(t,r,i,n,a,s){let o=r,l=0;for(let e=r;e<i;e++){var c=getTextWidth(t,e,e+1,a);l+c>n&&(o<e&&s.push(e),o=e,l=0),l+=c}return l}function breakWord(t,r,i,n,a,s){let o=r,l=r,c=r,h=0;for(let e=r;e<i;e++)if(" "!==t[e]&&" "!==t[e+1]&&e+1!==i||(c=e+1),c>l){let e=getTextWidth(t,l,c,a);h+e>n&&(o<l&&(s.push(l),o=l,h=0),e>n&&(e=breakAll(t,l,c,n,a,s),o=s[s.length-1])),l=c,h+=e}return h}function autoWrapping(e,t,r,i,n=0,a){var s=[];return("break-all"===t?breakAll:breakWord)(e,n,a=void 0===a?e.length:a,r,i,s),s}function transformRow(t,r,i,n,a,e){let s=0,o=0;for(let e=r;e<i;e++){const c=t[e];var l=n[c];l?(o=o||l.height,a[e]=s+l.width/2,s+=l.width):(log$2.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),a[e]=s,s+=MISSING_CHAR_WIDTH)}e[0]=s,e[1]=o}function transformParagraph(t,r,i,n,a){var s=(t=Array.from(t)).length;const o=new Array(s),l=new Array(s),c=new Array(s);var h=("break-word"===i||"break-all"===i)&&isFinite(n)&&0<n;const u=[0,0];var d=[];let p=0,f=0,m=0;for(let e=0;e<=s;e++){var g=t[e];if("\n"!==g&&e!==s||(m=e),m>f){var _=h?autoWrapping(t,i,n,a,f,m):SINGLE_LINE;for(let e=0;e<=_.length;e++){var v=0===e?f:_[e-1],y=e<_.length?_[e]:m;transformRow(t,v,y,a,o,d);for(let e=v;e<y;e++)l[e]=p+d[1]/2,c[e]=d[0];p+=d[1]*r,u[0]=Math.max(u[0],d[0])}f=m}"\n"===g&&(o[f]=0,l[f]=0,c[f]=0,f++)}return u[1]=p,{x:o,y:l,rowWidth:c,size:u}}function getTextFromBuffer({value:t,length:r,stride:e,offset:i,startIndices:n,characterSet:a}){var s=t.BYTES_PER_ELEMENT,o=e?e/s:1,l=i?i/s:0,c=n[r]||Math.ceil((t.length-l)/o),h=a&&new Set;const u=new Array(r);let d=t;if(1<o||0<l){d=new t.constructor(c);for(let e=0;e<c;e++)d[e]=t[e*o+l]}for(let e=0;e<r;e++){var p=n[e],f=n[e+1]||c;const m=d.subarray(p,f);u[e]=String.fromCodePoint.apply(null,m),h&&m.forEach(h.add,h)}if(h)for(const g of h)a.add(String.fromCodePoint(g));return{texts:u,characterCount:c}}class LRUCache{constructor(e=5){this.limit=e,this.clear()}clear(){this._cache={},this._order=[]}get(e){var t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?this.delete(e):Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e)}delete(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}_deleteCache(e){delete this._cache[e]}_deleteOrder(t){var e=this._order.findIndex(e=>e===t);0<=e&&this._order.splice(e,1)}_appendOrder(e){this._order.push(e)}}function getDefaultCharacterSet(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const DEFAULT_CHAR_SET=getDefaultCharacterSet(),DEFAULT_FONT_FAMILY="Monaco, monospace",DEFAULT_FONT_WEIGHT="normal",DEFAULT_FONT_SIZE=64,DEFAULT_BUFFER=4,DEFAULT_CUTOFF=.25,DEFAULT_RADIUS=12,MAX_CANVAS_WIDTH=1024,BASELINE_SCALE=.9,HEIGHT_SCALE=1.2,CACHE_LIMIT=3,cache=new LRUCache(CACHE_LIMIT),VALID_PROPS=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function getNewChars(e,t){e=cache.get(e);if(!e)return t;const r=[];e=e.mapping;let i=Object.keys(e);i=new Set(i);let n=t;return n instanceof Array&&(n=new Set(n)),n.forEach(e=>{i.has(e)||r.push(e)}),r}function populateAlphaChannel(t,r){for(let e=0;e<t.length;e++)r.data[4*e+3]=t[e]}function setTextStyle(e,t,r,i){e.font="".concat(i," ").concat(r,"px ").concat(t),e.fillStyle="#000",e.textBaseline="baseline",e.textAlign="left"}class FontAtlasManager{constructor(){this.props={fontFamily:DEFAULT_FONT_FAMILY,fontWeight:DEFAULT_FONT_WEIGHT,characterSet:DEFAULT_CHAR_SET,fontSize:DEFAULT_FONT_SIZE,buffer:DEFAULT_BUFFER,sdf:!1,cutoff:DEFAULT_CUTOFF,radius:DEFAULT_RADIUS},this._key=null,this._atlas=null}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return HEIGHT_SCALE}setProps(t={}){VALID_PROPS.forEach(e=>{e in t&&(this.props[e]=t[e])});var e=this._key;this._key=this._getKey();var r=getNewChars(this._key,this.props.characterSet),i=cache.get(this._key);i&&0===r.length?this._key!==e&&(this._atlas=i):(i=this._generateFontAtlas(this._key,r,i),this._atlas=i,cache.set(this._key,i))}_generateFontAtlas(e,t,r){var{fontFamily:i,fontWeight:n,fontSize:a,buffer:s,sdf:o,radius:l,cutoff:c}=this.props;let h=r&&r.data;h||(h=document.createElement("canvas"),h.width=MAX_CANVAS_WIDTH);const u=h.getContext("2d");setTextStyle(u,i,a,n);var{mapping:d,canvasHeight:p,xOffset:f,yOffset:m}=buildMapping({getFontWidth:e=>u.measureText(e).width,fontHeight:a*HEIGHT_SCALE,buffer:s,characterSet:t,maxCanvasWidth:MAX_CANVAS_WIDTH,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(h.height!==p&&(r=u.getImageData(0,0,h.width,h.height),h.height=p,u.putImageData(r,0,0)),setTextStyle(u,i,a,n),o){const _=new TinySDF$1(a,s,l,c,i,n);var g=u.getImageData(0,0,_.size,_.size);for(const v of t)populateAlphaChannel(_.draw(v),g),u.putImageData(g,d[v].x-s,d[v].y+s)}else for(const y of t)u.fillText(y,d[y].x,d[y].y+a*BASELINE_SCALE);return{xOffset:f,yOffset:m,mapping:d,data:h,width:h.width,height:h.height}}_getKey(){var{fontFamily:e,fontWeight:t,fontSize:r,buffer:i,sdf:n,radius:a,cutoff:s}=this.props;return n?"".concat(e," ").concat(t," ").concat(r," ").concat(i," ").concat(a," ").concat(s):"".concat(e," ").concat(t," ").concat(r," ").concat(i)}}var vs="#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs="#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n";const defaultProps$2={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class TextBackgroundLayer extends Layer{getShaders(){return super.getShaders({vs:vs,fs:fs,modules:[project32,picking]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:r}){super.updateState({props:e,oldProps:t,changeFlags:r}),r.extensionsChanged&&(t=this.context["gl"],null!==(r=this.state.model)&&void 0!==r&&r.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){var{billboard:t,sizeScale:r,sizeUnits:i,sizeMinPixels:n,sizeMaxPixels:a,getLineWidth:s}=this.props;let o=this.props["padding"];o.length<4&&(o=[o[0],o[1],o[0],o[1]]),this.state.model.setUniforms(e).setUniforms({billboard:t,stroked:Boolean(s),padding:o,sizeUnits:UNIT[i],sizeScale:r,sizeMinPixels:n,sizeMaxPixels:a}).draw()}_getModel(e){return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}TextBackgroundLayer.layerName="TextBackgroundLayer",TextBackgroundLayer.defaultProps=defaultProps$2;const DEFAULT_FONT_SETTINGS={fontSize:DEFAULT_FONT_SIZE,buffer:DEFAULT_BUFFER,sdf:!1,radius:DEFAULT_RADIUS,cutoff:DEFAULT_CUTOFF,smoothing:.1},TEXT_ANCHOR={start:1,middle:0,end:-1},ALIGNMENT_BASELINE={top:1,center:0,bottom:-1},DEFAULT_COLOR=[0,0,0,255],DEFAULT_LINE_HEIGHT=1,FONT_SETTINGS_PROPS=["fontSize","buffer","sdf","radius","cutoff"],defaultProps$1={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:DEFAULT_COLOR},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:DEFAULT_CHAR_SET},fontFamily:DEFAULT_FONT_FAMILY,fontWeight:DEFAULT_FONT_WEIGHT,lineHeight:DEFAULT_LINE_HEIGHT,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:DEFAULT_COLOR},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:DEFAULT_COLOR},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class TextLayer extends CompositeLayer{initializeState(){this.state={styleVersion:0,fontAtlasManager:new FontAtlasManager}}updateState({props:e,oldProps:t,changeFlags:r}){var i=r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText),r=this.state.characterSet;i&&this._updateText();r=r!==this.state.characterSet||this._fontChanged(t,e);r&&this._updateFontAtlas(t,e),!r&&e.lineHeight===t.lineHeight&&e.wordBreak===t.wordBreak&&e.maxWidth===t.maxWidth||this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=0<=e.index?this.props.data[e.index]:null,e}_updateFontAtlas(e,t){var{fontSettings:r,fontFamily:i,fontWeight:t}=t;const{fontAtlasManager:n,characterSet:a}=this.state;n.setProps({...DEFAULT_FONT_SETTINGS,...r,characterSet:a,fontFamily:i,fontWeight:t})}_fontChanged(e,t){if(e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight)return!0;if(e.fontSettings===t.fontSettings)return!1;const r=e.fontSettings||{},i=t.fontSettings||{};return FONT_SETTINGS_PROPS.some(e=>r[e]!==i[e])}_updateText(){var{data:e,characterSet:t}=this.props,r=e.attributes&&e.attributes.getText;let i=this.props["getText"],n=e["startIndices"],a;var s="auto"===t&&new Set;if(r&&n){const{texts:o,characterCount:l}=getTextFromBuffer({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:n,characterSet:s});a=l,i=(e,{index:t})=>o[t]}else{const{iterable:c,objectInfo:h}=createIterable(e);n=[0],a=0;for(const u of c){h.index++;const d=Array.from(i(u,h)||"");s&&d.forEach(s.add,s),a+=d.length,n.push(a)}}this.setState({getText:i,startIndices:n,numInstances:a,characterSet:s||t})}getBoundingRect(e,t){var r=this.state.fontAtlasManager.mapping;const i=this.state["getText"],{wordBreak:n,maxWidth:a,lineHeight:s,getTextAnchor:o,getAlignmentBaseline:l}=this.props;var{size:[c,r]}=transformParagraph(i(e,t)||"",s,n,a,r);return[(TEXT_ANCHOR["function"==typeof o?o(e,t):o]-1)*c/2,(ALIGNMENT_BASELINE["function"==typeof l?l(e,t):l]-1)*r/2,c,r]}getIconOffsets(e,t){var r=this.state.fontAtlasManager.mapping;const i=this.state["getText"],{wordBreak:n,maxWidth:a,lineHeight:s,getTextAnchor:o,getAlignmentBaseline:l}=this.props;var{x:c,y:h,rowWidth:u,size:[d,p]}=transformParagraph(i(e,t)||"",s,n,a,r),f=TEXT_ANCHOR["function"==typeof o?o(e,t):o],m=ALIGNMENT_BASELINE["function"==typeof l?l(e,t):l],g=c.length;const _=new Array(2*g);let v=0;for(let e=0;e<g;e++){var y=(1-f)*(d-u[e])/2;_[v++]=(f-1)*d/2+y+c[e],_[v++]=(m-1)*p/2+h[e]}return _}renderLayers(){var{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:i,texture:n,mapping:a},styleVersion:s}=this.state,{data:o,_dataDiff:l,getPosition:c,getColor:h,getSize:u,getAngle:d,getPixelOffset:p,getBackgroundColor:f,getBorderColor:m,getBorderWidth:g,backgroundPadding:_,background:v,billboard:y,fontSettings:x,outlineWidth:b,outlineColor:w,sizeScale:T,sizeUnits:E,sizeMinPixels:S,sizeMaxPixels:M,transitions:A,updateTriggers:C}=this.props;const L=this.getSubLayerClass("characters",MultiIconLayer),P=this.getSubLayerClass("background",TextBackgroundLayer);return[v&&new P({getFillColor:f,getLineColor:m,getLineWidth:g,padding:_,getPosition:c,getSize:u,getAngle:d,getPixelOffset:p,billboard:y,sizeScale:T/this.state.fontAtlasManager.props.fontSize,sizeUnits:E,sizeMinPixels:S,sizeMaxPixels:M,transitions:A&&{getPosition:A.getPosition,getAngle:A.getAngle,getSize:A.getSize,getFillColor:A.getBackgroundColor,getLineColor:A.getBorderColor,getLineWidth:A.getBorderWidth,getPixelOffset:A.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:C.getPosition,getAngle:C.getAngle,getSize:C.getSize,getFillColor:C.getBackgroundColor,getLineColor:C.getBorderColor,getLineWidth:C.getBorderWidth,getPixelOffset:C.getPixelOffset,getBoundingRect:{getText:C.getText,getTextAnchor:C.getTextAnchor,getAlignmentBaseline:C.getAlignmentBaseline,styleVersion:s}}}),{data:o.attributes?{length:o.length,attributes:o.attributes.background||{}}:o,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect.bind(this)}),new L({sdf:x.sdf,smoothing:(Number.isFinite(x.smoothing)?x:DEFAULT_FONT_SETTINGS).smoothing,outlineWidth:b,outlineColor:w,iconAtlas:n,iconMapping:a,getPosition:c,getColor:h,getSize:u,getAngle:d,getPixelOffset:p,billboard:y,sizeScale:T*i,sizeUnits:E,sizeMinPixels:S*i,sizeMaxPixels:M*i,transitions:A&&{getPosition:A.getPosition,getAngle:A.getAngle,getColor:A.getColor,getSize:A.getSize,getPixelOffset:A.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:C.getText,getPosition:C.getPosition,getAngle:C.getAngle,getColor:C.getColor,getSize:C.getSize,getPixelOffset:C.getPixelOffset,getIconOffsets:{getText:C.getText,getTextAnchor:C.getTextAnchor,getAlignmentBaseline:C.getAlignmentBaseline,styleVersion:s}}}),{data:o,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets.bind(this),getIcon:r})]}}TextLayer.layerName="TextLayer",TextLayer.defaultProps=defaultProps$1;const POINT_LAYER={circle:{type:ScatterplotLayer,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:IconLayer,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:TextLayer,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},LINE_LAYER={type:PathLayer,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},POLYGON_LAYER={type:SolidPolygonLayer,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function getDefaultProps({type:e,props:t}){const r={};for(const i in t)r[i]=e.defaultProps[t[i]];return r}function forwardProps(t,r){var{transitions:i,updateTriggers:n}=t.props;const a={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const o in r){var s=r[o];let e=t.props[o];o.startsWith("get")&&(e=t.getSubLayerAccessor(e),a.updateTriggers[s]=n[o],i&&(a.transitions[s]=i[o])),a[s]=e}return a}function getGeojsonFeatures(e){if(Array.isArray(e))return e;switch(log$2.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return log$2.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function separateGeojsonFeatures(e,r,i={}){var n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:a=e.length}=i;for(let t=i;t<a;t++){var s=e[t];log$2.assert(s&&s.geometry,"GeoJSON does not have geometry");var o=s["geometry"];if("GeometryCollection"===o.type){log$2.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");var l=o["geometries"];for(let e=0;e<l.length;e++)separateGeometry(l[e],n,r,s,t)}else separateGeometry(o,n,r,s,t)}return n}function separateGeometry(e,t,r,i,n){const{type:a,coordinates:s}=e,{pointFeatures:o,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:h}=t;if(validateGeometry(a,s))switch(a){case"Point":o.push(r({geometry:e},i,n));break;case"MultiPoint":s.forEach(e=>{o.push(r({geometry:{type:"Point",coordinates:e}},i,n))});break;case"LineString":l.push(r({geometry:e},i,n));break;case"MultiLineString":s.forEach(e=>{l.push(r({geometry:{type:"LineString",coordinates:e}},i,n))});break;case"Polygon":c.push(r({geometry:e},i,n)),s.forEach(e=>{h.push(r({geometry:{type:"LineString",coordinates:e}},i,n))});break;case"MultiPolygon":s.forEach(e=>{c.push(r({geometry:{type:"Polygon",coordinates:e}},i,n)),e.forEach(e=>{h.push(r({geometry:{type:"LineString",coordinates:e}},i,n))})})}else log$2.warn("".concat(a," coordinates are malformed"))()}const COORDINATE_NEST_LEVEL={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function validateGeometry(e,t){let r=COORDINATE_NEST_LEVEL[e];for(log$2.assert(r,"Unknown GeoJSON type ".concat(e));t&&0<--r;)t=t[0];return t&&Number.isFinite(t[0])}function createEmptyLayerProps(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function getCoordinates(e){return e.geometry.coordinates}function createLayerPropsFromFeatures(e,t){const r=createEmptyLayerProps();var{pointFeatures:i,lineFeatures:n,polygonFeatures:a,polygonOutlineFeatures:e}=e;return r.points.data=i,r.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),r.points.getPosition=getCoordinates,r.lines.data=n,r.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),r.lines.getPath=getCoordinates,r.polygons.data=a,r.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),r.polygons.getPolygon=getCoordinates,r.polygonsOutline.data=e,r.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),r.polygonsOutline.getPath=getCoordinates,r}function createLayerPropsFromBinary(e,t){const r=createEmptyLayerProps();var{points:i,lines:n,polygons:a}=e,t=calculatePickingColors(e,t);return r.points.data={length:i.positions.value.length/i.positions.size,attributes:{getPosition:i.positions,instancePickingColors:{size:3,value:t.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{getPath:n.positions,instancePickingColors:{size:3,value:t.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines._pathType="open",r.polygons.data={length:a.polygonIndices.value.length-1,startIndices:a.polygonIndices.value,attributes:{getPolygon:a.positions,pickingColors:{size:3,value:t.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},r.polygons._normalize=!1,a.triangles&&(r.polygons.data.attributes.indices=a.triangles.value),r.polygonsOutline.data={length:a.primitivePolygonIndices.value.length-1,startIndices:a.primitivePolygonIndices.value,attributes:{getPath:a.positions,instancePickingColors:{size:3,value:t.polygons}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},r.polygonsOutline._pathType="open",r}const defaultProps={...getDefaultProps(POINT_LAYER.circle),...getDefaultProps(POINT_LAYER.icon),...getDefaultProps(POINT_LAYER.text),...getDefaultProps(LINE_LAYER),...getDefaultProps(POLYGON_LAYER),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class GeoJsonLayer extends CompositeLayer{initializeState(){this.state={layerProps:{},features:{}},this.props.getLineDashArray&&log$2.removed("getLineDashArray","PathStyleExtension")()}updateState({props:e,changeFlags:t}){var r;t.dataChanged&&(r=this.props["data"],r=r&&"points"in r&&"polygons"in r&&"lines"in r,this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t}))}_updateStateBinary({props:e}){e=createLayerPropsFromBinary(e.data,this.encodePickingColor);this.setState({layerProps:e})}_updateStateJSON({props:e,changeFlags:t}){var r=getGeojsonFeatures(e.data),i=this.getSubLayerRow.bind(this);let n={};const a={};if(Array.isArray(t.dataChanged)){const o=this.state.features;for(const l in o)n[l]=o[l].slice(),a[l]=[];for(const c of t.dataChanged){var s=separateGeojsonFeatures(r,i,c);for(const h in o)a[h].push(replaceInRange({data:n[h],getIndex:e=>e.__source.index,dataRange:c,replace:s[h]}))}}else n=separateGeojsonFeatures(r,i);t=createLayerPropsFromFeatures(n,a);this.setState({features:n,featuresDiff:a,layerProps:t})}_updateAutoHighlight(e){var t="".concat(this.id,"-points-"),r=e.sourceLayer.id.startsWith(t);for(const i of this.getSubLayers())i.id.startsWith(t)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var{extruded:e,wireframe:t}=this.props,r=this.state["layerProps"],i="polygons-fill";const n=this.shouldRenderSubLayer(i,r.polygons.data)&&this.getSubLayerClass(i,POLYGON_LAYER.type);if(n){const a=forwardProps(this,POLYGON_LAYER.props);t=e&&t;return t||delete a.getLineColor,a.updateTriggers.lineColors=t,new n(a,this.getSubLayerProps({id:i,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var{extruded:e,stroked:t}=this.props,r=this.state["layerProps"],i="polygons-stroke",n="linestrings";const a=!e&&t&&this.shouldRenderSubLayer(i,r.polygonsOutline.data)&&this.getSubLayerClass(i,LINE_LAYER.type),s=this.shouldRenderSubLayer(n,r.lines.data)&&this.getSubLayerClass(n,LINE_LAYER.type);if(a||s){t=forwardProps(this,LINE_LAYER.props);return[a&&new a(t,this.getSubLayerProps({id:i,updateTriggers:t.updateTriggers}),r.polygonsOutline),s&&new s(t,this.getSubLayerProps({id:n,updateTriggers:t.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const e=this.props["pointType"],{layerProps:t,binary:r}=this.state;let i=this.props["highlightedObjectIndex"];!r&&Number.isFinite(i)&&(i=t.points.data.findIndex(e=>e.__source.index===i));const n=[];for(const o of new Set(e.split("+"))){var a="points-".concat(o),s=POINT_LAYER[o];const l=s&&this.shouldRenderSubLayer(a,t.points.data)&&this.getSubLayerClass(a,s.type);l&&(s=forwardProps(this,s.props),n.push(new l(s,this.getSubLayerProps({id:a,updateTriggers:s.updateTriggers,highlightedObjectIndex:i}),t.points)))}return n}renderLayers(){var e=this.props["extruded"],t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(n){var e=this.state["binary"];return e&&"function"==typeof n?(e,t)=>{var{data:r,index:i}=t,i=binaryToFeatureForAccesor(r,i);return n(i,t)}:super.getSubLayerAccessor(n)}}GeoJsonLayer.layerName="GeoJsonLayer",GeoJsonLayer.defaultProps=defaultProps;var earthRadius=6371008.8,factors={meters:earthRadius,metres:earthRadius,millimeters:1e3*earthRadius,millimetres:1e3*earthRadius,centimeters:100*earthRadius,centimetres:100*earthRadius,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,miles:earthRadius/1609.344,nauticalmiles:earthRadius/1852,inches:39.37*earthRadius,yards:earthRadius/1.0936,feet:3.28084*earthRadius,radians:1,degrees:earthRadius/111325};function feature(e,t,r){if(!isObject$2(r=r||{}))throw new Error("options is invalid");var i=r.bbox,n=r.id;if(void 0===e)throw new Error("geometry is required");if(t&&t.constructor!==Object)throw new Error("properties must be an Object");i&&validateBBox(i),n&&validateId(n);r={type:"Feature"};return n&&(r.id=n),i&&(r.bbox=i),r.properties=t||{},r.geometry=e,r}function point(e,t,r){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(e[0])||!isNumber(e[1]))throw new Error("coordinates must contain numbers");return feature({type:"Point",coordinates:e},t,r)}function polygon(e,t,r){if(!e)throw new Error("coordinates is required");for(var i=0;i<e.length;i++){var n=e[i];if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<n[n.length-1].length;a++){if(0===i&&0===a&&!isNumber(n[0][0])||!isNumber(n[0][1]))throw new Error("coordinates must contain numbers");if(n[n.length-1][a]!==n[0][a])throw new Error("First and last Position are not equivalent.")}}return feature({type:"Polygon",coordinates:e},t,r)}function featureCollection(e,t){if(!isObject$2(t=t||{}))throw new Error("options is invalid");var r=t.bbox,i=t.id;if(!e)throw new Error("No features passed");if(!Array.isArray(e))throw new Error("features must be an Array");r&&validateBBox(r),i&&validateId(i);t={type:"FeatureCollection"};return i&&(t.id=i),r&&(t.bbox=r),t.features=e,t}function radiansToLength(e,t){if(null==e)throw new Error("radians is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var r=factors[t||"kilometers"];if(!r)throw new Error(t+" units is invalid");return e*r}function radiansToDegrees(e){if(null==e)throw new Error("radians is required");return 180*(e%(2*Math.PI))/Math.PI}function degreesToRadians(e){if(null==e)throw new Error("degrees is required");return e%360*Math.PI/180}function isNumber(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function isObject$2(e){return!!e&&e.constructor===Object}function validateBBox(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(e){if(!isNumber(e))throw new Error("bbox must only contain numbers")})}function validateId(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}function coordEach(e,t,r){if(null!==e)for(var i,n,a,s=0,o=e.type,l="FeatureCollection"===o,c="Feature"===o,h=l?e.features.length:1,u=0;u<h;u++)for(var d,p,f=(p=!!(d=l?e.features[u].geometry:c?e.geometry:e)&&"GeometryCollection"===d.type)?d.geometries.length:1,m=0;m<f;m++){var g,_=0,v=0;if(null!==(g=p?d.geometries[m]:d)){var y=g.coordinates,x=g.type,b=!r||"Polygon"!==x&&"MultiPolygon"!==x?0:1;switch(x){case null:break;case"Point":if(!1===t(y,s,u,_,v))return!1;s++,_++;break;case"LineString":case"MultiPoint":for(i=0;i<y.length;i++){if(!1===t(y[i],s,u,_,v))return!1;s++,"MultiPoint"===x&&_++}"LineString"===x&&_++;break;case"Polygon":case"MultiLineString":for(i=0;i<y.length;i++){for(n=0;n<y[i].length-b;n++){if(!1===t(y[i][n],s,u,_,v))return!1;s++}"MultiLineString"===x&&_++,"Polygon"===x&&v++}"Polygon"===x&&_++;break;case"MultiPolygon":for(i=0;i<y.length;i++){for("MultiPolygon"===x&&(v=0),n=0;n<y[i].length;n++){for(a=0;a<y[i][n].length-b;a++){if(!1===t(y[i][n][a],s,u,_,v))return!1;s++}v++}_++}break;case"GeometryCollection":for(i=0;i<g.geometries.length;i++)if(!1===coordEach(g.geometries[i],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}function featureEach(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}var mapboxGlAnimatedPopup={exports:{}};mapboxGlAnimatedPopup.exports=function(s){const u={linear(e){return e},easeInQuad(e){return e*e},easeOutQuad(e){return-e*(e-2)},easeInOutQuad(e){if((e/=.5)<1)return.5*e*e;return-.5*(--e*(e-2)-1)},easeInCubic(e){return e*e*e},easeOutCubic(e){return(e-=1)*e*e+1},easeInOutCubic(e){if((e/=.5)<1)return.5*e*e*e;return.5*((e-=2)*e*e+2)},easeInQuart(e){return e*e*e*e},easeOutQuart(e){return-((e-=1)*e*e*e-1)},easeInOutQuart(e){if((e/=.5)<1)return.5*e*e*e*e;return-.5*((e-=2)*e*e*e-2)},easeInQuint(e){return e*e*e*e*e},easeOutQuint(e){return(e-=1)*e*e*e*e+1},easeInOutQuint(e){if((e/=.5)<1)return.5*e*e*e*e*e;return.5*((e-=2)*e*e*e*e+2)},easeInSine(e){return-Math.cos(e*(Math.PI/2))+1},easeOutSine(e){return Math.sin(e*(Math.PI/2))},easeInOutSine(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInExpo(e){return e===0?0:Math.pow(2,10*(e-1))},easeOutExpo(e){return e===1?1:-Math.pow(2,-10*e)+1},easeInOutExpo(e){if(e===0)return 0;if(e===1)return 1;if((e/=.5)<1)return.5*Math.pow(2,10*(e-1));return.5*(-Math.pow(2,-10*--e)+2)},easeInCirc(e){if(e>=1)return e;return-(Math.sqrt(1-e*e)-1)},easeOutCirc(e){return Math.sqrt(1-(e-=1)*e)},easeInOutCirc(e){if((e/=.5)<1)return-.5*(Math.sqrt(1-e*e)-1);return.5*(Math.sqrt(1-(e-=2)*e)+1)},easeInElastic(e){let t=1.70158;let r=0;let i=1;if(e===0)return 0;if(e===1)return 1;if(!r)r=.3;t=r/(2*Math.PI)*Math.asin(1/i);return-(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r))},easeOutElastic(e){let t=1.70158;let r=0;let i=1;if(e===0)return 0;if(e===1)return 1;if(!r)r=.3;t=r/(2*Math.PI)*Math.asin(1/i);return i*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/r)+1},easeInOutElastic(e){let t=1.70158;let r=0;let i=1;if(e===0)return 0;if((e/=.5)===2)return 1;if(!r)r=.45;t=r/(2*Math.PI)*Math.asin(1/i);if(e<1)return-.5*(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r));return i*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)*.5+1},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;if((e/=.5)<1)return.5*(e*e*(((t*=1.525)+1)*e-t));return.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce(e){return 1-u.easeOutBounce(1-e)},easeOutBounce(e){if(e<1/2.75)return 7.5625*e*e;if(e<2/2.75)return 7.5625*(e-=1.5/2.75)*e+.75;if(e<2.5/2.75)return 7.5625*(e-=2.25/2.75)*e+.9375;return 7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce(e){if(e<.5)return u.easeInBounce(e*2)*.5;return u.easeOutBounce(e*2-1)*.5+.5}};function o(i,n,a,s,o){let l;const c=performance.now();const h=()=>{if(l)return;const e=performance.now()-c;const t=a===0?1:Math.min(e/a,1);const r=u[n](t);i.transform=`scale(${s?1-r:r})`;if(t<1)requestAnimationFrame(h);else if(o)o()};h();return()=>{l=true}}function n(e,...t){for(const r of t)for(const i in r)if(typeof r[i]==="object"){if(!e[i])e[i]={};n(e[i],r[i])}else e[i]=r[i];return e}function l(e){for(const t of e.values()){const r=t.match(/mapboxgl-popup-anchor-(.+)/);if(r)return r[1].replace("-"," ")}}const t={openingAnimation:{duration:1e3,easing:"easeOutElastic"},closingAnimation:{duration:300,easing:"easeInBack"}};class e extends s.Popup{constructor(e){super(e);n(this.options,n({},t,e))}addTo(...e){if(this._map)this._remove();return super.addTo(...e)}_remove(){const e=this._wrapperContainer;if(this._cancelAnimation)this._cancelAnimation();if(e&&e.parentNode){e.parentNode.removeChild(e);delete this._wrapperContainer}super.remove()}remove(){if(this._wrapperContainer){const{easing:e,duration:t}=this.options.closingAnimation;if(this._cancelAnimation)this._cancelAnimation();this._cancelAnimation=o(this._container.style,e,t,true,()=>{this._remove()})}else super.remove();return this}_update(...e){const t=this._lngLat||this._trackPointer;if(!this._map||!t||!this._content)return;const r=this._map._requestDomTask;let i=this._wrapperContainer;let n=this._container;let a;Object.defineProperty(this,"_container",{configurable:true,get:()=>n,set:e=>{const{easing:t,duration:r}=this.options.openingAnimation;i=this._wrapperContainer=document.createElement("div");i.className="mapboxgl-popup-wrapper";i.style.position="absolute";i.style.willChange="transform";i.style.pointerEvents="none";n=e;n.style.position="relative";this._map.getContainer().appendChild(i);i.appendChild(n);this._cancelAnimation=o(n.style,t,r)}});if(s.version>="2.3")this._map._requestDomTask=e=>{r.call(this._map,()=>{a=n?n.style.transform:"scale(0)";e();i.style.transform=n.style.transform;n.style.transform=a;n.style.transformOrigin=l(n.classList)})};else a=n?n.style.transform:"scale(0)";super._update(...e);delete this._container;this._container=n;if(s.version>="2.3")this._map._requestDomTask=r;else{i.style.transform=n.style.transform;n.style.transform=a;n.style.transformOrigin=l(n.classList)}}}return e}(mapboxGl$1.exports);var Popup=mapboxGlAnimatedPopup.exports,suncalc={exports:{}};!function(e){!function(){var m=Math.PI,o=Math.sin,l=Math.cos,s=Math.tan,i=Math.asin,c=Math.atan2,h=Math.acos,y=m/180,r=864e5,t=2440588;function g(e){return new Date((e+.5-t)*r)}function _(e){return e.valueOf()/r-.5+t-2451545}var n=23.4397*y;function a(e,t){return c(o(e)*l(n)-s(t)*o(n),l(e))}function v(e,t){return i(o(t)*l(n)+l(t)*o(n)*o(e))}function u(e,t,r){return c(o(e),l(e)*o(t)-s(r)*l(t))}function d(e,t,r){return i(o(t)*o(r)+l(t)*l(r)*l(e))}function p(e,t){return y*(280.16+360.9856235*e)-t}function x(e){return y*(357.5291+.98560028*e)}function b(e){return e+y*(1.9148*o(e)+.02*o(2*e)+3e-4*o(3*e))+102.9372*y+m}function f(e){e=b(x(e));return{dec:v(e,0),ra:a(e,0)}}var w={getPosition:function(e,t,r){var i=y*-r,r=y*t,t=_(e),e=f(t),i=p(t,i)-e.ra;return{azimuth:u(i,r,e.dec),altitude:d(i,r,e.dec)}}},T=w.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];w.addTime=function(e,t,r){T.push([e,t,r])};function E(e,t,r){return 9e-4+(e+t)/(2*m)+r}function S(e,t,r){return 2451545+e+.0053*o(t)-.0069*o(2*r)}function M(e,t,r,i,n,a,s){return S(E((r=r,i=i,h((o(e)-o(r)*o(i))/(l(r)*l(i)))),t,n),a,s)}function A(e){var t=y*(134.963+13.064993*e),r=y*(93.272+13.22935*e),e=y*(218.316+13.176396*e)+6.289*y*o(t),r=5.128*y*o(r),t=385001-20905*l(t);return{ra:a(e,r),dec:v(e,r),dist:t}}function C(e,t){return new Date(e.valueOf()+t*r/24)}w.getTimes=function(e,t,r){for(var i,n,a=y*-r,s=y*t,e=_(e),o=Math.round(e-9e-4-a/(2*m)),e=E(0,a,o),l=x(e),c=b(l),h=v(c,0),u=S(e,l,c),d={solarNoon:g(u),nadir:g(u-.5)},p=0,f=T.length;p<f;p+=1)n=M((i=T[p])[0]*y,a,s,h,o,l,c),d[i[1]]=g(u-(n-u)),d[i[2]]=g(n);return d},w.getMoonPosition=function(e,t,r){var i=y*-r,n=y*t,a=_(e),r=A(a),t=p(a,i)-r.ra,e=d(t,n,r.dec),a=c(o(t),s(n)*l(r.dec)-o(r.dec)*l(t));return e+=((i=e)<0&&(i=0),2967e-7/Math.tan(i+.00312536/(i+.08901179))),{azimuth:u(t,n,r.dec),altitude:e,distance:r.dist,parallacticAngle:a}},w.getMoonIllumination=function(e){var t=_(e||new Date),r=f(t),e=A(t),t=h(o(r.dec)*o(e.dec)+l(r.dec)*l(e.dec)*l(r.ra-e.ra)),t=c(149598e3*o(t),e.dist-149598e3*l(t)),e=c(l(r.dec)*o(r.ra-e.ra),o(r.dec)*l(e.dec)-l(r.dec)*o(e.dec)*l(r.ra-e.ra));return{fraction:(1+l(t))/2,phase:.5+.5*t*(e<0?-1:1)/Math.PI,angle:e}},w.getMoonTimes=function(e,t,r,i){var n=new Date(e);i?n.setUTCHours(0,0,0,0):n.setHours(0,0,0,0);for(var a,s,o,l,c,h,u,d,p,f,m,g=.133*y,_=w.getMoonPosition(n,t,r).altitude-g,v=1;v<=24&&(d=w.getMoonPosition(C(n,v),t,r).altitude-g,u=((l=(_+(a=w.getMoonPosition(C(n,v+1),t,r).altitude-g))/2-d)*(h=-(c=(a-_)/2)/(2*l))+c)*h+d,(p=0)<=(d=c*c-4*l*d)&&(f=h-(m=Math.sqrt(d)/(2*Math.abs(l))),m=h+m,Math.abs(f)<=1&&p++,Math.abs(m)<=1&&p++,f<-1&&(f=m)),1===p?_<0?s=v+f:o=v+f:2===p&&(s=v+(u<0?m:f),o=v+(u<0?f:m)),!s||!o);v+=2)_=a;i={};return s&&(i.rise=C(n,s)),o&&(i.set=C(n,o)),s||o||(i[0<u?"alwaysUp":"alwaysDown"]=!0),i},e.exports=w}()}(suncalc);var SunCalc=suncalc.exports;function repeat(){var t=animation.instances,r=Object.keys(t),i=r.length,n=performance.now();for(let e=0;e<i;e++){const s=r[e],o=t[s];if(o){var a=o.nextFrame;if(!(n<a)){const{clock:l,callback:c,duration:h}=o,u=l?l.getHighResTime():n,d=o.start=o.start||u,p=u-d;if(c&&c(Math.min(p,h),h),o.nextFrame=Math.max((a||0)+1e3/(o.frameRate||120),n),h<=p){const f=o.complete;f&&f(),animation.stop(s)}}}}requestAnimationFrame(repeat)}const animation={instances:{},count:0,initialized:!1,init(){animation.initialized||(animation.initialized=!0,repeat())},isActive(e){return e in animation.instances},start(e){return e.duration=valueOrDefault(e.duration,1/0),animation.instances[animation.count]=e,animation.count++},stop(e){const t=animation.instances;t[e]&&delete t[e]},setFrameRate(e,t){const r=animation.instances[e];r&&(0<t&&t<60?r.frameRate=t:delete r.frameRate)}},configs={standingDuration:6e4,minStandingDuration:3e4,trainRefreshInterval:6e4,refreshTimeout:1e4,realtimeTrainCheckInterval:15e3,maxSpeedKMPH:80,accelerationKMPHPS:3,get maxSpeed(){return configs.maxSpeedKMPH/36e5},get acceleration(){return configs.accelerationKMPHPS/36e8},get maxAccelerationTime(){return configs.maxSpeed/configs.acceleration},get maxAccDistance(){return configs.maxAccelerationTime*configs.maxSpeed/2},maxFlightSpeedKMPH:500,flightAccelerationKMPHPS:12,get maxFlightSpeed(){return configs.maxFlightSpeedKMPH/36e5},get flightAcceleration(){return configs.flightAccelerationKMPHPS/36e8},minDelay:25e3,minFlightInterval:9e4,transitionDuration:300,fadeDuration:1e3,defaultCenter:[139.767,35.6814],defaultZoom:14,defaultBearing:0,defaultPitch:60,defaultEcoFrameRate:1,defaultViewMode:"ground",defaultTrackingMode:"helicopter",defaultClockMode:"realtime",defaultEcoMode:"normal",apiUrl:{tokyochallenge:"https://api-tokyochallenge.odpt.org/api/v4/",odpt:"https://api.odpt.org/api/v4/"},tidUrl:"https://mini-tokyo.appspot.com/tid",atisUrl:"https://mini-tokyo.appspot.com/atisinfo",dataUrl:"https://minitokyo3d.com/data",searchUrl:"https://search.minitokyo3d.com/api/v1/routes",lastStaticUpdate:"2021-11-20 20:00:00",customAttribution:'<a href="https://github.com/nagix/mini-tokyo-3d"> Akihiko Kusanagi</a>',copyright:" 2019-2021 Akihiko Kusanagi",shareUrl:"https://minitokyo3d.com",events:["boxzoomcancel","boxzoomend","boxzoomstart","click","contextmenu","dblclick","drag","dragend","dragstart","error","load","mousedown","mousemove","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","resize","rotate","rotateend","rotatestart","touchcancel","touchend","touchmove","touchstart","wheel","zoom","zoomend","zoomstart"]},isWindows=includes(navigator.userAgent,"Windows");class Panel{constructor(e){this._options=Object.assign({modal:!1},e)}setTitle(e){const t=this._container;return this._title=e,t&&(t.querySelector("#panel-title").innerHTML=e),this}setHTML(e){const t=this._container;return this._html=e,t&&(t.querySelector("#panel-content").innerHTML=e),this}setButtons(e){const t=this._container;if(this._buttons=e,t){const r=t.querySelector("#panel-button-group"),i=r["children"];for(let e=i.length-1;0<e;e--)r.removeChild(i[e]);for(const n of e||[])r.appendChild(n)}return this}addTo(e){const t=this,r=t._options;if(t._map=e,r.modal){const n=t._background=createElement("div",{className:"modal-panel-background closed"},e.container);n.addEventListener("click",()=>{t.remove()})}const i=t._container=createElement("div",{className:`panel closed ${r.className||""}`,innerHTML:`
<div id="panel-header">
    <div id="panel-title"></div>
    <div id="panel-button-group" class="panel-button-group">
        <div id="panel-button" class="${r.modal?"close-button":"slide-button"}"></div>
    </div>
</div>
<div id="panel-body"${isWindows?' class="windows"':""}>
    <div id="panel-content"></div>
</div>`},e.container);return t._title&&t.setTitle(t._title),t._html&&t.setHTML(t._html),t._buttons&&t.setButtons(t._buttons),r.modal?i.querySelector("#panel-button").addEventListener("click",()=>{t.remove()}):(i.querySelector("#panel-header").addEventListener("click",()=>{const e=i["classList"];e.contains("collapsed")?e.remove("collapsed"):e.add("collapsed")}),i.querySelector("#panel-header").style.cursor="pointer"),requestAnimationFrame(()=>{r.modal&&(t._background.classList.remove("closed"),i.style.height=`min(calc(100% - 10px), ${i.querySelector("#panel-content").offsetHeight+50}px)`),i.classList.remove("closed")}),t}remove(){const e=this,t=e._options,r=e._background,i=e._container;t.modal&&r.classList.add("closed"),i.style.removeProperty("height"),i.classList.add("closed"),setTimeout(()=>{t.modal&&(r.parentNode.removeChild(r),delete e._background),i.parentNode.removeChild(i),delete e._container,delete e._map},300)}isOpen(){return!!this._map}}class AboutPanel extends Panel{constructor(e){super(Object.assign({className:"about-panel",modal:!0},e))}addTo(e){return super.addTo(e).setTitle(e.dict.about).updateContent()}updateContent(){if(this.isOpen()){const{dict:e,lastDynamicUpdate:t}=this._map,{copyright:r,lastStaticUpdate:i}=configs;this.setHTML([e.description.replace(/<h3>.*<\/h3>/,""),`<p>${r}</p>`,`<div class="card-title">${e["static-update"]}</div>`,`<div class="card-body">${i}</div>`,`<div class="card-title">${e["dynamic-update"]}</div>`,'<div class="card-body">',t["JR-East"]||"N/A",` (${e["jr-east"]})<br>`,t.TokyoMetro||"N/A",` (${e["tokyo-metro"]})<br>`,t.Toei||"N/A",` (${e.toei})<br>`,t["HND-JAT"]||"N/A",` (${e["hnd-jat"]})<br>`,t["HND-TIAT"]||"N/A",` (${e["hnd-tiat"]})<br>`,t.NAA||"N/A",` (${e.naa})</div>`].join(""))}return this}}var japaneseHolidays$1={exports:{}};!function(f){!function(){var r,i=function(e,t,r,i,n,a,s,o){var l=new Date(2e3,0,1);return l.setTime(e.getTime()+1e3*(60*(60*(24*(null!=i?i:0)+(null!=n?n:0))+(null!=a?a:0))+(null!=s?s:0))+(null!=o?o:0)),l.setFullYear(l.getFullYear()+(null!=t?t:0)+Math.floor((l.getMonth()+(null!=r?r:0))/12)),l.setMonth(((l.getMonth()+(null!=r?r:0))%12+12)%12),l},t=function(e){return i(e,0,0,0,9)},n=function(e){return i(e,0,0,0,-9)},a=function(e,t,r){return new Date(Date.UTC(e,t,r))},g=function(e,t,r){return n(a(e,t,r))},s=function(e){return t(e).getUTCDay()},_=function(e){return t(e).getUTCDate()},v=function(e){return t(e).getUTCMonth()},o=function(e){return t(e).getUTCFullYear()},e=function(e){return t(e).getUTCHours()},l=function(e){return t(e).getUTCMinutes()},c=function(t,r){return function(e){return g(e,t-1,r)}},h=function(t,r){return function(e){e=g(e,t-1,1);return i(e,0,0,(7-(s(e)-1))%7+7*(r-1))}},u=function(e){return new Date(31556940400*(e-1949)-6558667e5)},d=function(e){var t;return(t={1603:23,2074:23,2355:23,2384:22}[e])?g(e,8,t):new Date(3155691e4*(e-1948)-67131691e4)},y=[["",c(1,1),1949],["",c(1,15),1949,1999],["",h(1,2),2e3],["",c(2,11),1967],["",c(2,23),2020],["",c(2,24),1989,1989],["",function(e){var t=u(e);return g(e,v(t),_(t))},1949],["",c(4,10),1959,1959],["",c(4,29),1949,1988],["",c(4,29),1989,2006],["",c(4,29),2007],["",c(5,1),2019,2019],["",c(5,3),1949],["",c(5,4),2007],["",c(5,5),1949],["",c(6,9),1993,1993],["",c(7,20),1996,2002],["",h(7,3),2003,2019],["",c(7,23),2020,2020],["",c(7,22),2021,2021],["",h(7,3),2022],["",c(8,11),2016,2019],["",c(8,10),2020,2020],["",c(8,8),2021,2021],["",c(8,11),2022],["",c(9,15),1966,2002],["",h(9,3),2003],["",function(e){var t=d(e);return g(e,v(t),_(t))},1948],["",c(10,10),1966,1999],["",h(10,2),2e3,2019],["",c(7,24),2020,2020],["",c(7,23),2021,2021],["",h(10,2),2022],["",c(10,22),2019,2019],["",c(11,3),1948],["",c(11,12),1990,1990],["",c(11,23),1948],["",c(12,23),1989,2018]],x=function(e){var t;if(e<g(1973,3,29)||0!==s(e))return null;if(t=i(e,0,0,1),!r(t,!1))return t;if(e<g(2007,0,1))return null;for(;;)if(t=i(t,0,0,1),!r(t,!1))return t},b=function(e){return!(o(e)<1988)&&r(i(e,0,0,2),!1)?(e=i(e,0,0,1),r(e,!1)||0===s(e)||1===s(e)?null:e):null},w={true:{},false:{}},p=function(e,t){var r,i,n,a,s,o,l,c,h,u,d,p,f,m;if(null!=(r=w[t=!(null!=t&&!t)][e]))return r;for(m={},s=0,c=y.length;s<c;s++)null!=(n=y[s])[2]&&e<n[2]||null!=n[3]&&n[3]<e||null!=(a=n[1](e))&&(m[[u=v(a)+1,i=_(a)]]=n[0]);for(d in w[!(l=[])][e]=m)d=d.split(","),null!=(a=b(g(e,d[0]-1,d[1])))&&(u=v(a)+1,i=_(a),l.push([u,i]));for(o=0,h=l.length;o<h;o++)m[a=l[o]]="";for(d in f={},m)p=m[d],f[d]=p,d=d.split(","),null!=(a=x(g(e,d[0]-1,d[1])))&&(f[[u=v(a)+1,i=_(a)]]="");return w[!0][e]=f,w[t][e]},c=null!=(c=null!==f?f.exports:void 0)?c:this.JapaneseHolidays={};c.getHolidaysOf=function(e,t){var r,i,n=[],a=p(e,t);for(r in a)i=a[r],n.push({month:parseInt(r.split(",")[0]),date:parseInt(r.split(",")[1]),name:i});return n.sort(function(e,t){return e.month-t.month||e.date-t.date}),n},r=function(e,t){return p(o(e),t)[[v(e)+1,_(e)]]},c.isHoliday=function(e,t){return p(e.getFullYear(),t)[[e.getMonth()+1,e.getDate()]]},c.isHolidayAt=r,c.shiftDate=i,c.u2j=t,c.j2u=n,c.jDate=g,c.uDate=a,c.getJDay=s,c.getJDate=_,c.getJMonth=v,c.getJFullYear=o,c.getJHours=e,c.getJMinutes=l,c.__forTest={shunbunWithTime:u,shubunWithTime:d}}.call(commonjsGlobal)}(japaneseHolidays$1);var JapaneseHolidays=japaneseHolidays$1.exports,japaneseHolidays=JapaneseHolidays;class Clock$1{constructor(e,t){this.reset(),this.setDate(e),this.setSpeed(t)}reset(){this.baseTime=0,this.baseHighResTime=0,this.speed=1}setSpeed(e){isNaN(e)||(this.baseTime=this.getTime()-Date.now()*e,this.baseHighResTime=this.getHighResTime()-performance.now()*e,this.speed=e)}setDate(e){var t,r;e instanceof Date&&(t=this.baseTime,r=-this.getTimezoneOffset(),this.baseTime=e.getTime()+r-Date.now()*this.speed,this.baseHighResTime+=this.baseTime-t)}getJSTDate(e){var t=this.getTimezoneOffset();return new Date(valueOrDefault(e,this.getTime())+t)}getTime(e){if(e){const t=this.getJSTDate(),r=e.split(":"),i=+r[0],n=+r[1],a=-this.getTimezoneOffset()+864e5*((t.getHours()<3?-1:0)+(i<3?1:0));return t.setHours(i,n,0,0)+a+configs.minDelay}return this.baseTime+Date.now()*this.speed}getTimeString(e){const t=this.getJSTDate(e),r=`0${t.getHours()}`.slice(-2),i=`'0${t.getMinutes()}`.slice(-2);return`${r}:${i}`}getHighResTime(){return this.baseHighResTime+performance.now()*this.speed}getTimezoneOffset(){return 6e4*((new Date).getTimezoneOffset()+540)}getCalendar(){const e=this.getJSTDate(),t=e.getHours();return t<3&&e.setHours(t-24),0===e.getDay()||japaneseHolidays.isHoliday(e)||2020===e.getFullYear()&&11===e.getMonth()&&30<=e.getDate()||2021===e.getFullYear()&&0===e.getMonth()&&e.getDate()<=3?"Holiday":6===e.getDay()?"Saturday":"Weekday"}}const DATE_FORMAT={year:"numeric",month:"short",day:"numeric",weekday:"short"},DATE_COMPONENTS=[{id:"year",fn:"FullYear",digits:4,extra:0},{id:"month",fn:"Month",digits:2,extra:1},{id:"day",fn:"Date",digits:2,extra:0},{id:"hour",fn:"Hours",digits:2,extra:0},{id:"minute",fn:"Minutes",digits:2,extra:0},{id:"second",fn:"Seconds",digits:2,extra:0}];class ClockControl extends mapboxGl$1.exports.Evented{constructor(e){super();var{lang:t,dict:r,clock:i,mode:e}=e;this._lang=t,this._dict=r,this._clock=i,this._mode=e||"realtime"}getDefaultPosition(){return"top-left"}onAdd(e){const t=this;t._map=e,t._container=createElement("div",{className:"clock-ctrl"}),t._update();const r=()=>{var e=t._clock.getTime();Math.floor(e/1e3)!==Math.floor(t._lastRefresh/1e3)&&(t._refresh(),t._lastRefresh=e),t._container&&requestAnimationFrame(r)};return r(),t._container}onRemove(){this._container.parentNode.removeChild(this._container),this._container=void 0,this._map=void 0}setMode(e){this._mode=e,delete this._tempDate,this._editing=!1,this._update()}_onChange(){this.fire({type:"change",clock:this._clock})}_update(){const r=this,i=r._container,t=r._dict,n=r._clock,e=r._mode;i.innerHTML=["realtime"!==e&&r._editing?"":'<span id="date"></span><br><span id="time"></span><br>',"playback"!==e||r._editing?"":['<div class="clock-button">',`<span><button id="edit-time-button">${t["edit-date-time"]}</button></span>`,"</div>"].join(""),"playback"===e&&r._editing?['<div class="clock-controller">',DATE_COMPONENTS.slice(0,3).map(({id:e})=>['<span class="spin-box">',`<div><button id="${e}-increase-button" class="top-button"><span class="increase-icon"></span></button></div>`,`<div id="${e}"></div>`,`<div><button id="${e}-decrease-button" class="bottom-button"><span class="decrease-icon"></span></button></div>`,"</span>"].join("")).join('<span class="clock-controller-separator">-</span>'),'<span class="clock-controller-separator"></span>',DATE_COMPONENTS.slice(-3).map(({id:e})=>['<span class="spin-box">',`<div><button id="${e}-increase-button" class="top-button"><span class="increase-icon"></span></button></div>`,`<div id="${e}"></div>`,`<div><button id="${e}-decrease-button" class="bottom-button"><span class="decrease-icon"></span></button></div>`,"</span>"].join("")).join('<span class="clock-controller-separator">:</span>'),"</div>",'<div class="clock-button">',`<span><button id="edit-time-cancel-button">${t.cancel}</button></span>`,'<span class="clock-controller-separator"></span>',`<span><button id="edit-time-ok-button" disabled>${t.ok}</button></span>`,"</div>"].join(""):"","playback"===e?['<div class="speed-controller">','<span><button id="speed-decrease-button" class="left-button"',1===n.speed?" disabled":"",'><span class="decrease-icon"></span></button></span>',`<span id="clock-speed">${n.speed}${t["x-speed"]}</span>`,'<span><button id="speed-increase-button" class="right-button"',600===n.speed?" disabled":"",'><span class="increase-icon"></span></button></span>',"</div>"].join(""):""].join(""),r._refresh(),"playback"===e&&r._editing&&(i.querySelector("#edit-time-cancel-button").addEventListener("click",()=>{delete r._tempDate,r._editing=!1,r._update()}),i.querySelector("#edit-time-ok-button").addEventListener("click",()=>{r._tempDate&&(n.setDate(r._tempDate),r._onChange(),delete r._tempDate),r._editing=!1,r._update()})),"playback"!==e||r._editing||i.querySelector("#edit-time-button").addEventListener("click",()=>{r._editing=!0,r._update()}),"playback"===e&&r._editing&&DATE_COMPONENTS.forEach(({id:e,fn:t})=>{i.querySelector(`#${e}-increase-button`).addEventListener("click",()=>{r._tempDate=r._tempDate||n.getJSTDate(),r._tempDate[`set${t}`](r._tempDate[`get${t}`]()+1),r._refresh()}),i.querySelector(`#${e}-decrease-button`).addEventListener("click",()=>{r._tempDate=r._tempDate||n.getJSTDate(),r._tempDate[`set${t}`](r._tempDate[`get${t}`]()-1),r._refresh()})}),"playback"===e&&(i.querySelector("#speed-increase-button").addEventListener("click",function(){let e=n["speed"];e+=e<10?1:e<100?10:100,n.setSpeed(e),this.disabled=600===e,i.querySelector("#speed-decrease-button").disabled=!1,i.querySelector("#clock-speed").innerHTML=e+t["x-speed"]}),i.querySelector("#speed-decrease-button").addEventListener("click",function(){let e=n["speed"];e-=e<=10?1:e<=100?10:100,n.setSpeed(e),this.disabled=1===e,i.querySelector("#speed-increase-button").disabled=!1,i.querySelector("#clock-speed").innerHTML=e+t["x-speed"]}))}_refresh(){const e=this._lang,n=this._container;let a=this._clock.getJSTDate(),t=a.toLocaleDateString(e,DATE_FORMAT);"ja"===e&&japaneseHolidays.isHoliday(a)&&(t=t.replace(/\(.+\)/,"()")),this._editing?(this._tempDate&&(a=this._tempDate,DATE_COMPONENTS.forEach(({id:e})=>{n.querySelector(`#${e}`).classList.add("desc-caution")}),n.querySelector("#edit-time-ok-button").disabled=!1),DATE_COMPONENTS.forEach(({id:e,fn:t,digits:r,extra:i})=>{n.querySelector(`#${e}`).innerHTML=`0${a[`get${t}`]()+i}`.slice(-r)})):(n.querySelector("#date").innerHTML=t,n.querySelector("#time").innerHTML=a.toLocaleTimeString(e))}}const h=["DH3dOGRdHSoiBG4owfJdJdi9","WORdRGddL8k3W79eW77dLCkfW5dcHWNcQhlcSmoceqVcUSo4WOdcUmodWPtdSCkqe3pcIa4AWOnykxFdQu/dGmooBuxcQmo6DHVcP8oOiCkDmMZdHLz+W6zmW7VdO8oqWQjkxH4","WOpcGCo9WQm","W7CJk8oRW4hdMmoMWRTeWQNdJKH3w8ktWPqmWOBdQSoZoSksWQnFtCoUWPruxmo/WPO4zmkjW6erkmkyWQBcJmowstW4hSo1WRxdGg1AWPDsnH/cPCk0WQGLCSoYW59YoCoO","pmoOpvlcGCk6W7qimMz8","cxVdJuZcH8o4WQLUW7u3nIFcUsODkYxdLSkklSkrW7ddI0aLW54RySk/W7S3W5NdPSkEbGmSW7qOWOSQgMJdOq1+WO7dQSoHWRBcKCkQmmkqDKxcMqBdISo+DHJcUmkfumoEnctdPtNdJexdQmoKgSkWuSozWPBdVJNcS8obWO9gCW","WRz+lCo6WPhcMmkG"];function x(a,e){return(x=function(e,t){e=+e;let r=h[e];void 0===x.tAfBcJ&&(x.OIZsEe=function(t,e){let r=[],i=0,n,a="";t=function(n){let a="",r="";for(let e=0,t,r,i=0;r=n.charAt(i++);~r&&(t=e%4?64*t+r:r,e++%4)&&(a+=String.fromCharCode(255&t>>(-2*e&6))))r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(let e=0,t=a.length;e<t;e++)r+="%"+("00"+a.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(r)}(t);let s;for(s=0;s<256;s++)r[s]=s;for(s=0;s<256;s++)i=(i+r[s]+e.charCodeAt(s%e.length))%256,n=r[s],r[s]=r[i],r[i]=n;s=0;for(let e=i=0;e<t.length;e++)s=(s+1)%256,i=(i+r[s])%256,n=r[s],r[s]=r[i],r[i]=n,a+=String.fromCharCode(t.charCodeAt(e)^r[(r[s]+r[i])%256]);return a},a=arguments,x.tAfBcJ=!0);var i=h[0],n=e+i,i=a[n];return i?r=i:(void 0===x.UelmbE&&(x.UelmbE=!0),r=x.OIZsEe(r,t),a[n]=r),r})(a,e)}function extend$3(e,...t){const r=x,i={};i[r(0,"uLoe")]=r(1,"Ty9K"),i[r(2,"0mZc")]=r(3,"7q)S");const n={};n[r(4,"y^OB")]=r(5,")^at"),n[r(6,"7q)S")]=i;for(const a of[n,...t])for(const s in a)e[s]=a[s];return e}function getViewport(e,t){var r=t.getCenter();return new WebMercatorViewport({x:0,y:0,width:e.width,height:e.height,longitude:r.lng,latitude:r.lat,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),nearZMultiplier:.02,farZMultiplier:2})}function pickObject(e,t,r){const i=e.__deck,{deckPicker:n,viewManager:a}=i;if(n){var s=a._viewports,{x:o,y:r}=r;a._viewports=[getViewport(i,e)];t=i.pickObject({x:o,y:r,layerIds:[t]});return a._viewports=s,t?t.object:void 0}}function getCoord(e){if(!e)throw new Error("coord is required");if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates;if(Array.isArray(e)&&2<=e.length&&void 0===e[0].length&&void 0===e[1].length)return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function getCoords(e){if(!e)throw new Error("coords is required");if("Feature"===e.type&&null!==e.geometry)return e.geometry.coordinates;if(e.coordinates)return e.coordinates;if(Array.isArray(e))return e;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function getType(e,t){if(!e)throw new Error((t||"geojson")+" is required");if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error((t||"geojson")+" is invalid")}function bearing(e,t,r){if(!isObject$2(r=r||{}))throw new Error("options is invalid");if(!0===r.final)return calculateFinalBearing(e,t);var i=getCoord(e),n=getCoord(t),r=degreesToRadians(i[0]),e=degreesToRadians(n[0]),t=degreesToRadians(i[1]),i=degreesToRadians(n[1]),n=Math.sin(e-r)*Math.cos(i),r=Math.cos(t)*Math.sin(i)-Math.sin(t)*Math.cos(i)*Math.cos(e-r);return radiansToDegrees(Math.atan2(n,r))}function calculateFinalBearing(e,t){return(bearing(t,e)+180)%360}var concaveman$2={exports:{}};function quickselect(e,t,r,i,n){quickselectStep(e,t,r||0,i||e.length-1,n||defaultCompare$1)}function quickselectStep(e,t,r,i,n){for(;r<i;){var a,s,o,l;600<i-r&&(a=i-r+1,s=t-r+1,l=Math.log(a),o=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*o*(a-o)/a)*(s-a/2<0?-1:1),quickselectStep(e,t,Math.max(r,Math.floor(t-s*o/a+l)),Math.min(i,Math.floor(t+(a-s)*o/a+l)),n));var c=e[t],h=r,u=i;for(swap(e,r,t),0<n(e[i],c)&&swap(e,r,i);h<u;){for(swap(e,h,u),h++,u--;n(e[h],c)<0;)h++;for(;0<n(e[u],c);)u--}0===n(e[r],c)?swap(e,r,u):swap(e,++u,i),u<=t&&(r=u+1),t<=u&&(i=u-1)}}function swap(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function defaultCompare$1(e,t){return e<t?-1:t<e?1:0}class RBush$1{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let r=this.data;const i=[];if(!intersects$2(t,r))return i;const n=this.toBBox,a=[];for(;r;){for(let e=0;e<r.children.length;e++){var s=r.children[e],o=r.leaf?n(s):s;intersects$2(t,o)&&(r.leaf?i.push(s):contains(t,o)?this._all(s,i):a.push(s))}r=a.pop()}return i}collides(t){let r=this.data;if(!intersects$2(t,r))return!1;const i=[];for(;r;){for(let e=0;e<r.children.length;e++){var n=r.children[e],a=r.leaf?this.toBBox(n):n;if(intersects$2(t,a)){if(r.leaf||contains(t,a))return!0;i.push(n)}}r=i.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);var r;return this.data.children.length?this.data.height===e.height?this._splitRoot(this.data,e):(this.data.height<e.height&&(r=this.data,this.data=e,e=r),this._insert(e,this.data.height-e.height-1,!0)):this.data=e,this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(e,t){if(!e)return this;let r=this.data;var i=this.toBBox(e);const n=[],a=[];let s,o,l;for(;r||n.length;){if(r||(r=n.pop(),o=n[n.length-1],s=a.pop(),l=!0),r.leaf){var c=findItem(e,r.children,t);if(-1!==c)return r.children.splice(c,1),n.push(r),this._condense(n),this}l||r.leaf||!contains(r,i)?o?(s++,r=o.children[s],l=!1):r=null:(n.push(r),a.push(s),s=0,o=r,r=r.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const r=[];for(;e;)(e.leaf?t:r).push(...e.children),e=r.pop();return t}_build(r,e,i,n){var t=i-e+1;let a=this._maxEntries,s;if(t<=a)return s=createNode(r.slice(e,i+1)),calcBBox(s,this.toBBox),s;n||(n=Math.ceil(Math.log(t)/Math.log(a)),a=Math.ceil(t/Math.pow(a,n-1))),s=createNode([]),s.leaf=!1,s.height=n;var o=Math.ceil(t/a),l=o*Math.ceil(Math.sqrt(a));multiSelect(r,e,i,l,this.compareMinX);for(let t=e;t<=i;t+=l){var c=Math.min(t+l-1,i);multiSelect(r,t,c,o,this.compareMinY);for(let e=t;e<=c;e+=o){var h=Math.min(e+o-1,c);s.children.push(this._build(r,e,h,n-1))}}return calcBBox(s,this.toBBox),s}_chooseSubtree(n,a,e,s){for(;;){if(s.push(a),a.leaf||s.length-1===e)break;let t=1/0,r=1/0,i;for(let e=0;e<a.children.length;e++){var o=a.children[e],l=bboxArea(o),c=enlargedArea(n,o)-l;c<r?(r=c,t=l<t?l:t,i=o):c===r&&l<t&&(t=l,i=o)}a=i||a.children[0]}return a}_insert(e,t,r){var r=r?e:this.toBBox(e),i=[];const n=this._chooseSubtree(r,this.data,t,i);for(n.children.push(e),extend$2(n,r);0<=t&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)}_split(e,t){const r=e[t];var i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);i=this._chooseSplitIndex(r,n,i);const a=createNode(r.children.splice(i,r.children.length-i));a.height=r.height,a.leaf=r.leaf,calcBBox(r,this.toBBox),calcBBox(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this.data=createNode([e,t]),this.data.height=e.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(t,r,i){let n,a=1/0,s=1/0;for(let e=r;e<=i-r;e++){var o=distBBox(t,0,e,this.toBBox),l=distBBox(t,e,i,this.toBBox),c=intersectionArea(o,l),l=bboxArea(o)+bboxArea(l);c<a?(a=c,n=e,s=l<s?l:s):c===a&&l<s&&(s=l,n=e)}return n||i-r}_chooseSplitAxis(e,t,r){var i=e.leaf?this.compareMinX:compareNodeMinX,n=e.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)}_allDistMargin(t,r,i,e){t.children.sort(e);const n=this.toBBox;var a=distBBox(t,0,r,n),s=distBBox(t,i-r,i,n);let o=bboxMargin(a)+bboxMargin(s);for(let e=r;e<i-r;e++){var l=t.children[e];extend$2(a,t.leaf?n(l):l),o+=bboxMargin(a)}for(let e=i-r-1;e>=r;e--){var c=t.children[e];extend$2(s,t.leaf?n(c):c),o+=bboxMargin(s)}return o}_adjustParentBBoxes(t,r,i){for(let e=i;0<=e;e--)extend$2(r[e],t)}_condense(r){for(let e=r.length-1,t;0<=e;e--)0===r[e].children.length?0<e?(t=r[e-1].children,t.splice(t.indexOf(r[e]),1)):this.clear():calcBBox(r[e],this.toBBox)}}function findItem(t,r,i){if(!i)return r.indexOf(t);for(let e=0;e<r.length;e++)if(i(t,r[e]))return e;return-1}function calcBBox(e,t){distBBox(e,0,e.children.length,t,e)}function distBBox(t,r,i,n,a){(a=a||createNode(null)).minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(let e=r;e<i;e++){var s=t.children[e];extend$2(a,t.leaf?n(s):s)}return a}function extend$2(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function compareNodeMinX(e,t){return e.minX-t.minX}function compareNodeMinY(e,t){return e.minY-t.minY}function bboxArea(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function bboxMargin(e){return e.maxX-e.minX+(e.maxY-e.minY)}function enlargedArea(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function intersectionArea(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),t=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,t-i)}function contains(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function intersects$2(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function createNode(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(e,t,r,i,n){const a=[t,r];for(;a.length;){var s;(r=a.pop())-(t=a.pop())<=i||(quickselect(e,s=t+Math.ceil((r-t)/i/2)*i,t,r,n),a.push(t,s,s,r))}}var rbush=Object.freeze({__proto__:null,default:RBush$1}),require$$0=getAugmentedNamespace(rbush);class TinyQueue{constructor(e=[],t=defaultCompare){if(this.data=e,this.length=this.data.length,this.compare=t,0<this.length)for(let e=(this.length>>1)-1;0<=e;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,0<this.length&&(this.data[0]=t,this._down(0)),e}}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this;for(var i=t[e];0<e;){var n=e-1>>1,a=t[n];if(0<=r(i,a))break;t[e]=a,e=n}t[e]=i}_down(r){const{data:i,compare:n}=this;for(var e=this.length>>1,a=i[r];r<e;){let e=1+(r<<1),t=i[e];var s=e+1;if(s<this.length&&n(i[s],t)<0&&(e=s,t=i[s]),0<=n(t,a))break;i[r]=t,r=e}i[r]=a}}function defaultCompare(e,t){return e<t?-1:t<e?1:0}var tinyqueue=Object.freeze({__proto__:null,default:TinyQueue}),require$$1=getAugmentedNamespace(tinyqueue),pointInPolygon$1={exports:{}},flat=function(e,t,r,i){for(var n=e[0],a=e[1],s=!1,o=((i=void 0===i?t.length:i)-(r=void 0===r?0:r))/2,l=0,c=o-1;l<o;c=l++){var h=t[r+2*l+0],u=t[r+2*l+1],d=t[r+2*c+0],p=t[r+2*c+1];a<u!=a<p&&n<(d-h)*(a-u)/(p-u)+h&&(s=!s)}return s},nested=function(e,t,r,i){for(var n=e[0],a=e[1],s=!1,o=(i=void 0===i?t.length:i)-(r=void 0===r?0:r),l=0,c=o-1;l<o;c=l++){var h=t[l+r][0],u=t[l+r][1],d=t[c+r][0],p=t[c+r][1];a<u!=a<p&&n<(d-h)*(a-u)/(p-u)+h&&(s=!s)}return s},pointInPolygonFlat=flat,pointInPolygonNested=nested;pointInPolygon$1.exports=function(e,t,r,i){return(0<t.length&&Array.isArray(t[0])?pointInPolygonNested:pointInPolygonFlat)(e,t,r,i)},pointInPolygon$1.exports.nested=pointInPolygonNested,pointInPolygon$1.exports.flat=pointInPolygonFlat;var orient2d_min={exports:{}};!function(e){const O=134217729,k=33306690738754706e-32;function B(e,t,r,i,n){let a,s,o,l,c=t[0],h=i[0],u=0,d=0;h>c==h>-c?(a=c,c=t[++u]):(a=h,h=i[++d]);let p=0;if(u<e&&d<r)for(h>c==h>-c?(o=a-((s=c+a)-c),c=t[++u]):(o=a-((s=h+a)-h),h=i[++d]),a=s,0!==o&&(n[p++]=o);u<e&&d<r;)h>c==h>-c?(o=a-((s=a+c)-(l=s-a))+(c-l),c=t[++u]):(o=a-((s=a+h)-(l=s-a))+(h-l),h=i[++d]),a=s,0!==o&&(n[p++]=o);for(;u<e;)o=a-((s=a+c)-(l=s-a))+(c-l),c=t[++u],a=s,0!==o&&(n[p++]=o);for(;d<r;)o=a-((s=a+h)-(l=s-a))+(h-l),h=i[++d],a=s,0!==o&&(n[p++]=o);return 0===a&&0!==p||(n[p++]=a),p}function t(e){return new Float64Array(e)}const h=33306690738754716e-32,F=22204460492503146e-32,z=11093356479670487e-47,N=t(4),U=t(8),G=t(12),V=t(16),$=t(4);e.orient2d=function(e,t,r,i,n,a){const s=(t-a)*(r-n),o=(e-n)*(i-a),l=s-o;if(0===s||0===o||s>0!=o>0)return l;const c=Math.abs(s+o);return Math.abs(l)>=h*c?l:-function(e,t,r,i,n,a,s){let o,l,c,h,u,d,p,f,m,g,_,v,y,x,b,w,T,E;const S=e-n,M=r-n,A=t-a,C=i-a;u=(b=(f=S-(p=(d=O*S)-(d-S)))*(g=C-(m=(d=O*C)-(d-C)))-((x=S*C)-p*m-f*m-p*g))-(_=b-(T=(f=A-(p=(d=O*A)-(d-A)))*(g=M-(m=(d=O*M)-(d-M)))-((w=A*M)-p*m-f*m-p*g))),N[0]=b-(_+u)+(u-T),u=(y=x-((v=x+_)-(u=v-x))+(_-u))-(_=y-w),N[1]=y-(_+u)+(u-w),u=(E=v+_)-v,N[2]=v-(E-u)+(_-u),N[3]=E;let L=function(t,r){let i=r[0];for(let e=1;e<t;e++)i+=r[e];return i}(4,N),P=F*s;if(L>=P||-L>=P)return L;if(o=e-(S+(u=e-S))+(u-n),c=r-(M+(u=r-M))+(u-n),l=t-(A+(u=t-A))+(u-a),h=i-(C+(u=i-C))+(u-a),0===o&&0===l&&0===c&&0===h)return L;if(P=z*s+k*Math.abs(L),(L+=S*h+C*o-(A*c+M*l))>=P||-L>=P)return L;u=(b=(f=o-(p=(d=O*o)-(d-o)))*(g=C-(m=(d=O*C)-(d-C)))-((x=o*C)-p*m-f*m-p*g))-(_=b-(T=(f=l-(p=(d=O*l)-(d-l)))*(g=M-(m=(d=O*M)-(d-M)))-((w=l*M)-p*m-f*m-p*g))),$[0]=b-(_+u)+(u-T),u=(y=x-((v=x+_)-(u=v-x))+(_-u))-(_=y-w),$[1]=y-(_+u)+(u-w),u=(E=v+_)-v,$[2]=v-(E-u)+(_-u),$[3]=E;const I=B(4,N,4,$,U);u=(b=(f=S-(p=(d=O*S)-(d-S)))*(g=h-(m=(d=O*h)-(d-h)))-((x=S*h)-p*m-f*m-p*g))-(_=b-(T=(f=A-(p=(d=O*A)-(d-A)))*(g=c-(m=(d=O*c)-(d-c)))-((w=A*c)-p*m-f*m-p*g))),$[0]=b-(_+u)+(u-T),u=(y=x-((v=x+_)-(u=v-x))+(_-u))-(_=y-w),$[1]=y-(_+u)+(u-w),u=(E=v+_)-v,$[2]=v-(E-u)+(_-u),$[3]=E;const R=B(I,U,4,$,G);u=(b=(f=o-(p=(d=O*o)-(d-o)))*(g=h-(m=(d=O*h)-(d-h)))-((x=o*h)-p*m-f*m-p*g))-(_=b-(T=(f=l-(p=(d=O*l)-(d-l)))*(g=c-(m=(d=O*c)-(d-c)))-((w=l*c)-p*m-f*m-p*g))),$[0]=b-(_+u)+(u-T),u=(y=x-((v=x+_)-(u=v-x))+(_-u))-(_=y-w),$[1]=y-(_+u)+(u-w),u=(E=v+_)-v,$[2]=v-(E-u)+(_-u),$[3]=E;const D=B(R,G,4,$,V);return V[D-1]}(e,t,r,i,n,a,c)},e.orient2dfast=function(e,t,r,i,n,a){return(t-a)*(r-n)-(e-n)*(i-a)},Object.defineProperty(e,"__esModule",{value:!0})}(orient2d_min.exports);var RBush=require$$0,Queue=require$$1,pointInPolygon=pointInPolygon$1.exports;const orient=orient2d_min.exports.orient2d;function concaveman(e,t,r){t=Math.max(0,void 0===t?2:t),r=r||0;var i=fastConvexHull(e),n=new RBush(16);n.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},n.compareMinX=function(e,t){return e[0]-t[0]},n.compareMinY=function(e,t){return e[1]-t[1]},n.load(e);for(var a,s=[],o=0;o<i.length;o++){var l=i[o];n.remove(l),a=insertNode$1(l,a),s.push(a)}for(var c=new RBush(16),o=0;o<s.length;o++)c.insert(updateBBox(s[o]));for(var h=t*t,u=r*r;s.length;){var d=s.shift(),p=d.p,f=d.next.p,m=getSqDist(p,f);m<u||(l=findCandidate(n,d.prev.p,p,f,d.next.next.p,m=m/h,c))&&Math.min(getSqDist(l,p),getSqDist(l,f))<=m&&(s.push(d),s.push(insertNode$1(l,d)),n.remove(l),c.remove(d),c.insert(updateBBox(d)),c.insert(updateBBox(d.next)))}for(var d=a,g=[];g.push(d.p),(d=d.next)!==a;);return g.push(d.p),g}function findCandidate(e,t,r,i,n,a,s){for(var o=new Queue([],compareDist),l=e.data;l;){for(var c=0;c<l.children.length;c++){var h=l.children[c],u=l.leaf?sqSegDist(h,r,i):sqSegBoxDist(r,i,h);a<u||o.push({node:h,dist:u})}for(;o.length&&!o.peek().node.children;){var d=o.pop(),p=d.node,f=sqSegDist(p,t,r),m=sqSegDist(p,i,n);if(d.dist<f&&d.dist<m&&noIntersections(r,p,s)&&noIntersections(i,p,s))return p}l=(l=o.pop())&&l.node}return null}function compareDist(e,t){return e.dist-t.dist}function sqSegBoxDist(e,t,r){if(inside(e,r)||inside(t,r))return 0;var i=sqSegSegDist(e[0],e[1],t[0],t[1],r.minX,r.minY,r.maxX,r.minY);if(0===i)return 0;var n=sqSegSegDist(e[0],e[1],t[0],t[1],r.minX,r.minY,r.minX,r.maxY);if(0===n)return 0;var a=sqSegSegDist(e[0],e[1],t[0],t[1],r.maxX,r.minY,r.maxX,r.maxY);if(0===a)return 0;r=sqSegSegDist(e[0],e[1],t[0],t[1],r.minX,r.maxY,r.maxX,r.maxY);return 0===r?0:Math.min(i,n,a,r)}function inside(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function noIntersections(e,t,r){for(var i=Math.min(e[0],t[0]),n=Math.min(e[1],t[1]),a=Math.max(e[0],t[0]),s=Math.max(e[1],t[1]),o=r.search({minX:i,minY:n,maxX:a,maxY:s}),l=0;l<o.length;l++)if(intersects$1(o[l].p,o[l].next.p,e,t))return!1;return!0}function cross(e,t,r){return orient(e[0],e[1],t[0],t[1],r[0],r[1])}function intersects$1(e,t,r,i){return e!==i&&t!==r&&0<cross(e,t,r)!=0<cross(e,t,i)&&0<cross(r,i,e)!=0<cross(r,i,t)}function updateBBox(e){var t=e.p,r=e.next.p;return e.minX=Math.min(t[0],r[0]),e.minY=Math.min(t[1],r[1]),e.maxX=Math.max(t[0],r[0]),e.maxY=Math.max(t[1],r[1]),e}function fastConvexHull(e){for(var t=e[0],r=e[0],i=e[0],n=e[0],a=0;a<e.length;a++){var s=e[a];s[0]<t[0]&&(t=s),s[0]>i[0]&&(i=s),s[1]<r[1]&&(r=s),s[1]>n[1]&&(n=s)}for(var o=[t,r,i,n],l=o.slice(),a=0;a<e.length;a++)pointInPolygon(e[a],o)||l.push(e[a]);return convexHull(l)}function insertNode$1(e,t){e={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(e.next=t.next,(e.prev=t).next.prev=e,t.next=e):(e.prev=e).next=e,e}function getSqDist(e,t){var r=e[0]-t[0],t=e[1]-t[1];return r*r+t*t}function sqSegDist(e,t,r){var i=t[0],n=t[1],a=r[0]-i,s=r[1]-n;return 0===a&&0===s||(1<(t=((e[0]-i)*a+(e[1]-n)*s)/(a*a+s*s))?(i=r[0],n=r[1]):0<t&&(i+=a*t,n+=s*t)),(a=e[0]-i)*a+(s=e[1]-n)*s}function sqSegSegDist(e,t,r,i,n,a,s,o){var l,c,h=r-e,u=i-t,d=s-n,p=o-a,f=e-n,m=t-a,g=h*h+u*u,_=h*d+u*p,v=d*d+p*p,u=h*f+u*m,d=d*f+p*m,f=g*v-_*_,p=f,m=f;0==f?(l=0,p=1,c=d,m=v):(c=g*d-_*u,(l=_*d-v*u)<0?(l=0,c=d,m=v):p<l&&(l=p,c=d+_,m=v)),c<0?-u<(c=0)?l=0:g<-u?l=p:(l=-u,p=g):m<c&&(c=m,_-u<0?l=0:g<_-u?l=p:(l=_-u,p=g));r=(1-(m=0===c?0:c/m))*n+m*s-((1-(p=0===l?0:l/p))*e+p*r),i=(1-m)*a+m*o-((1-p)*t+p*i);return r*r+i*i}function compareByX(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}function convexHull(e){e.sort(compareByX);for(var t=[],r=0;r<e.length;r++){for(;2<=t.length&&cross(t[t.length-2],t[t.length-1],e[r])<=0;)t.pop();t.push(e[r])}for(var i=[],n=e.length-1;0<=n;n--){for(;2<=i.length&&cross(i[i.length-2],i[i.length-1],e[n])<=0;)i.pop();i.push(e[n])}return i.pop(),t.pop(),t.concat(i)}concaveman$2.exports=concaveman,concaveman$2.exports.default=concaveman;var concaveman$1=concaveman$2.exports;function convex(e,t){if(!isObject$2(t=t||{}))throw new Error("options is invalid");var t=t.concavity||1/0,r=[];if(coordEach(e,function(e){r.push([e[0],e[1]])}),!r.length)return null;t=concaveman$1(r,t);return 3<t.length?polygon([t]):null}function centroid(e,t){var r=0,i=0,n=0;return coordEach(e,function(e){r+=e[0],i+=e[1],n++},!0),point([r/n,i/n],t)}function centerOfMass(e,t){switch(getType(e)){case"Point":return e;case"Polygon":var r=[];coordEach(e,function(e){r.push(e)});for(var i,n,a,s,o,l=centroid(e,t),c=l.geometry.coordinates,h=0,u=0,d=0,p=r.map(function(e){return[e[0]-c[0],e[1]-c[1]]}),f=0;f<r.length-1;f++)i=(s=p[f])[0],a=s[1],n=(o=p[f+1])[0],d+=o=i*(s=o[1])-n*a,h+=(i+n)*o,u+=(a+s)*o;if(0===d)return l;l=1/(6*(.5*d));return point([c[0]+l*h,c[1]+l*u],t);default:l=convex(e);return l?centerOfMass(l,t):centroid(e,t)}}function distance(e,t,r){if(!isObject$2(r=r||{}))throw new Error("options is invalid");var i=r.units,n=getCoord(e),r=getCoord(t),e=degreesToRadians(r[1]-n[1]),t=degreesToRadians(r[0]-n[0]),n=degreesToRadians(n[1]),r=degreesToRadians(r[1]),r=Math.pow(Math.sin(e/2),2)+Math.pow(Math.sin(t/2),2)*Math.cos(n)*Math.cos(r);return radiansToLength(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),i)}const DOUBLE_PI=2*Math.PI,DEGREE_TO_RADIAN$1=Math.PI/180,MEAN_EARTH_RADIUS=6371.0088;function destination(e,t,r){var i=getCoord(e),n=i[0]*DEGREE_TO_RADIAN$1,a=i[1]*DEGREE_TO_RADIAN$1,s=r*DEGREE_TO_RADIAN$1,e=t/MEAN_EARTH_RADIUS,i=Math.sin(a),r=Math.cos(a),t=Math.sin(e),a=Math.cos(e),e=Math.sin(s),s=Math.cos(s),s=Math.asin(i*a+r*t*s);return[(n+Math.atan2(e*t*r,a-i*Math.sin(s)))%DOUBLE_PI/DEGREE_TO_RADIAN$1,s%DOUBLE_PI/DEGREE_TO_RADIAN$1]}function featureFilter(e,t){const r=[];return featureEach(e,e=>{t(e.properties)&&r.push(e)}),featureCollection(r)}function updateDistances(e){const r=getCoords(e),i=[];let n=0,a=r[0],s,o,l;for(let e=0,t=r.length;e<t-1;e++){var c=a;a=r[e+1];var h=distance(c,a);s=bearing(c,a),o=((a[2]||0)-(c[2]||0))/h,l=Math.atan(o/1e3),i.push([n,s,o,l]),n+=h}i.push([n,s,o,l]),e.properties.distances=i}function getCoordAndBearing(e,t,r,i){const n=e.geometry.coordinates,a=e.properties.distances,s=n.length,o=[];let l=0,c=s-1;for(t-=i*(r-1)/2;l!==c-1;){var h=Math.floor((l+c)/2);t<a[h][0]?c=h:l=h}let u=l;for(let e=0;e<r;t+=i,e++){for(;t>a[u+1][0]&&u<s-2;)u++;var[d,p,f,m]=a[u],g=n[u],d=t-d;o.push({coord:destination(g,d,p),altitude:(g[2]||0)+f*d,bearing:p,pitch:m})}return o}function getIds(e){e=e.properties.ids;return"string"==typeof e?JSON.parse(e):e}function getAltitude(e){return getCoords(e)[0][0][2]}function getCenterCoord(e){return getCoord(centerOfMass(e))}function emptyFeatureCollection(){return featureCollection([])}function isFeature(e){return e&&"Feature"===e.type&&e.geometry}var parseCSSColor_1,csscolorparser={},kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function clamp_css_byte(e){return(e=Math.round(e))<0?0:255<e?255:e}function clamp_css_float(e){return e<0?0:1<e?1:e}function parse_css_int(e){return"%"===e[e.length-1]?clamp_css_byte(parseFloat(e)/100*255):clamp_css_byte(parseInt(e))}function parse_css_float(e){return"%"===e[e.length-1]?clamp_css_float(parseFloat(e)/100):clamp_css_float(parseFloat(e))}function css_hue_to_rgb(e,t,r){return r<0?r+=1:1<r&&--r,6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function parseCSSColor(e){var t=e.replace(/ /g,"").toLowerCase();if(t in kCSSColorTable)return kCSSColorTable[t].slice();if("#"===t[0])return 4===t.length?0<=(i=parseInt(t.substr(1),16))&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===t.length&&0<=(i=parseInt(t.substr(1),16))&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var r=t.indexOf("("),e=t.indexOf(")");if(-1!==r&&e+1===t.length){var i=t.substr(0,r),n=t.substr(r+1,e-(r+1)).split(","),a=1;switch(i){case"rgba":if(4!==n.length)return null;a=parse_css_float(n.pop());case"rgb":return 3!==n.length?null:[parse_css_int(n[0]),parse_css_int(n[1]),parse_css_int(n[2]),a];case"hsla":if(4!==n.length)return null;a=parse_css_float(n.pop());case"hsl":if(3!==n.length)return null;var s=(parseFloat(n[0])%360+360)%360/360,o=parse_css_float(n[1]),l=parse_css_float(n[2]),o=l<=.5?l*(o+1):l+o-l*o,l=2*l-o;return[clamp_css_byte(255*css_hue_to_rgb(l,o,s+1/3)),clamp_css_byte(255*css_hue_to_rgb(l,o,s)),clamp_css_byte(255*css_hue_to_rgb(l,o,s-1/3)),a];default:return null}}return null}try{parseCSSColor_1=csscolorparser.parseCSSColor=parseCSSColor}catch(e){}function getBounds(e){const t=new mapboxGl$1.exports.LngLatBounds;for(const r of e)t.extend(r);return t}function setLayerProps(e,t,r){e.getLayer(t).implementation.setProps(r)}function hasDarkBackground(e,t){if(t)return luminance(e.getLayer("background").paint.get("background-color"))<.5;var[r,t,e]=parseCSSColor_1(e.getPaintProperty("background","background-color"));return luminance({r:r,g:t,b:e})<127.5}function getScaledColorString(e,t){return`rgba(${e.r*t.r},${e.g*t.g},${e.b*t.b},${e.a})`}function getStyleColors(c){const h={background:["background-color"],line:["line-color"],fill:["fill-color","fill-outline-color"],"fill-extrusion":["fill-extrusion-color"]},t=Object.keys(h),u=[];return c.getStyle().layers.filter(e=>includes(t,e.type)&&!e.id.match(/-(og|ug)-/)).forEach(e=>{const{id:a,type:t}=e;for(const o of h[t]){const l=c.getPaintProperty(a,o);var r,i,n,s;"string"==typeof l?([r,i,n,s]=parseCSSColor_1(l),u.push({id:a,key:o,r:r,g:i,b:n,a:s})):Array.isArray(l)&&"case"===l[0]?l.forEach((e,t)=>{var r,i,n;1<=t&&"string"==typeof e&&([r,i,n,e]=parseCSSColor_1(e),u.push({id:a,key:o,_case:t,r:r,g:i,b:n,a:e}))}):"object"==typeof l&&l.stops.forEach((e,t)=>{var[r,i,n,e]=parseCSSColor_1(e[1]);u.push({id:a,key:o,stops:t,r:r,g:i,b:n,a:e})})}}),u}function getStyleOpacities(r){const t=["line","fill","fill-extrusion"],i=[];return r.getStyle().layers.filter(e=>includes(t,e.type)).forEach(e=>{var{id:t,type:e}=e,e=`${e}-opacity`;i.push({id:t,key:e,opacity:r.getPaintProperty(t,e)||1})}),i}function scaleValues(e,t){if(!isNaN(e))return e*t;if(Array.isArray(e)&&"case"===e[0])return e.map(e=>isNaN(e)?e:e*t);const r={};for(const i of Object.keys(e))"stops"===i?r[i]=e[i].map(e=>[e[0],e[1]*t]):r[i]=e[i];return r}class LayerPanel extends Panel{constructor(e){super(Object.assign({className:"layer-panel",modal:!0},e))}addTo(e){const t=this._options["layers"],{lang:r,dict:i}=e;super.addTo(e).setTitle(i.layers).setHTML(t.map(e=>[`<div id="${e.getId()}-layer" class="layer-row">`,'<div class="layer-icon"></div>',`<div>${e.getName(r)}</div>`,"</div>"].join("")).join(""));for(const n of t){const a=this._container.querySelector(`#${n.getId()}-layer .layer-icon`),{style:s,classList:o}=a;Object.assign(s,n.getIconStyle()),n.isEnabled()&&o.add("layer-icon-enabled"),a.addEventListener("click",()=>{n.isEnabled()?(o.remove("layer-icon-enabled"),n.disable()):(o.add("layer-icon-enabled"),n.enable())})}return this}}const OPERATORS_FOR_TRAINS=["JR-East","TokyoMetro","Toei"],OPERATORS_FOR_TRAININFORMATION={tokyochallenge:["JR-East","TWR","TokyoMetro","Toei","YokohamaMunicipal","Keio","Keikyu","Keisei","Tobu","Seibu","Tokyu","MIR","TamaMonorail"]},OPERATORS_FOR_FLIGHTINFORMATION=["HND-JAT","HND-TIAT","NAA"],RAILWAY_SOBURAPID="JR-East.SobuRapid",TRAINTYPE_JREAST_LIMITEDEXPRESS="JR-East.LimitedExpress";function getTimetableFileName(e){return`timetable-${"Weekday"===e.getCalendar()?"weekday":"holiday"}.json.gz`}function getExtraTimetableFileNames(e){e=e.getCalendar();return"Saturday"===e?["timetable-saturday.json.gz"]:"Holiday"===e?["timetable-sunday-holiday.json.gz"]:[]}function adjustTrainID(e,t,r){return t===TRAINTYPE_JREAST_LIMITEDEXPRESS&&r[0].match(/NaritaAirportTerminal1|Takao|Ofuna|Omiya|Ikebukuro|Shinjuku/)?e.replace(/JR-East\.(NaritaAirportBranch|Narita|Sobu)/,RAILWAY_SOBURAPID):e}function loadStaticData(t,e,r){const i=getExtraTimetableFileNames(r);return Promise.all([`${t}/dictionary-${e}.json`,`${t}/railways.json.gz`,`${t}/stations.json.gz`,`${t}/features.json.gz`,`${t}/${getTimetableFileName(r)}`,`${t}/rail-directions.json.gz`,`${t}/train-types.json.gz`,`${t}/train-vehicles.json.gz`,`${t}/operators.json.gz`,`${t}/airports.json.gz`,`${t}/flight-statuses.json.gz`,`${t}/poi.json.gz`,...i.map(e=>`${t}/${e}`)].map(loadJSON)).then(e=>({dict:e[0],railwayData:e[1],stationData:e[2],featureCollection:e[3],timetableData:e[4].concat(...e.slice(12)),railDirectionData:e[5],trainTypeData:e[6],trainVehicleData:e[7],operatorData:e[8],airportData:e[9],flightStatusData:e[10],poiData:e[11]}))}function loadTimetableData(t,e){const r=getExtraTimetableFileNames(e);return Promise.all([`${t}/${getTimetableFileName(e)}`,...r.map(e=>`${t}/${e}`)].map(loadJSON)).then(e=>e[0].concat(...e.slice(1)))}function loadDynamicTrainData(i){const n=[],t=[],e=configs.apiUrl.tokyochallenge,r=i.tokyochallenge,a=OPERATORS_FOR_TRAINS.map(e=>`odpt.Operator:${e}`).join(","),s=[`${e}odpt:Train?odpt:operator=${a}&acl:consumerKey=${r}`,configs.tidUrl];return Object.keys(OPERATORS_FOR_TRAININFORMATION).forEach(e=>{var t=configs.apiUrl[e],r=i[e],e=OPERATORS_FOR_TRAININFORMATION[e].map(e=>`odpt.Operator:${e}`).join(",");s.push(`${t}odpt:TrainInformation?odpt:operator=${e}&acl:consumerKey=${r}`)}),Promise.all(s.map(loadJSON)).then(e=>(e.shift().forEach(e=>{var t=removePrefix(e["odpt:trainType"]),r=removePrefix(e["odpt:destinationStation"]);n.push({id:adjustTrainID(removePrefix(e["owl:sameAs"]),t,r),o:removePrefix(e["odpt:operator"]),r:removePrefix(e["odpt:railway"]),y:t,n:e["odpt:trainNumber"],os:removePrefix(e["odpt:originStation"]),d:removePrefix(e["odpt:railDirection"]),ds:r,ts:removePrefix(e["odpt:toStation"]),fs:removePrefix(e["odpt:fromStation"]),delay:1e3*(e["odpt:delay"]||0),carComposition:e["odpt:carComposition"],date:e["dc:date"].replace(/([\d\-])T([\d:]+).*/,"$1 $2")})}),e.shift().forEach(e=>{n.push(e)}),[].concat(...e).forEach(e=>{t.push({operator:removePrefix(e["odpt:operator"]),railway:removePrefix(e["odpt:railway"]),status:e["odpt:trainInformationStatus"],text:e["odpt:trainInformationText"]})}),{trainData:n,trainInfoData:t}))}function loadDynamicFlightData(e){const t=configs.apiUrl.tokyochallenge,r=e.tokyochallenge,i=OPERATORS_FOR_FLIGHTINFORMATION.map(e=>`odpt.Operator:${e}`).join(","),n=[configs.atisUrl,...["Arrival","Departure"].map(e=>`${t}odpt:FlightInformation${e}?odpt:operator=${i}&acl:consumerKey=${r}`)];return Promise.all(n.map(loadJSON)).then(e=>{return{atisData:e.shift(),flightData:[].concat(...e).map(e=>({id:removePrefix(e["owl:sameAs"]),o:removePrefix(e["odpt:operator"]),n:e["odpt:flightNumber"],a:removePrefix(e["odpt:airline"]),s:removePrefix(e["odpt:flightStatus"]),dp:removePrefix(e["odpt:departureAirport"]),ar:removePrefix(e["odpt:arrivalAirport"]),ds:removePrefix(e["odpt:destinationAirport"]),or:removePrefix(e["odpt:originAirport"]),edt:e["odpt:estimatedDepartureTime"],adt:e["odpt:actualDepartureTime"],sdt:e["odpt:scheduledDepartureTime"],eat:e["odpt:estimatedArrivalTime"],aat:e["odpt:actualArrivalTime"],sat:e["odpt:scheduledArrivalTime"],date:e["dc:date"].replace(/([\d\-])T([\d:]+).*/,"$1 $2")}))}})}class MapboxGLButtonControl{constructor(e){this._options=e.map(e=>({className:e.className||"",title:e.title||"",eventHandler:e.eventHandler}))}onAdd(e){const i=this;return i._map=e,i._container=createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group"}),i._buttons=i._options.map(e=>{const t=createElement("button",{className:e.className,type:"button",title:e.title,onclick:e.eventHandler},i._container),r=createElement("span",{className:"mapboxgl-ctrl-icon"},t);return t.setAttribute("aria-label",e.title),r.setAttribute("aria-hidden",!0),t}),i._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}class Plugin{constructor(e){const t=this;t.implementation=e,t.enabled=!1,t.clockModes=e.clockModes||["realtime","playback"],t.viewModes=e.viewModes||["ground","underground"],t.searchModes=e.searchModes||["none"],t._onModeChanged=()=>{t.setVisibility(!0)}}addTo(e){const t=this["implementation"];return this.map=e,t.onAdd&&t.onAdd(e),valueOrDefault(t.enabled,!0)&&this.enable(),this}remove(){const{map:e,implementation:t}=this;return this.disable(),t.onRemove&&t.onRemove(e),delete this.map,this}enable(){const{map:e,implementation:t}=this;return this.enabled||(this.enabled=!0,e.on("clockmode",this._onModeChanged),e.on("viewmode",this._onModeChanged),t.onEnabled&&t.onEnabled(),this.setVisibility(!0)),this}disable(){const{map:e,implementation:t}=this;return this.enabled&&(this.enabled=!1,e.off("clockmode",this._onModeChanged),e.off("viewmode",this._onModeChanged),this.setVisibility(!1),t.onDisabled&&t.onDisabled()),this}setVisibility(e){const{map:t,implementation:r}=this;r.onVisibilityChanged&&r.onVisibilityChanged(e&&this.enabled&&includes(this.clockModes,t.getClockMode())&&includes(this.viewModes,t.getViewMode())&&includes(this.searchModes,t.searchMode))}getId(){return this.implementation.id}getName(e){var t=this.implementation["name"];return t[e]||t.en}getIconStyle(){return this.implementation.iconStyle}isEnabled(){return this.enabled}}function isObject$1(e){return null!==e&&"object"==typeof e&&"constructor"in e&&e.constructor===Object}function extend$1(t={},r={}){Object.keys(r).forEach(e=>{void 0===t[e]?t[e]=r[e]:isObject$1(r[e])&&isObject$1(t[e])&&0<Object.keys(r[e]).length&&extend$1(t[e],r[e])})}const ssrDocument={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function getDocument(){var e="undefined"!=typeof document?document:{};return extend$1(e,ssrDocument),e}const ssrWindow={document:ssrDocument,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(e){return"undefined"==typeof setTimeout?(e(),null):setTimeout(e,0)},cancelAnimationFrame(e){"undefined"!=typeof setTimeout&&clearTimeout(e)}};function getWindow(){var e="undefined"!=typeof window?window:{};return extend$1(e,ssrWindow),e}function makeReactive(e){const t=e.__proto__;Object.defineProperty(e,"__proto__",{get(){return t},set(e){t.__proto__=e}})}class Dom7 extends Array{constructor(e){super(...e||[]),makeReactive(this)}}function arrayFlat(e=[]){const t=[];return e.forEach(e=>{Array.isArray(e)?t.push(...arrayFlat(e)):t.push(e)}),t}function arrayFilter(e,t){return Array.prototype.filter.call(e,t)}function arrayUnique(t){const r=[];for(let e=0;e<t.length;e+=1)-1===r.indexOf(t[e])&&r.push(t[e]);return r}function qsa(e,t){if("string"!=typeof e)return[e];const r=[];var i=t.querySelectorAll(e);for(let e=0;e<i.length;e+=1)r.push(i[e]);return r}function $(e,t){var r=getWindow();const i=getDocument();let n=[];if(!t&&e instanceof Dom7)return e;if(!e)return new Dom7(n);if("string"==typeof e){const a=e.trim();if(0<=a.indexOf("<")&&0<=a.indexOf(">")){let e="div";0===a.indexOf("<li")&&(e="ul"),0===a.indexOf("<tr")&&(e="tbody"),0!==a.indexOf("<td")&&0!==a.indexOf("<th")||(e="tr"),0===a.indexOf("<tbody")&&(e="table"),0===a.indexOf("<option")&&(e="select");const s=i.createElement(e);s.innerHTML=a;for(let e=0;e<s.childNodes.length;e+=1)n.push(s.childNodes[e])}else n=qsa(e.trim(),t||i)}else if(e.nodeType||e===r||e===i)n.push(e);else if(Array.isArray(e)){if(e instanceof Dom7)return e;n=e}return new Dom7(arrayUnique(n))}function addClass(...e){const t=arrayFlat(e.map(e=>e.split(" ")));return this.forEach(e=>{e.classList.add(...t)}),this}function removeClass(...e){const t=arrayFlat(e.map(e=>e.split(" ")));return this.forEach(e=>{e.classList.remove(...t)}),this}function toggleClass(...e){const r=arrayFlat(e.map(e=>e.split(" ")));this.forEach(t=>{r.forEach(e=>{t.classList.toggle(e)})})}function hasClass(...e){const r=arrayFlat(e.map(e=>e.split(" ")));return 0<arrayFilter(this,t=>0<r.filter(e=>t.classList.contains(e)).length).length}function attr(t,r){if(1===arguments.length&&"string"==typeof t)return this[0]?this[0].getAttribute(t):void 0;for(let e=0;e<this.length;e+=1)if(2===arguments.length)this[e].setAttribute(t,r);else for(const i in t)this[e][i]=t[i],this[e].setAttribute(i,t[i]);return this}function removeAttr(t){for(let e=0;e<this.length;e+=1)this[e].removeAttribute(t);return this}function transform(t){for(let e=0;e<this.length;e+=1)this[e].style.transform=t;return this}function transition$1(t){for(let e=0;e<this.length;e+=1)this[e].style.transitionDuration="string"!=typeof t?`${t}ms`:t;return this}function on(...e){let[t,n,a,r]=e;function i(e){var t=e.target;if(t){const i=e.target.dom7EventData||[];if(i.indexOf(e)<0&&i.unshift(e),$(t).is(n))a.apply(t,i);else{var r=$(t).parents();for(let e=0;e<r.length;e+=1)$(r[e]).is(n)&&a.apply(r[e],i)}}}function s(e){const t=e&&e.target&&e.target.dom7EventData||[];t.indexOf(e)<0&&t.unshift(e),a.apply(this,t)}"function"==typeof e[1]&&([t,a,r]=e,n=void 0),r=r||!1;var o=t.split(" ");let l;for(let e=0;e<this.length;e+=1){const u=this[e];if(n)for(l=0;l<o.length;l+=1){var c=o[l];u.dom7LiveListeners||(u.dom7LiveListeners={}),u.dom7LiveListeners[c]||(u.dom7LiveListeners[c]=[]),u.dom7LiveListeners[c].push({listener:a,proxyListener:i}),u.addEventListener(c,i,r)}else for(l=0;l<o.length;l+=1){var h=o[l];u.dom7Listeners||(u.dom7Listeners={}),u.dom7Listeners[h]||(u.dom7Listeners[h]=[]),u.dom7Listeners[h].push({listener:a,proxyListener:s}),u.addEventListener(h,s,r)}}return this}function off(...e){let[t,r,i,n]=e;"function"==typeof e[1]&&([t,i,n]=e,r=void 0),n=n||!1;var a=t.split(" ");for(let e=0;e<a.length;e+=1){var s=a[e];for(let e=0;e<this.length;e+=1){const l=this[e];let t;if(!r&&l.dom7Listeners?t=l.dom7Listeners[s]:r&&l.dom7LiveListeners&&(t=l.dom7LiveListeners[s]),t&&t.length)for(let e=t.length-1;0<=e;--e){var o=t[e];(!i||o.listener!==i)&&!(i&&o.listener&&o.listener.dom7proxy&&o.listener.dom7proxy===i)&&i||(l.removeEventListener(s,o.proxyListener,n),t.splice(e,1))}}}return this}function trigger(...t){const r=getWindow();var i=t[0].split(" "),n=t[1];for(let e=0;e<i.length;e+=1){var a,s=i[e];for(let e=0;e<this.length;e+=1){const o=this[e];r.CustomEvent&&(a=new r.CustomEvent(s,{detail:n,bubbles:!0,cancelable:!0}),o.dom7EventData=t.filter((e,t)=>0<t),o.dispatchEvent(a),o.dom7EventData=[],delete o.dom7EventData)}}return this}function transitionEnd$1(r){const i=this;return r&&i.on("transitionend",function e(t){t.target===this&&(r.call(this,t),i.off("transitionend",e))}),this}function outerWidth(e){if(0<this.length){if(e){const t=this.styles();return this[0].offsetWidth+parseFloat(t.getPropertyValue("margin-right"))+parseFloat(t.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null}function outerHeight(e){if(0<this.length){if(e){const t=this.styles();return this[0].offsetHeight+parseFloat(t.getPropertyValue("margin-top"))+parseFloat(t.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null}function offset(){if(0<this.length){var e=getWindow(),t=getDocument();const a=this[0];var r=a.getBoundingClientRect(),i=t.body,n=a.clientTop||i.clientTop||0,t=a.clientLeft||i.clientLeft||0,i=a===e?e.scrollY:a.scrollTop,e=a===e?e.scrollX:a.scrollLeft;return{top:r.top+i-n,left:r.left+e-t}}return null}function styles(){const e=getWindow();return this[0]?e.getComputedStyle(this[0],null):{}}function css(e,t){const r=getWindow();let i;if(1===arguments.length){if("string"!=typeof e){for(i=0;i<this.length;i+=1)for(const n in e)this[i].style[n]=e[n];return this}if(this[0])return r.getComputedStyle(this[0],null).getPropertyValue(e)}if(2!==arguments.length||"string"!=typeof e)return this;for(i=0;i<this.length;i+=1)this[i].style[e]=t;return this}function each(r){return r&&this.forEach((e,t)=>{r.apply(e,[e,t])}),this}function filter(e){return $(arrayFilter(this,e))}function html(t){if(void 0===t)return this[0]?this[0].innerHTML:null;for(let e=0;e<this.length;e+=1)this[e].innerHTML=t;return this}function text(t){if(void 0===t)return this[0]?this[0].textContent.trim():null;for(let e=0;e<this.length;e+=1)this[e].textContent=t;return this}function is(e){var t=getWindow(),r=getDocument();const i=this[0];let n,a;if(!i||void 0===e)return!1;if("string"==typeof e){if(i.matches)return i.matches(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);for(n=$(e),a=0;a<n.length;a+=1)if(n[a]===i)return!0;return!1}if(e===r)return i===r;if(e===t)return i===t;if(e.nodeType||e instanceof Dom7){for(n=e.nodeType?[e]:e,a=0;a<n.length;a+=1)if(n[a]===i)return!0;return!1}return!1}function index(){let e=this[0],t;if(e){for(t=0;null!==(e=e.previousSibling);)1===e.nodeType&&(t+=1);return t}}function eq(e){if(void 0===e)return this;var t=this.length;if(t-1<e)return $([]);if(e<0){t=t+e;return t<0?$([]):$([this[t]])}return $([this[e]])}function append(...t){var r;const i=getDocument();for(let e=0;e<t.length;e+=1){r=t[e];for(let t=0;t<this.length;t+=1)if("string"==typeof r){const n=i.createElement("div");for(n.innerHTML=r;n.firstChild;)this[t].appendChild(n.firstChild)}else if(r instanceof Dom7)for(let e=0;e<r.length;e+=1)this[t].appendChild(r[e]);else this[t].appendChild(r)}return this}function prepend(e){const t=getDocument();let r,i;for(r=0;r<this.length;r+=1)if("string"==typeof e){const n=t.createElement("div");for(n.innerHTML=e,i=n.childNodes.length-1;0<=i;--i)this[r].insertBefore(n.childNodes[i],this[r].childNodes[0])}else if(e instanceof Dom7)for(i=0;i<e.length;i+=1)this[r].insertBefore(e[i],this[r].childNodes[0]);else this[r].insertBefore(e,this[r].childNodes[0]);return this}function next(e){return 0<this.length?e?this[0].nextElementSibling&&$(this[0].nextElementSibling).is(e)?$([this[0].nextElementSibling]):$([]):this[0].nextElementSibling?$([this[0].nextElementSibling]):$([]):$([])}function nextAll(e){const t=[];let r=this[0];if(!r)return $([]);for(;r.nextElementSibling;){var i=r.nextElementSibling;(!e||$(i).is(e))&&t.push(i),r=i}return $(t)}function prev(e){if(0<this.length){var t=this[0];return e?t.previousElementSibling&&$(t.previousElementSibling).is(e)?$([t.previousElementSibling]):$([]):t.previousElementSibling?$([t.previousElementSibling]):$([])}return $([])}function prevAll(e){const t=[];let r=this[0];if(!r)return $([]);for(;r.previousElementSibling;){var i=r.previousElementSibling;(!e||$(i).is(e))&&t.push(i),r=i}return $(t)}function parent(t){const r=[];for(let e=0;e<this.length;e+=1)null===this[e].parentNode||t&&!$(this[e].parentNode).is(t)||r.push(this[e].parentNode);return $(r)}function parents(r){const i=[];for(let t=0;t<this.length;t+=1){let e=this[t].parentNode;for(;e;)r&&!$(e).is(r)||i.push(e),e=e.parentNode}return $(i)}function closest(e){let t=this;return void 0===e?$([]):(t.is(e)||(t=t.parents(e).eq(0)),t)}function find(t){const r=[];for(let e=0;e<this.length;e+=1){var i=this[e].querySelectorAll(t);for(let e=0;e<i.length;e+=1)r.push(i[e])}return $(r)}function children(t){const r=[];for(let e=0;e<this.length;e+=1){var i=this[e].children;for(let e=0;e<i.length;e+=1)t&&!$(i[e]).is(t)||r.push(i[e])}return $(r)}function remove(){for(let e=0;e<this.length;e+=1)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this}$.fn=Dom7.prototype;const Methods={addClass:addClass,removeClass:removeClass,hasClass:hasClass,toggleClass:toggleClass,attr:attr,removeAttr:removeAttr,transform:transform,transition:transition$1,on:on,off:off,trigger:trigger,transitionEnd:transitionEnd$1,outerWidth:outerWidth,outerHeight:outerHeight,styles:styles,offset:offset,css:css,each:each,html:html,text:text,is:is,index:index,eq:eq,append:append,prepend:prepend,next:next,nextAll:nextAll,prev:prev,prevAll:prevAll,parent:parent,parents:parents,closest:closest,find:find,children:children,filter:filter,remove:remove};function deleteProps(e){const t=e;Object.keys(t).forEach(e=>{try{t[e]=null}catch(e){}try{delete t[e]}catch(e){}})}function nextTick(e,t=0){return setTimeout(e,t)}function now$1(){return Date.now()}function getComputedStyle$1(e){const t=getWindow();let r;return t.getComputedStyle&&(r=t.getComputedStyle(e,null)),!r&&e.currentStyle&&(r=e.currentStyle),r=r||e.style,r}function getTranslate(e,t="x"){const r=getWindow();let i,n,a;const s=getComputedStyle$1(e);return r.WebKitCSSMatrix?(n=s.transform||s.webkitTransform,6<n.split(",").length&&(n=n.split(", ").map(e=>e.replace(",",".")).join(", ")),a=new r.WebKitCSSMatrix("none"===n?"":n)):(a=s.MozTransform||s.OTransform||s.MsTransform||s.msTransform||s.transform||s.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),i=a.toString().split(",")),"x"===t&&(n=r.WebKitCSSMatrix?a.m41:16===i.length?parseFloat(i[12]):parseFloat(i[4])),"y"===t&&(n=r.WebKitCSSMatrix?a.m42:16===i.length?parseFloat(i[13]):parseFloat(i[5])),n||0}function isObject(e){return"object"==typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)}function isNode(e){return"undefined"!=typeof window&&void 0!==window.HTMLElement?e instanceof HTMLElement:e&&(1===e.nodeType||11===e.nodeType)}function extend(...t){const r=Object(t[0]),i=["__proto__","constructor","prototype"];for(let e=1;e<t.length;e+=1){var n=t[e];if(null!=n&&!isNode(n)){var a=Object.keys(Object(n)).filter(e=>i.indexOf(e)<0);for(let e=0,t=a.length;e<t;e+=1){var s=a[e],o=Object.getOwnPropertyDescriptor(n,s);void 0!==o&&o.enumerable&&(isObject(r[s])&&isObject(n[s])?n[s].__swiper__?r[s]=n[s]:extend(r[s],n[s]):!isObject(r[s])&&isObject(n[s])?(r[s]={},n[s].__swiper__?r[s]=n[s]:extend(r[s],n[s])):r[s]=n[s])}}}return r}function setCSSProperty(e,t,r){e.style.setProperty(t,r)}function animateCSSModeScroll({swiper:r,targetPosition:i,side:n}){const a=getWindow(),s=-r.translate;let o=null,l;const c=r.params.speed;r.wrapperEl.style.scrollSnapType="none",a.cancelAnimationFrame(r.cssModeFrameID);const h=i>s?"next":"prev",u=(e,t)=>"next"===h&&t<=e||"prev"===h&&e<=t,d=()=>{l=(new Date).getTime(),null===o&&(o=l);var e=Math.max(Math.min((l-o)/c,1),0),e=.5-Math.cos(e*Math.PI)/2;let t=s+e*(i-s);if(u(t,i)&&(t=i),r.wrapperEl.scrollTo({[n]:t}),u(t,i))return r.wrapperEl.style.overflow="hidden",r.wrapperEl.style.scrollSnapType="",setTimeout(()=>{r.wrapperEl.style.overflow="",r.wrapperEl.scrollTo({[n]:t})}),void a.cancelAnimationFrame(r.cssModeFrameID);r.cssModeFrameID=a.requestAnimationFrame(d)};d()}Object.keys(Methods).forEach(e=>{Object.defineProperty($.fn,e,{value:Methods[e],writable:!0})});let support;function calcSupport(){const r=getWindow();var e=getDocument();return{smoothScroll:e.documentElement&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in r||r.DocumentTouch&&e instanceof r.DocumentTouch),passiveListener:function(){let e=!1;try{var t=Object.defineProperty({},"passive",{get(){e=!0}});r.addEventListener("testPassiveListener",null,t)}catch(e){}return e}(),gestures:"ongesturestart"in r}}function getSupport(){return support=support||calcSupport(),support}let deviceCached;function calcDevice({userAgent:e}={}){var t=getSupport(),r=getWindow(),i=r.navigator.platform;const n=e||r.navigator.userAgent,a={ios:!1,android:!1};var s=r.screen.width,o=r.screen.height,l=n.match(/(Android);?[\s\/]+([\d.]+)?/);let c=n.match(/(iPad).*OS\s([\d_]+)/);var h=n.match(/(iPod)(.*OS\s([\d_]+))?/),e=!c&&n.match(/(iPhone\sOS|iOS)\s([\d_]+)/),r="Win32"===i;let u="MacIntel"===i;return!c&&u&&t.touch&&0<=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${s}x${o}`)&&(c=n.match(/(Version)\/([\d.]+)/),c=c||[0,1,"13_0_0"],u=!1),l&&!r&&(a.os="android",a.android=!0),(c||e||h)&&(a.os="ios",a.ios=!0),a}function getDevice(e={}){return deviceCached=deviceCached||calcDevice(e),deviceCached}let browser;function calcBrowser(){const t=getWindow();return{isSafari:function(){const e=t.navigator.userAgent.toLowerCase();return 0<=e.indexOf("safari")&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent)}}function getBrowser(){return browser=browser||calcBrowser(),browser}function Resize({swiper:a,on:e,emit:t}){const r=getWindow();let i=null;const s=()=>{a&&!a.destroyed&&a.initialized&&(t("beforeResize"),t("resize"))},n=()=>{a&&!a.destroyed&&a.initialized&&t("orientationchange")};e("init",()=>{a.params.resizeObserver&&void 0!==r.ResizeObserver?a&&!a.destroyed&&a.initialized&&(i=new ResizeObserver(e=>{var{width:t,height:r}=a;let i=t,n=r;e.forEach(({contentBoxSize:e,contentRect:t,target:r})=>{r&&r!==a.el||(i=t?t.width:(e[0]||e).inlineSize,n=t?t.height:(e[0]||e).blockSize)}),i===t&&n===r||s()}),i.observe(a.el)):(r.addEventListener("resize",s),r.addEventListener("orientationchange",n))}),e("destroy",()=>{i&&i.unobserve&&a.el&&(i.unobserve(a.el),i=null),r.removeEventListener("resize",s),r.removeEventListener("orientationchange",n)})}function Observer({swiper:e,extendParams:t,on:r,emit:n}){const a=[],s=getWindow(),i=(e,t={})=>{const r=s.MutationObserver||s.WebkitMutationObserver,i=new r(e=>{var t;1!==e.length?(t=function(){n("observerUpdate",e[0])},s.requestAnimationFrame?s.requestAnimationFrame(t):s.setTimeout(t,0)):n("observerUpdate",e[0])});i.observe(e,{attributes:void 0===t.attributes||t.attributes,childList:void 0===t.childList||t.childList,characterData:void 0===t.characterData||t.characterData}),a.push(i)};t({observer:!1,observeParents:!1,observeSlideChildren:!1}),r("init",()=>{if(e.params.observer){if(e.params.observeParents){var t=e.$el.parents();for(let e=0;e<t.length;e+=1)i(t[e])}i(e.$el[0],{childList:e.params.observeSlideChildren}),i(e.$wrapperEl[0],{attributes:!1})}}),r("destroy",()=>{a.forEach(e=>{e.disconnect()}),a.splice(0,a.length)})}var eventsEmitter={on(e,t,r){const i=this;if("function"!=typeof t)return i;const n=r?"unshift":"push";return e.split(" ").forEach(e=>{i.eventsListeners[e]||(i.eventsListeners[e]=[]),i.eventsListeners[e][n](t)}),i},once(t,r,e){const i=this;return"function"!=typeof r?i:(n.__emitterProxy=r,i.on(t,n,e));function n(...e){i.off(t,n),n.__emitterProxy&&delete n.__emitterProxy,r.apply(i,e)}},onAny(e,t){if("function"!=typeof e)return this;t=t?"unshift":"push";return this.eventsAnyListeners.indexOf(e)<0&&this.eventsAnyListeners[t](e),this},offAny(e){if(!this.eventsAnyListeners)return this;e=this.eventsAnyListeners.indexOf(e);return 0<=e&&this.eventsAnyListeners.splice(e,1),this},off(e,i){const n=this;return n.eventsListeners&&e.split(" ").forEach(r=>{void 0===i?n.eventsListeners[r]=[]:n.eventsListeners[r]&&n.eventsListeners[r].forEach((e,t)=>{(e===i||e.__emitterProxy&&e.__emitterProxy===i)&&n.eventsListeners[r].splice(t,1)})}),n},emit(...e){const r=this;if(!r.eventsListeners)return r;let t,i,n;n="string"==typeof e[0]||Array.isArray(e[0])?(t=e[0],i=e.slice(1,e.length),r):(t=e[0].events,i=e[0].data,e[0].context||r),i.unshift(n);const a=Array.isArray(t)?t:t.split(" ");return a.forEach(t=>{r.eventsAnyListeners&&r.eventsAnyListeners.length&&r.eventsAnyListeners.forEach(e=>{e.apply(n,[t,...i])}),r.eventsListeners&&r.eventsListeners[t]&&r.eventsListeners[t].forEach(e=>{e.apply(n,i)})}),r}};function updateSize(){var e=this;let t,r;const i=e.$el;t=void 0!==e.params.width&&null!==e.params.width?e.params.width:i[0].clientWidth,r=void 0!==e.params.height&&null!==e.params.height?e.params.height:i[0].clientHeight,0===t&&e.isHorizontal()||0===r&&e.isVertical()||(t=t-parseInt(i.css("padding-left")||0,10)-parseInt(i.css("padding-right")||0,10),r=r-parseInt(i.css("padding-top")||0,10)-parseInt(i.css("padding-bottom")||0,10),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=0),Object.assign(e,{width:t,height:r,size:e.isHorizontal()?t:r}))}function updateSlides(){const r=this;function i(e){return r.isHorizontal()?e:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[e]}function n(e,t){return parseFloat(e.getPropertyValue(i(t))||0)}const a=r.params,{$wrapperEl:e,size:s,rtlTranslate:o,wrongRTL:l}=r;var c=r.virtual&&a.virtual.enabled,h=(c?r.virtual:r).slides.length;const u=e.children(`.${r.params.slideClass}`);var d=(c?r.virtual.slides:u).length;let p=[];const f=[],m=[];let g=a.slidesOffsetBefore;"function"==typeof g&&(g=a.slidesOffsetBefore.call(r));let _=a.slidesOffsetAfter;"function"==typeof _&&(_=a.slidesOffsetAfter.call(r));var v=r.snapGrid.length,y=r.slidesGrid.length;let x=a.spaceBetween,b=-g,w=0,T=0;if(void 0!==s){"string"==typeof x&&0<=x.indexOf("%")&&(x=parseFloat(x.replace("%",""))/100*s),r.virtualSize=-x,o?u.css({marginLeft:"",marginBottom:"",marginTop:""}):u.css({marginRight:"",marginBottom:"",marginTop:""}),a.centeredSlides&&a.cssMode&&(setCSSProperty(r.wrapperEl,"--swiper-centered-offset-before",""),setCSSProperty(r.wrapperEl,"--swiper-centered-offset-after",""));var E=a.grid&&1<a.grid.rows&&r.grid;E&&r.grid.initSlides(d);let t;var S="auto"===a.slidesPerView&&a.breakpoints&&0<Object.keys(a.breakpoints).filter(e=>void 0!==a.breakpoints[e].slidesPerView).length;for(let e=0;e<d;e+=1){t=0;const k=u.eq(e);if(E&&r.grid.updateSlide(e,k,d,i),"none"!==k.css("display")){if("auto"===a.slidesPerView){S&&(u[e].style[i("width")]="");const B=getComputedStyle(k[0]);var M,A,C,L,P,I,R,D=k[0].style.transform,O=k[0].style.webkitTransform;D&&(k[0].style.transform="none"),O&&(k[0].style.webkitTransform="none"),t=a.roundLengths?r.isHorizontal()?k.outerWidth(!0):k.outerHeight(!0):(M=n(B,"width"),A=n(B,"padding-left"),C=n(B,"padding-right"),L=n(B,"margin-left"),P=n(B,"margin-right"),(R=B.getPropertyValue("box-sizing"))&&"border-box"===R?M+L+P:({clientWidth:I,offsetWidth:R}=k[0],M+A+C+L+P+(R-I))),D&&(k[0].style.transform=D),O&&(k[0].style.webkitTransform=O),a.roundLengths&&(t=Math.floor(t))}else t=(s-(a.slidesPerView-1)*x)/a.slidesPerView,a.roundLengths&&(t=Math.floor(t)),u[e]&&(u[e].style[i("width")]=`${t}px`);u[e]&&(u[e].swiperSlideSize=t),m.push(t),a.centeredSlides?(b=b+t/2+w/2+x,0===w&&0!==e&&(b=b-s/2-x),0===e&&(b=b-s/2-x),Math.abs(b)<.001&&(b=0),a.roundLengths&&(b=Math.floor(b)),T%a.slidesPerGroup==0&&p.push(b),f.push(b)):(a.roundLengths&&(b=Math.floor(b)),(T-Math.min(r.params.slidesPerGroupSkip,T))%r.params.slidesPerGroup==0&&p.push(b),f.push(b),b=b+t+x),r.virtualSize+=t+x,w=t,T+=1}}if(r.virtualSize=Math.max(r.virtualSize,s)+_,o&&l&&("slide"===a.effect||"coverflow"===a.effect)&&e.css({width:`${r.virtualSize+a.spaceBetween}px`}),a.setWrapperSize&&e.css({[i("width")]:`${r.virtualSize+a.spaceBetween}px`}),E&&r.grid.updateWrapperSize(t,p,i),!a.centeredSlides){const F=[];for(let t=0;t<p.length;t+=1){let e=p[t];a.roundLengths&&(e=Math.floor(e)),p[t]<=r.virtualSize-s&&F.push(e)}p=F,1<Math.floor(r.virtualSize-s)-Math.floor(p[p.length-1])&&p.push(r.virtualSize-s)}if(0===p.length&&(p=[0]),0!==a.spaceBetween&&(c=r.isHorizontal()&&o?"marginLeft":i("marginRight"),u.filter((e,t)=>!a.cssMode||t!==u.length-1).css({[c]:`${x}px`})),a.centeredSlides&&a.centeredSlidesBounds){let t=0;m.forEach(e=>{t+=e+(a.spaceBetween||0)}),t-=a.spaceBetween;const z=t-s;p=p.map(e=>e<0?-g:e>z?z+_:e)}if(a.centerInsufficientSlides){let t=0;if(m.forEach(e=>{t+=e+(a.spaceBetween||0)}),t-=a.spaceBetween,t<s){const N=(s-t)/2;p.forEach((e,t)=>{p[t]=e-N}),f.forEach((e,t)=>{f[t]=e+N})}}if(Object.assign(r,{slides:u,snapGrid:p,slidesGrid:f,slidesSizesGrid:m}),a.centeredSlides&&a.cssMode&&!a.centeredSlidesBounds){setCSSProperty(r.wrapperEl,"--swiper-centered-offset-before",`${-p[0]}px`),setCSSProperty(r.wrapperEl,"--swiper-centered-offset-after",`${r.size/2-m[m.length-1]/2}px`);const U=-r.snapGrid[0],G=-r.slidesGrid[0];r.snapGrid=r.snapGrid.map(e=>e+U),r.slidesGrid=r.slidesGrid.map(e=>e+G)}d!==h&&r.emit("slidesLengthChange"),p.length!==v&&(r.params.watchOverflow&&r.checkOverflow(),r.emit("snapGridLengthChange")),f.length!==y&&r.emit("slidesGridLengthChange"),a.watchSlidesProgress&&r.updateSlidesOffset()}}function updateAutoHeight(e){const r=this,t=[],i=r.virtual&&r.params.virtual.enabled;let n=0,a;"number"==typeof e?r.setTransition(e):!0===e&&r.setTransition(r.params.speed);var s,o=t=>(i?r.slides.filter(e=>parseInt(e.getAttribute("data-swiper-slide-index"),10)===t):r.slides.eq(t))[0];if("auto"!==r.params.slidesPerView&&1<r.params.slidesPerView)if(r.params.centeredSlides)r.visibleSlides.each(e=>{t.push(e)});else for(a=0;a<Math.ceil(r.params.slidesPerView);a+=1){var l=r.activeIndex+a;if(l>r.slides.length&&!i)break;t.push(o(l))}else t.push(o(r.activeIndex));for(a=0;a<t.length;a+=1)void 0!==t[a]&&(s=t[a].offsetHeight,n=s>n?s:n);n&&r.$wrapperEl.css("height",`${n}px`)}function updateSlidesOffset(){const t=this.slides;for(let e=0;e<t.length;e+=1)t[e].swiperSlideOffset=this.isHorizontal()?t[e].offsetLeft:t[e].offsetTop}function updateSlidesProgress(e=this&&this.translate||0){var i=this,n=i.params;const{slides:a,rtlTranslate:s,snapGrid:o}=i;if(0!==a.length){void 0===a[0].swiperSlideOffset&&i.updateSlidesOffset();let r=s?e:-e;a.removeClass(n.slideVisibleClass),i.visibleSlidesIndexes=[],i.visibleSlides=[];for(let t=0;t<a.length;t+=1){const d=a[t];let e=d.swiperSlideOffset;n.cssMode&&n.centeredSlides&&(e-=a[0].swiperSlideOffset);var l=(r+(n.centeredSlides?i.minTranslate():0)-e)/(d.swiperSlideSize+n.spaceBetween),c=(r-o[0]+(n.centeredSlides?i.minTranslate():0)-e)/(d.swiperSlideSize+n.spaceBetween),h=-(r-e),u=h+i.slidesSizesGrid[t];(0<=h&&h<i.size-1||1<u&&u<=i.size||h<=0&&u>=i.size)&&(i.visibleSlides.push(d),i.visibleSlidesIndexes.push(t),a.eq(t).addClass(n.slideVisibleClass)),d.progress=s?-l:l,d.originalProgress=s?-c:c}i.visibleSlides=$(i.visibleSlides)}}function updateProgress(e){var t=this;void 0===e&&(l=t.rtlTranslate?-1:1,e=t&&t.translate&&t.translate*l||0);var r=t.params,i=t.maxTranslate()-t.minTranslate();let{progress:n,isBeginning:a,isEnd:s}=t;var o=a,l=s;s=0==i?(n=0,a=!0):(n=(e-t.minTranslate())/i,a=n<=0,1<=n),Object.assign(t,{progress:n,isBeginning:a,isEnd:s}),(r.watchSlidesProgress||r.centeredSlides&&r.autoHeight)&&t.updateSlidesProgress(e),a&&!o&&t.emit("reachBeginning toEdge"),s&&!l&&t.emit("reachEnd toEdge"),(o&&!a||l&&!s)&&t.emit("fromEdge"),t.emit("progress",n)}function updateSlidesClasses(){const{slides:e,params:t,$wrapperEl:r,activeIndex:i,realIndex:n}=this;var a=this.virtual&&t.virtual.enabled;e.removeClass(`${t.slideActiveClass} ${t.slideNextClass} ${t.slidePrevClass} ${t.slideDuplicateActiveClass} ${t.slideDuplicateNextClass} ${t.slideDuplicatePrevClass}`);let s;s=a?this.$wrapperEl.find(`.${t.slideClass}[data-swiper-slide-index="${i}"]`):e.eq(i),s.addClass(t.slideActiveClass),t.loop&&(s.hasClass(t.slideDuplicateClass)?r.children(`.${t.slideClass}:not(.${t.slideDuplicateClass})[data-swiper-slide-index="${n}"]`):r.children(`.${t.slideClass}.${t.slideDuplicateClass}[data-swiper-slide-index="${n}"]`)).addClass(t.slideDuplicateActiveClass);let o=s.nextAll(`.${t.slideClass}`).eq(0).addClass(t.slideNextClass);t.loop&&0===o.length&&(o=e.eq(0),o.addClass(t.slideNextClass));let l=s.prevAll(`.${t.slideClass}`).eq(0).addClass(t.slidePrevClass);t.loop&&0===l.length&&(l=e.eq(-1),l.addClass(t.slidePrevClass)),t.loop&&((o.hasClass(t.slideDuplicateClass)?r.children(`.${t.slideClass}:not(.${t.slideDuplicateClass})[data-swiper-slide-index="${o.attr("data-swiper-slide-index")}"]`):r.children(`.${t.slideClass}.${t.slideDuplicateClass}[data-swiper-slide-index="${o.attr("data-swiper-slide-index")}"]`)).addClass(t.slideDuplicateNextClass),(l.hasClass(t.slideDuplicateClass)?r.children(`.${t.slideClass}:not(.${t.slideDuplicateClass})[data-swiper-slide-index="${l.attr("data-swiper-slide-index")}"]`):r.children(`.${t.slideClass}.${t.slideDuplicateClass}[data-swiper-slide-index="${l.attr("data-swiper-slide-index")}"]`)).addClass(t.slideDuplicatePrevClass)),this.emitSlidesClasses()}function updateActiveIndex(e){var t,r=this,i=r.rtlTranslate?r.translate:-r.translate;const{slidesGrid:n,snapGrid:a,params:s,activeIndex:o,realIndex:l,snapIndex:c}=r;let h=e,u;if(void 0===h){for(let e=0;e<n.length;e+=1)void 0!==n[e+1]?i>=n[e]&&i<n[e+1]-(n[e+1]-n[e])/2?h=e:i>=n[e]&&i<n[e+1]&&(h=e+1):i>=n[e]&&(h=e);s.normalizeSlideIndex&&(h<0||void 0===h)&&(h=0)}u=0<=a.indexOf(i)?a.indexOf(i):(t=Math.min(s.slidesPerGroupSkip,h))+Math.floor((h-t)/s.slidesPerGroup),u>=a.length&&(u=a.length-1),h!==o?(t=parseInt(r.slides.eq(h).attr("data-swiper-slide-index")||h,10),Object.assign(r,{snapIndex:u,realIndex:t,previousIndex:o,activeIndex:h}),r.emit("activeIndexChange"),r.emit("snapIndexChange"),l!==t&&r.emit("realIndexChange"),(r.initialized||r.params.runCallbacksOnInit)&&r.emit("slideChange")):u!==c&&(r.snapIndex=u,r.emit("snapIndexChange"))}function updateClickedSlide(e){var t=this,r=t.params,i=$(e.target).closest(`.${r.slideClass}`)[0];let n=!1,a;if(i)for(let e=0;e<t.slides.length;e+=1)if(t.slides[e]===i){n=!0,a=e;break}if(!i||!n)return t.clickedSlide=void 0,void(t.clickedIndex=void 0);t.clickedSlide=i,t.virtual&&t.params.virtual.enabled?t.clickedIndex=parseInt($(i).attr("data-swiper-slide-index"),10):t.clickedIndex=a,r.slideToClickedSlide&&void 0!==t.clickedIndex&&t.clickedIndex!==t.activeIndex&&t.slideToClickedSlide()}var update={updateSize:updateSize,updateSlides:updateSlides,updateAutoHeight:updateAutoHeight,updateSlidesOffset:updateSlidesOffset,updateSlidesProgress:updateSlidesProgress,updateProgress:updateProgress,updateSlidesClasses:updateSlidesClasses,updateActiveIndex:updateActiveIndex,updateClickedSlide:updateClickedSlide};function getSwiperTranslate(e=this.isHorizontal()?"x":"y"){var{params:t,rtlTranslate:r,translate:i,$wrapperEl:n}=this;if(t.virtualTranslate)return r?-i:i;if(t.cssMode)return i;let a=getTranslate(n[0],e);return r&&(a=-a),a||0}function setTranslate(e,t){var r=this;const{rtlTranslate:i,params:n,$wrapperEl:a,wrapperEl:s,progress:o}=r;let l=0,c=0;r.isHorizontal()?l=i?-e:e:c=e,n.roundLengths&&(l=Math.floor(l),c=Math.floor(c)),n.cssMode?s[r.isHorizontal()?"scrollLeft":"scrollTop"]=r.isHorizontal()?-l:-c:n.virtualTranslate||a.transform(`translate3d(${l}px, ${c}px, 0px)`),r.previousTranslate=r.translate,r.translate=r.isHorizontal()?l:c;let h;var u=r.maxTranslate()-r.minTranslate();h=0==u?0:(e-r.minTranslate())/u,h!==o&&r.updateProgress(e),r.emit("setTranslate",r.translate,t)}function minTranslate(){return-this.snapGrid[0]}function maxTranslate(){return-this.snapGrid[this.snapGrid.length-1]}function translateTo(e=0,t=this.params.speed,r=!0,i=!0,n){const a=this,{params:s,wrapperEl:o}=a;if(a.animating&&s.preventInteractionOnTransition)return!1;var l=a.minTranslate(),c=a.maxTranslate();let h;if(h=i&&l<e?l:i&&e<c?c:e,a.updateProgress(h),s.cssMode){e=a.isHorizontal();if(0===t)o[e?"scrollLeft":"scrollTop"]=-h;else{if(!a.support.smoothScroll)return animateCSSModeScroll({swiper:a,targetPosition:-h,side:e?"left":"top"}),!0;o.scrollTo({[e?"left":"top"]:-h,behavior:"smooth"})}return!0}return 0===t?(a.setTransition(0),a.setTranslate(h),r&&(a.emit("beforeTransitionStart",t,n),a.emit("transitionEnd"))):(a.setTransition(t),a.setTranslate(h),r&&(a.emit("beforeTransitionStart",t,n),a.emit("transitionStart")),a.animating||(a.animating=!0,a.onTranslateToWrapperTransitionEnd||(a.onTranslateToWrapperTransitionEnd=function(e){a&&!a.destroyed&&e.target===this&&(a.$wrapperEl[0].removeEventListener("transitionend",a.onTranslateToWrapperTransitionEnd),a.$wrapperEl[0].removeEventListener("webkitTransitionEnd",a.onTranslateToWrapperTransitionEnd),a.onTranslateToWrapperTransitionEnd=null,delete a.onTranslateToWrapperTransitionEnd,r&&a.emit("transitionEnd"))}),a.$wrapperEl[0].addEventListener("transitionend",a.onTranslateToWrapperTransitionEnd),a.$wrapperEl[0].addEventListener("webkitTransitionEnd",a.onTranslateToWrapperTransitionEnd))),!0}var translate={getTranslate:getSwiperTranslate,setTranslate:setTranslate,minTranslate:minTranslate,maxTranslate:maxTranslate,translateTo:translateTo};function setTransition(e,t){this.params.cssMode||this.$wrapperEl.transition(e),this.emit("setTransition",e,t)}function transitionEmit({swiper:e,runCallbacks:t,direction:r,step:i}){var{activeIndex:n,previousIndex:a}=e;let s=r;s=s||(a<n?"next":n<a?"prev":"reset"),e.emit(`transition${i}`),t&&n!==a&&("reset"!==s?(e.emit(`slideChangeTransition${i}`),"next"===s?e.emit(`slideNextTransition${i}`):e.emit(`slidePrevTransition${i}`)):e.emit(`slideResetTransition${i}`))}function transitionStart(e=!0,t){var r=this["params"];r.cssMode||(r.autoHeight&&this.updateAutoHeight(),transitionEmit({swiper:this,runCallbacks:e,direction:t,step:"Start"}))}function transitionEnd(e=!0,t){var r=this["params"];this.animating=!1,r.cssMode||(this.setTransition(0),transitionEmit({swiper:this,runCallbacks:e,direction:t,step:"End"}))}var transition={setTransition:setTransition,transitionStart:transitionStart,transitionEnd:transitionEnd};function slideTo(e=0,t=this.params.speed,r=!0,i,n){if("number"!=typeof e&&"string"!=typeof e)throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof e}] given.`);if("string"==typeof e){var a=parseInt(e,10);if(!isFinite(a))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${e}] given.`);e=a}const s=this;let o=e;o<0&&(o=0);const{params:l,snapGrid:c,slidesGrid:h,previousIndex:u,activeIndex:d,rtlTranslate:p,wrapperEl:f,enabled:m}=s;if(s.animating&&l.preventInteractionOnTransition||!m&&!i&&!n)return!1;a=Math.min(s.params.slidesPerGroupSkip,o);let g=a+Math.floor((o-a)/s.params.slidesPerGroup);g>=c.length&&(g=c.length-1),(d||l.initialSlide||0)===(u||0)&&r&&s.emit("beforeSlideChangeStart");var _=-c[g];if(s.updateProgress(_),l.normalizeSlideIndex)for(let e=0;e<h.length;e+=1){var v=-Math.floor(100*_),y=Math.floor(100*h[e]),x=Math.floor(100*h[e+1]);void 0!==h[e+1]?y<=v&&v<x-(x-y)/2?o=e:y<=v&&v<x&&(o=e+1):y<=v&&(o=e)}if(s.initialized&&o!==d){if(!s.allowSlideNext&&_<s.translate&&_<s.minTranslate())return!1;if(!s.allowSlidePrev&&_>s.translate&&_>s.maxTranslate()&&(d||0)!==o)return!1}let b;if(b=o>d?"next":o<d?"prev":"reset",p&&-_===s.translate||!p&&_===s.translate)return s.updateActiveIndex(o),l.autoHeight&&s.updateAutoHeight(),s.updateSlidesClasses(),"slide"!==l.effect&&s.setTranslate(_),"reset"!==b&&(s.transitionStart(r,b),s.transitionEnd(r,b)),!1;if(l.cssMode){e=s.isHorizontal(),n=p?_:-_;if(0===t){a=s.virtual&&s.params.virtual.enabled;a&&(s.wrapperEl.style.scrollSnapType="none",s._immediateVirtual=!0),f[e?"scrollLeft":"scrollTop"]=n,a&&requestAnimationFrame(()=>{s.wrapperEl.style.scrollSnapType="",s._swiperImmediateVirtual=!1})}else{if(!s.support.smoothScroll)return animateCSSModeScroll({swiper:s,targetPosition:n,side:e?"left":"top"}),!0;f.scrollTo({[e?"left":"top"]:n,behavior:"smooth"})}return!0}return 0===t?(s.setTransition(0),s.setTranslate(_),s.updateActiveIndex(o),s.updateSlidesClasses(),s.emit("beforeTransitionStart",t,i),s.transitionStart(r,b),s.transitionEnd(r,b)):(s.setTransition(t),s.setTranslate(_),s.updateActiveIndex(o),s.updateSlidesClasses(),s.emit("beforeTransitionStart",t,i),s.transitionStart(r,b),s.animating||(s.animating=!0,s.onSlideToWrapperTransitionEnd||(s.onSlideToWrapperTransitionEnd=function(e){s&&!s.destroyed&&e.target===this&&(s.$wrapperEl[0].removeEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.$wrapperEl[0].removeEventListener("webkitTransitionEnd",s.onSlideToWrapperTransitionEnd),s.onSlideToWrapperTransitionEnd=null,delete s.onSlideToWrapperTransitionEnd,s.transitionEnd(r,b))}),s.$wrapperEl[0].addEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.$wrapperEl[0].addEventListener("webkitTransitionEnd",s.onSlideToWrapperTransitionEnd))),!0}function slideToLoop(e=0,t=this.params.speed,r=!0,i){let n=e;return this.params.loop&&(n+=this.loopedSlides),this.slideTo(n,t,r,i)}function slideNext(e=this.params.speed,t=!0,r){var{animating:i,enabled:n,params:a}=this;if(!n)return this;let s=a.slidesPerGroup;"auto"===a.slidesPerView&&1===a.slidesPerGroup&&a.slidesPerGroupAuto&&(s=Math.max(this.slidesPerViewDynamic("current",!0),1));n=this.activeIndex<a.slidesPerGroupSkip?1:s;if(a.loop){if(i&&a.loopPreventsSlide)return!1;this.loopFix(),this._clientLeft=this.$wrapperEl[0].clientLeft}return this.slideTo(this.activeIndex+n,e,t,r)}function slidePrev(e=this.params.speed,t=!0,r){var i=this;const{params:n,animating:a,snapGrid:s,slidesGrid:o,rtlTranslate:l,enabled:c}=i;if(!c)return i;if(n.loop){if(a&&n.loopPreventsSlide)return!1;i.loopFix(),i._clientLeft=i.$wrapperEl[0].clientLeft}function h(e){return e<0?-Math.floor(Math.abs(e)):Math.floor(e)}const u=h(l?i.translate:-i.translate),d=s.map(e=>h(e));let p=s[d.indexOf(u)-1];if(void 0===p&&n.cssMode){let r;s.forEach((e,t)=>{u>=e&&(r=t)}),void 0!==r&&(p=s[0<r?r-1:r])}let f=0;return void 0!==p&&(f=o.indexOf(p),f<0&&(f=i.activeIndex-1),"auto"===n.slidesPerView&&1===n.slidesPerGroup&&n.slidesPerGroupAuto&&(f=f-i.slidesPerViewDynamic("previous",!0)+1,f=Math.max(f,0))),i.slideTo(f,e,t,r)}function slideReset(e=this.params.speed,t=!0,r){return this.slideTo(this.activeIndex,e,t,r)}function slideToClosest(e=this.params.speed,t=!0,r,i=.5){var n=this;let a=n.activeIndex;var s=Math.min(n.params.slidesPerGroupSkip,a),o=s+Math.floor((a-s)/n.params.slidesPerGroup),l=n.rtlTranslate?n.translate:-n.translate;return l>=n.snapGrid[o]?(s=n.snapGrid[o],(n.snapGrid[o+1]-s)*i<l-s&&(a+=n.params.slidesPerGroup)):l-(l=n.snapGrid[o-1])<=(n.snapGrid[o]-l)*i&&(a-=n.params.slidesPerGroup),a=Math.max(a,0),a=Math.min(a,n.slidesGrid.length-1),n.slideTo(a,e,t,r)}function slideToClickedSlide(){const e=this,{params:t,$wrapperEl:r}=e;var i,n="auto"===t.slidesPerView?e.slidesPerViewDynamic():t.slidesPerView;let a=e.clickedIndex;t.loop?e.animating||(i=parseInt($(e.clickedSlide).attr("data-swiper-slide-index"),10),t.centeredSlides?a<e.loopedSlides-n/2||a>e.slides.length-e.loopedSlides+n/2?(e.loopFix(),a=r.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(),nextTick(()=>{e.slideTo(a)})):e.slideTo(a):a>e.slides.length-n?(e.loopFix(),a=r.children(`.${t.slideClass}[data-swiper-slide-index="${i}"]:not(.${t.slideDuplicateClass})`).eq(0).index(),nextTick(()=>{e.slideTo(a)})):e.slideTo(a)):e.slideTo(a)}var slide={slideTo:slideTo,slideToLoop:slideToLoop,slideNext:slideNext,slidePrev:slidePrev,slideReset:slideReset,slideToClosest:slideToClosest,slideToClickedSlide:slideToClickedSlide};function loopCreate(){const i=this,t=getDocument(),{params:r,$wrapperEl:e}=i,n=0<e.children().length?$(e.children()[0].parentNode):e;n.children(`.${r.slideClass}.${r.slideDuplicateClass}`).remove();let a=n.children(`.${r.slideClass}`);if(r.loopFillGroupWithBlank){var s=r.slidesPerGroup-a.length%r.slidesPerGroup;if(s!==r.slidesPerGroup){for(let e=0;e<s;e+=1){var o=$(t.createElement("div")).addClass(`${r.slideClass} ${r.slideBlankClass}`);n.append(o)}a=n.children(`.${r.slideClass}`)}}"auto"!==r.slidesPerView||r.loopedSlides||(r.loopedSlides=a.length),i.loopedSlides=Math.ceil(parseFloat(r.loopedSlides||r.slidesPerView,10)),i.loopedSlides+=r.loopAdditionalSlides,i.loopedSlides>a.length&&(i.loopedSlides=a.length);const l=[],c=[];a.each((e,t)=>{const r=$(e);t<i.loopedSlides&&c.push(e),t<a.length&&t>=a.length-i.loopedSlides&&l.push(e),r.attr("data-swiper-slide-index",t)});for(let e=0;e<c.length;e+=1)n.append($(c[e].cloneNode(!0)).addClass(r.slideDuplicateClass));for(let e=l.length-1;0<=e;--e)n.prepend($(l[e].cloneNode(!0)).addClass(r.slideDuplicateClass))}function loopFix(){var e=this;e.emit("beforeLoopFix");var{activeIndex:t,slides:r,loopedSlides:i,allowSlidePrev:n,allowSlideNext:a,snapGrid:s,rtlTranslate:o}=e;let l;e.allowSlidePrev=!0,e.allowSlideNext=!0;s=-s[t]-e.getTranslate();t<i?(l=r.length-3*i+t,l+=i,e.slideTo(l,0,!1,!0)&&0!=s&&e.setTranslate((o?-e.translate:e.translate)-s)):t>=r.length-i&&(l=-r.length+t+i,l+=i,e.slideTo(l,0,!1,!0)&&0!=s&&e.setTranslate((o?-e.translate:e.translate)-s)),e.allowSlidePrev=n,e.allowSlideNext=a,e.emit("loopFix")}function loopDestroy(){const{$wrapperEl:e,params:t,slides:r}=this;e.children(`.${t.slideClass}.${t.slideDuplicateClass},.${t.slideClass}.${t.slideBlankClass}`).remove(),r.removeAttr("data-swiper-slide-index")}var loop={loopCreate:loopCreate,loopFix:loopFix,loopDestroy:loopDestroy};function setGrabCursor(e){if(!(this.support.touch||!this.params.simulateTouch||this.params.watchOverflow&&this.isLocked||this.params.cssMode)){const t="container"===this.params.touchEventsTarget?this.el:this.wrapperEl;t.style.cursor="move",t.style.cursor=e?"-webkit-grabbing":"-webkit-grab",t.style.cursor=e?"-moz-grabbin":"-moz-grab",t.style.cursor=e?"grabbing":"grab"}}function unsetGrabCursor(){this.support.touch||this.params.watchOverflow&&this.isLocked||this.params.cssMode||(this["container"===this.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="")}var grabCursor={setGrabCursor:setGrabCursor,unsetGrabCursor:unsetGrabCursor};function closestElement(r,e=this){return function e(t){return t&&t!==getDocument()&&t!==getWindow()?(t=t.assignedSlot||t).closest(r)||e(t.getRootNode().host):null}(e)}function onTouchStart(e){var i=this;const n=getDocument();var a=getWindow();const s=i.touchEventsData,{params:o,touches:l,enabled:t}=i;if(t&&(!i.animating||!o.preventInteractionOnTransition)){!i.animating&&o.cssMode&&o.loop&&i.loopFix();let t=e;t.originalEvent&&(t=t.originalEvent);let r=$(t.target);if(("wrapper"!==o.touchEventsTarget||r.closest(i.wrapperEl).length)&&(s.isTouchEvent="touchstart"===t.type,(s.isTouchEvent||!("which"in t)||3!==t.which)&&!(!s.isTouchEvent&&"button"in t&&0<t.button||s.isTouched&&s.isMoved))){!!o.noSwipingClass&&""!==o.noSwipingClass&&t.target&&t.target.shadowRoot&&e.path&&e.path[0]&&(r=$(e.path[0]));var c=o.noSwipingSelector||`.${o.noSwipingClass}`,h=!(!t.target||!t.target.shadowRoot);if(o.noSwiping&&(h?closestElement(c,t.target):r.closest(c)[0]))i.allowClick=!0;else if(!o.swipeHandler||r.closest(o.swipeHandler)[0]){l.currentX=("touchstart"===t.type?t.targetTouches[0]:t).pageX,l.currentY=("touchstart"===t.type?t.targetTouches[0]:t).pageY;var u=l.currentX,d=l.currentY,h=o.edgeSwipeDetection||o.iOSEdgeSwipeDetection,c=o.edgeSwipeThreshold||o.iOSEdgeSwipeThreshold;if(h&&(u<=c||u>=a.innerWidth-c)){if("prevent"!==h)return;e.preventDefault()}if(Object.assign(s,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),l.startX=u,l.startY=d,s.touchStartTime=now$1(),i.allowClick=!0,i.updateSize(),i.swipeDirection=void 0,0<o.threshold&&(s.allowThresholdMove=!1),"touchstart"!==t.type){let e=!0;r.is(s.focusableElements)&&(e=!1),n.activeElement&&$(n.activeElement).is(s.focusableElements)&&n.activeElement!==r[0]&&n.activeElement.blur();d=e&&i.allowTouchMove&&o.touchStartPreventDefault;!o.touchStartForcePreventDefault&&!d||r[0].isContentEditable||t.preventDefault()}i.emit("touchStart",t)}}}}function onTouchMove(n){var a=getDocument(),s=this;const o=s.touchEventsData,{params:l,touches:c,rtlTranslate:h,enabled:e}=s;if(e){let i=n;if(i.originalEvent&&(i=i.originalEvent),o.isTouched){if(!o.isTouchEvent||"touchmove"===i.type){var t="touchmove"===i.type&&i.targetTouches&&(i.targetTouches[0]||i.changedTouches[0]),n=("touchmove"===i.type?t:i).pageX,t=("touchmove"===i.type?t:i).pageY;if(i.preventedByNestedSwiper)return c.startX=n,void(c.startY=t);if(!s.allowTouchMove)return s.allowClick=!1,void(o.isTouched&&(Object.assign(c,{startX:n,startY:t,currentX:n,currentY:t}),o.touchStartTime=now$1()));if(o.isTouchEvent&&l.touchReleaseOnEdges&&!l.loop)if(s.isVertical()){if(t<c.startY&&s.translate<=s.maxTranslate()||t>c.startY&&s.translate>=s.minTranslate())return o.isTouched=!1,void(o.isMoved=!1)}else if(n<c.startX&&s.translate<=s.maxTranslate()||n>c.startX&&s.translate>=s.minTranslate())return;if(o.isTouchEvent&&a.activeElement&&i.target===a.activeElement&&$(i.target).is(o.focusableElements))return o.isMoved=!0,void(s.allowClick=!1);if(o.allowTouchCallbacks&&s.emit("touchMove",i),!(i.targetTouches&&1<i.targetTouches.length)){c.currentX=n,c.currentY=t;a=c.currentX-c.startX,n=c.currentY-c.startY;if(!(s.params.threshold&&Math.sqrt(a**2+n**2)<s.params.threshold))if(void 0===o.isScrolling&&(s.isHorizontal()&&c.currentY===c.startY||s.isVertical()&&c.currentX===c.startX?o.isScrolling=!1:25<=a*a+n*n&&(t=180*Math.atan2(Math.abs(n),Math.abs(a))/Math.PI,o.isScrolling=s.isHorizontal()?t>l.touchAngle:90-t>l.touchAngle)),o.isScrolling&&s.emit("touchMoveOpposite",i),void 0===o.startMoving&&(c.currentX===c.startX&&c.currentY===c.startY||(o.startMoving=!0)),o.isScrolling)o.isTouched=!1;else if(o.startMoving){s.allowClick=!1,!l.cssMode&&i.cancelable&&i.preventDefault(),l.touchMoveStopPropagation&&!l.nested&&i.stopPropagation(),o.isMoved||(l.loop&&!l.cssMode&&s.loopFix(),o.startTranslate=s.getTranslate(),s.setTransition(0),s.animating&&s.$wrapperEl.trigger("webkitTransitionEnd transitionend"),o.allowMomentumBounce=!1,!l.grabCursor||!0!==s.allowSlideNext&&!0!==s.allowSlidePrev||s.setGrabCursor(!0),s.emit("sliderFirstMove",i)),s.emit("sliderMove",i),o.isMoved=!0;let e=s.isHorizontal()?a:n;c.diff=e,e*=l.touchRatio,h&&(e=-e),s.swipeDirection=0<e?"prev":"next",o.currentTranslate=e+o.startTranslate;let t=!0,r=l.resistanceRatio;if(l.touchReleaseOnEdges&&(r=0),0<e&&o.currentTranslate>s.minTranslate()?(t=!1,l.resistance&&(o.currentTranslate=s.minTranslate()-1+(-s.minTranslate()+o.startTranslate+e)**r)):e<0&&o.currentTranslate<s.maxTranslate()&&(t=!1,l.resistance&&(o.currentTranslate=s.maxTranslate()+1-(s.maxTranslate()-o.startTranslate-e)**r)),t&&(i.preventedByNestedSwiper=!0),!s.allowSlideNext&&"next"===s.swipeDirection&&o.currentTranslate<o.startTranslate&&(o.currentTranslate=o.startTranslate),!s.allowSlidePrev&&"prev"===s.swipeDirection&&o.currentTranslate>o.startTranslate&&(o.currentTranslate=o.startTranslate),s.allowSlidePrev||s.allowSlideNext||(o.currentTranslate=o.startTranslate),0<l.threshold){if(!(Math.abs(e)>l.threshold||o.allowThresholdMove))return void(o.currentTranslate=o.startTranslate);if(!o.allowThresholdMove)return o.allowThresholdMove=!0,c.startX=c.currentX,c.startY=c.currentY,o.currentTranslate=o.startTranslate,void(c.diff=s.isHorizontal()?c.currentX-c.startX:c.currentY-c.startY)}l.followFinger&&!l.cssMode&&((l.freeMode&&l.freeMode.enabled&&s.freeMode||l.watchSlidesProgress)&&(s.updateActiveIndex(),s.updateSlidesClasses()),s.params.freeMode&&l.freeMode.enabled&&s.freeMode&&s.freeMode.onTouchMove(),s.updateProgress(o.currentTranslate),s.setTranslate(o.currentTranslate))}}}}else o.startMoving&&o.isScrolling&&s.emit("touchMoveOpposite",i)}}function onTouchEnd(n){const a=this,t=a.touchEventsData;var{params:s,touches:r,rtlTranslate:o,slidesGrid:l,enabled:c}=a;if(c){let e=n;if(e.originalEvent&&(e=e.originalEvent),t.allowTouchCallbacks&&a.emit("touchEnd",e),t.allowTouchCallbacks=!1,!t.isTouched)return t.isMoved&&s.grabCursor&&a.setGrabCursor(!1),t.isMoved=!1,void(t.startMoving=!1);s.grabCursor&&t.isMoved&&t.isTouched&&(!0===a.allowSlideNext||!0===a.allowSlidePrev)&&a.setGrabCursor(!1);c=now$1(),n=c-t.touchStartTime;if(a.allowClick&&(a.updateClickedSlide(e),a.emit("tap click",e),n<300&&c-t.lastClickTime<300&&a.emit("doubleTap doubleClick",e)),t.lastClickTime=now$1(),nextTick(()=>{a.destroyed||(a.allowClick=!0)}),!t.isTouched||!t.isMoved||!a.swipeDirection||0===r.diff||t.currentTranslate===t.startTranslate)return t.isTouched=!1,t.isMoved=!1,void(t.startMoving=!1);t.isTouched=!1,t.isMoved=!1,t.startMoving=!1;let i;if(i=s.followFinger?o?a.translate:-a.translate:-t.currentTranslate,!s.cssMode)if(a.params.freeMode&&s.freeMode.enabled)a.freeMode.onTouchEnd({currentPos:i});else{let t=0,r=a.slidesSizesGrid[0];for(let e=0;e<l.length;e+=e<s.slidesPerGroupSkip?1:s.slidesPerGroup){const h=e<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;void 0!==l[e+h]?i>=l[e]&&i<l[e+h]&&(t=e,r=l[e+h]-l[e]):i>=l[e]&&(t=e,r=l[l.length-1]-l[l.length-2])}o=(i-l[t])/r;const h=t<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;n>s.longSwipesMs?s.longSwipes?("next"===a.swipeDirection&&(o>=s.longSwipesRatio?a.slideTo(t+h):a.slideTo(t)),"prev"===a.swipeDirection&&(o>1-s.longSwipesRatio?a.slideTo(t+h):a.slideTo(t))):a.slideTo(a.activeIndex):s.shortSwipes?a.navigation&&(e.target===a.navigation.nextEl||e.target===a.navigation.prevEl)?e.target===a.navigation.nextEl?a.slideTo(t+h):a.slideTo(t):("next"===a.swipeDirection&&a.slideTo(t+h),"prev"===a.swipeDirection&&a.slideTo(t)):a.slideTo(a.activeIndex)}}}function onResize(){var e,t,r=this,{params:i,el:n}=r;n&&0===n.offsetWidth||(i.breakpoints&&r.setBreakpoint(),{allowSlideNext:e,allowSlidePrev:t,snapGrid:n}=r,r.allowSlideNext=!0,r.allowSlidePrev=!0,r.updateSize(),r.updateSlides(),r.updateSlidesClasses(),("auto"===i.slidesPerView||1<i.slidesPerView)&&r.isEnd&&!r.isBeginning&&!r.params.centeredSlides?r.slideTo(r.slides.length-1,0,!1,!0):r.slideTo(r.activeIndex,0,!1,!0),r.autoplay&&r.autoplay.running&&r.autoplay.paused&&r.autoplay.run(),r.allowSlidePrev=t,r.allowSlideNext=e,r.params.watchOverflow&&n!==r.snapGrid&&r.checkOverflow())}function onClick(e){this.enabled&&(this.allowClick||(this.params.preventClicks&&e.preventDefault(),this.params.preventClicksPropagation&&this.animating&&(e.stopPropagation(),e.stopImmediatePropagation())))}function onScroll(){var t=this,{wrapperEl:r,rtlTranslate:i,enabled:e}=t;if(e){t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-r.scrollLeft:t.translate=-r.scrollTop,-0===t.translate&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();let e;r=t.maxTranslate()-t.minTranslate();e=0==r?0:(t.translate-t.minTranslate())/r,e!==t.progress&&t.updateProgress(i?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}}let dummyEventAttached=!1;function dummyEventListener(){}const events=(e,t)=>{const r=getDocument(),{params:i,touchEvents:n,el:a,wrapperEl:s,device:o,support:l}=e;var c=!!i.nested,h="on"===t?"addEventListener":"removeEventListener",u=t;l.touch?(t=!("touchstart"!==n.start||!l.passiveListener||!i.passiveListeners)&&{passive:!0,capture:!1},a[h](n.start,e.onTouchStart,t),a[h](n.move,e.onTouchMove,l.passiveListener?{passive:!1,capture:c}:c),a[h](n.end,e.onTouchEnd,t),n.cancel&&a[h](n.cancel,e.onTouchEnd,t)):(a[h](n.start,e.onTouchStart,!1),r[h](n.move,e.onTouchMove,c),r[h](n.end,e.onTouchEnd,!1)),(i.preventClicks||i.preventClicksPropagation)&&a[h]("click",e.onClick,!0),i.cssMode&&s[h]("scroll",e.onScroll),i.updateOnWindowResize?e[u](o.ios||o.android?"resize orientationchange observerUpdate":"resize observerUpdate",onResize,!0):e[u]("observerUpdate",onResize,!0)};function attachEvents(){var e=this;const t=getDocument();var{params:r,support:i}=e;e.onTouchStart=onTouchStart.bind(e),e.onTouchMove=onTouchMove.bind(e),e.onTouchEnd=onTouchEnd.bind(e),r.cssMode&&(e.onScroll=onScroll.bind(e)),e.onClick=onClick.bind(e),i.touch&&!dummyEventAttached&&(t.addEventListener("touchstart",dummyEventListener),dummyEventAttached=!0),events(e,"on")}function detachEvents(){events(this,"off")}var events$1={attachEvents:attachEvents,detachEvents:detachEvents};const isGridEnabled=(e,t)=>e.grid&&t.grid&&1<t.grid.rows;function setBreakpoint(){var e=this;const{activeIndex:t,initialized:r,loopedSlides:i=0,params:n,$el:a}=e;var s,o,l,c,h=n.breakpoints;!h||0===Object.keys(h).length||(s=e.getBreakpoint(h,e.params.breakpointsBase,e.el))&&e.currentBreakpoint!==s&&(o=(s in h?h[s]:void 0)||e.originalParams,c=isGridEnabled(e,n),l=isGridEnabled(e,o),h=n.enabled,c&&!l?(a.removeClass(`${n.containerModifierClass}grid ${n.containerModifierClass}grid-column`),e.emitContainerClasses()):!c&&l&&(a.addClass(`${n.containerModifierClass}grid`),(o.grid.fill&&"column"===o.grid.fill||!o.grid.fill&&"column"===n.grid.fill)&&a.addClass(`${n.containerModifierClass}grid-column`),e.emitContainerClasses()),c=o.direction&&o.direction!==n.direction,l=n.loop&&(o.slidesPerView!==n.slidesPerView||c),c&&r&&e.changeDirection(),extend(e.params,o),c=e.params.enabled,Object.assign(e,{allowTouchMove:e.params.allowTouchMove,allowSlideNext:e.params.allowSlideNext,allowSlidePrev:e.params.allowSlidePrev}),h&&!c?e.disable():!h&&c&&e.enable(),e.currentBreakpoint=s,e.emit("_beforeBreakpoint",o),l&&r&&(e.loopDestroy(),e.loopCreate(),e.updateSlides(),e.slideTo(t-i+e.loopedSlides,0,!1)),e.emit("breakpoint",o))}function getBreakpoint(e,r="window",i){if(e&&("container"!==r||i)){let t=!1;const s=getWindow(),o="window"===r?s.innerHeight:i.clientHeight,l=Object.keys(e).map(e=>{if("string"!=typeof e||0!==e.indexOf("@"))return{value:e,point:e};var t=parseFloat(e.substr(1));return{value:o*t,point:e}});l.sort((e,t)=>parseInt(e.value,10)-parseInt(t.value,10));for(let e=0;e<l.length;e+=1){var{point:n,value:a}=l[e];"window"===r?s.matchMedia(`(min-width: ${a}px)`).matches&&(t=n):a<=i.clientWidth&&(t=n)}return t||"max"}}var breakpoints={setBreakpoint:setBreakpoint,getBreakpoint:getBreakpoint};function prepareClasses(e,r){const i=[];return e.forEach(t=>{"object"==typeof t?Object.keys(t).forEach(e=>{t[e]&&i.push(r+e)}):"string"==typeof t&&i.push(r+t)}),i}function addClasses(){const{classNames:e,params:t,rtl:r,$el:i,device:n,support:a}=this;var s=prepareClasses(["initialized",t.direction,{"pointer-events":!a.touch},{"free-mode":this.params.freeMode&&t.freeMode.enabled},{autoheight:t.autoHeight},{rtl:r},{grid:t.grid&&1<t.grid.rows},{"grid-column":t.grid&&1<t.grid.rows&&"column"===t.grid.fill},{android:n.android},{ios:n.ios},{"css-mode":t.cssMode},{centered:t.cssMode&&t.centeredSlides}],t.containerModifierClass);e.push(...s),i.addClass([...e].join(" ")),this.emitContainerClasses()}function removeClasses(){const{$el:e,classNames:t}=this;e.removeClass(t.join(" ")),this.emitContainerClasses()}var classes={addClasses:addClasses,removeClasses:removeClasses};function loadImage(e,t,r,i,n,a){const s=getWindow();let o;function l(){a&&a()}!($(e).parent("picture")[0]||e.complete&&n)&&t?(o=new s.Image,o.onload=l,o.onerror=l,i&&(o.sizes=i),r&&(o.srcset=r),t&&(o.src=t)):l()}function preloadImages(){const t=this;function r(){void 0!==t&&null!==t&&t&&!t.destroyed&&(void 0!==t.imagesLoaded&&(t.imagesLoaded+=1),t.imagesLoaded===t.imagesToLoad.length&&(t.params.updateOnImagesReady&&t.update(),t.emit("imagesReady")))}t.imagesToLoad=t.$el.find("img");for(let e=0;e<t.imagesToLoad.length;e+=1){const i=t.imagesToLoad[e];t.loadImage(i,i.currentSrc||i.getAttribute("src"),i.srcset||i.getAttribute("srcset"),i.sizes||i.getAttribute("sizes"),!0,r)}}var images={loadImage:loadImage,preloadImages:preloadImages};function checkOverflow(){var e,t=this,{isLocked:r,params:i}=t,n=i["slidesOffsetBefore"];n?(e=t.slides.length-1,n=t.slidesGrid[e]+t.slidesSizesGrid[e]+2*n,t.isLocked=t.size>n):t.isLocked=1===t.snapGrid.length,!0===i.allowSlideNext&&(t.allowSlideNext=!t.isLocked),!0===i.allowSlidePrev&&(t.allowSlidePrev=!t.isLocked),r&&r!==t.isLocked&&(t.isEnd=!1),r!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}var checkOverflow$1={checkOverflow:checkOverflow},defaults={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function moduleExtendParams(i,n){return function(e={}){var t=Object.keys(e)[0],r=e[t];"object"==typeof r&&null!==r&&(0<=["navigation","pagination","scrollbar"].indexOf(t)&&!0===i[t]&&(i[t]={auto:!0}),t in i&&"enabled"in r&&(!0===i[t]&&(i[t]={enabled:!0}),"object"!=typeof i[t]||"enabled"in i[t]||(i[t].enabled=!0),i[t]||(i[t]={enabled:!1}))),extend(n,e)}}const prototypes={eventsEmitter:eventsEmitter,update:update,translate:translate,transition:transition,slide:slide,loop:loop,grabCursor:grabCursor,events:events$1,breakpoints:breakpoints,checkOverflow:checkOverflow$1,classes:classes,images:images},extendedDefaults={};class Swiper{constructor(...e){let t,r;if(1===e.length&&e[0].constructor&&"Object"===Object.prototype.toString.call(e[0]).slice(8,-1)?r=e[0]:[t,r]=e,r=r||{},r=extend({},r),t&&!r.el&&(r.el=t),r.el&&1<$(r.el).length){const s=[];return $(r.el).each(e=>{e=extend({},r,{el:e});s.push(new Swiper(e))}),s}const i=this;i.__swiper__=!0,i.support=getSupport(),i.device=getDevice({userAgent:r.userAgent}),i.browser=getBrowser(),i.eventsListeners={},i.eventsAnyListeners=[],i.modules=[...i.__modules__],r.modules&&Array.isArray(r.modules)&&i.modules.push(...r.modules);const n={};i.modules.forEach(e=>{e({swiper:i,extendParams:moduleExtendParams(r,n),on:i.on.bind(i),once:i.once.bind(i),off:i.off.bind(i),emit:i.emit.bind(i)})});var a=extend({},defaults,n);return i.params=extend({},a,extendedDefaults,r),i.originalParams=extend({},i.params),i.passedParams=extend({},r),i.params&&i.params.on&&Object.keys(i.params.on).forEach(e=>{i.on(e,i.params.on[e])}),i.params&&i.params.onAny&&i.onAny(i.params.onAny),i.$=$,Object.assign(i,{enabled:i.params.enabled,el:t,classNames:[],slides:$(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return"horizontal"===i.params.direction},isVertical(){return"vertical"===i.params.direction},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:i.params.allowSlideNext,allowSlidePrev:i.params.allowSlidePrev,touchEvents:(e=["touchstart","touchmove","touchend","touchcancel"],a=["pointerdown","pointermove","pointerup"],i.touchEventsTouch={start:e[0],move:e[1],end:e[2],cancel:e[3]},i.touchEventsDesktop={start:a[0],move:a[1],end:a[2]},i.support.touch||!i.params.simulateTouch?i.touchEventsTouch:i.touchEventsDesktop),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:i.params.focusableElements,lastClickTime:now$1(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:i.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),i.emit("_swiper"),i.params.init&&i.init(),i}enable(){this.enabled||(this.enabled=!0,this.params.grabCursor&&this.setGrabCursor(),this.emit("enable"))}disable(){this.enabled&&(this.enabled=!1,this.params.grabCursor&&this.unsetGrabCursor(),this.emit("disable"))}setProgress(e,t){e=Math.min(Math.max(e,0),1);var r=this.minTranslate(),i=this.maxTranslate();this.translateTo((i-r)*e+r,void 0===t?0:t),this.updateActiveIndex(),this.updateSlidesClasses()}emitContainerClasses(){const t=this;if(t.params._emitClasses&&t.el){const e=t.el.className.split(" ").filter(e=>0===e.indexOf("swiper")||0===e.indexOf(t.params.containerModifierClass));t.emit("_containerClasses",e.join(" "))}}getSlideClasses(e){const t=this;return e.className.split(" ").filter(e=>0===e.indexOf("swiper-slide")||0===e.indexOf(t.params.slideClass)).join(" ")}emitSlidesClasses(){const r=this;if(r.params._emitClasses&&r.el){const i=[];r.slides.each(e=>{var t=r.getSlideClasses(e);i.push({slideEl:e,classNames:t}),r.emit("_slideClass",e,t)}),r.emit("_slideClasses",i)}}slidesPerViewDynamic(e="current",t=!1){var{params:r,slides:i,slidesGrid:n,slidesSizesGrid:a,size:s,activeIndex:o}=this;let l=1;if(r.centeredSlides){let t=i[o].swiperSlideSize,r;for(let e=o+1;e<i.length;e+=1)i[e]&&!r&&(t+=i[e].swiperSlideSize,l+=1,t>s&&(r=!0));for(let e=o-1;0<=e;--e)i[e]&&!r&&(t+=i[e].swiperSlideSize,l+=1,t>s&&(r=!0))}else if("current"===e)for(let e=o+1;e<i.length;e+=1)(t?n[e]+a[e]-n[o]<s:n[e]-n[o]<s)&&(l+=1);else for(let e=o-1;0<=e;--e)n[o]-n[e]<s&&(l+=1);return l}update(){const t=this;if(t&&!t.destroyed){var{snapGrid:r,params:i}=t;i.breakpoints&&t.setBreakpoint(),t.updateSize(),t.updateSlides(),t.updateProgress(),t.updateSlidesClasses();let e;function n(){var e=t.rtlTranslate?-1*t.translate:t.translate,e=Math.min(Math.max(e,t.maxTranslate()),t.minTranslate());t.setTranslate(e),t.updateActiveIndex(),t.updateSlidesClasses()}t.params.freeMode&&t.params.freeMode.enabled?(n(),t.params.autoHeight&&t.updateAutoHeight()):(e=("auto"===t.params.slidesPerView||1<t.params.slidesPerView)&&t.isEnd&&!t.params.centeredSlides?t.slideTo(t.slides.length-1,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0),e||n()),i.watchOverflow&&r!==t.snapGrid&&t.checkOverflow(),t.emit("update")}}changeDirection(t,e=!0){var r=this,i=r.params.direction;return(t=t||("horizontal"===i?"vertical":"horizontal"))===i||"horizontal"!==t&&"vertical"!==t||(r.$el.removeClass(`${r.params.containerModifierClass}${i}`).addClass(`${r.params.containerModifierClass}${t}`),r.emitContainerClasses(),r.params.direction=t,r.slides.each(e=>{"vertical"===t?e.style.width="":e.style.height=""}),r.emit("changeDirection"),e&&r.update()),r}mount(t){const e=this;if(e.mounted)return!0;const r=$(t||e.params.el);if(!(t=r[0]))return!1;t.swiper=e;const i=()=>`.${(e.params.wrapperClass||"").trim().split(" ").join(".")}`;let n=(()=>{if(t&&t.shadowRoot&&t.shadowRoot.querySelector){const e=$(t.shadowRoot.querySelector(i()));return e.children=e=>r.children(e),e}return r.children(i())})();if(0===n.length&&e.params.createElements){const a=getDocument(),s=a.createElement("div");n=$(s),s.className=e.params.wrapperClass,r.append(s),r.children(`.${e.params.slideClass}`).each(e=>{n.append(e)})}return Object.assign(e,{$el:r,el:t,$wrapperEl:n,wrapperEl:n[0],mounted:!0,rtl:"rtl"===t.dir.toLowerCase()||"rtl"===r.css("direction"),rtlTranslate:"horizontal"===e.params.direction&&("rtl"===t.dir.toLowerCase()||"rtl"===r.css("direction")),wrongRTL:"-webkit-box"===n.css("display")}),!0}init(e){var t=this;return t.initialized||!1===t.mount(e)||(t.emit("beforeInit"),t.params.breakpoints&&t.setBreakpoint(),t.addClasses(),t.params.loop&&t.loopCreate(),t.updateSize(),t.updateSlides(),t.params.watchOverflow&&t.checkOverflow(),t.params.grabCursor&&t.enabled&&t.setGrabCursor(),t.params.preloadImages&&t.preloadImages(),t.params.loop?t.slideTo(t.params.initialSlide+t.loopedSlides,0,t.params.runCallbacksOnInit,!1,!0):t.slideTo(t.params.initialSlide,0,t.params.runCallbacksOnInit,!1,!0),t.attachEvents(),t.initialized=!0,t.emit("init"),t.emit("afterInit")),t}destroy(e=!0,t=!0){const r=this,{params:i,$el:n,$wrapperEl:a,slides:s}=r;return void 0===r.params||r.destroyed||(r.emit("beforeDestroy"),r.initialized=!1,r.detachEvents(),i.loop&&r.loopDestroy(),t&&(r.removeClasses(),n.removeAttr("style"),a.removeAttr("style"),s&&s.length&&s.removeClass([i.slideVisibleClass,i.slideActiveClass,i.slideNextClass,i.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),r.emit("destroy"),Object.keys(r.eventsListeners).forEach(e=>{r.off(e)}),!1!==e&&(r.$el[0].swiper=null,deleteProps(r)),r.destroyed=!0),null}static extendDefaults(e){extend(extendedDefaults,e)}static get extendedDefaults(){return extendedDefaults}static get defaults(){return defaults}static installModule(e){Swiper.prototype.__modules__||(Swiper.prototype.__modules__=[]);const t=Swiper.prototype.__modules__;"function"==typeof e&&t.indexOf(e)<0&&t.push(e)}static use(e){return Array.isArray(e)?e.forEach(e=>Swiper.installModule(e)):Swiper.installModule(e),Swiper}}function createElementIfNotDefined(r,i,n,a){const s=getDocument();return r.params.createElements&&Object.keys(a).forEach(t=>{if(!n[t]&&!0===n.auto){let e=r.$el.children(`.${a[t]}`)[0];e||(e=s.createElement("div"),e.className=a[t],r.$el.append(e)),n[t]=e,i[t]=e}}),n}function classesToSelector(e=""){return`.${e.trim().replace(/([\.:!\/])/g,"\\$1").replace(/ /g,".")}`}function Pagination({swiper:p,extendParams:e,on:t,emit:f}){var r="swiper-pagination";e({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:e=>e,formatFractionTotal:e=>e,bulletClass:`${r}-bullet`,bulletActiveClass:`${r}-bullet-active`,modifierClass:`${r}-`,currentClass:`${r}-current`,totalClass:`${r}-total`,hiddenClass:`${r}-hidden`,progressbarFillClass:`${r}-progressbar-fill`,progressbarOppositeClass:`${r}-progressbar-opposite`,clickableClass:`${r}-clickable`,lockClass:`${r}-lock`,horizontalClass:`${r}-horizontal`,verticalClass:`${r}-vertical`}}),p.pagination={el:null,$el:null,bullets:[]};let m,g=0;function _(){return!p.params.pagination.el||!p.pagination.el||!p.pagination.$el||0===p.pagination.$el.length}function v(e,t){var r=p.params.pagination["bulletActiveClass"];e[t]().addClass(`${r}-${t}`)[t]().addClass(`${r}-${t}-${t}`)}function i(){var t=p.rtl;const a=p.params.pagination;if(!_()){var s=(p.virtual&&p.params.virtual.enabled?p.virtual:p).slides.length;const h=p.pagination.$el;let n;var i=p.params.loop?Math.ceil((s-2*p.loopedSlides)/p.params.slidesPerGroup):p.snapGrid.length;if(p.params.loop?(n=Math.ceil((p.activeIndex-p.loopedSlides)/p.params.slidesPerGroup),n>s-1-2*p.loopedSlides&&(n-=s-2*p.loopedSlides),n>i-1&&(n-=i),n<0&&"bullets"!==p.params.paginationType&&(n=i+n)):n=void 0!==p.snapIndex?p.snapIndex:p.activeIndex||0,"bullets"===a.type&&p.pagination.bullets&&0<p.pagination.bullets.length){const u=p.pagination.bullets;let r,i,e;if(a.dynamicBullets&&(m=u.eq(0)[p.isHorizontal()?"outerWidth":"outerHeight"](!0),h.css(p.isHorizontal()?"width":"height",`${m*(a.dynamicMainBullets+4)}px`),1<a.dynamicMainBullets&&void 0!==p.previousIndex&&(g+=n-p.previousIndex,g>a.dynamicMainBullets-1?g=a.dynamicMainBullets-1:g<0&&(g=0)),r=n-g,i=r+(Math.min(u.length,a.dynamicMainBullets)-1),e=(i+r)/2),u.removeClass(["","-next","-next-next","-prev","-prev-prev","-main"].map(e=>`${a.bulletActiveClass}${e}`).join(" ")),1<h.length)u.each(e=>{const t=$(e);e=t.index();e===n&&t.addClass(a.bulletActiveClass),a.dynamicBullets&&(e>=r&&e<=i&&t.addClass(`${a.bulletActiveClass}-main`),e===r&&v(t,"prev"),e===i&&v(t,"next"))});else{const d=u.eq(n);var o=d.index();if(d.addClass(a.bulletActiveClass),a.dynamicBullets){var l=u.eq(r),s=u.eq(i);for(let e=r;e<=i;e+=1)u.eq(e).addClass(`${a.bulletActiveClass}-main`);if(p.params.loop)if(o>=u.length-a.dynamicMainBullets){for(let e=a.dynamicMainBullets;0<=e;--e)u.eq(u.length-e).addClass(`${a.bulletActiveClass}-main`);u.eq(u.length-a.dynamicMainBullets-1).addClass(`${a.bulletActiveClass}-prev`)}else v(l,"prev"),v(s,"next");else v(l,"prev"),v(s,"next")}}a.dynamicBullets&&(c=Math.min(u.length,a.dynamicMainBullets+4),c=(m*c-m)/2-e*m,t=t?"right":"left",u.css(p.isHorizontal()?t:"top",`${c}px`))}if("fraction"===a.type&&(h.find(classesToSelector(a.currentClass)).text(a.formatFractionCurrent(n+1)),h.find(classesToSelector(a.totalClass)).text(a.formatFractionTotal(i))),"progressbar"===a.type){let e;e=a.progressbarOpposite?p.isHorizontal()?"vertical":"horizontal":p.isHorizontal()?"horizontal":"vertical";var c=(n+1)/i;let t=1,r=1;"horizontal"===e?t=c:r=c,h.find(classesToSelector(a.progressbarFillClass)).transform(`translate3d(0,0,0) scaleX(${t}) scaleY(${r})`).transition(p.params.speed)}"custom"===a.type&&a.renderCustom?(h.html(a.renderCustom(p,n+1,i)),f("paginationRender",h[0])):f("paginationUpdate",h[0]),p.params.watchOverflow&&p.enabled&&h[p.isLocked?"addClass":"removeClass"](a.lockClass)}}function n(){const i=p.params.pagination;if(!_()){var e=(p.virtual&&p.params.virtual.enabled?p.virtual:p).slides.length;const n=p.pagination.$el;let r="";if("bullets"===i.type){let t=p.params.loop?Math.ceil((e-2*p.loopedSlides)/p.params.slidesPerGroup):p.snapGrid.length;p.params.freeMode&&p.params.freeMode.enabled&&!p.params.loop&&t>e&&(t=e);for(let e=0;e<t;e+=1)i.renderBullet?r+=i.renderBullet.call(p,e,i.bulletClass):r+=`<${i.bulletElement} class="${i.bulletClass}"></${i.bulletElement}>`;n.html(r),p.pagination.bullets=n.find(classesToSelector(i.bulletClass))}"fraction"===i.type&&(r=i.renderFraction?i.renderFraction.call(p,i.currentClass,i.totalClass):`<span class="${i.currentClass}"></span>`+" / "+`<span class="${i.totalClass}"></span>`,n.html(r)),"progressbar"===i.type&&(r=i.renderProgressbar?i.renderProgressbar.call(p,i.progressbarFillClass):`<span class="${i.progressbarFillClass}"></span>`,n.html(r)),"custom"!==i.type&&f("paginationRender",p.pagination.$el[0])}}function a(){p.params.pagination=createElementIfNotDefined(p,p.originalParams.pagination,p.params.pagination,{el:"swiper-pagination"});const t=p.params.pagination;if(t.el){let e=$(t.el);0!==e.length&&(p.params.uniqueNavElements&&"string"==typeof t.el&&1<e.length&&(e=p.$el.find(t.el),1<e.length&&(e=e.filter(e=>$(e).parents(".swiper")[0]===p.el))),"bullets"===t.type&&t.clickable&&e.addClass(t.clickableClass),e.addClass(t.modifierClass+t.type),e.addClass(t.modifierClass+p.params.direction),"bullets"===t.type&&t.dynamicBullets&&(e.addClass(`${t.modifierClass}${t.type}-dynamic`),g=0,t.dynamicMainBullets<1&&(t.dynamicMainBullets=1)),"progressbar"===t.type&&t.progressbarOpposite&&e.addClass(t.progressbarOppositeClass),t.clickable&&e.on("click",classesToSelector(t.bulletClass),function(e){e.preventDefault();let t=$(this).index()*p.params.slidesPerGroup;p.params.loop&&(t+=p.loopedSlides),p.slideTo(t)}),Object.assign(p.pagination,{$el:e,el:e[0]}),p.enabled||e.addClass(t.lockClass))}}function s(){var e=p.params.pagination;if(!_()){const t=p.pagination.$el;t.removeClass(e.hiddenClass),t.removeClass(e.modifierClass+e.type),t.removeClass(e.modifierClass+p.params.direction),p.pagination.bullets&&p.pagination.bullets.removeClass&&p.pagination.bullets.removeClass(e.bulletActiveClass),e.clickable&&t.off("click",classesToSelector(e.bulletClass))}}t("init",()=>{a(),n(),i()}),t("activeIndexChange",()=>{(p.params.loop||void 0===p.snapIndex)&&i()}),t("snapIndexChange",()=>{p.params.loop||i()}),t("slidesLengthChange",()=>{p.params.loop&&(n(),i())}),t("snapGridLengthChange",()=>{p.params.loop||(n(),i())}),t("destroy",()=>{s()}),t("enable disable",()=>{const e=p.pagination["$el"];e&&e[p.enabled?"removeClass":"addClass"](p.params.pagination.lockClass)}),t("lock unlock",()=>{i()}),t("click",(e,t)=>{t=t.target;const r=p.pagination["$el"];p.params.pagination.el&&p.params.pagination.hideOnClick&&0<r.length&&!$(t).hasClass(p.params.pagination.bulletClass)&&(p.navigation&&(p.navigation.nextEl&&t===p.navigation.nextEl||p.navigation.prevEl&&t===p.navigation.prevEl)||(t=r.hasClass(p.params.pagination.hiddenClass),f(!0===t?"paginationShow":"paginationHide"),r.toggleClass(p.params.pagination.hiddenClass)))}),Object.assign(p.pagination,{render:n,update:i,init:a,destroy:s})}Object.keys(prototypes).forEach(t=>{Object.keys(prototypes[t]).forEach(e=>{Swiper.prototype[e]=prototypes[t][e]})}),Swiper.use([Resize,Observer]);class SearchPanel extends Panel{constructor(e){super(Object.assign({className:"search-panel"},e))}addTo(o){const l=this,{lang:t,dict:r}=o,i=o.clock.getJSTDate(),e=i.getMonth()+1,n=i.getDate(),a=i.getHours(),s=i.getMinutes();o.trackObject(),super.addTo(o).setHTML(`
<div id="search-form">
    <div class="search-form-element">${r["from-station"]} <input id="origin" class="search-input" type="text" list="stations"></div>
    <div class="search-form-element">${r["to-station"]} <input id="destination" class="search-input" type="text" list="stations"></div>
    <div class="search-form-element">
        <select id="type" class="search-select">
            <option value="departure" selected>${r["depart-at"]}</option>
        </select>
        <select id="month" class="search-select">
            <option value="${e}" selected>${i.toLocaleDateString(t,{month:"short"})}</option>
        </select>
        <select id="date" class="search-select">
            <option value="${n}" selected>${i.toLocaleDateString(t,{day:"numeric"})}</option>
        </select>
        <select id="hours" class="search-select"></select>
        <select id="minutes" class="search-select"></select>
    </div>
    <div class="search-form-element"><button id="search-button" class="search-button">${r["search-route"]}</button></div>
</div>
<div id="search-load">
    <div class="ball-pulse"><div></div><div></div><div></div></div>
</div>
<div id="search-result" class="swiper-container">
    <div class="swiper-wrapper"></div>
    <div class="swiper-pagination"></div>
</div>`);const c=l._container,h=c.querySelector("#origin"),u=c.querySelector("#destination"),d=c.querySelector("#hours"),p=c.querySelector("#minutes"),f=c.querySelector("#search-button");var m=({target:e})=>{e.style.borderColor="#777",e.value?(delete l.focus,e.classList.remove("search-focus")):(l.focus=e.id,e.classList.add("search-focus"))},g=({target:e})=>{h.classList.remove("search-focus"),u.classList.remove("search-focus"),l.focus=e.id,e.classList.add("search-focus")};h.addEventListener("input",m),h.addEventListener("focus",g),u.addEventListener("input",m),u.addEventListener("focus",g),h.placeholder=r["station-name"],u.placeholder=r["station-name"];for(let e=0;e<24;e++)i.setHours(e),createElement("option",{value:e,text:i.toLocaleTimeString(t,{hour:"numeric"}),selected:e===a},d);for(let e=0;e<60;e++)i.setMinutes(e),createElement("option",{value:e,text:`${i.toLocaleTimeString(t,{minute:"numeric"})}${r.minute}`,selected:e===s},p);return f.addEventListener("click",()=>{var e=o.stationTitleLookup[h.value.toUpperCase()],t=o.stationTitleLookup[u.value.toUpperCase()],r=c.querySelector("#type").value,i=c.querySelector("#month").value,n=c.querySelector("#date").value,a=d.value,s=p.value;if(delete l.focus,h.classList.remove("search-focus"),u.classList.remove("search-focus"),!e||!t||e===t)return h.style.borderColor=e&&e!==t?"#777":"#f90",void(u.style.borderColor=t&&e!==t?"#777":"#f90");h.style.borderColor="#777",u.style.borderColor="#777",c.classList.remove("search-form"),c.classList.add("search-load"),loadJSON(`${configs.searchUrl}?origin=${e.id}&destination=${t.id}&type=${r}&month=${i}&date=${n}&hours=${a}&minutes=${s}`).then(e=>{c.classList.remove("search-load"),l.showResult(e)})}),l.showForm(),o.touchDevice?(l.focus="origin",h.classList.add("search-focus")):c.addEventListener("transitionend",()=>{h.focus()},{once:!0}),l.popups=[],l}showForm(){this.setTitle(this._map.dict["route-search"]).setButtons(),this._container.classList.add("search-form")}fillStationName(t){if(this.focus){const r=this._container;let e=r.querySelector(`#${this.focus}`);e.style.borderColor="#777",e.value=t,e.classList.remove("search-focus"),this.focus="origin"===this.focus?"destination":"origin",e=r.querySelector(`#${this.focus}`),e.value?delete this.focus:(e.classList.add("search-focus"),this._map.touchDevice||e.focus())}}showResult(e){const t=this,r=t._map,{lang:i,dict:n,clock:a}=r,s=t._container,o=createElement("div",{innerHTML:['<button id="back-button" class="back-button">','<span class="back-icon"></span>',"</button>"].join("")}),l=createElement("div",{className:"page-controller",innerHTML:['<span><button id="previous-button" class="previous-button">','<span class="previous-icon"></span>',"</button></span>",'<span><button id="next-button" class="next-button">','<span class="next-icon"></span>',"</button></span>"].join("")}),c=s.querySelector(".swiper-wrapper");if(t._result=e,r._setSearchMode("route"),s.classList.add("search-result"),o.addEventListener("click",e=>{e.stopPropagation()}),o.querySelector("#back-button").addEventListener("click",()=>{t._swiper&&(t._swiper.destroy(),delete t._swiper,t.hideRoute()),s.classList.remove("search-result"),t.showForm(),r._setSearchMode("edit"),r.refreshMap()}),l.addEventListener("click",e=>{e.stopPropagation()}),l.querySelector("#previous-button").addEventListener("click",()=>{t._swiper.slidePrev()}),l.querySelector("#next-button").addEventListener("click",()=>{t._swiper.slideNext()}),c.innerHTML="",e.routes){t.setButtons([o,l]);for(const y of e.routes){const x=createElement("div",{className:"swiper-slide",innerHTML:['<div class="swiper-slide-content">','<div id="search-routes"></div>','<svg id="railway-mark"></svg>',"</div>"].join("")},c),b=x.querySelector("#search-routes"),w=x.querySelector("#railway-mark"),T=[],E=[],S=[];let e;for(var{r:h,y:u,ds:d,d:p,tt:f,nm:m,transfer:g,delay:_}of y.trains){const M=m?m.map(e=>e[i]||e.en).join(n.and):r.getLocalizedRailwayTitle(h),A=r.getLocalizedTrainTypeTitle(u),C=d?n.for.replace("$1",r.getLocalizedStationTitle(d)):r.getLocalizedRailDirectionTitle(p),L={};if(L.start=E.length,E.push(['<div class="station-row">',`<div class="station-title-box">${r.getLocalizedStationTitle(f[0].s)}</div>`,`<div class="station-time-box${_?" desc-caution":""}">`,e?`${a.getTimeString(a.getTime(e)+6e4*_)}<br>`:"",a.getTimeString(a.getTime(f[0].d)+6e4*_),"</div></div>"].join("")),E.push(['<div class="station-row">',`<div class="train-title-box">${M} ${A} ${C}`,_?` <span class="desc-caution">${n.delay.replace("$1",_)}</span>`:"","</div></div>"].join("")),L.end=E.length,L.color=r.railwayLookup[h].color,T.push(L),0===g)e=f[f.length-1].a;else{if(E.push(['<div class="station-row">',`<div class="station-title-box">${r.getLocalizedStationTitle(f[f.length-1].s)}</div>`,`<div class="station-time-box${_?" desc-caution":""}">`,a.getTimeString(a.getTime(f[f.length-1].a||f[f.length-1].d)+6e4*_),"</div></div>"].join("")),0<g){const P={};P.start=E.length-1,E.push(['<div class="station-row">',`<div class="train-title-box">${n["transfer-and-wait"].replace("$1",g)}</div>`,"</div>"].join("")),P.end=E.length,T.push(P)}e=void 0}}b.innerHTML=E.join("");var v=b["children"];for(let e=0,t=v.length;e<t;e++){const I=v[e];S.push(I.offsetTop+I.getBoundingClientRect().height/2)}w.innerHTML=T.map(({color:e,start:t,end:r})=>e?`<line stroke="${e}" stroke-width="10" x1="12" y1="${S[t]}" x2="12" y2="${S[r]}" stroke-linecap="round" />`:`<line stroke="#7f7f7f" stroke-width="4" x1="12" y1="${S[t]}" x2="12" y2="${S[r]}" stroke-dasharray="4 4" />`).concat(S.map((e,t)=>t%2==0?`<circle cx="12" cy="${e}" r="3" fill="#ffffff" />`:"")).join("")}t._swiper=new Swiper(".swiper-container",{modules:[Pagination],pagination:{el:".swiper-pagination",clickable:!0}}),t._swiper.on("slideChange",()=>{t.hideRoute()}),t._swiper.on("slideChangeTransitionEnd",()=>{t.switchRoute()}),t.switchRoute()}else t.setButtons([o]),c.innerHTML=['<div class="swiper-slide">','<div class="swiper-slide-content">',n["cannot-find-train"],"</div></div>"].join("")}switchRoute(){const i=this,n=i._map,{dict:a,map:s}=n,e=i._container,t=i._swiper,r=t.activeIndex,o=i._result.routes[r],l=[],c=[],h=[];i.setTitle([`${a.route}${r+1} `,a.transfers.replace("$1",o.numTransfers)].join("")),e.querySelector("#previous-button").disabled=t.isBeginning,e.querySelector("#next-button").disabled=t.isEnd;for(var{r:u,tt:d,d:p}of o.trains){const{stations:y,ascending:x}=n.railwayLookup[u];for(var{s:f}of d){f=n.stationLookup[f];c.push(f.group),h.push(f.coord)}if(p===x){var m=y.indexOf(d[0].s),g=y.indexOf(d[d.length-1].s,m);for(let e=m;e<g;e++)l.push(`${u}.${e+1}`)}else{var m=y.lastIndexOf(d[0].s),_=y.lastIndexOf(d[d.length-1].s,m);for(let e=m;e>_;e--)l.push(`${u}.${e}`)}}for(const b of[13,14,15,16,17,18]){let e=s.getLayer(`railways-routeug-${b}`).implementation;e.setProps({data:featureFilter(n.featureCollection,e=>e.zoom===b&&e.altitude<0&&includes(l,e.section))}),e=s.getLayer(`stations-routeug-${b}`).implementation,e.setProps({data:featureFilter(n.featureCollection,e=>e.zoom===b&&e.altitude<0&&includes(c,e.group))}),e=s.getLayer(`railways-routeog-${b}`).implementation,e.setProps({data:featureFilter(n.featureCollection,e=>e.zoom===b&&0===e.altitude&&includes(l,e.section))}),e=s.getLayer(`stations-routeog-${b}`).implementation,e.setProps({data:featureFilter(n.featureCollection,e=>e.zoom===b&&0===e.altitude&&includes(c,e.group))})}s.fitBounds(getBounds(h),{bearing:s.getBearing(),offset:[0,-s.transform.height/12],padding:{top:20,bottom:20,left:10,right:50},linear:!0,maxZoom:18}),n.refreshMap();const v=[o.trains[0].tt[0].s];for(const w of o.trains)(0<w.transfer||w===o.trains[o.trains.length-1])&&v.push(w.tt[w.tt.length-1].s);i.popups=v.map((t,r)=>setTimeout(()=>{const e=new Popup({className:"popup-route",closeButton:!1,closeOnClick:!1});e.setLngLat(n.stationLookup[t].coord).setHTML(0===r?a["from-station"]:r===v.length-1?a["to-station"]:`${a.transfer}${r}`).addTo(s),i.popups[r]=e},r/v.length*1e3+500))}hideRoute(){const e=this._map.map;for(const t of[13,14,15,16,17,18])for(const r of[`railways-routeug-${t}`,`stations-routeug-${t}`,`railways-routeog-${t}`,`stations-routeog-${t}`])e.getLayer(r).implementation.setProps({data:emptyFeatureCollection()});for(const i of this.popups)i instanceof Popup?i.remove():clearTimeout(i)}remove(){this.hideRoute(),super.remove()}}class SharePanel{constructor(e){this._object=e.object}addTo(e){const t=(this._map=e)["dict"],r=this._object.t?"train":"flight",i=this._object.t||this._object.id,n=this._container=createElement("div",{className:"share-panel"},e.container),a=this._button=createElement("button",{className:"share-button",innerHTML:t["share-this"].replace("$1",t[r])},n);return a.onclick=()=>{window.navigator.share({title:t.my.replace("$1",t[r]),text:t["on-this"].replace("$1",t[r]),url:`${configs.shareUrl}?selection=${i}`}).then(()=>{showNotification(e.container,t.shared)}).catch(()=>{})},this}remove(){this._container.parentNode.removeChild(this._container),delete this._container,delete this._map}}class StationPanel extends Panel{constructor(e){super(Object.assign({className:"station-panel"},e))}addTo(r){const e=[],t=this._options.object,i={},n=[].concat(...t.map(e=>e.exit||[]));for(var{id:a}of t)i[r.getLocalizedStationTitle(a)]=!0;for(const o of n)e.push(['<div class="exit-row">','<div class="exit-title-box">',r.getLocalizedPOIDescription(o),"</div>",'<div class="exit-share-button"></div>',"</div>"].join(""));super.addTo(r).setTitle(Object.keys(i).join(r.dict.and)).setHTML(e.join(""));var s=this._container.querySelector("#panel-content")["children"];for(let t=0,e=s.length;t<e;t++){const l=s[t];l.addEventListener("mouseenter",()=>{const e=r.container.querySelector(`#exit-${t}`);e&&e.classList.add("highlighted")}),l.addEventListener("mouseleave",()=>{const e=r.container.querySelector(`#exit-${t}`);e&&e.classList.remove("highlighted")})}return this}}const REVISION="134",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,SmoothShading=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es";class EventDispatcher{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0!==this._listeners){const r=this._listeners[e];void 0===r||-1!==(t=r.indexOf(t))&&r.splice(t,1)}}dispatchEvent(r){if(void 0!==this._listeners){const e=this._listeners[r.type];if(void 0!==e){r.target=this;const i=e.slice(0);for(let e=0,t=i.length;e<t;e++)i[e].call(this,r);r.target=null}}}}let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI,_lut=[];for(let e=0;e<256;e++)_lut[e]=(e<16?"0":"")+e.toString(16);const hasRandomUUID="undefined"!=typeof crypto&&"randomUUID"in crypto;function generateUUID(){if(hasRandomUUID)return crypto.randomUUID().toUpperCase();var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;const n=_lut[255&e]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[255&t]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[63&r|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[255&i]+_lut[i>>8&255]+_lut[i>>16&255]+_lut[i>>24&255];return n.toUpperCase()}function clamp(e,t,r){return Math.max(t,Math.min(r,e))}function euclideanModulo(e,t){return(e%t+t)%t}function mapLinear(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)}function inverseLerp(e,t,r){return e!==t?(r-e)/(t-e):0}function lerp(e,t,r){return(1-r)*e+r*t}function damp(e,t,r,i){return lerp(e,t,1-Math.exp(-r*i))}function pingpong(e,t=1){return t-Math.abs(euclideanModulo(e,2*t)-t)}function smoothstep(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)}function smootherstep(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)}function randInt(e,t){return e+Math.floor(Math.random()*(t-e+1))}function randFloat(e,t){return e+Math.random()*(t-e)}function randFloatSpread(e){return e*(.5-Math.random())}function seededRandom(e){return void 0!==e&&(_seed=e%2147483647),_seed=16807*_seed%2147483647,(_seed-1)/2147483646}function degToRad(e){return e*DEG2RAD}function radToDeg(e){return e*RAD2DEG}function isPowerOfTwo(e){return 0==(e&e-1)&&0!==e}function ceilPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function floorPowerOfTwo(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function setQuaternionFromProperEuler(e,t,r,i,n){const a=Math.cos,s=Math.sin;var o=a(r/2),l=s(r/2),c=a((t+i)/2),h=s((t+i)/2),u=a((t-i)/2),d=s((t-i)/2),p=a((i-t)/2),f=s((i-t)/2);switch(n){case"XYX":e.set(o*h,l*u,l*d,o*c);break;case"YZY":e.set(l*d,o*h,l*u,o*c);break;case"ZXZ":e.set(l*u,l*d,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}var MathUtils=Object.freeze({__proto__:null,DEG2RAD:DEG2RAD,RAD2DEG:RAD2DEG,generateUUID:generateUUID,clamp:clamp,euclideanModulo:euclideanModulo,mapLinear:mapLinear,inverseLerp:inverseLerp,lerp:lerp,damp:damp,pingpong:pingpong,smoothstep:smoothstep,smootherstep:smootherstep,randInt:randInt,randFloat:randFloat,randFloatSpread:randFloatSpread,seededRandom:seededRandom,degToRad:degToRad,radToDeg:radToDeg,isPowerOfTwo:isPowerOfTwo,ceilPowerOfTwo:ceilPowerOfTwo,floorPowerOfTwo:floorPowerOfTwo,setQuaternionFromProperEuler:setQuaternionFromProperEuler});class Vector2{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){var t=this.x,r=this.y,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6],this.y=e[1]*t+e[4]*r+e[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,t=this.y-e.y;return this.x=n*r-t*i+e.x,this.y=n*i+t*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Vector2.prototype.isVector2=!0;class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,n,a,s,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=n,c[5]=o,c[6]=r,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var r=e.elements,i=t.elements;const n=this.elements;var a=r[0],s=r[3],o=r[6],l=r[1],c=r[4],h=r[7],u=r[2],d=r[5],p=r[8],f=i[0],m=i[3],g=i[6],_=i[1],v=i[4],e=i[7],t=i[2],r=i[5],i=i[8];return n[0]=a*f+s*_+o*t,n[3]=a*m+s*v+o*r,n[6]=a*g+s*e+o*i,n[1]=l*f+c*_+h*t,n[4]=l*m+c*v+h*r,n[7]=l*g+c*e+h*i,n[2]=u*f+d*_+p*t,n[5]=u*m+d*v+p*r,n[8]=u*g+d*e+p*i,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],e=e[8];return t*a*e-t*s*l-r*n*e+r*s*o+i*n*l-i*a*o}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=c*a-s*l,u=s*o-c*n,d=l*n-a*o,p=t*h+r*u+i*d;if(0==p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return e[0]=h*f,e[1]=(i*l-c*r)*f,e[2]=(s*r-i*a)*f,e[3]=u*f,e[4]=(c*t-i*o)*f,e[5]=(i*n-s*t)*f,e[6]=d*f,e[7]=(r*o-l*t)*f,e[8]=(a*t-r*n)*f,this}transpose(){var e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,a,s){var o=Math.cos(n),n=Math.sin(n);return this.set(r*o,r*n,-r*(o*a+n*s)+a+e,-i*n,i*o,-i*(-n*a+o*s)+s+t,0,0,1),this}scale(e,t){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){var t=Math.cos(e),r=Math.sin(e);const i=this.elements;var n=i[0],a=i[3],s=i[6],o=i[1],l=i[4],e=i[7];return i[0]=t*n+r*o,i[3]=t*a+r*l,i[6]=t*s+r*e,i[1]=-r*n+t*o,i[4]=-r*a+t*l,i[7]=-r*s+t*e,this}translate(e,t){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<9;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function arrayMax(r){if(0===r.length)return-1/0;let i=r[0];for(let e=1,t=r.length;e<t;++e)r[e]>i&&(i=r[e]);return i}Matrix3.prototype.isMatrix3=!0;const TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function getTypedArray(e,t){return new TYPED_ARRAYS[e](t)}function createElementNS(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function hashString(r,e=0){let i=3735928559^e,n=1103547991^e;for(let e=0,t;e<r.length;e++)t=r.charCodeAt(e),i=Math.imul(i^t,2654435761),n=Math.imul(n^t,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}let _canvas;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===_canvas&&(_canvas=createElementNS("canvas")),_canvas.width=e.width,_canvas.height=e.height;const r=_canvas.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=_canvas}return 2048<t.width||2048<t.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let textureId=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,r=ClampToEdgeWrapping,i=ClampToEdgeWrapping,n=LinearFilter,a=LinearMipmapLinearFilter,s=RGBAFormat,o=UnsignedByteType,l=1,c=LinearEncoding){super(),Object.defineProperty(this,"id",{value:textureId++}),this.uuid=generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=generateUUID()),!t&&void 0===e.images[i.uuid]){let r;if(Array.isArray(i)){r=[];for(let e=0,t=i.length;e<t;e++)i[e].isDataTexture?r.push(serializeImage(i[e].image)):r.push(serializeImage(i[e]))}else r=serializeImage(i);e.images[i.uuid]={uuid:i.uuid,url:r}}r.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function serializeImage(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ImageUtils.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=UVMapping,Texture.prototype.isTexture=!0;class Vector4{constructor(e=0,t=0,r=0,i=1){this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){var t=this.x,r=this.y,i=this.z,n=this.w,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i+e[12]*n,this.y=e[1]*t+e[5]*r+e[9]*i+e[13]*n,this.z=e[2]*t+e[6]*r+e[10]*i+e[14]*n,this.w=e[3]*t+e[7]*r+e[11]*i+e[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,n;var a=e.elements,s=a[0],o=a[4],l=a[8],c=a[1],h=a[5],u=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(s+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(s+1)/2,g=(h+1)/2,_=(f+1)/2,v=(o+c)/4,e=(l+d)/4,a=(u+p)/4;return g<m&&_<m?n=m<.01?(r=0,i=.707106781):(r=Math.sqrt(m),i=v/r,e/r):_<g?n=g<.01?(r=.707106781,i=0,.707106781):(i=Math.sqrt(g),r=v/i,a/i):_<.01?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(_),r=e/n,i=a/n),this.set(r,i,n,t),this}let y=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(y)<.001&&(y=1),this.x=(p-u)/y,this.y=(l-d)/y,this.z=(c-o)/y,this.w=Math.acos((s+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Vector4.prototype.isVector4=!0;class WebGLRenderTarget extends EventDispatcher{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),this.texture=new Texture(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}WebGLRenderTarget.prototype.isWebGLRenderTarget=!0;class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(e,t,r){super(e,t);const i=this.texture;this.texture=[];for(let e=0;e<r;e++)this.texture[e]=i.clone()}setSize(r,i,n=1){if(this.width!==r||this.height!==i||this.depth!==n){this.width=r,this.height=i,this.depth=n;for(let e=0,t=this.texture.length;e<t;e++)this.texture[e].image.width=r,this.texture[e].image.height=i,this.texture[e].image.depth=n;this.dispose()}return this.viewport.set(0,0,r,i),this.scissor.set(0,0,r,i),this}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture;for(let e=this.texture.length=0,t=r.texture.length;e<t;e++)this.texture[e]=r.texture[e].clone();return this}}WebGLMultipleRenderTargets.prototype.isWebGLMultipleRenderTargets=!0;class WebGLMultisampleRenderTarget extends WebGLRenderTarget{constructor(e,t,r){super(e,t,r),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}WebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget=!0;class Quaternion{constructor(e=0,t=0,r=0,i=1){this._x=e,this._y=t,this._z=r,this._w=i}static slerp(e,t,r,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,t,i)}static slerpFlat(e,t,r,i,n,a,s){let o=r[i+0],l=r[i+1],c=r[i+2],h=r[i+3];var u=n[a+0],d=n[a+1],p=n[a+2],r=n[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===s)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=r);if(h!==r||o!==u||l!==d||c!==p){let e=1-s;i=o*u+l*d+c*p+h*r,n=0<=i?1:-1,a=1-i*i;a>Number.EPSILON&&(a=Math.sqrt(a),i=Math.atan2(a,i*n),e=Math.sin(e*i)/a,s=Math.sin(s*i)/a);n=s*n;o=o*e+u*n,l=l*e+d*n,c=c*e+p*n,h=h*e+r*n,e===1-s&&(s=1/Math.sqrt(o*o+l*l+c*c+h*h),o*=s,l*=s,c*=s,h*=s)}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,n,a){var s=r[i],o=r[i+1],l=r[i+2],c=r[i+3],h=n[a],r=n[a+1],i=n[a+2],a=n[a+3];return e[t]=s*a+c*h+o*i-l*r,e[t+1]=o*a+c*r+l*h-s*i,e[t+2]=l*a+c*i+s*r-o*h,e[t+3]=c*a-s*h-o*r-l*i,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,n=e._z,a=e._order;const s=Math.cos,o=Math.sin;var l=s(r/2),c=s(i/2),h=s(n/2),u=o(r/2),d=o(i/2),p=o(n/2);switch(a){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){var r=t/2,t=Math.sin(r);return this._x=e.x*t,this._y=e.y*t,this._z=e.z*t,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){var t,r=e.elements,i=r[0],n=r[4],a=r[8],s=r[1],o=r[5],l=r[9],c=r[2],h=r[6],e=r[10],r=i+o+e;return 0<r?(r=.5/Math.sqrt(r+1),this._w=.25/r,this._x=(h-l)*r,this._y=(a-c)*r,this._z=(s-n)*r):o<i&&e<i?(t=2*Math.sqrt(1+i-o-e),this._w=(h-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(a+c)/t):e<o?(t=2*Math.sqrt(1+o-i-e),this._w=(a-c)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+h)/t):(o=2*Math.sqrt(1+e-i-o),this._w=(s-n)/o,this._x=(a+c)/o,this._y=(l+h)/o,this._z=.25*o),this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp(this.dot(e),-1,1)))}rotateTowards(e,t){var r=this.angleTo(e);if(0===r)return this;r=Math.min(1,t/r);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){var r=e._x,i=e._y,n=e._z,a=e._w,s=t._x,o=t._y,e=t._z,t=t._w;return this._x=r*t+a*s+i*e-n*o,this._y=i*t+a*o+n*s-r*e,this._z=n*t+a*e+r*o-i*s,this._w=a*t-r*s-i*o-n*e,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,i=this._y,n=this._z,a=this._w;let s=a*e._w+r*e._x+i*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),1<=s)return this._w=a,this._x=r,this._y=i,this._z=n,this;var o=1-s*s;if(o<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*r+t*this._x,this._y=l*i+t*this._y,this._z=l*n+t*this._z,this.normalize(),this._onChangeCallback(),this}e=Math.sqrt(o),l=Math.atan2(e,s),o=Math.sin((1-t)*l)/e,e=Math.sin(t*l)/e;return this._w=a*o+this._w*e,this._x=r*o+this._x*e,this._y=i*o+this._y*e,this._z=n*o+this._z*e,this._onChangeCallback(),this}slerpQuaternions(e,t,r){this.copy(e).slerp(t,r)}random(){var e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),e=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(e),r*Math.cos(e),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Quaternion.prototype.isQuaternion=!0;class Vector3{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion$4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(e,t))}applyMatrix3(e){var t=this.x,r=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6]*i,this.y=e[1]*t+e[4]*r+e[7]*i,this.z=e[2]*t+e[5]*r+e[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){var t=this.x,r=this.y,i=this.z,n=e.elements,e=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*e,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*e,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*e,this}applyQuaternion(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,s=e.z,o=e.w,l=o*t+a*i-s*r,c=o*r+s*t-n*i,e=o*i+n*r-a*t,i=-n*t-a*r-s*i;return this.x=l*o+i*-n+c*-s-e*-a,this.y=c*o+i*-a+e*-n-l*-s,this.z=e*o+i*-s+l*-a-c*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){var t=this.x,r=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i,this.y=e[1]*t+e[5]*r+e[9]*i,this.z=e[2]*t+e[6]*r+e[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){var r=e.x,i=e.y,n=e.z,a=t.x,e=t.y,t=t.z;return this.x=i*t-n*e,this.y=n*a-r*t,this.z=r*e-i*a,this}projectOnVector(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);t=e.dot(this)/t;return this.copy(e).multiplyScalar(t)}projectOnPlane(e){return _vector$c.copy(this).projectOnVector(e),this.sub(_vector$c)}reflect(e){return this.sub(_vector$c.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;t=this.dot(e)/t;return Math.acos(clamp(t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,r=this.y-e.y,e=this.z-e.z;return t*t+r*r+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=e,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Vector3.prototype.isVector3=!0;const _vector$c=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(r){let i=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0;for(let e=0,t=r.length;e<t;e+=3){var c=r[e],h=r[e+1],u=r[e+2];c<i&&(i=c),h<n&&(n=h),u<a&&(a=u),c>s&&(s=c),h>o&&(o=h),u>l&&(l=u)}return this.min.set(i,n,a),this.max.set(s,o,l),this}setFromBufferAttribute(r){let i=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0;for(let e=0,t=r.count;e<t;e++){var c=r.getX(e),h=r.getY(e),u=r.getZ(e);c<i&&(i=c),h<n&&(n=h),u<a&&(a=u),c>s&&(s=c),h>o&&(o=h),u>l&&(l=u)}return this.min.set(i,n,a),this.max.set(s,o,l),this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=_vector$b.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),_box$3.copy(t.boundingBox),_box$3.applyMatrix4(e.matrixWorld),this.union(_box$3));var r=e.children;for(let e=0,t=r.length;e<t;e++)this.expandByObject(r[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,_vector$b),_vector$b.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return r=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){return!this.isEmpty()&&(this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$7.subVectors(e.b,_center),_v2$3.subVectors(e.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$3,_v1$7),_f2.subVectors(_v0$2,_v2$3),!!satForAxes([0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0],_v0$2,_v1$7,_v2$3,_extents)&&(!!satForAxes([1,0,0,0,1,0,0,0,1],_v0$2,_v1$7,_v2$3,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),satForAxes([_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],_v0$2,_v1$7,_v2$3,_extents))))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){const t=_vector$b.copy(e).clamp(this.min,this.max);return t.sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(_vector$b).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box3.prototype.isBox3=!0;const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$3=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(r,i,n,a,s){for(let e=0,t=r.length-3;e<=t;e+=3){_testAxis.fromArray(r,e);var o=s.x*Math.abs(_testAxis.x)+s.y*Math.abs(_testAxis.y)+s.z*Math.abs(_testAxis.z),l=i.dot(_testAxis),c=n.dot(_testAxis),h=a.dot(_testAxis);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>o)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_toFarthestPoint=new Vector3,_toPoint=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(r,e){const i=this.center;void 0!==e?i.copy(e):_box$2.setFromPoints(r).getCenter(i);let n=0;for(let e=0,t=r.length;e<t;e++)n=Math.max(n,i.distanceToSquared(r[e]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){var r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){_toPoint.subVectors(e,this.center);var t=_toPoint.lengthSq();return t>this.radius*this.radius&&(t=.5*((e=Math.sqrt(t))-this.radius),this.center.add(_toPoint.multiplyScalar(t/e)),this.radius+=t),this}union(e){return _toFarthestPoint.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(_v1$6.copy(e.center).add(_toFarthestPoint)),this.expandByPoint(_v1$6.copy(e.center).sub(_toFarthestPoint)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$a)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){var t=_vector$a.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$a.copy(this.direction).multiplyScalar(t).add(this.origin),_vector$a.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);var n=.5*e.distanceTo(t),a=-this.direction.dot(_segDir),s=_diff.dot(this.direction),o=-_diff.dot(_segDir),e=_diff.lengthSq(),t=Math.abs(1-a*a);let l,c,h,u;return h=0<t?(l=a*o-s,c=a*s-o,u=n*t,0<=l?c>=-u?c<=u?(t=1/t,l*=t,c*=t,l*(l+a*c+2*s)+c*(a*l+c+2*o)+e):(c=n,l=Math.max(0,-(a*c+s)),-l*l+c*(c+2*o)+e):(c=-n,l=Math.max(0,-(a*c+s)),-l*l+c*(c+2*o)+e):c<=-u?(l=Math.max(0,-(-a*n+s)),c=0<l?-n:Math.min(Math.max(-n,-o),n),-l*l+c*(c+2*o)+e):c<=u?(l=0,c=Math.min(Math.max(-n,-o),n),c*(c+2*o)+e):(l=Math.max(0,-(a*n+s)),c=0<l?n:Math.min(Math.max(-n,-o),n),-l*l+c*(c+2*o)+e)):(c=0<a?-n:n,l=Math.max(0,-(a*c+s)),-l*l+c*(c+2*o)+e),r&&r.copy(this.direction).multiplyScalar(l).add(this.origin),i&&i.copy(_segDir).multiplyScalar(c).add(_segCenter),h}intersectSphere(e,t){_vector$a.subVectors(e.center,this.origin);var r=_vector$a.dot(this.direction),i=_vector$a.dot(_vector$a)-r*r,e=e.radius*e.radius;if(e<i)return null;e=Math.sqrt(e-i),i=r-e,e=r+e;return i<0&&e<0?null:i<0?this.at(e,t):this.at(i,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;t=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=t?t:null}intersectPlane(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,n,a,s,o;var l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return i=0<=l?(r=(e.min.x-u.x)*l,(e.max.x-u.x)*l):(r=(e.max.x-u.x)*l,(e.min.x-u.x)*l),a=0<=c?(n=(e.min.y-u.y)*c,(e.max.y-u.y)*c):(n=(e.max.y-u.y)*c,(e.min.y-u.y)*c),r>a||n>i?null:((n>r||r!=r)&&(r=n),(a<i||i!=i)&&(i=a),o=0<=h?(s=(e.min.z-u.z)*h,(e.max.z-u.z)*h):(s=(e.max.z-u.z)*h,(e.min.z-u.z)*h),r>o||s>i?null:((s>r||r!=r)&&(r=s),(o<i||i!=i)&&(i=o),i<0?null:this.at(0<=r?r:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,_vector$a)}intersectTriangle(e,t,r,i,n){_edge1.subVectors(t,e),_edge2.subVectors(r,e),_normal$1.crossVectors(_edge1,_edge2);let a=this.direction.dot(_normal$1),s;if(0<a){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}_diff.subVectors(this.origin,e);i=s*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(i<0)return null;e=s*this.direction.dot(_edge1.cross(_diff));if(e<0)return null;if(i+e>a)return null;e=-s*_diff.dot(_normal$1);return e<0?null:this.at(e/a,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,n,a,s,o,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){e=e.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements;var r=e.elements,i=1/_v1$5.setFromMatrixColumn(e,0).length(),n=1/_v1$5.setFromMatrixColumn(e,1).length(),e=1/_v1$5.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*e,t[9]=r[9]*e,t[10]=r[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements;var r,i,n,a,s,o,l,c,h,u,d,p=e.x,f=e.y,m=e.z,g=Math.cos(p),_=Math.sin(p),v=Math.cos(f),y=Math.sin(f),p=Math.cos(m),f=Math.sin(m);return"XYZ"===e.order?(r=g*p,n=g*f,i=_*p,m=_*f,t[0]=v*p,t[4]=-v*f,t[8]=y,t[1]=n+i*y,t[5]=r-m*y,t[9]=-_*v,t[2]=m-r*y,t[6]=i+n*y,t[10]=g*v):"YXZ"===e.order?(a=v*p,r=v*f,i=y*p,n=y*f,t[0]=a+n*_,t[4]=i*_-r,t[8]=g*y,t[1]=g*f,t[5]=g*p,t[9]=-_,t[2]=r*_-i,t[6]=n+a*_,t[10]=g*v):"ZXY"===e.order?(l=v*p,a=v*f,s=y*p,o=y*f,t[0]=l-o*_,t[4]=-g*f,t[8]=s+a*_,t[1]=a+s*_,t[5]=g*p,t[9]=o-l*_,t[2]=-g*y,t[6]=_,t[10]=g*v):"ZYX"===e.order?(s=g*p,o=g*f,c=_*p,l=_*f,t[0]=v*p,t[4]=c*y-o,t[8]=s*y+l,t[1]=v*f,t[5]=l*y+s,t[9]=o*y-c,t[2]=-y,t[6]=_*v,t[10]=g*v):"YZX"===e.order?(u=g*v,c=g*y,h=_*v,d=_*y,t[0]=v*p,t[4]=d-u*f,t[8]=h*f+c,t[1]=f,t[5]=g*p,t[9]=-_*p,t[2]=-y*p,t[6]=c*f+h,t[10]=u-d*f):"XZY"===e.order&&(h=g*v,u=g*y,d=_*v,e=_*y,t[0]=v*p,t[4]=-f,t[8]=y*p,t[1]=h*f+e,t[5]=g*p,t[9]=u*f-d,t[2]=d*f-u,t[6]=_*p,t[10]=e*f+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,r){const i=this.elements;return _z.subVectors(e,t),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),0===_x.lengthSq()&&(1===Math.abs(r.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),i[0]=_x.x,i[4]=_y.x,i[8]=_z.x,i[1]=_x.y,i[5]=_y.y,i[9]=_z.y,i[2]=_x.z,i[6]=_y.z,i[10]=_z.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var r=e.elements,i=t.elements;const n=this.elements;var a=r[0],s=r[4],o=r[8],l=r[12],c=r[1],h=r[5],u=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],_=r[3],v=r[7],y=r[11],x=r[15],b=i[0],w=i[4],T=i[8],E=i[12],S=i[1],M=i[5],A=i[9],C=i[13],L=i[2],P=i[6],I=i[10],R=i[14],e=i[3],t=i[7],r=i[11],i=i[15];return n[0]=a*b+s*S+o*L+l*e,n[4]=a*w+s*M+o*P+l*t,n[8]=a*T+s*A+o*I+l*r,n[12]=a*E+s*C+o*R+l*i,n[1]=c*b+h*S+u*L+d*e,n[5]=c*w+h*M+u*P+d*t,n[9]=c*T+h*A+u*I+d*r,n[13]=c*E+h*C+u*R+d*i,n[2]=p*b+f*S+m*L+g*e,n[6]=p*w+f*M+m*P+g*t,n[10]=p*T+f*A+m*I+g*r,n[14]=p*E+f*C+m*R+g*i,n[3]=_*b+v*S+y*L+x*e,n[7]=_*w+v*M+y*P+x*t,n[11]=_*T+v*A+y*I+x*r,n[15]=_*E+v*C+y*R+x*i,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+n*o*h-i*l*h-n*s*u+r*l*u+i*s*d-r*o*d)+e[7]*(+t*o*d-t*l*u+n*a*u-i*a*d+i*l*c-n*o*c)+e[11]*(+t*l*h-t*s*d-n*a*h+r*a*d+n*s*c-r*l*c)+e[15]*(-i*s*c-t*o*h+t*s*u+i*a*h-r*a*u+r*o*c)}transpose(){const e=this.elements;var t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=h*m*l-f*u*l+f*o*d-s*m*d-h*o*g+s*u*g,v=p*u*l-c*m*l-p*o*d+a*m*d+c*o*g-a*u*g,y=c*f*l-p*h*l+p*s*d-a*f*d-c*s*g+a*h*g,x=p*h*o-c*f*o-p*s*u+a*f*u+c*s*m-a*h*m;var b=t*_+r*v+i*y+n*x;if(0==b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);b=1/b;return e[0]=_*b,e[1]=(f*u*n-h*m*n-f*i*d+r*m*d+h*i*g-r*u*g)*b,e[2]=(s*m*n-f*o*n+f*i*l-r*m*l-s*i*g+r*o*g)*b,e[3]=(h*o*n-s*u*n-h*i*l+r*u*l+s*i*d-r*o*d)*b,e[4]=v*b,e[5]=(c*m*n-p*u*n+p*i*d-t*m*d-c*i*g+t*u*g)*b,e[6]=(p*o*n-a*m*n-p*i*l+t*m*l+a*i*g-t*o*g)*b,e[7]=(a*u*n-c*o*n+c*i*l-t*u*l-a*i*d+t*o*d)*b,e[8]=y*b,e[9]=(p*h*n-c*f*n-p*r*d+t*f*d+c*r*g-t*h*g)*b,e[10]=(a*f*n-p*s*n+p*r*l-t*f*l-a*r*g+t*s*g)*b,e[11]=(c*s*n-a*h*n-c*r*l+t*h*l+a*r*d-t*s*d)*b,e[12]=x*b,e[13]=(c*f*i-p*h*i+p*r*u-t*f*u-c*r*m+t*h*m)*b,e[14]=(p*s*i-a*f*i-p*r*o+t*f*o+a*r*m-t*s*m)*b,e[15]=(a*h*i-c*s*i+c*r*o-t*h*o-a*r*u+t*s*u)*b,this}scale(e){const t=this.elements;var r=e.x,i=e.y,e=e.z;return t[0]*=r,t[4]*=i,t[8]*=e,t[1]*=r,t[5]*=i,t[9]*=e,t[2]*=r,t[6]*=i,t[10]*=e,t[3]*=r,t[7]*=i,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,e))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,s=e.y,o=e.z,t=n*a,e=n*s;return this.set(t*a+r,t*s-i*o,t*o+i*s,0,t*s+i*o,e*s+r,e*o-i*a,0,t*o-i*s,e*o+i*a,n*o*o+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,n,a){return this.set(1,r,n,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements;var n=t._x,a=t._y,s=t._z,o=t._w,l=n+n,c=a+a,h=s+s,u=n*l,d=n*c,p=n*h,t=a*c,n=a*h,a=s*h,s=o*l,l=o*c,c=o*h,o=r.x,h=r.y,r=r.z;return i[0]=(1-(t+a))*o,i[1]=(d+c)*o,i[2]=(p-l)*o,i[3]=0,i[4]=(d-c)*h,i[5]=(1-(u+a))*h,i[6]=(n+s)*h,i[7]=0,i[8]=(p+l)*r,i[9]=(n-s)*r,i[10]=(1-(u+t))*r,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){var i=this.elements;let n=_v1$5.set(i[0],i[1],i[2]).length();var a=_v1$5.set(i[4],i[5],i[6]).length(),s=_v1$5.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],_m1$2.copy(this);var o=1/n,e=1/a,i=1/s;return _m1$2.elements[0]*=o,_m1$2.elements[1]*=o,_m1$2.elements[2]*=o,_m1$2.elements[4]*=e,_m1$2.elements[5]*=e,_m1$2.elements[6]*=e,_m1$2.elements[8]*=i,_m1$2.elements[9]*=i,_m1$2.elements[10]*=i,t.setFromRotationMatrix(_m1$2),r.x=n,r.y=a,r.z=s,this}makePerspective(e,t,r,i,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements;var o=2*n/(r-i),l=(t+e)/(t-e),r=(r+i)/(r-i),i=-(a+n)/(a-n),a=-2*a*n/(a-n);return s[0]=2*n/(t-e),s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=o,s[9]=r,s[13]=0,s[2]=0,s[6]=0,s[10]=i,s[14]=a,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,r,i,n,a){const s=this.elements;var o=1/(t-e),l=1/(r-i),c=1/(a-n),e=(t+e)*o,i=(r+i)*l,n=(a+n)*c;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-e,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-i,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-n,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<16;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}Matrix4.prototype.isMatrix4=!0;const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$1=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(e=0,t=0,r=0,i=Euler.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){var e=e.elements,i=e[0],n=e[4],a=e[8],s=e[1],o=e[5],l=e[9],c=e[2],h=e[6],u=e[10];switch(t){case"XYZ":this._y=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,u),this._z=Math.atan2(-n,i)):(this._x=Math.atan2(h,o),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,u),this._z=Math.atan2(s,o)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,u),this._z=Math.atan2(-n,o)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-clamp(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,u),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-n,o));break;case"YZX":this._z=Math.asin(clamp(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,o),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,u));break;case"XZY":this._z=Math.asin(-clamp(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(h,o),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-l,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return _matrix$1.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix$1,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Euler.prototype.isEuler=!0,Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3;const t=new Euler,r=new Quaternion;var i=new Vector3(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this}rotateX(e){return this.rotateOnAxis(_xAxis,e)}rotateY(e){return this.rotateOnAxis(_yAxis,e)}rotateZ(e){return this.rotateOnAxis(_zAxis,e)}translateOnAxis(e,t){return _v1$4.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_xAxis,e)}translateY(e){return this.translateOnAxis(_yAxis,e)}translateZ(e){return this.translateOnAxis(_zAxis,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?_target.copy(e):_target.set(e,t,r);r=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),r&&(_m1$1.extractRotation(r.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(_removedEvent)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(r,i){if(this[r]===i)return this;for(let e=0,t=this.children.length;e<t;e++){const a=this.children[e];var n=a.getObjectByProperty(r,i);if(void 0!==n)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,e,_scale$2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(r){r(this);const i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverse(r)}traverseVisible(r){if(!1!==this.visible){r(this);const i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverseVisible(r)}}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),r=!(this.matrixWorldNeedsUpdate=!1));const i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(r)}updateWorldMatrix(e,t){const r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].updateWorldMatrix(!1,!0)}}toJSON(r){var e,t,i,n,a,s=void 0===r||"string"==typeof r;const o={};s&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},o.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const l={};function c(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(r)),t.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(l.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&(l.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=c(r.geometries,this.geometry);var h=this.geometry.parameters;if(void 0!==h&&void 0!==h.shapes){var u=h.shapes;if(Array.isArray(u))for(let e=0,t=u.length;e<t;e++){var d=u[e];c(r.shapes,d)}else c(r.shapes,u)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(c(r.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const m=[];for(let e=0,t=this.material.length;e<t;e++)m.push(c(r.materials,this.material[e]));l.material=m}else l.material=c(r.materials,this.material);if(0<this.children.length){l.children=[];for(let e=0;e<this.children.length;e++)l.children.push(this.children[e].toJSON(r).object)}if(0<this.animations.length){l.animations=[];for(let e=0;e<this.animations.length;e++){var p=this.animations[e];l.animations.push(c(r.animations,p))}}return s&&(e=f(r.geometries),t=f(r.materials),i=f(r.textures),n=f(r.images),a=f(r.shapes),h=f(r.skeletons),s=f(r.animations),0<e.length&&(o.geometries=e),0<t.length&&(o.materials=t),0<i.length&&(o.textures=i),0<n.length&&(o.images=n),0<a.length&&(o.shapes=a),0<h.length&&(o.skeletons=h),0<s.length&&(o.animations=s)),o.object=l,o;function f(e){const t=[];for(const r in e){const i=e[r];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const r=t.children[e];this.add(r.clone())}return this}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype.isObject3D=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;class Triangle{constructor(e=new Vector3,t=new Vector3,r=new Vector3){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),_v0$1.subVectors(e,t),i.cross(_v0$1);t=i.lengthSq();return 0<t?i.multiplyScalar(1/Math.sqrt(t)):i.set(0,0,0)}static getBarycoord(e,t,r,i,n){_v0$1.subVectors(i,t),_v1$3.subVectors(r,t),_v2$2.subVectors(e,t);var a=_v0$1.dot(_v0$1),s=_v0$1.dot(_v1$3),i=_v0$1.dot(_v2$2),r=_v1$3.dot(_v1$3),e=_v1$3.dot(_v2$2),t=a*r-s*s;if(0==t)return n.set(-2,-1,-1);t=1/t,r=(r*i-s*e)*t,t*=a*e-s*i;return n.set(1-r-t,t,r)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,_v3$1),0<=_v3$1.x&&0<=_v3$1.y&&_v3$1.x+_v3$1.y<=1}static getUV(e,t,r,i,n,a,s,o){return this.getBarycoord(e,t,r,i,_v3$1),o.set(0,0),o.addScaledVector(n,_v3$1.x),o.addScaledVector(a,_v3$1.y),o.addScaledVector(s,_v3$1.z),o}static isFrontFacing(e,t,r,i){return _v0$1.subVectors(r,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,n){return Triangle.getUV(e,this.a,this.b,this.c,t,r,i,n)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){var r=this.a,i=this.b,n=this.c;let a,s;_vab.subVectors(i,r),_vac.subVectors(n,r),_vap.subVectors(e,r);var o=_vab.dot(_vap),l=_vac.dot(_vap);if(o<=0&&l<=0)return t.copy(r);_vbp.subVectors(e,i);var c=_vab.dot(_vbp),h=_vac.dot(_vbp);if(0<=c&&h<=c)return t.copy(i);var u=o*h-c*l;if(u<=0&&0<=o&&c<=0)return a=o/(o-c),t.copy(r).addScaledVector(_vab,a);_vcp.subVectors(e,n);var d=_vab.dot(_vcp),e=_vac.dot(_vcp);if(0<=e&&d<=e)return t.copy(n);o=d*l-o*e;if(o<=0&&0<=l&&e<=0)return s=l/(l-e),t.copy(r).addScaledVector(_vac,s);l=c*e-d*h;if(l<=0&&0<=h-c&&0<=d-e)return _vbc.subVectors(n,i),s=(h-c)/(h-c+(d-e)),t.copy(i).addScaledVector(_vbc,s);l=1/(l+o+u);return a=o*l,s=u*l,t.copy(r).addScaledVector(_vab,a).addScaledVector(_vac,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let materialId=0;class Material extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.format=RGBAFormat,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){0<this._alphaTest!=0<e&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const r in e){var t=e[r];if(void 0!==t)if("shading"!==r){const i=this[r];void 0!==i?i&&i.isColor?i.set(t):i&&i.isVector3&&t&&t.isVector3?i.copy(t):this[r]=t:console.warn("THREE."+this.type+": '"+r+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===FlatShading;else console.warn("THREE.Material: '"+r+"' parameter is undefined.")}}toJSON(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const r in e){const i=e[r];delete i.metadata,t.push(i)}return t}return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.side!==FrontSide&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.format!==RGBAFormat&&(r.format=this.format),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t&&(t=i(e.textures),e=i(e.images),0<t.length&&(r.textures=t),0<e.length&&(r.images=e)),r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){var i=t.length;r=new Array(i);for(let e=0;e!==i;++e)r[e]=t[e].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Material.prototype.isMaterial=!0;const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(e,t,r){return r<0&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Color{constructor(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this}setHSL(e,t,r){return e=euclideanModulo(e,1),t=clamp(t,0,1),r=clamp(r,0,1),0===t?this.r=this.g=this.b=r:(this.r=hue2rgb(t=2*r-(r=r<=.5?r*(1+t):r+t-r*t),r,e+1/3),this.g=hue2rgb(t,r,e),this.b=hue2rgb(t,r,e-1/3)),this}setStyle(t){function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let e;var n=i[1],a=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var s=parseFloat(e[1])/360,o=parseInt(e[2],10)/100,l=parseInt(e[3],10)/100;return r(e[4]),this.setHSL(s,o,l)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const e=i[1];n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this}setColorName(e){var t=_colorKeywords[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){t=0<t?1/t:1;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){var t=this.r,r=this.g,i=this.b,n=Math.max(t,r,i),a=Math.min(t,r,i);let s,o;var l=(a+n)/2;if(a===n)s=0,o=0;else{var c=n-a;switch(o=l<=.5?c/(n+a):c/(2-n-a),n){case t:s=(r-i)/c+(r<i?6:0);break;case r:s=(i-t)/c+2;break;case i:s=(t-r)/c+4}s/=6}return e.h=s,e.s=o,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,r){return this.getHSL(_hslA),_hslA.h+=e,_hslA.s+=t,_hslA.l+=r,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);var r=lerp(_hslA.h,_hslB.h,t),e=lerp(_hslA.s,_hslB.s,t),t=lerp(_hslA.l,_hslB.l,t);return this.setHSL(r,e,t),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=_colorKeywords,Color.prototype.isColor=!0,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class MeshBasicMaterial extends Material{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;const _vector$9=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(r,i,n){r*=this.itemSize,n*=i.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[r+e]=i.array[n+e];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(r){const i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",t),e=new Color),i[n++]=e.r,i[n++]=e.g,i[n++]=e.b}return this}copyVector2sArray(r){const i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",t),e=new Vector2),i[n++]=e.x,i[n++]=e.y}return this}copyVector3sArray(r){const i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",t),e=new Vector3),i[n++]=e.x,i[n++]=e.y,i[n++]=e.z}return this}copyVector4sArray(r){const i=this.array;let n=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",t),e=new Vector4),i[n++]=e.x,i[n++]=e.y,i[n++]=e.z,i[n++]=e.w}return this}applyMatrix3(r){if(2===this.itemSize)for(let e=0,t=this.count;e<t;e++)_vector2$1.fromBufferAttribute(this,e),_vector2$1.applyMatrix3(r),this.setXY(e,_vector2$1.x,_vector2$1.y);else if(3===this.itemSize)for(let e=0,t=this.count;e<t;e++)_vector$9.fromBufferAttribute(this,e),_vector$9.applyMatrix3(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(r){for(let e=0,t=this.count;e<t;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.applyMatrix4(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(r){for(let e=0,t=this.count;e<t;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.applyNormalMatrix(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(r){for(let e=0,t=this.count;e<t;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.transformDirection(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}BufferAttribute.prototype.isBufferAttribute=!0;class Int8BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Int8Array(e),t,r)}}class Uint8BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class Int16BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Int16Array(e),t,r)}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class Int32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Int32Array(e),t,r)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Float16BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint16Array(e),t,r)}}Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0;class Float32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Float32Array(e),t,r)}}class Float64BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Float64Array(e),t,r)}}let _id=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:_id++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(65535<arrayMax(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;var i;void 0!==r&&(i=(new Matrix3).getNormalMatrix(e),r.applyNormalMatrix(i),r.needsUpdate=!0);const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return _m1.makeRotationFromQuaternion(e),this.applyMatrix4(_m1),this}rotateX(e){return _m1.makeRotationX(e),this.applyMatrix4(_m1),this}rotateY(e){return _m1.makeRotationY(e),this.applyMatrix4(_m1),this}rotateZ(e){return _m1.makeRotationZ(e),this.applyMatrix4(_m1),this}translate(e,t,r){return _m1.makeTranslation(e,t,r),this.applyMatrix4(_m1),this}scale(e,t,r){return _m1.makeScale(e,t,r),this.applyMatrix4(_m1),this}lookAt(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(r){const i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e];i.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position,r=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),r)for(let e=0,t=r.length;e<t;e++){var i=r[e];_box$1.setFromBufferAttribute(i),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var i=this.attributes.position,n=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(i){const l=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(i),n)for(let e=0,t=n.length;e<t;e++){var a=n[e];_boxMorphTargets.setFromBufferAttribute(a),this.morphTargetsRelative?(_vector$8.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$8),_vector$8.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$8)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(l);let r=0;for(let e=0,t=i.count;e<t;e++)_vector$8.fromBufferAttribute(i,e),r=Math.max(r,l.distanceToSquared(_vector$8));if(n)for(let e=0,t=n.length;e<t;e++){var s=n[e],o=this.morphTargetsRelative;for(let e=0,t=s.count;e<t;e++)_vector$8.fromBufferAttribute(s,e),o&&(_offset.fromBufferAttribute(i,e),_vector$8.add(_offset)),r=Math.max(r,l.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var i=e.array;const h=t.position.array,u=t.normal.array,d=t.uv.array;var n=h.length/3;void 0===t.tangent&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*n),4));const p=t.tangent.array,f=[],m=[];for(let e=0;e<n;e++)f[e]=new Vector3,m[e]=new Vector3;const g=new Vector3,_=new Vector3,v=new Vector3,y=new Vector2,x=new Vector2,b=new Vector2,w=new Vector3,T=new Vector3;let r=this.groups;0===r.length&&(r=[{start:0,count:i.length}]);for(let e=0,t=r.length;e<t;++e){var a=r[e],s=a.start;for(let e=s,t=s+a.count;e<t;e+=3)!function(e,t,r){g.fromArray(h,3*e),_.fromArray(h,3*t),v.fromArray(h,3*r),y.fromArray(d,2*e),x.fromArray(d,2*t),b.fromArray(d,2*r),_.sub(g),v.sub(g),x.sub(y),b.sub(y);var i=1/(x.x*b.y-b.x*x.y);isFinite(i)&&(w.copy(_).multiplyScalar(b.y).addScaledVector(v,-x.y).multiplyScalar(i),T.copy(v).multiplyScalar(x.x).addScaledVector(_,-b.x).multiplyScalar(i),f[e].add(w),f[t].add(w),f[r].add(w),m[e].add(T),m[t].add(T),m[r].add(T))}(i[e+0],i[e+1],i[e+2])}const E=new Vector3,S=new Vector3,M=new Vector3,A=new Vector3;for(let e=0,t=r.length;e<t;++e){var o=r[e],l=o.start;for(let e=l,t=l+o.count;e<t;e+=3)c(i[e+0]),c(i[e+1]),c(i[e+2])}function c(e){M.fromArray(u,3*e),A.copy(M);var t=f[e];E.copy(t),E.sub(M.multiplyScalar(M.dot(t))).normalize(),S.crossVectors(A,t);t=S.dot(m[e])<0?-1:1;p[4*e]=E.x,p[4*e+1]=E.y,p[4*e+2]=E.z,p[4*e+3]=t}}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)")}computeVertexNormals(){const i=this.index;var n=this.getAttribute("position");if(void 0!==n){let r=this.getAttribute("normal");if(void 0===r)r=new BufferAttribute(new Float32Array(3*n.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);const l=new Vector3,c=new Vector3,h=new Vector3,u=new Vector3,d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector3;if(i)for(let e=0,t=i.count;e<t;e+=3){var a=i.getX(e+0),s=i.getX(e+1),o=i.getX(e+2);l.fromBufferAttribute(n,a),c.fromBufferAttribute(n,s),h.fromBufferAttribute(n,o),f.subVectors(h,c),m.subVectors(l,c),f.cross(m),u.fromBufferAttribute(r,a),d.fromBufferAttribute(r,s),p.fromBufferAttribute(r,o),u.add(f),d.add(f),p.add(f),r.setXYZ(a,u.x,u.y,u.z),r.setXYZ(s,d.x,d.y,d.z),r.setXYZ(o,p.x,p.y,p.z)}else for(let e=0,t=n.count;e<t;e+=3)l.fromBufferAttribute(n,e+0),c.fromBufferAttribute(n,e+1),h.fromBufferAttribute(n,e+2),f.subVectors(h,c),m.subVectors(l,c),f.cross(m),r.setXYZ(e+0,f.x,f.y,f.z),r.setXYZ(e+1,f.x,f.y,f.z),r.setXYZ(e+2,f.x,f.y,f.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(const s in r)if(void 0!==e.attributes[s]){const o=r[s].array;var i=e.attributes[s],n=i.array,i=i.itemSize*t,a=Math.min(n.length,o.length-i);for(let e=0,t=i;e<a;e++,t++)o[t]=n[e]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}normalizeNormals(){const r=this.attributes.normal;for(let e=0,t=r.count;e<t;e++)_vector$8.fromBufferAttribute(r,e),_vector$8.normalize(),r.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function r(r,i){const n=r.array;var a=r.itemSize,e=r.normalized;const s=new n.constructor(i.length*a);let o=0,l=0;for(let e=0,t=i.length;e<t;e++){o=r.isInterleavedBufferAttribute?i[e]*r.data.stride+r.offset:i[e]*a;for(let e=0;e<a;e++)s[l++]=n[o++]}return new BufferAttribute(s,a,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new BufferGeometry;var n=this.index.array,e=this.attributes;for(const h in e){var t=r(e[h],n);i.setAttribute(h,t)}var a=this.morphAttributes;for(const u in a){const d=[];var s=a[u];for(let e=0,t=s.length;e<t;e++){var o=r(s[e],n);d.push(o)}i.morphAttributes[u]=d}i.morphTargetsRelative=this.morphTargetsRelative;var l=this.groups;for(let e=0,t=l.length;e<t;e++){var c=l[e];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const r={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),0<Object.keys(this.userData).length&&(r.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(const l in e)void 0!==e[l]&&(r[l]=e[l]);return r}r.data={attributes:{}};var t=this.index;null!==t&&(r.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});var i=this.attributes;for(const c in i){const h=i[c];r.data.attributes[c]=h.toJSON(r.data)}const n={};let a=!1;for(const u in this.morphAttributes){var s=this.morphAttributes[u];const d=[];for(let e=0,t=s.length;e<t;e++){const p=s[e];d.push(p.toJSON(r.data))}0<d.length&&(n[u]=d,a=!0)}a&&(r.data.morphAttributes=n,r.data.morphTargetsRelative=this.morphTargetsRelative);t=this.groups;0<t.length&&(r.data.groups=JSON.parse(JSON.stringify(t)));const o=this.boundingSphere;return null!==o&&(r.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),r}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var r={};this.name=e.name;const t=e.index;null!==t&&this.setIndex(t.clone(r));var i=e.attributes;for(const c in i){const h=i[c];this.setAttribute(c,h.clone(r))}var n=e.morphAttributes;for(const u in n){const d=[],p=n[u];for(let e=0,t=p.length;e<t;e++)d.push(p[e].clone(r));this.morphAttributes[u]=d}this.morphTargetsRelative=e.morphTargetsRelative;var a=e.groups;for(let e=0,t=a.length;e<t;e++){var s=a[e];this.addGroup(s.start,s.count,s.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}BufferGeometry.prototype.isBufferGeometry=!0;const _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,r=Object.keys(t);if(0<r.length){var i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){var n=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(i,n){const e=this.geometry;var a=this.material,t=this.matrixWorld;if(void 0!==a&&(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$3.copy(e.boundingSphere),_sphere$3.applyMatrix4(t),!1!==i.ray.intersectsSphere(_sphere$3)&&(_inverseMatrix$2.copy(t).invert(),_ray$2.copy(i.ray).applyMatrix4(_inverseMatrix$2),null===e.boundingBox||!1!==_ray$2.intersectsBox(e.boundingBox)))){let r;if(e.isBufferGeometry){const L=e.index;var s=e.attributes.position,o=e.morphAttributes.position,l=e.morphTargetsRelative,c=e.attributes.uv,h=e.attributes.uv2,u=e.groups,d=e.drawRange;if(null!==L)if(Array.isArray(a))for(let e=0,t=u.length;e<t;e++){var p=u[e],f=a[p.materialIndex];for(let e=Math.max(p.start,d.start),t=Math.min(L.count,Math.min(p.start+p.count,d.start+d.count));e<t;e+=3){var m=L.getX(e),g=L.getX(e+1),_=L.getX(e+2);r=checkBufferGeometryIntersection(this,f,i,_ray$2,s,o,l,c,h,m,g,_),r&&(r.faceIndex=Math.floor(e/3),r.face.materialIndex=p.materialIndex,n.push(r))}}else for(let e=Math.max(0,d.start),t=Math.min(L.count,d.start+d.count);e<t;e+=3){var v=L.getX(e),y=L.getX(e+1),x=L.getX(e+2);r=checkBufferGeometryIntersection(this,a,i,_ray$2,s,o,l,c,h,v,y,x),r&&(r.faceIndex=Math.floor(e/3),n.push(r))}else if(void 0!==s)if(Array.isArray(a))for(let e=0,t=u.length;e<t;e++){var b=u[e],w=a[b.materialIndex];for(let e=Math.max(b.start,d.start),t=Math.min(s.count,Math.min(b.start+b.count,d.start+d.count));e<t;e+=3){var T=e,E=e+1,S=e+2;r=checkBufferGeometryIntersection(this,w,i,_ray$2,s,o,l,c,h,T,E,S),r&&(r.faceIndex=Math.floor(e/3),r.face.materialIndex=b.materialIndex,n.push(r))}}else for(let e=Math.max(0,d.start),t=Math.min(s.count,d.start+d.count);e<t;e+=3){var M=e,A=e+1,C=e+2;r=checkBufferGeometryIntersection(this,a,i,_ray$2,s,o,l,c,h,M,A,C),r&&(r.faceIndex=Math.floor(e/3),n.push(r))}}else e.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function checkIntersection(e,t,r,i,n,a,s,o){let l;if(l=t.side===BackSide?i.intersectTriangle(s,a,n,!0,o):i.intersectTriangle(n,a,s,t.side!==DoubleSide,o),null===l)return null;_intersectionPointWorld.copy(o),_intersectionPointWorld.applyMatrix4(e.matrixWorld);o=r.ray.origin.distanceTo(_intersectionPointWorld);return o<r.near||o>r.far?null:{distance:o,point:_intersectionPointWorld.clone(),object:e}}function checkBufferGeometryIntersection(e,t,r,i,n,a,s,o,l,c,h,u){_vA$1.fromBufferAttribute(n,c),_vB$1.fromBufferAttribute(n,h),_vC$1.fromBufferAttribute(n,u);var d=e.morphTargetInfluences;if(a&&d){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(let e=0,t=a.length;e<t;e++){var p=d[e],f=a[e];0!==p&&(_tempA.fromBufferAttribute(f,c),_tempB.fromBufferAttribute(f,h),_tempC.fromBufferAttribute(f,u),s?(_morphA.addScaledVector(_tempA,p),_morphB.addScaledVector(_tempB,p),_morphC.addScaledVector(_tempC,p)):(_morphA.addScaledVector(_tempA.sub(_vA$1),p),_morphB.addScaledVector(_tempB.sub(_vB$1),p),_morphC.addScaledVector(_tempC.sub(_vC$1),p)))}_vA$1.add(_morphA),_vB$1.add(_morphB),_vC$1.add(_morphC)}e.isSkinnedMesh&&(e.boneTransform(c,_vA$1),e.boneTransform(h,_vB$1),e.boneTransform(u,_vC$1));const m=checkIntersection(e,t,r,i,_vA$1,_vB$1,_vC$1,_intersectionPoint);return m&&(o&&(_uvA$1.fromBufferAttribute(o,c),_uvB$1.fromBufferAttribute(o,h),_uvC$1.fromBufferAttribute(o,u),m.uv=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),l&&(_uvA$1.fromBufferAttribute(l,c),_uvB$1.fromBufferAttribute(l,h),_uvC$1.fromBufferAttribute(l,u),m.uv2=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),l={a:c,b:h,c:u,normal:new Vector3,materialIndex:0},Triangle.getNormal(_vA$1,_vB$1,_vC$1,l.normal),m.face=l),m}Mesh.prototype.isMesh=!0;class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,i=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};const A=this;i=Math.floor(i),n=Math.floor(n),a=Math.floor(a);const C=[],L=[],P=[],I=[];let R=0,D=0;function s(r,i,n,a,s,e,t,o,l,c,h){var u=e/l,d=t/c,p=e/2,f=t/2,m=o/2,g=l+1,_=c+1;let v=0,y=0;const x=new Vector3;for(let t=0;t<_;t++){var b=t*d-f;for(let e=0;e<g;e++){var w=e*u-p;x[r]=w*a,x[i]=b*s,x[n]=m,L.push(x.x,x.y,x.z),x[r]=0,x[i]=0,x[n]=0<o?1:-1,P.push(x.x,x.y,x.z),I.push(e/l),I.push(1-t/c),v+=1}}for(let t=0;t<c;t++)for(let e=0;e<l;e++){var T=R+e+g*t,E=R+e+g*(t+1),S=R+(e+1)+g*(t+1),M=R+(e+1)+g*t;C.push(T,E,M),C.push(E,S,M),y+=6}A.addGroup(D,y,h),D+=y,R+=v}s("z","y","x",-1,-1,r,t,e,a,n,0),s("z","y","x",1,-1,r,t,-e,a,n,1),s("x","z","y",1,1,e,r,t,i,a,2),s("x","z","y",1,-1,e,r,-t,i,a,3),s("x","y","z",1,-1,e,t,r,i,n,4),s("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(C),this.setAttribute("position",new Float32BufferAttribute(L,3)),this.setAttribute("normal",new Float32BufferAttribute(P,3)),this.setAttribute("uv",new Float32BufferAttribute(I,2))}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cloneUniforms(e){const t={};for(const r in e){t[r]={};for(const i in e[r]){const n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}function mergeUniforms(t){const r={};for(let e=0;e<t.length;e++){var i=cloneUniforms(t[e]);for(const n in i)r[n]=i[n]}return r}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class ShaderMaterial extends Material{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const r={};for(const a in this.extensions)!0===this.extensions[a]&&(r[a]=!0);return 0<Object.keys(r).length&&(t.extensions=r),t}}ShaderMaterial.prototype.isShaderMaterial=!0;class Camera extends Object3D{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Camera.prototype.isCamera=!0;class PerspectiveCamera extends Camera{constructor(e=50,t=1,r=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){e=.5*this.getFilmHeight()/e;this.fov=2*RAD2DEG*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){var e=Math.tan(.5*DEG2RAD*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*RAD2DEG*Math.atan(Math.tan(.5*DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=this.near;let t=e*Math.tan(.5*DEG2RAD*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i;var a,s=this.view;null!==this.view&&this.view.enabled&&(a=s.fullWidth,o=s.fullHeight,n+=s.offsetX*i/a,t-=s.offsetY*r/o,i*=s.width/a,r*=s.height/o);var o=this.filmOffset;0!==o&&(n+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}PerspectiveCamera.prototype.isPerspectiveCamera=!0;const fov=90,aspect=1;class CubeCamera extends Object3D{constructor(e,t,r){if(super(),this.type="CubeCamera",!0===r.isWebGLCubeRenderTarget){this.renderTarget=r;const i=new PerspectiveCamera(fov,aspect,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Vector3(1,0,0)),this.add(i);const n=new PerspectiveCamera(fov,aspect,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(-1,0,0)),this.add(n);const a=new PerspectiveCamera(fov,aspect,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new Vector3(0,1,0)),this.add(a);const s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Vector3(0,-1,0)),this.add(s);const o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Vector3(0,0,1)),this.add(o);const l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l)}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}update(e,t){null===this.parent&&this.updateMatrixWorld();const r=this.renderTarget;var[i,n,a,s,o,l]=this.children,c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;var u=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,n),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,o),r.texture.generateMipmaps=u,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}class CubeTexture extends Texture{constructor(e,t,r,i,n,a,s,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:CubeReflectionMapping,r,i,n,a,s,o,l,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}CubeTexture.prototype.isCubeTexture=!0;class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new CubeTexture(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:LinearFilter,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=RGBAFormat,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new BoxGeometry(5,5,5);const n=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:BackSide,blending:NoBlending});n.uniforms.tEquirect.value=t;const a=new Mesh(i,n);i=t.minFilter;t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter);const s=new CubeCamera(1,10,this);return s.update(e,a),t.minFilter=i,a.geometry.dispose(),a.material.dispose(),this}clear(t,r,i,n){var e=t.getRenderTarget();for(let e=0;e<6;e++)t.setRenderTarget(this,e),t.clear(r,i,n);t.setRenderTarget(e)}}WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){t=_vector1.subVectors(r,t).cross(_vector2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(t,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){var r=e.delta(_vector1),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;i=-(e.start.dot(this.normal)+this.constant)/i;return i<0||1<i?null:t.copy(r).multiplyScalar(i).add(e.start)}intersectsLine(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){t=t||_normalMatrix.getNormalMatrix(e);const r=this.coplanarPoint(_vector1).applyMatrix4(e);t=this.normal.applyMatrix3(t).normalize();return this.constant=-r.dot(t),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Plane.prototype.isPlane=!0;const _sphere$2=new Sphere,_vector$7=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,r=new Plane,i=new Plane,n=new Plane,a=new Plane){this.planes=[e,t,r,i,n,a]}set(e,t,r,i,n,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(i),s[4].copy(n),s[5].copy(a),this}copy(t){const r=this.planes;for(let e=0;e<6;e++)r[e].copy(t.planes[e]);return this}setFromProjectionMatrix(e){const t=this.planes;var r=e.elements,i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],l=r[5],c=r[6],h=r[7],u=r[8],d=r[9],p=r[10],f=r[11],m=r[12],g=r[13],e=r[14],r=r[15];return t[0].setComponents(s-i,h-o,f-u,r-m).normalize(),t[1].setComponents(s+i,h+o,f+u,r+m).normalize(),t[2].setComponents(s+n,h+l,f+d,r+g).normalize(),t[3].setComponents(s-n,h-l,f-d,r-g).normalize(),t[4].setComponents(s-a,h-c,f-p,r-e).normalize(),t[5].setComponents(s+a,h+c,f+p,r+e).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),_sphere$2.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSprite(e){return _sphere$2.center.set(0,0,0),_sphere$2.radius=.7071067811865476,_sphere$2.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSphere(e){const t=this.planes;var r=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<i)return!1;return!0}intersectsBox(t){var r=this.planes;for(let e=0;e<6;e++){const i=r[e];if(_vector$7.x=(0<i.normal.x?t.max:t.min).x,_vector$7.y=(0<i.normal.y?t.max:t.min).y,_vector$7.z=(0<i.normal.z?t.max:t.min).z,i.distanceToPoint(_vector$7)<0)return!1}return!0}containsPoint(t){const r=this.planes;for(let e=0;e<6;e++)if(r[e].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function WebGLAnimation(){let r=null,e=!1,i=null,n=null;function a(e,t){i(e,t),n=r.requestAnimationFrame(a)}return{start:function(){!0!==e&&null!==i&&(n=r.requestAnimationFrame(a),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(e){i=e},setContext:function(e){r=e}}}function WebGLAttributes(s,e){const o=e.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=n.get(e);t&&(s.deleteBuffer(t.buffer),n.delete(e))},update:function(e,t){if(e.isGLBufferAttribute){var r=n.get(e);(!r||r.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);void 0===i?n.set(e,function(e,t){var r=e.array,i=e.usage,n=s.createBuffer();s.bindBuffer(t,n),s.bufferData(t,r,i),e.onUploadCallback();let a=5126;return r instanceof Float32Array?a=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?o?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:r instanceof Int16Array?a=5122:r instanceof Uint32Array?a=5125:r instanceof Int32Array?a=5124:r instanceof Int8Array?a=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(a=5121),{buffer:n,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,t)):i.version<e.version&&(function(e,t,r){const i=t.array,n=t.updateRange;s.bindBuffer(r,e),-1===n.count?s.bufferSubData(r,0,i):(o?s.bufferSubData(r,n.offset*i.BYTES_PER_ELEMENT,i,n.offset,n.count):s.bufferSubData(r,n.offset*i.BYTES_PER_ELEMENT,i.subarray(n.offset,n.offset+n.count)),n.count=-1)}(i.buffer,e,t),i.version=e.version)}}}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var n=e/2,a=t/2,s=Math.floor(r),o=Math.floor(i),l=s+1,c=o+1,h=e/s,u=t/o;const d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){var g=t*u-a;for(let e=0;e<l;e++){var _=e*h-n;p.push(_,-g,0),f.push(0,0,1),m.push(e/s),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<s;e++){var v=e+l*t,y=e+l*(t+1),x=e+1+l*(t+1),b=e+1+l*t;d.push(v,y,b),d.push(y,x,b)}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}var alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment="#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif";const vertex$g="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",fragment$g="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",vertex$f="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragment$f="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",vertex$e="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",fragment$e="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",vertex$d="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",fragment$d="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",vertex$c="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragment$c="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",vertex$b="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$b="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$a="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",fragment$a="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$9="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$9="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$8="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",fragment$8="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$7="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",fragment$7="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",vertex$6="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$6="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$5="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",fragment$5="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$4="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$4="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$3="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",fragment$3="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$2="#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$2="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",vertex$1="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$1="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,alphatest_pars_fragment:alphatest_pars_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normal_pars_fragment:normal_pars_fragment,normal_pars_vertex:normal_pars_vertex,normal_vertex:normal_vertex,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_pars_fragment:clearcoat_pars_fragment,output_fragment:output_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,transmission_fragment:transmission_fragment,transmission_pars_fragment:transmission_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_vert:vertex$g,background_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};function WebGLBackground(a,s,r,o,i){const l=new Color(0);let c=0,h,u,d=null,p=0,f=null;function m(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return l},setClearColor:function(e,t=1){l.set(e),c=t,m(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,m(l,c)},render:function(e,t){let r=!1,i=!0===t.isScene?t.background:null;i&&i.isTexture&&(i=s.get(i));const n=a.xr;(t=n.getSession&&n.getSession())&&"additive"===t.environmentBlendMode&&(i=null),null===i?m(l,c):i&&i.isColor&&(m(i,1),r=!0),(a.autoClear||r)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),i&&(i.isCubeTexture||i.mapping===CubeUVReflectionMapping)?(void 0===u&&(u=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(u)),u.material.uniforms.envMap.value=i,u.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,d===i&&p===i.version&&f===a.toneMapping||(u.material.needsUpdate=!0,d=i,p=i.version,f=a.toneMapping),e.unshift(u,u.geometry,u.material,0,0,null)):i&&i.isTexture&&(void 0===h&&(h=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(h)),h.material.uniforms.t2D.value=i,!0===i.matrixAutoUpdate&&i.updateMatrix(),h.material.uniforms.uvTransform.value.copy(i.matrix),d===i&&p===i.version&&f===a.toneMapping||(h.material.needsUpdate=!0,d=i,p=i.version,f=a.toneMapping),e.unshift(h,h.geometry,h.material,0,0,null))}}}function WebGLBindingStates(y,x,b,w){const n=y.getParameter(34921),o=w.isWebGL2?null:x.get("OES_vertex_array_object"),l=w.isWebGL2||null!==o,c={},e=d(null);let h=e;function u(e){return w.isWebGL2?y.bindVertexArray(e):o.bindVertexArrayOES(e)}function a(e){return w.isWebGL2?y.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function d(e){const t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function T(){const r=h.newAttributes;for(let e=0,t=r.length;e<t;e++)r[e]=0}function E(e){S(e,0)}function S(e,t){const r=h.newAttributes,i=h.enabledAttributes,n=h.attributeDivisors;if(r[e]=1,0===i[e]&&(y.enableVertexAttribArray(e),i[e]=1),n[e]!==t){const a=w.isWebGL2?y:x.get("ANGLE_instanced_arrays");a[w.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),n[e]=t}}function M(){var r=h.newAttributes;const i=h.enabledAttributes;for(let e=0,t=i.length;e<t;e++)i[e]!==r[e]&&(y.disableVertexAttribArray(e),i[e]=0)}function A(e,t,r,i,n,a){!0!==w.isWebGL2||5124!==r&&5125!==r?y.vertexAttribPointer(e,t,r,i,n,a):y.vertexAttribIPointer(e,t,r,n,a)}function s(){t(),h!==e&&(h=e,u(h.object))}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(e,t,r,i,n){let a=!1;var s;l?(s=function(e,t,r){r=!0===r.wireframe;let i=c[e.id];void 0===i&&(i={},c[e.id]=i);let n=i[t.id];void 0===n&&(n={},i[t.id]=n);let a=n[r];void 0===a&&(a=d(w.isWebGL2?y.createVertexArray():o.createVertexArrayOES()),n[r]=a);return a}(i,r,t),h!==s&&(h=s,u(h.object)),a=function(e,t){var r=h.attributes,i=e.attributes;let n=0;for(const o in i){var a=r[o],s=i[o];if(void 0===a)return!0;if(a.attribute!==s)return!0;if(a.data!==s.data)return!0;n++}return h.attributesNum!==n||h.index!==t}(i,n),a&&function(e,t){const r={},i=e.attributes;let n=0;for(const s in i){var a=i[s];const o={};(o.attribute=a).data&&(o.data=a.data),r[s]=o,n++}h.attributes=r,h.attributesNum=n,h.index=t}(i,n)):(s=!0===t.wireframe,h.geometry===i.id&&h.program===r.id&&h.wireframe===s||(h.geometry=i.id,h.program=r.id,h.wireframe=s,a=!0)),!0===e.isInstancedMesh&&(a=!0),null!==n&&b.update(n,34963),a&&(function(e,t,r,i){if(!1===w.isWebGL2&&(e.isInstancedMesh||i.isInstancedBufferGeometry)&&null===x.get("ANGLE_instanced_arrays"))return;T();var n=i.attributes,a=r.getAttributes(),s=t.defaultAttributeValues;for(const v in a){var o=a[v];if(0<=o.location){let t=n[v];if(void 0===t&&("instanceMatrix"===v&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===v&&e.instanceColor&&(t=e.instanceColor)),void 0!==t){var l=t.normalized,c=t.itemSize,h=b.get(t);if(void 0!==h){var u=h.buffer,d=h.type,p=h.bytesPerElement;if(t.isInterleavedBufferAttribute){var f=t.data,m=f.stride,g=t.offset;if(f&&f.isInstancedInterleavedBuffer){for(let e=0;e<o.locationSize;e++)S(o.location+e,f.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=f.meshPerAttribute*f.count)}else for(let e=0;e<o.locationSize;e++)E(o.location+e);y.bindBuffer(34962,u);for(let e=0;e<o.locationSize;e++)A(o.location+e,c/o.locationSize,d,l,m*p,(g+c/o.locationSize*e)*p)}else{if(t.isInstancedBufferAttribute){for(let e=0;e<o.locationSize;e++)S(o.location+e,t.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<o.locationSize;e++)E(o.location+e);y.bindBuffer(34962,u);for(let e=0;e<o.locationSize;e++)A(o.location+e,c/o.locationSize,d,l,c*p,c/o.locationSize*e*p)}}}else if(void 0!==s){var _=s[v];if(void 0!==_)switch(_.length){case 2:y.vertexAttrib2fv(o.location,_);break;case 3:y.vertexAttrib3fv(o.location,_);break;case 4:y.vertexAttrib4fv(o.location,_);break;default:y.vertexAttrib1fv(o.location,_)}}}}M()}(e,t,r,i),null!==n&&y.bindBuffer(34963,b.get(n).buffer))},reset:s,resetDefaultState:t,dispose:function(){s();for(const e in c){const t=c[e];for(const r in t){const i=t[r];for(const n in i)a(i[n].object),delete i[n];delete t[r]}delete c[e]}},releaseStatesOfGeometry:function(e){if(void 0!==c[e.id]){const t=c[e.id];for(const r in t){const i=t[r];for(const n in i)a(i[n].object),delete i[n];delete t[r]}delete c[e.id]}},releaseStatesOfProgram:function(e){for(const t in c){const r=c[t];if(void 0!==r[e.id]){const i=r[e.id];for(const n in i)a(i[n].object),delete i[n];delete r[e.id]}}},initAttributes:T,enableAttribute:E,disableUnusedAttributes:M}}function WebGLBufferRenderer(a,s,o,e){const l=e.isWebGL2;let c;this.setMode=function(e){c=e},this.render=function(e,t){a.drawArrays(c,e,t),o.update(t,c,1)},this.renderInstances=function(r,i,n){if(0!==n){let e,t;if(l)e=a,t="drawArraysInstanced";else if(e=s.get("ANGLE_instanced_arrays"),t="drawArraysInstancedANGLE",null===e)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,r,i,n),o.update(i,c,n)}}}function WebGLCapabilities(t,r,e){let i;function n(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==e.precision?e.precision:"highp";var o=n(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);var l=a||r.has("WEBGL_draw_buffers"),c=!0===e.logarithmicDepthBuffer,h=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),_=t.getParameter(36349),v=0<u,y=a||r.has("OES_texture_float"),o=v&&y,e=a?t.getParameter(36183):0;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){return void 0!==i||(i=!0===r.has("EXT_texture_filter_anisotropic")?(e=r.get("EXT_texture_filter_anisotropic"),t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0),i;var e},getMaxPrecision:n,precision:s,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:o,maxSamples:e}}function WebGLClipping(t){const o=this;let c=null,h=0,u=!1,d=!1;const l=new Plane,p=new Matrix3,f={value:null,needsUpdate:!1};function m(){f.value!==c&&(f.value=c,f.needsUpdate=0<h),o.numPlanes=h,o.numIntersection=0}function g(r,e,i,t){var n=null!==r?r.length:0;let a=null;if(0!==n){if(a=f.value,!0!==t||null===a){var t=i+4*n,s=e.matrixWorldInverse;p.getNormalMatrix(s),(null===a||a.length<t)&&(a=new Float32Array(t));for(let e=0,t=i;e!==n;++e,t+=4)l.copy(r[e]).applyMatrix4(s,p),l.normal.toArray(a,t),a[t+3]=l.constant}f.value=a,f.needsUpdate=!0}return o.numPlanes=n,o.numIntersection=0,a}this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){var i=0!==e.length||t||0!==h||u;return u=t,c=g(e,r,0),h=e.length,i},this.beginShadows=function(){d=!0,g(null)},this.endShadows=function(){d=!1,m()},this.setState=function(e,r,i){var n=e.clippingPlanes,a=e.clipIntersection,s=e.clipShadows;const o=t.get(e);if(!u||null===n||0===n.length||d&&!s)d?g(null):m();else{var s=d?0:h,l=4*s;let t=o.clippingState||null;f.value=t,t=g(n,r,l,i);for(let e=0;e!==l;++e)t[e]=c[e];o.clippingState=t,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=s}}}function WebGLCubeMaps(n){let a=new WeakMap;function s(e,t){return t===EquirectangularReflectionMapping?e.mapping=CubeReflectionMapping:t===EquirectangularRefractionMapping&&(e.mapping=CubeRefractionMapping),e}function o(e){const t=e.target;t.removeEventListener("dispose",o);const r=a.get(t);void 0!==r&&(a.delete(t),r.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t=e.mapping;if(t===EquirectangularReflectionMapping||t===EquirectangularRefractionMapping){if(a.has(e))return s(a.get(e).texture,e.mapping);var r=e.image;if(r&&0<r.height){t=n.getRenderTarget();const i=new WebGLCubeRenderTarget(r.height/2);return i.fromEquirectangularTexture(n,e),a.set(e,i),n.setRenderTarget(t),e.addEventListener("dispose",o),s(i.texture,e.mapping)}return null}}return e},dispose:function(){a=new WeakMap}}}ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};class OrthographicCamera extends Camera{constructor(e=-1,t=1,r=1,i=-1,n=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let n=r-e,a=r+e,s=i+t,o=i-t;null!==this.view&&this.view.enabled&&(i=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,n+=i*this.view.offsetX,a=n+i*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height),this.projectionMatrix.makeOrthographic(n,a,s,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}OrthographicCamera.prototype.isOrthographicCamera=!0;class RawShaderMaterial extends ShaderMaterial{constructor(e){super(e),this.type="RawShaderMaterial"}}RawShaderMaterial.prototype.isRawShaderMaterial=!0;const LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS={[LinearEncoding]:0,[sRGBEncoding]:1,[RGBEEncoding]:2,[RGBM7Encoding]:3,[RGBM16Encoding]:4,[RGBDEncoding]:5,[GammaEncoding]:6},_flatCamera=new OrthographicCamera,{_lodPlanes,_sizeLods,_sigmas}=_createPlanes(),_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=_getBlurShader(MAX_SAMPLES),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){_oldTarget=this._renderer.getRenderTarget();var n=this._allocateTargets();return this._sceneToCubeUV(e,r,i,n),0<t&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<_lodPlanes.length;e++)_lodPlanes[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(_oldTarget),e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}_fromTexture(e){_oldTarget=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){var t={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:UnsignedByteType,format:RGBEFormat,encoding:_isLDR(e)?e.encoding:RGBEEncoding,depthBuffer:!1};const r=_createRenderTarget(t);return r.depthBuffer=!e,this._pingPongRenderTarget=_createRenderTarget(t),r}_compileMaterial(e){e=new Mesh(_lodPlanes[0],e);this._renderer.compile(e,_flatCamera)}_sceneToCubeUV(t,e,r,i){const n=new PerspectiveCamera(90,1,e,r);var a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1];const o=this._renderer;var l=o.autoClear,c=o.outputEncoding,e=o.toneMapping;o.getClearColor(_clearColor),o.toneMapping=NoToneMapping,o.outputEncoding=LinearEncoding,o.autoClear=!1;const h=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),u=new Mesh(new BoxGeometry,h);let d=!1;r=t.background;r?r.isColor&&(h.color.copy(r),t.background=null,d=!0):(h.color.copy(_clearColor),d=!0);for(let e=0;e<6;e++){var p=e%3;0==p?(n.up.set(0,a[e],0),n.lookAt(s[e],0,0)):1==p?(n.up.set(0,0,a[e]),n.lookAt(0,s[e],0)):(n.up.set(0,a[e],0),n.lookAt(0,0,s[e])),_setViewport(i,p*SIZE_MAX,2<e?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),o.setRenderTarget(i),d&&o.render(u,n),o.render(t,n)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=e,o.outputEncoding=c,o.autoClear=l,t.background=r}_setEncoding(e,t){!0===this._renderer.capabilities.isWebGL2&&t.format===RGBAFormat&&t.type===UnsignedByteType&&t.encoding===sRGBEncoding?e.value=ENCODINGS[LinearEncoding]:e.value=ENCODINGS[t.encoding]}_textureToCubeUV(e,t){const r=this._renderer;var i=e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping;i?null==this._cubemapShader&&(this._cubemapShader=_getCubemapShader()):null==this._equirectShader&&(this._equirectShader=_getEquirectShader());var n=i?this._cubemapShader:this._equirectShader,a=new Mesh(_lodPlanes[0],n);const s=n.uniforms;s.envMap.value=e,i||s.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(s.inputEncoding,e),this._setEncoding(s.outputEncoding,t.texture),_setViewport(t,0,0,3*SIZE_MAX,2*SIZE_MAX),r.setRenderTarget(t),r.render(a,_flatCamera)}_applyPMREM(t){const e=this._renderer;var r=e.autoClear;e.autoClear=!1;for(let e=1;e<TOTAL_LODS;e++){var i=Math.sqrt(_sigmas[e]*_sigmas[e]-_sigmas[e-1]*_sigmas[e-1]),n=_axisDirections[(e-1)%_axisDirections.length];this._blur(t,e-1,e,i,n)}e.autoClear=r}_blur(e,t,r,i,n){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",n),this._halfBlur(a,e,r,r,i,"longitudinal",n)}_halfBlur(e,t,r,i,n,a,s){const o=this._renderer;var l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Mesh(_lodPlanes[i],l);const h=l.uniforms;var l=_sizeLods[r]-1,l=isFinite(n)?Math.PI/(2*l):2*Math.PI/(2*MAX_SAMPLES-1),u=n/l,d=isFinite(n)?1+Math.floor(3*u):MAX_SAMPLES;d>MAX_SAMPLES&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${d} samples when the maximum is set to ${MAX_SAMPLES}`);const p=[];let f=0;for(let e=0;e<MAX_SAMPLES;++e){const g=e/u;var m=Math.exp(-g*g/2);p.push(m),0==e?f+=m:e<d&&(f+=2*m)}for(let e=0;e<p.length;e++)p[e]=p[e]/f;h.envMap.value=e.texture,h.samples.value=d,h.weights.value=p,h.latitudinal.value="latitudinal"===a,s&&(h.poleAxis.value=s),h.dTheta.value=l,h.mipInt.value=LOD_MAX-r,this._setEncoding(h.inputEncoding,e.texture),this._setEncoding(h.outputEncoding,e.texture);e=_sizeLods[i];const g=3*Math.max(0,SIZE_MAX-2*e);i=(0===i?0:2*SIZE_MAX)+2*e*(i>LOD_MAX-LOD_MIN?i-LOD_MAX+LOD_MIN:0);_setViewport(t,g,i,3*e,2*e),o.setRenderTarget(t),o.render(c,_flatCamera)}}function _isLDR(e){return void 0!==e&&e.type===UnsignedByteType&&(e.encoding===LinearEncoding||e.encoding===sRGBEncoding||e.encoding===GammaEncoding)}function _createPlanes(){const r=[],i=[],n=[];let a=LOD_MAX;for(let t=0;t<TOTAL_LODS;t++){var s=Math.pow(2,a);i.push(s);let e=1/s;t>LOD_MAX-LOD_MIN?e=EXTRA_LOD_SIGMA[t-LOD_MAX+LOD_MIN-1]:0==t&&(e=0),n.push(e);var o=1/(s-1),s=-o/2,o=1+o/2,l=[s,s,o,s,o,o,s,s,o,o,s,o];const u=new Float32Array(108),d=new Float32Array(72),p=new Float32Array(36);for(let e=0;e<6;e++){var c=e%3*2/3-1,h=2<e?0:-1;u.set([c,h,0,c+2/3,h,0,c+2/3,1+h,0,c,h,0,c+2/3,1+h,0,c,1+h,0],18*e),d.set(l,12*e);h=[e,e,e,e,e,e];p.set(h,6*e)}const f=new BufferGeometry;f.setAttribute("position",new BufferAttribute(u,3)),f.setAttribute("uv",new BufferAttribute(d,2)),f.setAttribute("faceIndex",new BufferAttribute(p,1)),r.push(f),a>LOD_MIN&&a--}return{_lodPlanes:r,_sizeLods:i,_sigmas:n}}function _createRenderTarget(e){const t=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,e);return t.texture.mapping=CubeUVReflectionMapping,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function _setViewport(e,t,r,i,n){e.viewport.set(t,r,i,n),e.scissor.set(t,r,i,n)}function _getBlurShader(e){var t=new Float32Array(e),r=new Vector3(0,1,0);return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${_getEncodings()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectShader(){var e=new Vector2(1,1);return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${_getEncodings()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${_getEncodings()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function _getEncodings(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function WebGLCubeUVMaps(n){let a=new WeakMap,s=null;function o(e){const t=e.target;t.removeEventListener("dispose",o);const r=a.get(t);void 0!==r&&(a.delete(t),r.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t=e.mapping,r=t===EquirectangularReflectionMapping||t===EquirectangularRefractionMapping,i=t===CubeReflectionMapping||t===CubeRefractionMapping;if(r||i){if(a.has(e))return a.get(e).texture;t=e.image;if(r&&t&&0<t.height||i&&t&&function(t){let r=0;for(let e=0;e<6;e++)void 0!==t[e]&&r++;return 6===r}(t)){t=n.getRenderTarget();null===s&&(s=new PMREMGenerator(n));r=r?s.fromEquirectangular(e):s.fromCubemap(e);return a.set(e,r),n.setRenderTarget(t),e.addEventListener("dispose",o),r.texture}return null}}return e},dispose:function(){a=new WeakMap,null!==s&&(s.dispose(),s=null)}}}function WebGLExtensions(r){const i={};function n(e){if(void 0!==i[e])return i[e];let t;switch(e){case"WEBGL_depth_texture":t=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}return i[e]=t,t}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function WebGLGeometries(e,f,i,n){const a={},m=new WeakMap;function s(e){const t=e.target;null!==t.index&&f.remove(t.index);for(const r in t.attributes)f.remove(t.attributes[r]);t.removeEventListener("dispose",s),delete a[t.id];e=m.get(t);e&&(f.remove(e),m.delete(t)),n.releaseStatesOfGeometry(t),!0===t.isInstancedBufferGeometry&&delete t._maxInstanceCount,i.memory.geometries--}function o(e){const r=[];var t=e.index,i=e.attributes.position;let n=0;if(null!==t){var a=t.array;n=t.version;for(let e=0,t=a.length;e<t;e+=3){var s=a[e+0],o=a[e+1],l=a[e+2];r.push(s,o,o,l,l,s)}}else{var c=i.array;n=i.version;for(let e=0,t=c.length/3-1;e<t;e+=3){var h=e+0,u=e+1,d=e+2;r.push(h,u,u,d,d,h)}}const p=new(65535<arrayMax(r)?Uint32BufferAttribute:Uint16BufferAttribute)(r,1);p.version=n;c=m.get(e);c&&f.remove(c),m.set(e,p)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",s),a[t.id]=!0,i.memory.geometries++),t},update:function(e){var t=e.attributes;for(const n in t)f.update(t[n],34962);var r=e.morphAttributes;for(const a in r){var i=r[a];for(let e=0,t=i.length;e<t;e++)f.update(i[e],34962)}},getWireframeAttribute:function(e){var t,r=m.get(e);return(!r||null!==(t=e.index)&&r.version<t.version)&&o(e),m.get(e)}}}function WebGLIndexedBufferRenderer(a,s,o,e){const l=e.isWebGL2;let c;let h,u;this.setMode=function(e){c=e},this.setIndex=function(e){h=e.type,u=e.bytesPerElement},this.render=function(e,t){a.drawElements(c,t,h,e*u),o.update(t,c,1)},this.renderInstances=function(r,i,n){if(0!==n){let e,t;if(l)e=a,t="drawElementsInstanced";else if(e=s.get("ANGLE_instanced_arrays"),t="drawElementsInstancedANGLE",null===e)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,i,h,r*u,n),o.update(i,c,n)}}}function WebGLInfo(e){const i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(e,t,r){switch(i.calls++,t){case 4:i.triangles+=r*(e/3);break;case 1:i.lines+=r*(e/2);break;case 3:i.lines+=r*(e-1);break;case 2:i.lines+=r*e;break;case 0:i.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}class DataTexture2DArray extends Texture{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function numericalSort(e,t){return e[0]-t[0]}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function denormalize(e,t){let r=1;t=(t.isInterleavedBufferAttribute?t.data:t).array;t instanceof Int8Array?r=127:t instanceof Int16Array?r=32767:t instanceof Int32Array?r=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",t),e.divideScalar(r)}function WebGLMorphtargets(E,S,r){const M={},A=new Float32Array(8),C=new WeakMap,L=new Vector3,P=[];for(let e=0;e<8;e++)P[e]=[e,0];return{update:function(e,i,t,n){var a=e.morphTargetInfluences;if(!0===S.isWebGL2){var s=i.morphAttributes.position.length;let e=C.get(i);if(void 0===e||e.count!==s){void 0!==e&&e.texture.dispose();var o=void 0!==i.morphAttributes.normal,l=i.morphAttributes.position,c=i.morphAttributes.normal||[],h=!0==o?2:1;let t=i.attributes.position.count*h,r=1;t>S.maxTextureSize&&(r=Math.ceil(t/S.maxTextureSize),t=S.maxTextureSize);const b=new Float32Array(t*r*4*s),w=new DataTexture2DArray(b,t,r,s);w.format=RGBAFormat,w.type=FloatType;var u=4*h;for(let e=0;e<s;e++){var d=l[e],p=c[e],f=t*r*4*e;for(let e=0;e<d.count;e++){L.fromBufferAttribute(d,e),!0===d.normalized&&denormalize(L,d);var m=e*u;b[f+m]=L.x,b[f+m+1]=L.y,b[f+m+2]=L.z,!(b[f+m+3]=0)==o&&(L.fromBufferAttribute(p,e),!0===p.normalized&&denormalize(L,p),b[f+m+4]=L.x,b[f+m+5]=L.y,b[f+m+6]=L.z,b[f+m+7]=0)}}e={count:s,texture:w,size:new Vector2(t,r)},C.set(i,e)}let t=0;for(let e=0;e<a.length;e++)t+=a[e];h=i.morphTargetsRelative?1:1-t;n.getUniforms().setValue(E,"morphTargetBaseInfluence",h),n.getUniforms().setValue(E,"morphTargetInfluences",a),n.getUniforms().setValue(E,"morphTargetsTexture",e.texture,r),n.getUniforms().setValue(E,"morphTargetsTextureSize",e.size)}else{var g=void 0===a?0:a.length;let t=M[i.id];if(void 0===t||t.length!==g){t=[];for(let e=0;e<g;e++)t[e]=[e,0];M[i.id]=t}for(let e=0;e<g;e++){const T=t[e];T[0]=e,T[1]=a[e]}t.sort(absNumericalSort);for(let e=0;e<8;e++)e<g&&t[e][1]?(P[e][0]=t[e][0],P[e][1]=t[e][1]):(P[e][0]=Number.MAX_SAFE_INTEGER,P[e][1]=0);P.sort(numericalSort);var _=i.morphAttributes.position,v=i.morphAttributes.normal;let r=0;for(let e=0;e<8;e++){var y=P[e],x=y[0],y=y[1];x!==Number.MAX_SAFE_INTEGER&&y?(_&&i.getAttribute("morphTarget"+e)!==_[x]&&i.setAttribute("morphTarget"+e,_[x]),v&&i.getAttribute("morphNormal"+e)!==v[x]&&i.setAttribute("morphNormal"+e,v[x]),A[e]=y,r+=y):(_&&!0===i.hasAttribute("morphTarget"+e)&&i.deleteAttribute("morphTarget"+e),v&&!0===i.hasAttribute("morphNormal"+e)&&i.deleteAttribute("morphNormal"+e),A[e]=0)}h=i.morphTargetsRelative?1:1-r;n.getUniforms().setValue(E,"morphTargetBaseInfluence",h),n.getUniforms().setValue(E,"morphTargetInfluences",A)}}}}function WebGLObjects(e,i,n,a){let s=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var t=a.render.frame,r=e.geometry,r=i.get(e,r);return s.get(r)!==t&&(i.update(r),s.set(r,t)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),r},dispose:function(){s=new WeakMap}}}DataTexture2DArray.prototype.isDataTexture2DArray=!0;class DataTexture3D extends Texture{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture3D.prototype.isDataTexture3D=!0;const emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(r,i,n){const e=r[0];if(e<=0||0<e)return r;var t=i*n;let a=arrayCacheF32[t];if(void 0===a&&(a=new Float32Array(t),arrayCacheF32[t]=a),0!==i){e.toArray(a,0);for(let e=1,t=0;e!==i;++e)t+=n,r[e].toArray(a,t)}return a}function arraysEqual(r,i){if(r.length!==i.length)return!1;for(let e=0,t=r.length;e<t;e++)if(r[e]!==i[e])return!1;return!0}function copyArray(r,i){for(let e=0,t=i.length;e<t;e++)r[e]=i[e]}function allocTexUnits(t,r){let i=arrayCacheI32[r];void 0===i&&(i=new Int32Array(r),arrayCacheI32[r]=i);for(let e=0;e!==r;++e)i[e]=t.allocateTextureUnit();return i}function setValueV1f(e,t){const r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function setValueV2f(e,t){const r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y):arraysEqual(r,t)||(e.uniform2fv(this.addr,t),copyArray(r,t))}function setValueV3f(e,t){const r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z):void 0!==t.r?r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b):arraysEqual(r,t)||(e.uniform3fv(this.addr,t),copyArray(r,t))}function setValueV4f(e,t){const r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w):arraysEqual(r,t)||(e.uniform4fv(this.addr,t),copyArray(r,t))}function setValueM2(e,t){var r=this.cache,i=t.elements;void 0===i?arraysEqual(r,t)||(e.uniformMatrix2fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,i)||(mat2array.set(i),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(r,i))}function setValueM3(e,t){var r=this.cache,i=t.elements;void 0===i?arraysEqual(r,t)||(e.uniformMatrix3fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,i)||(mat3array.set(i),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(r,i))}function setValueM4(e,t){var r=this.cache,i=t.elements;void 0===i?arraysEqual(r,t)||(e.uniformMatrix4fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,i)||(mat4array.set(i),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(r,i))}function setValueV1i(e,t){const r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function setValueV2i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform2iv(this.addr,t),copyArray(r,t))}function setValueV3i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform3iv(this.addr,t),copyArray(r,t))}function setValueV4i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform4iv(this.addr,t),copyArray(r,t))}function setValueV1ui(e,t){const r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function setValueV2ui(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform2uiv(this.addr,t),copyArray(r,t))}function setValueV3ui(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform3uiv(this.addr,t),copyArray(r,t))}function setValueV4ui(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform4uiv(this.addr,t),copyArray(r,t))}function setValueT1(e,t,r){const i=this.cache;var n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.safeSetTexture2D(t||emptyTexture,n)}function setValueT3D1(e,t,r){const i=this.cache;var n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||emptyTexture3d,n)}function setValueT6(e,t,r){const i=this.cache;var n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.safeSetTextureCube(t||emptyCubeTexture,n)}function setValueT2DArray1(e,t,r){const i=this.cache;var n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(t||emptyTexture2dArray,n)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV2fArray(e,t){t=flatten(t,this.size,2);e.uniform2fv(this.addr,t)}function setValueV3fArray(e,t){t=flatten(t,this.size,3);e.uniform3fv(this.addr,t)}function setValueV4fArray(e,t){t=flatten(t,this.size,4);e.uniform4fv(this.addr,t)}function setValueM2Array(e,t){t=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function setValueM3Array(e,t){t=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function setValueM4Array(e,t){t=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV1uiArray(e,t){e.uniform1uiv(this.addr,t)}function setValueV2uiArray(e,t){e.uniform2uiv(this.addr,t)}function setValueV3uiArray(e,t){e.uniform3uiv(this.addr,t)}function setValueV4uiArray(e,t){e.uniform4uiv(this.addr,t)}function setValueT1Array(e,t,r){var i=t.length,n=allocTexUnits(r,i);e.uniform1iv(this.addr,n);for(let e=0;e!==i;++e)r.safeSetTexture2D(t[e]||emptyTexture,n[e])}function setValueT6Array(e,t,r){var i=t.length,n=allocTexUnits(r,i);e.uniform1iv(this.addr,n);for(let e=0;e!==i;++e)r.safeSetTextureCube(t[e]||emptyCubeTexture,n[e])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}function StructuredUniform(e){this.id=e,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)},StructuredUniform.prototype.setValue=function(r,i,n){var a=this.seq;for(let e=0,t=a.length;e!==t;++e){const s=a[e];s.setValue(r,i[s.id],n)}};const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,r,i){var n=e.name,a=n.length;for(RePathPart.lastIndex=0;;){var s=RePathPart.exec(n),o=RePathPart.lastIndex;let t=s[1];var l="]"===s[2],s=s[3];if(l&&(t|=0),void 0===s||"["===s&&o+2===a){addUniform(i,new(void 0===s?SingleUniform:PureArrayUniform)(t,e,r));break}{let e=i.map[t];void 0===e&&(e=new StructuredUniform(t),addUniform(i,e)),i=e}}}function WebGLUniforms(t,r){this.seq=[],this.map={};var i=t.getProgramParameter(r,35718);for(let e=0;e<i;++e){var n=t.getActiveUniform(r,e);parseUniform(n,t.getUniformLocation(r,n.name),this)}}function WebGLShader(e,t,r){t=e.createShader(t);return e.shaderSource(t,r),e.compileShader(t),t}WebGLUniforms.prototype.setValue=function(e,t,r,i){const n=this.map[t];void 0!==n&&n.setValue(e,r,i)},WebGLUniforms.prototype.setOptional=function(e,t,r){t=t[r];void 0!==t&&this.setValue(e,r,t)},WebGLUniforms.upload=function(r,i,n,a){for(let e=0,t=i.length;e!==t;++e){const s=i[e],o=n[s.id];!1!==o.needsUpdate&&s.setValue(r,o.value,a)}},WebGLUniforms.seqWithValue=function(r,i){const n=[];for(let e=0,t=r.length;e!==t;++e){var a=r[e];a.id in i&&n.push(a)}return n};let programIdCount=0;function addLineNumbers(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function getShaderErrors(e,t,r){var i=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();return i&&""===n?"":r.toUpperCase()+"\n\n"+n+"\n\n"+addLineNumbers(e.getShaderSource(t))}function getTexelDecodingFunction(e,t){t=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function getTexelEncodingFunction(e,t){t=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function getToneMappingFunction(e,t){let r;switch(t){case LinearToneMapping:r="Linear";break;case ReinhardToneMapping:r="Reinhard";break;case CineonToneMapping:r="OptimizedCineon";break;case ACESFilmicToneMapping:r="ACESFilmic";break;case CustomToneMapping:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function generateExtensions(e){const t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(filterEmptyLine).join("\n")}function generateDefines(e){const t=[];for(const i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}function fetchAttributeLocations(r,i){const n={};var e=r.getProgramParameter(i,35721);for(let t=0;t<e;t++){var a=r.getActiveAttrib(i,t),s=a.name;let e=1;35674===a.type&&(e=2),35675===a.type&&(e=3),35676===a.type&&(e=4),n[s]={type:a.type,location:r.getAttribLocation(i,s),locationSize:e}}return n}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}function includeReplacer(e,t){var r=ShaderChunk[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return resolveIncludes(r)}const deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(e,t,r,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(e,t,r,i)}function loopReplacer(e,t,r,i){let n="";for(let e=parseInt(t);e<parseInt(r);e++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function generatePrecision(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function generateShadowMapTypeDefine(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV"}return t}function generateEnvMapModeDefine(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case CubeRefractionMapping:case CubeUVRefractionMapping:t="ENVMAP_MODE_REFRACTION"}return t}function generateEnvMapBlendingDefine(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD"}return t}function WebGLProgram(r,e,t,i){const n=r.getContext();var a=t.defines,s=t.vertexShader,o=t.fragmentShader,l=generateShadowMapTypeDefine(t),c=generateEnvMapTypeDefine(t),h=generateEnvMapModeDefine(t),u=generateEnvMapBlendingDefine(t),d=0<r.gammaFactor?r.gammaFactor:1;const p=t.isWebGL2?"":generateExtensions(t),f=generateDefines(a),m=n.createProgram();let g,_,v=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(g=[f].filter(filterEmptyLine).join("\n"),0<g.length&&(g+="\n"),_=[p,f].filter(filterEmptyLine).join("\n"),0<_.length&&(_+="\n")):(g=[generatePrecision(t),"#define SHADER_NAME "+t.shaderName,f,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),_=[p,generatePrecision(t),"#define SHADER_NAME "+t.shaderName,f,"#define GAMMA_FACTOR "+d,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",t.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",t.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===RGBFormat?"#define OPAQUE":"",ShaderChunk.encodings_pars_fragment,t.map?getTexelDecodingFunction("mapTexelToLinear",t.mapEncoding):"",t.matcap?getTexelDecodingFunction("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?getTexelDecodingFunction("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularColorMap?getTexelDecodingFunction("specularColorMapTexelToLinear",t.specularColorMapEncoding):"",t.sheenColorMap?getTexelDecodingFunction("sheenColorMapTexelToLinear",t.sheenColorMapEncoding):"",t.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",t.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),s=replaceClippingPlaneNums(replaceLightNums(resolveIncludes(s),t),t),o=replaceClippingPlaneNums(replaceLightNums(resolveIncludes(o),t),t),s=unrollLoops(s),o=unrollLoops(o),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",t.glslVersion===GLSL3?"":"out highp vec4 pc_fragColor;",t.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);c=v+g+s,h=v+_+o,u=WebGLShader(n,35633,c),l=WebGLShader(n,35632,h);if(n.attachShader(m,u),n.attachShader(m,l),void 0!==t.index0AttributeName?n.bindAttribLocation(m,0,t.index0AttributeName):!0===t.morphTargets&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m),r.debug.checkShaderErrors){s=n.getProgramInfoLog(m).trim(),o=n.getShaderInfoLog(u).trim(),c=n.getShaderInfoLog(l).trim();let e=!0,t=!0;!1===n.getProgramParameter(m,35714)?(e=!1,h=getShaderErrors(n,u,"vertex"),r=getShaderErrors(n,l,"fragment"),console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+s+"\n"+h+"\n"+r)):""!==s?console.warn("THREE.WebGLProgram: Program Info Log:",s):""!==o&&""!==c||(t=!1),t&&(this.diagnostics={runnable:e,programLog:s,vertexShader:{log:o,prefix:g},fragmentShader:{log:c,prefix:_}})}n.deleteShader(u),n.deleteShader(l);let y;this.getUniforms=function(){return void 0===y&&(y=new WebGLUniforms(n,m)),y};let x;return this.getAttributes=function(){return void 0===x&&(x=fetchAttributeLocations(n,m)),x},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=u,this.fragmentShader=l,this}function WebGLPrograms(p,f,m,g,_,t,v){const a=[],y=_.isWebGL2,x=_.logarithmicDepthBuffer,b=_.floatVertexTextures,w=_.maxVertexUniforms,T=_.vertexTextures;let E=_.precision;const S={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},i=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function M(e){let t;return t=e&&e.isTexture?e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e.texture.encoding):LinearEncoding,y&&e&&e.isTexture&&e.format===RGBAFormat&&e.type===UnsignedByteType&&e.encoding===sRGBEncoding&&(t=LinearEncoding),t}return{getParameters:function(e,t,r,i,n){var a=i.fog,s=e.isMeshStandardMaterial?i.environment:null,o=(e.isMeshStandardMaterial?m:f).get(e.envMap||s),i=S[e.type],s=n.isSkinnedMesh?(h=(u=n).skeleton.bones,b?1024:(u=w,u=Math.floor((u-20)/4),(u=Math.min(u,h.length))<h.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+h.length+" bones. This GPU supports "+u+"."),0):u)):0;null!==e.precision&&(E=_.getMaxPrecision(e.precision),E!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",E,"instead."));let l,c;c=i?(d=ShaderLib[i],l=d.vertexShader,d.fragmentShader):(l=e.vertexShader,e.fragmentShader);var h=p.getRenderTarget(),u=0<e.alphaTest,d=0<e.clearcoat;return{isWebGL2:y,shaderID:i,shaderName:e.type,vertexShader:l,fragmentShader:c,defines:e.defines,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:E,instancing:!0===n.isInstancedMesh,instancingColor:!0===n.isInstancedMesh&&null!==n.instanceColor,supportsVertexTextures:T,outputEncoding:null!==h?M(h.texture):p.outputEncoding,map:!!e.map,mapEncoding:M(e.map),matcap:!!e.matcap,matcapEncoding:M(e.matcap),envMap:!!o,envMapMode:o&&o.mapping,envMapEncoding:M(o),envMapCubeUV:!!o&&(o.mapping===CubeUVReflectionMapping||o.mapping===CubeUVRefractionMapping),lightMap:!!e.lightMap,lightMapEncoding:M(e.lightMap),aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:M(e.emissiveMap),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:e.normalMapType===TangentSpaceNormalMap,clearcoat:d,clearcoatMap:d&&!!e.clearcoatMap,clearcoatRoughnessMap:d&&!!e.clearcoatRoughnessMap,clearcoatNormalMap:d&&!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,specularIntensityMap:!!e.specularIntensityMap,specularColorMap:!!e.specularColorMap,specularColorMapEncoding:M(e.specularColorMap),alphaMap:!!e.alphaMap,alphaTest:u,gradientMap:!!e.gradientMap,sheen:0<e.sheen,sheenColorMap:!!e.sheenColorMap,sheenColorMapEncoding:M(e.sheenColorMap),sheenRoughnessMap:!!e.sheenRoughnessMap,transmission:0<e.transmission,transmissionMap:!!e.transmissionMap,thicknessMap:!!e.thicknessMap,combine:e.combine,vertexTangents:!!e.normalMap&&!!n.geometry&&!!n.geometry.attributes.tangent,vertexColors:e.vertexColors,vertexAlphas:!0===e.vertexColors&&!!n.geometry&&!!n.geometry.attributes.color&&4===n.geometry.attributes.color.itemSize,vertexUvs:!!e.map||!!e.bumpMap||!!e.normalMap||!!e.specularMap||!!e.alphaMap||!!e.emissiveMap||!!e.roughnessMap||!!e.metalnessMap||!!e.clearcoatMap||!!e.clearcoatRoughnessMap||!!e.clearcoatNormalMap||!!e.displacementMap||!!e.transmissionMap||!!e.thicknessMap||!!e.specularIntensityMap||!!e.specularColorMap||!!e.sheenColorMap||e.sheenRoughnessMap,uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||0<e.transmission||e.transmissionMap||e.thicknessMap||e.specularIntensityMap||e.specularColorMap||0<!!e.sheen||e.sheenColorMap||e.sheenRoughnessMap||!e.displacementMap),fog:!!a,useFog:e.fog,fogExp2:a&&a.isFogExp2,flatShading:!!e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:x,skinning:!0===n.isSkinnedMesh&&0<s,maxBones:s,useVertexTexture:b,morphTargets:!!n.geometry&&!!n.geometry.morphAttributes.position,morphNormals:!!n.geometry&&!!n.geometry.morphAttributes.normal,morphTargetsCount:n.geometry&&n.geometry.morphAttributes.position?n.geometry.morphAttributes.position.length:0,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:v.numPlanes,numClipIntersection:v.numIntersection,format:e.format,dithering:e.dithering,shadowMapEnabled:p.shadowMap.enabled&&0<r.length,shadowMapType:p.shadowMap.type,toneMapping:e.toneMapped?p.toneMapping:NoToneMapping,physicallyCorrectLights:p.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,doubleSided:e.side===DoubleSide,flipSided:e.side===BackSide,depthPacking:void 0!==e.depthPacking&&e.depthPacking,index0AttributeName:e.index0AttributeName,extensionDerivatives:e.extensions&&e.extensions.derivatives,extensionFragDepth:e.extensions&&e.extensions.fragDepth,extensionDrawBuffers:e.extensions&&e.extensions.drawBuffers,extensionShaderTextureLOD:e.extensions&&e.extensions.shaderTextureLOD,rendererExtensionFragDepth:y||g.has("EXT_frag_depth"),rendererExtensionDrawBuffers:y||g.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:y||g.has("EXT_shader_texture_lod"),customProgramCacheKey:e.customProgramCacheKey()}},getProgramCacheKey:function(t){const r=[];if(t.shaderID?r.push(t.shaderID):(r.push(hashString(t.fragmentShader)),r.push(hashString(t.vertexShader))),void 0!==t.defines)for(const e in t.defines)r.push(e),r.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<i.length;e++)r.push(t[i[e]]);r.push(p.outputEncoding),r.push(p.gammaFactor)}return r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){var t=S[e.type];let r;return r=t?(t=ShaderLib[t],UniformsUtils.clone(t.uniforms)):e.uniforms,r},acquireProgram:function(e,r){let i;for(let e=0,t=a.length;e<t;e++){var n=a[e];if(n.cacheKey===r){i=n,++i.usedTimes;break}}return void 0===i&&(i=new WebGLProgram(p,r,e,t),a.push(i)),i},releaseProgram:function(e){var t;0==--e.usedTimes&&(t=a.indexOf(e),a[t]=a[a.length-1],a.pop(),e.destroy())},programs:a}}function WebGLProperties(){let i=new WeakMap;return{get:function(e){let t=i.get(e);return void 0===t&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,r){i.get(e)[t]=r},dispose:function(){i=new WeakMap}}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(l){const c=[];let h=0;const s=[],o=[],u=[],d={id:-1};function p(e,t,r,i,n,a){let s=c[h];var o=l.get(r);return void 0===s?(s={id:e.id,object:e,geometry:t,material:r,program:o.program||d,groupOrder:i,renderOrder:e.renderOrder,z:n,group:a},c[h]=s):(s.id=e.id,s.object=e,s.geometry=t,s.material=r,s.program=o.program||d,s.groupOrder=i,s.renderOrder=e.renderOrder,s.z=n,s.group=a),h++,s}return{opaque:s,transmissive:o,transparent:u,init:function(){h=0,s.length=0,o.length=0,u.length=0},push:function(e,t,r,i,n,a){a=p(e,t,r,i,n,a),(0<r.transmission?o:!0===r.transparent?u:s).push(a)},unshift:function(e,t,r,i,n,a){a=p(e,t,r,i,n,a),(0<r.transmission?o:!0===r.transparent?u:s).unshift(a)},finish:function(){for(let e=h,t=c.length;e<t;e++){const r=c[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(e,t){1<s.length&&s.sort(e||painterSortStable),1<o.length&&o.sort(t||reversePainterSortStable),1<u.length&&u.sort(t||reversePainterSortStable)}}}function WebGLRenderLists(i){let n=new WeakMap;return{get:function(e,t){let r;return!1===n.has(e)?(r=new WebGLRenderList(i),n.set(e,[r])):t>=n.get(e).length?(r=new WebGLRenderList(i),n.get(e).push(r)):r=n.get(e)[t],r},dispose:function(){n=new WeakMap}}}function UniformsCache(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Vector3,color:new Color};break;case"SpotLight":t={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":t={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return r[e.id]=t,t}}}function ShadowUniformsCache(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return r[e.id]=t,t}}}let nextVersion=0;function shadowCastingLightsFirst(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WebGLLights(L,P){const I=new UniformsCache,R=ShadowUniformsCache(),D={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)D.probe.push(new Vector3);const m=new Vector3,g=new Matrix4,_=new Matrix4;return{setup:function(r,e){let i=0,n=0,a=0;for(let e=0;e<9;e++)D.probe[e].set(0,0,0);let s=0,o=0,l=0,c=0,h=0,u=0,d=0,p=0;r.sort(shadowCastingLightsFirst);var f=!0!==e?Math.PI:1;for(let e=0,t=r.length;e<t;e++){var m=r[e],g=m.color,_=m.intensity,v=m.distance,y=m.shadow&&m.shadow.map?m.shadow.map.texture:null;if(m.isAmbientLight)i+=g.r*_*f,n+=g.g*_*f,a+=g.b*_*f;else if(m.isLightProbe)for(let e=0;e<9;e++)D.probe[e].addScaledVector(m.sh.coefficients[e],_);else if(m.isDirectionalLight){const b=I.get(m);if(b.color.copy(m.color).multiplyScalar(m.intensity*f),m.castShadow){var x=m.shadow;const w=R.get(m);w.shadowBias=x.bias,w.shadowNormalBias=x.normalBias,w.shadowRadius=x.radius,w.shadowMapSize=x.mapSize,D.directionalShadow[s]=w,D.directionalShadowMap[s]=y,D.directionalShadowMatrix[s]=m.shadow.matrix,u++}D.directional[s]=b,s++}else if(m.isSpotLight){const T=I.get(m);if(T.position.setFromMatrixPosition(m.matrixWorld),T.color.copy(g).multiplyScalar(_*f),T.distance=v,T.coneCos=Math.cos(m.angle),T.penumbraCos=Math.cos(m.angle*(1-m.penumbra)),T.decay=m.decay,m.castShadow){v=m.shadow;const E=R.get(m);E.shadowBias=v.bias,E.shadowNormalBias=v.normalBias,E.shadowRadius=v.radius,E.shadowMapSize=v.mapSize,D.spotShadow[l]=E,D.spotShadowMap[l]=y,D.spotShadowMatrix[l]=m.shadow.matrix,p++}D.spot[l]=T,l++}else if(m.isRectAreaLight){const S=I.get(m);S.color.copy(g).multiplyScalar(_),S.halfWidth.set(.5*m.width,0,0),S.halfHeight.set(0,.5*m.height,0),D.rectArea[c]=S,c++}else if(m.isPointLight){const M=I.get(m);if(M.color.copy(m.color).multiplyScalar(m.intensity*f),M.distance=m.distance,M.decay=m.decay,m.castShadow){g=m.shadow;const A=R.get(m);A.shadowBias=g.bias,A.shadowNormalBias=g.normalBias,A.shadowRadius=g.radius,A.shadowMapSize=g.mapSize,A.shadowCameraNear=g.camera.near,A.shadowCameraFar=g.camera.far,D.pointShadow[o]=A,D.pointShadowMap[o]=y,D.pointShadowMatrix[o]=m.shadow.matrix,d++}D.point[o]=M,o++}else if(m.isHemisphereLight){const C=I.get(m);C.skyColor.copy(m.color).multiplyScalar(_*f),C.groundColor.copy(m.groundColor).multiplyScalar(_*f),D.hemi[h]=C,h++}}0<c&&(P.isWebGL2||!0===L.has("OES_texture_float_linear")?(D.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,D.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):!0===L.has("OES_texture_half_float_linear")?(D.rectAreaLTC1=UniformsLib.LTC_HALF_1,D.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),D.ambient[0]=i,D.ambient[1]=n,D.ambient[2]=a;const t=D.hash;t.directionalLength===s&&t.pointLength===o&&t.spotLength===l&&t.rectAreaLength===c&&t.hemiLength===h&&t.numDirectionalShadows===u&&t.numPointShadows===d&&t.numSpotShadows===p||(D.directional.length=s,D.spot.length=l,D.rectArea.length=c,D.point.length=o,D.hemi.length=h,D.directionalShadow.length=u,D.directionalShadowMap.length=u,D.pointShadow.length=d,D.pointShadowMap.length=d,D.spotShadow.length=p,D.spotShadowMap.length=p,D.directionalShadowMatrix.length=u,D.pointShadowMatrix.length=d,D.spotShadowMatrix.length=p,t.directionalLength=s,t.pointLength=o,t.spotLength=l,t.rectAreaLength=c,t.hemiLength=h,t.numDirectionalShadows=u,t.numPointShadows=d,t.numSpotShadows=p,D.version=nextVersion++)},setupView:function(r,e){let i=0,n=0,a=0,s=0,o=0;var l=e.matrixWorldInverse;for(let e=0,t=r.length;e<t;e++){var c=r[e];if(c.isDirectionalLight){const h=D.directional[i];h.direction.setFromMatrixPosition(c.matrixWorld),m.setFromMatrixPosition(c.target.matrixWorld),h.direction.sub(m),h.direction.transformDirection(l),i++}else if(c.isSpotLight){const u=D.spot[a];u.position.setFromMatrixPosition(c.matrixWorld),u.position.applyMatrix4(l),u.direction.setFromMatrixPosition(c.matrixWorld),m.setFromMatrixPosition(c.target.matrixWorld),u.direction.sub(m),u.direction.transformDirection(l),a++}else if(c.isRectAreaLight){const d=D.rectArea[s];d.position.setFromMatrixPosition(c.matrixWorld),d.position.applyMatrix4(l),_.identity(),g.copy(c.matrixWorld),g.premultiply(l),_.extractRotation(g),d.halfWidth.set(.5*c.width,0,0),d.halfHeight.set(0,.5*c.height,0),d.halfWidth.applyMatrix4(_),d.halfHeight.applyMatrix4(_),s++}else if(c.isPointLight){const p=D.point[n];p.position.setFromMatrixPosition(c.matrixWorld),p.position.applyMatrix4(l),n++}else if(c.isHemisphereLight){const f=D.hemi[o];f.direction.setFromMatrixPosition(c.matrixWorld),f.direction.transformDirection(l),f.direction.normalize(),o++}}},state:D}}function WebGLRenderState(e,t){const r=new WebGLLights(e,t),i=[],n=[];return{init:function(){i.length=0,n.length=0},state:{lightsArray:i,shadowsArray:n,lights:r},setupLights:function(e){r.setup(i,e)},setupLightsView:function(e){r.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){n.push(e)}}}function WebGLRenderStates(i,n){let a=new WeakMap;return{get:function(e,t=0){let r;return!1===a.has(e)?(r=new WebGLRenderState(i,n),a.set(e,[r])):t>=a.get(e).length?(r=new WebGLRenderState(i,n),a.get(e).push(r)):r=a.get(e)[t],r},dispose:function(){a=new WeakMap}}}class MeshDepthMaterial extends Material{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;class MeshDistanceMaterial extends Material{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;const vertex="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragment="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function WebGLShadowMap(m,g,e){let _=new Frustum;const p=new Vector2,f=new Vector2,v=new Vector4,c=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),h=new MeshDistanceMaterial,u={},y=e.maxTextureSize,d={0:BackSide,1:FrontSide,2:DoubleSide},x=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),b=x.clone();b.defines.HORIZONTAL_PASS=1;const t=new BufferGeometry;t.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Mesh(t,x),T=this;function E(r,e,i,t,n,a,s){let o=null;var l=!0===t.isPointLight?r.customDistanceMaterial:r.customDepthMaterial;if(o=void 0!==l?l:!0===t.isPointLight?h:c,m.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&0<i.alphaTest){r=o.uuid,l=i.uuid;let e=u[r];void 0===e&&(e={},u[r]=e);let t=e[l];void 0===t&&(t=o.clone(),e[l]=t),o=t}return o.visible=i.visible,o.wireframe=i.wireframe,s===VSMShadowMap?o.side=null!==i.shadowSide?i.shadowSide:i.side:o.side=null!==i.shadowSide?i.shadowSide:d[i.side],o.alphaMap=i.alphaMap,o.alphaTest=i.alphaTest,o.clipShadows=i.clipShadows,o.clippingPlanes=i.clippingPlanes,o.clipIntersection=i.clipIntersection,o.displacementMap=i.displacementMap,o.displacementScale=i.displacementScale,o.displacementBias=i.displacementBias,o.wireframeLinewidth=i.wireframeLinewidth,o.linewidth=i.linewidth,!0===t.isPointLight&&!0===o.isMeshDistanceMaterial&&(o.referencePosition.setFromMatrixPosition(t.matrixWorld),o.nearDistance=n,o.farDistance=a),o}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(r,i,n){if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)&&0!==r.length){var e=m.getRenderTarget(),t=m.getActiveCubeFace(),a=m.getActiveMipmapLevel();const u=m.state;u.setBlending(NoBlending),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let e=0,t=r.length;e<t;e++){var s=r[e];const d=s.shadow;if(void 0!==d){if(!1!==d.autoUpdate||!1!==d.needsUpdate){p.copy(d.mapSize);var o,l=d.getFrameExtents();p.multiply(l),f.copy(d.mapSize),(p.x>y||p.y>y)&&(p.x>y&&(f.x=Math.floor(y/l.x),p.x=f.x*l.x,d.mapSize.x=f.x),p.y>y&&(f.y=Math.floor(y/l.y),p.y=f.y*l.y,d.mapSize.y=f.y)),null!==d.map||d.isPointLightShadow||this.type!==VSMShadowMap||(o={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat},d.map=new WebGLRenderTarget(p.x,p.y,o),d.map.texture.name=s.name+".shadowMap",d.mapPass=new WebGLRenderTarget(p.x,p.y,o),d.camera.updateProjectionMatrix()),null===d.map&&(o={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat},d.map=new WebGLRenderTarget(p.x,p.y,o),d.map.texture.name=s.name+".shadowMap",d.camera.updateProjectionMatrix()),m.setRenderTarget(d.map),m.clear();var c=d.getViewportCount();for(let e=0;e<c;e++){var h=d.getViewport(e);v.set(f.x*h.x,f.y*h.y,f.x*h.z,f.y*h.w),u.viewport(v),d.updateMatrices(s,e),_=d.getFrustum(),function r(i,n,a,s,o){if(!1===i.visible)return;const e=i.layers.test(n.layers);if(e&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&o===VSMShadowMap)&&(!i.frustumCulled||_.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);const c=g.update(i),h=i.material;if(Array.isArray(h)){const u=c.groups;for(let e=0,t=u.length;e<t;e++){const d=u[e],p=h[d.materialIndex];if(p&&p.visible){const f=E(i,c,p,s,a.near,a.far,o);m.renderBufferDirect(a,null,c,f,i,d)}}}else if(h.visible){const t=E(i,c,h,s,a.near,a.far,o);m.renderBufferDirect(a,null,c,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)r(l[e],n,a,s,o)}(i,n,d.camera,s,this.type)}d.isPointLightShadow||this.type!==VSMShadowMap||function(e,t){var r=g.update(w);x.defines.VSM_SAMPLES!==e.blurSamples&&(x.defines.VSM_SAMPLES=e.blurSamples,b.defines.VSM_SAMPLES=e.blurSamples,x.needsUpdate=!0,b.needsUpdate=!0);x.uniforms.shadow_pass.value=e.map.texture,x.uniforms.resolution.value=e.mapSize,x.uniforms.radius.value=e.radius,m.setRenderTarget(e.mapPass),m.clear(),m.renderBufferDirect(t,null,r,x,w,null),b.uniforms.shadow_pass.value=e.mapPass.texture,b.uniforms.resolution.value=e.mapSize,b.uniforms.radius.value=e.radius,m.setRenderTarget(e.map),m.clear(),m.renderBufferDirect(t,null,r,b,w,null)}(d,n),d.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",s,"has no shadow.")}T.needsUpdate=!1,m.setRenderTarget(e,t,a)}}}function WebGLState(h,e,t){const r=t.isWebGL2;const i=new function(){let t=!1;const a=new Vector4;let r=null;const s=new Vector4(0,0,0,0);return{setMask:function(e){r===e||t||(h.colorMask(e,e,e,e),r=e)},setLocked:function(e){t=e},setClear:function(e,t,r,i,n){!0===n&&(e*=i,t*=i,r*=i),a.set(e,t,r,i),!1===s.equals(a)&&(h.clearColor(e,t,r,i),s.copy(a))},reset:function(){t=!1,r=null,s.set(-1,0,0,0)}}},n=new function(){let t=!1,r=null,i=null,n=null;return{setTest:function(e){(e?B:F)(2929)},setMask:function(e){r===e||t||(h.depthMask(e),r=e)},setFunc:function(e){if(i!==e){if(e)switch(e){case NeverDepth:h.depthFunc(512);break;case AlwaysDepth:h.depthFunc(519);break;case LessDepth:h.depthFunc(513);break;case LessEqualDepth:h.depthFunc(515);break;case EqualDepth:h.depthFunc(514);break;case GreaterEqualDepth:h.depthFunc(518);break;case GreaterDepth:h.depthFunc(516);break;case NotEqualDepth:h.depthFunc(517);break;default:h.depthFunc(515)}else h.depthFunc(515);i=e}},setLocked:function(e){t=e},setClear:function(e){n!==e&&(h.clearDepth(e),n=e)},reset:function(){t=!1,r=null,i=null,n=null}}},a=new function(){let t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(e){t||(e?B:F)(2960)},setMask:function(e){r===e||t||(h.stencilMask(e),r=e)},setFunc:function(e,t,r){i===e&&n===t&&a===r||(h.stencilFunc(e,t,r),i=e,n=t,a=r)},setOp:function(e,t,r){s===e&&o===t&&l===r||(h.stencilOp(e,t,r),s=e,o=t,l=r)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(h.clearStencil(e),c=e)},reset:function(){t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,c=null}}};let s={},o=null,l={},c=null,u=!1,d=null,p=null,f=null,m=null,g=null,_=null,v=null,y=!1,x=null,b=null,w=null,T=null,E=null;const S=h.getParameter(35661);let M=!1,A=0;const C=h.getParameter(7938);-1!==C.indexOf("WebGL")?(A=parseFloat(/^WebGL (\d)/.exec(C)[1]),M=1<=A):-1!==C.indexOf("OpenGL ES")&&(A=parseFloat(/^OpenGL ES (\d)/.exec(C)[1]),M=2<=A);let L=null,P={};var I=h.getParameter(3088),t=h.getParameter(2978);const R=(new Vector4).fromArray(I),D=(new Vector4).fromArray(t);function O(e,t,r){var i=new Uint8Array(4),n=h.createTexture();h.bindTexture(e,n),h.texParameteri(e,10241,9728),h.texParameteri(e,10240,9728);for(let e=0;e<r;e++)h.texImage2D(t+e,0,6408,1,1,0,6408,5121,i);return n}const k={};function B(e){!0!==s[e]&&(h.enable(e),s[e]=!0)}function F(e){!1!==s[e]&&(h.disable(e),s[e]=!1)}k[3553]=O(3553,3553,1),k[34067]=O(34067,34069,6),i.setClear(0,0,0,1),n.setClear(1),a.setClear(0),B(2929),n.setFunc(LessEqualDepth),G(!1),V(CullFaceBack),B(2884),U(NoBlending);const z={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};r?(z[MinEquation]=32775,z[MaxEquation]=32776):null!==(e=e.get("EXT_blend_minmax"))&&(z[MinEquation]=e.MIN_EXT,z[MaxEquation]=e.MAX_EXT);const N={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function U(e,t,r,i,n,a,s,o){if(e!==NoBlending){if(!1===u&&(B(3042),u=!0),e===CustomBlending)n=n||t,a=a||r,s=s||i,t===p&&n===g||(h.blendEquationSeparate(z[t],z[n]),p=t,g=n),r===f&&i===m&&a===_&&s===v||(h.blendFuncSeparate(N[r],N[i],N[a],N[s]),f=r,m=i,_=a,v=s),d=e,y=null;else if(e!==d||o!==y){if(p===AddEquation&&g===AddEquation||(h.blendEquation(32774),p=AddEquation,g=AddEquation),o)switch(e){case NormalBlending:h.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:h.blendFunc(1,1);break;case SubtractiveBlending:h.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:h.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case NormalBlending:h.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:h.blendFunc(770,1);break;case SubtractiveBlending:h.blendFunc(0,769);break;case MultiplyBlending:h.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}f=null,m=null,_=null,v=null,d=e,y=o}}else!0===u&&(F(3042),u=!1)}function G(e){x!==e&&(e?h.frontFace(2304):h.frontFace(2305),x=e)}function V(e){e!==CullFaceNone?(B(2884),e!==b&&(e===CullFaceBack?h.cullFace(1029):e===CullFaceFront?h.cullFace(1028):h.cullFace(1032))):F(2884),b=e}function $(e,t,r){e?(B(32823),T===t&&E===r||(h.polygonOffset(t,r),T=t,E=r)):F(32823)}function j(e){void 0===e&&(e=33984+S-1),L!==e&&(h.activeTexture(e),L=e)}return{buffers:{color:i,depth:n,stencil:a},enable:B,disable:F,bindFramebuffer:function(e,t){return null===t&&null!==o&&(t=o),l[e]!==t&&(h.bindFramebuffer(e,t),l[e]=t,r&&(36009===e&&(l[36160]=t),36160===e&&(l[36009]=t)),!0)},bindXRFramebuffer:function(e){e!==o&&(h.bindFramebuffer(36160,e),o=e)},useProgram:function(e){return c!==e&&(h.useProgram(e),c=e,!0)},setBlending:U,setMaterial:function(e,t){(e.side===DoubleSide?F:B)(2884);let r=e.side===BackSide;t&&(r=!r),G(r),e.blending===NormalBlending&&!1===e.transparent?U(NoBlending):U(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),n.setFunc(e.depthFunc),n.setTest(e.depthTest),n.setMask(e.depthWrite),i.setMask(e.colorWrite),t=e.stencilWrite,a.setTest(t),t&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),$(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),(!0===e.alphaToCoverage?B:F)(32926)},setFlipSided:G,setCullFace:V,setLineWidth:function(e){e!==w&&(M&&h.lineWidth(e),w=e)},setPolygonOffset:$,setScissorTest:function(e){(e?B:F)(3089)},activeTexture:j,bindTexture:function(e,t){null===L&&j();let r=P[L];void 0===r&&(r={type:void 0,texture:void 0},P[L]=r),r.type===e&&r.texture===t||(h.bindTexture(e,t||k[e]),r.type=e,r.texture=t)},unbindTexture:function(){const e=P[L];void 0!==e&&void 0!==e.type&&(h.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{h.compressedTexImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{h.texImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{h.texImage3D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===R.equals(e)&&(h.scissor(e.x,e.y,e.z,e.w),R.copy(e))},viewport:function(e){!1===D.equals(e)&&(h.viewport(e.x,e.y,e.z,e.w),D.copy(e))},reset:function(){h.disable(3042),h.disable(2884),h.disable(2929),h.disable(32823),h.disable(3089),h.disable(2960),h.disable(32926),h.blendEquation(32774),h.blendFunc(1,0),h.blendFuncSeparate(1,0,1,0),h.colorMask(!0,!0,!0,!0),h.clearColor(0,0,0,0),h.depthMask(!0),h.depthFunc(513),h.clearDepth(1),h.stencilMask(4294967295),h.stencilFunc(519,0,4294967295),h.stencilOp(7680,7680,7680),h.clearStencil(0),h.cullFace(1029),h.frontFace(2305),h.polygonOffset(0,0),h.activeTexture(33984),h.bindFramebuffer(36160,null),!0===r&&(h.bindFramebuffer(36009,null),h.bindFramebuffer(36008,null)),h.useProgram(null),h.lineWidth(1),h.scissor(0,0,h.canvas.width,h.canvas.height),h.viewport(0,0,h.canvas.width,h.canvas.height),s={},L=null,P={},o=null,l={},c=null,u=!1,d=null,p=null,f=null,m=null,g=null,_=null,v=null,y=!1,x=null,b=null,w=null,T=null,E=null,R.set(0,0,h.canvas.width,h.canvas.height),D.set(0,0,h.canvas.width,h.canvas.height),i.reset(),n.reset(),a.reset()}}}function WebGLTextures(m,a,g,_,v,y,x){const b=v.isWebGL2,t=v.maxTextures,f=v.maxCubemapSize,h=v.maxTextureSize,r=v.maxSamples,s=new WeakMap;let l,i=!1;try{i="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function c(e,t){return i?new OffscreenCanvas(e,t):createElementNS("canvas")}function w(e,t,r,i){let n=1;if((e.width>i||e.height>i)&&(n=i/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const a=t?floorPowerOfTwo:Math.floor;i=a(n*e.width),t=a(n*e.height);void 0===l&&(l=c(i,t));const s=r?c(i,t):l;s.width=i,s.height=t;const o=s.getContext("2d");return o.drawImage(e,0,0,i,t),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+i+"x"+t+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function T(e){return isPowerOfTwo(e.width)&&isPowerOfTwo(e.height)}function E(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function S(e,t,r,i,n=1){m.generateMipmap(e);const a=_.get(t);a.__maxMipLevel=Math.log2(Math.max(r,i,n))}function M(e,t,r,i){if(!1===b)return t;if(null!==e){if(void 0!==m[e])return m[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let n=t;return 6403===t&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r&&(n=33321)),6407===t&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r&&(n=32849)),6408===t&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r&&(n=i===sRGBEncoding?35907:32856)),33325!==n&&33326!==n&&34842!==n&&34836!==n||a.get("EXT_color_buffer_float"),n}function n(e){return e===NearestFilter||e===NearestMipmapNearestFilter||e===NearestMipmapLinearFilter?9728:9729}function o(e){const t=e.target;var r;t.removeEventListener("dispose",o),r=t,void 0!==(e=_.get(r)).__webglInit&&(m.deleteTexture(e.__webglTexture),_.remove(r)),t.isVideoTexture&&s.delete(t),x.memory.textures--}function A(e){const t=e.target;t.removeEventListener("dispose",A),function(e){var r=e.texture,t=_.get(e),i=_.get(r);if(e){if(void 0!==i.__webglTexture&&(m.deleteTexture(i.__webglTexture),x.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)m.deleteFramebuffer(t.__webglFramebuffer[e]),t.__webglDepthbuffer&&m.deleteRenderbuffer(t.__webglDepthbuffer[e]);else m.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&m.deleteRenderbuffer(t.__webglDepthbuffer),t.__webglMultisampledFramebuffer&&m.deleteFramebuffer(t.__webglMultisampledFramebuffer),t.__webglColorRenderbuffer&&m.deleteRenderbuffer(t.__webglColorRenderbuffer),t.__webglDepthRenderbuffer&&m.deleteRenderbuffer(t.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,t=r.length;e<t;e++){var n=_.get(r[e]);n.__webglTexture&&(m.deleteTexture(n.__webglTexture),x.memory.textures--),_.remove(r[e])}_.remove(r),_.remove(e)}}(t)}let u=0;function d(e,t){var r,i=_.get(e);if(e.isVideoTexture&&(n=e,r=x.render.frame,s.get(n)!==r&&(s.set(n,r),n.update())),0<e.version&&i.__version!==e.version){var n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void R(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}g.activeTexture(33984+t),g.bindTexture(3553,i.__webglTexture)}function p(e,t){var r=_.get(e);0<e.version&&r.__version!==e.version?function(e,i,t){if(6===i.image.length){I(e,i),g.activeTexture(33984+t),g.bindTexture(34067,e.__webglTexture),m.pixelStorei(37440,i.flipY),m.pixelStorei(37441,i.premultiplyAlpha),m.pixelStorei(3317,i.unpackAlignment),m.pixelStorei(37443,0);var n=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),a=i.image[0]&&i.image[0].isDataTexture;const p=[];for(let e=0;e<6;e++)p[e]=n||a?a?i.image[e].image:i.image[e]:w(i.image[e],!1,!0,f);var s=p[0],t=T(s)||b,o=y.convert(i.format),l=y.convert(i.type),c=M(i.internalFormat,o,l,i.encoding);P(34067,i,t);let r;if(n){for(let t=0;t<6;t++){r=p[t].mipmaps;for(let e=0;e<r.length;e++){var h=r[e];i.format!==RGBAFormat&&i.format!==RGBFormat?null!==o?g.compressedTexImage2D(34069+t,e,c,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g.texImage2D(34069+t,e,c,h.width,h.height,0,o,l,h.data)}}e.__maxMipLevel=r.length-1}else{r=i.mipmaps;for(let t=0;t<6;t++)if(a){g.texImage2D(34069+t,0,c,p[t].width,p[t].height,0,o,l,p[t].data);for(let e=0;e<r.length;e++){var u=r[e].image[t].image;g.texImage2D(34069+t,e+1,c,u.width,u.height,0,o,l,u.data)}}else{g.texImage2D(34069+t,0,c,o,l,p[t]);for(let e=0;e<r.length;e++){var d=r[e];g.texImage2D(34069+t,e+1,c,o,l,d.image[t])}}e.__maxMipLevel=r.length}E(i,t)&&S(34067,i,s.width,s.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}}(r,e,t):(g.activeTexture(33984+t),g.bindTexture(34067,r.__webglTexture))}const C={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},L={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function P(e,t,r){r?(m.texParameteri(e,10242,C[t.wrapS]),m.texParameteri(e,10243,C[t.wrapT]),32879!==e&&35866!==e||m.texParameteri(e,32882,C[t.wrapR]),m.texParameteri(e,10240,L[t.magFilter]),m.texParameteri(e,10241,L[t.minFilter])):(m.texParameteri(e,10242,33071),m.texParameteri(e,10243,33071),32879!==e&&35866!==e||m.texParameteri(e,32882,33071),t.wrapS===ClampToEdgeWrapping&&t.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),m.texParameteri(e,10240,n(t.magFilter)),m.texParameteri(e,10241,n(t.minFilter)),t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===a.has("EXT_texture_filter_anisotropic")&&(r=a.get("EXT_texture_filter_anisotropic"),t.type===FloatType&&!1===a.has("OES_texture_float_linear")||!1===b&&t.type===HalfFloatType&&!1===a.has("OES_texture_half_float_linear")||(1<t.anisotropy||_.get(t).__currentAnisotropy)&&(m.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,v.getMaxAnisotropy())),_.get(t).__currentAnisotropy=t.anisotropy))}function I(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",o),e.__webglTexture=m.createTexture(),x.memory.textures++)}function R(e,r,t){let i=3553;r.isDataTexture2DArray&&(i=35866),r.isDataTexture3D&&(i=32879),I(e,r),g.activeTexture(33984+t),g.bindTexture(i,e.__webglTexture),m.pixelStorei(37440,r.flipY),m.pixelStorei(37441,r.premultiplyAlpha),m.pixelStorei(3317,r.unpackAlignment),m.pixelStorei(37443,0);var t=(n=r,!b&&(n.wrapS!==ClampToEdgeWrapping||n.wrapT!==ClampToEdgeWrapping||n.minFilter!==NearestFilter&&n.minFilter!==LinearFilter)&&!1===T(r.image)),n=w(r.image,t,!1,h),t=T(n)||b,a=y.convert(r.format);let s=y.convert(r.type),o=M(r.internalFormat,a,s,r.encoding);P(i,r,t);let l;var c=r.mipmaps;if(r.isDepthTexture)o=6402,b?o=r.type===FloatType?36012:r.type===UnsignedIntType?33190:r.type===UnsignedInt248Type?35056:33189:r.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===DepthFormat&&6402===o&&r.type!==UnsignedShortType&&r.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=UnsignedShortType,s=y.convert(r.type)),r.format===DepthStencilFormat&&6402===o&&(o=34041,r.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=UnsignedInt248Type,s=y.convert(r.type))),g.texImage2D(3553,0,o,n.width,n.height,0,a,s,null);else if(r.isDataTexture)if(0<c.length&&t){for(let e=0,t=c.length;e<t;e++)l=c[e],g.texImage2D(3553,e,o,l.width,l.height,0,a,s,l.data);r.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else g.texImage2D(3553,0,o,n.width,n.height,0,a,s,n.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=c.length;e<t;e++)l=c[e],r.format!==RGBAFormat&&r.format!==RGBFormat?null!==a?g.compressedTexImage2D(3553,e,o,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):g.texImage2D(3553,e,o,l.width,l.height,0,a,s,l.data);e.__maxMipLevel=c.length-1}else if(r.isDataTexture2DArray)g.texImage3D(35866,0,o,n.width,n.height,n.depth,0,a,s,n.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)g.texImage3D(32879,0,o,n.width,n.height,n.depth,0,a,s,n.data),e.__maxMipLevel=0;else if(0<c.length&&t){for(let e=0,t=c.length;e<t;e++)l=c[e],g.texImage2D(3553,e,o,a,s,l);r.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else g.texImage2D(3553,0,o,a,s,n),e.__maxMipLevel=0;E(r,t)&&S(i,r,n.width,n.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function D(e,t,r,i,n){var a=y.convert(r.format),s=y.convert(r.type),o=M(r.internalFormat,a,s,r.encoding);32879===n||35866===n?g.texImage3D(n,0,o,t.width,t.height,t.depth,0,a,s,null):g.texImage2D(n,0,o,t.width,t.height,0,a,s,null),g.bindFramebuffer(36160,e),m.framebufferTexture2D(36160,i,n,_.get(r).__webglTexture,0),g.bindFramebuffer(36160,null)}function O(t,r,i){if(m.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){let e=33189;i?((n=r.depthTexture)&&n.isDepthTexture&&(n.type===FloatType?e=36012:n.type===UnsignedIntType&&(e=33190)),n=B(r),m.renderbufferStorageMultisample(36161,n,e,r.width,r.height)):m.renderbufferStorage(36161,e,r.width,r.height),m.framebufferRenderbuffer(36160,36096,36161,t)}else{var e,n;r.depthBuffer&&r.stencilBuffer?(i?(e=B(r),m.renderbufferStorageMultisample(36161,e,35056,r.width,r.height)):m.renderbufferStorage(36161,34041,r.width,r.height),m.framebufferRenderbuffer(36160,33306,36161,t)):(n=!0===r.isWebGLMultipleRenderTargets?r.texture[0]:r.texture,e=y.convert(n.format),t=y.convert(n.type),n=M(n.internalFormat,e,t,n.encoding),i?(i=B(r),m.renderbufferStorageMultisample(36161,i,n,r.width,r.height)):m.renderbufferStorage(36161,n,r.width,r.height))}m.bindRenderbuffer(36161,null)}function k(t){const r=_.get(t);var e=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(e)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(_.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),d(t.depthTexture,0),e=_.get(t.depthTexture).__webglTexture,t.depthTexture.format===DepthFormat)m.framebufferTexture2D(36160,36096,3553,e,0);else{if(t.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");m.framebufferTexture2D(36160,33306,3553,e,0)}}(r.__webglFramebuffer,t)}else if(e){r.__webglDepthbuffer=[];for(let e=0;e<6;e++)g.bindFramebuffer(36160,r.__webglFramebuffer[e]),r.__webglDepthbuffer[e]=m.createRenderbuffer(),O(r.__webglDepthbuffer[e],t,!1)}else g.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=m.createRenderbuffer(),O(r.__webglDepthbuffer,t,!1);g.bindFramebuffer(36160,null)}function B(e){return b&&e.isWebGLMultisampleRenderTarget?Math.min(r,e.samples):0}let F=!1,z=!1;this.allocateTextureUnit=function(){var e=u;return e>=t&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+t),u+=1,e},this.resetTextureUnits=function(){u=0},this.setTexture2D=d,this.setTexture2DArray=function(e,t){var r=_.get(e);0<e.version&&r.__version!==e.version?R(r,e,t):(g.activeTexture(33984+t),g.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=_.get(e);0<e.version&&r.__version!==e.version?R(r,e,t):(g.activeTexture(33984+t),g.bindTexture(32879,r.__webglTexture))},this.setTextureCube=p,this.setupRenderTarget=function(r){const t=r.texture,i=_.get(r),n=_.get(t);r.addEventListener("dispose",A),!0!==r.isWebGLMultipleRenderTargets&&(n.__webglTexture=m.createTexture(),n.__version=t.version,x.memory.textures++);var e,a=!0===r.isWebGLCubeRenderTarget,s=!0===r.isWebGLMultipleRenderTargets,o=!0===r.isWebGLMultisampleRenderTarget,l=t.isDataTexture3D||t.isDataTexture2DArray,c=T(r)||b;if(!b||t.format!==RGBFormat||t.type!==FloatType&&t.type!==HalfFloatType||(t.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),a){i.__webglFramebuffer=[];for(let e=0;e<6;e++)i.__webglFramebuffer[e]=m.createFramebuffer()}else if(i.__webglFramebuffer=m.createFramebuffer(),s)if(v.drawBuffers){var h=r.texture;for(let e=0,t=h.length;e<t;e++){const f=_.get(h[e]);void 0===f.__webglTexture&&(f.__webglTexture=m.createTexture(),x.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else o&&(b?(i.__webglMultisampledFramebuffer=m.createFramebuffer(),i.__webglColorRenderbuffer=m.createRenderbuffer(),m.bindRenderbuffer(36161,i.__webglColorRenderbuffer),e=y.convert(t.format),o=y.convert(t.type),e=M(t.internalFormat,e,o,t.encoding),o=B(r),m.renderbufferStorageMultisample(36161,o,e,r.width,r.height),g.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),m.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),m.bindRenderbuffer(36161,null),r.depthBuffer&&(i.__webglDepthRenderbuffer=m.createRenderbuffer(),O(i.__webglDepthRenderbuffer,r,!0)),g.bindFramebuffer(36160,null)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."));if(a){g.bindTexture(34067,n.__webglTexture),P(34067,t,c);for(let e=0;e<6;e++)D(i.__webglFramebuffer[e],r,t,36064,34069+e);E(t,c)&&S(34067,t,r.width,r.height),g.unbindTexture()}else if(s){var u=r.texture;for(let e=0,t=u.length;e<t;e++){var d=u[e],p=_.get(d);g.bindTexture(3553,p.__webglTexture),P(3553,d,c),D(i.__webglFramebuffer,r,d,36064+e,3553),E(d,c)&&S(3553,d,r.width,r.height)}g.unbindTexture()}else{let e=3553;l&&(b?(l=t.isDataTexture3D,e=l?32879:35866):console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),g.bindTexture(e,n.__webglTexture),P(e,t,c),D(i.__webglFramebuffer,r,t,36064,e),E(t,c)&&S(e,t,r.width,r.height,r.depth),g.unbindTexture()}r.depthBuffer&&k(r)},this.updateRenderTargetMipmap=function(r){var i=T(r)||b,n=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let e=0,t=n.length;e<t;e++){var a,s,o=n[e];E(o,i)&&(a=r.isWebGLCubeRenderTarget?34067:3553,s=_.get(o).__webglTexture,g.bindTexture(a,s),S(a,o,r.width,r.height),g.unbindTexture())}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(b){var r=t.width,i=t.height;let e=16384;t.depthBuffer&&(e|=256),t.stencilBuffer&&(e|=1024);t=_.get(t);g.bindFramebuffer(36008,t.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,t.__webglFramebuffer),m.blitFramebuffer(0,0,r,i,0,0,r,i,e,9728),g.bindFramebuffer(36008,null),g.bindFramebuffer(36009,t.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),d(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===z&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),z=!0),e=e.texture),p(e,t)}}function WebGLUtils(e,r,t){const i=t.isWebGL2;return{convert:function(e){let t;if(e===UnsignedByteType)return 5121;if(e===UnsignedShort4444Type)return 32819;if(e===UnsignedShort5551Type)return 32820;if(e===UnsignedShort565Type)return 33635;if(e===ByteType)return 5120;if(e===ShortType)return 5122;if(e===UnsignedShortType)return 5123;if(e===IntType)return 5124;if(e===UnsignedIntType)return 5125;if(e===FloatType)return 5126;if(e===HalfFloatType)return i?5131:(t=r.get("OES_texture_half_float"),null!==t?t.HALF_FLOAT_OES:null);if(e===AlphaFormat)return 6406;if(e===RGBFormat)return 6407;if(e===RGBAFormat)return 6408;if(e===LuminanceFormat)return 6409;if(e===LuminanceAlphaFormat)return 6410;if(e===DepthFormat)return 6402;if(e===DepthStencilFormat)return 34041;if(e===RedFormat)return 6403;if(e===RedIntegerFormat)return 36244;if(e===RGFormat)return 33319;if(e===RGIntegerFormat)return 33320;if(e===RGBIntegerFormat)return 36248;if(e===RGBAIntegerFormat)return 36249;if(e===RGB_S3TC_DXT1_Format||e===RGBA_S3TC_DXT1_Format||e===RGBA_S3TC_DXT3_Format||e===RGBA_S3TC_DXT5_Format){if(t=r.get("WEBGL_compressed_texture_s3tc"),null===t)return null;if(e===RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===RGB_PVRTC_4BPPV1_Format||e===RGB_PVRTC_2BPPV1_Format||e===RGBA_PVRTC_4BPPV1_Format||e===RGBA_PVRTC_2BPPV1_Format){if(t=r.get("WEBGL_compressed_texture_pvrtc"),null===t)return null;if(e===RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===RGB_ETC1_Format)return t=r.get("WEBGL_compressed_texture_etc1"),null!==t?t.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===RGB_ETC2_Format||e===RGBA_ETC2_EAC_Format)&&(t=r.get("WEBGL_compressed_texture_etc"),null!==t)){if(e===RGB_ETC2_Format)return t.COMPRESSED_RGB8_ETC2;if(e===RGBA_ETC2_EAC_Format)return t.COMPRESSED_RGBA8_ETC2_EAC}return e===RGBA_ASTC_4x4_Format||e===RGBA_ASTC_5x4_Format||e===RGBA_ASTC_5x5_Format||e===RGBA_ASTC_6x5_Format||e===RGBA_ASTC_6x6_Format||e===RGBA_ASTC_8x5_Format||e===RGBA_ASTC_8x6_Format||e===RGBA_ASTC_8x8_Format||e===RGBA_ASTC_10x5_Format||e===RGBA_ASTC_10x6_Format||e===RGBA_ASTC_10x8_Format||e===RGBA_ASTC_10x10_Format||e===RGBA_ASTC_12x10_Format||e===RGBA_ASTC_12x12_Format||e===SRGB8_ALPHA8_ASTC_4x4_Format||e===SRGB8_ALPHA8_ASTC_5x4_Format||e===SRGB8_ALPHA8_ASTC_5x5_Format||e===SRGB8_ALPHA8_ASTC_6x5_Format||e===SRGB8_ALPHA8_ASTC_6x6_Format||e===SRGB8_ALPHA8_ASTC_8x5_Format||e===SRGB8_ALPHA8_ASTC_8x6_Format||e===SRGB8_ALPHA8_ASTC_8x8_Format||e===SRGB8_ALPHA8_ASTC_10x5_Format||e===SRGB8_ALPHA8_ASTC_10x6_Format||e===SRGB8_ALPHA8_ASTC_10x8_Format||e===SRGB8_ALPHA8_ASTC_10x10_Format||e===SRGB8_ALPHA8_ASTC_12x10_Format||e===SRGB8_ALPHA8_ASTC_12x12_Format?(t=r.get("WEBGL_compressed_texture_astc"),null!==t?e:null):e===RGBA_BPTC_Format?(t=r.get("EXT_texture_compression_bptc"),null!==t?e:null):e===UnsignedInt248Type?i?34042:(t=r.get("WEBGL_depth_texture"),null!==t?t.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.cameras=e}}ArrayCamera.prototype.isArrayCamera=!0;class Group extends Object3D{constructor(){super(),this.type="Group"}}Group.prototype.isGroup=!0;const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,n=null,a=null;const s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==s&&(i=t.getPose(e.targetRaySpace,r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent))),l&&e.hand){a=!0;for(const d of e.hand.values()){var c=t.getJointPose(d,r);if(void 0===l.joints[d.jointName]){const f=new Group;f.matrixAutoUpdate=!1,f.visible=!1,l.joints[d.jointName]=f,l.add(f)}const p=l.joints[d.jointName];null!==c&&(p.matrix.fromArray(c.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=c.radius),p.visible=null!==c}const u=l.joints["index-finger-tip"];var h=l.joints["thumb-tip"],h=u.position.distanceTo(h.position);l.inputState.pinching&&.025<h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(n=t.getPose(e.gripSpace,r),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));return null!==s&&(s.visible=null!==i),null!==o&&(o.visible=null!==n),null!==l&&(l.visible=null!==a),this}}class WebXRManager extends EventDispatcher{constructor(e,h){super();const r=this,u=e.state;let d=null,i=1,p=null,n="local-floor",f=null,m=null,g=null,_=null,v=null,y=!1,x=null,a=null,s=null,b=null,w=null,T=null;const E=[],o=new Map,l=new PerspectiveCamera;l.layers.enable(1),l.viewport=new Vector4;const c=new PerspectiveCamera;c.layers.enable(2),c.viewport=new Vector4;const S=[l,c],M=new ArrayCamera;M.layers.enable(1),M.layers.enable(2);let A=null,C=null;function L(e){const t=o.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function P(){o.forEach(function(e,t){e.disconnect(t)}),o.clear(),A=null,C=null,u.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),g&&h.deleteFramebuffer(g),x&&h.deleteFramebuffer(x),a&&h.deleteRenderbuffer(a),s&&h.deleteRenderbuffer(s),g=null,x=null,a=null,s=null,v=null,_=null,m=null,d=null,B.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function I(t){var r=d.inputSources;for(let e=0;e<E.length;e++)o.set(r[e],E[e]);for(let e=0;e<t.removed.length;e++){var i=t.removed[e];const a=o.get(i);a&&(a.dispatchEvent({type:"disconnected",data:i}),o.delete(i))}for(let e=0;e<t.added.length;e++){var n=t.added[e];const s=o.get(n);s&&s.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=E[e];return void 0===t&&(t=new WebXRController,E[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=E[e];return void 0===t&&(t=new WebXRController,E[e]=t),t.getGripSpace()},this.getHand=function(e){let t=E[e];return void 0===t&&(t=new WebXRController,E[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){n=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p},this.getBaseLayer=function(){return null!==_?_:v},this.getBinding=function(){return m},this.getFrame=function(){return b},this.getSession=function(){return d},this.setSession=async function(t){if(d=t,null!==d){d.addEventListener("select",L),d.addEventListener("selectstart",L),d.addEventListener("selectend",L),d.addEventListener("squeeze",L),d.addEventListener("squeezestart",L),d.addEventListener("squeezeend",L),d.addEventListener("end",P),d.addEventListener("inputsourceschange",I);t=h.getContextAttributes();if(!0!==t.xrCompatible&&await h.makeXRCompatible(),void 0===d.renderState.layers){var e={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i};v=new XRWebGLLayer(d,h,e),d.updateRenderState({baseLayer:v})}else if(h instanceof WebGLRenderingContext){e={antialias:!0,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i};v=new XRWebGLLayer(d,h,e),d.updateRenderState({layers:[v]})}else{y=t.antialias;let e=null;t.depth&&(T=256,t.stencil&&(T|=1024),w=t.stencil?33306:36096,e=t.stencil?35056:33190);t={colorFormat:t.alpha?32856:32849,depthFormat:e,scaleFactor:i};m=new XRWebGLBinding(d,h),_=m.createProjectionLayer(t),g=h.createFramebuffer(),d.updateRenderState({layers:[_]}),y&&(x=h.createFramebuffer(),a=h.createRenderbuffer(),h.bindRenderbuffer(36161,a),h.renderbufferStorageMultisample(36161,4,32856,_.textureWidth,_.textureHeight),u.bindFramebuffer(36160,x),h.framebufferRenderbuffer(36160,36064,36161,a),h.bindRenderbuffer(36161,null),null!==e&&(s=h.createRenderbuffer(),h.bindRenderbuffer(36161,s),h.renderbufferStorageMultisample(36161,4,e,_.textureWidth,_.textureHeight),h.framebufferRenderbuffer(36160,w,36161,s),h.bindRenderbuffer(36161,null)),u.bindFramebuffer(36160,null))}p=await d.requestReferenceSpace(n),B.setContext(d),B.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};const R=new Vector3,D=new Vector3;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null!==d){M.near=c.near=l.near=e.near,M.far=c.far=l.far=e.far,A===M.near&&C===M.far||(d.updateRenderState({depthNear:M.near,depthFar:M.far}),A=M.near,C=M.far);var t=e.parent,r=M.cameras;O(M,t);for(let e=0;e<r.length;e++)O(r[e],t);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),e.position.copy(M.position),e.quaternion.copy(M.quaternion),e.scale.copy(M.scale),e.matrix.copy(M.matrix),e.matrixWorld.copy(M.matrixWorld);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);2===r.length?function(e,t,r){R.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(r.matrixWorld);var i=R.distanceTo(D),n=t.projectionMatrix.elements,a=r.projectionMatrix.elements,s=n[14]/(n[10]-1),o=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],h=(n[8]-1)/n[0],r=(a[8]+1)/a[0],n=s*h,a=s*r,h=(r=i/(r-h))*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(h),e.translateZ(r),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),s+=r,r=o+r,e.projectionMatrix.makePerspective(n-h,i-h+a,l*o/r*s,c*o/r*s,s,r)}(M,l,c):M.projectionMatrix.copy(l.projectionMatrix)}},this.getCamera=function(){return M},this.getFoveation=function(){return null!==_?_.fixedFoveation:null!==v?v.fixedFoveation:void 0},this.setFoveation=function(e){null!==_&&(_.fixedFoveation=e),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=e)};let k=null;const B=new WebGLAnimation;B.setAnimationLoop(function(e,t){if(f=t.getViewerPose(p),b=t,null!==f){var i=f.views;null!==v&&u.bindXRFramebuffer(v.framebuffer);let r=!1;i.length!==M.cameras.length&&(M.cameras.length=0,r=!0);for(let t=0;t<i.length;t++){var n,a=i[t];let e=null;e=null!==v?v.getViewport(a):(n=m.getViewSubImage(_,a),u.bindXRFramebuffer(g),void 0!==n.depthStencilTexture&&h.framebufferTexture2D(36160,w,3553,n.depthStencilTexture,0),h.framebufferTexture2D(36160,36064,3553,n.colorTexture,0),n.viewport);const l=S[t];l.matrix.fromArray(a.transform.matrix),l.projectionMatrix.fromArray(a.projectionMatrix),l.viewport.set(e.x,e.y,e.width,e.height),0===t&&M.matrix.copy(l.matrix),!0===r&&M.cameras.push(l)}y&&(u.bindXRFramebuffer(x),null!==T&&h.clear(T))}var r,s=d.inputSources;for(let e=0;e<E.length;e++){const c=E[e];var o=s[e];c.update(o,t,p)}k&&k(e,t),y&&(r=_.textureWidth,e=_.textureHeight,u.bindFramebuffer(36008,x),u.bindFramebuffer(36009,g),h.invalidateFramebuffer(36008,[w]),h.invalidateFramebuffer(36009,[w]),h.blitFramebuffer(0,0,r,e,0,0,r,e,16384,9728),h.invalidateFramebuffer(36008,[36064]),u.bindFramebuffer(36008,null),u.bindFramebuffer(36009,null),u.bindFramebuffer(36160,x)),b=null}),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function WebGLMaterials(a){function c(e,t){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);var r=a.get(t).envMap;r&&(e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,e.reflectivity.value=t.reflectivity,e.ior.value=t.ior,e.refractionRatio.value=t.refractionRatio,void 0!==(r=a.get(r).__maxMipLevel)&&(e.maxMipLevel.value=r)),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);let i;t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap?i=t.emissiveMap:t.clearcoatMap?i=t.clearcoatMap:t.clearcoatNormalMap?i=t.clearcoatNormalMap:t.clearcoatRoughnessMap?i=t.clearcoatRoughnessMap:t.specularIntensityMap?i=t.specularIntensityMap:t.specularColorMap?i=t.specularColorMap:t.transmissionMap?i=t.transmissionMap:t.thicknessMap?i=t.thicknessMap:t.sheenColorMap?i=t.sheenColorMap:t.sheenRoughnessMap&&(i=t.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix));let n;t.aoMap?n=t.aoMap:t.lightMap&&(n=t.lightMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uv2Transform.value.copy(n.matrix))}function h(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),a.get(t).envMap&&(e.envMapIntensity.value=t.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,r,i,n){var a,s,o,l;t.isMeshBasicMaterial?c(e,t):t.isMeshLambertMaterial?(c(e,t),o=e,(l=t).emissiveMap&&(o.emissiveMap.value=l.emissiveMap)):t.isMeshToonMaterial?(c(e,t),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshPhongMaterial?(c(e,t),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshStandardMaterial?(c(e,t),t.isMeshPhysicalMaterial?function(e,t,r){h(e,t),e.ior.value=t.ior,0<t.sheen&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));0<t.clearcoat&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===BackSide&&e.clearcoatNormalScale.value.negate()));0<t.transmission&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,t,n):h(e,t)):t.isMeshMatcapMaterial?(c(e,t),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshDepthMaterial?(c(e,t),a=e,(s=t).displacementMap&&(a.displacementMap.value=s.displacementMap,a.displacementScale.value=s.displacementScale,a.displacementBias.value=s.displacementBias)):t.isMeshDistanceMaterial?(c(e,t),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,t)):t.isMeshNormalMaterial?(c(e,t),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isLineBasicMaterial?(a=t,(s=e).diffuse.value.copy(a.color),s.opacity.value=a.opacity,t.isLineDashedMaterial&&(s=t,(a=e).dashSize.value=s.dashSize,a.totalSize.value=s.dashSize+s.gapSize,a.scale.value=s.scale)):t.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,t,r,i):t.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);let r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function createCanvasElement(){const e=createElementNS("canvas");return e.style.display="block",e}function WebGLRenderer(e={}){const n=void 0!==e.canvas?e.canvas:createCanvasElement(),t=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let f=null,M=null;const u=[],d=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const A=this;let p=!1,m=0,g=0,C=null,L=-1,P=null;const _=new Vector4,v=new Vector4;let y=null,x=n.width,I=n.height,R=1,b=null,w=null;const T=new Vector4(0,0,x,I),E=new Vector4(0,0,x,I);let S=!1;const D=[],O=new Frustum;let k=!1,B=!1,F=null;const z=new Matrix4,N=new Vector3,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return null===C?R:1}let V=t;function $(t,r){for(let e=0;e<t.length;e++){var i=t[e],i=n.getContext(i,r);if(null!==i)return i}return null}try{var j={alpha:r,depth:i,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(n.addEventListener("webglcontextlost",ge,!1),n.addEventListener("webglcontextrestored",_e,!1),null===V){const Ae=["webgl2","webgl","experimental-webgl"];if(!0===A.isWebGL1Renderer&&Ae.shift(),V=$(Ae,j),null===V)throw $(Ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===V.getShaderPrecisionFormat&&(V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}let H,W,Z,q,X,Y,K,J,Q,ee,te,re,ie,ne,ae,se,oe,le,ce,he,ue,de,pe;function fe(){H=new WebGLExtensions(V),W=new WebGLCapabilities(V,H,e),H.init(W),de=new WebGLUtils(V,H,W),Z=new WebGLState(V,H,W),D[0]=1029,q=new WebGLInfo(V),X=new WebGLProperties,Y=new WebGLTextures(V,H,Z,X,W,de,q),K=new WebGLCubeMaps(A),J=new WebGLCubeUVMaps(A),Q=new WebGLAttributes(V,W),pe=new WebGLBindingStates(V,H,Q,W),ee=new WebGLGeometries(V,Q,q,pe),te=new WebGLObjects(V,ee,Q,q),ce=new WebGLMorphtargets(V,W,Y),se=new WebGLClipping(X),re=new WebGLPrograms(A,K,J,H,W,pe,se),ie=new WebGLMaterials(X),ne=new WebGLRenderLists(X),ae=new WebGLRenderStates(H,W),le=new WebGLBackground(A,K,Z,te,o),oe=new WebGLShadowMap(A,te,W),he=new WebGLBufferRenderer(V,H,q,W),ue=new WebGLIndexedBufferRenderer(V,H,q,W),q.programs=re.programs,A.capabilities=W,A.extensions=H,A.properties=X,A.renderLists=ne,A.shadowMap=oe,A.state=Z,A.info=q}fe();const me=new WebXRManager(A,V);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1;var e=q.autoReset,t=oe.enabled,r=oe.autoUpdate,i=oe.needsUpdate,n=oe.type;fe(),q.autoReset=e,oe.enabled=t,oe.autoUpdate=r,oe.needsUpdate=i,oe.type=n}function ve(e){const t=e.target;t.removeEventListener("dispose",ve),function(e){const t=X.get(e).programs;void 0!==t&&t.forEach(function(e){re.releaseProgram(e)})}(e=t),X.remove(e)}this.xr=me,this.getContext=function(){return V},this.getContextAttributes=function(){return V.getContextAttributes()},this.forceContextLoss=function(){const e=H.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=H.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(x,I,!1))},this.getSize=function(e){return e.set(x,I)},this.setSize=function(e,t,r){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(x=e,I=t,n.width=Math.floor(e*R),n.height=Math.floor(t*R),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(x*R,I*R).floor()},this.setDrawingBufferSize=function(e,t,r){x=e,I=t,R=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(_)},this.getViewport=function(e){return e.copy(T)},this.setViewport=function(e,t,r,i){e.isVector4?T.set(e.x,e.y,e.z,e.w):T.set(e,t,r,i),Z.viewport(_.copy(T).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(E)},this.setScissor=function(e,t,r,i){e.isVector4?E.set(e.x,e.y,e.z,e.w):E.set(e,t,r,i),Z.scissor(v.copy(E).multiplyScalar(R).floor())},this.getScissorTest=function(){return S},this.setScissorTest=function(e){Z.setScissorTest(S=e)},this.setOpaqueSort=function(e){b=e},this.setTransparentSort=function(e){w=e},this.getClearColor=function(e){return e.copy(le.getClearColor())},this.setClearColor=function(){le.setClearColor.apply(le,arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha.apply(le,arguments)},this.clear=function(e,t,r){let i=0;void 0!==e&&!e||(i|=16384),void 0!==t&&!t||(i|=256),void 0!==r&&!r||(i|=1024),V.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",ge,!1),n.removeEventListener("webglcontextrestored",_e,!1),ne.dispose(),ae.dispose(),X.dispose(),K.dispose(),J.dispose(),te.dispose(),pe.dispose(),me.dispose(),me.removeEventListener("sessionstart",xe),me.removeEventListener("sessionend",be),F&&(F.dispose(),F=null),we.stop()},this.renderBufferDirect=function(e,t,r,i,n,a){null===t&&(t=U);var s=n.isMesh&&n.matrixWorld.determinant()<0,o=function(e,t,r,i,n){!0!==t.isScene&&(t=U);Y.resetTextureUnits();const a=t.fog,s=i.isMeshStandardMaterial?t.environment:null,o=null===C?A.outputEncoding:C.texture.encoding,l=(i.isMeshStandardMaterial?J:K).get(i.envMap||s),c=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,h=!!i.normalMap&&!!r.attributes.tangent,u=!!r.morphAttributes.position,d=!!r.morphAttributes.normal,p=r.morphAttributes.position?r.morphAttributes.position.length:0,f=X.get(i),m=M.state.lights;{var g;!0===k&&(!0!==B&&e===P||(g=e===P&&i.id===L,se.setState(i,e,g)))}let _=!1;i.version===f.__version?(f.needsLights&&f.lightsStateVersion!==m.state.version||f.outputEncoding!==o||n.isInstancedMesh&&!1===f.instancing||!n.isInstancedMesh&&!0===f.instancing||n.isSkinnedMesh&&!1===f.skinning||!n.isSkinnedMesh&&!0===f.skinning||f.envMap!==l||i.fog&&f.fog!==a||void 0!==f.numClippingPlanes&&(f.numClippingPlanes!==se.numPlanes||f.numIntersection!==se.numIntersection)||f.vertexAlphas!==c||f.vertexTangents!==h||f.morphTargets!==u||f.morphNormals!==d||!0===W.isWebGL2&&f.morphTargetsCount!==p)&&(_=!0):(_=!0,f.__version=i.version);let v=f.currentProgram;!0===_&&(v=Se(i,t,n));let y=!1,x=!1,b=!1;const w=v.getUniforms(),T=f.uniforms;Z.useProgram(v.program)&&(y=!0,x=!0,b=!0);i.id!==L&&(L=i.id,x=!0);if(y||P!==e){if(w.setValue(V,"projectionMatrix",e.projectionMatrix),W.logarithmicDepthBuffer&&w.setValue(V,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),P!==e&&(P=e,x=!0,b=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const E=w.map.cameraPosition;void 0!==E&&E.setValue(V,N.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&w.setValue(V,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&w.setValue(V,"viewMatrix",e.matrixWorldInverse)}if(n.isSkinnedMesh){w.setOptional(V,n,"bindMatrix"),w.setOptional(V,n,"bindMatrixInverse");const S=n.skeleton;S&&(W.floatVertexTextures?(null===S.boneTexture&&S.computeBoneTexture(),w.setValue(V,"boneTexture",S.boneTexture,Y),w.setValue(V,"boneTextureSize",S.boneTextureSize)):w.setOptional(V,S,"boneMatrices"))}!r||void 0===r.morphAttributes.position&&void 0===r.morphAttributes.normal||ce.update(n,r,i,v);!x&&f.receiveShadow===n.receiveShadow||(f.receiveShadow=n.receiveShadow,w.setValue(V,"receiveShadow",n.receiveShadow));x&&(w.setValue(V,"toneMappingExposure",A.toneMappingExposure),f.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(T,b),a&&i.fog&&ie.refreshFogUniforms(T,a),ie.refreshMaterialUniforms(T,i,R,I,F),WebGLUniforms.upload(V,f.uniformsList,T,Y));i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(WebGLUniforms.upload(V,f.uniformsList,T,Y),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&w.setValue(V,"center",n.center);return w.setValue(V,"modelViewMatrix",n.modelViewMatrix),w.setValue(V,"normalMatrix",n.normalMatrix),w.setValue(V,"modelMatrix",n.matrixWorld),v}(e,t,r,i,n);Z.setMaterial(i,s);let l=r.index;e=r.attributes.position;if(null===l){if(void 0===e||0===e.count)return}else if(0===l.count)return;let c=1;!0===i.wireframe&&(l=ee.getWireframeAttribute(r),c=2),pe.setup(n,i,o,r,l);let h=he;null!==l&&(u=Q.get(l),h=ue,h.setIndex(u));var t=(null!==l?l:e).count,s=r.drawRange.start*c,o=r.drawRange.count*c,u=null!==a?a.start*c:0,e=null!==a?a.count*c:1/0,a=Math.max(s,u),e=Math.min(t,s+o,u+e)-1,e=Math.max(0,e-a+1);if(0!==e){if(n.isMesh)!0===i.wireframe?(Z.setLineWidth(i.wireframeLinewidth*G()),h.setMode(1)):h.setMode(4);else if(n.isLine){let e=i.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*G()),n.isLineSegments?h.setMode(1):n.isLineLoop?h.setMode(2):h.setMode(3)}else n.isPoints?h.setMode(0):n.isSprite&&h.setMode(4);n.isInstancedMesh?h.renderInstances(a,e,n.count):r.isInstancedBufferGeometry?(r=Math.min(r.instanceCount,r._maxInstanceCount),h.renderInstances(a,e,r)):h.render(a,e)}},this.compile=function(i,t){M=ae.get(i),M.init(),d.push(M),i.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(M.pushLight(e),e.castShadow&&M.pushShadow(e))}),M.setupLights(A.physicallyCorrectLights),i.traverse(function(t){var r=t.material;if(r)if(Array.isArray(r))for(let e=0;e<r.length;e++)Se(r[e],i,t);else Se(r,i,t)}),d.pop(),M=null};let ye=null;function xe(){we.stop()}function be(){we.start()}const we=new WebGLAnimation;function Te(e,t,r,i){var n=e.opaque,a=e.transmissive,e=e.transparent;M.setupLightsView(r),0<a.length&&function(e,t,r){if(null===F){const a=!0===s&&!0===W.isWebGL2?WebGLMultisampleRenderTarget:WebGLRenderTarget;F=new a(1024,1024,{generateMipmaps:!0,type:null!==de.convert(HalfFloatType)?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,magFilter:NearestFilter,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping})}var i=A.getRenderTarget();A.setRenderTarget(F),A.clear();var n=A.toneMapping;A.toneMapping=NoToneMapping,Ee(e,t,r),A.toneMapping=n,Y.updateMultisampleRenderTarget(F),Y.updateRenderTargetMipmap(F),A.setRenderTarget(i)}(n,t,r),i&&Z.viewport(_.copy(i)),0<n.length&&Ee(n,t,r),0<a.length&&Ee(a,t,r),0<e.length&&Ee(e,t,r)}function Ee(r,i,n){var a=!0===i.isScene?i.overrideMaterial:null;for(let e=0,t=r.length;e<t;e++){var s=r[e];const c=s.object;var o=s.geometry,l=null===a?s.material:a,s=s.group;c.layers.test(n.layers)&&function(e,t,r,i,n,a){e.onBeforeRender(A,t,r,i,n,a),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(A,t,r,i,e,a),!0===n.transparent&&n.side===DoubleSide?(n.side=BackSide,n.needsUpdate=!0,A.renderBufferDirect(r,t,i,n,e,a),n.side=FrontSide,n.needsUpdate=!0,A.renderBufferDirect(r,t,i,n,e,a),n.side=DoubleSide):A.renderBufferDirect(r,t,i,n,e,a);e.onAfterRender(A,t,r,i,n,a)}(c,i,n,o,l,s)}}function Se(e,t,r){!0!==t.isScene&&(t=U);const i=X.get(e);var n=M.state.lights,a=M.state.shadowsArray,s=n.state.version;const o=re.getParameters(e,n.state,a,t,r);a=re.getProgramCacheKey(o);let l=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?J:K).get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",ve),l=new Map,i.programs=l);let c=l.get(a);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===s)return Me(e,o),c}else o.uniforms=re.getUniforms(e),e.onBuild(r,o,A),e.onBeforeCompile(o,A),c=re.acquireProgram(o,a),l.set(a,c),i.uniforms=o.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=se.uniform),Me(e,o),i.needsLights=(e=e).isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,i.lightsStateVersion=s,i.needsLights&&(h.ambientLightColor.value=n.state.ambient,h.lightProbe.value=n.state.probe,h.directionalLights.value=n.state.directional,h.directionalLightShadows.value=n.state.directionalShadow,h.spotLights.value=n.state.spot,h.spotLightShadows.value=n.state.spotShadow,h.rectAreaLights.value=n.state.rectArea,h.ltc_1.value=n.state.rectAreaLTC1,h.ltc_2.value=n.state.rectAreaLTC2,h.pointLights.value=n.state.point,h.pointLightShadows.value=n.state.pointShadow,h.hemisphereLights.value=n.state.hemi,h.directionalShadowMap.value=n.state.directionalShadowMap,h.directionalShadowMatrix.value=n.state.directionalShadowMatrix,h.spotShadowMap.value=n.state.spotShadowMap,h.spotShadowMatrix.value=n.state.spotShadowMatrix,h.pointShadowMap.value=n.state.pointShadowMap,h.pointShadowMatrix.value=n.state.pointShadowMatrix);n=c.getUniforms(),n=WebGLUniforms.seqWithValue(n.seq,h);return i.currentProgram=c,i.uniformsList=n,c}function Me(e,t){const r=X.get(e);r.outputEncoding=t.outputEncoding,r.instancing=t.instancing,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents}we.setAnimationLoop(function(e){ye&&ye(e)}),"undefined"!=typeof window&&we.setContext(window),this.setAnimationLoop=function(e){ye=e,me.setAnimationLoop(e),null===e?we.stop():we.start()},me.addEventListener("sessionstart",xe),me.addEventListener("sessionend",be),this.render=function(r,e){if(void 0===e||!0===e.isCamera){if(!0!==p){!0===r.autoUpdate&&r.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(e),e=me.getCamera()),!0===r.isScene&&r.onBeforeRender(A,r,e,C),M=ae.get(r,d.length),M.init(),d.push(M),z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),O.setFromProjectionMatrix(z),B=this.localClippingEnabled,k=se.init(this.clippingPlanes,B,e),f=ne.get(r,u.length),f.init(),u.push(f),function r(i,n,a,s){if(!1===i.visible)return;const e=i.layers.test(n.layers);if(e)if(i.isGroup)a=i.renderOrder;else if(i.isLOD)!0===i.autoUpdate&&i.update(n);else if(i.isLight)M.pushLight(i),i.castShadow&&M.pushShadow(i);else if(i.isSprite){if(!i.frustumCulled||O.intersectsSprite(i)){s&&N.setFromMatrixPosition(i.matrixWorld).applyMatrix4(z);const t=te.update(i),l=i.material;l.visible&&f.push(i,t,l,a,N.z,null)}}else if((i.isMesh||i.isLine||i.isPoints)&&(i.isSkinnedMesh&&i.skeleton.frame!==q.render.frame&&(i.skeleton.update(),i.skeleton.frame=q.render.frame),!i.frustumCulled||O.intersectsObject(i))){s&&N.setFromMatrixPosition(i.matrixWorld).applyMatrix4(z);const c=te.update(i),h=i.material;if(Array.isArray(h)){const u=c.groups;for(let e=0,t=u.length;e<t;e++){const d=u[e],p=h[d.materialIndex];p&&p.visible&&f.push(i,c,p,a,N.z,d)}}else h.visible&&f.push(i,c,h,a,N.z,null)}const o=i.children;for(let e=0,t=o.length;e<t;e++)r(o[e],n,a,s)}(r,e,0,A.sortObjects),f.finish(),!0===A.sortObjects&&f.sort(b,w),!0===k&&se.beginShadows();var t=M.state.shadowsArray;if(oe.render(t,r,e),!0===k&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),le.render(f,r),M.setupLights(A.physicallyCorrectLights),e.isArrayCamera){var i=e.cameras;for(let e=0,t=i.length;e<t;e++){var n=i[e];Te(f,r,n,n.viewport)}}else Te(f,r,e);null!==C&&(Y.updateMultisampleRenderTarget(C),Y.updateRenderTargetMipmap(C)),!0===r.isScene&&r.onAfterRender(A,r,e),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1),pe.resetDefaultState(),L=-1,P=null,d.pop(),M=0<d.length?d[d.length-1]:null,u.pop(),f=0<u.length?u[u.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return g},this.getRenderTarget=function(){return C},this.setRenderTarget=function(t,e=0,r=0){C=t,m=e,g=r,t&&void 0===X.get(t).__webglFramebuffer&&Y.setupRenderTarget(t);let i=null,n=!1,a=!1;var s;if(y=t?(((s=t.texture).isDataTexture3D||s.isDataTexture2DArray)&&(a=!0),s=X.get(t).__webglFramebuffer,t.isWebGLCubeRenderTarget?(i=s[e],n=!0):i=t.isWebGLMultisampleRenderTarget?X.get(t).__webglMultisampledFramebuffer:s,_.copy(t.viewport),v.copy(t.scissor),t.scissorTest):(_.copy(T).multiplyScalar(R).floor(),v.copy(E).multiplyScalar(R).floor(),S),Z.bindFramebuffer(36160,i)&&W.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const Y=t.texture;if(D.length!==Y.length||36064!==D[0]){for(let e=0,t=Y.length;e<t;e++)D[e]=36064+e;D.length=Y.length,e=!0}}else 1===D.length&&36064===D[0]||(D[0]=36064,D.length=1,e=!0);else 1===D.length&&1029===D[0]||(D[0]=1029,D.length=1,e=!0);e&&(W.isWebGL2?V.drawBuffers(D):H.get("WEBGL_draw_buffers").drawBuffersWEBGL(D))}Z.viewport(_),Z.scissor(v),Z.setScissorTest(y),n?(s=X.get(t.texture),V.framebufferTexture2D(36160,36064,34069+e,s.__webglTexture,r)):a&&(t=X.get(t.texture),e=e||0,V.framebufferTextureLayer(36160,36064,t.__webglTexture,r||0,e)),L=-1},this.readRenderTargetPixels=function(t,r,i,n,a,s,o){if(t&&t.isWebGLRenderTarget){let e=X.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(e=e[o]),e){Z.bindFramebuffer(36160,e);try{var l=t.texture,c=l.format,h=l.type;if(c!==RGBAFormat&&de.convert(c)!==V.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var u=h===HalfFloatType&&(H.has("EXT_color_buffer_half_float")||W.isWebGL2&&H.has("EXT_color_buffer_float"));if(!(h===UnsignedByteType||de.convert(h)===V.getParameter(35738)||h===FloatType&&(W.isWebGL2||H.has("OES_texture_float")||H.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===V.checkFramebufferStatus(36160)?0<=r&&r<=t.width-n&&0<=i&&i<=t.height-a&&V.readPixels(r,i,n,a,de.convert(c),de.convert(h),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==C?X.get(C).__webglFramebuffer:null;Z.bindFramebuffer(36160,e)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r=0){var i=Math.pow(2,-r),n=Math.floor(t.image.width*i),i=Math.floor(t.image.height*i);let a=de.convert(t.format);W.isWebGL2&&(6407===a&&(a=32849),6408===a&&(a=32856)),Y.setTexture2D(t,0),V.copyTexImage2D(3553,r,a,e.x,e.y,n,i,0),Z.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){var n=t.image.width,a=t.image.height,s=de.convert(r.format),o=de.convert(r.type);Y.setTexture2D(r,0),V.pixelStorei(37440,r.flipY),V.pixelStorei(37441,r.premultiplyAlpha),V.pixelStorei(3317,r.unpackAlignment),t.isDataTexture?V.texSubImage2D(3553,i,e.x,e.y,n,a,s,o,t.image.data):t.isCompressedTexture?V.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):V.texSubImage2D(3553,i,e.x,e.y,s,o,t.image),0===i&&r.generateMipmaps&&V.generateMipmap(3553),Z.unbindTexture()},this.copyTextureToTexture3D=function(t,r,i,n,a=0){if(A.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,c=de.convert(n.format),h=de.convert(n.type);let e;if(n.isDataTexture3D)Y.setTexture3D(n,0),e=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Y.setTexture2DArray(n,0),e=35866}V.pixelStorei(37440,n.flipY),V.pixelStorei(37441,n.premultiplyAlpha),V.pixelStorei(3317,n.unpackAlignment);var u=V.getParameter(3314),d=V.getParameter(32878),p=V.getParameter(3316),f=V.getParameter(3315),m=V.getParameter(32877),g=i.isCompressedTexture?i.mipmaps[0]:i.image;V.pixelStorei(3314,g.width),V.pixelStorei(32878,g.height),V.pixelStorei(3316,t.min.x),V.pixelStorei(3315,t.min.y),V.pixelStorei(32877,t.min.z),i.isDataTexture||i.isDataTexture3D?V.texSubImage3D(e,a,r.x,r.y,r.z,s,o,l,c,h,g.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),V.compressedTexSubImage3D(e,a,r.x,r.y,r.z,s,o,l,c,g.data)):V.texSubImage3D(e,a,r.x,r.y,r.z,s,o,l,c,h,g),V.pixelStorei(3314,u),V.pixelStorei(32878,d),V.pixelStorei(3316,p),V.pixelStorei(3315,f),V.pixelStorei(32877,m),0===a&&n.generateMipmaps&&V.generateMipmap(e),Z.unbindTexture()}},this.initTexture=function(e){Y.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){m=0,g=0,C=null,Z.reset(),pe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}WebGLRenderer.prototype.isWebGLRenderer=!0;class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(e,t=25e-5){this.name="",this.color=new Color(e),this.density=t}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}FogExp2.prototype.isFogExp2=!0;class Fog{constructor(e,t=1,r=1e3){this.name="",this.color=new Color(e),this.near=t,this.far=r}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Fog.prototype.isFog=!0;class Scene extends Object3D{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Scene.prototype.isScene=!0;class InterleavedBuffer{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(r,i,n){r*=this.stride,n*=i.stride;for(let e=0,t=this.stride;e<t;e++)this.array[r+e]=i.array[n+e];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);e=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]);const t=new this.constructor(e,this.stride);return t.setUsage(this.usage),t}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}InterleavedBuffer.prototype.isInterleavedBuffer=!0;const _vector$6=new Vector3;class InterleavedBufferAttribute{constructor(e,t,r,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(r){for(let e=0,t=this.data.count;e<t;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.applyMatrix4(r),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this}applyNormalMatrix(r){for(let e=0,t=this.count;e<t;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.applyNormalMatrix(r),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this}transformDirection(r){for(let e=0,t=this.count;e<t;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.transformDirection(r),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const r=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)r.push(this.data.array[t+e])}return new BufferAttribute(new this.array.constructor(r),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const r=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)r.push(this.data.array[t+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:r,normalized:this.normalized}}}}InterleavedBufferAttribute.prototype.isInterleavedBufferAttribute=!0;class SpriteMaterial extends Material{constructor(e){super(),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}SpriteMaterial.prototype.isSpriteMaterial=!0;let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(e){var t;super(),this.type="Sprite",void 0===_geometry&&(_geometry=new BufferGeometry,t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new InterleavedBuffer(t,5),_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))),this.geometry=_geometry,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);var r=this.material.rotation;let i,n;0!==r&&(n=Math.cos(r),i=Math.sin(r));r=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,r,_worldScale,i,n),transformVertex(_vB.set(.5,-.5,0),_mvPosition,r,_worldScale,i,n),transformVertex(_vC.set(.5,.5,0),_mvPosition,r,_worldScale,i,n),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1),null===e.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint)&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,r,_worldScale,i,n),_uvB.set(0,1),null===e.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint))||((r=e.ray.origin.distanceTo(_intersectPoint))<e.near||r>e.far||t.push({distance:r,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this}))}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function transformVertex(e,t,r,i,n,a){_alignedPosition.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(_rotatedPosition.x=a*_alignedPosition.x-n*_alignedPosition.y,_rotatedPosition.y=n*_alignedPosition.x+a*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),e.copy(t),e.x+=_rotatedPosition.x,e.y+=_rotatedPosition.y,e.applyMatrix4(_viewWorldMatrix)}Sprite.prototype.isSprite=!0;const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);var r=e.levels;for(let e=0,t=r.length;e<t;e++){const i=r[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){var i=this.levels;if(0<i.length){let e,t;for(e=1,t=i.length;e<t&&!(r<i[e].distance);e++);return i[e-1].object}return null}raycast(e,t){var r;0<this.levels.length&&(_v1$2.setFromMatrixPosition(this.matrixWorld),r=e.ray.origin.distanceTo(_v1$2),this.getObjectForDistance(r).raycast(e,t))}update(r){const i=this.levels;if(1<i.length){_v1$2.setFromMatrixPosition(r.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);var n=_v1$2.distanceTo(_v2$1)/r.zoom;i[0].object.visible=!0;let e,t;for(e=1,t=i.length;e<t&&n>=i[e].distance;e++)i[e-1].object.visible=!1,i[e].object.visible=!0;for(this._currentLevel=e-1;e<t;e++)i[e].object.visible=!1}}toJSON(e){const r=super.toJSON(e);!1===this.autoUpdate&&(r.object.autoUpdate=!1),r.object.levels=[];var i=this.levels;for(let e=0,t=i.length;e<t;e++){var n=i[e];r.object.levels.push({object:n.object.uuid,distance:n.distance})}return r}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector$5=new Vector3,_matrix=new Matrix4;class SkinnedMesh extends Mesh{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const r=new Vector4,i=this.geometry.attributes.skinWeight;for(let e=0,t=i.count;e<t;e++){r.x=i.getX(e),r.y=i.getY(e),r.z=i.getZ(e),r.w=i.getW(e);var n=1/r.manhattanLength();n!=1/0?r.multiplyScalar(n):r.set(1,0,0,0),i.setXYZW(e,r.x,r.y,r.z,r.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){var r=this.skeleton,i=this.geometry;_skinIndex.fromBufferAttribute(i.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(i.attributes.skinWeight,e),_basePosition.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){var n,a=_skinWeight.getComponent(e);0!==a&&(n=_skinIndex.getComponent(e),_matrix.multiplyMatrices(r.bones[n].matrixWorld,r.boneInverses[n]),t.addScaledVector(_vector$5.copy(_basePosition).applyMatrix4(_matrix),a))}return t.applyMatrix4(this.bindMatrixInverse)}}SkinnedMesh.prototype.isSkinnedMesh=!0;class Bone extends Object3D{constructor(){super(),this.type="Bone"}}Bone.prototype.isBone=!0;class DataTexture extends Texture{constructor(e=null,t=1,r=1,i,n,a,s,o,l=NearestFilter,c=NearestFilter,h,u){super(null,a,s,o,l,c,i,n,h,u),this.image={data:e,width:t,height:r},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture.prototype.isDataTexture=!0;const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(e=[],t=[]){this.uuid=generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Matrix4)}}calculateInverses(){for(let e=this.boneInverses.length=0,t=this.bones.length;e<t;e++){const r=new Matrix4;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){var r=this.bones,i=this.boneInverses,n=this.boneMatrices;const e=this.boneTexture;for(let e=0,t=r.length;e<t;e++){var a=r[e]?r[e].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(a,i[e]),_offsetMatrix.toArray(n,16*e)}null!==e&&(e.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){var e=ceilPowerOfTwo(e=Math.sqrt(4*this.bones.length));e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);var r=new DataTexture(t,e,e,RGBAFormat,FloatType);return this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(r){for(let e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];if(i.name===r)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,i){this.uuid=r.uuid;for(let t=0,e=r.bones.length;t<e;t++){var n=r.bones[t];let e=i[n];void 0===e&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),e=new Bone),this.bones.push(e),this.boneInverses.push((new Matrix4).fromArray(r.boneInverses[t]))}return this.init(),this}toJSON(){const r={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;var i=this.bones,n=this.boneInverses;for(let e=0,t=i.length;e<t;e++){var a=i[e];r.bones.push(a.uuid);const s=n[e];r.boneInverses.push(s.toArray())}return r}}class InstancedBufferAttribute extends BufferAttribute{constructor(e,t,r,i=1){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,r),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}InstancedBufferAttribute.prototype.isInstancedBufferAttribute=!0;const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;class InstancedMesh extends Mesh{constructor(e,t,r){super(e,t),this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,i){var t=this.matrixWorld,n=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material)for(let r=0;r<n;r++){this.getMatrixAt(r,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(t,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(e,_instanceIntersects);for(let e=0,t=_instanceIntersects.length;e<t;e++){const a=_instanceIntersects[e];a.instanceId=r,a.object=this,i.push(a)}_instanceIntersects.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}InstancedMesh.prototype.isInstancedMesh=!0;class LineBasicMaterial extends Material{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}LineBasicMaterial.prototype.isLineBasicMaterial=!0;const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var r=e.attributes.position;const i=[0];for(let e=1,t=r.count;e<t;e++)_start$1.fromBufferAttribute(r,e-1),_end$1.fromBufferAttribute(r,e),i[e]=i[e-1],i[e]+=_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(r,i){const e=this.geometry;var t=this.matrixWorld,n=r.params.Line.threshold,a=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$1.copy(e.boundingSphere),_sphere$1.applyMatrix4(t),_sphere$1.radius+=n,!1!==r.ray.intersectsSphere(_sphere$1)){_inverseMatrix$1.copy(t).invert(),_ray$1.copy(r.ray).applyMatrix4(_inverseMatrix$1);var n=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=n*n;const d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector3;var o=this.isLineSegments?2:1;if(e.isBufferGeometry){const g=e.index;var l,c=e.attributes.position;if(null!==g)for(let e=Math.max(0,a.start),t=Math.min(g.count,a.start+a.count)-1;e<t;e+=o){var h=g.getX(e),u=g.getX(e+1);d.fromBufferAttribute(c,h),p.fromBufferAttribute(c,u),s<_ray$1.distanceSqToSegment(d,p,m,f)||(m.applyMatrix4(this.matrixWorld),(u=r.ray.origin.distanceTo(m))<r.near||u>r.far||i.push({distance:u,point:f.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else for(let e=Math.max(0,a.start),t=Math.min(c.count,a.start+a.count)-1;e<t;e+=o)d.fromBufferAttribute(c,e),p.fromBufferAttribute(c,e+1),s<_ray$1.distanceSqToSegment(d,p,m,f)||(m.applyMatrix4(this.matrixWorld),(l=r.ray.origin.distanceTo(m))<r.near||l>r.far||i.push({distance:l,point:f.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else e.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,r=Object.keys(t);if(0<r.length){var i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){var n=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Line.prototype.isLine=!0;const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var r=e.attributes.position;const i=[];for(let e=0,t=r.count;e<t;e+=2)_start.fromBufferAttribute(r,e),_end.fromBufferAttribute(r,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}LineSegments.prototype.isLineSegments=!0;class LineLoop extends Line{constructor(e,t){super(e,t),this.type="LineLoop"}}LineLoop.prototype.isLineLoop=!0;class PointsMaterial extends Material{constructor(e){super(),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}PointsMaterial.prototype.isPointsMaterial=!0;const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(r,i){const e=this.geometry;var n=this.matrixWorld,t=r.params.Points.threshold,a=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere.copy(e.boundingSphere),_sphere.applyMatrix4(n),_sphere.radius+=t,!1!==r.ray.intersectsSphere(_sphere)){_inverseMatrix.copy(n).invert(),_ray.copy(r.ray).applyMatrix4(_inverseMatrix);var t=t/((this.scale.x+this.scale.y+this.scale.z)/3),s=t*t;if(e.isBufferGeometry){const c=e.index;var o=e.attributes.position;if(null!==c)for(let e=Math.max(0,a.start),t=Math.min(c.count,a.start+a.count);e<t;e++){var l=c.getX(e);_position$2.fromBufferAttribute(o,l),testPoint(_position$2,l,s,n,r,i,this)}else for(let e=Math.max(0,a.start),t=Math.min(o.count,a.start+a.count);e<t;e++)_position$2.fromBufferAttribute(o,e),testPoint(_position$2,e,s,n,r,i,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,r=Object.keys(t);if(0<r.length){var i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){var n=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function testPoint(e,t,r,i,n,a,s){var o=_ray.distanceSqToPoint(e);if(o<r){const l=new Vector3;_ray.closestPointToPoint(e,l),l.applyMatrix4(i);i=n.ray.origin.distanceTo(l);i<n.near||i>n.far||a.push({distance:i,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:s})}}Points.prototype.isPoints=!0;class VideoTexture extends Texture{constructor(t,e,r,i,n,a,s,o,l){super(t,e,r,i,n,a,s,o,l),this.format=void 0!==s?s:RGBFormat,this.minFilter=void 0!==a?a:LinearFilter,this.magFilter=void 0!==n?n:LinearFilter,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}VideoTexture.prototype.isVideoTexture=!0;class CompressedTexture extends Texture{constructor(e,t,r,i,n,a,s,o,l,c,h,u){super(null,a,s,o,l,c,i,n,h,u),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}CompressedTexture.prototype.isCompressedTexture=!0;class CanvasTexture extends Texture{constructor(e,t,r,i,n,a,s,o,l){super(e,t,r,i,n,a,s,o,l),this.needsUpdate=!0}}CanvasTexture.prototype.isCanvasTexture=!0;class DepthTexture extends Texture{constructor(e,t,r,i,n,a,s,o,l,c){if((c=void 0!==c?c:DepthFormat)!==DepthFormat&&c!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,n,a,s,o,c,r=void 0===(r=void 0===r&&c===DepthFormat?UnsignedShortType:r)&&c===DepthStencilFormat?UnsignedInt248Type:r,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:NearestFilter,this.minFilter=void 0!==o?o:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}}DepthTexture.prototype.isDepthTexture=!0;class CircleGeometry extends BufferGeometry{constructor(r=1,i=8,n=0,a=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:i,thetaStart:n,thetaLength:a},i=Math.max(3,i);const t=[],s=[],o=[],l=[],c=new Vector3,h=new Vector2;s.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let e=0,t=3;e<=i;e++,t+=3){var u=n+e/i*a;c.x=r*Math.cos(u),c.y=r*Math.sin(u),s.push(c.x,c.y,c.z),o.push(0,0,1),h.x=(s[t]/r+1)/2,h.y=(s[t+1]/r+1)/2,l.push(h.x,h.y)}for(let e=1;e<=i;e++)t.push(e,e+1,0);this.setIndex(t),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}static fromJSON(e){return new CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(m=1,g=1,_=1,v=8,y=1,e=!1,x=0,b=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:m,radiusBottom:g,height:_,radialSegments:v,heightSegments:y,openEnded:e,thetaStart:x,thetaLength:b};const w=this;v=Math.floor(v),y=Math.floor(y);const T=[],E=[],S=[],M=[];let A=0;const C=[],L=_/2;let P=0;function t(t){var r=A;const i=new Vector2,n=new Vector3;let a=0;var s=!0===t?m:g,o=!0===t?1:-1;for(let e=1;e<=v;e++)E.push(0,L*o,0),S.push(0,o,0),M.push(.5,.5),A++;var l=A;for(let e=0;e<=v;e++){var c=e/v*b+x,h=Math.cos(c),c=Math.sin(c);n.x=s*c,n.y=L*o,n.z=s*h,E.push(n.x,n.y,n.z),S.push(0,o,0),i.x=.5*h+.5,i.y=.5*c*o+.5,M.push(i.x,i.y),A++}for(let e=0;e<v;e++){var u=r+e,d=l+e;!0===t?T.push(d,d+1,u):T.push(d+1,d,u),a+=3}w.addGroup(P,a,!0===t?1:2),P+=a}!function(){const t=new Vector3,r=new Vector3;let i=0;var n=(g-m)/_;for(let e=0;e<=y;e++){const f=[];var a=e/y,s=a*(g-m)+m;for(let e=0;e<=v;e++){var o=e/v,l=o*b+x,c=Math.sin(l),l=Math.cos(l);r.x=s*c,r.y=-a*_+L,r.z=s*l,E.push(r.x,r.y,r.z),t.set(c,n,l).normalize(),S.push(t.x,t.y,t.z),M.push(o,1-a),f.push(A++)}C.push(f)}for(let t=0;t<v;t++)for(let e=0;e<y;e++){var h=C[e][t],u=C[e+1][t],d=C[e+1][t+1],p=C[e][t+1];T.push(h,u,p),T.push(u,d,p),i+=6}w.addGroup(P,i,0),P+=i}(),!1===e&&(0<m&&t(!0),0<g&&t(!1)),this.setIndex(T),this.setAttribute("position",new Float32BufferAttribute(E,3)),this.setAttribute("normal",new Float32BufferAttribute(S,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2))}static fromJSON(e){return new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(e=1,t=1,r=8,i=1,n=!1,a=0,s=2*Math.PI){super(0,e,t,r,i,n,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:s}}static fromJSON(e){return new ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(r=[],a=[],e=1,t=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:a,radius:e,detail:t};const h=[],u=[];function d(e){h.push(e.x,e.y,e.z)}function s(e,t){e*=3;t.x=r[0+e],t.y=r[1+e],t.z=r[2+e]}function p(e,t,r,i){i<0&&1===e.x&&(u[t]=e.x-1),0===r.x&&0===r.z&&(u[t]=i/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}!function(t){var r=new Vector3,i=new Vector3,n=new Vector3;for(let e=0;e<a.length;e+=3)s(a[e+0],r),s(a[e+1],i),s(a[e+2],n),function(e,r,i,t){const n=t+1,a=[];for(let t=0;t<=n;t++){a[t]=[];const c=e.clone().lerp(i,t/n);var s=r.clone().lerp(i,t/n),o=n-t;for(let e=0;e<=o;e++)0===e&&t===n?a[t][e]=c:a[t][e]=c.clone().lerp(s,e/o)}for(let t=0;t<n;t++)for(let e=0;e<2*(n-t)-1;e++){var l=Math.floor(e/2);e%2==0?(d(a[t][l+1]),d(a[t+1][l]),d(a[t][l])):(d(a[t][l+1]),d(a[t+1][l+1]),d(a[t+1][l]))}}(r,i,n,t)}(t),function(t){const r=new Vector3;for(let e=0;e<h.length;e+=3)r.x=h[e+0],r.y=h[e+1],r.z=h[e+2],r.normalize().multiplyScalar(t),h[e+0]=r.x,h[e+1]=r.y,h[e+2]=r.z}(e),function(){const t=new Vector3;for(let e=0;e<h.length;e+=3){t.x=h[e+0],t.y=h[e+1],t.z=h[e+2];var r=f(t)/2/Math.PI+.5,i=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(t)/Math.PI+.5;u.push(r,1-i)}(function(){const r=new Vector3,i=new Vector3,n=new Vector3,a=new Vector3,s=new Vector2,o=new Vector2,l=new Vector2;for(let e=0,t=0;e<h.length;e+=9,t+=6){r.set(h[e+0],h[e+1],h[e+2]),i.set(h[e+3],h[e+4],h[e+5]),n.set(h[e+6],h[e+7],h[e+8]),s.set(u[t+0],u[t+1]),o.set(u[t+2],u[t+3]),l.set(u[t+4],u[t+5]),a.copy(r).add(i).add(n).divideScalar(3);var c=f(a);p(s,t+0,r,c),p(o,t+2,i,c),p(l,t+4,n,c)}})(),function(){for(let e=0;e<u.length;e+=6){var t=u[e+0],r=u[e+2],i=u[e+4],n=Math.max(t,r,i),a=Math.min(t,r,i);.9<n&&a<.1&&(t<.2&&(u[e+0]+=1),r<.2&&(u[e+2]+=1),i<.2&&(u[e+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(h.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(u,2)),0===t?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new PolyhedronGeometry(e.vertices,e.indices,e.radius,e.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2,i=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new DodecahedronGeometry(e.radius,e.detail)}}const _v0=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){var r=Math.pow(10,4),i=Math.cos(DEG2RAD*t);const m=e.getIndex();var n=e.getAttribute("position"),a=(m||n).count;const g=[0,0,0];var s,o,l=["a","b","c"];const _=new Array(3),v={},y=[];for(let e=0;e<a;e+=3){m?(g[0]=m.getX(e),g[1]=m.getX(e+1),g[2]=m.getX(e+2)):(g[0]=e,g[1]=e+1,g[2]=e+2);const{a:x,b,c:w}=_triangle;if(x.fromBufferAttribute(n,g[0]),b.fromBufferAttribute(n,g[1]),w.fromBufferAttribute(n,g[2]),_triangle.getNormal(_normal),_[0]=`${Math.round(x.x*r)},${Math.round(x.y*r)},${Math.round(x.z*r)}`,_[1]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,_[2]=`${Math.round(w.x*r)},${Math.round(w.y*r)},${Math.round(w.z*r)}`,_[0]!==_[1]&&_[1]!==_[2]&&_[2]!==_[0])for(let e=0;e<3;e++){var c=(e+1)%3,h=_[e],u=_[c],d=_triangle[l[e]],p=_triangle[l[c]],f=`${h}_${u}`,h=`${u}_${h}`;h in v&&v[h]?(_normal.dot(v[h].normal)<=i&&(y.push(d.x,d.y,d.z),y.push(p.x,p.y,p.z)),v[h]=null):f in v||(v[f]={index0:g[e],index1:g[c],normal:_normal.clone()})}}for(const T in v)v[T]&&({index0:s,index1:o}=v[T],_v0.fromBufferAttribute(n,s),_v1$1.fromBufferAttribute(n,o),y.push(_v0.x,_v0.y,_v0.z),y.push(_v1$1.x,_v1$1.y,_v1$1.z));this.setAttribute("position",new Float32BufferAttribute(y,3))}}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)}getPoints(t=5){const r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return r}getSpacedPoints(t=5){const r=[];for(let e=0;e<=t;e++)r.push(this.getPointAt(e/t));return r}getLength(){var e=this.getLengths();return e[e.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const r=[];let i,n=this.getPoint(0),a=0;r.push(0);for(let e=1;e<=t;e++)i=this.getPoint(e/t),a+=i.distanceTo(n),r.push(a),n=i;return this.cacheArcLengths=r,r}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){var r=this.getLengths();let i=0;var n=r.length;let a;a=t||e*r[n-1];let s=0,o=n-1,l;for(;s<=o;)if(i=Math.floor(s+(o-s)/2),(l=r[i]-a)<0)s=i+1;else{if(!(0<l)){o=i;break}o=i-1}if(i=o,r[i]===a)return i/(n-1);t=r[i],e=r[i+1],t=(a-t)/(e-t);return(i+t)/(n-1)}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),1<i&&(i=1);var n=this.getPoint(r),e=this.getPoint(i);const a=t||new(n.isVector2?Vector2:Vector3);return a.copy(e).sub(n).normalize(),a}getTangentAt(e,t){e=this.getUtoTmapping(e);return this.getTangent(e,t)}computeFrenetFrames(r,e){const t=new Vector3,i=[],n=[],a=[],s=new Vector3,o=new Matrix4;for(let e=0;e<=r;e++){var l=e/r;i[e]=this.getTangentAt(l,new Vector3)}n[0]=new Vector3,a[0]=new Vector3;let c=Number.MAX_VALUE;var h,u=Math.abs(i[0].x),d=Math.abs(i[0].y),p=Math.abs(i[0].z);u<=c&&(c=u,t.set(1,0,0)),d<=c&&(c=d,t.set(0,1,0)),p<=c&&t.set(0,0,1),s.crossVectors(i[0],t).normalize(),n[0].crossVectors(i[0],s),a[0].crossVectors(i[0],n[0]);for(let e=1;e<=r;e++)n[e]=n[e-1].clone(),a[e]=a[e-1].clone(),s.crossVectors(i[e-1],i[e]),s.length()>Number.EPSILON&&(s.normalize(),h=Math.acos(clamp(i[e-1].dot(i[e]),-1,1)),n[e].applyMatrix4(o.makeRotationAxis(s,h))),a[e].crossVectors(i[e],n[e]);if(!0===e){let t=Math.acos(clamp(n[0].dot(n[r]),-1,1));t/=r,0<i[0].dot(s.crossVectors(n[0],n[r]))&&(t=-t);for(let e=1;e<=r;e++)n[e].applyMatrix4(o.makeRotationAxis(i[e],t*e)),a[e].crossVectors(i[e],n[e])}return{tangents:i,normals:n,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(e=0,t=0,r=1,i=1,n=0,a=2*Math.PI,s=!1,o=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t){const r=t||new Vector2;var i=2*Math.PI;let n=this.aEndAngle-this.aStartAngle;for(var a=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(n=a?0:i),!0!==this.aClockwise||a||(n===i?n=-i:n-=i);var s=this.aStartAngle+e*n;let o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);return 0!==this.aRotation&&(t=Math.cos(this.aRotation),a=Math.sin(this.aRotation),e=o-this.aX,s=l-this.aY,o=e*t-s*a+this.aX,l=e*a+s*t+this.aY),r.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}EllipseCurve.prototype.isEllipseCurve=!0;class ArcCurve extends EllipseCurve{constructor(e,t,r,i,n,a){super(e,t,r,r,i,n,a),this.type="ArcCurve"}}function CubicPoly(){let n=0,a=0,s=0,o=0;function l(e,t,r,i){n=e,a=r,s=-3*e+3*t-2*r-i,o=2*e-2*t+r+i}return{initCatmullRom:function(e,t,r,i,n){l(t,r,n*(r-e),n*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,n,a,s){n=(t-e)/n-(r-e)/(n+a)+(r-t)/a,s=(r-t)/a-(i-t)/(a+s)+(i-r)/s;l(t,r,n*=a,s*=a)},calc:function(e){var t=e*e,r=t*e;return n+a*e+s*t+o*r}}}ArcCurve.prototype.isArcCurve=!0;const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,i=new Vector3){const t=i;var r=this.points,i=r.length,e=(i-(this.closed?0:1))*e;let n=Math.floor(e),a=e-n;this.closed?n+=0<n?0:(Math.floor(Math.abs(n)/i)+1)*i:0===a&&n===i-1&&(n=i-2,a=1);let s,o;s=this.closed||0<n?r[(n-1)%i]:(tmp.subVectors(r[0],r[1]).add(r[0]),tmp);const l=r[n%i],c=r[(n+1)%i];if(o=this.closed||n+2<i?r[(n+2)%i]:(tmp.subVectors(r[i-1],r[i-2]).add(r[i-1]),tmp),"centripetal"===this.curveType||"chordal"===this.curveType){i="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(l),i),t=Math.pow(l.distanceToSquared(c),i),r=Math.pow(c.distanceToSquared(o),i);t<1e-4&&(t=1),e<1e-4&&(e=t),r<1e-4&&(r=t),px.initNonuniformCatmullRom(s.x,l.x,c.x,o.x,e,t,r),py.initNonuniformCatmullRom(s.y,l.y,c.y,o.y,e,t,r),pz.initNonuniformCatmullRom(s.z,l.z,c.z,o.z,e,t,r)}else"catmullrom"===this.curveType&&(px.initCatmullRom(s.x,l.x,c.x,o.x,this.tension),py.initCatmullRom(s.y,l.y,c.y,o.y,this.tension),pz.initCatmullRom(s.z,l.z,c.z,o.z,this.tension));return t.set(px.calc(a),py.calc(a),pz.calc(a)),t}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){const i=r.points[e];this.points.push(i.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){const r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){const i=this.points[e];r.points.push(i.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push((new Vector3).fromArray(i))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function CatmullRom(e,t,r,i,n){var a=.5*(i-t),t=.5*(n-r),n=e*e;return(2*r-2*i+a+t)*(e*n)+(-3*r+3*i-2*a-t)*n+a*e+r}function QuadraticBezierP0(e,t){e=1-e;return e*e*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,r,i){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,r)+QuadraticBezierP2(e,i)}function CubicBezierP0(e,t){e=1-e;return e*e*e*t}function CubicBezierP1(e,t){var r=1-e;return 3*r*r*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,r,i,n){return CubicBezierP0(e,t)+CubicBezierP1(e,r)+CubicBezierP2(e,i)+CubicBezierP3(e,n)}CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;class CubicBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,r=new Vector2,i=new Vector2){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Vector2){const r=t;var i=this.v0,n=this.v1,a=this.v2,t=this.v3;return r.set(CubicBezier(e,i.x,n.x,a.x,t.x),CubicBezier(e,i.y,n.y,a.y,t.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve.prototype.isCubicBezierCurve=!0;class CubicBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,r=new Vector3,i=new Vector3){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Vector3){const r=t;var i=this.v0,n=this.v1,a=this.v2,t=this.v3;return r.set(CubicBezier(e,i.x,n.x,a.x,t.x),CubicBezier(e,i.y,n.y,a.y,t.y),CubicBezier(e,i.z,n.z,a.z,t.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;class LineCurve extends Curve{constructor(e=new Vector2,t=new Vector2){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Vector2){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const r=t||new Vector2;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}LineCurve.prototype.isLineCurve=!0;class LineCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Vector3){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,r=new Vector2){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Vector2){const r=t;var i=this.v0,n=this.v1,t=this.v2;return r.set(QuadraticBezier(e,i.x,n.x,t.x),QuadraticBezier(e,i.y,n.y,t.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;class QuadraticBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,r=new Vector3){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Vector3){const r=t;var i=this.v0,n=this.v1,t=this.v2;return r.set(QuadraticBezier(e,i.x,n.x,t.x),QuadraticBezier(e,i.y,n.y,t.y),QuadraticBezier(e,i.z,n.z,t.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;class SplineCurve extends Curve{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Vector2){const r=t;var i=this.points,n=(i.length-1)*e,a=Math.floor(n),s=n-a,t=i[0===a?a:a-1],e=i[a],n=i[a>i.length-2?i.length-1:a+1],a=i[a>i.length-3?i.length-1:a+2];return r.set(CatmullRom(s,t.x,e.x,n.x,a.x),CatmullRom(s,t.y,e.y,n.y,a.y)),r}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){const i=r.points[e];this.points.push(i.clone())}return this}toJSON(){const r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){const i=this.points[e];r.points.push(i.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push((new Vector2).fromArray(i))}return this}}SplineCurve.prototype.isSplineCurve=!0;var Curves=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))}getPoint(e,t){var r=e*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=r){var a=i[n]-r;const o=this.curves[n];var s=o.getLength();return o.getPointAt(0===s?0:1-a/s,t)}n++}return null}getLength(){var e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const r=[];let i=0;for(let e=0,t=this.curves.length;e<t;e++)i+=this.curves[e].getLength(),r.push(i);return this.cacheLengths=r,r}getSpacedPoints(t=40){const r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return this.autoClose&&r.push(r[0]),r}getPoints(r=12){const i=[];let n;for(let e=0,t=this.curves;e<t.length;e++){const l=t[e];var a=l&&l.isEllipseCurve?2*r:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?r*l.points.length:r,s=l.getPoints(a);for(let e=0;e<s.length;e++){var o=s[e];n&&n.equals(o)||(i.push(o),n=o)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(r){super.copy(r),this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){const i=r.curves[e];this.curves.push(i.clone())}return this.autoClose=r.autoClose,this}toJSON(){const r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let e=0,t=this.curves.length;e<t;e++){const i=this.curves[e];r.curves.push(i.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){var i=r.curves[e];this.curves.push((new Curves[i.type]).fromJSON(i))}return this}}class Path extends CurvePath{constructor(e){super(),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let e=1,t=r.length;e<t;e++)this.lineTo(r[e].x,r[e].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){var r=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){t=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,i));return this.curves.push(t),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,n,a){i=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,i),new Vector2(n,a));return this.curves.push(i),this.currentPoint.set(n,a),this}splineThru(e){var t=[this.currentPoint.clone()].concat(e),t=new SplineCurve(t);return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,n,a){var s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,r,i,n,a),this}absarc(e,t,r,i,n,a){return this.absellipse(e,t,r,r,i,n,a),this}ellipse(e,t,r,i,n,a,s,o){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,r,i,n,a,s,o),this}absellipse(e,t,r,i,n,a,s,o){const l=new EllipseCurve(e,t,r,i,n,a,s,o);if(0<this.curves.length){const c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);o=l.getPoint(1);return this.currentPoint.copy(o),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Shape extends Path{constructor(e){super(e),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(r){const i=[];for(let e=0,t=this.holes.length;e<t;e++)i[e]=this.holes[e].getPoints(r);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(r){super.copy(r),this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){const i=r.holes[e];this.holes.push(i.clone())}return this}toJSON(){const r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let e=0,t=this.holes.length;e<t;e++){const i=this.holes[e];r.holes.push(i.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){var i=r.holes[e];this.holes.push((new Path).fromJSON(i))}return this}}const Earcut={triangulate:function(t,e,r=2){var i=e&&e.length,n=i?e[0]*r:t.length;let a=linkedList(t,0,n,r,!0);var s=[];if(!a||a.next===a.prev)return s;let o,l,c,h,u,d,p;if(i&&(a=eliminateHoles(t,e,a,r)),t.length>80*r){o=c=t[0],l=h=t[1];for(let e=r;e<n;e+=r)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?1/p:0}return earcutLinked(a,s,r,o,l,p),s}};function linkedList(e,t,r,i,n){let a,s;if(n===0<signedArea(e,t,r,i))for(a=t;a<r;a+=i)s=insertNode(a,e[a],e[a+1],s);else for(a=r-i;a>=t;a-=i)s=insertNode(a,e[a],e[a+1],s);return s&&equals(s,s.next)&&(removeNode(s),s=s.next),s}function filterPoints(e,t){if(!e)return e;t=t||e;let r=e,i;do{if(i=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function earcutLinked(i,n,a,s,o,l,c){if(i){!c&&l&&indexCurve(i,s,o,l);let e=i,t,r;for(;i.prev!==i.next;)if(t=i.prev,r=i.next,l?isEarHashed(i,s,o,l):isEar(i))n.push(t.i/a),n.push(i.i/a),n.push(r.i/a),removeNode(i),i=r.next,e=r.next;else if((i=r)===e){c?1===c?earcutLinked(i=cureLocalIntersections(filterPoints(i),n,a),n,a,s,o,l,2):2===c&&splitEarcut(i,n,a,s,o,l):earcutLinked(filterPoints(i),n,a,s,o,l,1);break}}}function isEar(e){var t=e.prev,r=e,i=e.next;if(0<=area(t,r,i))return!1;let n=e.next.next;for(;n!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&0<=area(n.prev,n,n.next))return!1;n=n.next}return!0}function isEarHashed(e,t,r,i){var n=e.prev,a=e,s=e.next;if(0<=area(n,a,s))return!1;var o=(n.x<a.x?n.x<s.x?n:s:a.x<s.x?a:s).x,l=(n.y<a.y?n.y<s.y?n:s:a.y<s.y?a:s).y,c=(n.x>a.x?n.x>s.x?n:s:a.x>s.x?a:s).x,h=(n.y>a.y?n.y>s.y?n:s:a.y>s.y?a:s).y,u=zOrder(o,l,t,r,i),d=zOrder(c,h,t,r,i);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=area(f.prev,f,f.next))return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&0<=area(f.prev,f,f.next))return!1;f=f.nextZ}return!0}function cureLocalIntersections(e,t,r){let i=e;do{var n=i.prev,a=i.next.next;!equals(n,a)&&intersects(n,i,i.next,a)&&locallyInside(n,a)&&locallyInside(a,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(a.i/r),removeNode(i),removeNode(i.next),i=e=a),i=i.next}while(i!==e);return filterPoints(i)}function splitEarcut(e,t,r,i,n,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&isValidDiagonal(s,e)){var o=splitPolygon(s,e);return s=filterPoints(s,s.next),o=filterPoints(o,o.next),earcutLinked(s,t,r,i,n,a),void earcutLinked(o,t,r,i,n,a)}e=e.next}}while(s=s.next,s!==e)}function eliminateHoles(e,t,r,i){const n=[];let a,s,o,l,c;for(a=0,s=t.length;a<s;a++)o=t[a]*i,l=a<s-1?t[a+1]*i:e.length,c=linkedList(e,o,l,i,!1),c===c.next&&(c.steiner=!0),n.push(getLeftmost(c));for(n.sort(compareX),a=0;a<n.length;a++)eliminateHole(n[a],r),r=filterPoints(r,r.next);return r}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){(t=findHoleBridge(e,t))&&(e=splitPolygon(t,e),filterPoints(t,t.next),filterPoints(e,e.next))}function findHoleBridge(e,t){let r=t;var i=e.x,n=e.y;let a=-1/0,s;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>a){if((a=o)===i){if(n===r.y)return r;if(n===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}}while(r=r.next,r!==t);if(!s)return null;if(i===a)return s;var l=s,c=s.x,h=s.y;let u=1/0,d;for(r=s;i>=r.x&&r.x>=c&&i!==r.x&&pointInTriangle(n<h?i:a,n,c,h,n<h?a:i,n,r.x,r.y)&&(d=Math.abs(n-r.y)/(i-r.x),locallyInside(r,e)&&(d<u||d===u&&(r.x>s.x||r.x===s.x&&sectorContainsSector(s,r)))&&(s=r,u=d)),r=r.next,r!==l;);return s}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,r,i){let n=e;for(;null===n.z&&(n.z=zOrder(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next,n!==e;);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(e){let t,r,i,n,a,s,o,l,c=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,i=r,o=0,t=0;t<c&&(o++,i=i.nextZ,i);t++);for(l=c;0<o||0<l&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}}while(a.nextZ=null,c*=2,1<s);return e}function zOrder(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){let t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next,t!==e;);return r}function pointInTriangle(e,t,r,i,n,a,s,o){return 0<=(n-s)*(t-o)-(e-s)*(a-o)&&0<=(e-s)*(i-o)-(r-s)*(t-o)&&0<=(r-s)*(a-o)-(n-s)*(i-o)}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&0<area(e.prev,e,e.next)&&0<area(t.prev,t,t.next))}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,i){var n=sign(area(e,t,r)),a=sign(area(e,t,i)),s=sign(area(r,i,e)),o=sign(area(r,i,t));return n!==a&&s!==o||(!(0!==n||!onSegment(e,r,t))||(!(0!==a||!onSegment(e,i,t))||(!(0!==s||!onSegment(r,e,i))||!(0!==o||!onSegment(r,t,i)))))}function onSegment(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sign(e){return 0<e?1:e<0?-1:0}function intersectsPolygon(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0}while(r=r.next,r!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?0<=area(e,t,e.next)&&0<=area(e,e.prev,t):area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){let r=e,i=!1;for(var n=(e.x+t.x)/2,a=(e.y+t.y)/2;r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next,r!==e;);return i}function splitPolygon(e,t){const r=new Node(e.i,e.x,e.y),i=new Node(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function insertNode(e,t,r,i){const n=new Node(e,t,r);return i?(n.next=i.next,(n.prev=i).next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(r,i,n,a){let s=0;for(let e=i,t=n-a;e<n;e+=a)s+=(r[t]-r[e])*(r[e+1]+r[t+1]),t=e;return s}class ShapeUtils{static area(r){var i=r.length;let n=0;for(let e=i-1,t=0;t<i;e=t++)n+=r[e].x*r[t].y-r[t].x*r[e].y;return.5*n}static isClockWise(e){return ShapeUtils.area(e)<0}static triangulateShape(e,t){var r=[];const i=[],n=[];removeDupEndPts(e),addContour(r,e);let a=e.length;t.forEach(removeDupEndPts);for(let e=0;e<t.length;e++)i.push(a),a+=t[e].length,addContour(r,t[e]);const s=Earcut.triangulate(r,i);for(let e=0;e<s.length;e+=3)n.push(s.slice(e,e+3));return n}}function removeDupEndPts(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function addContour(t,r){for(let e=0;e<r.length;e++)t.push(r[e].x),t.push(r[e].y)}class ExtrudeGeometry extends BufferGeometry{constructor(r=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),J={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:J},r=Array.isArray(r)?r:[r];const Q=this,ee=[],te=[];for(let e=0,t=r.length;e<t;e++)!function(e){const i=[],t=void 0!==J.curveSegments?J.curveSegments:12,o=void 0!==J.steps?J.steps:1;let r=void 0!==J.depth?J.depth:1,s=void 0===J.bevelEnabled||J.bevelEnabled,n=void 0!==J.bevelThickness?J.bevelThickness:.2,a=void 0!==J.bevelSize?J.bevelSize:n-.1,l=void 0!==J.bevelOffset?J.bevelOffset:0,c=void 0!==J.bevelSegments?J.bevelSegments:3;const h=J.extrudePath,u=void 0!==J.UVGenerator?J.UVGenerator:WorldUVGenerator;void 0!==J.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),r=J.amount);let d,p=!1,f,m,g,_;h&&(d=h.getSpacedPoints(o),p=!0,s=!1,f=h.computeFrenetFrames(o,!1),m=new Vector3,g=new Vector3,_=new Vector3);s||(c=0,n=0,a=0,l=0);e=e.extractPoints(t);let v=e.shape;const y=e.holes,x=!ShapeUtils.isClockWise(v);if(x){v=v.reverse();for(let e=0,t=y.length;e<t;e++){const K=y[e];ShapeUtils.isClockWise(K)&&(y[e]=K.reverse())}}const b=ShapeUtils.triangulateShape(v,y),w=v;for(let e=0,t=y.length;e<t;e++){var T=y[e];v=v.concat(T)}function E(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}const S=v.length,M=b.length;function A(e,t,r){let i,n,a;var s=e.x-t.x,o=e.y-t.y,l=r.x-e.x,c=r.y-e.y,h=s*s+o*o;if(Math.abs(s*c-o*l)>Number.EPSILON){var u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=t.x-o/u,u=t.y+s/u,d=((r.x-c/d-p)*c-(r.y+l/d-u)*l)/(s*c-o*l);i=p+s*d-e.x,n=u+o*d-e.y;e=i*i+n*n;if(e<=2)return new Vector2(i,n);a=Math.sqrt(e/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),a=e?(i=-o,n=s,Math.sqrt(h)):(i=s,n=o,Math.sqrt(h/2))}return new Vector2(i/a,n/a)}const C=[];for(let e=0,t=w.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),C[e]=A(w[e],w[r],w[i]);const L=[];let P,I=C.concat();for(let e=0,t=y.length;e<t;e++){var R=y[e];P=[];for(let e=0,t=R.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),P[e]=A(R[e],R[r],R[i]);L.push(P),I=I.concat(P)}for(let e=0;e<c;e++){var D=e/c,O=n*Math.cos(D*Math.PI/2);const z=a*Math.sin(D*Math.PI/2)+l;for(let e=0,t=w.length;e<t;e++){var k=E(w[e],C[e],z);Z(k.x,k.y,-O)}for(let e=0,t=y.length;e<t;e++){var B=y[e];P=L[e];for(let e=0,t=B.length;e<t;e++){var F=E(B[e],P[e],z);Z(F.x,F.y,-O)}}}const z=a+l;for(let e=0;e<S;e++){var N=s?E(v[e],I[e],z):v[e];p?(g.copy(f.normals[0]).multiplyScalar(N.x),m.copy(f.binormals[0]).multiplyScalar(N.y),_.copy(d[0]).add(g).add(m),Z(_.x,_.y,_.z)):Z(N.x,N.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<S;e++){var U=s?E(v[e],I[e],z):v[e];p?(g.copy(f.normals[t]).multiplyScalar(U.x),m.copy(f.binormals[t]).multiplyScalar(U.y),_.copy(d[t]).add(g).add(m),Z(_.x,_.y,_.z)):Z(U.x,U.y,r/o*t)}for(let e=c-1;0<=e;e--){var G=e/c,V=n*Math.cos(G*Math.PI/2);const z=a*Math.sin(G*Math.PI/2)+l;for(let e=0,t=w.length;e<t;e++){var $=E(w[e],C[e],z);Z($.x,$.y,r+V)}for(let e=0,t=y.length;e<t;e++){var j=y[e];P=L[e];for(let e=0,t=j.length;e<t;e++){var H=E(j[e],P[e],z);p?Z(H.x,H.y+d[o-1].y,d[o-1].x+V):Z(H.x,H.y,r+V)}}}function W(e,i){let t=e.length;for(;0<=--t;){var n=t;let r=t-1;r<0&&(r=e.length-1);for(let e=0,t=o+2*c;e<t;e++){var a=S*e,s=S*(e+1);!function(e,t,r,i){X(e),X(t),X(i),X(t),X(r),X(i);i=ee.length/3,i=u.generateSideWallUV(Q,ee,i-6,i-3,i-2,i-1);Y(i[0]),Y(i[1]),Y(i[3]),Y(i[1]),Y(i[2]),Y(i[3])}(i+n+a,i+r+a,i+r+s,i+n+s)}}}function Z(e,t,r){i.push(e),i.push(t),i.push(r)}function q(e,t,r){X(e),X(t),X(r);r=ee.length/3,r=u.generateTopUV(Q,ee,r-3,r-2,r-1);Y(r[0]),Y(r[1]),Y(r[2])}function X(e){ee.push(i[3*e+0]),ee.push(i[3*e+1]),ee.push(i[3*e+2])}function Y(e){te.push(e.x),te.push(e.y)}(function(){var e,t=ee.length/3;if(s){let t=0*S;for(let e=0;e<M;e++){var r=b[e];q(r[2]+t,r[1]+t,r[0]+t)}e=o+2*c,t=S*e;for(let e=0;e<M;e++){var i=b[e];q(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<M;e++){var n=b[e];q(n[2],n[1],n[0])}for(let e=0;e<M;e++){var a=b[e];q(a[0]+S*o,a[1]+S*o,a[2]+S*o)}}Q.addGroup(t,ee.length/3-t,0)})(),function(){var e=ee.length/3;let r=0;W(w,r),r+=w.length;for(let e=0,t=y.length;e<t;e++){var i=y[e];W(i,r),r+=i.length}Q.addGroup(e,ee.length/3-e,1)}()}(r[e]);this.setAttribute("position",new Float32BufferAttribute(ee,3)),this.setAttribute("uv",new Float32BufferAttribute(te,2)),this.computeVertexNormals()}toJSON(){var e=super.toJSON();return toJSON$1(this.parameters.shapes,this.parameters.options,e)}static fromJSON(r,i){const n=[];for(let e=0,t=r.shapes.length;e<t;e++){var a=i[r.shapes[e]];n.push(a)}var e=r.options.extrudePath;return void 0!==e&&(r.options.extrudePath=(new Curves[e.type]).fromJSON(e)),new ExtrudeGeometry(n,r.options)}}const WorldUVGenerator={generateTopUV:function(e,t,r,i,n){var a=t[3*r],s=t[3*r+1],o=t[3*i],r=t[3*i+1],i=t[3*n],n=t[3*n+1];return[new Vector2(a,s),new Vector2(o,r),new Vector2(i,n)]},generateSideWallUV:function(e,t,r,i,n,a){var s=t[3*r],o=t[3*r+1],l=t[3*r+2],c=t[3*i],h=t[3*i+1],u=t[3*i+2],d=t[3*n],p=t[3*n+1],r=t[3*n+2],i=t[3*a],n=t[3*a+1],a=t[3*a+2];return Math.abs(o-h)<Math.abs(s-c)?[new Vector2(s,1-l),new Vector2(c,1-u),new Vector2(d,1-r),new Vector2(i,1-a)]:[new Vector2(o,1-l),new Vector2(h,1-u),new Vector2(p,1-r),new Vector2(n,1-a)]}};function toJSON$1(r,e,i){if(i.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var n=r[e];i.shapes.push(n.uuid)}else i.shapes.push(r.uuid);return void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new IcosahedronGeometry(e.radius,e.detail)}}class LatheGeometry extends BufferGeometry{constructor(r=[new Vector2(0,.5),new Vector2(.5,0),new Vector2(0,-.5)],i=12,e=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:r,segments:i,phiStart:e,phiLength:n},i=Math.floor(i),n=clamp(n,0,2*Math.PI);const a=[],s=[],o=[];var l=1/i;const c=new Vector3,h=new Vector2;for(let t=0;t<=i;t++){var u=e+t*l*n,d=Math.sin(u),p=Math.cos(u);for(let e=0;e<=r.length-1;e++)c.x=r[e].x*d,c.y=r[e].y,c.z=r[e].x*p,s.push(c.x,c.y,c.z),h.x=t/i,h.y=e/(r.length-1),o.push(h.x,h.y)}for(let t=0;t<i;t++)for(let e=0;e<r.length-1;e++){var f=e+t*r.length,m=f+r.length,g=f+r.length+1,_=f+1;a.push(f,m,_),a.push(m,g,_)}if(this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.computeVertexNormals(),n===2*Math.PI){const y=this.attributes.normal.array,x=new Vector3,b=new Vector3,w=new Vector3;var v=i*r.length*3;for(let e=0,t=0;e<r.length;e++,t+=3)x.x=y[t+0],x.y=y[t+1],x.z=y[t+2],b.x=y[v+t+0],b.y=y[v+t+1],b.z=y[v+t+2],w.addVectors(x,b).normalize(),y[t+0]=y[v+t+0]=w.x,y[t+1]=y[v+t+1]=w.y,y[t+2]=y[v+t+2]=w.z}}static fromJSON(e){return new LatheGeometry(e.points,e.segments,e.phiStart,e.phiLength)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new OctahedronGeometry(e.radius,e.detail)}}class RingGeometry extends BufferGeometry{constructor(e=.5,t=1,r=8,i=1,n=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},r=Math.max(3,r);const s=[],o=[],l=[],c=[];let h=e;var u=(t-e)/(i=Math.max(1,i));const d=new Vector3,p=new Vector2;for(let e=0;e<=i;e++){for(let e=0;e<=r;e++){var f=n+e/r*a;d.x=h*Math.cos(f),d.y=h*Math.sin(f),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=u}for(let e=0;e<i;e++){var m=e*(r+1);for(let e=0;e<r;e++){var g=e+m,_=g+r+1,v=g+r+2,y=g+1;s.push(g,_,y),s.push(_,v,y)}}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}static fromJSON(e){return new RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:d};const p=[],f=[],m=[],g=[];let r=0,_=0;if(!1===Array.isArray(t))i(t);else for(let e=0;e<t.length;e++)i(t[e]),this.addGroup(r,_,e),r+=_,_=0;function i(e){var r=f.length/3,e=e.extractPoints(d);let i=e.shape;const n=e.holes;!1===ShapeUtils.isClockWise(i)&&(i=i.reverse());for(let e=0,t=n.length;e<t;e++){const u=n[e];!0===ShapeUtils.isClockWise(u)&&(n[e]=u.reverse())}var a=ShapeUtils.triangulateShape(i,n);for(let e=0,t=n.length;e<t;e++){var s=n[e];i=i.concat(s)}for(let e=0,t=i.length;e<t;e++){var o=i[e];f.push(o.x,o.y,0),m.push(0,0,1),g.push(o.x,o.y)}for(let e=0,t=a.length;e<t;e++){var l=a[e],c=l[0]+r,h=l[1]+r,l=l[2]+r;p.push(c,h,l),_+=3}}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}toJSON(){var e=super.toJSON();return toJSON(this.parameters.shapes,e)}static fromJSON(r,i){const n=[];for(let e=0,t=r.shapes.length;e<t;e++){var a=i[r.shapes[e]];n.push(a)}return new ShapeGeometry(n,r.curveSegments)}}function toJSON(r,i){if(i.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var n=r[e];i.shapes.push(n.uuid)}else i.shapes.push(r.uuid);return i}class SphereGeometry extends BufferGeometry{constructor(r=1,i=32,n=16,a=0,s=2*Math.PI,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:i,heightSegments:n,phiStart:a,phiLength:s,thetaStart:o,thetaLength:l},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));var c=Math.min(o+l,Math.PI);let h=0;const u=[],d=new Vector3,p=new Vector3,f=[],m=[],g=[],_=[];for(let e=0;e<=n;e++){const E=[];var v=e/n;let t=0;0==e&&0==o?t=.5/i:e==n&&c==Math.PI&&(t=-.5/i);for(let e=0;e<=i;e++){var y=e/i;d.x=-r*Math.cos(a+y*s)*Math.sin(o+v*l),d.y=r*Math.cos(o+v*l),d.z=r*Math.sin(a+y*s)*Math.sin(o+v*l),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),_.push(y+t,1-v),E.push(h++)}u.push(E)}for(let t=0;t<n;t++)for(let e=0;e<i;e++){var x=u[t][e+1],b=u[t][e],w=u[t+1][e],T=u[t+1][e+1];(0!==t||0<o)&&f.push(x,b,T),(t!==n-1||c<Math.PI)&&f.push(b,w,T)}this.setIndex(f),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(g,3)),this.setAttribute("uv",new Float32BufferAttribute(_,2))}static fromJSON(e){return new SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new TetrahedronGeometry(e.radius,e.detail)}}class TorusGeometry extends BufferGeometry{constructor(r=1,i=.4,n=8,a=6,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:i,radialSegments:n,tubularSegments:a,arc:s},n=Math.floor(n),a=Math.floor(a);const o=[],l=[],c=[],h=[],u=new Vector3,d=new Vector3,p=new Vector3;for(let t=0;t<=n;t++)for(let e=0;e<=a;e++){var f=e/a*s,m=t/n*Math.PI*2;d.x=(r+i*Math.cos(m))*Math.cos(f),d.y=(r+i*Math.cos(m))*Math.sin(f),d.z=i*Math.sin(m),l.push(d.x,d.y,d.z),u.x=r*Math.cos(f),u.y=r*Math.sin(f),p.subVectors(d,u).normalize(),c.push(p.x,p.y,p.z),h.push(e/a),h.push(t/n)}for(let t=1;t<=n;t++)for(let e=1;e<=a;e++){var g=(a+1)*t+e-1,_=(a+1)*(t-1)+e-1,v=(a+1)*(t-1)+e,y=(a+1)*t+e;o.push(g,_,y),o.push(_,v,y)}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}static fromJSON(e){return new TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(e=1,r=.4,i=64,n=8,a=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:r,tubularSegments:i,radialSegments:n,p:a,q:s},i=Math.floor(i),n=Math.floor(n);const o=[],l=[],c=[],h=[],u=new Vector3,d=new Vector3;var p=new Vector3,f=new Vector3;const m=new Vector3,g=new Vector3,_=new Vector3;for(let t=0;t<=i;++t){var v=t/i*a*Math.PI*2;S(v,a,s,e,p),S(.01+v,a,s,e,f),g.subVectors(f,p),_.addVectors(f,p),m.crossVectors(g,_),_.crossVectors(m,g),m.normalize(),_.normalize();for(let e=0;e<=n;++e){var y=e/n*Math.PI*2,x=-r*Math.cos(y),y=r*Math.sin(y);u.x=p.x+(x*_.x+y*m.x),u.y=p.y+(x*_.y+y*m.y),u.z=p.z+(x*_.z+y*m.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),c.push(d.x,d.y,d.z),h.push(t/i),h.push(e/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){var b=(n+1)*(t-1)+(e-1),w=(n+1)*t+(e-1),T=(n+1)*t+e,E=(n+1)*(t-1)+e;o.push(b,w,E),o.push(w,T,E)}function S(e,t,r,i,n){var a=Math.cos(e),s=Math.sin(e),t=r/t*e,e=Math.cos(t);n.x=i*(2+e)*.5*a,n.y=i*(2+e)*s*.5,n.z=i*Math.sin(t)*.5}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}static fromJSON(e){return new TorusKnotGeometry(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class TubeGeometry extends BufferGeometry{constructor(a=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),s=64,o=1,l=8,e=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:s,radius:o,radialSegments:l,closed:e};const c=a.computeFrenetFrames(s,e);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;const h=new Vector3,u=new Vector3,r=new Vector2;let d=new Vector3;const p=[],f=[],i=[],m=[];function t(e){d=a.getPointAt(e/s,d);var t=c.normals[e],r=c.binormals[e];for(let e=0;e<=l;e++){var i=e/l*Math.PI*2,n=Math.sin(i),i=-Math.cos(i);u.x=i*t.x+n*r.x,u.y=i*t.y+n*r.y,u.z=i*t.z+n*r.z,u.normalize(),f.push(u.x,u.y,u.z),h.x=d.x+o*u.x,h.y=d.y+o*u.y,h.z=d.z+o*u.z,p.push(h.x,h.y,h.z)}}!function(){for(let e=0;e<s;e++)t(e);t(!1===e?s:0),function(){for(let t=0;t<=s;t++)for(let e=0;e<=l;e++)r.x=t/s,r.y=e/l,i.push(r.x,r.y)}(),function(){for(let t=1;t<=s;t++)for(let e=1;e<=l;e++){var r=(l+1)*(t-1)+(e-1),i=(l+1)*t+(e-1),n=(l+1)*t+e,a=(l+1)*(t-1)+e;m.push(r,i,a),m.push(i,n,a)}}()}(),this.setIndex(m),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(i,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new TubeGeometry((new Curves[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class WireframeGeometry extends BufferGeometry{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const u=[];var i=new Set;const d=new Vector3,p=new Vector3;if(null!==e.index){var n=e.attributes.position;const f=e.index;let r=e.groups;0===r.length&&(r=[{start:0,count:f.count,materialIndex:0}]);for(let e=0,t=r.length;e<t;++e){var a=r[e],s=a.start;for(let t=s,e=s+a.count;t<e;t+=3)for(let e=0;e<3;e++){var o=f.getX(t+e),l=f.getX(t+(e+1)%3);d.fromBufferAttribute(n,o),p.fromBufferAttribute(n,l),!0===isUniqueEdge(d,p,i)&&(u.push(d.x,d.y,d.z),u.push(p.x,p.y,p.z))}}}else{var r=e.attributes.position;for(let t=0,e=r.count/3;t<e;t++)for(let e=0;e<3;e++){var c=3*t+e,h=3*t+(e+1)%3;d.fromBufferAttribute(r,c),p.fromBufferAttribute(r,h),!0===isUniqueEdge(d,p,i)&&(u.push(d.x,d.y,d.z),u.push(p.x,p.y,p.z))}}this.setAttribute("position",new Float32BufferAttribute(u,3))}}}function isUniqueEdge(e,t,r){var i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,e=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==r.has(i)&&!0!==r.has(e)&&(r.add(i,e),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeGeometry,WireframeGeometry:WireframeGeometry});class ShadowMaterial extends Material{constructor(e){super(),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ShadowMaterial.prototype.isShadowMaterial=!0;class MeshStandardMaterial extends Material{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){0<this._sheen!=0<e&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){0<this._clearcoat!=0<e&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){0<this._transmission!=0<e&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;class MeshPhongMaterial extends Material{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;class MeshToonMaterial extends Material{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}MeshToonMaterial.prototype.isMeshToonMaterial=!0;class MeshNormalMaterial extends Material{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;class MeshLambertMaterial extends Material{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;class MeshMatcapMaterial extends Material{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;class LineDashedMaterial extends LineBasicMaterial{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}LineDashedMaterial.prototype.isLineDashedMaterial=!0;var Materials=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material});const AnimationUtils={arraySlice:function(e,t,r){return AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(r){var t=r.length;const i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort(function(e,t){return r[e]-r[t]}),i},sortedArray:function(r,i,n){var a=r.length;const s=new r.constructor(a);for(let e=0,t=0;t!==a;++e){var o=n[e]*i;for(let e=0;e!==i;++e)s[t++]=r[o+e]}return s},flattenJSON:function(t,r,i,n){let a=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[a++];if(void 0!==s){let e=s[n];if(void 0!==e)if(Array.isArray(e))for(;e=s[n],void 0!==e&&(r.push(s.time),i.push.apply(i,e)),s=t[a++],void 0!==s;);else if(void 0!==e.toArray)for(;e=s[n],void 0!==e&&(r.push(s.time),e.toArray(i,i.length)),s=t[a++],void 0!==s;);else for(;e=s[n],void 0!==e&&(r.push(s.time),i.push(e)),s=t[a++],void 0!==s;);}},subclip:function(e,t,r,i,n=30){const a=e.clone();a.name=t;const s=[];for(let e=0;e<a.tracks.length;++e){const h=a.tracks[e];var o=h.getValueSize();const u=[],d=[];for(let t=0;t<h.times.length;++t){var l=h.times[t]*n;if(!(l<r||i<=l)){u.push(h.times[t]);for(let e=0;e<o;++e)d.push(h.values[t*o+e])}}0!==u.length&&(h.times=AnimationUtils.convertArray(u,h.times.constructor),h.values=AnimationUtils.convertArray(d,h.values.constructor),s.push(h))}a.tracks=s;let c=1/0;for(let e=0;e<a.tracks.length;++e)c>a.tracks[e].times[0]&&(c=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*c);return a.resetDuration(),a},makeClipAdditive:function(t,e=0,r=t,i=30){var n=r.tracks.length,a=e/(i=i<=0?30:i);for(let e=0;e<n;++e){const m=r.tracks[e],g=m.ValueTypeName;if("bool"!==g&&"string"!==g){const _=t.tracks.find(function(e){return e.name===m.name&&e.ValueTypeName===g});if(void 0!==_){let e=0;var s=m.getValueSize();m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(e=s/3);let t=0;var o=_.getValueSize();_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(t=o/3);var l=m.times.length-1;let r;if(a<=m.times[0]){var c=e,h=s-e;r=AnimationUtils.arraySlice(m.values,c,h)}else if(a>=m.times[l]){var l=l*s+e,u=l+s-e;r=AnimationUtils.arraySlice(m.values,l,u)}else{const v=m.createInterpolant();u=e,s=s-e;v.evaluate(a),r=AnimationUtils.arraySlice(v.resultBuffer,u,s)}if("quaternion"===g){const y=(new Quaternion).fromArray(r).normalize().conjugate();y.toArray(r)}var d=_.times.length;for(let e=0;e<d;++e){var p=e*o+t;if("quaternion"===g)Quaternion.multiplyQuaternionsFlat(_.values,p,r,0,_.values,p);else{var f=o-2*t;for(let e=0;e<f;++e)_.values[p+e]-=r[e]}}}}}return t.blendMode=AdditiveAnimationBlendMode,t}};class Interpolant{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){var r=this.parameterPositions;let i=this._cachedIndex,n=r[i],a=r[i-1];e:{t:{let e;r:{i:if(!(t<n)){for(var s=i+2;;){if(void 0===n){if(t<a)break i;return i=r.length,this._cachedIndex=i,this.afterEnd_(i-1,t,a)}if(i===s)break;if(a=n,n=r[++i],t<n)break t}e=r.length;break r}if(t>=a)break e;var o=r[1];t<o&&(i=2,a=o);for(var l=i-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===l)break;if(n=a,a=r[--i-1],t>=a)break t}e=i,i=0}for(;i<e;){var c=i+e>>>1;t<r[c]?e=c:i=1+c}if(n=r[i],a=r[i-1],void 0===a)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=r.length,this._cachedIndex=i,this.afterEnd_(i-1,a,t)}this._cachedIndex=i,this.intervalChanged_(i,a,n)}return this.interpolate_(i,a,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i;for(let e=0;e!==i;++e)t[e]=r[n+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Interpolant.prototype.beforeStart_=Interpolant.prototype.copySampleValue_,Interpolant.prototype.afterEnd_=Interpolant.prototype.copySampleValue_;class CubicInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(e,t,r){var i=this.parameterPositions;let n=e-2,a=e+1,s=i[n],o=i[a];if(void 0===s)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:n=e,s=2*t-r;break;case WrapAroundEnding:n=i.length-2,s=t+i[n]-i[n+1];break;default:n=e,s=r}if(void 0===o)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:a=e,o=2*r-t;break;case WrapAroundEnding:a=1,o=r+i[1]-i[0];break;default:a=e-1,o=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-r),this._offsetPrev=n*c,this._offsetNext=a*c}interpolate_(e,t,r,i){const n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(r-t)/(i-t),f=p*p,m=f*p;var g=-u*m+2*u*f-u*p,_=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,y=d*m-d*f;for(let e=0;e!==s;++e)n[e]=g*a[c+e]+_*a[l+e]+v*a[o+e]+y*a[h+e];return n}}class LinearInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(r-t)/(i-t),h=1-c;for(let e=0;e!==s;++e)n[e]=a[l+e]*h+a[o+e]*c;return n}}class DiscreteInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class KeyframeTrack{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;var i;return t.toJSON!==this.toJSON?r=t.toJSON(e):(r={name:e.name,times:AnimationUtils.convertArray(e.times,Array),values:AnimationUtils.convertArray(e.values,Array)},(i=e.getInterpolation())!==e.DefaultInterpolation&&(r.interpolation=i)),r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(r){if(0!==r){const i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]+=r}return this}scale(r){if(1!==r){const i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]*=r}return this}trim(e,t){var r,i=this.times,n=i.length;let a=0,s=n-1;for(;a!==n&&i[a]<e;)++a;for(;-1!==s&&i[s]>t;)--s;return++s,0===a&&s===n||(a>=s&&(s=Math.max(s,1),a=s-1),r=this.getValueSize(),this.times=AnimationUtils.arraySlice(i,a,s),this.values=AnimationUtils.arraySlice(this.values,a*r,s*r)),this}validate(){let r=!0;var e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);var t=this.times,i=this.values,n=t.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let a=null;for(let e=0;e!==n;e++){var s=t[e];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,s),r=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,s,a),r=!1;break}a=s}if(void 0!==i&&AnimationUtils.isTypedArray(i))for(let e=0,t=i.length;e!==t;++e){var o=i[e];if(isNaN(o)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,o),r=!1;break}}return r}optimize(){const r=AnimationUtils.arraySlice(this.times),i=AnimationUtils.arraySlice(this.values),n=this.getValueSize(),a=this.getInterpolation()===InterpolateSmooth,s=r.length-1;let o=1;for(let e=1;e<s;++e){let t=!1;var l=r[e];if(l!==r[e+1]&&(1!==e||l!==r[0]))if(a)t=!0;else{var c=e*n,h=c-n,u=c+n;for(let e=0;e!==n;++e){var d=i[c+e];if(d!==i[h+e]||d!==i[u+e]){t=!0;break}}}if(t){if(e!==o){r[o]=r[e];var p=e*n,f=o*n;for(let e=0;e!==n;++e)i[f+e]=i[p+e]}++o}}if(0<s){r[o]=r[s];for(let e=s*n,t=o*n,r=0;r!==n;++r)i[t+r]=i[e+r];++o}return o!==r.length?(this.times=AnimationUtils.arraySlice(r,0,o),this.values=AnimationUtils.arraySlice(i,0,o*n)):(this.times=r,this.values=i),this}clone(){var e=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0);const r=this.constructor,i=new r(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(r-t)/(i-t);let l=e*s;for(var c=l+s;l!==c;l+=4)Quaternion.slerpFlat(n,0,a,l-s,a,l,o);return n}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e,t=-1,r,i=NormalAnimationBlendMode){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const r=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,t=i.length;e!==t;++e)r.push(parseKeyframeTrack(i[e]).scale(n));const t=new this(e.name,e.duration,r,e.blendMode);return t.uuid=e.uuid,t}static toJSON(e){const r=[],i=e.tracks;e={name:e.name,duration:e.duration,tracks:r,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,t=i.length;e!==t;++e)r.push(KeyframeTrack.toJSON(i[e]));return e}static CreateFromMorphTargetSequence(e,i,n,a){var s=i.length;const o=[];for(let r=0;r<s;r++){let e=[],t=[];e.push((r+s-1)%s,r,(r+1)%s),t.push(0,1,0);var l=AnimationUtils.getKeyframeOrder(e);e=AnimationUtils.sortedArray(e,1,l),t=AnimationUtils.sortedArray(t,1,l),a||0!==e[0]||(e.push(s),t.push(t[0])),o.push(new NumberKeyframeTrack(".morphTargetInfluences["+i[r].name+"]",e,t).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(r,e,t){const i={};var n=/^([\w-]*?)([\d]+)$/;for(let e=0,t=r.length;e<t;e++){const o=r[e];var a=o.name.match(n);if(a&&1<a.length){a=a[1];let e=i[a];e||(i[a]=e=[]),e.push(o)}}const s=[];for(const l in i)s.push(this.CreateFromMorphTargetSequence(l,i[l],e,t));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;function r(e,t,r,i,n){var a,s;0!==r.length&&(a=[],s=[],AnimationUtils.flattenJSON(r,a,s,i),0!==a.length&&n.push(new e(t,a,s)))}const i=[];var n=e.name||"default",a=e.fps||30,s=e.blendMode;let o=e.length||-1;var l=e.hierarchy||[];for(let e=0;e<l.length;e++){var c=l[e].keys;if(c&&0!==c.length)if(c[0].morphTargets){const d={};let t;for(t=0;t<c.length;t++)if(c[t].morphTargets)for(let e=0;e<c[t].morphTargets.length;e++)d[c[t].morphTargets[e]]=-1;for(const p in d){const f=[],m=[];for(let e=0;e!==c[t].morphTargets.length;++e){var h=c[t];f.push(h.time),m.push(h.morphTarget===p?1:0)}i.push(new NumberKeyframeTrack(".morphTargetInfluence["+p+"]",f,m))}o=d.length*(a||1)}else{var u=".bones["+t[e].name+"]";r(VectorKeyframeTrack,u+".position",c,"pos",i),r(QuaternionKeyframeTrack,u+".quaternion",c,"rot",i),r(VectorKeyframeTrack,u+".scale",c,"scl",i)}}return 0===i.length?null:new this(n,o,i,s)}resetDuration(){let r=0;for(let e=0,t=this.tracks.length;e!==t;++e){var i=this.tracks[e];r=Math.max(r,i.times[i.times.length-1])}return this.duration=r,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=getTrackTypeForValueTypeName(e.type);var r,i;return void 0===e.times&&(r=[],i=[],AnimationUtils.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i),void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class LoadingManager{constructor(e,t,r){const i=this;let n=!1,a=0,s=0,o=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){s++,!1===n&&void 0!==i.onStart&&i.onStart(e,a,s),n=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,s),a===s&&(n=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(r){for(let e=0,t=l.length;e<t;e+=2){const n=l[e];var i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(r))return i}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,i){const n=this;return new Promise(function(e,t){n.load(r,e,i,t)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const loading={};class FileLoader extends Loader{constructor(e){super(e)}load(a,e,t,r){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);const i=Cache.get(a);if(void 0!==i)return this.manager.itemStart(a),setTimeout(()=>{e&&e(i),this.manager.itemEnd(a)},0),i;var n;void 0===loading[a]?(loading[a]=[],loading[a].push({onLoad:e,onProgress:t,onError:r}),n=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),fetch(n).then(e=>{if(200!==e.status&&0!==e.status)throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`);{0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const o=loading[a],t=e.body.getReader();e=e.headers.get("Content-Length");const l=e?parseInt(e):0,c=0!==l;let s=0;return new ReadableStream({start(a){!function n(){t.read().then(({done:e,value:t})=>{if(e)a.close();else{s+=t.byteLength;const r=new ProgressEvent("progress",{lengthComputable:c,loaded:s,total:l});for(let e=0,t=o.length;e<t;e++){const i=o[e];i.onProgress&&i.onProgress(r)}a.enqueue(t),n()}})}()}})}}).then(e=>{const t=new Response(e);switch(this.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(e=>{const t=new DOMParser;return t.parseFromString(e,this.mimeType)});case"json":return t.json();default:return t.text()}}).then(r=>{Cache.add(a,r);var i=loading[a];delete loading[a];for(let e=0,t=i.length;e<t;e++){const n=i[e];n.onLoad&&n.onLoad(r)}this.manager.itemEnd(a)}).catch(r=>{var i=loading[a];delete loading[a];for(let e=0,t=i.length;e<t;e++){const n=i[e];n.onError&&n.onError(r)}this.manager.itemError(a),this.manager.itemEnd(a)}),this.manager.itemStart(a)):loading[a].push({onLoad:e,onProgress:t,onError:r})}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class AnimationLoader extends Loader{constructor(e){super(e)}load(t,r,e,i){const n=this,a=new FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(t){const r=[];for(let e=0;e<t.length;e++){var i=AnimationClip.parse(t[e]);r.push(i)}return r}}class CompressedTextureLoader extends Loader{constructor(e){super(e)}load(r,n,i,a){const s=this,o=[],l=new CompressedTexture,c=new FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(s.withCredentials);let h=0;if(Array.isArray(r))for(let e=0,t=r.length;e<t;++e)!function(t){c.load(r[t],function(e){e=s.parse(e,!0);o[t]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},h+=1,6===h&&(1===e.mipmapCount&&(l.minFilter=LinearFilter),l.image=o,l.format=e.format,l.needsUpdate=!0,n&&n(l))},i,a)}(e);else c.load(r,function(e){var r=s.parse(e,!0);if(r.isCubemap){var i=r.mipmaps.length/r.mipmapCount;for(let t=0;t<i;t++){o[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)o[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),o[t].format=r.format,o[t].width=r.width,o[t].height=r.height}l.image=o}else l.image.width=r.width,l.image.height=r.height,l.mipmaps=r.mipmaps;1===r.mipmapCount&&(l.minFilter=LinearFilter),l.format=r.format,l.needsUpdate=!0,n&&n(l)},i,a);return l}}class ImageLoader extends Loader{constructor(e){super(e)}load(t,e,r,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=Cache.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;const s=createElementNS("img");function o(){c(),Cache.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){c(),i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}function c(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),n.manager.itemStart(t),s.src=t,s}}class CubeTextureLoader extends Loader{constructor(e){super(e)}load(r,i,e,n){const a=new CubeTexture,s=new ImageLoader(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;for(let e=0;e<r.length;++e)!function(t){s.load(r[t],function(e){a.images[t]=e,o++,6===o&&(a.needsUpdate=!0,i&&i(a))},void 0,n)}(e);return a}}class DataTextureLoader extends Loader{constructor(e){super(e)}load(e,t,r,i){const n=this,a=new DataTexture,s=new FileLoader(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(n.withCredentials),s.load(e,function(e){e=n.parse(e);e&&(void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:ClampToEdgeWrapping,a.wrapT=void 0!==e.wrapT?e.wrapT:ClampToEdgeWrapping,a.magFilter=void 0!==e.magFilter?e.magFilter:LinearFilter,a.minFilter=void 0!==e.minFilter?e.minFilter:LinearFilter,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.encoding&&(a.encoding=e.encoding),void 0!==e.flipY&&(a.flipY=e.flipY),void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps,a.minFilter=LinearMipmapLinearFilter),1===e.mipmapCount&&(a.minFilter=LinearFilter),void 0!==e.generateMipmaps&&(a.generateMipmaps=e.generateMipmaps),a.needsUpdate=!0,t&&t(a,e))},r,i),a}}class TextureLoader extends Loader{constructor(e){super(e)}load(e,t,r,i){const n=new Texture,a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n}}class Light extends Object3D{constructor(e,t=1){super(),this.type="Light",this.color=new Color(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Light.prototype.isLight=!0;class HemisphereLight extends Light{constructor(e,t,r){super(e,r),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}copy(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}HemisphereLight.prototype.isHemisphereLight=!0;const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera;var r=2*RAD2DEG*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;r===t.fov&&i===t.aspect&&n===t.far||(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}SpotLightShadow.prototype.isSpotLightShadow=!0;class SpotLight extends Light{constructor(e,t,r=0,i=Math.PI/3,n=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.distance=r,this.angle=i,this.penumbra=n,this.decay=a,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}SpotLight.prototype.isSpotLight=!0;const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix;var n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(e.matrixWorld),r.position.copy(_lightPositionWorld),_lookTarget.copy(r.position),_lookTarget.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(_lookTarget),r.updateMatrixWorld(),i.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}PointLightShadow.prototype.isPointLightShadow=!0;class PointLight extends Light{constructor(e,t,r=0,i=1){super(e,t),this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}PointLight.prototype.isPointLight=!0;class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500))}}DirectionalLightShadow.prototype.isDirectionalLightShadow=!0;class DirectionalLight extends Light{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}DirectionalLight.prototype.isDirectionalLight=!0;class AmbientLight extends Light{constructor(e,t){super(e,t),this.type="AmbientLight"}}AmbientLight.prototype.isAmbientLight=!0;class RectAreaLight extends Light{constructor(e,t,r=10,i=10){super(e,t),this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}RectAreaLight.prototype.isRectAreaLight=!0;class SphericalHarmonics3{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vector3)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){var r=e.x,i=e.y,n=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.282095),t.addScaledVector(e[1],.488603*i),t.addScaledVector(e[2],.488603*n),t.addScaledVector(e[3],.488603*r),t.addScaledVector(e[4],r*i*1.092548),t.addScaledVector(e[5],i*n*1.092548),t.addScaledVector(e[6],.315392*(3*n*n-1)),t.addScaledVector(e[7],r*n*1.092548),t.addScaledVector(e[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){var r=e.x,i=e.y,n=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.886227),t.addScaledVector(e[1],1.023328*i),t.addScaledVector(e[2],1.023328*n),t.addScaledVector(e[3],1.023328*r),t.addScaledVector(e[4],.858086*r*i),t.addScaledVector(e[5],.858086*i*n),t.addScaledVector(e[6],.743125*n*n-.247708),t.addScaledVector(e[7],.858086*r*n),t.addScaledVector(e[8],.429043*(r*r-i*i)),t}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,r){for(let e=0;e<9;e++)this.coefficients[e].addScaledVector(t.coefficients[e],r);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,r){for(let e=0;e<9;e++)this.coefficients[e].lerp(t.coefficients[e],r);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,r=0){const i=this.coefficients;for(let e=0;e<9;e++)i[e].fromArray(t,r+3*e);return this}toArray(t=[],r=0){const i=this.coefficients;for(let e=0;e<9;e++)i[e].toArray(t,r+3*e);return t}static getBasisAt(e,t){var r=e.x,i=e.y,e=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*e,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*r*e,t[8]=.546274*(r*r-i*i)}}SphericalHarmonics3.prototype.isSphericalHarmonics3=!0;class LightProbe extends Light{constructor(e=new SphericalHarmonics3,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}LightProbe.prototype.isLightProbe=!0;class MaterialLoader extends Loader{constructor(e){super(e),this.textures={}}load(t,r,e,i){const n=this,a=new FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(t){const r=this.textures;function e(e){return void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),r[e]}const i=new Materials[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Color).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.format&&(i.format=t.format),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=0<t.vertexColors:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const a in t.uniforms){var n=t.uniforms[a];switch(i.uniforms[a]={},n.type){case"t":i.uniforms[a].value=e(n.value);break;case"c":i.uniforms[a].value=(new Color).setHex(n.value);break;case"v2":i.uniforms[a].value=(new Vector2).fromArray(n.value);break;case"v3":i.uniforms[a].value=(new Vector3).fromArray(n.value);break;case"v4":i.uniforms[a].value=(new Vector4).fromArray(n.value);break;case"m3":i.uniforms[a].value=(new Matrix3).fromArray(n.value);break;case"m4":i.uniforms[a].value=(new Matrix4).fromArray(n.value);break;default:i.uniforms[a].value=n.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const s in t.extensions)i.extensions[s]=t.extensions[s];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=e(t.map)),void 0!==t.matcap&&(i.matcap=e(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=e(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Vector2).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=e(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=e(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=e(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=e(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=e(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(i.transmissionMap=e(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=e(t.thicknessMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=e(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=e(t.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}}class LoaderUtils{static decodeText(r){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(r);let i="";for(let e=0,t=r.length;e<t;e++)i+=String.fromCharCode(r[e]);try{return decodeURIComponent(escape(i))}catch(e){return i}}static extractUrlBase(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}InstancedBufferGeometry.prototype.isInstancedBufferGeometry=!0;class BufferGeometryLoader extends Loader{constructor(e){super(e)}load(t,r,e,i){const n=this,a=new FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(r){const n={},a={};function i(e,t){if(void 0!==n[t])return n[t];var r=e.interleavedBuffers[t],e=function(e,t){if(void 0!==a[t])return a[t];e=e.arrayBuffers,e=e[t],e=new Uint32Array(e).buffer;return a[t]=e}(e,r.buffer),e=getTypedArray(r.type,e);const i=new InterleavedBuffer(e,r.stride);return i.uuid=r.uuid,n[t]=i,i}const s=new(r.isInstancedBufferGeometry?InstancedBufferGeometry:BufferGeometry);var e=r.data.index;void 0!==e&&(m=getTypedArray(e.type,e.array),s.setIndex(new BufferAttribute(m,1)));var t=r.data.attributes;for(const g in t){var o=t[g];let e;if(o.isInterleavedBufferAttribute){var l=i(r.data,o.data);e=new InterleavedBufferAttribute(l,o.itemSize,o.offset,o.normalized)}else{l=getTypedArray(o.type,o.array);const _=o.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;e=new _(l,o.itemSize,o.normalized)}void 0!==o.name&&(e.name=o.name),void 0!==o.usage&&e.setUsage(o.usage),void 0!==o.updateRange&&(e.updateRange.offset=o.updateRange.offset,e.updateRange.count=o.updateRange.count),s.setAttribute(g,e)}var c=r.data.morphAttributes;if(c)for(const v in c){var h=c[v];const y=[];for(let t=0,e=h.length;t<e;t++){var u,d=h[t];let e;e=d.isInterleavedBufferAttribute?(u=i(r.data,d.data),new InterleavedBufferAttribute(u,d.itemSize,d.offset,d.normalized)):(u=getTypedArray(d.type,d.array),new BufferAttribute(u,d.itemSize,d.normalized)),void 0!==d.name&&(e.name=d.name),y.push(e)}s.morphAttributes[v]=y}r.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);var p=r.data.groups||r.data.drawcalls||r.data.offsets;if(void 0!==p)for(let e=0,t=p.length;e!==t;++e){var f=p[e];s.addGroup(f.start,f.count,f.materialIndex)}var m=r.data.boundingSphere;if(void 0!==m){const x=new Vector3;void 0!==m.center&&x.fromArray(m.center),s.boundingSphere=new Sphere(x,m.radius)}return r.name&&(s.name=r.name),r.userData&&(s.userData=r.userData),s}}class ObjectLoader extends Loader{constructor(e){super(e)}load(i,n,e,a){const s=this;var t=""===this.path?LoaderUtils.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||t;const r=new FileLoader(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(i,function(e){let t=null;try{t=JSON.parse(e)}catch(e){return void 0!==a&&a(e),void console.error("THREE:ObjectLoader: Can't parse "+i+".",e.message)}const r=t.metadata;void 0!==r&&void 0!==r.type&&"geometry"!==r.type.toLowerCase()?s.parse(t,n):console.error("THREE.ObjectLoader: Can't load "+i)},e,a)}async loadAsync(e,t){var r=""===this.path?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const i=new FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);t=await i.loadAsync(e,t),t=JSON.parse(t);const n=t.metadata;if(void 0===n||void 0===n.type||"geometry"===n.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return this.parseAsync(t)}parse(e,t){var r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){void 0!==t&&t(o)}),s=this.parseTextures(e.textures,a),i=this.parseMaterials(e.materials,s);const o=this.parseObject(e.object,n,i,s,r);e=this.parseSkeletons(e.skeletons,o);if(this.bindSkeletons(o,e),void 0!==t){let e=!1;for(const l in a)if(a[l]instanceof HTMLImageElement){e=!0;break}!1===e&&t(o)}return o}async parseAsync(e){var t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),n=await this.parseImagesAsync(e.images),r=this.parseTextures(e.textures,n),n=this.parseMaterials(e.materials,r),t=this.parseObject(e.object,i,n,r,t),e=this.parseSkeletons(e.skeletons,t);return this.bindSkeletons(t,e),t}parseShapes(r){const i={};if(void 0!==r)for(let e=0,t=r.length;e<t;e++){var n=(new Shape).fromJSON(r[e]);i[n.uuid]=n}return i}parseSkeletons(r,e){const i={},n={};if(e.traverse(function(e){e.isBone&&(n[e.uuid]=e)}),void 0!==r)for(let e=0,t=r.length;e<t;e++){var a=(new Skeleton).fromJSON(r[e],n);i[a.uuid]=a}return i}parseGeometries(r,i){const n={};if(void 0!==r){const s=new BufferGeometryLoader;for(let t=0,e=r.length;t<e;t++){let e;var a=r[t];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":e=s.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Geometries?e=Geometries[a.type].fromJSON(a,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}e.uuid=a.uuid,void 0!==a.name&&(e.name=a.name),!0===e.isBufferGeometry&&void 0!==a.userData&&(e.userData=a.userData),n[a.uuid]=e}}return n}parseMaterials(r,e){const i={},n={};if(void 0!==r){const o=new MaterialLoader;o.setTextures(e);for(let e=0,t=r.length;e<t;e++){var a=r[e];if("MultiMaterial"===a.type){const l=[];for(let e=0;e<a.materials.length;e++){var s=a.materials[e];void 0===i[s.uuid]&&(i[s.uuid]=o.parse(s)),l.push(i[s.uuid])}n[a.uuid]=l}else void 0===i[a.uuid]&&(i[a.uuid]=o.parse(a)),n[a.uuid]=i[a.uuid]}}return n}parseAnimations(t){const r={};if(void 0!==t)for(let e=0;e<t.length;e++){var i=t[e],i=AnimationClip.parse(i);r[i.uuid]=i}return r}parseImages(r,e){const i=this,n={};let a;function s(e){if("string"!=typeof e)return e.data?{data:getTypedArray(e.type,e.data),width:e.width,height:e.height}:null;var t,e=e,e=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e;return t=e,i.manager.itemStart(t),a.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemError(t),i.manager.itemEnd(t)})}if(void 0!==r&&0<r.length){e=new LoadingManager(e);a=new ImageLoader(e),a.setCrossOrigin(this.crossOrigin);for(let e=0,t=r.length;e<t;e++){var o=r[e],l=o.url;if(Array.isArray(l)){n[o.uuid]=[];for(let e=0,t=l.length;e<t;e++){var c=s(l[e]);null!==c&&(c instanceof HTMLImageElement?n[o.uuid].push(c):n[o.uuid].push(new DataTexture(c.data,c.width,c.height)))}}else{var h=s(o.url);null!==h&&(n[o.uuid]=h)}}}return n}async parseImagesAsync(r){const t=this,i={};let n;async function a(e){if("string"!=typeof e)return e.data?{data:getTypedArray(e.type,e.data),width:e.width,height:e.height}:null;e=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:t.resourcePath+e;return n.loadAsync(e)}if(void 0!==r&&0<r.length){n=new ImageLoader(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,t=r.length;e<t;e++){var s=r[e],o=s.url;if(Array.isArray(o)){i[s.uuid]=[];for(let e=0,t=o.length;e<t;e++){var l=await a(o[e]);null!==l&&(l instanceof HTMLImageElement?i[s.uuid].push(l):i[s.uuid].push(new DataTexture(l.data,l.width,l.height)))}}else{var c=await a(s.url);null!==c&&(i[s.uuid]=c)}}}return i}parseTextures(r,i){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const a={};if(void 0!==r)for(let t=0,e=r.length;t<e;t++){var s=r[t];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===i[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);let e;var o=i[s.image];Array.isArray(o)?(e=new CubeTexture(o),6===o.length&&(e.needsUpdate=!0)):(e=o&&o.data?new DataTexture(o.data,o.width,o.height):new Texture(o),o&&(e.needsUpdate=!0)),e.uuid=s.uuid,void 0!==s.name&&(e.name=s.name),void 0!==s.mapping&&(e.mapping=n(s.mapping,TEXTURE_MAPPING)),void 0!==s.offset&&e.offset.fromArray(s.offset),void 0!==s.repeat&&e.repeat.fromArray(s.repeat),void 0!==s.center&&e.center.fromArray(s.center),void 0!==s.rotation&&(e.rotation=s.rotation),void 0!==s.wrap&&(e.wrapS=n(s.wrap[0],TEXTURE_WRAPPING),e.wrapT=n(s.wrap[1],TEXTURE_WRAPPING)),void 0!==s.format&&(e.format=s.format),void 0!==s.type&&(e.type=s.type),void 0!==s.encoding&&(e.encoding=s.encoding),void 0!==s.minFilter&&(e.minFilter=n(s.minFilter,TEXTURE_FILTER)),void 0!==s.magFilter&&(e.magFilter=n(s.magFilter,TEXTURE_FILTER)),void 0!==s.anisotropy&&(e.anisotropy=s.anisotropy),void 0!==s.flipY&&(e.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(e.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(e.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(e.userData=s.userData),a[s.uuid]=e}return a}parseObject(e,t,a,r,i){let n;function s(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(r){if(void 0!==r){if(Array.isArray(r)){const n=[];for(let e=0,t=r.length;e<t;e++){var i=r[e];void 0===a[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),n.push(a[i])}return n}return void 0===a[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),a[r]}}function l(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}let c,h;switch(e.type){case"Scene":n=new Scene,void 0!==e.background&&(Number.isInteger(e.background)?n.background=new Color(e.background):n.background=l(e.background)),void 0!==e.environment&&(n.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":n=new DirectionalLight(e.color,e.intensity);break;case"PointLight":n=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":n=(new LightProbe).fromJSON(e);break;case"SkinnedMesh":c=s(e.geometry),h=o(e.material),n=new SkinnedMesh(c,h),void 0!==e.bindMode&&(n.bindMode=e.bindMode),void 0!==e.bindMatrix&&n.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(n.skeleton=e.skeleton);break;case"Mesh":c=s(e.geometry),h=o(e.material),n=new Mesh(c,h);break;case"InstancedMesh":c=s(e.geometry),h=o(e.material);var u=e.count,d=e.instanceMatrix,p=e.instanceColor;n=new InstancedMesh(c,h,u),n.instanceMatrix=new InstancedBufferAttribute(new Float32Array(d.array),16),void 0!==p&&(n.instanceColor=new InstancedBufferAttribute(new Float32Array(p.array),p.itemSize));break;case"LOD":n=new LOD;break;case"Line":n=new Line(s(e.geometry),o(e.material));break;case"LineLoop":n=new LineLoop(s(e.geometry),o(e.material));break;case"LineSegments":n=new LineSegments(s(e.geometry),o(e.material));break;case"PointCloud":case"Points":n=new Points(s(e.geometry),o(e.material));break;case"Sprite":n=new Sprite(o(e.material));break;case"Group":n=new Group;break;case"Bone":n=new Bone;break;default:n=new Object3D}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(n.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children){var f=e.children;for(let e=0;e<f.length;e++)n.add(this.parseObject(f[e],t,a,r,i))}if(void 0!==e.animations){var m=e.animations;for(let e=0;e<m.length;e++){var g=m[e];n.animations.push(i[g])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(n.autoUpdate=e.autoUpdate);var _=e.levels;for(let e=0;e<_.length;e++){var v=_[e],y=n.getObjectByProperty("uuid",v.object);void 0!==y&&n.addLevel(y,v.distance)}}return n}bindSkeletons(e,r){0!==Object.keys(r).length&&e.traverse(function(e){var t;!0===e.isSkinnedMesh&&void 0!==e.skeleton&&(void 0===(t=r[e.skeleton])?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(t,e.bindMatrix))})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(t,r,e,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=Cache.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){r&&r(a),n.manager.itemEnd(t)},0),a;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(t,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(e){Cache.add(t,e),r&&r(e),n.manager.itemEnd(t)}).catch(function(e){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}),n.manager.itemStart(t)}}ImageBitmapLoader.prototype.isImageBitmapLoader=!0;let _context;const AudioContext={getContext:function(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(e){_context=e}};class AudioLoader extends Loader{constructor(e){super(e)}load(i,n,e,a){const s=this,t=new FileLoader(this.manager);t.setResponseType("arraybuffer"),t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials),t.load(i,function(e){try{var t=e.slice(0);const r=AudioContext.getContext();r.decodeAudioData(t,function(e){n(e)})}catch(e){a?a(e):console.error(e),s.manager.itemError(i)}},e,a)}}class HemisphereLightProbe extends LightProbe{constructor(e,t,r=1){super(void 0,r);var i=(new Color).set(e),r=(new Color).set(t),e=new Vector3(i.r,i.g,i.b),t=new Vector3(r.r,r.g,r.b),i=Math.sqrt(Math.PI),r=i*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(i),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(r)}}HemisphereLightProbe.prototype.isHemisphereLightProbe=!0;class AmbientLightProbe extends LightProbe{constructor(e,t=1){super(void 0,t);e=(new Color).set(e);this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}}AmbientLightProbe.prototype.isAmbientLightProbe=!0;const _eyeRight=new Matrix4,_eyeLeft=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const s=e.projectionMatrix.clone();var r,i=t.eyeSep/2,n=i*t.near/t.focus,a=t.near*Math.tan(DEG2RAD*t.fov*.5)/t.zoom;_eyeLeft.elements[12]=-i,_eyeRight.elements[12]=i,r=-a*t.aspect+n,i=a*t.aspect+n,s.elements[0]=2*t.near/(i-r),s.elements[8]=(i+r)/(i-r),this.cameraL.projectionMatrix.copy(s),r=-a*t.aspect-n,i=a*t.aspect-n,s.elements[0]=2*t.near/(i-r),s.elements[8]=(i+r)/(i-r),this.cameraR.projectionMatrix.copy(s)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=now(),e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e),e);var t}}function now(){return("undefined"==typeof performance?Date:performance).now()}const _position$1=new Vector3,_quaternion$1=new Quaternion,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;var r=this.up;this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),t.positionX?(e=this.context.currentTime+this.timeDelta,t.positionX.linearRampToValueAtTime(_position$1.x,e),t.positionY.linearRampToValueAtTime(_position$1.y,e),t.positionZ.linearRampToValueAtTime(_position$1.z,e),t.forwardX.linearRampToValueAtTime(_orientation$1.x,e),t.forwardY.linearRampToValueAtTime(_orientation$1.y,e),t.forwardZ.linearRampToValueAtTime(_orientation$1.z,e),t.upX.linearRampToValueAtTime(r.x,e),t.upY.linearRampToValueAtTime(r.y,e),t.upZ.linearRampToValueAtTime(r.z,e)):(t.setPosition(_position$1.x,_position$1.y,_position$1.z),t.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,r.x,r.y,r.z))}}class Audio extends Object3D{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e=e||[],!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const _position=new Vector3,_quaternion=new Quaternion,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const t=this.panner;t.positionX?(e=this.context.currentTime+this.listener.timeDelta,t.positionX.linearRampToValueAtTime(_position.x,e),t.positionY.linearRampToValueAtTime(_position.y,e),t.positionZ.linearRampToValueAtTime(_position.z,e),t.orientationX.linearRampToValueAtTime(_orientation.x,e),t.orientationY.linearRampToValueAtTime(_orientation.y,e),t.orientationZ.linearRampToValueAtTime(_orientation.z,e)):(t.setPosition(_position.x,_position.y,_position.z),t.setOrientation(_orientation.x,_orientation.y,_orientation.z))}}}class AudioAnalyser{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;var r=this.getFrequencyData();for(let e=0;e<r.length;e++)t+=r[e];return t/r.length}}class PropertyMixer{constructor(e,t,r){this.binding=e,this.valueSize=r;let i,n,a;switch(t){case"quaternion":i=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,i=this.valueSize,n=e*i+i;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==i;++e)r[n+e]=r[e];a=t}else{a+=t;t=t/a;this._mixBufferRegion(r,n,0,t,i)}this.cumulativeWeight=a}accumulateAdditive(e){var t=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const r=this.valueSize,i=this.buffer,n=e*r+r,t=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,t<1&&(e=r*this._origIndex,this._mixBufferRegion(i,n,e,1-t,r)),0<a&&this._mixBufferRegionAdditive(i,n,this._addIndex*r,1,r);for(let e=r,t=r+r;e!==t;++e)if(i[e]!==i[e+r]){s.setValue(i,n);break}}saveOriginalState(){const e=this.binding,r=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(r,n);for(let e=i,t=n;e!==t;++e)r[e]=r[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){var t=this._addIndex*this.valueSize,r=t+this.valueSize;for(let e=t;e<r;e++)this.buffer[e]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var t=this._origIndex*this.valueSize,r=this._addIndex*this.valueSize;for(let e=0;e<this.valueSize;e++)this.buffer[r+e]=this.buffer[t+e]}_select(t,r,i,e,n){if(.5<=e)for(let e=0;e!==n;++e)t[r+e]=t[i+e]}_slerp(e,t,r,i){Quaternion.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,n){n=this._workIndex*n;Quaternion.multiplyQuaternionsFlat(e,n,e,t,e,r),Quaternion.slerpFlat(e,t,e,t,e,n,i)}_lerp(t,r,i,n,a){var s=1-n;for(let e=0;e!==a;++e){var o=r+e;t[o]=t[o]*s+t[i+e]*n}}_lerpAdditive(t,r,i,n,a){for(let e=0;e!==a;++e){var s=r+e;t[s]=t[s]+t[i+e]*n}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];class Composite{constructor(e,t,r){r=r||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)}setValue(r,i){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].setValue(r,i)}bind(){const r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].bind()}unbind(){const r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].unbind()}}class PropertyBinding{constructor(e,t,r){this.path=t,this.parsedPath=r||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return new(e&&e.isAnimationObjectGroup?PropertyBinding.Composite:PropertyBinding)(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(e){var t=_trackRe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]};var i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i&&(t=r.nodeName.substring(i+1),-1!==_supportedObjectNames.indexOf(t)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=t)),null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(!i||""===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(i);if(void 0!==t)return t}if(e.children){const n=function(t){for(let e=0;e<t.length;e++){var r=t[e];if(r.name===i||r.uuid===i)return r;r=n(r.children);if(r)return r}return null};e=n(e.children);if(e)return e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)r[i++]=n[e]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,i){const n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++]}_setValue_array_setNeedsUpdate(r,i){const n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,i){const n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let r=this.node;var e=this.parsedPath,i=e.objectName,n=e.propertyName;let a=e.propertyIndex;if(r||(r=PropertyBinding.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,r){if(i){let t=e.objectIndex;switch(i){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let e=0;e<r.length;e++)if(r[e].name===t){t=e;break}break;default:if(void 0===r[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[i]}if(void 0!==t){if(void 0===r[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[t]}}var s=r[n];if(void 0!==s){let e=this.Versioning.None;this.targetObject=r,void 0!==r.needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==r.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate);let t=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===n){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==r.morphTargetDictionary[a]&&(a=r.morphTargetDictionary[a])}t=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=a}else void 0!==s.fromArray&&void 0!==s.toArray?(t=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(t=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[t],this.setValue=this.SetterByBindingTypeAndVersioning[t][e]}else{e=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+n+" but it wasn't found.",r)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite,PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const r={};this._indicesByUUID=r;for(let e=0,t=arguments.length;e!==t;++e)r[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const i=this._objects,n=this._indicesByUUID,a=this._paths,s=this._parsedPaths,o=this._bindings,l=o.length;let c=void 0,h=i.length,u=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var d=arguments[e],p=d.uuid;let r=n[p];if(void 0===r){r=h++,n[p]=r,i.push(d);for(let e=0,t=l;e!==t;++e)o[e].push(new PropertyBinding(d,a[e],s[e]))}else if(r<u){c=i[r];var f=--u,m=i[f];n[m.uuid]=r,i[r]=m,n[p]=f,i[f]=d;for(let t=0,e=l;t!==e;++t){const g=o[t],_=g[f];let e=g[r];g[r]=_,void 0===e&&(e=new PropertyBinding(d,a[t],s[t])),g[f]=e}}else i[r]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const r=this._objects,i=this._indicesByUUID,n=this._bindings,a=n.length;let s=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var o=arguments[e],l=o.uuid,c=i[l];if(void 0!==c&&c>=s){var h=s++,u=r[h];i[u.uuid]=c,r[c]=u,i[l]=h,r[h]=o;for(let e=0,t=a;e!==t;++e){const d=n[e],p=d[h],f=d[c];d[c]=p,d[h]=f}}}this.nCachedObjects_=s}uncache(){const r=this._objects,i=this._indicesByUUID,n=this._bindings,a=n.length;let s=this.nCachedObjects_,o=r.length;for(let e=0,t=arguments.length;e!==t;++e){var l=arguments[e].uuid,c=i[l];if(void 0!==c)if(delete i[l],c<s){var h=--s,l=r[h],u=--o,d=r[u];i[l.uuid]=c,r[c]=l,i[d.uuid]=h,r[h]=d,r.pop();for(let e=0,t=a;e!==t;++e){const f=n[e],m=f[h],g=f[u];f[c]=m,f[h]=g,f.pop()}}else{var p=--o,d=r[p];0<p&&(i[d.uuid]=c),r[c]=d,r.pop();for(let e=0,t=a;e!==t;++e){const _=n[e];_[c]=_[p],_.pop()}}}this.nCachedObjects_=s}subscribe_(r,i){const e=this._bindingsIndicesByPath;let t=e[r];const n=this._bindings;if(void 0!==t)return n[t];const a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);t=n.length,e[r]=t,a.push(r),s.push(i),n.push(h);for(let e=c,t=o.length;e!==t;++e){var u=o[e];h[e]=new PropertyBinding(u,r,i)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){const i=this._paths,n=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s],l=e[s];t[l]=r,a[r]=o,a.pop(),n[r]=n[s],n.pop(),i[r]=i[s],i.pop()}}}AnimationObjectGroup.prototype.isAnimationObjectGroup=!0;class AnimationAction{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;const n=t.tracks,a=n.length,s=new Array(a);var o={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let e=0;e!==a;++e){const l=n[e].createInterpolant(null);s[e]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){var i,n;return e.fadeOut(t),this.fadeIn(t),r&&(r=(i=this._clip.duration)/(n=e._clip.duration),e.warp(1,n/i,t),this.warp(r,1,t)),this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const i=this._mixer,n=i.time,a=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const o=s.parameterPositions,l=s.sampleValues;return o[0]=n,o[1]=n+r,l[0]=e/a,l[1]=t/a,this}stopWarping(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(this.enabled){var n=this._startTime;if(null!==n){n=(e-n)*r;if(n<0||0===r)return;this._startTime=null,t=r*n}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(0<s){const o=this._interpolants,l=this._propertyBindings;if(this.blendMode===AdditiveAnimationBlendMode)for(let e=0,t=o.length;e!==t;++e)o[e].evaluate(a),l[e].accumulateAdditive(s);else{NormalAnimationBlendMode;for(let e=0,t=o.length;e!==t;++e)o[e].evaluate(a),l[e].accumulate(i,s)}}}else this._updateWeight(e)}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;var r;null!==i&&(r=i.evaluate(e)[0],t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1)))}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;var r;null!==i&&(r=i.evaluate(e)[0],t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){var t=this._clip.duration,r=this.loop;let i=this.time+e,n=this._loopCount;var a,s=r===LoopPingPong;if(0===e)return-1!==n&&s&&1==(1&n)?t-i:i;if(r===LoopOnce){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else if(-1===n&&(0<=e?(n=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=t||i<0?(a=Math.floor(i/t),i-=t*a,n+=Math.abs(a),(r=this.repetitions-n)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=0<e?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1==r?this._setEndings(r=e<0,!r,s):this._setEndings(!1,!1,s),this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a}))):this.time=i,s&&1==(1&n))return t-i;return i}_setEndings(e,t,r){const i=this._interpolantSettings;r?(i.endingStart=ZeroSlopeEnding,i.endingEnd=ZeroSlopeEnding):(i.endingStart=e?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,i.endingEnd=t?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)}_scheduleFading(e,t,r){const i=this._mixer,n=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const s=a.parameterPositions,o=a.sampleValues;return s[0]=n,o[0]=t,s[1]=n+e,o[1]=r,this}}class AnimationMixer extends EventDispatcher{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,r){const i=e._localRoot||this._root,n=e._clip.tracks,a=n.length,s=e._propertyBindings,o=e._interpolants,l=i.uuid,t=this._bindingsByRootAndName;let c=t[l];void 0===c&&(c={},t[l]=c);for(let t=0;t!==a;++t){const u=n[t],d=u.name;let e=c[d];if(void 0!==e)s[t]=e;else{if(e=s[t],void 0!==e){null===e._cacheIndex&&(++e.referenceCount,this._addInactiveBinding(e,l,d));continue}var h=r&&r._propertyBindings[t].binding.parsedPath;e=new PropertyMixer(PropertyBinding.create(i,d,h),u.ValueTypeName,u.getValueSize()),++e.referenceCount,this._addInactiveBinding(e,l,d),s[t]=e}o[t].resultBuffer=e.buffer}}_activateAction(e){if(!this._isActiveAction(e)){var t,r,i;null===e._cacheIndex&&(t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r],this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t));var n=e._propertyBindings;for(let e=0,t=n.length;e!==t;++e){const a=n[e];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){const i=r[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(e,t,r){const i=this._actions,n=this._actionsByClip;let a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{const s=a.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;const n=e._clip.uuid,a=this._actionsByClip,s=a[n],o=s.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;const h=s.actionByRoot,u=(e._localRoot||this._root).uuid;delete h[u],0===o.length&&delete a[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){const i=r[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_addInactiveBinding(e,t,r){const i=this._bindingsByRootAndName,n=this._bindings;let a=i[t];void 0===a&&(a={},i[t]=a),(a[r]=e)._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,s=a[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[n],0===Object.keys(s).length&&delete a[i]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return void 0===r&&(r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n}clipAction(e,t,r){var i=t||this._root,n=i.uuid;let a="string"==typeof e?AnimationClip.findByName(i,e):e;var s=null!==a?a.uuid:e,i=this._actionsByClip[s];let o=null;if(void 0===r&&(r=null!==a?a.blendMode:NormalAnimationBlendMode),void 0!==i){e=i.actionByRoot[n];if(void 0!==e&&e.blendMode===r)return e;o=i.knownActions[0],null===a&&(a=o._clip)}if(null===a)return null;r=new AnimationAction(this,a,t,r);return this._bindAction(r,o),this._addInactiveAction(r,s,n),r}existingAction(e,t){var r=t||this._root,t=r.uuid,r="string"==typeof e?AnimationClip.findByName(r,e):e,e=r?r.uuid:e,e=this._actionsByClip[e];return void 0!==e&&e.actionByRoot[t]||null}stopAllAction(){const t=this._actions,r=this._nActiveActions;for(let e=r-1;0<=e;--e)t[e].stop();return this}update(t){t*=this.timeScale;var r=this._actions,i=this._nActiveActions,n=this.time+=t,a=Math.sign(t),s=this._accuIndex^=1;for(let e=0;e!==i;++e){const c=r[e];c._update(n,t,a,s)}const o=this._bindings,l=this._nActiveBindings;for(let e=0;e!==l;++e)o[e].apply(s);return this}setTime(e){for(let e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const r=this._actions,t=e.uuid,i=this._actionsByClip,n=i[t];if(void 0!==n){var a=n.knownActions;for(let e=0,t=a.length;e!==t;++e){const s=a[e];this._deactivateAction(s);const o=s._cacheIndex,l=r[r.length-1];s._cacheIndex=null,s._byClipCacheIndex=null,l._cacheIndex=o,r[o]=l,r.pop(),this._removeInactiveBindingsForAction(s)}delete i[t]}}uncacheRoot(e){var t=e.uuid,r=this._actionsByClip;for(const a in r){var i=r[a].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var n=this._bindingsByRootAndName[t];if(void 0!==n)for(const s in n){const o=n[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){t=this.existingAction(e,t);null!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}}AnimationMixer.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Uniform{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(e,t,r=1){super(e,t),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}InstancedInterleavedBuffer.prototype.isInstancedInterleavedBuffer=!0;class GLBufferAttribute{constructor(e,t,r,i,n){this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=n,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}GLBufferAttribute.prototype.isGLBufferAttribute=!0;class Raycaster{constructor(e,t,r=0,i=1/0){this.ray=new Ray(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return intersectObject(e,this,r,t),r.sort(ascSort),r}intersectObjects(r,i=!0,n=[]){for(let e=0,t=r.length;e<t;e++)intersectObject(r[e],this,n,i);return n.sort(ascSort),n}}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,r,i,t){if(e.layers.test(r.layers)&&e.raycast(r,i),!0===t){var n=e.children;for(let e=0,t=n.length;e<t;e++)intersectObject(n[e],r,i,!0)}}class Spherical{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(clamp(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const _vector$4=new Vector2;class Box2{constructor(e=new Vector2(1/0,1/0),t=new Vector2(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=_vector$4.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){const t=_vector$4.copy(e).clamp(this.min,this.max);return t.sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box2.prototype.isBox2=!0;const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(e=new Vector3,t=new Vector3){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){_startP.subVectors(e,this.start),_startEnd.subVectors(this.end,this.start);e=_startEnd.dot(_startEnd);let r=_startEnd.dot(_startP)/e;return t&&(r=clamp(r,0,1)),r}closestPointToPoint(e,t,r){t=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(t).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const r=new BufferGeometry,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1;e<32;e++,t++){var n=e/32*Math.PI*2,a=t/32*Math.PI*2;i.push(Math.cos(n),Math.sin(n),1,Math.cos(a),Math.sin(a),1)}r.setAttribute("position",new Float32BufferAttribute(i,3));t=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(r,t),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();var e=this.light.distance||1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(e){var t=getBoneList(e);const r=new BufferGeometry,i=[],n=[];var a=new Color(0,0,1),s=new Color(0,1,0);for(let e=0;e<t.length;e++){var o=t[e];o.parent&&o.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(s.r,s.g,s.b))}r.setAttribute("position",new Float32BufferAttribute(i,3)),r.setAttribute("color",new Float32BufferAttribute(n,3));var l=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){var r=this.bones;const t=this.geometry,i=t.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let e=0,t=0;e<r.length;e++){var n=r[e];n.parent&&n.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,n.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(t,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,n.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(t+1,_vector$2.x,_vector$2.y,_vector$2.z),t+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function getBoneList(t){const r=[];t&&t.isBone&&r.push(t);for(let e=0;e<t.children.length;e++)r.push.apply(r,getBoneList(t.children[e]));return r}class PointLightHelper extends Mesh{constructor(e,t,r){super(new SphereGeometry(t,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;const i=new OctahedronGeometry(t);i.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);t=i.getAttribute("position"),t=new Float32Array(3*t.count);i.setAttribute("color",new BufferAttribute(t,3)),this.add(new Mesh(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let e=0,t=i.count;e<t;e++){var r=e<t/2?_color1:_color2;i.setXYZ(e,r.r,r.g,r.b)}i.needsUpdate=!0}e.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(e=10,i=10,n=4473924,a=8947848){n=new Color(n),a=new Color(a);var s=i/2,o=e/i,l=e/2;const c=[],h=[];for(let e=0,t=0,r=-l;e<=i;e++,r+=o){c.push(-l,0,r,l,0,r),c.push(r,0,-l,r,0,l);const u=e===s?n:a;u.toArray(h,t),t+=3,u.toArray(h,t),t+=3,u.toArray(h,t),t+=3,u.toArray(h,t),t+=3}const t=new BufferGeometry;t.setAttribute("position",new Float32BufferAttribute(c,3)),t.setAttribute("color",new Float32BufferAttribute(h,3));e=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(t,e),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(t=10,r=16,i=8,n=64,a=4473924,s=8947848){a=new Color(a),s=new Color(s);const o=[],l=[];for(let e=0;e<=r;e++){var c=e/r*(2*Math.PI),h=Math.sin(c)*t,c=Math.cos(c)*t;o.push(0,0,0),o.push(h,0,c);c=1&e?a:s;l.push(c.r,c.g,c.b),l.push(c.r,c.g,c.b)}for(let e=0;e<=i;e++){var u=1&e?a:s,d=t-t/i*e;for(let e=0;e<n;e++){var p=e/n*(2*Math.PI),f=Math.sin(p)*d,m=Math.cos(p)*d;o.push(f,0,m),l.push(u.r,u.g,u.b),p=(e+1)/n*(2*Math.PI),f=Math.sin(p)*d,m=Math.cos(p)*d,o.push(f,0,m),l.push(u.r,u.g,u.b)}}const e=new BufferGeometry;e.setAttribute("position",new Float32BufferAttribute(o,3)),e.setAttribute("color",new Float32BufferAttribute(l,3));var g=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(e,g),this.type="PolarGridHelper"}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);let i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));t=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(i,t),this.add(this.lightPlane),i=new BufferGeometry,i.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(i,t),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(e){const t=new BufferGeometry;var r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1});const i=[],n=[],a={};var s=new Color(16755200),o=new Color(16711680),l=new Color(43775),c=new Color(16777215),h=new Color(3355443);function u(e,t,r){d(e,r),d(t,r)}function d(e,t){i.push(0,0,0),n.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}u("n1","n2",s),u("n2","n4",s),u("n4","n3",s),u("n3","n1",s),u("f1","f2",s),u("f2","f4",s),u("f4","f3",s),u("f3","f1",s),u("n1","f1",s),u("n2","f2",s),u("n3","f3",s),u("n4","f4",s),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),t.setAttribute("position",new Float32BufferAttribute(i,3)),t.setAttribute("color",new Float32BufferAttribute(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){const e=this.geometry;var t=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",t,e,_camera,0,0,-1),setPoint("t",t,e,_camera,0,0,1),setPoint("n1",t,e,_camera,-1,-1,-1),setPoint("n2",t,e,_camera,1,-1,-1),setPoint("n3",t,e,_camera,-1,1,-1),setPoint("n4",t,e,_camera,1,1,-1),setPoint("f1",t,e,_camera,-1,-1,1),setPoint("f2",t,e,_camera,1,-1,1),setPoint("f3",t,e,_camera,-1,1,1),setPoint("f4",t,e,_camera,1,1,1),setPoint("u1",t,e,_camera,.7,1.1,-1),setPoint("u2",t,e,_camera,-.7,1.1,-1),setPoint("u3",t,e,_camera,0,2,-1),setPoint("cf1",t,e,_camera,-1,0,1),setPoint("cf2",t,e,_camera,1,0,1),setPoint("cf3",t,e,_camera,0,-1,1),setPoint("cf4",t,e,_camera,0,1,1),setPoint("cn1",t,e,_camera,-1,0,-1),setPoint("cn2",t,e,_camera,1,0,-1),setPoint("cn3",t,e,_camera,0,-1,-1),setPoint("cn4",t,e,_camera,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(e,t,r,i,n,a,s){_vector.set(n,a,s).unproject(i);var o=t[e];if(void 0!==o){const l=r.getAttribute("position");for(let e=0,t=o.length;e<t;e++)l.setXYZ(o[e],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24);const n=new BufferGeometry;n.setIndex(new BufferAttribute(r,1)),n.setAttribute("position",new BufferAttribute(i,3)),super(n,new LineBasicMaterial({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box.setFromObject(this.object),!_box.isEmpty()){var t=_box.min,e=_box.max;const r=this.geometry.attributes.position,i=r.array;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=t.x,i[4]=e.y,i[5]=e.z,i[6]=t.x,i[7]=t.y,i[8]=e.z,i[9]=e.x,i[10]=t.y,i[11]=e.z,i[12]=e.x,i[13]=e.y,i[14]=t.z,i[15]=t.x,i[16]=e.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=e.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}setFromObject(e){return this.object=e,this.update(),this}copy(e){return LineSegments.prototype.copy.call(this,e),this.object=e.object,this}}class Box3Helper extends LineSegments{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);const i=new BufferGeometry;i.setIndex(new BufferAttribute(r,1)),i.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new LineBasicMaterial({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class PlaneHelper extends Line{constructor(e,t=1,r=16776960){const i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new LineBasicMaterial({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),n.computeBoundingSphere(),this.add(new Mesh(n,new MeshBasicMaterial({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?BackSide:FrontSide,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(e=new Vector3(0,0,1),t=new Vector3(0,0,0),r=1,i=16776960,n=.2*r,a=.2*n){super(),this.type="ArrowHelper",void 0===_lineGeometry&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(t),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,a)}setDirection(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(_axis.set(e.z,0,-e.x).normalize(),e=Math.acos(e.y),this.quaternion.setFromAxisAngle(_axis,e))}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class AxesHelper extends LineSegments{constructor(e=1){e=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];const t=new BufferGeometry;t.setAttribute("position",new Float32BufferAttribute(e,3)),t.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));e=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(t,e),this.type="AxesHelper"}setColors(e,t,r){const i=new Color;var n=this.geometry.attributes.color.array;return i.set(e),i.toArray(n,0),i.toArray(n,3),i.set(t),i.toArray(n,6),i.toArray(n,9),i.set(r),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,n,a){return this.currentPath.bezierCurveTo(e,t,r,i,n,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(r,e){function t(r){const i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e];const a=new Shape;a.curves=n.curves,i.push(a)}return i}const i=ShapeUtils.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===e)return t(n);let a,s,o;const l=[];if(1===n.length)return s=n[0],o=new Shape,o.curves=s.curves,l.push(o),l;let c=!i(n[0].getPoints());c=r?!c:c;const h=[],u=[];let d=[],p=0;var f,m;u[p]=void 0,d[p]=[];for(let e=0,t=n.length;e<t;e++)s=n[e],f=s.getPoints(),a=i(f),a=r?!a:a,a?(!c&&u[p]&&p++,u[p]={s:new Shape,p:f},u[p].s.curves=s.curves,c&&p++,d[p]=[]):d[p].push({h:s,p:f[0]});if(!u[0])return t(n);if(1<u.length){let n=!1;const v=[];for(let e=0,t=u.length;e<t;e++)h[e]=[];for(let i=0,e=u.length;i<e;i++){var g=d[i];for(let r=0;r<g.length;r++){var _=g[r];let t=!0;for(let e=0;e<u.length;e++)!function(s,o){var e=o.length;let l=!1;for(let n=e-1,a=0;a<e;n=a++){let e=o[n],t=o[a],r=t.x-e.x,i=t.y-e.y;if(Math.abs(i)>Number.EPSILON){if(i<0&&(e=o[a],r=-r,t=o[n],i=-i),!(s.y<e.y||s.y>t.y))if(s.y===e.y){if(s.x===e.x)return 1}else{var c=i*(s.x-e.x)-r*(s.y-e.y);if(0==c)return 1;c<0||(l=!l)}}else if(s.y===e.y&&(t.x<=s.x&&s.x<=e.x||e.x<=s.x&&s.x<=t.x))return 1}return l}(_.p,u[e].p)||(i!==e&&v.push({froms:i,tos:e,hole:r}),t?(t=!1,h[e].push(_)):n=!0);t&&h[i].push(_)}}0<v.length&&(n||(d=h))}for(let r=0,e=u.length;r<e;r++){o=u[r].s,l.push(o);for(let e=0,t=(m=d[r]).length;e<t;e++)o.holes.push(m[e].h)}return l}}const _floatView=new Float32Array(1),_int32View=new Int32Array(_floatView.buffer);class DataUtils{static toHalfFloat(e){65504<e&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),_floatView[0]=e;var t=_int32View[0];let r=t>>16&32768,i=t>>12&2047;e=t>>23&255;return e<103||(142<e?(r|=31744,r|=(255==e?0:1)&&8388607&t):e<113?(i|=2048,r|=(i>>114-e)+(i>>113-e&1)):(r|=e-112<<10|i>>1,r+=1&i)),r}}const LineStrip=0,LinePieces=1,NoColors=0,FaceColors=1,VertexColors=2;function MeshFaceMaterial(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function MultiMaterial(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e}function PointCloud(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(e,t)}function Particle(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(e)}function ParticleSystem(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(e,t)}function PointCloudMaterial(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleBasicMaterial(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleSystemMaterial(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function Vertex(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,r)}function DynamicBufferAttribute(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(e,t).setUsage(DynamicDrawUsage)}function Int8Attribute(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(e,t)}function Uint8Attribute(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(e,t)}function Uint8ClampedAttribute(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(e,t)}function Int16Attribute(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(e,t)}function Uint16Attribute(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(e,t)}function Int32Attribute(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(e,t)}function Uint32Attribute(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(e,t)}function Float32Attribute(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(e,t)}function Float64Attribute(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(e,t)}function AxisHelper(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(e)}function BoundingBoxHelper(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)}function EdgesHelper(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function WireframeHelper(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function XHRLoader(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(e)}function BinaryTextureLoader(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(e)}function WebGLRenderTargetCube(e,t,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(e,r)}function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Path.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Loader.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(e)},Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Box2.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box2.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box2.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box2.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},Box3.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box3.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box3.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box3.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Box3.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Sphere.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Matrix3.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix3.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Matrix3.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Matrix3.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Matrix4.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Matrix4.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix4.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},Matrix4.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Matrix4.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Matrix4.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Matrix4.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Matrix4.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Matrix4.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Matrix4.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Matrix4.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Matrix4.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Matrix4.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Matrix4.prototype.makeFrustum=function(e,t,r,i,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,n,a)},Matrix4.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Quaternion.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ray.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ray.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Ray.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Triangle.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Triangle.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Triangle.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Triangle.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Triangle.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Triangle.barycoordFromPoint=function(e,t,r,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,r,i,n)},Triangle.normal=function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,r,i)},Shape.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Shape.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},Shape.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)},Vector2.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Vector2.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector2.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector3.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Vector3.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Vector3.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Vector3.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Vector3.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Vector3.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Vector3.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Vector3.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector3.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector4.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Vector4.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Object3D.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Object3D.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Object3D.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Object3D.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Object3D.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Mesh.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}}),BufferAttribute.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?DynamicDrawUsage:StaticDrawUsage),this},BufferAttribute.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},BufferAttribute.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},BufferGeometry.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},BufferGeometry.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(t,arguments[2])))},BufferGeometry.prototype.addDrawCall=function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},BufferGeometry.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},BufferGeometry.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},BufferGeometry.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},BufferGeometry.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),InterleavedBuffer.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?DynamicDrawUsage:StaticDrawUsage),this},InterleavedBuffer.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ExtrudeGeometry.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ExtrudeGeometry.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ExtrudeGeometry.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Scene.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Uniform.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),WebGLRenderer.prototype.clearTarget=function(e,t,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,i)},WebGLRenderer.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},WebGLRenderer.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},WebGLRenderer.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},WebGLRenderer.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},WebGLRenderer.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},WebGLRenderer.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},WebGLRenderer.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},WebGLRenderer.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},WebGLRenderer.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},WebGLRenderer.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},WebGLRenderer.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},WebGLRenderer.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},WebGLRenderer.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},WebGLRenderer.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},WebGLRenderer.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},WebGLRenderer.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},WebGLRenderer.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},WebGLRenderer.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},WebGLRenderer.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},WebGLRenderer.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},WebGLRenderer.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},WebGLRenderer.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},WebGLRenderer.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},WebGLRenderer.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?sRGBEncoding:LinearEncoding}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Audio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this,r=new AudioLoader;return r.load(e,function(e){t.setBuffer(e)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},CubeCamera.prototype.clear=function(e,t,r,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,r,i)},ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const n=new TextureLoader;n.setCrossOrigin(this.crossOrigin);const a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a},ImageUtils.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const n=new CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);const a=n.load(e,r,void 0,i);return t&&(a.mapping=t),a},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function ParametricGeometry(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new BufferGeometry}function TextGeometry(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new BufferGeometry}function FontLoader(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function Font(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function ImmediateRenderObject(){console.error("THREE.ImmediateRenderObject has been removed.")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);var three=Object.freeze({__proto__:null,ACESFilmicToneMapping:ACESFilmicToneMapping,AddEquation:AddEquation,AddOperation:AddOperation,AdditiveAnimationBlendMode:AdditiveAnimationBlendMode,AdditiveBlending:AdditiveBlending,AlphaFormat:AlphaFormat,AlwaysDepth:AlwaysDepth,AlwaysStencilFunc:AlwaysStencilFunc,AmbientLight:AmbientLight,AmbientLightProbe:AmbientLightProbe,AnimationClip:AnimationClip,AnimationLoader:AnimationLoader,AnimationMixer:AnimationMixer,AnimationObjectGroup:AnimationObjectGroup,AnimationUtils:AnimationUtils,ArcCurve:ArcCurve,ArrayCamera:ArrayCamera,ArrowHelper:ArrowHelper,Audio:Audio,AudioAnalyser:AudioAnalyser,AudioContext:AudioContext,AudioListener:AudioListener,AudioLoader:AudioLoader,AxesHelper:AxesHelper,AxisHelper:AxisHelper,BackSide:BackSide,BasicDepthPacking:BasicDepthPacking,BasicShadowMap:BasicShadowMap,BinaryTextureLoader:BinaryTextureLoader,Bone:Bone,BooleanKeyframeTrack:BooleanKeyframeTrack,BoundingBoxHelper:BoundingBoxHelper,Box2:Box2,Box3:Box3,Box3Helper:Box3Helper,BoxBufferGeometry:BoxGeometry,BoxGeometry:BoxGeometry,BoxHelper:BoxHelper,BufferAttribute:BufferAttribute,BufferGeometry:BufferGeometry,BufferGeometryLoader:BufferGeometryLoader,ByteType:ByteType,Cache:Cache,Camera:Camera,CameraHelper:CameraHelper,CanvasRenderer:CanvasRenderer,CanvasTexture:CanvasTexture,CatmullRomCurve3:CatmullRomCurve3,CineonToneMapping:CineonToneMapping,CircleBufferGeometry:CircleGeometry,CircleGeometry:CircleGeometry,ClampToEdgeWrapping:ClampToEdgeWrapping,Clock:Clock,Color:Color,ColorKeyframeTrack:ColorKeyframeTrack,CompressedTexture:CompressedTexture,CompressedTextureLoader:CompressedTextureLoader,ConeBufferGeometry:ConeGeometry,ConeGeometry:ConeGeometry,CubeCamera:CubeCamera,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,CubeTexture:CubeTexture,CubeTextureLoader:CubeTextureLoader,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,CubicInterpolant:CubicInterpolant,CullFaceBack:CullFaceBack,CullFaceFront:CullFaceFront,CullFaceFrontBack:CullFaceFrontBack,CullFaceNone:CullFaceNone,Curve:Curve,CurvePath:CurvePath,CustomBlending:CustomBlending,CustomToneMapping:CustomToneMapping,CylinderBufferGeometry:CylinderGeometry,CylinderGeometry:CylinderGeometry,Cylindrical:Cylindrical,DataTexture:DataTexture,DataTexture2DArray:DataTexture2DArray,DataTexture3D:DataTexture3D,DataTextureLoader:DataTextureLoader,DataUtils:DataUtils,DecrementStencilOp:DecrementStencilOp,DecrementWrapStencilOp:DecrementWrapStencilOp,DefaultLoadingManager:DefaultLoadingManager,DepthFormat:DepthFormat,DepthStencilFormat:DepthStencilFormat,DepthTexture:DepthTexture,DirectionalLight:DirectionalLight,DirectionalLightHelper:DirectionalLightHelper,DiscreteInterpolant:DiscreteInterpolant,DodecahedronBufferGeometry:DodecahedronGeometry,DodecahedronGeometry:DodecahedronGeometry,DoubleSide:DoubleSide,DstAlphaFactor:DstAlphaFactor,DstColorFactor:DstColorFactor,DynamicBufferAttribute:DynamicBufferAttribute,DynamicCopyUsage:DynamicCopyUsage,DynamicDrawUsage:DynamicDrawUsage,DynamicReadUsage:DynamicReadUsage,EdgesGeometry:EdgesGeometry,EdgesHelper:EdgesHelper,EllipseCurve:EllipseCurve,EqualDepth:EqualDepth,EqualStencilFunc:EqualStencilFunc,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,Euler:Euler,EventDispatcher:EventDispatcher,ExtrudeBufferGeometry:ExtrudeGeometry,ExtrudeGeometry:ExtrudeGeometry,FaceColors:FaceColors,FileLoader:FileLoader,FlatShading:FlatShading,Float16BufferAttribute:Float16BufferAttribute,Float32Attribute:Float32Attribute,Float32BufferAttribute:Float32BufferAttribute,Float64Attribute:Float64Attribute,Float64BufferAttribute:Float64BufferAttribute,FloatType:FloatType,Fog:Fog,FogExp2:FogExp2,Font:Font,FontLoader:FontLoader,FrontSide:FrontSide,Frustum:Frustum,GLBufferAttribute:GLBufferAttribute,GLSL1:GLSL1,GLSL3:GLSL3,GammaEncoding:GammaEncoding,GreaterDepth:GreaterDepth,GreaterEqualDepth:GreaterEqualDepth,GreaterEqualStencilFunc:GreaterEqualStencilFunc,GreaterStencilFunc:GreaterStencilFunc,GridHelper:GridHelper,Group:Group,HalfFloatType:HalfFloatType,HemisphereLight:HemisphereLight,HemisphereLightHelper:HemisphereLightHelper,HemisphereLightProbe:HemisphereLightProbe,IcosahedronBufferGeometry:IcosahedronGeometry,IcosahedronGeometry:IcosahedronGeometry,ImageBitmapLoader:ImageBitmapLoader,ImageLoader:ImageLoader,ImageUtils:ImageUtils,ImmediateRenderObject:ImmediateRenderObject,IncrementStencilOp:IncrementStencilOp,IncrementWrapStencilOp:IncrementWrapStencilOp,InstancedBufferAttribute:InstancedBufferAttribute,InstancedBufferGeometry:InstancedBufferGeometry,InstancedInterleavedBuffer:InstancedInterleavedBuffer,InstancedMesh:InstancedMesh,Int16Attribute:Int16Attribute,Int16BufferAttribute:Int16BufferAttribute,Int32Attribute:Int32Attribute,Int32BufferAttribute:Int32BufferAttribute,Int8Attribute:Int8Attribute,Int8BufferAttribute:Int8BufferAttribute,IntType:IntType,InterleavedBuffer:InterleavedBuffer,InterleavedBufferAttribute:InterleavedBufferAttribute,Interpolant:Interpolant,InterpolateDiscrete:InterpolateDiscrete,InterpolateLinear:InterpolateLinear,InterpolateSmooth:InterpolateSmooth,InvertStencilOp:InvertStencilOp,JSONLoader:JSONLoader,KeepStencilOp:KeepStencilOp,KeyframeTrack:KeyframeTrack,LOD:LOD,LatheBufferGeometry:LatheGeometry,LatheGeometry:LatheGeometry,Layers:Layers,LensFlare:LensFlare,LessDepth:LessDepth,LessEqualDepth:LessEqualDepth,LessEqualStencilFunc:LessEqualStencilFunc,LessStencilFunc:LessStencilFunc,Light:Light,LightProbe:LightProbe,Line:Line,Line3:Line3,LineBasicMaterial:LineBasicMaterial,LineCurve:LineCurve,LineCurve3:LineCurve3,LineDashedMaterial:LineDashedMaterial,LineLoop:LineLoop,LinePieces:LinePieces,LineSegments:LineSegments,LineStrip:LineStrip,LinearEncoding:LinearEncoding,LinearFilter:LinearFilter,LinearInterpolant:LinearInterpolant,LinearMipMapLinearFilter:LinearMipMapLinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearToneMapping:LinearToneMapping,Loader:Loader,LoaderUtils:LoaderUtils,LoadingManager:LoadingManager,LogLuvEncoding:LogLuvEncoding,LoopOnce:LoopOnce,LoopPingPong:LoopPingPong,LoopRepeat:LoopRepeat,LuminanceAlphaFormat:LuminanceAlphaFormat,LuminanceFormat:LuminanceFormat,MOUSE:MOUSE,Material:Material,MaterialLoader:MaterialLoader,Math:MathUtils,MathUtils:MathUtils,Matrix3:Matrix3,Matrix4:Matrix4,MaxEquation:MaxEquation,Mesh:Mesh,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshFaceMaterial:MeshFaceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,MinEquation:MinEquation,MirroredRepeatWrapping:MirroredRepeatWrapping,MixOperation:MixOperation,MultiMaterial:MultiMaterial,MultiplyBlending:MultiplyBlending,MultiplyOperation:MultiplyOperation,NearestFilter:NearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NeverDepth:NeverDepth,NeverStencilFunc:NeverStencilFunc,NoBlending:NoBlending,NoColors:NoColors,NoToneMapping:NoToneMapping,NormalAnimationBlendMode:NormalAnimationBlendMode,NormalBlending:NormalBlending,NotEqualDepth:NotEqualDepth,NotEqualStencilFunc:NotEqualStencilFunc,NumberKeyframeTrack:NumberKeyframeTrack,Object3D:Object3D,ObjectLoader:ObjectLoader,ObjectSpaceNormalMap:ObjectSpaceNormalMap,OctahedronBufferGeometry:OctahedronGeometry,OctahedronGeometry:OctahedronGeometry,OneFactor:OneFactor,OneMinusDstAlphaFactor:OneMinusDstAlphaFactor,OneMinusDstColorFactor:OneMinusDstColorFactor,OneMinusSrcAlphaFactor:OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:OneMinusSrcColorFactor,OrthographicCamera:OrthographicCamera,PCFShadowMap:PCFShadowMap,PCFSoftShadowMap:PCFSoftShadowMap,PMREMGenerator:PMREMGenerator,ParametricGeometry:ParametricGeometry,Particle:Particle,ParticleBasicMaterial:ParticleBasicMaterial,ParticleSystem:ParticleSystem,ParticleSystemMaterial:ParticleSystemMaterial,Path:Path,PerspectiveCamera:PerspectiveCamera,Plane:Plane,PlaneBufferGeometry:PlaneGeometry,PlaneGeometry:PlaneGeometry,PlaneHelper:PlaneHelper,PointCloud:PointCloud,PointCloudMaterial:PointCloudMaterial,PointLight:PointLight,PointLightHelper:PointLightHelper,Points:Points,PointsMaterial:PointsMaterial,PolarGridHelper:PolarGridHelper,PolyhedronBufferGeometry:PolyhedronGeometry,PolyhedronGeometry:PolyhedronGeometry,PositionalAudio:PositionalAudio,PropertyBinding:PropertyBinding,PropertyMixer:PropertyMixer,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,Quaternion:Quaternion,QuaternionKeyframeTrack:QuaternionKeyframeTrack,QuaternionLinearInterpolant:QuaternionLinearInterpolant,REVISION:REVISION,RGBADepthPacking:RGBADepthPacking,RGBAFormat:RGBAFormat,RGBAIntegerFormat:RGBAIntegerFormat,RGBA_ASTC_10x10_Format:RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:RGBA_ASTC_8x8_Format,RGBA_BPTC_Format:RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format:RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format,RGBDEncoding:RGBDEncoding,RGBEEncoding:RGBEEncoding,RGBEFormat:RGBEFormat,RGBFormat:RGBFormat,RGBIntegerFormat:RGBIntegerFormat,RGBM16Encoding:RGBM16Encoding,RGBM7Encoding:RGBM7Encoding,RGB_ETC1_Format:RGB_ETC1_Format,RGB_ETC2_Format:RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:RGB_S3TC_DXT1_Format,RGFormat:RGFormat,RGIntegerFormat:RGIntegerFormat,RawShaderMaterial:RawShaderMaterial,Ray:Ray,Raycaster:Raycaster,RectAreaLight:RectAreaLight,RedFormat:RedFormat,RedIntegerFormat:RedIntegerFormat,ReinhardToneMapping:ReinhardToneMapping,RepeatWrapping:RepeatWrapping,ReplaceStencilOp:ReplaceStencilOp,ReverseSubtractEquation:ReverseSubtractEquation,RingBufferGeometry:RingGeometry,RingGeometry:RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format:SRGB8_ALPHA8_ASTC_10x10_Format,SRGB8_ALPHA8_ASTC_10x5_Format:SRGB8_ALPHA8_ASTC_10x5_Format,SRGB8_ALPHA8_ASTC_10x6_Format:SRGB8_ALPHA8_ASTC_10x6_Format,SRGB8_ALPHA8_ASTC_10x8_Format:SRGB8_ALPHA8_ASTC_10x8_Format,SRGB8_ALPHA8_ASTC_12x10_Format:SRGB8_ALPHA8_ASTC_12x10_Format,SRGB8_ALPHA8_ASTC_12x12_Format:SRGB8_ALPHA8_ASTC_12x12_Format,SRGB8_ALPHA8_ASTC_4x4_Format:SRGB8_ALPHA8_ASTC_4x4_Format,SRGB8_ALPHA8_ASTC_5x4_Format:SRGB8_ALPHA8_ASTC_5x4_Format,SRGB8_ALPHA8_ASTC_5x5_Format:SRGB8_ALPHA8_ASTC_5x5_Format,SRGB8_ALPHA8_ASTC_6x5_Format:SRGB8_ALPHA8_ASTC_6x5_Format,SRGB8_ALPHA8_ASTC_6x6_Format:SRGB8_ALPHA8_ASTC_6x6_Format,SRGB8_ALPHA8_ASTC_8x5_Format:SRGB8_ALPHA8_ASTC_8x5_Format,SRGB8_ALPHA8_ASTC_8x6_Format:SRGB8_ALPHA8_ASTC_8x6_Format,SRGB8_ALPHA8_ASTC_8x8_Format:SRGB8_ALPHA8_ASTC_8x8_Format,Scene:Scene,SceneUtils:SceneUtils,ShaderChunk:ShaderChunk,ShaderLib:ShaderLib,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,Shape:Shape,ShapeBufferGeometry:ShapeGeometry,ShapeGeometry:ShapeGeometry,ShapePath:ShapePath,ShapeUtils:ShapeUtils,ShortType:ShortType,Skeleton:Skeleton,SkeletonHelper:SkeletonHelper,SkinnedMesh:SkinnedMesh,SmoothShading:SmoothShading,Sphere:Sphere,SphereBufferGeometry:SphereGeometry,SphereGeometry:SphereGeometry,Spherical:Spherical,SphericalHarmonics3:SphericalHarmonics3,SplineCurve:SplineCurve,SpotLight:SpotLight,SpotLightHelper:SpotLightHelper,Sprite:Sprite,SpriteMaterial:SpriteMaterial,SrcAlphaFactor:SrcAlphaFactor,SrcAlphaSaturateFactor:SrcAlphaSaturateFactor,SrcColorFactor:SrcColorFactor,StaticCopyUsage:StaticCopyUsage,StaticDrawUsage:StaticDrawUsage,StaticReadUsage:StaticReadUsage,StereoCamera:StereoCamera,StreamCopyUsage:StreamCopyUsage,StreamDrawUsage:StreamDrawUsage,StreamReadUsage:StreamReadUsage,StringKeyframeTrack:StringKeyframeTrack,SubtractEquation:SubtractEquation,SubtractiveBlending:SubtractiveBlending,TOUCH:TOUCH,TangentSpaceNormalMap:TangentSpaceNormalMap,TetrahedronBufferGeometry:TetrahedronGeometry,TetrahedronGeometry:TetrahedronGeometry,TextGeometry:TextGeometry,Texture:Texture,TextureLoader:TextureLoader,TorusBufferGeometry:TorusGeometry,TorusGeometry:TorusGeometry,TorusKnotBufferGeometry:TorusKnotGeometry,TorusKnotGeometry:TorusKnotGeometry,Triangle:Triangle,TriangleFanDrawMode:TriangleFanDrawMode,TriangleStripDrawMode:TriangleStripDrawMode,TrianglesDrawMode:TrianglesDrawMode,TubeBufferGeometry:TubeGeometry,TubeGeometry:TubeGeometry,UVMapping:UVMapping,Uint16Attribute:Uint16Attribute,Uint16BufferAttribute:Uint16BufferAttribute,Uint32Attribute:Uint32Attribute,Uint32BufferAttribute:Uint32BufferAttribute,Uint8Attribute:Uint8Attribute,Uint8BufferAttribute:Uint8BufferAttribute,Uint8ClampedAttribute:Uint8ClampedAttribute,Uint8ClampedBufferAttribute:Uint8ClampedBufferAttribute,Uniform:Uniform,UniformsLib:UniformsLib,UniformsUtils:UniformsUtils,UnsignedByteType:UnsignedByteType,UnsignedInt248Type:UnsignedInt248Type,UnsignedIntType:UnsignedIntType,UnsignedShort4444Type:UnsignedShort4444Type,UnsignedShort5551Type:UnsignedShort5551Type,UnsignedShort565Type:UnsignedShort565Type,UnsignedShortType:UnsignedShortType,VSMShadowMap:VSMShadowMap,Vector2:Vector2,Vector3:Vector3,Vector4:Vector4,VectorKeyframeTrack:VectorKeyframeTrack,Vertex:Vertex,VertexColors:VertexColors,VideoTexture:VideoTexture,WebGL1Renderer:WebGL1Renderer,WebGLCubeRenderTarget:WebGLCubeRenderTarget,WebGLMultipleRenderTargets:WebGLMultipleRenderTargets,WebGLMultisampleRenderTarget:WebGLMultisampleRenderTarget,WebGLRenderTarget:WebGLRenderTarget,WebGLRenderTargetCube:WebGLRenderTargetCube,WebGLRenderer:WebGLRenderer,WebGLUtils:WebGLUtils,WireframeGeometry:WireframeGeometry,WireframeHelper:WireframeHelper,WrapAroundEnding:WrapAroundEnding,XHRLoader:XHRLoader,ZeroCurvatureEnding:ZeroCurvatureEnding,ZeroFactor:ZeroFactor,ZeroSlopeEnding:ZeroSlopeEnding,ZeroStencilOp:ZeroStencilOp,sRGBEncoding:sRGBEncoding});const SQRT3=Math.sqrt(3);class ThreeLayer{constructor(e){this.implementation=e,this._tick=this._tick.bind(this),this._onResize=this._onResize.bind(this)}onAdd(r,e){const i=this,n=i["implementation"],{id:t,minzoom:a,maxzoom:s}=n;i.map=r,i.modelOrigin=r.getModelOrigin(),r.map.addLayer({id:t,type:"custom",renderingMode:"3d",onAdd:(e,t)=>{i._onAdd(e,t),n.onAdd&&n.onAdd(r,{renderer:i.renderer,scene:i.scene,camera:i.camera})},onRemove:(e,t)=>{i._onRemove(e,t),n.onRemove&&n.onRemove(r,{renderer:i.renderer,scene:i.scene,camera:i.camera})},render:i._render.bind(i)},e||"poi"),r.map.setLayerZoomRange(t,a,s)}_onAdd(e,t){const r=this,{_fov:i,width:n,height:a}=e.transform,s=r.renderer=new WebGLRenderer({canvas:e.getCanvas(),context:t}),o=r.scene=new Scene,l=valueOrDefault(r.implementation.lightColor,(new Color).copy(r.map.getLightColor())),c=r.light=new DirectionalLight(l,.8),h=r.ambientLight=new AmbientLight(l,.4);s.autoClear=!1,o.add(c),o.add(h),o.add(new Mesh),r.mbox=e,r.camera=new PerspectiveCamera(MathUtils.radToDeg(i),n/a),e.on("resize",r._onResize),void 0===r.implementation.lightColor&&r._tick()}_tick(){const{map:e,mbox:t,light:r,ambientLight:i,lastRefresh:n,_tick:a}=this,s=e.clock.getTime();var o;Math.floor(s/6e4)!==Math.floor(n/6e4)&&(o=e.getLightColor(),r.color.copy(o),i.color.copy(o),this.lastRefresh=s),t&&requestAnimationFrame(a)}_onRemove(e){e.off("resize",this._onResize),delete this.mbox}_render(e,t){const{modelOrigin:r,mbox:i,renderer:n,camera:a,light:s,scene:o}=this,{_fov:l,_camera:c,_horizonShift:h,worldSize:u,fovAboveCenter:d,_pitch:p,width:f,height:m}=i.transform,g=l/2,_=Math.PI/2-p,v=c.position[2]*u/Math.cos(p),y=Math.sin(d)*v/Math.sin(clamp$2(_-d,.01,Math.PI-.01)),x=Math.cos(_)*y+v,b=v/h,w=a.far=Math.min(2*x,b),T=a.near=m/50,E=Math.tan(g)*T,S=E*f/m,M=(new Matrix4).fromArray(t),A=(new Matrix4).makeTranslation(r.x,r.y,0).scale(new Vector3(1,-1,1));a.projectionMatrix.makePerspective(-S,S,E,-E,T,w).clone().invert().multiply(M).multiply(A).invert().decompose(a.position,a.quaternion,a.scale);t=MathUtils.degToRad(i.getBearing()+30);s.position.set(-Math.sin(t),-Math.cos(t),SQRT3).normalize(),n.resetState(),n.render(o,a)}_onResize(e){const t=this["camera"],{width:r,height:i}=e.target.transform;t.aspect=r/i,t.updateProjectionMatrix()}}class InstancedGeometry extends InstancedBufferGeometry{constructor(e,t,r,i){super();var n=this;n.instanceCount=0;for(const c of Object.keys(e.attributes))n.attributes[c]=e.attributes[c].clone();e.index&&(n.index=e.index.clone());const a=new Uint8Array(3*t),s=new InstancedBufferAttribute(a,3,!0);for(let e=0;e<t;e++)a.set([255&r,e>>8&255,255&e],3*e);n.setAttribute("idColor",s),n.userData.attributes={},n.userData.buffers=[];const o={};for(const h of Object.keys(i)){var l=i[h];if(l instanceof InterleavedBufferAttribute)n.setAttribute(h,l);else{const{type:u,itemSize:d,normalized:p}=i[h],f=o[u]=o[u]||{type:u,size:0,keys:[]};n.userData.attributes[h]={itemSize:d,offset:f.size,normalized:p},f.size+=d,f.keys.push(h)}}for(const m of Object.keys(o)){const{type:g,size:_,keys:v}=o[m],y=new g(t*_),x=new InstancedInterleavedBuffer(y,_).setUsage(DynamicDrawUsage);for(const b of v){const w=n.userData.attributes[b],{itemSize:T,offset:E,normalized:S}=w;n.setAttribute(b,new InterleavedBufferAttribute(x,T,E,S)),w.buffer=x}n.userData.buffers.push(x)}}addInstance(e={}){this.setInstanceAttributes(this.instanceCount++,e)}removeInstance(e){var t=this.instanceCount;for(const i of this.userData.buffers){var r=i.stride;i.set(i.array.subarray((e+1)*r,t*r),e*r),i.needsUpdate=!0}this.instanceCount--}setInstanceAttributes(e,t){for(const r of Object.keys(t)){const{offset:i,buffer:n}=this.userData.attributes[r],a=e*n.stride+i;isNaN(t[r])?n.set(t[r],a):n.array[a]=t[r],n.needsUpdate=!0}}getInstanceAttributes(e){const t={};for(const r of Object.keys(this.userData.attributes)){const{itemSize:i,offset:n,buffer:a}=this.userData.attributes[r],s=e*a.stride+n;t[r]=1<i?a.array.subarray(s,s+i):a.array[s]}return t}}function mergeBufferGeometries(r,i=!1){var n=null!==r[0].index;const a=new Set(Object.keys(r[0].attributes)),s=new Set(Object.keys(r[0].morphAttributes)),o={},l={};var c=r[0].morphTargetsRelative;const h=new BufferGeometry;let u=0;for(let t=0;t<r.length;++t){var d=r[t];let e=0;if(n!=(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const m in d.attributes){if(!a.has(m))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+'. All geometries must have compatible attributes; make sure "'+m+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[m]&&(o[m]=[]),o[m].push(d.attributes[m]),e++}if(e!==a.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". Make sure all geometries have the same number of attributes."),null;if(c!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const g in d.morphAttributes){if(!s.has(g))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===l[g]&&(l[g]=[]),l[g].push(d.morphAttributes[g])}if(h.userData.mergedUserData=h.userData.mergedUserData||[],h.userData.mergedUserData.push(d.userData),i){let e;if(n)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}h.addGroup(u,e,t),u+=e}}if(n){let t=0;const _=[];for(let e=0;e<r.length;++e){const v=r[e].index;for(let e=0;e<v.count;++e)_.push(v.getX(e)+t);t+=r[e].attributes.position.count}h.setIndex(_)}for(const t in o){var e=mergeBufferAttributes(o[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" attribute."),null;h.setAttribute(t,e)}for(const y in l){var p=l[y][0].length;if(0===p)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[y]=[];for(let t=0;t<p;++t){const x=[];for(let e=0;e<l[y].length;++e)x.push(l[y][e][t]);var f=mergeBufferAttributes(x);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+y+" morphAttribute."),null;h.morphAttributes[y].push(f)}}return h}function mergeBufferAttributes(t){let r,i,n,a=0;for(let e=0;e<t.length;++e){var s=t[e];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===r&&(r=s.array.constructor),r!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=s.itemSize),i!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=s.normalized),n!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=s.array.length}const o=new r(a);let l=0;for(let e=0;e<t.length;++e)o.set(t[e].array,l),l+=t[e].array.length;return new BufferAttribute(o,i,n)}const groupIndices$1=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]),glslRotateFunctions$1=`
    mat3 rotateX( float angle ) {
        float s = sin( angle );
        float c = cos( angle );

        return mat3(
            1.0, 0.0, 0.0,
            0.0, c, s,
            0.0, -s, c
        );
    }

    mat3 rotateZ( float angle ) {
        float s = sin( angle );
        float c = cos( angle );

        return mat3(
            c, s, 0.0,
            -s, c, 0.0,
            0.0, 0.0, 1.0
        );
    }
`,glslTransformVariables$1=`
    uniform float scale;
    attribute float groupIndex;
    attribute vec3 translation;
    attribute float rotationX;
    attribute float rotationZ;
    attribute float scale0;
    attribute vec3 idColor;
`,glslTransform$1=e=>`
    float offsetY = groupIndex == 2.0 ? 0.44 - 1.32 * max( scale / scale0, 1.0 ) : 0.0;
    float offsetZ = groupIndex == 2.0 ? 0.88 : 0.0;
    float scaleX = groupIndex == 1.0 ? max( scale0, scale ) : scale0;
    float scaleY = groupIndex == 0.0 ? max( scale0, scale ) : scale0;
    vec3 position0 = ( position + vec3( 0.0, offsetY, offsetZ ) ) * vec3( scaleX, scaleY, scale0 );
    position0 = position0 * ( 1.0 + idColor.b * 0.03 );
    ${e?"position0 = position0 + 0.1 * scale0 * sign( position );":""}
    vec3 transformed = rotateZ( rotationZ ) * rotateX( rotationX ) * position0 + translation + vec3( 0.0, 0.0, .44 * scale0 );
`;class AircraftMeshSet{constructor(e,t){const r=this,i=[new BoxGeometry(.88,2.64,.88),new BoxGeometry(2.64,.88,.1),new BoxGeometry(.1,.88,.88)],n=mergeBufferGeometries(i);n.setAttribute("groupIndex",new BufferAttribute(groupIndices$1,1)),r.geometry=new InstancedGeometry(n,e,t.index,{translation:{type:Float32Array,itemSize:3},rotationX:{type:Float32Array,itemSize:1},rotationZ:{type:Float32Array,itemSize:1},opacity0:{type:Float32Array,itemSize:1},outline:{type:Float32Array,itemSize:1},scale0:{type:Float32Array,itemSize:1},color0:{type:Uint8Array,itemSize:3,normalized:!0},color1:{type:Uint8Array,itemSize:3,normalized:!0}}),i.map(e=>e.dispose()),n.dispose(),r.uniforms={scale:{type:"f",value:t.scale}},r.material=new MeshLambertMaterial({opacity:t.opacity,transparent:!0}),r.material.onBeforeCompile=e=>{e.uniforms.scale=r.uniforms.scale,e.vertexShader=[`
                attribute vec3 color0;
                attribute vec3 color1;
                attribute float opacity0;
                varying vec3 vTriangleColor;
                varying float vInstanceOpacity;
                ${glslTransformVariables$1}

                ${glslRotateFunctions$1}

            `,e.vertexShader.replace("#include <begin_vertex>",glslTransform$1()).replace("#include <beginnormal_vertex>","vec3 objectNormal = rotateZ( rotationZ ) * rotateX( rotationX ) * vec3( normal );").replace("#include <color_vertex>",`
                #include <color_vertex>

                vTriangleColor = groupIndex < 2.0 ? color0 : color1;
                vInstanceOpacity = opacity0;
            `)].join(""),e.fragmentShader=[`
                varying vec3 vTriangleColor;
                varying float vInstanceOpacity;
            `,e.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );","vec4 diffuseColor = vec4( vTriangleColor, vInstanceOpacity * opacity );")].join("")},r.mesh=new Mesh(r.geometry,r.material),r.mesh.updateMatrix(),r.mesh.matrixAutoUpdate=!1,r.mesh.frustumCulled=!1,r.pickingMaterial=new ShaderMaterial({uniforms:{scale:r.uniforms.scale},vertexShader:`
                varying vec3 vIdColor;
                ${glslTransformVariables$1}

                ${glslRotateFunctions$1}

                void main( void ) {
                    ${glslTransform$1()}
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );
                    vIdColor = idColor;
                }
            `,fragmentShader:`
                varying vec3 vIdColor;

                void main( void ) {
                    gl_FragColor = vec4( vIdColor, 1.0 );
                }
            `}),r.pickingMesh=new Mesh(r.geometry,r.pickingMaterial),r.pickingMesh.updateMatrix(),r.pickingMesh.matrixAutoUpdate=!1,r.pickingMesh.frustumCulled=!1,r.outlineMaterial=new ShaderMaterial({uniforms:{scale:r.uniforms.scale},vertexShader:`
                attribute float outline;
                varying float vInstanceOpacity;
                ${glslTransformVariables$1}

                ${glslRotateFunctions$1}

                void main( void ) {
                    ${glslTransform$1(!0)}
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, outline > 0.0 ? 1.0 : 0.0 );
                    vInstanceOpacity = outline;
                }
            `,fragmentShader:`
                varying float vInstanceOpacity;

                void main( void ) {
                    gl_FragColor = vec4( 1.0, 1.0, 1.0, vInstanceOpacity );
                }
            `,side:BackSide,transparent:!0}),r.outlineMesh=new Mesh(r.geometry,r.outlineMaterial),r.outlineMesh.updateMatrix(),r.outlineMesh.matrixAutoUpdate=!1,r.outlineMesh.frustumCulled=!1}getMesh(){return this.mesh}getPickingMesh(){return this.pickingMesh}getOutlineMesh(){return this.outlineMesh}addInstance(e){this.geometry.addInstance(e)}removeInstance(e){this.geometry.removeInstance(e)}setInstanceAttributes(e,t){this.geometry.setInstanceAttributes(e,t)}getInstanceAttributes(e){return this.geometry.getInstanceAttributes(e)}setOpacity(e){this.material.opacity=e}getOpacity(){return this.material.opacity}dispose(){this.geometry.dispose(),this.material.dispose(),this.pickingMaterial.dispose(),this.outlineMaterial.dispose()}}const groupIndices=new Float32Array([0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,0,0,0,0,0,0,5,5,5,5,5,5,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,0,0,0,0,0,0,3,3,3,3,3,3]),glslRotateFunctions=`
    mat3 rotateX( float angle ) {
        float s = sin( angle );
        float c = cos( angle );

        return mat3(
            1.0, 0.0, 0.0,
            0.0, c, s,
            0.0, -s, c
        );
    }

    mat3 rotateZ( float angle ) {
        float s = sin( angle );
        float c = cos( angle );

        return mat3(
            c, s, 0.0,
            -s, c, 0.0,
            0.0, 0.0, 1.0
        );
    }
`,glslTransformVariables=`
    uniform float scale;
    attribute vec3 translation;
    attribute float rotationX;
    attribute float rotationZ;
    attribute vec3 idColor;
`,glslTransform=e=>`
    vec3 position0 = position * ( scale * ( 1.0 + idColor.b * 0.03 ) );
    ${e?"position0 = position0 + 0.1 * scale * sign( position );":""}
    vec3 transformed = rotateZ( rotationZ ) * rotateX( rotationX ) * position0 + translation + vec3( 0.0, 0.0, .44 * scale );
`;class CarMeshSet{constructor(e,t){const r=this,i=new BoxGeometry(.88,1.76,.88,1,1,3),n=i.toNonIndexed();n.setAttribute("groupIndex",new BufferAttribute(groupIndices,1)),r.geometry=new InstancedGeometry(n,e,t.index,{translation:{type:Float32Array,itemSize:3},rotationX:{type:Float32Array,itemSize:1},rotationZ:{type:Float32Array,itemSize:1},opacity0:{type:Float32Array,itemSize:1},delay:{type:Float32Array,itemSize:1},outline:{type:Float32Array,itemSize:1},color0:{type:Uint8Array,itemSize:3,normalized:!0},color1:{type:Uint8Array,itemSize:3,normalized:!0},color2:{type:Uint8Array,itemSize:3,normalized:!0},color3:{type:Uint8Array,itemSize:3,normalized:!0}}),i.dispose(),n.dispose(),r.uniforms={scale:{type:"f",value:t.scale},base:{type:"f",value:t.dark?0:1}},r.material=new MeshLambertMaterial({opacity:t.opacity,transparent:!0}),r.material.onBeforeCompile=e=>{e.uniforms.scale=r.uniforms.scale,e.vertexShader=[`
                attribute float groupIndex;
                attribute vec3 color0;
                attribute vec3 color1;
                attribute vec3 color2;
                attribute vec3 color3;
                attribute float opacity0;
                varying vec3 vTriangleColor;
                varying float vInstanceOpacity;
                ${glslTransformVariables}

                ${glslRotateFunctions}

            `,e.vertexShader.replace("#include <begin_vertex>",glslTransform()).replace("#include <beginnormal_vertex>","vec3 objectNormal = rotateZ( rotationZ ) * rotateX( rotationX ) * vec3( normal );").replace("#include <color_vertex>",`
                #include <color_vertex>

                float mod3 = mod( groupIndex, 3.0 );
                vec3 null = vec3( 0.0, 1.0, 0.0 );
                vTriangleColor = mod3 == 1.0 && color1 != null ? color1 : color0;
                vTriangleColor = mod3 == 2.0 && color2 != null ? color2 : vTriangleColor;
                vTriangleColor = groupIndex >= 3.0 && color3 != null ? color3 : vTriangleColor;
                vInstanceOpacity = opacity0;
            `)].join(""),e.fragmentShader=[`
                varying vec3 vTriangleColor;
                varying float vInstanceOpacity;
            `,e.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );","vec4 diffuseColor = vec4( vTriangleColor, vInstanceOpacity * opacity );")].join("")},r.mesh=new Mesh(r.geometry,r.material),r.mesh.updateMatrix(),r.mesh.matrixAutoUpdate=!1,r.mesh.frustumCulled=!1,r.pickingMaterial=new ShaderMaterial({uniforms:{scale:r.uniforms.scale},vertexShader:`
                varying vec3 vIdColor;
                ${glslTransformVariables}

                ${glslRotateFunctions}

                void main( void ) {
                    ${glslTransform()}
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 );
                    vIdColor = idColor;
                }
            `,fragmentShader:`
                varying vec3 vIdColor;

                void main( void ) {
                    gl_FragColor = vec4( vIdColor, 1.0 );
                }
            `}),r.pickingMesh=new Mesh(r.geometry,r.pickingMaterial),r.pickingMesh.updateMatrix(),r.pickingMesh.matrixAutoUpdate=!1,r.pickingMesh.frustumCulled=!1;const a=new SphereGeometry(1.8,32,32);r.delayMarkerGeometry=new InstancedGeometry(a,e,t.index,{translation:r.geometry.getAttribute("translation"),opacity0:r.geometry.getAttribute("opacity0"),delay:r.geometry.getAttribute("delay")}),a.dispose(),r.delayMarkerMaterial=new ShaderMaterial({uniforms:{scale:r.uniforms.scale,opacity:{type:"f",get value(){return r.material.opacity}},base:r.uniforms.base},vertexShader:`
                uniform float scale;
                uniform float opacity;
                attribute vec3 translation;
                attribute float opacity0;
                attribute float delay;
                varying float vIntensity;

                void main( void ) {
                    vec3 transformed = position * scale + translation + vec3( 0.0, 0.0, .44 * scale );
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, delay );
                    vec3 vNormal = normalize( normalMatrix * normal );
                    vec3 vNormel = normalize( vec3( modelViewMatrix * vec4( transformed, 1.0 ) ) );
                    vIntensity = ( 1.0 + dot( vNormal, vNormel ) ) * opacity * opacity0;
                }
            `,fragmentShader:`
                uniform float base;
                varying float vIntensity;

                void main( void ) {
                    vec3 color = mix( vec3( base ), vec3( 1.0, 0.6, 0.0 ), vIntensity );
                    gl_FragColor = vec4( color, 1.0 );
                }
            `,blending:t.dark?AdditiveBlending:MultiplyBlending,depthWrite:!1}),r.delayMarkerMesh=new Mesh(r.delayMarkerGeometry,r.delayMarkerMaterial),r.delayMarkerMesh.updateMatrix(),r.delayMarkerMesh.matrixAutoUpdate=!1,r.delayMarkerMesh.frustumCulled=!1,r.outlineMaterial=new ShaderMaterial({uniforms:{scale:r.uniforms.scale},vertexShader:`
                attribute float outline;
                varying float vInstanceOpacity;
                ${glslTransformVariables}

                ${glslRotateFunctions}

                void main( void ) {
                    ${glslTransform(!0)}
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( transformed, outline > 0.0 ? 1.0 : 0.0 );
                    vInstanceOpacity = outline;
                }
            `,fragmentShader:`
                varying float vInstanceOpacity;

                void main( void ) {
                    gl_FragColor = vec4( 1.0, 1.0, 1.0, vInstanceOpacity );
                }
            `,transparent:!0,side:BackSide}),r.outlineMesh=new Mesh(r.geometry,r.outlineMaterial),r.outlineMesh.updateMatrix(),r.outlineMesh.matrixAutoUpdate=!1,r.outlineMesh.frustumCulled=!1}getMesh(){return this.mesh}getPickingMesh(){return this.pickingMesh}getDelayMarkerMesh(){return this.delayMarkerMesh}getOutlineMesh(){return this.outlineMesh}addInstance(e){this.geometry.addInstance(e),this.delayMarkerGeometry.addInstance()}removeInstance(e){this.geometry.removeInstance(e),this.delayMarkerGeometry.removeInstance(e)}setInstanceAttributes(e,t){this.geometry.setInstanceAttributes(e,t)}getInstanceAttributes(e){return this.geometry.getInstanceAttributes(e)}setScale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setOpacity(e){this.material.opacity=e,this.delayMarkerMaterial.opacity=e}getOpacity(){return this.material.opacity}refreshDelayMarkerMesh(e){this.uniforms.base.value=e?0:1,this.delayMarkerMaterial.blending=e?AdditiveBlending:MultiplyBlending}dispose(){this.geometry.dispose(),this.material.dispose(),this.pickingMaterial.dispose(),this.delayMarkerGeometry.dispose(),this.delayMarkerMaterial.dispose(),this.outlineMaterial.dispose()}}const MAX_UG_CARS=2e3,MAX_OG_CARS=4e3,MAX_AIRCRAFTS=200;class TrafficLayer{constructor(e){this.id=e.id,this.type="three",this.lightColor="white",this.ugObjects=[],this.ogObjects=[],this.aircraftObjects=[]}onAdd(e,t){const r=this,i=(r.context=t)["scene"],n=e.getModelScale();r.map=e,r.ugCarMeshSet=new CarMeshSet(MAX_UG_CARS,{index:0,scale:100*n,opacity:.225}),r.ogCarMeshSet=new CarMeshSet(MAX_OG_CARS,{index:1,scale:100*n,opacity:.9}),r.aircraftMeshSet=new AircraftMeshSet(MAX_AIRCRAFTS,{index:2,scale:.06/.285*n*100,opacity:.9}),i.add(r.ugCarMeshSet.getMesh()),i.add(r.ogCarMeshSet.getMesh()),i.add(r.aircraftMeshSet.getMesh()),i.add(r.ugCarMeshSet.getDelayMarkerMesh()),i.add(r.ogCarMeshSet.getDelayMarkerMesh()),i.add(r.ugCarMeshSet.getOutlineMesh()),i.add(r.ogCarMeshSet.getOutlineMesh()),i.add(r.aircraftMeshSet.getOutlineMesh()),r.ugPickingScene=new Scene,r.ugPickingScene.background=new Color(16777215),r.ugPickingScene.add(r.ugCarMeshSet.getPickingMesh()),r.ogPickingScene=new Scene,r.ogPickingScene.background=new Color(16777215),r.ogPickingScene.add(r.ogCarMeshSet.getPickingMesh()),r.ogPickingScene.add(r.aircraftMeshSet.getPickingMesh()),r.pickingTexture=new WebGLRenderTarget(1,1),r.pixelBuffer=new Uint8Array(4),e.on("zoom",r.onZoom.bind(r)),e.on("pitch",r.onPitch.bind(r))}onZoom(){var e=this.map.getZoom(),e=Math.pow(2,14-clamp$2(e,13,19))*this.map.getModelScale()*100;this.ugCarMeshSet.setScale(e),this.ogCarMeshSet.setScale(e),this.onPitch()}onPitch(){for(const e of this.aircraftObjects)this.updateObject(e)}setMode(e,t){const r=this,i=r.ugCarMeshSet.getOpacity(),n=r.ogCarMeshSet.getOpacity();let a,s;"none"!==t&&"edit"!==t?a=s=.1:s="underground"===e?(a=.9,.225):(a=.225,.9),animation.start({callback:(e,t)=>{r.ugCarMeshSet.setOpacity(lerp$3(i,a,e/t)),r.ogCarMeshSet.setOpacity(lerp$3(n,s,e/t)),r.aircraftMeshSet.setOpacity(lerp$3(n,s,e/t)),r.refreshDelayMarkers(!0)},duration:configs.transitionDuration})}getAircraftScale(e){const t=this["map"],r=t.getModelPosition(e.coord,e.altitude).z,i=t.map.getFreeCameraOptions().position.z,n=t.getZoom()+Math.log2(i/Math.abs(i-r)),a=Math.pow(2,14-clamp$2(n,13,19));return a*t.getModelScale()*100}addObject(r){const e="train"===r.type?r.altitude<0?0:1:2,i=[this.ugCarMeshSet,this.ogCarMeshSet,this.aircraftMeshSet][e],t=[this.ugObjects,this.ogObjects,this.aircraftObjects][e],{x:n,y:a,z:s}=this.map.getModelPosition(r.coord,r.altitude),o=Array.isArray(r.color)?r.color:[r.color],l={translation:[n,a,s],rotationX:r.pitch,rotationZ:MathUtils.degToRad(-r.bearing),opacity0:0,outline:r.outline};"train"===r.type?(l.delay=r.delay,l.color0=colorToRGBArray(o[0]),l.color1=colorToRGBArray(o[1]||"#00ff00"),l.color2=colorToRGBArray(o[2]||"#00ff00"),l.color3=colorToRGBArray(o[3]||"#00ff00")):(l.scale0=this.getAircraftScale(r),l.color0=colorToRGBArray(o[0]),l.color1=colorToRGBArray(o[1])),i.addInstance(l),r.meshIndex=e,r.instanceIndex=t.length,t.push(r),r.animationID=animation.start({callback:(e,t)=>{i.setInstanceAttributes(r.instanceIndex,{opacity0:e/t})},complete:()=>{delete r.animationID},duration:configs.fadeDuration})}updateObject(r){if(r&&void 0!==r.instanceIndex){const e=this,t=r.meshIndex,i=[e.ugCarMeshSet,e.ogCarMeshSet,e.aircraftMeshSet][t],n=[e.ugObjects,e.ogObjects,e.aircraftObjects][t],a=r.instanceIndex,{x:s,y:o,z:l}=e.map.getModelPosition(r.coord,r.altitude),c={translation:[s,o,l],rotationX:r.pitch,rotationZ:MathUtils.degToRad(-r.bearing),outline:r.outline},h=r.altitude<0?0:1;if("train"===r.type?c.delay=r.delay:c.scale0=e.getAircraftScale(r),i.setInstanceAttributes(a,c),"train"===r.type&&h!==t){const u=[e.ugCarMeshSet,e.ogCarMeshSet,e.aircraftMeshSet][h],d=[e.ugObjects,e.ogObjects,e.aircraftObjects][h],p=i.getInstanceAttributes(a).opacity0*i.getOpacity();r.animationID&&animation.stop(r.animationID),u.addInstance(i.getInstanceAttributes(a)),r.meshIndex=h,r.instanceIndex=d.length,d.push(r),i.removeInstance(a),n.splice(a,1);for(let e=a;e<n.length;e++)n[e].instanceIndex--;u.setInstanceAttributes(r.instanceIndex,{opacity0:p/u.getOpacity()}),r.animationID=animation.start({callback:(e,t)=>{u.setInstanceAttributes(r.instanceIndex,{opacity0:lerp$3(p/u.getOpacity(),1,e/t)})},complete:()=>{delete r.animationID},duration:configs.fadeDuration})}}}removeObject(r){if(r&&void 0!==r.instanceIndex){const e=r.meshIndex,i=[this.ugCarMeshSet,this.ogCarMeshSet,this.aircraftMeshSet][e],n=[this.ugObjects,this.ogObjects,this.aircraftObjects][e];r.animationID&&animation.stop(r.animationID),r.animationID=animation.start({callback:(e,t)=>{i.setInstanceAttributes(r.instanceIndex,{opacity0:1-e/t})},complete:()=>{var t=r.instanceIndex;i.removeInstance(t),delete r.meshIndex,delete r.instanceIndex,delete r.animationID,n.splice(t,1);for(let e=t;e<n.length;e++)n[e].instanceIndex--},duration:configs.fadeDuration})}}pickObject(e,t){const{context:r,pickingTexture:i,pixelBuffer:n}=this,{renderer:a,camera:s}=r,{drawingBufferWidth:o,drawingBufferHeight:l}=a.getContext(),c=window.devicePixelRatio,h="underground"===e?this.ugPickingScene:this.ogPickingScene;s.setViewOffset(o,l,t.x*c|0,t.y*c|0,1,1),a.setRenderTarget(i),a.render(h,s),a.setRenderTarget(null),a.resetState(),s.clearViewOffset(),a.readRenderTargetPixels(i,0,0,1,1,n);e=n[0],t=n[1]<<8|n[2],e=[this.ugObjects,this.ogObjects,this.aircraftObjects][e];if(e)return e[t]}refreshDelayMarkers(e){e=hasDarkBackground(this.map.map,e);this.ugCarMeshSet.refreshDelayMarkerMesh(e),this.ogCarMeshSet.refreshDelayMarkerMesh(e)}project(e,t){const{map:r,context:i}=this,{width:n,height:a}=r.map.transform,{x:s,y:o,z:l}=r.getModelPosition(e,t),{x:c,y:h}=new Vector3(s,o,l).project(i.camera);return new mapboxGl$1.exports.Point((c+1)/2*n,(1-h)/2*a)}}class TrainPanel extends Panel{constructor(e){super(Object.assign({className:"train-panel"},e))}addTo(i){const n=this,{lang:t,dict:e,clock:a}=i,r=[],s=[],o=[],l=[],c=n._options.object,{r:h,nm:u,v:d,ds:p,nextTrains:f}=c,m=i.railwayLookup[h],g=(d?i.trainVehicleLookup[d]:m).color,_=c.delay||0;let v,y;for(let e=c;e;e=e.previousTrains&&e.previousTrains[0])r.unshift(e);for(let e=f&&f[0];e;e=e.nextTrains&&e.nextTrains[0])r.push(e);r.forEach(r=>{const e={};e.start=Math.max(o.length-1,0),r.tt.forEach((e,t)=>{(0<t||!r.previousTrains)&&o.push(['<div class="station-row">',`<div class="station-title-box">${i.getLocalizedStationTitle(e.s)}</div>`,'<div class="station-time-box',6e4<=_?" desc-caution":"",'">',e.a?a.getTimeString(a.getTime(e.a)+_):"",e.a&&e.d?"<br>":"",e.d?a.getTimeString(a.getTime(e.d)+_):"","</div></div>"].join(""))}),e.end=o.length-1,e.color=i.railwayLookup[r.r].color,s.push(e),r===c&&(v=e)}),super.addTo(i).setTitle(['<div class="desc-header">',Array.isArray(g)?["<div>",...g.slice(0,3).map(e=>`<div class="line-strip-long" style="background-color: ${e};"></div>`),"</div>"].join(""):`<div style="background-color: ${g};"></div>`,"<div>",u?u.map(e=>e[t]||e.en).join(e.and):i.getLocalizedRailwayTitle(h),'<br><span class="desc-normal-style">',`<span class="train-type-label">${i.getLocalizedTrainTypeTitle(c.y)}</span> `,p?e.for.replace("$1",i.getLocalizedStationTitle(p)):i.getLocalizedRailDirectionTitle(c.d),"</span></div></div>"].join("")).setHTML(['<div id="timetable-content">',...o,"</div>",'<svg id="railway-mark"></svg>','<svg id="train-mark"></svg>'].join(""));const x=n._container,b=x.querySelector("#panel-body"),w=x.querySelector("#timetable-content")["children"];for(let e=0,t=w.length;e<t;e++){const S=w[e];l.push(S.offsetTop+S.getBoundingClientRect().height/2)}x.querySelector("#railway-mark").innerHTML=s.map(({color:e,start:t,end:r})=>`<line stroke="${e}" stroke-width="10" x1="12" y1="${l[t]}" x2="12" y2="${l[r]}" stroke-linecap="round" />`).concat(l.map(e=>`<circle cx="12" cy="${e}" r="3" fill="#ffffff" />`)).join("");const T=l.slice(v.start,v.end+1),E=()=>{var e=b.getBoundingClientRect()["height"],t=c["timetableIndex"],r=T[t],t=lerp$3(r,c.arrivalStation?T[t+1]:r,c._t),r=performance.now()%1500/1500;x.querySelector("#train-mark").innerHTML=`<circle cx="22" cy="${t+10}" r="${7+15*r}" fill="#ffffff" opacity="${1-r}" />`+`<circle cx="22" cy="${t+10}" r="7" fill="#ffffff" />`,void 0!==y&&y!==b.scrollTop||(b.scrollTop=Math.round(t-e/2+4),y=b.scrollTop),n._container&&requestAnimationFrame(E)};return E(),n}}const OPERATORS_FOR_DYNAMIC_TRAIN_DATA=["JR-East","TokyoMetro","Toei"],RAILWAY_NAMBOKU="TokyoMetro.Namboku",RAILWAY_MITA="Toei.Mita",RAILWAY_ARAKAWA="Toei.Arakawa",AIRLINES_FOR_ANA_CODE_SHARE=["ADO","SFJ","SNJ"],DEGREE_TO_RADIAN=Math.PI/180,render=MapboxLayer.prototype.render;MapboxLayer.prototype.render=function(...e){const{deck:t,map:r}=this;t.layerManager&&(t.props.userData.currentViewport||(t.props.userData.currentViewport=getViewport(t,r)),render.apply(this,e))};const modelOrigin=mapboxGl$1.exports.MercatorCoordinate.fromLngLat(configs.defaultCenter),modelScale=modelOrigin.meterInMercatorCoordinateUnits();class map extends mapboxGl$1.exports.Evented{constructor(e){super();const t=this;e=extend$3({hash:!1,center:configs.defaultCenter,zoom:configs.defaultZoom,bearing:configs.defaultBearing,pitch:configs.defaultPitch,dataUrl:configs.dataUrl,clockControl:!0,searchControl:!0,navigationControl:!0,fullscreenControl:!0,modeControl:!0,configControl:!0,trackingMode:configs.defaultTrackingMode,ecoMode:configs.defaultEcoMode,ecoFrameRate:configs.defaultEcoFrameRate},e),t.lang=getLang(e.lang),t.dataUrl=e.dataUrl,t.container="string"==typeof e.container?document.getElementById(e.container):e.container,t.secrets=e.secrets,t.exitPopups=[],t.clockControl=e.clockControl,t.searchControl=e.searchControl,t.navigationControl=e.navigationControl,t.fullscreenControl=e.fullscreenControl,t.modeControl=e.modeControl,t.configControl=e.configControl,t.clock=new Clock$1,t.plugins=(e.plugins||[]).map(e=>new Plugin(e)),t.searchMode="none",t.viewMode=configs.defaultViewMode,t.trackingMode=e.trackingMode,t.initialSelection=e.selection,t.clockMode=configs.defaultClockMode,t.isEditingTime=!1,t.ecoMode=e.ecoMode,t.ecoFrameRate=e.ecoFrameRate,t.lastDynamicUpdate={},t.lastRepaint=0,t.container.addEventListener("touchstart",()=>{t.touchDevice=!0}),e.container=initContainer(t.container),e.style=`${e.dataUrl}/osm-liberty.json`,e.configControl||(e.customAttribution=flat$1([e.customAttribution,configs.customAttribution])),t.map=new mapboxGl$1.exports.Map(e),configs.events.forEach(e=>{t.map.on(e,t.fire.bind(t))}),t.map.once("load",()=>{hideLoader(t.container)}),Promise.all([loadStaticData(t.dataUrl,t.lang,t.clock).then(t.initData.bind(t)).catch(e=>{throw showErrorMessage(t.container),e}),new Promise(e=>{t.map.once("styledata",e)})]).then(t.initialize.bind(t))}getMapboxMap(){return this.map}getCenter(){return this.map.getCenter()}setCenter(e){return this.trackObject(),this.map.setCenter(e),this}getZoom(){return this.map.getZoom()}setZoom(e){return this.map.setZoom(e),this}getBearing(){return this.map.getBearing()}setBearing(e){return this.trackObject(),this.map.setBearing(e),this}getPitch(){return this.map.getPitch()}setPitch(e){return this.map.setPitch(e),this}easeTo(e){var{center:t,bearing:r}=e;return void 0===t&&void 0===r||this.trackObject(),this.map.easeTo(e),this}flyTo(e){var{center:t,bearing:r}=e;return void 0===t&&void 0===r||this.trackObject(),this.map.flyTo(e),this}jumpTo(e){var{center:t,bearing:r}=e;return void 0===t&&void 0===r||this.trackObject(),this.map.jumpTo(e),this}getViewMode(){return this.viewMode}setViewMode(e){return this.initialized&&this._setViewMode(e),this}getTrackingMode(){return this.trackingMode}setTrackingMode(e){return this._setTrackingMode(e),this}getSelection(){if(isTrainOrFlight(this.trackedObject)){var e=this.trackedObject.object;return e.t||e.id}}setSelection(t){const r=this,i=removePrefix(t);if(i.match(/NRT|HND/))r.flightLoaded?((n=r.activeFlightLookup[i])?n.aircraft?r.trackObject(n.aircraft):r.selection=n.id:showNotification(r.container,r.dict["flight-terminated"]),delete r.initialSelection):r.initialSelection=i;else if(r.trainLoaded){var n=r.trainLookup[i];let e;if(n)for(const t of getConnectingTrainIds(n))if(e=r.activeTrainLookup[t])break;e?e.cars[0]?r.trackObject(e.cars[0]):r.selection=e.t:showNotification(r.container,r.dict["train-terminated"]),delete r.initialSelection}else r.initialSelection=i;return r}getClockMode(){return this.clockMode}setClockMode(e){return this.initialized&&this._setClockMode(e),this}getEcoMode(){return this.ecoMode}setEcoMode(e){return this._setEcoMode(e),this}addLayer(e,t){return"three"===e.type?new ThreeLayer(e).onAdd(this,t):this.map.addLayer(e,t||"poi"),this}removeLayer(e){return this.map.removeLayer(e),this}setLayerVisibility(e,t){return this.map.setLayoutProperty(e,"visibility",t),this}getModelOrigin(){return modelOrigin}getModelScale(){return modelScale}getModelPosition(e,t){t=mapboxGl$1.exports.MercatorCoordinate.fromLngLat(e,t);return{x:t.x-modelOrigin.x,y:-(t.y-modelOrigin.y),z:t.z-modelOrigin.z}}hasDarkBackground(){return hasDarkBackground(this.map)}initData(e){const i=this;Object.assign(i,e),i.railwayLookup=buildLookup(i.railwayData),i.stationLookup=buildLookup(i.stationData),i.featureLookup={},featureEach(i.featureCollection,e=>{const{id:t,type:r}=e.properties;t&&!t.match(/\.(ug|og)\./)&&updateDistances(i.featureLookup[t]=e),1===r&&(i.featureLookup[t]=e)}),i.lastTimetableRefresh=i.clock.getTime("03:00"),i.updateTimetableData(i.timetableData),i.trainLookup=buildLookup(i.timetableData,"t"),i.railDirectionLookup=buildLookup(i.railDirectionData),i.trainTypeLookup=buildLookup(i.trainTypeData),i.trainVehicleLookup=buildLookup(i.trainVehicleData),i.operatorLookup=buildLookup(i.operatorData),i.airportLookup=buildLookup(i.airportData),i.flightStatusLookup=buildLookup(i.flightStatusData),i.poiLookup=buildLookup(i.poiData),i.activeTrainLookup={},i.realtimeTrainLookup={},i.activeFlightLookup={},i.flightLookup={}}initialize(){const o=this,{lang:t,dict:n,clock:e,map:l}=o,r=Math.pow(2,14-clamp$2(l.getZoom(),13,19));o.layerZoom=clamp$2(Math.floor(l.getZoom()),13,18),o.objectUnit=Math.max(.19*r,.02),o.trafficLayer=new TrafficLayer({id:"traffic"}),["poi","poi_extra"].forEach(e=>{l.setLayoutProperty(e,"text-field",`{name_${t.match(/ja|ko|zh-Han[st]/)?t:"en"}}`)}),[13,14,15,16,17,18].forEach(t=>{var e=t<=13?0:t,r=18<=t?24:t+1,i=13===t?clamp$2(Math.pow(2,l.getZoom()-12),.125,1):18===t?clamp$2(Math.pow(2,l.getZoom()-19),1,8):1;l.addLayer(new MapboxLayer({id:`stations-marked-${t}`,type:GeoJsonLayer,filled:!0,stroked:!0,getLineWidth:12,getLineColor:[255,255,255],lineWidthUnits:"pixels",lineWidthScale:i,getFillColor:[255,255,255],visible:!1,parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`stations-marked-${t}`,e,r),l.addLayer(new MapboxLayer({id:`stations-selected-${t}`,type:GeoJsonLayer,filled:!0,stroked:!0,getLineWidth:12,getLineColor:[255,255,255],lineWidthUnits:"pixels",lineWidthScale:i,getFillColor:[255,255,255],visible:!1,parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`stations-selected-${t}`,e,r),l.addLayer(new MapboxLayer({id:`railways-ug-${t}`,type:GeoJsonLayer,data:featureFilter(o.featureCollection,e=>e.zoom===t&&0===e.type&&e.altitude<0),filled:!1,stroked:!0,getLineWidth:e=>e.properties.width,getLineColor:e=>colorToRGBArray(e.properties.color),lineWidthUnits:"pixels",lineWidthScale:i,opacity:.0625,pickable:!0,parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`railways-ug-${t}`,e,r),l.addLayer(new MapboxLayer({id:`stations-ug-${t}`,type:GeoJsonLayer,data:featureFilter(o.featureCollection,e=>e.zoom===t&&1===e.type&&e.altitude<0),filled:!0,stroked:!0,getLineWidth:4,getLineColor:[0,0,0],lineWidthUnits:"pixels",lineWidthScale:i,getFillColor:[255,255,255,179],opacity:.0625,pickable:!0,parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`stations-ug-${t}`,e,r),l.addLayer(new MapboxLayer({id:`railways-routeug-${t}`,type:GeoJsonLayer,data:emptyFeatureCollection(),filled:!1,stroked:!0,getLineWidth:e=>e.properties.width,getLineColor:e=>colorToRGBArray(e.properties.color),lineWidthUnits:"pixels",lineWidthScale:i,opacity:.0625,parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`railways-routeug-${t}`,e,r),l.addLayer(new MapboxLayer({id:`stations-routeug-${t}`,type:GeoJsonLayer,data:emptyFeatureCollection(),filled:!0,stroked:!0,getLineWidth:4,getLineColor:[0,0,0],lineWidthUnits:"pixels",lineWidthScale:i,getFillColor:[255,255,255,179],opacity:.0625,parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`stations-routeug-${t}`,e,r),l.addLayer(new MapboxLayer({id:`railways-routeog-${t}`,type:GeoJsonLayer,data:emptyFeatureCollection(),filled:!1,stroked:!0,getLineWidth:e=>e.properties.width,getLineColor:e=>colorToRGBArray(e.properties.color),lineWidthUnits:"pixels",lineWidthScale:i,parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`railways-routeog-${t}`,e,r),l.addLayer(new MapboxLayer({id:`stations-routeog-${t}`,type:GeoJsonLayer,data:emptyFeatureCollection(),filled:!0,stroked:!0,getLineWidth:4,getLineColor:[0,0,0],lineWidthUnits:"pixels",lineWidthScale:i,getFillColor:[255,255,255,179],parameters:{depthTest:!1}}),"building-3d"),l.setLayerZoomRange(`stations-routeog-${t}`,e,r)}),l.__deck.props.getCursor=()=>l.getCanvas().style.cursor,[13,14,15,16,17,18].forEach(t=>{var e=t<=13?0:t,r=18<=t?24:t+1,i=["get","width"],n=["get","color"],a=13===t?["interpolate",["exponential",2],["zoom"],9,["/",i,8],12,i]:18===t?["interpolate",["exponential",2],["zoom"],19,i,22,["*",i,8]]:i,s={type:"geojson",data:featureFilter(o.featureCollection,e=>e.zoom===t&&0===e.type&&0===e.altitude)},i={type:"geojson",data:featureFilter(o.featureCollection,e=>e.zoom===t&&1===e.type&&0===e.altitude)};l.addLayer({id:`railways-og-${t}`,type:"line",source:s,paint:{"line-color":n,"line-width":a},minzoom:e,maxzoom:r},"building-3d"),l.addLayer({id:`stations-og-${t}`,type:"fill",source:i,paint:{"fill-color":n,"fill-opacity":.7},minzoom:e,maxzoom:r},"building-3d"),l.addLayer({id:`stations-outline-og-${t}`,type:"line",source:i,paint:{"line-color":["get","outlineColor"],"line-width":a},minzoom:e,maxzoom:r},"building-3d")}),o.addLayer(o.trafficLayer,"building-3d"),l.addLayer({id:"sky",type:"sky",paint:{"sky-opacity":["interpolate",["linear"],["zoom"],0,0,5,.3,8,1],"sky-type":"atmosphere","sky-atmosphere-sun-intensity":20}}),o.styleColors=getStyleColors(l),o.styleOpacities=getStyleOpacities(l);const s=createElement("datalist",{id:"stations"},document.body);var i;if(o.stationTitleLookup={},[t,"en"].forEach(a=>{o.railwayData.forEach(e=>{e.stations.forEach(e=>{const t=o.stationLookup[e],r=t.utitle&&t.utitle[a],i=r||normalize$1(t.title[a]||t.title.en),n=i.toUpperCase();o.stationTitleLookup[n]||(createElement("option",{value:i},s),o.stationTitleLookup[n]=t)})})}),o.searchControl&&(i=new MapboxGLButtonControl([{className:"mapboxgl-ctrl-search",title:n["enter-search"],eventHandler(){o._setSearchMode("none"===o.searchMode?"edit":"none")}}]),l.addControl(i)),o.navigationControl){const a=new mapboxGl$1.exports.NavigationControl;a._setButtonTitle=function(e){var{_zoomInButton:t,_zoomOutButton:r,_compass:i}=this,i=e===t?n["zoom-in"]:e===r?n["zoom-out"]:e===i?n.compass:"";e.title=i,e.setAttribute("aria-label",i)},l.addControl(a)}if(o.fullscreenControl){const c=new mapboxGl$1.exports.FullscreenControl({container:o.container});c._updateTitle=function(){const e=this["_fullscreenButton"],t=n[this._isFullscreen()?"exit-fullscreen":"enter-fullscreen"];e.title=t,e.setAttribute("aria-label",t)},l.addControl(c)}o.modeControl&&(i=new MapboxGLButtonControl([{className:"mapboxgl-ctrl-underground",title:n["enter-underground"],eventHandler(){o._setViewMode("ground"===o.viewMode?"underground":"ground")}},{className:`mapboxgl-ctrl-track mapboxgl-ctrl-track-${"helicopter"===o.trackingMode?"helicopter":"train"}`,title:n.track,eventHandler(e){o._setTrackingMode("helicopter"===o.trackingMode?"heading":"helicopter"),e.stopPropagation()}},{className:"mapboxgl-ctrl-playback",title:n["enter-playback"],eventHandler(){o._setClockMode("realtime"===o.clockMode?"playback":"realtime")}},{className:"mapboxgl-ctrl-eco",title:n["enter-eco"],eventHandler(){o._setEcoMode("eco"===o.ecoMode?"normal":"eco")}}]),l.addControl(i)),o.layerPanel=new LayerPanel({layers:o.plugins}),o.aboutPanel=new AboutPanel,o.configControl&&l.addControl(new MapboxGLButtonControl([{className:"mapboxgl-ctrl-layers",title:n["select-layers"],eventHandler(){o.layerPanel.addTo(o)}},{className:"mapboxgl-ctrl-about",title:n.about,eventHandler(){o.aboutPanel.addTo(o)}}])),o.clockControl&&(o.clockCtrl=new ClockControl({lang:t,dict:n,clock:e}),o.clockCtrl.on("change",o.onClockChange.bind(o)),l.addControl(o.clockCtrl)),[13,14,15,16,17,18].forEach(e=>{l.on("mouseenter",`stations-og-${e}`,e=>{o.pickedFeature=e.features[0]}),l.on("click",`stations-og-${e}`,e=>{o.pickedFeature=e.features[0]}),l.on("mouseleave",`stations-og-${e}`,()=>{delete o.pickedFeature})}),l.on("mousemove",e=>{o.markObject(o.pickObject(e.point))}),l.on("mouseout",()=>{o.markObject()}),l.on("click",e=>{var t=o.pickObject(e.point);o.markObject(t),o.trackObject(t),console.log(e.lngLat)}),l.on("zoom",e=>{e.tracking||isTrainOrFlight(o.trackedObject)&&({type:t,coord:r,altitude:i}=o.trackedObject,"flight"===t&&o.updateBaseZoom(r,i));var t=l.getZoom(),r=Math.pow(2,14-clamp$2(t,13,19));if(t<13){const n=clamp$2(Math.pow(2,t-12),.125,1);["stations-marked-13","stations-selected-13","railways-ug-13","stations-ug-13","railways-routeug-13","stations-routeug-13","railways-routeog-13","stations-routeog-13"].forEach(e=>{setLayerProps(l,e,{lineWidthScale:n})})}else if(19<t){const a=clamp$2(Math.pow(2,t-19),1,8);["stations-marked-18","stations-selected-18","railways-ug-18","stations-ug-18","railways-routeug-18","stations-routeug-18","railways-routeog-18","stations-routeog-18"].forEach(e=>{setLayerProps(l,e,{lineWidthScale:a})})}var i=o.layerZoom;o.layerZoom=clamp$2(Math.floor(t),13,18),o.objectUnit=Math.max(.19*r,.02),i!==o.layerZoom&&(Object.keys(o.activeTrainLookup).forEach(e=>{e=o.activeTrainLookup[e];o.updateTrainProps(e),o.updateTrainShape(e)}),Object.keys(o.activeFlightLookup).forEach(e=>{o.updateFlightShape(o.activeFlightLookup[e])}))}),l.on("render",()=>{o.markedObject&&(isTrainOrFlight(o.markedObject)?o.updatePopup({setHTML:!0}):o.updatePopup())});for(const h of o.plugins.slice().reverse())h.addTo(o);animation.init(),animation.start({callback:()=>{var e=o.clock.getTime();864e5<=e-o.lastTimetableRefresh&&(o.loadTimetableData(),o.lastTimetableRefresh=o.clock.getTime("03:00")),Date.now()-o.lastFrameRefresh>=configs.refreshTimeout&&o.stopAll(),o.lastFrameRefresh=Date.now(),o.updateVisibleArea(),Math.floor((e-configs.minDelay)/configs.trainRefreshInterval)!==Math.floor(o.lastTrainRefresh/configs.trainRefreshInterval)&&(o.refreshStyleColors(),o.setSunPosition(),"none"===o.searchMode&&("realtime"===o.clockMode?(o.loadRealtimeTrainData(),o.loadRealtimeFlightData()):(o.refreshTrains(),o.refreshFlights())),o.lastTrainRefresh=e-configs.minDelay),!isTrainOrFlight(o.trackedObject)&&("normal"===o.ecoMode&&l._loaded||Date.now()-o.lastRepaint>=1e3/o.ecoFrameRate)&&(o.trackedObject&&o.refreshStationOutline(),l.triggerRepaint(),o.lastRepaint=Date.now())}}),o.initialized=!0}_jumpTo(e){const{map:t,trackingMode:r,trackingBaseBearing:i}=this,n=t.scrollZoom._active;let{center:a,altitude:s,bearing:o,centerFactor:l,bearingFactor:c}=e;var h,u,d;"helicopter"===r?o=(i+performance.now()/100)%360:0<=c&&(d=t.getBearing(),o=d+((o-d+540)%360-180)*c),a=this.adjustCoord(a,s,o),0<=l&&({lng:h,lat:u}=t.getCenter(),{lng:e,lat:d}=a,a=new mapboxGl$1.exports.LngLat(h+(e-h)*l,u+(d-u)*l)),t.jumpTo({center:a,bearing:o}),n&&(t.scrollZoom._active=!0)}updateVisibleArea(){const e=this["map"],{width:t,height:r}=e.transform,i=this.getModelPosition(e.unproject([0,0])),n=this.getModelPosition(e.unproject([t,0])),a=this.getModelPosition(e.unproject([0,r])),s=this.getModelPosition(e.unproject([t,r]));this.visibleArea=bufferTrapezoid([[i.x,i.y],[n.x,n.y],[s.x,s.y],[a.x,a.y]],Math.max(14e-6,5e-5*Math.sin(e.getPitch()*DEGREE_TO_RADIAN)))}updateTrainProps(e){var t=(e.railwayFeature=this.featureLookup[`${e.r}.${this.layerZoom}`]).properties["station-offsets"],{sectionIndex:r,sectionLength:i}=e,n=e.offset=t[r];e.interval=t[r+i]-n}updateTrainShape(r,e){const i=this,{map:n,trafficLayer:a,objectUnit:t}=i,{railwayFeature:s,offset:o,interval:l,direction:c,cars:h,delay:u}=r,d=h.length;let p,f,m;if(void 0!==e&&(r._t=e),void 0!==r._t){var g;0===d&&(g=i.railwayLookup[r.r],e=r["v"],g={type:"train",object:r,color:(e?i.trainVehicleLookup[e]:g).color,delay:0},h.push(g),i.markedObject&&i.markedObject.object===r&&(p=h[0]),i.trackedObject&&i.trackedObject.object===r&&(f=h[0]),i.selection===r.t&&(f=h[0],delete i.selection)),h[0].delay=u?1:0;var _,v,y=getCoordAndBearing(s,o+r._t*l,1,t);for(let e=0,t=h.length;e<t;e++){const x=h[e],b=y[e];x.altitude<0&&0<=b.altitude?m="ground":0<=x.altitude&&b.altitude<0&&(m="underground"),x.coord=b.coord,x.altitude=b.altitude,x.bearing=b.bearing+(c<0?180:0),x.pitch=b.pitch*c,p===x&&i.markObject(x),f===x&&i.trackObject(x),i.markedObject===x?x.outline=1:i.trackedObject===x?x.outline=blink():x.outline=0,i.trackedObject!==x||i.viewAnimationID||n._zooming||n._pitching||i._jumpTo({center:x.coord,altitude:x.altitude,bearing:x.bearing,bearingFactor:.02}),animation.isActive(r.animationID)&&({x:_,y:v}=i.getModelPosition(x.coord),v=pointInTrapezoid([_,v],i.visibleArea)?"normal"===i.ecoMode&&n._loaded?60:i.ecoFrameRate:1,animation.setFrameRate(r.animationID,v)),void 0===x.meshIndex?a.addObject(x):a.updateObject(x),m&&i.trackedObject===x&&i._setViewMode(m),i.trackedObject===x&&i.markedObject===x&&i.updatePopup()}}}updateFlightShape(e,t){const r=this,{map:i,trafficLayer:n}=r;let a=e["aircraft"],s;var o,l,c;void 0!==t&&(e._t=t),void 0!==e._t&&(a||({color:t,tailcolor:o}=r.operatorLookup[e.a],a=e.aircraft={type:"flight",object:e,color:[t||"#FFFFFF",o||"#FFFFFF"]},r.selection===e.id&&(s=a,delete r.selection)),o=getCoordAndBearing(e.feature,e._t*e.feature.properties.length,1,0)[0],a.coord=o.coord,a.altitude=o.altitude,a.bearing=o.bearing,a.pitch=o.pitch,s===a&&r.trackObject(a),r.markedObject===a?a.outline=1:r.trackedObject===a?a.outline=blink():a.outline=0,r.trackedObject!==a||r.viewAnimationID||i._zooming||i._pitching||(r._jumpTo({center:a.coord,altitude:a.altitude,bearing:a.bearing,bearingFactor:.02}),isNaN(r.baseZoom)||({baseDistance:c,baseZoom:o}=r,l=r.getModelPosition(a.coord,a.altitude).z,l=o-Math.log2((l/Math.cos(i.getPitch()*DEGREE_TO_RADIAN)+c)/c),c=i.scrollZoom._active,i.setZoom(l,{tracking:!0}),c&&(i.scrollZoom._active=!0))),animation.isActive(e.animationID)&&({x:l,y:c}=r.getModelPosition(a.coord),c=pointInTrapezoid([l,c],r.visibleArea)?"normal"===r.ecoMode&&i._loaded?60:r.ecoFrameRate:1,animation.setFrameRate(e.animationID,c)),void 0===a.meshIndex?n.addObject(a):n.updateObject(a),r.trackedObject===a&&r.markedObject===a&&r.updatePopup())}refreshTrains(){const i=this,n=i.clock.getTime();i.timetableData.forEach(e=>{var t=e.delay||0,r=i.railwayLookup[e.r];!(e.start+t<=n&&n<=e.end+t)||i.checkActiveTrains(e,!0)||r.dynamic&&r.status&&!i.realtimeTrainLookup[e.t]||i.trainStart(e)}),i.trafficLayer.refreshDelayMarkers(),i.trainLoaded=!0,i.initialSelection&&i.setSelection(i.initialSelection)}trainStart(e,t){const r=this["clock"],i=r.getTime();this.setSectionData(e,t)&&((this.activeTrainLookup[e.t]=e).cars=[],this.updateTrainProps(e),t=r.getTime(e.departureTime)+(e.delay||0),e.tt||0===e.sectionLength?e.tt&&t<=i?this.trainRepeat(e,i-t):this.trainStand(e):this.trainRepeat(e))}trainStand(e,t){const r=this,i=r["clock"],n=i.getTime(e.departureTime)+(e.delay||0);!(t=!e.tt?!r.setSectionData(e,void 0,!r.realtimeTrainLookup[e.t]):t)&&e.arrivalStation&&(r.updateTrainProps(e),r.updateTrainShape(e,0)),e.tt||0===e.sectionLength?(r.setTrainStandingStatus(e,!0),e.animationID=animation.start({callback:()=>{r.trackedObject&&r.trackedObject.object===e&&r.updateTrainShape(e)},complete:()=>{t?r.stopTrain(e):e.tt?r.trainRepeat(e,1===r.clock.speed?void 0:r.clock.getTime()-n):r.trainStand(e)},duration:e.tt?Math.max(n-i.getTime(),1===i.speed?configs.minStandingDuration:0):t?configs.minStandingDuration:configs.realtimeTrainCheckInterval,clock:i})):r.trainRepeat(e)}trainRepeat(i,e){const a=this,t=a["clock"],r=t.getTime(),n=i.delay||0,{arrivalTime:s,nextDepartureTime:o}=i;let l,c;o&&(c=t.getTime(o)+n-r+(e||0)-configs.minDelay+6e4-configs.minStandingDuration),s&&(l=t.getTime(s)+n-r+(e||0)-configs.minDelay,c<l+6e4||(c=l+6e4)),a.setTrainStandingStatus(i,!1),i.animationID=startTrainAnimation(e=>!i.cars||isNaN(e)?(console.log("Invalid train",Object.assign({},i)),void a.stopTrain(i)):void a.updateTrainShape(i,e),()=>{if(!i.cars||i.tt&&i.timetableIndex+1>=i.tt.length)a.stopTrain(i);else if(a.setSectionData(i,i.timetableIndex+1))a.trainStand(i);else{const t=i["nextTrains"];if(t){let e=!1;for(const r of t[0].previousTrains)r.arrivalStation&&(e=!0);if(e)a.trainStand(i);else{let r=-1,i=-1;for(const n of t[0].previousTrains)-1===r&&n.cars&&(r=n.cars.indexOf(a.markedObject)),-1===i&&n.cars&&(i=n.cars.indexOf(a.trackedObject)),a.stopTrain(n);t.forEach((e,t)=>{a.activeTrainLookup[e.t]||a.trainStart(e,0),0===t&&e.cars&&(a.updateTrainShape(e,0),-1!==r&&a.markObject(e.cars[r]),-1!==i&&a.trackObject(e.cars[i]))})}}else a.trainStand(i,!0)}},Math.abs(i.interval),l,c,e,t)}refreshFlights(){const r=this,i=r["clock"],n=i.getTime();Object.keys(r.flightLookup).forEach(e=>{const t=r.flightLookup[e];t.standing<=n&&n<=t.end&&!r.activeFlightLookup[t.id]&&(r.activeFlightLookup[t.id]=t,n>=t.start?r.flightRepeat(t,n-t.start):(r.updateFlightShape(t,0),r.setFlightStandingStatus(t,!0),t.animationID=animation.start({callback:()=>{r.trackedObject&&r.trackedObject.object===t&&r.updateFlightShape(t)},complete:()=>{r.flightRepeat(t)},duration:t.start-n,clock:i})))}),r.flightLoaded=!0,r.initialSelection&&r.setSelection(r.initialSelection)}flightRepeat(t,e){const r=this,i=r["clock"];r.setFlightStandingStatus(t,!1),t.animationID=startFlightAnimation(e=>{r.updateFlightShape(t,e)},()=>{r.setFlightStandingStatus(t,!0),t.animationID=animation.start({callback:()=>{r.trackedObject&&r.trackedObject.object===t&&r.updateFlightShape(t)},complete:()=>{r.stopFlight(t)},duration:Math.max(t.end-i.getTime(),0),clock:i})},t.feature.properties.length,t.maxSpeed,t.acceleration,e,i)}startViewAnimation(){const a=this;let s=0;a.trackingBaseBearing=a.map.getBearing()-performance.now()/100,a.viewAnimationID=animation.start({callback:(e,t)=>{var r=easeOutQuart(e/t),i=1-(1-r)/(1-s),{coord:n,altitude:e,bearing:t}=a.trackedObject;a._jumpTo({center:n,altitude:e,bearing:t,centerFactor:i,bearingFactor:i}),s=r},complete:()=>{delete a.viewAnimationID},duration:1e3})}stopViewAnimation(){this.viewAnimationID&&(animation.stop(this.viewAnimationID),delete this.viewAnimationID)}adjustCoord(e,t,r){if(!t)return mapboxGl$1.exports.LngLat.convert(e);const{map:i,trafficLayer:n}=this;if(isNaN(r))return i.unproject(n.project(e,t));var a=mapboxGl$1.exports.MercatorCoordinate.fromLngLat(e,t),e=a.z*Math.tan(i.getPitch()*DEGREE_TO_RADIAN),t=a.x+e*Math.sin(r*DEGREE_TO_RADIAN),r=a.y-e*Math.cos(r*DEGREE_TO_RADIAN);return new mapboxGl$1.exports.MercatorCoordinate(t,r,0).toLngLat()}getLocalizedRailwayTitle(e){e=(this.railwayLookup[e]||{}).title||{};return e[this.lang]||e.en}getLocalizedRailDirectionTitle(e){e=(this.railDirectionLookup[e]||{}).title||{};return e[this.lang]||e.en}getLocalizedTrainTypeTitle(e){e=(this.trainTypeLookup[e]||{}).title||{};return e[this.lang]||e.en}getLocalizedStationTitle(e){const t=this,r=Array.isArray(e)?e:[e];return r.map(e=>{e=(t.stationLookup[e]||{}).title||{};return e[t.lang]||e.en}).join(t.dict.and)}getLocalizedOperatorTitle(e){e=(this.operatorLookup[e]||{}).title||{};return e[this.lang]||e.en}getLocalizedAirportTitle(e){e=(this.airportLookup[e]||{}).title||{};return e[this.lang]||e.en}getLocalizedFlightStatusTitle(e){e=(this.flightStatusLookup[e]||{}).title||{};return e[this.lang]||e.en}getLocalizedPOITitle(e){e=(this.poiLookup[e]||{}).title||{};return e[this.lang]||e.en}getLocalizedPOIDescription(e){e=(this.poiLookup[e]||{}).description||{};return e[this.lang]||e.en}setTrainStandingStatus(e,t){const{lang:r,dict:i,clock:n}=this,{r:a,nm:s,v:o,ds:l,departureTime:c,arrivalStation:h}=e,u=this.railwayLookup[a],d=(o?this.trainVehicleLookup[o]:u).color,p=e.delay||0,f=e.arrivalTime||e.nextDepartureTime,{status:m,text:g}=u;e.standing=t,e.description=['<div class="desc-header">',Array.isArray(d)?["<div>",...d.slice(0,3).map(e=>`<div class="line-strip" style="background-color: ${e};"></div>`),"</div>"].join(""):`<div style="background-color: ${d};"></div>`,"<div><strong>",s?s.map(e=>e[r]||e.en).join(i.and):this.getLocalizedRailwayTitle(a),"</strong>",`<br> <span class="train-type-label">${this.getLocalizedTrainTypeTitle(e.y)}</span> `,l?i.for.replace("$1",this.getLocalizedStationTitle(l)):this.getLocalizedRailDirectionTitle(e.d),"</div></div>",`<strong>${i["train-number"]}:</strong> ${e.n}`,e.tt?"":` <span class="desc-caution">${i.special}</span>`,"<br>",6e4<=p?'<span class="desc-caution">':"","<strong>",i[t?"standing-at":"previous-stop"],":</strong> ",this.getLocalizedStationTitle(e.departureStation),c?` ${n.getTimeString(n.getTime(c)+p)}`:"",h?[`<br><strong>${i["next-stop"]}:</strong> `,this.getLocalizedStationTitle(h),f?` ${n.getTimeString(n.getTime(f)+p)}`:""].join(""):"",6e4<=p?`<br>${i.delay.replace("$1",Math.floor(p/6e4))}</span>`:"",m&&"ja"===r?`<br><span class="desc-caution"><strong>${m}:</strong> ${g}</span>`:""].join("")}setFlightStandingStatus(e){const t=this["dict"],{a:r,n:i,ds:n,or:a}=e,s=this.operatorLookup[r].tailcolor||"#FFFFFF",o=e.sdt||e.sat,l=e.edt||e.eat,c=e.adt||e.aat,h=(l||c)&&o!==(l||c);e.description=['<div class="desc-header">',`<div style="background-color: ${s};"></div>`,`<div><strong>${this.getLocalizedOperatorTitle(r)}</strong>`,`<br>${i[0]} `,t[n?"to":"from"].replace("$1",this.getLocalizedAirportTitle(n||a)),"</div></div>",`<strong>${t.status}:</strong> ${this.getLocalizedFlightStatusTitle(e.s)}`,"<br><strong>",t[n?"scheduled-departure-time":"scheduled-arrival-time"],`:</strong> ${o}`,h?'<span class="desc-caution">':"",l?["<br><strong>",t[n?"estimated-departure-time":"estimated-arrival-time"],`:</strong> ${l}`].join(""):c?["<br><strong>",t[n?"actual-departure-time":"actual-arrival-time"],`:</strong> ${c}`].join(""):"",h?"</span>":"",1<i.length?`<br><strong>${t["code-share"]}:</strong> ${i.slice(1).join(" ")}`:""].join("")}checkActiveTrains(e){const n=this;function a(e,r){var t=n.activeTrainLookup[e.t];if(t&&e.id===t.id)return!0;var i=e[r];if(i)for(let e=0,t=i.length;e<t;e++)if(a(i[e],r))return!0;return!1}return a(e,"previousTrains")||a(e,"nextTrains")}stopTrain(e,t){const r=this,{cars:i,animationID:n,t:a,tt:s}=e;animation.stop(n),i&&i.forEach(e=>{r.trafficLayer.removeObject(e),e!==r.markedObject||t||r.markObject(),e!==r.trackedObject||t||r.trackObject()}),delete e.cars,delete r.activeTrainLookup[a],t||delete e.delay,s||r.timetableData.splice(r.timetableData.indexOf(e),1)}stopFlight(e){var{id:t,animationID:r,aircraft:i}=e;animation.stop(r),this.trafficLayer.removeObject(i),i===this.markedObject&&this.markObject(),i===this.trackedObject&&this.trackObject(),delete e.aircraft,delete this.activeFlightLookup[t]}stopAll(){const t=this;Object.keys(t.activeTrainLookup).forEach(e=>t.stopTrain(t.activeTrainLookup[e])),Object.keys(t.activeFlightLookup).forEach(e=>t.stopFlight(t.activeFlightLookup[e])),t.realtimeTrainLookup={},delete t.lastTrainRefresh}resetRailwayStatus(){this.railwayData.forEach(e=>{delete e.status,delete e.text,delete e.dynamic})}loadTimetableData(){const t=this;loadTimetableData(t.dataUrl,t.clock).then(e=>{t.timetableData=e,t.updateTimetableData(t.timetableData),t.trainLookup=buildLookup(t.timetableData,"t"),delete t.lastTrainRefresh})}loadRealtimeTrainData(){const a=this;loadDynamicTrainData(a.secrets).then(({trainData:e,trainInfoData:t})=>{a.realtimeTrainLookup={},e.forEach(e=>{const t=e["id"];let r=a.trainLookup[t]||a.trainLookup[t.replace(".Marunouchi.",".MarunouchiBranch.")],i=!1;if(r)a.realtimeTrainLookup[t]=r,r.delay!==e.delay&&(r.delay=e.delay,i=!0),e.carComposition&&r.carComposition!==e.carComposition&&(r.carComposition=e.carComposition,i=!0),e.y&&r.y!==e.y&&(r.y=e.y,i=!0),truncateTrainTimetable(r,e.os,e.ds)&&(i=!0),r.tt||(r.ts=e.ts,r.fs=e.fs),i&&a.activeTrainLookup[t]&&a.stopTrain(r,!0);else if(e.r){if(e.r===RAILWAY_NAMBOKU&&(e.os[0].startsWith(RAILWAY_MITA)||e.ds[0].startsWith(RAILWAY_MITA)))return;if(e.r===RAILWAY_ARAKAWA)return;var n=a.railwayLookup[e.r];n&&(r={t:t,id:`${t}.Today`,r:e.r,y:e.y,n:e.n,os:e.os,d:e.d,ds:e.ds,ts:e.ts,fs:e.fs,start:Date.now(),end:Date.now()+864e5,delay:e.delay,direction:e.d===n.ascending?1:-1,altitude:n.altitude,carComposition:e.carComposition||n.carComposition},a.timetableData.push(r),a.realtimeTrainLookup[t]=a.trainLookup[t]=r)}a.lastDynamicUpdate[e.o]=e.date}),a.resetRailwayStatus(),t.forEach(e=>{const t=a.railwayLookup[e.railway];t&&e.status&&e.status.ja&&(t.status=e.status.ja,t.text=e.text.ja,includes(OPERATORS_FOR_DYNAMIC_TRAIN_DATA,e.operator)&&(t.dynamic=!0,Object.keys(a.activeTrainLookup).forEach(e=>{e=a.activeTrainLookup[e];e.r!==t.id||a.realtimeTrainLookup[e.t]||a.stopTrain(e)})))}),a.refreshTrains(),a.aboutPanel.updateContent()}).catch(e=>{a.refreshTrains(),console.log(e)})}loadRealtimeFlightData(){const U=this;loadDynamicFlightData(U.secrets).then(({atisData:e,flightData:t})=>{const{landing:r,departure:i}=e,n=[r.join("/"),i.join("/")].join(" "),a={},s={};let o={},l={},c=!0;U.flightPattern!==n&&(U.flightPattern=n,U.lastFlightPatternChanged=Date.now(),Object.keys(U.activeFlightLookup).forEach(e=>{U.stopFlight(U.activeFlightLookup[e])})),includes(r,["R16L","R16R"])?(o={S:"R16L",N:"R16R"},l={S:"22",N:"16R"},c=!1):includes(r,["L22","L23"])?(o={S:"L23",N:"L22"},l={S:"O16R",N:"16L"},c=!1):includes(r,["I16L","I16R"])?(o={S:"I16L",N:"I16R"},l={S:"22",N:"16R"},c=!1):includes(r,["I22","I23"])?(o={S:"I23",N:"I22"},l={S:"16R",N:"16L"},c=!1):includes(r,["I34L","H34R"])?(o={S:"IX34L",N:"H34R"},l={S:"05",N:"34R"},c=!0):includes(r,["I34L","I34R"])?(o={S:"IZ34L",N:"H34R"},l={S:"05",N:"34R"},c=!0):1!==r.length?console.log(`Unexpected RWY: ${r}`):(includes(r,"I23")?(o={S:"IY23",N:"IY23"},c=!1):includes(r,"L23")?(o={S:"LY23",N:"LY23"},c=!1):includes(r,"I34L")?(o={S:"IX34L",N:"IX34L"},c=!0):includes(r,"I34R")?(o={S:"IY34R",N:"IY34R"},c=!0):console.log(`Unexpected LDG RWY: ${r[0]}`),includes(i,"16L")?l={S:"N16L",N:"N16L"}:includes(i,"05")?l={S:"N05",N:"N05"}:console.log(`Unexpected DEP RWY: ${i[0]}`));for(const b of t){var h,u,d,p,f,m;includes(AIRLINES_FOR_ANA_CODE_SHARE,b.a)&&({dp:h,ds:u,sdt:d,or:p,ar:f,sat:m}=b,a[`${h||p}.${u||f}.${d||m}`]=b)}for(const w of t){const T=w["id"];let e=U.flightLookup[T],t=w.s,{maxFlightSpeed:r,flightAcceleration:i}=configs;if(T.match(/NH\d{4}$/)){const{dp:S,ds:M,sdt:A,or:C,ar:L,sat:P}=w,I=`${S||C}.${M||L}.${A||P}`,R=a[I];if(R){R.n.push(...w.n);continue}}if(!e){if("Cancelled"===t)continue;const D=U.airportLookup[w.ds||w.or],O=D?D.direction:"S",k="NRT"===w.dp?`NRT.${c?"34L":"16R"}.Dep`:"NRT"===w.ar?`NRT.${c?"34R":"16L"}.Arr`:"HND"===w.dp?`HND.${l[O]}.Dep`:"HND"===w.ar?`HND.${o[O]}.Arr`:void 0,B=U.featureLookup[k];if(!B)continue;e=U.flightLookup[T]={id:T,n:w.n,a:w.a,dp:w.dp,ar:w.ar,ds:w.ds,or:w.or,runway:k.replace(/^([^.]+\.)[A-Z]*([^.]+).+/,"$1$2"),feature:B}}Object.assign(e,{edt:w.edt,adt:w.adt,sdt:w.sdt,eat:w.eat,aat:w.aat,sat:w.sat});var g=e.edt||e.adt||e.sdt,_=e.eat||e.aat||e.sat;t?"CheckIn"!==t&&"NowBoarding"!==t&&"BoardingComplete"!==t&&"Departed"!==t||(g<e.sdt?t="NewTime":g>e.sdt?t="Delayed":g===e.sdt&&(t="OnTime")):_<e.sat?t="NewTime":_>e.sat?t="Delayed":_===e.sat&&(t="OnTime"),e.s=t,_&&(r/=2,i/=-2);var v=r/Math.abs(i)/2+e.feature.properties.length/r,y=configs.standingDuration;g?(e.start=e.base=U.clock.getTime(g),e.standing=e.start-y,e.end=e.start+v):(e.start=e.standing=U.clock.getTime(_)-v,e.base=e.start+v-y,e.end=e.start+v+y),e.maxSpeed=r,e.acceleration=i;const E=s[e.runway]=s[e.runway]||[];E.push(e),U.lastDynamicUpdate[w.o]=w.date}for(const F of Object.keys(s)){const z=s[F];let e=0;z.sort((e,t)=>e.base-t.base);for(const N of z){var x=Math.max(N.base,e+configs.minFlightInterval)-N.base;x&&(N.start+=x,N.base+=x,N.standing+=x,N.end+=x),e=N.base}}U.refreshFlights()}).catch(e=>{U.refreshFlights(),console.log(e)})}updateSearchButton(e){const{container:t,dict:r}=this,i=t.querySelector(".mapboxgl-ctrl-search");if(i){const n=i["classList"];"edit"===e||"route"===e||"playback"===e?(i.title=r["exit-search"],n.add("mapboxgl-ctrl-search-active")):(i.title=r["enter-search"],n.remove("mapboxgl-ctrl-search-active"))}}updateUndergroundButton(e){const{container:t,dict:r}=this,i=t.querySelector(".mapboxgl-ctrl-underground");if(i){const n=i["classList"];"underground"===e?(i.title=r["exit-underground"],n.add("mapboxgl-ctrl-underground-visible")):(i.title=r["enter-underground"],n.remove("mapboxgl-ctrl-underground-visible"))}}updateTrackingButton(e){var t=this.container.querySelector(".mapboxgl-ctrl-track");if(t){const r=t["classList"];"helicopter"===e?(r.remove("mapboxgl-ctrl-track-train"),r.add("mapboxgl-ctrl-track-helicopter")):"heading"===e?(r.remove("mapboxgl-ctrl-track-helicopter"),r.add("mapboxgl-ctrl-track-train")):e?r.add("mapboxgl-ctrl-track-active"):r.remove("mapboxgl-ctrl-track-active")}}updatePlaybackButton(e){const{container:t,dict:r}=this,i=t.querySelector(".mapboxgl-ctrl-playback");if(i){const n=i["classList"];"playback"===e?(i.title=r["exit-playback"],n.add("mapboxgl-ctrl-playback-active")):(i.title=r["enter-playback"],n.remove("mapboxgl-ctrl-playback-active"))}}updateEcoButton(e){const{container:t,dict:r}=this,i=t.querySelector(".mapboxgl-ctrl-eco");if(i){const n=i["classList"];"eco"===e?(i.title=r["exit-eco"],n.add("mapboxgl-ctrl-eco-active")):(i.title=r["enter-eco"],n.remove("mapboxgl-ctrl-eco-active"))}}refreshMap(){const{map:e,trafficLayer:t,viewMode:r,searchMode:i,styleColors:n,styleOpacities:a}=this,s="underground"===r,o=this.getLightColor();e.setPaintProperty("background","background-color",s?"rgb(16,16,16)":getScaledColorString(n[0],o)),e.setPaintProperty("building-underground","fill-color",s?"hsla(268,67%,67%,.5)":getScaledColorString({r:167,g:114,b:227,a:.25},o));for(var{id:l,key:c,opacity:h}of a){var u=getLayerOpacity(l,r,i);e.setPaintProperty(l,c,scaleValues(h,u))}for(const d of[13,14,15,16,17,18])for(const p of[`railways-ug-${d}`,`stations-ug-${d}`,`railways-routeug-${d}`,`stations-routeug-${d}`,`railways-routeog-${d}`,`stations-routeog-${d}`])setLayerOpacity(e,p,getLayerOpacity(p,r,i));t.setMode(r,i)}_setSearchMode(e){var t=this;t.updateSearchButton(e),"none"===e?t.searchPanel&&(t.searchPanel.remove(),delete t.searchPanel):t.searchPanel||(t.searchPanel=new SearchPanel,t.searchPanel.addTo(t)),t.searchMode=e,t.stopAll();for(const r of t.plugins)r.setVisibility("none"===e);t.refreshMap()}_setViewMode(e){this.viewMode!==e&&(this.updateUndergroundButton(e),this.viewMode=e,this.refreshMap(),this.fire({type:"viewmode",mode:e}))}_setTrackingMode(e){this.trackingMode!==e&&(this.updateTrackingButton(e),this.trackingMode=e,isTrainOrFlight(this.trackedObject)&&this.startViewAnimation(),this.fire({type:"trackingmode",mode:e}))}_setClockMode(e){this.clockMode!==e&&(this.updatePlaybackButton(e),this.clockMode=e,this.clock.reset(),this.onClockChange(),this.clockControl&&this.clockCtrl.setMode(e),"playback"===e&&this.resetRailwayStatus(),this.fire({type:"clockmode",mode:e}))}_setEcoMode(e){this.ecoMode!==e&&(this.updateEcoButton(e),this.ecoMode=e,this.fire({type:"ecomode",mode:e}))}onClockChange(){var e=this.clock.getTime("03:00");this.stopAll(),this.markObject(),this.trackObject(),this.lastTimetableRefresh!==e&&(this.loadTimetableData(),this.lastTimetableRefresh=e)}getLightColor(){const[e,t]=configs.defaultCenter,r=this["clock"],i=SunCalc.getTimes(new Date(r.getTime()),t,e),n=r.getJSTDate(i.sunrise.getTime()).getTime(),a=r.getJSTDate(i.sunset.getTime()).getTime(),s=r.getJSTDate().getTime();let o,l,c,h;return n-36e5<=s&&s<n?(o=(s-n)/36e5+1,l=.4*(1-o)+.8*o,c=.4*(1-o)+.9*o,h=.5*(1-o)+o):n<=s&&s<n+36e5?(o=(s-n)/36e5,l=.8*(1-o)+o,c=.9*(1-o)+o,h=1):n+36e5<=s&&s<a-36e5?l=c=h=1:h=a-36e5<=s&&s<a?(o=(s-a)/36e5+1,l=1,c=1-o+.9*o,1-o+.8*o):a<=s&&s<a+36e5?(o=(s-a)/36e5,l=1-o+.4*o,c=.9*(1-o)+.4*o,.8*(1-o)+.5*o):(l=c=.4,.5),{r:l,g:c,b:h}}refreshStyleColors(){const{map:s,viewMode:e}=this,o="underground"===e,l=this.getLightColor();this.styleColors.forEach(e=>{var{id:t,key:r,stops:i,_case:n}=e;let a;"background"===t&&o?a="rgb(16,16,16)":"building-underground"===t&&o?a="hsla(268,67%,67%,.5)":(e=getScaledColorString(e,l),void 0!==i?(a=s.getPaintProperty(t,r),a.stops[i][1]=e):void 0!==n?(a=s.getPaintProperty(t,r),a[n]=e):a=e),s.setPaintProperty(t,r,a)})}setSunPosition(){const{map:e,clock:t}=this,r=e.getCenter(),i=SunCalc.getPosition(t.getTime(),r.lat,r.lng),n=180+180*i.azimuth/Math.PI,a=90-180*i.altitude/Math.PI;e.setPaintProperty("sky","sky-atmosphere-sun",[n,a])}pickObject(e){const{map:t,viewMode:r,trafficLayer:i,layerZoom:n,pickedFeature:a}=this,s=["ground","underground"];let o;"underground"===r&&s.reverse();for(const l of s){if(o=i.pickObject(l,e),o)return o;if(o="ground"===l?a:pickObject(t,`stations-ug-${n}`,e),o)return o}}markObject(e){const t=this,{markedObject:r,map:i,popup:n}=t;r&&!isEqualObject(r,e)&&(isTrainOrFlight(r)?(r.outline=0,t.trafficLayer.updateObject(r)):t.removeStationOutline("stations-marked"),delete t.markedObject,n&&n.isOpen()&&(i.getCanvas().style.cursor="",n.remove())),e&&!isEqualObject(e,t.markedObject)&&(t.markedObject=e,i.getCanvas().style.cursor="pointer",t.popup=new Popup({className:"popup-object",closeButton:!1,closeOnClick:!1,maxWidth:"300px",offset:{top:[0,10],bottom:[0,-30]},openingAnimation:{duration:300,easing:"easeOutBack"}}),t.updatePopup({setHTML:!0,addToMap:!0}),isTrainOrFlight(e)?(e.outline=1,t.trafficLayer.updateObject(e)):t.addStationOutline(e,"stations-marked"))}trackObject(e){const n=this,{searchMode:t,searchPanel:r,lang:i,map:a,trackedObject:s,sharePanel:o,detailPanel:l}=n;if("none"===t){if((isTrainOrFlight(s)||isStation(s)||s&&!isEqualObject(s,e))&&(isTrainOrFlight(s)?(d=s.object,s.outline=0,n.trafficLayer.updateObject(s),n.fire({type:"deselection",deselection:d.t||d.id})):isStation(s)?(n.removeStationOutline("stations-selected"),n.fire({type:"deselection"})):n.fire(Object.assign({type:"deselection"},s)),delete n.trackedObject,n.updateBaseZoom(),n.stopViewAnimation(),n.updateTrackingButton(!1),o&&(o.remove(),delete n.sharePanel),l&&(l.remove(),delete n.detailPanel),n.exitPopups.forEach(e=>{e instanceof Popup?e.remove():"function"==typeof e?a.off("moveend",e):clearTimeout(e)})),isTrainOrFlight(e)||isStation(e)||e&&!isEqualObject(e,n.trackedObject))if(isTrainOrFlight(n.trackedObject=e)){var{type:c,coord:h,altitude:u,object:d}=e;"flight"===c&&n.updateBaseZoom(h,u),n.startViewAnimation(),n.updateTrackingButton(!0),n._setViewMode(u<0?"underground":"ground"),"realtime"===n.clockMode&&navigator.share&&(n.sharePanel=new SharePanel({object:d}),n.sharePanel.addTo(n)),d.tt&&(n.detailPanel=new TrainPanel({object:d}),n.detailPanel.addTo(n)),e.outline=1,n.trafficLayer.updateObject(e),n.fire({type:"selection",selection:d.t||d.id})}else if(isStation(e)){const p=getAltitude(e),f=getIds(e),m=f.map(e=>n.stationLookup[e]),g=[].concat(...m.map(e=>e.exit||[]));if(0<g.length){const _=[];n.exitPopups=g.map((t,r)=>{const i=n.poiLookup[t]["coord"],e=()=>{n.exitPopups[r]=setTimeout(()=>{const e=new Popup({className:"popup-station",closeButton:!1,closeOnClick:!1});e.setLngLat(i).setHTML(n.getLocalizedPOITitle(t)).addTo(a).getElement().id=`exit-${r}`,n.exitPopups[r]=e},r/g.length*1e3)};return a.once("moveend",e),_.push(i),e}),n._setViewMode(p<0?"underground":"ground"),a.fitBounds(getBounds(_),{bearing:a.getBearing(),offset:[0,-a.transform.height/12],padding:{top:20,bottom:20,left:10,right:50},maxZoom:18}),n.detailPanel=new StationPanel({object:m}),n.detailPanel.addTo(n),n.addStationOutline(e,"stations-selected"),n.fire({type:"selection"})}else n.trackedObject=void 0}else n.fire(Object.assign({type:"selection"},e))}else"edit"===t&&r&&isStation(e)&&(e=getIds(e),e=(e=n.stationLookup[e[0]]).utitle&&e.utitle[i]||normalize$1(e.title[i]||e.title.en),r.fillStationName(e))}updateBaseZoom(e,t){const r=this["map"];void 0!==e&&void 0!==t?(e=this.getModelPosition(e,t).z,t=r.getFreeCameraOptions().position.z,this.baseDistance=(e=t-e)/Math.cos(r.getPitch()*DEGREE_TO_RADIAN),this.baseZoom=r.getZoom()+Math.log2(t/e)):(delete this.baseDistance,delete this.baseZoom)}updatePopup(e){const n=this,{markedObject:t,trackedObject:r,map:i,popup:a}=n,{setHTML:s,addToMap:o}=e||{};if(isTrainOrFlight(t)){var{coord:l,altitude:e,object:c}=t,h=t===r?i.getBearing():void 0;a.setLngLat(n.adjustCoord(l,e,h)),s&&a.setHTML(c.description)}else{h=n.featureLookup[t.properties.id.replace(/\d+$/,n.layerZoom)],c=getCenterCoord(h),h=getAltitude(h);if(a.setLngLat(n.adjustCoord(c,h)),s){const u=getIds(t),d={};u.forEach(e=>{const t=n.getLocalizedStationTitle(e),r=n.stationLookup[e].railway,i=d[t]=d[t]||{};i[n.getLocalizedRailwayTitle(r)]=n.railwayLookup[r].color}),a.setHTML(['<div class="thumbnail-image-container">','<div class="ball-pulse"><div></div><div></div><div></div></div>',`<div class="thumbnail-image" style="background-image: url(\'${n.stationLookup[u[0]].thumbnail}\');"></div>`,"</div>",'<div class="railway-list">',Object.keys(d).map(t=>{var e=Object.keys(d[t]).map(e=>`<div class="line-strip" style="background-color: ${d[t][e]};"></div><span>${e}</span>`).join("<br>");return`<strong>${t}</strong><br>${e}`}).join("<br>"),"</div>"].join(""))}}o&&a.addTo(i)}updateTimetableData(e){const h=this,u=h["clock"],d=buildLookup(e);e.forEach(e=>{const t=h.railwayLookup[e.r],r=e.d===t.ascending?1:-1,{tt:i,pt:n,nt:a}=e,s=i.length;let o=1/0,l,c;n&&n.forEach(e=>{var t=d[e];t&&(e=t.tt,o=Math.min(o,u.getTime(e[e.length-1].a||e[e.length-1].d||i[0].d)-configs.standingDuration),l=l||[],l.push(t))}),a&&(a.forEach(e=>{e=d[e];e&&(c=c||[],c.push(e))}),c&&(i[s-1].d=c[0].tt[0].d)),e.start=Math.min(o,u.getTime(i[0].d)-configs.standingDuration),e.end=u.getTime(i[s-1].a||i[s-1].d||i[Math.max(s-2,0)].d),e.direction=r,e.altitude=t.altitude,e.carComposition=t.carComposition,e.previousTrains=l,e.nextTrains=c})}addStationOutline(e,r){const i=this,n=getIds(e);[13,14,15,16,17,18].forEach(t=>{setLayerProps(i.map,`${r}-${t}`,{data:featureFilter(i.featureCollection,e=>e.zoom===t&&e.ids&&e.ids[0]===n[0]),opacity:1,visible:!0})})}removeStationOutline(t){[13,14,15,16,17,18].forEach(e=>{setLayerProps(this.map,`${t}-${e}`,{visible:!1})})}refreshStationOutline(){const t=performance.now()%1500/1500*2;[13,14,15,16,17,18].forEach(e=>{setLayerProps(this.map,`stations-selected-${e}`,{opacity:t<1?t:2-t,visible:!0})})}setSectionData(e,t,r){const i=this["clock"],n=this.railwayLookup[e.r]["stations"],{direction:a,tt:s}=e,o=(e.ds||[])[0],l=e.delay||0,c=i.getTime();let h,u,d,p,f,m,g,_;if(f=s?(h=valueOrDefault(t,s.reduce((e,t,r)=>t.d&&i.getTime(t.d)+l<=c?r:e,0)),u=s[h],d=s[h+1],p=u.s,d&&d.s):(p=e.fs||e.ts,e.ts||e.fs),0<a?(m=n.indexOf(p),g=n.indexOf(f,m),_=n.indexOf(o,m),-1===_&&(_=n.length-1)):(m=n.lastIndexOf(p),g=n.lastIndexOf(f,m),_=n.lastIndexOf(o,m),-1===_&&(_=0)),s){if(e.timetableIndex=h,e.departureStation=p,e.departureTime=u.d||u.a,0<=m&&0<=g)return e.sectionIndex=m,e.sectionLength=g-m,e.arrivalStation=f,e.arrivalTime=d.a,e.nextDepartureTime=d.d,!0}else{t=numberOrDefault(e.sectionIndex+e.sectionLength,m);if(e.departureStation=p,0<=t&&t!==_&&(!r&&0<=g||r&&0<=_))return e.sectionIndex=t,e.sectionLength=(r?_:g)-t,e.arrivalStation=f===p?n[t+a]:f,!0}e.arrivalStation=e.arrivalTime=e.nextDepartureTime=void 0}}function initContainer(e){var t=createElement("div",{id:"map"},e);return createElement("div",{id:"loader",className:"loader-inner ball-pulse",innerHTML:"<div></div><div></div><div></div>"},e),createElement("div",{id:"loading-error"},e),e.classList.add("mini-tokyo-3d"),t}function hideLoader(e){const t=e.querySelector("#loader");t.style.opacity=0,setTimeout(()=>{t.style.display="none"},1e3)}function showErrorMessage(e){const t=e.querySelector("#loader"),r=e.querySelector("#loading-error");t.style.display="none",r.innerHTML="Loading failed. Please reload the page.",r.style.display="block"}function startTrainAnimation(i,e,n,t,r,a,s){let{maxSpeed:o,acceleration:l,maxAccelerationTime:c,maxAccDistance:h}=configs,u,d;return d=n<=2*h?(u=2*Math.sqrt(n/l),u/2):(u=2*c+(n-2*h)/o,0<r&&(u=clamp$2(u,t||0,r),h=l*u*u/8,n>=2*h?(o=2*n/u,l=2*o/u):o=l*u/2-Math.sqrt(l*(2*h-n))),o/l),animation.start({callback:e=>{var t=u-e;let r;r=e<=d?l/2*e*e:t<=d?n-l/2*t*t:o*(e-d/2),i(r/n)},complete:e,duration:u,start:0<a?s.getHighResTime()-a:void 0,clock:s})}function startFlightAnimation(i,e,n,a,s,t,r){const o=a/Math.abs(s),l=o/2+n/a;return animation.start({callback:e=>{var t=l-e;let r;r=0<s?e<=o?s/2*e*e:a*(e-o/2):t<=o?n+s/2*t*t:a*e,i(r/n)},complete:e,duration:l,start:0<t?r.getHighResTime()-t:void 0,clock:r})}function easeOutQuart(e){return-((e-=1)*e*e*e-1)}function truncateTrainTimetable(e,r,i){const{tt:n,os:t,ds:a}=e;let s=!1;if(t&&r&&t[0]!==r[0]){if(e.os=r,n)for(let e=0,t=n.length;e<t;e++){const o=n[e];if(o.s===r[0]){delete o.a,n.splice(0,e);break}}s=!0}if(a&&i&&a[0]!==i[0]){if(e.ds=i,n)for(let e=0,t=n.length;e<t;e++){const l=n[e];if(l.s===i[0]){l.a=l.a||l.d,delete l.d,n.splice(e+1);break}}s=!0}return s}function getConnectingTrainIds(e){const{nextTrains:t,t:r}=e,i=r?[r]:[];return t?i.concat(...t.map(getConnectingTrainIds)):i}function isTrainOrFlight(e){return e&&includes(["train","flight"],e.type)}function isStation(e){return isFeature(e)}function isEqualObject(e,t){return e===t||!!(e&&e.properties&&t&&t.properties&&e.properties.ids===t.properties.ids)}function setLayerOpacity(e,t,r){const i=e.getLayer(t).implementation,n=valueOrDefault(i.props.opacity,1);animation.start({callback:(e,t)=>{i.setProps({opacity:lerp$3(n,r,e/t)})},duration:configs.transitionDuration})}function getLayerOpacity(e,t,r){t="underground"===t,r="none"===r||"edit"===r;return includes(e,"-ug-")?t?r?1:.005:r?.0625:.005:includes(e,"-og-")?t?r?.25:.1:r?1:.1:includes(e,"-routeug-")?t?1:.125:includes(e,"-routeog-")?t?.25:1:t&&"building-underground"!==e?r?.0625:.025:r?1:.1}class popup{constructor(){this._popup=new Popup({className:"popup-object",closeButton:!1,closeOnClick:!1,maxWidth:"300px",offset:{top:[0,10],bottom:[0,-30]},openingAnimation:{duration:300,easing:"easeOutBack"}})}addTo(e){return this._popup.addTo(e.map),this}remove(){return this._popup.remove(),this}setLngLat(e){return this._popup.setLngLat(e),this}setHTML(e){return this._popup.setHTML(e),this}}class GLTFLoader extends Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new GLTFMaterialsClearcoatExtension(e)}),this.register(function(e){return new GLTFTextureBasisUExtension(e)}),this.register(function(e){return new GLTFTextureWebPExtension(e)}),this.register(function(e){return new GLTFMaterialsSheenExtension(e)}),this.register(function(e){return new GLTFMaterialsTransmissionExtension(e)}),this.register(function(e){return new GLTFMaterialsVolumeExtension(e)}),this.register(function(e){return new GLTFMaterialsIorExtension(e)}),this.register(function(e){return new GLTFMaterialsSpecularExtension(e)}),this.register(function(e){return new GLTFLightsExtension(e)}),this.register(function(e){return new GLTFMeshoptCompression(e)})}load(t,r,e,i){const n=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);function s(e){i?i(e):console.error(e),n.manager.itemError(t),n.manager.itemEnd(t)}const o=new FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(e){try{n.parse(e,a,function(e){r(e),n.manager.itemEnd(t)},s)}catch(e){s(e)}},e,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n;const a={},s={};if("string"==typeof e)n=e;else if(LoaderUtils.decodeText(new Uint8Array(e,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{a[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(e){return void(i&&i(e))}n=a[EXTENSIONS.KHR_BINARY_GLTF].content}else n=LoaderUtils.decodeText(new Uint8Array(e));var o=JSON.parse(n);if(void 0===o.asset||o.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{const h=new GLTFParser(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){var l=this.pluginCallbacks[e](h);s[l.name]=l,a[l.name]=!0}if(o.extensionsUsed)for(let e=0;e<o.extensionsUsed.length;++e){var c=o.extensionsUsed[e];const u=o.extensionsRequired||[];switch(c){case EXTENSIONS.KHR_MATERIALS_UNLIT:a[c]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[c]=new GLTFMaterialsPbrSpecularGlossinessExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:a[c]=new GLTFDracoMeshCompressionExtension(o,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:a[c]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:a[c]=new GLTFMeshQuantizationExtension;break;default:0<=u.indexOf(c)&&void 0===s[c]&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}h.setExtensions(a),h.setPlugins(s),h.parse(r,i)}}}function GLTFRegistry(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class GLTFLightsExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const r=this.parser;var i=this.parser.json.nodes||[];for(let e=0,t=i.length;e<t;e++){var n=i[e];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&r._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser;var r="light:"+e;let i=t.cache.get(r);if(i)return i;var n=t.json;const a=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let s;const o=new Color(16777215);void 0!==a.color&&o.fromArray(a.color);var l=void 0!==a.range?a.range:0;switch(a.type){case"directional":s=new DirectionalLight(o),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new PointLight(o),s.distance=l;break;case"spot":s=new SpotLight(o),s.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,s.angle=a.spot.outerConeAngle,s.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return s.position.set(0,0,0),s.decay=2,void 0!==a.intensity&&(s.intensity=a.intensity),s.name=t.createUniqueName(a.name||"light_"+e),i=Promise.resolve(s),t.cache.add(r,i),i}createNodeAttachment(e){const t=this,r=this.parser;e=r.json.nodes[e];const i=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(e){return r._getNodeRef(t.cache,i,e)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(e,t,r){const i=[];e.color=new Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;return n&&(Array.isArray(n.baseColorFactor)&&(t=n.baseColorFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture))),Promise.all(i)}}class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser;e=r.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const i=[];e=e.extensions[this.name];return void 0!==e.clearcoatFactor&&(t.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&i.push(r.assignTexture(t,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(t.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&i.push(r.assignTexture(t,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(i.push(r.assignTexture(t,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale&&(e=e.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new Vector2(e,e))),Promise.all(i)}}class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser;e=r.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new Color(0,0,0),t.sheenRoughness=0,t.sheen=1;e=e.extensions[this.name];return void 0!==e.sheenColorFactor&&t.sheenColor.fromArray(e.sheenColorFactor),void 0!==e.sheenRoughnessFactor&&(t.sheenRoughness=e.sheenRoughnessFactor),void 0!==e.sheenColorTexture&&i.push(r.assignTexture(t,"sheenColorMap",e.sheenColorTexture)),void 0!==e.sheenRoughnessTexture&&i.push(r.assignTexture(t,"sheenRoughnessMap",e.sheenRoughnessTexture)),Promise.all(i)}}class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser;e=r.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const i=[];e=e.extensions[this.name];return void 0!==e.transmissionFactor&&(t.transmission=e.transmissionFactor),void 0!==e.transmissionTexture&&i.push(r.assignTexture(t,"transmissionMap",e.transmissionTexture)),Promise.all(i)}}class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser;e=r.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const i=[];e=e.extensions[this.name];t.thickness=void 0!==e.thicknessFactor?e.thicknessFactor:0,void 0!==e.thicknessTexture&&i.push(r.assignTexture(t,"thicknessMap",e.thicknessTexture)),t.attenuationDistance=e.attenuationDistance||0;e=e.attenuationColor||[1,1,1];return t.attenuationColor=new Color(e[0],e[1],e[2]),Promise.all(i)}}class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){e=this.parser.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();e=e.extensions[this.name];return t.ior=void 0!==e.ior?e.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser;var i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[];e=i.extensions[this.name];t.specularIntensity=void 0!==e.specularFactor?e.specularFactor:1,void 0!==e.specularTexture&&n.push(r.assignTexture(t,"specularIntensityMap",e.specularTexture));i=e.specularColorFactor||[1,1,1];return t.specularColor=new Color(i[0],i[1],i[2]),void 0!==e.specularColorTexture&&n.push(r.assignTexture(t,"specularColorMap",e.specularColorTexture).then(function(e){e.encoding=sRGBEncoding})),Promise.all(n)}}class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json;var i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var n=i.extensions[this.name],i=r.images[n.source],n=t.options.ktx2Loader;if(n)return t.loadTextureImage(e,i,n);if(r.extensionsRequired&&0<=r.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}}class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const r=this.name,i=this.parser,n=i.json;var e=n.textures[t];if(!e.extensions||!e.extensions[r])return null;e=e.extensions[r];const a=n.images[e.source];let s=i.textureLoader;return!a.uri||null!==(e=i.options.manager.getHandler(a.uri))&&(s=e),this.detectSupport().then(function(e){if(e)return i.loadTextureImage(t,a,s);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(r))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(e){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json;e=t.bufferViews[e];if(e.extensions&&e.extensions[this.name]){const s=e.extensions[this.name];e=this.parser.getDependency("buffer",s.buffer);const o=this.parser.options.meshoptDecoder;if(o&&o.supported)return Promise.all([e,o.ready]).then(function(e){var t=s.byteOffset||0,r=s.byteLength||0,i=s.count,n=s.byteStride,a=new ArrayBuffer(i*n),r=new Uint8Array(e[0],t,r);return o.decodeGltfBuffer(new Uint8Array(a),i,n,r,s.mode,s.filter),a});if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(e){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,BINARY_EXTENSION_HEADER_LENGTH);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var r=this.header.length-BINARY_EXTENSION_HEADER_LENGTH;const i=new DataView(e,BINARY_EXTENSION_HEADER_LENGTH);let n=0;for(;n<r;){var a=i.getUint32(n,!0);n+=4;var s,o=i.getUint32(n,!0);n+=4,o===BINARY_EXTENSION_CHUNK_TYPES.JSON?(s=new Uint8Array(e,BINARY_EXTENSION_HEADER_LENGTH+n,a),this.content=LoaderUtils.decodeText(s)):o===BINARY_EXTENSION_CHUNK_TYPES.BIN&&(o=BINARY_EXTENSION_HEADER_LENGTH+n,this.body=e.slice(o,o+a)),n+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){var r=this.json;const i=this.dracoLoader;var n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes;const s={},o={},l={};for(const p in a){var c=ATTRIBUTES[p]||p.toLowerCase();s[c]=a[p]}for(const f in e.attributes){var h,u,d=ATTRIBUTES[f]||f.toLowerCase();void 0!==a[f]&&(h=r.accessors[e.attributes[f]],u=WEBGL_COMPONENT_TYPES[h.componentType],l[d]=u,o[d]=!0===h.normalized)}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(n){i.decodeDracoFile(e,function(e){for(const r in e.attributes){const i=e.attributes[r];var t=o[r];void 0!==t&&(i.normalized=t)}n(e)},s,l)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class GLTFMeshStandardSGMaterial extends MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){(o.specularMap.value=e)?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){(o.glossinessMap.value=e)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class GLTFMaterialsPbrSpecularGlossinessExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return GLTFMeshStandardSGMaterial}extendParams(e,t,r){var i=t.extensions[this.name];e.color=new Color(1,1,1),e.opacity=1;const n=[];return Array.isArray(i.diffuseFactor)&&(t=i.diffuseFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==i.diffuseTexture&&n.push(r.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture&&(i=i.specularGlossinessTexture,n.push(r.assignTexture(e,"glossinessMap",i)),n.push(r.assignTexture(e,"specularMap",i))),Promise.all(n)}createMaterial(e){const t=new GLTFMeshStandardSGMaterial(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=r[n+e];return t}}GLTFCubicSplineInterpolant.prototype.beforeStart_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.afterEnd_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.interpolate_=function(e,t,r,i){const n=this.resultBuffer;var a=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,c=i-t,i=(r-t)/c,r=i*i,t=r*i,h=e*l,u=h-l,d=-2*t+3*r,p=t-r,f=1-d,m=p-r+i;for(let e=0;e!==s;e++){var g=a[u+e+s],_=a[u+e+o]*c,v=a[h+e+s],y=a[h+e]*c;n[e]=f*g+m*_+d*v+p*y}return n};const _q=new Quaternion;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,t,r,i){i=super.interpolate_(e,t,r,i);return _q.fromArray(i).normalize().toArray(i),i}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),e.DefaultMaterial}function addUnknownExtensionsToUserData(e,t,r){for(const i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function assignExtrasToUserData(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function addMorphTargets(r,i,n){let a=!1,s=!1;for(let e=0,t=i.length;e<t;e++){var o=i[e];if(void 0!==o.POSITION&&(a=!0),void 0!==o.NORMAL&&(s=!0),a&&s)break}if(!a&&!s)return Promise.resolve(r);const l=[],c=[];for(let e=0,t=i.length;e<t;e++){var h,u=i[e];a&&(h=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):r.attributes.position,l.push(h)),s&&(u=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):r.attributes.normal,c.push(u))}return Promise.all([Promise.all(l),Promise.all(c)]).then(function(e){var t=e[0],e=e[1];return a&&(r.morphAttributes.position=t),s&&(r.morphAttributes.normal=e),r.morphTargetsRelative=!0,r})}function updateMorphTargets(r,i){if(r.updateMorphTargets(),void 0!==i.weights)for(let e=0,t=i.weights.length;e<t;e++)r.morphTargetInfluences[e]=i.weights[e];if(i.extras&&Array.isArray(i.extras.targetNames)){var n=i.extras.targetNames;if(r.morphTargetInfluences.length===n.length){r.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++)r.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(e){var t=e.extensions&&e.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+createAttributesKey(t.attributes):e.indices+":"+createAttributesKey(e.attributes)+":"+e.mode,r}function createAttributesKey(r){let i="";var n=Object.keys(r).sort();for(let e=0,t=n.length;e<t;e++)i+=n[e]+":"+r[n[e]]+";";return i}function getNormalizedComponentScale(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class GLTFParser{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new ImageBitmapLoader(this.options.manager):this.textureLoader=new TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(r,e){const i=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(e){const t={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};addUnknownExtensionsToUserData(a,t,n),assignExtrasToUserData(t,n),Promise.all(i._invokeAll(function(e){return e.afterRoot&&e.afterRoot(t)})).then(function(){r(t)})}).catch(e)}_markDefs(){const r=this.json.nodes||[];var i=this.json.skins||[];const n=this.json.meshes||[];for(let e=0,t=i.length;e<t;e++){var a=i[e].joints;for(let e=0,t=a.length;e<t;e++)r[a[e]].isBone=!0}for(let e=0,t=r.length;e<t;e++){var s=r[e];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(n[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const i=r.clone(),a=(e,t)=>{var r,i,n=this.associations.get(e);null!=n&&this.associations.set(t,n);for([r,i]of e.children.entries())a(i,t.children[r])};return a(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(t){const r=Object.values(this.plugins);r.push(this);for(let e=0;e<r.length;e++){var i=t(r[e]);if(i)return i}return null}_invokeAll(t){const r=Object.values(this.plugins);r.unshift(this);const i=[];for(let e=0;e<r.length;e++){var n=t(r[e]);n&&i.push(n)}return i}getDependency(e,t){var r=e+":"+t;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(r){let e=this.cache.get(r);if(!e){const i=this,t=this.json[r+("mesh"===r?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return i.getDependency(r,t)})),this.cache.add(r,e)}return e}loadBuffer(e){const r=this.json.buffers[e],i=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(e,t){i.load(LoaderUtils.resolveURL(r.uri,n.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(e){var t=i.byteLength||0,r=i.byteOffset||0;return e.slice(r,r+t)})}loadAccessor(e){const g=this,_=this.json,v=this.json.accessors[e];if(void 0===v.bufferView&&void 0===v.sparse)return Promise.resolve(null);const t=[];return void 0!==v.bufferView?t.push(this.getDependency("bufferView",v.bufferView)):t.push(null),void 0!==v.sparse&&(t.push(this.getDependency("bufferView",v.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",v.sparse.values.bufferView))),Promise.all(t).then(function(e){var t=e[0],r=WEBGL_TYPE_SIZES[v.type];const i=WEBGL_COMPONENT_TYPES[v.componentType];var n=i.BYTES_PER_ELEMENT,a=n*r,s=v.byteOffset||0,o=void 0!==v.bufferView?_.bufferViews[v.bufferView].byteStride:void 0,l=!0===v.normalized;let c,h;if(o&&o!==a){var u=Math.floor(s/o),a="InterleavedBuffer:"+v.bufferView+":"+v.componentType+":"+u+":"+v.count;let e=g.cache.get(a);e||(c=new i(t,u*o,v.count*o/n),e=new InterleavedBuffer(c,o/n),g.cache.add(a,e)),h=new InterleavedBufferAttribute(e,r,s%o/n,l)}else c=null===t?new i(v.count*r):new i(t,s,v.count*r),h=new BufferAttribute(c,r,l);if(void 0!==v.sparse){n=WEBGL_TYPE_SIZES.SCALAR;const m=WEBGL_COMPONENT_TYPES[v.sparse.indices.componentType];var s=v.sparse.indices.byteOffset||0,l=v.sparse.values.byteOffset||0,d=new m(e[1],s,v.sparse.count*n),p=new i(e[2],l,v.sparse.count*r);null!==t&&(h=new BufferAttribute(h.array.slice(),h.itemSize,h.normalized));for(let e=0,t=d.length;e<t;e++){var f=d[e];if(h.setX(f,p[e*r]),2<=r&&h.setY(f,p[e*r+1]),3<=r&&h.setZ(f,p[e*r+2]),4<=r&&h.setW(f,p[e*r+3]),5<=r)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h})}loadTexture(e){var t=this.json;const r=this.options;var i=t.textures[e],t=t.images[i.source];let n=this.textureLoader;return!t.uri||null!==(i=r.manager.getHandler(t.uri))&&(n=i),this.loadTextureImage(e,t,n)}loadTextureImage(r,t,n){const i=this,a=this.json,s=this.options,o=a.textures[r];var e=(t.uri||t.bufferView)+":"+o.sampler;if(this.textureCache[e])return this.textureCache[e];const l=self.URL||self.webkitURL;let c=t.uri||"",h=!1;if(void 0!==t.bufferView)c=i.getDependency("bufferView",t.bufferView).then(function(e){h=!0;e=new Blob([e],{type:t.mimeType});return c=l.createObjectURL(e),c});else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+r+" is missing URI and bufferView");var u=Promise.resolve(c).then(function(i){return new Promise(function(r,e){let t=r;!0===n.isImageBitmapLoader&&(t=function(e){const t=new Texture(e);t.needsUpdate=!0,r(t)}),n.load(LoaderUtils.resolveURL(i,s.path),t,void 0,e)})}).then(function(e){!0===h&&l.revokeObjectURL(c),e.flipY=!1,o.name&&(e.name=o.name);var t=(a.samplers||{})[o.sampler]||{};return e.magFilter=WEBGL_FILTERS[t.magFilter]||LinearFilter,e.minFilter=WEBGL_FILTERS[t.minFilter]||LinearMipmapLinearFilter,e.wrapS=WEBGL_WRAPPINGS[t.wrapS]||RepeatWrapping,e.wrapT=WEBGL_WRAPPINGS[t.wrapT]||RepeatWrapping,i.associations.set(e,{textures:r}),e}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",c),null});return this.textureCache[e]=u}assignTexture(i,n,a){const s=this;return this.getDependency("texture",a.index).then(function(e){var t,r;return void 0===a.texCoord||0==a.texCoord||"aoMap"===n&&1==a.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+a.texCoord+" for texture "+n+" not yet supported."),!s.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]||(t=void 0!==a.extensions?a.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0)&&(r=s.associations.get(e),e=s.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),s.associations.set(e,r)),i[n]=e})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;var i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){var s="PointsMaterial:"+r.uuid;let e=this.cache.get(s);e||(e=new PointsMaterial,Material.prototype.copy.call(e,r),e.color.copy(r.color),e.map=r.map,e.sizeAttenuation=!1,this.cache.add(s,e)),r=e}else if(e.isLine){s="LineBasicMaterial:"+r.uuid;let e=this.cache.get(s);e||(e=new LineBasicMaterial,Material.prototype.copy.call(e,r),e.color.copy(r.color),this.cache.add(s,e)),r=e}if(i||n||a){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=r}getMaterialType(){return MeshStandardMaterial}loadMaterial(t){const r=this;var e=this.json;const i=this.extensions,n=e.materials[t];let a;const s={};e=n.extensions||{};const o=[];if(e[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const c=i[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=c.getMaterialType(),o.push(c.extendParams(s,n,r))}else if(e[EXTENSIONS.KHR_MATERIALS_UNLIT]){const h=i[EXTENSIONS.KHR_MATERIALS_UNLIT];a=h.getMaterialType(),o.push(h.extendParams(s,n,r))}else{var l=n.pbrMetallicRoughness||{};s.color=new Color(1,1,1),s.opacity=1,Array.isArray(l.baseColorFactor)&&(e=l.baseColorFactor,s.color.fromArray(e),s.opacity=e[3]),void 0!==l.baseColorTexture&&o.push(r.assignTexture(s,"map",l.baseColorTexture)),s.metalness=void 0!==l.metallicFactor?l.metallicFactor:1,s.roughness=void 0!==l.roughnessFactor?l.roughnessFactor:1,void 0!==l.metallicRoughnessTexture&&(o.push(r.assignTexture(s,"metalnessMap",l.metallicRoughnessTexture)),o.push(r.assignTexture(s,"roughnessMap",l.metallicRoughnessTexture))),a=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),o.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,s)})))}!0===n.doubleSided&&(s.side=DoubleSide);l=n.alphaMode||ALPHA_MODES.OPAQUE;return l===ALPHA_MODES.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.format=RGBFormat,s.transparent=!1,l===ALPHA_MODES.MASK&&(s.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&a!==MeshBasicMaterial&&(o.push(r.assignTexture(s,"normalMap",n.normalTexture)),s.normalScale=new Vector2(1,1),void 0!==n.normalTexture.scale&&(l=n.normalTexture.scale,s.normalScale.set(l,l))),void 0!==n.occlusionTexture&&a!==MeshBasicMaterial&&(o.push(r.assignTexture(s,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(s.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&a!==MeshBasicMaterial&&(s.emissive=(new Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&a!==MeshBasicMaterial&&o.push(r.assignTexture(s,"emissiveMap",n.emissiveTexture)),Promise.all(o).then(function(){let e;return e=a===GLTFMeshStandardSGMaterial?i[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new a(s),n.name&&(e.name=n.name),e.map&&(e.map.encoding=sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=sRGBEncoding),assignExtrasToUserData(e,n),r.associations.set(e,{materials:t}),n.extensions&&addUnknownExtensionsToUserData(i,e,n),e})}createUniqueName(e){var t=PropertyBinding.sanitizeNodeName(e||"");let r=t;for(let e=1;this.nodeNamesUsed[r];++e)r=t+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(r){const i=this,n=this.extensions,a=this.primitiveCache;const s=[];for(let e=0,t=r.length;e<t;e++){var o=r[e],l=createPrimitiveKey(o),c=a[l];if(c)s.push(c.promise);else{let e;e=o.extensions&&o.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?function(t){return n[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,i).then(function(e){return addPrimitiveAttributes(e,t,i)})}(o):addPrimitiveAttributes(new BufferGeometry,o,i),a[l]={primitive:o,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(c){const h=this;var e=this.json;const u=this.extensions,d=e.meshes[c],p=d.primitives,r=[];for(let e=0,t=p.length;e<t;e++){var i=void 0===p[e].material?createDefaultMaterial(this.cache):this.getDependency("material",p[e].material);r.push(i)}return r.push(h.loadGeometries(p)),Promise.all(r).then(function(e){var r=e.slice(0,e.length-1),i=e[e.length-1];const n=[];for(let t=0,e=i.length;t<e;t++){var a=i[t],s=p[t];let e;var o=r[t];if(s.mode===WEBGL_CONSTANTS.TRIANGLES||s.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||s.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||void 0===s.mode)e=new(!0===d.isSkinnedMesh?SkinnedMesh:Mesh)(a,o),!0!==e.isSkinnedMesh||e.geometry.attributes.skinWeight.normalized||e.normalizeSkinWeights(),s.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?e.geometry=toTrianglesDrawMode(e.geometry,TriangleStripDrawMode):s.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(e.geometry=toTrianglesDrawMode(e.geometry,TriangleFanDrawMode));else if(s.mode===WEBGL_CONSTANTS.LINES)e=new LineSegments(a,o);else if(s.mode===WEBGL_CONSTANTS.LINE_STRIP)e=new Line(a,o);else if(s.mode===WEBGL_CONSTANTS.LINE_LOOP)e=new LineLoop(a,o);else{if(s.mode!==WEBGL_CONSTANTS.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+s.mode);e=new Points(a,o)}0<Object.keys(e.geometry.morphAttributes).length&&updateMorphTargets(e,d),e.name=h.createUniqueName(d.name||"mesh_"+c),assignExtrasToUserData(e,d),s.extensions&&addUnknownExtensionsToUserData(u,e,s),h.assignFinalMaterial(e),n.push(e)}for(let e=0,t=n.length;e<t;e++)h.associations.set(n[e],{meshes:c,primitives:e});if(1===n.length)return n[0];const l=new Group;h.associations.set(l,{meshes:c});for(let e=0,t=n.length;e<t;e++)l.add(n[e]);return l})}loadCamera(e){let t;var r=this.json.cameras[e],e=r[r.type];if(e)return"perspective"===r.type?t=new PerspectiveCamera(MathUtils.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===r.type&&(t=new OrthographicCamera(-e.xmag,e.xmag,e.ymag,-e.ymag,e.znear,e.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),assignExtrasToUserData(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){e=this.json.skins[e];const t={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",e.inverseBindMatrices).then(function(e){return t.inverseBindMatrices=e,t})}loadAnimation(t){const y=this.json.animations[t],r=[],i=[],n=[],a=[],s=[];for(let e=0,t=y.channels.length;e<t;e++){var o=y.channels[e],l=y.samplers[o.sampler],c=o.target,h=void 0!==c.node?c.node:c.id,u=void 0!==y.parameters?y.parameters[l.input]:l.input,o=void 0!==y.parameters?y.parameters[l.output]:l.output;r.push(this.getDependency("node",h)),i.push(this.getDependency("accessor",u)),n.push(this.getDependency("accessor",o)),a.push(l),s.push(c)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(n),Promise.all(a),Promise.all(s)]).then(function(e){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4];const o=[];for(let e=0,t=r.length;e<t;e++){const m=r[e];var l=i[e],c=n[e],h=a[e],u=s[e];if(void 0!==m){m.updateMatrix(),m.matrixAutoUpdate=!0;let r;switch(PATH_PROPERTIES[u.path]){case PATH_PROPERTIES.weights:r=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:r=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:default:r=VectorKeyframeTrack}var d=m.name||m.uuid,p=void 0!==h.interpolation?INTERPOLATION[h.interpolation]:InterpolateLinear;const g=[];PATH_PROPERTIES[u.path]===PATH_PROPERTIES.weights?m.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&g.push(e.name||e.uuid)}):g.push(d);let i=c.array;if(c.normalized){var f=getNormalizedComponentScale(i.constructor);const _=new Float32Array(i.length);for(let e=0,t=i.length;e<t;e++)_[e]=i[e]*f;i=_}for(let e=0,t=g.length;e<t;e++){const v=new r(g[e]+"."+PATH_PROPERTIES[u.path],l.array,i,p);"CUBICSPLINE"===h.interpolation&&(v.createInterpolant=function(e){const t=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new t(this.times,this.values,this.getValueSize()/3,e)},v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),o.push(v)}}}e=y.name||"animation_"+t;return new AnimationClip(e,void 0,o)})}createNodeMesh(e){var t=this.json;const r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(e){const t=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(r){if(r.isMesh)for(let e=0,t=i.weights.length;e<t;e++)r.morphTargetInfluences[e]=i.weights[e]}),t})}loadNode(n){var e=this.json;const t=this.extensions,a=this,s=e.nodes[n],o=s.name?a.createUniqueName(s.name):"";return function(){const t=[];var e=a._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(n)});return e&&t.push(e),void 0!==s.camera&&t.push(a.getDependency("camera",s.camera).then(function(e){return a._getNodeRef(a.cameraCache,s.camera,e)})),a._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(n)}).forEach(function(e){t.push(e)}),Promise.all(t)}().then(function(r){let i;if(i=!0===s.isBone?new Bone:1<r.length?new Group:1===r.length?r[0]:new Object3D,i!==r[0])for(let e=0,t=r.length;e<t;e++)i.add(r[e]);if(s.name&&(i.userData.name=s.name,i.name=o),assignExtrasToUserData(i,s),s.extensions&&addUnknownExtensionsToUserData(t,i,s),void 0!==s.matrix){const e=new Matrix4;e.fromArray(s.matrix),i.applyMatrix4(e)}else void 0!==s.translation&&i.position.fromArray(s.translation),void 0!==s.rotation&&i.quaternion.fromArray(s.rotation),void 0!==s.scale&&i.scale.fromArray(s.scale);return a.associations.has(i)||a.associations.set(i,{}),a.associations.get(i).nodes=n,i})}loadScene(e){var r=this.json,t=this.extensions,e=this.json.scenes[e];const n=this,i=new Group;e.name&&(i.name=n.createUniqueName(e.name)),assignExtrasToUserData(i,e),e.extensions&&addUnknownExtensionsToUserData(t,i,e);var a=e.nodes||[];const s=[];for(let e=0,t=a.length;e<t;e++)s.push(buildNodeHierarchy(a[e],i,r,n));return Promise.all(s).then(function(){return n.associations=(e=>{const r=new Map;for(var[t,i]of n.associations)(t instanceof Material||t instanceof Texture)&&r.set(t,i);return e.traverse(e=>{var t=n.associations.get(e);null!=t&&r.set(e,t)}),r})(i),i})}}function buildNodeHierarchy(e,t,s,l){const c=s.nodes[e];return l.getDependency("node",e).then(function(e){if(void 0===c.skin)return e;let o;return l.getDependency("skin",c.skin).then(function(e){o=e;const r=[];for(let e=0,t=o.joints.length;e<t;e++)r.push(l.getDependency("node",o.joints[e]));return Promise.all(r)}).then(function(s){return e.traverse(function(e){if(e.isMesh){const i=[],n=[];for(let e=0,t=s.length;e<t;e++){var r=s[e];if(r){i.push(r);const a=new Matrix4;void 0!==o.inverseBindMatrices&&a.fromArray(o.inverseBindMatrices.array,16*e),n.push(a)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[e])}e.bind(new Skeleton(i,n),e.matrixWorld)}}),e})}).then(function(r){t.add(r);const i=[];if(c.children){var n=c.children;for(let e=0,t=n.length;e<t;e++){var a=n[e];i.push(buildNodeHierarchy(a,r,s,l))}}return Promise.all(i)})}function computeBounds(e,t,r){var i=t.attributes;const n=new Box3;if(void 0!==i.POSITION){var a=r.json.accessors[i.POSITION],s=a.min,i=a.max;if(void 0!==s&&void 0!==i){n.set(new Vector3(s[0],s[1],s[2]),new Vector3(i[0],i[1],i[2])),a.normalized&&(a=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[a.componentType]),n.min.multiplyScalar(a),n.max.multiplyScalar(a));var o=t.targets;if(void 0!==o){const d=new Vector3,p=new Vector3;for(let e=0,t=o.length;e<t;e++){var l,c,h=o[e];void 0!==h.POSITION&&(l=(c=r.json.accessors[h.POSITION]).min,h=c.max,void 0!==l&&void 0!==h?(p.setX(Math.max(Math.abs(l[0]),Math.abs(h[0]))),p.setY(Math.max(Math.abs(l[1]),Math.abs(h[1]))),p.setZ(Math.max(Math.abs(l[2]),Math.abs(h[2]))),c.normalized&&(c=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[c.componentType]),p.multiplyScalar(c)),d.max(p)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}n.expandByVector(d)}e.boundingBox=n;const u=new Sphere;n.getCenter(u.center),u.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=u}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function addPrimitiveAttributes(r,e,i){var t,n=e.attributes;const a=[];for(const o in n){var s=ATTRIBUTES[o]||o.toLowerCase();s in r.attributes||a.push(function(e,t){return i.getDependency("accessor",e).then(function(e){r.setAttribute(t,e)})}(n[o],s))}return void 0===e.indices||r.index||(t=i.getDependency("accessor",e.indices).then(function(e){r.setIndex(e)}),a.push(t)),assignExtrasToUserData(r,e),computeBounds(r,e,i),Promise.all(a).then(function(){return void 0!==e.targets?addMorphTargets(r,e.targets,i):r})}function toTrianglesDrawMode(e,t){let r=e.getIndex();if(null===r){const o=[];var i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)o.push(e);e.setIndex(o),r=e.getIndex()}var n=r.count-2;const a=[];if(t===TriangleFanDrawMode)for(let e=1;e<=n;e++)a.push(r.getX(0)),a.push(r.getX(e)),a.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(a.push(r.getX(e)),a.push(r.getX(e+1)),a.push(r.getX(e+2))):(a.push(r.getX(e+2)),a.push(r.getX(e+1)),a.push(r.getX(e)));a.length/3!=n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(a),s}function styleInject(e,t){var r,i=(t=void 0===t?{}:t).insertAt;e&&"undefined"!=typeof document&&(r=document.head||document.getElementsByTagName("head")[0],(t=document.createElement("style")).type="text/css","top"===i&&r.firstChild?r.insertBefore(t,r.firstChild):r.appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)))}var css_248z$2="@keyframes scale {\n  0% {\n    transform: scale(1);\n    opacity: 1; }\n  45% {\n    transform: scale(0.1);\n    opacity: 0.7; }\n  80% {\n    transform: scale(1);\n    opacity: 1; } }\n\n.ball-pulse > div:nth-child(0) {\n  animation: scale 0.75s -0.36s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08); }\n\n.ball-pulse > div:nth-child(1) {\n  animation: scale 0.75s -0.24s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08); }\n\n.ball-pulse > div:nth-child(2) {\n  animation: scale 0.75s -0.12s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08); }\n\n.ball-pulse > div:nth-child(3) {\n  animation: scale 0.75s 0s infinite cubic-bezier(0.2, 0.68, 0.18, 1.08); }\n\n.ball-pulse > div {\n  background-color: #fff;\n  width: 15px;\n  height: 15px;\n  border-radius: 100%;\n  margin: 2px;\n  animation-fill-mode: both;\n  display: inline-block; }\n";styleInject(css_248z$2);var css_248z$1="@font-face {\n  font-family: 'swiper-icons';\n  src: url(\"data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA\") format(\"woff\");\n  font-weight: 400;\n  font-style: normal; }\n\n:root {\n  --swiper-theme-color: #007aff; }\n\n.swiper {\n  margin-left: auto;\n  margin-right: auto;\n  position: relative;\n  overflow: hidden;\n  list-style: none;\n  padding: 0;\n  /* Fix of Webkit flickering */\n  z-index: 1; }\n\n.swiper-vertical > .swiper-wrapper {\n  flex-direction: column; }\n\n.swiper-wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  z-index: 1;\n  display: flex;\n  transition-property: transform;\n  box-sizing: content-box; }\n\n.swiper-android .swiper-slide,\n.swiper-wrapper {\n  transform: translate3d(0px, 0, 0); }\n\n.swiper-pointer-events {\n  touch-action: pan-y; }\n\n.swiper-pointer-events.swiper-vertical {\n    touch-action: pan-x; }\n\n.swiper-slide {\n  flex-shrink: 0;\n  width: 100%;\n  height: 100%;\n  position: relative;\n  transition-property: transform; }\n\n.swiper-slide-invisible-blank {\n  visibility: hidden; }\n\n/* Auto Height */\n\n.swiper-autoheight,\n.swiper-autoheight .swiper-slide {\n  height: auto; }\n\n.swiper-autoheight .swiper-wrapper {\n  align-items: flex-start;\n  transition-property: transform, height; }\n\n/* 3D Effects */\n\n.swiper-3d,\n.swiper-3d.swiper-css-mode .swiper-wrapper {\n  perspective: 1200px; }\n\n.swiper-3d .swiper-wrapper,\n.swiper-3d .swiper-slide,\n.swiper-3d .swiper-slide-shadow,\n.swiper-3d .swiper-slide-shadow-left,\n.swiper-3d .swiper-slide-shadow-right,\n.swiper-3d .swiper-slide-shadow-top,\n.swiper-3d .swiper-slide-shadow-bottom,\n.swiper-3d .swiper-cube-shadow {\n  transform-style: preserve-3d; }\n\n.swiper-3d .swiper-slide-shadow,\n.swiper-3d .swiper-slide-shadow-left,\n.swiper-3d .swiper-slide-shadow-right,\n.swiper-3d .swiper-slide-shadow-top,\n.swiper-3d .swiper-slide-shadow-bottom {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  z-index: 10; }\n\n.swiper-3d .swiper-slide-shadow {\n  background: rgba(0, 0, 0, 0.15); }\n\n.swiper-3d .swiper-slide-shadow-left {\n  background-image: linear-gradient(to left, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); }\n\n.swiper-3d .swiper-slide-shadow-right {\n  background-image: linear-gradient(to right, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); }\n\n.swiper-3d .swiper-slide-shadow-top {\n  background-image: linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); }\n\n.swiper-3d .swiper-slide-shadow-bottom {\n  background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0)); }\n\n/* CSS Mode */\n\n.swiper-css-mode > .swiper-wrapper {\n  overflow: auto;\n  scrollbar-width: none;\n  /* For Firefox */\n  -ms-overflow-style: none;\n  /* For Internet Explorer and Edge */ }\n\n.swiper-css-mode > .swiper-wrapper::-webkit-scrollbar {\n    display: none; }\n\n.swiper-css-mode > .swiper-wrapper > .swiper-slide {\n  scroll-snap-align: start start; }\n\n.swiper-horizontal.swiper-css-mode > .swiper-wrapper {\n  scroll-snap-type: x mandatory; }\n\n.swiper-vertical.swiper-css-mode > .swiper-wrapper {\n  scroll-snap-type: y mandatory; }\n\n.swiper-centered > .swiper-wrapper::before {\n  content: '';\n  flex-shrink: 0;\n  order: 9999; }\n\n.swiper-centered.swiper-horizontal > .swiper-wrapper > .swiper-slide:first-child {\n  margin-inline-start: var(--swiper-centered-offset-before); }\n\n.swiper-centered.swiper-horizontal > .swiper-wrapper::before {\n  height: 100%;\n  width: var(--swiper-centered-offset-after); }\n\n.swiper-centered.swiper-vertical > .swiper-wrapper > .swiper-slide:first-child {\n  margin-block-start: var(--swiper-centered-offset-before); }\n\n.swiper-centered.swiper-vertical > .swiper-wrapper::before {\n  width: 100%;\n  height: var(--swiper-centered-offset-after); }\n\n.swiper-centered > .swiper-wrapper > .swiper-slide {\n  scroll-snap-align: center center; }\n\n:root {\n  /*\n  --swiper-pagination-color: var(--swiper-theme-color);\n  --swiper-pagination-bullet-size: 8px;\n  --swiper-pagination-bullet-width: 8px;\n  --swiper-pagination-bullet-height: 8px;\n  --swiper-pagination-bullet-inactive-color: #000;\n  --swiper-pagination-bullet-inactive-opacity: 0.2;\n  --swiper-pagination-bullet-opacity: 1;\n  --swiper-pagination-bullet-horizontal-gap: 4px;\n  --swiper-pagination-bullet-vertical-gap: 6px;\n  */ }\n\n.swiper-pagination {\n  position: absolute;\n  text-align: center;\n  transition: 300ms opacity;\n  transform: translate3d(0, 0, 0);\n  z-index: 10; }\n\n.swiper-pagination.swiper-pagination-hidden {\n    opacity: 0; }\n\n/* Common Styles */\n\n.swiper-pagination-fraction,\n.swiper-pagination-custom,\n.swiper-horizontal > .swiper-pagination-bullets,\n.swiper-pagination-bullets.swiper-pagination-horizontal {\n  bottom: 10px;\n  left: 0;\n  width: 100%; }\n\n/* Bullets */\n\n.swiper-pagination-bullets-dynamic {\n  overflow: hidden;\n  font-size: 0; }\n\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n    transform: scale(0.33);\n    position: relative; }\n\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active {\n    transform: scale(1); }\n\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main {\n    transform: scale(1); }\n\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev {\n    transform: scale(0.66); }\n\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev {\n    transform: scale(0.33); }\n\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next {\n    transform: scale(0.66); }\n\n.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next {\n    transform: scale(0.33); }\n\n.swiper-pagination-bullet {\n  width: var(--swiper-pagination-bullet-width, var(--swiper-pagination-bullet-size, 8px));\n  height: var(--swiper-pagination-bullet-height, var(--swiper-pagination-bullet-size, 8px));\n  display: inline-block;\n  border-radius: 50%;\n  background: var(--swiper-pagination-bullet-inactive-color, #000);\n  opacity: var(--swiper-pagination-bullet-inactive-opacity, 0.2); }\n\nbutton.swiper-pagination-bullet {\n    border: none;\n    margin: 0;\n    padding: 0;\n    box-shadow: none;\n    appearance: none; }\n\n.swiper-pagination-clickable .swiper-pagination-bullet {\n    cursor: pointer; }\n\n.swiper-pagination-bullet:only-child {\n    display: none !important; }\n\n.swiper-pagination-bullet-active {\n  opacity: var(--swiper-pagination-bullet-opacity, 1);\n  background: var(--swiper-pagination-color, var(--swiper-theme-color)); }\n\n.swiper-vertical > .swiper-pagination-bullets,\n.swiper-pagination-vertical.swiper-pagination-bullets {\n  right: 10px;\n  top: 50%;\n  transform: translate3d(0px, -50%, 0); }\n\n.swiper-vertical > .swiper-pagination-bullets .swiper-pagination-bullet,\n  .swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet {\n    margin: var(--swiper-pagination-bullet-vertical-gap, 6px) 0;\n    display: block; }\n\n.swiper-vertical > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic,\n  .swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic {\n    top: 50%;\n    transform: translateY(-50%);\n    width: 8px; }\n\n.swiper-vertical > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,\n    .swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n      display: inline-block;\n      transition: 200ms transform, 200ms top; }\n\n.swiper-horizontal > .swiper-pagination-bullets .swiper-pagination-bullet,\n.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet {\n  margin: 0 var(--swiper-pagination-bullet-horizontal-gap, 4px); }\n\n.swiper-horizontal > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic,\n.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic {\n  left: 50%;\n  transform: translateX(-50%);\n  white-space: nowrap; }\n\n.swiper-horizontal > .swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,\n  .swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n    transition: 200ms transform, 200ms left; }\n\n.swiper-horizontal.swiper-rtl > .swiper-pagination-bullets-dynamic .swiper-pagination-bullet {\n  transition: 200ms transform, 200ms right; }\n\n/* Progress */\n\n.swiper-pagination-progressbar {\n  background: rgba(0, 0, 0, 0.25);\n  position: absolute; }\n\n.swiper-pagination-progressbar .swiper-pagination-progressbar-fill {\n    background: var(--swiper-pagination-color, var(--swiper-theme-color));\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    transform: scale(0);\n    transform-origin: left top; }\n\n.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill {\n    transform-origin: right top; }\n\n.swiper-horizontal > .swiper-pagination-progressbar, .swiper-pagination-progressbar.swiper-pagination-horizontal,\n  .swiper-vertical > .swiper-pagination-progressbar.swiper-pagination-progressbar-opposite, .swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite {\n    width: 100%;\n    height: 4px;\n    left: 0;\n    top: 0; }\n\n.swiper-vertical > .swiper-pagination-progressbar, .swiper-pagination-progressbar.swiper-pagination-vertical,\n  .swiper-horizontal > .swiper-pagination-progressbar.swiper-pagination-progressbar-opposite, .swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite {\n    width: 4px;\n    height: 100%;\n    left: 0;\n    top: 0; }\n\n.swiper-pagination-lock {\n  display: none; }\n";styleInject(css_248z$1);var css_248z=".mapboxgl-map {\n    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n    overflow: hidden;\n    position: relative;\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.mapboxgl-canvas {\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n.mapboxgl-map:-webkit-full-screen {\n    width: 100%;\n    height: 100%;\n}\n\n.mapboxgl-canary {\n    background-color: salmon;\n}\n\n.mapboxgl-canvas-container.mapboxgl-interactive,\n.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass {\n    cursor: grab;\n    -webkit-user-select: none;\n    user-select: none;\n}\n\n.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer {\n    cursor: pointer;\n}\n\n.mapboxgl-canvas-container.mapboxgl-interactive:active,\n.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active {\n    cursor: grabbing;\n}\n\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas {\n    touch-action: pan-x pan-y;\n}\n\n.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,\n.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas {\n    touch-action: pinch-zoom;\n}\n\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas {\n    touch-action: none;\n}\n\n.mapboxgl-ctrl-top-left,\n.mapboxgl-ctrl-top-right,\n.mapboxgl-ctrl-bottom-left,\n.mapboxgl-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n\n.mapboxgl-ctrl-top-left     { top: 0; left: 0; }\n\n.mapboxgl-ctrl-top-right    { top: 0; right: 0; }\n\n.mapboxgl-ctrl-bottom-left  { bottom: 0; left: 0; }\n\n.mapboxgl-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.mapboxgl-ctrl {\n    clear: both;\n    pointer-events: auto;\n\n    /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n    transform: translate(0, 0);\n}\n\n.mapboxgl-ctrl-top-left .mapboxgl-ctrl     { margin: 10px 0 0 10px; float: left; }\n\n.mapboxgl-ctrl-top-right .mapboxgl-ctrl    { margin: 10px 10px 0 0; float: right; }\n\n.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl  { margin: 0 0 10px 10px; float: left; }\n\n.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl { margin: 0 10px 10px 0; float: right; }\n\n.mapboxgl-ctrl-group {\n    border-radius: 4px;\n    background: #fff;\n}\n\n.mapboxgl-ctrl-group:not(:empty) {\n    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);\n}\n\n@media (-ms-high-contrast: active) {\n    .mapboxgl-ctrl-group:not(:empty) {\n        box-shadow: 0 0 0 2px ButtonText;\n    }\n}\n\n.mapboxgl-ctrl-group button {\n    width: 29px;\n    height: 29px;\n    display: block;\n    padding: 0;\n    outline: none;\n    border: 0;\n    box-sizing: border-box;\n    background-color: transparent;\n    cursor: pointer;\n    overflow: hidden;\n}\n\n.mapboxgl-ctrl-group button + button {\n    border-top: 1px solid #ddd;\n}\n\n.mapboxgl-ctrl button .mapboxgl-ctrl-icon {\n    display: block;\n    width: 100%;\n    height: 100%;\n    background-repeat: no-repeat;\n    background-position: center center;\n}\n\n@media (-ms-high-contrast: active) {\n    .mapboxgl-ctrl-icon {\n        background-color: transparent;\n    }\n\n    .mapboxgl-ctrl-group button + button {\n        border-top: 1px solid ButtonText;\n    }\n}\n\n.mapboxgl-ctrl-attrib-button:focus,\n.mapboxgl-ctrl-group button:focus {\n    box-shadow: 0 0 2px 2px rgba(0, 150, 255, 1);\n}\n\n.mapboxgl-ctrl button:disabled {\n    cursor: not-allowed;\n}\n\n.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon {\n    opacity: 0.25;\n}\n\n.mapboxgl-ctrl button:not(:disabled):hover {\n    background-color: rgba(0, 0, 0, 0.05);\n}\n\n.mapboxgl-ctrl-group button:focus:focus-visible {\n    box-shadow: 0 0 2px 2px rgba(0, 150, 255, 1);\n}\n\n.mapboxgl-ctrl-group button:focus:not(:focus-visible) {\n    box-shadow: none;\n}\n\n.mapboxgl-ctrl-group button:focus:first-child {\n    border-radius: 4px 4px 0 0;\n}\n\n.mapboxgl-ctrl-group button:focus:last-child {\n    border-radius: 0 0 4px 4px;\n}\n\n.mapboxgl-ctrl-group button:focus:only-child {\n    border-radius: inherit;\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E %3C/svg%3E\");\n}\n\n@media (-ms-high-contrast: active) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E %3C/svg%3E\");\n    }\n}\n\n@media (-ms-high-contrast: black-on-white) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E %3C/svg%3E\");\n    }\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E %3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E %3C/svg%3E\");\n}\n\n@media (-ms-high-contrast: active) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E %3C/svg%3E\");\n    }\n}\n\n@media (-ms-high-contrast: black-on-white) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E %3C/svg%3E\");\n    }\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E %3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E %3C/svg%3E\");\n}\n\n@media (-ms-high-contrast: active) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon {\n\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E %3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E %3C/svg%3E\");\n    }\n}\n\n@media (-ms-high-contrast: black-on-white) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E %3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E %3C/svg%3E\");\n    }\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon {\n    animation: mapboxgl-spin 2s infinite linear;\n}\n\n@media (-ms-high-contrast: active) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n    }\n}\n\n@media (-ms-high-contrast: black-on-white) {\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E\");\n    }\n\n    .mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E %3C/svg%3E\");\n    }\n}\n\n@keyframes mapboxgl-spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\na.mapboxgl-ctrl-logo {\n    width: 88px;\n    height: 23px;\n    margin: 0 0 -4px -4px;\n    display: block;\n    background-repeat: no-repeat;\n    cursor: pointer;\n    overflow: hidden;\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='0.9' fill='%23fff'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E\");\n}\n\na.mapboxgl-ctrl-logo.mapboxgl-compact {\n    width: 23px;\n}\n\n@media (-ms-high-contrast: active) {\n    a.mapboxgl-ctrl-logo {\n\n        background-color: transparent;\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='1' fill='%23fff'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E\");\n    }\n}\n\n@media (-ms-high-contrast: black-on-white) {\n    a.mapboxgl-ctrl-logo {\n\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='1' fill='%23000'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E\");\n    }\n}\n\n.mapboxgl-ctrl.mapboxgl-ctrl-attrib {\n    padding: 0 5px;\n    background-color: rgba(255, 255, 255, 0.5);\n    margin: 0;\n}\n\n@media screen {\n    .mapboxgl-ctrl-attrib.mapboxgl-compact {\n        min-height: 20px;\n        padding: 2px 24px 2px 0;\n        margin: 10px;\n        position: relative;\n        background-color: #fff;\n        border-radius: 12px;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact-show {\n        padding: 2px 28px 2px 8px;\n        visibility: visible;\n    }\n\n    .mapboxgl-ctrl-top-left > .mapboxgl-ctrl-attrib.mapboxgl-compact-show,\n    .mapboxgl-ctrl-bottom-left > .mapboxgl-ctrl-attrib.mapboxgl-compact-show {\n        padding: 2px 8px 2px 28px;\n        border-radius: 12px;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner {\n        display: none;\n    }\n\n    .mapboxgl-ctrl-attrib-button {\n        display: none;\n        cursor: pointer;\n        position: absolute;\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E %3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E %3C/svg%3E\");\n        background-color: rgba(255, 255, 255, 0.5);\n        width: 24px;\n        height: 24px;\n        box-sizing: border-box;\n        border-radius: 12px;\n        outline: none;\n        top: 0;\n        right: 0;\n        border: 0;\n    }\n\n    .mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button,\n    .mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button {\n        left: 0;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button,\n    .mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner {\n        display: block;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button {\n        background-color: rgba(0, 0, 0, 0.05);\n    }\n\n    .mapboxgl-ctrl-bottom-right > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        bottom: 0;\n        right: 0;\n    }\n\n    .mapboxgl-ctrl-top-right > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        top: 0;\n        right: 0;\n    }\n\n    .mapboxgl-ctrl-top-left > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        top: 0;\n        left: 0;\n    }\n\n    .mapboxgl-ctrl-bottom-left > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        bottom: 0;\n        left: 0;\n    }\n}\n\n@media screen and (-ms-high-contrast: active) {\n    .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E %3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E %3C/svg%3E\");\n    }\n}\n\n@media screen and (-ms-high-contrast: black-on-white) {\n    .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E %3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E %3C/svg%3E\");\n    }\n}\n\n.mapboxgl-ctrl-attrib a {\n    color: rgba(0, 0, 0, 0.75);\n    text-decoration: none;\n}\n\n.mapboxgl-ctrl-attrib a:hover {\n    color: inherit;\n    text-decoration: underline;\n}\n\n/* stylelint-disable-next-line selector-class-pattern */\n\n.mapboxgl-ctrl-attrib .mapbox-improve-map {\n    font-weight: bold;\n    margin-left: 2px;\n}\n\n.mapboxgl-attrib-empty {\n    display: none;\n}\n\n.mapboxgl-ctrl-scale {\n    background-color: rgba(255, 255, 255, 0.75);\n    font-size: 10px;\n    border-width: medium 2px 2px;\n    border-style: none solid solid;\n    border-color: #333;\n    padding: 0 5px;\n    color: #333;\n    box-sizing: border-box;\n}\n\n.mapboxgl-popup {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: flex;\n    will-change: transform;\n    pointer-events: none;\n}\n\n.mapboxgl-popup-anchor-top,\n.mapboxgl-popup-anchor-top-left,\n.mapboxgl-popup-anchor-top-right {\n    flex-direction: column;\n}\n\n.mapboxgl-popup-anchor-bottom,\n.mapboxgl-popup-anchor-bottom-left,\n.mapboxgl-popup-anchor-bottom-right {\n    flex-direction: column-reverse;\n}\n\n.mapboxgl-popup-anchor-left {\n    flex-direction: row;\n}\n\n.mapboxgl-popup-anchor-right {\n    flex-direction: row-reverse;\n}\n\n.mapboxgl-popup-tip {\n    width: 0;\n    height: 0;\n    border: 10px solid transparent;\n    z-index: 1;\n}\n\n.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {\n    align-self: center;\n    border-top: none;\n    border-bottom-color: #fff;\n}\n\n.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {\n    align-self: flex-start;\n    border-top: none;\n    border-left: none;\n    border-bottom-color: #fff;\n}\n\n.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {\n    align-self: flex-end;\n    border-top: none;\n    border-right: none;\n    border-bottom-color: #fff;\n}\n\n.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {\n    align-self: center;\n    border-bottom: none;\n    border-top-color: #fff;\n}\n\n.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {\n    align-self: flex-start;\n    border-bottom: none;\n    border-left: none;\n    border-top-color: #fff;\n}\n\n.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {\n    align-self: flex-end;\n    border-bottom: none;\n    border-right: none;\n    border-top-color: #fff;\n}\n\n.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {\n    align-self: center;\n    border-left: none;\n    border-right-color: #fff;\n}\n\n.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {\n    align-self: center;\n    border-right: none;\n    border-left-color: #fff;\n}\n\n.mapboxgl-popup-close-button {\n    position: absolute;\n    right: 0;\n    top: 0;\n    border: 0;\n    border-radius: 0 3px 0 0;\n    cursor: pointer;\n    background-color: transparent;\n}\n\n.mapboxgl-popup-close-button:hover {\n    background-color: rgba(0, 0, 0, 0.05);\n}\n\n.mapboxgl-popup-content {\n    position: relative;\n    background: #fff;\n    border-radius: 3px;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    padding: 10px 10px 15px;\n    pointer-events: auto;\n}\n\n.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content {\n    border-top-left-radius: 0;\n}\n\n.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content {\n    border-top-right-radius: 0;\n}\n\n.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content {\n    border-bottom-left-radius: 0;\n}\n\n.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content {\n    border-bottom-right-radius: 0;\n}\n\n.mapboxgl-popup-track-pointer {\n    display: none;\n}\n\n.mapboxgl-popup-track-pointer * {\n    pointer-events: none;\n    user-select: none;\n}\n\n.mapboxgl-map:hover .mapboxgl-popup-track-pointer {\n    display: flex;\n}\n\n.mapboxgl-map:active .mapboxgl-popup-track-pointer {\n    display: none;\n}\n\n.mapboxgl-marker {\n    position: absolute;\n    top: 0;\n    left: 0;\n    will-change: transform;\n    opacity: 1;\n    transition: opacity 0.2s;\n}\n\n.mapboxgl-user-location-dot {\n    background-color: #1da1f2;\n    width: 15px;\n    height: 15px;\n    border-radius: 50%;\n}\n\n.mapboxgl-user-location-dot::before {\n    background-color: #1da1f2;\n    content: '';\n    width: 15px;\n    height: 15px;\n    border-radius: 50%;\n    position: absolute;\n    animation: mapboxgl-user-location-dot-pulse 2s infinite;\n}\n\n.mapboxgl-user-location-dot::after {\n    border-radius: 50%;\n    border: 2px solid #fff;\n    content: '';\n    height: 19px;\n    left: -2px;\n    position: absolute;\n    top: -2px;\n    width: 19px;\n    box-sizing: border-box;\n    box-shadow: 0 0 3px rgba(0, 0, 0, 0.35);\n}\n\n.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading {\n    width: 0;\n    height: 0;\n}\n\n.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading::before,\n.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading::after {\n    content: \"\";\n    border-bottom: 7.5px solid #4aa1eb;\n    position: absolute;\n}\n\n.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading::before {\n    border-left: 7.5px solid transparent;\n    transform: translate(0, -28px) skewY(-20deg);\n}\n\n.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading::after {\n    border-right: 7.5px solid transparent;\n    transform: translate(7.5px, -28px) skewY(20deg);\n}\n\n@keyframes mapboxgl-user-location-dot-pulse {\n    0%   { transform: scale(1); opacity: 1; }\n    70%  { transform: scale(3); opacity: 0; }\n    100% { transform: scale(1); opacity: 0; }\n}\n\n.mapboxgl-user-location-dot-stale {\n    background-color: #aaa;\n}\n\n.mapboxgl-user-location-dot-stale::after {\n    display: none;\n}\n\n.mapboxgl-user-location-accuracy-circle {\n    background-color: #1da1f233;\n    width: 1px;\n    height: 1px;\n    border-radius: 100%;\n}\n\n.mapboxgl-crosshair,\n.mapboxgl-crosshair .mapboxgl-interactive,\n.mapboxgl-crosshair .mapboxgl-interactive:active {\n    cursor: crosshair;\n}\n\n.mapboxgl-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n}\n\n@media print {\n    /* stylelint-disable-next-line selector-class-pattern */\n    .mapbox-improve-map {\n        display: none;\n    }\n}\n\n.mapboxgl-touch-pan-blocker,\n.mapboxgl-scroll-zoom-blocker {\n    color: #fff;\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif;\n    justify-content: center;\n    text-align: center;\n    position: absolute;\n    display: flex;\n    align-items: center;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.7);\n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 0.75s ease-in-out;\n    transition-delay: 1s;\n}\n\n.mapboxgl-touch-pan-blocker-show,\n.mapboxgl-scroll-zoom-blocker-show {\n    opacity: 1;\n    transition: opacity 0.1s ease-in-out;\n}\n\n.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,\n.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas {\n    touch-action: pan-x pan-y;\n}\n\n.mini-tokyo-3d {\n    width: 380px;\n    height: 380px;\n    margin: 0;\n    padding: 0;\n    position: relative;\n    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n    cursor: default;\n    -webkit-touch-callout: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    touch-action: none;\n    overflow: hidden;\n}\n\n.mini-tokyo-3d #map {\n    width: 100%;\n    height: 100%;\n    position: relative;\n}\n\n.mini-tokyo-3d .loader-inner {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    height: 21px;\n    transform: translate(-50%, -50%);\n    padding: 20px;\n    border-radius: 10px;\n    background-color: #eee;\n    opacity: .9;\n    transition: opacity 1s linear;\n    box-sizing: initial;\n}\n\n.mini-tokyo-3d .ball-pulse > div {\n    background-color: #777;\n}\n\n.mini-tokyo-3d #loading-error {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    height: 21px;\n    transform: translate(-50%, -50%);\n    padding: 20px;\n    border-radius: 10px;\n    color: #333;\n    background-color: #eee;\n    opacity: .9;\n    display: none;\n}\n\n.mini-tokyo-3d .clock-ctrl {\n    margin-top: 10px;\n    margin-left: 10px;\n    padding: 10px;\n    border-radius: 3px;\n    background-color: rgba(0, 0, 0, 0.7);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    color: #fff;\n    pointer-events: auto;\n}\n\n.mini-tokyo-3d #time {\n    font-size: 150%;\n}\n\n.mini-tokyo-3d .clock-controller {\n    width: 100%;\n    margin-top: 4px;\n    margin-bottom: 10px;\n    display: table;\n    font-size: 150%;\n}\n\n.mini-tokyo-3d .clock-controller > span {\n    vertical-align: middle;\n    text-align: center;\n    display: table-cell;\n}\n\n.mini-tokyo-3d .clock-controller-separator {\n    width: 10px;\n}\n\n.mini-tokyo-3d .spin-box {\n    width: 30px;\n    border-radius: 4px;\n    box-shadow:0 0 0 1px #777;\n}\n\n.mini-tokyo-3d .spin-box:first-child {\n    width: 52px;\n}\n\n.mini-tokyo-3d .spin-box > div {\n    width: 100%;\n    height: 30px;\n    line-height: 30px;\n    text-align: center;\n}\n\n.mini-tokyo-3d .spin-box > div:first-child {\n    border-bottom: solid 1px #777;\n}\n\n.mini-tokyo-3d .spin-box > div:last-child {\n    border-top: solid 1px #777;\n}\n\n.mini-tokyo-3d .spin-box button {\n    display: block;\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    color: #fff;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n.mini-tokyo-3d .spin-box .top-button {\n    border-radius: 4px 4px 0 0;\n}\n\n.mini-tokyo-3d .spin-box .bottom-button {\n    border-radius: 0 0 4px 4px;\n}\n\n.mini-tokyo-3d .clock-button {\n    width: 100%;\n    margin-top: 4px;\n    margin-bottom: 10px;\n    display: table;\n}\n\n.mini-tokyo-3d .clock-button > span {\n    height: 30px;\n    vertical-align: middle;\n    text-align: center;\n    display: table-cell;\n}\n\n.mini-tokyo-3d .clock-button button {\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    border-radius: 4px;\n    box-shadow:0 0 0 1px #777;\n    color: #fff;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n.mini-tokyo-3d .speed-controller {\n    width: 100%;\n    margin-top: 4;\n    display: table;\n    border-radius: 4px;\n    box-shadow:0 0 0 1px #777;\n}\n\n.mini-tokyo-3d .speed-controller > span {\n    height: 30px;\n    vertical-align: middle;\n    text-align: center;\n    display: table-cell;\n}\n\n.mini-tokyo-3d .speed-controller > span:first-child {\n    width: 30px;\n    border-right: solid 1px #777;\n}\n\n.mini-tokyo-3d .speed-controller > span:last-child {\n    width: 30px;\n    border-left: solid 1px #777;\n}\n\n.mini-tokyo-3d .speed-controller button {\n    display: block;\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    color: #fff;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n.mini-tokyo-3d .speed-controller .left-button {\n    border-radius: 4px 0 0 4px;\n}\n\n.mini-tokyo-3d .speed-controller .right-button {\n    border-radius: 0 4px 4px 0;\n}\n\n.mini-tokyo-3d .decrease-icon {\n    display: block;\n    width: 100%;\n    height: 12px;\n    background: no-repeat center/12px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d button:disabled .decrease-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512' fill='%237f7f7f'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .clock-ctrl button {\n    font-size: 12px;\n}\n\n.mini-tokyo-3d .clock-ctrl button:disabled {\n    color: #777;\n    cursor: not-allowed;\n}\n\n.mini-tokyo-3d .clock-ctrl button:not(:disabled):hover {\n    background-color: rgba(51, 51, 51, 0.7);\n}\n\n.mini-tokyo-3d .increase-icon {\n    display: block;\n    width: 100%;\n    height: 12px;\n    background: no-repeat center/12px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d button:disabled .increase-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512' fill='%237f7f7f'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d #clock-speed {\n    padding: 0 6px;\n}\n\n.mini-tokyo-3d .share-panel {\n    position: absolute;\n    z-index: 3;\n    top: 0;\n    left: 50%;\n    padding: 10px;\n    border-radius: 0 0 3px 3px;\n    background-color: rgba(0, 0, 0, 0.7);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    color: #fff;\n    transform: translate(-50%, 0);\n}\n\n.mini-tokyo-3d .share-button {\n    height: 30px;\n    padding: 0 6px;\n    border: 0;\n    border-radius: 4px;\n    box-shadow:0 0 0 1px #777;\n    display: block;\n    color: #fff;\n    background-color: transparent;\n    cursor: pointer;\n    font-size: 12px;\n    line-height: 20px;\n}\n\n.mini-tokyo-3d .share-button:hover {\n    background-color: rgba(51, 51, 51, 0.7);\n}\n\n.mini-tokyo-3d .share-button:before {\n    content: \"\";\n    display: block;\n    background: no-repeat center/20px 20px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96-42.981-96-96-96z'/%3E%3C/svg%3E\");\n    width: 20px;\n    height: 20px;\n    float: left;\n    margin: 0 6px 0 0;\n}\n\n.mini-tokyo-3d .notification {\n    position: absolute;\n    z-index: 3;\n    top: 33%;\n    left: 50%;\n    padding: 20px;\n    border-radius: 0 0 3px 3px;\n    background-color: rgba(0, 0, 0, 0.7);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    color: #fff;\n    opacity: 1;\n    font-size: 130%;\n    transform: translate(-50%, -50%);\n    transition: opacity 1s linear;\n}\n\n.mini-tokyo-3d .panel {\n    position: absolute;\n    z-index: 3;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    width: calc(100% - 20px);\n    max-width: 380px;\n    height: 33%;\n    margin: auto;\n    border-radius: 3px 3px 0 0;\n    background-color: rgba(0, 0, 0, 0.7);\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    font-size: 130%;\n    color: #fff;\n    transition: height 300ms;\n}\n\n.mini-tokyo-3d .panel.collapsed {\n    height: 50px;\n}\n\n.mini-tokyo-3d #panel-header {\n    position: relative;\n    height: 30px;\n    margin: 10px 0;\n    padding: 0 10px;\n    line-height: 30px;\n}\n\n.mini-tokyo-3d #panel-title {\n    font-weight: bold;\n}\n\n.mini-tokyo-3d #panel-body {\n    height: calc(100% - 50px);\n    margin-top: 10px;\n    padding: 0 10px;\n    overflow: auto;\n    overscroll-behavior: contain;\n    line-height: 130%;\n}\n\n.mini-tokyo-3d #panel-content{\n    position: relative;\n    overflow: hidden;\n}\n\n.mini-tokyo-3d .windows {\n    scrollbar-width: thin;\n    scrollbar-color: #ccc transparent;\n}\n\n.mini-tokyo-3d .windows::-webkit-scrollbar {\n    width: 10px;\n}\n\n.mini-tokyo-3d .windows::-webkit-scrollbar-thumb {\n    background: #ccc;\n    background-clip: content-box;\n    border-radius: 6px;\n    border: solid 2px transparent;\n}\n\n.mini-tokyo-3d .train-panel.collapsed {\n    height: 68px;\n}\n\n.mini-tokyo-3d .train-panel #panel-header {\n    height: 48px;\n    line-height: 24px;\n    overflow: hidden;\n}\n\n.mini-tokyo-3d .train-panel #panel-body {\n    height: calc(100% - 68px);\n}\n\n.mini-tokyo-3d #railway-mark {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 24px;\n    height: 100%;\n}\n\n.mini-tokyo-3d #train-mark {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 44px;\n    height: calc(100% + 20px);\n    margin: -10px;\n}\n\n.mini-tokyo-3d .station-row {\n    display: table;\n    width: 100%;\n    margin: 5px 0;\n}\n\n.mini-tokyo-3d .station-row:last-child {\n    margin-bottom: 10px;\n}\n\n.mini-tokyo-3d .station-row:hover {\n    background-color: rgba(102, 102, 102, 0.7);\n}\n\n.mini-tokyo-3d .station-row > div {\n    display: table-cell;\n    vertical-align: middle;\n}\n\n.mini-tokyo-3d .station-title-box {\n    padding-left: 30px;\n}\n\n.mini-tokyo-3d .station-time-box {\n    width: 42px;\n    text-align: right;\n}\n\n.mini-tokyo-3d .train-title-box {\n    padding-left: 40px;\n    font-size: 12px;\n    line-height: 20px;\n}\n\n.mini-tokyo-3d .exit-row {\n    margin: 4px 0;\n}\n\n.mini-tokyo-3d .station-row:last-child {\n    margin-bottom: 10px;\n}\n\n.mini-tokyo-3d .exit-row:hover {\n    background-color: rgba(102, 102, 102, 0.7);\n}\n\n.mini-tokyo-3d .exit-row > div {\n    display: inline-block;\n    vertical-align: middle;\n}\n\n.mini-tokyo-3d .exit-title-box:before {\n    content: \"\";\n    display: block;\n    background: no-repeat center/20px 20px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M416 448h-84c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h84c17.7 0 32-14.3 32-32V160c0-17.7-14.3-32-32-32h-84c-6.6 0-12-5.4-12-12V76c0-6.6 5.4-12 12-12h84c53 0 96 43 96 96v192c0 53-43 96-96 96zm-47-201L201 79c-15-15-41-4.5-41 17v96H24c-13.3 0-24 10.7-24 24v96c0 13.3 10.7 24 24 24h136v96c0 21.5 26 32 41 17l168-168c9.3-9.4 9.3-24.6 0-34z'/%3E%3C/svg%3E\");\n    width: 20px;\n    height: 20px;\n    float: left;\n    margin: 0 6px 0 0;\n}\n\n.mini-tokyo-3d .exit-share-button {\n    height: 30px;\n}\n\n.mini-tokyo-3d .panel-button-group {\n    position: absolute;\n    top: 0;\n    right: 10px;\n    height: 100%;\n}\n\n.mini-tokyo-3d .panel-button-group > * {\n    margin-left: 10px;\n    float: right;\n}\n\n.mini-tokyo-3d .slide-button {\n    width: 20px;\n    height: 100%;\n    background: no-repeat center/13px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z'/%3E%3C/svg%3E\");\n    pointer-events: none;\n}\n\n.mini-tokyo-3d .collapsed .slide-button {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d #slide-button {\n    pointer-events: none;\n}\n\n.mini-tokyo-3d .search-panel {\n    height: 194px;\n}\n\n.mini-tokyo-3d .search-panel.search-result {\n    height: 33%;\n}\n\n.mini-tokyo-3d .search-panel.collapsed {\n    height: 50px;\n}\n\n.mini-tokyo-3d #search-header {\n    height: 30px;\n    margin: 10px 0;\n    padding: 0 10px;\n    overflow: hidden;\n    line-height: 30px;\n    cursor: pointer;\n}\n\n.mini-tokyo-3d .page-controller {\n    display: table;\n    border-radius: 4px;\n    box-shadow:0 0 0 1px #777;\n}\n\n.mini-tokyo-3d .page-controller > span {\n    width: 30px;\n    height: 30px;\n    vertical-align: middle;\n    text-align: center;\n    display: table-cell;\n}\n\n.mini-tokyo-3d .page-controller > span:first-child {\n    margin-right: 1px;\n    border-right: solid 1px #777;\n}\n\n.mini-tokyo-3d .page-controller button {\n    display: block;\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    border: 0;\n    color: #fff;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n.mini-tokyo-3d .page-controller .previous-button {\n    border-radius: 4px 0 0 4px;\n}\n\n.mini-tokyo-3d .page-controller .next-button {\n    border-radius: 0 4px 4px 0;\n}\n\n.mini-tokyo-3d .previous-icon {\n    display: block;\n    width: 100%;\n    height: 14px;\n    background: no-repeat center/10px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d button:disabled .previous-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 512' fill='%237f7f7f'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .page-controller button:disabled {\n    cursor: not-allowed;\n}\n\n.mini-tokyo-3d .page-controller button:not(:disabled):hover {\n    background-color: rgba(51, 51, 51, 0.7);\n}\n\n.mini-tokyo-3d .next-icon {\n    display: block;\n    width: 100%;\n    height: 14px;\n    background: no-repeat center/10px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d button:disabled .next-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 512' fill='%237f7f7f'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .back-button {\n    width: 30px;\n    height: 30px;\n    display: block;\n    padding: 0;\n    border: 0;\n    border-radius: 4px;\n    box-shadow:0 0 0 1px #777;\n    color: #fff;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n.mini-tokyo-3d .back-button:hover {\n    background-color: rgba(51, 51, 51, 0.7);\n}\n\n.mini-tokyo-3d .back-icon {\n    display: block;\n    width: 100%;\n    height: 14px;\n    background: no-repeat center/14px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .search-panel #panel-content {\n    height: 100%;\n}\n\n.mini-tokyo-3d #search-form {\n    display: none;\n}\n\n.mini-tokyo-3d .search-form #search-form {\n    display: block;\n}\n\n.mini-tokyo-3d .search-form-element {\n    margin: 2px 0 4px;\n}\n\n.mini-tokyo-3d #search-load {\n    display: none;\n    height: 134px;\n    position: relative;\n}\n\n.mini-tokyo-3d .search-load #search-load {\n    display: block;\n}\n\n.mini-tokyo-3d #search-load > .ball-pulse {\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%) scale(.5, .5);\n    box-sizing: initial;\n    position: absolute;\n}\n\n.mini-tokyo-3d .search-input {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 220px;\n    height: 26px;\n    padding: 1px;\n    font-size: 15.6px;\n    border: 1px solid #777;\n    border-radius: 0;\n    outline: none;\n    background-color: transparent;\n    color: #fff;\n}\n\n.mini-tokyo-3d .search-input:hover {\n    background-color: rgba(51, 51, 51, 0.7);\n}\n\n.mini-tokyo-3d .search-focus {\n    outline: 2px solid #33B5E5;\n}\n\n.mini-tokyo-3d .search-select {\n    -webkit-appearance: none;\n    appearance: none;\n    height: 30px;\n    padding: 0 10px;\n    margin: 0;\n    border: 1px solid #777;\n    border-radius: 4px;\n    outline: none;\n    background-color: transparent;\n    color: #fff;\n    cursor: pointer;\n    font-size: 15.6px;\n}\n\n.mini-tokyo-3d .search-select:hover {\n    background-color: rgba(51, 51, 51, 0.7);\n}\n\n.mini-tokyo-3d .search-button {\n    -webkit-appearance: none;\n    appearance: none;\n    width: calc(100% - 2px);\n    height: 28px;\n    margin: 1px;\n    border: 0;\n    border-radius: 4px;\n    box-shadow:0 0 0 1px #777;\n    outline: none;\n    background-color: transparent;\n    color: #fff;\n    cursor: pointer;\n    font-size: 15.6px;\n}\n\n.mini-tokyo-3d .search-button:hover {\n    background-color: rgba(51, 51, 51, 0.7);\n}\n\n.mini-tokyo-3d #search-result {\n    display: none;\n    height: 100%;\n}\n\n.mini-tokyo-3d .search-result #search-result {\n    display: block;\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl-search {\n    transition: width 300ms ease;\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-search .mapboxgl-ctrl-icon {\n    background: no-repeat right 5px center/19px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-search-active .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%2333B5E5'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-underground .mapboxgl-ctrl-icon {\n    background: no-repeat center/23px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-underground-visible .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' fill='%2333B5E5'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-track-helicopter .mapboxgl-ctrl-icon {\n    background: no-repeat center/23px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M304 384h272c17.67 0 32-14.33 32-32 0-123.71-100.29-224-224-224V64h176c8.84 0 16-7.16 16-16V16c0-8.84-7.16-16-16-16H144c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h176v64H112L68.8 70.4C65.78 66.37 61.03 64 56 64H16.01C5.6 64-2.04 73.78.49 83.88L32 192l160 64 86.4 115.2A31.992 31.992 0 0 0 304 384zm112-188.49C478.55 208.3 528.03 257.44 540.79 320H416V195.51zm219.37 263.3l-22.15-22.2c-6.25-6.26-16.24-6.1-22.64.01-7.09 6.77-13.84 11.25-24.64 11.25H240c-8.84 0-16 7.18-16 16.03v32.06c0 8.85 7.16 16.03 16 16.03h325.94c14.88 0 35.3-.47 68.45-29.52 7.02-6.14 7.57-17.05.98-23.66z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-track-helicopter.mapboxgl-ctrl-track-active .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512' fill='%2333B5E5'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M304 384h272c17.67 0 32-14.33 32-32 0-123.71-100.29-224-224-224V64h176c8.84 0 16-7.16 16-16V16c0-8.84-7.16-16-16-16H144c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h176v64H112L68.8 70.4C65.78 66.37 61.03 64 56 64H16.01C5.6 64-2.04 73.78.49 83.88L32 192l160 64 86.4 115.2A31.992 31.992 0 0 0 304 384zm112-188.49C478.55 208.3 528.03 257.44 540.79 320H416V195.51zm219.37 263.3l-22.15-22.2c-6.25-6.26-16.24-6.1-22.64.01-7.09 6.77-13.84 11.25-24.64 11.25H240c-8.84 0-16 7.18-16 16.03v32.06c0 8.85 7.16 16.03 16 16.03h325.94c14.88 0 35.3-.47 68.45-29.52 7.02-6.14 7.57-17.05.98-23.66z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-track-train .mapboxgl-ctrl-icon {\n    background: no-repeat center/19px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M448 96v256c0 51.815-61.624 96-130.022 96l62.98 49.721C386.905 502.417 383.562 512 376 512H72c-7.578 0-10.892-9.594-4.957-14.279L130.022 448C61.82 448 0 403.954 0 352V96C0 42.981 64 0 128 0h192c65 0 128 42.981 128 96zm-48 136V120c0-13.255-10.745-24-24-24H72c-13.255 0-24 10.745-24 24v112c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24zm-176 64c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-track-train.mapboxgl-ctrl-track-active .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512' fill='%2333B5E5'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M448 96v256c0 51.815-61.624 96-130.022 96l62.98 49.721C386.905 502.417 383.562 512 376 512H72c-7.578 0-10.892-9.594-4.957-14.279L130.022 448C61.82 448 0 403.954 0 352V96C0 42.981 64 0 128 0h192c65 0 128 42.981 128 96zm-48 136V120c0-13.255-10.745-24-24-24H72c-13.255 0-24 10.745-24 24v112c0 13.255 10.745 24 24 24h304c13.255 0 24-10.745 24-24zm-176 64c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-playback .mapboxgl-ctrl-icon {\n    background: no-repeat center/21px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-playback-active .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%2333B5E5'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-eco .mapboxgl-ctrl-icon {\n    background: no-repeat center/21px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M544 160v64h32v64h-32v64H64V160h480m16-64H48c-26.51 0-48 21.49-48 48v224c0 26.51 21.49 48 48 48h512c26.51 0 48-21.49 48-48v-16h8c13.255 0 24-10.745 24-24V184c0-13.255-10.745-24-24-24h-8v-16c0-26.51-21.49-48-48-48zm-144 96H96v128h320V192z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-eco-active .mapboxgl-ctrl-icon {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512' fill='%2333B5E5'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M544 160v64h32v64h-32v64H64V160h480m16-64H48c-26.51 0-48 21.49-48 48v224c0 26.51 21.49 48 48 48h512c26.51 0 48-21.49 48-48v-16h8c13.255 0 24-10.745 24-24V184c0-13.255-10.745-24-24-24h-8v-16c0-26.51-21.49-48-48-48zm-144 96H96v128h320V192z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-layers .mapboxgl-ctrl-icon {\n    background: no-repeat center/19px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M12.41 148.02l232.94 105.67c6.8 3.09 14.49 3.09 21.29 0l232.94-105.67c16.55-7.51 16.55-32.52 0-40.03L266.65 2.31a25.607 25.607 0 0 0-21.29 0L12.41 107.98c-16.55 7.51-16.55 32.53 0 40.04zm487.18 88.28l-58.09-26.33-161.64 73.27c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.51 209.97l-58.1 26.33c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 276.3c16.55-7.5 16.55-32.5 0-40zm0 127.8l-57.87-26.23-161.86 73.37c-7.56 3.43-15.59 5.17-23.86 5.17s-16.29-1.74-23.86-5.17L70.29 337.87 12.41 364.1c-16.55 7.5-16.55 32.5 0 40l232.94 105.59c6.8 3.08 14.49 3.08 21.29 0L499.59 404.1c16.55-7.5 16.55-32.5 0-40z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-ctrl button.mapboxgl-ctrl-about .mapboxgl-ctrl-icon {\n    background: no-repeat center/21px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' fill='%23333'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .mapboxgl-popup-content {\n    color: #fff;\n    background-color: rgba(0, 0, 0, 0.7);\n}\n\n.mini-tokyo-3d .highlighted .mapboxgl-popup-content {\n    background-color: rgba(102, 102, 102, 0.7);\n}\n\n.mini-tokyo-3d .popup-object .mapboxgl-popup-content,\n.mini-tokyo-3d .popup-object .mapboxgl-popup-tip,\n.mini-tokyo-3d .popup-station .mapboxgl-popup-content,\n.mini-tokyo-3d .popup-station .mapboxgl-popup-tip {\n    pointer-events: none;\n}\n\n.mini-tokyo-3d .popup-station .mapboxgl-popup-content {\n    padding: 5px 10px;\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-top .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {\n    border-bottom-color: rgba(0, 0, 0, 0.7);\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {\n    border-top-color: rgba(0, 0, 0, 0.7);\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-left .mapboxgl-popup-tip {\n    border-right-color: rgba(0, 0, 0, 0.7);\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-right .mapboxgl-popup-tip {\n    border-left-color: rgba(0, 0, 0, 0.7);\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-top.highlighted .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-top-left.highlighted .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-top-right.highlighted .mapboxgl-popup-tip {\n    border-bottom-color: rgba(102, 102, 102, 0.7);\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-bottom.highlighted .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-bottom-left.highlighted .mapboxgl-popup-tip,\n.mini-tokyo-3d .mapboxgl-popup-anchor-bottom-right.highlighted .mapboxgl-popup-tip {\n    border-top-color: rgba(102, 102, 102, 0.7);\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-left.highlighted .mapboxgl-popup-tip {\n    border-right-color: rgba(102, 102, 102, 0.7);\n}\n\n.mini-tokyo-3d .mapboxgl-popup-anchor-right.highlighted .mapboxgl-popup-tip {\n    border-left-color: rgba(102, 102, 102, 0.7);\n}\n\n.mini-tokyo-3d .desc-header {\n    display: table;\n}\n\n.mini-tokyo-3d .desc-header > div {\n    display: table-cell;\n    vertical-align: top;\n}\n\n.mini-tokyo-3d .desc-header > div:first-child {\n    width: 10px;\n}\n\n.mini-tokyo-3d .desc-header > div:last-child {\n    padding-left: 8px;\n}\n\n.mini-tokyo-3d .desc-caution {\n    color: #f90;\n}\n\n.mini-tokyo-3d .desc-normal-style {\n    font-weight: normal;\n}\n\n.mini-tokyo-3d .line-strip {\n    width: 10px;\n    height: 13px;\n}\n\n.mini-tokyo-3d .line-strip-long {\n    width: 10px;\n    height: 16px;\n}\n\n.mini-tokyo-3d .train-type-label {\n    padding: 2px 2px 1px 2px;\n    border-radius: 3px;\n    color: #333;\n    background-color: #fff;\n}\n\n.mini-tokyo-3d .thumbnail-image-container {\n    width: 128px;\n    height: 72px;\n    margin-bottom: 4px;\n    position: relative;\n}\n\n.mini-tokyo-3d .thumbnail-image-container > .ball-pulse {\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%) scale(.5, .5);\n    box-sizing: initial;\n    position: absolute;\n}\n\n.mini-tokyo-3d .thumbnail-image {\n    width: 100%;\n    height: 100%;\n    background-size: cover;\n    background-position: center;\n    position: absolute;\n}\n\n.mini-tokyo-3d .railway-list > * {\n    vertical-align: middle;\n}\n\n.mini-tokyo-3d .railway-list .line-strip {\n    width: 10px;\n    height: 18px;\n    margin-right: 8px;\n    display: inline-block;\n}\n\n.mini-tokyo-3d .modal-panel-background {\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    position: absolute;\n    z-index: 3;\n    background-color: #000;\n    opacity: 0.5;\n    transition: opacity 300ms ease;\n}\n\n.mini-tokyo-3d .modal-panel-background.closed {\n    opacity: 0;\n}\n\n.mini-tokyo-3d .close-button {\n    width: 20px;\n    height: 100%;\n    background: no-repeat center/13px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 352 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z'/%3E%3C/svg%3E\");\n    cursor: pointer;\n}\n\n.mini-tokyo-3d .about-panel #panel-body{\n    font-size: 12px;\n    line-height: 20px;\n}\n\n.mini-tokyo-3d .about-panel a:link,\n.mini-tokyo-3d .about-panel a:visited {\n    color: #f90;\n    text-decoration: none;\n}\n\n.mini-tokyo-3d .about-panel a:hover,\n.mini-tokyo-3d .about-panel a:active {\n    color: #f90;\n    text-decoration: underline;\n}\n\n.mini-tokyo-3d .card-title {\n    background: rgba(51, 51, 51, 0.7);\n    color: #fff;\n    display: block;\n    padding: 4px;\n}\n\n.mini-tokyo-3d .card-body {\n    border: 1px solid rgba(51, 51, 51, 0.7);\n    margin-bottom: 10px;\n    padding: 0 4px;\n}\n\n.mini-tokyo-3d .layer-row {\n    height: 60px;\n}\n\n.mini-tokyo-3d .layer-row div {\n    display: inline-block;\n    vertical-align: middle;\n}\n\n.mini-tokyo-3d .layer-icon {\n    width: 48px;\n    height: 48px;\n    margin: 1px 11px 1px 1px;\n    border-width: 1px;\n    border-style: solid;\n    border-radius: 4px;\n    border-color: #777;\n    cursor: pointer;\n    background: no-repeat center/32px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' fill='%23fff'%3E%3C!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --%3E%3Cpath d='M519.442 288.651c-41.519 0-59.5 31.593-82.058 31.593C377.409 320.244 432 144 432 144s-196.288 80-196.288-3.297c0-35.827 36.288-46.25 36.288-85.985C272 19.216 243.885 0 210.539 0c-34.654 0-66.366 18.891-66.366 56.346 0 41.364 31.711 59.277 31.711 81.75C175.885 207.719 0 166.758 0 166.758v333.237s178.635 41.047 178.635-28.662c0-22.473-40-40.107-40-81.471 0-37.456 29.25-56.346 63.577-56.346 33.673 0 61.788 19.216 61.788 54.717 0 39.735-36.288 50.158-36.288 85.985 0 60.803 129.675 25.73 181.23 25.73 0 0-34.725-120.101 25.827-120.101 35.962 0 46.423 36.152 86.308 36.152C556.712 416 576 387.99 576 354.443c0-34.199-18.962-65.792-56.558-65.792z'/%3E%3C/svg%3E\");\n}\n\n.mini-tokyo-3d .layer-icon-enabled {\n    margin: 0 10px 0 0;\n    border-width: 2px;\n    border-color: #33B5E5;\n}\n\n.mini-tokyo-3d .panel.closed {\n    height: 0;\n}\n\n.mini-tokyo-3d .search-panel.search-result #panel-body {\n    padding: 0;\n}\n\n.mini-tokyo-3d .swiper-slide {\n    padding: 0 10px;\n    box-sizing: border-box;\n    overflow: auto;\n}\n\n.mini-tokyo-3d .swiper-slide-content {\n    position: relative;\n    overflow: hidden;\n}\n\n.mini-tokyo-3d .swiper-pagination {\n    pointer-events: none;\n}\n\n.mini-tokyo-3d .swiper-pagination-bullet {\n    background-color: #fff;\n    pointer-events: auto;\n}\n";styleInject(css_248z);const THREE=Object.assign({GLTFLoader:GLTFLoader},three);export{map as Map,marker as Marker,Panel,Plugin,popup as Popup,THREE,ThreeLayer,mapboxGl as mapboxgl};