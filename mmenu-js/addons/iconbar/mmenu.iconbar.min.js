import Mmenu from"../../core/oncanvas/mmenu.oncanvas";import options from"./_options";import{extendShorthandOptions}from"./_options";import*as DOM from"../../_modules/dom";import*as media from"../../_modules/matchmedia";import{type,extend}from"../../_modules/helpers";Mmenu.options.iconbar=options;export default function(){var e,t=this,n=extendShorthandOptions(this.opts.iconbar);if((this.opts.iconbar=extend(n,Mmenu.options.iconbar),n.use)&&(["top","bottom"].forEach(function(t,o){var a=n[t];"array"!=type(a)&&(a=[a]);for(var i=DOM.create("div.mm-iconbar__"+t),r=0,m=a.length;r<m;r++)"string"==typeof a[r]?i.innerHTML+=a[r]:i.append(a[r]);i.children.length&&(e||(e=DOM.create("div.mm-iconbar")),e.append(i))}),e)){this.bind("initMenu:after",function(){t.node.menu.prepend(e)});var o="mm-menu_iconbar-"+n.position,a=function(){t.node.menu.classList.add(o),Mmenu.sr_aria(e,"hidden",!1)};if("boolean"==typeof n.use?this.bind("initMenu:after",a):media.add(n.use,a,function(){t.node.menu.classList.remove(o),Mmenu.sr_aria(e,"hidden",!0)}),"tabs"==n.type){e.classList.add("mm-iconbar_tabs"),e.addEventListener("click",function(e){var n=e.target;if(n.matches("a"))if(n.matches(".mm-iconbar__tab_selected"))e.stopImmediatePropagation();else try{var o=t.node.menu.querySelector(n.getAttribute("href"))[0];o&&o.matches(".mm-panel")&&(e.preventDefault(),e.stopImmediatePropagation(),t.openPanel(o,!1))}catch(e){}});var i=function(t){DOM.find(e,"a").forEach(function(e){e.classList.remove("mm-iconbar__tab_selected")});var n=DOM.find(e,'[href="#'+t.id+'"]')[0];if(n)n.classList.add("mm-iconbar__tab_selected");else{var o=t.mmParent;o&&i(o.closest(".mm-panel"))}};this.bind("openPanel:start",i)}}};