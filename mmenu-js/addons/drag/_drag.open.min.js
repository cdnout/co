import DragEvents from"../../_modules/dragevents/index";import*as DOM from"../../_modules/dom";import*as events from"../../_modules/eventlisteners";import*as media from"../../_modules/matchmedia";var dragInstance=null,dragNode=null,maxDistance=0;export default function(t){var e=this,o={},i=!1,a=function(){var t=Object.keys(e.opts.extensions);t.length?(media.add(t.join(", "),function(){},function(){o=getPositionVars(o,[],e.node.menu)}),t.forEach(function(t){media.add(t,function(){o=getPositionVars(o,e.opts.extensions[t],e.node.menu)},function(){})})):o=getPositionVars(o,[],e.node.menu)};dragNode&&(events.off(dragNode,"dragStart"),events.off(dragNode,"dragMove"),events.off(dragNode,"dragEnd")),dragInstance=new DragEvents(dragNode=t),a(),a=function(){},dragNode&&(events.on(dragNode,"dragStart",function(t){t.detail.direction==o.direction&&(i=!0,e.node.wrpr.classList.add("mm-wrapper_dragging"),e._openSetup(),e.trigger("open:start"),maxDistance=e.node.menu["x"==o.axis?"clientWidth":"clientHeight"])}),events.on(dragNode,"dragMove",function(t){if(t.detail.axis==o.axis&&i){var e=t.detail["distance"+o.axis.toUpperCase()];switch(o.position){case"right":case"bottom":e=Math.min(Math.max(e,-maxDistance),0);break;default:e=Math.max(Math.min(e,maxDistance),0)}if("front"==o.zposition)switch(o.position){case"right":case"bottom":e+=maxDistance;break;default:e-=maxDistance}o.slideOutNodes.forEach(function(t){t.style.transform="translate"+o.axis.toUpperCase()+"("+e+"px)"})}}),events.on(dragNode,"dragEnd",function(t){if(t.detail.axis==o.axis&&i){i=!1,e.node.wrpr.classList.remove("mm-wrapper_dragging"),o.slideOutNodes.forEach(function(t){t.style.transform=""});var a=Math.abs(t.detail["distance"+o.axis.toUpperCase()])>=.75*maxDistance;if(!a){var n=t.detail["movement"+o.axis.toUpperCase()];switch(o.position){case"right":case"bottom":a=n<=0;break;default:a=n>=0}}a?e._openStart():e.close()}}))};var getPositionVars=function(t,e,o){switch(t.position="left",t.zposition="back",["right","top","bottom"].forEach(function(o){e.indexOf("position-"+o)>-1&&(t.position=o)}),["front","top","bottom"].forEach(function(o){e.indexOf("position-"+o)>-1&&(t.zposition="front")}),dragInstance.area={top:"bottom"==t.position?"75%":0,right:"left"==t.position?"75%":0,bottom:"top"==t.position?"75%":0,left:"right"==t.position?"75%":0},t.position){case"top":case"bottom":t.axis="y";break;default:t.axis="x"}switch(t.position){case"top":t.direction="Down";break;case"right":t.direction="Left";break;case"bottom":t.direction="Up";break;default:t.direction="Right"}switch(t.zposition){case"front":t.slideOutNodes=[o];break;default:t.slideOutNodes=DOM.find(document.body,".mm-slideout")}return t};