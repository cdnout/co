import Mmenu from"../../core/oncanvas/mmenu.oncanvas";import options from"./_options";import{extendShorthandOptions}from"./_options";import*as DOM from"../../_modules/dom";import{extend}from"../../_modules/helpers";Mmenu.options.columns=options;export default function(){var n=this,e=extendShorthandOptions(this.opts.columns);if(this.opts.columns=extend(e,Mmenu.options.columns),e.add){e.visible.min=Math.max(1,Math.min(6,e.visible.min)),e.visible.max=Math.max(e.visible.min,Math.min(6,e.visible.max));for(var m=[],s=[],i=["mm-panel_opened","mm-panel_opened-parent","mm-panel_highest"],a=0;a<=e.visible.max;a++)m.push("mm-menu_columns-"+a),s.push("mm-panel_columns-"+a);i.push.apply(i,s),this.bind("openPanel:before",function(e){var m;if(e&&(m=e.mmParent),m&&!m.classList.contains("mm-listitem_vertical")&&(m=m.closest(".mm-panel"))){var s=m.className;if(s.length&&(s=s.split("mm-panel_columns-")[1]))for(var a=parseInt(s.split(" ")[0],10)+1;a>0;){if(!(e=DOM.children(n.node.pnls,".mm-panel_columns-"+a)[0])){a=-1;break}a++,e.classList.add("mm-hidden"),i.forEach(function(n){e.classList.remove(n)})}}}),this.bind("openPanel:start",function(i){if(i){var a=i.mmParent;if(a&&a.classList.contains("mm-listitem_vertical"))return}var o=DOM.children(n.node.pnls,".mm-panel_opened-parent").length;i.matches(".mm-panel_opened-parent")||o++,o=Math.min(e.visible.max,Math.max(e.visible.min,o)),m.forEach(function(e){n.node.menu.classList.remove(e)}),n.node.menu.classList.add("mm-menu_columns-"+o);var t=[];DOM.children(n.node.pnls,".mm-panel").forEach(function(n){s.forEach(function(e){n.classList.remove(e)}),n.matches(".mm-panel_opened-parent")&&t.push(n)}),t.push(i),t.slice(-e.visible.max).forEach(function(n,e){n.classList.add("mm-panel_columns-"+e)})})}};