import Mmenu from"../../core/oncanvas/mmenu.oncanvas";import options from"./_options";import{extendShorthandOptions}from"./_options";import*as DOM from"../../_modules/dom";import{extend}from"../../_modules/helpers";Mmenu.options.iconPanels=options;export default function(){var e=this,n=extendShorthandOptions(this.opts.iconPanels);this.opts.iconPanels=extend(n,Mmenu.options.iconPanels);var i=!1;if("first"==n.visible&&(i=!0,n.visible=1),n.visible=Math.min(3,Math.max(1,n.visible)),n.visible++,n.add){this.bind("initMenu:after",function(){var i=["mm-menu_iconpanel"];n.hideNavbar&&i.push("mm-menu_hidenavbar"),n.hideDivider&&i.push("mm-menu_hidedivider"),i.forEach(function(n){e.node.menu.classList.add(n)})});var t=[];if(!i)for(var o=0;o<=n.visible;o++)t.push("mm-panel_iconpanel-"+o);this.bind("openPanel:start",function(o){var a=DOM.children(e.node.pnls,".mm-panel");if(!(o=o||a[0]).parentElement.matches(".mm-listitem_vertical"))if(i)a.forEach(function(e,n){e.classList[0==n?"add":"remove"]("mm-panel_iconpanel-first")});else{a.forEach(function(e){t.forEach(function(n){e.classList.remove(n)})}),a=a.filter(function(e){return e.matches(".mm-panel_opened-parent")});var s=!1;a.forEach(function(e){o===e&&(s=!0)}),s||a.push(o),a.forEach(function(e){e.classList.remove("mm-hidden")}),(a=a.slice(-n.visible)).forEach(function(e,n){e.classList.add("mm-panel_iconpanel-"+n)})}}),this.bind("initPanel:after",function(e){if(n.blockPanel&&!e.parentElement.matches(".mm-listitem_vertical")&&!DOM.children(e,".mm-panel__blocker")[0]){var i=DOM.create("a.mm-panel__blocker");i.setAttribute("href","#"+e.closest(".mm-panel").id),e.prepend(i)}})}};