!function(t){function e(t,e){return e?(Object.keys(e.query).map(function(n){t=t.replace(new RegExp("^\\?"+n+"$"),e.query[n])}),Object.keys(e.param).map(function(n){t=t.replace(new RegExp("^\\$"+n+"$"),e.param[n])}),t):t}var n=t&&t.riot?t.riot:require("riot");n.tag("route",' <section if="{ show }"><yield ></yield></section>',function(t){function e(t,e){if(t=t.replace(/^\//,""),"*"==t)return{};var n=[],i=t.replace(/(^|\/):([^\/]+)/g,function(t,e,i){return n.push(i),e+"([^/]+)"}),o=e.match(new RegExp("^"+i+"$"));if(!o)return null;var r={};return n.map(function(t,e){r[t]=o[e+1]}),r}var n=this;n.show=!1,n.on("update",function(){var i,o=n.parent.path,r=n.parent.query;n.show=!n.parent.found&&null!==(i=e(t.path,o)),i=i||{},n.show&&(t.redirect?/^http/.test(t.redirect)?location.href=t.redirect:location.hash=t.redirect:(n.trigger("urlchanged",{path:o,query:r,param:i}),n.parent.found=!0))})}),n.tag("router"," <yield ></yield>",function(e){var n=this,i=t,o="hashchange";n.path="",n.query={},n.found=!1,this.emit=function(t){var e=location.href.split("#")[1]||"",i=e.split("?")[0].replace(/^\/|\/$/g,""),o={};e.replace(/[?&](.+?)=([^&]*)/g,function(t,e,n){o[e]=n}),n.path=i,n.query=o,n.found=!1,t&&n.update()}.bind(this),n.on("mount",function(){i.addEventListener?i.addEventListener(o,n.emit,!1):i.attachEvent("on"+o,n.emit)}),n.on("unmount",function(){i.removeEventListener?i.removeEventListener(o,n.emit,!1):i.detachEvent("on"+o,n.emit)}),n.emit()}),n.mixin("ikki",{$$version:0,init:function(){var t=this,n=t.$$findAncestor("route");n?n.on("urlchanged",function(n){t.$$loadOpts(t.opts.opts,n),t.one("update",function(){Object.keys(t.opts).map(function(i){"string"==typeof t.opts[i]&&(t.opts[i]=e(t.opts[i],n))})})}):t.$$loadOpts(t.opts.opts)},$$findAncestor:function(t){for(tag=this;tag&&t!=tag.root.tagName.toLowerCase();)tag=tag.parent;return tag||null},$$loadOpts:function(t,e){function n(t){function e(e){o<i.$$version||(i.$$extendOpts(e)&&i.update(),setTimeout(function(){n(t)},0))}var r=t.next().value;r&&(r.then?r.then(e):e(r))}if(t){var i=this,o=++i.$$version;"object"!=typeof t||t.then?"object"==typeof t?t.then(function(t){i.$$extendOpts(t)&&i.update()}):t&&"GeneratorFunction"==t.constructor.name&&n(e?t(e):t()):i.$$extendOpts(t)}},$$extendOpts:function(t){var e=this;t.listeners&&(t.listeners.map(function(t){e.on(t.key,t.callback)}),delete t.listeners);var n=Object.keys(t);return n.map(function(n){e.opts[n]=t[n]}),n.length>0}}),n.mixin("parentScope",{init:function(){this._ownPropKeys=[],this._ownOptsKeys=[];for(var t in this)this._ownPropKeys[t]=!0;for(var t in this.opts)this._ownOptsKeys[t]=!0;this.on("update",function(){for(var t in this.parent)this._ownPropKeys[t]||(this[t]=this.parent[t]);for(var t in this.parent.opts)this._ownOptsKeys[t]||(this.opts[t]=this.parent.opts[t])})},updateCaller:function(t){var e=[];for(var n in this.parent._ownPropKeys||this.parent)e.push(n);for(var i=0;i<e.length;i++)if(this.parent[e[i]]===t)return void this.parent.update();this.parent.updateCaller&&this.parent.updateCaller(t)}})}("undefined"!=typeof window?window:void 0);