!function(r,e){"function"==typeof define&&define.amd?define(["exports"],e):"object"==typeof exports?e(exports):e(r.rison={})}(this,function(r){var e,t,u,s=r;void 0===s&&(window.rison={}),s.uri_ok={"~":!0,"!":!0,"*":!0,"(":!0,")":!0,"-":!0,_:!0,".":!0,",":!0,":":!0,"@":!0,$:!0,"'":!0,"/":!0},function(){for(var r=[],e=0;e<16;e++)for(var t,n=0;n<16;n++){e+n!=0&&(t=String.fromCharCode(16*e+n),/\w|[-_.\/~]/.test(t)||r.push("\\u00"+e.toString(16)+n.toString(16)))}s.not_idchar=r.join("")}(),s.not_idchar=" '!:(),*@$",s.not_idstart="-0123456789",e="[^"+s.not_idstart+s.not_idchar+"][^"+s.not_idchar+"]*",s.id_ok=new RegExp("^"+e+"$"),s.next_id=new RegExp(e,"g"),s.quote=function(r){return/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(r)?r:encodeURIComponent(r).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g").replace("%20","+","g")},t={"'":!0,"!":!0},u={array:function(r){for(var e,t,n,i=["!("],o=r.length,s=0;s<o;s+=1)n=r[s],(t=u[typeof n])&&"string"==typeof(n=t(n))&&(e&&(i[i.length]=","),i[i.length]=n,e=!0);return i[i.length]=")",i.join("")},boolean:function(r){return r?"!t":"!f"},null:function(r){return"!n"},number:function(r){return isFinite(r)?String(r).replace(/\+/,""):"!n"},object:function(r){if(r){if(r instanceof Array)return u.array(r);if("object"==typeof r.__prototype__&&void 0!==r.__prototype__.encode_rison)return r.encode_rison();var e,t,n,i,o,s=["("],a=[];for(n in r)a[a.length]=n;for(a.sort(),o=0;o<a.length;o++)i=r[n=a[o]],(t=u[typeof i])&&"string"==typeof(i=t(i))&&(e&&(s[s.length]=","),s.push(u.string(n),":",i),e=!0);return s[s.length]=")",s.join("")}return"!n"},string:function(r){return""==r?"''":s.id_ok.test(r)?r:"'"+(r=r.replace(/(['!])/g,function(r,e){return t[e]?"!"+e:e}))+"'"},undefined:function(r){throw new Error("rison can't encode the undefined value")}},s.encode=function(r){return u[typeof r](r)},s.encode_object=function(r){if("object"!=typeof r||null===r||r instanceof Array)throw new Error("rison.encode_object expects an object argument");var e=u[typeof r](r);return e.substring(1,e.length-1)},s.encode_array=function(r){if(!(r instanceof Array))throw new Error("rison.encode_array expects an array argument");var e=u[typeof r](r);return e.substring(2,e.length-1)},s.encode_uri=function(r){return s.quote(u[typeof r](r))},s.decode=function(r){return new s.parser(function(r){throw Error("rison decoder error: "+r)}).parse(r)},s.decode_object=function(r){return s.decode("("+r+")")},s.decode_array=function(r){return s.decode("!("+r+")")},s.parser=function(r){this.errorHandler=r},s.parser.WHITESPACE="",s.parser.prototype.setOptions=function(r){r.errorHandler&&(this.errorHandler=r.errorHandler)},s.parser.prototype.parse=function(r){this.string=r,this.index=0,this.message=null;var e=this.readValue();return!this.message&&this.next()&&(e=this.error("unable to parse string as rison: '"+s.encode(r)+"'")),this.message&&this.errorHandler&&this.errorHandler(this.message,this.index),e},s.parser.prototype.error=function(r){"undefined"!=typeof console&&console.log("rison parser error: ",r),this.message=r},s.parser.prototype.readValue=function(){var r=this.next(),e=r&&this.table[r];if(e)return e.apply(this);var t=this.string,n=this.index-1;s.next_id.lastIndex=n;var i=s.next_id.exec(t);if(0<i.length){var o=i[0];return this.index=n+o.length,o}return r?this.error("invalid character: '"+r+"'"):this.error("empty expression")},s.parser.parse_array=function(r){for(var e,t=[];")"!=(e=r.next());){if(!e)return r.error("unmatched '!('");if(t.length)","!=e&&r.error("missing ','");else{if(","==e)return r.error("extra ','");--r.index}var n=r.readValue();if(void 0===n)return;t.push(n)}return t},s.parser.bangs={t:!0,f:!1,n:null,"(":s.parser.parse_array},s.parser.prototype.table={"!":function(){var r=this.string.charAt(this.index++);if(!r)return this.error('"!" at end of input');var e=s.parser.bangs[r];return"function"==typeof e?e.call(null,this):void 0===e?this.error('unknown literal: "!'+r+'"'):e},"(":function(){for(var r,e={},t=0;")"!=(r=this.next());){if(t)","!=r&&this.error("missing ','");else{if(","==r)return this.error("extra ','");--this.index}var n=this.readValue();if(void 0===n)return;if(":"!=this.next())return this.error("missing ':'");var i=this.readValue();if(void 0===i)return;e[n]=i,t++}return e},"'":function(){for(var r,e=this.string,t=this.index,n=t,i=[];"'"!=(r=e.charAt(t++));){if(!r)return this.error('unmatched "\'"');if("!"==r){if(n<t-1&&i.push(e.slice(n,t-1)),r=e.charAt(t++),!(0<="!'".indexOf(r)))return this.error('invalid string escape: "!'+r+'"');i.push(r),n=t}}return n<t-1&&i.push(e.slice(n,t-1)),this.index=t,1==i.length?i[0]:i.join("")},"-":function(){var r=this.string,e=this.index,t=e-1,n="int",i="-",o={"int+.":"frac","int+e":"exp","frac+e":"exp"};do{var s=r.charAt(e++);if(!s)break;"0"<=s&&s<="9"||(0<=i.indexOf(s)?i="":"exp"==(n=o[n+"+"+s.toLowerCase()])&&(i="-"))}while(n);return this.index=--e,"-"==(r=r.slice(t,e))?this.error("invalid number"):Number(r)}},function(r){for(var e=0;e<=9;e++)r[String(e)]=r["-"]}(s.parser.prototype.table),s.parser.prototype.next=function(){var r=this.string,e=this.index;do{if(e==r.length)return;var t=r.charAt(e++)}while(0<=s.parser.WHITESPACE.indexOf(t));return this.index=e,t}});