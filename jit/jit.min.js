(function(){this.$jit=function(x){x=x||window;for(var y in $jit){if($jit[y].$extend){x[y]=$jit[y]}}};$jit.version="2.0.1";var d=function(x){return document.getElementById(x)};d.empty=function(){};d.extend=function(z,x){for(var y in (x||{})){z[y]=x[y]}return z};d.lambda=function(x){return(typeof x=="function")?x:function(){return x}};d.time=Date.now||function(){return +new Date};d.splat=function(y){var x=d.type(y);return x?((x!="array")?[y]:y):[]};d.type=function(y){var x=d.type.s.call(y).match(/^\[object\s(.*)\]$/)[1].toLowerCase();if(x!="object"){return x}if(y&&y.$$family){return y.$$family}if(y&&y.nodeType==9){return"htmldocument"}return(y&&y.nodeName&&y.nodeType==1)?"element":x};d.type.s=Object.prototype.toString;d.each=function(C,B){var A=d.type(C);if(A=="object"){for(var z in C){B(C[z],z)}}else{for(var y=0,x=C.length;y<x;y++){B(C[y],y)}}};d.indexOf=function(A,z){if(A.indexOf){return A.indexOf(z)}for(var y=0,x=A.length;y<x;y++){if(A[y]===z){return y}}return -1};d.map=function(z,y){var x=[];d.each(z,function(B,A){x.push(y(B,A))});return x};d.reduce=function(B,z,y){var x=B.length;if(x==0){return y}var A=arguments.length==3?y:B[--x];while(x--){A=z(A,B[x])}return A};d.merge=function(){var B={};for(var A=0,x=arguments.length;A<x;A++){var y=arguments[A];if(d.type(y)!="object"){continue}for(var z in y){var D=y[z],C=B[z];B[z]=(C&&d.type(D)=="object"&&d.type(C)=="object")?d.merge(C,D):d.unlink(D)}}return B};d.unlink=function(z){var y;switch(d.type(z)){case"object":y={};for(var B in z){y[B]=d.unlink(z[B])}break;case"array":y=[];for(var A=0,x=z.length;A<x;A++){y[A]=d.unlink(z[A])}break;default:return z}return y};d.zip=function(){if(arguments.length===0){return[]}for(var z=0,y=[],x=arguments.length,C=arguments[0].length;z<C;z++){for(var A=0,B=[];A<x;A++){B.push(arguments[A][z])}y.push(B)}return y};d.rgbToHex=function(B,A){if(B.length<3){return null}if(B.length==4&&B[3]==0&&!A){return"transparent"}var y=[];for(var x=0;x<3;x++){var z=(B[x]-0).toString(16);y.push(z.length==1?"0"+z:z)}return A?y:"#"+y.join("")};d.hexToRgb=function(z){if(z.length!=7){z=z.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);z.shift();if(z.length!=3){return null}var x=[];for(var y=0;y<3;y++){var A=z[y];if(A.length==1){A+=A}x.push(parseInt(A,16))}return x}else{z=parseInt(z.slice(1),16);return[z>>16,z>>8&255,z&255]}};d.destroy=function(x){d.clean(x);if(x.parentNode){x.parentNode.removeChild(x)}if(x.clearAttributes){x.clearAttributes()}};d.clean=function(A){for(var z=A.childNodes,y=0,x=z.length;y<x;y++){d.destroy(z[y])}};d.addEvent=function(z,y,x){if(z.addEventListener){z.addEventListener(y,x,false)}else{z.attachEvent("on"+y,x)}};d.addEvents=function(y,z){for(var x in z){d.addEvent(y,x,z[x])}};d.hasClass=function(y,x){return(" "+y.className+" ").indexOf(" "+x+" ")>-1};d.addClass=function(y,x){if(!d.hasClass(y,x)){y.className=(y.className+" "+x)}};d.removeClass=function(y,x){y.className=y.className.replace(new RegExp("(^|\\s)"+x+"(?:\\s|$)"),"$1")};d.getPos=function(z){var C=B(z);var x=A(z);return{x:C.x-x.x,y:C.y-x.y};function B(E){var D={x:0,y:0};while(E&&!y(E)){D.x+=E.offsetLeft;D.y+=E.offsetTop;E=E.offsetParent}return D}function A(E){var D={x:0,y:0};while(E&&!y(E)){D.x+=E.scrollLeft;D.y+=E.scrollTop;E=E.parentNode}return D}function y(D){return(/^(?:body|html)$/i).test(D.tagName)}};d.event={get:function(y,x){x=x||window;return y||x.event},getWheel:function(x){return x.wheelDelta?x.wheelDelta/120:-(x.detail||0)/3},isRightClick:function(x){return(x.which==3||x.button==2)},getPos:function(A,z){z=z||window;A=A||z.event;var y=z.document;y=y.documentElement||y.body;if(A.touches&&A.touches.length){A=A.touches[0]}var x={x:A.pageX||(A.clientX+y.scrollLeft),y:A.pageY||(A.clientY+y.scrollTop)};return x},stop:function(x){if(x.stopPropagation){x.stopPropagation()}x.cancelBubble=true;if(x.preventDefault){x.preventDefault()}else{x.returnValue=false}}};$jit.util=$jit.id=d;var r=function(y){y=y||{};var x=function(){for(var B in this){if(typeof this[B]!="function"){this[B]=d.unlink(this[B])}}this.constructor=x;if(r.prototyping){return this}var A=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return A};for(var z in r.Mutators){if(!y[z]){continue}y=r.Mutators[z](y,y[z]);delete y[z]}d.extend(x,this);x.constructor=r;x.prototype=y;return x};r.Mutators={Implements:function(x,y){d.each(d.splat(y),function(A){r.prototyping=A;var z=(typeof A=="function")?new A:A;for(var B in z){if(!(B in x)){x[B]=z[B]}}delete r.prototyping});return x}};d.extend(r,{inherit:function(x,A){for(var z in A){var y=A[z];var C=x[z];var B=d.type(y);if(C&&B=="function"){if(y!=C){r.override(x,z,y)}}else{if(B=="object"){x[z]=d.merge(C,y)}else{x[z]=y}}}return x},override:function(y,x,B){var A=r.prototyping;if(A&&y[x]!=A[x]){A=null}var z=function(){var C=this.parent;this.parent=A?A[x]:y[x];var D=B.apply(this,arguments);this.parent=C;return D};y[x]=z}});r.prototype.implement=function(){var x=this.prototype;d.each(Array.prototype.slice.call(arguments||[]),function(y){r.inherit(x,y)});return this};$jit.Class=r;$jit.json={prune:function(y,x){this.each(y,function(A,z){if(z==x&&A.children){delete A.children;A.children=[]}})},getParent:function(x,B){if(x.id==B){return false}var A=x.children;if(A&&A.length>0){for(var z=0;z<A.length;z++){if(A[z].id==B){return x}else{var y=this.getParent(A[z],B);if(y){return y}}}}return false},getSubtree:function(x,B){if(x.id==B){return x}for(var z=0,A=x.children;A&&z<A.length;z++){var y=this.getSubtree(A[z],B);if(y!=null){return y}}return null},eachLevel:function(x,C,z,B){if(C<=z){B(x,C);if(!x.children){return}for(var y=0,A=x.children;y<A.length;y++){this.eachLevel(A[y],C+1,z,B)}}},each:function(x,y){this.eachLevel(x,0,Number.MAX_VALUE,y)}};$jit.Trans={$extend:true,linear:function(x){return x}};var j=$jit.Trans;(function(){var x=function(A,z){z=d.splat(z);return d.extend(A,{easeIn:function(B){return A(B,z)},easeOut:function(B){return 1-A(1-B,z)},easeInOut:function(B){return(B<=0.5)?A(2*B,z)/2:(2-A(2*(1-B),z))/2}})};var y={Pow:function(A,z){return Math.pow(A,z[0]||6)},Expo:function(z){return Math.pow(2,8*(z-1))},Circ:function(z){return 1-Math.sin(Math.acos(z))},Sine:function(z){return 1-Math.sin((1-z)*Math.PI/2)},Back:function(A,z){z=z[0]||1.618;return Math.pow(A,2)*((z+1)*A-z)},Bounce:function(C){var B;for(var A=0,z=1;1;A+=z,z/=2){if(C>=(7-4*A)/11){B=z*z-Math.pow((11-6*A-11*C)/4,2);break}}return B},Elastic:function(A,z){return Math.pow(2,10*--A)*Math.cos(20*A*Math.PI*(z[0]||1)/3)}};d.each(y,function(A,z){j[z]=x(A)});d.each(["Quad","Cubic","Quart","Quint"],function(A,z){j[A]=x(function(B){return Math.pow(B,[z+2])})})})();var v=new r({initialize:function(x){this.setOptions(x)},setOptions:function(x){var y={duration:2500,fps:40,transition:j.Quart.easeInOut,compute:d.empty,complete:d.empty,link:"ignore"};this.opt=d.merge(y,x||{});return this},step:function(){var y=d.time(),x=this.opt;if(y<this.time+x.duration){var z=x.transition((y-this.time)/x.duration);x.compute(z)}else{this.timer=clearInterval(this.timer);x.compute(1);x.complete()}},start:function(){if(!this.check()){return this}this.time=0;this.startTimer();return this},startTimer:function(){var x=this,y=this.opt.fps;if(this.timer){return false}this.time=d.time()-this.time;this.timer=setInterval((function(){x.step()}),Math.round(1000/y));return true},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer){return false}this.time=d.time()-this.time;this.timer=clearInterval(this.timer);return true},check:function(){if(!this.timer){return true}if(this.opt.link=="cancel"){this.stopTimer();return true}return false}});var o=function(){var z=arguments;for(var B=0,x=z.length,y={};B<x;B++){var A=o[z[B]];if(A.$extend){d.extend(y,A)}else{y[z[B]]=A}}return y};o.AreaChart={$extend:true,animate:true,labelOffset:3,type:"stacked",Tips:{enable:false,onShow:d.empty,onHide:d.empty},Events:{enable:false,onClick:d.empty},selectOnHover:true,showAggregates:true,showLabels:true,filterOnClick:false,restoreOnRightClick:false};o.Margin={$extend:false,top:0,left:0,right:0,bottom:0};o.Canvas={$extend:true,injectInto:"id",type:"2D",width:false,height:false,useCanvas:false,withLabels:true,background:false,Scene:{Lighting:{enable:false,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[0.5,0.3,0.1]}}}};o.Tree={$extend:true,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center",levelSpacing:"even"};o.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,autoWidth:false,lineWidth:1,transform:true,align:"center",angularWidth:1,span:1,CanvasStyles:{}};o.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};o.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:true};o.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};o.Tips={$extend:false,enable:false,type:"auto",offsetX:20,offsetY:20,force:false,onShow:d.empty,onHide:d.empty};o.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};o.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:d.empty,onRightClick:d.empty,onMouseMove:d.empty,onMouseEnter:d.empty,onMouseLeave:d.empty,onDragStart:d.empty,onDragMove:d.empty,onDragCancel:d.empty,onDragEnd:d.empty,onTouchStart:d.empty,onTouchMove:d.empty,onTouchEnd:d.empty,onTouchCancel:d.empty,onMouseWheel:d.empty};o.Navigation={$extend:false,enable:false,type:"auto",panning:false,zooming:false};o.Controller={$extend:true,onBeforeCompute:d.empty,onAfterCompute:d.empty,onCreateLabel:d.empty,onPlaceLabel:d.empty,onComplete:d.empty,onBeforePlotLine:d.empty,onAfterPlotLine:d.empty,onBeforePlotNode:d.empty,onAfterPlotNode:d.empty,onBeforeRemoveNode:d.empty,request:false};var u={initialize:function(z,x){this.viz=x;this.canvas=x.canvas;this.config=x.config[z];this.nodeTypes=x.fx.nodeTypes;var y=this.config.type;this.dom=y=="auto"?(x.config.Label.type!="Native"):(y!="Native");this.labelContainer=this.dom&&x.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:d.empty,setAsProperty:d.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(C,B,A){C=d.event.get(C,B);var x=this.labelContainer,z=C.target||C.srcElement,y=C.relatedTarget;if(A){return y&&y==this.viz.canvas.getCtx().canvas&&!!z&&this.isDescendantOf(z,x)}else{return this.isDescendantOf(z,x)}},isDescendantOf:function(y,x){while(y&&y.parentNode){if(y.parentNode==x){return y}y=y.parentNode}return false}};var i={onMouseUp:d.empty,onMouseDown:d.empty,onMouseMove:d.empty,onMouseOver:d.empty,onMouseOut:d.empty,onMouseWheel:d.empty,onTouchStart:d.empty,onTouchMove:d.empty,onTouchEnd:d.empty,onTouchCancel:d.empty};var t=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.node=false;this.edge=false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var z=this.canvas.getElement(),y=this;z.oncontextmenu=d.lambda(false);d.addEvents(z,{mouseup:function(C,B){var A=d.event.get(C,B);y.handleEvent("MouseUp",C,B,y.makeEventObject(C,B),d.event.isRightClick(A))},mousedown:function(C,B){var A=d.event.get(C,B);y.handleEvent("MouseDown",C,B,y.makeEventObject(C,B),d.event.isRightClick(A))},mousemove:function(B,A){y.handleEvent("MouseMove",B,A,y.makeEventObject(B,A))},mouseover:function(B,A){y.handleEvent("MouseOver",B,A,y.makeEventObject(B,A))},mouseout:function(B,A){y.handleEvent("MouseOut",B,A,y.makeEventObject(B,A))},touchstart:function(B,A){y.handleEvent("TouchStart",B,A,y.makeEventObject(B,A))},touchmove:function(B,A){y.handleEvent("TouchMove",B,A,y.makeEventObject(B,A))},touchend:function(B,A){y.handleEvent("TouchEnd",B,A,y.makeEventObject(B,A))}});var x=function(D,C){var B=d.event.get(D,C);var A=d.event.getWheel(B);y.handleEvent("MouseWheel",D,C,A)};if(!document.getBoxObjectFor&&window.mozInnerScreenX==null){d.addEvent(z,"mousewheel",x)}else{z.addEventListener("DOMMouseScroll",x,false)}},register:function(x){this.registeredObjects.push(x)},handleEvent:function(){var y=Array.prototype.slice.call(arguments),B=y.shift();for(var A=0,z=this.registeredObjects,x=z.length;A<x;A++){z[A]["on"+B].apply(z[A],y)}},makeEventObject:function(D,C){var A=this,B=this.viz.graph,z=this.viz.fx,y=z.nodeTypes,x=z.edgeTypes;return{pos:false,node:false,edge:false,contains:false,getNodeCalled:false,getEdgeCalled:false,getPos:function(){var G=A.viz.canvas,H=G.getSize(),I=G.getPos(),F=G.translateOffsetX,E=G.translateOffsetY,L=G.scaleOffsetX,J=G.scaleOffsetY,K=d.event.getPos(D,C);this.pos={x:(K.x-I.x-H.width/2-F)*1/L,y:(K.y-I.y-H.height/2-E)*1/J};return this.pos},getNode:function(){if(this.getNodeCalled){return this.node}this.getNodeCalled=true;for(var H in B.nodes){var G=B.nodes[H],F=G&&y[G.getData("type")],E=F&&F.contains&&F.contains.call(z,G,this.getPos());if(E){this.contains=E;return A.node=this.node=G}}return A.node=this.node=false},getEdge:function(){if(this.getEdgeCalled){return this.edge}this.getEdgeCalled=true;var G={};for(var K in B.edges){var I=B.edges[K];G[K]=true;for(var J in I){if(J in G){continue}var H=I[J],F=H&&x[H.getData("type")],E=F&&F.contains&&F.contains.call(z,H,this.getPos());if(E){this.contains=E;return A.edge=this.edge=H}}}return A.edge=this.edge=false},getContains:function(){if(this.getNodeCalled){return this.contains}this.getNode();return this.contains}}}});var p={initializeExtras:function(){var y=new t(this),x=this;d.each(["NodeStyles","Tips","Navigation","Events"],function(z){var A=new p.Classes[z](z,x);if(A.isEnabled()){y.register(A)}if(A.setAsProperty()){x[z.toLowerCase()]=A}})}};p.Classes={};p.Classes.Events=new r({Implements:[u,i],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.hovered=false;this.pressed=false;this.touched=false;this.touchMoved=false;this.moved=false},setAsProperty:d.lambda(true),onMouseUp:function(B,A,y,z){var x=d.event.get(B,A);if(!this.moved){if(z){this.config.onRightClick(this.hovered,y,x)}else{this.config.onClick(this.pressed,y,x)}}if(this.pressed){if(this.moved){this.config.onDragEnd(this.pressed,y,x)}else{this.config.onDragCancel(this.pressed,y,x)}this.pressed=this.moved=false}},onMouseOut:function(C,B,A){var y=d.event.get(C,B),z;if(this.dom&&(z=this.isLabel(C,B,true))){this.config.onMouseLeave(this.viz.graph.getNode(z.id),A,y);this.hovered=false;return}var x=y.relatedTarget,D=this.canvas.getElement();while(x&&x.parentNode){if(D==x.parentNode){return}x=x.parentNode}if(this.hovered){this.config.onMouseLeave(this.hovered,A,y);this.hovered=false}},onMouseOver:function(B,A,z){var x=d.event.get(B,A),y;if(this.dom&&(y=this.isLabel(B,A,true))){this.hovered=this.viz.graph.getNode(y.id);this.config.onMouseEnter(this.hovered,z,x)}},onMouseMove:function(D,C,B){var y,x=d.event.get(D,C);if(this.pressed){this.moved=true;this.config.onDragMove(this.pressed,B,x);return}if(this.dom){this.config.onMouseMove(this.hovered,B,x)}else{if(this.hovered){var E=this.hovered;var A=E.nodeFrom?this.etypes[E.getData("type")]:this.ntypes[E.getData("type")];var z=A&&A.contains&&A.contains.call(this.fx,E,B.getPos());if(z){this.config.onMouseMove(E,B,x);return}else{this.config.onMouseLeave(E,B,x);this.hovered=false}}if(this.hovered=(B.getNode()||(this.config.enableForEdges&&B.getEdge()))){this.config.onMouseEnter(this.hovered,B,x)}else{this.config.onMouseMove(false,B,x)}}},onMouseWheel:function(y,x,z){this.config.onMouseWheel(z,d.event.get(y,x))},onMouseDown:function(B,A,z){var x=d.event.get(B,A),y;if(this.dom){if(y=this.isLabel(B,A)){this.pressed=this.viz.graph.getNode(y.id)}}else{this.pressed=z.getNode()||(this.config.enableForEdges&&z.getEdge())}this.pressed&&this.config.onDragStart(this.pressed,z,x)},onTouchStart:function(B,A,z){var x=d.event.get(B,A),y;if(this.dom&&(y=this.isLabel(B,A))){this.touched=this.viz.graph.getNode(y.id)}else{this.touched=z.getNode()||(this.config.enableForEdges&&z.getEdge())}this.touched&&this.config.onTouchStart(this.touched,z,x)},onTouchMove:function(A,z,y){var x=d.event.get(A,z);if(this.touched){this.touchMoved=true;this.config.onTouchMove(this.touched,y,x)}},onTouchEnd:function(A,z,y){var x=d.event.get(A,z);if(this.touched){if(this.touchMoved){this.config.onTouchEnd(this.touched,y,x)}else{this.config.onTouchCancel(this.touched,y,x)}this.touched=this.touchMoved=false}}});p.Classes.Tips=new r({Implements:[u,i],initializePost:function(){if(document.body){var x=d("_tooltip")||document.createElement("div");x.id="_tooltip";x.className="tip";d.extend(x.style,{position:"absolute",display:"none",zIndex:13000});document.body.appendChild(x);this.tip=x;this.node=false}},setAsProperty:d.lambda(true),onMouseOut:function(A,z){var y=d.event.get(A,z);if(this.dom&&this.isLabel(A,z,true)){this.hide(true);return}var x=A.relatedTarget,B=this.canvas.getElement();while(x&&x.parentNode){if(B==x.parentNode){return}x=x.parentNode}this.hide(false)},onMouseOver:function(z,y){var x;if(this.dom&&(x=this.isLabel(z,y,false))){this.node=this.viz.graph.getNode(x.id);this.config.onShow(this.tip,this.node,x)}},onMouseMove:function(A,z,x){if(this.dom&&this.isLabel(A,z)){this.setTooltipPosition(d.event.getPos(A,z))}if(!this.dom){var y=x.getNode();if(!y){this.hide(true);return}if(this.config.force||!this.node||this.node.id!=y.id){this.node=y;this.config.onShow(this.tip,y,x.getContains())}this.setTooltipPosition(d.event.getPos(A,z))}},setTooltipPosition:function(D){var G=this.tip,z=G.style,H=this.config;z.display="";var A=document.compatMode==="CSS1Compat"&&document.documentElement||document.body||document.documentElement;var E={width:A.clientWidth,height:A.clientHeight,x:window.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body&&document.body.scrollLeft||0,y:window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop||0};var B={width:G.offsetWidth,height:G.offsetHeight};var F=H.offsetX,C=H.offsetY;z.top=((D.y+B.height+C>E.height+E.y)?(D.y-B.height-C):D.y+C)+"px";z.left=((D.x+B.width+F>E.width+E.x)?(D.x-B.width-F):D.x+F)+"px"},hide:function(x){this.tip.style.display="none";x&&this.config.onHide()}});p.Classes.NodeStyles=new r({Implements:[u,i],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new v();this.down=false;this.move=false},onMouseOut:function(z,y){this.down=this.move=false;if(!this.hoveredNode){return}if(this.dom&&this.isLabel(z,y,true)){this.toggleStylesOnHover(this.hoveredNode,false)}var x=z.relatedTarget,A=this.canvas.getElement();while(x&&x.parentNode){if(A==x.parentNode){return}x=x.parentNode}this.toggleStylesOnHover(this.hoveredNode,false);this.hoveredNode=false},onMouseOver:function(A,z){var x;if(this.dom&&(x=this.isLabel(A,z,true))){var y=this.viz.graph.getNode(x.id);if(y.selected){return}this.hoveredNode=y;this.toggleStylesOnHover(this.hoveredNode,true)}},onMouseDown:function(B,A,y,z){if(z){return}var x;if(this.dom&&(x=this.isLabel(B,A))){this.down=this.viz.graph.getNode(x.id)}else{if(!this.dom){this.down=y.getNode()}}this.move=false},onMouseUp:function(A,z,x,y){if(y){return}if(!this.move){this.onClick(x.getNode())}this.down=this.move=false},getRestoredStyles:function(y,x){var A={},z=this["nodeStylesOn"+x];for(var B in z){A[B]=y.styles["$"+B]}return A},toggleStylesOnHover:function(x,y){if(this.nodeStylesOnHover){this.toggleStylesOn("Hover",x,y)}},toggleStylesOnClick:function(x,y){if(this.nodeStylesOnClick){this.toggleStylesOn("Click",x,y)}},toggleStylesOn:function(B,x,D){var E=this.viz;var C=this.nStyles;if(D){var A=this;if(!x.styles){x.styles=d.merge(x.data,{})}for(var F in this["nodeStylesOn"+B]){var y="$"+F;if(!(y in x.styles)){x.styles[y]=x.getData(F)}}E.fx.nodeFx(d.extend({elements:{id:x.id,properties:A["nodeStylesOn"+B]},transition:j.Quart.easeOut,duration:300,fps:40},this.config))}else{var z=this.getRestoredStyles(x,B);E.fx.nodeFx(d.extend({elements:{id:x.id,properties:z},transition:j.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(x){if(!x){return}var y=this.nodeStylesOnClick;if(!y){return}if(x.selected){this.toggleStylesOnClick(x,false);delete x.selected}else{this.viz.graph.eachNode(function(A){if(A.selected){for(var z in y){A.setData(z,A.styles["$"+z],"end")}delete A.selected}});this.toggleStylesOnClick(x,true);x.selected=true;delete x.hovered;this.hoveredNode=false}},onMouseMove:function(D,C,A){if(this.down){this.move=true}if(this.dom&&this.isLabel(D,C)){return}var B=this.nodeStylesOnHover;if(!B){return}if(!this.dom){if(this.hoveredNode){var y=this.types[this.hoveredNode.getData("type")];var x=y&&y.contains&&y.contains.call(this.fx,this.hoveredNode,A.getPos());if(x){return}}var z=A.getNode();if(!this.hoveredNode&&!z){return}if(z.hovered){return}if(z&&!z.selected){this.fx.nodeFxAnimation.stopTimer();this.viz.graph.eachNode(function(F){if(F.hovered&&!F.selected){for(var E in B){F.setData(E,F.styles["$"+E],"end")}delete F.hovered}});z.hovered=true;this.hoveredNode=z;this.toggleStylesOnHover(z,true)}else{if(this.hoveredNode&&!this.hoveredNode.selected){this.fx.nodeFxAnimation.stopTimer();this.toggleStylesOnHover(this.hoveredNode,false);delete this.hoveredNode.hovered;this.hoveredNode=false}}}}});p.Classes.Navigation=new r({Implements:[u,i],initializePost:function(){this.pos=false;this.pressed=false},onMouseWheel:function(A,z,x){if(!this.config.zooming){return}d.event.stop(d.event.get(A,z));var B=this.config.zooming/1000,y=1+x*B;this.canvas.scale(y,y)},onMouseDown:function(C,B,A){if(!this.config.panning){return}C.preventDefault?C.preventDefault():C.returnValue=false;d.addClass(this.canvas.getElement(),"grabbing");if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(C,B):(A.getNode()||A.getEdge()))){return}this.pressed=true;this.pos=A.getPos();var z=this.canvas,y=z.translateOffsetX,x=z.translateOffsetY,E=z.scaleOffsetX,D=z.scaleOffsetY;this.pos.x*=E;this.pos.x+=y;this.pos.y*=D;this.pos.y+=x},onMouseMove:function(E,D,G){if(!this.config.panning){return}if(!this.pressed){return}if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(E,D):G.getNode())){return}var C=this.pos,F=G.getPos(),A=this.canvas,B=A.translateOffsetX,z=A.translateOffsetY,K=A.scaleOffsetX,I=A.scaleOffsetY;F.x*=K;F.y*=I;F.x+=B;F.y+=z;var J=F.x-C.x,H=F.y-C.y;this.pos=F;this.canvas.translate(J*1/K,H*1/I)},onMouseUp:function(A,z,y,x){if(!this.config.panning){return}d.removeClass(this.canvas.getElement(),"grabbing");this.pressed=false}});var m;(function(){var x=typeof HTMLCanvasElement,z=(x=="object"||x=="function");function y(A,B){var C=document.createElement(A);for(var D in B){if(typeof B[D]=="object"){d.extend(C[D],B[D])}else{C[D]=B[D]}}if(A=="canvas"&&!z&&G_vmlCanvasManager){C=G_vmlCanvasManager.initElement(document.body.appendChild(C))}return C}$jit.Canvas=m=new r({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(M,F){this.viz=M;this.opt=this.config=F;var C=d.type(F.injectInto)=="string"?F.injectInto:F.injectInto.id,L=F.type,D=C+"-label",A=d(C),E=F.width||A.offsetWidth,N=F.height||A.offsetHeight;this.id=C;var G={injectInto:C,width:E,height:N};this.element=y("div",{id:C+"-canvaswidget",style:{position:"relative",width:E+"px",height:N+"px"}});this.labelContainer=this.createLabelContainer(F.Label.type,D,G);this.canvases.push(new m.Base[L]({config:d.extend({idSuffix:"-canvas"},G),plot:function(O){M.fx.plot()},resize:function(){M.refresh()}}));var H=F.background;if(H){var K=new m.Background[H.type](M,d.extend(H,G));this.canvases.push(new m.Base[L](K))}var J=this.canvases.length;while(J--){this.element.appendChild(this.canvases[J].canvas);if(J>0){this.canvases[J].plot()}}this.element.appendChild(this.labelContainer);A.appendChild(this.element);var B=null,I=this;d.addEvent(window,"scroll",function(){clearTimeout(B);B=setTimeout(function(){I.getPos(true)},500)})},getCtx:function(A){return this.canvases[A||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(A){return this.canvases[A||0].getSize()},resize:function(E,A){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var C=0,B=this.canvases.length;C<B;C++){this.canvases[C].resize(E,A)}var D=this.element.style;D.width=E+"px";D.height=A+"px";if(this.labelContainer){this.labelContainer.style.width=E+"px"}},translate:function(A,E,D){this.translateOffsetX+=A*this.scaleOffsetX;this.translateOffsetY+=E*this.scaleOffsetY;for(var C=0,B=this.canvases.length;C<B;C++){this.canvases[C].translate(A,E,D)}},scale:function(F,C,D){var G=this.scaleOffsetX*F,E=this.scaleOffsetY*C;var I=this.translateOffsetX*(F-1)/G,H=this.translateOffsetY*(C-1)/E;this.scaleOffsetX=G;this.scaleOffsetY=E;for(var B=0,A=this.canvases.length;B<A;B++){this.canvases[B].scale(F,C,true)}this.translate(I,H,false)},getZoom:function(){return new q(this.scaleOffsetX,this.scaleOffsetY)},setZoom:function(A,F,D){var E=this.getZoom(),C=A/E.x,B=F/E.y;this.scale(C,B,D)},getPos:function(A){if(A||!this.pos){return this.pos=d.getPos(this.getElement())}return this.pos},clear:function(A){this.canvases[A||0].clear()},path:function(B,C){var A=this.canvases[0].getCtx();A.beginPath();C(A);A[B]();A.closePath()},createLabelContainer:function(C,G,F){var E="http://www.w3.org/2000/svg";if(C=="HTML"||C=="Native"){return y("div",{id:G,style:{overflow:"visible",position:"absolute",top:0,left:0,width:F.width+"px",height:0}})}else{if(C=="SVG"){var D=document.createElementNS(E,"svg:svg");D.setAttribute("width",F.width);D.setAttribute("height",F.height);var B=D.style;B.position="absolute";B.left=B.top="0px";var A=document.createElementNS(E,"svg:g");A.setAttribute("width",F.width);A.setAttribute("height",F.height);A.setAttribute("x",0);A.setAttribute("y",0);A.setAttribute("id",G);D.appendChild(A);return D}}}});m.Base={};m.Base["2D"]=new r({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(A){this.viz=A;this.opt=A.config;this.size=false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var B=this.opt,C=B.width,A=B.height;this.canvas=y("canvas",{id:B.injectInto+B.idSuffix,width:C,height:A,style:{position:"absolute",top:0,left:0,width:C+"px",height:A+"px"}})},getCtx:function(){if(!this.ctx){return this.ctx=this.canvas.getContext("2d")}return this.ctx},getSize:function(){if(this.size){return this.size}var A=this.canvas;return this.size={width:A.width,height:A.height}},translateToCenter:function(D){var B=this.getSize(),C=D?(B.width-D.width-this.translateOffsetX*2):B.width;height=D?(B.height-D.height-this.translateOffsetY*2):B.height;var A=this.getCtx();D&&A.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);A.translate(C/2,height/2)},resize:function(D,A){var C=this.getSize(),B=this.canvas,E=B.style;this.size=false;B.width=D;B.height=A;E.width=D+"px";E.height=A+"px";if(!z){this.translateToCenter(C)}else{this.translateToCenter()}this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(D,A,this)},translate:function(A,E,B){var D=this.scaleOffsetX,C=this.scaleOffsetY;this.translateOffsetX+=A*D;this.translateOffsetY+=E*C;this.getCtx().translate(A,E);!B&&this.plot()},scale:function(A,C,B){this.scaleOffsetX*=A;this.scaleOffsetY*=C;this.getCtx().scale(A,C);!B&&this.plot()},clear:function(){var C=this.getSize(),B=this.translateOffsetX,A=this.translateOffsetY,E=this.scaleOffsetX,D=this.scaleOffsetY;this.getCtx().clearRect((-C.width/2-B)*1/E,(-C.height/2-A)*1/D,C.width*1/E,C.height*1/D)},plot:function(){this.clear();this.viz.plot(this)}});m.Background={};m.Background.Circles=new r({initialize:function(A,B){this.viz=A;this.config=d.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},B)},resize:function(B,A,C){this.plot(C)},plot:function(A){var B=A.canvas,H=A.getCtx(),E=this.config,G=E.CanvasStyles;for(var I in G){H[I]=G[I]}var C=E.numberOfCircles,F=E.levelDistance;for(var D=1;D<=C;D++){H.beginPath();H.arc(0,0,F*D,0,2*Math.PI,false);H.stroke();H.closePath()}}})})();var b=function(y,x){this.theta=y||0;this.rho=x||0};$jit.Polar=b;b.prototype={getc:function(x){return this.toComplex(x)},getp:function(){return this},set:function(x){x=x.getp();this.theta=x.theta;this.rho=x.rho},setc:function(z,A){this.rho=Math.sqrt(z*z+A*A);this.theta=Math.atan2(A,z);if(this.theta<0){this.theta+=Math.PI*2}},setp:function(y,x){this.theta=y;this.rho=x},clone:function(){return new b(this.theta,this.rho)},toComplex:function(B){var z=Math.cos(this.theta)*this.rho;var A=Math.sin(this.theta)*this.rho;if(B){return{x:z,y:A}}return new q(z,A)},add:function(x){return new b(this.theta+x.theta,this.rho+x.rho)},scale:function(x){return new b(this.theta,this.rho*x)},equals:function(x){return this.theta==x.theta&&this.rho==x.rho},$add:function(x){this.theta=this.theta+x.theta;this.rho+=x.rho;return this},$madd:function(x){this.theta=(this.theta+x.theta)%(Math.PI*2);this.rho+=x.rho;return this},$scale:function(x){this.rho*=x;return this},isZero:function(){var y=0.0001,x=Math.abs;return x(this.theta)<y&&x(this.rho)<y},interpolate:function(z,G){var A=Math.PI,D=A*2;var y=function(I){var H=(I<0)?(I%D)+D:I%D;return H};var C=this.theta,F=z.theta;var B,E=Math.abs(C-F);if(E==A){if(C>F){B=y((F+((C-D)-F)*G))}else{B=y((F-D+(C-(F))*G))}}else{if(E>=A){if(C>F){B=y((F+((C-D)-F)*G))}else{B=y((F-D+(C-(F-D))*G))}}else{B=y((F+(C-F)*G))}}var x=(this.rho-z.rho)*G+z.rho;return{theta:B,rho:x}}};var l=function(y,x){return new b(y,x)};b.KER=l(0,0);var q=function(z,A){this.x=z||0;this.y=A||0};$jit.Complex=q;q.prototype={getc:function(){return this},getp:function(x){return this.toPolar(x)},set:function(x){x=x.getc(true);this.x=x.x;this.y=x.y},setc:function(z,A){this.x=z;this.y=A},setp:function(y,x){this.x=Math.cos(y)*x;this.y=Math.sin(y)*x},clone:function(){return new q(this.x,this.y)},toPolar:function(z){var x=this.norm();var y=Math.atan2(this.y,this.x);if(y<0){y+=Math.PI*2}if(z){return{theta:y,rho:x}}return new b(y,x)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(x){return new q(this.x+x.x,this.y+x.y)},prod:function(x){return new q(this.x*x.x-this.y*x.y,this.y*x.x+this.x*x.y)},conjugate:function(){return new q(this.x,-this.y)},scale:function(x){return new q(this.x*x,this.y*x)},equals:function(x){return this.x==x.x&&this.y==x.y},$add:function(x){this.x+=x.x;this.y+=x.y;return this},$prod:function(B){var z=this.x,A=this.y;this.x=z*B.x-A*B.y;this.y=A*B.x+z*B.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(x){this.x*=x;this.y*=x;return this},$div:function(C){var z=this.x,B=this.y;var A=C.squaredNorm();this.x=z*C.x+B*C.y;this.y=B*C.x-z*C.y;return this.$scale(1/A)},isZero:function(){var y=0.0001,x=Math.abs;return x(this.x)<y&&x(this.y)<y}};var s=function(y,x){return new q(y,x)};q.KER=s(0,0);q.IM=s(0,1);$jit.Graph=new r({initialize:function(z,y,x,D){var B={klass:q,Node:{}};this.Node=y;this.Edge=x;this.Label=D;this.opt=d.merge(B,z||{});this.nodes={};this.edges={};var A=this;this.nodeList={};for(var C in k){A.nodeList[C]=(function(E){return function(){var F=Array.prototype.slice.call(arguments);A.eachNode(function(G){G[E].apply(G,F)})}})(C)}},getNode:function(x){if(this.hasNode(x)){return this.nodes[x]}return false},get:function(x){return this.getNode(x)},getByName:function(x){for(var z in this.nodes){var y=this.nodes[z];if(y.name==x){return y}}return false},getAdjacence:function(y,x){if(y in this.edges){return this.edges[y][x]}return false},addNode:function(y){if(!this.nodes[y.id]){var x=this.edges[y.id]={};this.nodes[y.id]=new f.Node(d.extend({id:y.id,name:y.name,data:d.merge(y.data||{},{}),adjacencies:x},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[y.id]},addAdjacence:function(A,z,y){if(!this.hasNode(A.id)){this.addNode(A)}if(!this.hasNode(z.id)){this.addNode(z)}A=this.nodes[A.id];z=this.nodes[z.id];if(!A.adjacentTo(z)){var B=this.edges[A.id]=this.edges[A.id]||{};var x=this.edges[z.id]=this.edges[z.id]||{};B[z.id]=x[A.id]=new f.Adjacence(A,z,y,this.Edge,this.Label);return B[z.id]}return this.edges[A.id][z.id]},removeNode:function(z){if(this.hasNode(z)){delete this.nodes[z];var y=this.edges[z];for(var x in y){delete this.edges[x][z]}delete this.edges[z]}},removeAdjacence:function(y,x){delete this.edges[y][x];delete this.edges[x][y]},hasNode:function(x){return x in this.nodes},empty:function(){this.nodes={};this.edges={}}});var f=$jit.Graph;var k;(function(){var x=function(E,G,B,D,F){var C;B=B||"current";E="$"+(E?E+"-":"");if(B=="current"){C=this.data}else{if(B=="start"){C=this.startData}else{if(B=="end"){C=this.endData}}}var A=E+G;if(D){return C[A]}if(!this.Config.overridable){return F[G]||0}return(A in C)?C[A]:((A in this.data)?this.data[A]:(F[G]||0))};var z=function(D,E,C,A){A=A||"current";D="$"+(D?D+"-":"");var B;if(A=="current"){B=this.data}else{if(A=="start"){B=this.startData}else{if(A=="end"){B=this.endData}}}B[D+E]=C};var y=function(C,A){C="$"+(C?C+"-":"");var B=this;d.each(A,function(E){var D=C+E;delete B.data[D];delete B.endData[D];delete B.startData[D]})};k={getData:function(C,A,B){return x.call(this,"",C,A,B,this.Config)},setData:function(C,B,A){z.call(this,"",C,B,A)},setDataset:function(D,E){D=d.splat(D);for(var A in E){for(var C=0,F=d.splat(E[A]),B=D.length;C<B;C++){this.setData(A,F[C],D[C])}}},removeData:function(){y.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(C,A,B){return x.call(this,"canvas",C,A,B,this.Config.CanvasStyles)},setCanvasStyle:function(C,B,A){z.call(this,"canvas",C,B,A)},setCanvasStyles:function(D,E){D=d.splat(D);for(var A in E){for(var C=0,F=d.splat(E[A]),B=D.length;C<B;C++){this.setCanvasStyle(A,F[C],D[C])}}},removeCanvasStyle:function(){y.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(C,A,B){return x.call(this,"label",C,A,B,this.Label)},setLabelData:function(C,B,A){z.call(this,"label",C,B,A)},setLabelDataset:function(D,E){D=d.splat(D);for(var A in E){for(var C=0,F=d.splat(E[A]),B=D.length;C<B;C++){this.setLabelData(A,F[C],D[C])}}},removeLabelData:function(){y.call(this,"label",Array.prototype.slice.call(arguments))}}})();f.Node=new r({initialize:function(A,x,z,y,C){var B={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,angleSpan:{begin:0,end:0},pos:new x,startPos:new x,endPos:new x};d.extend(this,d.extend(B,A));this.Config=this.Node=z;this.Edge=y;this.Label=C},adjacentTo:function(x){return x.id in this.adjacencies},adjacentWithDirectionTo:function(x){var y=x.id in this.adjacencies;if(!y){return false}var z=this.adjacencies[x.id].data.$direction;return z[0]===this.id},getAdjacency:function(x){return this.adjacencies[x]},getPos:function(x){x=x||"current";if(x=="current"){return this.pos}else{if(x=="end"){return this.endPos}else{if(x=="start"){return this.startPos}}}},setPos:function(y,x){x=x||"current";var z;if(x=="current"){z=this.pos}else{if(x=="end"){z=this.endPos}else{if(x=="start"){z=this.startPos}}}z.set(y)}});f.Node.implement(k);f.Adjacence=new r({initialize:function(y,B,z,x,A){this.nodeFrom=y;this.nodeTo=B;this.data=z||{};this.startData={};this.endData={};this.Config=this.Edge=x;this.Label=A}});f.Adjacence.implement(k);f.Util={filter:function(y){if(!y||!(d.type(y)=="string")){return function(){return true}}var x=y.split(" ");return function(A){for(var z=0;z<x.length;z++){if(A[x[z]]){return false}}return true}},getNode:function(x,y){return x.nodes[y]},eachNode:function(B,A,x){var z=this.filter(x);for(var y in B.nodes){if(z(B.nodes[y])){A(B.nodes[y])}}},each:function(z,y,x){this.eachNode(z,y,x)},eachAdjacency:function(C,D,y){var z=C.adjacencies,B=this.filter(y);for(var E in z){var x=z[E];if(B(x)){if(x.nodeFrom!=C){var A=x.nodeFrom;x.nodeFrom=x.nodeTo;x.nodeTo=A}D(x,E)}}},computeLevels:function(D,E,A,z){A=A||0;var B=this.filter(z);this.eachNode(D,function(F){F._flag=false;F._depth=-1},z);var y=D.getNode(E);y._depth=A;var x=[y];while(x.length!=0){var C=x.pop();C._flag=true;this.eachAdjacency(C,function(F){var G=F.nodeTo;if(G._flag==false&&B(G)&&!F._hiding){if(G._depth<0){G._depth=C._depth+1+A}x.unshift(G)}},z)}},eachBFS:function(C,D,B,y){var z=this.filter(y);this.clean(C);var x=[C.getNode(D)];while(x.length!=0){var A=x.pop();if(!A){return}A._flag=true;B(A,A._depth);this.eachAdjacency(A,function(E){var F=E.nodeTo;if(F._flag==false&&z(F)&&!E._hiding){F._flag=true;x.unshift(F)}},y)}},eachLevel:function(B,G,y,C,A){var F=B._depth,x=this.filter(A),D=this,E=true;y=y===false?Number.MAX_VALUE-F:y;(function z(K,H,I){if(!E){return}var L=K._depth,J;if(L>=H&&L<=I&&x(K)){J=C(K,L)}if(typeof J!=="undefined"){E=J}if(E&&L<I){D.eachAdjacency(K,function(M){var N=M.nodeTo;if(N._depth>L){z(N,H,I)}})}})(B,G+F,y+F)},eachSubgraph:function(y,z,x){this.eachLevel(y,0,false,z,x)},eachSubnode:function(y,z,x){this.eachLevel(y,1,1,z,x)},anySubnode:function(A,z,y){var x=false;z=z||d.lambda(true);var B=d.type(z)=="string"?function(C){return C[z]}:z;this.eachSubnode(A,function(C){if(B(C)){x=true}},y);return x},getSubnodes:function(C,D,x){var z=[],B=this;D=D||0;var A,y;if(d.type(D)=="array"){A=D[0];y=D[1]}else{A=D;y=Number.MAX_VALUE-C._depth}this.eachLevel(C,A,y,function(E){z.push(E)},x);return z},getParents:function(y){var x=[];this.eachAdjacency(y,function(z){var A=z.nodeTo;if(A._depth<y._depth){x.push(A)}});return x},isDescendantOf:function(A,B){if(A.id==B){return true}var z=this.getParents(A),x=false;for(var y=0;!x&&y<z.length;y++){x=x||this.isDescendantOf(z[y],B)}return x},clean:function(x){this.eachNode(x,function(y){y._flag=false})},getClosestNodeToOrigin:function(y,z,x){return this.getClosestNodeToPos(y,b.KER,z,x)},getClosestNodeToPos:function(z,C,B,x){var y=null;B=B||"current";C=C&&C.getc(true)||q.KER;var A=function(E,D){var G=E.x-D.x,F=E.y-D.y;return G*G+F*F};this.eachNode(z,function(D){y=(y==null||A(D.getPos(B).getc(true),C)<A(y.getPos(B).getc(true),C))?D:y},x);return y}};d.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(x){f.prototype[x]=function(){return f.Util[x].apply(f.Util,[this].concat(Array.prototype.slice.call(arguments)))}});d.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(x){f.Node.prototype[x]=function(){return f.Util[x].apply(f.Util,[this].concat(Array.prototype.slice.call(arguments)))}});f.Op={options:{type:"nothing",duration:2000,hideLabels:true,fps:30},initialize:function(x){this.viz=x},removeNode:function(C,A){var x=this.viz;var y=d.merge(this.options,x.controller,A);var E=d.splat(C);var z,B,D;switch(y.type){case"nothing":for(z=0;z<E.length;z++){y.onBeforeRemoveNode(x.graph.getNode(E[z]));x.graph.removeNode(E[z])}break;case"replot":this.removeNode(E,{type:"nothing"});x.labels.clearLabels();x.refresh(true);break;case"fade:seq":case"fade":B=this;for(z=0;z<E.length;z++){D=x.graph.getNode(E[z]);D.setData("alpha",0,"end")}x.fx.animate(d.merge(y,{modes:["node-property:alpha"],onComplete:function(){B.removeNode(E,{type:"nothing"});x.labels.clearLabels();x.reposition();x.fx.animate(d.merge(y,{modes:["linear"]}))}}));break;case"fade:con":B=this;for(z=0;z<E.length;z++){D=x.graph.getNode(E[z]);D.setData("alpha",0,"end");D.ignore=true}x.reposition();x.fx.animate(d.merge(y,{modes:["node-property:alpha","linear"],onComplete:function(){B.removeNode(E,{type:"nothing"});y.onComplete&&y.onComplete()}}));break;case"iter":B=this;x.fx.sequence({condition:function(){return E.length!=0},step:function(){B.removeNode(E.shift(),{type:"nothing"});x.labels.clearLabels()},onComplete:function(){y.onComplete&&y.onComplete()},duration:Math.ceil(y.duration/E.length)});break;default:this.doError()}},removeEdge:function(E,C){var x=this.viz;var A=d.merge(this.options,x.controller,C);var z=(d.type(E[0])=="string")?[E]:E;var B,D,y;switch(A.type){case"nothing":for(B=0;B<z.length;B++){x.graph.removeAdjacence(z[B][0],z[B][1])}break;case"replot":this.removeEdge(z,{type:"nothing"});x.refresh(true);break;case"fade:seq":case"fade":D=this;for(B=0;B<z.length;B++){y=x.graph.getAdjacence(z[B][0],z[B][1]);if(y){y.setData("alpha",0,"end")}}x.fx.animate(d.merge(A,{modes:["edge-property:alpha"],onComplete:function(){D.removeEdge(z,{type:"nothing"});x.reposition();x.fx.animate(d.merge(A,{modes:["linear"]}))}}));break;case"fade:con":D=this;for(B=0;B<z.length;B++){y=x.graph.getAdjacence(z[B][0],z[B][1]);if(y){y.setData("alpha",0,"end");y.ignore=true}}x.reposition();x.fx.animate(d.merge(A,{modes:["edge-property:alpha","linear"],onComplete:function(){D.removeEdge(z,{type:"nothing"});A.onComplete&&A.onComplete()}}));break;case"iter":D=this;x.fx.sequence({condition:function(){return z.length!=0},step:function(){D.removeEdge(z.shift(),{type:"nothing"});x.labels.clearLabels()},onComplete:function(){A.onComplete()},duration:Math.ceil(A.duration/z.length)});break;default:this.doError()}},sum:function(B,A){var x=this.viz;var z=d.merge(this.options,x.controller,A),y=x.root;var D;x.root=A.id||x.root;switch(z.type){case"nothing":D=x.construct(B);D.eachNode(function(F){F.eachAdjacency(function(G){x.graph.addAdjacence(G.nodeFrom,G.nodeTo,G.data)})});break;case"replot":x.refresh(true);this.sum(B,{type:"nothing"});x.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;D=x.construct(B);var E=this.preprocessSum(D);var C=!E?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];x.reposition();if(z.type!="fade:con"){x.fx.animate(d.merge(z,{modes:["linear"],onComplete:function(){x.fx.animate(d.merge(z,{modes:C,onComplete:function(){z.onComplete()}}))}}))}else{x.graph.eachNode(function(F){if(F.id!=y&&F.pos.isZero()){F.pos.set(F.endPos);F.startPos.set(F.endPos)}});x.fx.animate(d.merge(z,{modes:["linear"].concat(C)}))}break;default:this.doError()}},morph:function(F,y,A){A=A||{};var C=this.viz;var G=d.merge(this.options,C.controller,y),B=C.root;var D;C.root=y.id||C.root;switch(G.type){case"nothing":D=C.construct(F);D.eachNode(function(J){var I=C.graph.hasNode(J.id);J.eachAdjacency(function(N){var M=!!C.graph.getAdjacence(N.nodeFrom.id,N.nodeTo.id);C.graph.addAdjacence(N.nodeFrom,N.nodeTo,N.data);if(M){var L=C.graph.getAdjacence(N.nodeFrom.id,N.nodeTo.id);for(var O in (N.data||{})){L.data[O]=N.data[O]}}});if(I){var H=C.graph.getNode(J.id);for(var K in (J.data||{})){H.data[K]=J.data[K]}}});C.graph.eachNode(function(H){H.eachAdjacency(function(I){if(!D.getAdjacence(I.nodeFrom.id,I.nodeTo.id)){C.graph.removeAdjacence(I.nodeFrom.id,I.nodeTo.id)}});if(!D.hasNode(H.id)){C.graph.removeNode(H.id)}});break;case"replot":C.labels.clearLabels(true);this.morph(F,{type:"nothing"});C.refresh(true);C.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;D=C.construct(F);var E=("node-property" in A)&&d.map(d.splat(A["node-property"]),function(H){return"$"+H});C.graph.eachNode(function(I){var J=D.getNode(I.id);if(!J){I.setData("alpha",1);I.setData("alpha",1,"start");I.setData("alpha",0,"end");I.ignore=true}else{var H=J.data;for(var K in H){if(E&&(d.indexOf(E,K)>-1)){I.endData[K]=H[K]}else{I.data[K]=H[K]}}}});C.graph.eachNode(function(H){if(H.ignore){return}H.eachAdjacency(function(I){if(I.nodeFrom.ignore||I.nodeTo.ignore){return}var J=D.getNode(I.nodeFrom.id);var K=D.getNode(I.nodeTo.id);if(!J.adjacentTo(K)){var I=C.graph.getAdjacence(J.id,K.id);x=true;I.setData("alpha",1);I.setData("alpha",1,"start");I.setData("alpha",0,"end");I._hiding=true}else{if(I.data.$direction&&I.data.$direction[0]===J.id){if(!J.adjacentWithDirectionTo(K)){I._reversing=true}}}})});var x=this.preprocessSum(D);var z=!x?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];z[0]=z[0]+(("node-property" in A)?(":"+d.splat(A["node-property"]).join(":")):"");z[1]=(z[1]||"edge-property:alpha")+(("edge-property" in A)?(":"+d.splat(A["edge-property"]).join(":")):"");if("label-property" in A){z.push("label-property:"+d.splat(A["label-property"]).join(":"))}if(C.reposition){C.reposition()}else{C.compute("end")}this._updateDirectedEdges();C.graph.eachNode(function(H){if(H.id!=B&&H.pos.getp().equals(b.KER)){H.pos.set(H.endPos);H.startPos.set(H.endPos)}});C.fx.animate(d.merge(G,{modes:[A.position||"polar"].concat(z),onComplete:function(){C.graph.eachNode(function(H){if(H.ignore){C.graph.removeNode(H.id)}});C.graph.eachNode(function(H){H.eachAdjacency(function(I){if(I.ignore){C.graph.removeAdjacence(I.nodeFrom.id,I.nodeTo.id)}})});G.onComplete()}}));break;default:}},_updateDirectedEdges:function(){var x=this.viz.graph;x.eachNode(function(y){y.eachAdjacency(function(B){var C=B.data.$direction;if(C&&B.nodeFrom.id!==B.data.$direction[0]){return}if(B._hiding){x.removeAdjacence(B.nodeFrom.id,B.nodeTo.id)}if(B._reversing){var E=B.nodeFrom.id;var D=B.nodeTo.id;var A=x.edges[E][D];var z=x.edges[D][E];A.data.$direction=[D,E];z.data.$direction=[D,E];B._reversing=undefined}})})},contract:function(z,y){var x=this.viz;if(z.collapsed||!z.anySubnode(d.lambda(true))){return}y=d.merge(this.options,x.config,y||{},{modes:["node-property:alpha:span","linear"]});z.collapsed=true;(function A(B){B.eachSubnode(function(C){C.ignore=true;C.setData("alpha",0,y.type=="animate"?"end":"current");A(C)})})(z);if(y.type=="animate"){x.compute("end");if(x.rotated){x.rotate(x.rotated,"none",{property:"end"})}(function A(B){B.eachSubnode(function(C){C.setPos(z.getPos("end"),"end");A(C)})})(z);x.fx.animate(y)}else{if(y.type=="replot"){x.refresh()}}},expand:function(z,y){if(!("collapsed" in z)){return}var x=this.viz;y=d.merge(this.options,x.config,y||{},{modes:["node-property:alpha:span","linear"]});delete z.collapsed;(function A(B){B.eachSubnode(function(C){delete C.ignore;C.setData("alpha",1,y.type=="animate"?"end":"current");A(C)})})(z);if(y.type=="animate"){x.compute("end");if(x.rotated){x.rotate(x.rotated,"none",{property:"end"})}x.fx.animate(y)}else{if(y.type=="replot"){x.refresh()}}},preprocessSum:function(y){var x=this.viz;y.eachNode(function(A){if(!x.graph.hasNode(A.id)){x.graph.addNode(A);var B=x.graph.getNode(A.id);B.setData("alpha",0);B.setData("alpha",0,"start");B.setData("alpha",1,"end")}});var z=false;y.eachNode(function(A){A.eachAdjacency(function(B){var C=x.graph.getNode(B.nodeFrom.id);var D=x.graph.getNode(B.nodeTo.id);if(!C.adjacentTo(D)){var B=x.graph.addAdjacence(C,D,B.data);if(C.startAlpha==C.endAlpha&&D.startAlpha==D.endAlpha){z=true;B.setData("alpha",0);B.setData("alpha",0,"start");B.setData("alpha",1,"end")}}})});return z}};var a={none:{render:d.empty,contains:d.lambda(false)},circle:{render:function(A,B,x,z){var y=z.getCtx();y.beginPath();y.arc(B.x,B.y,x,0,Math.PI*2,true);y.closePath();y[A]()},contains:function(C,B,x){var z=C.x-B.x,y=C.y-B.y,A=z*z+y*y;return A<=x*x}},ellipse:{render:function(D,F,x,G,y){var H=y.getCtx(),A=1,z=1,E=1,C=1,B=0;if(x>G){B=x/2;z=G/x;C=x/G}else{B=G/2;A=x/G;E=G/x}H.save();H.scale(A,z);H.beginPath();H.arc(F.x*E,F.y*C,B,0,Math.PI*2,true);H.closePath();H[D]();H.restore()},contains:function(x,E,y,G){var D=0,C=1,B=1,A=0,z=0,F=0;if(y>G){D=y/2;B=G/y}else{D=G/2;C=y/G}A=(x.x-E.x)*(1/C);z=(x.y-E.y)*(1/B);F=A*A+z*z;return F<=D*D}},square:{render:function(y,A,z,x){x.getCtx()[y+"Rect"](A.x-z,A.y-z,2*z,2*z)},contains:function(z,y,x){return Math.abs(y.x-z.x)<=x&&Math.abs(y.y-z.y)<=x}},rectangle:{render:function(A,B,z,x,y){y.getCtx()[A+"Rect"](B.x-z/2,B.y-x/2,z,x)},contains:function(A,z,y,x){return Math.abs(z.x-A.x)<=y/2&&Math.abs(z.y-A.y)<=x/2}},triangle:{render:function(D,E,A,x){var H=x.getCtx(),z=E.x,y=E.y-A,G=z-A,F=E.y+A,C=z+A,B=F;H.beginPath();H.moveTo(z,y);H.lineTo(G,F);H.lineTo(C,B);H.closePath();H[D]()},contains:function(z,y,x){return a.circle.contains(z,y,x)}},star:{render:function(B,D,C,y){var x=y.getCtx(),A=Math.PI/5;x.save();x.translate(D.x,D.y);x.beginPath();x.moveTo(C,0);for(var z=0;z<9;z++){x.rotate(A);if(z%2==0){x.lineTo((C/0.525731)*0.200811,0)}else{x.lineTo(C,0)}}x.closePath();x[B]();x.restore()},contains:function(z,y,x){return a.circle.contains(z,y,x)}}};var n={line:{render:function(A,z,y){var x=y.getCtx();x.beginPath();x.moveTo(A.x,A.y);x.lineTo(z.x,z.y);x.stroke()},contains:function(H,z,C,F){var A=Math.min,D=Math.max,y=A(H.x,z.x)-F,G=D(H.x,z.x)+F,x=A(H.y,z.y)-F,E=D(H.y,z.y)+F;if(C.x>=y&&C.x<=G&&C.y>=x&&C.y<=E){if(Math.abs(z.x-H.x)<=F){return true}var B=(z.y-H.y)/(z.x-H.x)*(C.x-H.x)+H.y;return Math.abs(B-C.y)<=F}return false}},arrow:{render:function(J,K,B,y,x,z){var L=x.getCtx();if(y){var A=J;J=K;K=A}var E=new q(K.x-J.x,K.y-J.y);E.$scale(B/E.norm());var H;switch(z){case"end":H=E;break;case"center":H=new q((K.x-J.x)/2,(K.y-J.y)/2);break}var C=new q(K.x-H.x,K.y-H.y),D=new q(-E.y/2,E.x/2),F=C.add(E),I=C.add(D),G=C.$add(D.$scale(-1));L.beginPath();L.moveTo(J.x,J.y);L.lineTo(K.x,K.y);L.stroke();L.beginPath();L.moveTo(I.x,I.y);L.moveTo(I.x,I.y);L.lineTo(G.x,G.y);L.lineTo(F.x,F.y);L.closePath();L.fill()},contains:function(y,x,A,z){return n.line.contains(y,x,A,z)}},hyperline:{render:function(E,F,x,z){var G=z.getCtx();var A=B(E,F);if(A.a>1000||A.b>1000||A.ratio<0){G.beginPath();G.moveTo(E.x*x,E.y*x);G.lineTo(F.x*x,F.y*x);G.stroke()}else{var D=Math.atan2(F.y-A.y,F.x-A.x);var C=Math.atan2(E.y-A.y,E.x-A.x);var y=y(D,C);G.beginPath();G.arc(A.x*x,A.y*x,A.ratio*x,D,C,y);G.stroke()}function B(T,S){var L=(T.x*S.y-T.y*S.x),H=L;var K=T.squaredNorm(),J=S.squaredNorm();if(L==0){return{x:0,y:0,ratio:-1}}var R=(T.y*J-S.y*K+T.y-S.y)/L;var P=(S.x*K-T.x*J+S.x-T.x)/H;var Q=-R/2;var O=-P/2;var N=(R*R+P*P)/4-1;if(N<0){return{x:0,y:0,ratio:-1}}var M=Math.sqrt(N);var I={x:Q,y:O,ratio:M>1000?-1:M,a:R,b:P};return I}function y(H,I){return(H<I)?((H+Math.PI>I)?false:true):((I+Math.PI>H)?true:false)}},contains:d.lambda(false)}};f.Plot={initialize:function(y,x){this.viz=y;this.config=y.config;this.node=y.config.Node;this.edge=y.config.Edge;this.animation=new v;this.nodeTypes=new x.Plot.NodeTypes;this.edgeTypes=new x.Plot.EdgeTypes;this.labels=y.labels},nodeHelper:a,edgeHelper:n,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number",vertices:"polygon"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(z,y,x){return z+(y-z)*x},moebius:function(E,D,G,A){var C=A.scale(-G);if(C.norm()<1){var z=C.x,F=C.y;var B=E.startPos.getc().moebiusTransformation(C);E.pos.setc(B.x,B.y);C.x=z;C.y=F}},linear:function(y,x,B){var A=y.startPos.getc(true);var z=y.endPos.getc(true);y.pos.setc(this.compute(A.x,z.x,B),this.compute(A.y,z.y,B))},polar:function(z,y,C){var B=z.startPos.getp(true);var A=z.endPos.getp();var x=A.interpolate(B,C);z.pos.setp(x.theta,x.rho)},number:function(y,D,C,x,B){var A=y[x](D,"start");var z=y[x](D,"end");y[B](D,this.compute(A,z,C))},color:function(z,x,F,C,A){var D=d.hexToRgb(z[C](x,"start"));var E=d.hexToRgb(z[C](x,"end"));var B=this.compute;var y=d.rgbToHex([parseInt(B(D[0],E[0],F)),parseInt(B(D[1],E[1],F)),parseInt(B(D[2],E[2],F))]);z[A](x,y)},"array-number":function(A,z,K,H,C){var I=A[H](z,"start"),J=A[H](z,"end"),L=[];for(var F=0,B=I.length;F<B;F++){var y=I[F],x=J[F];if(y.length){for(var E=0,G=y.length,D=[];E<G;E++){D.push(this.compute(y[E],x[E],K))}L.push(D)}else{L.push(this.compute(y,x,K))}}A[C](z,L)},node:function(y,D,F,x,E,z){x=this[x];if(D){var C=D.length;for(var A=0;A<C;A++){var B=D[A];this[x[B]](y,B,F,E,z)}}else{for(var B in x){this[x[B]](y,B,F,E,z)}}},edge:function(z,y,E,A,x,D){var C=z.adjacencies;for(var B in C){this["node"](C[B],y,E,A,x,D)}},"node-property":function(y,x,z){this["node"](y,x,z,"map","getData","setData")},"edge-property":function(y,x,z){this["edge"](y,x,z,"map","getData","setData")},"label-property":function(y,x,z){this["node"](y,x,z,"label","getLabelData","setLabelData")},"node-style":function(y,x,z){this["node"](y,x,z,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(y,x,z){this["edge"](y,x,z,"canvas","getCanvasStyle","setCanvasStyle")},polygon:function(A,z,K,G,C){var I=A[G](z,"start"),J=A[G](z,"end"),L=[];if(typeof I.offset=="undefined"){if(I===0){I=d.map(J,function(){return new $jit.Complex(0,0)});I.offset=0}else{if(I.length==0){I.push(new $jit.Complex(0,0))}while(I.length<J.length){I.push(I[0])}while(I.length>J.length){J.push(J[0]||new $jit.Complex(0,0))}if(I.length==0){return}var B=I.length;var H=1e+300;for(var D=0;D<B;D++){var F=0;for(var E=0;E<B;E++){F+=Geometry.dist2(I[(D+E)%B],J[E])}if(F<H){I.offset=D;H=F}}}}for(var E=0,B=I.length;E<B;E++){var y=I[(E+I.offset)%B],x=J[E];L.push(new $jit.Complex(this.compute(y.x,x.x,K),this.compute(y.y,x.y,K)))}A[C](z,L)}},sequence:function(y){var z=this;y=d.merge({condition:d.lambda(false),step:d.empty,onComplete:d.empty,duration:200},y||{});var x=setInterval(function(){if(y.condition()){y.step()}else{clearInterval(x);y.onComplete()}z.viz.refresh(true)},y.duration)},prepare:function(D){var C=this.viz.graph,A={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}};var y={};if(d.type(D)=="array"){for(var B=0,x=D.length;B<x;B++){var z=D[B].split(":");y[z.shift()]=z}}else{for(var E in D){if(E=="position"){y[D.position]=[]}else{y[E]=d.splat(D[E])}}}C.eachNode(function(F){F.startPos.set(F.pos);d.each(["node-property","node-style"],function(I){if(I in y){var J=y[I];for(var H=0,G=J.length;H<G;H++){F[A[I].setter](J[H],F[A[I].getter](J[H]),"start")}}});d.each(["edge-property","edge-style"],function(G){if(G in y){var H=y[G];F.eachAdjacency(function(J){for(var K=0,I=H.length;K<I;K++){J[A[G].setter](H[K],J[A[G].getter](H[K]),"start")}})}})});return y},animate:function(A,z){A=d.merge(this.viz.config,A||{});var B=this,y=this.viz,D=y.graph,E=this.Interpolator,C=A.type==="nodefx"?this.nodeFxAnimation:this.animation;var x=this.prepare(A.modes);if(A.hideLabels){this.labels.hideLabels(true)}C.setOptions(d.extend(A,{$animating:false,compute:function(F){D.eachNode(function(G){for(var H in x){E[H](G,x[H],F,z)}});B.plot(A,this.$animating,F);this.$animating=true},complete:function(){if(A.hideLabels){B.labels.hideLabels(false)}B.plot(A);A.onComplete()}})).start()},nodeFx:function(z){if(this.nodeFxAnimation==undefined){this.nodeFxAnimation=new v()}var E=this.viz,F=E.graph,C=this.nodeFxAnimation,G=d.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false});z=d.merge(G,z||{},{onBeforeCompute:d.empty,onAfterCompute:d.empty});C.stopTimer();var D=z.elements.properties;if(!z.elements.id){F.eachNode(function(I){for(var H in D){I.setData(H,D[H],"end")}})}else{var x=d.splat(z.elements.id);d.each(x,function(J){var I=F.getNode(J);if(I){for(var H in D){I.setData(H,D[H],"end")}}})}var B=[];for(var y in D){B.push(y)}var A=["node-property:"+B.join(":")];if(z.reposition){A.push("linear");E.compute("end")}this.animate(d.merge(z,{modes:A,type:"nodefx"}))},plot:function(y,H){var F=this.viz,C=F.graph,z=F.canvas,x=F.root,D=this,G=z.getCtx(),B=Math.min,y=y||this.viz.controller;y.clearCanvas&&z.clear();var E=C.getNode(x);if(!E){return}var A=!!E.visited;C.eachNode(function(J){var I=J.getData("alpha");J.eachAdjacency(function(K){var L=K.nodeTo;if(!!L.visited===A&&J.drawn&&L.drawn){!H&&y.onBeforePlotLine(K);D.plotLine(K,z,H);!H&&y.onAfterPlotLine(K)}});if(J.drawn){!H&&y.onBeforePlotNode(J);D.plotNode(J,z,H);!H&&y.onAfterPlotNode(J)}if(!D.labelsHidden&&y.withLabels){if(J.drawn&&I>=0.95){D.labels.plotLabel(z,J,y)}else{D.labels.hideLabel(J,false)}}J.visited=!A})},plotTree:function(B,y,F){var C=this,D=this.viz,z=D.canvas,A=this.config,E=z.getCtx();var x=B.getData("alpha");B.eachSubnode(function(H){if(y.plotSubtree(B,H)&&H.exist&&H.drawn){var G=B.getAdjacency(H.id);!F&&y.onBeforePlotLine(G);C.plotLine(G,z,F);!F&&y.onAfterPlotLine(G);C.plotTree(H,y,F)}});if(B.drawn){!F&&y.onBeforePlotNode(B);this.plotNode(B,z,F);!F&&y.onAfterPlotNode(B);if(!y.hideLabels&&y.withLabels&&x>=0.95){this.labels.plotLabel(z,B,y)}else{this.labels.hideLabel(B,false)}}else{this.labels.hideLabel(B,true)}},plotNode:function(z,y,G){var D=z.getData("type"),C=this.node.CanvasStyles;if(D!="none"){var x=z.getData("lineWidth"),B=z.getData("color"),A=z.getData("alpha"),E=y.getCtx();E.save();E.lineWidth=x;E.fillStyle=E.strokeStyle=B;E.globalAlpha=A;for(var F in C){E[F]=z.getCanvasStyle(F)}this.nodeTypes[D].render.call(this,z,y,G);E.restore()}},plotLine:function(D,y,H){var C=D.getData("type"),A=this.edge.CanvasStyles;if(C!="none"){var x=D.getData("lineWidth"),z=D.getData("color"),F=y.getCtx(),B=D.nodeFrom,E=D.nodeTo;F.save();F.lineWidth=x;F.fillStyle=F.strokeStyle=z;F.globalAlpha=Math.min(B.getData("alpha"),E.getData("alpha"),D.getData("alpha"));for(var G in A){F[G]=D.getCanvasStyle(G)}this.edgeTypes[C].render.call(this,D,y,H);F.restore()}}};f.Plot3D=d.merge(f.Plot,{Interpolator:{linear:function(y,x,B){var A=y.startPos.getc(true);var z=y.endPos.getc(true);y.pos.setc(this.compute(A.x,z.x,B),this.compute(A.y,z.y,B),this.compute(A.z,z.z,B))}},plotNode:function(y,x){if(y.getData("type")=="none"){return}this.plotElement(y,x,{getAlpha:function(){return y.getData("alpha")}})},plotLine:function(x,y){if(x.getData("type")=="none"){return}this.plotElement(x,y,{getAlpha:function(){return Math.min(x.nodeFrom.getData("alpha"),x.nodeTo.getData("alpha"),x.getData("alpha"))}})},plotElement:function(Z,F,A){var W=F.getCtx(),G=new Matrix4,y=F.config.Scene.Lighting,aa=F.canvases[0],L=aa.program,Y=aa.camera;if(!Z.geometry){Z.geometry=new O3D[Z.getData("type")]}Z.geometry.update(Z);if(!Z.webGLVertexBuffer){var K=[],C=[],Q=[],O=0,T=Z.geometry;for(var X=0,V=T.vertices,I=T.faces,H=I.length;X<H;X++){var N=I[X],E=V[N.a],D=V[N.b],B=V[N.c],z=N.d?V[N.d]:false,S=N.normal;K.push(E.x,E.y,E.z);K.push(D.x,D.y,D.z);K.push(B.x,B.y,B.z);if(z){K.push(z.x,z.y,z.z)}Q.push(S.x,S.y,S.z);Q.push(S.x,S.y,S.z);Q.push(S.x,S.y,S.z);if(z){Q.push(S.x,S.y,S.z)}C.push(O,O+1,O+2);if(z){C.push(O,O+2,O+3);O+=4}else{O+=3}}Z.webGLVertexBuffer=W.createBuffer();W.bindBuffer(W.ARRAY_BUFFER,Z.webGLVertexBuffer);W.bufferData(W.ARRAY_BUFFER,new Float32Array(K),W.STATIC_DRAW);Z.webGLFaceBuffer=W.createBuffer();W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,Z.webGLFaceBuffer);W.bufferData(W.ELEMENT_ARRAY_BUFFER,new Uint16Array(C),W.STATIC_DRAW);Z.webGLFaceCount=C.length;Z.webGLNormalBuffer=W.createBuffer();W.bindBuffer(W.ARRAY_BUFFER,Z.webGLNormalBuffer);W.bufferData(W.ARRAY_BUFFER,new Float32Array(Q),W.STATIC_DRAW)}G.multiply(Y.matrix,Z.geometry.matrix);W.uniformMatrix4fv(L.viewMatrix,false,G.flatten());W.uniformMatrix4fv(L.projectionMatrix,false,Y.projectionMatrix.flatten());var M=Matrix4.makeInvert(G);M.$transpose();W.uniformMatrix4fv(L.normalMatrix,false,M.flatten());var U=d.hexToRgb(Z.getData("color"));U.push(A.getAlpha());W.uniform4f(L.color,U[0]/255,U[1]/255,U[2]/255,U[3]);W.uniform1i(L.enableLighting,y.enable);if(y.enable){if(y.ambient){var P=y.ambient;W.uniform3f(L.ambientColor,P[0],P[1],P[2])}if(y.directional){var R=y.directional,U=R.color,J=R.direction,x=new Vector3(J.x,J.y,J.z).normalize().$scale(-1);W.uniform3f(L.lightingDirection,x.x,x.y,x.z);W.uniform3f(L.directionalColor,U[0],U[1],U[2])}}W.bindBuffer(W.ARRAY_BUFFER,Z.webGLVertexBuffer);W.vertexAttribPointer(L.position,3,W.FLOAT,false,0,0);W.bindBuffer(W.ARRAY_BUFFER,Z.webGLNormalBuffer);W.vertexAttribPointer(L.normal,3,W.FLOAT,false,0,0);W.bindBuffer(W.ELEMENT_ARRAY_BUFFER,Z.webGLFaceBuffer);W.drawElements(W.TRIANGLES,Z.webGLFaceCount,W.UNSIGNED_SHORT,0)}});f.Label={};f.Label.Native=new r({initialize:function(x){this.viz=x},plotLabel:function(z,A,y){var x=z.getCtx();var B=A.pos.getc(true);x.font=A.getLabelData("style")+" "+A.getLabelData("size")+"px "+A.getLabelData("family");x.textAlign=A.getLabelData("textAlign");x.fillStyle=x.strokeStyle=A.getLabelData("color");x.textBaseline=A.getLabelData("textBaseline");this.renderLabel(z,A,y)},renderLabel:function(z,A,y){var x=z.getCtx();var B=A.pos.getc(true);x.fillText(A.name,B.x,B.y+A.getData("height")/2)},hideLabel:function(y,x){y=d.splat(y);var z=x?false:true;d.each(y,function(A){A._hideLabel=z})},hideLabels:d.empty});f.Label.DOM=new r({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(x){return(x in this.labels&&this.labels[x]!=null)?this.labels[x]:this.labels[x]=document.getElementById(x)},hideLabels:function(y){var x=this.getLabelContainer();if(y){x.style.display="none"}else{x.style.display=""}this.labelsHidden=y},clearLabels:function(x){for(var y in this.labels){if(x||!this.viz.graph.hasNode(y)){this.disposeLabel(y);delete this.labels[y]}}},disposeLabel:function(y){var x=this.getLabel(y);if(x&&x.parentNode){x.parentNode.removeChild(x)}},hideLabel:function(B,x){B=d.splat(B);var y=x?"":"none",z,A=this;d.each(B,function(C){z=A.getLabel(C.id);if(z){z.style.display=y}})},fitsInCanvas:function(z,x){var y=x.getSize();if(z.w&&z.h){if(z.x>=y.width||z.x<-z.w||z.y>=y.height||z.y<-z.h){return false}}else{if(z.x>=y.width||z.x<0||z.y>=y.height||z.y<0){return false}}return true}});f.Label.HTML=new r({Implements:f.Label.DOM,plotLabel:function(A,B,z){var C=B.id,x=this.getLabel(C);if(!x&&!(x=document.getElementById(C))){x=document.createElement("div");var y=this.getLabelContainer();x.id=C;x.className="node";x.style.position="absolute";z.onCreateLabel(x,B);y.appendChild(x);this.labels[B.id]=x}this.placeLabel(x,B,z)}});f.Label.SVG=new r({Implements:f.Label.DOM,plotLabel:function(A,C,z){var E=C.id,x=this.getLabel(E);if(!x&&!(x=document.getElementById(E))){var B="http://www.w3.org/2000/svg";x=document.createElementNS(B,"svg:text");var D=document.createElementNS(B,"svg:tspan");x.appendChild(D);var y=this.getLabelContainer();x.setAttribute("id",E);x.setAttribute("class","node");y.appendChild(x);z.onCreateLabel(x,C);this.labels[C.id]=x}this.placeLabel(x,C,z)}});f.Geom=new r({initialize:function(x){this.viz=x;this.config=x.config;this.node=x.config.Node;this.edge=x.config.Edge},translate:function(y,x){x=d.splat(x);this.viz.graph.eachNode(function(z){d.each(x,function(A){z.getPos(A).$add(y)})})},setRightLevelToShow:function(A,x,C){var B=this.getRightLevelToShow(A,x),z=this.viz.labels,y=d.merge({execShow:true,execHide:true,onHide:d.empty,onShow:d.empty},C||{});A.eachLevel(0,this.config.levelsToShow,function(E){var D=E._depth-A._depth;if(D>B){y.onHide(E);if(y.execHide){E.drawn=false;E.exist=false;z.hideLabel(E,false)}}else{y.onShow(E);if(y.execShow){E.exist=true}}});A.drawn=true},getRightLevelToShow:function(A,y){var x=this.config;var B=x.levelsToShow;var z=x.constrained;if(!z){return B}while(!this.treeFitsInCanvas(A,y,B)&&B>1){B--}return B}});var e={construct:function(y){var z=(d.type(y)=="array");var x=new f(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);if(!z){(function(A,C){A.addNode(C);if(C.children){for(var B=0,D=C.children;B<D.length;B++){A.addAdjacence(C,D[B]);arguments.callee(A,D[B])}}})(x,y)}else{(function(I,J){var B=function(N){for(var M=0,K=J.length;M<K;M++){if(J[M].id==N){return J[M]}}var L={id:N,name:N};return I.addNode(L)};for(var F=0,C=J.length;F<C;F++){I.addNode(J[F]);var G=J[F].adjacencies;if(G){for(var D=0,H=G.length;D<H;D++){var A=G[D],E={};if(typeof G[D]!="string"){E=d.merge(A.data,{});A=A.nodeTo}I.addAdjacence(J[F],B(A),E)}}}})(x,y)}return x},loadJSON:function(y,x){this.json=y;if(this.labels&&this.labels.clearLabels){this.labels.clearLabels(true)}this.graph=this.construct(y);if(d.type(y)!="array"){this.root=y.id}else{this.root=y[x?x:0].id}},toJSON:function(B){B=B||"tree";if(B=="tree"){var z={};var y=this.graph.getNode(this.root);var z=(function x(E){var C={};C.id=E.id;C.name=E.name;C.data=E.data;var D=[];E.eachSubnode(function(F){D.push(x(F))});C.children=D;return C})(y);return z}else{var z=[];var A=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(D){var C={};C.id=D.id;C.name=D.name;C.data=D.data;var E=[];D.eachAdjacency(function(F){var H=F.nodeTo;if(!!H.visited===A){var G={};G.nodeTo=H.id;G.data=F.data;E.push(G)}});C.adjacencies=E;z.push(C);D.visited=!A});return z}}};var h=$jit.Layouts={};var g={label:null,compute:function(A,B,y){this.initializeLabel(y);var x=this.label,z=x.style;A.eachNode(function(E){var I=E.getData("autoWidth"),J=E.getData("autoHeight");if(I||J){delete E.data.$width;delete E.data.$height;delete E.data.$dim;var C=E.getData("width"),K=E.getData("height");z.width=I?"auto":C+"px";z.height=J?"auto":K+"px";x.innerHTML=E.name;var G=x.offsetWidth,D=x.offsetHeight;var H=E.getData("type");if(d.indexOf(["circle","square","triangle","star"],H)===-1){E.setData("width",G);E.setData("height",D)}else{var F=G>D?G:D;E.setData("width",F);E.setData("height",F);E.setData("dim",F)}}})},initializeLabel:function(x){if(!this.label){this.label=document.createElement("div");document.body.appendChild(this.label)}this.setLabelStyles(x)},setLabelStyles:function(x){d.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};h.Tree=(function(){var G=Array.prototype.slice;function E(Q,L,I,O,J){var N=L.Node;var K=L.multitree;if(N.overridable){var P=-1,M=-1;Q.eachNode(function(T){if(T._depth==I&&(!K||("$orn" in T.data)&&T.data.$orn==O)){var R=T.getData("width",J);var S=T.getData("height",J);P=(P<R)?R:P;M=(M<S)?S:M}});return{width:P<0?N.width:P,height:M<0?N.height:M}}else{return N}}function H(J,M,L,I){var K=(I=="left"||I=="right")?"y":"x";J.getPos(M)[K]+=L}function C(J,K){var I=[];d.each(J,function(L){L=G.call(L);L[0]+=K;L[1]+=K;I.push(L)});return I}function F(L,I){if(L.length==0){return I}if(I.length==0){return L}var K=L.shift(),J=I.shift();return[[K[0],J[1]]].concat(F(L,I))}function A(I,J){J=J||[];if(I.length==0){return J}var K=I.pop();return A(I,F(K,J))}function D(L,J,M,I,K){if(L.length<=K||J.length<=K){return 0}var O=L[K][1],N=J[K][0];return Math.max(D(L,J,M,I,++K)+M,O-N+I)}function B(L,J,I){function K(O,Q,N){if(Q.length<=N){return[]}var P=Q[N],M=D(O,P,J,I,0);return[M].concat(K(F(O,C(P,M)),Q,++N))}return K([],L,0)}function y(M,L,K){function I(P,R,O){if(R.length<=O){return[]}var Q=R[O],N=-D(Q,P,L,K,0);return[N].concat(I(F(C(Q,N),P),R,++O))}M=G.call(M);var J=I([],M.reverse(),0);return J.reverse()}function x(O,M,J,P){var K=B(O,M,J),N=y(O,M,J);if(P=="left"){N=K}else{if(P=="right"){K=N}}for(var L=0,I=[];L<K.length;L++){I[L]=(K[L]+N[L])/2}return I}function z(I,S,J,Z,X){var L=Z.multitree;var R=["x","y"],O=["width","height"];var K=+(X=="left"||X=="right");var P=R[K],Y=R[1-K];var U=Z.Node;var N=O[K],W=O[1-K];var M=Z.siblingOffset;var V=Z.subtreeOffset;var T=Z.align;function Q(ac,ag,ak){var ab=ac.getData(N,J);var aj=ag||(ac.getData(W,J));var an=[],al=[],ah=false;var aa=aj+Z.levelDistance;ac.eachSubnode(function(ap){if(ap.exist&&(!L||("$orn" in ap.data)&&ap.data.$orn==X)){if(Z.levelSpacing=="even"){if(!ah){ah=E(I,Z,ap._depth,X,J)}}else{ah={width:ap.getData("width"),height:ap.getData("height")}}var ao=Q(ap,ah[W],ak+aa);an.push(ao.tree);al.push(ao.extent)}});var af=x(al,V,M,T);for(var ae=0,ad=[],ai=[];ae<an.length;ae++){H(an[ae],J,af[ae],X);ai.push(C(al[ae],af[ae]))}var am=[[-ab/2,ab/2]].concat(A(ai));ac.getPos(J)[P]=0;if(X=="top"||X=="left"){ac.getPos(J)[Y]=ak}else{ac.getPos(J)[Y]=-ak}return{tree:ac,extent:am}}Q(S,false,0)}return new r({compute:function(K,J){var L=K||"start";var I=this.graph.getNode(this.root);d.extend(I,{drawn:true,exist:true,selected:true});g.compute(this.graph,L,this.config);if(!!J||!("_depth" in I)){this.graph.computeLevels(this.root,0,"ignore")}this.computePositions(I,L)},computePositions:function(M,I){var K=this.config;var J=K.multitree;var P=K.align;var L=P!=="center"&&K.indent;var Q=K.orientation;var O=J?["top","right","bottom","left"]:[Q];var N=this;d.each(O,function(R){z(N.graph,M,I,N.config,R,I);var S=["x","y"][+(R=="left"||R=="right")];(function T(U){U.eachSubnode(function(V){if(V.exist&&(!J||("$orn" in V.data)&&V.data.$orn==R)){V.getPos(I)[S]+=U.getPos(I)[S];if(L){V.getPos(I)[S]+=P=="left"?L:-L}T(V)}})})(M)})}})})();$jit.ST=(function(){var y=[];function z(E){E=E||this.clickedNode;if(!this.config.constrained){return[]}var B=this.geom;var I=this.graph;var C=this.canvas;var A=E._depth,F=[];I.eachNode(function(J){if(J.exist&&!J.selected){if(J.isDescendantOf(E.id)){if(J._depth<=A){F.push(J)}}else{F.push(J)}}});var G=B.getRightLevelToShow(E,C);E.eachLevel(G,G,function(J){if(J.exist&&!J.selected){F.push(J)}});for(var H=0;H<y.length;H++){var D=this.graph.getNode(y[H]);if(!D.isDescendantOf(E.id)){F.push(D)}}return F}function x(C){var B=[],A=this.config;C=C||this.clickedNode;this.clickedNode.eachLevel(0,A.levelsToShow,function(D){if(A.multitree&&!("$orn" in D.data)&&D.anySubnode(function(E){return E.exist&&!E.drawn})){B.push(D)}else{if(D.drawn&&!D.anySubnode("drawn")){B.push(D)}}});return B}return new r({Implements:[e,p,h.Tree],initialize:function(A){var C=$jit.ST;var B={levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0};this.controller=this.config=d.merge(o("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),B,A);var D=this.config;if(D.useCanvas){this.canvas=D.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(D.background){D.background=d.merge({type:"Circles"},D.background)}this.canvas=new m(this,D);this.config.labelContainer=(typeof D.injectInto=="string"?D.injectInto:D.injectInto.id)+"-label"}this.graphOptions={klass:q};this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new C.Label[D.Label.type](this);this.fx=new C.Plot(this,C);this.op=new C.Op(this);this.group=new C.Group(this);this.geom=new C.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(F,E,D){var A=this.geom,B=this.fx,C=this;if(!B.busy){B.busy=true;this.contract({onComplete:function(){A.switchOrientation(F);C.compute("end",false);B.busy=false;if(E=="animate"){C.onClick(C.clickedNode.id,D)}else{if(E=="replot"){C.select(C.clickedNode.id,D)}}}},F)}},switchAlignment:function(C,B,A){this.config.align=C;if(B=="animate"){this.select(this.clickedNode.id,A)}else{if(B=="replot"){this.onClick(this.clickedNode.id,A)}}},addNodeInPath:function(A){y.push(A);this.select((this.clickedNode&&this.clickedNode.id)||this.root)},clearNodesInPath:function(A){y.length=0;this.select((this.clickedNode&&this.clickedNode.id)||this.root)},refresh:function(){this.reposition();this.select((this.clickedNode&&this.clickedNode.id)||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(B){if(B.exist){B.drawn=true}});this.compute("end");if(this.clickedNode){var A={x:this.canvas.translateOffsetX+this.config.offsetX||0,y:this.canvas.translateOffsetY+this.config.offsetY||0};this.geom.translate(this.clickedNode.endPos.add(A).$scale(-1),"end")}},requestNodes:function(C,D){var B=d.merge(this.controller,D),A=this.config.levelsToShow;if(B.request){var F=[],E=C._depth;C.eachLevel(0,A,function(G){if(G.drawn&&!G.anySubnode()){F.push(G);G._level=A-(G._depth-E)}});this.group.requestNodes(F,B)}else{B.onComplete()}},contract:function(E,F){var D=this.config.orientation;var A=this.geom,C=this.group;if(F){A.switchOrientation(F)}var B=z.call(this);if(F){A.switchOrientation(D)}C.contract(B,d.merge(this.controller,E))},move:function(B,C){this.compute("end",false);var A=C.Move,D={x:A.offsetX,y:A.offsetY};if(A.enable){this.geom.translate(B.endPos.add(D).$scale(-1),"end")}else{this.geom.translate(s(D.x,D.y).$scale(-1),"end")}this.fx.animate(d.merge(this.controller,{modes:["linear"]},C))},expand:function(B,C){var A=x.call(this,B);this.group.expand(A,d.merge(this.controller,C))},selectPath:function(D){var C=this;this.graph.eachNode(function(F){F.selected=false});function E(G){if(G==null||G.selected){return}G.selected=true;d.each(C.group.getSiblings([G])[G.id],function(H){H.exist=true;H.drawn=true});var F=G.getParents();F=(F.length>0)?F[0]:null;E(F)}for(var A=0,B=[D.id].concat(y);A<B.length;A++){E(this.graph.getNode(B[A]))}},setRoot:function(H,G,F){if(this.busy){return}this.busy=true;var E=this,C=this.canvas;var A=this.graph.getNode(this.root);var B=this.graph.getNode(H);function D(){if(this.config.multitree&&B.data.$orn){var J=B.data.$orn;var K={left:"right",right:"left",top:"bottom",bottom:"top"}[J];A.data.$orn=K;(function I(L){L.eachSubnode(function(M){if(M.id!=H){M.data.$orn=K;I(M)}})})(A);delete B.data.$orn}this.root=H;this.clickedNode=B;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(B,C,{execHide:false,onShow:function(L){if(!L.drawn){L.drawn=true;L.setData("alpha",1,"end");L.setData("alpha",0);L.pos.setc(B.pos.x,B.pos.y)}}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){E.busy=false;E.onClick(H,{onComplete:function(){F&&F.onComplete()}})}})}delete A.data.$orns;if(G=="animate"){D.call(this);E.selectPath(B)}else{if(G=="replot"){D.call(this);this.select(this.root)}}},addSubtree:function(A,C,B){if(C=="replot"){this.op.sum(A,d.extend({type:"replot"},B||{}))}else{if(C=="animate"){this.op.sum(A,d.extend({type:"fade:seq"},B||{}))}}},removeSubtree:function(F,B,E,D){var C=this.graph.getNode(F),A=[];C.eachLevel(+!B,false,function(G){A.push(G.id)});if(E=="replot"){this.op.removeNode(A,d.extend({type:"replot"},D||{}))}else{if(E=="animate"){this.op.removeNode(A,d.extend({type:"fade:seq"},D||{}))}}},select:function(A,D){var I=this.group,G=this.geom;var E=this.graph.getNode(A),C=this.canvas;var H=this.graph.getNode(this.root);var B=d.merge(this.controller,D);var F=this;B.onBeforeCompute(E);this.selectPath(E);this.clickedNode=E;this.requestNodes(E,{onComplete:function(){I.hide(I.prepare(z.call(F)),B);G.setRightLevelToShow(E,C);F.compute("current");F.graph.eachNode(function(L){var K=L.pos.getc(true);L.startPos.setc(K.x,K.y);L.endPos.setc(K.x,K.y);L.visited=false});var J={x:B.offsetX,y:B.offsetY};F.geom.translate(E.endPos.add(J).$scale(-1),["start","current","end"]);I.show(x.call(F));F.plot();B.onAfterCompute(F.clickedNode);B.onComplete()}})},onClick:function(B,I){var D=this.canvas,H=this,A=this.geom,E=this.config;var G={Move:{enable:true,offsetX:D.translateOffsetX+E.offsetX||0,offsetY:D.translateOffsetY+E.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:d.empty,onBeforeContract:d.empty,onBeforeMove:d.empty,onBeforeExpand:d.empty};var C=d.merge(this.controller,G,I);if(!this.busy){this.busy=true;var F=this.graph.getNode(B);this.selectPath(F,this.clickedNode);this.clickedNode=F;C.onBeforeCompute(F);C.onBeforeRequest(F);this.requestNodes(F,{onComplete:function(){C.onBeforeContract(F);H.contract({onComplete:function(){A.setRightLevelToShow(F,D,C.setRightLevelToShowConfig);C.onBeforeMove(F);H.move(F,{Move:C.Move,onComplete:function(){C.onBeforeExpand(F);H.expand(F,{onComplete:function(){H.busy=false;C.onAfterCompute(B);C.onComplete()}})}})}})}})}}})})();$jit.ST.$extend=true;$jit.ST.Op=new r({Implements:f.Op});$jit.ST.Group=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.config=x.config;this.animation=new v;this.nodes=null},requestNodes:function(C,B){var A=0,y=C.length,E={};var z=function(){B.onComplete()};var x=this.viz;if(y==0){z()}for(var D=0;D<y;D++){E[C[D].id]=C[D];B.request(C[D].id,C[D]._level,{onComplete:function(G,F){if(F&&F.children){F.id=G;x.op.sum(F,{type:"nothing"})}if(++A==y){x.graph.computeLevels(x.root,0);z()}}})}},contract:function(z,y){var x=this.viz;var A=this;z=this.prepare(z);this.animation.setOptions(d.merge(y,{$animating:false,compute:function(B){if(B==1){B=0.99}A.plotStep(1-B,y,this.$animating);this.$animating="contract"},complete:function(){A.hide(z,y)}})).start()},hide:function(z,y){var x=this.viz;for(var A=0;A<z.length;A++){if(true||!y||!y.request){z[A].eachLevel(1,false,function(C){if(C.exist){d.extend(C,{drawn:false,exist:false})}})}else{var B=[];z[A].eachLevel(1,false,function(C){B.push(C.id)});x.op.removeNode(B,{type:"nothing"});x.labels.clearLabels()}}y.onComplete()},expand:function(y,x){var z=this;this.show(y);this.animation.setOptions(d.merge(x,{$animating:false,compute:function(A){z.plotStep(A,x,this.$animating);this.$animating="expand"},complete:function(){z.plotStep(undefined,x,false);x.onComplete()}})).start()},show:function(x){var y=this.config;this.prepare(x);d.each(x,function(A){if(y.multitree&&!("$orn" in A.data)){delete A.data.$orns;var z=" ";A.eachSubnode(function(B){if(("$orn" in B.data)&&z.indexOf(B.data.$orn)<0&&B.exist&&!B.drawn){z+=B.data.$orn+" "}});A.data.$orns=z}A.eachLevel(0,y.levelsToShow,function(B){if(B.exist){B.drawn=true}})})},prepare:function(x){this.nodes=this.getNodesWithChildren(x);return this.nodes},getNodesWithChildren:function(z){var y=[],B=this.config,x=this.viz.root;z.sort(function(F,E){return(F._depth<=E._depth)-(F._depth>=E._depth)});for(var C=0;C<z.length;C++){if(z[C].anySubnode("exist")){for(var A=C+1,D=false;!D&&A<z.length;A++){if(!B.multitree||"$orn" in z[A].data){D=D||z[C].isDescendantOf(z[A].id)}}if(!D){y.push(z[C])}}}return y},plotStep:function(H,D,J){var G=this.viz,A=this.config,z=G.canvas,I=z.getCtx(),x=this.nodes;var C,B;var y={};for(C=0;C<x.length;C++){B=x[C];y[B.id]=[];var F=A.multitree&&!("$orn" in B.data);var E=F&&B.data.$orns;B.eachSubgraph(function(K){if(F&&E&&E.indexOf(K.data.$orn)>0&&K.drawn){K.drawn=false;y[B.id].push(K)}else{if((!F||!E)&&K.drawn){K.drawn=false;y[B.id].push(K)}}});B.drawn=true}if(x.length>0){G.fx.plot()}for(C in y){d.each(y[C],function(K){K.drawn=true})}for(C=0;C<x.length;C++){B=x[C];I.save();G.fx.plotSubtree(B,D,H,J);I.restore()}},getSiblings:function(x){var y={};d.each(x,function(B){var A=B.getParents();if(A.length==0){y[B.id]=[B]}else{var z=[];A[0].eachSubnode(function(C){z.push(C)});y[B.id]=z}});return y}});$jit.ST.Geom=new r({Implements:f.Geom,switchOrientation:function(x){this.config.orientation=x},dispatch:function(){var y=Array.prototype.slice.call(arguments);var z=y.shift(),x=y.length;var A=function(B){return typeof B=="function"?B():B};if(x==2){return(z=="top"||z=="bottom")?A(y[0]):A(y[1])}else{if(x==4){switch(z){case"top":return A(y[0]);case"right":return A(y[1]);case"bottom":return A(y[2]);case"left":return A(y[3])}}}return undefined},getSize:function(E,D){var C=E.data,z=this.config;var y=z.siblingOffset;var B=(z.multitree&&("$orn" in C)&&C.$orn)||z.orientation;var x=E.getData("width")+y;var A=E.getData("height")+y;if(!D){return this.dispatch(B,A,x)}else{return this.dispatch(B,x,A)}},getTreeBaseSize:function(B,C,y){var z=this.getSize(B,true),x=0,A=this;if(y(C,B)){return z}if(C===0){return 0}B.eachSubnode(function(D){x+=A.getTreeBaseSize(D,C-1,y)});return(z>x?z:x)+this.config.subtreeOffset},getEdge:function(C,B,A){var y=function(F,E){return function(){return C.pos.add(new q(F,E))}};var D=this.node;var x=C.getData("width");var z=C.getData("height");if(B=="begin"){if(D.align=="center"){return this.dispatch(A,y(0,z/2),y(-x/2,0),y(0,-z/2),y(x/2,0))}else{if(D.align=="left"){return this.dispatch(A,y(0,z),y(0,0),y(0,0),y(x,0))}else{if(D.align=="right"){return this.dispatch(A,y(0,0),y(-x,0),y(0,-z),y(0,0))}else{throw"align: not implemented"}}}}else{if(B=="end"){if(D.align=="center"){return this.dispatch(A,y(0,-z/2),y(x/2,0),y(0,z/2),y(-x/2,0))}else{if(D.align=="left"){return this.dispatch(A,y(0,0),y(x,0),y(0,z),y(0,0))}else{if(D.align=="right"){return this.dispatch(A,y(0,-z),y(0,0),y(0,0),y(-x,0))}else{throw"align: not implemented"}}}}}},getScaledTreePosition:function(B,D){var C=this.node;var x=B.getData("width");var A=B.getData("height");var z=(this.config.multitree&&("$orn" in B.data)&&B.data.$orn)||this.config.orientation;var y=function(F,E){return function(){return B.pos.add(new q(F,E)).$scale(1-D)}};if(C.align=="left"){return this.dispatch(z,y(0,A),y(0,0),y(0,0),y(x,0))}else{if(C.align=="center"){return this.dispatch(z,y(0,A/2),y(-x/2,0),y(0,-A/2),y(x/2,0))}else{if(C.align=="right"){return this.dispatch(z,y(0,0),y(-x,0),y(0,-A),y(0,0))}else{throw"align: not implemented"}}}},treeFitsInCanvas:function(C,x,D){var z=x.getSize();var A=(this.config.multitree&&("$orn" in C.data)&&C.data.$orn)||this.config.orientation;var y=this.dispatch(A,z.width,z.height);var B=this.getTreeBaseSize(C,D,function(F,E){return F===0||!E.anySubnode()});return(B<y)}});$jit.ST.Plot=new r({Implements:f.Plot,plotSubtree:function(A,x,B,F){var D=this.viz,y=D.canvas,z=D.config;B=Math.min(Math.max(0.001,B),1);if(B>=0){A.drawn=false;var E=y.getCtx();var C=D.geom.getScaledTreePosition(A,B);E.translate(C.x,C.y);E.scale(B,B)}this.plotTree(A,d.merge(x,{withLabels:true,hideLabels:!!B,plotSubtree:function(J,H){var G=z.multitree&&!("$orn" in A.data);var I=G&&A.getData("orns");return !G||I.indexOf(A.getData("orn"))>-1}}),F);if(B>=0){A.drawn=true}},getAlignedPos:function(C,A,x){var z=this.node;var B,y;if(z.align=="center"){B={x:C.x-A/2,y:C.y-x/2}}else{if(z.align=="left"){y=this.config.orientation;if(y=="bottom"||y=="top"){B={x:C.x-A/2,y:C.y}}else{B={x:C.x,y:C.y-x/2}}}else{if(z.align=="right"){y=this.config.orientation;if(y=="bottom"||y=="top"){B={x:C.x-A/2,y:C.y-x}}else{B={x:C.x-A,y:C.y-x/2}}}else{throw"align: not implemented"}}}return B},getOrientation:function(x){var z=this.config;var y=z.orientation;if(z.multitree){var A=x.nodeFrom;var B=x.nodeTo;y=(("$orn" in A.data)&&A.data.$orn)||(("$orn" in B.data)&&B.data.$orn)}return y}});$jit.ST.Label={};$jit.ST.Label.Native=new r({Implements:f.Label.Native,renderLabel:function(A,C,z){var y=A.getCtx(),E=C.pos.getc(true),B=C.getData("width"),x=C.getData("height"),D=this.viz.fx.getAlignedPos(E,B,x);y.fillText(C.name,D.x+B/2,D.y+x/2)}});$jit.ST.Label.DOM=new r({Implements:f.Label.DOM,placeLabel:function(P,J,F){var B=J.pos.getc(true),O=this.viz.config,K=O.Node,x=this.viz.canvas,C=J.getData("width"),M=J.getData("height"),y=x.getSize(),G,N;var A=x.translateOffsetX,z=x.translateOffsetY,E=x.scaleOffsetX,D=x.scaleOffsetY,I=B.x*E+A,H=B.y*D+z;if(K.align=="center"){G={x:Math.round(I-C/2+y.width/2),y:Math.round(H-M/2+y.height/2)}}else{if(K.align=="left"){N=O.orientation;if(N=="bottom"||N=="top"){G={x:Math.round(I-C/2+y.width/2),y:Math.round(H+y.height/2)}}else{G={x:Math.round(I+y.width/2),y:Math.round(H-M/2+y.height/2)}}}else{if(K.align=="right"){N=O.orientation;if(N=="bottom"||N=="top"){G={x:Math.round(I-C/2+y.width/2),y:Math.round(H-M+y.height/2)}}else{G={x:Math.round(I-C+y.width/2),y:Math.round(H-M/2+y.height/2)}}}else{throw"align: not implemented"}}}G.w=C;G.h=M;var L=P.style;L.left=G.x+"px";L.top=G.y+"px";L.display=this.fitsInCanvas(G,x)?"":"none";F.onPlaceLabel(P,J)}});$jit.ST.Label.SVG=new r({Implements:[$jit.ST.Label.DOM,f.Label.SVG],initialize:function(x){this.viz=x}});$jit.ST.Label.HTML=new r({Implements:[$jit.ST.Label.DOM,f.Label.HTML],initialize:function(x){this.viz=x}});$jit.ST.Plot.NodeTypes=new r({none:{render:d.empty,contains:d.lambda(false)},circle:{render:function(y,x){var A=y.getData("dim"),B=this.getAlignedPos(y.pos.getc(true),A,A),z=A/2;this.nodeHelper.circle.render("fill",{x:B.x+z,y:B.y+z},z,x)},contains:function(x,B){var z=x.getData("dim"),A=this.getAlignedPos(x.pos.getc(true),z,z),y=z/2;return this.nodeHelper.circle.contains({x:A.x+y,y:A.y+y},B,y)}},square:{render:function(y,x){var A=y.getData("dim"),z=A/2,B=this.getAlignedPos(y.pos.getc(true),A,A);this.nodeHelper.square.render("fill",{x:B.x+z,y:B.y+z},z,x)},contains:function(x,B){var z=x.getData("dim"),A=this.getAlignedPos(x.pos.getc(true),z,z),y=z/2;return this.nodeHelper.square.contains({x:A.x+y,y:A.y+y},B,y)}},ellipse:{render:function(A,y){var z=A.getData("width"),x=A.getData("height"),B=this.getAlignedPos(A.pos.getc(true),z,x);this.nodeHelper.ellipse.render("fill",{x:B.x+z/2,y:B.y+x/2},z,x,y)},contains:function(z,B){var y=z.getData("width"),x=z.getData("height"),A=this.getAlignedPos(z.pos.getc(true),y,x);return this.nodeHelper.ellipse.contains({x:A.x+y/2,y:A.y+x/2},B,y,x)}},rectangle:{render:function(A,y){var z=A.getData("width"),x=A.getData("height"),B=this.getAlignedPos(A.pos.getc(true),z,x);this.nodeHelper.rectangle.render("fill",{x:B.x+z/2,y:B.y+x/2},z,x,y)},contains:function(z,B){var y=z.getData("width"),x=z.getData("height"),A=this.getAlignedPos(z.pos.getc(true),y,x);return this.nodeHelper.rectangle.contains({x:A.x+y/2,y:A.y+x/2},B,y,x)}}});$jit.ST.Plot.EdgeTypes=new r({none:d.empty,line:{render:function(y,A){var z=this.getOrientation(y),B=y.nodeFrom,C=y.nodeTo,x=B._depth<C._depth,E=this.viz.geom.getEdge(x?B:C,"begin",z),D=this.viz.geom.getEdge(x?C:B,"end",z);this.edgeHelper.line.render(E,D,A)},contains:function(y,E){var z=this.getOrientation(y),A=y.nodeFrom,B=y.nodeTo,x=A._depth<B._depth,D=this.viz.geom.getEdge(x?A:B,"begin",z),C=this.viz.geom.getEdge(x?B:A,"end",z);return this.edgeHelper.line.contains(D,C,E,this.edge.epsilon)}},arrow:{render:function(D,y){var C=this.getOrientation(D),z=D.nodeFrom,x=D.nodeTo,H=(z._depth<x._depth),B=D.getData("dim"),G=this.viz.geom.getEdge((H?z:x),"begin",C),F=this.viz.geom.getEdge((H?x:z),"end",C),E=D.data.$direction,A=(E&&E.length>1&&E[0]!=z.id);this.edgeHelper.arrow.render(G,F,B,A,y)},contains:function(y,E){var z=this.getOrientation(y),A=y.nodeFrom,B=y.nodeTo,x=A._depth<B._depth,D=this.viz.geom.getEdge(x?A:B,"begin",z),C=this.viz.geom.getEdge(x?B:A,"end",z);return this.edgeHelper.arrow.contains(D,C,E,this.edge.epsilon)}},"quadratic:begin":{render:function(D,x){var C=this.getOrientation(D);var B=D.nodeFrom,E=D.nodeTo,G=B._depth<E._depth,y=this.viz.geom.getEdge(G?B:E,"begin",C),z=this.viz.geom.getEdge(G?E:B,"end",C),A=D.getData("dim"),F=x.getCtx();F.beginPath();F.moveTo(y.x,y.y);switch(C){case"left":F.quadraticCurveTo(y.x+A,y.y,z.x,z.y);break;case"right":F.quadraticCurveTo(y.x-A,y.y,z.x,z.y);break;case"top":F.quadraticCurveTo(y.x,y.y+A,z.x,z.y);break;case"bottom":F.quadraticCurveTo(y.x,y.y-A,z.x,z.y);break}F.stroke()}},"quadratic:end":{render:function(D,x){var C=this.getOrientation(D);var B=D.nodeFrom,E=D.nodeTo,G=B._depth<E._depth,y=this.viz.geom.getEdge(G?B:E,"begin",C),z=this.viz.geom.getEdge(G?E:B,"end",C),A=D.getData("dim"),F=x.getCtx();F.beginPath();F.moveTo(y.x,y.y);switch(C){case"left":F.quadraticCurveTo(z.x-A,z.y,z.x,z.y);break;case"right":F.quadraticCurveTo(z.x+A,z.y,z.x,z.y);break;case"top":F.quadraticCurveTo(z.x,z.y-A,z.x,z.y);break;case"bottom":F.quadraticCurveTo(z.x,z.y+A,z.x,z.y);break}F.stroke()}},bezier:{render:function(D,x){var C=this.getOrientation(D),B=D.nodeFrom,E=D.nodeTo,G=B._depth<E._depth,y=this.viz.geom.getEdge(G?B:E,"begin",C),z=this.viz.geom.getEdge(G?E:B,"end",C),A=D.getData("dim"),F=x.getCtx();F.beginPath();F.moveTo(y.x,y.y);switch(C){case"left":F.bezierCurveTo(y.x+A,y.y,z.x-A,z.y,z.x,z.y);break;case"right":F.bezierCurveTo(y.x-A,y.y,z.x+A,z.y,z.x,z.y);break;case"top":F.bezierCurveTo(y.x,y.y+A,z.x,z.y-A,z.x,z.y);break;case"bottom":F.bezierCurveTo(y.x,y.y-A,z.x,z.y+A,z.x,z.y);break}F.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(X,E){var V=X.pos.getc(true),z=X.getData("width"),B=X.getData("height"),H=this.getAlignedPos(V,z,B),ac=H.x,ab=H.y,M=X.getData("stringArray"),G=X.getData("dimArray"),C=X.getData("valueArray"),ae=d.reduce(C,function(al,am){return al+am[0]},0),ad=d.reduce(C,function(al,am){return al+am[1]},0),J=X.getData("colorArray"),D=J.length,Z=X.getData("config"),K=X.getData("gradient"),ak=Z.showLabels,O=Z.showAggregates,ag=Z.Label,U=X.getData("prev");var N=E.getCtx(),I=X.getData("border");if(J&&G&&M){for(var aj=0,ah=G.length,L=0,F=0,Y=0;aj<ah;aj++){N.fillStyle=N.strokeStyle=J[aj%D];N.save();if(K&&(G[aj][0]>0||G[aj][1]>0)){var S=L+G[aj][0],Q=F+G[aj][1],ai=Math.atan((Q-S)/z),aa=55;var W=N.createLinearGradient(ac+z/2,ab-(S+Q)/2,ac+z/2+aa*Math.sin(ai),ab-(S+Q)/2+aa*Math.cos(ai));var R=d.rgbToHex(d.map(d.hexToRgb(J[aj%D].slice(1)),function(x){return(x*0.85)>>0}));W.addColorStop(0,J[aj%D]);W.addColorStop(1,R);N.fillStyle=W}N.beginPath();N.moveTo(ac,ab-L);N.lineTo(ac+z,ab-F);N.lineTo(ac+z,ab-F-G[aj][1]);N.lineTo(ac,ab-L-G[aj][0]);N.lineTo(ac,ab-L);N.fill();N.restore();if(I){var T=I.name==M[aj];var A=T?0.7:0.8;var R=d.rgbToHex(d.map(d.hexToRgb(J[aj%D].slice(1)),function(x){return(x*A)>>0}));N.strokeStyle=R;N.lineWidth=T?4:1;N.save();N.beginPath();if(I.index===0){N.moveTo(ac,ab-L);N.lineTo(ac,ab-L-G[aj][0])}else{N.moveTo(ac+z,ab-F);N.lineTo(ac+z,ab-F-G[aj][1])}N.stroke();N.restore()}L+=(G[aj][0]||0);F+=(G[aj][1]||0);if(G[aj][0]>0){Y+=(C[aj][0]||0)}}if(U&&ag.type=="Native"){N.save();N.beginPath();N.fillStyle=N.strokeStyle=ag.color;N.font=ag.style+" "+ag.size+"px "+ag.family;N.textAlign="center";N.textBaseline="middle";var P=O(X.name,ae,ad,X,Y);if(P!==false){N.fillText(P!==true?P:Y,ac,ab-L-Z.labelOffset-ag.size/2,z)}var af=ak(X.name,ae,ad,X);if(af!==false){N.fillText(af!==true?af:X.name,ac,ab+ag.size/2+Z.labelOffset)}N.restore()}}},contains:function(D,F){var K=D.pos.getc(true),A=D.getData("width"),O=D.getData("height"),N=this.getAlignedPos(K,A,O),M=N.x,L=N.y,P=D.getData("dimArray"),z=F.x-M;if(F.x<M||F.x>M+A||F.y>L||F.y<L-O){return false}for(var G=0,E=P.length,J=L,B=L;G<E;G++){var C=P[G];J-=C[0];B-=C[1];var H=J+(B-J)*z/A;if(F.y>=H){var I=+(z>A/2);return{name:D.getData("stringArray")[G],color:D.getData("colorArray")[G],value:D.getData("valueArray")[G][I],index:I}}}return false}}});$jit.AreaChart=new r({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(z){this.controller=this.config=d.merge(o("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},z);var A=this.config.showLabels,y=d.type(A),B=this.config.showAggregates,x=d.type(B);this.config.showLabels=y=="function"?A:d.lambda(A);this.config.showAggregates=x=="function"?B:d.lambda(B);this.initializeViz()},initializeViz:function(){var y=this.config,C=this,x=y.type.split(":")[0],B={};var A=new $jit.ST({injectInto:y.injectInto,width:y.width,height:y.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:y.Label.type!="Native",useCanvas:y.useCanvas,Label:{type:y.Label.type},Node:{overridable:true,type:"areachart-"+x,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:y.Tips.enable,type:"Native",force:true,onShow:function(H,G,E){var F=E;y.Tips.onShow(H,F,G)}},Events:{enable:true,type:"Native",onClick:function(G,H,E){if(!y.filterOnClick&&!y.Events.enable){return}var F=H.getContains();if(F){y.filterOnClick&&C.filter(F.name)}y.Events.enable&&y.Events.onClick(F,H,E)},onRightClick:function(F,G,E){if(!y.restoreOnRightClick){return}C.restore()},onMouseMove:function(G,H,E){if(!y.selectOnHover){return}if(G){var F=H.getContains();C.select(G.id,F.name,F.index)}else{C.select(false,false,false)}}},onCreateLabel:function(K,H){var Q=y.Label,P=H.getData("valueArray"),I=d.reduce(P,function(R,S){return R+S[0]},0),N=d.reduce(P,function(R,S){return R+S[1]},0);if(H.getData("prev")){var M={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var E=M.wrapper,O=M.label,F=M.aggregate,G=E.style,L=O.style,J=F.style;B[H.id]=M;E.appendChild(O);E.appendChild(F);if(!y.showLabels(H.name,I,N,H)){O.style.display="none"}if(!y.showAggregates(H.name,I,N,H)){F.style.display="none"}G.position="relative";G.overflow="visible";G.fontSize=Q.size+"px";G.fontFamily=Q.family;G.color=Q.color;G.textAlign="center";J.position=L.position="absolute";K.style.width=H.getData("width")+"px";K.style.height=H.getData("height")+"px";O.innerHTML=H.name;K.appendChild(E)}},onPlaceLabel:function(W,Q){if(!Q.getData("prev")){return}var U=B[Q.id],F=U.wrapper.style,E=U.label.style,P=U.aggregate.style,N=Q.getData("width"),L=Q.getData("height"),K=Q.getData("dimArray"),H=Q.getData("valueArray"),M=d.reduce(H,function(X,Y){return X+Y[0]},0),I=d.reduce(H,function(X,Y){return X+Y[1]},0),J=parseInt(F.fontSize,10),O=W.style;if(K&&H){if(y.showLabels(Q.name,M,I,Q)){E.display=""}else{E.display="none"}var G=y.showAggregates(Q.name,M,I,Q);if(G!==false){P.display=""}else{P.display="none"}F.width=P.width=E.width=W.style.width=N+"px";P.left=E.left=-N/2+"px";for(var T=0,R=H.length,S=0,V=0;T<R;T++){if(K[T][0]>0){S+=H[T][0];V+=K[T][0]}}P.top=(-J-y.labelOffset)+"px";E.top=(y.labelOffset+V)+"px";W.style.top=parseInt(W.style.top,10)-V+"px";W.style.height=F.height=V+"px";U.aggregate.innerHTML=G!==true?G:S}}});var z=A.canvas.getSize(),D=y.Margin;A.config.offsetY=-z.height/2+D.bottom+(y.showLabels&&(y.labelOffset+y.Label.size));A.config.offsetX=(D.right-D.left)/2;this.delegate=A;this.canvas=this.delegate.canvas},loadJSON:function(O){var K=d.time(),C=[],N=this.delegate,R=d.splat(O.label),J=d.splat(O.color||this.colors),P=this.config,y=!!P.type.split(":")[1],A=P.animate;for(var L=0,z=O.values,I=z.length;L<I-1;L++){var Q=z[L],F=z[L-1],G=z[L+1];var M=d.splat(z[L].values),x=d.splat(z[L+1].values);var B=d.zip(M,x);var E=0,D=0;C.push({id:K+Q.label,name:Q.label,data:{value:B,"$valueArray":B,"$colorArray":J,"$stringArray":R,"$next":G.label,"$prev":F?F.label:false,"$config":P,"$gradient":y},children:[]})}var H={id:K+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:C};N.loadJSON(H);this.normalizeDims();N.compute();N.select(N.root);if(A){N.fx.animate({modes:["node-property:height:dimArray"],duration:1500})}},updateJSON:function(H,y){if(this.busy){return}this.busy=true;var E=this.delegate,G=E.graph,B=H.label&&d.splat(H.label),F=H.values,x=this.config.animate,D=this,C={};for(var A=0,z=F.length;A<z;A++){C[F[A].label]=F[A]}G.eachNode(function(M){var I=C[M.name],J=M.getData("stringArray"),L=M.getData("valueArray"),K=M.getData("next");if(I){I.values=d.splat(I.values);d.each(L,function(N,O){N[0]=I.values[O];if(B){J[O]=B[O]}});M.setData("valueArray",L)}if(K){I=C[K];if(I){d.each(L,function(N,O){N[1]=I.values[O]})}}});this.normalizeDims();E.compute();E.select(E.root);if(x){E.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){D.busy=false;y&&y.onComplete()}})}},filter:function(A,B){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.delegate.tips.hide()}this.select(false,false,false);var y=d.splat(A);var x=this.delegate.graph.getNode(this.delegate.root);var z=this;this.normalizeDims();x.eachAdjacency(function(C){var F=C.nodeTo,E=F.getData("dimArray","end"),D=F.getData("stringArray");F.setData("dimArray",d.map(E,function(H,G){return(d.indexOf(y,D[G])>-1)?H:[0,0]}),"end")});this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){z.busy=false;B&&B.onComplete()}})},restore:function(y){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.delegate.tips.hide()}this.select(false,false,false);this.normalizeDims();var x=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){x.busy=false;y&&y.onComplete()}})},select:function(C,y,x){if(!this.config.selectOnHover){return}var z=this.selected;if(z.id!=C||z.name!=y||z.index!=x){z.id=C;z.name=y;z.index=x;this.delegate.graph.eachNode(function(D){D.setData("border",false)});if(C){var B=this.delegate.graph.getNode(C);B.setData("border",z);var A=x===0?"prev":"next";A=B.getData(A);if(A){B=this.delegate.graph.getByName(A);if(B){B.setData("border",{name:y,index:1-x})}}}this.delegate.plot()}},getLegend:function(){var z={};var A;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(B){A=B.nodeTo});var y=A.getData("colorArray"),x=y.length;d.each(A.getData("stringArray"),function(C,B){z[C]=y[B%x]});return z},getMaxValue:function(){var x=0;this.delegate.graph.eachNode(function(C){var z=C.getData("valueArray"),y=0,B=0;d.each(z,function(D){y+=+D[0];B+=+D[1]});var A=B>y?B:y;x=x>A?x:A});return x},normalizeDims:function(){var D=this.delegate.graph.getNode(this.delegate.root),A=0;D.eachAdjacency(function(){A++});var C=this.getMaxValue()||1,G=this.delegate.canvas.getSize(),z=this.config,B=z.Margin,E=z.labelOffset+z.Label.size,x=(G.width-(B.left+B.right))/A,y=z.animate,F=G.height-(B.top+B.bottom)-(z.showAggregates&&E)-(z.showLabels&&E);this.delegate.graph.eachNode(function(M){var J=0,L=0,H=[];d.each(M.getData("valueArray"),function(N){J+=+N[0];L+=+N[1];H.push([0,0])});var K=L>J?L:J;M.setData("width",x);if(y){M.setData("height",K*F/C,"end");M.setData("dimArray",d.map(M.getData("valueArray"),function(N){return[N[0]*F/C,N[1]*F/C]}),"end");var I=M.getData("dimArray");if(!I){M.setData("dimArray",H)}}else{M.setData("height",K*F/C);M.setData("dimArray",d.map(M.getData("valueArray"),function(N){return[N[0]*F/C,N[1]*F/C]}))}})}});o.BarChart={$extend:true,animate:true,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:true,showLabels:true,Tips:{enable:false,onShow:d.empty,onHide:d.empty},Events:{enable:false,onClick:d.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(S,D){var I=S.pos.getc(true),R=S.getData("width"),P=S.getData("height"),N=this.getAlignedPos(I,R,P),M=N.x,L=N.y,O=S.getData("dimArray"),G=S.getData("valueArray"),F=S.getData("colorArray"),C=F.length,Z=S.getData("stringArray");var U=D.getCtx(),z={},V=S.getData("border"),A=S.getData("gradient"),ab=S.getData("config"),B=ab.orientation=="horizontal",E=ab.showAggregates,Q=ab.showLabels,K=ab.Label;if(F&&O&&Z){for(var Y=0,T=O.length,X=0,H=0;Y<T;Y++){U.fillStyle=U.strokeStyle=F[Y%C];if(A){var aa;if(B){aa=U.createLinearGradient(M+X+O[Y]/2,L,M+X+O[Y]/2,L+P)}else{aa=U.createLinearGradient(M,L-X-O[Y]/2,M+R,L-X-O[Y]/2)}var W=d.rgbToHex(d.map(d.hexToRgb(F[Y%C].slice(1)),function(x){return(x*0.5)>>0}));aa.addColorStop(0,W);aa.addColorStop(0.5,F[Y%C]);aa.addColorStop(1,W);U.fillStyle=aa}if(B){U.fillRect(M+X,L,O[Y],P)}else{U.fillRect(M,L-X-O[Y],R,O[Y])}if(V&&V.name==Z[Y]){z.acum=X;z.dimValue=O[Y]}X+=(O[Y]||0);H+=(G[Y]||0)}if(V){U.save();U.lineWidth=2;U.strokeStyle=V.color;if(B){U.strokeRect(M+z.acum+1,L+1,z.dimValue-2,P-2)}else{U.strokeRect(M+1,L-z.acum-z.dimValue+1,R-2,z.dimValue-2)}U.restore()}if(K.type=="Native"){U.save();U.fillStyle=U.strokeStyle=K.color;U.font=K.style+" "+K.size+"px "+K.family;U.textBaseline="middle";var J=E(S.name,H,S);if(J!==false){J=J!==true?J:H;if(B){U.textAlign="right";U.fillText(J,M+X-ab.labelOffset,L+P/2)}else{U.textAlign="center";U.fillText(J,M+R/2,L-P-K.size/2-ab.labelOffset)}}if(Q(S.name,H,S)){if(B){U.textAlign="center";U.translate(M-ab.labelOffset-K.size/2,L+P/2);U.rotate(Math.PI/2);U.fillText(S.name,0,0)}else{U.textAlign="center";U.fillText(S.name,M+R/2,L+K.size/2+ab.labelOffset)}}U.restore()}}},contains:function(E,G){var J=E.pos.getc(true),B=E.getData("width"),O=E.getData("height"),N=this.getAlignedPos(J,B,O),M=N.x,K=N.y,P=E.getData("dimArray"),C=E.getData("config"),A=G.x-M,z=C.orientation=="horizontal";if(z){if(G.x<M||G.x>M+B||G.y>K+O||G.y<K){return false}}else{if(G.x<M||G.x>M+B||G.y>K||G.y<K-O){return false}}for(var H=0,F=P.length,L=(z?M:K);H<F;H++){var D=P[H];if(z){L+=D;var I=L;if(G.x<=I){return{name:E.getData("stringArray")[H],color:E.getData("colorArray")[H],value:E.getData("valueArray")[H],label:E.name}}}else{L-=D;var I=L;if(G.y>=I){return{name:E.getData("stringArray")[H],color:E.getData("colorArray")[H],value:E.getData("valueArray")[H],label:E.name}}}}return false}},"barchart-grouped":{render:function(U,D){var J=U.pos.getc(true),T=U.getData("width"),R=U.getData("height"),O=this.getAlignedPos(J,T,R),N=O.x,M=O.y,Q=U.getData("dimArray"),H=U.getData("valueArray"),aa=H.length,G=U.getData("colorArray"),C=G.length,ac=U.getData("stringArray");var W=D.getCtx(),z={},X=U.getData("border"),A=U.getData("gradient"),ae=U.getData("config"),B=ae.orientation=="horizontal",F=ae.showAggregates,S=ae.showLabels,L=ae.Label,E=(B?R:T)/aa;if(G&&Q&&ac){for(var ab=0,V=aa,Z=0,I=0;ab<V;ab++){W.fillStyle=W.strokeStyle=G[ab%C];if(A){var ad;if(B){ad=W.createLinearGradient(N+Q[ab]/2,M+E*ab,N+Q[ab]/2,M+E*(ab+1))}else{ad=W.createLinearGradient(N+E*ab,M-Q[ab]/2,N+E*(ab+1),M-Q[ab]/2)}var Y=d.rgbToHex(d.map(d.hexToRgb(G[ab%C].slice(1)),function(x){return(x*0.5)>>0}));ad.addColorStop(0,Y);ad.addColorStop(0.5,G[ab%C]);ad.addColorStop(1,Y);W.fillStyle=ad}if(B){W.fillRect(N,M+E*ab,Q[ab],E)}else{W.fillRect(N+E*ab,M-Q[ab],E,Q[ab])}if(X&&X.name==ac[ab]){z.acum=E*ab;z.dimValue=Q[ab]}Z+=(Q[ab]||0);I+=(H[ab]||0)}if(X){W.save();W.lineWidth=2;W.strokeStyle=X.color;if(B){W.strokeRect(N+1,M+z.acum+1,z.dimValue-2,E-2)}else{W.strokeRect(N+z.acum+1,M-z.dimValue+1,E-2,z.dimValue-2)}W.restore()}if(L.type=="Native"){W.save();W.fillStyle=W.strokeStyle=L.color;W.font=L.style+" "+L.size+"px "+L.family;W.textBaseline="middle";var K=F(U.name,I,U);if(K!==false){K=K!==true?K:I;if(B){W.textAlign="right";W.fillText(K,N+Math.max.apply(null,Q)-ae.labelOffset,M+R/2)}else{W.textAlign="center";W.fillText(K,N+T/2,M-Math.max.apply(null,Q)-L.size/2-ae.labelOffset)}}var P=S(U.name,I,U);if(P!==false){P=P!==true?P:U.name;if(B){W.textAlign="center";W.translate(N-ae.labelOffset-L.size/2,M+R/2);W.rotate(Math.PI/2);W.fillText(P,0,0)}else{W.textAlign="center";W.fillText(P,N+T/2,M+L.size/2+ae.labelOffset)}}W.restore()}}},contains:function(K,G){var C=K.pos.getc(true),J=K.getData("width"),I=K.getData("height"),F=this.getAlignedPos(C,J,I),E=F.x,D=F.y,H=K.getData("dimArray"),N=H.length,Q=K.getData("config"),B=G.x-E,z=Q.orientation=="horizontal",A=(z?I:J)/N;if(z){if(G.x<E||G.x>E+J||G.y>D+I||G.y<D){return false}}else{if(G.x<E||G.x>E+J||G.y>D||G.y<D-I){return false}}for(var M=0,L=H.length;M<L;M++){var P=H[M];if(z){var O=D+A*M;if(G.x<=E+P&&G.y>=O&&G.y<=O+A){return{name:K.getData("stringArray")[M],color:K.getData("colorArray")[M],value:K.getData("valueArray")[M],label:K.name}}}else{var O=E+A*M;if(G.x>=O&&G.x<=O+A&&G.y>=D-P){return{name:K.getData("stringArray")[M],color:K.getData("colorArray")[M],value:K.getData("valueArray")[M],label:K.name}}}}return false}}});$jit.BarChart=new r({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(z){this.controller=this.config=d.merge(o("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},z);var A=this.config.showLabels,y=d.type(A),B=this.config.showAggregates,x=d.type(B);this.config.showLabels=y=="function"?A:d.lambda(A);this.config.showAggregates=x=="function"?B:d.lambda(B);this.initializeViz()},initializeViz:function(){var y=this.config,C=this;var x=y.type.split(":")[0],E=y.orientation=="horizontal",B={};var A=new $jit.ST({injectInto:y.injectInto,width:y.width,height:y.height,orientation:E?"left":"bottom",levelDistance:0,siblingOffset:y.barsOffset,subtreeOffset:0,withLabels:y.Label.type!="Native",useCanvas:y.useCanvas,Label:{type:y.Label.type},Node:{overridable:true,type:"barchart-"+x,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:y.Tips.enable,type:"Native",force:true,onShow:function(I,H,F){var G=F;y.Tips.onShow(I,G,H)}},Events:{enable:true,type:"Native",onClick:function(H,I,F){if(!y.Events.enable){return}var G=I.getContains();y.Events.onClick(G,I,F)},onMouseMove:function(H,I,F){if(!y.hoveredColor){return}if(H){var G=I.getContains();C.select(H.id,G.name,G.index)}else{C.select(false,false,false)}}},onCreateLabel:function(K,I){var Q=y.Label,O=I.getData("valueArray"),N=d.reduce(O,function(R,S){return R+S},0);var M={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var F=M.wrapper,P=M.label,G=M.aggregate,H=F.style,L=P.style,J=G.style;B[I.id]=M;F.appendChild(P);F.appendChild(G);if(!y.showLabels(I.name,N,I)){L.display="none"}if(!y.showAggregates(I.name,N,I)){J.display="none"}H.position="relative";H.overflow="visible";H.fontSize=Q.size+"px";H.fontFamily=Q.family;H.color=Q.color;H.textAlign="center";J.position=L.position="absolute";K.style.width=I.getData("width")+"px";K.style.height=I.getData("height")+"px";J.left=L.left="0px";P.innerHTML=I.name;K.appendChild(F)},onPlaceLabel:function(V,Q){if(!B[Q.id]){return}var U=B[Q.id],H=U.wrapper.style,F=U.label.style,P=U.aggregate.style,W=y.type.split(":")[0]=="grouped",G=y.orientation=="horizontal",L=Q.getData("dimArray"),J=Q.getData("valueArray"),N=(W&&G)?Math.max.apply(null,L):Q.getData("width"),M=(W&&!G)?Math.max.apply(null,L):Q.getData("height"),K=parseInt(H.fontSize,10),O=V.style;if(L&&J){H.width=P.width=F.width=V.style.width=N+"px";for(var T=0,R=J.length,S=0;T<R;T++){if(L[T]>0){S+=J[T]}}if(y.showLabels(Q.name,S,Q)){F.display=""}else{F.display="none"}var I=y.showAggregates(Q.name,S,Q);if(I!==false){P.display=""}else{P.display="none"}if(y.orientation=="horizontal"){P.textAlign="right";F.textAlign="left";F.textIndex=P.textIndent=y.labelOffset+"px";P.top=F.top=(M-K)/2+"px";V.style.height=H.height=M+"px"}else{P.top=(-K-y.labelOffset)+"px";F.top=(y.labelOffset+M)+"px";V.style.top=parseInt(V.style.top,10)-M+"px";V.style.height=H.height=M+"px"}U.aggregate.innerHTML=I!==true?I:S}}});var z=A.canvas.getSize(),D=y.Margin;if(E){A.config.offsetX=z.width/2-D.left-(y.showLabels&&(y.labelOffset+y.Label.size));A.config.offsetY=(D.bottom-D.top)/2}else{A.config.offsetY=-z.height/2+D.bottom+(y.showLabels&&(y.labelOffset+y.Label.size));A.config.offsetX=(D.right-D.left)/2}this.delegate=A;this.canvas=this.delegate.canvas},loadJSON:function(L){if(this.busy){return}this.busy=true;var I=d.time(),D=[],K=this.delegate,O=d.splat(L.label),H=d.splat(L.color||this.colors),M=this.config,x=!!M.type.split(":")[1],A=M.animate,z=M.orientation=="horizontal",B=this;for(var J=0,y=L.values,F=y.length;J<F;J++){var N=y[J];var C=d.splat(y[J].values);var G=0;if(typeof N.id=="undefined"){N.id=N.label}D.push({id:I+N.id,name:N.label,data:{value:C,"$valueArray":C,"$colorArray":H,"$stringArray":O,"$gradient":x,"$config":M},children:[]})}var E={id:I+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:D};K.loadJSON(E);this.normalizeDims();K.compute();K.select(K.root);if(A){if(z){K.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){B.busy=false}})}else{K.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){B.busy=false}})}}else{this.busy=false}},updateJSON:function(z,D){if(this.busy){return}this.busy=true;this.select(false,false,false);var A=this.delegate;var C=A.graph;var y=z.values;var x=this.config.animate;var B=this;var E=this.config.orientation=="horizontal";d.each(y,function(F){var G=C.getByName(F.label);if(G){G.setData("valueArray",d.splat(F.values));if(z.label){G.setData("stringArray",d.splat(z.label))}}});this.normalizeDims();A.compute();A.select(A.root);if(x){if(E){A.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){B.busy=false;D&&D.onComplete()}})}else{A.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){B.busy=false;D&&D.onComplete()}})}}},select:function(z,x){if(!this.config.hoveredColor){return}var y=this.selected;if(y.id!=z||y.name!=x){y.id=z;y.name=x;y.color=this.config.hoveredColor;this.delegate.graph.eachNode(function(A){if(z==A.id){A.setData("border",y)}else{A.setData("border",false)}});this.delegate.plot()}},getLegend:function(){var z={};var A;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(B){A=B.nodeTo});var y=A.getData("colorArray"),x=y.length;d.each(A.getData("stringArray"),function(C,B){z[C]=y[B%x]});return z},getMaxValue:function(){var y=0,x=this.config.type.split(":")[0]=="stacked";this.delegate.graph.eachNode(function(B){var z=B.getData("valueArray"),A=0;if(!z){return}if(x){d.each(z,function(C){A+=+C})}else{A=Math.max.apply(null,z)}y=y>A?y:A});return y},setBarType:function(x){this.config.type=x;this.delegate.config.Node.type="barchart-"+x.split(":")[0]},normalizeDims:function(){var H=this.delegate.graph.getNode(this.delegate.root),C=0;H.eachAdjacency(function(){C++});var E=this.getMaxValue()||1,K=this.delegate.canvas.getSize(),A=this.config,D=A.Margin,I=D.left+D.right,B=D.top+D.bottom,y=A.orientation=="horizontal",x=(K[y?"height":"width"]-(y?B:I)-(C-1)*A.barsOffset)/C,z=A.animate,J=K[y?"width":"height"]-(y?I:B)-(!y&&A.showAggregates&&(A.Label.size+A.labelOffset))-(A.showLabels&&(A.Label.size+A.labelOffset)),G=y?"height":"width",F=y?"width":"height";this.delegate.graph.eachNode(function(O){var N=0,L=[];d.each(O.getData("valueArray"),function(P){N+=+P;L.push(0)});O.setData(G,x);if(z){O.setData(F,N*J/E,"end");O.setData("dimArray",d.map(O.getData("valueArray"),function(P){return P*J/E}),"end");var M=O.getData("dimArray");if(!M){O.setData("dimArray",L)}}else{O.setData(F,N*J/E);O.setData("dimArray",d.map(O.getData("valueArray"),function(P){return P*J/E}))}})}});o.PieChart={$extend:true,animate:true,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:false,onClick:d.empty},Tips:{enable:false,onShow:d.empty,onHide:d.empty},showLabels:true,resizeLabels:false,updateHeights:false};h.Radial=new r({compute:function(y){var z=d.splat(y||["current","start","end"]);g.compute(this.graph,z,this.config);this.graph.computeLevels(this.root,0,"ignore");var x=this.createLevelDistanceFunc();this.computeAngularWidths(z);this.computePositions(z,x)},computePositions:function(E,B){var G=E;var F=this.graph;var C=F.getNode(this.root);var D=this.parent;var x=this.config;for(var z=0,y=G.length;z<y;z++){var A=G[z];C.setPos(l(0,0),A);C.setData("span",Math.PI*2,A)}C.angleSpan={begin:0,end:2*Math.PI};F.eachBFS(this.root,function(L){var R=L.angleSpan.end-L.angleSpan.begin;var T=L.angleSpan.begin;var S=B(L);var U=0,H=[],K={};L.eachSubnode(function(X){U+=X._treeAngularWidth;for(var Y=0,W=G.length;Y<W;Y++){var aa=G[Y],Z=X.getData("dim",aa);K[aa]=(aa in K)?(Z>K[aa]?Z:K[aa]):Z}H.push(X)},"ignore");if(D&&D.id==L.id&&H.length>0&&H[0].dist){H.sort(function(X,W){return(X.dist>=W.dist)-(X.dist<=W.dist)})}for(var N=0,P=H.length;N<P;N++){var J=H[N];if(!J._flag){var V=J._treeAngularWidth/U*R;var I=T+V/2;for(var O=0,M=G.length;O<M;O++){var Q=G[O];J.setPos(l(I,S),Q);J.setData("span",V,Q);J.setData("dim-quotient",J.getData("dim",Q)/K[Q],Q)}J.angleSpan={begin:T,end:T+V};T+=V}}},"ignore")},setAngularWidthForNodes:function(x){this.graph.eachBFS(this.root,function(A,y){var z=A.getData("angularWidth",x[0])||5;A._angularWidth=z/y},"ignore")},setSubtreesAngularWidth:function(){var x=this;this.graph.eachNode(function(y){x.setSubtreeAngularWidth(y)},"ignore")},setSubtreeAngularWidth:function(A){var z=this,y=A._angularWidth,x=0;A.eachSubnode(function(B){z.setSubtreeAngularWidth(B);x+=B._treeAngularWidth},"ignore");A._treeAngularWidth=Math.max(y,x)},computeAngularWidths:function(x){this.setAngularWidthForNodes(x);this.setSubtreesAngularWidth()}});$jit.Sunburst=new r({Implements:[e,p,h.Radial],initialize:function(x){var z=$jit.Sunburst;var y={interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}};this.controller=this.config=d.merge(o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),y,x);var A=this.config;if(A.useCanvas){this.canvas=A.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(A.background){A.background=d.merge({type:"Circles"},A.background)}this.canvas=new m(this,A);this.config.labelContainer=(typeof A.injectInto=="string"?A.injectInto:A.injectInto.id)+"-label"}this.graphOptions={klass:b,Node:{selected:false,exist:true,drawn:true}};this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new z.Label[A.Label.type](this);this.fx=new z.Plot(this,z);this.op=new z.Op(this);this.json=null;this.root=null;this.rotated=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var x=this.config.levelDistance;return function(y){return(y._depth+1)*x}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(z,A,y){var x=z.getPos(y.property||"current").getp(true).theta;this.rotated=z;this.rotateAngle(-x,A,y)},rotateAngle:function(z,C,y){var A=this;var x=d.merge(this.config,y||{},{modes:["polar"]});var B=y.property||(C==="animate"?"end":"current");if(C==="animate"){this.fx.animation.pause()}this.graph.eachNode(function(E){var D=E.getPos(B);D.theta+=z;if(D.theta<0){D.theta+=Math.PI*2}});if(C=="animate"){this.fx.animate(x)}else{if(C=="replot"){this.fx.plot();this.busy=false}}},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=true;(function(x){x.Op=new r({Implements:f.Op});x.Plot=new r({Implements:f.Plot});x.Label={};x.Label.Native=new r({Implements:f.Label.Native,initialize:function(y){this.viz=y;this.label=y.config.Label;this.config=y.config},renderLabel:function(C,E,G){var N=E.getData("span");if(N<Math.PI/2&&Math.tan(N)*this.config.levelDistance*E._depth<10){return}var O=C.getCtx();var A=O.measureText(E.name);if(E.id==this.viz.root){var M=-A.width/2,K=0,L=0;var z=0}else{var D=5;var z=G.levelDistance-D;var J=E.pos.clone();J.rho+=D;var B=J.getp(true);var H=J.getc(true);var M=H.x,K=H.y;var F=Math.PI;var I=(B.theta>F/2&&B.theta<3*F/2);var L=I?B.theta+F:B.theta;if(I){M-=Math.abs(Math.cos(B.theta)*A.width);K+=Math.sin(B.theta)*A.width}else{if(E.id==this.viz.root){M-=A.width/2}}}O.save();O.translate(M,K);O.rotate(L);O.fillText(E.name,0,0);O.restore()}});x.Label.SVG=new r({Implements:f.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(N,C,E){var J=C.pos.getc(true),M=this.viz,A=this.viz.canvas;var F=A.getSize();var B={x:Math.round(J.x+F.width/2),y:Math.round(J.y+F.height/2)};N.setAttribute("x",B.x);N.setAttribute("y",B.y);var G=N.getBBox();if(G){var L=N.getAttribute("x");var I=N.getAttribute("y");var z=C.pos.getp(true);var D=Math.PI;var H=(z.theta>D/2&&z.theta<3*D/2);if(H){N.setAttribute("x",L-G.width);N.setAttribute("y",I-G.height)}else{if(C.id==M.root){N.setAttribute("x",L-G.width/2)}}var K=H?z.theta+D:z.theta;if(C._depth){N.setAttribute("transform","rotate("+K*360/(2*D)+" "+L+" "+I+")")}}E.onPlaceLabel(N,C)}});x.Label.HTML=new r({Implements:f.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(H,B,D){var F=B.pos.clone(),z=this.viz.canvas,G=B.getData("height"),C=((G||B._depth==0)?G:this.viz.config.levelDistance)/2,E=z.getSize();F.rho+=C;F=F.getc(true);var A={x:Math.round(F.x+E.width/2),y:Math.round(F.y+E.height/2)};var y=H.style;y.left=A.x+"px";y.top=A.y+"px";y.display=this.fitsInCanvas(A,z)?"":"none";D.onPlaceLabel(H,B)}});x.Plot.NodeTypes=new r({none:{render:d.empty,contains:d.lambda(false),anglecontains:function(C,E){var B=C.getData("span")/2,z=C.pos.theta;var A=z-B,y=z+B;if(A<0){A+=Math.PI*2}var D=Math.atan2(E.y,E.x);if(D<0){D+=Math.PI*2}if(A>y){return(D>A&&D<=Math.PI*2)||D<y}else{return D>A&&D<y}}},pie:{render:function(D,B){var H=D.getData("span")/2,A=D.pos.theta;var C=A-H,E=A+H;var G=D.pos.getp(true);var y=new b(G.rho,C);var z=y.getc(true);y.theta=E;var F=y.getc(true);var I=B.getCtx();I.beginPath();I.moveTo(0,0);I.lineTo(z.x,z.y);I.moveTo(0,0);I.lineTo(F.x,F.y);I.moveTo(0,0);I.arc(0,0,G.rho*D.getData("dim-quotient"),C,E,false);I.fill()},contains:function(A,C){if(this.nodeTypes.none.anglecontains.call(this,A,C)){var y=Math.sqrt(C.x*C.x+C.y*C.y);var z=this.config.levelDistance,B=A._depth;return(y<=z*B)}return false}},multipie:{render:function(E,C){var L=E.getData("height");var F=L?L:this.config.levelDistance;var K=E.getData("span")/2,B=E.pos.theta;var D=B-K,H=B+K;var J=E.pos.getp(true);var z=new b(J.rho,D);var A=z.getc(true);z.theta=H;var I=z.getc(true);z.rho+=F;var y=z.getc(true);z.theta=D;var G=z.getc(true);var M=C.getCtx();M.moveTo(0,0);M.beginPath();M.arc(0,0,J.rho,D,H,false);M.arc(0,0,J.rho+F,H,D,true);M.moveTo(A.x,A.y);M.lineTo(G.x,G.y);M.moveTo(I.x,I.y);M.lineTo(y.x,y.y);M.fill();if(E.collapsed){M.save();M.lineWidth=2;M.moveTo(0,0);M.beginPath();M.arc(0,0,J.rho+F+5,H-0.01,D+0.01,true);M.stroke();M.restore()}},contains:function(B,E){if(this.nodeTypes.none.anglecontains.call(this,B,E)){var z=Math.sqrt(E.x*E.x+E.y*E.y);var y=B.getData("height");var C=y?y:this.config.levelDistance;var A=this.config.levelDistance,D=B._depth;return(z>=A*D)&&(z<=(A*D+C))}return false}},"gradient-multipie":{render:function(B,y){var G=y.getCtx();var F=B.getData("height");var C=F?F:this.config.levelDistance;var z=G.createRadialGradient(0,0,B.getPos().rho,0,0,B.getPos().rho+C);var E=d.hexToRgb(B.getData("color")),D=[];d.each(E,function(H){D.push(parseInt(H*0.5,10))});var A=d.rgbToHex(D);z.addColorStop(0,A);z.addColorStop(1,B.getData("color"));G.fillStyle=z;this.nodeTypes.multipie.render.call(this,B,y)},contains:function(y,z){return this.nodeTypes.multipie.contains.call(this,y,z)}},"gradient-pie":{render:function(D,A){var y=A.getCtx();var E=y.createRadialGradient(0,0,0,0,0,D.getPos().rho);var C=d.hexToRgb(D.getData("color")),z=[];d.each(C,function(F){z.push(parseInt(F*0.5,10))});var B=d.rgbToHex(z);E.addColorStop(1,B);E.addColorStop(0,D.getData("color"));y.fillStyle=E;this.nodeTypes.pie.render.call(this,D,A)},contains:function(y,z){return this.nodeTypes.pie.contains.call(this,y,z)}}});x.Plot.EdgeTypes=new r({none:d.empty,line:{render:function(y,z){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true);this.edgeHelper.line.render(B,A,z)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(A,z,B,this.edge.epsilon)}},arrow:{render:function(z,A){var E=z.nodeFrom.pos.getc(true),D=z.nodeTo.pos.getc(true),C=z.getData("dim"),B=z.data.$direction,y=(B&&B.length>1&&B[0]!=z.nodeFrom.id);this.edgeHelper.arrow.render(E,D,C,y,A)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(A,z,B,this.edge.epsilon)}},hyperline:{render:function(y,z){var C=y.nodeFrom.pos.getc(),B=y.nodeTo.pos.getc(),A=Math.max(C.norm(),B.norm());this.edgeHelper.hyperline.render(C.$scale(1/A),B.$scale(1/A),A,z)},contains:d.lambda(false)}})})($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(V,B){var U=V.pos.getp(true),D=V.getData("dimArray"),T=V.getData("valueArray"),H=V.getData("colorArray"),A=H.length,N=V.getData("stringArray"),Q=V.getData("span")/2,L=V.pos.theta,G=L-Q,K=L+Q,S=new b;var O=B.getCtx(),M={},J=V.getData("gradient"),E=V.getData("border"),aa=V.getData("config"),aj=aa.showLabels,Z=aa.resizeLabels,ac=aa.Label;var af=aa.sliceOffset*Math.cos((G+K)/2);var F=aa.sliceOffset*Math.sin((G+K)/2);if(H&&D&&N){for(var ag=0,ad=D.length,x=0,Y=0;ag<ad;ag++){var C=D[ag],ah=H[ag%A];if(C<=0){continue}O.fillStyle=O.strokeStyle=ah;if(J&&C){var ae=O.createRadialGradient(af,F,x+aa.sliceOffset,af,F,x+C+aa.sliceOffset);var y=d.hexToRgb(ah),X=d.map(y,function(am){return(am*0.8)>>0}),z=d.rgbToHex(X);ae.addColorStop(0,ah);ae.addColorStop(0.5,ah);ae.addColorStop(1,z);O.fillStyle=ae}S.rho=x+aa.sliceOffset;S.theta=G;var ai=S.getc(true);S.theta=K;var P=S.getc(true);S.rho+=C;var ak=S.getc(true);S.theta=G;var R=S.getc(true);O.beginPath();O.arc(af,F,x+0.01,G,K,false);O.arc(af,F,x+C+0.01,K,G,true);O.fill();if(E&&E.name==N[ag]){M.acum=x;M.dimValue=D[ag];M.begin=G;M.end=K}x+=(C||0);Y+=(T[ag]||0)}if(E){O.save();O.globalCompositeOperation="source-over";O.lineWidth=2;O.strokeStyle=E.color;var ab=G<K?1:-1;O.beginPath();O.arc(af,F,M.acum+0.01+1,M.begin,M.end,false);O.arc(af,F,M.acum+M.dimValue+0.01-1,M.end,M.begin,true);O.closePath();O.stroke();O.restore()}if(aj&&ac.type=="Native"){O.save();O.fillStyle=O.strokeStyle=ac.color;var W=Z?V.getData("normalizedDim"):1,I=(ac.size*W)>>0;I=I<+Z?+Z:I;O.font=ac.style+" "+I+"px "+ac.family;O.textBaseline="middle";O.textAlign="center";S.rho=x+aa.labelOffset+aa.sliceOffset;S.theta=V.pos.theta;var al=S.getc(true);O.fillText(V.name,al.x,al.y);O.restore()}}},contains:function(A,E){if(this.nodeTypes.none.anglecontains.call(this,A,E)){var G=Math.sqrt(E.x*E.x+E.y*E.y);var x=this.config.levelDistance,D=A._depth;var y=A.getData("config");if(G<=x*D+y.sliceOffset){var H=A.getData("dimArray");for(var C=0,B=H.length,F=y.sliceOffset;C<B;C++){var z=H[C];if(G>=F&&G<=F+z){return{name:A.getData("stringArray")[C],color:A.getData("colorArray")[C],value:A.getData("valueArray")[C],label:A.name}}F+=z}}return false}return false}}});$jit.PieChart=new r({sb:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(x){this.controller=this.config=d.merge(o("Canvas","PieChart","Label"),{Label:{type:"Native"}},x);this.initializeViz()},initializeViz:function(){var y=this.config,C=this;var x=y.type.split(":")[0];var B=new $jit.Sunburst({injectInto:y.injectInto,width:y.width,height:y.height,useCanvas:y.useCanvas,withLabels:y.Label.type!="Native",Label:{type:y.Label.type},Node:{overridable:true,type:"piechart-"+x,width:1,height:1},Edge:{type:"none"},Tips:{enable:y.Tips.enable,type:"Native",force:true,onShow:function(G,F,D){var E=D;y.Tips.onShow(G,E,F)}},Events:{enable:true,type:"Native",onClick:function(F,G,D){if(!y.Events.enable){return}var E=G.getContains();y.Events.onClick(E,G,D)},onMouseMove:function(F,G,D){if(!y.hoveredColor){return}if(F){var E=G.getContains();C.select(F.id,E.name,E.index)}else{C.select(false,false,false)}}},onCreateLabel:function(G,F){var D=y.Label;if(y.showLabels){var E=G.style;E.fontSize=D.size+"px";E.fontFamily=D.family;E.color=D.color;E.textAlign="center";G.innerHTML=F.name}},onPlaceLabel:function(T,N){if(!y.showLabels){return}var H=N.pos.getp(true),K=N.getData("dimArray"),Q=N.getData("span")/2,I=N.pos.theta,S=I-Q,E=I+Q,V=new b;var M=y.showLabels,G=y.resizeLabels,J=y.Label;if(K){for(var R=0,O=K.length,P=0;R<O;R++){P+=K[R]}var U=G?N.getData("normalizedDim"):1,D=(J.size*U)>>0;D=D<+G?+G:D;T.style.fontSize=D+"px";V.rho=P+y.labelOffset+y.sliceOffset;V.theta=(S+E)/2;var H=V.getc(true);var F=C.canvas.getSize();var L={x:Math.round(H.x+F.width/2),y:Math.round(H.y+F.height/2)};T.style.left=L.x+"px";T.style.top=L.y+"px"}}});var A=B.canvas.getSize(),z=Math.min;B.config.levelDistance=z(A.width,A.height)/2-y.offset-y.sliceOffset;this.delegate=B;this.canvas=this.delegate.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(L){var I=d.time(),C=[],K=this.delegate,O=d.splat(L.label),E=O.length,H=d.splat(L.color||this.colors),z=H.length,M=this.config,x=!!M.type.split(":")[1],A=M.animate,G=E==1;for(var J=0,y=L.values,F=y.length;J<F;J++){var N=y[J];var B=d.splat(N.values);C.push({id:I+N.label,name:N.label,data:{value:B,"$valueArray":B,"$colorArray":G?d.splat(H[J%z]):H,"$stringArray":O,"$gradient":x,"$config":M,"$angularWidth":d.reduce(B,function(P,Q){return P+Q})},children:[]})}var D={id:I+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:C};K.loadJSON(D);this.normalizeDims();K.refresh();if(A){K.fx.animate({modes:["node-property:dimArray"],duration:1500})}},updateJSON:function(z,D){if(this.busy){return}this.busy=true;var A=this.delegate;var C=A.graph;var y=z.values;var x=this.config.animate;var B=this;d.each(y,function(E){var G=C.getByName(E.label),F=d.splat(E.values);if(G){G.setData("valueArray",F);G.setData("angularWidth",d.reduce(F,function(H,I){return H+I}));if(z.label){G.setData("stringArray",d.splat(z.label))}}});this.normalizeDims();if(x){A.compute("end");A.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){B.busy=false;D&&D.onComplete()}})}else{A.refresh()}},select:function(z,x){if(!this.config.hoveredColor){return}var y=this.selected;if(y.id!=z||y.name!=x){y.id=z;y.name=x;y.color=this.config.hoveredColor;this.delegate.graph.eachNode(function(A){if(z==A.id){A.setData("border",y)}else{A.setData("border",false)}});this.delegate.plot()}},getLegend:function(){var z={};var A;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(B){A=B.nodeTo});var y=A.getData("colorArray"),x=y.length;d.each(A.getData("stringArray"),function(C,B){z[C]=y[B%x]});return z},getMaxValue:function(){var x=0;this.delegate.graph.eachNode(function(A){var y=A.getData("valueArray"),z=0;d.each(y,function(B){z+=+B});x=x>z?x:z});return x},normalizeDims:function(){var y=this.delegate.graph.getNode(this.delegate.root),x=0;y.eachAdjacency(function(){x++});var C=this.getMaxValue()||1,B=this.config,z=B.animate,A=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(H){var G=0,D=[];d.each(H.getData("valueArray"),function(I){G+=+I;D.push(1)});var F=(D.length==1)&&!B.updateHeights;if(z){H.setData("dimArray",d.map(H.getData("valueArray"),function(I){return F?A:(I*A/C)}),"end");var E=H.getData("dimArray");if(!E){H.setData("dimArray",D)}}else{H.setData("dimArray",d.map(H.getData("valueArray"),function(I){return F?A:(I*A/C)}))}H.setData("normalizedDim",G/C)})}});h.TM={};h.TM.SliceAndDice=new r({compute:function(C){var y=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(y);var A=this.canvas.getSize(),z=this.config,B=A.width,x=A.height;this.graph.computeLevels(this.root,0,"ignore");y.getPos(C).setc(-B/2,-x/2);y.setData("width",B,C);y.setData("height",x+z.titleHeight,C);this.computePositions(y,y,this.layout.orientation,C);this.controller.onAfterCompute(y)},computePositions:function(H,F,Q,z){var O=0;H.eachSubnode(function(S){O+=S.getData("area",z)});var R=this.config,C=R.offset,L=H.getData("width",z),J=Math.max(H.getData("height",z)-R.titleHeight,0),y=H==F?1:(F.getData("area",z)/O);var K,I,N,D,B,G,E;var P=(Q=="h");if(P){Q="v";K=J;I=L*y;N="height";D="y";B="x";G=R.titleHeight;E=0}else{Q="h";K=J*y;I=L;N="width";D="x";B="y";G=0;E=R.titleHeight}var x=F.getPos(z);F.setData("width",I,z);F.setData("height",K,z);var M=0,A=this;F.eachSubnode(function(T){var S=T.getPos(z);S[D]=M+x[D]+G;S[B]=x[B]+E;A.computePositions(F,T,Q,z);M+=T.getData(N,z)})}});h.TM.Area={compute:function(x){x=x||"current";var D=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(D);var z=this.config,G=this.canvas.getSize(),y=G.width,F=G.height,E=z.offset,A=y-E,C=F-E;this.graph.computeLevels(this.root,0,"ignore");D.getPos(x).setc(-y/2,-F/2);D.setData("width",y,x);D.setData("height",F,x);var B={top:-F/2+z.titleHeight+E/2,left:-y/2+E/2,width:A,height:C-z.titleHeight};this.computePositions(D,B,x);this.controller.onAfterCompute(D)},computeDim:function(B,C,E,A,z,x){if(B.length+C.length==1){var y=(B.length==1)?B:C;this.layoutLast(y,E,A,x);return}if(B.length>=2&&C.length==0){C=[B.shift()]}if(B.length==0){if(C.length>0){this.layoutRow(C,E,A,x)}return}var D=B[0];if(z(C,E)>=z([D].concat(C),E)){this.computeDim(B.slice(1),C.concat([D]),E,A,z,x)}else{var F=this.layoutRow(C,E,A,x);this.computeDim(B,[],F.dim,F,z,x)}},worstAspectRatio:function(x,F){if(!x||x.length==0){return Number.MAX_VALUE}var y=0,G=0,B=Number.MAX_VALUE;for(var D=0,C=x.length;D<C;D++){var z=x[D]._area;y+=z;B=B<z?B:z;G=G>z?G:z}var E=F*F,A=y*y;return Math.max(E*G/A,A/(E*B))},avgAspectRatio:function(B,y){if(!B||B.length==0){return Number.MAX_VALUE}var D=0;for(var z=0,x=B.length;z<x;z++){var C=B[z]._area;var A=C/y;D+=y>A?y/A:A/y}return D/x},layoutLast:function(y,x,B,A){var z=y[0];z.getPos(A).setc(B.left,B.top);z.setData("width",B.width,A);z.setData("height",B.height,A)}};h.TM.Squarified=new r({Implements:h.TM.Area,computePositions:function(B,E,y){var A=this.config,G=Math.max;if(E.width>=E.height){this.layout.orientation="h"}else{this.layout.orientation="v"}var x=B.getSubnodes([1,1],"ignore");if(x.length>0){this.processChildrenLayout(B,x,E,y);for(var D=0,C=x.length;D<C;D++){var H=x[D],I=A.offset,J=G(H.getData("height",y)-I-A.titleHeight,0),z=G(H.getData("width",y)-I,0),F=H.getPos(y);E={width:z,height:J,top:F.y+A.titleHeight+I/2,left:F.x+I/2};this.computePositions(H,E,y)}}},processChildrenLayout:function(H,x,D,y){var B=D.width*D.height;var C,z=x.length,E=0,I=[];for(C=0;C<z;C++){I[C]=parseFloat(x[C].getData("area",y));E+=I[C]}for(C=0;C<z;C++){x[C]._area=B*I[C]/E}var A=this.layout.horizontal()?D.height:D.width;x.sort(function(K,J){var L=J._area-K._area;return L?L:(J.id==K.id?0:(J.id<K.id?1:-1))});var G=[x[0]];var F=x.slice(1);this.squarify(F,G,A,D,y)},squarify:function(y,B,x,A,z){this.computeDim(y,B,x,A,this.worstAspectRatio,z)},layoutRow:function(y,x,A,z){if(this.layout.horizontal()){return this.layoutV(y,x,A,z)}else{return this.layoutH(y,x,A,z)}},layoutV:function(x,I,E,y){var J=0,A=function(K){return K};d.each(x,function(K){J+=K._area});var z=A(J/I)||0,F=0;for(var C=0,B=x.length;C<B;C++){var D=A(x[C]._area/z)||0;var G=x[C];G.getPos(y).setc(E.left,E.top+F);G.setData("width",z,y);G.setData("height",D,y);F+=D}var H={height:E.height,width:E.width-z,top:E.top,left:E.left+z};H.dim=Math.min(H.width,H.height);if(H.dim!=H.height){this.layout.change()}return H},layoutH:function(x,G,C,y){var I=0;d.each(x,function(J){I+=J._area});var H=I/G||0,D=C.top,z=0;for(var B=0,A=x.length;B<A;B++){var E=x[B];var G=E._area/H||0;E.getPos(y).setc(C.left+z,D);E.setData("width",G,y);E.setData("height",H,y);z+=G}var F={height:C.height-H,width:C.width,top:C.top+H,left:C.left};F.dim=Math.min(F.width,F.height);if(F.dim!=F.width){this.layout.change()}return F}});h.TM.Strip=new r({Implements:h.TM.Area,computePositions:function(B,E,y){var x=B.getSubnodes([1,1],"ignore"),A=this.config,G=Math.max;if(x.length>0){this.processChildrenLayout(B,x,E,y);for(var D=0,C=x.length;D<C;D++){var H=x[D];var I=A.offset,J=G(H.getData("height",y)-I-A.titleHeight,0),z=G(H.getData("width",y)-I,0);var F=H.getPos(y);E={width:z,height:J,top:F.y+A.titleHeight+I/2,left:F.x+I/2};this.computePositions(H,E,y)}}},processChildrenLayout:function(H,x,C,y){var A=C.width*C.height;var B,z=x.length,D=0,I=[];for(B=0;B<z;B++){I[B]=+x[B].getData("area",y);D+=I[B]}for(B=0;B<z;B++){x[B]._area=A*I[B]/D}var G=this.layout.horizontal()?C.width:C.height;var F=[x[0]];var E=x.slice(1);this.stripify(E,F,G,C,y)},stripify:function(y,B,x,A,z){this.computeDim(y,B,x,A,this.avgAspectRatio,z)},layoutRow:function(y,x,A,z){if(this.layout.horizontal()){return this.layoutH(y,x,A,z)}else{return this.layoutV(y,x,A,z)}},layoutV:function(x,G,D,y){var H=0;d.each(x,function(I){H+=I._area});var z=H/G||0,E=0;for(var B=0,A=x.length;B<A;B++){var F=x[B];var C=F._area/z||0;F.getPos(y).setc(D.left,D.top+(G-C-E));F.setData("width",z,y);F.setData("height",C,y);E+=C}return{height:D.height,width:D.width-z,top:D.top,left:D.left+z,dim:G}},layoutH:function(x,F,C,y){var H=0;d.each(x,function(J){H+=J._area});var G=H/F||0,D=C.height-G,z=0;for(var B=0,A=x.length;B<A;B++){var E=x[B];var I=E._area/G||0;E.getPos(y).setc(C.left+z,C.top+D);E.setData("width",I,y);E.setData("height",G,y);z+=I}return{height:C.height-G,width:C.width,top:C.top,left:C.left,dim:F}}});h.TM.Voronoi=new r({Implements:h.TM.Area,compute:function(E){this.controller.onBeforeCompute(y);var y=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root),A=this.canvas.getSize(),z=this.config,D=z.offset,C=A.width,x=A.height;this.graph.computeLevels(this.root,0,0);y.getPos(E).setc(-5,-5);if(!y.histoPos){y.histoPos=[]}y.histoPos[0]=s(0,0);var B=[s(-C*0.5,-x*0.5),s(C*0.5,-x*0.5),s(C*0.5,x*0.5),s(-C*0.5,x*0.5)];B=Geometry.offsetConvex(B,-D*0.5);y.setData("vertices",B,E);y.setData("width",0,E);y.setData("height",0,E);B=Geometry.offsetConvex(B,-D*1.5);this.computePositions(y,B,E,0);this.controller.onAfterCompute(y)},computePositions:function(A,B,x,y){var G=this,C=A.getSubnodes([1,1],"ignore"),z=this.config,D=z.offset,F=A.histoPos[y]||c(0,0),E,H;A.setData("width",0,x);A.setData("height",0,x);A.getPos(x).setc(F.x,F.y);if(C.length>0){if(!C[0].histoPos||!C[0].histoPos[y+1]){E=$jit.util.map(C,function(I){var J=Geometry.randPointInPolygon(B);if(I.data&&I.data.$area){J.area=I.data.$area}return J});E=G[G.config.centroidType](E,B);$jit.util.each(E,function(J,I){if(!C[I].histoPos){C[I].histoPos=[]}C[I].histoPos[y+1]=J})}E=$jit.util.map(C,function(I){return I.histoPos[y+1]});H=Geometry.voronoi(E,B);$jit.util.each(C,function(L,K){var J=H[K];var I=J.slice(0);if(Geometry.area(J)<0){J.reverse()}if(D){I=Geometry.offsetConvex(J,-D*2);J=Geometry.offsetConvex(J,-D*0.5);L.offset=D}L.setData("vertices",J,x);G.computePositions(L,I,x,y+1)})}},centroid:function(A,z){var y=2,x;while(y>0.001){x=Geometry.voronoi(A,z);y=0;A=x.map(function(C,B){var D=Geometry.centroid(C);y+=Geometry.dist2(D,A[B]);return D})}return A},doLayoutPressure:function(){var y=this,x=y.graph.getNode(y.clickedNode&&y.clickedNode.id||y.root);x.eachNode(function(){})},weightedCentroid:function(A,y){var G=[];var z=2,B,E=Geometry.area(y),x=0,D;d.each(A,function(H,I){x+=H.area});D=E/x;B=Geometry.voronoi(A,y);d.each(B,function(I,H){G[H]=A[H].area*D/Geometry.area(I)});var F=0,C=0;d.each(G,function(I,H){F+=I;C+=I*I});console.log("from "+(C-F*F/G.length)/G.length);while(z>0.001){B=Geometry.voronoi(A,y);d.each(B,function(I,H){G[H]=A[H].area*D/Geometry.area(I)});z=0;A=B.map(function(I,H){var K=s(0,0),J=0;d.each(I,function(M,O){var P=[A[H],M,I[O+1]||I[0]],N=(M.attached)?G[M.attached[0]]:1,L=Geometry.area(P)*Math.exp((G[H]-N)*2);J+=L;K.$add(M.add(P[2]).scale(0.5*L))});K.$scale(1/J);K.area=A[H].area;z+=Geometry.dist(K,A[H]);return K})}var F=0,C=0;d.each(G,function(I,H){F+=I;C+=I*I});console.log("to "+(C-F*F/G.length)/G.length);return A},byArea:function(D,B){D=this.centroid(D,B);var z=0,y=0,x,C,x;$jit.util.each(D,function(E){z+=E.area});z=Geometry.area(B)/z;for(;y<100;y++){x=Geometry.voronoi(D,B);for(var A=0;A<D.length;A++){if(x[A].length==0){D=x.map(function(F,E){return Geometry.centroid(F)});break}}C=x.map(function(F,E){return F.area*z/(Geometry.area(F)+1e-10)});x=Geometry.voronoi(D,B);D=x.map(function(H,G){var E=s(D[G].x,D[G].y),I,F;E.area=D[G].area;I=s(0,0);$jit.util.each(H,function(P,M){var N=(P.attached)?P.attached:-1,J=(P.attached)?C[P.attached[0]]:1,L=P,O=H[M+1]||H[0],K=(C[G]-J),R=O.x-L.x,Q=O.y-L.y;I.x+=Q*K;I.y-=R*K});E.x+=I.x/10;E.y+=I.y/10;E.tp=I;return E})}return D}});h.Icicle=new r({compute:function(F){F=F||"current";var E=this.graph.getNode(this.root),A=this.config,I=this.canvas.getSize(),x=I.width,H=I.height,B=A.offset,D=A.constrained?A.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(E);f.Util.computeLevels(this.graph,E.id,0,"ignore");var G=0;f.Util.eachLevel(E,0,false,function(K,J){if(J>G){G=J}});var z=this.graph.getNode(this.clickedNode&&this.clickedNode.id||E.id);var y=Math.min(G,D-1);var C=z._depth;if(this.layout.horizontal()){this.computeSubtree(z,-x/2,-H/2,x/(y+1),H,C,y,F)}else{this.computeSubtree(z,-x/2,-H/2,x,H/(y+1),C,y,F)}},computeSubtree:function(H,J,G,z,M,F,B,I){H.getPos(I).setc(J,G);H.setData("width",z,I);H.setData("height",M,I);var D,L=0,K=0;var A=f.Util.getSubnodes(H,[1,1],"ignore");if(!A.length){return}d.each(A,function(x){K+=x.getData("dim")});for(var E=0,C=A.length;E<C;E++){if(this.layout.horizontal()){D=M*A[E].getData("dim")/K;this.computeSubtree(A[E],J+z,G,z,D,F,B,I);G+=D}else{D=z*A[E].getData("dim")/K;this.computeSubtree(A[E],J,G+M,D,M,F,B,I);J+=D}}}});$jit.Icicle=new r({Implements:[e,p,h.Icicle],layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(x){var y={animate:false,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:false,Node:{type:"rectangle",overridable:true},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45};var A=o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=d.merge(A,y,x);this.layout.orientation=this.config.orientation;var z=this.config;if(z.useCanvas){this.canvas=z.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{this.canvas=new m(this,z);this.config.labelContainer=(typeof z.injectInto=="string"?z.injectInto:z.injectInto.id)+"-label"}this.graphOptions={klass:q,Node:{selected:false,exist:true,drawn:true}};this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){var x=this.config.Label.type;if(x!="Native"){var y=this;this.graph.eachNode(function(z){y.labels.hideLabel(z,false)})}this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(A){if(this.busy){return}this.busy=true;var z=this,y=this.config,x=A;var B={onComplete:function(){if(y.request){z.compute()}if(y.animate){z.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]});f.Util.eachSubgraph(A,function(C){C.setData("alpha",1,"end")},"ignore");z.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){z.clickedNode=A;z.compute("end");z.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){z.busy=false;z.clickedNode=A}})}})}else{z.clickedNode=A;z.busy=false;z.refresh()}}};if(y.request){this.requestNodes(A,B)}else{B.onComplete()}},out:function(){if(this.busy){return}var y=this,z=f.Util,x=this.config,E=this.graph,B=z.getParents(E.getNode(this.clickedNode&&this.clickedNode.id||this.root)),C=B[0],F=C,A=this.clickedNode,D;this.busy=true;this.events.hoveredNode=false;if(!C){this.busy=false;return}D={onComplete:function(){y.clickedNode=C;if(x.request){y.requestNodes(C,{onComplete:function(){y.compute();y.plot();y.busy=false}})}else{y.compute();y.plot();y.busy=false}}};if(x.animate){this.clickedNode=F;this.compute("end");this.clickedNode=A;this.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){y.clickedNode=F;E.nodeList.setDataset(["current","end"],{alpha:[0,1]});z.eachSubgraph(A,function(G){G.setData("alpha",1)},"ignore");y.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){D.onComplete()}})}})}else{D.onComplete()}},requestNodes:function(z,A){var y=d.merge(this.controller,A),x=this.config.constrained?this.config.levelsToShow:Number.MAX_VALUE;if(y.request){var C=[],B=z._depth;f.Util.eachLevel(z,0,x,function(D){if(D.drawn&&!f.Util.anySubnode(D)){C.push(D);D._level=D._depth-B}});this.group.requestNodes(C,y)}else{y.onComplete()}}});$jit.Icicle.Op=new r({Implements:f.Op});$jit.Icicle.Group=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.config=x.config},requestNodes:function(C,B){var A=0,y=C.length,E={};var z=function(){B.onComplete()};var x=this.viz;if(y==0){z()}for(var D=0;D<y;D++){E[C[D].id]=C[D];B.request(C[D].id,C[D]._level,{onComplete:function(G,F){if(F&&F.children){F.id=G;x.op.sum(F,{type:"nothing"})}if(++A==y){f.Util.computeLevels(x.graph,x.root,0);z()}}})}}});$jit.Icicle.Plot=new r({Implements:f.Plot,plot:function(B,z){B=B||this.viz.controller;var x=this.viz,C=x.graph,y=C.getNode(x.clickedNode&&x.clickedNode.id||x.root),A=y._depth;x.canvas.clear();this.plotTree(y,d.merge(B,{withLabels:true,hideLabels:false,plotSubtree:function(D,E){return !x.config.constrained||(E._depth-A<x.config.levelsToShow)}}),z)}});$jit.Icicle.Label={};$jit.Icicle.Label.Native=new r({Implements:f.Label.Native,renderLabel:function(y,z,B){var E=y.getCtx(),x=z.getData("width"),D=z.getData("height"),F=z.getLabelData("size"),A=E.measureText(z.name);if(D<(F*1.5)||x<A.width){return}var C=z.pos.getc(true);E.fillText(z.name,C.x+x/2,C.y+D/2)}});$jit.Icicle.Label.SVG=new r({Implements:f.Label.SVG,initialize:function(x){this.viz=x},placeLabel:function(y,B,z){var D=B.pos.getc(true),A=this.viz.canvas;var x=A.getSize();var C={x:Math.round(D.x+x.width/2),y:Math.round(D.y+x.height/2)};y.setAttribute("x",C.x);y.setAttribute("y",C.y);z.onPlaceLabel(y,B)}});$jit.Icicle.Label.HTML=new r({Implements:f.Label.HTML,initialize:function(x){this.viz=x},placeLabel:function(y,C,z){var E=C.pos.getc(true),A=this.viz.canvas;var x=A.getSize();var D={x:Math.round(E.x+x.width/2),y:Math.round(E.y+x.height/2)};var B=y.style;B.left=D.x+"px";B.top=D.y+"px";B.display="";z.onPlaceLabel(y,C)}});$jit.Icicle.Plot.NodeTypes=new r({none:{render:d.empty},rectangle:{render:function(A,y,L){var z=this.viz.config;var D=z.offset;var x=A.getData("width");var I=A.getData("height");var C=A.getData("border");var H=A.pos.getc(true);var G=H.x+D/2,E=H.y+D/2;var K=y.getCtx();if(x-D<2||I-D<2){return}if(z.cushion){var B=A.getData("color");var J=K.createRadialGradient(G+(x-D)/2,E+(I-D)/2,1,G+(x-D)/2,E+(I-D)/2,x<I?I:x);var F=d.rgbToHex(d.map(d.hexToRgb(B),function(M){return M*0.3>>0}));J.addColorStop(0,B);J.addColorStop(1,F);K.fillStyle=J}if(C){K.strokeStyle=C;K.lineWidth=3}K.fillRect(G,E,Math.max(0,x-D),Math.max(0,I-D));C&&K.strokeRect(H.x,H.y,x,I)},contains:function(z,B){if(this.viz.clickedNode&&!$jit.Graph.Util.isDescendantOf(z,this.viz.clickedNode.id)){return false}var A=z.pos.getc(true),y=z.getData("width"),x=z.getData("height");return this.nodeHelper.rectangle.contains({x:A.x+y/2,y:A.y+x/2},B,y,x)}}});$jit.Icicle.Plot.EdgeTypes=new r({none:d.empty});QuadTreeNode=new r({com:[0,0],children:[null,null,null,null],hasChildren:false,mass:null,fItem:null});QuadTreeNodeFactory=new r({maxNodes:50000,nodes:null,setup:function(){this.nodes=new Array()},getQuadTreeNode:function(){if(this.nodes.length>0){return this.nodes.pop()}else{return new QuadTreeNode()}},reclaim:function(x){x.mass=0;x.com[0]=0;x.com[1]=0;x.fItem=null;x.hasChildren=false;x.children=[null,null,null,null];if(this.nodes.length<this.maxNodes){this.nodes.push(x)}}});NBodyForce=new r({pnames:["GravitationalConstant","Distance","BarnesHutTheta"],DEFAULT_GRAV_CONSTANT:-1,DEFAULT_MIN_GRAV_CONSTANT:-10,DEFAULT_MAX_GRAV_CONSTANT:10,DEFAULT_DISTANCE:-1,DEFAULT_MIN_DISTANCE:-1,DEFAULT_MAX_DISTANCE:500,DEFAULT_THETA:0.9,DEFAULT_MIN_THETA:0,DEFAULT_MAX_THETA:1,GRAVITATIONAL_CONST:0,MIN_DISTANCE:1,BARNES_HUT_THETA:2,xMin:null,xMax:null,yMin:null,yMax:null,params:null,minValues:null,maxValues:null,factory:null,root:null,setup:function(){this.params=[this.DEFAULT_GRAV_CONSTANT,this.DEFAULT_DISTANCE,this.DEFAULT_THETA];this.minValues=[this.DEFAULT_MIN_GRAV_CONSTANT,this.DEFAULT_MIN_DISTANCE,this.DEFAULT_MIN_THETA];this.maxValues=[this.DEFAULT_MAX_GRAV_CONSTANT,this.DEFAULT_MAX_DISTANCE,this.DEFAULT_MAX_THETA];this.factory=new QuadTreeNodeFactory();this.factory.setup();this.root=this.factory.getQuadTreeNode()},setBounds:function(y,x,A,z){this.xMin=y;this.yMin=x;this.xMax=A;this.yMax=z},insertHelper:function(A,C,B,I,z,H){var J=A.location[0];var G=A.location[1];var F=(B+z)/2;var E=(I+H)/2;var D=(J>=F?1:0)+(G>=E?2:0);if(C.children[D]==null){C.children[D]=this.factory.getQuadTreeNode();C.hasChildren=true}if(D==1||D==3){B=F}else{z=F}if(D>1){I=E}else{H=E}this.insert(A,C.children[D],B,I,z,H)},isSameLocation:function(A,z){var y=Math.abs(A.location[0]-z.location[0]);var x=Math.abs(A.location[1]-z.location[1]);return(y<0.01&&x<0.01)},insert:function(C,D,z,B,y,A){if(D.hasChildren){this.insertHelper(C,D,z,B,y,A)}else{if(D.fItem!=null){if(this.isSameLocation(D.fItem,C)){this.insertHelper(C,D,z,B,y,A)}else{var x=D.fItem;D.fItem=null;this.insertHelper(x,D,z,B,y,A);this.insertHelper(C,D,z,B,y,A)}}else{D.fItem=C}}},calcMass:function(A){var z=0;var x=0;A.mass=0;if(A.hasChildren){for(var y=0;y<A.children.length;y++){if(A.children[y]!=null){this.calcMass(A.children[y]);A.mass+=A.children[y].mass;z+=A.children[y].mass*A.children[y].com[0];x+=A.children[y].mass*A.children[y].com[1]}}}if(A.fItem!=null){A.mass+=A.fItem.mass;z+=A.fItem.mass*A.fItem.location[0];x+=A.fItem.mass*A.fItem.location[1]}A.com[0]=z/A.mass;A.com[1]=x/A.mass},insertRoot:function(x){this.insert(x,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},clearHelper:function(y){for(var x=0;x<y.children.length;x++){if(y.children[x]!=null){this.clearHelper(y.children[x])}}this.factory.reclaim(y)},clear:function(){this.clearHelper(this.root);this.root=this.factory.getQuadTreeNode()},init:function(B){this.clear();var A=Number.MAX_VALUE;var F=Number.MAX_VALUE;var z=Number.MIN_VALUE;var E=Number.MIN_VALUE;for(var C=0;C<B.items.length;C++){var G=B.items[C].location[0];var D=B.items[C].location[1];if(G<A){A=G}if(D<F){F=D}if(G>z){z=G}if(D>E){E=D}}var I=z-A;var H=E-F;if(I>H){E=F+I}else{z=A+H}this.setBounds(A,F,z,E);for(var C=0;C<B.items.length;C++){this.insertRoot(B.items[C])}this.calcMass(this.root)},getForce:function(x){this.forceHelper(x,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},forceHelper:function(J,A,z,G,y,E){var L=A.com[0]-J.location[0];var K=A.com[1]-J.location[1];var x=Math.sqrt(L*L+K*K);var F=false;if(x==0){L=(Math.random()-0.5)/50;K=(Math.random()-0.5)/50;x=Math.sqrt(L*L+K*K);F=true}var H=this.params[this.MIN_DISTANCE]>0&&x>this.params[this.MIN_DISTANCE];if((!A.hasChildren&&A.fItem!=J)||(!F&&(y-z)/x<this.params[this.BARNES_HUT_THETA])){if(H){return}var I=this.params[this.GRAVITATIONAL_CONST]*J.mass*A.mass/(x*x*x);J.force[0]+=I*L;J.force[1]+=I*K}else{if(A.hasChildren){var D=(z+y)/2;var C=(G+E)/2;for(var B=0;B<A.children.length;B++){if(A.children[B]!=null){this.forceHelper(J,A.children[B],(B==1||B==3?D:z),(B>1?C:G),(B==1||B==3?y:D),(B>1?E:C))}}if(H){return}if(A.fItem!=null&&A.fItem!=J){var I=this.params[this.GRAVITATIONAL_CONST]*J.mass*A.fItem.mass/(x*x*x);J.force[0]+=I*L;J.force[1]+=I*K}}}}});SpringForce=new r({pnames:["SpringCoefficient","DefaultSpringLength"],DEFAULT_SPRING_COEFF:0.0001,DEFAULT_MAX_SPRING_COEFF:0.001,DEFAULT_MIN_SPRING_COEFF:0.00001,DEFAULT_SPRING_LENGTH:50,DEFAULT_MIN_SPRING_LENGTH:0,DEFAULT_MAX_SPRING_LENGTH:200,SPRING_COEFF:0,SPRING_LENGTH:1,params:null,minValues:null,maxValues:null,setup:function(){this.params=[this.DEFAULT_SPRING_COEFF,this.DEFAULT_SPRING_LENGTH];this.minValues=[this.DEFAULT_MIN_SPRING_COEFF,this.DEFAULT_MIN_SPRING_LENGTH];this.maxValues=[this.DEFAULT_MAX_SPRING_COEFF,this.DEFAULT_MAX_SPRING_LENGTH]},getForce:function(J){var D=J.item1;var C=J.item2;var A=(J.length<0?this.params[this.SPRING_LENGTH]:J.length);var z=D.location[0];var G=D.location[1];var y=C.location[0];var F=C.location[1];var I=y-z;var H=F-G;var x=Math.sqrt(I*I+H*H);if(x==0){I=(Math.random()-0.5)/50;H=(Math.random()-0.5)/50;x=Math.sqrt(I*I+H*H)}var E=x-A;var B=(J.coeff<0?this.params[this.SPRING_COEFF]:J.coeff)*E/x;D.force[0]+=B*I;D.force[1]+=B*H;C.force[0]+=-B*I;C.force[1]+=-B*H},init:function(){}});DragForce=new r({pnames:["DragCoefficient"],DEFAULT_DRAG_COEFF:0.01,DEFAULT_MIN_DRAG_COEFF:0,DEFAULT_MAX_DRAG_COEFF:0.1,DRAG_COEFF:0,params:null,minValues:null,maxValues:null,setup:function(){this.params=[this.DEFAULT_DRAG_COEFF];this.minValues=[this.DEFAULT_MIN_DRAG_COEFF];this.maxValues=[this.DEFAULT_MAX_DRAG_COEFF]},getForce:function(x){x.force[0]-=this.params[this.DRAG_COEFF]*x.velocity[0];x.force[1]-=this.params[this.DRAG_COEFF]*x.velocity[1]},init:function(){}});RungeKuttaIntegrator=new r({integrate:function(G,y){var z=G.speedLimit;var F,E,H,D;var B,A;for(var C=0;C<G.items.length;C++){var I=G.items[C];D=y/I.mass;B=I.k;A=I.l;I.plocation[0]=I.location[0];I.plocation[1]=I.location[1];B[0][0]=y*I.velocity[0];B[0][1]=y*I.velocity[1];A[0][0]=D*I.force[0];A[0][1]=D*I.force[1];I.location[0]+=0.5*B[0][0];I.location[1]+=0.5*B[0][1]}G.accumulate();for(var C=0;C<G.items.length;C++){var I=G.items[C];D=y/I.mass;B=I.k;A=I.l;F=I.velocity[0]+0.5*A[0][0];E=I.velocity[1]+0.5*A[0][1];H=Math.sqrt(F*F+E*E);if(H>z){F=z*F/H;E=z*E/H}B[1][0]=y*F;B[1][1]=y*E;A[1][0]=D*I.force[0];A[1][1]=D*I.force[1];I.location[0]=I.plocation[0]+0.5*B[1][0];I.location[1]=I.plocation[1]+0.5*B[1][1]}G.accumulate();for(var C=0;C<G.items.length;C++){var I=G.items[C];D=y/I.mass;B=I.k;A=I.l;F=I.velocity[0]+0.5*A[1][0];E=I.velocity[1]+0.5*A[1][1];H=Math.sqrt(F*F+E*E);if(H>z){F=z*F/H;E=z*E/H}B[2][0]=y*F;B[2][1]=y*E;A[2][0]=D*I.force[0];A[2][1]=D*I.force[1];I.location[0]=I.plocation[0]+0.5*B[2][0];I.location[1]=I.plocation[1]+0.5*B[2][1]}G.accumulate();for(var C=0;C<G.items.length;C++){var I=G.items[C];D=y/I.mass;B=I.k;A=I.l;var x=I.plocation;F=I.velocity[0]+A[2][0];E=I.velocity[1]+A[2][1];H=Math.sqrt(F*F+E*E);if(H>z){F=z*F/H;E=z*E/H}B[3][0]=y*F;B[3][1]=y*E;A[3][0]=D*I.force[0];A[3][1]=D*I.force[1];I.location[0]=x[0]+(B[0][0]+B[3][0])/6+(B[1][0]+B[2][0])/3;I.location[1]=x[1]+(B[0][1]+B[3][1])/6+(B[1][1]+B[2][1])/3;F=(A[0][0]+A[3][0])/6+(A[1][0]+A[2][0])/3;E=(A[0][1]+A[3][1])/6+(A[1][1]+A[2][1])/3;H=Math.sqrt(F*F+E*E);if(H>z){F=z*F/H;E=z*E/H}I.velocity[0]+=F;I.velocity[1]+=E}}});ForceSimulator=new r({speedLimit:1,iflen:0,sflen:0,integrator:null,items:null,springs:null,iforces:null,sforces:null,setup:function(){this.items=new Array();this.springs=new Array();this.iforces=new Array();this.sforces=new Array();this.integrator=new RungeKuttaIntegrator()},accumulate:function(){for(var y=0;y<this.iforces.length;y++){this.iforces[y].init(this)}for(var y=0;y<this.sforces.length;y++){this.sforces[y].init(this)}for(var y=0;y<this.items.length;y++){this.items[y].force[0]=0;this.items[y].force[1]=0;for(var x=0;x<this.iforces.length;x++){this.iforces[x].getForce(this.items[y])}}for(var y=0;y<this.springs.length;y++){for(var x=0;x<this.sforces.length;x++){this.sforces[x].getForce(this.springs[y])}}},runSimulator:function(x){this.accumulate();this.integrator.integrate(this,x)},addForce:function(x,y){if(y){this.iforces.push(x);this.iflen++}else{this.sforces.push(x);this.sflen++}},addItem:function(x){this.items.push(x)},addSpring:function(x){this.springs.push(x)}});Spring=new r({item1:null,item2:null,coeff:null,length:null,setup:function(A,z,y,x){this.item1=A;this.item2=z;this.coeff=y;this.length=x}});ForceItem=new r({mass:1,force:null,velocity:null,location:null,plocation:null,k:[[0,0],[0,0],[0,0],[0,0]],l:[[0,0],[0,0],[0,0],[0,0]],setup:function(){this.force=new Array();this.velocity=new Array();this.location=new Array();this.plocation=new Array()},init:function(y,x){this.force[0]=0;this.force[1]=0;this.velocity[0]=0;this.velocity[1]=0;this.location[0]=y;this.location[1]=x;this.plocation[0]=0;this.plocation[1]=0}});h.ForceDirected=new r({getOptions:function(D){var B=this.canvas.getSize();var y=B.width,A=B.height;var C=0;this.graph.eachNode(function(F){C++});var E=y*A/C,z=Math.sqrt(E);var x=this.config.levelDistance;return{width:y-x,height:A-x,tstart:y*0.1,nodef:function(F){return E/(F||1)},edgef:function(F){return z*(F-x)}}},compute:function(y,z){var A=d.splat(y||["current","start","end"]);var x=this.getOptions();g.compute(this.graph,A,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(B){d.each(A,function(C){var D=B.getPos(C);if(D.equals(q.KER)){D.x=x.width/5*(Math.random()-0.5);D.y=x.height/5*(Math.random()-0.5)}B.disp={};d.each(A,function(E){B.disp[E]=s(0,0)})})});this.computePositions(A,x,z)},computePositions:function(B,z,C){var D=this.config.iterations,y=0,A=this;if(C){(function x(){for(var F=C.iter,E=0;E<F;E++){z.t=z.tstart;if(D){z.t*=(1-y++/(D-1))}A.computePositionStep(B,z);if(D&&y>=D){C.onComplete();return}}C.onStep(Math.round(y/(D-1)*100));setTimeout(x,1)})()}else{for(;y<D;y++){z.t=z.tstart*(1-y/(D-1));this.computePositionStep(B,z)}}},computePositionStep:function(E,x){var F=this.graph;var z=Math.min,D=Math.max;var C=s(0,0);F.eachNode(function(H){d.each(E,function(I){H.disp[I].x=0;H.disp[I].y=0});F.eachNode(function(I){if(I.id!=H.id){d.each(E,function(M){var K=H.getPos(M),J=I.getPos(M);C.x=K.x-J.x;C.y=K.y-J.y;var L=C.norm()||1;H.disp[M].$add(C.$scale(x.nodef(L)/L))})}})});var y=!!F.getNode(this.root).visited;F.eachNode(function(H){H.eachAdjacency(function(I){var J=I.nodeTo;if(!!J.visited===y){d.each(E,function(N){var L=H.getPos(N),K=J.getPos(N);C.x=L.x-K.x;C.y=L.y-K.y;var M=C.norm()||1;H.disp[N].$add(C.$scale(-x.edgef(M)/M));J.disp[N].$add(C.$scale(-1))})}});H.visited=!y});var G=x.t,A=x.width/2,B=x.height/2;F.eachNode(function(H){d.each(E,function(K){var I=H.disp[K];var J=I.norm()||1;var K=H.getPos(K);K.$add(s(I.x*z(Math.abs(I.x),G)/J,I.y*z(Math.abs(I.y),G)/J));K.x=z(A,D(-A,K.x));K.y=z(B,D(-B,K.y))})})},computeFast:function(K,E){var G=new ForceSimulator();G.setup();var N=new NBodyForce();N.setup();var L=new SpringForce();L.setup();var D=new DragForce();D.setup();G.addForce(N,true);G.addForce(L,false);G.addForce(D,true);var B=1000;var y=d.splat(K||["current","start","end"]);var A=this.getOptions();var I=[];g.compute(this.graph,y,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(O){d.each(y,function(P){var Q=O.getPos(P);Q.x=A.width/2;Q.y=A.height/2;O.forceItem=new ForceItem();O.forceItem.setup();O.forceItem.init(Q.x,Q.y);G.addItem(O.forceItem);O.disp={};d.each(y,function(R){O.disp[R]=s(0,0)})})});this.graph.eachNode(function(O){O.eachAdjacency(function(P){if(I[P.nodeTo.id]===undefined){var Q=new Spring();Q.setup(P.nodeFrom.forceItem,P.nodeTo.forceItem,-1,-1);G.addSpring(Q);I[P.nodeFrom.id]=[];I[P.nodeFrom.id][P.nodeTo.id]=true}})});var z=Math.ceil(this.config.iterations/E.iter);var H=0;var J=0;var x=this.config.iterations;var C=0;var M=this.graph;(function F(){for(var X=E.iter,W=0;W<X;W++){A.t=A.tstart;if(x){A.t*=(1-C++/(x-1))}B*=(1-C/x);var S=B+50;G.runSimulator(S);if(x&&C>=x){var R=0;var Z=0;var Q=A.width/2;var Y=A.height/2;M.eachNode(function(ab){d.each(y,function(ah){var ad=ab.forceItem.location[0];var aj=ab.forceItem.location[1];var ac=ab.getData("dim")*2;var ag=ab.getData("dim")*2;var ae=ab.disp[ah];var af=ae.norm()||1;var ai=ab.getPos(ah);ai.x=ad;ai.y=aj})});E.onComplete();var P=-Number.MAX_VALUE;var V=Number.MAX_VALUE;var O=-Number.MAX_VALUE;var U=Number.MAX_VALUE;M.eachNode(function(ab){d.each(y,function(ad){var ac=ab.getPos(ad);if(ac.x>P){P=ac.x}if(ac.x<V){V=ac.x}if(ac.y>O){O=ac.y}if(ac.y<U){U=ac.y}})});var aa;var T;if(P<0){T=Math.ceil(Math.floor(Math.abs(V))-Math.floor(Math.abs(P)))}else{if(V>=0){T=Math.ceil(P-V)}else{T=Math.ceil(P+Math.abs(V))}}if(O<0){aa=Math.ceil(Math.floor(Math.abs(U))-Math.floor(Math.abs(O)))}else{if(U>=0){aa=Math.ceil(O-U)}else{aa=Math.ceil(O+Math.abs(U))}}var Q=A.width/2;var Y=A.height/2;M.eachNode(function(ab){d.each(y,function(ae){var ac=ab.getPos(ae);var ad=ab.getData("dim");if(V<0){ac.x=((ac.x+Math.abs(V))*(A.width/T))-(A.width/2)}else{ac.x=((ac.x-V)*(A.width/T))-(A.width/2)}if(ac.x<=-Q+ad){ac.x=-Q+(ad*2)}if(ac.x>=Q-ad){ac.x=Q-(ad*2)}if(U<0){ac.y=((ac.y+Math.abs(U))*(A.height/aa))-(A.height/2)}else{ac.y=((ac.y-U)*(A.height/aa))-(A.height/2)}if(ac.y<=-Y+ad){ac.y=-Y+(ad*2)}if(ac.y>=Y-ad){ac.y=Y-(ad*2)}})});return}}E.onStep(Math.round(C/(x-1)*100));setTimeout(F,1)})()}});$jit.ForceDirected=new r({Implements:[e,p,h.ForceDirected],initialize:function(y){var x=$jit.ForceDirected;var z={iterations:50,levelDistance:50};this.controller=this.config=d.merge(o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),z,y);var A=this.config;if(A.useCanvas){this.canvas=A.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(A.background){A.background=d.merge({type:"Circles"},A.background)}this.canvas=new m(this,A);this.config.labelContainer=(typeof A.injectInto=="string"?A.injectInto:A.injectInto.id)+"-label"}this.graphOptions={klass:q,Node:{selected:false,exist:true,drawn:true}};this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new x.Label[A.Label.type](this);this.fx=new x.Plot(this,x);this.op=new x.Op(this);this.json=null;this.busy=false;this.initializeExtras()},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(x){x=d.merge({iter:20,property:"end",onStep:d.empty,onComplete:d.empty},x||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(x.property,x)},computePrefuse:function(x){x=d.merge({iter:20,property:"end",onStep:d.empty,onComplete:d.empty},x||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.computeFast(x.property,x)},plot:function(){this.fx.plot()},animate:function(x){this.fx.animate(d.merge({modes:["linear"]},x||{}))}});$jit.ForceDirected.$extend=true;(function(x){x.Op=new r({Implements:f.Op});x.Plot=new r({Implements:f.Plot});x.Label={};x.Label.Native=new r({Implements:f.Label.Native});x.Label.SVG=new r({Implements:f.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(I,C,D){var G=C.pos.getc(true),z=this.viz.canvas,A=z.translateOffsetX,y=z.translateOffsetY,H=z.scaleOffsetX,F=z.scaleOffsetY,E=z.getSize();var B={x:Math.round(G.x*H+A+E.width/2),y:Math.round(G.y*F+y+E.height/2)};I.setAttribute("x",B.x);I.setAttribute("y",B.y);D.onPlaceLabel(I,C)}});x.Label.HTML=new r({Implements:f.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(J,D,E){var H=D.pos.getc(true),A=this.viz.canvas,B=A.translateOffsetX,z=A.translateOffsetY,I=A.scaleOffsetX,G=A.scaleOffsetY,F=A.getSize();var C={x:Math.round(H.x*I+B+F.width/2),y:Math.round(H.y*G+z+F.height/2)};var y=J.style;y.left=C.x+"px";y.top=C.y+"px";y.display=this.fitsInCanvas(C,A)?"":"none";E.onPlaceLabel(J,D)}});x.Plot.NodeTypes=new r({none:{render:d.empty,contains:d.lambda(false)},circle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.circle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.circle.contains(A,B,z)}},ellipse:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.ellipse.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.ellipse.contains(B,C,z,y)}},square:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.square.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.square.contains(A,B,z)}},rectangle:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.rectangle.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.rectangle.contains(B,C,z,y)}},triangle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.triangle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.triangle.contains(A,B,z)}},star:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.star.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.star.contains(A,B,z)}}});x.Plot.EdgeTypes=new r({none:d.empty,line:{render:function(y,z){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true);this.edgeHelper.line.render(B,A,z)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(A,z,B,this.edge.epsilon)}},arrow:{render:function(z,A){var E=z.nodeFrom.pos.getc(true),D=z.nodeTo.pos.getc(true),C=z.getData("dim"),B=z.data.$direction,y=(B&&B.length>1&&B[0]!=z.nodeFrom.id);this.edgeHelper.arrow.render(E,D,C,y,A)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(A,z,B,this.edge.epsilon)}}})})($jit.ForceDirected);$jit.TM={};var w=$jit.TM;$jit.TM.$extend=true;w.Base={layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(x){var y={orientation:"h",titleHeight:13,offset:2,levelsToShow:0,labelsToShow:[0,-1],constrained:false,animate:false,Node:{type:"rectangle",overridable:true,width:3,height:3,color:"#444",props:"node-property:width:height"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45};this.controller=this.config=d.merge(o("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),y,x);this.layout.orientation=this.config.orientation;var z=this.config;if(z.useCanvas){this.canvas=z.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(z.background){z.background=d.merge({type:"Circles"},z.background)}this.canvas=new m(this,z);this.config.labelContainer=(typeof z.injectInto=="string"?z.injectInto:z.injectInto.id)+"-label"}this.graphOptions={klass:q,Node:{selected:false,exist:true,drawn:true}};this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new w.Label[z.Label.type](this);this.fx=new w.Plot(this);this.op=new w.Op(this);this.group=new w.Group(this);this.geom=new w.Geom(this);this.clickedNode=null;this.busy=false;this.initializeExtras()},refresh:function(){if(this.busy){return}this.busy=true;var y=this;if(this.config.animate){this.compute("end");this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.fx.animate(d.merge(this.config,{modes:["linear",this.config.Node.props],onComplete:function(){y.busy=false}}))}else{var x=this.config.Label.type;if(x!="Native"){this.graph.eachNode(function(z){y.labels.hideLabel(z,false)})}this.busy=false;this.compute();this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.plot()}},plot:function(){this.fx.plot()},leaf:function(x){return x.getSubnodes([1,1],"ignore").length==0},enter:function(D){if(this.busy){return}this.busy=true;var z=this,y=this.config,B=this.graph,x=D,A=this.clickedNode;var C={onComplete:function(){z.geom.setRightLevelToShow(D);if(y.request){z.compute()}if(y.animate){B.nodeList.setData("alpha",0,"end");D.eachSubgraph(function(E){E.setData("alpha",1,"end");E.selected=false},"ignore");x.selected=true;z.fx.animate({duration:z.config.duration/3,modes:["node-property:alpha"],onComplete:function(){z.clickedNode=x;z.compute("end");z.clickedNode=A;z.fx.animate({duration:2*z.config.duration/3,modes:["linear",z.config.Node.props],onComplete:function(){z.busy=false;z.clickedNode=x;z.geom.setRightLevelToShow(x)}})}})}else{z.busy=false;z.clickedNode=D;z.refresh()}}};this.geom.setRightLevelToShow(D);if(y.request){this.requestNodes(x,C)}else{C.onComplete()}},out:function(){if(this.busy){return}this.busy=true;this.events.hoveredNode=false;var B=this,z=this.config,D=this.graph,y=D.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents(),A=y[0],x=A,C=this.clickedNode;if(!A){this.busy=false;return}A.selected=true;var E={onComplete:function(){C.selected=false;B.clickedNode=A;if(z.request){B.requestNodes(A,{onComplete:function(){B.compute();B.plot();B.busy=false}})}else{B.compute();B.plot();B.busy=false}B.geom.setRightLevelToShow(A);B.plot()}};this.geom.setRightLevelToShow(A);if(z.animate){this.clickedNode=x;this.compute("end");this.clickedNode=C;this.fx.animate({duration:2*this.config.duration/3,modes:["linear",this.config.Node.props],onComplete:function(){B.clickedNode=x;x.eachSubgraph(function(F){F.setDataset(["current","end"],{alpha:[0,1]})},"ignore");C.eachSubgraph(function(F){F.setData("alpha",1)},"ignore");B.geom.setRightLevelToShow(A);B.fx.animate({duration:B.config.duration/3,modes:["node-property:alpha"],onComplete:function(){E.onComplete()}})}})}else{E.onComplete()}},requestNodes:function(z,A){var y=d.merge(this.controller,A),x=this.config.levelsToShow;if(y.request){var C=[],B=z._depth;z.eachLevel(0,x,function(E){var D=x-(E._depth-B);if(E.drawn&&!E.anySubnode()&&D>0){C.push(E);E._level=D}});this.group.requestNodes(C,y)}else{y.onComplete()}},reposition:function(){this.compute("end")}};w.Op=new r({Implements:f.Op,initialize:function(x){this.viz=x}});w.Geom=new r({Implements:f.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(y){var B=this.getRightLevelToShow(),A=this.viz.config.labelsToShow,x=this.viz.labels;var z={};y.eachLevel(0,false,function(D){var C=D._depth-y._depth;D._hideLabel=A[0]>=0&&C<A[0]||A[1]>=0&&C>A[1];if(B>0&&C>B){D.drawn=false;D.exist=false;D.ignore=true;x.hideLabel(D,false)}else{D.drawn=true;D.exist=true;delete D.ignore}z[D.name]=D._hideLabel});y.drawn=true;delete y.ignore}});w.Group=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.config=x.config},requestNodes:function(C,B){var A=0,y=C.length,E={};var z=function(){B.onComplete()};var x=this.viz;if(y==0){z()}for(var D=0;D<y;D++){E[C[D].id]=C[D];B.request(C[D].id,C[D]._level,{onComplete:function(G,F){if(F&&F.children){F.id=G;x.op.sum(F,{type:"nothing"})}if(++A==y){x.graph.computeLevels(x.root,0);z()}}})}}});w.Plot=new r({Implements:f.Plot,initialize:function(x){this.viz=x;this.config=x.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new v;this.nodeTypes=new w.Plot.NodeTypes;this.edgeTypes=new w.Plot.EdgeTypes;this.labels=x.labels},plot:function(z,y){var x=this.viz,A=x.graph;x.canvas.clear();this.plotTree(A.getNode(x.clickedNode&&x.clickedNode.id||x.root),d.merge(x.config,z||{},{withLabels:true,hideLabels:false,plotSubtree:function(C,B){return C.anySubnode("exist")}}),y)}});w.Label={};w.Label.Native=new r({Implements:f.Label.Native,initialize:function(x){this.config=x.config;this.leaf=x.leaf},renderLabel:function(A,B,C){if(B._hideLabel||!this.leaf(B)&&!this.config.titleHeight){return}var E=B.pos.getc(true),H=A.getCtx(),z=B.getData("width"),G=B.getData("height"),F=E.x+z/2,D=E.y;if(isNaN(z)||z===0){H.fillText(B.name,F,D)}else{H.fillText(B.name,F,D,z)}}});w.Label.SVG=new r({Implements:f.Label.SVG,initialize:function(x){this.viz=x;this.leaf=x.leaf;this.config=x.config},placeLabel:function(H,B,C){C=C||this.viz.controller;var F=B.pos.getc(true),y=this.viz.canvas,z=y.translateOffsetX,x=y.translateOffsetY,G=y.scaleOffsetX,E=y.scaleOffsetY,D=y.getSize();var A={x:Math.round(F.x*G+z+D.width/2),y:Math.round(F.y*E+x+D.height/2)};H.setAttribute("x",A.x);H.setAttribute("y",A.y);if(B._hideLabel||!this.leaf(B)&&!this.config.titleHeight){H.style.display="none"}C.onPlaceLabel(H,B)}});w.Label.HTML=new r({Implements:f.Label.HTML,initialize:function(x){this.viz=x;this.leaf=x.leaf;this.config=x.config},placeLabel:function(I,C,D){D=D||this.viz.controller;var G=C.pos.getc(true),z=this.viz.canvas,A=z.translateOffsetX,y=z.translateOffsetY,H=z.scaleOffsetX,F=z.scaleOffsetY,E=z.getSize();var B={x:Math.round(G.x*H+A+E.width/2),y:Math.round(G.y*F+y+E.height/2)};var x=I.style;x.left=B.x+"px";x.top=B.y+"px";x.width=Math.max(0,C.getData("width")*H)+"px";x.height=Math.max(0,C.getData("height")*F)+"px";x.zIndex=C._depth*100;x.display="";if(C._hideLabel||!this.leaf(C)&&!this.config.titleHeight){I.style.display="none"}D.onPlaceLabel(I,C)}});w.Plot.NodeTypes=new r({none:{render:d.empty},rectangle:{render:function(A,y,N){var E=this.viz.leaf(A),z=this.config,J=z.offset,D=z.titleHeight,I=A.pos.getc(true),x=A.getData("width"),K=A.getData("height"),C=A.getData("border"),M=y.getCtx(),H=I.x+J/2,F=I.y+J/2;if(x<=J||K<=J){return}if(E){if(z.cushion){var L=M.createRadialGradient(H+(x-J)/2,F+(K-J)/2,1,H+(x-J)/2,F+(K-J)/2,x<K?K:x);var B=A.getData("color");var G=d.rgbToHex(d.map(d.hexToRgb(B),function(O){return O*0.2>>0}));L.addColorStop(0,B);L.addColorStop(1,G);M.fillStyle=L}M.fillRect(H,F,x-J,K-J);if(C){M.save();M.strokeStyle=C;M.strokeRect(H,F,x-J,K-J);M.restore()}}else{if(D>0){M.fillRect(I.x+J/2,I.y+J/2,x-J,D-J);if(C){M.save();M.strokeStyle=C;M.strokeRect(I.x+J/2,I.y+J/2,x-J,K-J);M.restore()}}}},contains:function(A,C){if(this.viz.clickedNode&&!A.isDescendantOf(this.viz.clickedNode.id)||A.ignore){return false}var B=A.pos.getc(true),z=A.getData("width"),y=this.viz.leaf(A),x=y?A.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:B.x+z/2,y:B.y+x/2},C,z,x)}}});w.Plot.EdgeTypes=new r({none:d.empty});w.SliceAndDice=new r({Implements:[e,p,w.Base,h.TM.SliceAndDice]});w.Squarified=new r({Implements:[e,p,w.Base,h.TM.Squarified]});w.Strip=new r({Implements:[e,p,w.Base,h.TM.Strip]});$jit.RGraph=new r({Implements:[e,p,h.Radial],initialize:function(x){var y=$jit.RGraph;var z={interpolation:"linear",levelDistance:100};this.controller=this.config=d.merge(o("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),z,x);var A=this.config;if(A.useCanvas){this.canvas=A.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(A.background){A.background=d.merge({type:"Circles"},A.background)}this.canvas=new m(this,A);this.config.labelContainer=(typeof A.injectInto=="string"?A.injectInto:A.injectInto.id)+"-label"}this.graphOptions={klass:b,Node:{selected:false,exist:true,drawn:true}};this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new y.Label[A.Label.type](this);this.fx=new y.Plot(this,y);this.op=new y.Op(this);this.json=null;this.root=null;this.busy=false;this.parent=false;this.initializeExtras()},createLevelDistanceFunc:function(){var x=this.config.levelDistance;return function(y){return(y._depth+1)*x}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(E){var z=false;var D=this.graph.getNode(E);var B=D.getParents();var A=(B.length>0)?B[0]:false;if(A){var x=A.pos.getc(),C=D.pos.getc();var y=x.add(C.scale(-1));z=Math.atan2(y.y,y.x);if(z<0){z+=2*Math.PI}}return{parent:A,theta:z}},tagChildren:function(B,D){if(B.angleSpan){var C=[];B.eachAdjacency(function(E){C.push(E.nodeTo)},"ignore");var x=C.length;for(var A=0;A<x&&D!=C[A].id;A++){}for(var z=(A+1)%x,y=0;D!=C[z].id;z=(z+1)%x){C[z].dist=y++}}},onClick:function(C,y){if(this.root!=C&&!this.busy){this.busy=true;this.root=C;var z=this;this.controller.onBeforeCompute(this.graph.getNode(C));var A=this.getNodeAndParentAngle(C);this.tagChildren(A.parent,C);this.parent=A.parent;this.compute("end");var x=A.theta-A.parent.endPos.theta;this.graph.eachNode(function(D){D.endPos.set(D.endPos.getp().add(l(x,0)))});var B=this.config.interpolation;y=d.merge({onComplete:d.empty},y||{});this.fx.animate(d.merge({hideLabels:true,modes:[B]},y,{onComplete:function(){z.busy=false;y.onComplete()}}))}}});$jit.RGraph.$extend=true;(function(x){x.Op=new r({Implements:f.Op});x.Plot=new r({Implements:f.Plot});x.Label={};x.Label.Native=new r({Implements:f.Label.Native});x.Label.SVG=new r({Implements:f.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(I,C,D){var G=C.pos.getc(true),z=this.viz.canvas,A=z.translateOffsetX,y=z.translateOffsetY,H=z.scaleOffsetX,F=z.scaleOffsetY,E=z.getSize();var B={x:Math.round(G.x*H+A+E.width/2),y:Math.round(G.y*F+y+E.height/2)};I.setAttribute("x",B.x);I.setAttribute("y",B.y);D.onPlaceLabel(I,C)}});x.Label.HTML=new r({Implements:f.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(J,D,E){var H=D.pos.getc(true),A=this.viz.canvas,B=A.translateOffsetX,z=A.translateOffsetY,I=A.scaleOffsetX,G=A.scaleOffsetY,F=A.getSize();var C={x:Math.round(H.x*I+B+F.width/2),y:Math.round(H.y*G+z+F.height/2)};var y=J.style;y.left=C.x+"px";y.top=C.y+"px";y.display=this.fitsInCanvas(C,A)?"":"none";E.onPlaceLabel(J,D)}});x.Plot.NodeTypes=new r({none:{render:d.empty,contains:d.lambda(false)},circle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.circle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.circle.contains(A,B,z)}},ellipse:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.ellipse.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.ellipse.contains(B,C,z,y)}},square:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.square.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.square.contains(A,B,z)}},rectangle:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.rectangle.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.rectangle.contains(B,C,z,y)}},triangle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.triangle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.triangle.contains(A,B,z)}},star:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.star.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.star.contains(A,B,z)}}});x.Plot.EdgeTypes=new r({none:d.empty,line:{render:function(y,z){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true);this.edgeHelper.line.render(B,A,z)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(A,z,B,this.edge.epsilon)}},arrow:{render:function(z,A){var F=z.nodeFrom.pos.getc(true),E=z.nodeTo.pos.getc(true),D=z.getData("dim"),C=z.data.$direction,y=(C&&C.length>1&&C[0]!=z.nodeFrom.id),B=this.edge.arrowPosition||"end";this.edgeHelper.arrow.render(F,E,D,y,A,B)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(A,z,B,this.edge.epsilon)}}})})($jit.RGraph);q.prototype.moebiusTransformation=function(z){var x=this.add(z);var y=z.$conjugate().$prod(this);y.x++;return x.$div(y)};f.Util.moebiusTransformation=function(z,B,A,y,x){this.eachNode(z,function(D){for(var C=0;C<A.length;C++){var F=B[C].scale(-1),E=y?y:A[C];D.getPos(A[C]).set(D.getPos(E).getc().moebiusTransformation(F))}},x)};$jit.Hypertree=new r({Implements:[e,p,h.Radial],initialize:function(x){var A=$jit.Hypertree;var y={radius:"auto",offset:0,Edge:{type:"hyperline"},duration:1500,fps:35};this.controller=this.config=d.merge(o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),y,x);var z=this.config;if(z.useCanvas){this.canvas=z.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(z.background){z.background=d.merge({type:"Circles"},z.background)}this.canvas=new m(this,z);this.config.labelContainer=(typeof z.injectInto=="string"?z.injectInto:z.injectInto.id)+"-label"}this.graphOptions={klass:b,Node:{selected:false,exist:true,drawn:true}};this.graph=new f(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new A.Label[z.Label.type](this);this.fx=new A.Plot(this,A);this.op=new A.Op(this);this.json=null;this.root=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var B=this.getRadius();var D=0,x=Math.max,y=this.config;this.graph.eachNode(function(E){D=x(E._depth,D)},"ignore");D++;var C=function(E){return function(G){G.scale=B;var I=G._depth+1;var H=0,F=Math.pow;while(I){H+=F(E,I--)}return H-y.offset}};for(var A=0.51;A<=1;A+=0.01){var z=(1-Math.pow(A,D))/(1-A);if(z>=2){return C(A-0.01)}}return C(0.75)},getRadius:function(){var x=this.config.radius;if(x!=="auto"){return x}var y=this.canvas.getSize();return Math.min(y.width,y.height)/2},refresh:function(x){if(x){this.reposition();this.graph.eachNode(function(y){y.startPos.rho=y.pos.rho=y.endPos.rho;y.startPos.theta=y.pos.theta=y.endPos.theta})}else{this.compute()}this.plot()},reposition:function(){this.compute("end");var x=this.graph.getNode(this.root).pos.getc().scale(-1);f.Util.moebiusTransformation(this.graph,[x],["end"],"end","ignore");this.graph.eachNode(function(y){if(y.ignore){y.endPos.rho=y.pos.rho;y.endPos.theta=y.pos.theta}})},plot:function(){this.fx.plot()},onClick:function(z,x){var y=this.graph.getNode(z).pos.getc(true);this.move(y,x)},move:function(B,z){var y=s(B.x,B.y);if(this.busy===false&&y.norm()<1){this.busy=true;var x=this.graph.getClosestNodeToPos(y),A=this;this.graph.computeLevels(x.id,0);this.controller.onBeforeCompute(x);z=d.merge({onComplete:d.empty},z||{});this.fx.animate(d.merge({modes:["moebius"],hideLabels:true},z,{onComplete:function(){A.busy=false;z.onComplete()}}),y)}}});$jit.Hypertree.$extend=true;(function(x){x.Op=new r({Implements:f.Op});x.Plot=new r({Implements:f.Plot});x.Label={};x.Label.Native=new r({Implements:f.Label.Native,initialize:function(y){this.viz=y},renderLabel:function(A,C,z){var y=A.getCtx();var D=C.pos.getc(true);var B=this.viz.getRadius();y.fillText(C.name,D.x*B,D.y*B)}});x.Label.SVG=new r({Implements:f.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(J,D,E){var H=D.pos.getc(true),A=this.viz.canvas,B=A.translateOffsetX,z=A.translateOffsetY,I=A.scaleOffsetX,G=A.scaleOffsetY,F=A.getSize(),y=this.viz.getRadius();var C={x:Math.round((H.x*I)*y+B+F.width/2),y:Math.round((H.y*G)*y+z+F.height/2)};J.setAttribute("x",C.x);J.setAttribute("y",C.y);E.onPlaceLabel(J,D)}});x.Label.HTML=new r({Implements:f.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(K,E,F){var I=E.pos.getc(true),B=this.viz.canvas,C=B.translateOffsetX,A=B.translateOffsetY,J=B.scaleOffsetX,H=B.scaleOffsetY,G=B.getSize(),y=this.viz.getRadius();var D={x:Math.round((I.x*J)*y+C+G.width/2),y:Math.round((I.y*H)*y+A+G.height/2)};var z=K.style;z.left=D.x+"px";z.top=D.y+"px";z.display=this.fitsInCanvas(D,B)?"":"none";F.onPlaceLabel(K,E)}});x.Plot.NodeTypes=new r({none:{render:d.empty,contains:d.lambda(false)},circle:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.circle.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.circle.contains(A,B,z)}},ellipse:{render:function(B,z){var C=B.pos.getc().$scale(B.scale),A=B.getData("width"),y=B.getData("height");this.nodeHelper.ellipse.render("fill",C,A,y,z)},contains:function(A,C){var z=A.getData("width"),y=A.getData("height"),B=A.pos.getc().$scale(A.scale);return this.nodeHelper.circle.contains(B,C,z,y)}},square:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.square.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.square.contains(A,B,z)}},rectangle:{render:function(C,z){var B=this.node,A=C.getData("width"),y=C.getData("height"),D=C.pos.getc();A=B.transform?A*(1-D.squaredNorm()):A;y=B.transform?y*(1-D.squaredNorm()):y;D.$scale(C.scale);if(A>0.2&&y>0.2){this.nodeHelper.rectangle.render("fill",D,A,y,z)}},contains:function(A,C){var z=A.getData("width"),y=A.getData("height"),B=A.pos.getc().$scale(A.scale);return this.nodeHelper.rectangle.contains(B,C,z,y)}},triangle:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.triangle.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.triangle.contains(A,B,z)}},star:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.star.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.star.contains(A,B,z)}}});x.Plot.EdgeTypes=new r({none:d.empty,line:{render:function(y,z){var C=y.nodeFrom.pos.getc(true),B=y.nodeTo.pos.getc(true),A=y.nodeFrom.scale;this.edgeHelper.line.render({x:C.x*A,y:C.y*A},{x:B.x*A,y:B.y*A},z)},contains:function(y,C){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true),z=y.nodeFrom.scale;this.edgeHelper.line.contains({x:B.x*z,y:B.y*z},{x:A.x*z,y:A.y*z},C,this.edge.epsilon)}},arrow:{render:function(z,A){var F=z.nodeFrom.pos.getc(true),E=z.nodeTo.pos.getc(true),B=z.nodeFrom.scale,D=z.getData("dim"),C=z.data.$direction,y=(C&&C.length>1&&C[0]!=z.nodeFrom.id);this.edgeHelper.arrow.render({x:F.x*B,y:F.y*B},{x:E.x*B,y:E.y*B},D,y,A)},contains:function(y,C){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true),z=y.nodeFrom.scale;this.edgeHelper.arrow.contains({x:B.x*z,y:B.y*z},{x:A.x*z,y:A.y*z},C,this.edge.epsilon)}},hyperline:{render:function(y,z){var C=y.nodeFrom.pos.getc(),B=y.nodeTo.pos.getc(),A=this.viz.getRadius();this.edgeHelper.hyperline.render(C,B,A,z)},contains:d.lambda(false)}})})($jit.Hypertree)})();