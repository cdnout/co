RGraph=window.RGraph||{isrgraph:!0,isRGraph:!0,rgraph:!0},RGraph.SVG=RGraph.SVG||{},window,document,RGraph.SVG.Pie=function(t){this.set=function(t,e){if(1===arguments.length&&"object"==typeof t)for(i in arguments[0])"string"==typeof i&&(t=a.name,e=a.value,this.set(t,e));else{var a=RGraph.SVG.commonSetter({object:this,name:t,value:e});t=a.name,e=a.value,this.properties[t]=e,"colors"===t&&(this.originalColors=RGraph.SVG.arrayClone(e),this.colorsParsed=!1)}return this},this.get=function(t){return this.properties[t]},t.data=RGraph.SVG.stringsToNumbers(t.data),this.id=t.id,this.uid=RGraph.SVG.createUID(),this.container=document.getElementById(this.id),this.layers={},this.svg=RGraph.SVG.createSVG({object:this,container:this.container}),this.isRGraph=!0,this.isrgraph=!0,this.rgraph=!0,this.width=Number(this.svg.getAttribute("width")),this.height=Number(this.svg.getAttribute("height")),this.data=t.data,this.type="pie",this.angles=[],this.colorsParsed=!1,this.originalColors={},this.gradientCounter=1,this.nodes=[],this.shadowNodes=[],this.firstDraw=!0,RGraph.SVG.OR.add(this),this.container.style.display="inline-block",this.properties={centerx:null,centery:null,radius:null,marginLeft:35,marginRight:35,marginTop:35,marginBottom:35,colors:["#f66","#6f6","#66f","#ff6","#6ff","#ccc","pink","orange","cyan","maroon","olive","teal"],colorsStroke:"rgba(0,0,0,0)",textColor:"black",textFont:"Arial, Verdana, sans-serif",textSize:12,textBold:!1,textItalic:!1,text:null,labels:[],labelsSticks:!0,labelsSticksOffset:50,labelsFormattedDecimals:0,labelsFormattedPoint:".",labelsFormattedThousand:",",labelsFormattedUnitsPre:"",labelsFormattedUnitsPost:"",linewidth:1,tooltips:null,tooltipsOverride:null,tooltipsEffect:"fade",tooltipsCssClass:"RGraph_tooltip",tooltipsCss:null,tooltipsEvent:"click",tooltipsFormattedThousand:",",tooltipsFormattedPoint:".",tooltipsFormattedDecimals:0,tooltipsFormattedUnitsPre:"",tooltipsFormattedUnitsPost:"",tooltipsFormattedKeyColors:null,tooltipsFormattedKeyColorsShape:"square",tooltipsFormattedKeyLabels:[],tooltipsFormattedTableHeaders:null,tooltipsFormattedTableData:null,tooltipsPointer:!0,tooltipsPositionStatic:!0,highlightStroke:"rgba(0,0,0,0)",highlightFill:"rgba(255,255,255,0.7)",highlightLinewidth:1,highlightStyle:"normal",highlightStyleOutlineWidth:7,title:"",titleX:null,titleY:null,titleHalign:"center",titleValign:null,titleSize:null,titleColor:null,titleFont:null,titleBold:null,titleItalic:null,titleSubtitle:null,titleSubtitleSize:null,titleSubtitleColor:"#aaa",titleSubtitleFont:null,titleSubtitleBold:null,titleSubtitleItalic:null,shadow:!1,shadowOffsetx:2,shadowOffsety:2,shadowBlur:2,shadowOpacity:.25,exploded:0,roundRobinMultiplier:1,donut:!1,donutWidth:75,key:null,keyColors:null,keyOffsetx:0,keyOffsety:0,keyLabelsOffsetx:0,keyLabelsOffsety:-1,keyLabelsColor:null,keyLabelsFont:null,keyLabelsSize:null,keyLabelsBold:null,keyLabelsItalic:null},RGraph.SVG.getGlobals(this),RGraph.SVG.FX&&"function"==typeof RGraph.SVG.FX.decorate&&RGraph.SVG.FX.decorate(this),this.responsive=RGraph.SVG.responsive,RGraph.SVG.addCreateFunction(this);var b=this.properties;for(i in this.draw=function(){if(RGraph.SVG.fireCustomEvent(this,"onbeforedraw"),this.angles=[],this.width=Number(this.svg.getAttribute("width")),this.height=Number(this.svg.getAttribute("height")),RGraph.SVG.createDefs(this),this.graphWidth=this.width-b.marginLeft-b.marginRight,this.graphHeight=this.height-b.marginTop-b.marginBottom,this.centerx=this.graphWidth/2+b.marginLeft,this.centery=this.graphHeight/2+b.marginTop,this.radius=Math.min(this.graphWidth,this.graphHeight)/2,this.centerx=("number"==typeof b.centerx?b:this).centerx,this.centery=("number"==typeof b.centery?b:this).centery,this.radius=("number"==typeof b.radius?b:this).radius,"string"==typeof b.radius&&b.radius.match(/^\+|-\d+$/)&&(this.radius+=parseFloat(b.radius)),"string"==typeof b.centerx&&b.centerx.match(/^\+|-\d+$/)&&(this.centerx+=parseFloat(b.centerx)),"string"==typeof b.centery&&b.centery.match(/^\+|-\d+$/)&&(this.centery+=parseFloat(b.centery)),RGraph.SVG.resetColorsToOriginalValues({object:this}),this.parseColors(),this.max=RGraph.SVG.arrayMax(this.data),this.total=RGraph.SVG.arraySum(this.data),"number"==typeof b.exploded&&0<b.exploded){var t=b.exploded;b.exploded=[];for(var e=0;e<this.data.length;++e)b.exploded[e]=t}if(this.drawSegments({shadow:!0}),RGraph.SVG.drawTitle(this),b.labels&&b.labels.length){"string"==typeof b.labels&&(b.labels=RGraph.SVG.arrayPad({array:[],length:this.data.length,value:b.labels}));for(e=0;e<b.labels.length;++e)b.labels[e]=RGraph.SVG.labelSubstitution({object:this,text:b.labels[e],index:e,value:this.data[e],decimals:b.labelsFormattedDecimals||0,unitsPre:b.labelsFormattedUnitsPre||"",unitsPost:b.labelsFormattedUnitsPost||"",thousand:b.labelsFormattedThousand||",",point:b.labelsFormattedPoint||"."})}b.labelsSticks?this.drawLabelsSticks():this.drawLabels(),this.drawIngraphLabels(),null!==typeof b.key&&RGraph.SVG.drawKey?RGraph.SVG.drawKey(this):RGraph.SVG.isNull(b.key)||alert("The drawKey() function does not exist - have you forgotten to include the key library?");var a=this;return document.body.addEventListener("mousedown",function(t){RGraph.SVG.removeHighlight(a)},!1),RGraph.SVG.addCustomText(this),this.firstDraw&&(this.firstDraw=!1,RGraph.SVG.fireCustomEvent(this,"onfirstdraw")),RGraph.SVG.fireCustomEvent(this,"ondraw"),this},this.drawSegments=function(t){for(var e=0,a=0,i=RGraph.SVG.arraySum(this.data),s=0,r=0,l=this.data.length;r<l;++r){var o=this.data[r]*b.roundRobinMultiplier,h=(e=a)+(s=o/i*RGraph.SVG.TRIG.TWOPI),n=RGraph.SVG.TRIG.getRadiusEndPoint({angle:e+s/2,r:b.exploded[r]}),d=n[1],n=n[0];this.angles[r]={start:e,end:h,angle:h-e,halfway:(h-e)/2+e,cx:this.centerx+(parseFloat(d)||0),cy:this.centery-(parseFloat(n)||0),radius:this.radius,object:this},a+=h-e}t.shadow&&RGraph.SVG.setShadow({object:this,offsetx:b.shadowOffsetx,offsety:b.shadowOffsety,blur:b.shadowBlur,opacity:b.shadowOpacity,id:"dropShadow"});for(r=0;r<this.angles.length;++r){var g,p,c=RGraph.SVG.TRIG.getArcPath({cx:this.angles[r].cx,cy:this.angles[r].cy,r:this.radius,start:this.angles[r].start,end:this.angles[r].end});c=b.donut?(p=b.donutWidth,g=RGraph.SVG.TRIG.getArcPath3({cx:this.angles[r].cx,cy:this.angles[r].cy,r:this.radius-p,start:this.angles[r].end,end:this.angles[r].start,moveto:!1,anticlockwise:!0}),p=RGraph.SVG.TRIG.getRadiusEndPoint({angle:this.angles[r].end-RGraph.SVG.TRIG.HALFPI,r:this.radius-p}),c+" L {1} {2} ".format(p[0]+this.angles[r].cx,p[1]+this.angles[r].cy)+g+" Z"):c+" L {1} {2} ".format(this.angles[r].cx,this.angles[r].cy)+" Z";var G=RGraph.SVG.create({svg:this.svg,parent:this.svg.all,type:"path",attr:{d:c,fill:b.colors[r],stroke:b.colorsStroke,"stroke-width":b.linewidth,"data-tooltip":!RGraph.SVG.isNull(b.tooltips)&&b.tooltips.length?b.tooltips[r]:"","data-index":r,"data-value":o,"data-start-angle":this.angles[r].start,"data-end-angle":this.angles[r].end,"data-radius":this.radius,filter:b.shadow&&t.shadow?"url(#dropShadow)":""}});this.angles[r].element=G,b.shadow&&t.shadow?this.shadowNodes[r]=G:this.nodes[r]=G,!b.tooltips||!b.tooltips[r]&&"string"!=typeof b.tooltips||t.shadow&&b.shadow||("mousemove"!==b.tooltipsEvent&&(b.tooltipsEvent="click"),function(a,i){G.addEventListener(b.tooltipsEvent,function(t){var e=RGraph.SVG.REG.get("tooltip");e&&"mousemove"===b.tooltipsEvent&&a===e.__index__||(i.removeHighlight(),RGraph.SVG.tooltip({object:i,index:a,sequentialIndex:a,text:"string"==typeof b.tooltips?b.tooltips:b.tooltips[a],event:t}),i.highlight(t.target),t=RGraph.SVG.REG.get("highlight"),"mousemove"===b.tooltipsEvent&&(t.style.cursor="pointer"))},!1),"click"===b.tooltipsEvent&&G.addEventListener("mousemove",function(t){t.target.style.cursor="pointer"},!1)}(r,this))}b.shadow&&t.shadow&&this.redrawSegments()},this.redrawSegments=function(){this.drawSegments({shadow:!1})},this.drawLabels=function(){for(var t=this.angles,e=b.labels,a=RGraph.SVG.getTextConf({object:this,prefix:"labels"}),i=0;i<t.length;++i){var s,r,l=RGraph.SVG.TRIG.getRadiusEndPoint({angle:t[i].halfway-RGraph.SVG.TRIG.HALFPI,r:t[i].radius+15}),o=l[0]+t[i].cx,l=l[1]+t[i].cy;0<t[i].halfway&&t[i].halfway<RGraph.SVG.TRIG.HALFPI?(r="left",s="bottom"):t[i].halfway>RGraph.SVG.TRIG.HALFPI&&t[i].halfway<RGraph.SVG.TRIG.PI?(r="left",s="top"):(t[i].halfway>RGraph.SVG.TRIG.PI&&t[i].halfway<RGraph.SVG.TRIG.HALFPI+RGraph.SVG.TRIG.PI||t[i].halfway>RGraph.SVG.TRIG.HALFPI+RGraph.SVG.TRIG.PI&&t[i].halfway<RGraph.SVG.TRIG.TWOPI)&&(r="right",s="top"),RGraph.SVG.text({object:this,parent:this.svg.all,tag:"labels",text:"string"==typeof e[i]?e[i]:"",x:o,y:l,valign:s,halign:r,font:a.font,size:a.size,bold:a.bold,italic:a.italic,color:a.color})}},this.drawIngraphLabels=function(){if(b.labelsIngraph)for(var t=RGraph.SVG.getTextConf({object:this,prefix:"labelsIngraph"}),e=0;e<this.angles.length;++e){var a=b.labelsIngraphHalign||"center",i=b.labelsIngraphValign||"center",s=b.labelsIngraphBackground||"transparent",r=b.labelsIngraphDecimals||0,l="string"==typeof b.labelsIngraphBackground?3:0,o=RGraph.SVG.TRIG.getRadiusEndPoint({angle:this.angles[e].halfway-RGraph.SVG.TRIG.HALFPI,r:this.angles[e].radius*("number"==typeof b.labelsIngraphRadiusPos?b.labelsIngraphRadiusPos:.5)});r="object"==typeof b.labelsIngraphSpecific&&b.labelsIngraphSpecific?"string"==typeof b.labelsIngraphSpecific[e]?b.labelsIngraphSpecific[e]:"":"function"==typeof b.labelsIngraphFormatter?b.labelsIngraphFormatter({object:this,number:this.data[e].toFixed(r)}):RGraph.SVG.numberFormat({prepend:b.labelsIngraphUnitsPre,append:b.labelsIngraphUnitsPost,point:b.labelsIngraphPoint,thousand:b.labelsIngraphThousand,num:this.data[e].toFixed(r),object:this}),RGraph.SVG.text({object:this,parent:this.svg.all,tag:"labels.ingraph",x:this.angles[e].cx+o[0],y:this.angles[e].cy+o[1],text:r,halign:a,valign:i,font:t.font,size:t.size,bold:t.bold,italic:t.italic,color:t.color,background:s,padding:l})}},this.drawLabelsSticks=function(){for(var t=[],e=[],a=[],i=0;i<this.angles.length;++i){var s=this.angles[i].start+(this.angles[i].end-this.angles[i].start)/2-RGraph.SVG.TRIG.HALFPI,r=RGraph.SVG.TRIG.getRadiusEndPoint({angle:s,r:this.radius+5}),l=RGraph.SVG.TRIG.getRadiusEndPoint({angle:s,r:this.radius+30}),o=["number"==typeof b.exploded?b.exploded:b.exploded[i],Math.cos(s)*("number"==typeof b.exploded?b.exploded:b.exploded[i]),Math.sin(s)*("number"==typeof b.exploded?b.exploded:b.exploded[i])];a[i]=[];var h,n,d,g={};s>RGraph.SVG.TRIG.HALFPI?(e[h=e.length]=[],e[h].text=b.labels[i],e[h].halign="right",g=e,a[i].halign="right"):(t[h=t.length]=[],t[h].text=b.labels[i],t[h].halign="right",g=t,a[i].halign="left"),r[0]+=o[1]||0,r[1]+=o[2]||0,l[0]+=o[1]||0,l[1]+=o[2]||0,(d=g[h].text?RGraph.SVG.create({svg:this.svg,parent:this.svg.all,type:"path",attr:{d:"M {1} {2} L {3} {4}".format(this.centerx+r[0],this.centery+r[1],this.centerx+l[0],this.centery+l[1]),stroke:"#999",fill:"rgba(0,0,0,0)"}}):d)&&(g[h].stick=d),G=this.centerx+l[0]+(1.57<s?-50:50),n=this.centery+l[1],a[i].x=G,a[i].y=n,a[i].text=b.labels[i]}for(var p=(this.height-b.marginTop-b.marginBottom)/t.length,c=(this.height-b.marginTop-b.marginBottom)/e.length,G=n=0,u=RGraph.SVG.getTextConf({object:this,prefix:"labels"}),i=0;i<t.length;++i)t[i]&&t[i].text&&(G=this.centerx+this.radius+b.labelsSticksOffset,n=b.marginTop+p*i+p/2,RGraph.SVG.text({object:this,parent:this.svg.all,tag:"labels.sticks",text:"string"==typeof t[i].text?t[i].text:"",x:G,y:n,valign:"center",halign:t[i].text,font:u.font,size:u.size,bold:u.bold,italic:u.italic,color:u.color}),f=t[i].stick.getAttribute("d").replace(/ L /," Q ")+" {1} {2}",t[i].stick.setAttribute("d",f.format(G-5,n)));for(var f,i=0;i<e.length;++i)e[i]&&e[i].text&&(G=this.centerx-this.radius-b.labelsSticksOffset,n=this.height-(b.marginTop+c*i+c/2),RGraph.SVG.text({object:this,parent:this.svg.all,tag:"labels.sticks",text:"string"==typeof e[i].text?e[i].text:"",x:G-7,y:n,valign:"center",halign:e[i].halign,font:u.font,size:u.size,bold:u.bold,italic:u.italic,color:u.color}),f=e[i].stick.getAttribute("d").replace(/ L /," Q ")+" {1} {2}",e[i].stick.setAttribute("d",f.format(G-5,n)))},this.highlight=function(t){var e,a,i;i="outline"===b.highlightStyle?(e=t.getAttribute("data-index"),a=RGraph.SVG.TRIG.getArcPath3({start:this.angles[e].start,end:this.angles[e].end,cx:this.angles[e].cx,cy:this.angles[e].cy,r:this.angles[e].radius+2,anticlockwise:!1,lineto:!1}),a+=RGraph.SVG.TRIG.getArcPath3({start:this.angles[e].end,end:this.angles[e].start,cx:this.angles[e].cx,cy:this.angles[e].cy,r:this.angles[e].radius+2+b.highlightStyleOutlineWidth,anticlockwise:!0}),RGraph.SVG.create({svg:this.svg,parent:this.svg.all,type:"path",attr:{d:a,fill:b.colors[e],stroke:"transparent"},style:{pointerEvents:"none"}})):RGraph.SVG.create({svg:this.svg,parent:this.svg.all,type:"path",attr:{d:t.getAttribute("d"),fill:b.highlightFill,stroke:b.highlightStroke,"stroke-width":b.highlightLinewidth},style:{pointerEvents:"none"}}),"mousemove"===b.tooltipsEvent&&i.addEventListener("mouseout",function(t){i.parentNode.removeChild(i),RGraph.SVG.hideTooltip(),RGraph.SVG.REG.set("highlight",null)},!1),RGraph.SVG.REG.set("highlight",i)},this.parseColors=function(){Object.keys(this.originalColors).length||(this.originalColors={colors:RGraph.SVG.arrayClone(b.colors),highlightFill:RGraph.SVG.arrayClone(b.highlightFill)});var t=b.colors;if(t)for(var e=0;e<t.length;++e)t[e]=RGraph.SVG.parseColorRadial({object:this,color:t[e]});b.highlightFill=RGraph.SVG.parseColorRadial({object:this,color:b.highlightFill})},this.roundrobin=this.roundRobin=function(){var o=this,t=arguments[0]||{},h=(RGraph.SVG.arrayClone(this.data),1),n=t.frames||30,d="function"==typeof t.callback?t.callback:function(){},g=(RGraph.SVG.arraySum(this.data),b.textColor),p=b.labelsIngraph,c=0;b.textColor="rgba(0,0,0,0)",b.labelsIngraph=!1,o.draw();var G=RGraph.SVG.arrayClone(this.angles);return function t(){c=1/n*h++;for(var e=0;e<G.length;++e){o.data[e],o.angles[e].start=G[e].start*c,o.angles[e].end=G[e].end*c;var a,i=(o.angles[e].end-o.angles[e].start)/2,s=Math.cos(o.angles[e].start+i-RGraph.SVG.TRIG.HALFPI)*(b.exploded[e]||0),r=Math.sin(o.angles[e].start+i-RGraph.SVG.TRIG.HALFPI)*(b.exploded[e]||0),l=RGraph.SVG.TRIG.getArcPath({cx:o.centerx+s,cy:o.centery+r,r:o.radius,start:o.angles[e].start,end:o.angles[e].end});l=b.donut?(a=b.donutWidth,i=RGraph.SVG.TRIG.getArcPath3({cx:o.angles[e].cx,cy:o.angles[e].cy,r:o.radius-a,start:o.angles[e].end,end:o.angles[e].start,moveto:!1,anticlockwise:!0}),a=RGraph.SVG.TRIG.getRadiusEndPoint({angle:o.angles[e].end-RGraph.SVG.TRIG.HALFPI,r:o.radius-a}),l+" L {1} {2} ".format(a[0]+o.angles[e].cx,a[1]+o.angles[e].cy)+i+" Z"):l+" L {1} {2} ".format(o.angles[e].cx,o.angles[e].cy)+" Z",l+=" L {1} {2} Z".format(o.centerx+s,o.centery+r),o.shadowNodes&&o.shadowNodes[e]&&o.shadowNodes[e].setAttribute("d",l),o.nodes[e].setAttribute("d",l)}h<=n?RGraph.SVG.FX.update(t):(b.textColor=g,b.labelsIngraph=p,RGraph.SVG.redraw(o.svg),d(o))}(),this},this.on=function(t,e){return"on"!==t.substr(0,2)&&(t="on"+t),RGraph.SVG.addCustomEventListener(this,t,e),this},this.exec=function(t){return t(this),this},this.removeHighlight=function(){var t=RGraph.SVG.REG.get("highlight");t&&t.parentNode&&t.parentNode.removeChild(t),RGraph.SVG.REG.set("highlight",null)},this.tooltipSubstitutions=function(t){return{index:t.index,dataset:0,sequentialIndex:t.index,value:this.data[t.index],values:[this.data[t.index]]}},this.tooltipsFormattedCustom=function(t,e,a){a=a[t.index];return{label:"object"==typeof b.tooltipsFormattedKeyLabels&&"string"==typeof b.tooltipsFormattedKeyLabels[t.index]?b.tooltipsFormattedKeyLabels[t.index]:"",color:a}},this.positionTooltipStatic=function(t){var e=t.object,a=(t.event,t.tooltip),i=t.index,s=RGraph.SVG.getSVGXY(e.svg),r=this.angles[t.index].halfway;e=b.donut?this.radius-b.donutWidth+b.donutWidth/2:.5*this.radius,b.exploded[i]&&(e+=b.exploded[i]);e=RGraph.SVG.TRIG.getRadiusEndPoint({angle:r-RGraph.SVG.TRIG.HALFPI,r:e});t.tooltip.style.left=s[0]+this.centerx+e[0]-a.offsetWidth/2+"px",t.tooltip.style.top=s[1]+this.centery+e[1]-a.offsetHeight-10+"px"},t.options)"string"==typeof i&&this.set(i,t.options[i])};