RGraph=window.RGraph||{isrgraph:!0,isRGraph:!0,rgraph:!0},RGraph.Funnel=function(t){var e=t.id,i=document.getElementById(e),o=t.data;if(this.id=e,this.canvas=i,this.context=this.canvas.getContext?this.canvas.getContext("2d",{alpha:"object"!=typeof e||!1!==e.alpha}):null,(this.canvas.__object__=this).type="funnel",this.coords=[],this.isRGraph=!0,this.isrgraph=!0,this.rgraph=!0,this.uid=RGraph.createUID(),this.canvas.uid=this.canvas.uid||RGraph.createUID(),this.coordsText=[],this.original_colors=[],this.firstDraw=!0,this.canvas){this.properties={colorsStroke:"rgba(0,0,0,0)",colors:["red","green","gray","black","pink","orange","blue","yellow","green","red"],marginLeft:35,marginRight:35,marginTop:35,marginBottom:35,labels:null,labelsFont:null,labelsSize:null,labelsColor:null,labelsBold:null,labelsItalic:null,labelsSticks:!1,labelsX:null,labelsPosition:"edge",labelsOffsetx:0,labelsOffsety:0,labelsFormattedDecimals:0,labelsFormattedPoint:".",labelsFormattedThousand:",",labelsFormattedUnitsPre:"",labelsFormattedUnitsPost:"",title:"",titleBackground:null,titleHpos:null,titleVpos:null,titleItalic:null,titleBold:null,titleFont:null,titleSize:null,titleColor:null,titleX:null,titleY:null,titleHalign:null,titleValign:null,titleOffsetx:0,titleOffsety:0,textSize:12,textColor:"black",textFont:"Arial, Verdana, sans-serif",textBold:!1,textItalic:!1,textHalign:"left",textAccessible:!0,textAccessibleOverflow:"visible",textAccessiblePointerevents:!1,text:null,contextmenu:null,shadow:!1,shadowColor:"#666",shadowBlur:3,shadowOffsetx:3,shadowOffsety:3,key:null,keyBackground:"white",keyPosition:"graph",keyHalign:"right",keyShadow:!1,keyShadowColor:"#666",keyShadowBlur:3,keyShadowOffsetx:2,keyShadowOffsety:2,keyPositionMarginBoxed:!1,keyPositionX:null,keyPositionY:null,keyColorShape:"square",keyRounded:!0,keyLinewidth:1,keyColors:null,keyInteractive:!1,keyInteractiveHighlightChartStroke:"black",keyInteractiveHighlightChartFill:"rgba(255,255,255,0.7)",keyInteractiveHighlightLabel:"rgba(255,0,0,0.2)",keyLabelsFont:null,keyLabelsSize:null,keyLabelsColor:null,keyLabelsBold:null,keyLabelsItalic:null,keyLabelsOffsetx:0,keyLabelsOffsety:0,tooltipsHighlight:!0,tooltips:null,tooltipsEffect:"slide",tooltipsCssClass:"RGraph_tooltip",tooltipsCss:null,tooltipsEvent:"onclick",tooltipsFormattedThousand:",",tooltipsFormattedPoint:".",tooltipsFormattedDecimals:0,tooltipsFormattedUnitsPre:"",tooltipsFormattedUnitsPost:"",tooltipsFormattedKeyColors:null,tooltipsFormattedKeyColorsShape:"square",tooltipsFormattedKeyLabels:[],tooltipsFormattedListType:"ul",tooltipsFormattedListItems:null,tooltipsFormattedTableHeaders:null,tooltipsFormattedTableData:null,tooltipsPointer:!0,tooltipsPositionStatic:!0,highlightStroke:"rgba(0,0,0,0)",highlightFill:"rgba(255,255,255,0.7)",annotatable:!1,annotatableColor:"black",resizable:!1,resizableHandleBackground:null,clearto:"rgba(0,0,0,0)"},o=RGraph.stringsToNumbers(o),this.data=o;for(var f=0;f<o.length;++f)this["$"+f]={};var u=this.properties;this.path=RGraph.pathObjectFunction,RGraph.Effects&&"function"==typeof RGraph.Effects.decorate&&RGraph.Effects.decorate(this),this.responsive=RGraph.responsive,this.set=function(t){var e=void 0===arguments[1]?null:arguments[1];if(1!==arguments.length||"object"!=typeof t)return u[t]=e,this;for(f in t)"string"==typeof f&&this.set(f,t[f]);return this},this.get=function(t){return u[t]},this.draw=function(){return RGraph.fireCustomEvent(this,"onbeforedraw"),this.canvas.__rgraph_aa_translated__||(this.context.translate(.5,.5),this.canvas.__rgraph_aa_translated__=!0),this.colorsParsed||(this.parseColors(),this.colorsParsed=!0),this.marginLeft=u.marginLeft,this.marginRight=u.marginRight,this.marginTop=u.marginTop,this.marginBottom=u.marginBottom,this.coords=[],this.coordsText=[],RGraph.drawTitle(this,u.title,this.marginTop,null,"number"==typeof u.titleSize?u.titleSize:u.textSize),this.drawFunnel(),u.contextmenu&&RGraph.showContext(this),this.drawLabels(),RGraph.addCustomText(this),RGraph.installEventListeners(this),this.firstDraw&&(this.firstDraw=!1,RGraph.fireCustomEvent(this,"onfirstdraw"),this.firstDrawFunc()),RGraph.fireCustomEvent(this,"ondraw"),this},this.exec=function(t){return t(this),this},this.drawFunnel=function(){var t=this.canvas.width-this.marginLeft-this.marginRight,e=this.canvas.height-this.marginTop-this.marginBottom,i=RGraph.arrayMax(this.data),o=this.marginTop;for(u.shadow&&(this.context.shadowColor=u.shadowColor,this.context.shadowBlur=u.shadowBlur,this.context.shadowOffsetX=u.shadowOffsetx,this.context.shadowOffsetY=u.shadowOffsety),f=0,len=this.data.length;f<len;++f){var s=this.data[0],l=this.data[f],a=e/(this.data.length-1),r=l/i*t/2,n=this.data[f+1],h=this.data[f+1]?n/i*t:null,c=h/2,d=this.marginLeft+s/i*t/2,g=d-r,p=o,l=d+r,n=o,s=d+c,r=o+a,d=d-c,c=o+a;h&&f<this.data.length-1&&(this.context.beginPath(),this.context.strokeStyle=u.colorsStroke,this.context.fillStyle=u.colors[f],this.context.moveTo(g,p),this.context.lineTo(l,n),this.context.lineTo(s,r),this.context.lineTo(d,c),this.context.closePath(),this.coords.push([g,p,l,n,s,r,d,c])),u.shadow||this.context.stroke(),this.context.fill(),o+=a}if(u.shadow)for(RGraph.noShadow(this),f=0;f<this.coords.length;++f)this.context.strokeStyle=u.colorsStroke,this.context.fillStyle=u.colors[f],this.context.beginPath(),this.context.moveTo(this.coords[f][0],this.coords[f][1]),this.context.lineTo(this.coords[f][2],this.coords[f][3]),this.context.lineTo(this.coords[f][4],this.coords[f][5]),this.context.lineTo(this.coords[f][6],this.coords[f][7]),this.context.closePath(),this.context.stroke(),this.context.fill();u.key&&u.key.length&&RGraph.drawKey(this,u.key,u.colors)},this.drawLabels=function(){if(u.labels&&u.labels.length){"string"==typeof u.labels&&(u.labels=RGraph.arrayPad({array:[],length:this.coords.length+1,value:u.labels}));for(var t=0;t<u.labels.length;++t)u.labels[t]=RGraph.labelSubstitution({object:this,text:u.labels[t],index:t,value:this.data[t],decimals:u.labelsFormattedDecimals||0,unitsPre:u.labelsFormattedUnitsPre||"",unitsPost:u.labelsFormattedUnitsPost||"",thousand:u.labelsFormattedThousand||",",point:u.labelsFormattedPoint||"."})}if(!RGraph.isNull(u.labels)&&"object"==typeof u.labels&&0<u.labels.length){var e,i=u.textFont,o=(u.textSize,u.textColor),s=u.labels,l="left"==u.textHalign?"left":"center",a=RGraph.getTextConf({object:this,prefix:"labels"});e="number"==typeof u.labelsX?u.labelsX:"left"==l?this.marginLeft-15:(this.canvas.width-this.marginLeft-this.marginRight)/2+this.marginLeft;for(var r,n=0;n<this.coords.length;++n){this.context.beginPath(),this.path("ss black fs %",o),RGraph.noShadow(this),r="section"===u.labelsPosition?this.coords[n][1]+(this.coords[n][5]-this.coords[n][3])/2:this.coords[n][1];RGraph.text({object:this,font:a.font,size:a.size,color:a.color,bold:a.bold,italic:a.italic,x:e+u.labelsOffsetx,y:r+u.labelsOffsety,text:s[n]||"",valign:"center",halign:l,bounding:!0,boundingFill:"rgba(255,255,255,0.7)",boundingStroke:"rgba(0,0,0,0)",tag:"labels",cssClass:RGraph.getLabelsCSSClassName({object:this,name:"labelsClass",index:n})});u.labelsSticks&&s[n]&&(this.context.font=a.size+"pt "+i,h=this.context.measureText(s[n]).width,this.path("b m % % l % % s gray",e+h+10,r,("section"===u.labelsPosition?this.coords[n][0]+(this.coords[n][6]-this.coords[n][0])/2:this.coords[n][0])-10,r))}var h,c=s[n];c&&"edge"===u.labelsPosition&&(RGraph.text({object:this,font:a.font,size:a.size,color:a.color,bold:a.bold,italic:a.italic,x:e+u.labelsOffsetx,y:this.coords[n-1][5]+u.labelsOffsety,text:c,valign:"center",halign:l,bounding:!0,boundingFill:"rgba(255,255,255,0.7)",boundingStroke:"rgba(0,0,0,0)",tag:"labels",cssClass:RGraph.getLabelsCSSClassName({object:this,name:"labelsClass",index:n})}),u.labelsSticks&&(this.context.font=a.size+"pt "+i,h=this.context.measureText(c).width,this.path("b m % % l % % s gray",e+h+10,Math.round(this.coords[n-1][7]),this.coords[n-1][6]-10,Math.round(this.coords[n-1][7]))))}},this.getShape=function(t){var e=this.coords,t=RGraph.getMouseXY(t),i=t[0],o=t[1];for(f=0,len=e.length;f<len;++f){var s,l=e[f];if(this.context.beginPath(),this.context.moveTo(l[0],l[1]),this.context.lineTo(l[2],l[3]),this.context.lineTo(l[4],l[5]),this.context.lineTo(l[6],l[7]),this.context.lineTo(l[8],l[9]),this.context.isPointInPath(i,o))return RGraph.parseTooltipText&&u.tooltips&&(s=RGraph.parseTooltipText(u.tooltips,f)),{object:this,coords:l,dataset:0,index:f,sequentialIndex:f,label:u.labels&&"string"==typeof u.labels[f]?u.labels[f]:null,tooltip:"string"==typeof s?s:null}}return null},this.highlight=function(t){if(u.tooltipsHighlight)if("function"!=typeof u.highlightStyle)if("string"!=typeof u.highlightStyle||"invert"!==u.highlightStyle){e=t.coords;this.path("b m % % l % % l % % l % % c s % f %",e[0]-.5,e[1]-.5,e[2]+.5,e[3]-.5,e[4]+.5,e[5]+.5,e[6]-.5,e[7]+.5,u.highlightStroke,u.highlightFill)}else for(var e,i=0;i<this.coords.length;++i)i!==t.sequentialIndex&&(e=this.coords[i],this.path("b m % % l % % l % % l % % c s % f %",e[0]-.5,e[1]-.5,e[2]+.5,e[3]-.5,e[4]+.5,e[5]+.5,e[6]-.5,e[7]+.5,u.highlightStroke,u.highlightFill));else u.highlightStyle(t)},this.getObjectByXY=function(t){t=RGraph.getMouseXY(t);if(t[0]>u.marginLeft&&t[0]<this.canvas.width-u.marginRight&&t[1]>u.marginTop&&t[1]<this.canvas.height-u.marginBottom)return this},this.parseColors=function(){0===this.original_colors.length&&(this.original_colors.colors=RGraph.arrayClone(u.colors),this.original_colors.keyColors=RGraph.arrayClone(u.keyColors),this.original_colors.highlightFill=RGraph.arrayClone(u.highlightFill),this.original_colors.highlightStroke=RGraph.arrayClone(u.highlightStroke),this.original_colors.colorsStroke=RGraph.arrayClone(u.colorsStroke));for(var t=u.colors,e=0;e<t.length;++e)t[e]=this.parseSingleColorForHorizontalGradient(t[e]);var i=u.keyColors;if(i)for(e=0;e<i.length;++e)i[e]=this.parseSingleColorForHorizontalGradient(i[e]);u.colorsStroke=this.parseSingleColorForVerticalGradient(u.colorsStroke),u.highlightStroke=this.parseSingleColorForHorizontalGradient(u.highlightStroke),u.highlightFill=this.parseSingleColorForHorizontalGradient(u.highlightFill)},this.reset=function(){},this.parseSingleColorForHorizontalGradient=function(t){if(!t||"string"!=typeof t)return t;if(t.match(/^gradient\((.*)\)$/i)){if(t.match(/^gradient\(({.*})\)$/i))return RGraph.parseJSONGradient({object:this,def:RegExp.$1});var e=RegExp.$1.split(":"),i=this.context.createLinearGradient(u.marginLeft,0,this.canvas.width-u.marginRight,0),o=1/(e.length-1);i.addColorStop(0,RGraph.trim(e[0]));for(var s=1;s<e.length;++s)i.addColorStop(s*o,RGraph.trim(e[s]))}return i||t},this.parseSingleColorForVerticalGradient=function(t){if(!t||"string"!=typeof t)return t;if(t.match(/^gradient\((.*)\)$/i)){var e=RegExp.$1.split(":"),i=this.context.createLinearGradient(0,u.marginTop,0,this.canvas.height-u.marginBottom),o=1/(e.length-1);i.addColorStop(0,RGraph.trim(e[0]));for(var s=1;s<e.length;++s)i.addColorStop(s*o,RGraph.trim(e[s]))}return i||t},this.interactiveKeyHighlight=function(t){var e=this.coords[t];e&&8==e.length&&(t=this.context.lineWidth,this.context.lineWidth=2,this.context.strokeStyle=u.keyInteractiveHighlightChartStroke,this.context.fillStyle=u.keyInteractiveHighlightChartFill,this.context.beginPath(),this.context.moveTo(e[0]-.5,e[1]-.5),this.context.lineTo(e[2]+.5,e[3]-.5),this.context.lineTo(e[4]+.5,e[5]+.5),this.context.lineTo(e[6]-.5,e[7]+.5),this.context.closePath(),this.context.fill(),this.context.stroke(),this.context.lineWidth=t)},this.on=function(t,e){return"function"!=typeof this[t="on"!==t.substr(0,2)?"on"+t:t]?this[t]=e:RGraph.addCustomEventListener(this,t,e),this},this.firstDrawFunc=function(){},this.tooltipSubstitutions=function(t){return{index:t.index,dataset:0,sequentialIndex:t.index,value:this.data[t.index],values:[this.data[t.index]]}},this.tooltipsFormattedCustom=function(t,e){var i=u.colors[t.index];return{label:RGraph.isString(u.tooltipsFormattedKeyLabels[t.index])?u.tooltipsFormattedKeyLabels[t.index]:"",color:i=!RGraph.isNull(u.tooltipsFormattedKeyColors)&&"object"==typeof u.tooltipsFormattedKeyColors&&"string"==typeof u.tooltipsFormattedKeyColors[t.index]?u.tooltipsFormattedKeyColors[t.index]:i}},this.positionTooltipStatic=function(t){var e=t.object,i=(t.event,t.tooltip),o=(t.index,RGraph.getCanvasXY(e.canvas));coords=this.coords[t.index],t.tooltip.style.left=o[0]+((coords[2]-coords[0])/2+coords[0])-i.offsetWidth/2+e.properties.tooltipsOffsetx+"px",t.tooltip.style.top=o[1]+coords[1]-i.offsetHeight+e.properties.tooltipsOffsety-10+"px",parseFloat(t.tooltip.style.top)<0&&(t.tooltip.style.top=parseFloat(t.tooltip.style.top)+20+"px")},RGraph.register(this),RGraph.parseObjectStyleConfig(this,t.options)}else alert("[FUNNEL] No canvas support")};