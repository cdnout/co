RGraph=window.RGraph||{isrgraph:!0,isRGraph:!0,rgraph:!0},RGraph.SVG=RGraph.SVG||{},window,document,RGraph.SVG.Funnel=function(t){this.set=function(t,e){if(1===arguments.length&&"object"==typeof t)for(i in arguments[0])"string"==typeof i&&(t=o.name,e=o.value,this.set(t,e));else{var o=RGraph.SVG.commonSetter({object:this,name:t,value:e});t=o.name,e=o.value,this.properties[t]=e,"colors"===t&&(this.originalColors=RGraph.SVG.arrayClone(e),this.colorsParsed=!1)}return this},this.get=function(t){return this.properties[t]},t.data=RGraph.SVG.stringsToNumbers(t.data),this.id=t.id,this.uid=RGraph.SVG.createUID(),this.container=document.getElementById(this.id),this.layers={},this.svg=RGraph.SVG.createSVG({object:this,container:this.container}),this.isRGraph=!0,this.isrgraph=!0,this.rgraph=!0,this.width=Number(this.svg.getAttribute("width")),this.height=Number(this.svg.getAttribute("height")),this.data=RGraph.SVG.arrayClone(t.data),this.originalData=RGraph.SVG.arrayClone(t.data),this.type="funnel",this.coords=[],this.colorsParsed=!1,this.originalColors={},this.gradientCounter=1,this.nodes=[],this.shadowNodes=[],this.max=0,this.redraw=!1,this.highlight_node=null,this.firstDraw=!0,RGraph.SVG.OR.add(this),this.container.style.display="inline-block";var o=this;this.data.forEach(function(t,i,e){o.max=Math.max(o.max,t)}),this.properties={marginLeft:35,marginRight:35,marginTop:35,marginBottom:35,backgroundBars:!1,backgroundBarsOpacity:.25,backgroundBarsColors:null,colorsStroke:"white",colors:["red","black","orange","green","#6ff","#ccc","pink","orange","cyan","maroon","olive","teal"],textColor:"black",textFont:"Arial, Verdana, sans-serif",textSize:12,textBold:!1,textItalic:!1,text:null,labels:[],labelsFont:null,labelsSize:null,labelsColor:null,labelsBold:null,labelsItalic:null,labelsBackground:null,labelsHalign:"center",labelsPosition:"section",labelsFormattedDecimals:0,labelsFormattedPoint:".",labelsFormattedThousand:",",labelsFormattedUnitsPre:"",labelsFormattedUnitsPost:"",linewidth:1,tooltips:null,tooltipsOverride:null,tooltipsEffect:"fade",tooltipsCssClass:"RGraph_tooltip",tooltipsCss:null,tooltipsEvent:"click",tooltipsFormattedThousand:",",tooltipsFormattedPoint:".",tooltipsFormattedDecimals:0,tooltipsFormattedUnitsPre:"",tooltipsFormattedUnitsPost:"",tooltipsFormattedKeyColors:null,tooltipsFormattedKeyColorsShape:"square",tooltipsFormattedKeyLabels:[],tooltipsFormattedTableHeaders:null,tooltipsFormattedTableData:null,tooltipsPointer:!0,tooltipsPositionStatic:!0,highlightStroke:"rgba(0,0,0,0)",highlightFill:"rgba(255,255,255,0.7)",highlightLinewidth:1,title:"",titleX:null,titleY:null,titleHalign:"center",titleValign:null,titleSize:null,titleColor:null,titleFont:null,titleBold:null,titleItalic:null,titleSubtitle:null,titleSubtitleSize:null,titleSubtitleColor:"#aaa",titleSubtitleFont:null,titleSubtitleBold:null,titleSubtitleItalic:null,key:null,keyColors:null,keyOffsetx:0,keyOffsety:0,keyLabelsOffsetx:0,keyLabelsOffsety:-1,keyLabelsFont:null,keyLabelsSize:null,keyLabelsColor:null,keyLabelsBold:null,keyLabelsItalic:null},RGraph.SVG.getGlobals(this),RGraph.SVG.FX&&"function"==typeof RGraph.SVG.FX.decorate&&RGraph.SVG.FX.decorate(this),this.responsive=RGraph.SVG.responsive,RGraph.SVG.addCreateFunction(this);var c=this.properties;for(i in this.draw=function(){RGraph.SVG.fireCustomEvent(this,"onbeforedraw"),this.width=Number(this.svg.getAttribute("width")),this.height=Number(this.svg.getAttribute("height")),this.data=RGraph.SVG.arrayClone(this.originalData),this.coords=[],RGraph.SVG.createDefs(this),this.graphWidth=this.width-c.marginLeft-c.marginRight,this.graphHeight=this.height-c.marginTop-c.marginBottom;for(var t=0,i=this.data.length;t<i;++t)"string"==typeof this.data[t]&&(this.data[t]=RGraph.SVG.stringsToNumbers(this.data[t]));RGraph.SVG.resetColorsToOriginalValues({object:this}),this.parseColors(),this.drawFunnel(),this.drawBackgroundBars(),this.drawLabels(),RGraph.SVG.drawTitle(this),null!==typeof c.key&&RGraph.SVG.drawKey?RGraph.SVG.drawKey(this):RGraph.SVG.isNull(c.key)||alert("The drawKey() function does not exist - have you forgotten to include the key library?");var e=this;return document.body.addEventListener("mousedown",function(t){e.hideHighlight(e)},!1),RGraph.SVG.addCustomText(this),this.firstDraw&&(this.firstDraw=!1,RGraph.SVG.fireCustomEvent(this,"onfirstdraw")),RGraph.SVG.fireCustomEvent(this,"ondraw"),this},this.drawFunnel=function(t){for(var i=c.marginLeft+this.graphWidth/2,e=0;e<this.data.length-1;++e){var o=this.data[e],a=this.data[e+1],l=(this.graphWidth,o/this.max*this.graphWidth),s=this.graphHeight/(this.data.length-1),r=a/this.max*this.graphWidth,h=i-l/2,o=c.marginTop+s*e,a=i+l/2,l=c.marginTop+s*e;x3=i+r/2,y3=c.marginTop+s*(e+1),x4=i-r/2,y4=c.marginTop+s*(e+1),this.coords.push({x1:h,y1:o,x2:a,y2:l,x3:x3,y3:y3,x4:x4,y4:y4,widthTop:a-h,widthBottom:x3-x4,height:y3-l,object:this})}for(var n,g,d,e=0,p=this.coords.length,u=0;e<p;++e,++u)e<p&&(n=this.coords[e],g=RGraph.SVG.create({svg:this.svg,type:"path",parent:this.svg.all,attr:{d:"M {1} {2} L {3} {4} L {5} {6} L {7} {8} z".format(n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4),stroke:c.colorsStroke,fill:c.colors[e],"stroke-width":c.linewidth,"data-value":this.data[e],"data-index":e}}),n.element=g,RGraph.SVG.isNull(c.tooltips)||!c.tooltips[e]&&"string"!=typeof c.tooltips||(d=this,function(i,e){g.addEventListener(c.tooltipsEvent.replace(/^on/,""),function(t){d.removeHighlight(),RGraph.SVG.tooltip({object:d,index:i,group:null,sequentialIndex:e,text:"string"==typeof c.tooltips?c.tooltips:c.tooltips[e],event:t}),d.highlight(t.target)},!1),g.addEventListener("mousemove",function(t){t.target.style.cursor="pointer"},!1)}(e,u)))},this.redrawFunnel=function(){},this.drawBackgroundBars=function(){if(c.backgroundBars)for(var t=0;t<this.coords.length;++t){var i=this.coords[t];RGraph.SVG.create({svg:this.svg,type:"rect",parent:this.layers.background1,attr:{x:0,y:i.y1,width:this.width,height:i.y3-i.y2,fill:(c.backgroundBarsColors&&"object"==typeof c.backgroundBarsColors&&"string"==typeof c.backgroundBarsColors[t]?c.backgroundBarsColors:c.colors)[t],"fill-opacity":c.backgroundBarsOpacity}})}},this.drawLabels=function(){if(c.labels&&c.labels.length){"string"==typeof c.labels&&(c.labels=RGraph.SVG.arrayPad({array:[],length:this.coords.length+1,value:c.labels}));for(var t=0;t<c.labels.length;++t)c.labels[t]=RGraph.SVG.labelSubstitution({object:this,text:c.labels[t],index:t,value:this.data[t],decimals:c.labelsFormattedDecimals||0,unitsPre:c.labelsFormattedUnitsPre||"",unitsPost:c.labelsFormattedUnitsPost||"",thousand:c.labelsFormattedThousand||",",point:c.labelsFormattedPoint||"."})}var i,e,o=RGraph.SVG.create({svg:this.svg,parent:this.svg.all,type:"g"}),a=RGraph.SVG.getTextConf({object:this,prefix:"labels"});if(e="left"===c.labelsHalign?(i=15,"left"):"right"===c.labelsHalign?(i=this.width-15,"right"):(i=this.width/2,"center"),c.labels&&c.labels.length)if("section"===c.labelsPosition)for(var l=this.graphHeight/c.labels.length,t=0;t<c.labels.length;++t)RGraph.SVG.text({object:this,svg:this.svg,parent:o,tag:"labels",text:"string"==typeof c.labels[t]||"number"===c.labels[t]?c.labels[t].toString():"",x:i,y:c.marginTop+l/2+t*l,halign:e,valign:"center",background:c.labelsBackground||"rgba(255,255,255,0.5)",padding:2,color:a.color,size:a.size,bold:a.bold,italic:a.italic,font:a.font});else for(t=0;t<c.labels.length;++t)RGraph.SVG.text({object:this,svg:this.svg,parent:o,tag:"labels",text:"string"==typeof c.labels[t]||"number"===c.labels[t]?c.labels[t].toString():"",x:i,y:c.marginTop+this.graphHeight/(c.labels.length-1)*t,halign:e,valign:"center",background:c.labelsBackground||"rgba(255,255,255,0.5)",padding:2,size:a.size,bold:a.bold,italic:a.italic,color:a.color,font:a.font})},this.highlight=function(t){var t=t.getAttribute("d"),i=RGraph.SVG.create({svg:this.svg,parent:this.svg.all,type:"path",attr:{d:t,fill:c.highlightFill,stroke:c.highlightStroke,"stroke-width":c.highlightLinewidth},style:{pointerEvents:"none"}});"mousemove"===c.tooltipsEvent&&i.addEventListener("mouseout",function(t){i.parentNode.removeChild(i),RGraph.SVG.hideTooltip(),RGraph.SVG.REG.set("highlight",null)},!1),RGraph.SVG.REG.set("highlight",i)},this.parseColors=function(){Object.keys(this.originalColors).length||(this.originalColors={colors:RGraph.SVG.arrayClone(c.colors),highlightFill:RGraph.SVG.arrayClone(c.highlightFill),backgroundBarsColors:RGraph.SVG.arrayClone(c.backgroundBarsColors)});var t=c.colors;if(t)for(var i=0;i<t.length;++i)t[i]=RGraph.SVG.parseColorLinear({object:this,color:t[i],direction:"horizontal"});if(c.backgroundBarsColors&&c.backgroundBarsColors.length)for(i=0;i<c.backgroundBarsColors.length;++i)c.backgroundBarsColors[i]=RGraph.SVG.parseColorLinear({object:this,color:c.backgroundBarsColors[i],direction:"horizontal"});c.highlightFill=RGraph.SVG.parseColorLinear({object:this,color:c.highlightFill})},this.on=function(t,i){return"on"!==t.substr(0,2)&&(t="on"+t),RGraph.SVG.addCustomEventListener(this,t,i),this},this.exec=function(t){return t(this),this},this.removeHighlight=this.hideHighlight=function(){var t=RGraph.SVG.REG.get("highlight");t&&(t.setAttribute("fill","transparent"),t.setAttribute("stroke","transparent"),RGraph.SVG.REG.set("highlight",null))},this.tooltipSubstitutions=function(t){return{index:t.index,dataset:0,sequentialIndex:t.index,value:this.data[t.index],values:[this.data[t.index]]}},this.tooltipsFormattedCustom=function(t,i,e){e=e[t.index];return{label:"object"==typeof c.tooltipsFormattedKeyLabels&&"string"==typeof c.tooltipsFormattedKeyLabels[t.index]?c.tooltipsFormattedKeyLabels[t.index]:"",color:e}},this.positionTooltipStatic=function(t){var i=t.object,e=(t.event,t.tooltip),o=(t.index,RGraph.SVG.getSVGXY(i.svg)),i=this.coords[t.index];t.tooltip.style.left=o[0]+i.x1-e.offsetWidth/2+(i.x2-i.x1)/2+"px",t.tooltip.style.top=o[1]+i.y1-e.offsetHeight-10+"px"},t.options)"string"==typeof i&&this.set(i,t.options[i])};