function n(n,t){for(var r in t)n[r]=t[r];return n}module.exports=function(i){var f=[];function t(n){for(var t=[],r=0;r<f.length;r++)f[r]===n?n=null:t.push(f[r]);f=t}function r(t,r,u){i=r?t:n(n({},i),t);for(var e=f,o=0;o<e.length;o++)e[o](i,u)}return i=i||{},{action:function(e){function o(n){r(n,!1,e)}return function(){for(var n=arguments,t=[i],r=0;r<arguments.length;r++)t.push(n[r]);var u=e.apply(this,t);if(null!=u)return u.then?u.then(o):o(u)}},setState:r,subscribe:function(n){return f.push(n),function(){t(n)}},unsubscribe:t,getState:function(){return i}}};