!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("preact")):"function"==typeof define&&define.amd?define(["exports","preact"],t):t(n.unistore={},n.preact)}(this,function(n,a){function p(n,t){for(var e in t)n[e]=t[e];return n}function t(n){this.getChildContext=function(){return{store:n.store}}}t.prototype.render=function(n){return n.children&&n.children[0]||n.children},n.createStore=function(u){var i=[];function t(n){for(var t=[],e=0;e<i.length;e++)i[e]===n?n=null:t.push(i[e]);i=t}function e(n,t,e){u=t?n:p(p({},u),n);for(var r=i,o=0;o<r.length;o++)r[o](u,e)}return u=u||{},{action:function(o){function i(n){e(n,!1,o)}return function(){for(var n=arguments,t=[u],e=0;e<arguments.length;e++)t.push(n[e]);var r=o.apply(this,t);if(null!=r)return r.then?r.then(i):i(r)}},setState:e,subscribe:function(n){return i.push(n),function(){t(n)}},unsubscribe:t,getState:function(){return u}}},n.Provider=t,n.connect=function(f,s){var r;return"function"!=typeof f&&("string"==typeof(r=f||{})&&(r=r.split(/\s*,\s*/)),f=function(n){for(var t={},e=0;e<r.length;e++)t[r[e]]=n[r[e]];return t}),function(c){function n(r,n){function t(){var n=f(i?i.getState():{},r);for(var t in n)if(n[t]!==u[t])return u=n,o.setState({});for(var e in u)if(!(e in n))return u=n,o.setState({})}var o=this,i=n.store,u=f(i?i.getState():{},r),e=s?function(n,t){"function"==typeof n&&(n=n(t));var e={};for(var r in n)e[r]=t.action(n[r]);return e}(s,i):{store:i};this.componentWillReceiveProps=function(n){r=n,t()},this.componentDidMount=function(){i.subscribe(t)},this.componentWillUnmount=function(){i.unsubscribe(t)},this.render=function(n){return a.h(c,p(p(p({},e),n),u))}}return(n.prototype=new a.Component).constructor=n}}});