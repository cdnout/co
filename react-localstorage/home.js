"use strict";var ls,warn=require("./lib/warning"),hasLocalStorage=!0,testKey="react-localstorage.mixin.test-key";try{(ls=global.localStorage).setItem(testKey,"foo"),ls.removeItem(testKey)}catch(e){hasLocalStorage=!1}function loadStateFromLocalStorage(e){if(hasLocalStorage){var t=getLocalStorageKey(e);if(!1!==t){try{var o=JSON.parse(ls.getItem(t));o&&e.setState(o)}catch(t){console&&console.warn("Unable to load state for",getDisplayName(e),"from localStorage.")}e.__react_localstorage_loaded=!0}}}function saveStateToLocalStorage(e){if(hasLocalStorage&&e.__react_localstorage_loaded){var t=getLocalStorageKey(e);!1!==t&&ls.setItem(t,JSON.stringify(getSyncState(e)))}}function getDisplayName(e){return e.displayName||e.constructor.displayName||e.constructor.name}function getLocalStorageKey(e){return e.getLocalStorageKey?e.getLocalStorageKey():!1!==e.props.localStorageKey&&("function"==typeof e.props.localStorageKey?e.props.localStorageKey.call(e):e.props.localStorageKey||getDisplayName(e)||"react-localstorage")}function getStateFilterKeys(e){return e.getStateFilterKeys?"string"==typeof e.getStateFilterKeys()?[e.getStateFilterKeys()]:e.getStateFilterKeys():"string"==typeof e.props.stateFilterKeys?[e.props.stateFilterKeys]:e.props.stateFilterKeys}function getSyncState(e){var t=e.state,o=getStateFilterKeys(e);if(!o||!t)return t;for(var a,r={},l=0;l<o.length;l++)a=o[l],t.hasOwnProperty(a)&&(r[a]=t[a]);return r}process.browser&&warn(hasLocalStorage,"localStorage not found. Component state will not be stored to localStorage."),module.exports={componentWillUnmount:function(){saveStateToLocalStorage(this),this.__react_localstorage_beforeunload&&global.removeEventListener("beforeunload",this.__react_localstorage_beforeunload)},componentDidMount:function(){loadStateFromLocalStorage(this),hasLocalStorage&&this.__react_localstorage_loaded&&global.addEventListener&&(this.__react_localstorage_beforeunload=module.exports.componentWillUnmount.bind(this),global.addEventListener("beforeunload",this.__react_localstorage_beforeunload))}};