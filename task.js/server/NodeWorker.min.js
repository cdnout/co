function _defineProperty(e,r,i){return r in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}const cp=require("child_process"),GeneralWorker=require("../GeneralWorker");class NodeWorker extends GeneralWorker{constructor(e){super(...arguments),_defineProperty(this,"_onExit",()=>{this._alive&&(this._debug&&this._log({action:"killed"}),this._alive=!1,this.handleWorkerExit())}),_defineProperty(this,"_onMessage",e=>{this.handleWorkerMessage(e)}),_defineProperty(this,"postMessage",e=>{this._debug&&this._log({taskId:e.id,action:"send_task_to_actual_worker",message:`sending taskId(${e.id}) to worker process`}),this._worker.send(e)}),_defineProperty(this,"terminate",()=>{this._debug&&this._log({action:"terminated"}),this._worker.kill()}),e=e||{},this._worker=cp.fork(`${__dirname}/EvalWorker.js`,{env:e.env}),this._worker.on("message",this._onMessage),this._worker.on("exit",this._onExit),this._worker.on("close",this._onExit),this._worker.on("disconnect",this._onExit),this._worker.on("error",this._onExit),this._alive=!0,this._debug&&this._log({action:"initialized"})}_log(e){let r={source:"worker_thread",managerId:this.managerId,workerId:this.id,processId:this._worker.pid};Object.keys(e).forEach(i=>{r[i]=e[i]}),r.message||(r.message=r.action),this._logger(r)}}module.exports=NodeWorker;