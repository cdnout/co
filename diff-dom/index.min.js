"use strict";function e(t,o,n){var s;return"#text"===t.nodeName?s=n.document.createTextNode(t.data):"#comment"===t.nodeName?s=n.document.createComment(t.data):(o?s=n.document.createElementNS("http://www.w3.org/2000/svg",t.nodeName):"svg"===t.nodeName.toLowerCase()?(s=n.document.createElementNS("http://www.w3.org/2000/svg","svg"),o=!0):s=n.document.createElement(t.nodeName),t.attributes&&Object.entries(t.attributes).forEach(function(e){var t=e[0],e=e[1];return s.setAttribute(t,e)}),t.childNodes&&t.childNodes.forEach(function(t){return s.appendChild(e(t,o,n))}),n.valueDiffing&&(t.value&&(s.value=t.value),t.checked&&(s.checked=t.checked),t.selected&&(s.selected=t.selected))),s}function t(e,t){for(t=t.slice();0<t.length;){if(!e.childNodes)return!1;var o=t.splice(0,1)[0];e=e.childNodes[o]}return e}function o(o,n,s){var i,a,l,c,r=t(o,n[s._const.route]),u={diff:n,node:r};if(s.preDiffApply(u))return!0;switch(n[s._const.action]){case s._const.addAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(n[s._const.name],n[s._const.value]);break;case s._const.modifyAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(n[s._const.name],n[s._const.newValue]),"INPUT"===r.nodeName&&"value"===n[s._const.name]&&(r.value=n[s._const.newValue]);break;case s._const.removeAttribute:if(!r||!r.removeAttribute)return!1;r.removeAttribute(n[s._const.name]);break;case s._const.modifyTextElement:if(!r||3!==r.nodeType)return!1;s.textDiff(r,r.data,n[s._const.oldValue],n[s._const.newValue]);break;case s._const.modifyValue:if(!r||void 0===r.value)return!1;r.value=n[s._const.newValue];break;case s._const.modifyComment:if(!r||void 0===r.data)return!1;s.textDiff(r,r.data,n[s._const.oldValue],n[s._const.newValue]);break;case s._const.modifyChecked:if(!r||void 0===r.checked)return!1;r.checked=n[s._const.newValue];break;case s._const.modifySelected:if(!r||void 0===r.selected)return!1;r.selected=n[s._const.newValue];break;case s._const.replaceElement:r.parentNode.replaceChild(e(n[s._const.newValue],"http://www.w3.org/2000/svg"===r.namespaceURI,s),r);break;case s._const.relocateGroup:Array.apply(void 0,new Array(n.groupLength)).map(function(){return r.removeChild(r.childNodes[n[s._const.from]])}).forEach(function(e,t){0===t&&(a=r.childNodes[n[s._const.to]]),r.insertBefore(e,a||null)});break;case s._const.removeElement:r.parentNode.removeChild(r);break;case s._const.addElement:c=(l=n[s._const.route].slice()).splice(l.length-1,1)[0],(r=t(o,l)).insertBefore(e(n[s._const.element],"http://www.w3.org/2000/svg"===r.namespaceURI,s),r.childNodes[c]||null);break;case s._const.removeTextElement:if(!r||3!==r.nodeType)return!1;r.parentNode.removeChild(r);break;case s._const.addTextElement:if(c=(l=n[s._const.route].slice()).splice(l.length-1,1)[0],i=s.document.createTextNode(n[s._const.value]),!(r=t(o,l))||!r.childNodes)return!1;r.insertBefore(i,r.childNodes[c]||null);break;default:console.log("unknown action")}return u.newNode=i,s.postDiffApply(u),!0}function n(e,t,o){var n=e[t];e[t]=e[o],e[o]=n}function s(t,e,s){e.length||(e=[e]),(e=e.slice()).reverse(),e.forEach(function(e){!function(e,t,s){switch(t[s._const.action]){case s._const.addAttribute:t[s._const.action]=s._const.removeAttribute,o(e,t,s);break;case s._const.modifyAttribute:n(t,s._const.oldValue,s._const.newValue),o(e,t,s);break;case s._const.removeAttribute:t[s._const.action]=s._const.addAttribute,o(e,t,s);break;case s._const.modifyTextElement:case s._const.modifyValue:case s._const.modifyComment:case s._const.modifyChecked:case s._const.modifySelected:case s._const.replaceElement:n(t,s._const.oldValue,s._const.newValue),o(e,t,s);break;case s._const.relocateGroup:n(t,s._const.from,s._const.to),o(e,t,s);break;case s._const.removeElement:t[s._const.action]=s._const.addElement,o(e,t,s);break;case s._const.addElement:t[s._const.action]=s._const.removeElement,o(e,t,s);break;case s._const.removeTextElement:t[s._const.action]=s._const.addTextElement,o(e,t,s);break;case s._const.addTextElement:t[s._const.action]=s._const.removeTextElement,o(e,t,s);break;default:console.log("unknown action")}}(t,e,s)})}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(e){var o=this;void 0===e&&(e={}),Object.entries(e).forEach(function(e){var t=e[0],e=e[1];return o[t]=e})};function a(e){var t=[];return t.push(e.nodeName),"#text"!==e.nodeName&&"#comment"!==e.nodeName&&e.attributes&&(e.attributes.class&&t.push(e.nodeName+"."+e.attributes.class.replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id)),t}function l(e){var o={},n={};return e.forEach(function(e){a(e).forEach(function(e){var t=e in o;t||e in n?t&&(delete o[e],n[e]=!0):o[e]=!0})}),o}function c(e,t){var e=l(e),o=l(t),n={};return Object.keys(e).forEach(function(e){o[e]&&(n[e]=!0)}),n}function r(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(r)}function u(t,o){if(!["nodeName","value","checked","selected","data"].every(function(e){return t[e]===o[e]}))return!1;if(Boolean(t.attributes)!==Boolean(o.attributes))return!1;if(Boolean(t.childNodes)!==Boolean(o.childNodes))return!1;if(t.attributes){var e=Object.keys(t.attributes),n=Object.keys(o.attributes);if(e.length!==n.length)return!1;if(!e.every(function(e){return t.attributes[e]===o.attributes[e]}))return!1}if(t.childNodes){if(t.childNodes.length!==o.childNodes.length)return!1;if(!t.childNodes.every(function(e,t){return u(e,o.childNodes[t])}))return!1}return!0}function d(e,t,o,n,s){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!s||e.data===t.data;if(e.nodeName in o)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(e.nodeName+"#"+e.attributes.id in o)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class&&e.nodeName+"."+e.attributes.class.replace(/ /g,".")in o)return!0}if(n)return!0;var e=e.childNodes?e.childNodes.slice().reverse():[],i=t.childNodes?t.childNodes.slice().reverse():[];if(e.length!==i.length)return!1;if(s)return e.every(function(e,t){return e.nodeName===i[t].nodeName});var a=c(e,i);return e.every(function(e,t){return d(e,i[t],a,!0,!0)})}function h(e){return JSON.parse(JSON.stringify(e))}function f(e,n,t,o){var s=0,i=[],l=e.length,r=n.length,u=Array.apply(void 0,new Array(l+1)).map(function(){return[]}),h=c(e,n),p=l===r;p&&e.some(function(e,t){var e=a(e),o=a(n[t]);return e.length!==o.length?!(p=!1):(e.some(function(e,t){if(e!==o[t])return!(p=!1)}),!p||void 0)});for(var f=0;f<l;f++)for(var m=e[f],_=0;_<r;_++){var V=n[_];t[f]||o[_]||!d(m,V,h,p)?u[f+1][_+1]=0:(u[f+1][_+1]=u[f][_]?u[f][_]+1:1,u[f+1][_+1]>=s&&(s=u[f+1][_+1],i=[f+1,_+1]))}return 0!==s&&{oldValue:i[0]-s,newValue:i[1]-s,length:s}}function p(e,t){return Array.apply(void 0,new Array(e)).map(function(){return t})}i.prototype.toString=function(){return JSON.stringify(this)},i.prototype.setValue=function(e,t){return this[e]=t,this};var m=function(){this.list=[]};function _(e,t){var o,n,s=e;for(t=t.slice();0<t.length;){if(!s.childNodes)return!1;n=t.splice(0,1)[0],s=(o=s).childNodes[n]}return{node:s,parentNode:o,nodeIndex:n}}function V(t,e,o){return e.forEach(function(e){!function(e,o,n){var t,s,i,a=_(e,o[n._const.route]),l=a.node,c=a.parentNode,r=a.nodeIndex,u=[],a={diff:o,node:l};if(n.preVirtualDiffApply(a))return;switch(o[n._const.action]){case n._const.addAttribute:l.attributes||(l.attributes={}),l.attributes[o[n._const.name]]=o[n._const.value],"checked"===o[n._const.name]?l.checked=!0:"selected"===o[n._const.name]?l.selected=!0:"INPUT"===l.nodeName&&"value"===o[n._const.name]&&(l.value=o[n._const.value]);break;case n._const.modifyAttribute:l.attributes[o[n._const.name]]=o[n._const.newValue];break;case n._const.removeAttribute:delete l.attributes[o[n._const.name]],0===Object.keys(l.attributes).length&&delete l.attributes,"checked"===o[n._const.name]?l.checked=!1:"selected"===o[n._const.name]?delete l.selected:"INPUT"===l.nodeName&&"value"===o[n._const.name]&&delete l.value;break;case n._const.modifyTextElement:l.data=o[n._const.newValue];break;case n._const.modifyValue:l.value=o[n._const.newValue];break;case n._const.modifyComment:l.data=o[n._const.newValue];break;case n._const.modifyChecked:l.checked=o[n._const.newValue];break;case n._const.modifySelected:l.selected=o[n._const.newValue];break;case n._const.replaceElement:(t=h(o[n._const.newValue])).outerDone=!0,t.innerDone=!0,t.valueDone=!0,c.childNodes[r]=t;break;case n._const.relocateGroup:l.childNodes.splice(o[n._const.from],o.groupLength).reverse().forEach(function(e){return l.childNodes.splice(o[n._const.to],0,e)}),l.subsets&&l.subsets.forEach(function(e){var t;o[n._const.from]<o[n._const.to]&&e.oldValue<=o[n._const.to]&&e.oldValue>o[n._const.from]?(e.oldValue-=o.groupLength,0<(t=e.oldValue+e.length-o[n._const.to])&&(u.push({oldValue:o[n._const.to]+o.groupLength,newValue:e.newValue+e.length-t,length:t}),e.length-=t)):o[n._const.from]>o[n._const.to]&&e.oldValue>o[n._const.to]&&e.oldValue<o[n._const.from]?(e.oldValue+=o.groupLength,0<(t=e.oldValue+e.length-o[n._const.to])&&(u.push({oldValue:o[n._const.to]+o.groupLength,newValue:e.newValue+e.length-t,length:t}),e.length-=t)):e.oldValue===o[n._const.from]&&(e.oldValue=o[n._const.to])});break;case n._const.removeElement:c.childNodes.splice(r,1),c.subsets&&c.subsets.forEach(function(e){e.oldValue>r?--e.oldValue:e.oldValue===r?e.delete=!0:e.oldValue<r&&e.oldValue+e.length>r&&(e.oldValue+e.length-1===r?e.length--:(u.push({newValue:e.newValue+r-e.oldValue,oldValue:r,length:e.length-r+e.oldValue-1}),e.length=r-e.oldValue))}),l=c;break;case n._const.addElement:s=o[n._const.route].slice(),i=s.splice(s.length-1,1)[0],l=_(e,s).node,(t=h(o[n._const.element])).outerDone=!0,t.innerDone=!0,t.valueDone=!0,l.childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(t):l.childNodes.splice(i,0,t),l.subsets&&l.subsets.forEach(function(e){var t;e.oldValue>=i?e.oldValue+=1:e.oldValue<i&&e.oldValue+e.length>i&&(t=e.oldValue+e.length-i,u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t)});break;case n._const.removeTextElement:c.childNodes.splice(r,1),"TEXTAREA"===c.nodeName&&delete c.value,c.subsets&&c.subsets.forEach(function(e){e.oldValue>r?--e.oldValue:e.oldValue===r?e.delete=!0:e.oldValue<r&&e.oldValue+e.length>r&&(e.oldValue+e.length-1===r?e.length--:(u.push({newValue:e.newValue+r-e.oldValue,oldValue:r,length:e.length-r+e.oldValue-1}),e.length=r-e.oldValue))}),l=c;break;case n._const.addTextElement:s=o[n._const.route].slice(),i=s.splice(s.length-1,1)[0],(t={}).nodeName="#text",t.data=o[n._const.value],(l=_(e,s).node).childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(t):l.childNodes.splice(i,0,t),"TEXTAREA"===l.nodeName&&(l.value=o[n._const.newValue]),l.subsets&&l.subsets.forEach(function(e){var t;e.oldValue>=i&&(e.oldValue+=1),e.oldValue<i&&e.oldValue+e.length>i&&(t=e.oldValue+e.length-i,u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t)});break;default:console.log("unknown action")}l.subsets&&(l.subsets=l.subsets.filter(function(e){return!e.delete&&e.oldValue!==e.newValue}),u.length&&(l.subsets=l.subsets.concat(u))),a.newNode=t,n.postVirtualDiffApply(a)}(t,e,o)}),!0}function g(e,t){void 0===t&&(t={});var o={};return o.nodeName=e.nodeName,"#text"===o.nodeName||"#comment"===o.nodeName?o.data=e.data:(e.attributes&&0<e.attributes.length&&(o.attributes={},Array.prototype.slice.call(e.attributes).forEach(function(e){return o.attributes[e.name]=e.value})),"TEXTAREA"===o.nodeName?o.value=e.value:e.childNodes&&0<e.childNodes.length&&(o.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){return o.childNodes.push(g(e,t))})),t.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?o.checked=e.checked:void 0!==e.value&&(o.value=e.value),void 0!==e.selected&&(o.selected=e.selected))),o}m.prototype.add=function(e){var t;(t=this.list).push.apply(t,e)},m.prototype.forEach=function(t){this.list.forEach(function(e){return t(e)})};var v=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,N=Object.create?Object.create(null):{},b=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function w(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}var y={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function E(e){var t={nodeName:"",attributes:{}},o=e.match(/<\/?([^\s]+?)[/\s>]/);if(o&&(t.nodeName=o[1].toUpperCase(),!y[o[1].toLowerCase()]&&"/"!==e.charAt(e.length-2)||(t.voidElement=!0),t.nodeName.startsWith("!--"))){o=e.indexOf("--\x3e");return{type:"comment",data:-1!==o?e.slice(4,o):""}}for(var n,s,i=new RegExp(b),a=null,l=!1;!l;)null===(a=i.exec(e))?l=!0:a[0].trim()&&(a[1]?(s=[n=a[1].trim(),""],-1<n.indexOf("=")&&(s=n.split("=")),t.attributes[s[0]]=s[1],i.lastIndex--):a[2]&&(t.attributes[a[2]]=a[3].trim().substring(1,a[3].length-1)));return t}function k(e){return function e(t){return delete t.voidElement,t.childNodes&&t.childNodes.forEach(e),t}(function(a,l){void 0===l&&(l={components:N});var c,r=[],u=-1,d=[],h=!1;return a.replace(v,function(e,t){if(h){if(e!=="</"+c.nodeName+">")return;h=!1}var o,n="/"!==e.charAt(1),s=e.startsWith("\x3c!--"),i=t+e.length,t=a.charAt(i);if(s){s=E(e);return u<0?r.push(s):(o=d[u])&&(o.childNodes||(o.childNodes=[]),o.childNodes.push(s)),r}n&&(c=E(e),u++,"tag"===c.type&&l.components[c.nodeName]&&(c.type="component",h=!0),c.voidElement||h||!t||"<"===t||(c.childNodes||(c.childNodes=[]),c.childNodes.push({nodeName:"#text",data:w(a.slice(i,a.indexOf("<",i)))})),0===u&&r.push(c),(o=d[u-1])&&(o.childNodes||(o.childNodes=[]),o.childNodes.push(c)),d[u]=c),n&&!c.voidElement||(u--,h||"<"===t||!t)||(o=-1===u?r:d[u].childNodes||[],t=a.indexOf("<",i),t=w(a.slice(i,-1===t?void 0:t)),o.push({nodeName:"#text",data:t}))}),r[0]}(e))}var x=function(e,t,o){this.options=o,this.t1=e instanceof HTMLElement?g(e,this.options):"string"==typeof e?k(e,this.options):JSON.parse(JSON.stringify(e)),this.t2=t instanceof HTMLElement?g(t,this.options):"string"==typeof t?k(t,this.options):JSON.parse(JSON.stringify(t)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=g(e,this.options),this.t2Orig=g(t,this.options)),this.tracker=new m};x.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},x.prototype.findDiffs=function(e,t){var o;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig))}while(0===(o=this.findNextDiff(e,t,[])).length&&(u(e,t)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,r(e),o=this.findNextDiff(e,t,[])))),0<o.length&&(this.foundAll=!1,this.tracker.add(o),V(e,o,this.options)),0<o.length);return this.tracker.list},x.prototype.findNextDiff=function(e,t,o){var n,s;if(this.options.maxDepth&&o.length>this.options.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,o),this.options.filterOuterDiff&&(s=this.options.filterOuterDiff(e,t,n))&&(n=s),0<n.length)return e.outerDone=!0,n;e.outerDone=!0}if(!e.innerDone){if(0<(n=this.findInnerDiff(e,t,o)).length)return n;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if(0<(n=this.findValueDiff(e,t,o)).length)return e.valueDone=!0,n;e.valueDone=!0}return[]},x.prototype.findOuterDiff=function(e,t,o){var n,s,a,l,c,r,u=[];if(e.nodeName!==t.nodeName){if(!o.length)throw new Error("Top level nodes have to be of the same kind.");return[(new i).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(e)).setValue(this.options._const.newValue,h(t)).setValue(this.options._const.route,o)]}if(o.length&&this.options.maxNodeDiffCount<Math.abs((e.childNodes||[]).length-(t.childNodes||[]).length))return[(new i).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(e)).setValue(this.options._const.newValue,h(t)).setValue(this.options._const.route,o)];if(e.data!==t.data)return"#text"===e.nodeName?[(new i).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[(new i).setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(s=e.attributes?Object.keys(e.attributes).sort():[],a=t.attributes?Object.keys(t.attributes).sort():[],l=s.length,r=0;r<l;r++)n=s[r],-1===(c=a.indexOf(n))?u.push((new i).setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,e.attributes[n])):(a.splice(c,1),e.attributes[n]!==t.attributes[n]&&u.push((new i).setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.oldValue,e.attributes[n]).setValue(this.options._const.newValue,t.attributes[n])));for(l=a.length,r=0;r<l;r++)n=a[r],u.push((new i).setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,t.attributes[n]));return u},x.prototype.findInnerDiff=function(e,t,o){var n=e.childNodes?e.childNodes.slice():[],s=t.childNodes?t.childNodes.slice():[],a=Math.max(n.length,s.length),l=Math.abs(n.length-s.length),c=[],r=0;if(!this.options.maxChildCount||a<this.options.maxChildCount){var d=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?function(e,t){for(var o=e.childNodes||[],n=t.childNodes||[],s=p(o.length,!1),i=p(n.length,!1),a=[],l=!0,c=function(){return arguments[1]};l;)(l=f(o,n,s,i))&&(a.push(l),Array.apply(void 0,new Array(l.length)).map(c).forEach(function(e){return e=e,s[l.oldValue+e]=!0,void(i[l.newValue+e]=!0)}));return e.subsets=a,e.subsetsAge=100,a}(e,t):[];if(0<d.length&&0<(c=this.attemptGroupRelocation(e,t,d,o)).length)return c}for(var m=0;m<a;m+=1){var _=n[m],V=s[m];l&&(_&&!V?("#text"===_.nodeName?c.push((new i).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.value,_.data)):c.push((new i).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.element,h(_))),--r):V&&!_&&("#text"===V.nodeName?c.push((new i).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.value,V.data)):c.push((new i).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.element,h(V))))),_&&V&&(!this.options.maxChildCount||a<this.options.maxChildCount?c=c.concat(this.findNextDiff(_,V,o.concat(r))):u(_,V)||(n.length>s.length?("#text"===_.nodeName?c.push((new i).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.value,_.data)):c.push((new i).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,h(_)).setValue(this.options._const.route,o.concat(r))),n.splice(m,1),--m,--r,--l):n.length<s.length?(c=c.concat([(new i).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,h(V)).setValue(this.options._const.route,o.concat(r))]),n.splice(m,0,{}),--l):c=c.concat([(new i).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(_)).setValue(this.options._const.newValue,h(V)).setValue(this.options._const.route,o.concat(r))]))),r+=1}return e.innerDone=!0,c},x.prototype.attemptGroupRelocation=function(e,t,o,n){for(var s,a,l,c,r,u,f,m,_,V,g,m=(f=t,m=o,_=e.childNodes?p(e.childNodes.length,!0):[],V=f.childNodes?p(f.childNodes.length,!0):[],g=0,m.forEach(function(e){for(var t=e.oldValue+e.length,o=e.newValue+e.length,n=e.oldValue;n<t;n+=1)_[n]=g;for(var s=e.newValue;s<o;s+=1)V[s]=g;g+=1}),{gaps1:_,gaps2:V}),v=m.gaps1,N=m.gaps2,b=Math.min(v.length,N.length),w=[],y=0,E=0;y<b;E+=1,y+=1)if(!0===v[y])if("#text"===(c=e.childNodes[E]).nodeName)if("#text"===t.childNodes[y].nodeName){if(c.data!==t.childNodes[y].data){for(u=E;e.childNodes.length>u+1&&"#text"===e.childNodes[u+1].nodeName;)if(u+=1,t.childNodes[y].data===e.childNodes[u].data){r=!0;break}if(!r)return w.push((new i).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.oldValue,c.data).setValue(this.options._const.newValue,t.childNodes[y].data)),w}}else w.push((new i).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.value,c.data)),v.splice(y,1),b=Math.min(v.length,N.length),--y;else w.push((new i).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.element,h(c))),v.splice(y,1),b=Math.min(v.length,N.length),--y;else if(!0===N[y])b=("#text"===(c=t.childNodes[y]).nodeName?w.push((new i).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.value,c.data)):w.push((new i).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,n.concat(y)).setValue(this.options._const.element,h(c))),v.splice(y,0,!0),Math.min(v.length,N.length)),--E;else if(v[y]!==N[y]){if(0<w.length)return w;if(l=o[v[y]],(a=Math.min(l.newValue,e.childNodes.length-l.length))!==l.oldValue){s=!1;for(var k=0;k<l.length;k+=1)d(e.childNodes[a+k],e.childNodes[l.oldValue+k],[],!1,!0)||(s=!0);if(s)return[(new i).setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",l.length).setValue(this.options._const.from,l.oldValue).setValue(this.options._const.to,a).setValue(this.options._const.route,n)]}}return w};var A={debug:!(x.prototype.findValueDiff=function(e,t,o){var n=[];return e.selected!==t.selected&&n.push((new i).setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,o)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&n.push((new i).setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,o)),e.checked!==t.checked&&n.push((new i).setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,o)),n}),diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(e,t,o,n){e.data=n},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:!(!window||!window.document)&&window.document},D=function(e){var o=this;void 0===e&&(e={}),this.options=e,Object.entries(A).forEach(function(e){var t=e[0],e=e[1];Object.prototype.hasOwnProperty.call(o.options,t)||(o.options[t]=e)}),this.options._const||(e=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"],this.options._const={},this.options.compress?e.forEach(function(e,t){return o.options._const[e]=t}):e.forEach(function(e){return o.options._const[e]=e})),this.DiffFinder=x};D.prototype.apply=function(e,t){return n=e,s=this.options,t.every(function(e){return o(n,e,s)});var n,s},D.prototype.undo=function(e,t){return s(e,t,this.options)},D.prototype.diff=function(e,t){return new this.DiffFinder(e,t,this.options).init()};var O=function(e){var a=this;void 0===e&&(e={}),this.pad="│   ",this.padding="",this.tick=1,this.messages=[];for(var t in e)"function"==typeof e[t]&&function(n,s){var i=n[s];n[s]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];a.fin(s,Array.prototype.slice.call(e));var o=i.apply(n,e);return a.fout(s,o),o}}(e,t);this.log("┌ TRACELOG START")};O.prototype.fin=function(e,t){this.padding+=this.pad,this.log("├─> entering "+e,t)},O.prototype.fout=function(e,t){this.log("│<──┘ generated return value",t),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},O.prototype.format=function(e,t){return function(e){for(e=""+e;e.length<4;)e="0"+e;return e}(t)+"> "+this.padding+e},O.prototype.log=function(){var e=Array.prototype.slice.call(arguments),t=function(e){return e?"string"==typeof e?e:e instanceof HTMLElement?e.outerHTML||"<empty>":e instanceof Array?"["+e.map(t).join(",")+"]":e.toString()||e.valueOf()||"<unknown>":"<falsey>"},e=e.map(t).join(", ");this.messages.push(this.format(e,this.tick++))},O.prototype.toString=function(){for(var e="└───";e.length<=this.padding.length+this.pad.length;)e+="×   ";var t=this.padding;return this.padding="",e=this.format(e,this.tick),this.padding=t,this.messages.join("\n")+"\n"+e},exports.DiffDOM=D,exports.TraceLogger=O,exports.nodeToObj=g,exports.stringToObj=k;