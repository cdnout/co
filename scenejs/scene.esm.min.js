import{between,isString,splitText,isArray,splitComma,splitSpace,RGBA,splitBracket,COLOR_MODELS,stringToRGBA,OBJECT,ARRAY,PROPERTY,STRING,NUMBER,isObject,IS_WINDOW,$,ANIMATION,removeEvent,addEvent,requestAnimationFrame,cancelAnimationFrame,splitUnit,camelize,getKeys,sortOrders,isUndefined,FILTER,TRANSFORM,FUNCTION,dot as dot$1,isFunction,toArray,fromCSS,findIndex,find,KEYFRAMES,addClass,removeClass,hasClass,decamelize}from"@daybrush/utils";import EventEmitter from"@scena/event-emitter";import OrderMap from"order-map";import styled from"css-styled";var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function __extends(t,e){function r(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function __decorate(t,e,r,i){var n,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,i);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(a=(s<3?n(a):s>3?n(e,r,a):n(e,r))||a);return s>3&&a&&Object.defineProperty(e,r,a),a}function __spreadArrays(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var s=arguments[e],a=0,o=s.length;a<o;a++,n++)i[n]=s[a];return i}function cubic(t,e,r){var i=1-r;return r*r*r+3*r*r*i*e+3*r*i*i*t}function solveFromX(t,e,r){for(var i=r,n=1;Math.abs(n)>.001;){if(n=cubic(t,e,i)-r,Math.abs(n)<.001)return i;i-=n/2}return i}function bezier(t,e,r,i){var n=function(n){var s=solveFromX(t,r,between(n,0,1));return cubic(e,i,s)};return n.easingName="cubic-bezier("+t+","+e+","+r+","+i+")",n}function steps(t,e){var r=function(r){var i=1/t;return r>=1?1:("start"===e?i:0)+Math.floor(r/i)*i};return r.easingName="steps("+t+", "+e+")",r}var _a,STEP_START=steps(1,"start"),STEP_END=steps(1,"end"),LINEAR=bezier(0,0,1,1),EASE=bezier(.25,.1,.25,1),EASE_IN=bezier(.42,0,1,1),EASE_OUT=bezier(0,0,.58,1),EASE_IN_OUT=bezier(.42,0,.58,1),PREFIX="__SCENEJS_",DATA_SCENE_ID="data-scene-id",TIMING_FUNCTION="animation-timing-function",ROLES={transform:{},filter:{},attribute:{},html:!0},ALIAS={easing:[TIMING_FUNCTION]},FIXED=((_a={})[TIMING_FUNCTION]=!0,_a.contents=!0,_a.html=!0,_a),MAXIMUM=1e6,THRESHOLD=1e-6,DURATION="duration",FILL_MODE="fillMode",DIRECTION="direction",ITERATION_COUNT="iterationCount",DELAY="delay",EASING="easing",PLAY_SPEED="playSpeed",EASING_NAME="easingName",ITERATION_TIME="iterationTime",PAUSED="paused",ENDED="ended",TIMEUPDATE="timeupdate",ANIMATE="animate",PLAY="play",RUNNING="running",ITERATION="iteration",START_ANIMATION="startAnimation",PAUSE_ANIMATION="pauseAnimation",ALTERNATE="alternate",REVERSE="reverse",ALTERNATE_REVERSE="alternate-reverse",NORMAL="normal",INFINITE="infinite",PLAY_STATE="playState",PLAY_CSS="playCSS",PREV_TIME="prevTime",TICK_TIME="tickTime",CURRENT_TIME="currentTime",SELECTOR="selector",TRANSFORM_NAME="transform",EASINGS={linear:LINEAR,ease:EASE,"ease-in":EASE_IN,"ease-out":EASE_OUT,"ease-in-out":EASE_IN_OUT,"step-start":STEP_START,"step-end":STEP_END},NAME_SEPARATOR="_///_",OPTIONS=[DURATION,FILL_MODE,DIRECTION,ITERATION_COUNT,DELAY,EASING,PLAY_SPEED],EVENTS=[PAUSED,ENDED,TIMEUPDATE,ANIMATE,PLAY,ITERATION],PropertyObject=function(){function t(t,e){this.prefix="",this.suffix="",this.model="",this.type="",this.separator=",",e&&this.setOptions(e),this.value=isString(t)?t.split(this.separator):t}var e=t.prototype;return e.setOptions=function(t){for(var e in t)this[e]=t[e];return this},e.size=function(){return this.value.length},e.get=function(t){return this.value[t]},e.set=function(t,e){return this.value[t]=e,this},e.clone=function(){var e=this,r=e.separator,i=e.prefix,n=e.suffix,s=e.model,a=e.type;return new t(this.value.map(function(e){return e instanceof t?e.clone():e}),{separator:r,prefix:i,suffix:n,model:s,type:a})},e.toValue=function(){return this.prefix+this.join()+this.suffix},e.join=function(){return this.value.map(function(e){return e instanceof t?e.toValue():e}).join(this.separator)},e.forEach=function(t){return this.value.forEach(t),this},t}();function splitStyle(t){for(var e=splitText(t,";"),r={},i=e.length,n=i,s=0;s<i;++s){var a=splitText(e[s],":");a.length<2||!a[1]?--n:r[a[0].trim()]=toPropertyObject(a[1].trim())}return{styles:r,length:n}}function arrayToColorObject(t){var e=RGBA;return 3===t.length&&(t[3]=1),new PropertyObject(t,{model:e,separator:",",type:"color",prefix:e+"(",suffix:")"})}function stringToBracketObject(t){var e=splitBracket(t),r=e.prefix,i=e.value,n=e.suffix;if(void 0===i)return t;if(COLOR_MODELS.indexOf(r)>-1)return arrayToColorObject(stringToRGBA(t));var s=toPropertyObject(i,r),a=[i],o=",",u=r+"(",h=")"+n;return s instanceof PropertyObject&&(o=s.separator,a=s.value,u+=s.prefix,h=s.suffix+h),new PropertyObject(a,{separator:o,model:r,prefix:u,suffix:h})}function arrayToPropertyObject(t,e){return new PropertyObject(t,{type:"array",separator:e})}function stringToColorObject(t){var e=stringToRGBA(t);return e?arrayToColorObject(e):t}function toPropertyObject(t,e){if(!isString(t))return isArray(t)?arrayToPropertyObject(t,","):t;var r=splitComma(t);return r.length>1?arrayToPropertyObject(r.map(function(t){return toPropertyObject(t)}),","):(r=splitSpace(t)).length>1?arrayToPropertyObject(r.map(function(t){return toPropertyObject(t)})," "):(r=/^(['"])([^'"]*)(['"])$/g.exec(t))&&r[1]===r[3]?new PropertyObject([toPropertyObject(r[2])],{prefix:r[1],suffix:r[1]}):-1!==t.indexOf("(")?stringToBracketObject(t):"#"===t.charAt(0)&&"url"!==e?stringToColorObject(t):t}function toObject(t,e){void 0===e&&(e={});var r=t.model;if(r){t.setOptions({model:"",suffix:"",prefix:""});var i=t.size()>1?t:t.get(0);e[r]=i}else t.forEach(function(t){toObject(t,e)});return e}function isPropertyObject(t){return t instanceof PropertyObject}function setAlias(t,e){ALIAS[t]=e}function setRole(t,e,r){for(var i=t.length,n=ROLES,s=FIXED,a=0;a<i-1;++a)!n[t[a]]&&(n[t[a]]={}),n=n[t[a]],r&&(!s[t[a]]&&(s[t[a]]={}),s=s[t[a]]);r&&(s[t[i-1]]=!0),n[t[i-1]]=!!e||{}}function getType(t){var e=typeof t;if(e===OBJECT){if(isArray(t))return ARRAY;if(isPropertyObject(t))return PROPERTY}else if(e===STRING||e===NUMBER)return"value";return e}function isPureObject(t){return isObject(t)&&t.constructor===Object}function getNames(t,e){var r=[];if(isPureObject(t))for(var i in t)e.push(i),r=r.concat(getNames(t[i],e)),e.pop();else r.push(e.slice());return r}function updateFrame(t,e){for(var r in e){isPureObject(e[r])?(isObject(t[r])||(t[r]={}),updateFrame(t[r],e[r])):t[r]=!0}return t}function toFixed(t){return Math.round(t*MAXIMUM)/MAXIMUM}function getValueByNames(t,e,r){void 0===r&&(r=t.length);for(var i=e,n=0;n<r;++n){if(!isObject(i)||null==i)return;i=i[t[n]]}return i}function isInProperties(t,e,r){var i=e.length,n=t;if(0===i)return!1;for(var s=0;s<i;++s){if(!0===n)return!1;if(!(n=n[e[s]])||!r&&!0===n)return!1}return!0}function isRole(t,e){return isInProperties(ROLES,t,e)}function isFixed(t){return isInProperties(FIXED,t,!0)}function setPlayCSS(t,e){t.state[PLAY_CSS]=e}function isPausedCSS(t){return t.state[PLAY_CSS]&&t.isPaused()}function isEndedCSS(t){return!t.isEnded()&&t.state[PLAY_CSS]}function makeId(t){for(;;){var e=""+Math.floor(1e7*Math.random());if(!IS_WINDOW||!t)return e;if(!$('[data-scene-id="'+e+'"]'))return e}}function getRealId(t){return t.getId()||t.setId(makeId(!1)).getId()}function toId(t){return(""+t).match(/[0-9a-zA-Z]+/g).join("")}function playCSS(t,e,r,i){if(void 0===i&&(i={}),ANIMATION&&t.getPlayState()!==RUNNING){var n=r||START_ANIMATION;if(isPausedCSS(t))t.addPlayClass(!0,n,i);else{t.isEnded()&&t.setTime(0),e&&t.exportCSS({className:n});var s=t.addPlayClass(!1,n,i);if(!s)return;addAnimationEvent(t,s),setPlayCSS(t,!0)}t.setPlayState(RUNNING)}}function addAnimationEvent(t,e){var r=t.state,i=t.getDuration(),n=!i||!isFinite(i),s=function(){setPlayCSS(t,!1),t.finish()},a=function(){t.trigger(PLAY),addEvent(e,"animationcancel",s),addEvent(e,"animationend",s),addEvent(e,"animationiteration",o)};t.once(ENDED,function(){removeEvent(e,"animationcancel",s),removeEvent(e,"animationend",s),removeEvent(e,"animationiteration",o),removeEvent(e,"animationstart",a)});var o=function(e){var s=e.elapsedTime,a=n?0:s/i;r[CURRENT_TIME]=s,t.setIteration(a)};addEvent(e,"animationstart",a)}function getEasing(t){var e;if(isString(t))if(t in EASINGS)e=EASINGS[t];else{var r=toPropertyObject(t);if(isString(r))return 0;if("cubic-bezier"===r.model)e=bezier((t=r.value.map(function(t){return parseFloat(t)}))[0],t[1],t[2],t[3]);else{if("steps"!==r.model)return 0;e=steps(parseFloat(r.value[0]),r.value[1])}}else e=isArray(t)?bezier(t[0],t[1],t[2],t[3]):t;return e}function GetterSetter(t,e,r){return function(i){var n=i.prototype;t.forEach(function(t){n[camelize("get "+t)]=function(){return this[r][t]}}),e.forEach(function(t){n[camelize("set "+t)]=function(e){return this[r][t]=e,this}})}}function isDirectionReverse(t,e,r){return r===REVERSE||(e!==INFINITE&&t===e&&e%1==0?r===(t%2>=1?ALTERNATE_REVERSE:ALTERNATE):r===(t%2>=1?ALTERNATE:ALTERNATE_REVERSE))}var setters=["id",ITERATION_COUNT,DELAY,FILL_MODE,DIRECTION,PLAY_SPEED,DURATION,PLAY_SPEED,ITERATION_TIME,PLAY_STATE],getters=__spreadArrays(setters,[EASING,EASING_NAME]),Animator=function(t){function e(e){var r=t.call(this)||this;return r.timerId=0,r.state={id:"",easing:0,easingName:"linear",iterationCount:1,delay:0,fillMode:"forwards",direction:NORMAL,playSpeed:1,currentTime:0,iterationTime:-1,iteration:0,tickTime:0,prevTime:0,playState:PAUSED,duration:0},r.setOptions(e),r}__extends(e,t);var r=e.prototype;return r.setEasing=function(t){var e=getEasing(t),r=e&&e[EASING_NAME]||"linear",i=this.state;return i[EASING]=e,i[EASING_NAME]=r,this},r.setOptions=function(t){for(var e in void 0===t&&(t={}),t){var r=t[e];e!==EASING?e!==DURATION?OPTIONS.indexOf(e)>-1&&(this.state[e]=r):r&&this.setDuration(r):this.setEasing(r)}return this},r.getTotalDuration=function(){return this.getActiveDuration(!0)},r.getActiveDuration=function(t){var e=this.state,r=e[ITERATION_COUNT];return r===INFINITE?1/0:(t?e[DELAY]:0)+this.getDuration()*r},r.isEnded=function(){return 0===this.state[TICK_TIME]&&this.state[PLAY_STATE]===PAUSED||!(this.getTime()<this.getActiveDuration())},r.isPaused=function(){return this.state[PLAY_STATE]===PAUSED},r.start=function(t){void 0===t&&(t=this.state[DELAY]);var e=this.state;return e[PLAY_STATE]=RUNNING,e[TICK_TIME]>=t&&(this.trigger(PLAY),!0)},r.play=function(t){var e=this,r=this.state,i=r[DELAY],n=this.getTime();return r[PLAY_STATE]=RUNNING,this.isEnded()&&(0===n||n>=this.getActiveDuration())&&this.setTime(-i,!0),this.timerId=requestAnimationFrame(function(i){r[PREV_TIME]=i,e.tick(i,t)}),this.start(),this},r.pause=function(){var t=this.state;return t[PLAY_STATE]!==PAUSED&&(t[PLAY_STATE]=PAUSED,this.trigger(PAUSED)),cancelAnimationFrame(this.timerId),this},r.finish=function(){return this.setTime(0),this.state[TICK_TIME]=0,this.end(),this},r.end=function(){return this.pause(),this.trigger(ENDED),this},r.setTime=function(t,e,r){var i=this.getActiveDuration(),n=this.state,s=n[TICK_TIME],a=n[DELAY],o=e?t:this.getUnitTime(t);if(n[TICK_TIME]=a+o,o<0?o=0:o>i&&(o=i),n[CURRENT_TIME]=o,this.calculate(),e&&!r){var u=n[TICK_TIME];if(s<a&&t>=0&&this.start(0),u<s||this.isEnded())return void this.end()}return this.isDelay()?this:(this.trigger(TIMEUPDATE,{currentTime:o,time:this.getIterationTime(),iterationCount:n[ITERATION]}),this)},r.getTime=function(){return this.state[CURRENT_TIME]},r.getUnitTime=function(t){if(isString(t)){var e=this.getDuration()||100;if("from"===t)return 0;if("to"===t)return e;var r=splitUnit(t),i=r.unit,n=r.value;return"%"===i?(!this.getDuration()&&this.setDuration(e),toFixed(parseFloat(t)/100*e)):">"===i?n+THRESHOLD:n}return toFixed(t)},r.isDelay=function(){var t=this.state,e=t[DELAY],r=t[TICK_TIME];return e>0&&r<e},r.setIteration=function(t){var e=this.state,r=Math.floor(t),i=e[ITERATION_COUNT]===INFINITE?1/0:e[ITERATION_COUNT];return e[ITERATION]<r&&r<i&&this.trigger(ITERATION,{currentTime:e[CURRENT_TIME],iterationCount:r}),e[ITERATION]=t,this},r.calculate=function(){var t=this.state,e=t[ITERATION_COUNT],r=t[FILL_MODE],i=t[DIRECTION],n=this.getDuration(),s=this.getTime(),a=0===n?0:s/n,o=n?s%n:0;if(!n)return this.setIterationTime(0),this;this.setIteration(a);var u=isDirectionReverse(a,e,i),h=isFinite(n);(h&&u&&(o=n-o),h&&e!==INFINITE)&&(a>=e&&(o=n*("both"===r||"forwards"===r?e%1||1:0),u&&(o=n-o)));return this.setIterationTime(o),this},r.tick=function(t,e){var r=this;if(!this.isPaused()){var i=this.state,n=i[PLAY_SPEED],s=i[PREV_TIME],a=i[DELAY],o=i[TICK_TIME]+Math.min(1e3,t-s)/1e3*n;i[PREV_TIME]=t,this.setTime(o-a,!0),e&&1e3*e<t&&this.pause(),i[PLAY_STATE]!==PAUSED&&(this.timerId=requestAnimationFrame(function(t){r.tick(t,e)}))}},e=__decorate([GetterSetter(getters,setters,"state")],e)}(EventEmitter);function toInnerProperties(t,e){if(void 0===e&&(e=[]),!t)return"";var r=[],i=getKeys(t);return sortOrders(i,e),i.forEach(function(e){r.push(e.replace(/\d$/g,"")+"("+t[e]+")")}),r.join(" ")}function clone(t,e){return void 0===e&&(e=!1),merge({},t,e)}function merge(t,e,r){for(var i in void 0===r&&(r=!1),e){var n=e[i],s=getType(n);s===PROPERTY?t[i]=r?n.toValue():n.clone():s===FUNCTION?t[i]=r?getValue([i],n):n:s===ARRAY?t[i]=n.slice():s===OBJECT?isObject(t[i])&&!isPropertyObject(t[i])?merge(t[i],n,r):t[i]=clone(n,r):t[i]=e[i]}return t}function getPropertyName(t){return t[0]in ALIAS?ALIAS[t[0]]:t}function getValue(t,e){var r=getType(e);if(r===PROPERTY)return e.toValue();if(r===FUNCTION){if(t[0]!==TIMING_FUNCTION)return getValue(t,e())}else if(r===OBJECT)return clone(e,!0);return e}var Frame=function(){function t(t){void 0===t&&(t={}),this.properties={},this.orderMap=new OrderMap(NAME_SEPARATOR),this.properties={},this.set(t)}var e=t.prototype;return e.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.raw.apply(this,t);return getValue(getPropertyName(t),r)},e.getOrders=function(t){return this.orderMap.get(t)},e.setOrders=function(t,e){return this.orderMap.set(t,e)},e.getOrderObject=function(){return this.orderMap.getObject()},e.setOrderObject=function(t){this.orderMap.setObject(t)},e.getKeys=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.raw.apply(this,t),i=getType(r)===OBJECT?getKeys(r):[];return sortOrders(i,this.orderMap.get(t)),i},e.gets=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=this.get.apply(this,e);return this.getKeys.apply(this,e).map(function(r){return{key:r,value:i[r],children:t.gets.apply(t,__spreadArrays(e,[r]))}})},e.raw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return getValueByNames(getPropertyName(t),this.properties)},e.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=getPropertyName(t),i=r.length;if(!i)return this;this.orderMap.remove(r);var n=getValueByNames(r,this.properties,i-1);return isObject(n)&&delete n[r[i-1]],this},e.set=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=e.length,n=e.slice(0,-1),s=e[i-1],a=n[0];if(1===i&&s instanceof t)this.merge(s);else if(a in ALIAS)this._set(ALIAS[a],s);else if(2===i&&isArray(a))this._set(a,s);else if(isPropertyObject(s))isRole(n)?this.set.apply(this,__spreadArrays(n,[toObject(s)])):this._set(n,s);else if(isArray(s))this._set(n,s);else if(isObject(s))for(var o in!this.has.apply(this,n)&&isRole(n)&&this._set(n,{}),s)this.set.apply(this,__spreadArrays(n,[o,s[o]]));else if(isString(s)){if(isRole(n,!0)){if(isFixed(n)||!isRole(n))this._set(n,s);else{var u=toPropertyObject(s);isObject(u)&&this.set.apply(this,__spreadArrays(n,[u]))}return this}var h=splitStyle(s),c=h.styles,f=h.length;for(var o in c)this.set.apply(this,__spreadArrays(n,[o,c[o]]));if(f)return this;this._set(n,s)}else this._set(n,s);return this},e.getNames=function(){return getNames(this.properties,[])},e.has=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=getPropertyName(t),i=r.length;return!!i&&!isUndefined(getValueByNames(r,this.properties,i))},e.clone=function(){var e=new t;return e.setOrderObject(this.orderMap.orderMap),e.merge(this)},e.merge=function(t){var e=this.properties,r=t.properties;return r&&merge(e,r),this},e.toCSSObject=function(){var t=this.get(),e={};for(var r in t)if(!isRole([r],!0)){var i=t[r];r===TIMING_FUNCTION?e[TIMING_FUNCTION.replace("animation",ANIMATION)]=(isString(i)?i:i[EASING_NAME])||"initial":e[r]=i}var n=toInnerProperties(t[TRANSFORM_NAME],this.orderMap.get([TRANSFORM_NAME])),s=toInnerProperties(t.filter,this.orderMap.get([FILTER]));return TRANSFORM&&n&&(e[TRANSFORM]=n),FILTER&&s&&(e[FILTER]=s),e},e.toCSS=function(){var t=this.toCSSObject(),e=[],r=getKeys(t);return sortOrders(r,this.orderMap.get([])),r.forEach(function(r){e.push(r+":"+t[r]+";")}),e.join("")},e.clear=function(){return this.properties={},this.orderMap.clear(),this},e._set=function(t,e){for(var r=this.properties,i=t.length,n=0;n<i-1;++n){var s=t[n];!(s in r)&&(r[s]={}),r=r[s]}if(i){var a=t[i-1];this.orderMap.add(t),r[a]=1===i&&a===TIMING_FUNCTION?getEasing(e):isString(e)&&!isFixed(t)?toPropertyObject(e,a):e}},t}();function dotArray(t,e,r,i){var n=e.length;return t.map(function(t,s){return s>=n?t:dot(t,e[s],r,i)})}function dotColor(t,e,r,i){var n=t.value,s=e.value,a=t.model;if(a!==e.model)return dot(t.toValue(),e.toValue(),r,i);3===n.length&&(n[3]=1),3===s.length&&(s[3]=1);for(var o=dotArray(n,s,r,i),u=a,h=0;h<3;++h)o[h]=parseInt(o[h],10);return new PropertyObject(o,{type:"color",model:u,prefix:u+"(",suffix:")"})}function dotObject(t,e,r,i){var n=t.type;if("color"===n)return dotColor(t,e,r,i);var s=dotArray(t.value,e.value,r,i);return new PropertyObject(s,{type:n,separator:t.separator||e.separator,prefix:t.prefix||e.prefix,suffix:t.suffix||e.suffix,model:t.model||e.model})}function dot(t,e,r,i){if(0===i)return e;if(0===r||r+i===0)return t;var n=getType(t),s=getType(e),a=n===FUNCTION,o=s===FUNCTION;if(a||o)return function(){return dot(a?toPropertyObject(t()):t,o?toPropertyObject(e()):e,r,i)};if(n!==s)return t;if(n===PROPERTY)return dotObject(t,e,r,i);if(n===ARRAY)return dotArray(t,e,r,i);if("value"!==n)return t;var u,h=splitUnit(""+t),c=splitUnit(""+e);if(isNaN(h.value)||isNaN(c.value))return t;u=dot$1(h.value,c.value,r,i);var f=h.prefix||c.prefix,l=h.unit||c.unit;return f||l?f+u+l:u}function dotValue(t,e,r,i,n,s){if(t===e)return i;if(t===r)return n;if(!s)return dot(i,n,t-e,r-t);var a=s((t-e)/(r-e));return dot(i,n,a,1-a)}function getNearTimeIndex(t,e){for(var r=t.length,i=0;i<r;++i){if(t[i]===e)return[i,i];if(t[i]>e)return[i>0?i-1:0,i]}return[r-1,r-1]}function makeAnimationProperties(t){var e=[];for(var r in t)e.push(ANIMATION+"-"+decamelize(r)+":"+t[r]+";");return e.join("")}function addTime(t,e){for(var r=t.length,i=0;i<r;++i)if(e<t[i])return void t.splice(i,0,e);t[r]=e}function addEntry(t,e,r){var i=t[t.length-1];(!i||i[0]!==e||i[1]!==r)&&t.push([toFixed(e),toFixed(r)])}function getEntries(t,e){var r=t.map(function(t){return[t,t]}),i=[];return e.forEach(function(t){for(var e=t[ITERATION_COUNT],n=t[DELAY],s=t[PLAY_SPEED],a=t[DIRECTION],o=Math.ceil(e),u=r[r.length-1][0],h=r.length,c=u*e,f=0;f<o;++f)for(var l=a===REVERSE||a===ALTERNATE&&f%2||a===ALTERNATE_REVERSE&&!(f%2),E=0;E<h;++E){var d=r[l?h-E-1:E],p=d[1],m=u*f+(l?u-d[0]:d[0]),T=r[l?h-E:E-1];if(m>c){if(0!==E){var A=u*f+(l?u-T[0]:T[0]),v=dot$1(T[1],p,c-A,m-c);addEntry(i,(n+u*e)/s,v)}break}if(m===c&&i.length&&i[i.length-1][0]===c+n)break;addEntry(i,(n+m)/s,p)}n&&i.unshift([0,i[0][1]]),r=i,i=[]}),r}var SceneItem=function(t){function e(e,r){var i=t.call(this)||this;return i.times=[],i.items={},i.nameMap=new OrderMap(NAME_SEPARATOR),i.elements=[],i.needUpdate=!0,i.load(e,r),i}__extends(e,t);var r=e.prototype;return r.getDuration=function(){var t=this.times,e=t.length;return(0===e?0:t[e-1])||this.state[DURATION]},r.size=function(){return this.times.length},r.setDuration=function(t){if(!t)return this;var e=this.getDuration();if(e>0){var r=t/e,i=this.times,n=this.items,s={};this.times=i.map(function(t){var e=toFixed(t*r);return s[e]=n[t],e}),this.items=s}else this.newFrame(t);return this},r.setId=function(t){var e=this.state,r=this.elements,i=r.length;if(e.id=t||makeId(!!i),i&&!e[SELECTOR]){var n=toId(this.getId());e[SELECTOR]="["+DATA_SCENE_ID+'="'+n+'"]',r.forEach(function(t){t.setAttribute(DATA_SCENE_ID,n)})}return this},r.set=function(t){for(var r=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(t instanceof e)return this.set(0,t);if(isArray(t))for(var s=t.length,a=0;a<s;++a){var o=1===s?0:this.getUnitTime(a/(s-1)*100+"%");this.set(o,t[a])}else if(isObject(t)){var u=function(e){var i=t[e];splitComma(e).forEach(function(t){var e=r.getUnitTime(t);isNaN(e)?getNames(i,[t]).forEach(function(t){for(var e,n=getValueByNames(t.slice(1),i),s=isArray(n)?n:[getValueByNames(t,r.target),n],a=s.length,o=0;o<a;++o)(e=r.newFrame(o/(a-1)*100+"%")).set.apply(e,__spreadArrays(t,[s[o]]))}):r.set(e,i)})};for(var o in t)u(o)}else if(!isUndefined(t)){var h=i[0];splitComma(t+"").forEach(function(t){var n=r.getUnitTime(t);if(h instanceof e){var s=h.getDelay(),a=h.toObject(!r.hasFrame(n+s)),o=h.getDuration(),u=h.getDirection().indexOf("reverse")>-1;for(var c in a){var f=u?o-parseFloat(c):parseFloat(c);r.set(n+f,a[c])}}else if(1===i.length&&isArray(h))h.forEach(function(t){r.set(n,t)});else{var l=r.newFrame(n);l.set.apply(l,i)}})}return this.needUpdate=!0,this},r.get=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=this.getFrame(t);return i&&i.get.apply(i,e)},r.getOrders=function(t){return this.needUpdate&&this.update(),this.nameMap.get(t)},r.setOrders=function(t,e){this.needUpdate&&this.update();var r=this.nameMap.set(t,e);return this.updateFrameOrders(),r},r.getOrderObject=function(){return this.nameMap.getObject()},r.setOrderObject=function(t){this.nameMap.setObject(t),this.updateFrameOrders()},r.remove=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(e.length){var i=this.getFrame(t);i&&i.remove.apply(i,e)}else this.removeFrame(t);return this.needUpdate=!0,this},r.append=function(t){return t instanceof e?this.set(this.getDuration(),t):this.append(new e(t)),this},r.prepend=function(t){if(t instanceof e){var r=t.getDuration()+t.getDelay(),i=this.getFrame(0);this.removeFrame(0),this.unshift(r),this.set(0,t),this.set(r+THRESHOLD,i)}else this.prepend(new e(t));return this},r.unshift=function(t){var e=this.times,r=this.items,i={};return this.times=e.map(function(e){var n=toFixed(t+e);return i[n]=r[e],n}),this.items=i,this},r.toObject=function(t){void 0===t&&(t=!0);var e={},r=this.getDelay();return this.forEach(function(i,n){e[(n||t?0:THRESHOLD)+r+n]=i.clone()}),e},r.setSelector=function(t){return isFunction(t)?this.setElement(t(this.getId())):this.setElement(t),this},r.getElements=function(){return this.elements},r.setElements=function(t){return this.setElement(t)},r.setElement=function(t){var e=this.state,r=[];if(!t)return this;if(!0===t||isString(t)){var i=!0===t?""+e.id:t,n=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(i);r=toArray($(n?n[1]:i,!0)),e[SELECTOR]=i}else r=t instanceof Element?[t]:toArray(t);return r.length?(this.elements=r,this.setId(this.getId()),this.target=r[0].style,this.targetFunc=function(t){var i=t.get("attribute");if(i){var n=function(t){r.forEach(function(e){e.setAttribute(t,i[t])})};for(var s in i)n(s)}if(t.has("html")){var a=t.get("html");r.forEach(function(t){t.innerHTML=a})}var o=t.toCSS();if(e.cssText!==o)return e.cssText=o,r.forEach(function(t){t.style.cssText+=o}),t},this):this},r.setTarget=function(t){return this.target=t,this.targetFunc=function(e){var r=e.get();for(var i in r)t[i]=r[i]},this},r.setCSS=function(t,e){return void 0===e&&(e=[]),this.set(t,fromCSS(this.elements,e)),this},r.setTime=function(e,r,i,n){t.prototype.setTime.call(this,e,r,i);var s=this.getIterationTime(),a=this.getEasing()||n,o=this.getNowFrame(s,a),u=this.getTime();return this.temp=o,this.trigger("animate",{frame:o,currentTime:u,time:s}),this.targetFunc&&this.targetFunc(o),this},r.update=function(){var t=this.nameMap,e={};this.forEach(function(t){updateFrame(e,t.properties)});var r=new OrderMap(NAME_SEPARATOR);return function e(i,n){var s=getKeys(i);sortOrders(s,t.get(n)),r.set(n,s),s.forEach(function(t){var r=i[t];isObject(r)&&e(r,__spreadArrays(n,[t]))})}(e,[]),this.nameMap=r,this.forEach(function(t){t.setOrderObject(r.orderMap)}),this.needUpdate=!1,this},r.newFrame=function(t){var e=this.getFrame(t);return e||(e=new Frame,this.setFrame(t,e),e)},r.setFrame=function(t,e){var r=this.getUnitTime(t);return this.items[r]=e,addTime(this.times,r),this.needUpdate=!0,this},r.getFrame=function(t){return this.items[this.getUnitTime(t)]},r.removeFrame=function(t){var e=this.getUnitTime(t),r=this.items,i=this.times.indexOf(e);return delete r[e],i>-1&&this.times.splice(i,1),this.needUpdate=!0,this},r.hasFrame=function(t){return this.getUnitTime(t)in this.items},r.hasName=function(t){return this.needUpdate&&this.update(),!!this.nameMap.get(t)},r.mergeFrame=function(t,e){e&&this.newFrame(t).merge(e);return this},r.getNowFrame=function(t,e,r){var i=this;this.needUpdate&&this.update();var n=new Frame,s=getNearTimeIndex(this.times,t),a=s[0],o=s[1],u=this.getEasing()||e,h=this.nameMap;if(this.hasName([TIMING_FUNCTION])){var c=this.getNowValue(t,[TIMING_FUNCTION],a,o,!1,0,!0);isFunction(c)&&(u=c)}if(r){var f=this.getFrame(t),l=f.orderMap.filter([],function(t){return f.has.apply(f,t)});for(var E in ROLES){var d=h.get([E]);l.get([E])&&d&&l.set([E],d)}h=l}var p=h.gets([]);return n.setOrderObject(h.orderMap),p.forEach(function(e){var s=i.getNowValue(t,e,a,o,r,u,isFixed(e));isUndefined(s)||n.set(e,s)}),n},r.load=function(t,e){var r;if(void 0===t&&(t={}),void 0===e&&(e=t.options),e&&this.setOptions(e),isArray(t))this.set(t);else if(t.keyframes)this.set(t.keyframes);else for(var i in t)"options"!==i&&this.set(((r={})[i]=t[i],r));return e&&e[DURATION]&&this.setDuration(e[DURATION]),this},r.clone=function(){var t=new e;return t.setOptions(this.state),t.setOrderObject(this.nameMap.orderMap),this.forEach(function(e,r){t.setFrame(r,e.clone())}),t},r.forEach=function(t){var e=this.times,r=this.items;return e.forEach(function(e){t(r[e],e,r)}),this},r.setOptions=function(e){void 0===e&&(e={}),t.prototype.setOptions.call(this,e);var r=e.id,i=e.selector,n=e.elements,s=e.element,a=e.target;return r&&this.setId(r),a?this.setTarget(a):i?this.setSelector(i):(n||s)&&this.setElement(n||s),this},r.toCSS=function(t,e,r){void 0===t&&(t={className:START_ANIMATION}),void 0===e&&(e=this.getDuration()),void 0===r&&(r=[]);var i=this.state,n=i[SELECTOR];if(!n)return"";var s=this.getDuration();i[DURATION]=s,r.push(i);var a=toArray(r).reverse(),o=toId(getRealId(this)),u=r[0],h=findIndex(a,function(t){return t[ITERATION_COUNT]===INFINITE||!isFinite(t[DURATION])},r.length-1),c=a.slice(0,h),f=e||c.reduce(function(t,e){return(e[DELAY]+t*e[ITERATION_COUNT])/e[PLAY_SPEED]},s),l=a.slice(h).reduce(function(t,e){return(t+e[DELAY])/e[PLAY_SPEED]},0),E=find(a,function(t){return t[EASING]&&t[EASING_NAME]},i)[EASING_NAME],d=a[h][ITERATION_COUNT],p=u[FILL_MODE],m=a[h][DIRECTION],T=makeAnimationProperties({fillMode:p,direction:m,iterationCount:d,delay:l+"s",name:PREFIX+"KEYFRAMES_"+o,duration:f/u[PLAY_SPEED]+"s",timingFunction:E}),A=splitComma(n).map(function(t){var e=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(t);return e?[e[1],e[2]]:[t,""]}),v=t.className,I=t.selector;return"\n    "+((isFunction(I)?I(this,n):I)||A.map(function(t){var e=t[0],r=t[1];return e+"."+v+r}))+" {"+T+"}\n    "+A.map(function(t){var e=t[0],r=t[1];return e+"."+PAUSE_ANIMATION+r})+" {"+ANIMATION+"-play-state: paused;}\n    @"+KEYFRAMES+" "+PREFIX+"KEYFRAMES_"+o+"{"+this._toKeyframes(f,c,m)+"}"},r.exportCSS=function(t,e,r){if(!this.elements.length)return"";var i=this.toCSS(t,e,r);return r&&!isUndefined(r[ITERATION_COUNT])||(this.styledInjector&&(this.styledInjector.destroy(),this.styledInjector=null),this.styled=styled(i),this.styledInjector=this.styled.inject(this.getAnimationElement(),{original:!0})),this},r.pause=function(){return t.prototype.pause.call(this),isPausedCSS(this)&&this.pauseCSS(),this},r.pauseCSS=function(){return this.elements.forEach(function(t){addClass(t,PAUSE_ANIMATION)}),this},r.endCSS=function(){return this.elements.forEach(function(t){removeClass(t,PAUSE_ANIMATION),removeClass(t,START_ANIMATION)}),setPlayCSS(this,!1),this},r.end=function(){return isEndedCSS(this)&&this.endCSS(),t.prototype.end.call(this),this},r.playCSS=function(t,e,r){return void 0===t&&(t=!0),void 0===r&&(r={}),playCSS(this,t,e,r),this},r.getAnimationElement=function(){return this.elements[0]},r.addPlayClass=function(t,e,r){void 0===r&&(r={});var i=this.elements,n=i.length,s=makeAnimationProperties(r);if(n)return t?i.forEach(function(t){removeClass(t,PAUSE_ANIMATION)}):(i.forEach(function(t){t.style.cssText+=s,hasClass(t,START_ANIMATION)&&removeClass(t,START_ANIMATION)}),i.forEach(function(t){t.clientWidth}),i.forEach(function(t){addClass(t,START_ANIMATION)})),i[0]},r.clear=function(){return this.times=[],this.items={},this.nameMap=new OrderMap(NAME_SEPARATOR),this.styledInjector&&this.styledInjector.destroy(),this.styled=null,this.styledInjector=null,this.temp=null,this.needUpdate=!0,this},r.getNowValue=function(t,e,r,i,n,s,a){var o,u,h,c,f=this.times,l=f.length,E=isUndefined(r),d=isUndefined(i);if(E||d){var p=getNearTimeIndex(f,t);E&&(r=p[0]),d&&(i=p[1])}for(var m=r;m>=0;--m){if((A=this.getFrame(f[m])).has.apply(A,e)){o=f[m],h=A;break}}var T=h&&h.raw.apply(h,e);if(n&&!isRole([e[0]]))return o===t?T:void 0;if(a)return T;for(m=i;m<l;++m){var A;if((A=this.getFrame(f[m])).has.apply(A,e)){u=f[m],c=A;break}}var v=c&&c.raw.apply(c,e);return!h||isUndefined(T)?v:!c||isUndefined(v)||T===v?T:dotValue(t,Math.max(o,0),u,T,v,s)},r._toKeyframes=function(t,e,r){var i=this,n={},s=this.times.slice();if(!s.length)return"";var a=this.getDuration();!this.getFrame(0)&&s.unshift(0),!this.getFrame(a)&&s.push(a);var o=getEntries(s,e),u=o[o.length-1];u[0]<t&&addEntry(o,t,u[1]);var h=-1;return o.map(function(e){var s=e[0],o=e[1];n[o]||(n[o]=(i.hasFrame(o)&&0!==o&&o!==a?i.getNowFrame(o,0,!0):i.getNowFrame(o)).toCSS());var u=s/t*100;return u-h<THRESHOLD&&(u+=THRESHOLD),h=u,Math.min(u,100)+"%{\n                "+(0!==s||isDirectionReverse(0,1,r)?n[o]:"")+"\n            }"}).join("")},r.updateFrameOrders=function(){var t=this.nameMap.orderMap;this.forEach(function(e){e.setOrderObject(t)})},e}(Animator),Scene=function(t){function e(e,r){var i=t.call(this)||this;return i.items={},i.orderMap=new OrderMap(NAME_SEPARATOR),i.load(e,r),i}__extends(e,t);var r=e.prototype;return r.getDuration=function(){var t=0;return this.forEach(function(e){t=Math.max(t,e.getTotalDuration()/e.getPlaySpeed())}),t||this.state[DURATION]},r.setDuration=function(e){this.items;var r=this.getDuration();if(0===e||!isFinite(r))return this;if(0===r)this.forEach(function(t){t.setDuration(e)});else{var i=e/r;this.forEach(function(t){t.setDelay(t.getDelay()*i),t.setDuration(t.getDuration()*i)})}return t.prototype.setDuration.call(this,e),this},r.getItem=function(t){return this.items[t]},r.newItem=function(t,e){if(void 0===e&&(e={}),this.items[t])return this.items[t];var r=new SceneItem;return this.setItem(t,r),r.setOptions(e),r},r.removeItem=function(t){return delete this.items[t],this.orderMap.remove([t]),this},r.setItem=function(t,e){return e.setId(t),this.items[t]=e,this.orderMap.add([t]),this},r.setTime=function(e,r,i,n){t.prototype.setTime.call(this,e,r,i);var s=this.getIterationTime(),a=this.getEasing()||n,o={};return this.forEach(function(t){t.setTime(s*t.getPlaySpeed()-t.getDelay(),r,!0,a),o[t.getId()]=t.temp}),this.temp=o,this.trigger("animate",{frames:o,currentTime:this.getTime(),time:s}),this},r.forEach=function(t){var e=this.items;return this.getOrders().forEach(function(r,i){t(e[r],r,i,e)}),this},r.toCSS=function(t,e,r){void 0===e&&(e=this.getDuration()),void 0===r&&(r=[]);var i=e&&isFinite(e)?e:0,n=[],s=this.state;return s[DURATION]=this.getDuration(),this.forEach(function(e){n.push(e.toCSS(t,i,r.concat(s)))}),n.join("")},r.exportCSS=function(t,e,r){var i=this.toCSS(t,e,r);return r&&r.length||(this.styledInjector&&(this.styledInjector.destroy(),this.styledInjector=null),this.styled=styled(i),this.styledInjector=this.styled.inject(this.getAnimationElement(),{original:!0})),this},r.append=function(t){t.setDelay(t.getDelay()+this.getDuration()),this.setItem(getRealId(t),t)},r.pauseCSS=function(){return this.forEach(function(t){t.pauseCSS()})},r.pause=function(){return t.prototype.pause.call(this),isPausedCSS(this)&&this.pauseCSS(),this.forEach(function(t){t.pause()}),this},r.endCSS=function(){this.forEach(function(t){t.endCSS()}),setPlayCSS(this,!1)},r.end=function(){return isEndedCSS(this)&&this.endCSS(),t.prototype.end.call(this),this},r.getOrders=function(){return this.orderMap.get([])||[]},r.setOrders=function(t){return this.orderMap.set([],t)},r.getAnimationElement=function(){var t;return this.forEach(function(e){var r=e.getAnimationElement();!t&&(t=r)}),t},r.addPlayClass=function(t,e,r){var i;return void 0===r&&(r={}),this.forEach(function(n){var s=n.addPlayClass(t,e,r);!i&&(i=s)}),i},r.playCSS=function(t,e,r){return void 0===t&&(t=!0),void 0===r&&(r={}),playCSS(this,t,e,r),this},r.set=function(t){return this.load(t),this},r.clear=function(){this.finish(),this.items={},this.orderMap=new OrderMap(NAME_SEPARATOR),this.styledInjector&&this.styledInjector.destroy(),this.styled=null,this.styledInjector=null},r.load=function(t,r){if(void 0===t&&(t={}),void 0===r&&(r=t.options),!t)return this;var i=r&&r[SELECTOR]||this.state[SELECTOR];for(var n in t)if("options"!==n){var s=t[n],a=void 0;if(s instanceof e||s instanceof SceneItem)this.setItem(n,s),a=s;else{if(isFunction(s)&&i){for(var o=IS_WINDOW?$(""+(isFunction(i)?i(n):n),!0):[],u=o.length,h=new e,c=0;c<u;++c)h.newItem(c).setId().setElement(o[c]).load(s(c,o[c]));this.setItem(n,h);continue}(a=this.newItem(n)).load(s)}i&&a.setSelector(i)}this.setOptions(r)},r.setOptions=function(e){void 0===e&&(e={}),t.prototype.setOptions.call(this,e);var r=e.selector;return r&&(this.state[SELECTOR]=r),this},r.setSelector=function(t){var e=this.state,r=t||e[SELECTOR];e[SELECTOR]=r;var i=isFunction(t);return r&&this.forEach(function(e,n){e.setSelector(i?t(n):r)}),this},r.start=function(e){void 0===e&&(e=this.state[DELAY]);var r=t.prototype.start.call(this,e);return r?this.forEach(function(t){t.start(0)}):this.forEach(function(t){t.setPlayState(RUNNING)}),r},e.VERSION="1.5.0",e}(Animator);function animate(t,e){return new Scene(t,e).play()}function animateItem(t,e){return new SceneItem(t,e).play()}export default Scene;export{Animator,EASE,EASE_IN,EASE_IN_OUT,EASE_OUT,EVENTS,FIXED,Frame,LINEAR,NAME_SEPARATOR,OPTIONS,ROLES,STEP_END,STEP_START,SceneItem,animate,animateItem,bezier,isRole,setAlias,setRole,steps};