!function(t){t.lvector={VERSION:"1.6.0",noConflict:function(){return t.lvector=this._originallvector,this},_originallvector:t.lvector}}(this),lvector.Layer=L.Class.extend({options:{fields:"",scaleRange:null,map:null,uniqueField:null,visibleAtScale:!0,dynamic:!1,autoUpdate:!1,autoUpdateInterval:null,popupTemplate:null,popupOptions:{},singlePopup:!1,symbology:null,showAll:!1},initialize:function(t){L.Util.setOptions(this,t)},setMap:function(t){if(!t||!this.options.map)if(t){if(this.options.map=t,this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length){var t=this.options.map.getZoom(),e=this.options.scaleRange;this.options.visibleAtScale=t>=e[0]&&t<=e[1]}this._show()}else this.options.map&&(this._hide(),this.options.map=t)},getMap:function(){return this.options.map},setOptions:function(){},_show:function(){if(this._addIdleListener(),this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&this._addZoomChangeListener(),this.options.visibleAtScale){if(this.options.autoUpdate&&this.options.autoUpdateInterval){var t=this;this._autoUpdateInterval=setInterval(function(){t._getFeatures()},this.options.autoUpdateInterval)}this.options.map.fire("moveend").fire("zoomend")}},_hide:function(){this._idleListener&&this.options.map.off("moveend",this._idleListener),this._zoomChangeListener&&this.options.map.off("zoomend",this._zoomChangeListener),this._autoUpdateInterval&&clearInterval(this._autoUpdateInterval),this._clearFeatures(),this._lastQueriedBounds=null,this._gotAll&&(this._gotAll=!1)},_hideVectors:function(){for(var t=0;t<this._vectors.length;t++)if(this._vectors[t].vector&&(this.options.map.removeLayer(this._vectors[t].vector),this._vectors[t].popup?this.options.map.removeLayer(this._vectors[t].popup):this.popup&&this.popup.associatedFeature&&this.popup.associatedFeature==this._vectors[t]&&(this.options.map.removeLayer(this.popup),this.popup=null)),this._vectors[t].vectors&&this._vectors[t].vectors.length)for(var e=0;e<this._vectors[t].vectors.length;e++)this.options.map.removeLayer(this._vectors[t].vectors[e]),this._vectors[t].vectors[e].popup?this.options.map.removeLayer(this._vectors[t].vectors[e].popup):this.popup&&this.popup.associatedFeature&&this.popup.associatedFeature==this._vectors[t]&&(this.options.map.removeLayer(this.popup),this.popup=null)},_showVectors:function(){for(var t=0;t<this._vectors.length;t++)if(this._vectors[t].vector&&this.options.map.addLayer(this._vectors[t].vector),this._vectors[t].vectors&&this._vectors[t].vectors.length)for(var e=0;e<this._vectors[t].vectors.length;e++)this.options.map.addLayer(this._vectors[t].vectors[e])},_clearFeatures:function(){this._hideVectors(),this._vectors=[]},_addZoomChangeListener:function(){this._zoomChangeListener=this._zoomChangeListenerTemplate(),this.options.map.on("zoomend",this._zoomChangeListener,this)},_zoomChangeListenerTemplate:function(){var t=this;return function(){t._checkLayerVisibility()}},_idleListenerTemplate:function(){var t=this;return function(){t.options.visibleAtScale&&(t.options.showAll?t._gotAll||(t._getFeatures(),t._gotAll=!0):t._getFeatures())}},_addIdleListener:function(){this._idleListener=this._idleListenerTemplate(),this.options.map.on("moveend",this._idleListener,this)},_checkLayerVisibility:function(){var t=this.options.visibleAtScale,e=this.options.map.getZoom(),o=this.options.scaleRange;if(this.options.visibleAtScale=e>=o[0]&&e<=o[1],t!==this.options.visibleAtScale&&this[this.options.visibleAtScale?"_showVectors":"_hideVectors"](),t&&!this.options.visibleAtScale&&this._autoUpdateInterval)clearInterval(this._autoUpdateInterval);else if(!t&&this.options.autoUpdate&&this.options.autoUpdateInterval){var s=this;this._autoUpdateInterval=setInterval(function(){s._getFeatures()},this.options.autoUpdateInterval)}},_setPopupContent:function(t){var e,o=t.popupContent,s=t.attributes||t.properties;if("string"==typeof this.options.popupTemplate){e=this.options.popupTemplate;for(var i in s)e=e.replace(RegExp("{"+i+"}","g"),s[i])}else{if("function"!=typeof this.options.popupTemplate)return;e=this.options.popupTemplate(s)}t.popupContent=e,t.popup?t.popupContent!==o&&t.popup.setContent(t.popupContent):this.popup&&this.popup.associatedFeature==t&&t.popupContent!==o&&this.popup.setContent(t.popupContent)},_showPopup:function(t,e){var o=e.latlng;o||L.Util.extend(this.options.popupOptions,{offset:e.target.options.icon.options.popupAnchor});var s;this.options.singlePopup?(this.popup&&(this.options.map.removeLayer(this.popup),this.popup=null),this.popup=new L.Popup(this.options.popupOptions,t.vector),this.popup.associatedFeature=t,s=this):(t.popup=new L.Popup(this.options.popupOptions,t.vector),s=t),s.popup.setLatLng(o?e.latlng:e.target.getLatLng()),s.popup.setContent(t.popupContent),this.options.map.addLayer(s.popup)},_fireClickEvent:function(t,e){this.options.clickEvent(t,e)},_getFeatureVectorOptions:function(t){var e={},t=t.attributes||t.properties;if(this.options.symbology)switch(this.options.symbology.type){case"single":for(var o in this.options.symbology.vectorOptions)if(e[o]=this.options.symbology.vectorOptions[o],e.title)for(var s in t){var i=RegExp("{"+s+"}","g");e.title=e.title.replace(i,t[s])}break;case"unique":for(var r=this.options.symbology.property,n=0,a=this.options.symbology.values.length;a>n;n++)if(t[r]==this.options.symbology.values[n].value)for(o in this.options.symbology.values[n].vectorOptions)if(e[o]=this.options.symbology.values[n].vectorOptions[o],e.title)for(s in t)i=RegExp("{"+s+"}","g"),e.title=e.title.replace(i,t[s]);break;case"range":for(r=this.options.symbology.property,n=0,a=this.options.symbology.ranges.length;a>n;n++)if(t[r]>=this.options.symbology.ranges[n].range[0]&&t[r]<=this.options.symbology.ranges[n].range[1])for(o in this.options.symbology.ranges[n].vectorOptions)if(e[o]=this.options.symbology.ranges[n].vectorOptions[o],e.title)for(s in t)i=RegExp("{"+s+"}","g"),e.title=e.title.replace(i,t[s])}return e},_getPropertiesChanged:function(t,e){var o,s=!1;for(o in t)t[o]!=e[o]&&(s=!0);return s},_getPropertyChanged:function(t,e,o){return t[o]!=e[o]},_getGeometryChanged:function(t,e){var o=!1;return t.coordinates&&t.coordinates instanceof Array?t.coordinates[0]==e.coordinates[0]&&t.coordinates[1]==e.coordinates[1]||(o=!0):t.x==e.x&&t.y==e.y||(o=!0),o},_makeJsonpRequest:function(t){var e=document.getElementsByTagName("head")[0],o=document.createElement("script");o.type="text/javascript",o.src=t,e.appendChild(o)},_processFeatures:function(t){if(this.options.map){var e=this.options.map.getBounds();if(!this._lastQueriedBounds||!this._lastQueriedBounds.equals(e)||this.options.autoUpdate){if(this._lastQueriedBounds=e,featuresHaveIds=!!(t.features&&t.features.length&&t.features[0].id),!this.options.uniqueField&&!featuresHaveIds&&this._clearFeatures(),this instanceof lvector.PRWSF){t.features=t.rows,delete t.rows;for(var e=0,o=t.features.length;o>e;e++){t.features[e].type="Feature",t.features[e].properties={};for(var s in t.features[e].row)"geojson"==s?t.features[e].geometry=t.features[e].row.geojson:t.features[e].properties[s]=t.features[e].row[s];delete t.features[e].row}}if(this instanceof lvector.GISCloud)for(t.features=t.data,delete t.data,e=0,o=t.features.length;o>e;e++)t.features[e].type="Feature",t.features[e].properties=t.features[e].data,t.features[e].properties.id=t.features[e].__id,delete t.features[e].data,t.features[e].geometry=t.features[e].__geometry,delete t.features[e].__geometry;if(t&&t.features&&t.features.length)for(e=0;e<t.features.length;e++){if(this instanceof lvector.EsriJSONLayer&&(t.features[e].properties=t.features[e].attributes,delete t.features[e].attributes),s=!1,o=!!t.features[e].id,this.options.uniqueField||o)for(var i=0;i<this._vectors.length;i++){var r=!!this._vectors[i].id;if((o&&r&&t.features[e].id==this._vectors[i].id||this.options.uniqueField&&t.features[e].properties[this.options.uniqueField]==this._vectors[i].properties[this.options.uniqueField])&&(s=!0,this.options.dynamic&&(!this._getGeometryChanged(this._vectors[i].geometry,t.features[e].geometry)||isNaN(t.features[e].geometry.coordinates[0])||isNaN(t.features[e].geometry.coordinates[1])||(this._vectors[i].geometry=t.features[e].geometry,this._vectors[i].vector.setLatLng(new L.LatLng(this._vectors[i].geometry.coordinates[1],this._vectors[i].geometry.coordinates[0]))),this._getPropertiesChanged(this._vectors[i].properties,t.features[e].properties)&&(r=this._getPropertyChanged(this._vectors[i].properties,t.features[e].properties,this.options.symbology.property),this._vectors[i].properties=t.features[e].properties,this.options.popupTemplate&&this._setPopupContent(this._vectors[i]),this.options.symbology&&"single"!=this.options.symbology.type&&r))))if(this._vectors[i].vectors)for(var r=0,n=this._vectors[i].vectors.length;n>r;r++)this._vectors[i].vectors[r].setStyle?this._vectors[i].vectors[r].setStyle(this._getFeatureVectorOptions(this._vectors[i])):this._vectors[i].vectors[r].setIcon&&this._vectors[i].vectors[r].setIcon(this._getFeatureVectorOptions(this._vectors[i]).icon);else this._vectors[i].vector&&(this._vectors[i].vector.setStyle?this._vectors[i].vector.setStyle(this._getFeatureVectorOptions(this._vectors[i])):this._vectors[i].vector.setIcon&&this._vectors[i].vector.setIcon(this._getFeatureVectorOptions(this._vectors[i]).icon))}if(!s){if(this instanceof lvector.GeoJSONLayer?(s=this._geoJsonGeometryToLeaflet(t.features[e].geometry,this._getFeatureVectorOptions(t.features[e])),t.features[e][s instanceof Array?"vectors":"vector"]=s):this instanceof lvector.EsriJSONLayer&&(s=this._esriJsonGeometryToLeaflet(t.features[e].geometry,this._getFeatureVectorOptions(t.features[e])),t.features[e][s instanceof Array?"vectors":"vector"]=s),t.features[e].vector)this.options.map.addLayer(t.features[e].vector);else if(t.features[e].vectors&&t.features[e].vectors.length)for(r=0;r<t.features[e].vectors.length;r++)this.options.map.addLayer(t.features[e].vectors[r]);if(this._vectors.push(t.features[e]),this.options.popupTemplate){var a=this;s=t.features[e],this._setPopupContent(s),function(t){if(t.vector)t.vector.on("click",function(e){a._showPopup(t,e)});else if(t.vectors)for(var e=0,o=t.vectors.length;o>e;e++)t.vectors[e].on("click",function(e){a._showPopup(t,e)})}(s)}this.options.clickEvent&&(a=this,s=t.features[e],function(t){if(t.vector)t.vector.on("click",function(e){a._fireClickEvent(t,e)});else if(t.vectors)for(var e=0,o=t.vectors.length;o>e;e++)t.vectors[e].on("click",function(e){a._fireClickEvent(t,e)})}(s))}}}}}}),lvector.GeoJSONLayer=lvector.Layer.extend({_geoJsonGeometryToLeaflet:function(t,e){var o,s;switch(t.type){case"Point":o=e.circleMarker?new L.CircleMarker(new L.LatLng(t.coordinates[1],t.coordinates[0]),e):new L.Marker(new L.LatLng(t.coordinates[1],t.coordinates[0]),e);break;case"MultiPoint":s=[];for(var i=0,r=t.coordinates.length;r>i;i++)s.push(new L.Marker(new L.LatLng(t.coordinates[i][1],t.coordinates[i][0]),e));break;case"LineString":for(var n=[],i=0,r=t.coordinates.length;r>i;i++)n.push(new L.LatLng(t.coordinates[i][1],t.coordinates[i][0]));o=new L.Polyline(n,e);break;case"MultiLineString":for(s=[],i=0,r=t.coordinates.length;r>i;i++){for(var n=[],a=0,p=t.coordinates[i].length;p>a;a++)n.push(new L.LatLng(t.coordinates[i][a][1],t.coordinates[i][a][0]));s.push(new L.Polyline(n,e))}break;case"Polygon":for(var l=[],i=0,r=t.coordinates.length;r>i;i++){for(n=[],a=0,p=t.coordinates[i].length;p>a;a++)n.push(new L.LatLng(t.coordinates[i][a][1],t.coordinates[i][a][0]));l.push(n)}o=new L.Polygon(l,e);break;case"MultiPolygon":for(s=[],i=0,r=t.coordinates.length;r>i;i++){for(l=[],a=0,p=t.coordinates[i].length;p>a;a++){for(var n=[],h=0,c=t.coordinates[i][a].length;c>h;h++)n.push(new L.LatLng(t.coordinates[i][a][h][1],t.coordinates[i][a][h][0]));l.push(n)}s.push(new L.Polygon(l,e))}break;case"GeometryCollection":for(s=[],i=0,r=t.geometries.length;r>i;i++)s.push(this._geoJsonGeometryToLeaflet(t.geometries[i],e))}return o||s}}),lvector.EsriJSONLayer=lvector.Layer.extend({_esriJsonGeometryToLeaflet:function(t,e){var o,s;if(t.x&&t.y)o=new L.Marker(new L.LatLng(t.y,t.x),e);else if(t.points){s=[];for(var i=0,r=t.points.length;r>i;i++)s.push(new L.Marker(new L.LatLng(t.points[i].y,t.points[i].x),e))}else if(t.paths)if(t.paths.length>1)for(s=[],i=0,r=t.paths.length;r>i;i++){for(var n=[],a=0,p=t.paths[i].length;p>a;a++)n.push(new L.LatLng(t.paths[i][a][1],t.paths[i][a][0]));s.push(new L.Polyline(n,e))}else{for(n=[],i=0,r=t.paths[0].length;r>i;i++)n.push(new L.LatLng(t.paths[0][i][1],t.paths[0][i][0]));o=new L.Polyline(n,e)}else if(t.rings)if(t.rings.length>1)for(s=[],i=0,r=t.rings.length;r>i;i++){for(var l=[],n=[],a=0,p=t.rings[i].length;p>a;a++)n.push(new L.LatLng(t.rings[i][a][1],t.rings[i][a][0]));l.push(n),s.push(new L.Polygon(l,e))}else{for(l=[],n=[],i=0,r=t.rings[0].length;r>i;i++)n.push(new L.LatLng(t.rings[0][i][1],t.rings[0][i][0]));l.push(n),o=new L.Polygon(l,e)}return o||s}}),lvector.AGS=lvector.EsriJSONLayer.extend({initialize:function(t){for(var e=0,o=this._requiredParams.length;o>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');if(this._globalPointer="AGS_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,"/"!==t.url.substr(t.url.length-1,1)&&(t.url+="/"),this._originalOptions=L.Util.extend({},t),t.esriOptions){if("object"!=typeof t.esriOptions)return void this._getEsriOptions();L.Util.extend(t,this._convertEsriOptions(t.esriOptions))}lvector.Layer.prototype.initialize.call(this,t),this.options.where&&(this.options.where=encodeURIComponent(this.options.where)),this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{where:"1=1",url:null,useEsriOptions:!1},_requiredParams:["url"],_convertEsriOptions:function(t){var e={};if(void 0!=t.minScale&&void 0!=t.maxScale){var o=this._scaleToLevel(t.minScale),s=this._scaleToLevel(t.maxScale);0==s&&(s=20),e.scaleRange=[o,s]}return t.drawingInfo&&t.drawingInfo.renderer&&(e.symbology=this._renderOptionsToSymbology(t.drawingInfo.renderer)),e},_getEsriOptions:function(){this._makeJsonpRequest(this._originalOptions.url+"?f=json&callback="+this._globalPointer+"._processEsriOptions")},_processEsriOptions:function(t){var e=this._originalOptions;e.esriOptions=t,this.initialize(e)},_scaleToLevel:function(t){var e=[591657527.591555,295828763.795777,147914381.897889,73957190.948944,36978595.474472,18489297.737236,9244648.868618,4622324.434309,2311162.217155,1155581.108577,577790.554289,288895.277144,144447.638572,72223.819286,36111.909643,18055.954822,9027.977411,4513.988705,2256.994353,1128.497176,564.248588,282.124294];if(0==t)return 0;for(var o=0,s=0;s<e.length-1;s++){var i=e[s+1];if(t<=e[s]&&t>i){o=s;break}}return o},_renderOptionsToSymbology:function(t){switch(symbology={},t.type){case"simple":symbology.type="single",symbology.vectorOptions=this._parseSymbology(t.symbol);break;case"uniqueValue":symbology.type="unique",symbology.property=t.field1;for(var e=[],o=0;o<t.uniqueValueInfos.length;o++){var s=t.uniqueValueInfos[o],i={};i.value=s.value,i.vectorOptions=this._parseSymbology(s.symbol),i.label=s.label,e.push(i)}symbology.values=e;break;case"classBreaks":for(symbology.type="range",symbology.property=rend.field,e=[],s=t.minValue,o=0;o<t.classBreakInfos.length;o++){var i=t.classBreakInfos[o],r={};r.range=[s,i.classMaxValue],s=i.classMaxValue,r.vectorOptions=this._parseSymbology(i.symbol),r.label=i.label,e.push(r)}symbology.ranges=e}return symbology},_parseSymbology:function(t){var e={};switch(t.type){case"esriSMS":case"esriPMS":t=L.icon({iconUrl:"data:"+t.contentType+";base64,"+t.imageData,shadowUrl:null,iconSize:new L.Point(t.width,t.height),iconAnchor:new L.Point(t.width/2+t.xoffset,t.height/2+t.yoffset),popupAnchor:new L.Point(0,-(t.height/2))}),e.icon=t;break;case"esriSLS":e.weight=t.width,e.color=this._parseColor(t.color),e.opacity=this._parseAlpha(t.color[3]);break;case"esriSFS":t.outline?(e.weight=t.outline.width,e.color=this._parseColor(t.outline.color),e.opacity=this._parseAlpha(t.outline.color[3])):(e.weight=0,e.color="#000000",e.opacity=0),"esriSFSNull"!=t.style?(e.fillColor=this._parseColor(t.color),e.fillOpacity=this._parseAlpha(t.color[3])):(e.fillColor="#000000",e.fillOpacity=0)}return e},_parseColor:function(t){return red=this._normalize(t[0]),green=this._normalize(t[1]),blue=this._normalize(t[2]),"#"+this._pad(red.toString(16))+this._pad(green.toString(16))+this._pad(blue.toString(16))},_normalize:function(t){return 1>t&&t>0?Math.floor(255*t):t},_pad:function(t){return t.length>1?t.toUpperCase():"0"+t.toUpperCase()},_parseAlpha:function(t){return t/255},_getFeatures:function(){var t=this.options.url+"query?returnGeometry=true&outSR=4326&f=json&outFields="+this.options.fields+"&where="+this.options.where+"&callback="+this._globalPointer+"._processFeatures";this.options.showAll||(t+="&inSR=4326&spatialRel=esriSpatialRelIntersects&geometryType=esriGeometryEnvelope&geometry="+this.options.map.getBounds().toBBoxString()),this._makeJsonpRequest(t)}}),lvector.A2E=lvector.AGS.extend({initialize:function(t){for(var e=0,o=this._requiredParams.length;o>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');if(this._globalPointer="A2E_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,"/"!==t.url.substr(t.url.length-1,1)&&(t.url+="/"),this._originalOptions=L.Util.extend({},t),t.esriOptions){if("object"!=typeof t.esriOptions)return void this._getEsriOptions();L.Util.extend(t,this._convertEsriOptions(t.esriOptions))}if(lvector.Layer.prototype.initialize.call(this,t),this.options.where&&(this.options.where=encodeURIComponent(this.options.where)),this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show()),this.options.autoUpdate&&this.options.esriOptions.editFeedInfo){this._makeJsonpRequest("http://cdn.pubnub.com/pubnub-3.1.min.js");var s=this;this._pubNubScriptLoaderInterval=setInterval(function(){window.PUBNUB&&s._pubNubScriptLoaded()},200)}},_pubNubScriptLoaded:function(){clearInterval(this._pubNubScriptLoaderInterval),this.pubNub=PUBNUB.init({subscribe_key:this.options.esriOptions.editFeedInfo.pubnubSubscribeKey,ssl:!1,origin:"pubsub.pubnub.com"});var t=this;this.pubNub.subscribe({channel:this.options.esriOptions.editFeedInfo.pubnubChannel,callback:function(){t._getFeatures()},error:function(){}})}}),lvector.GeoIQ=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,o=this._requiredParams.length;o>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="GeoIQ_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{dataset:null},_requiredParams:["dataset"],_getFeatures:function(){var t="http://geocommons.com/datasets/"+this.options.dataset+"/features.json?geojson=1&callback="+this._globalPointer+"._processFeatures&limit=999";this.options.showAll||(t+="&bbox="+this.options.map.getBounds().toBBoxString()+"&intersect=full"),this._makeJsonpRequest(t)}}),lvector.CartoDB=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,o=this._requiredParams.length;o>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="CartoDB_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{version:1,user:null,table:null,fields:"*",where:null,limit:null,key:null,uniqueField:"cartodb_id"},_requiredParams:["user","table"],_getFeatures:function(){var t=this.options.where||"";if(!this.options.showAll)for(var e=this.options.map.getBounds(),o=e.getSouthWest(),e=e.getNorthEast(),s=this.options.table.split(",").length,i=0;s>i;i++)t+=(t.length?" AND ":"")+(s>1?this.options.table.split(",")[i].split(".")[0]+".the_geom":"the_geom")+" && st_setsrid(st_makebox2d(st_point("+o.lng+","+o.lat+"),st_point("+e.lng+","+e.lat+")),4326)";this.options.limit&&(t+=(t.length?" ":"")+"limit "+this.options.limit),t=t.length?" "+t:"",t="http://"+this.options.user+".cartodb.com/api/v"+this.options.version+"/sql?q="+encodeURIComponent("SELECT "+this.options.fields+" FROM "+this.options.table+(t.length?" WHERE "+t:""))+"&format=geojson&callback="+this._globalPointer+"._processFeatures",this.options.apiKey&&(t+="&api_key="+this.options.apiKey),this._makeJsonpRequest(t)}}),lvector.PRWSF=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,o=this._requiredParams.length;o>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');"/"!==t.url.substr(t.url.length-1,1)&&(t.url+="/"),lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="PRWSF_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{geotable:null,srid:null,geomFieldName:"the_geom",geomPrecision:"",fields:"",where:null,limit:null,uniqueField:null},_requiredParams:["url","geotable"],_getFeatures:function(){var t=this.options.where||"";if(!this.options.showAll){var e=this.options.map.getBounds(),o=e.getSouthWest(),e=e.getNorthEast();t+=t.length?" AND ":"",t+=this.options.srid?this.options.geomFieldName+" && transform(st_setsrid(st_makebox2d(st_point("+o.lng+","+o.lat+"),st_point("+e.lng+","+e.lat+")),4326),"+this.options.srid+")":"transform("+this.options.geomFieldName+",4326) && st_setsrid(st_makebox2d(st_point("+o.lng+","+o.lat+"),st_point("+e.lng+","+e.lat+")),4326)"}this.options.limit&&(t+=(t.length?" ":"")+"limit "+this.options.limit),o=(this.options.fields.length?this.options.fields+",":"")+"st_asgeojson(transform("+this.options.geomFieldName+",4326)"+(this.options.geomPrecision?","+this.options.geomPrecision:"")+") as geojson",this._makeJsonpRequest(this.options.url+"v1/ws_geo_attributequery.php?parameters="+encodeURIComponent(t)+"&geotable="+this.options.geotable+"&fields="+encodeURIComponent(o)+"&format=json&callback="+this._globalPointer+"._processFeatures")}}),lvector.GISCloud=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,o=this._requiredParams.length;o>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="GISCloud_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{mapID:null,layerID:null,uniqueField:"id"},_requiredParams:["mapID","layerID"],_getFeatures:function(){var t="http://api.giscloud.com/1/maps/"+this.options.mapID+"/layers/"+this.options.layerID+"/features.json?geometry=geojson&epsg=4326&callback="+this._globalPointer+"._processFeatures";this.options.showAll||(t+="&bounds="+this.options.map.getBounds().toBBoxString()),this.options.where&&(t+="&where="+encodeURIComponent(this.options.where)),this._makeJsonpRequest(t)}}),lvector.GitSpatial=lvector.GeoJSONLayer.extend({initialize:function(t){for(var e=0,o=this._requiredParams.length;o>e;e++)if(!t[this._requiredParams[e]])throw Error('No "'+this._requiredParams[e]+'" parameter found.');lvector.Layer.prototype.initialize.call(this,t),this._globalPointer="GitSpatial_"+Math.floor(1e5*Math.random()),window[this._globalPointer]=this,this._vectors=[],this.options.map&&(this.options.scaleRange&&this.options.scaleRange instanceof Array&&2===this.options.scaleRange.length&&(t=this.options.map.getZoom(),e=this.options.scaleRange,this.options.visibleAtScale=t>=e[0]&&t<=e[1]),this._show())},options:{},_requiredParams:["user","repo","featureSet"],_getFeatures:function(){var t="http://gitspatial.com/api/v1/"+this.options.user+"/"+this.options.repo+"/"+this.options.featureSet+"?callback="+this._globalPointer+"._processFeatures";this.options.showAll||(t+="&bbox="+this.options.map.getBounds().toBBoxString()),this._makeJsonpRequest(t)}});
//# sourceMappingURL=lvector.min.js.map