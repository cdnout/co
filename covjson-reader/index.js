!function(t,e){"use strict";function r(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=r;return e}function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function o(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}function a(t,e){return t[0]-e[0]}function i(){var t,e=this.stride,r=new Array(e.length);for(t=0;t<r.length;++t)r[t]=[Math.abs(e[t]),t];r.sort(a);var n=new Array(r.length);for(t=0;t<n.length;++t)n[t]=r[t][1];return n}function s(t,e){var r=["View",e,"d",t].join("");e<0&&(r="View_Nil"+t);var n="generic"===t;if(e===-1){var o="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}",a=new Function(o);return a()}if(0===e){var o="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}",a=new Function("TrivialArray",o);return a(q[t][0])}var o=["'use strict'"],s=F(e),u=s.map(function(t){return"i"+t}),f="this.offset+"+s.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),c=s.map(function(t){return"b"+t}).join(","),p=s.map(function(t){return"c"+t}).join(",");o.push("function "+r+"(a,"+c+","+p+",d){this.data=a","this.shape=["+c+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),o.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+s.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),e<4?(o.push("function "+r+"_order(){"),2===e?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+r+"_set("+u.join(",")+",v){"),n?o.push("return this.data.set("+f+",v)}"):o.push("return this.data["+f+"]=v}"),o.push("proto.get=function "+r+"_get("+u.join(",")+"){"),n?o.push("return this.data.get("+f+")}"):o.push("return this.data["+f+"]}"),o.push("proto.index=function "+r+"_index(",u.join(),"){return "+f+"}"),o.push("proto.hi=function "+r+"_hi("+u.join(",")+"){return new "+r+"(this.data,"+s.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+s.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var d=s.map(function(t){return"a"+t+"=this.shape["+t+"]"}),l=s.map(function(t){return"c"+t+"=this.stride["+t+"]"});o.push("proto.lo=function "+r+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+l.join(","));for(var h=0;h<e;++h)o.push("if(typeof i"+h+"==='number'&&i"+h+">=0){d=i"+h+"|0;b+=c"+h+"*d;a"+h+"-=d}");o.push("return new "+r+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"c"+t}).join(",")+",b)}"),o.push("proto.step=function "+r+"_step("+u.join(",")+"){var "+s.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+s.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var h=0;h<e;++h)o.push("if(typeof i"+h+"==='number'){d=i"+h+"|0;if(d<0){c+=b"+h+"*(a"+h+"-1);a"+h+"=ceil(-a"+h+"/d)}else{a"+h+"=ceil(a"+h+"/d)}b"+h+"*=d}");o.push("return new "+r+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"b"+t}).join(",")+",c)}");for(var v=new Array(e),y=new Array(e),h=0;h<e;++h)v[h]="a[i"+h+"]",y[h]="b[i"+h+"]";o.push("proto.transpose=function "+r+"_transpose("+u+"){"+u.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+v.join(",")+","+y.join(",")+",this.offset)}"),o.push("proto.pick=function "+r+"_pick("+u+"){var a=[],b=[],c=this.offset");for(var h=0;h<e;++h)o.push("if(typeof i"+h+"==='number'&&i"+h+">=0){c=(c+this.stride["+h+"]*i"+h+")|0}else{a.push(this.shape["+h+"]);b.push(this.stride["+h+"])}");o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+s.map(function(t){return"shape["+t+"]"}).join(",")+","+s.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}");var a=new Function("CTOR_LIST","ORDER",o.join("\n"));return a(q[t],i)}function u(t){if(B(t))return"buffer";if(G)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}function f(t,e,r,n){if(void 0===t){var o=q.array[0];return o([])}"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var a=e.length;if(void 0===r){r=new Array(a);for(var i=a-1,f=1;i>=0;--i)r[i]=f,f*=e[i]}if(void 0===n){n=0;for(var i=0;i<a;++i)r[i]<0&&(n-=(e[i]-1)*r[i])}for(var c=u(t),p=q[c];p.length<=a+1;)p.push(s(c,p.length-1));var o=p[a+1];return o(t,e,r,n)}function c(t,e){return e={exports:{}},t(e,e.exports),e.exports}function p(t,e){if(!t)throw e=e||"Assertion failed",new Error(e)}function d(t){var e=Object.create(Object.getPrototypeOf(t));for(var r in t)e[r]=t[r];return e}function l(t){var e=t["@context"];if(e){Array.isArray(e)||(e=[e]);var r=new Map,n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;if("string"!=typeof u){var f=!0,c=!1,p=void 0;try{for(var d,l=Object.keys(u)[Symbol.iterator]();!(f=(d=l.next()).done);f=!0){var h=d.value;"string"==typeof u[h]&&r.set(h,u[h])}}catch(t){c=!0,p=t}finally{try{!f&&l.return&&l.return()}finally{if(c)throw p}}}}}catch(t){o=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}}function h(t){var e=t?'; profile="'+$+'"':"",r=Z.COVJSON+e+"; q=1.0, "+Z.JSONLD+"; q=0.1, "+Z.JSON+"; q=0.1";return r}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"arraybuffer";if(["arraybuffer","text"].indexOf(r)===-1)throw new Error;var n=e.headers||{};return new Promise(function(o,a){var i=new XMLHttpRequest;i.open("GET",t),i.responseType=r;var s=h(e.eagerload);if(i.setRequestHeader("Accept",s),n){var u=!0,f=!1,c=void 0;try{for(var p,d=Object.keys(n)[Symbol.iterator]();!(u=(p=d.next()).done);u=!0){var l=p.value;i.setRequestHeader(l,n[l])}}catch(t){f=!0,c=t}finally{try{!u&&d.return&&d.return()}finally{if(f)throw c}}}i.addEventListener("load",function(){try{if(!(i.status>=200&&i.status<300||304===i.status))return void a(new Error('Resource "'+t+'" not found, HTTP status code: '+i.status));var e=void 0;if("arraybuffer"===r){if(!window.TextDecoder)return void a({responseType:"text"});var n=new Date;e=JSON.parse((new TextDecoder).decode(new DataView(i.response))),console.log("JSON decoding: "+(new Date-n)+"ms")}else{var s=new Date;e=JSON.parse(i.response),console.log("JSON decoding (slow path): "+(new Date-s)+"ms")}var u=y(i.getAllResponseHeaders());o({data:e,headers:u})}catch(t){a(t)}}),i.addEventListener("error",function(){a(new Error("Network error loading resource at "+t))}),i.send()}).catch(function(e){if(e.responseType)return v(t,n,e.responseType);throw e})}function y(t){var e={};if(!t)return e;for(var r=t.split("\r\n"),n=0;n<r.length;n++){var o=r[n],a=o.indexOf(": ");if(a>0){var i=o.substring(0,a).toLowerCase(),s=o.substring(a+2);e[i]=s}}return e}function m(t,e){if(!t)return e._axisNames;var r=[].concat(ot(t.axes.values())).filter(function(t){return t.values.length>1}).length>1,n=t._rangeAxisOrder||e._axisNames;if(r&&!n)throw new Error("Range axis order missing");return n=n||[].concat(ot(t.axes.keys()))}function g(t,e){if(!t)return e._shape;var r=m(t,e),n=r.map(function(e){return t.axes.get(e).values.length});if(e._shape){var o=e._shape.length===n.length&&e._shape.every(function(t,e){return t===n[e]});if(!o)throw new Error("range.shape must match domain axis sizes")}return n}function b(t){return function(e){return void 0===e&&(e=t.parameters.keys()),e=Array.from(e),Promise.all(e.map(function(e){return t.loadRange(e)})).then(function(t){for(var r=new Map,n=0;n<e.length;n++)r.set(e[n],t[n]);return r})}}function w(t,e){return function(r){return t.loadDomain().then(function(){var n=t._covjson.ranges[r];if("object"===("undefined"==typeof n?"undefined":tt(n))){var o=n;return x(t,r,o,t._covjson.domain,e)}var a=n;return v(a).then(function(n){var o=n.data;return x(t,r,o,t._covjson.domain,e)})})}}function x(t,r,n,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(a=e.normalizeIndexSubsetConstraints(o,a),"NdArray"===n.type||"Range"===n.type){k(n,o),t.options.cacheRanges&&(t._covjson.ranges[r]=n,t._updateLoadStatus());var i=S(n,o,a);return Promise.resolve(i)}if("TiledNdArray"===n.type)return j(n,a);throw new Error("Unsupported: "+n.type)}function j(t,e){function r(e){var r={};return e.forEach(function(e,n){return r[t.axisNames[n]]=e}),u.expand(r)}for(var n=t.axisNames.map(function(t){return e[t]}),o=function(e){return e.map(function(e,r){return null===e?t.shape[r]:e})},a=t.tileSets.map(function(t){return O(o(t.tileShape),n)}),i=A(a),s=t.tileSets[i],u=K.parse(s.urlTemplate),f=o(s.tileShape),c=[],p=0;p<f.length;p++){for(var d=n[p],l=d.start,h=d.stop,y=d.step,m=f[p],g=Math.floor(l/m),b=Math.ceil(h/m),w=[],x=g;x<b;x++){var j=(x+.5)*m,S=Math.floor((j-l)/y),T=l+S*y,E=l+(S+1)*y,N=x*m,D=(x+1)*m;(T>=N||D<=E)&&w.push(x)}c.push(w)}var M=_(c),R=n.map(function(t){var e=t.start,r=t.stop,n=t.step;return Math.floor((r-e)/n)+(r-e)%n});if(1===M.length&&R.every(function(t,e){return t===f[e]})){var V=r(M[0]);return v(V).then(function(t){var e=t.data;return k(e),e})}var L=function(){var e=R.reduce(function(t,e){return t*e}),o=z(new Array(e),R),a=M.map(function(t){var e=r(t);return v(e).then(function(e){var r=e.data;k(r);for(var a=t.map(function(t,e){return t*f[e]}),i=[],s=0;s<f.length;s++){var u=n[s],c=u.start,p=u.stop,d=u.step,l=f[s],h=a[s],v=[],y=0;h<c&&(y=c-h);var m=l;h+m>p&&(m=p-h);for(var g=y;g<m;g++){var b=h+g;(b-c)%d===0&&v.push(g)}i.push(v)}var w=_(i),x=!0,j=!1,O=void 0;try{for(var A,S=w[Symbol.iterator]();!(x=(A=S.next()).done);x=!0){var T,E=A.value,C=(T=r._ndarr).get.apply(T,ot(E)),N=E.map(function(t,e){var r=a[e]+t;return Math.floor((r-n[e].start)/n[e].step)});o.set.apply(o,ot(N).concat([C]))}}catch(t){j=!0,O=t}finally{try{!x&&S.return&&S.return()}finally{if(j)throw O}}})});return{v:Promise.all(a).then(function(){var e={dataType:t.dataType,get:C(o,t.axisNames),_ndarr:o,_axisNames:t.axisNames,_shape:R};return e.shape=new Map(t.axisNames.map(function(t,e){return[t,o.shape[e]]})),e})}}();if("object"===("undefined"==typeof L?"undefined":tt(L)))return L.v}function _(t){return t.reduce(function(t,e){return t.map(function(t){return e.map(function(e){return t.concat(e)})}).reduce(function(t,e){return t.concat(e)},[])},[[]])}function O(t,e){for(var r=1,n=0;n<t.length;n++){var o=e[n],a=o.start,i=o.stop,s=o.step,u=t[n],f=Math.floor(a/u),c=Math.ceil(i/u),p=u*(c-f);r*=Math.ceil(p/Math.max(s,u))}var d=r*t.reduce(function(t,e){return t*e});return{tileCount:r,valueCount:d}}function A(t){var e=1e3,r=t.map(function(t){return t.tileCount+t.valueCount/e}),n=r.reduce(function(t,e,r,n){return e<n[t]?r:t},0);return n}function S(t,e,r){var n,o,a=t._ndarr,i=m(e,t),s=i.map(function(t){return r[t].start}),u=i.map(function(t){return r[t].stop}),f=i.map(function(t){return r[t].step}),c=(n=(o=a.hi.apply(a,ot(u))).lo.apply(o,ot(s))).step.apply(n,ot(f)),p={dataType:t.dataType,get:C(c,i),_ndarr:c,_axisNames:i,_shape:c.shape};return p.shape=new Map(i.map(function(t,e){return[t,c.shape[e]]})),p}function T(t,r){return function(n){return t.loadDomain().then(function(o){n=e.normalizeIndexSubsetConstraints(o,n);var a=e.subsetDomainByIndex(o,n),i=D(n,r);o._rangeAxisOrder&&(a._rangeAxisOrder=o._rangeAxisOrder);var s={_covjson:t._covjson,options:t.options,type:e.COVERAGE,domainProfiles:t.domainProfiles,domainType:t.domainType,parameters:t.parameters,loadDomain:function(){return Promise.resolve(a)}};return s.loadRange=w(s,i),s.loadRanges=b(s),s.subsetByIndex=T(s,i),s.subsetByValue=e.subsetByValue.bind(null,s),s})}}function E(t,e){if(!("__transformDone"in t[e])){var r=t[e];if(r.key=e,r.unit&&"string"==typeof r.unit.symbol&&(r.unit.symbol={value:r.unit.symbol}),r.categoryEncoding){var n=new Map,o=!0,a=!1,i=void 0;try{for(var s,u=Object.keys(r.categoryEncoding)[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var f=s.value,c=r.categoryEncoding[f];Array.isArray(c)||(c=[c]),n.set(f,c)}}catch(t){a=!0,i=t}finally{try{!o&&u.return&&u.return()}finally{if(a)throw i}}r.categoryEncoding=n}r.__transformDone=!0}}function k(t,r){if(!("__transformDone"in t)){var n=t.values;if(void 0===t.actualMin){var o=e.minMax(n),a=nt(o,2),i=a[0],s=a[1];null!==i&&(t.actualMin=i,t.actualMax=s)}t.shape&&(t._shape=t.shape),t.axisNames&&(t._axisNames=t.axisNames,delete t.axisNames);var u=m(r,t),f=g(r,t),c=z(n,f);return t._ndarr=c,t.get=C(c,u),t.shape=new Map(u.map(function(t,e){return[t,f[e]]})),t.__transformDone=!0,t}}function C(t,e){for(var r="",n=0;n<e.length;n++)r&&(r+=","),r+="'"+e[n]+"' in obj ? obj['"+e[n]+"'] : 0";var o=new Function("ndarr","return function ndarrget (obj) { return ndarr.get("+r+") }")(t);return o}function N(t,e,r){if(!("__transformDone"in t)){r=t.domainType||r,r&&r.indexOf(":")===-1&&(r=Y+r),t.domainType=r;var n=new Map,o=!0,a=!1,i=void 0;try{for(var s,u=Object.keys(t.axes)[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var f=s.value;n.set(f,t.axes[f])}}catch(t){a=!0,i=t}finally{try{!o&&u.return&&u.return()}finally{if(a)throw i}}t.axes=n;var c=!0,p=!1,d=void 0;try{for(var l,h=n[Symbol.iterator]();!(c=(l=h.next()).done);c=!0){var v=nt(l.value,2),y=v[0],m=v[1];if(m.key=y,m.dataType&&m.dataType.indexOf(":")===-1&&(m.dataType=W+m.dataType),m.components&&(m.coordinates=m.components),m.coordinates||(m.coordinates=[y]),m.components=m.coordinates,"start"in m&&"stop"in m&&"num"in m){var g=new Float64Array(m.num),b=void 0;if(1===m.num){if(m.start!==m.stop)throw new Error("regular axis of length 1 must have equal start/stop values");b=0}else b=(m.stop-m.start)/(m.num-1);for(var w=0;w<m.num;w++)g[w]=m.start+w*b;m.values=g,delete m.start,delete m.stop,delete m.num}if(Array.isArray(m.values)&&"number"==typeof m.values[0]){for(var x=new Float64Array(m.values.length),j=0;j<m.values.length;j++)x[j]=m.values[j];m.values=x}m.bounds=M(m)}}catch(t){p=!0,d=t}finally{try{!c&&h.return&&h.return()}finally{if(p)throw d}}e&&(t.referencing=e);var _=!0,O=!1,A=void 0;try{for(var S,T=t.referencing[Symbol.iterator]();!(_=(S=T.next()).done);_=!0){var E=S.value;E.components&&(E.coordinates=E.components)}}catch(t){O=!0,A=t}finally{try{!_&&T.return&&T.return()}finally{if(O)throw A}}return t.rangeAxisOrder&&(t._rangeAxisOrder=t.rangeAxisOrder,delete t.rangeAxisOrder),t.__transformDone=!0,t}}function D(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},n=!0,o=!1,a=void 0;try{for(var i,s=Object.keys(t)[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value,f=t[u],c=e[u]||{},p=c.start,d=void 0===p?0:p,l=c.step,h=void 0===l?1:l;r[u]={start:d+h*f.start,stop:d+h*f.stop,step:h*f.step}}}catch(t){o=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}function M(t){if(t.bounds){var e=function(){var e=t.bounds;return{v:{get:function(t){return[e[2*t],e[2*t+1]]}}}}();if("object"===("undefined"==typeof e?"undefined":tt(e)))return e.v}}function R(t,e){return v(t,e)}function V(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"object"===("undefined"==typeof t?"undefined":tt(t))?Promise.resolve().then(function(){return L(t)}):R(t,e).then(function(t){var e=t.data,r=t.headers;return L(e,r)})}function L(t,r){if(P(t),[e.COVERAGE,e.COVERAGECOLLECTION,e.DOMAIN].indexOf(t.type)===-1)throw new Error("CoverageJSON document must be of Coverage, CoverageCollection, or Domain type");var n=void 0;return t.type===e.DOMAIN?(N(t),n=t):n=t.type===e.COVERAGE?new at(t):new it(t),t.type!==e.COVERAGE&&t.type!==e.COVERAGECOLLECTION||I(n,r),n}function I(t,e){if(e&&e.link){var r=t.ld,n=!0,o=!1,a=void 0;try{for(var i,s=e.link.split(",")[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;u=u.trim();var f=u.split(";"),c=f[0].substr(1,f[0].length-2),p=!0,d=!1,l=void 0;try{for(var h,v=f.slice(1)[Symbol.iterator]();!(p=(h=v.next()).done);p=!0){var y=h.value,m=y.indexOf("rel=");if(m!==-1){var g=y.substring(m+5,y.length-1);0!==g.indexOf("http://")&&0!==g.indexOf("https://")&&(g=X+g),r[g]?Array.isArray(r[g])?r[g].push(c):r[g]=[r[g],c]:r[g]=c}}}catch(t){d=!0,l=t}finally{try{!p&&v.return&&v.return()}finally{if(d)throw l}}}}catch(t){o=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}}}function P(t){p("type"in t,'"type" missing'),t.type===e.COVERAGE?(p("parameters"in t,'"parameters" missing'),p("domain"in t,'"domain" missing'),p("ranges"in t,'"ranges" missing')):t.type===e.COVERAGECOLLECTION&&p(Array.isArray(t.coverages),'"coverages" must be an array')}var J=r,U=function(t){return null!=t&&(n(t)||o(t)||!!t._isBuffer)},F=J,B=U,G="undefined"!=typeof Float64Array,q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]},z=f,H="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},K=c(function(t,e){!function(r,n){"object"==typeof e?t.exports=n():"function"==typeof define&&define.amd?define([],n):r.urltemplate=n()}(H,function(){function t(){}return t.prototype.encodeReserved=function(t){return t.split(/(%[0-9A-Fa-f]{2})/g).map(function(t){return/%[0-9A-Fa-f]/.test(t)||(t=encodeURI(t).replace(/%5B/g,"[").replace(/%5D/g,"]")),t}).join("")},t.prototype.encodeUnreserved=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})},t.prototype.encodeValue=function(t,e,r){return e="+"===t||"#"===t?this.encodeReserved(e):this.encodeUnreserved(e),r?this.encodeUnreserved(r)+"="+e:e},t.prototype.isDefined=function(t){return void 0!==t&&null!==t},t.prototype.isKeyOperator=function(t){return";"===t||"&"===t||"?"===t},t.prototype.getValues=function(t,e,r,n){var o=t[r],a=[];if(this.isDefined(o)&&""!==o)if("string"==typeof o||"number"==typeof o||"boolean"==typeof o)o=o.toString(),n&&"*"!==n&&(o=o.substring(0,parseInt(n,10))),a.push(this.encodeValue(e,o,this.isKeyOperator(e)?r:null));else if("*"===n)Array.isArray(o)?o.filter(this.isDefined).forEach(function(t){a.push(this.encodeValue(e,t,this.isKeyOperator(e)?r:null))},this):Object.keys(o).forEach(function(t){this.isDefined(o[t])&&a.push(this.encodeValue(e,o[t],t))},this);else{var i=[];Array.isArray(o)?o.filter(this.isDefined).forEach(function(t){i.push(this.encodeValue(e,t))},this):Object.keys(o).forEach(function(t){this.isDefined(o[t])&&(i.push(this.encodeUnreserved(t)),i.push(this.encodeValue(e,o[t].toString())))},this),this.isKeyOperator(e)?a.push(this.encodeUnreserved(r)+"="+i.join(",")):0!==i.length&&a.push(i.join(","))}else";"===e?this.isDefined(o)&&a.push(this.encodeUnreserved(r)):""!==o||"&"!==e&&"?"!==e?""===o&&a.push(""):a.push(this.encodeUnreserved(r)+"=");return a},t.prototype.parse=function(t){var e=this,r=["+","#",".","/",";","?","&"];return{expand:function(n){return t.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(t,o,a){if(o){var i=null,s=[];if(r.indexOf(o.charAt(0))!==-1&&(i=o.charAt(0),o=o.substr(1)),o.split(/,/g).forEach(function(t){var r=/([^:\*]*)(?::(\d+)|(\*))?/.exec(t);s.push.apply(s,e.getValues(n,i,r[1],r[2]||r[3]))}),i&&"+"!==i){var u=",";return"?"===i?u="&":"#"!==i&&(u=i),(0!==s.length?i:"")+s.join(u)}return s.join(",")}return e.encodeReserved(a)})}}},new t})}),X="http://www.iana.org/assignments/relation/",Q="https://covjson.org/def/",W=Q+"core#",Y=Q+"domainTypes#",Z={COVJSON:"application/prs.coverage+json",JSONLD:"application/ld+json",JSON:"application/json",TEXT:"text/plain"},$=W+"standalone",tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},et=(function(){function t(t){this.value=t}function e(e){function r(t,e){return new Promise(function(r,o){var s={key:t,arg:e,resolve:r,reject:o,next:null};i?i=i.next=s:(a=i=s,n(t,e))})}function n(r,a){try{var i=e[r](a),s=i.value;s instanceof t?Promise.resolve(s.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(i.done?"return":"normal",i.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":a.resolve({value:e,done:!0});break;case"throw":a.reject(e);break;default:a.resolve({value:e,done:!1})}a=a.next,a?n(a.key,a.arg):i=null}var a,i;this._invoke=r,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),rt=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),nt=function(){function t(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ot=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},at=function(){function t(r,n){et(this,t),this._covjson=r,this.type=e.COVERAGE,this.ld={},this._exposeLd(r),this.prefixes=l(this.ld),this.options=n?d(n):{},this.id=r.id,this.parameters=new Map;var o=!0,a=!1,i=void 0;try{for(var s,u=Object.keys(r.parameters)[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var f=s.value;E(r.parameters,f),this.parameters.set(f,r.parameters[f])}}catch(t){a=!0,i=t}finally{try{!o&&u.return&&u.return()}finally{if(a)throw i}}var c=void 0;c="string"==typeof this._covjson.domain?this._covjson.domainType:this._covjson.domain.domainType||this._covjson.domainType,c&&c.indexOf(":")===-1&&(c=Y+c),this.domainType=c,this._updateLoadStatus()}return rt(t,[{key:"_updateLoadStatus",value:function(){var t=this,e=function(t){return"object"===("undefined"==typeof t?"undefined":tt(t))},r=e(this._covjson.domain),n=Object.keys(this._covjson.ranges).every(function(r){return e(t._covjson.ranges[r])});this.loaded=r&&n}},{key:"_exposeLd",value:function(t){if(t["@context"]){var e=d(t);delete e.domain,delete e.ranges,this.ld=JSON.parse(JSON.stringify(e))}}},{key:"loadDomain",value:function(){var t=this,e=this._covjson.domain;if(this._domainPromise)return this._domainPromise;var r=void 0;if("object"===("undefined"==typeof e?"undefined":tt(e))){var n=e;N(n,this.options.referencing,this.domainType),r=Promise.resolve(n)}else{var o=e;r=v(o).then(function(e){var r=e.data;return N(r,t.options.referencing,t.domainType),t._covjson.domain=r,t._updateLoadStatus(),r})}return this._domainPromise=r,r}},{key:"loadRange",value:function(t){return w(this)(t)}},{key:"loadRanges",value:function(t){return b(this)(t)}},{key:"subsetByIndex",value:function(t){return T(this)(t)}},{key:"subsetByValue",value:function(t){return e.subsetByValue(this,t)}}]),t}(),it=function(){function t(r){et(this,t),this.type=e.COVERAGECOLLECTION,this.ld={},this._exposeLd(r),this.prefixes=l(this.ld),this.id=r.id;var n=r.domainType;n&&n.indexOf(":")===-1&&(n=Y+n),this.domainType=n;var o=[],a=r.parameters?r.parameters:{},i=!0,s=!1,u=void 0;try{for(var f,c=Object.keys(a)[Symbol.iterator]();!(i=(f=c.next()).done);i=!0){var p=f.value,d=a[p];d.id||(d.id=Math.round((new Date).getTime()*Math.random()).toString())}}catch(t){s=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(s)throw u}}var h={};r.referencing&&(h.referencing=r.referencing);var v=!0,y=!1,m=void 0;try{for(var g,b=r.coverages[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value;w.domainType||(w.domainType=n),w.parameters||(w.parameters={});var x=!0,j=!1,_=void 0;try{for(var O,A=Object.keys(a)[Symbol.iterator]();!(x=(O=A.next()).done);x=!0){var S=O.value;S in w.ranges&&(w.parameters[S]=a[S])}}catch(t){j=!0,_=t}finally{try{!x&&A.return&&A.return()}finally{if(j)throw _}}r["@context"]&&(w["@context"]=r["@context"]),o.push(new at(w,h))}}catch(t){y=!0,m=t}finally{try{!v&&b.return&&b.return()}finally{if(y)throw m}}if(this.coverages=o,r.parameters){this.parameters=new Map;var T=!0,k=!1,C=void 0;try{for(var D,M=Object.keys(r.parameters)[Symbol.iterator]();!(T=(D=M.next()).done);T=!0){var R=D.value;E(r.parameters,R),this.parameters.set(R,r.parameters[R])}}catch(t){k=!0,C=t}finally{try{!T&&M.return&&M.return()}finally{if(k)throw C}}}r.domainTemplate&&(N(r.domainTemplate),this.domainTemplate=r.domainTemplate)}return rt(t,[{key:"query",value:function(){return new e.CollectionQuery(this)}},{key:"_exposeLd",value:function(t){if(t["@context"]){var e=d(t);delete e.coverages,this.ld=JSON.parse(JSON.stringify(e))}}}]),t}();t.load=R,t.read=V}(this.CovJSON=this.CovJSON||{},CovUtils);
//# sourceMappingURL=covjson-reader.min.js.map
