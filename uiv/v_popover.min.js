import Vue from"vue";function isExist(t){return null!=t}function isFunction(t){return"function"==typeof t}function isString(t){return"string"==typeof t}function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var EVENTS={MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",FOCUS:"focus",BLUR:"blur",CLICK:"click",INPUT:"input",KEY_DOWN:"keydown",KEY_UP:"keyup",KEY_PRESS:"keypress",RESIZE:"resize",SCROLL:"scroll",TOUCH_START:"touchstart",TOUCH_END:"touchend"},TRIGGERS={CLICK:"click",HOVER:"hover",FOCUS:"focus",HOVER_FOCUS:"hover-focus",OUTSIDE_CLICK:"outside-click",MANUAL:"manual"},PLACEMENTS={TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"};function getViewportSize(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth)||0,height:Math.max(document.documentElement.clientHeight,window.innerHeight)||0}}function on(t,e,i){t.addEventListener(e,i)}function off(t,e,i){t.removeEventListener(e,i)}function isElement(t){return t&&t.nodeType===Node.ELEMENT_NODE}function removeFromDom(t){isElement(t)&&isElement(t.parentNode)&&t.parentNode.removeChild(t)}function ensureElementMatchesFunction(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),i=e.length;--i>=0&&e.item(i)!==this;);return i>-1})}function addClass(t,e){if(isElement(t))if(t.className){var i=t.className.split(" ");i.indexOf(e)<0&&(i.push(e),t.className=i.join(" "))}else t.className=e}function removeClass(t,e){if(isElement(t)&&t.className){for(var i=t.className.split(" "),o=[],n=0,s=i.length;n<s;n++)i[n]!==e&&o.push(i[n]);t.className=o.join(" ")}}function hasClass(t,e){if(!isElement(t))return!1;for(var i=t.className.split(" "),o=0,n=i.length;o<n;o++)if(i[o]===e)return!0;return!1}function isAvailableAtPosition(t,e,i){var o=t.getBoundingClientRect(),n=e.getBoundingClientRect(),s=getViewportSize(),r=!0,h=!0,l=!0,u=!0;switch(i){case PLACEMENTS.TOP:r=o.top>=n.height,u=o.left+o.width/2>=n.width/2,h=o.right-o.width/2+n.width/2<=s.width;break;case PLACEMENTS.BOTTOM:l=o.bottom+n.height<=s.height,u=o.left+o.width/2>=n.width/2,h=o.right-o.width/2+n.width/2<=s.width;break;case PLACEMENTS.RIGHT:h=o.right+n.width<=s.width,r=o.top+o.height/2>=n.height/2,l=o.bottom-o.height/2+n.height/2<=s.height;break;case PLACEMENTS.LEFT:u=o.left>=n.width,r=o.top+o.height/2>=n.height/2,l=o.bottom-o.height/2+n.height/2<=s.height}return r&&h&&l&&u}function setTooltipPosition(t,e,i,o,n,s,r){if(isElement(t)&&isElement(e)){var h,l,u=t&&t.className&&t.className.indexOf("popover")>=0;if(isExist(n)&&"body"!==n&&"body"!==s){var a=getElementBySelectorOrRef(s||n);l=a.scrollLeft,h=a.scrollTop}else{var E=document.documentElement;l=(window.pageXOffset||E.scrollLeft)-(E.clientLeft||0),h=(window.pageYOffset||E.scrollTop)-(E.clientTop||0)}if(o){var d=[PLACEMENTS.RIGHT,PLACEMENTS.BOTTOM,PLACEMENTS.LEFT,PLACEMENTS.TOP],c=function(e){d.forEach(function(e){removeClass(t,e)}),addClass(t,e)};if(!isAvailableAtPosition(e,t,i)){for(var g=0,m=d.length;g<m;g++)if(c(d[g]),isAvailableAtPosition(e,t,d[g])){i=d[g];break}c(i)}}var p,f,T,S=e.getBoundingClientRect(),v=t.getBoundingClientRect();if(i===PLACEMENTS.BOTTOM?(p=h+S.top+S.height,f=l+S.left+S.width/2-v.width/2):i===PLACEMENTS.LEFT?(p=h+S.top+S.height/2-v.height/2,f=l+S.left-v.width):i===PLACEMENTS.RIGHT?(p=h+S.top+S.height/2-v.height/2,f=l+S.left+S.width+1):(p=h+S.top-v.height,f=l+S.left+S.width/2-v.width/2),isString(r)?T=document.querySelector(r):isFunction(r)&&(T=r(e)),isElement(T)){var w=u?11:0,C=T.getBoundingClientRect(),O=h+C.top,N=l+C.left,I=O+C.height,L=N+C.width;p<O?p=O:p+v.height>I&&(p=I-v.height),f<N?f=N:f+v.width>L&&(f=L-v.width),i===PLACEMENTS.BOTTOM?p-=w:i===PLACEMENTS.LEFT?f+=w:i===PLACEMENTS.RIGHT?f-=w:p+=w}t.style.top=p+"px",t.style.left=f+"px"}}var MODAL_BACKDROP="modal-backdrop";function getOpenModals(){return document.querySelectorAll("."+MODAL_BACKDROP)}function getOpenModalNum(){return getOpenModals().length}function getElementBySelectorOrRef(t){return isString(t)?document.querySelector(t):isElement(t)?t:isElement(t.$el)?t.$el:null}var SHOW_CLASS="in",popupMixin={props:{value:{type:Boolean,default:!1},tag:{type:String,default:"span"},placement:{type:String,default:PLACEMENTS.TOP},autoPlacement:{type:Boolean,default:!0},appendTo:{type:null,default:"body"},positionBy:{type:null,default:null},transition:{type:Number,default:150},hideDelay:{type:Number,default:0},showDelay:{type:Number,default:0},enable:{type:Boolean,default:!0},enterable:{type:Boolean,default:!0},target:null,viewport:null,customClass:String},data:function(){return{triggerEl:null,hideTimeoutId:0,showTimeoutId:0,transitionTimeoutId:0,autoTimeoutId:0}},watch:{value:function(t){t?this.show():this.hide()},trigger:function(){this.clearListeners(),this.initListeners()},target:function(t){this.clearListeners(),this.initTriggerElByTarget(t),this.initListeners()},allContent:function(t){var e=this;this.isNotEmpty()?this.$nextTick(function(){e.isShown()&&e.resetPosition()}):this.hide()},enable:function(t){t||this.hide()}},mounted:function(){var t=this;ensureElementMatchesFunction(),removeFromDom(this.$refs.popup),this.$nextTick(function(){t.initTriggerElByTarget(t.target),t.initListeners(),t.value&&t.show()})},beforeDestroy:function(){this.clearListeners(),removeFromDom(this.$refs.popup)},methods:{initTriggerElByTarget:function(t){if(t)this.triggerEl=getElementBySelectorOrRef(t);else{var e=this.$el.querySelector('[data-role="trigger"]');if(e)this.triggerEl=e;else{var i=this.$el.firstChild;this.triggerEl=i===this.$refs.popup?null:i}}},initListeners:function(){this.triggerEl&&(this.trigger===TRIGGERS.HOVER?(on(this.triggerEl,EVENTS.MOUSE_ENTER,this.show),on(this.triggerEl,EVENTS.MOUSE_LEAVE,this.hide)):this.trigger===TRIGGERS.FOCUS?(on(this.triggerEl,EVENTS.FOCUS,this.show),on(this.triggerEl,EVENTS.BLUR,this.hide)):this.trigger===TRIGGERS.HOVER_FOCUS?(on(this.triggerEl,EVENTS.MOUSE_ENTER,this.handleAuto),on(this.triggerEl,EVENTS.MOUSE_LEAVE,this.handleAuto),on(this.triggerEl,EVENTS.FOCUS,this.handleAuto),on(this.triggerEl,EVENTS.BLUR,this.handleAuto)):this.trigger!==TRIGGERS.CLICK&&this.trigger!==TRIGGERS.OUTSIDE_CLICK||on(this.triggerEl,EVENTS.CLICK,this.toggle)),on(window,EVENTS.CLICK,this.windowClicked)},clearListeners:function(){this.triggerEl&&(off(this.triggerEl,EVENTS.FOCUS,this.show),off(this.triggerEl,EVENTS.BLUR,this.hide),off(this.triggerEl,EVENTS.MOUSE_ENTER,this.show),off(this.triggerEl,EVENTS.MOUSE_LEAVE,this.hide),off(this.triggerEl,EVENTS.CLICK,this.toggle),off(this.triggerEl,EVENTS.MOUSE_ENTER,this.handleAuto),off(this.triggerEl,EVENTS.MOUSE_LEAVE,this.handleAuto),off(this.triggerEl,EVENTS.FOCUS,this.handleAuto),off(this.triggerEl,EVENTS.BLUR,this.handleAuto)),off(window,EVENTS.CLICK,this.windowClicked),this.clearTimeouts()},clearTimeouts:function(){this.hideTimeoutId&&(clearTimeout(this.hideTimeoutId),this.hideTimeoutId=0),this.showTimeoutId&&(clearTimeout(this.showTimeoutId),this.showTimeoutId=0),this.transitionTimeoutId&&(clearTimeout(this.transitionTimeoutId),this.transitionTimeoutId=0),this.autoTimeoutId&&(clearTimeout(this.autoTimeoutId),this.autoTimeoutId=0)},resetPosition:function(){var t=this.$refs.popup;t&&(setTooltipPosition(t,this.triggerEl,this.placement,this.autoPlacement,this.appendTo,this.positionBy,this.viewport),t.offsetHeight)},hideOnLeave:function(){(this.trigger===TRIGGERS.HOVER||this.trigger===TRIGGERS.HOVER_FOCUS&&!this.triggerEl.matches(":focus"))&&this.$hide()},toggle:function(){this.isShown()?this.hide():this.show()},show:function(){var t=this;if(this.enable&&this.triggerEl&&this.isNotEmpty()&&!this.isShown()){var e=this.hideTimeoutId>0;e&&(clearTimeout(this.hideTimeoutId),this.hideTimeoutId=0),this.transitionTimeoutId>0&&(clearTimeout(this.transitionTimeoutId),this.transitionTimeoutId=0),clearTimeout(this.showTimeoutId),this.showTimeoutId=setTimeout(function(){t.showTimeoutId=0;var i=t.$refs.popup;if(i){var o=getOpenModalNum();if(o>1){var n="popover"===t.name?1060:1070,s=20*(o-1);i.style.zIndex=""+(n+s)}if(!e)i.className=t.name+" "+t.placement+" "+(t.customClass?t.customClass:"")+" fade",getElementBySelectorOrRef(t.appendTo).appendChild(i),t.resetPosition();addClass(i,SHOW_CLASS),t.$emit("input",!0),t.$emit("show")}},this.showDelay)}},hide:function(){var t=this;this.showTimeoutId>0&&(clearTimeout(this.showTimeoutId),this.showTimeoutId=0),this.isShown()&&(!this.enterable||this.trigger!==TRIGGERS.HOVER&&this.trigger!==TRIGGERS.HOVER_FOCUS?this.$hide():(clearTimeout(this.hideTimeoutId),this.hideTimeoutId=setTimeout(function(){t.hideTimeoutId=0;var e=t.$refs.popup;e&&!e.matches(":hover")&&t.$hide()},100)))},$hide:function(){var t=this;this.isShown()&&(clearTimeout(this.hideTimeoutId),this.hideTimeoutId=setTimeout(function(){t.hideTimeoutId=0,removeClass(t.$refs.popup,SHOW_CLASS),t.transitionTimeoutId=setTimeout(function(){t.transitionTimeoutId=0,removeFromDom(t.$refs.popup),t.$emit("input",!1),t.$emit("hide")},t.transition)},this.hideDelay))},isShown:function(){return hasClass(this.$refs.popup,SHOW_CLASS)},windowClicked:function(t){!this.triggerEl||!isFunction(this.triggerEl.contains)||this.triggerEl.contains(t.target)||this.trigger!==TRIGGERS.OUTSIDE_CLICK||this.$refs.popup&&this.$refs.popup.contains(t.target)||!this.isShown()||this.hide()},handleAuto:function(){var t=this;clearTimeout(this.autoTimeoutId),this.autoTimeoutId=setTimeout(function(){t.autoTimeoutId=0,t.triggerEl.matches(":hover, :focus")?t.show():t.hide()},20)}}},Popover={mixins:[popupMixin],data:function(){return{name:"popover"}},render:function(t){return t(this.tag,[this.$slots.default,t("div",{style:{display:"block"},ref:"popup",on:{mouseleave:this.hideOnLeave}},[t("div",{class:"arrow"}),t("h3",{class:"popover-title",directives:[{name:"show",value:this.title}]},this.title),t("div",{class:"popover-content"},[this.content||this.$slots.popover])])])},props:{title:{type:String,default:""},content:{type:String,default:""},trigger:{type:String,default:TRIGGERS.OUTSIDE_CLICK}},computed:{allContent:function(){return this.title+this.content}},methods:{isNotEmpty:function(){return this.title||this.content||this.$slots.popover}}},INSTANCE="_uiv_popover_instance",bind=function(t,e){unbind(t);var i=new(Vue.extend(Popover))({propsData:{target:t,appendTo:e.arg&&"#"+e.arg,title:e.value&&e.value.title&&e.value.title.toString(),positionBy:e.value&&e.value.positionBy&&e.value.positionBy.toString(),content:e.value&&e.value.content&&e.value.content.toString(),viewport:e.value&&e.value.viewport&&e.value.viewport.toString(),customClass:e.value&&e.value.customClass&&e.value.customClass.toString()}}),o=[];for(var n in e.modifiers)hasOwnProperty(e.modifiers,n)&&e.modifiers[n]&&o.push(n);o.forEach(function(t){/(top)|(left)|(right)|(bottom)/.test(t)?i.placement=t:/(hover)|(focus)|(click)/.test(t)?i.trigger=t:/unenterable/.test(t)&&(i.enterable=!1)}),i.$mount(),t[INSTANCE]=i},unbind=function(t){var e=t[INSTANCE];e&&e.$destroy(),delete t[INSTANCE]},update=function(t,e){e.value!==e.oldValue&&bind(t,e)},popover={bind:bind,unbind:unbind,update:update};export default popover;