function isExist(t){return null!=t}function isFunction(t){return"function"==typeof t}function isString(t){return"string"==typeof t}function isBoolean(t){return"boolean"==typeof t}function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function request(t,e){void 0===e&&(e="GET");var n=new window.XMLHttpRequest,i={},o={then:function(t,e){return o.done(t).fail(e)},catch:function(t){return o.fail(t)},always:function(t){return o.done(t).fail(t)}};return["done","fail"].forEach(function(t){i[t]=[],o[t]=function(e){return e instanceof Function&&i[t].push(e),o}}),o.done(JSON.parse),n.onreadystatechange=function(){if(4===n.readyState){var t={status:n.status};if(200===n.status){var e=n.responseText;for(var o in i.done)if(hasOwnProperty(i.done,o)&&isFunction(i.done[o])){var s=i.done[o](e);isExist(s)&&(e=s)}}else i.fail.forEach(function(e){return e(t)})}},n.open(e,t),n.setRequestHeader("Accept","application/json"),n.send(),o}var EVENTS={MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",FOCUS:"focus",BLUR:"blur",CLICK:"click",INPUT:"input",KEY_DOWN:"keydown",KEY_UP:"keyup",KEY_PRESS:"keypress",RESIZE:"resize",SCROLL:"scroll",TOUCH_START:"touchstart",TOUCH_END:"touchend"};function on(t,e,n){t.addEventListener(e,n)}function off(t,e,n){t.removeEventListener(e,n)}function isElement(t){return t&&t.nodeType===Node.ELEMENT_NODE}function ensureElementMatchesFunction(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),n=e.length;--n>=0&&e.item(n)!==this;);return n>-1})}function setDropdownPosition(t,e,n){void 0===n&&(n={});var i=document.documentElement,o=(window.pageXOffset||i.scrollLeft)-(i.clientLeft||0),s=(window.pageYOffset||i.scrollTop)-(i.clientTop||0),r=e.getBoundingClientRect(),l=t.getBoundingClientRect();t.style.right="auto",t.style.bottom="auto",n.menuRight?t.style.left=o+r.left+r.width-l.width+"px":t.style.left=o+r.left+"px",n.dropup?t.style.top=s+r.top-l.height-4+"px":t.style.top=s+r.top+r.height+"px"}function focus(t){isElement(t)&&(!t.getAttribute("tabindex")&&t.setAttribute("tabindex","-1"),t.focus())}function getElementBySelectorOrRef(t){return isString(t)?document.querySelector(t):isElement(t)?t:isElement(t.$el)?t.$el:null}var DEFAULT_TAG="div",Dropdown={render:function(t){return t(this.tag,{class:{"btn-group":this.tag===DEFAULT_TAG,dropdown:!this.dropup,dropup:this.dropup,open:this.show}},[this.$slots.default,t("ul",{class:{"dropdown-menu":!0,"dropdown-menu-right":this.menuRight},ref:"dropdown"},[this.$slots.dropdown])])},props:{tag:{type:String,default:DEFAULT_TAG},appendToBody:{type:Boolean,default:!1},value:Boolean,dropup:{type:Boolean,default:!1},menuRight:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},notCloseElements:Array,positionElement:null},data:function(){return{show:!1,triggerEl:void 0}},watch:{value:function(t){this.toggle(t)}},mounted:function(){this.initTrigger(),this.triggerEl&&(on(this.triggerEl,EVENTS.CLICK,this.toggle),on(this.triggerEl,EVENTS.KEY_DOWN,this.onKeyPress)),on(this.$refs.dropdown,EVENTS.KEY_DOWN,this.onKeyPress),on(window,EVENTS.CLICK,this.windowClicked),on(window,EVENTS.TOUCH_END,this.windowClicked),this.value&&this.toggle(!0)},beforeDestroy:function(){this.removeDropdownFromBody(),this.triggerEl&&(off(this.triggerEl,EVENTS.CLICK,this.toggle),off(this.triggerEl,EVENTS.KEY_DOWN,this.onKeyPress)),off(this.$refs.dropdown,EVENTS.KEY_DOWN,this.onKeyPress),off(window,EVENTS.CLICK,this.windowClicked),off(window,EVENTS.TOUCH_END,this.windowClicked)},methods:{getFocusItem:function(){return this.$refs.dropdown.querySelector("li > a:focus")},onKeyPress:function(t){if(this.show){var e=this.$refs.dropdown,n=t.keyCode;if(27===n)this.toggle(!1),this.triggerEl&&this.triggerEl.focus();else if(13===n){var i=this.getFocusItem();i&&i.click()}else if(38===n||40===n){t.preventDefault(),t.stopPropagation();var o=this.getFocusItem(),s=e.querySelectorAll("li:not(.disabled) > a");if(o){for(var r=0;r<s.length;r++)if(o===s[r]){38===n&&r<s.length>0?focus(s[r-1]):40===n&&r<s.length-1&&focus(s[r+1]);break}}else focus(s[0])}}},initTrigger:function(){var t=this.$el.querySelector('[data-role="trigger"]')||this.$el.querySelector(".dropdown-toggle")||this.$el.firstChild;this.triggerEl=t&&t!==this.$refs.dropdown?t:null},toggle:function(t){this.disabled||(isBoolean(t)?this.show=t:this.show=!this.show,this.appendToBody&&(this.show?this.appendDropdownToBody():this.removeDropdownFromBody()),this.$emit("input",this.show))},windowClicked:function(t){var e=t.target;if(this.show&&e){var n=!1;if(this.notCloseElements)for(var i=0,o=this.notCloseElements.length;i<o;i++){var s=this.notCloseElements[i].contains(e),r=s;if(this.appendToBody){var l=this.$refs.dropdown.contains(e),u=this.notCloseElements.indexOf(this.$el)>=0;r=s||l&&u}if(r){n=!0;break}}var a=this.$refs.dropdown.contains(e),h=this.$el.contains(e)&&!a,c=a&&"touchend"===t.type;h||n||c||this.toggle(!1)}},appendDropdownToBody:function(){try{var t=this.$refs.dropdown;t.style.display="block",document.body.appendChild(t),setDropdownPosition(t,this.positionElement||this.$el,this)}catch(t){}},removeDropdownFromBody:function(){try{var t=this.$refs.dropdown;t.removeAttribute("style"),this.$el.appendChild(t)}catch(t){}}}},script={components:{Dropdown:Dropdown},props:{value:{required:!0},data:Array,itemKey:String,appendToBody:{type:Boolean,default:!1},ignoreCase:{type:Boolean,default:!0},matchStart:{type:Boolean,default:!1},forceSelect:{type:Boolean,default:!1},forceClear:{type:Boolean,default:!1},limit:{type:Number,default:10},asyncSrc:String,asyncKey:String,asyncFunction:Function,debounce:{type:Number,default:200},openOnFocus:{type:Boolean,default:!0},openOnEmpty:{type:Boolean,default:!1},target:{required:!0},preselect:{type:Boolean,default:!0}},data:function(){return{inputEl:null,items:[],activeIndex:0,timeoutID:0,elements:[],open:!1,dropdownMenuEl:null}},computed:{regexOptions:function(){var t="";return this.ignoreCase&&(t+="i"),this.matchStart||(t+="g"),t}},mounted:function(){var t=this;ensureElementMatchesFunction(),this.$nextTick(function(){t.initInputElByTarget(t.target),t.initListeners(),t.dropdownMenuEl=t.$refs.dropdown.$el.querySelector(".dropdown-menu"),t.value&&t.setInputTextByValue(t.value)})},beforeDestroy:function(){this.removeListeners()},watch:{target:function(t){this.removeListeners(),this.initInputElByTarget(t),this.initListeners()},value:function(t){this.setInputTextByValue(t)}},methods:{setInputTextByValue:function(t){isString(t)?this.inputEl.value=t:t?this.inputEl.value=this.itemKey?t[this.itemKey]:t:null===t&&(this.inputEl.value="")},hasEmptySlot:function(){return!!this.$slots.empty||!!this.$scopedSlots.empty},initInputElByTarget:function(t){t&&(this.inputEl=getElementBySelectorOrRef(t))},initListeners:function(){this.inputEl&&(this.elements=[this.inputEl],on(this.inputEl,EVENTS.FOCUS,this.inputFocused),on(this.inputEl,EVENTS.BLUR,this.inputBlured),on(this.inputEl,EVENTS.INPUT,this.inputChanged),on(this.inputEl,EVENTS.KEY_DOWN,this.inputKeyPressed))},removeListeners:function(){this.elements=[],this.inputEl&&(off(this.inputEl,EVENTS.FOCUS,this.inputFocused),off(this.inputEl,EVENTS.BLUR,this.inputBlured),off(this.inputEl,EVENTS.INPUT,this.inputChanged),off(this.inputEl,EVENTS.KEY_DOWN,this.inputKeyPressed))},prepareItems:function(t,e){if(void 0===e&&(e=!1),e)this.items=t.slice(0,this.limit);else{this.items=[],this.activeIndex=this.preselect?0:-1;for(var n=0,i=t.length;n<i;n++){var o=t[n],s=this.itemKey?o[this.itemKey]:o;s=s.toString();var r=-1;if(r=this.ignoreCase?s.toLowerCase().indexOf(this.inputEl.value.toLowerCase()):s.indexOf(this.inputEl.value),(this.matchStart?0===r:r>=0)&&this.items.push(o),this.items.length>=this.limit)break}}},fetchItems:function(t,e){var n=this;if(clearTimeout(this.timeoutID),""!==t||this.openOnEmpty){if(this.data)this.prepareItems(this.data),this.open=this.hasEmptySlot()||Boolean(this.items.length);else if(this.asyncSrc)this.timeoutID=setTimeout(function(){n.$emit("loading"),request(n.asyncSrc+encodeURIComponent(t)).then(function(t){n.inputEl.matches(":focus")&&(n.prepareItems(n.asyncKey?t[n.asyncKey]:t,!0),n.open=n.hasEmptySlot()||Boolean(n.items.length)),n.$emit("loaded")}).catch(function(t){console.error(t),n.$emit("loaded-error")})},e);else if(this.asyncFunction){var i=function(t){n.inputEl.matches(":focus")&&(n.prepareItems(t,!0),n.open=n.hasEmptySlot()||Boolean(n.items.length)),n.$emit("loaded")};this.timeoutID=setTimeout(function(){n.$emit("loading"),n.asyncFunction(t,i)},e)}}else this.open=!1},inputChanged:function(){var t=this.inputEl.value;this.fetchItems(t,this.debounce),this.$emit("input",this.forceSelect?void 0:t)},inputFocused:function(){if(this.openOnFocus){var t=this.inputEl.value;this.fetchItems(t,0)}},inputBlured:function(){var t=this;this.dropdownMenuEl.matches(":hover")||(this.open=!1),this.inputEl&&this.forceClear&&this.$nextTick(function(){void 0===t.value&&(t.inputEl.value="")})},inputKeyPressed:function(t){if(t.stopPropagation(),this.open)switch(t.keyCode){case 13:this.activeIndex>=0?this.selectItem(this.items[this.activeIndex]):this.open=!1,t.preventDefault();break;case 27:this.open=!1;break;case 38:this.activeIndex=this.activeIndex>0?this.activeIndex-1:0;break;case 40:var e=this.items.length-1;this.activeIndex=this.activeIndex<e?this.activeIndex+1:e}},selectItem:function(t){this.$emit("input",t),this.open=!1},highlight:function(t){var e=this.itemKey?t[this.itemKey]:t,n=this.inputEl.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return e.replace(new RegExp(""+n,this.regexOptions),"<b>$&</b>")}}};function normalizeComponent(t,e,n,i,o,s,r,l,u,a){"boolean"!=typeof r&&(u=l,l=r,r=!1);var h,c="function"==typeof n?n.options:n;if(t&&t.render&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),i&&(c._scopeId=i),s?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,u(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=h):e&&(h=r?function(t){e.call(this,a(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,l(t))}),h)if(c.functional){var p=c.render;c.render=function(t,e){return h.call(e),p(t,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,h):[h]}return n}var __vue_script__=script,__vue_render__=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dropdown",{ref:"dropdown",attrs:{tag:"section","append-to-body":t.appendToBody,"not-close-elements":t.elements,"position-element":t.inputEl},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[n("template",{slot:"dropdown"},[t._t("item",t._l(t.items,function(e,i){return n("li",{class:{active:t.activeIndex===i}},[n("a",{attrs:{href:"#"},on:{click:function(n){return n.preventDefault(),t.selectItem(e)}}},[n("span",{domProps:{innerHTML:t._s(t.highlight(e))}})])])}),{items:t.items,activeIndex:t.activeIndex,select:t.selectItem,highlight:t.highlight}),t._v(" "),t.items&&0!==t.items.length?t._e():t._t("empty")],2)],2)},__vue_staticRenderFns__=[];__vue_render__._withStripped=!0;var __vue_inject_styles__=void 0,__vue_scope_id__=void 0,__vue_module_identifier__=void 0,__vue_is_functional_template__=!1,__vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,!1,void 0,void 0,void 0);export default __vue_component__;