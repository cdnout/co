!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",r=function(t){function e(n,s,r){var a=t.call(this,s)||this;return a.code=n,a.customData=r,a.name=i,Object.setPrototypeOf(a,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,o.prototype.create),a}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",h=this.serviceName+": "+a+" ("+i+").";return new r(i,h,s)},t}();var a,h,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(h||(h={}));var f={debug:h.DEBUG,verbose:h.VERBOSE,info:h.INFO,warn:h.WARN,error:h.ERROR,silent:h.SILENT},d=h.INFO,p=((a={})[h.DEBUG]="log",a[h.VERBOSE]="log",a[h.INFO]="info",a[h.WARN]="warn",a[h.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=p[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in h))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.DEBUG],t)),this._logHandler.apply(this,l([this,h.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.VERBOSE],t)),this._logHandler.apply(this,l([this,h.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.INFO],t)),this._logHandler.apply(this,l([this,h.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.WARN],t)),this._logHandler.apply(this,l([this,h.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.ERROR],t)),this._logHandler.apply(this,l([this,h.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function _(){}function T(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function N(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var S="closure_uid_"+(1e9*Math.random()>>>0),A=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function D(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function k(t,e,n){return(k=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:D).apply(null,arguments)}function L(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function O(){return Date.now()}function R(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function C(){this.j=this.j,this.i=this.i}C.prototype.j=!1,C.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,S)&&t[S]||(t[S]=++A)})(this)},C.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var P=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,i="string"==typeof t?t.split(""):t,r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function V(t){return Array.prototype.concat.apply([],arguments)}function M(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function q(t){return/^[\s\xa0]*$/.test(t)}var G,F=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function j(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:t>e?1:0}t:{var B=I.navigator;if(B){var K=B.userAgent;if(K){G=K;break t}}G=""}function Y(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function z(t){var e={};for(var n in t)e[n]=t[n];return e}var H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(t,e){for(var n,s,i=1;i<arguments.length;i++){for(n in s=arguments[i])t[n]=s[n];for(var r=0;r<H.length;r++)n=H[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function X(t){return X[" "](t),t}X[" "]=_;var J,Q,Z=j(G,"Opera"),tt=j(G,"Trident")||j(G,"MSIE"),et=j(G,"Edge"),nt=et||tt,st=j(G,"Gecko")&&!(j(G.toLowerCase(),"webkit")&&!j(G,"Edge"))&&!(j(G,"Trident")||j(G,"MSIE"))&&!j(G,"Edge"),it=j(G.toLowerCase(),"webkit")&&!j(G,"Edge");function rt(){var t=I.document;return t?t.documentMode:void 0}t:{var ot="",at=(Q=G,st?/rv:([^\);]+)(\)|;)/.exec(Q):et?/Edge\/([\d\.]+)/.exec(Q):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Q):it?/WebKit\/(\S+)/.exec(Q):Z?/(?:Version)[ \/]?(\S+)/.exec(Q):void 0);if(at&&(ot=at?at[1]:""),tt){var ht=rt();if(null!=ht&&ht>parseFloat(ot)){J=String(ht);break t}}J=ot}var ut,ct={};function lt(t){return function(t,e){var n=ct;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=F(String(J)).split("."),s=F(String(t)).split("."),i=Math.max(n.length,s.length),r=0;0==e&&r<i;r++){var o=n[r]||"",a=s[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=$(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||$(0==o[2].length,0==a[2].length)||$(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&tt){var ft=rt();ut=ft||(parseInt(J,10)||void 0)}else ut=void 0;var dt=ut,pt=!tt||9<=Number(dt),gt=tt&&!lt("9"),mt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",_,e),I.removeEventListener("test",_,e)}catch(t){}return t}();function yt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(yt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{X(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:vt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}yt.prototype.b=function(){this.defaultPrevented=!0},R(wt,yt);var vt={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var bt="closure_listenable_"+(1e6*Math.random()|0),Et=0;function It(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function Tt(t,e){var n=e.type;if(n in t.a){var s,i=t.a[n],r=P(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(It(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Nt(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.Y&&r.listener==e&&r.capture==!!n&&r.ca==s)return i}return-1}_t.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.a[r])||(t=this.a[r]=[],this.b++);var o=Nt(t,e,s,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=i,this.key=++Et,this.Y=this.Z=!1}(e,this.src,r,!!s,i)).Z=n,t.push(e)),e};var St="closure_lm_"+(1e6*Math.random()|0),At={};function xt(t,e,n,s,i){if(s&&s.once)return function t(e,n,s,i,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);return null}s=Ut(s);return e&&e[bt]?e.wa(n,s,N(i)?!!i.capture:!!i,r):Dt(e,n,s,!0,i,r)}(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)xt(t,e[r],n,s,i);return null}return n=Ut(n),t&&t[bt]?t.va(e,n,N(s)?!!s.capture:!!s,i):Dt(t,e,n,!1,s,i)}function Dt(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=N(i)?!!i.capture:!!i;if(o&&!pt)return null;var a=Ct(t);if(a||(t[St]=a=new _t(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){var t=Rt,e=pt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)mt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Lt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function kt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[bt])Tt(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Lt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Ct(e))?(Tt(n,t),0==n.b&&(n.src=null,e[St]=null)):It(t)}}}function Lt(t){return t in At?At[t]:At[t]="on"+t}function Ot(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&kt(t),n.call(s,e)}function Rt(t,e){if(t.Y)return!0;if(!pt){if(!e)t:{e=["window","event"];for(var n=I,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return Ot(t,e=new wt(e,this))}return Ot(t,new wt(e,this))}function Ct(t){return(t=t[St])instanceof _t?t:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==typeof t?t:(t[Pt]||(t[Pt]=function(e){return t.handleEvent(e)}),t[Pt])}function Vt(){C.call(this),this.c=new _t(this),this.J=this,this.C=null}function Mt(t,e){var n,s=t.C;if(s)for(n=[];s;s=s.C)n.push(s);if(t=t.J,s=e.type||e,"string"==typeof e)e=new yt(e,t);else if(e instanceof yt)e.target=e.target||t;else{var i=e;W(e=new yt(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.a=n[r];i=qt(o,s,!0,e)&&i}if(i=qt(o=e.a=t,s,!0,e)&&i,i=qt(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=qt(o=e.a=n[r],s,!1,e)&&i}function qt(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.Y&&o.capture==n){var a=o.listener,h=o.ca||o.src;o.Z&&Tt(t.c,o),i=!1!==a.call(h,s)&&i}}return i&&!s.defaultPrevented}R(Vt,C),Vt.prototype[bt]=!0,(v=Vt.prototype).addEventListener=function(t,e,n,s){xt(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,i,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);else i=N(i)?!!i.capture:!!i,s=Ut(s),e&&e[bt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=Nt(o=e.a[n],s,i,r))&&(It(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Ct(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Nt(n,s,i,r)),(s=-1<e?n[e]:null)&&kt(s))}(this,t,e,n,s)},v.G=function(){if(Vt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)It(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var Gt=I.JSON.stringify;function Ft(){this.b=this.a=null}var jt,$t=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new Kt},function(t){t.reset()});function Bt(){var t=Wt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Kt(){this.next=this.b=this.a=null}function Yt(t){I.setTimeout(function(){throw t},0)}function zt(t,e){jt||function(){var t=I.Promise.resolve(void 0);jt=function(){t.then(Xt)}}(),Ht||(jt(),Ht=!0),Wt.add(t,e)}Ft.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Kt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Kt.prototype.reset=function(){this.next=this.b=this.a=null};var Ht=!1,Wt=new Ft;function Xt(){for(var t;t=Bt();){try{t.a.call(t.b)}catch(t){Yt(t)}var e=$t;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ht=!1}function Jt(t,e){Vt.call(this),this.b=t||1,this.a=e||I,this.f=k(this.Za,this),this.g=O()}function Qt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==typeof t)n&&(t=k(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=k(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}R(Jt,Vt),(v=Jt.prototype).aa=!1,v.M=null,v.Za=function(){if(this.aa){var t=O()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Mt(this,"tick"),this.aa&&(Qt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=O())},v.G=function(){Jt.X.G.call(this),Qt(this),delete this.a};var te=function(t){function e(e,n){var s=t.call(this)||this;return s.g=e,s.h=n,s.b=null,s.c=!1,s.a=null,s}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(C);function ee(t){C.call(this),this.b=t,this.a={}}R(ee,C);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var r=xt(e,n[i],s||t.handleEvent,!1,t.b||t);if(!r)break;t.a[r.key]=r}}function ie(t){Y(t.a,function(t,e){this.a.hasOwnProperty(e)&&kt(t)},t),t.a={}}function re(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Gt(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.X.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},re.prototype.info=function(){};var ae={},he=null;function ue(){return he=he||new Vt}function ce(t){yt.call(this,ae.Fa,t)}function le(t){var e=ue();Mt(e,new ce(e,t))}function fe(t,e){yt.call(this,ae.STAT_EVENT,t),this.stat=e}function de(t){var e=ue();Mt(e,new fe(e,t))}function pe(t){yt.call(this,ae.Ga,t)}function ge(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}ae.Fa="serverreachability",R(ce,yt),ae.STAT_EVENT="statevent",R(fe,yt),ae.Ga="timingevent",R(pe,yt);var me={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ye={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function we(){}function ve(t){var e;return(e=t.a)||(e=t.a={}),e}function be(){}we.prototype.a=null;var Ee,Ie={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function _e(){yt.call(this,"d")}function Te(){yt.call(this,"c")}function Ne(){}function Se(t,e,n,s){this.g=t,this.c=e,this.f=n,this.S=s||1,this.J=new ee(this),this.P=Ae,t=nt?125:void 0,this.R=new Jt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}R(_e,yt),R(Te,yt),R(Ne,we),Ee=new Ne;var Ae=45e3,xe={},De={};function ke(t,e,n){t.H=1,t.i=Qe(Ye(e)),t.j=n,t.I=!0,Le(t,null)}function Le(t,e){t.u=O(),Ce(t),t.l=Ye(t.i);var n=t.l,s=t.S;Array.isArray(s)||(s=[String(s)]),fn(n.b,"t",s),t.D=0,t.a=rs(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(k(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Xa),e=t.B?z(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),le(1),function(t,e,n,s,i,r){t.info(function(){if(t.a)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var u=a[h].split("=");if(1<u.length){var c=u[0];u=u[1];var l=c.split("_");o=2<=l.length&&"type"==l[1]?o+(c+"=")+u+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.S,t.j)}function Oe(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var i=Re(t,n);if(i==De){4==e&&(t.h=4,de(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,de(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,i,null),qe(t,i)}4==e&&0==n.length&&(t.h=1,de(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Jn(e),e.F=!0,de(11))):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Me(t),Ve(t))}function Re(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?De:(n=Number(e.substring(n,s)),isNaN(n)?xe:(s+=1)+n>e.length?De:(e=e.substr(s,n),t.D=s+n,e))}function Ce(t){t.T=O()+t.P,Pe(t,t.P)}function Pe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ge(k(t.Va,t),e)}function Ue(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||ts(t.g,t)}function Me(t){Ue(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Qt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function qe(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||vn(n.b,t)))if(n.I=t.N,!t.C&&vn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Zn(n),jn(n)}Xn(n),de(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ge(k(n.Sa,n),6e3));if(1>=wn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ns(n,11)}else if((t.C||n.a==t)&&Zn(n),!q(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(i=e[s],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var r=i[3];null!=r&&(n.ha=r,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var h=1.5*a;n.D=h,n.c.info("backChannelRequestTimeoutMs_="+h)}h=n;var u=t.a;if(u){var c=u.a?u.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var l=h.b;!l.a&&(j(c,"spdy")||j(c,"quic")||j(c,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(bn(l,l.b),l.b=null))}if(h.A){var f=u.a?u.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(h.na=f,Je(h.B,h.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=O()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((h=n).la=is(h,h.C?h.ga:null,h.fa),d.C){En(h.b,d);var p=d,g=h.D;g&&p.setTimeout(g),p.o&&(Ue(p),Ce(p)),h.a=d}else Wn(h);0<n.g.length&&Kn(n)}else"stop"!=i[0]&&"close"!=i[0]||ns(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ns(n,7):Fn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);le(4)}catch(t){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(T(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(T(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;i=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(T(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof Fe)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];$e(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)$e(i,s=t.a[e])||(t.a[n++]=s,i[s]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Se.prototype).setTimeout=function(t){this.P=t},v.Xa=function(t){t=t.target;var e=this.F;e&&3==Vn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Vn(this.a),n=this.a.ua(),s=this.a.W();if(!(3>e||3==e&&!nt&&!this.a.$())){this.A||4!=e||7==n||le(8==n||0>=s?3:2),Ue(this);var i=this.a.W();this.N=i;var r=this.a.$();if(this.b=200==i,function(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,de(12),Me(this),Ve(this);break t}oe(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,qe(this,h)}this.I?(Oe(this,e,r),nt&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Wa),this.R.start())):(oe(this.c,this.f,r,null),qe(this,r)),4==e&&Me(this),this.b&&!this.A&&(4==e?ts(this.g,this):(this.b=!1,Ce(this)))}else 400==i&&0<r.indexOf("Unknown SID")?(this.h=3,de(12)):(this.h=0,de(13)),Me(this),Ve(this)}}}catch(t){}},v.Wa=function(){if(this.a){var t=Vn(this.a),e=this.a.$();this.D<e.length&&(Ue(this),Oe(this,t,e),this.b&&4!=t&&Ce(this))}},v.cancel=function(){this.A=!0,Me(this)},v.Va=function(){this.o=null;var t=O();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(le(3),de(17)),Me(this),this.h=2,Ve(this)):Pe(this,this.T-t)},(v=Fe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return $e(this.b,t)?this.b[t]:e},v.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var Be=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ke(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ke){this.a=void 0!==e?e:t.a,ze(this,t.f),this.j=t.j,He(this,t.c),We(this,t.h),this.g=t.g,e=t.b;var n=new hn;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Xe(this,n),this.i=t.i}else t&&(n=String(t).match(Be))?(this.a=!!e,ze(this,n[1]||"",!0),this.j=Ze(n[2]||""),He(this,n[3]||"",!0),We(this,n[4]),this.g=Ze(n[5]||"",!0),Xe(this,n[6]||"",!0),this.i=Ze(n[7]||"")):(this.a=!!e,this.b=new hn(null,this.a))}function Ye(t){return new Ke(t)}function ze(t,e,n){t.f=n?Ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function He(t,e,n){t.c=n?Ze(e,!0):e}function We(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Xe(t,e,n){e instanceof hn?(t.b=e,function(t,e){e&&!t.f&&(un(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),fn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=tn(e,on)),t.b=new hn(e,t.a))}function Je(t,e,n){t.b.set(e,n)}function Qe(t){return Je(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^O()).toString(36)),t}function Ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,en),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function en(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ke.prototype.toString=function(){var t=[],e=this.f;e&&t.push(tn(e,nn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(tn(e,nn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(tn(n,"/"==n.charAt(0)?rn:sn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",tn(n,an)),t.join("")};var nn=/[#\/\?@]/g,sn=/[#\?:]/g,rn=/[#\?]/g,on=/[#\?@]/g,an=/#/g;function hn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function un(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function cn(t,e){un(t),e=dn(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function ln(t,e){return un(t),e=dn(t,e),$e(t.a.b,e)}function fn(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(dn(t,e),M(n)),t.b+=n.length)}function dn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(v=hn.prototype).add=function(t,e){un(this),this.c=null,t=dn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){un(this),this.a.forEach(function(n,s){U(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){un(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},v.K=function(t){un(this);var e=[];if("string"==typeof t)ln(this,t)&&(e=V(e,this.a.get(dn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=V(e,t[n])}return e},v.set=function(t,e){return un(this),this.c=null,ln(this,t=dn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.K(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.c=t.join("&")};var pn=function(){return function(t,e){this.b=t,this.a=e}}();function gn(t){this.g=t||mn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var mn=10;function yn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function wn(t){return t.b?1:t.a?t.a.size:0}function vn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function bn(t,e){t.a?t.a.add(e):t.b=e}function En(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function In(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var i=w(t.a.values()),r=i.next();!r.done;r=i.next()){var o=r.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return s}return M(t.c)}function _n(){}function Tn(t,e,n){var s=n||"";try{Ge(t,function(t,n){var i=t;N(t)&&(i=Gt(t)),e.push(s+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function Nn(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}gn.prototype.cancel=function(){var t,e;if(this.c=In(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},_n.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},_n.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var Sn=I.JSON.parse;function An(t){Vt.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=xn,this.D=this.F=!1}R(An,Vt);var xn="",Dn=/^https?$/i,kn=["POST","PUT"];function Ln(t){return"content-type"==t.toLowerCase()}function On(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Rn(t),Pn(t)}function Rn(t){t.u||(t.u=!0,Mt(t,"complete"),Mt(t,"error"))}function Cn(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Vn(t)||2!=t.W()))if(t.l&&4==Vn(t))Zt(t.za,0,t);else if(Mt(t,"readystatechange"),4==Vn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var i;if(i=0===n){var r=String(t.B).match(Be)[1]||null;if(!r&&I.self&&I.self.location){var o=I.self.location.protocol;r=o.substr(0,o.length-1)}i=!Dn.test(r?r.toLowerCase():"")}e=i}if(e)Mt(t,"complete"),Mt(t,"success");else{t.h=6;try{var a=2<Vn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Rn(t)}}finally{Pn(t)}}}function Pn(t,e){if(t.a){Un(t);var n=t.a,s=t.s[0]?_:null;t.a=null,t.s=null,e||Mt(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function Un(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Vn(t){return t.a?t.a.readyState:0}function Mn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return Y(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Je(t,e,n))}function qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.pa=0,this.g=[],this.c=new re,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=qn("baseRetryDelayMs",5e3,t),this.Ra=qn("retryDelaySeedMs",1e4,t),this.Ma=qn("forwardChannelMaxRetries",2,t),this.ma=qn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new gn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new _n},this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Fn(t){if($n(t),3==t.v){var e=t.R++,n=Ye(t.B);Je(n,"SID",t.J),Je(n,"RID",e),Je(n,"TYPE","terminate"),zn(t,n),(e=new Se(t,t.c,e,void 0)).H=2,e.i=Qe(Ye(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=rs(e.g,null),e.a.ba(e.i)),e.u=O(),Ce(e)}ss(t)}function jn(t){t.a&&(Jn(t),t.a.cancel(),t.a=null)}function $n(t){jn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Zn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function Bn(t,e){t.g.push(new pn(t.Oa++,e)),3==t.v&&Kn(t)}function Kn(t){yn(t.b)||t.h||(t.h=!0,zt(t.Ba,t),t.u=0)}function Yn(t,e){var n;n=e?e.f:t.R++;var s=Ye(t.B);Je(s,"SID",t.J),Je(s,"RID",n),Je(s,"AID",t.P),zn(t,s),t.i&&t.l&&Mn(s,t.i,t.l),n=new Se(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Hn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),bn(t.b,n),ke(n,s,e)}function zn(t,e){t.f&&Ge({},function(t,n){Je(e,n,t)})}function Hn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?k(t.f.Ja,t.f,t):null;t:for(var i=t.g,r=-1;;){var o=["count="+n];-1==r?0<n?(r=i[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var a=!0,h=0;h<n;h++){var u=i[h].b,c=i[h].a;if(0>(u-=r))r=Math.max(0,i[h].b-100),a=!1;else try{Tn(c,o,"req"+u+"_")}catch(t){s&&s(c)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Wn(t){t.a||t.j||(t.T=1,zt(t.Aa,t),t.o=0)}function Xn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ge(k(t.Aa,t),es(t,t.o)),t.o++,!0)}function Jn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Qn(t){t.a=new Se(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ye(t.la);Je(e,"RID","rpc"),Je(e,"SID",t.J),Je(e,"CI",t.H?"0":"1"),Je(e,"AID",t.P),zn(t,e),Je(e,"TYPE","xmlhttp"),t.i&&t.l&&Mn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Qe(Ye(e)),n.j=null,n.I=!0,Le(n,t)}function Zn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function ts(t,e){var n=null;if(t.a==e){Zn(t),Jn(t),t.a=null;var s=2}else{if(!vn(t.b,e))return;n=e.s,En(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=O()-e.u;var i=t.u;Mt(s=ue(),new pe(s,n,e,i)),Kn(t)}else Wn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==s&&function(t,e){return!(wn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=ge(k(t.Ba,t,e),es(t,t.u)),t.u++,0)))}(t,e)||2==s&&Xn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ns(t,5);break;case 4:ns(t,10);break;case 3:ns(t,6);break;default:ns(t,2)}}function es(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ns(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=k(t.Ya,t);n||(n=new Ke("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||ze(n,"https"),Qe(n)),function(t,e){var n=new re;if(I.Image){var s=new Image;s.onload=L(Nn,n,s,"TestLoadImage: loaded",!0,e),s.onerror=L(Nn,n,s,"TestLoadImage: error",!1,e),s.onabort=L(Nn,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=L(Nn,n,s,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else de(2);t.v=0,t.f&&t.f.ra(e),ss(t),$n(t)}function ss(t){t.v=0,t.I=-1,t.f&&(0==In(t.b).length&&0==t.g.length||(t.b.c.length=0,M(t.g),t.g.length=0),t.f.qa())}function is(t,e,n){var s=function(t){return t instanceof Ke?Ye(t):new Ke(t,void 0)}(n);if(""!=s.c)e&&He(s,e+"."+s.c),We(s,s.h);else{var i=I.location;s=function(t,e,n,s){var i=new Ke(null,void 0);return t&&ze(i,t),e&&He(i,e),n&&We(i,n),s&&(i.g=s),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&Y(t.V,function(t,e){Je(s,e,t)}),e=t.A,n=t.na,e&&n&&Je(s,e,n),Je(s,"VER",t.ha),zn(t,s),s}function rs(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new An(t.Na)).F=t.C,e}function os(){}function as(){if(tt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function hs(t,e){Vt.call(this),this.a=new Gn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!q(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ls(this)}function us(t){_e.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cs(){Te.call(this),this.status=1}function ls(t){this.a=t}(v=An.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ve(this.H):ve(Ee),this.a.onreadystatechange=k(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void On(this,t)}t=n||"";var i=new Fe(this.headers);s&&Ge(s,function(t,e){i.set(e,t)}),s=function(t){t:{for(var e=Ln,n=t.length,s="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=I.FormData&&t instanceof I.FormData,!(0<=P(kn,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Un(this),0<this.o&&((this.D=function(t){return tt&&lt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=k(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){On(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Mt(this,"timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Mt(this,"complete"),Mt(this,"abort"),Pn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Pn(this,!0)),An.X.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Cn(this):this.Ua())},v.Ua=function(){Cn(this)},v.W=function(){try{return 2<Vn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Sn(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Gn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Se(this,this.c,t,void 0),s=this.l;if(this.O&&(s?W(s=z(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var i=e=0;i<this.g.length;i++){var r=this.g[i];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Hn(this,n,e),Je(i=Ye(this.B),"RID",t),Je(i,"CVER",22),this.A&&Je(i,"X-HTTP-Session-Id",this.A),zn(this,i),this.i&&s&&Mn(i,this.i,s),bn(this.b,n),this.Ia&&Je(i,"TYPE","init"),this.da?(Je(i,"$req",e),Je(i,"SID","null"),n.U=!0,ke(n,i,null)):ke(n,i,e),this.v=2}}else 3==this.v&&(t?Yn(this,t):0==this.g.length||yn(this.b)||Yn(this))},v.Aa=function(){if(this.j=null,Qn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ge(k(this.Ta,this),t)}},v.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,de(10),jn(this),Qn(this))},v.Sa=function(){null!=this.m&&(this.m=null,jn(this),Xn(this),de(19))},v.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),de(2)):(this.c.info("Failed to ping google.com"),de(1))},(v=os.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ja=function(){},as.prototype.a=function(t,e){return new hs(t,e)},R(hs,Vt),hs.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;de(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=is(t,null,t.fa),Kn(t)},hs.prototype.close=function(){Fn(this.a)},hs.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Bn(this.a,e)}else this.l?((e={}).__data__=Gt(t),Bn(this.a,e)):Bn(this.a,t)},hs.prototype.G=function(){this.a.f=null,delete this.f,Fn(this.a),delete this.a,hs.X.G.call(this)},R(us,_e),R(cs,Te),R(ls,os),ls.prototype.ta=function(){Mt(this.a,"a")},ls.prototype.sa=function(t){Mt(this.a,new us(t))},ls.prototype.ra=function(t){Mt(this.a,new cs(t))},ls.prototype.qa=function(){Mt(this.a,"b")},as.prototype.createWebChannel=as.prototype.a,hs.prototype.send=hs.prototype.h,hs.prototype.open=hs.prototype.g,hs.prototype.close=hs.prototype.close,me.NO_ERROR=0,me.TIMEOUT=8,me.HTTP_ERROR=6,ye.COMPLETE="complete",be.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",Vt.prototype.listen=Vt.prototype.va,An.prototype.listenOnce=An.prototype.wa,An.prototype.getLastError=An.prototype.Qa,An.prototype.getLastErrorCode=An.prototype.ua,An.prototype.getStatus=An.prototype.W,An.prototype.getResponseJson=An.prototype.Pa,An.prototype.getResponseText=An.prototype.$,An.prototype.send=An.prototype.ba;var fs=function(){return new as},ds=function(){return ue()},ps=me,gs=ye,ms=ae,ys={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},ws=be,vs=An;class bs{constructor(t){this.uid=t}t(){return null!=this.uid}i(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}bs.UNAUTHENTICATED=new bs(null),bs.o=new bs("google-credentials-uid"),bs.u=new bs("first-party-uid");const Es=new m("@firebase/firestore");function Is(){return Es.logLevel}function _s(t,...e){if(Es.logLevel<=h.DEBUG){const n=e.map(Ss);Es.debug(`Firestore (8.2.9): ${t}`,...n)}}function Ts(t,...e){if(Es.logLevel<=h.ERROR){const n=e.map(Ss);Es.error(`Firestore (8.2.9): ${t}`,...n)}}function Ns(t,...e){if(Es.logLevel<=h.WARN){const n=e.map(Ss);Es.warn(`Firestore (8.2.9): ${t}`,...n)}}function Ss(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function As(t="Unexpected state"){const e="FIRESTORE (8.2.9) INTERNAL ASSERTION FAILED: "+t;throw Ts(e),new Error(e)}function xs(t,e){t||As()}function Ds(t,e){return t}const ks={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ls extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Os{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization=`Bearer ${t}`}}class Rs{constructor(){this.l=null}getToken(){return Promise.resolve(null)}_(){}T(t){this.l=t,t(bs.UNAUTHENTICATED)}I(){this.l=null}}class Cs{constructor(t){this.m=null,this.currentUser=bs.UNAUTHENTICATED,this.A=!1,this.R=0,this.l=null,this.forceRefresh=!1,this.m=(()=>{this.R++,this.currentUser=this.P(),this.A=!0,this.l&&this.l(this.currentUser)}),this.R=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.m):(this.m(null),t.get().then(t=>{this.auth=t,this.m&&this.auth.addAuthTokenListener(this.m)},()=>{}))}getToken(){const t=this.R,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.R!==t?(_s("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(xs("string"==typeof e.accessToken),new Os(e.accessToken,this.currentUser)):null):Promise.resolve(null)}_(){this.forceRefresh=!0}T(t){this.l=t,this.A&&t(this.currentUser)}I(){this.auth&&this.auth.removeAuthTokenListener(this.m),this.m=null,this.l=null}P(){const t=this.auth&&this.auth.getUid();return xs(null===t||"string"==typeof t),new bs(t)}}class Ps{constructor(t,e){this.V=t,this.g=e,this.type="FirstParty",this.user=bs.u}get h(){const t={"X-Goog-AuthUser":this.g},e=this.V.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t}}class Us{constructor(t,e){this.V=t,this.g=e}getToken(){return Promise.resolve(new Ps(this.V,this.g))}T(t){t(bs.u)}I(){}_(){}}class Vs{constructor(t,e,n,s,i,r){this.p=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=i,this.v=r}}class Ms{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get S(){return"(default)"===this.database}isEqual(t){return t instanceof Ms&&t.projectId===this.projectId&&t.database===this.database}}class qs{constructor(t,e){this.previousValue=t,e&&(e.D=(t=>this.C(t)),this.N=(t=>e.$(t)))}C(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.N&&this.N(t),t}}function Gs(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}qs.O=-1;class Fs{static k(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Gs(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function js(t,e){return t<e?-1:t>e?1:0}function $s(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function Bs(t){return t+"\0"}class Ks{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ls(ks.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ls(ks.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ls(ks.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ls(ks.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ks.fromMillis(Date.now())}static fromDate(t){return Ks.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Ks(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}M(t){return this.seconds===t.seconds?js(this.nanoseconds,t.nanoseconds):js(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ys{constructor(t){this.timestamp=t}static F(t){return new Ys(t)}static min(){return new Ys(new Ks(0,0))}L(t){return this.timestamp.M(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}B(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}q(){return this.timestamp}}class zs{constructor(t,e,n){void 0===e?e=0:e>t.length&&As(),void 0===n?n=t.length-e:n>t.length-e&&As(),this.segments=t,this.offset=e,this.U=n}get length(){return this.U}isEqual(t){return 0===zs.K(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof zs?t.forEach(t=>{e.push(t)}):e.push(t),this.W(e)}limit(){return this.offset+this.length}j(t){return t=void 0===t?1:t,this.W(this.segments,this.offset+t,this.length-t)}G(){return this.W(this.segments,this.offset,this.length-1)}H(){return this.segments[this.offset]}J(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}Y(){return 0===this.length}X(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}Z(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}tt(){return this.segments.slice(this.offset,this.limit())}static K(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Hs extends zs{W(t,e,n){return new Hs(t,e,n)}et(){return this.tt().join("/")}toString(){return this.et()}static nt(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Ls(ks.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Hs(e)}static st(){return new Hs([])}}const Ws=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xs extends zs{W(t,e,n){return new Xs(t,e,n)}static it(t){return Ws.test(t)}et(){return this.tt().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xs.it(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.et()}rt(){return 1===this.length&&"__name__"===this.get(0)}static ot(){return new Xs(["__name__"])}static ct(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new Ls(ks.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Ls(ks.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ls(ks.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new Ls(ks.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Xs(e)}static st(){return new Xs([])}}class Js{constructor(t){this.path=t}static at(t){return new Js(Hs.nt(t))}static ut(t){return new Js(Hs.nt(t).j(5))}ht(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Hs.K(this.path,t.path)}toString(){return this.path.toString()}static K(t,e){return Hs.K(t.path,e.path)}static lt(t){return t.length%2==0}static _t(t){return new Js(new Hs(t.slice()))}}function Qs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ti(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ei{constructor(t){this.fields=t,t.sort(Xs.K)}ft(t){for(const e of this.fields)if(e.X(t))return!0;return!1}isEqual(t){return $s(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class ni{constructor(t){this.dt=t}static fromBase64String(t){const e=atob(t);return new ni(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ni(e)}toBase64(){return t=this.dt,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.dt)}wt(){return 2*this.dt.length}L(t){return js(this.dt,t.dt)}isEqual(t){return this.dt===t.dt}}ni.Et=new ni("");const si=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ii(t){if(xs(!!t),"string"==typeof t){let e=0;const n=si.exec(t);if(xs(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ri(t.seconds),nanos:ri(t.nanos)}}function ri(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function oi(t){return"string"==typeof t?ni.fromBase64String(t):ni.fromUint8Array(t)}function ai(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function hi(t){const e=ii(t.mapValue.fields.__local_write_time__.timestampValue);return new Ks(e.seconds,e.nanos)}function ui(t){return null==t}function ci(t){return 0===t&&1/t==-1/0}function li(t){return"number"==typeof t&&Number.isInteger(t)&&!ci(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function fi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ai(t)?4:10:As()}function di(t,e){const n=fi(t);if(n!==fi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return hi(t).isEqual(hi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ii(t.timestampValue),s=ii(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return oi(t.bytesValue).isEqual(oi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ri(t.geoPointValue.latitude)===ri(e.geoPointValue.latitude)&&ri(t.geoPointValue.longitude)===ri(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ri(t.integerValue)===ri(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ri(t.doubleValue),s=ri(e.doubleValue);return n===s?ci(n)===ci(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return $s(t.arrayValue.values||[],e.arrayValue.values||[],di);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Qs(n)!==Qs(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!di(n[t],s[t])))return!1;return!0}(t,e);default:return As()}}function pi(t,e){return void 0!==(t.values||[]).find(t=>di(t,e))}function gi(t,e){const n=fi(t),s=fi(e);if(n!==s)return js(n,s);switch(n){case 0:return 0;case 1:return js(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ri(t.integerValue||t.doubleValue),s=ri(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return mi(t.timestampValue,e.timestampValue);case 4:return mi(hi(t),hi(e));case 5:return js(t.stringValue,e.stringValue);case 6:return function(t,e){const n=oi(t),s=oi(e);return n.L(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=js(n[t],s[t]);if(0!==e)return e}return js(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=js(ri(t.latitude),ri(e.latitude));return 0!==n?n:js(ri(t.longitude),ri(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=gi(n[t],s[t]);if(e)return e}return js(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=js(s[t],r[t]);if(0!==e)return e;const o=gi(n[s[t]],i[r[t]]);if(0!==o)return o}return js(s.length,r.length)}(t.mapValue,e.mapValue);default:throw As()}}function mi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return js(t,e);const n=ii(t),s=ii(e),i=js(n.seconds,s.seconds);return 0!==i?i:js(n.nanos,s.nanos)}function yi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=ii(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?oi(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,Js.ut(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const r of n)i?i=!1:s+=",",s+=`${r}:${t(e.fields[r])}`;return s+"}"}(e.mapValue):As();var n,s}(t)}function wi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.et()}`}}function vi(t){return!!t&&"integerValue"in t}function bi(t){return!!t&&"arrayValue"in t}function Ei(t){return!!t&&"nullValue"in t}function Ii(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function _i(t){return!!t&&"mapValue"in t}class Ti{constructor(t){this.proto=t}static empty(){return new Ti({mapValue:{}})}field(t){if(t.Y())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!_i(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.J()])||null}}isEqual(t){return di(this.proto,t.proto)}}class Ni{constructor(t=Ti.empty()){this.Tt=t,this.It=new Map}set(t,e){return this.At(t,e),this}delete(t){return this.At(t,null),this}At(t,e){let n=this.It;for(let e=0;e<t.length-1;++e){const s=t.get(e);let i=n.get(s);i instanceof Map?n=i:i&&10===fi(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(s,i),n=i):(i=new Map,n.set(s,i),n=i)}n.set(t.J(),e)}Rt(){const t=this.Pt(Xs.st(),this.It);return null!=t?new Ti(t):this.Tt}Pt(t,e){let n=!1;const s=this.Tt.field(t),i=_i(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const r=this.Pt(t.child(s),e);null!=r&&(i[s]=r,n=!0)}else null!==e?(i[s]=e,n=!0):i.hasOwnProperty(s)&&(delete i[s],n=!0)}),n?{mapValue:{fields:i}}:null}}function Si(t){const e=[];return Zs(t.fields||{},(t,n)=>{const s=new Xs([t]);if(_i(n)){const t=Si(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new ei(e)}class Ai{constructor(t,e){this.key=t,this.version=e}}class xi extends Ai{constructor(t,e,n,s){super(t,e),this.Vt=n,this.gt=!!s.gt,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.Vt.field(t)}data(){return this.Vt}yt(){return this.Vt.proto}isEqual(t){return t instanceof xi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.gt===t.gt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Vt.isEqual(t.Vt)}toString(){return`Document(${this.key}, ${this.version}, ${this.Vt.toString()}, {hasLocalMutations: ${this.gt}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.gt||this.hasCommittedMutations}}class Di extends Ai{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof Di&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class ki extends Ai{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof ki&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class Li{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.bt=null}}function Oi(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Li(t,e,n,s,i,r,o)}function Ri(t){const e=Ds(t);if(null===e.bt){let t=e.path.et();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.et()+t.op.toString()+yi(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.et()+t.dir})(t)).join(","),ui(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Yi(e.startAt)),e.endAt&&(t+="|ub:",t+=Yi(e.endAt)),e.bt=t}return e.bt}function Ci(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Hi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!di(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Xi(t.startAt,e.startAt)&&Xi(t.endAt,e.endAt)}function Pi(t){return Js.lt(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ui extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.rt()?"in"===e||"not-in"===e?this.vt(t,e,n):new Vi(t,e,n):"array-contains"===e?new Fi(t,n):"in"===e?new ji(t,n):"not-in"===e?new $i(t,n):"array-contains-any"===e?new Bi(t,n):new Ui(t,e,n)}static vt(t,e,n){return"in"===e?new Mi(t,n):new qi(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.St(gi(e,this.value)):null!==e&&fi(this.value)===fi(e)&&this.St(gi(e,this.value))}St(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return As()}}Dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Vi extends Ui{constructor(t,e,n){super(t,e,n),this.key=Js.ut(n.referenceValue)}matches(t){const e=Js.K(t.key,this.key);return this.St(e)}}class Mi extends Ui{constructor(t,e){super(t,"in",e),this.keys=Gi("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class qi extends Ui{constructor(t,e){super(t,"not-in",e),this.keys=Gi("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Gi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>Js.ut(t.referenceValue))}class Fi extends Ui{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return bi(e)&&pi(e.arrayValue,this.value)}}class ji extends Ui{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&pi(this.value.arrayValue,e)}}class $i extends Ui{constructor(t,e){super(t,"not-in",e)}matches(t){if(pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!pi(this.value.arrayValue,e)}}class Bi extends Ui{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!bi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>pi(this.value.arrayValue,t))}}class Ki{constructor(t,e){this.position=t,this.before=e}}function Yi(t){return`${t.before?"b":"a"}:${t.position.map(t=>yi(t)).join(",")}`}class zi{constructor(t,e="asc"){this.field=t,this.dir=e}}function Hi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Wi(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.rt()?Js.K(Js.ut(o.referenceValue),n.key):gi(o,n.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Xi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!di(t.position[n],e.position[n]))return!1;return!0}class Ji{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.Ct=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.Nt=null,this.xt=null,this.startAt,this.endAt}}function Qi(t,e,n,s,i,r,o,a){return new Ji(t,e,n,s,i,r,o,a)}function Zi(t){return new Ji(t)}function tr(t){return!ui(t.limit)&&"F"===t.limitType}function er(t){return!ui(t.limit)&&"L"===t.limitType}function nr(t){return t.Ct.length>0?t.Ct[0].field:null}function sr(t){for(const e of t.filters)if(e.Dt())return e.field;return null}function ir(t){return null!==t.collectionGroup}function rr(t){const e=Ds(t);if(null===e.Nt){e.Nt=[];const t=sr(e),n=nr(e);if(null!==t&&null===n)t.rt()||e.Nt.push(new zi(t)),e.Nt.push(new zi(Xs.ot(),"asc"));else{let t=!1;for(const n of e.Ct)e.Nt.push(n),n.field.rt()&&(t=!0);if(!t){const t=e.Ct.length>0?e.Ct[e.Ct.length-1].dir:"asc";e.Nt.push(new zi(Xs.ot(),t))}}}return e.Nt}function or(t){const e=Ds(t);if(!e.xt)if("F"===e.limitType)e.xt=Oi(e.path,e.collectionGroup,rr(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of rr(e)){const e="desc"===n.dir?"asc":"desc";t.push(new zi(n.field,e))}const n=e.endAt?new Ki(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Ki(e.startAt.position,!e.startAt.before):null;e.xt=Oi(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.xt}function ar(t,e,n){return new Ji(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function hr(t,e){return Ci(or(t),or(e))&&t.limitType===e.limitType}function ur(t){return`${Ri(or(t))}|lt:${t.limitType}`}function cr(t){return`Query(target=${function(t){let e=t.path.et();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.et()} ${e.op} ${yi(e.value)}`;var e}).join(", ")}]`),ui(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.et()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Yi(t.startAt)),t.endAt&&(e+=", endAt: "+Yi(t.endAt)),`Target(${e})`}(or(t))}; limitType=${t.limitType})`}function lr(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.ht(t.collectionGroup)&&t.path.X(n):Js.lt(t.path)?t.path.isEqual(n):t.path.Z(n)}(t,e)&&function(t,e){for(const n of t.Ct)if(!n.field.rt()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Wi(t.startAt,rr(t),e))&&(!t.endAt||!Wi(t.endAt,rr(t),e))}(t,e)}function fr(t){return(e,n)=>{let s=!1;for(const i of rr(t)){const t=dr(i,e,n);if(0!==t)return t;s=s||i.field.rt()}return 0}}function dr(t,e,n){const s=t.field.rt()?Js.K(e.key,n.key):function(t,e,n){const s=e.field(t),i=n.field(t);return null!==s&&null!==i?gi(s,i):As()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return As()}}class pr{constructor(t,e,n,s,i=Ys.min(),r=Ys.min(),o=ni.Et){this.target=t,this.targetId=e,this.$t=n,this.sequenceNumber=s,this.Ot=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}kt(t){return new pr(this.target,this.targetId,this.$t,t,this.Ot,this.lastLimboFreeSnapshotVersion,this.resumeToken)}Mt(t,e){return new pr(this.target,this.targetId,this.$t,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}Ft(t){return new pr(this.target,this.targetId,this.$t,this.sequenceNumber,this.Ot,t,this.resumeToken)}}function gr(t,e){if(t.Lt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ci(e)?"-0":e}}function mr(t){return{integerValue:""+t}}function yr(t,e){return li(e)?mr(e):gr(t,e)}class wr{constructor(){this.Bt=void 0}}function vr(t,e,n){return t instanceof Ir?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof _r?Tr(t,e):t instanceof Nr?Sr(t,e):function(t,e){const n=Er(t,e),s=xr(n)+xr(t.qt);return vi(n)&&vi(t.qt)?mr(s):gr(t.Ut,s)}(t,e)}function br(t,e,n){return t instanceof _r?Tr(t,e):t instanceof Nr?Sr(t,e):n}function Er(t,e){return t instanceof Ar?vi(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Ir extends wr{}class _r extends wr{constructor(t){super(),this.elements=t}}function Tr(t,e){const n=Dr(e);for(const e of t.elements)n.some(t=>di(t,e))||n.push(e);return{arrayValue:{values:n}}}class Nr extends wr{constructor(t){super(),this.elements=t}}function Sr(t,e){let n=Dr(e);for(const e of t.elements)n=n.filter(t=>!di(t,e));return{arrayValue:{values:n}}}class Ar extends wr{constructor(t,e){super(),this.Ut=t,this.qt=e}}function xr(t){return ri(t.integerValue||t.doubleValue)}function Dr(t){return bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class kr{constructor(t,e){this.field=t,this.transform=e}}class Lr{constructor(t,e){this.version=t,this.transformResults=e}}class Or{constructor(t,e){this.updateTime=t,this.exists=e}static Kt(){return new Or}static exists(t){return new Or(void 0,t)}static updateTime(t){return new Or(t)}get Qt(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Rr(t,e){return void 0!==t.updateTime?e instanceof xi&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof xi}class Cr{}function Pr(t,e,n){return t instanceof Gr?function(t,e,n){let s=t.value;if(n.transformResults){const i=$r(t.fieldTransforms,e,n.transformResults);s=Kr(t.fieldTransforms,s,i)}return new xi(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof Fr?function(t,e,n){if(!Rr(t.Wt,e))return new ki(t.key,n.version);const s=jr(t,e,n.transformResults?$r(t.fieldTransforms,e,n.transformResults):[]);return new xi(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Di(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Ur(t,e,n){return t instanceof Gr?function(t,e,n){if(!Rr(t.Wt,e))return e;let s=t.value;const i=Br(t.fieldTransforms,n,e);s=Kr(t.fieldTransforms,s,i);const r=qr(e);return new xi(t.key,r,s,{gt:!0})}(t,e,n):t instanceof Fr?function(t,e,n){if(!Rr(t.Wt,e))return e;const s=qr(e),i=jr(t,e,Br(t.fieldTransforms,n,e));return new xi(t.key,s,i,{gt:!0})}(t,e,n):function(t,e){return Rr(t.Wt,e)?new Di(t.key,Ys.min()):e}(t,e)}function Vr(t,e){return function(t,e){let n=null;for(const s of t){const t=e instanceof xi?e.field(s.field):void 0,i=Er(s.transform,t||null);null!=i&&(n=null==n?(new Ni).set(s.field,i):n.set(s.field,i))}return n?n.Rt():null}(t.fieldTransforms,e)}function Mr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Wt.isEqual(e.Wt)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&$s(t,e,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof _r&&e instanceof _r||t instanceof Nr&&e instanceof Nr?$s(t.elements,e.elements,di):t instanceof Ar&&e instanceof Ar?di(t.qt,e.qt):t instanceof Ir&&e instanceof Ir}(t.transform,e.transform)})(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.jt.isEqual(e.jt))}function qr(t){return t instanceof xi?t.version:Ys.min()}class Gr extends Cr{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.Wt=n,this.fieldTransforms=s,this.type=0}}class Fr extends Cr{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.jt=n,this.Wt=s,this.fieldTransforms=i,this.type=1}}function jr(t,e,n){let s;return s=e instanceof xi?e.data():Ti.empty(),s=function(t,e){const n=new Ni(s);return t.jt.fields.forEach(e=>{if(!e.Y()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.Rt()}(t),s=Kr(t.fieldTransforms,s,n)}function $r(t,e,n){const s=[];xs(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform;let a=null;e instanceof xi&&(a=e.field(r.field)),s.push(br(o,a,n[i]))}return s}function Br(t,e,n){const s=[];for(const i of t){const t=i.transform;let r=null;n instanceof xi&&(r=n.field(i.field)),s.push(vr(t,r,e))}return s}function Kr(t,e,n){const s=new Ni(e);for(let e=0;e<t.length;e++){const i=t[e];s.set(i.field,n[e])}return s.Rt()}class Yr extends Cr{constructor(t,e){super(),this.key=t,this.Wt=e,this.type=2,this.fieldTransforms=[]}}class zr extends Cr{constructor(t,e){super(),this.key=t,this.Wt=e,this.type=3,this.fieldTransforms=[]}}class Hr{constructor(t){this.count=t}}var Wr,Xr;function Jr(t){switch(t){case ks.OK:return As();case ks.CANCELLED:case ks.UNKNOWN:case ks.DEADLINE_EXCEEDED:case ks.RESOURCE_EXHAUSTED:case ks.INTERNAL:case ks.UNAVAILABLE:case ks.UNAUTHENTICATED:return!1;case ks.INVALID_ARGUMENT:case ks.NOT_FOUND:case ks.ALREADY_EXISTS:case ks.PERMISSION_DENIED:case ks.FAILED_PRECONDITION:case ks.ABORTED:case ks.OUT_OF_RANGE:case ks.UNIMPLEMENTED:case ks.DATA_LOSS:return!0;default:return As()}}function Qr(t){if(void 0===t)return Ts("GRPC error has no .code"),ks.UNKNOWN;switch(t){case Wr.OK:return ks.OK;case Wr.CANCELLED:return ks.CANCELLED;case Wr.UNKNOWN:return ks.UNKNOWN;case Wr.DEADLINE_EXCEEDED:return ks.DEADLINE_EXCEEDED;case Wr.RESOURCE_EXHAUSTED:return ks.RESOURCE_EXHAUSTED;case Wr.INTERNAL:return ks.INTERNAL;case Wr.UNAVAILABLE:return ks.UNAVAILABLE;case Wr.UNAUTHENTICATED:return ks.UNAUTHENTICATED;case Wr.INVALID_ARGUMENT:return ks.INVALID_ARGUMENT;case Wr.NOT_FOUND:return ks.NOT_FOUND;case Wr.ALREADY_EXISTS:return ks.ALREADY_EXISTS;case Wr.PERMISSION_DENIED:return ks.PERMISSION_DENIED;case Wr.FAILED_PRECONDITION:return ks.FAILED_PRECONDITION;case Wr.ABORTED:return ks.ABORTED;case Wr.OUT_OF_RANGE:return ks.OUT_OF_RANGE;case Wr.UNIMPLEMENTED:return ks.UNIMPLEMENTED;case Wr.DATA_LOSS:return ks.DATA_LOSS;default:return As()}}(Xr=Wr||(Wr={}))[Xr.OK=0]="OK",Xr[Xr.CANCELLED=1]="CANCELLED",Xr[Xr.UNKNOWN=2]="UNKNOWN",Xr[Xr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Xr[Xr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Xr[Xr.NOT_FOUND=5]="NOT_FOUND",Xr[Xr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Xr[Xr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Xr[Xr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Xr[Xr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Xr[Xr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Xr[Xr.ABORTED=10]="ABORTED",Xr[Xr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Xr[Xr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Xr[Xr.INTERNAL=13]="INTERNAL",Xr[Xr.UNAVAILABLE=14]="UNAVAILABLE",Xr[Xr.DATA_LOSS=15]="DATA_LOSS";class Zr{constructor(t,e){this.K=t,this.root=e||eo.EMPTY}Gt(t,e){return new Zr(this.K,this.root.Gt(t,e,this.K).copy(null,null,eo.zt,null,null))}remove(t){return new Zr(this.K,this.root.remove(t,this.K).copy(null,null,eo.zt,null,null))}get(t){let e=this.root;for(;!e.Y();){const n=this.K(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.Y();){const s=this.K(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}Y(){return this.root.Y()}get size(){return this.root.size}Ht(){return this.root.Ht()}Jt(){return this.root.Jt()}Yt(t){return this.root.Yt(t)}forEach(t){this.Yt((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.Yt((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}Xt(t){return this.root.Xt(t)}Zt(){return new to(this.root,null,this.K,!1)}te(t){return new to(this.root,t,this.K,!1)}ee(){return new to(this.root,null,this.K,!0)}ne(t){return new to(this.root,t,this.K,!0)}}class to{constructor(t,e,n,s){this.se=s,this.ie=[];let i=1;for(;!t.Y();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.se?t.left:t.right;else{if(0===i){this.ie.push(t);break}this.ie.push(t),t=this.se?t.right:t.left}}re(){let t=this.ie.pop();const e={key:t.key,value:t.value};if(this.se)for(t=t.left;!t.Y();)this.ie.push(t),t=t.right;else for(t=t.right;!t.Y();)this.ie.push(t),t=t.left;return e}oe(){return this.ie.length>0}ce(){if(0===this.ie.length)return null;const t=this.ie[this.ie.length-1];return{key:t.key,value:t.value}}}class eo{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:eo.RED,this.left=null!=s?s:eo.EMPTY,this.right=null!=i?i:eo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new eo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}Y(){return!1}Yt(t){return this.left.Yt(t)||t(this.key,this.value)||this.right.Yt(t)}Xt(t){return this.right.Xt(t)||t(this.key,this.value)||this.left.Xt(t)}min(){return this.left.Y()?this:this.left.min()}Ht(){return this.min().key}Jt(){return this.right.Y()?this.key:this.right.Jt()}Gt(t,e,n){let s=this;const i=n(t,s.key);return(s=i<0?s.copy(null,null,null,s.left.Gt(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.Gt(t,e,n))).ae()}ue(){if(this.left.Y())return eo.EMPTY;let t=this;return t.left.he()||t.left.left.he()||(t=t.le()),(t=t.copy(null,null,null,t.left.ue(),null)).ae()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.Y()||s.left.he()||s.left.left.he()||(s=s.le()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.he()&&(s=s._e()),s.right.Y()||s.right.he()||s.right.left.he()||(s=s.fe()),0===e(t,s.key)){if(s.right.Y())return eo.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.ue())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.ae()}he(){return this.color}ae(){let t=this;return t.right.he()&&!t.left.he()&&(t=t.de()),t.left.he()&&t.left.left.he()&&(t=t._e()),t.left.he()&&t.right.he()&&(t=t.we()),t}le(){let t=this.we();return t.right.left.he()&&(t=(t=(t=t.copy(null,null,null,null,t.right._e())).de()).we()),t}fe(){let t=this.we();return t.left.left.he()&&(t=(t=t._e()).we()),t}de(){const t=this.copy(null,null,eo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}_e(){const t=this.copy(null,null,eo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}we(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Ee(){const t=this.Te();return Math.pow(2,t)<=this.size+1}Te(){if(this.he()&&this.left.he())throw As();if(this.right.he())throw As();const t=this.left.Te();if(t!==this.right.Te())throw As();return t+(this.he()?0:1)}}eo.EMPTY=null,eo.RED=!0,eo.zt=!1,eo.EMPTY=new class{constructor(){this.size=0}get key(){throw As()}get value(){throw As()}get color(){throw As()}get left(){throw As()}get right(){throw As()}copy(t,e,n,s,i){return this}Gt(t,e,n){return new eo(t,e)}remove(t,e){return this}Y(){return!0}Yt(t){return!1}Xt(t){return!1}Ht(){return null}Jt(){return null}he(){return!1}Ee(){return!0}Te(){return 0}};class no{constructor(t){this.K=t,this.data=new Zr(this.K)}has(t){return null!==this.data.get(t)}first(){return this.data.Ht()}last(){return this.data.Jt()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.Yt((e,n)=>(t(e),!1))}Ie(t,e){const n=this.data.te(t[0]);for(;n.oe();){const s=n.re();if(this.K(s.key,t[1])>=0)return;e(s.key)}}me(t,e){let n;for(n=void 0!==e?this.data.te(e):this.data.Zt();n.oe();)if(!t(n.re().key))return}Ae(t){const e=this.data.te(t);return e.oe()?e.re().key:null}Zt(){return new so(this.data.Zt())}te(t){return new so(this.data.te(t))}add(t){return this.copy(this.data.remove(t).Gt(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}Y(){return this.data.Y()}Re(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof no))return!1;if(this.size!==t.size)return!1;const e=this.data.Zt(),n=t.data.Zt();for(;e.oe();){const t=e.re().key,s=n.re().key;if(0!==this.K(t,s))return!1}return!0}tt(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new no(this.K);return e.data=t,e}}class so{constructor(t){this.Pe=t}re(){return this.Pe.re().key}oe(){return this.Pe.oe()}}const io=new Zr(Js.K);function ro(){return io}function oo(){return ro()}const ao=new Zr(Js.K);function ho(){return ao}const uo=new Zr(Js.K);function co(){return uo}const lo=new no(Js.K);function fo(...t){let e=lo;for(const n of t)e=e.add(n);return e}const po=new no(js);function go(){return po}class mo{constructor(t){this.K=t?(e,n)=>t(e,n)||Js.K(e.key,n.key):(t,e)=>Js.K(t.key,e.key),this.Ve=ho(),this.ge=new Zr(this.K)}static ye(t){return new mo(t.K)}has(t){return null!=this.Ve.get(t)}get(t){return this.Ve.get(t)}first(){return this.ge.Ht()}last(){return this.ge.Jt()}Y(){return this.ge.Y()}indexOf(t){const e=this.Ve.get(t);return e?this.ge.indexOf(e):-1}get size(){return this.ge.size}forEach(t){this.ge.Yt((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.Ve.Gt(t.key,t),e.ge.Gt(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.Ve.remove(t),this.ge.remove(e)):this}isEqual(t){if(!(t instanceof mo))return!1;if(this.size!==t.size)return!1;const e=this.ge.Zt(),n=t.ge.Zt();for(;e.oe();){const t=e.re().key,s=n.re().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new mo;return n.K=this.K,n.Ve=t,n.ge=e,n}}class yo{constructor(){this.pe=new Zr(Js.K)}track(t){const e=t.doc.key,n=this.pe.get(e);n?0!==t.type&&3===n.type?this.pe=this.pe.Gt(e,t):3===t.type&&1!==n.type?this.pe=this.pe.Gt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.pe=this.pe.Gt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.pe=this.pe.Gt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.pe=this.pe.remove(e):1===t.type&&2===n.type?this.pe=this.pe.Gt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.pe=this.pe.Gt(e,{type:2,doc:t.doc}):As():this.pe=this.pe.Gt(e,t)}be(){const t=[];return this.pe.Yt((e,n)=>{t.push(n)}),t}}class wo{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.ve=n,this.docChanges=s,this.Se=i,this.fromCache=r,this.De=o,this.Ce=a}static Ne(t,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new wo(t,e,mo.ye(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.Se.Y()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.De===t.De&&this.Se.isEqual(t.Se)&&hr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.ve.isEqual(t.ve)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class vo{constructor(t,e,n,s,i){this.Ot=t,this.xe=e,this.$e=n,this.Oe=s,this.ke=i}static Me(t,e){const n=new Map;return n.set(t,bo.Fe(t,e)),new vo(Ys.min(),n,go(),ro(),fo())}}class bo{constructor(t,e,n,s,i){this.resumeToken=t,this.Le=e,this.Be=n,this.qe=s,this.Ue=i}static Fe(t,e){return new bo(ni.Et,e,fo(),fo(),fo())}}class Eo{constructor(t,e,n,s){this.Ke=t,this.removedTargetIds=e,this.key=n,this.Qe=s}}class Io{constructor(t,e){this.targetId=t,this.We=e}}class _o{constructor(t,e,n=ni.Et,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class To{constructor(){this.je=0,this.Ge=Ao(),this.ze=ni.Et,this.He=!1,this.Je=!0}get Le(){return this.He}get resumeToken(){return this.ze}get Ye(){return 0!==this.je}get Xe(){return this.Je}Ze(t){t.wt()>0&&(this.Je=!0,this.ze=t)}tn(){let t=fo(),e=fo(),n=fo();return this.Ge.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:As()}}),new bo(this.ze,this.He,t,e,n)}en(){this.Je=!1,this.Ge=Ao()}nn(t,e){this.Je=!0,this.Ge=this.Ge.Gt(t,e)}sn(t){this.Je=!0,this.Ge=this.Ge.remove(t)}rn(){this.je+=1}on(){this.je-=1}cn(){this.Je=!0,this.He=!0}}class No{constructor(t){this.an=t,this.un=new Map,this.hn=ro(),this.ln=So(),this._n=new no(js)}fn(t){for(const e of t.Ke)t.Qe instanceof xi?this.dn(e,t.Qe):t.Qe instanceof Di&&this.wn(e,t.key,t.Qe);for(const e of t.removedTargetIds)this.wn(e,t.key,t.Qe)}En(t){this.Tn(t,e=>{const n=this.In(e);switch(t.state){case 0:this.mn(e)&&n.Ze(t.resumeToken);break;case 1:n.on(),n.Ye||n.en(),n.Ze(t.resumeToken);break;case 2:n.on(),n.Ye||this.removeTarget(e);break;case 3:this.mn(e)&&(n.cn(),n.Ze(t.resumeToken));break;case 4:this.mn(e)&&(this.An(e),n.Ze(t.resumeToken));break;default:As()}})}Tn(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.un.forEach((t,n)=>{this.mn(n)&&e(n)})}Rn(t){const e=t.targetId,n=t.We.count,s=this.Pn(e);if(s){const t=s.target;if(Pi(t))if(0===n){const n=new Js(t.path);this.wn(e,n,new Di(n,Ys.min()))}else xs(1===n);else this.Vn(e)!==n&&(this.An(e),this._n=this._n.add(e))}}gn(t){const e=new Map;this.un.forEach((n,s)=>{const i=this.Pn(s);if(i){if(n.Le&&Pi(i.target)){const e=new Js(i.target.path);null!==this.hn.get(e)||this.yn(s,e)||this.wn(s,e,new Di(e,t))}n.Xe&&(e.set(s,n.tn()),n.en())}});let n=fo();this.ln.forEach((t,e)=>{let s=!0;e.me(t=>{const e=this.Pn(t);return!e||2===e.$t||(s=!1,!1)}),s&&(n=n.add(t))});const s=new vo(t,e,this._n,this.hn,n);return this.hn=ro(),this.ln=So(),this._n=new no(js),s}dn(t,e){if(!this.mn(t))return;const n=this.yn(t,e.key)?2:0;this.In(t).nn(e.key,n),this.hn=this.hn.Gt(e.key,e),this.ln=this.ln.Gt(e.key,this.pn(e.key).add(t))}wn(t,e,n){if(!this.mn(t))return;const s=this.In(t);this.yn(t,e)?s.nn(e,1):s.sn(e),this.ln=this.ln.Gt(e,this.pn(e).delete(t)),n&&(this.hn=this.hn.Gt(e,n))}removeTarget(t){this.un.delete(t)}Vn(t){const e=this.In(t).tn();return this.an.bn(t).size+e.Be.size-e.Ue.size}rn(t){this.In(t).rn()}In(t){let e=this.un.get(t);return e||(e=new To,this.un.set(t,e)),e}pn(t){let e=this.ln.get(t);return e||(e=new no(js),this.ln=this.ln.Gt(t,e)),e}mn(t){const e=null!==this.Pn(t);return e||_s("WatchChangeAggregator","Detected inactive target",t),e}Pn(t){const e=this.un.get(t);return e&&e.Ye?null:this.an.vn(t)}An(t){this.un.set(t,new To),this.an.bn(t).forEach(e=>{this.wn(t,e,null)})}yn(t,e){return this.an.bn(t).has(e)}}function So(){return new Zr(Js.K)}function Ao(){return new Zr(Js.K)}const xo={asc:"ASCENDING",desc:"DESCENDING"},Do={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ko{constructor(t,e){this.p=t,this.Lt=e}}function Lo(t,e){return t.Lt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Oo(t,e){return t.Lt?e.toBase64():e.toUint8Array()}function Ro(t){return xs(!!t),Ys.F(function(t){const e=ii(t);return new Ks(e.seconds,e.nanos)}(t))}function Co(t,e){return function(t){return new Hs(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).et()}function Po(t){const e=Hs.nt(t);return xs(Zo(e)),e}function Uo(t,e){return Co(t.p,e.path)}function Vo(t,e){const n=Po(e);if(n.get(1)!==t.p.projectId)throw new Ls(ks.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.p.projectId);if(n.get(3)!==t.p.database)throw new Ls(ks.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.p.database);return new Js(Fo(n))}function Mo(t,e){return Co(t.p,e)}function qo(t){const e=Po(t);return 4===e.length?Hs.st():Fo(e)}function Go(t){return new Hs(["projects",t.p.projectId,"databases",t.p.database]).et()}function Fo(t){return xs(t.length>4&&"documents"===t.get(4)),t.j(5)}function jo(t,e,n){return{name:Uo(t,e),fields:n.proto.mapValue.fields}}function $o(t,e,n){const s=Vo(t,e.name),i=Ro(e.updateTime),r=new Ti({mapValue:{fields:e.fields}});return new xi(s,i,r,{hasCommittedMutations:!!n})}function Bo(t,e){let n;if(e instanceof Gr)n={update:jo(t,e.key,e.value)};else if(e instanceof Yr)n={delete:Uo(t,e.key)};else if(e instanceof Fr)n={update:jo(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.et())),{fieldPaths:e}}(e.jt)};else{if(!(e instanceof zr))return As();n={verify:Uo(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Ir)return{fieldPath:e.field.et(),setToServerValue:"REQUEST_TIME"};if(n instanceof _r)return{fieldPath:e.field.et(),appendMissingElements:{values:n.elements}};if(n instanceof Nr)return{fieldPath:e.field.et(),removeAllFromArray:{values:n.elements}};if(n instanceof Ar)return{fieldPath:e.field.et(),increment:n.qt};throw As()})(0,t))),e.Wt.Qt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return Lo(t,e.q())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:As()}(t,e.Wt)),n}function Ko(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Or.updateTime(Ro(t.updateTime)):void 0!==t.exists?Or.exists(t.exists):Or.Kt()}(e.currentDocument):Or.Kt(),s=e.updateTransforms?e.updateTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)xs("REQUEST_TIME"===e.setToServerValue),n=new Ir;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new _r(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Nr(t)}else"increment"in e?n=new Ar(t,e.increment):As();const s=Xs.ct(e.fieldPath);return new kr(s,n)})(t,e)):[];if(e.update){e.update.name;const i=Vo(t,e.update.name),r=new Ti({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new ei(e.map(t=>Xs.ct(t)))}(e.updateMask);return new Fr(i,r,t,n,s)}return new Gr(i,r,n,s)}if(e.delete){const s=Vo(t,e.delete);return new Yr(s,n)}if(e.verify){const s=Vo(t,e.verify);return new zr(s,n)}return As()}function Yo(t,e){return{documents:[Mo(t,e.path)]}}function zo(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Mo(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Mo(t,s.G()),n.structuredQuery.from=[{collectionId:s.J()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Ii(t.value))return{unaryFilter:{field:Jo(t.field),op:"IS_NAN"}};if(Ei(t.value))return{unaryFilter:{field:Jo(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ii(t.value))return{unaryFilter:{field:Jo(t.field),op:"IS_NOT_NAN"}};if(Ei(t.value))return{unaryFilter:{field:Jo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Jo(t.field),op:function(t){return Do[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:Jo(t.field),direction:function(t){return xo[t]}(t.dir)}})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.Lt||ui(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Wo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Wo(e.endAt)),n}function Ho(t){let e=qo(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){xs(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Qo(t.unaryFilter.field);return Ui.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Qo(t.unaryFilter.field);return Ui.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Qo(t.unaryFilter.field);return Ui.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Qo(t.unaryFilter.field);return Ui.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return As()}}(e)]:void 0!==e.fieldFilter?[function(t){return Ui.create(Qo(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return As()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):As():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new zi(Qo(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return ui(e="object"==typeof t?t.value:t)?null:e}(n.limit));let h=null;n.startAt&&(h=Xo(n.startAt));let u=null;return n.endAt&&(u=Xo(n.endAt)),Qi(e,i,o,r,a,"F",h,u)}function Wo(t){return{before:t.before,values:t.position}}function Xo(t){const e=!!t.before,n=t.values||[];return new Ki(n,e)}function Jo(t){return{fieldPath:t.et()}}function Qo(t){return Xs.ct(t.fieldPath)}function Zo(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class ta{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class ea{constructor(t){this.Sn=null,this.Dn=null,this.result=void 0,this.error=void 0,this.Cn=!1,this.Nn=!1,t(t=>{this.Cn=!0,this.result=t,this.Sn&&this.Sn(t)},t=>{this.Cn=!0,this.error=t,this.Dn&&this.Dn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.Nn&&As(),this.Nn=!0,this.Cn?this.error?this.xn(e,this.error):this.$n(t,this.result):new ea((n,s)=>{this.Sn=(e=>{this.$n(t,e).next(n,s)}),this.Dn=(t=>{this.xn(e,t).next(n,s)})})}On(){return new Promise((t,e)=>{this.next(t,e)})}kn(t){try{const e=t();return e instanceof ea?e:ea.resolve(e)}catch(t){return ea.reject(t)}}$n(t,e){return t?this.kn(()=>t(e)):ea.resolve(e)}xn(t,e){return t?this.kn(()=>t(e)):ea.reject(e)}static resolve(t){return new ea((e,n)=>{e(t)})}static reject(t){return new ea((e,n)=>{n(t)})}static Mn(t){return new ea((e,n)=>{let s=0,i=0,r=!1;t.forEach(t=>{++s,t.next(()=>{++i,r&&i===s&&e()},t=>n(t))}),r=!0,i===s&&e()})}static Fn(t){let e=ea.resolve(!1);for(const n of t)e=e.next(t=>t?ea.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.Mn(n)}}class na{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Ln=new ta,this.transaction.oncomplete=(()=>{this.Ln.resolve()}),this.transaction.onabort=(()=>{e.error?this.Ln.reject(new ra(t,e.error)):this.Ln.resolve()}),this.transaction.onerror=(e=>{const n=ca(e.target.error);this.Ln.reject(new ra(t,n))})}static open(t,e,n,s){try{return new na(e,t.transaction(s,n))}catch(t){throw new ra(e,t)}}get Bn(){return this.Ln.promise}abort(t){t&&this.Ln.reject(t),this.aborted||(_s("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new aa(e)}}class sa{constructor(t,e,n){this.name=t,this.version=e,this.qn=n,12.2===sa.Un(s())&&Ts("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return _s("SimpleDb","Removing database:",t),ha(window.indexedDB.deleteDatabase(t)).On()}static Kn(){if("undefined"==typeof indexedDB)return!1;if(sa.Qn())return!0;const t=s(),e=sa.Un(t),n=0<e&&e<10,i=sa.Wn(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static Qn(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.jn)}static Gn(t,e){return t.store(e)}static Un(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Wn(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async zn(t){return this.db||(_s("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=(t=>{const n=t.target.result;e(n)}),s.onblocked=(()=>{n(new ra(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),s.onerror=(e=>{const s=e.target.error;"VersionError"===s.name?n(new Ls(ks.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new ra(t,s))}),s.onupgradeneeded=(t=>{_s("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.qn.Hn(e,s.transaction,t.oldVersion,this.version).next(()=>{_s("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Jn&&(this.db.onversionchange=(t=>this.Jn(t))),this.db}Yn(t){this.Jn=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n,s){const i="readonly"===e;for(;;){0;try{this.db=await this.zn(t);const e=na.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).catch(t=>(e.abort(t),ea.reject(t))).On();return r.catch(()=>{}),await e.Bn,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(_s("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ia{constructor(t){this.Xn=t,this.Zn=!1,this.ts=null}get Cn(){return this.Zn}get es(){return this.ts}set cursor(t){this.Xn=t}done(){this.Zn=!0}ns(t){this.ts=t}delete(){return ha(this.Xn.delete())}}class ra extends Ls{constructor(t,e){super(ks.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function oa(t){return"IndexedDbTransactionError"===t.name}class aa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(_s("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(_s("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ha(n)}add(t){return _s("SimpleDb","ADD",this.store.name,t,t),ha(this.store.add(t))}get(t){return ha(this.store.get(t)).next(e=>(void 0===e&&(e=null),_s("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return _s("SimpleDb","DELETE",this.store.name,t),ha(this.store.delete(t))}count(){return _s("SimpleDb","COUNT",this.store.name),ha(this.store.count())}ss(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.rs(n,(t,e)=>{s.push(e)}).next(()=>s)}os(t,e){_s("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.cs=!1;const s=this.cursor(n);return this.rs(s,(t,e,n)=>n.delete())}us(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.rs(s,e)}hs(t){const e=this.cursor({});return new ea((n,s)=>{e.onerror=(t=>{const e=ca(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}rs(t,e){const n=[];return new ea((s,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void s();const r=new ia(i),o=e(i.primaryKey,i.value,r);if(o instanceof ea){const t=o.catch(t=>(r.done(),ea.reject(t)));n.push(t)}r.Cn?s():null===r.es?i.continue():i.continue(r.es)})}).next(()=>ea.Mn(n))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.cs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ha(t){return new ea((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=ca(t.target.error);n(e)})})}let ua=!1;function ca(t){const e=sa.Un(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Ls("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ua||(ua=!0,setTimeout(()=>{throw t},0)),t}}return t}class la{constructor(t,e,n,s,i){this.ls=t,this._s=e,this.fs=n,this.op=s,this.ds=i,this.ws=new ta,this.then=this.ws.promise.then.bind(this.ws.promise),this.ws.promise.catch(t=>{})}static Es(t,e,n,s,i){const r=Date.now()+n,o=new la(t,e,r,s,i);return o.start(n),o}start(t){this.Ts=setTimeout(()=>this.Is(),t)}As(){return this.Is()}cancel(t){null!==this.Ts&&(this.clearTimeout(),this.ws.reject(new Ls(ks.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}Is(){this.ls.Rs(()=>null!==this.Ts?(this.clearTimeout(),this.op().then(t=>this.ws.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Ts&&(this.ds(this),clearTimeout(this.Ts),this.Ts=null)}}function fa(t,e){if(Ts("AsyncQueue",`${e}: ${t}`),oa(t))return new Ls(ks.UNAVAILABLE,`${e}: ${t}`);throw t}const da="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pa{constructor(){this.Ps=[]}Vs(t){this.Ps.push(t)}gs(){this.Ps.forEach(t=>t())}}function ga(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=ya(e)),e=ma(t.get(n),e);return ya(e)}function ma(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function ya(t){return t+""}function wa(t){const e=t.length;if(xs(e>=2),2===e)return xs(""===t.charAt(0)&&""===t.charAt(1)),Hs.st();const n=e-2,s=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>r)&&As(),t.charAt(e+1)){case"":const r=t.substring(n,e);let o;0===i.length?o=r:(o=i+=r,i=""),s.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:As()}n=e+2}return new Hs(s)}class va{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class ba{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}ba.store="owner",ba.key="owner";class Ea{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ea.store="mutationQueues",Ea.keyPath="userId";class Ia{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}Ia.store="mutations",Ia.keyPath="batchId",Ia.userMutationsIndex="userMutationsIndex",Ia.userMutationsKeyPath=["userId","batchId"];class _a{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,ga(e)]}static key(t,e,n){return[t,ga(e),n]}}_a.store="documentMutations",_a.PLACEHOLDER=new _a;class Ta{constructor(t,e){this.path=t,this.readTime=e}}class Na{constructor(t,e){this.path=t,this.version=e}}class Sa{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}Sa.store="remoteDocuments",Sa.readTimeIndex="readTimeIndex",Sa.readTimeIndexPath="readTime",Sa.collectionReadTimeIndex="collectionReadTimeIndex",Sa.collectionReadTimeIndexPath=["parentPath","readTime"];class Aa{constructor(t){this.byteSize=t}}Aa.store="remoteDocumentGlobal",Aa.key="remoteDocumentGlobalKey";class xa{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}xa.store="targets",xa.keyPath="targetId",xa.queryTargetsIndexName="queryTargetsIndex",xa.queryTargetsKeyPath=["canonicalId","targetId"];class Da{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}Da.store="targetDocuments",Da.keyPath=["targetId","path"],Da.documentTargetsIndex="documentTargetsIndex",Da.documentTargetsKeyPath=["path","targetId"];class ka{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}ka.key="targetGlobalKey",ka.store="targetGlobal";class La{constructor(t,e){this.collectionId=t,this.parent=e}}La.store="collectionParents",La.keyPath=["collectionId","parent"];class Oa{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}Oa.store="clientMetadata",Oa.keyPath="clientId";class Ra{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Ra.store="bundles",Ra.keyPath="bundleId";class Ca{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Ca.store="namedQueries",Ca.keyPath="name";const Pa=[...[...[...[...[Ea.store,Ia.store,_a.store,Sa.store,xa.store,ba.store,ka.store,Da.store],Oa.store],Aa.store],La.store],Ra.store,Ca.store];class Ua extends pa{constructor(t,e){super(),this.ys=t,this.ps=e}}function Va(t,e){const n=Ds(t);return sa.Gn(n.ys,e)}class Ma{constructor(t,e,n,s){this.batchId=t,this.bs=e,this.baseMutations=n,this.mutations=s}vs(t,e,n){const s=n.Ss;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=Pr(i,e,s[n]))}return e}Ds(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Ur(n,e,this.bs));for(const n of this.mutations)n.key.isEqual(t)&&(e=Ur(n,e,this.bs));return e}Cs(t){let e=t;return this.mutations.forEach(n=>{const s=this.Ds(n.key,t.get(n.key));s&&(e=e.Gt(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),fo())}isEqual(t){return this.batchId===t.batchId&&$s(this.mutations,t.mutations,(t,e)=>Mr(t,e))&&$s(this.baseMutations,t.baseMutations,(t,e)=>Mr(t,e))}}class qa{constructor(t,e,n,s){this.batch=t,this.Ns=e,this.Ss=n,this.xs=s}static from(t,e,n){xs(t.mutations.length===n.length);let s=co();const i=t.mutations;for(let t=0;t<i.length;t++)s=s.Gt(i[t].key,n[t].version);return new qa(t,e,n,s)}}class Ga{constructor(t){this.$s=t}}function Fa(t,e){if(e.document)return $o(t.$s,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=Js._t(e.noDocument.path),n=Ya(e.noDocument.readTime);return new Di(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=Js._t(e.unknownDocument.path),n=Ya(e.unknownDocument.version);return new ki(t,n)}return As()}function ja(t,e,n){const s=$a(n),i=e.key.path.G().tt();if(e instanceof xi){const n=function(t,e){return{name:Uo(t,e.key),fields:e.yt().mapValue.fields,updateTime:Lo(t,e.version.q())}}(t.$s,e),r=e.hasCommittedMutations;return new Sa(null,null,n,r,s,i)}if(e instanceof Di){const t=e.key.path.tt(),n=Ka(e.version),r=e.hasCommittedMutations;return new Sa(null,new Ta(t,n),null,r,s,i)}if(e instanceof ki){const t=e.key.path.tt(),n=Ka(e.version);return new Sa(new Na(t,n),null,null,!0,s,i)}return As()}function $a(t){const e=t.q();return[e.seconds,e.nanoseconds]}function Ba(t){const e=new Ks(t[0],t[1]);return Ys.F(e)}function Ka(t){const e=t.q();return new va(e.seconds,e.nanoseconds)}function Ya(t){const e=new Ks(t.seconds,t.nanoseconds);return Ys.F(e)}function za(t,e){const n=(e.baseMutations||[]).map(e=>Ko(t.$s,e));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map(e=>Ko(t.$s,e)),i=Ks.fromMillis(e.localWriteTimeMs);return new Ma(e.batchId,i,n,s)}function Ha(t){const e=Ya(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Ya(t.lastLimboFreeSnapshotVersion):Ys.min();let s;var i;return void 0!==t.query.documents?(xs(1===(i=t.query).documents.length),s=or(Zi(qo(i.documents[0])))):s=function(t){return or(Ho(t))}(t.query),new pr(s,t.targetId,0,t.lastListenSequenceNumber,e,n,ni.fromBase64String(t.resumeToken))}function Wa(t,e){const n=Ka(e.Ot),s=Ka(e.lastLimboFreeSnapshotVersion);let i;i=Pi(e.target)?Yo(t.$s,e.target):zo(t.$s,e.target);const r=e.resumeToken.toBase64();return new xa(e.targetId,Ri(e.target),n,r,e.sequenceNumber,s,i)}function Xa(t){const e=Ho({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?ar(e,e.limit,"L"):e}class Ja{Os(t,e){return Qa(t).get(e).next(t=>{if(t)return{id:(e=t).bundleId,createTime:Ya(e.createTime),version:e.version};var e})}ks(t,e){return Qa(t).put({bundleId:(n=e).id,createTime:Ka(Ro(n.createTime)),version:n.version});var n}Ms(t,e){return Za(t).get(e).next(t=>{if(t)return{name:(e=t).name,query:Xa(e.bundledQuery),readTime:Ya(e.readTime)};var e})}Fs(t,e){return Za(t).put(function(t){return{name:t.name,readTime:Ka(Ro(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Qa(t){return Va(t,Ra.store)}function Za(t){return Va(t,Ca.store)}class th{constructor(){this.Ls=new eh}Bs(t,e){return this.Ls.add(e),ea.resolve()}qs(t,e){return ea.resolve(this.Ls.getEntries(e))}}class eh{constructor(){this.index={}}add(t){const e=t.J(),n=t.G(),s=this.index[e]||new no(Hs.K),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.J(),n=t.G(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new no(Hs.K)).tt()}}class nh{constructor(){this.Us=new eh}Bs(t,e){if(!this.Us.has(e)){const n=e.J(),s=e.G();t.Vs(()=>{this.Us.add(e)});const i={collectionId:n,parent:ga(s)};return sh(t).put(i)}return ea.resolve()}qs(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Bs(e),""],!1,!0);return sh(t).ss(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(wa(s.parent))}return n})}}function sh(t){return Va(t,La.store)}const ih={Ks:!1,Qs:0,Ws:0,js:0};class rh{constructor(t,e,n){this.Gs=t,this.zs=e,this.Hs=n}static Js(t){return new rh(t,rh.Ys,rh.Xs)}}async function oh(t){if(t.code!==ks.FAILED_PRECONDITION||t.message!==da)throw t;_s("LocalStore","Unexpectedly lost primary lease")}rh.Ys=10,rh.Xs=1e3,rh.Zs=new rh(41943040,rh.Ys,rh.Xs),rh.ti=new rh(-1,0,0);class ah{constructor(t,e){this.ei=t,this.ni=e,this.si={}}get(t){const e=this.ei(t),n=this.si[e];if(void 0!==n)for(const[e,s]of n)if(this.ni(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.ei(t),s=this.si[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.ni(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.si[n]=[[t,e]]}delete(t){const e=this.ei(t),n=this.si[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.ni(n[s][0],t))return 1===n.length?delete this.si[e]:n.splice(s,1),!0;return!1}forEach(t){Zs(this.si,(e,n)=>{for(const[e,s]of n)t(e,s)})}Y(){return ti(this.si)}}class hh{constructor(){this.ii=new ah(t=>t.toString(),(t,e)=>t.isEqual(e)),this.ri=!1}oi(t){const e=this.ii.get(t);return e?e.readTime:Ys.min()}ci(t,e){this.ai(),this.ii.set(t.key,{ui:t,readTime:e})}hi(t,e=null){this.ai(),this.ii.set(t,{ui:null,readTime:e})}li(t,e){this.ai();const n=this.ii.get(e);return void 0!==n?ea.resolve(n.ui):this._i(t,e)}getEntries(t,e){return this.fi(t,e)}apply(t){return this.ai(),this.ri=!0,this.di(t)}ai(){}}function uh(t,e,n){const s=t.store(Ia.store),i=t.store(_a.store),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=s.us({range:o},(t,e,n)=>(a++,n.delete()));r.push(h.next(()=>{xs(1===a)}));const u=[];for(const t of n.mutations){const s=_a.key(e,t.key.path,n.batchId);r.push(i.delete(s)),u.push(t.key)}return ea.Mn(r).next(()=>u)}function ch(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw As();e=t.noDocument}return JSON.stringify(e).length}class lh{constructor(t,e,n,s){this.userId=t,this.Ut=e,this.wi=n,this.Ei=s,this.Ti={}}static Ii(t,e,n,s){xs(""!==t.uid);const i=t.t()?t.uid:"";return new lh(i,e,n,s)}mi(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dh(t).us({index:Ia.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}Ai(t,e,n,s){const i=ph(t),r=dh(t);return r.add({}).next(o=>{xs("number"==typeof o);const a=new Ma(o,e,n,s),h=function(t,e,n){const s=n.baseMutations.map(e=>Bo(t.$s,e)),i=n.mutations.map(e=>Bo(t.$s,e));return new Ia(e,n.batchId,n.bs.toMillis(),s,i)}(this.Ut,this.userId,a),u=[];let c=new no((t,e)=>js(t.et(),e.et()));for(const t of s){const e=_a.key(this.userId,t.key.path,o);c=c.add(t.key.path.G()),u.push(r.put(h)),u.push(i.put(e,_a.PLACEHOLDER))}return c.forEach(e=>{u.push(this.wi.Bs(t,e))}),t.Vs(()=>{this.Ti[o]=a.keys()}),ea.Mn(u).next(()=>a)})}Ri(t,e){return dh(t).get(e).next(t=>t?(xs(t.userId===this.userId),za(this.Ut,t)):null)}Pi(t,e){return this.Ti[e]?ea.resolve(this.Ti[e]):this.Ri(t,e).next(t=>{if(t){const n=t.keys();return this.Ti[e]=n,n}return null})}Vi(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return dh(t).us({index:Ia.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(xs(e.batchId>=n),i=za(this.Ut,e)),s.done()}).next(()=>i)}gi(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return dh(t).us({index:Ia.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}yi(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return dh(t).ss(Ia.userMutationsIndex,e).next(t=>t.map(t=>za(this.Ut,t)))}pi(t,e){const n=_a.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return ph(t).us({range:s},(n,s,r)=>{const[o,a,h]=n,u=wa(a);if(o===this.userId&&e.path.isEqual(u))return dh(t).get(h).next(t=>{if(!t)throw As();xs(t.userId===this.userId),i.push(za(this.Ut,t))});r.done()}).next(()=>i)}bi(t,e){let n=new no(js);const s=[];return e.forEach(e=>{const i=_a.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=ph(t).us({range:r},(t,s,i)=>{const[r,o,a]=t,h=wa(o);r===this.userId&&e.path.isEqual(h)?n=n.add(a):i.done()});s.push(o)}),ea.Mn(s).next(()=>this.vi(t,n))}Si(t,e){const n=e.path,s=n.length+1,i=_a.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new no(js);return ph(t).us({range:r},(t,e,i)=>{const[r,a,h]=t,u=wa(a);r===this.userId&&n.X(u)?u.length===s&&(o=o.add(h)):i.done()}).next(()=>this.vi(t,o))}vi(t,e){const n=[],s=[];return e.forEach(e=>{s.push(dh(t).get(e).next(t=>{if(null===t)throw As();xs(t.userId===this.userId),n.push(za(this.Ut,t))}))}),ea.Mn(s).next(()=>n)}Di(t,e){return uh(t.ys,this.userId,e).next(n=>(t.Vs(()=>{this.Ci(e.batchId)}),ea.forEach(n,e=>this.Ei.Ni(t,e))))}Ci(t){delete this.Ti[t]}xi(t){return this.mi(t).next(e=>{if(!e)return ea.resolve();const n=IDBKeyRange.lowerBound(_a.prefixForUser(this.userId)),s=[];return ph(t).us({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=wa(t[1]);s.push(e)}else n.done()}).next(()=>{xs(0===s.length)})})}$i(t,e){return fh(t,this.userId,e)}Oi(t){return gh(t).get(this.userId).next(t=>t||new Ea(this.userId,-1,""))}}function fh(t,e,n){const s=_a.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return ph(t).us({range:r,cs:!0},(t,n,s)=>{const[r,a,h]=t;r===e&&a===i&&(o=!0),s.done()}).next(()=>o)}function dh(t){return Va(t,Ia.store)}function ph(t){return Va(t,_a.store)}function gh(t){return Va(t,Ea.store)}class mh{constructor(t){this.ki=t}next(){return this.ki+=2,this.ki}static Mi(){return new mh(0)}static Fi(){return new mh(-1)}}class yh{constructor(t,e){this.Ei=t,this.Ut=e}Li(t){return this.Bi(t).next(e=>{const n=new mh(e.highestTargetId);return e.highestTargetId=n.next(),this.qi(t,e).next(()=>e.highestTargetId)})}Ui(t){return this.Bi(t).next(t=>Ys.F(new Ks(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Ki(t){return this.Bi(t).next(t=>t.highestListenSequenceNumber)}Qi(t,e,n){return this.Bi(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.q()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.qi(t,s)))}Wi(t,e){return this.ji(t,e).next(()=>this.Bi(t).next(n=>(n.targetCount+=1,this.Gi(e,n),this.qi(t,n))))}zi(t,e){return this.ji(t,e)}Hi(t,e){return this.Ji(t,e.targetId).next(()=>wh(t).delete(e.targetId)).next(()=>this.Bi(t)).next(e=>(xs(e.targetCount>0),e.targetCount-=1,this.qi(t,e)))}Yi(t,e,n){let s=0;const i=[];return wh(t).us((r,o)=>{const a=Ha(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,i.push(this.Hi(t,a)))}).next(()=>ea.Mn(i)).next(()=>s)}Tn(t,e){return wh(t).us((t,n)=>{const s=Ha(n);e(s)})}Bi(t){return vh(t).get(ka.key).next(t=>(xs(null!==t),t))}qi(t,e){return vh(t).put(ka.key,e)}ji(t,e){return wh(t).put(Wa(this.Ut,e))}Gi(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}Xi(t){return this.Bi(t).next(t=>t.targetCount)}Zi(t,e){const n=Ri(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return wh(t).us({range:s,index:xa.queryTargetsIndexName},(t,n,s)=>{const r=Ha(n);Ci(e,r.target)&&(i=r,s.done())}).next(()=>i)}tr(t,e,n){const s=[],i=bh(t);return e.forEach(e=>{const r=ga(e.path);s.push(i.put(new Da(n,r))),s.push(this.Ei.er(t,n,e))}),ea.Mn(s)}nr(t,e,n){const s=bh(t);return ea.forEach(e,e=>{const i=ga(e.path);return ea.Mn([s.delete([n,i]),this.Ei.sr(t,n,e)])})}Ji(t,e){const n=bh(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}ir(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=bh(t);let i=fo();return s.us({range:n,cs:!0},(t,e,n)=>{const s=wa(t[1]),r=new Js(s);i=i.add(r)}).next(()=>i)}$i(t,e){const n=ga(e.path),s=IDBKeyRange.bound([n],[Bs(n)],!1,!0);let i=0;return bh(t).us({index:Da.documentTargetsIndex,cs:!0,range:s},([t,e],n,s)=>{0!==t&&(i++,s.done())}).next(()=>i>0)}vn(t,e){return wh(t).get(e).next(t=>t?Ha(t):null)}}function wh(t){return Va(t,xa.store)}function vh(t){return Va(t,ka.store)}function bh(t){return Va(t,Da.store)}function Eh([t,e],[n,s]){const i=js(t,n);return 0===i?js(e,s):i}class Ih{constructor(t){this.rr=t,this.buffer=new no(Eh),this.cr=0}ar(){return++this.cr}ur(t){const e=[t,this.ar()];if(this.buffer.size<this.rr)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Eh(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class _h{constructor(t,e){this.hr=t,this.ls=e,this.lr=!1,this._r=null}start(t){-1!==this.hr.params.Gs&&this.dr(t)}stop(){this._r&&(this._r.cancel(),this._r=null)}get wr(){return null!==this._r}dr(t){const e=this.lr?3e5:6e4;_s("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this._r=this.ls.Er("lru_garbage_collection",e,async()=>{this._r=null,this.lr=!0;try{await t.Tr(this.hr)}catch(t){oa(t)?_s("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await oh(t)}await this.dr(t)})}}class Th{constructor(t,e){this.Ir=t,this.params=e}mr(t,e){return this.Ir.Ar(t).next(t=>Math.floor(e/100*t))}Rr(t,e){if(0===e)return ea.resolve(qs.O);const n=new Ih(e);return this.Ir.Tn(t,t=>n.ur(t.sequenceNumber)).next(()=>this.Ir.Pr(t,t=>n.ur(t))).next(()=>n.maxValue)}Yi(t,e,n){return this.Ir.Yi(t,e,n)}Vr(t,e){return this.Ir.Vr(t,e)}gr(t,e){return-1===this.params.Gs?(_s("LruGarbageCollector","Garbage collection skipped; disabled"),ea.resolve(ih)):this.yr(t).next(n=>n<this.params.Gs?(_s("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.Gs}`),ih):this.pr(t,e))}yr(t){return this.Ir.yr(t)}pr(t,e){let n,s,i,r,o,a,u;const c=Date.now();return this.mr(t,this.params.zs).next(e=>(e>this.params.Hs?(_s("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.Hs} from ${e}`),s=this.params.Hs):s=e,r=Date.now(),this.Rr(t,s))).next(s=>(n=s,o=Date.now(),this.Yi(t,n,e))).next(e=>(i=e,a=Date.now(),this.Vr(t,n))).next(t=>(u=Date.now(),Is()<=h.DEBUG&&_s("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-c}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-c}ms`),ea.resolve({Ks:!0,Qs:s,Ws:i,js:t})))}}class Nh{constructor(t,e){this.db=t,this.hr=function(t,e){return new Th(t,e)}(this,e)}Ar(t){const e=this.br(t);return this.db.vr().Xi(t).next(t=>e.next(e=>t+e))}br(t){let e=0;return this.Pr(t,t=>{e++}).next(()=>e)}Tn(t,e){return this.db.vr().Tn(t,e)}Pr(t,e){return this.Sr(t,(t,n)=>e(n))}er(t,e,n){return Sh(t,n)}sr(t,e,n){return Sh(t,n)}Yi(t,e,n){return this.db.vr().Yi(t,e,n)}Ni(t,e){return Sh(t,e)}Dr(t,e){return function(t,e){let n=!1;return gh(t).hs(s=>fh(t,s,e).next(t=>(t&&(n=!0),ea.resolve(!t)))).next(()=>n)}(t,e)}Vr(t,e){const n=this.db.Nr().Cr(),s=[];let i=0;return this.Sr(t,(r,o)=>{if(o<=e){const e=this.Dr(t,r).next(e=>{if(!e)return i++,n.li(t,r).next(()=>(n.hi(r),bh(t).delete([0,ga(r.path)])))});s.push(e)}}).next(()=>ea.Mn(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.kt(t.ps);return this.db.vr().zi(t,n)}$r(t,e){return Sh(t,e)}Sr(t,e){const n=bh(t);let s,i=qs.O;return n.us({index:Da.documentTargetsIndex},([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==qs.O&&e(new Js(wa(s)),i),i=o,s=r):i=qs.O}).next(()=>{i!==qs.O&&e(new Js(wa(s)),i)})}yr(t){return this.db.Nr().Or(t)}}function Sh(t,e){return bh(t).put(function(t,e){return new Da(0,ga(t.path),e)}(e,t.ps))}class Ah{constructor(t,e){this.Ut=t,this.wi=e}ci(t,e,n){return kh(t).put(Lh(e),n)}hi(t,e){const n=kh(t),s=Lh(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.kr(t,n)))}li(t,e){return kh(t).get(Lh(e)).next(t=>this.Mr(t))}Fr(t,e){return kh(t).get(Lh(e)).next(t=>{const e=this.Mr(t);return e?{ui:e,size:ch(t)}:null})}getEntries(t,e){let n=oo();return this.Lr(t,e,(t,e)=>{const s=this.Mr(e);n=n.Gt(t,s)}).next(()=>n)}Br(t,e){let n=oo(),s=new Zr(Js.K);return this.Lr(t,e,(t,e)=>{const i=this.Mr(e);i?(n=n.Gt(t,i),s=s.Gt(t,ch(e))):(n=n.Gt(t,null),s=s.Gt(t,0))}).next(()=>({qr:n,Ur:s}))}Lr(t,e,n){if(e.Y())return ea.resolve();const s=IDBKeyRange.bound(e.first().path.tt(),e.last().path.tt()),i=e.Zt();let r=i.re();return kh(t).us({range:s},(t,e,s)=>{const o=Js._t(t);for(;r&&Js.K(r,o)<0;)n(r,null),r=i.re();r&&r.isEqual(o)&&(n(r,e),r=i.oe()?i.re():null),r?s.ns(r.path.tt()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.oe()?i.re():null})}Kr(t,e,n){let s=ho();const i=e.path.length+1,r={};if(n.isEqual(Ys.min())){const t=e.path.tt();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.tt(),s=$a(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=Sa.collectionReadTimeIndex}return kh(t).us(r,(t,n,r)=>{if(t.length!==i)return;const o=Fa(this.Ut,n);e.path.X(o.key.path)?o instanceof xi&&lr(e,o)&&(s=s.Gt(o.key,o)):r.done()}).next(()=>s)}Cr(t){return new xh(this,!!t&&t.Qr)}Or(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return Dh(t).get(Aa.key).next(t=>(xs(!!t),t))}kr(t,e){return Dh(t).put(Aa.key,e)}Mr(t){if(t){const e=Fa(this.Ut,t);return e instanceof Di&&e.version.isEqual(Ys.min())?null:e}return null}}class xh extends hh{constructor(t,e){super(),this.Wr=t,this.Qr=e,this.jr=new ah(t=>t.toString(),(t,e)=>t.isEqual(e))}di(t){const e=[];let n=0,s=new no((t,e)=>js(t.et(),e.et()));return this.ii.forEach((i,r)=>{const o=this.jr.get(i);if(r.ui){const a=ja(this.Wr.Ut,r.ui,this.oi(i));s=s.add(i.path.G());const h=ch(a);n+=h-o,e.push(this.Wr.ci(t,i,a))}else if(n-=o,this.Qr){const n=ja(this.Wr.Ut,new Di(i,Ys.min()),this.oi(i));e.push(this.Wr.ci(t,i,n))}else e.push(this.Wr.hi(t,i))}),s.forEach(n=>{e.push(this.Wr.wi.Bs(t,n))}),e.push(this.Wr.updateMetadata(t,n)),ea.Mn(e)}_i(t,e){return this.Wr.Fr(t,e).next(t=>null===t?(this.jr.set(e,0),null):(this.jr.set(e,t.size),t.ui))}fi(t,e){return this.Wr.Br(t,e).next(({qr:t,Ur:e})=>(e.forEach((t,e)=>{this.jr.set(t,e)}),t))}}function Dh(t){return Va(t,Aa.store)}function kh(t){return Va(t,Sa.store)}function Lh(t){return t.path.tt()}class Oh{constructor(t){this.Ut=t}Hn(t,e,n,s){xs(n<s&&n>=0&&s<=11);const i=new na("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(ba.store)}(t),function(t){t.createObjectStore(Ea.store,{keyPath:Ea.keyPath}),t.createObjectStore(Ia.store,{keyPath:Ia.keyPath,autoIncrement:!0}).createIndex(Ia.userMutationsIndex,Ia.userMutationsKeyPath,{unique:!0}),t.createObjectStore(_a.store)}(t),Rh(t),function(t){t.createObjectStore(Sa.store)}(t));let r=ea.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(Da.store),t.deleteObjectStore(xa.store),t.deleteObjectStore(ka.store)}(t),Rh(t)),r=r.next(()=>(function(t){const e=i.store(ka.store),n=new ka(0,0,Ys.min().q(),0);return e.put(ka.key,n)})())),n<4&&s>=4&&(0!==n&&(r=r.next(()=>(function(t,e){return e.store(Ia.store).ss().next(n=>{t.deleteObjectStore(Ia.store),t.createObjectStore(Ia.store,{keyPath:Ia.keyPath,autoIncrement:!0}).createIndex(Ia.userMutationsIndex,Ia.userMutationsKeyPath,{unique:!0});const s=e.store(Ia.store),i=n.map(t=>s.put(t));return ea.Mn(i)})})(t,i))),r=r.next(()=>{!function(t){t.createObjectStore(Oa.store,{keyPath:Oa.keyPath})}(t)})),n<5&&s>=5&&(r=r.next(()=>this.Gr(i))),n<6&&s>=6&&(r=r.next(()=>((function(t){t.createObjectStore(Aa.store)})(t),this.zr(i)))),n<7&&s>=7&&(r=r.next(()=>this.Hr(i))),n<8&&s>=8&&(r=r.next(()=>this.Jr(t,i))),n<9&&s>=9&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Sa.store);e.createIndex(Sa.readTimeIndex,Sa.readTimeIndexPath,{unique:!1}),e.createIndex(Sa.collectionReadTimeIndex,Sa.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(r=r.next(()=>this.Yr(i))),n<11&&s>=11&&(r=r.next(()=>{!function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath})}(t),function(t){t.createObjectStore(Ca.store,{keyPath:Ca.keyPath})}(t)})),r}zr(t){let e=0;return t.store(Sa.store).us((t,n)=>{e+=ch(n)}).next(()=>{const n=new Aa(e);return t.store(Aa.store).put(Aa.key,n)})}Gr(t){const e=t.store(Ea.store),n=t.store(Ia.store);return e.ss().next(e=>ea.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.ss(Ia.userMutationsIndex,s).next(n=>ea.forEach(n,n=>{xs(n.userId===e.userId);const s=za(this.Ut,n);return uh(t,e.userId,s).next(()=>{})}))}))}Hr(t){const e=t.store(Da.store),n=t.store(Sa.store);return t.store(ka.store).get(ka.key).next(t=>{const s=[];return n.us((n,i)=>{const r=new Hs(n),o=function(t){return[0,ga(r)]}();s.push(e.get(o).next(n=>n?ea.resolve():(n=>e.put(new Da(0,ga(n),t.highestListenSequenceNumber)))(r)))}).next(()=>ea.Mn(s))})}Jr(t,e){t.createObjectStore(La.store,{keyPath:La.keyPath});const n=e.store(La.store),s=new eh,i=t=>{if(s.add(t)){const e=t.J(),s=t.G();return n.put({collectionId:e,parent:ga(s)})}};return e.store(Sa.store).us({cs:!0},(t,e)=>{const n=new Hs(t);return i(n.G())}).next(()=>e.store(_a.store).us({cs:!0},([t,e,n],s)=>{const r=wa(e);return i(r.G())}))}Yr(t){const e=t.store(xa.store);return e.us((t,n)=>{const s=Ha(n),i=Wa(this.Ut,s);return e.put(i)})}}function Rh(t){t.createObjectStore(Da.store,{keyPath:Da.keyPath}).createIndex(Da.documentTargetsIndex,Da.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(xa.store,{keyPath:xa.keyPath}).createIndex(xa.queryTargetsIndexName,xa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ka.store)}const Ch="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ph{constructor(t,e,n,s,i,r,o,a,h,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Xr=i,this.window=r,this.document=o,this.Zr=h,this.eo=u,this.no=null,this.so=!1,this.isPrimary=!1,this.networkEnabled=!0,this.io=null,this.inForeground=!1,this.ro=null,this.oo=null,this.co=Number.NEGATIVE_INFINITY,this.ao=(t=>Promise.resolve()),!Ph.Kn())throw new Ls(ks.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ei=new Nh(this,s),this.uo=e+"main",this.Ut=new Ga(a),this.ho=new sa(this.uo,11,new Oh(this.Ut)),this.lo=new yh(this.Ei,this.Ut),this.wi=new nh,this._o=function(t,e){return new Ah(t,e)}(this.Ut,this.wi),this.fo=new Ja,this.window&&this.window.localStorage?this.wo=this.window.localStorage:(this.wo=null,!1===u&&Ts("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Eo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ls(ks.FAILED_PRECONDITION,Ch);return this.To(),this.Io(),this.mo(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.lo.Ki(t))}).then(t=>{this.no=new qs(t,this.Zr)}).then(()=>{this.so=!0}).catch(t=>(this.ho&&this.ho.close(),Promise.reject(t)))}Ao(t){return this.ao=(async e=>{if(this.wr)return t(e)}),t(this.isPrimary)}Ro(t){this.ho.Yn(async e=>{null===e.newVersion&&await t()})}Po(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Xr.Rs(async()=>{this.wr&&await this.Eo()}))}Eo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Vh(t).put(new Oa(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Vo(t).next(t=>{t||(this.isPrimary=!1,this.Xr.yo(()=>this.ao(!1)))})}).next(()=>this.po(t)).next(e=>this.isPrimary&&!e?this.bo(t).next(()=>!1):!!e&&this.vo(t).next(()=>!0))).catch(t=>{if(oa(t))return _s("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return _s("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Xr.yo(()=>this.ao(t)),this.isPrimary=t})}Vo(t){return Uh(t).get(ba.key).next(t=>ea.resolve(this.So(t)))}Do(t){return Vh(t).delete(this.clientId)}async Co(){if(this.isPrimary&&!this.No(this.co,18e5)){this.co=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=Va(t,Oa.store);return e.ss().next(t=>{const n=this.xo(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return ea.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.wo)for(const e of t)this.wo.removeItem(this.$o(e.clientId))}}mo(){this.oo=this.Xr.Er("client_metadata_refresh",4e3,()=>this.Eo().then(()=>this.Co()).then(()=>this.mo()))}So(t){return!!t&&t.ownerId===this.clientId}po(t){return this.eo?ea.resolve(!0):Uh(t).get(ba.key).next(e=>{if(null!==e&&this.No(e.leaseTimestampMs,5e3)&&!this.Oo(e.ownerId)){if(this.So(e)&&this.networkEnabled)return!0;if(!this.So(e)){if(!e.allowTabSynchronization)throw new Ls(ks.FAILED_PRECONDITION,Ch);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vh(t).ss().next(t=>void 0===this.xo(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&_s("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async ko(){this.so=!1,this.Mo(),this.oo&&(this.oo.cancel(),this.oo=null),this.Fo(),this.Lo(),await this.ho.runTransaction("shutdown","readwrite",[ba.store,Oa.store],t=>{const e=new Ua(t,qs.O);return this.bo(e).next(()=>this.Do(e))}),this.ho.close(),this.Bo()}xo(t,e){return t.filter(t=>this.No(t.updateTimeMs,e)&&!this.Oo(t.clientId))}qo(){return this.runTransaction("getActiveClients","readonly",t=>Vh(t).ss().next(t=>this.xo(t,18e5).map(t=>t.clientId)))}get wr(){return this.so}Uo(t){return lh.Ii(t,this.Ut,this.wi,this.Ei)}vr(){return this.lo}Nr(){return this._o}Ko(){return this.wi}Qo(){return this.fo}runTransaction(t,e,n){_s("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.ho.runTransaction(t,s,Pa,s=>(i=new Ua(s,this.no?this.no.next():qs.O),"readwrite-primary"===e?this.Vo(i).next(t=>!!t||this.po(i)).next(e=>{if(!e)throw Ts(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Xr.yo(()=>this.ao(!1)),new Ls(ks.FAILED_PRECONDITION,da);return n(i)}).next(t=>this.vo(i).next(()=>t)):this.Wo(i).next(()=>n(i)))).then(t=>(i.gs(),t))}Wo(t){return Uh(t).get(ba.key).next(t=>{if(null!==t&&this.No(t.leaseTimestampMs,5e3)&&!this.Oo(t.ownerId)&&!this.So(t)&&!(this.eo||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Ls(ks.FAILED_PRECONDITION,Ch)})}vo(t){const e=new ba(this.clientId,this.allowTabSynchronization,Date.now());return Uh(t).put(ba.key,e)}static Kn(){return sa.Kn()}bo(t){const e=Uh(t);return e.get(ba.key).next(t=>this.So(t)?(_s("IndexedDbPersistence","Releasing primary lease."),e.delete(ba.key)):ea.resolve())}No(t,e){const n=Date.now();return!(t<n-e||t>n&&(Ts(`Detected an update time that is in the future: ${t} > ${n}`),1))}To(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ro=(()=>{this.Xr.Rs(()=>(this.inForeground="visible"===this.document.visibilityState,this.Eo()))}),this.document.addEventListener("visibilitychange",this.ro),this.inForeground="visible"===this.document.visibilityState)}Fo(){this.ro&&(this.document.removeEventListener("visibilitychange",this.ro),this.ro=null)}Io(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.io=(()=>{this.Mo(),this.Xr.Rs(()=>this.ko())}),this.window.addEventListener("unload",this.io))}Lo(){this.io&&(this.window.removeEventListener("unload",this.io),this.io=null)}Oo(t){var e;try{const n=null!==(null===(e=this.wo)||void 0===e?void 0:e.getItem(this.$o(t)));return _s("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Ts("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Mo(){if(this.wo)try{this.wo.setItem(this.$o(this.clientId),String(Date.now()))}catch(t){Ts("Failed to set zombie client id.",t)}}Bo(){if(this.wo)try{this.wo.removeItem(this.$o(this.clientId))}catch(t){}}$o(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Uh(t){return Va(t,ba.store)}function Vh(t){return Va(t,Oa.store)}function Mh(t,e){let n=t.projectId;return t.S||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class qh{constructor(t,e){this.progress=t,this.jo=e}}class Gh{constructor(t,e,n){this._o=t,this.Go=e,this.wi=n}zo(t,e){return this.Go.pi(t,e).next(n=>this.Ho(t,e,n))}Ho(t,e,n){return this._o.li(t,e).next(t=>{for(const s of n)t=s.Ds(e,t);return t})}Jo(t,e,n){let s=oo();return e.forEach((t,e)=>{for(const s of n)e=s.Ds(t,e);s=s.Gt(t,e)}),s}Yo(t,e){return this._o.getEntries(t,e).next(e=>this.Xo(t,e))}Xo(t,e){return this.Go.bi(t,e).next(n=>{const s=this.Jo(t,e,n);let i=ro();return s.forEach((t,e)=>{e||(e=new Di(t,Ys.min())),i=i.Gt(t,e)}),i})}Kr(t,e,n){return function(t){return Js.lt(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Zo(t,e.path):ir(e)?this.tc(t,e,n):this.ec(t,e,n)}Zo(t,e){return this.zo(t,new Js(e)).next(t=>{let e=ho();return t instanceof xi&&(e=e.Gt(t.key,t)),e})}tc(t,e,n){const s=e.collectionGroup;let i=ho();return this.wi.qs(t,s).next(r=>ea.forEach(r,r=>{const o=function(t,e){return new Ji(e,null,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.ec(t,o,n).next(t=>{t.forEach((t,e)=>{i=i.Gt(t,e)})})}).next(()=>i))}ec(t,e,n){let s,i;return this._o.Kr(t,e,n).next(n=>(s=n,this.Go.Si(t,e))).next(e=>(i=e,this.nc(t,i,s).next(t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=Ur(e,s.get(n),t.bs);s=i instanceof xi?s.Gt(n,i):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{lr(e,n)||(s=s.remove(t))}),s))}nc(t,e,n){let s=fo();for(const t of e)for(const e of t.mutations)e instanceof Fr&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this._o.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof xi&&(i=i.Gt(t,e))}),i))}}class Fh{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.sc=n,this.ic=s}static rc(t,e){let n=fo(),s=fo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Fh(t,e.fromCache,n,s)}}class jh{oc(t){this.cc=t}Kr(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.Ct.length||1===t.Ct.length&&t.Ct[0].field.rt())}(e)||n.isEqual(Ys.min())?this.ac(t,e):this.cc.Yo(t,s).next(i=>{const r=this.uc(e,i);return(tr(e)||er(e))&&this.hc(e.limitType,r,s,n)?this.ac(t,e):(Is()<=h.DEBUG&&_s("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),cr(e)),this.cc.Kr(t,e,n).next(t=>(r.forEach(e=>{t=t.Gt(e.key,e)}),t)))})}uc(t,e){let n=new no(fr(t));return e.forEach((e,s)=>{s instanceof xi&&lr(t,s)&&(n=n.add(s))}),n}hc(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.L(s)>0)}ac(t,e){return Is()<=h.DEBUG&&_s("QueryEngine","Using full collection scan to execute query:",cr(e)),this.cc.Kr(t,e,Ys.min())}}class $h{constructor(t,e,n,s){this.persistence=t,this.lc=e,this.Ut=s,this._c=new Zr(js),this.fc=new ah(t=>Ri(t),Ci),this.dc=Ys.min(),this.Go=t.Uo(n),this.wc=t.Nr(),this.lo=t.vr(),this.Ec=new Gh(this.wc,this.Go,this.persistence.Ko()),this.fo=t.Qo(),this.lc.oc(this.Ec)}Tr(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.gr(e,this._c))}}function Bh(t,e,n,s){return new $h(t,e,n,s)}async function Kh(t,e){const n=Ds(t);let s=n.Go,i=n.Ec;const r=await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.Go.yi(t).next(o=>(r=o,s=n.persistence.Uo(e),i=new Gh(n.wc,s,n.persistence.Ko()),s.yi(t))).next(e=>{const n=[],s=[];let o=fo();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.Yo(t,o).next(t=>({Tc:t,Ic:n,mc:s}))})});return n.Go=s,n.Ec=i,n.lc.oc(n.Ec),r}function Yh(t){const e=Ds(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.lo.Ui(t))}function zh(t,e,n,s,i){let r=fo();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let r=ro();return n.forEach((n,o)=>{const a=t.get(n),h=(null==i?void 0:i.get(n))||s;o instanceof Di&&o.version.isEqual(Ys.min())?(e.hi(n,h),r=r.Gt(n,o)):null==a||o.version.L(a.version)>0||0===o.version.L(a.version)&&a.hasPendingWrites?(e.ci(o,h),r=r.Gt(n,o)):_s("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)}),r})}function Hh(t,e){const n=Ds(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.Go.Vi(t,e)))}function Wh(t,e){const n=Ds(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return n.lo.Zi(t,e).next(i=>i?(s=i,ea.resolve(s)):n.lo.Li(t).next(i=>(s=new pr(e,i,0,t.ps),n.lo.Wi(t,s).next(()=>s))))}).then(t=>{const s=n._c.get(t.targetId);return(null===s||t.Ot.L(s.Ot)>0)&&(n._c=n._c.Gt(t.targetId,t),n.fc.set(e,t.targetId)),t})}async function Xh(t,e,n){const s=Ds(t),i=s._c.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,t=>s.persistence.Ei.removeTarget(t,i))}catch(t){if(!oa(t))throw t;_s("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s._c=s._c.remove(e),s.fc.delete(i.target)}function Jh(t,e,n){const s=Ds(t);let i=Ys.min(),r=fo();return s.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const s=Ds(t),i=s.fc.get(n);return void 0!==i?ea.resolve(s._c.get(i)):s.lo.Zi(e,n)})(s,t,or(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.lo.ir(t,e.targetId).next(t=>{r=t})}).next(()=>s.lc.Kr(t,e,n?i:Ys.min(),n?r:fo())).next(t=>({documents:t,Ac:r})))}function Qh(t,e){const n=Ds(t),s=Ds(n.lo),i=n._c.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>s.vn(t,e).next(t=>t?t.target:null))}function Zh(t){const e=Ds(t);return e.persistence.runTransaction("Get new document changes","readonly",t=>(function(t,e,n){const s=Ds(t);let i=ro(),r=$a(n);const o=kh(e),a=IDBKeyRange.lowerBound(r,!0);return o.us({index:Sa.readTimeIndex,range:a},(t,e)=>{const n=Fa(s.Ut,e);i=i.Gt(n.key,n),r=e.readTime}).next(()=>({jo:i,readTime:Ba(r)}))})(e.wc,t,e.dc)).then(({jo:t,readTime:n})=>(e.dc=n,t))}async function tu(t,e,n=fo()){const s=await Wh(t,or(Xa(e.bundledQuery))),i=Ds(t);return i.persistence.runTransaction("Save named query","readwrite",t=>{const r=Ro(e.readTime);if(s.Ot.L(r)>=0)return i.fo.Fs(t,e);const o=s.Mt(ni.Et,r);return i._c=i._c.Gt(o.targetId,o),i.lo.zi(t,o).next(()=>i.lo.Ji(t,s.targetId)).next(()=>i.lo.tr(t,n,s.targetId)).next(()=>i.fo.Fs(t,e))})}class eu{constructor(t){this.Ut=t,this.gc=new Map,this.yc=new Map}Os(t,e){return ea.resolve(this.gc.get(e))}ks(t,e){var n;return this.gc.set(e.id,{id:(n=e).id,version:n.version,createTime:Ro(n.createTime)}),ea.resolve()}Ms(t,e){return ea.resolve(this.yc.get(e))}Fs(t,e){return this.yc.set(e.name,function(t){return{name:t.name,query:Xa(t.bundledQuery),readTime:Ro(t.readTime)}}(e)),ea.resolve()}}class nu{constructor(){this.bc=new no(su.vc),this.Sc=new no(su.Dc)}Y(){return this.bc.Y()}er(t,e){const n=new su(t,e);this.bc=this.bc.add(n),this.Sc=this.Sc.add(n)}Cc(t,e){t.forEach(t=>this.er(t,e))}sr(t,e){this.Nc(new su(t,e))}xc(t,e){t.forEach(t=>this.sr(t,e))}$c(t){const e=new Js(new Hs([])),n=new su(e,t),s=new su(e,t+1),i=[];return this.Sc.Ie([n,s],t=>{this.Nc(t),i.push(t.key)}),i}Oc(){this.bc.forEach(t=>this.Nc(t))}Nc(t){this.bc=this.bc.delete(t),this.Sc=this.Sc.delete(t)}kc(t){const e=new Js(new Hs([])),n=new su(e,t),s=new su(e,t+1);let i=fo();return this.Sc.Ie([n,s],t=>{i=i.add(t.key)}),i}$i(t){const e=new su(t,0),n=this.bc.Ae(e);return null!==n&&t.isEqual(n.key)}}class su{constructor(t,e){this.key=t,this.Mc=e}static vc(t,e){return Js.K(t.key,e.key)||js(t.Mc,e.Mc)}static Dc(t,e){return js(t.Mc,e.Mc)||Js.K(t.key,e.key)}}class iu{constructor(t,e){this.wi=t,this.Ei=e,this.Go=[],this.Fc=1,this.Lc=new no(su.vc)}mi(t){return ea.resolve(0===this.Go.length)}Ai(t,e,n,s){const i=this.Fc;this.Fc++,this.Go.length>0&&this.Go[this.Go.length-1];const r=new Ma(i,e,n,s);this.Go.push(r);for(const e of s)this.Lc=this.Lc.add(new su(e.key,i)),this.wi.Bs(t,e.key.path.G());return ea.resolve(r)}Ri(t,e){return ea.resolve(this.Bc(e))}Vi(t,e){const n=e+1,s=this.qc(n),i=s<0?0:s;return ea.resolve(this.Go.length>i?this.Go[i]:null)}gi(){return ea.resolve(0===this.Go.length?-1:this.Fc-1)}yi(t){return ea.resolve(this.Go.slice())}pi(t,e){const n=new su(e,0),s=new su(e,Number.POSITIVE_INFINITY),i=[];return this.Lc.Ie([n,s],t=>{const e=this.Bc(t.Mc);i.push(e)}),ea.resolve(i)}bi(t,e){let n=new no(js);return e.forEach(t=>{const e=new su(t,0),s=new su(t,Number.POSITIVE_INFINITY);this.Lc.Ie([e,s],t=>{n=n.add(t.Mc)})}),ea.resolve(this.Uc(n))}Si(t,e){const n=e.path,s=n.length+1;let i=n;Js.lt(i)||(i=i.child(""));const r=new su(new Js(i),0);let o=new no(js);return this.Lc.me(t=>{const e=t.key.path;return!!n.X(e)&&(e.length===s&&(o=o.add(t.Mc)),!0)},r),ea.resolve(this.Uc(o))}Uc(t){const e=[];return t.forEach(t=>{const n=this.Bc(t);null!==n&&e.push(n)}),e}Di(t,e){xs(0===this.Kc(e.batchId,"removed")),this.Go.shift();let n=this.Lc;return ea.forEach(e.mutations,s=>{const i=new su(s.key,e.batchId);return n=n.delete(i),this.Ei.Ni(t,s.key)}).next(()=>{this.Lc=n})}Ci(t){}$i(t,e){const n=new su(e,0),s=this.Lc.Ae(n);return ea.resolve(e.isEqual(s&&s.key))}xi(t){return this.Go.length,ea.resolve()}Kc(t,e){return this.qc(t)}qc(t){return 0===this.Go.length?0:t-this.Go[0].batchId}Bc(t){const e=this.qc(t);return e<0||e>=this.Go.length?null:this.Go[e]}}class ru{constructor(t,e){this.wi=t,this.Qc=e,this.docs=new Zr(Js.K),this.size=0}ci(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.Qc(e);return this.docs=this.docs.Gt(s,{ui:e,size:o,readTime:n}),this.size+=o-r,this.wi.Bs(t,s.path.G())}hi(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}li(t,e){const n=this.docs.get(e);return ea.resolve(n?n.ui:null)}getEntries(t,e){let n=oo();return e.forEach(t=>{const e=this.docs.get(t);n=n.Gt(t,e?e.ui:null)}),ea.resolve(n)}Kr(t,e,n){let s=ho();const i=new Js(e.path.child("")),r=this.docs.te(i);for(;r.oe();){const{key:t,value:{ui:i,readTime:o}}=r.re();if(!e.path.X(t.path))break;o.L(n)<=0||i instanceof xi&&lr(e,i)&&(s=s.Gt(i.key,i))}return ea.resolve(s)}Wc(t,e){return ea.forEach(this.docs,t=>e(t))}Cr(t){return new ou(this)}Or(t){return ea.resolve(this.size)}}class ou extends hh{constructor(t){super(),this.Wr=t}di(t){const e=[];return this.ii.forEach((n,s)=>{s&&s.ui?e.push(this.Wr.ci(t,s.ui,this.oi(n))):this.Wr.hi(n)}),ea.Mn(e)}_i(t,e){return this.Wr.li(t,e)}fi(t,e){return this.Wr.getEntries(t,e)}}class au{constructor(t){this.persistence=t,this.jc=new ah(t=>Ri(t),Ci),this.lastRemoteSnapshotVersion=Ys.min(),this.highestTargetId=0,this.Gc=0,this.zc=new nu,this.targetCount=0,this.Hc=mh.Mi()}Tn(t,e){return this.jc.forEach((t,n)=>e(n)),ea.resolve()}Ui(t){return ea.resolve(this.lastRemoteSnapshotVersion)}Ki(t){return ea.resolve(this.Gc)}Li(t){return this.highestTargetId=this.Hc.next(),ea.resolve(this.highestTargetId)}Qi(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Gc&&(this.Gc=e),ea.resolve()}ji(t){this.jc.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Hc=new mh(e),this.highestTargetId=e),t.sequenceNumber>this.Gc&&(this.Gc=t.sequenceNumber)}Wi(t,e){return this.ji(e),this.targetCount+=1,ea.resolve()}zi(t,e){return this.ji(e),ea.resolve()}Hi(t,e){return this.jc.delete(e.target),this.zc.$c(e.targetId),this.targetCount-=1,ea.resolve()}Yi(t,e,n){let s=0;const i=[];return this.jc.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.jc.delete(r),i.push(this.Ji(t,o.targetId)),s++)}),ea.Mn(i).next(()=>s)}Xi(t){return ea.resolve(this.targetCount)}Zi(t,e){const n=this.jc.get(e)||null;return ea.resolve(n)}tr(t,e,n){return this.zc.Cc(e,n),ea.resolve()}nr(t,e,n){this.zc.xc(e,n);const s=this.persistence.Ei,i=[];return s&&e.forEach(e=>{i.push(s.Ni(t,e))}),ea.Mn(i)}Ji(t,e){return this.zc.$c(e),ea.resolve()}ir(t,e){const n=this.zc.kc(e);return ea.resolve(n)}$i(t,e){return ea.resolve(this.zc.$i(e))}}class hu{constructor(t,e){this.Jc={},this.no=new qs(0),this.so=!1,this.so=!0,this.Ei=t(this),this.lo=new au(this),this.wi=new th,this._o=function(t,e){return new ru(t,e)}(this.wi,t=>this.Ei.Yc(t)),this.Ut=new Ga(e),this.fo=new eu(this.Ut)}start(){return Promise.resolve()}ko(){return this.so=!1,Promise.resolve()}get wr(){return this.so}Ro(){}Po(){}Ko(){return this.wi}Uo(t){let e=this.Jc[t.i()];return e||(e=new iu(this.wi,this.Ei),this.Jc[t.i()]=e),e}vr(){return this.lo}Nr(){return this._o}Qo(){return this.fo}runTransaction(t,e,n){_s("MemoryPersistence","Starting transaction:",t);const s=new uu(this.no.next());return this.Ei.Xc(),n(s).next(t=>this.Ei.Zc(s).next(()=>t)).On().then(t=>(s.gs(),t))}ta(t,e){return ea.Fn(Object.values(this.Jc).map(n=>()=>n.$i(t,e)))}}class uu extends pa{constructor(t){super(),this.ps=t}}class cu{constructor(t){this.persistence=t,this.ea=new nu,this.na=null}static sa(t){return new cu(t)}get ia(){if(this.na)return this.na;throw As()}er(t,e,n){return this.ea.er(n,e),this.ia.delete(n.toString()),ea.resolve()}sr(t,e,n){return this.ea.sr(n,e),this.ia.add(n.toString()),ea.resolve()}Ni(t,e){return this.ia.add(e.toString()),ea.resolve()}removeTarget(t,e){this.ea.$c(e.targetId).forEach(t=>this.ia.add(t.toString()));const n=this.persistence.vr();return n.ir(t,e.targetId).next(t=>{t.forEach(t=>this.ia.add(t.toString()))}).next(()=>n.Hi(t,e))}Xc(){this.na=new Set}Zc(t){const e=this.persistence.Nr().Cr();return ea.forEach(this.ia,n=>{const s=Js.at(n);return this.ra(t,s).next(t=>{t||e.hi(s)})}).next(()=>(this.na=null,e.apply(t)))}$r(t,e){return this.ra(t,e).next(t=>{t?this.ia.delete(e.toString()):this.ia.add(e.toString())})}Yc(t){return 0}ra(t,e){return ea.Fn([()=>ea.resolve(this.ea.$i(e)),()=>this.persistence.vr().$i(t,e),()=>this.persistence.ta(t,e)])}}function lu(t,e){return`firestore_clients_${t}_${e}`}function fu(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+=`_${e.uid}`),s}function du(t,e){return`firestore_targets_${t}_${e}`}class pu{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static oa(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&((r="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(i=new Ls(s.error.code,s.error.message))),r?new pu(t,e,s.state,i):(Ts("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}ca(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class gu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static oa(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&((i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(s=new Ls(n.error.code,n.error.message))),i?new gu(t,n.state,s):(Ts("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ca(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class mu{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static oa(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=go();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=li(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new mu(t,i):(Ts("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class yu{constructor(t,e){this.clientId=t,this.onlineState=e}static oa(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new yu(e.clientId,e.onlineState):(Ts("SharedClientState",`Failed to parse online state: ${t}`),null)}}class wu{constructor(){this.activeTargetIds=go()}aa(t){this.activeTargetIds=this.activeTargetIds.add(t)}ua(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ca(){const t={activeTargetIds:this.activeTargetIds.tt(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class vu{constructor(t,e,n,s,i){this.window=t,this.Xr=e,this.persistenceKey=n,this.ha=s,this.la=null,this._a=null,this.D=null,this.fa=this.da.bind(this),this.wa=new Zr(js),this.wr=!1,this.Ea=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ta=lu(this.persistenceKey,this.ha),this.Ia=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.wa=this.wa.Gt(this.ha,new wu),this.ma=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.Aa=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.Ra=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Pa=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Va=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.fa)}static Kn(t){return!(!t||!t.localStorage)}async start(){const t=await this.la.qo();for(const e of t){if(e===this.ha)continue;const t=this.getItem(lu(this.persistenceKey,e));if(t){const n=mu.oa(e,t);n&&(this.wa=this.wa.Gt(n.clientId,n))}}this.ga();const e=this.storage.getItem(this.Pa);if(e){const t=this.ya(e);t&&this.pa(t)}for(const t of this.Ea)this.da(t);this.Ea=[],this.window.addEventListener("unload",()=>this.ko()),this.wr=!0}$(t){this.setItem(this.Ia,JSON.stringify(t))}ba(){return this.va(this.wa)}Sa(t){let e=!1;return this.wa.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}Da(t){this.Ca(t,"pending")}Na(t,e,n){this.Ca(t,e,n),this.xa(t)}$a(t){let e="not-current";if(this.Sa(t)){const n=this.storage.getItem(du(this.persistenceKey,t));if(n){const s=gu.oa(t,n);s&&(e=s.state)}}return this.Oa.aa(t),this.ga(),e}ka(t){this.Oa.ua(t),this.ga()}Ma(t){return this.Oa.activeTargetIds.has(t)}Fa(t){this.removeItem(du(this.persistenceKey,t))}La(t,e,n){this.Ba(t,e,n)}qa(t,e,n){e.forEach(t=>{this.xa(t)}),this.currentUser=t,n.forEach(t=>{this.Da(t)})}Ua(t){this.Ka(t)}Qa(){this.Wa()}ko(){this.wr&&(this.window.removeEventListener("storage",this.fa),this.removeItem(this.Ta),this.wr=!1)}getItem(t){const e=this.storage.getItem(t);return _s("SharedClientState","READ",t,e),e}setItem(t,e){_s("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){_s("SharedClientState","REMOVE",t),this.storage.removeItem(t)}da(t){const e=t;if(e.storageArea===this.storage){if(_s("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ta)return void Ts("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Xr.yo(async()=>{if(this.wr){if(null!==e.key)if(this.ma.test(e.key)){if(null==e.newValue){const t=this.ja(e.key);return this.Ga(t,null)}{const t=this.za(e.key,e.newValue);if(t)return this.Ga(t.clientId,t)}}else if(this.Aa.test(e.key)){if(null!==e.newValue){const t=this.Ha(e.key,e.newValue);if(t)return this.Ja(t)}}else if(this.Ra.test(e.key)){if(null!==e.newValue){const t=this.Ya(e.key,e.newValue);if(t)return this.Xa(t)}}else if(e.key===this.Pa){if(null!==e.newValue){const t=this.ya(e.newValue);if(t)return this.pa(t)}}else if(e.key===this.Ia){const t=function(t){let e=qs.O;if(null!=t)try{const n=JSON.parse(t);xs("number"==typeof n),e=n}catch(t){Ts("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==qs.O&&this.D(t)}else if(e.key===this.Va)return this.la.Za()}else this.Ea.push(e)})}}get Oa(){return this.wa.get(this.ha)}ga(){this.setItem(this.Ta,this.Oa.ca())}Ca(t,e,n){const s=new pu(this.currentUser,t,e,n),i=fu(this.persistenceKey,this.currentUser,t);this.setItem(i,s.ca())}xa(t){const e=fu(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Ka(t){const e={clientId:this.ha,onlineState:t};this.storage.setItem(this.Pa,JSON.stringify(e))}Ba(t,e,n){const s=du(this.persistenceKey,t),i=new gu(t,e,n);this.setItem(s,i.ca())}Wa(){this.setItem(this.Va,"value-not-used")}ja(t){const e=this.ma.exec(t);return e?e[1]:null}za(t,e){const n=this.ja(t);return mu.oa(n,e)}Ha(t,e){const n=this.Aa.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return pu.oa(new bs(i),s,e)}Ya(t,e){const n=this.Ra.exec(t),s=Number(n[1]);return gu.oa(s,e)}ya(t){return yu.oa(t)}async Ja(t){if(t.user.uid===this.currentUser.uid)return this.la.tu(t.batchId,t.state,t.error);_s("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}Xa(t){return this.la.eu(t.targetId,t.state,t.error)}Ga(t,e){const n=e?this.wa.Gt(t,e):this.wa.remove(t),s=this.va(this.wa),i=this.va(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.la.nu(r,o).then(()=>{this.wa=n})}pa(t){this.wa.get(t.clientId)&&this._a(t.onlineState)}va(t){let e=go();return t.forEach((t,n)=>{e=e.Re(n.activeTargetIds)}),e}}class bu{constructor(){this.su=new wu,this.iu={},this._a=null,this.D=null}Da(t){}Na(t,e,n){}$a(t){return this.su.aa(t),this.iu[t]||"not-current"}La(t,e,n){this.iu[t]=e}ka(t){this.su.ua(t)}Ma(t){return this.su.activeTargetIds.has(t)}Fa(t){delete this.iu[t]}ba(){return this.su.activeTargetIds}Sa(t){return this.su.activeTargetIds.has(t)}start(){return this.su=new wu,Promise.resolve()}qa(t,e,n){}Ua(t){}ko(){}$(t){}Qa(){}}class Eu{ru(t){}ko(){}}class Iu{constructor(){this.ou=(()=>this.cu()),this.au=(()=>this.uu()),this.hu=[],this.lu()}ru(t){this.hu.push(t)}ko(){window.removeEventListener("online",this.ou),window.removeEventListener("offline",this.au)}lu(){window.addEventListener("online",this.ou),window.addEventListener("offline",this.au)}cu(){_s("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.hu)t(0)}uu(){_s("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.hu)t(1)}static Kn(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const _u={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Tu{constructor(t){this._u=t._u,this.fu=t.fu}du(t){this.wu=t}Eu(t){this.Tu=t}onMessage(t){this.Iu=t}close(){this.fu()}send(t){this._u(t)}mu(){this.wu()}Au(t){this.Tu(t)}Ru(t){this.Iu(t)}}class Nu extends class{constructor(t){this.Pu=t,this.p=t.p;const e=t.ssl?"https":"http";this.Vu=e+"://"+t.host,this.gu="projects/"+this.p.projectId+"/databases/"+this.p.database+"/documents"}yu(t,e,n,s){const i=this.pu(t,e);_s("RestConnection","Sending: ",i,n);const r={};return this.bu(r,s),this.vu(t,i,r,n).then(t=>(_s("RestConnection","Received: ",t),t),e=>{throw Ns("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}Su(t,e,n,s){return this.yu(t,e,n,s)}bu(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.9",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}pu(t,e){const n=_u[t];return`${this.Vu}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.v=t.v}vu(t,e,n,s){return new Promise((i,r)=>{const o=new vs;o.listenOnce(gs.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case ps.NO_ERROR:const e=o.getResponseJson();_s("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ps.TIMEOUT:_s("Connection",'RPC "'+t+'" timed out'),r(new Ls(ks.DEADLINE_EXCEEDED,"Request time out"));break;case ps.HTTP_ERROR:const n=o.getStatus();if(_s("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(ks).indexOf(e)>=0?e:ks.UNKNOWN}(t.status);r(new Ls(e,t.message))}else r(new Ls(ks.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Ls(ks.UNAVAILABLE,"Connection failed."));break;default:As()}}finally{_s("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}Du(t,e){const n=[this.Vu,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=fs(),r=ds(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.p.projectId}/databases/${this.p.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.v};var a,h;this.bu(o.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((h=s()).indexOf("MSIE ")>=0||h.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||(o.httpHeadersOverwriteParam="$httpHeaders");const u=n.join("");_s("Connection","Creating WebChannel: "+u,o);const c=i.createWebChannel(u,o);let l=!1,f=!1;const d=new Tu({_u:t=>{f?_s("Connection","Not sending because WebChannel is closed:",t):(l||(_s("Connection","Opening WebChannel transport."),c.open(),l=!0),_s("Connection","WebChannel sending:",t),c.send(t))},fu:()=>c.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(c,ws.EventType.OPEN,()=>{f||_s("Connection","WebChannel transport opened.")}),p(c,ws.EventType.CLOSE,()=>{f||(f=!0,_s("Connection","WebChannel transport closed"),d.Au())}),p(c,ws.EventType.ERROR,t=>{f||(f=!0,Ns("Connection","WebChannel transport errored:",t),d.Au(new Ls(ks.UNAVAILABLE,"The operation could not be completed")))}),p(c,ws.EventType.MESSAGE,t=>{var e;if(!f){const n=t.data[0];xs(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){_s("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=Wr[t];if(void 0!==e)return Qr(e)}(t),n=i.message;void 0===e&&(e=ks.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),f=!0,d.Au(new Ls(e,n)),c.close()}else _s("Connection","WebChannel received:",n),d.Ru(n)}}),p(r,ms.STAT_EVENT,t=>{t.stat===ys.PROXY?_s("Connection","Detected buffering proxy"):t.stat===ys.NOPROXY&&_s("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.mu()},0),d}}function Su(){return"undefined"!=typeof window?window:null}function Au(){return"undefined"!=typeof document?document:null}function xu(t){return new ko(t,!0)}class Du{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Xr=t,this._s=e,this.Cu=n,this.Nu=s,this.xu=i,this.$u=0,this.Ou=null,this.ku=Date.now(),this.reset()}reset(){this.$u=0}Mu(){this.$u=this.xu}Fu(t){this.cancel();const e=Math.floor(this.$u+this.Lu()),n=Math.max(0,Date.now()-this.ku),s=Math.max(0,e-n);s>0&&_s("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.$u} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ou=this.Xr.Er(this._s,s,()=>(this.ku=Date.now(),t())),this.$u*=this.Nu,this.$u<this.Cu&&(this.$u=this.Cu),this.$u>this.xu&&(this.$u=this.xu)}Bu(){null!==this.Ou&&(this.Ou.As(),this.Ou=null)}cancel(){null!==this.Ou&&(this.Ou.cancel(),this.Ou=null)}Lu(){return(Math.random()-.5)*this.$u}}class ku{constructor(t,e,n,s,i,r){this.Xr=t,this.qu=n,this.Uu=s,this.Ku=i,this.listener=r,this.state=0,this.Qu=0,this.Wu=null,this.stream=null,this.ju=new Du(t,e)}Gu(){return 1===this.state||2===this.state||4===this.state}zu(){return 2===this.state}start(){3!==this.state?this.auth():this.Hu()}async stop(){this.Gu()&&await this.close(0)}Ju(){this.state=0,this.ju.reset()}Yu(){this.zu()&&null===this.Wu&&(this.Wu=this.Xr.Er(this.qu,6e4,()=>this.Xu()))}Zu(t){this.th(),this.stream.send(t)}async Xu(){if(this.zu())return this.close(0)}th(){this.Wu&&(this.Wu.cancel(),this.Wu=null)}async close(t,e){this.th(),this.ju.cancel(),this.Qu++,3!==t?this.ju.reset():e&&e.code===ks.RESOURCE_EXHAUSTED?(Ts(e.toString()),Ts("Using maximum backoff delay to prevent overloading the backend."),this.ju.Mu()):e&&e.code===ks.UNAUTHENTICATED&&this.Ku._(),null!==this.stream&&(this.eh(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Eu(e)}eh(){}auth(){this.state=1;const t=this.nh(this.Qu),e=this.Qu;this.Ku.getToken().then(t=>{this.Qu===e&&this.sh(t)},e=>{t(()=>{const t=new Ls(ks.UNKNOWN,"Fetching auth token failed: "+e.message);return this.ih(t)})})}sh(t){const e=this.nh(this.Qu);this.stream=this.rh(t),this.stream.du(()=>{e(()=>(this.state=2,this.listener.du()))}),this.stream.Eu(t=>{e(()=>this.ih(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}Hu(){this.state=4,this.ju.Fu(async()=>{this.state=0,this.start()})}ih(t){return _s("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(3,t)}nh(t){return e=>{this.Xr.Rs(()=>this.Qu===t?e():(_s("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Lu extends ku{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.Ut=s}rh(t){return this.Uu.Du("Listen",t)}onMessage(t){this.ju.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:As()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.Lt?(xs(void 0===e||"string"==typeof e),ni.fromBase64String(e||"")):(xs(void 0===e||e instanceof Uint8Array),ni.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?ks.UNKNOWN:Qr(t.code);return new Ls(e,t.message||"")}(o);n=new _o(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Vo(t,s.document.name),r=Ro(s.document.updateTime),o=new Ti({mapValue:{fields:s.document.fields}}),a=new xi(i,r,o,{}),h=s.targetIds||[],u=s.removedTargetIds||[];n=new Eo(h,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Vo(t,s.document),r=s.readTime?Ro(s.readTime):Ys.min(),o=new Di(i,r),a=s.removedTargetIds||[];n=new Eo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Vo(t,s.document),r=s.removedTargetIds||[];n=new Eo([],r,i,null)}else{if(!("filter"in e))return As();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Hr(s),r=t.targetId;n=new Io(r,i)}}return n}(this.Ut,t),n=function(t){if(!("targetChange"in t))return Ys.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Ys.min():e.readTime?Ro(e.readTime):Ys.min()}(t);return this.listener.oh(e,n)}ah(t){const e={};e.database=Go(this.Ut),e.addTarget=function(t,e){let n;const s=e.target;return(n=Pi(s)?{documents:Yo(t,s)}:{query:zo(t,s)}).targetId=e.targetId,e.resumeToken.wt()>0?n.resumeToken=Oo(t,e.resumeToken):e.Ot.L(Ys.min())>0&&(n.readTime=Lo(t,e.Ot.q())),n}(this.Ut,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return As()}}(0,e.$t);return null==n?null:{"goog-listen-tags":n}}(this.Ut,t);n&&(e.labels=n),this.Zu(e)}uh(t){const e={};e.database=Go(this.Ut),e.removeTarget=t,this.Zu(e)}}class Ou extends ku{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.Ut=s,this.hh=!1}get lh(){return this.hh}start(){this.hh=!1,this.lastStreamToken=void 0,super.start()}eh(){this.hh&&this._h([])}rh(t){return this.Uu.Du("Write",t)}onMessage(t){if(xs(!!t.streamToken),this.lastStreamToken=t.streamToken,this.hh){this.ju.reset();const e=function(t,e){return t&&t.length>0?(xs(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?Ro(t.updateTime):Ro(e);n.isEqual(Ys.min())&&(n=Ro(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new Lr(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=Ro(t.commitTime);return this.listener.fh(n,e)}return xs(!t.writeResults||0===t.writeResults.length),this.hh=!0,this.listener.dh()}wh(){const t={};t.database=Go(this.Ut),this.Zu(t)}_h(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>Bo(this.Ut,t))};this.Zu(e)}}class Ru extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Uu=e,this.Ut=n,this.Eh=!1}Th(){if(this.Eh)throw new Ls(ks.FAILED_PRECONDITION,"The client has already been terminated.")}yu(t,e,n){return this.Th(),this.credentials.getToken().then(s=>this.Uu.yu(t,e,n,s)).catch(t=>{throw t.code===ks.UNAUTHENTICATED&&this.credentials._(),t})}Su(t,e,n){return this.Th(),this.credentials.getToken().then(s=>this.Uu.Su(t,e,n,s)).catch(t=>{throw t.code===ks.UNAUTHENTICATED&&this.credentials._(),t})}terminate(){this.Eh=!1}}class Cu{constructor(t,e){this.ls=t,this._a=e,this.state="Unknown",this.Ih=0,this.mh=null,this.Ah=!0}Rh(){0===this.Ih&&(this.Ph("Unknown"),this.mh=this.ls.Er("online_state_timeout",1e4,()=>(this.mh=null,this.Vh("Backend didn't respond within 10 seconds."),this.Ph("Offline"),Promise.resolve())))}gh(t){"Online"===this.state?this.Ph("Unknown"):(this.Ih++,this.Ih>=1&&(this.yh(),this.Vh(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Ph("Offline")))}set(t){this.yh(),this.Ih=0,"Online"===t&&(this.Ah=!1),this.Ph(t)}Ph(t){t!==this.state&&(this.state=t,this._a(t))}Vh(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Ah?(Ts(e),this.Ah=!1):_s("OnlineStateTracker",e)}yh(){null!==this.mh&&(this.mh.cancel(),this.mh=null)}}class Pu{constructor(t,e,n,s,i){this.ph=t,this.bh=e,this.ls=n,this.Sh={},this.Dh=[],this.Ch=new Map,this.Nh=new Set,this.xh=[],this.$h=i,this.$h.ru(t=>{n.Rs(async()=>{Bu(this)&&(_s("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ds(t);e.Nh.add(4),await Vu(e),e.Oh.set("Unknown"),e.Nh.delete(4),await Uu(e)}(this))})}),this.Oh=new Cu(n,s)}}async function Uu(t){if(Bu(t))for(const e of t.xh)await e(!0)}async function Vu(t){for(const e of t.xh)await e(!1)}function Mu(t,e){const n=Ds(t);n.Ch.has(e.targetId)||(n.Ch.set(e.targetId,e),$u(n)?ju(n):tc(n).zu()&&Gu(n,e))}function qu(t,e){const n=Ds(t),s=tc(n);n.Ch.delete(e),s.zu()&&Fu(n,e),0===n.Ch.size&&(s.zu()?s.Yu():Bu(n)&&n.Oh.set("Unknown"))}function Gu(t,e){t.kh.rn(e.targetId),tc(t).ah(e)}function Fu(t,e){t.kh.rn(e),tc(t).uh(e)}function ju(t){t.kh=new No({bn:e=>t.Sh.bn(e),vn:e=>t.Ch.get(e)||null}),tc(t).start(),t.Oh.Rh()}function $u(t){return Bu(t)&&!tc(t).Gu()&&t.Ch.size>0}function Bu(t){return 0===Ds(t).Nh.size}function Ku(t){t.kh=void 0}async function Yu(t,e,n){if(!oa(e))throw e;t.Nh.add(1),await Vu(t),t.Oh.set("Offline"),n||(n=(()=>Yh(t.ph))),t.ls.yo(async()=>{_s("RemoteStore","Retrying IndexedDB access"),await n(),t.Nh.delete(1),await Uu(t)})}function zu(t,e){return e().catch(n=>Yu(t,n,e))}async function Hu(t){const e=Ds(t),n=ec(e);let s=e.Dh.length>0?e.Dh[e.Dh.length-1].batchId:-1;for(;Wu(e);)try{const i=await Hh(e.ph,s);if(null===i){0===e.Dh.length&&n.Yu();break}s=i.batchId,Xu(e,i)}catch(t){await Yu(e,t)}Ju(e)&&Qu(e)}function Wu(t){return Bu(t)&&t.Dh.length<10}function Xu(t,e){t.Dh.push(e);const n=ec(t);n.zu()&&n.lh&&n._h(e.mutations)}function Ju(t){return Bu(t)&&!ec(t).Gu()&&t.Dh.length>0}function Qu(t){ec(t).start()}async function Zu(t,e){const n=Ds(t);e?(n.Nh.delete(2),await Uu(n)):e||(n.Nh.add(2),await Vu(n),n.Oh.set("Unknown"))}function tc(t){return t.qh||(t.qh=function(t,e,n){const s=Ds(t);return s.Th(),new Lu(e,s.Uu,s.credentials,s.Ut,n)}(t.bh,t.ls,{du:async function(t){t.Ch.forEach((e,n)=>{Gu(t,e)})}.bind(null,t),Eu:async function(t,e){Ku(t),$u(t)?(t.Oh.gh(e),ju(t)):t.Oh.set("Unknown")}.bind(null,t),oh:async function(t,e,n){if(t.Oh.set("Online"),e instanceof _o&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Ch.has(s)&&(await t.Sh.Mh(s,n),t.Ch.delete(s),t.kh.removeTarget(s))}(t,e)}catch(n){_s("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Yu(t,n)}else if(e instanceof Eo?t.kh.fn(e):e instanceof Io?t.kh.Rn(e):t.kh.En(e),!n.isEqual(Ys.min()))try{const s=await Yh(t.ph);n.L(s)>=0&&await function(t,e){const n=t.kh.gn(e);return n.xe.forEach((n,s)=>{if(n.resumeToken.wt()>0){const i=t.Ch.get(s);i&&t.Ch.set(s,i.Mt(n.resumeToken,e))}}),n.$e.forEach(e=>{const n=t.Ch.get(e);if(!n)return;t.Ch.set(e,n.Mt(ni.Et,n.Ot)),Fu(t,e);const s=new pr(n.target,e,1,n.sequenceNumber);Gu(t,s)}),t.Sh.Fh(n)}(t,n)}catch(e){_s("RemoteStore","Failed to raise snapshot:",e),await Yu(t,e)}}.bind(null,t)}),t.xh.push(async e=>{e?(t.qh.Ju(),$u(t)?ju(t):t.Oh.set("Unknown")):(await t.qh.stop(),Ku(t))})),t.qh}function ec(t){return t.Uh||(t.Uh=function(t,e,n){const s=Ds(t);return s.Th(),new Ou(e,s.Uu,s.credentials,s.Ut,n)}(t.bh,t.ls,{du:async function(t){ec(t).wh()}.bind(null,t),Eu:async function(t,e){e&&ec(t).lh&&await async function(t,e){if(Jr(n=e.code)&&n!==ks.ABORTED){const n=t.Dh.shift();ec(t).Ju(),await zu(t,()=>t.Sh.Bh(n.batchId,e)),await Hu(t)}var n}(t,e),Ju(t)&&Qu(t)}.bind(null,t),dh:async function(t){const e=ec(t);for(const n of t.Dh)e._h(n.mutations)}.bind(null,t),fh:async function(t,e,n){const s=t.Dh.shift(),i=qa.from(s,e,n);await zu(t,()=>t.Sh.Lh(i)),await Hu(t)}.bind(null,t)}),t.xh.push(async e=>{e?(t.Uh.Ju(),await Hu(t)):(await t.Uh.stop(),t.Dh.length>0&&(_s("RemoteStore",`Stopping write stream with ${t.Dh.length} pending writes`),t.Dh=[]))})),t.Uh}class nc{constructor(){this.Kh=void 0,this.listeners=[]}}class sc{constructor(){this.queries=new ah(t=>ur(t),hr),this.onlineState="Unknown",this.Qh=new Set}}async function ic(t,e){const n=Ds(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new nc),i)try{r.Kh=await n.Wh(s)}catch(t){const n=fa(t,`Initialization of query '${cr(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.jh(n.onlineState),r.Kh&&e.Gh(r.Kh)&&oc(n)}async function rc(t,e){const n=Ds(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.zh(s)}function oc(t){t.Qh.forEach(t=>{t.next()})}class ac{constructor(t,e,n){this.query=t,this.Hh=e,this.Jh=!1,this.Yh=null,this.onlineState="Unknown",this.options=n||{}}Gh(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new wo(t.query,t.docs,t.ve,e,t.Se,t.fromCache,t.De,!0)}let e=!1;return this.Jh?this.Xh(t)&&(this.Hh.next(t),e=!0):this.Zh(t,this.onlineState)&&(this.tl(t),e=!0),this.Yh=t,e}onError(t){this.Hh.error(t)}jh(t){this.onlineState=t;let e=!1;return this.Yh&&!this.Jh&&this.Zh(this.Yh,t)&&(this.tl(this.Yh),e=!0),e}Zh(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.el&&n||t.docs.Y()&&"Offline"!==e)}Xh(t){if(t.docChanges.length>0)return!0;const e=this.Yh&&this.Yh.hasPendingWrites!==t.hasPendingWrites;return!(!t.De&&!e)&&!0===this.options.includeMetadataChanges}tl(t){t=wo.Ne(t.query,t.docs,t.Se,t.fromCache),this.Jh=!0,this.Hh.next(t)}}class hc{constructor(t,e){this.payload=t,this.byteLength=e}nl(){return"metadata"in this.payload}}class uc{constructor(t){this.Ut=t}Rc(t){return Vo(this.Ut,t)}Pc(t){return t.metadata.exists?$o(this.Ut,t.document,!1):new Di(this.Rc(t.metadata.name),this.Vc(t.metadata.readTime))}Vc(t){return Ro(t)}}class cc{constructor(t,e,n){this.sl=t,this.ph=e,this.Ut=n,this.queries=[],this.documents=[],this.progress=lc(t)}il(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}rl(t){const e=new Map,n=new uc(this.Ut);for(const s of t)if(s.metadata.queries){const t=n.Rc(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||fo()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const i=Ds(t);let r=fo(),o=ro(),a=co();for(const t of n){const n=e.Rc(t.metadata.name);t.document&&(r=r.add(n)),o=o.Gt(n,e.Pc(t)),a=a.Gt(n,e.Vc(t.metadata.readTime))}const h=i.wc.Cr({Qr:!0}),u=await Wh(i,function(t){return or(Zi(Hs.nt(`__bundle__/docs/${t}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>zh(t,h,o,Ys.min(),a).next(e=>(h.apply(t),e)).next(e=>i.lo.Ji(t,u.targetId).next(()=>i.lo.tr(t,r,u.targetId)).next(()=>i.Ec.Xo(t,e))))}(this.ph,new uc(this.Ut),this.documents,this.sl.id),e=this.rl(this.documents);for(const t of this.queries)await tu(this.ph,t,e.get(t.name));return this.progress.taskState="Success",new qh(Object.assign({},this.progress),t)}}function lc(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class fc{constructor(t){this.key=t}}class dc{constructor(t){this.key=t}}class pc{constructor(t,e){this.query=t,this.ol=e,this.cl=null,this.Le=!1,this.al=fo(),this.Se=fo(),this.ul=fr(t),this.hl=new mo(this.ul)}get ll(){return this.ol}_l(t,e){const n=e?e.fl:new yo,s=e?e.hl:this.hl;let i=e?e.Se:this.Se,r=s,o=!1;const a=tr(this.query)&&s.size===this.query.limit?s.last():null,h=er(this.query)&&s.size===this.query.limit?s.first():null;if(t.Yt((t,e)=>{const u=s.get(t);let c=e instanceof xi?e:null;c&&(c=lr(this.query,c)?c:null);const l=!!u&&this.Se.has(u.key),f=!!c&&(c.gt||this.Se.has(c.key)&&c.hasCommittedMutations);let d=!1;u&&c?u.data().isEqual(c.data())?l!==f&&(n.track({type:3,doc:c}),d=!0):this.dl(u,c)||(n.track({type:2,doc:c}),d=!0,(a&&this.ul(c,a)>0||h&&this.ul(c,h)<0)&&(o=!0)):!u&&c?(n.track({type:0,doc:c}),d=!0):u&&!c&&(n.track({type:1,doc:u}),d=!0,(a||h)&&(o=!0)),d&&(c?(r=r.add(c),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),tr(this.query)||er(this.query))for(;r.size>this.query.limit;){const t=tr(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{hl:r,fl:n,hc:o,Se:i}}dl(t,e){return t.gt&&e.hasCommittedMutations&&!e.gt}di(t,e,n){const s=this.hl;this.hl=t.hl,this.Se=t.Se;const i=t.fl.be();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return As()}};return n(t)-n(e)})(t.type,e.type)||this.ul(t.doc,e.doc)),this.wl(n);const r=e?this.El():[],o=0===this.al.size&&this.Le?1:0,a=o!==this.cl;return this.cl=o,0!==i.length||a?{snapshot:new wo(this.query,t.hl,s,i,t.Se,0===o,a,!1),Tl:r}:{Tl:r}}jh(t){return this.Le&&"Offline"===t?(this.Le=!1,this.di({hl:this.hl,fl:new yo,Se:this.Se,hc:!1},!1)):{Tl:[]}}Il(t){return!this.ol.has(t)&&!!this.hl.has(t)&&!this.hl.get(t).gt}wl(t){t&&(t.Be.forEach(t=>this.ol=this.ol.add(t)),t.qe.forEach(t=>{}),t.Ue.forEach(t=>this.ol=this.ol.delete(t)),this.Le=t.Le)}El(){if(!this.Le)return[];const t=this.al;this.al=fo(),this.hl.forEach(t=>{this.Il(t.key)&&(this.al=this.al.add(t.key))});const e=[];return t.forEach(t=>{this.al.has(t)||e.push(new dc(t))}),this.al.forEach(n=>{t.has(n)||e.push(new fc(n))}),e}ml(t){this.ol=t.Ac,this.al=fo();const e=this._l(t.documents);return this.di(e,!0)}Al(){return wo.Ne(this.query,this.hl,this.Se,0===this.cl)}}class gc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class mc{constructor(t){this.key=t,this.Rl=!1}}class yc{constructor(t,e,n,s,i,r){this.ph=t,this.Pl=e,this.Vl=n,this.gl=s,this.currentUser=i,this.yl=r,this.pl={},this.bl=new ah(t=>ur(t),hr),this.vl=new Map,this.Sl=new Set,this.Dl=new Zr(Js.K),this.Cl=new Map,this.Nl=new nu,this.xl={},this.$l=new Map,this.Ol=mh.Fi(),this.onlineState="Unknown",this.kl=void 0}get Ml(){return!0===this.kl}}async function wc(t,e,n,s){t.Fl=((e,n,s)=>(async function(t,e,n,s){let i=e.view._l(n);i.hc&&(i=await Jh(t.ph,e.query,!1).then(({documents:t})=>e.view._l(t,i)));const r=s&&s.xe.get(e.targetId),o=e.view.di(i,t.Ml,r);return Sc(t,e.targetId,o.Tl),o.snapshot})(t,e,n,s));const i=await Jh(t.ph,e,!0),r=new pc(e,i.Ac),o=r._l(i.documents),a=bo.Fe(n,s&&"Offline"!==t.onlineState),h=r.di(o,t.Ml,a);Sc(t,n,h.Tl);const u=new gc(e,n,r);return t.bl.set(e,u),t.vl.has(n)?t.vl.get(n).push(e):t.vl.set(n,[e]),h.snapshot}async function vc(t,e){const n=Ds(t);try{const s=await function(t,e){const n=Ds(t),s=e.Ot;let i=n._c;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const r=n.wc.Cr({Qr:!0});i=n._c;const o=[];e.xe.forEach((e,r)=>{const a=i.get(r);if(!a)return;o.push(n.lo.nr(t,e.Ue,r).next(()=>n.lo.tr(t,e.Be,r)));const h=e.resumeToken;if(h.wt()>0){const u=a.Mt(h,s).kt(t.ps);i=i.Gt(r,u),function(t,e,n){return xs(e.resumeToken.wt()>0),0===t.resumeToken.wt()||e.Ot.B()-t.Ot.B()>=3e8||n.Be.size+n.qe.size+n.Ue.size>0}(a,u,e)&&o.push(n.lo.zi(t,u))}});let a=ro();if(e.Oe.forEach((s,i)=>{e.ke.has(s)&&o.push(n.persistence.Ei.$r(t,s))}),o.push(zh(t,r,e.Oe,s,void 0).next(t=>{a=t})),!s.isEqual(Ys.min())){const e=n.lo.Ui(t).next(e=>n.lo.Qi(t,t.ps,s));o.push(e)}return ea.Mn(o).next(()=>r.apply(t)).next(()=>n.Ec.Xo(t,a))}).then(t=>(n._c=i,t))}(n.ph,e);e.xe.forEach((t,e)=>{const s=n.Cl.get(e);s&&(xs(t.Be.size+t.qe.size+t.Ue.size<=1),t.Be.size>0?s.Rl=!0:t.qe.size>0?xs(s.Rl):t.Ue.size>0&&(xs(s.Rl),s.Rl=!1))}),await Dc(n,s,e)}catch(t){await oh(t)}}function bc(t,e,n){const s=Ds(t);if(s.Ml&&0===n||!s.Ml&&1===n){const t=[];s.bl.forEach((n,s)=>{const i=s.view.jh(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=Ds(t);n.onlineState=e;let s=!1;n.queries.forEach((t,n)=>{for(const t of n.listeners)t.jh(e)&&(s=!0)}),s&&oc(n)}(s.Vl,e),t.length&&s.pl.oh(t),s.onlineState=e,s.Ml&&s.gl.Ua(e)}}async function Ec(t,e){const n=Ds(t),s=e.batch.batchId;try{const i=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const s=e.batch.keys(),i=n.wc.Cr({Qr:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=ea.resolve();return r.forEach(t=>{o=o.next(()=>s.li(e,t)).next(e=>{let r=e;const o=n.xs.get(t);xs(null!==o),(!r||r.version.L(o)<0)&&(r=i.vs(t,r,n))&&s.ci(r,n.Ns)})}),o.next(()=>t.Go.Di(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.Go.xi(t)).next(()=>n.Ec.Yo(t,s))})}(n.ph,e);_c(n,s,null),Ic(n,s),n.gl.Na(s,"acknowledged"),await Dc(n,i)}catch(t){await oh(t)}}function Ic(t,e){(t.$l.get(e)||[]).forEach(t=>{t.resolve()}),t.$l.delete(e)}function _c(t,e,n){const s=Ds(t);let i=s.xl[s.currentUser.i()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.xl[s.currentUser.i()]=i}}function Tc(t,e,n=null){t.gl.ka(e);for(const s of t.vl.get(e))t.bl.delete(s),n&&t.pl.Ll(s,n);t.vl.delete(e),t.Ml&&t.Nl.$c(e).forEach(e=>{t.Nl.$i(e)||Nc(t,e)})}function Nc(t,e){t.Sl.delete(e.path.et());const n=t.Dl.get(e);null!==n&&(qu(t.Pl,n),t.Dl=t.Dl.remove(e),t.Cl.delete(n),xc(t))}function Sc(t,e,n){for(const s of n)s instanceof fc?(t.Nl.er(s.key,e),Ac(t,s)):s instanceof dc?(_s("SyncEngine","Document no longer in limbo: "+s.key),t.Nl.sr(s.key,e),t.Nl.$i(s.key)||Nc(t,s.key)):As()}function Ac(t,e){const n=e.key,s=n.path.et();t.Dl.get(n)||t.Sl.has(s)||(_s("SyncEngine","New document in limbo: "+n),t.Sl.add(s),xc(t))}function xc(t){for(;t.Sl.size>0&&t.Dl.size<t.yl;){const e=t.Sl.values().next().value;t.Sl.delete(e);const n=new Js(Hs.nt(e)),s=t.Ol.next();t.Cl.set(s,new mc(n)),t.Dl=t.Dl.Gt(n,s),Mu(t.Pl,new pr(or(Zi(n.path)),s,2,qs.O))}}async function Dc(t,e,n){const s=Ds(t),i=[],r=[],o=[];s.bl.Y()||(s.bl.forEach((t,a)=>{o.push(s.Fl(a,e,n).then(t=>{if(t){s.Ml&&s.gl.La(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Fh.rc(a.targetId,t);r.push(e)}}))}),await Promise.all(o),s.pl.oh(i),await async function(t,e){const n=Ds(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>ea.forEach(e,e=>ea.forEach(e.sc,s=>n.persistence.Ei.er(t,e.targetId,s)).next(()=>ea.forEach(e.ic,s=>n.persistence.Ei.sr(t,e.targetId,s)))))}catch(t){if(!oa(t))throw t;_s("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n._c.get(e),s=t.Ot,i=t.Ft(s);n._c=n._c.Gt(e,i)}}}(s.ph,r))}async function kc(t,e){const n=Ds(t),s=await Jh(n.ph,e.query,!0),i=e.view.ml(s);return n.Ml&&Sc(n,e.targetId,i.Tl),i}async function Lc(t,e,n){const s=Ds(t),i=[],r=[];for(const t of e){let e;const n=s.vl.get(t);if(n&&0!==n.length){e=await Wh(s.ph,or(n[0]));for(const t of n){const e=s.bl.get(t),n=await kc(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Qh(s.ph,t);e=await Wh(s.ph,n),await wc(s,Oc(n),t,!1)}i.push(e)}return s.pl.oh(r),i}function Oc(t){return Qi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Rc(t){const e=Ds(t);return e.Pl.Sh.Fh=vc.bind(null,e),e.Pl.Sh.bn=function(t,e){const n=Ds(t),s=n.Cl.get(e);if(s&&s.Rl)return fo().add(s.key);{let t=fo();const s=n.vl.get(e);if(!s)return t;for(const e of s){const s=n.bl.get(e);t=t.Re(s.view.ll)}return t}}.bind(null,e),e.Pl.Sh.Mh=async function(t,e,n){const s=Ds(t);s.gl.La(e,"rejected",n);const i=s.Cl.get(e),r=i&&i.key;if(r){let t=new Zr(Js.K);t=t.Gt(r,new Di(r,Ys.min()));const n=fo().add(r),i=new vo(Ys.min(),new Map,new no(js),t,n);await vc(s,i),s.Dl=s.Dl.remove(r),s.Cl.delete(e),xc(s)}else await Xh(s.ph,e,!1).then(()=>Tc(s,e,n)).catch(oh)}.bind(null,e),e.pl.oh=function(t,e){const n=Ds(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.Gh(t)&&(s=!0);i.Kh=t}}s&&oc(n)}.bind(null,e.Vl),e.pl.Ll=function(t,e,n){const s=Ds(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}.bind(null,e.Vl),e}function Cc(t){const e=Ds(t);return e.Pl.Sh.Lh=Ec.bind(null,e),e.Pl.Sh.Bh=async function(t,e,n){const s=Ds(t);try{const t=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return n.Go.Ri(t,e).next(e=>(xs(null!==e),s=e.keys(),n.Go.Di(t,e))).next(()=>n.Go.xi(t)).next(()=>n.Ec.Yo(t,s))})}(s.ph,e);_c(s,e,n),Ic(s,e),s.gl.Na(e,"rejected",n),await Dc(s,t)}catch(n){await oh(n)}}.bind(null,e),e}class Pc{constructor(){this.synchronizeTabs=!1}async initialize(t){this.Ut=xu(t.Pu.p),this.gl=this.Ql(t),this.persistence=this.Wl(t),await this.persistence.start(),this.jl=this.Gl(t),this.ph=this.zl(t)}Gl(t){return null}zl(t){return Bh(this.persistence,new jh,t.Hl,this.Ut)}Wl(t){return new hu(cu.sa,this.Ut)}Ql(t){return new bu}async terminate(){this.jl&&this.jl.stop(),await this.gl.ko(),await this.persistence.ko()}}class Uc extends Pc{constructor(t,e,n){super(),this.Jl=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=Ds(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>(function(t){const e=kh(t);let n=Ys.min();return e.us({index:Sa.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=Ba(e.readTime)),s.done()}).next(()=>n)})(t)).then(t=>{e.dc=t})}(this.ph),await this.Jl.initialize(this,t),await Cc(this.Jl.la),await Hu(this.Jl.Pl)}zl(t){return Bh(this.persistence,new jh,t.Hl,this.Ut)}Gl(t){const e=this.persistence.Ei.hr;return new _h(e,t.ls)}Wl(t){const e=Mh(t.Pu.p,t.Pu.persistenceKey),n=void 0!==this.cacheSizeBytes?rh.Js(this.cacheSizeBytes):rh.Zs;return new Ph(this.synchronizeTabs,e,t.clientId,n,t.ls,Su(),Au(),this.Ut,this.gl,!!this.forceOwnership)}Ql(t){return new bu}}class Vc extends Uc{constructor(t,e){super(t,e,!1),this.Jl=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Jl.la;this.gl instanceof vu&&(this.gl.la={tu:async function(t,e,n,s){const i=Ds(t),r=await function(t,e){const n=Ds(t),s=Ds(n.Go);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Pi(t,e).next(e=>e?n.Ec.Yo(t,e):ea.resolve(null)))}(i.ph,e);null!==r?("pending"===n?await Hu(i.Pl):"acknowledged"===n||"rejected"===n?(_c(i,e,s||null),Ic(i,e),function(t,e){Ds(Ds(t).Go).Ci(e)}(i.ph,e)):As(),await Dc(i,r)):_s("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),eu:async function(t,e,n,s){const i=Ds(t);if(i.kl)_s("SyncEngine","Ignoring unexpected query state notification.");else if(i.vl.has(e))switch(n){case"current":case"not-current":{const t=await Zh(i.ph),s=vo.Me(e,"current"===n);await Dc(i,t,s);break}case"rejected":await Xh(i.ph,e,!0),Tc(i,e,s);break;default:As()}}.bind(null,e),nu:async function(t,e,n){const s=Rc(t);if(s.kl){for(const t of e){if(s.vl.has(t)){_s("SyncEngine","Adding an already active target "+t);continue}const e=await Qh(s.ph,t),n=await Wh(s.ph,e);await wc(s,Oc(e),n.targetId,!1),Mu(s.Pl,n)}for(const t of n)s.vl.has(t)&&await Xh(s.ph,t,!1).then(()=>{qu(s.Pl,t),Tc(s,t)}).catch(oh)}}.bind(null,e),qo:function(t){return Ds(Ds(Ds(t).ph).persistence).qo()}.bind(null,e),Za:async function(t){const e=Ds(t);return Zh(e.ph).then(t=>Dc(e,t))}.bind(null,e)},await this.gl.start()),await this.persistence.Ao(async t=>{await async function(t,e){const n=Ds(t);if(Rc(n),Cc(n),!0===e&&!0!==n.kl){const t=n.gl.ba(),e=await Lc(n,t.tt());n.kl=!0,await Zu(n.Pl,!0);for(const t of e)Mu(n.Pl,t)}else if(!1===e&&!1!==n.kl){const t=[];let e=Promise.resolve();n.vl.forEach((s,i)=>{n.gl.Ma(i)?t.push(i):e=e.then(()=>(Tc(n,i),Xh(n.ph,i,!0))),qu(n.Pl,i)}),await e,await Lc(n,t),function(t){const e=Ds(n);e.Cl.forEach((t,n)=>{qu(e.Pl,n)}),e.Nl.Oc(),e.Cl=new Map,e.Dl=new Zr(Js.K)}(),n.kl=!1,await Zu(n.Pl,!1)}}(this.Jl.la,t),this.jl&&(t&&!this.jl.wr?this.jl.start(this.ph):t||this.jl.stop())})}Ql(t){const e=Su();if(!vu.Kn(e))throw new Ls(ks.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Mh(t.Pu.p,t.Pu.persistenceKey);return new vu(e,t.ls,n,t.clientId,t.Hl)}}class Mc{async initialize(t,e){this.ph||(this.ph=t.ph,this.gl=t.gl,this.bh=this.Yl(e),this.Pl=this.Xl(e),this.Vl=this.Zl(e),this.la=this.t_(e,!t.synchronizeTabs),this.gl._a=(t=>bc(this.la,t,1)),this.Pl.Sh.e_=async function(t,e){const n=Ds(t);if(!n.currentUser.isEqual(e)){_s("SyncEngine","User change. New user:",e.i());const t=await Kh(n.ph,e);n.currentUser=e,function(t,e){t.$l.forEach(t=>{t.forEach(t=>{t.reject(new Ls(ks.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.$l.clear()}(n),n.gl.qa(e,t.Ic,t.mc),await Dc(n,t.Tc)}}.bind(null,this.la),await Zu(this.Pl,this.la.Ml))}Zl(t){return new sc}Yl(t){const e=xu(t.Pu.p),n=(s=t.Pu,new Nu(s));var s;return function(t,e,n){return new Ru(t,e,n)}(t.credentials,n,e)}Xl(t){return e=this.ph,n=this.bh,s=t.ls,i=(t=>bc(this.la,t,0)),r=Iu.Kn()?new Iu:new Eu,new Pu(e,n,s,i,r);var e,n,s,i,r}t_(t,e){return function(t,e,n,s,i,r,o){const a=new yc(t,e,n,s,i,r);return o&&(a.kl=!0),a}(this.ph,this.Pl,this.Vl,this.gl,t.Hl,t.yl,e)}terminate(){return async function(t){const e=Ds(t);_s("RemoteStore","RemoteStore shutting down."),e.Nh.add(5),await Vu(e),e.$h.ko(),e.Oh.set("Unknown")}(this.Pl)}}function qc(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){}}}class Gc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.n_(this.observer.next,t)}error(t){this.observer.error?this.n_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}s_(){this.muted=!0}n_(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}class Fc{constructor(t,e){this.i_=t,this.Ut=e,this.metadata=new ta,this.buffer=new Uint8Array,this.r_=new TextDecoder("utf-8"),this.o_().then(t=>{t&&t.nl()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))},t=>this.metadata.reject(t))}close(){return this.i_.cancel()}async getMetadata(){return this.metadata.promise}async Ul(){return await this.getMetadata(),this.o_()}async o_(){const t=await this.c_();if(null===t)return null;const e=this.r_.decode(t),n=Number(e);isNaN(n)&&this.a_(`length string (${e}) is not valid number`);const s=await this.u_(n);return new hc(JSON.parse(s),t.length+n)}h_(){return this.buffer.findIndex(t=>t==="{".charCodeAt(0))}async c_(){for(;this.h_()<0&&!await this.l_(););if(0===this.buffer.length)return null;const t=this.h_();t<0&&this.a_("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async u_(t){for(;this.buffer.length<t;)await this.l_()&&this.a_("Reached the end of bundle when more is expected.");const e=this.r_.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}a_(t){throw this.i_.cancel(),new Error(`Invalid bundle format: ${t}`)}async l_(){const t=await this.i_.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class jc{constructor(t){this.__=t}static fromBase64String(t){try{return new jc(ni.fromBase64String(t))}catch(t){throw new Ls(ks.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new jc(ni.fromUint8Array(t))}toBase64(){return this.__.toBase64()}toUint8Array(){return this.__.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.__.isEqual(t.__)}}class $c{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ls(ks.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.f_=new Xs(t)}isEqual(t){return this.f_.isEqual(t.f_)}}class Bc{constructor(t){this._methodName=t}}class Kc{constructor(t){this.d_=t}}function Yc(t,e,n){if(!n)throw new Ls(ks.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function zc(t){if(!Js.lt(t))throw new Ls(ks.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Hc(t){if(Js.lt(t))throw new Ls(ks.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Wc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":As()}function Xc(t,e){if("_delegate"in t&&(t=t.d_),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ls(ks.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Wc(t);throw new Ls(ks.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Jc(t,e){if(e<=0)throw new Ls(ks.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Qc{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Ls(ks.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ls(ks.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,function(t,e,n,s){if(!0===e&&!0===s)throw new Ls(ks.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties}}const Zc=new Map;class tl{constructor(t,e){this.w_="(lite)",this.E_=new Qc({}),this.T_=!1,t instanceof Ms?(this.I_=t,this.m_=new Rs):(this.A_=t,this.I_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ls(ks.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ms(t.options.projectId)}(t),this.m_=new Cs(e))}get app(){if(!this.A_)throw new Ls(ks.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.A_}get R_(){return this.T_}get P_(){return void 0!==this.V_}g_(t){if(this.T_)throw new Ls(ks.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.E_=new Qc(t),void 0!==t.credentials&&(this.m_=function(t){if(!t)return new Rs;switch(t.type){case"gapi":const e=t.client;return xs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Us(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Ls(ks.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}y_(){return this.E_}p_(){return this.T_=!0,this.E_}_delete(){return this.V_||(this.V_=this.b_()),this.V_}toJSON(){return{app:this.A_,p:this.I_,settings:this.E_}}b_(){return function(t){const e=Zc.get(t);e&&(_s("ComponentProvider","Removing Datastore"),Zc.delete(t),e.terminate())}(this),Promise.resolve()}}class el{constructor(t,e,n){this.v_=e,this.S_=n,this.type="document",this.firestore=t}get D_(){return this.S_.path}get id(){return this.S_.path.J()}get path(){return this.S_.path.et()}get parent(){return new sl(this.firestore,this.v_,this.S_.path.G())}withConverter(t){return new el(this.firestore,t,this.S_)}}class nl{constructor(t,e,n){this.v_=e,this.C_=n,this.type="query",this.firestore=t}withConverter(t){return new nl(this.firestore,t,this.C_)}}class sl extends nl{constructor(t,e,n){super(t,e,Zi(n)),this.firestore=t,this.D_=n,this.type="collection"}get id(){return this.C_.path.J()}get path(){return this.C_.path.et()}get parent(){const t=this.D_.G();return t.Y()?null:new el(this.firestore,null,new Js(t))}withConverter(t){return new sl(this.firestore,t,this.D_)}}function il(t,e,...n){if(t instanceof Kc&&(t=t.d_),1===arguments.length&&(e=Fs.k()),Yc("doc","path",e),t instanceof tl){const s=Hs.nt(e,...n);return zc(s),new el(t,null,new Js(s))}{if(!(t instanceof el||t instanceof sl))throw new Ls(ks.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t.D_.child(Hs.nt(e,...n));return zc(s),new el(t.firestore,t instanceof sl?t.v_:null,new Js(s))}}function rl(t,e){return t instanceof Kc&&(t=t.d_),e instanceof Kc&&(e=e.d_),t instanceof nl&&e instanceof nl&&t.firestore===e.firestore&&hr(t.C_,e.C_)&&t.v_===e.v_}class ol{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ls(ks.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ls(ks.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.N_=t,this.x_=e}get latitude(){return this.N_}get longitude(){return this.x_}isEqual(t){return this.N_===t.N_&&this.x_===t.x_}toJSON(){return{latitude:this.N_,longitude:this.x_}}M(t){return js(this.N_,t.N_)||js(this.x_,t.x_)}}const al=/^__.*__$/;class hl{constructor(t,e,n){this.data=t,this.jt=e,this.fieldTransforms=n}O_(t,e){return null!==this.jt?new Fr(t,this.data,this.jt,e,this.fieldTransforms):new Gr(t,this.data,e,this.fieldTransforms)}}class ul{constructor(t,e,n){this.data=t,this.jt=e,this.fieldTransforms=n}O_(t,e){return new Fr(t,this.data,this.jt,e,this.fieldTransforms)}}function cl(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw As()}}class ll{constructor(t,e,n,s,i,r){this.settings=t,this.p=e,this.Ut=n,this.ignoreUndefinedProperties=s,void 0===i&&this.k_(),this.fieldTransforms=i||[],this.jt=r||[]}get path(){return this.settings.path}get M_(){return this.settings.M_}F_(t){return new ll(Object.assign(Object.assign({},this.settings),t),this.p,this.Ut,this.ignoreUndefinedProperties,this.fieldTransforms,this.jt)}L_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.F_({path:n,B_:!1});return s.q_(t),s}U_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.F_({path:n,B_:!1});return s.k_(),s}K_(t){return this.F_({path:void 0,B_:!0})}Q_(t){return Ll(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)}contains(t){return void 0!==this.jt.find(e=>t.X(e))||void 0!==this.fieldTransforms.find(e=>t.X(e.field))}k_(){if(this.path)for(let t=0;t<this.path.length;t++)this.q_(this.path.get(t))}q_(t){if(0===t.length)throw this.Q_("Document fields must not be empty");if(cl(this.M_)&&al.test(t))throw this.Q_('Document fields cannot begin and end with "__"')}}class fl{constructor(t,e,n){this.p=t,this.ignoreUndefinedProperties=e,this.Ut=n||xu(t)}G_(t,e,n,s=!1){return new ll({M_:t,methodName:e,j_:n,path:Xs.st(),B_:!1,W_:s},this.p,this.Ut,this.ignoreUndefinedProperties)}}function dl(t){const e=t.p_(),n=xu(t.I_);return new fl(t.I_,!!e.ignoreUndefinedProperties,n)}function pl(t,e,n,s,i,r={}){const o=t.G_(r.merge||r.mergeFields?2:0,e,n,i);Al("Data must be an object, but it was:",o,s);const a=Nl(s,o);let h,u;if(r.merge)h=new ei(o.jt),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=xl(e,s,n);if(!o.contains(i))throw new Ls(ks.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ol(t,i)||t.push(i)}h=new ei(t),u=o.fieldTransforms.filter(t=>h.ft(t.field))}else h=null,u=o.fieldTransforms;return new hl(new Ti(a),h,u)}class gl extends Bc{z_(t){if(2!==t.M_)throw 1===t.M_?t.Q_(`${this._methodName}() can only appear at the top level of your update data`):t.Q_(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.jt.push(t.path),null}isEqual(t){return t instanceof gl}}function ml(t,e,n){return new ll({M_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.p,e.Ut,e.ignoreUndefinedProperties)}class yl extends Bc{z_(t){return new kr(t.path,new Ir)}isEqual(t){return t instanceof yl}}class wl extends Bc{constructor(t,e){super(t),this.H_=e}z_(t){const e=ml(this,t,!0),n=this.H_.map(t=>Tl(t,e)),s=new _r(n);return new kr(t.path,s)}isEqual(t){return this===t}}class vl extends Bc{constructor(t,e){super(t),this.H_=e}z_(t){const e=ml(this,t,!0),n=this.H_.map(t=>Tl(t,e)),s=new Nr(n);return new kr(t.path,s)}isEqual(t){return this===t}}class bl extends Bc{constructor(t,e){super(t),this.J_=e}z_(t){const e=new Ar(t.Ut,yr(t.Ut,this.J_));return new kr(t.path,e)}isEqual(t){return this===t}}function El(t,e,n,s){const i=t.G_(1,e,n);Al("Data must be an object, but it was:",i,s);const r=[],o=new Ni;Zs(s,(t,s)=>{const a=kl(e,t,n);s instanceof Kc&&(s=s.d_);const h=i.U_(a);if(s instanceof gl)r.push(a);else{const t=Tl(s,h);null!=t&&(r.push(a),o.set(a,t))}});const a=new ei(r);return new ul(o.Rt(),a,i.fieldTransforms)}function Il(t,e,n,s,i,r){const o=t.G_(1,e,n),a=[xl(e,s,n)],h=[i];if(r.length%2!=0)throw new Ls(ks.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(xl(e,r[t])),h.push(r[t+1]);const u=[],c=new Ni;for(let t=a.length-1;t>=0;--t)if(!Ol(u,a[t])){const e=a[t];let n=h[t];n instanceof Kc&&(n=n.d_);const s=o.U_(e);if(n instanceof gl)u.push(e);else{const t=Tl(n,s);null!=t&&(u.push(e),c.set(e,t))}}const l=new ei(u);return new ul(c.Rt(),l,o.fieldTransforms)}function _l(t,e,n,s=!1){return Tl(n,t.G_(s?4:3,e))}function Tl(t,e){if(t instanceof Kc&&(t=t.d_),Sl(t))return Al("Unsupported field value:",e,t),Nl(t,e);if(t instanceof Bc)return function(t,e){if(!cl(e.M_))throw e.Q_(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Q_(`${t._methodName}() is not currently supported inside arrays`);const n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.jt.push(e.path),t instanceof Array){if(e.settings.B_&&4!==e.M_)throw e.Q_("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Tl(i,e.K_(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof Kc&&(t=t.d_),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return yr(e.Ut,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ks.fromDate(t);return{timestampValue:Lo(e.Ut,n)}}if(t instanceof Ks){const n=new Ks(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Lo(e.Ut,n)}}if(t instanceof ol)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof jc)return{bytesValue:Oo(e.Ut,t.__)};if(t instanceof el){const n=e.p,s=t.firestore.I_;if(!s.isEqual(n))throw e.Q_(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Co(t.firestore.I_||e.p,t.S_.path)}}throw e.Q_(`Unsupported field value: ${Wc(t)}`)}(t,e)}function Nl(t,e){const n={};return ti(t)?e.path&&e.path.length>0&&e.jt.push(e.path):Zs(t,(t,s)=>{const i=Tl(s,e.L_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Sl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ks||t instanceof ol||t instanceof jc||t instanceof el||t instanceof Bc)}function Al(t,e,n){if(!Sl(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=Wc(n);throw"an object"===s?e.Q_(t+" a custom object"):e.Q_(t+" "+s)}}function xl(t,e,n){if(e instanceof Kc&&(e=e.d_),e instanceof $c)return e.f_;if("string"==typeof e)return kl(t,e);throw Ll("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Dl=new RegExp("[~\\*/\\[\\]]");function kl(t,e,n){if(e.search(Dl)>=0)throw Ll(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new $c(...e.split(".")).f_}catch(s){throw Ll(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ll(t,e,n,s,i){const r=s&&!s.Y(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(r||o)&&(h+=" (found",r&&(h+=` in field ${s}`),o&&(h+=` in document ${i}`),h+=")"),new Ls(ks.INVALID_ARGUMENT,a+t+h)}function Ol(t,e){return t.some(t=>t.isEqual(e))}class Rl{constructor(t){this.bh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}async ef(t){if(this.nf(),this.mutations.length>0)throw new Ls(ks.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ds(t),s=Go(n.Ut)+"/documents",i={documents:e.map(t=>Uo(n.Ut,t))},r=await n.Su("BatchGetDocuments",s,i),o=new Map;r.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){xs(!!e.found),e.found.name,e.found.updateTime;const n=Vo(t,e.found.name),s=Ro(e.found.updateTime),i=new Ti({mapValue:{fields:e.found.fields}});return new xi(n,s,i,{})}(t,e):"missing"in e?function(t,e){xs(!!e.missing),xs(!!e.readTime);const n=Vo(t,e.missing),s=Ro(e.readTime);return new Di(n,s)}(t,e):As()}(n.Ut,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());xs(!!e),a.push(e)}),a}(this.bh,t);return e.forEach(t=>{t instanceof Di||t instanceof xi?this.sf(t):As()}),e}set(t,e){this.write(e.O_(t,this.Wt(t))),this.tf.add(t.toString())}update(t,e){try{this.write(e.O_(t,this.rf(t)))}catch(t){this.Z_=t}this.tf.add(t.toString())}delete(t){this.write(new Yr(t,this.Wt(t))),this.tf.add(t.toString())}async commit(){if(this.nf(),this.Z_)throw this.Z_;const t=this.Y_;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=Js.at(e);this.mutations.push(new zr(n,this.Wt(n)))}),await async function(t,e){const n=Ds(t),s=Go(n.Ut)+"/documents",i={writes:e.map(t=>Bo(n.Ut,t))};await n.yu("Commit",s,i)}(this.bh,this.mutations),this.X_=!0}sf(t){let e;if(t instanceof xi)e=t.version;else{if(!(t instanceof Di))throw As();e=Ys.min()}const n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Ls(ks.ABORTED,"Document version changed between two reads.")}else this.Y_.set(t.key.toString(),e)}Wt(t){const e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?Or.updateTime(e):Or.Kt()}rf(t){const e=this.Y_.get(t.toString());if(!this.tf.has(t.toString())&&e){if(e.isEqual(Ys.min()))throw new Ls(ks.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Or.updateTime(e)}return Or.exists(!0)}write(t){this.nf(),this.mutations.push(t)}nf(){}}class Cl{constructor(t,e,n,s){this.ls=t,this.bh=e,this.updateFunction=n,this.ws=s,this.cf=5,this.ju=new Du(this.ls,"transaction_retry")}run(){this.af()}af(){this.ju.Fu(async()=>{const t=new Rl(this.bh),e=this.uf(t);e&&e.then(e=>{this.ls.Rs(()=>t.commit().then(()=>{this.ws.resolve(e)}).catch(t=>{this.hf(t)}))}).catch(t=>{this.hf(t)})})}uf(t){try{const e=this.updateFunction(t);return!ui(e)&&e.catch&&e.then?e:(this.ws.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ws.reject(t),null}}hf(t){this.cf>0&&this.lf(t)?(this.cf-=1,this.ls.Rs(()=>(this.af(),Promise.resolve()))):this.ws.reject(t)}lf(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!Jr(e)}return!1}}class Pl{constructor(t,e,n){this.credentials=t,this.ls=e,this.Pu=n,this.user=bs.UNAUTHENTICATED,this.clientId=Fs.k(),this._f=(()=>{}),this.A=new ta,this.credentials.T(t=>{_s("FirestoreClient","Received user=",t.uid),this.user=t,this._f(t),this.A.resolve()})}async getConfiguration(){return await this.A.promise,{ls:this.ls,Pu:this.Pu,clientId:this.clientId,credentials:this.credentials,Hl:this.user,yl:100}}ff(t){this._f=t,this.A.promise.then(()=>this._f(this.user))}df(){if(this.ls.wf)throw new Ls(ks.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.ls.Ef();const t=new ta;return this.ls.Tf(async()=>{try{this.If&&await this.If.terminate(),this.mf&&await this.mf.terminate(),this.credentials.I(),t.resolve()}catch(e){const n=fa(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function Ul(t,e){t.ls.Af(),_s("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.Hl;t.ff(n=>{s.isEqual(n)||(s=n,t.ls.yo(async()=>{await Kh(e.ph,n)}))}),e.persistence.Ro(()=>t.terminate()),t.mf=e}async function Vl(t,e){t.ls.Af();const n=await Ml(t);_s("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.ff(n=>t.ls.yo(()=>(async function(t,e){const n=Ds(t);n.ls.Af(),_s("RemoteStore","RemoteStore received new credentials");const s=Bu(n);n.Nh.add(3),await Vu(n),s&&n.Oh.set("Unknown"),await n.Sh.e_(e),n.Nh.delete(3),await Uu(n)})(e.Pl,n))),t.If=e}async function Ml(t){return t.mf||(_s("FirestoreClient","Using default OfflineComponentProvider"),await Ul(t,new Pc)),t.mf}async function ql(t){return t.If||(_s("FirestoreClient","Using default OnlineComponentProvider"),await Vl(t,new Mc)),t.If}function Gl(t){return Ml(t).then(t=>t.persistence)}function Fl(t){return Ml(t).then(t=>t.ph)}function jl(t){return ql(t).then(t=>t.Pl)}function $l(t){return ql(t).then(t=>t.la)}async function Bl(t){const e=await ql(t),n=e.Vl;return n.Wh=async function(t,e){const n=Rc(t);let s,i;const r=n.bl.get(e);if(r)s=r.targetId,n.gl.$a(s),i=r.view.Al();else{const t=await Wh(n.ph,or(e)),r=n.gl.$a(t.targetId);s=t.targetId,i=await wc(n,e,s,"current"===r),n.Ml&&Mu(n.Pl,t)}return i}.bind(null,e.la),n.zh=async function(t,e){const n=Ds(t),s=n.bl.get(e),i=n.vl.get(s.targetId);if(i.length>1)return n.vl.set(s.targetId,i.filter(t=>!hr(t,e))),void n.bl.delete(e);n.Ml?(n.gl.ka(s.targetId),n.gl.Sa(s.targetId)||await Xh(n.ph,s.targetId,!1).then(()=>{n.gl.Fa(s.targetId),qu(n.Pl,s.targetId),Tc(n,s.targetId)}).catch(oh)):(Tc(n,s.targetId),await Xh(n.ph,s.targetId,!0))}.bind(null,e.la),n}function Kl(t,e,n={}){const s=new ta;return t.ls.Rs(async()=>(function(t,e,n,s,i){const r=new Gc({next:r=>{e.Rs(()=>rc(t,o));const a=r.docs.has(n);!a&&r.fromCache?i.reject(new Ls(ks.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&s&&"server"===s.source?i.reject(new Ls(ks.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new ac(Zi(n.path),r,{includeMetadataChanges:!0,el:!0});return ic(t,o)})(await Bl(t),t.ls,e,n,s)),s.promise}function Yl(t,e,n={}){const s=new ta;return t.ls.Rs(async()=>(function(t,e,n,s,i){const r=new Gc({next:n=>{e.Rs(()=>rc(t,o)),n.fromCache&&"server"===s.source?i.reject(new Ls(ks.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new ac(n,r,{includeMetadataChanges:!0,el:!0});return ic(t,o)})(await Bl(t),t.ls,e,n,s)),s.promise}function zl(t,e,n,s){const i=function(t,e){let n;return function(t,e){return new Fc(t,e)}(function(t,e){if(t instanceof Uint8Array)return qc(t,e);if(t instanceof ArrayBuffer)return qc(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n="string"==typeof t?(new TextEncoder).encode(t):t),e)}(n,xu(e));t.ls.Rs(async()=>{!function(t,e,n){const s=Ds(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=Ds(t),s=Ro(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",t=>n.fo.Os(t,e.id)).then(t=>!!t&&t.createTime.L(s)>=0)}(t.ph,s))return await e.close(),void n.Bl(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s));n.ql(lc(s));const i=new cc(s,t.ph,e.Ut);let r=await e.Ul();for(;r;){const t=await i.il(r);t&&n.ql(t),r=await e.Ul()}const o=await i.complete();await Dc(t,o.jo,void 0),await function(t,e){const n=Ds(t);return n.persistence.runTransaction("Save bundle","readwrite",t=>n.fo.ks(t,e))}(t.ph,s),n.Bl(o.progress)}catch(t){Ns("SyncEngine",`Loading bundle failed with ${t}`),n.Kl(t)}})(s,e,n).then(()=>{s.gl.Qa()})}(await $l(t),i,s)})}class Hl{constructor(){this.Rf=Promise.resolve(),this.Pf=[],this.Vf=!1,this.gf=[],this.yf=null,this.pf=!1,this.bf=[],this.ju=new Du(this,"async_queue_retry"),this.vf=(()=>{const t=Au();t&&_s("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ju.Bu()});const t=Au();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.vf)}get wf(){return this.Vf}Rs(t){this.enqueue(t)}Tf(t){this.Sf(),this.Df(t)}Ef(){if(!this.Vf){this.Vf=!0;const t=Au();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vf)}}enqueue(t){return this.Sf(),this.Vf?new Promise(t=>{}):this.Df(t)}yo(t){this.Rs(()=>(this.Pf.push(t),this.Cf()))}async Cf(){if(0!==this.Pf.length){try{await this.Pf[0](),this.Pf.shift(),this.ju.reset()}catch(t){if(!oa(t))throw t;_s("AsyncQueue","Operation failed with retryable error: "+t)}this.Pf.length>0&&this.ju.Fu(()=>this.Cf())}}Df(t){const e=this.Rf.then(()=>(this.pf=!0,t().catch(t=>{throw this.yf=t,this.pf=!1,Ts("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.pf=!1,t))));return this.Rf=e,e}Er(t,e,n){this.Sf(),this.bf.indexOf(t)>-1&&(e=0);const s=la.Es(this,t,e,n,t=>this.Nf(t));return this.gf.push(s),s}Sf(){this.yf&&As()}Af(){}async xf(){let t;do{t=this.Rf,await t}while(t!==this.Rf)}$f(t){for(const e of this.gf)if(e._s===t)return!0;return!1}Of(t){return this.xf().then(()=>{this.gf.sort((t,e)=>t.fs-e.fs);for(const e of this.gf)if(e.As(),"all"!==t&&e._s===t)break;return this.xf()})}kf(t){this.bf.push(t)}Nf(t){const e=this.gf.indexOf(t);this.gf.splice(e,1)}}function Wl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Xl{constructor(){this.Mf={},this.Ff=new ta,this.Lf={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this.Mf={next:t,error:e,complete:n}}catch(t){return this.Ff.promise.catch(t)}then(t,e){return this.Ff.promise.then(t,e)}Bl(t){this.ql(t),this.Mf.complete&&this.Mf.complete(),this.Ff.resolve(t)}Kl(t){this.Lf.taskState="Error",this.Mf.next&&this.Mf.next(this.Lf),this.Mf.error&&this.Mf.error(t),this.Ff.reject(t)}ql(t){this.Lf=t,this.Mf.next&&this.Mf.next(t)}}class Jl extends tl{constructor(t,e){super(t,e),this.Bf=new Hl,this.w_="name"in t?t.name:"[DEFAULT]"}b_(){return this.qf||Zl(this),this.qf.terminate()}}function Ql(t){return t.qf||Zl(t),t.qf.df(),t.qf}function Zl(t){const e=t.p_(),n=function(t,e,n){return new Vs(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.I_,t.w_,e);t.qf=new Pl(t.m_,t.Bf,n)}function tf(t,e,n){const s=new ta;return t.ls.enqueue(async()=>{try{await Ul(t,n),await Vl(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===ks.FAILED_PRECONDITION||t.code===ks.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}}).then(()=>s.promise)}function ef(t){if(t.R_||t.P_)throw new Ls(ks.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class nf{Uf(t,e="none"){switch(fi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ri(t.integerValue||t.doubleValue);case 3:return this.Kf(t.timestampValue);case 4:return this.Qf(t,e);case 5:return t.stringValue;case 6:return this.Wf(oi(t.bytesValue));case 7:return this.jf(t.referenceValue);case 8:return this.Gf(t.geoPointValue);case 9:return this.zf(t.arrayValue,e);case 10:return this.Hf(t.mapValue,e);default:throw As()}}Hf(t,e){const n={};return Zs(t.fields||{},(t,s)=>{n[t]=this.Uf(s,e)}),n}Gf(t){return new ol(ri(t.latitude),ri(t.longitude))}zf(t,e){return(t.values||[]).map(t=>this.Uf(t,e))}Qf(t,e){switch(e){case"previous":const n=function t(e){const n=e.mapValue.fields.__previous_value__;return ai(n)?t(n):n}(t);return null==n?null:this.Uf(n,e);case"estimate":return this.Kf(hi(t));default:return null}}Kf(t){const e=ii(t);return new Ks(e.seconds,e.nanos)}Jf(t,e){const n=Hs.nt(t);xs(Zo(n));const s=new Ms(n.get(1),n.get(3)),i=new Js(n.j(5));return s.isEqual(e)||Ts(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class sf{constructor(t,e,n,s,i){this.Yf=t,this.Xf=e,this.S_=n,this.Zf=s,this.v_=i}get id(){return this.S_.path.J()}get ref(){return new el(this.Yf,this.v_,this.S_)}exists(){return null!==this.Zf}data(){if(this.Zf){if(this.v_){const t=new rf(this.Yf,this.Xf,this.S_,this.Zf,null);return this.v_.fromFirestore(t)}return this.Xf.Uf(this.Zf.yt())}}get(t){if(this.Zf){const e=this.Zf.data().field(of("DocumentSnapshot.get",t));if(null!==e)return this.Xf.Uf(e)}}}class rf extends sf{data(){return super.data()}}function of(t,e){return"string"==typeof e?kl(t,e):e instanceof Kc?e.d_.f_:e.f_}class af{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class hf extends sf{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this.Yf=t,this.td=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this.Zf){if(this.v_){const e=new uf(this.Yf,this.Xf,this.S_,this.Zf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Xf.Uf(this.Zf.yt(),t.serverTimestamps)}}get(t,e={}){if(this.Zf){const n=this.Zf.data().field(of("DocumentSnapshot.get",t));if(null!==n)return this.Xf.Uf(n,e.serverTimestamps)}}}class uf extends hf{data(t={}){return super.data(t)}}class cf{constructor(t,e,n,s){this.Yf=t,this.Xf=e,this.ed=s,this.metadata=new af(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.ed.docs.size}get empty(){return 0===this.size}forEach(t,e){this.ed.docs.forEach(n=>{t.call(e,new uf(this.Yf,this.Xf,n.key,n,new af(this.ed.Se.has(n.key),this.ed.fromCache),this.query.v_))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.ed.Ce)throw new Ls(ks.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.nd&&this.sd===e||(this.nd=function(t,e){if(t.ed.ve.Y()){let e,n=0;return t.ed.docChanges.map(s=>{const i=new uf(t.Yf,t.Xf,s.doc.key,s.doc,new af(t.ed.Se.has(s.doc.key),t.ed.fromCache),t.query.v_);return e=s.doc,{type:"added",doc:i,oldIndex:-1,newIndex:n++}})}{let n=t.ed.ve;return t.ed.docChanges.filter(t=>e||3!==t.type).map(e=>{const s=new uf(t.Yf,t.Xf,e.doc.key,e.doc,new af(t.ed.Se.has(e.doc.key),t.ed.fromCache),t.query.v_);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(r=(n=n.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return As()}}(e.type),doc:s,oldIndex:i,newIndex:r}})}}(this,e),this.sd=e),this.nd}}function lf(t){if(er(t)&&0===t.Ct.length)throw new Ls(ks.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ff{}class df extends ff{constructor(t,e,n){super(),this.od=t,this.ad=e,this.ud=n,this.type="where"}rd(t){const e=dl(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.rt()){if("array-contains"===r||"array-contains-any"===r)throw new Ls(ks.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){bf(o,r);const e=[];for(const n of o)e.push(vf(s,t,n));a={arrayValue:{values:e}}}else a=vf(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||bf(o,r),a=_l(n,"where",o,"in"===r||"not-in"===r);const h=Ui.create(i,r,a);return function(t,e){if(e.Dt()){const n=sr(t);if(null!==n&&!n.isEqual(e.field))throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=nr(t);null!==s&&Ef(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new Ls(ks.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ls(ks.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,h),h}(t.C_,0,e,t.firestore.I_,this.od,this.ad,this.ud);return new nl(t.firestore,t.v_,function(t,e){const n=t.filters.concat([e]);return new Ji(t.path,t.collectionGroup,t.Ct.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,n))}}class pf extends ff{constructor(t,e){super(),this.od=t,this.hd=e,this.type="orderBy"}rd(t){const e=function(t,e,n){if(null!==t.startAt)throw new Ls(ks.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Ls(ks.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new zi(e,n);return function(t,e){if(null===nr(t)){const n=sr(t);null!==n&&Ef(t,n,e.field)}}(t,s),s}(t.C_,this.od,this.hd);return new nl(t.firestore,t.v_,function(t,e){const n=t.Ct.concat([e]);return new Ji(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,e))}}class gf extends ff{constructor(t,e,n){super(),this.type=t,this.ld=e,this._d=n}rd(t){return new nl(t.firestore,t.v_,ar(t.C_,this.ld,this._d))}}class mf extends ff{constructor(t,e,n){super(),this.type=t,this.fd=e,this.dd=n}rd(t){const e=wf(t,this.type,this.fd,this.dd);return new nl(t.firestore,t.v_,function(t,e){return new Ji(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.C_,e))}}class yf extends ff{constructor(t,e,n){super(),this.type=t,this.fd=e,this.dd=n}rd(t){const e=wf(t,this.type,this.fd,this.dd);return new nl(t.firestore,t.v_,function(t,e){return new Ji(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.C_,e))}}function wf(t,e,n,s){if(n[0]instanceof Kc&&(n[0]=n[0].d_),n[0]instanceof sf)return function(t,e,n,s,i){if(!s)throw new Ls(ks.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of rr(t))if(n.field.rt())r.push(wi(e,s.key));else{const t=s.field(n.field);if(ai(t))throw new Ls(ks.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.et();throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new Ki(r,i)}(t.C_,t.firestore.I_,e,n[0].Zf,s);{const i=dl(t.firestore);return function(t,e,n,s,i,r){const o=t.Ct;if(i.length>o.length)throw new Ls(ks.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let r=0;r<i.length;r++){const h=i[r];if(o[r].field.rt()){if("string"!=typeof h)throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!ir(t)&&-1!==h.indexOf("/"))throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const n=t.path.child(Hs.nt(h));if(!Js.lt(n))throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Js(n);a.push(wi(e,i))}else{const t=_l(n,s,h);a.push(t)}}return new Ki(a,r)}(t.C_,t.firestore.I_,i,e,n,s)}}function vf(t,e,n){if(n instanceof Kc&&(n=n.d_),"string"==typeof n){if(""===n)throw new Ls(ks.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ir(e)&&-1!==n.indexOf("/"))throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Hs.nt(n));if(!Js.lt(s))throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return wi(t,new Js(s))}if(n instanceof el)return wi(t,n.S_);throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wc(n)}.`)}function bf(t,e){if(!Array.isArray(t)||0===t.length)throw new Ls(ks.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Ls(ks.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Ef(t,e,n){if(!n.isEqual(e))throw new Ls(ks.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function If(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class _f extends nf{constructor(t){super(),this.firestore=t}Wf(t){return new jc(t)}jf(t){const e=this.Jf(t,this.firestore.I_);return new el(this.firestore,null,e)}}class Tf{constructor(t,e){this.Yf=t,this.wd=e,this.Ed=[],this.Td=!1,this.Id=dl(t)}set(t,e,n){this.md();const s=Nf(t,this.Yf),i=If(s.v_,e,n),r=pl(this.Id,"WriteBatch.set",s.S_,i,null!==s.v_,n);return this.Ed.push(r.O_(s.S_,Or.Kt())),this}update(t,e,n,...s){this.md();const i=Nf(t,this.Yf);let r;return e instanceof Kc&&(e=e.d_),r="string"==typeof e||e instanceof $c?Il(this.Id,"WriteBatch.update",i.S_,e,n,s):El(this.Id,"WriteBatch.update",i.S_,e),this.Ed.push(r.O_(i.S_,Or.exists(!0))),this}delete(t){this.md();const e=Nf(t,this.Yf);return this.Ed=this.Ed.concat(new Yr(e.S_,Or.Kt())),this}commit(){return this.md(),this.Td=!0,this.Ed.length>0?this.wd(this.Ed):Promise.resolve()}md(){if(this.Td)throw new Ls(ks.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Nf(t,e){if(t instanceof Kc&&(t=t.d_),t.firestore!==e)throw new Ls(ks.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class Sf extends nf{constructor(t){super(),this.firestore=t}Wf(t){return new jc(t)}jf(t){const e=this.Jf(t,this.firestore.I_);return new el(this.firestore,null,e)}}function Af(t,e){return function(t,e){const n=new ta;return t.ls.Rs(async()=>(async function(t,e,n){const s=Cc(t);try{const i=await function(t,e){const n=Ds(t),s=Ks.now(),i=e.reduce((t,e)=>t.add(e.key),fo());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.Ec.Yo(t,i).next(i=>{r=i;const o=[];for(const t of e){const e=Vr(t,r.get(t.key));null!=e&&o.push(new Fr(t.key,e,Si(e.proto.mapValue),Or.exists(!0)))}return n.Go.Ai(t,s,o,e)})).then(t=>{const e=t.Cs(r);return{batchId:t.batchId,ii:e}})}(s.ph,e);s.gl.Da(i.batchId),function(t,e,n){let s=t.xl[t.currentUser.i()];s||(s=new Zr(js)),s=s.Gt(e,n),t.xl[t.currentUser.i()]=s}(s,i.batchId,n),await Dc(s,i.ii),await Hu(s.Pl)}catch(t){const e=fa(t,"Failed to persist write");n.reject(e)}})(await $l(t),e,n)),n.promise}(Ql(t),e)}function xf(t,e,n){const s=n.docs.get(e.S_),i=new Sf(t);return new hf(t,i,e.S_,s,new af(n.hasPendingWrites,n.fromCache),e.v_)}class Df extends class{constructor(t,e){this.Yf=t,this.Ad=e,this.Id=dl(t)}get(t){const e=Nf(t,this.Yf),n=new _f(this.Yf);return this.Ad.ef([e.S_]).then(t=>{if(!t||1!==t.length)return As();const s=t[0];if(s instanceof Di)return new sf(this.Yf,n,e.S_,null,e.v_);if(s instanceof xi)return new sf(this.Yf,n,s.key,s,e.v_);throw As()})}set(t,e,n){const s=Nf(t,this.Yf),i=If(s.v_,e,n),r=pl(this.Id,"Transaction.set",s.S_,i,null!==s.v_,n);return this.Ad.set(s.S_,r),this}update(t,e,n,...s){const i=Nf(t,this.Yf);let r;return e instanceof Kc&&(e=e.d_),r="string"==typeof e||e instanceof $c?Il(this.Id,"Transaction.update",i.S_,e,n,s):El(this.Id,"Transaction.update",i.S_,e),this.Ad.update(i.S_,r),this}delete(t){const e=Nf(t,this.Yf);return this.Ad.delete(e.S_),this}}{constructor(t,e){super(t,e),this.Yf=t}get(t){const e=Nf(t,this.Yf),n=new Sf(this.Yf);return super.get(t).then(t=>new hf(this.Yf,n,e.S_,t.Zf,new af(!1,!1),e.v_))}}e._registerComponent(new c("firestore-exp",t=>((t,e)=>new Jl(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.900","node"),t.Bytes=jc,t.CACHE_SIZE_UNLIMITED=-1,t.CollectionReference=sl,t.DocumentReference=el,t.DocumentSnapshot=hf,t.FieldPath=$c,t.FieldValue=Bc,t.FirebaseFirestore=Jl,t.FirestoreError=Ls,t.GeoPoint=ol,t.LoadBundleTask=Xl,t.Query=nl,t.QueryConstraint=ff,t.QueryDocumentSnapshot=uf,t.QuerySnapshot=cf,t.SnapshotMetadata=af,t.Timestamp=Ks,t.Transaction=Df,t.WriteBatch=Tf,t.addDoc=function(t,e){const n=Xc(t.firestore,Jl),s=il(t),i=If(t.v_,e);return Af(n,[pl(dl(t.firestore),"addDoc",s.S_,i,null!==t.v_,{}).O_(s.S_,Or.exists(!1))]).then(()=>s)},t.arrayRemove=function(...t){return new vl("arrayRemove",t)},t.arrayUnion=function(...t){return new wl("arrayUnion",t)},t.clearIndexedDbPersistence=function(t){if(t.R_&&!t.P_)throw new Ls(ks.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ta;return t.Bf.Tf(async()=>{try{await async function(t){if(!sa.Kn())return Promise.resolve();const e=t+"main";await sa.delete(e)}(Mh(t.I_,t.w_)),e.resolve()}catch(t){e.reject(t)}}),e.promise},t.collection=function(t,e,...n){if(t instanceof Kc&&(t=t.d_),Yc("collection","path",e),t instanceof tl){const s=Hs.nt(e,...n);return Hc(s),new sl(t,null,s)}{if(!(t instanceof el||t instanceof sl))throw new Ls(ks.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=Hs.nt(t.path,...n).child(Hs.nt(e));return Hc(s),new sl(t.firestore,null,s)}},t.collectionGroup=function(t,e){if(t=Xc(t,tl),Yc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ls(ks.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new nl(t,null,function(t){return new Ji(Hs.st(),t)}(e))},t.deleteDoc=function(t){return Af(Xc(t.firestore,Jl),[new Yr(t.S_,Or.Kt())])},t.deleteField=function(){return new gl("deleteField")},t.disableNetwork=function(t){return function(t){return t.ls.enqueue(async()=>{const e=await Gl(t),n=await jl(t);return e.Po(!1),async function(t){const e=Ds(n);e.Nh.add(0),await Vu(e),e.Oh.set("Offline")}()})}(Ql(t=Xc(t,Jl)))},t.doc=il,t.documentId=function(){return new $c("__name__")},t.enableIndexedDbPersistence=function(t,e){ef(t=Xc(t,Jl));const n=Ql(t),s=t.p_(),i=new Mc;return tf(n,i,new Uc(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))},t.enableMultiTabIndexedDbPersistence=function(t){ef(t=Xc(t,Jl));const e=Ql(t),n=t.p_(),s=new Mc;return tf(e,s,new Vc(s,n.cacheSizeBytes))},t.enableNetwork=function(t){return function(t){return t.ls.enqueue(async()=>{const e=await Gl(t),n=await jl(t);return e.Po(!0),function(t){const e=Ds(n);return e.Nh.delete(0),Uu(e)}()})}(Ql(t=Xc(t,Jl)))},t.endAt=function(...t){return new yf("endAt",t,!1)},t.endBefore=function(...t){return new yf("endBefore",t,!0)},t.getDoc=function(t){const e=Xc((t=Xc(t,el)).firestore,Jl);return Kl(Ql(e),t.S_).then(n=>xf(e,t,n))},t.getDocFromCache=function(t){const e=Xc((t=Xc(t,el)).firestore,Jl),n=Ql(e),s=new Sf(e);return function(t,e){const n=new ta;return t.ls.Rs(async()=>(async function(t,e,n){try{const s=await function(t,e){const n=Ds(t);return n.persistence.runTransaction("read document","readonly",t=>n.Ec.zo(t,e))}(t,e);s instanceof xi?n.resolve(s):s instanceof Di?n.resolve(null):n.reject(new Ls(ks.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=fa(t,`Failed to get document '${e} from cache`);n.reject(s)}})(await Fl(t),e,n)),n.promise}(n,t.S_).then(n=>new hf(e,s,t.S_,n,new af(n instanceof xi&&n.gt,!0),t.v_))},t.getDocFromServer=function(t){const e=Xc((t=Xc(t,el)).firestore,Jl);return Kl(Ql(e),t.S_,{source:"server"}).then(n=>xf(e,t,n))},t.getDocs=function(t){const e=Xc((t=Xc(t,nl)).firestore,Jl),n=Ql(e),s=new Sf(e);return lf(t.C_),Yl(n,t.C_).then(n=>new cf(e,s,t,n))},t.getDocsFromCache=function(t){const e=Xc((t=Xc(t,nl)).firestore,Jl),n=Ql(e),s=new Sf(e);return function(t,e){const n=new ta;return t.ls.Rs(async()=>(async function(t,e,n){try{const s=await Jh(t,e,!0),i=new pc(e,s.Ac),r=i._l(s.documents),o=i.di(r,!1);n.resolve(o.snapshot)}catch(t){const s=fa(t,`Failed to execute query '${e} against cache`);n.reject(s)}})(await Fl(t),e,n)),n.promise}(n,t.C_).then(n=>new cf(e,s,t,n))},t.getDocsFromServer=function(t){const e=Xc((t=Xc(t,nl)).firestore,Jl),n=Ql(e),s=new Sf(e);return Yl(n,t.C_,{source:"server"}).then(n=>new cf(e,s,t,n))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new bl("increment",t)},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp");if(s.isInitialized())throw new Ls(ks.FAILED_PRECONDITION,"Firestore can only be initialized once per app.");const i=s.getImmediate();if(void 0!==n.cacheSizeBytes&&-1!==n.cacheSizeBytes&&n.cacheSizeBytes<1048576)throw new Ls(ks.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return i.g_(n),i},t.limit=function(t){return Jc("limit",t),new gf("limit",t,"F")},t.limitToLast=function(t){return Jc("limitToLast",t),new gf("limitToLast",t,"L")},t.loadBundle=function(t,e){const n=Ql(t=Xc(t,Jl)),s=new Xl;return zl(n,t.I_,e,s),s},t.namedQuery=function(t,e){return function(t,e){return t.ls.enqueue(async()=>(function(t,e){const n=Ds(t);return n.persistence.runTransaction("Get named query","readonly",t=>n.fo.Ms(t,e))})(await Fl(t),e))}(Ql(t=Xc(t,Jl)),e).then(e=>e?new nl(t,null,e.query):null)},t.onSnapshot=function(t,...e){var n,s,i;t instanceof Kc&&(t=t.d_);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Wl(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(Wl(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let h,u,c;if(t instanceof el)u=Xc(t.firestore,Jl),c=Zi(t.S_.path),h={next:n=>{e[o]&&e[o](xf(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Xc(t,nl);u=Xc(n.firestore,Jl),c=n.C_;const s=new Sf(u);h={next:t=>{e[o]&&e[o](new cf(u,s,n,t))},error:e[o+1],complete:e[o+2]},lf(t.C_)}return function(t,e,n,s){const i=new Gc(h),r=new ac(e,i,n);return t.ls.Rs(async()=>ic(await Bl(t),r)),()=>{i.s_(),t.ls.Rs(async()=>rc(await Bl(t),r))}}(Ql(u),c,a)},t.onSnapshotsInSync=function(t,e){return function(t,e){const n=new Gc(e);return t.ls.Rs(async()=>(function(t,e){Ds(t).Qh.add(e),e.next()})(await Bl(t),n)),()=>{n.s_(),t.ls.Rs(async()=>(function(t,e){Ds(t).Qh.delete(e)})(await Bl(t),n))}}(Ql(t=Xc(t,Jl)),Wl(e)?e:{next:e})},t.orderBy=function(t,e="asc"){const n=e,s=of("orderBy",t);return new pf(s,n)},t.query=function(t,...e){for(const n of e)t=n.rd(t);return t},t.queryEqual=rl,t.refEqual=function(t,e){return t instanceof Kc&&(t=t.d_),e instanceof Kc&&(e=e.d_),(t instanceof el||t instanceof sl)&&(e instanceof el||e instanceof sl)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_},t.runTransaction=function(t,e){return function(t,e){const n=new ta;return t.ls.Rs(async()=>{const s=await function(t){return ql(t).then(t=>t.bh)}(t);new Cl(t.ls,s,e,n).run()}),n.promise}(Ql(t),n=>e(new Df(t,n)))},t.serverTimestamp=function(){return new yl("serverTimestamp")},t.setDoc=function(t,e,n){const s=Xc((t=Xc(t,el)).firestore,Jl),i=If(t.v_,e,n);return Af(s,[pl(dl(s),"setDoc",t.S_,i,null!==t.v_,n).O_(t.S_,Or.Kt())])},t.setLogLevel=function(t){Es.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof hf&&e instanceof hf?t.Yf===e.Yf&&t.S_.isEqual(e.S_)&&(null===t.Zf?null===e.Zf:t.Zf.isEqual(e.Zf))&&t.v_===e.v_:t instanceof cf&&e instanceof cf&&t.Yf===e.Yf&&rl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.ed.isEqual(e.ed)},t.startAfter=function(...t){return new mf("startAfter",t,!1)},t.startAt=function(...t){return new mf("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),t._delete()},t.updateDoc=function(t,e,n,...s){const i=Xc((t=Xc(t,el)).firestore,Jl),r=dl(i);let o;return e instanceof Kc&&(e=e.d_),Af(i,[(o="string"==typeof e||e instanceof $c?Il(r,"updateDoc",t.S_,e,n,s):El(r,"updateDoc",t.S_,e)).O_(t.S_,Or.exists(!0))])},t.useFirestoreEmulator=function(t,e,n){const s=(t=Xc(t,tl)).y_();"firestore.googleapis.com"!==s.host&&s.host!==e&&Ns("Host has been set in both settings() and useEmulator(), emulator host will be used"),t.g_(Object.assign(Object.assign({},s),{host:`${e}:${n}`,ssl:!1}))},t.waitForPendingWrites=function(t){return function(t){const e=new ta;return t.ls.Rs(async()=>(async function(t,e){const n=Ds(t);Bu(n.Pl)||_s("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await function(t){const e=Ds(n.ph);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.Go.gi(t))}();if(-1===s)return void e.resolve();const i=n.$l.get(s)||[];i.push(e),n.$l.set(s,i)}catch(t){const n=fa(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(await $l(t),e)),e.promise}(Ql(t=Xc(t,Jl)))},t.where=function(t,e,n){const s=e,i=of("where",t);return new df(i,s,n)},t.writeBatch=function(t){return Ql(t=Xc(t,Jl)),new Tf(t,e=>Af(t,e))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});