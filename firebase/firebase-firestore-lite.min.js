!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase["firestore-lite"]=t.firebase["firestore-lite"]||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var s="FirebaseError",r=function(t){function e(n,r,o){var a=t.call(this,r)||this;return a.code=n,a.customData=o,a.name=s,Object.setPrototypeOf(a,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,i.prototype.create),a}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),i=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",c=this.serviceName+": "+a+" ("+i+").";return new r(i,c,s)},t}();var o,a,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,r++)s[r]=i[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(a||(a={}));var h={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},f=a.INFO,d=((o={})[a.DEBUG]="log",o[a.VERBOSE]="log",o[a.INFO]="info",o[a.WARN]="warn",o[a.ERROR]="error",o),p=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var r=(new Date).toISOString(),i=d[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,l(["["+r+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=f,this._logHandler=p,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in a))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?h[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,a.DEBUG],t)),this._logHandler.apply(this,l([this,a.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,a.VERBOSE],t)),this._logHandler.apply(this,l([this,a.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,a.INFO],t)),this._logHandler.apply(this,l([this,a.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,a.WARN],t)),this._logHandler.apply(this,l([this,a.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,a.ERROR],t)),this._logHandler.apply(this,l([this,a.ERROR],t))},t}();class g{constructor(t){this.uid=t}t(){return null!=this.uid}i(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}g.UNAUTHENTICATED=new g(null),g.o=new g("google-credentials-uid"),g.u=new g("first-party-uid");const w=new m("@firebase/firestore");function y(t,...e){if(w.logLevel<=a.DEBUG){const n=e.map(E);w.debug(`Firestore (8.2.9): ${t}`,...n)}}function v(t,...e){if(w.logLevel<=a.ERROR){const n=e.map(E);w.error(`Firestore (8.2.9): ${t}`,...n)}}function b(t,...e){if(w.logLevel<=a.WARN){const n=e.map(E);w.warn(`Firestore (8.2.9): ${t}`,...n)}}function E(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function A(t="Unexpected state"){const e="FIRESTORE (8.2.9) INTERNAL ASSERTION FAILED: "+t;throw v(e),new Error(e)}function T(t,e){t||A()}function S(t,e){return t}const V="ok",N="cancelled",I="unknown",_="invalid-argument",x="deadline-exceeded",D="not-found",O="already-exists",L="permission-denied",P="unauthenticated",R="resource-exhausted",q="failed-precondition",B="aborted",$="out-of-range",F="unimplemented",U="internal",C="unavailable",k="data-loss";class j extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class M{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization=`Bearer ${t}`}}class G{constructor(){this.l=null}getToken(){return Promise.resolve(null)}_(){}m(t){this.l=t,t(g.UNAUTHENTICATED)}p(){this.l=null}}class H{constructor(t){this.I=null,this.currentUser=g.UNAUTHENTICATED,this.T=!1,this.A=0,this.l=null,this.forceRefresh=!1,this.I=(()=>{this.A++,this.currentUser=this.P(),this.T=!0,this.l&&this.l(this.currentUser)}),this.A=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(t=>{this.auth=t,this.I&&this.auth.addAuthTokenListener(this.I)},()=>{}))}getToken(){const t=this.A,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.A!==t?(y("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(T("string"==typeof e.accessToken),new M(e.accessToken,this.currentUser)):null):Promise.resolve(null)}_(){this.forceRefresh=!0}m(t){this.l=t,this.T&&t(this.currentUser)}p(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.l=null}P(){const t=this.auth&&this.auth.getUid();return T(null===t||"string"==typeof t),new g(t)}}class z{constructor(t,e){this.R=t,this.V=e,this.type="FirstParty",this.user=g.u}get h(){const t={"X-Goog-AuthUser":this.V},e=this.R.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t}}class Q{constructor(t,e){this.R=t,this.V=e}getToken(){return Promise.resolve(new z(this.R,this.V))}m(t){t(g.u)}p(){}_(){}}class Y{constructor(t,e,n,s,r,i){this.g=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=r,this.v=i}}class W{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get N(){return"(default)"===this.database}isEqual(t){return t instanceof W&&t.projectId===this.projectId&&t.database===this.database}}class K{constructor(t,e,n){void 0===e?e=0:e>t.length&&A(),void 0===n?n=t.length-e:n>t.length-e&&A(),this.segments=t,this.offset=e,this.$=n}get length(){return this.$}isEqual(t){return 0===K.D(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof K?t.forEach(t=>{e.push(t)}):e.push(t),this.F(e)}limit(){return this.offset+this.length}S(t){return t=void 0===t?1:t,this.F(this.segments,this.offset+t,this.length-t)}q(){return this.F(this.segments,this.offset,this.length-1)}O(){return this.segments[this.offset]}C(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}L(){return 0===this.length}U(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}j(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}M(){return this.segments.slice(this.offset,this.limit())}static D(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),r=e.get(s);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Z extends K{F(t,e,n){return new Z(t,e,n)}B(){return this.M().join("/")}toString(){return this.B()}static k(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new j(_,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new Z(e)}static W(){return new Z([])}}const X=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class J extends K{F(t,e,n){return new J(t,e,n)}static G(t){return X.test(t)}B(){return this.M().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),J.G(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.B()}Y(){return 1===this.length&&"__name__"===this.get(0)}static H(){return new J(["__name__"])}static K(t){const e=[];let n="",s=0;const r=()=>{if(0===n.length)throw new j(_,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new j(_,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new j(_,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(i=!i,s++):"."!==e||i?(n+=e,s++):(r(),s++)}if(r(),i)throw new j(_,"Unterminated ` in path: "+t);return new J(e)}static W(){return new J([])}}class tt{constructor(t){this.path=t}static J(t){return new tt(Z.k(t))}static Z(t){return new tt(Z.k(t).S(5))}X(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Z.D(this.path,t.path)}toString(){return this.path.toString()}static D(t,e){return Z.D(t.path,e.path)}static tt(t){return t.length%2==0}static nt(t){return new tt(new Z(t.slice()))}}function et(t,e,n){if(!n)throw new j(_,`Function ${t}() cannot be called with an empty ${e}.`)}function nt(t){if(!tt.tt(t))throw new j(_,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function st(t){if(tt.tt(t))throw new j(_,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function rt(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":A()}function it(t,e){if("_delegate"in t&&(t=t.et),!(t instanceof e)){if(e.name===t.constructor.name)throw new j(_,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=rt(t);throw new j(_,`Expected type '${e.name}', but it was: ${n}`)}}return t}function ot(t,e){if(e<=0)throw new j(_,`Function ${t}() requires a positive number, but it was: ${e}.`)}function at(t){return null==t}function ut(t){return 0===t&&1/t==-1/0}const ct={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};var lt,ht;function ft(t){if(void 0===t)return v("RPC_ERROR","HTTP error has no status"),I;switch(t){case 200:return V;case 400:return q;case 401:return P;case 403:return L;case 404:return D;case 409:return B;case 416:return $;case 429:return R;case 499:return N;case 500:return I;case 501:return F;case 503:return C;case 504:return x;default:return t>=200&&t<300?V:t>=400&&t<500?q:t>=500&&t<600?U:I}}(ht=lt||(lt={}))[ht.OK=0]="OK",ht[ht.CANCELLED=1]="CANCELLED",ht[ht.UNKNOWN=2]="UNKNOWN",ht[ht.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ht[ht.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ht[ht.NOT_FOUND=5]="NOT_FOUND",ht[ht.ALREADY_EXISTS=6]="ALREADY_EXISTS",ht[ht.PERMISSION_DENIED=7]="PERMISSION_DENIED",ht[ht.UNAUTHENTICATED=16]="UNAUTHENTICATED",ht[ht.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ht[ht.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ht[ht.ABORTED=10]="ABORTED",ht[ht.OUT_OF_RANGE=11]="OUT_OF_RANGE",ht[ht.UNIMPLEMENTED=12]="UNIMPLEMENTED",ht[ht.INTERNAL=13]="INTERNAL",ht[ht.UNAVAILABLE=14]="UNAVAILABLE",ht[ht.DATA_LOSS=15]="DATA_LOSS";class dt extends class{constructor(t){this.st=t,this.g=t.g;const e=t.ssl?"https":"http";this.rt=e+"://"+t.host,this.it="projects/"+this.g.projectId+"/databases/"+this.g.database+"/documents"}ot(t,e,n,s){const r=this.ut(t,e);y("RestConnection","Sending: ",r,n);const i={};return this.ct(i,s),this.at(t,r,i,n).then(t=>(y("RestConnection","Received: ",t),t),e=>{throw b("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e})}ht(t,e,n,s){return this.ot(t,e,n,s)}ct(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.9",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}ut(t,e){const n=ct[t];return`${this.rt}/v1/${e}:${n}`}}{constructor(t,e){super(t),this.lt=e}ft(t,e){throw new Error("Not supported by FetchConnection")}async at(t,e,n,s){const r=JSON.stringify(s);let i;try{i=await this.lt(e,{method:"POST",headers:n,body:r})}catch(t){throw new j(ft(t.status),"Request failed with error: "+t.statusText)}if(!i.ok)throw new j(ft(i.status),"Request failed with error: "+i.statusText);return i.json()}}class pt{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}function mt(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class gt{static dt(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=mt(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<e&&(n+=t.charAt(s[r]%t.length))}return n}}function wt(t,e){return t<e?-1:t>e?1:0}function yt(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}class vt{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new j(_,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new j(_,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new j(_,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new j(_,"Timestamp seconds out of range: "+t)}static now(){return vt.fromMillis(Date.now())}static fromDate(t){return vt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new vt(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_t(t){return this.seconds===t.seconds?wt(this.nanoseconds,t.nanoseconds):wt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class bt{constructor(t){this.timestamp=t}static wt(t){return new bt(t)}static min(){return new bt(new vt(0,0))}yt(t){return this.timestamp._t(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}Et(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}It(){return this.timestamp}}function Et(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function At(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class Tt{constructor(t){this.fields=t,t.sort(J.D)}Tt(t){for(const e of this.fields)if(e.U(t))return!0;return!1}isEqual(t){return yt(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class St{constructor(t){this.At=t}static fromBase64String(t){const e=atob(t);return new St(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new St(e)}toBase64(){return t=this.At,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.At)}Pt(){return 2*this.At.length}yt(t){return wt(this.At,t.At)}isEqual(t){return this.At===t.At}}St.Rt=new St("");const Vt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nt(t){if(T(!!t),"string"==typeof t){let e=0;const n=Vt.exec(t);if(T(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:It(t.seconds),nanos:It(t.nanos)}}function It(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function _t(t){return"string"==typeof t?St.fromBase64String(t):St.fromUint8Array(t)}function xt(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Dt(t){const e=Nt(t.mapValue.fields.__local_write_time__.timestampValue);return new vt(e.seconds,e.nanos)}function Ot(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?xt(t)?4:10:A()}function Lt(t,e){const n=Ot(t);if(n!==Ot(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Dt(t).isEqual(Dt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Nt(t.timestampValue),s=Nt(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return _t(t.bytesValue).isEqual(_t(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return It(t.geoPointValue.latitude)===It(e.geoPointValue.latitude)&&It(t.geoPointValue.longitude)===It(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return It(t.integerValue)===It(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=It(t.doubleValue),s=It(e.doubleValue);return n===s?ut(n)===ut(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return yt(t.arrayValue.values||[],e.arrayValue.values||[],Lt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Et(n)!==Et(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Lt(n[t],s[t])))return!1;return!0}(t,e);default:return A()}}function Pt(t,e){return void 0!==(t.values||[]).find(t=>Lt(t,e))}function Rt(t,e){const n=Ot(t),s=Ot(e);if(n!==s)return wt(n,s);switch(n){case 0:return 0;case 1:return wt(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=It(t.integerValue||t.doubleValue),s=It(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return qt(t.timestampValue,e.timestampValue);case 4:return qt(Dt(t),Dt(e));case 5:return wt(t.stringValue,e.stringValue);case 6:return function(t,e){const n=_t(t),s=_t(e);return n.yt(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=wt(n[t],s[t]);if(0!==e)return e}return wt(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=wt(It(t.latitude),It(e.latitude));return 0!==n?n:wt(It(t.longitude),It(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Rt(n[t],s[t]);if(e)return e}return wt(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),r=e.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let t=0;t<s.length&&t<i.length;++t){const e=wt(s[t],i[t]);if(0!==e)return e;const o=Rt(n[s[t]],r[i[t]]);if(0!==o)return o}return wt(s.length,i.length)}(t.mapValue,e.mapValue);default:throw A()}}function qt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return wt(t,e);const n=Nt(t),s=Nt(e),r=wt(n.seconds,s.seconds);return 0!==r?r:wt(n.nanos,s.nanos)}function Bt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.B()}`}}function $t(t){return!!t&&"arrayValue"in t}function Ft(t){return!!t&&"nullValue"in t}function Ut(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ct(t){return!!t&&"mapValue"in t}class kt{constructor(t){this.proto=t}static empty(){return new kt({mapValue:{}})}field(t){if(t.L())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ct(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.C()])||null}}isEqual(t){return Lt(this.proto,t.proto)}}class jt{constructor(t=kt.empty()){this.Vt=t,this.gt=new Map}set(t,e){return this.bt(t,e),this}delete(t){return this.bt(t,null),this}bt(t,e){let n=this.gt;for(let e=0;e<t.length-1;++e){const s=t.get(e);let r=n.get(s);r instanceof Map?n=r:r&&10===Ot(r)?(r=new Map(Object.entries(r.mapValue.fields||{})),n.set(s,r),n=r):(r=new Map,n.set(s,r),n=r)}n.set(t.C(),e)}vt(){const t=this.Nt(J.W(),this.gt);return null!=t?new kt(t):this.Vt}Nt(t,e){let n=!1;const s=this.Vt.field(t),r=Ct(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const i=this.Nt(t.child(s),e);null!=i&&(r[s]=i,n=!0)}else null!==e?(r[s]=e,n=!0):r.hasOwnProperty(s)&&(delete r[s],n=!0)}),n?{mapValue:{fields:r}}:null}}class Mt{constructor(t,e){this.key=t,this.version=e}}class Gt extends Mt{constructor(t,e,n,s){super(t,e),this.$t=n,this.Dt=!!s.Dt,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.$t.field(t)}data(){return this.$t}Ft(){return this.$t.proto}isEqual(t){return t instanceof Gt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Dt===t.Dt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.$t.isEqual(t.$t)}toString(){return`Document(${this.key}, ${this.version}, ${this.$t.toString()}, {hasLocalMutations: ${this.Dt}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.Dt||this.hasCommittedMutations}}class Ht extends Mt{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof Ht&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class zt{constructor(t,e=null,n=[],s=[],r=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.St=null}}function Qt(t,e=null,n=[],s=[],r=null,i=null,o=null){return new zt(t,e,n,s,r,i,o)}class Yt extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.Y()?"in"===e||"not-in"===e?this.xt(t,e,n):new Wt(t,e,n):"array-contains"===e?new Jt(t,n):"in"===e?new te(t,n):"not-in"===e?new ee(t,n):"array-contains-any"===e?new ne(t,n):new Yt(t,e,n)}static xt(t,e,n){return"in"===e?new Kt(t,n):new Zt(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.qt(Rt(e,this.value)):null!==e&&Ot(this.value)===Ot(e)&&this.qt(Rt(e,this.value))}qt(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return A()}}Ot(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Wt extends Yt{constructor(t,e,n){super(t,e,n),this.key=tt.Z(n.referenceValue)}matches(t){const e=tt.D(t.key,this.key);return this.qt(e)}}class Kt extends Yt{constructor(t,e){super(t,"in",e),this.keys=Xt("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Zt extends Yt{constructor(t,e){super(t,"not-in",e),this.keys=Xt("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Xt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>tt.Z(t.referenceValue))}class Jt extends Yt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return $t(e)&&Pt(e.arrayValue,this.value)}}class te extends Yt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&Pt(this.value.arrayValue,e)}}class ee extends Yt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Pt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.field(this.field);return null!==e&&!Pt(this.value.arrayValue,e)}}class ne extends Yt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!$t(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Pt(this.value.arrayValue,t))}}class se{constructor(t,e){this.position=t,this.before=e}}class re{constructor(t,e="asc"){this.field=t,this.dir=e}}function ie(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function oe(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Lt(t.position[n],e.position[n]))return!1;return!0}class ae{constructor(t,e=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.Ct=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.Lt=null,this.Ut=null,this.startAt,this.endAt}}function ue(t){return!at(t.limit)&&"L"===t.limitType}function ce(t){return t.Ct.length>0?t.Ct[0].field:null}function le(t){for(const e of t.filters)if(e.Ot())return e.field;return null}function he(t){return null!==t.collectionGroup}function fe(t){const e=S(t);if(null===e.Lt){e.Lt=[];const t=le(e),n=ce(e);if(null!==t&&null===n)t.Y()||e.Lt.push(new re(t)),e.Lt.push(new re(J.H(),"asc"));else{let t=!1;for(const n of e.Ct)e.Lt.push(n),n.field.Y()&&(t=!0);if(!t){const t=e.Ct.length>0?e.Ct[e.Ct.length-1].dir:"asc";e.Lt.push(new re(J.H(),t))}}}return e.Lt}function de(t){const e=S(t);if(!e.Ut)if("F"===e.limitType)e.Ut=Qt(e.path,e.collectionGroup,fe(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of fe(e)){const e="desc"===n.dir?"asc":"desc";t.push(new re(n.field,e))}const n=e.endAt?new se(e.endAt.position,!e.endAt.before):null,s=e.startAt?new se(e.startAt.position,!e.startAt.before):null;e.Ut=Qt(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.Ut}function pe(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!ut(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?{integerValue:""+e}:function(t,e){if(t.jt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ut(e)?"-0":e}}(t,e)}class me{constructor(){this.Mt=void 0}}class ge extends me{}class we extends me{constructor(t){super(),this.elements=t}}class ye extends me{constructor(t){super(),this.elements=t}}class ve extends me{constructor(t,e){super(),this.Bt=t,this.kt=e}}class be{constructor(t,e){this.field=t,this.transform=e}}class Ee{constructor(t,e){this.updateTime=t,this.exists=e}static Qt(){return new Ee}static exists(t){return new Ee(void 0,t)}static updateTime(t){return new Ee(t)}get Wt(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}class Ae{}class Te extends Ae{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.zt=n,this.fieldTransforms=s,this.type=0}}class Se extends Ae{constructor(t,e,n,s,r=[]){super(),this.key=t,this.data=e,this.Gt=n,this.zt=s,this.fieldTransforms=r,this.type=1}}class Ve extends Ae{constructor(t,e){super(),this.key=t,this.zt=e,this.type=2,this.fieldTransforms=[]}}class Ne extends Ae{constructor(t,e){super(),this.key=t,this.zt=e,this.type=3,this.fieldTransforms=[]}}const Ie={asc:"ASCENDING",desc:"DESCENDING"},_e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class xe{constructor(t,e){this.g=t,this.jt=e}}function De(t,e){return t.jt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Oe(t){return T(!!t),bt.wt(function(t){const e=Nt(t);return new vt(e.seconds,e.nanos)}(t))}function Le(t,e){return function(t){return new Z(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).B()}function Pe(t,e){return Le(t.g,e.path)}function Re(t,e){const n=function(t){const e=Z.k(t);return T(je(e)),e}(e);if(n.get(1)!==t.g.projectId)throw new j(_,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.g.projectId);if(n.get(3)!==t.g.database)throw new j(_,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.g.database);return new tt((T((s=n).length>4&&"documents"===s.get(4)),s.S(5)));var s}function qe(t,e){return Le(t.g,e)}function Be(t){return new Z(["projects",t.g.projectId,"databases",t.g.database]).B()}function $e(t,e,n){return{name:Pe(t,e),fields:n.proto.mapValue.fields}}function Fe(t,e){let n;if(e instanceof Te)n={update:$e(t,e.key,e.value)};else if(e instanceof Ve)n={delete:Pe(t,e.key)};else if(e instanceof Se)n={update:$e(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.B())),{fieldPaths:e}}(e.Gt)};else{if(!(e instanceof Ne))return A();n={verify:Pe(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof ge)return{fieldPath:e.field.B(),setToServerValue:"REQUEST_TIME"};if(n instanceof we)return{fieldPath:e.field.B(),appendMissingElements:{values:n.elements}};if(n instanceof ye)return{fieldPath:e.field.B(),removeAllFromArray:{values:n.elements}};if(n instanceof ve)return{fieldPath:e.field.B(),increment:n.kt};throw A()})(0,t))),e.zt.Wt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return De(t,e.It())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:A()}(t,e.zt)),n}function Ue(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=qe(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=qe(t,s.q()),n.structuredQuery.from=[{collectionId:s.C()}]);const r=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Ut(t.value))return{unaryFilter:{field:ke(t.field),op:"IS_NAN"}};if(Ft(t.value))return{unaryFilter:{field:ke(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ut(t.value))return{unaryFilter:{field:ke(t.field),op:"IS_NOT_NAN"}};if(Ft(t.value))return{unaryFilter:{field:ke(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ke(t.field),op:function(t){return _e[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);r&&(n.structuredQuery.where=r);const i=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:ke(t.field),direction:function(t){return Ie[t]}(t.dir)}})(t))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.jt||at(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Ce(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ce(e.endAt)),n}function Ce(t){return{before:t.before,values:t.position}}function ke(t){return{fieldPath:t.B()}}function je(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Me(t){return new xe(t,!0)}class Ge{constructor(t,e,n,s,r){this.Yt=t,this.Ht=e,this.Kt=n,this.op=s,this.Jt=r,this.Zt=new pt,this.then=this.Zt.promise.then.bind(this.Zt.promise),this.Zt.promise.catch(t=>{})}static Xt(t,e,n,s,r){const i=Date.now()+n,o=new Ge(t,e,i,s,r);return o.start(n),o}start(t){this.tn=setTimeout(()=>this.nn(),t)}en(){return this.nn()}cancel(t){null!==this.tn&&(this.clearTimeout(),this.Zt.reject(new j(N,"Operation cancelled"+(t?": "+t:""))))}nn(){this.Yt.sn(()=>null!==this.tn?(this.clearTimeout(),this.op().then(t=>this.Zt.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.tn&&(this.Jt(this),clearTimeout(this.tn),this.tn=null)}}class He{constructor(t,e,n=1e3,s=1.5,r=6e4){this.rn=t,this.Ht=e,this.on=n,this.un=s,this.cn=r,this.an=0,this.hn=null,this.ln=Date.now(),this.reset()}reset(){this.an=0}fn(){this.an=this.cn}dn(t){this.cancel();const e=Math.floor(this.an+this._n()),n=Math.max(0,Date.now()-this.ln),s=Math.max(0,e-n);s>0&&y("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.an} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.hn=this.rn.wn(this.Ht,s,()=>(this.ln=Date.now(),t())),this.an*=this.un,this.an<this.on&&(this.an=this.on),this.an>this.cn&&(this.an=this.cn)}mn(){null!==this.hn&&(this.hn.en(),this.hn=null)}cancel(){null!==this.hn&&(this.hn.cancel(),this.hn=null)}_n(){return(Math.random()-.5)*this.an}}class ze extends class{}{constructor(t,e,n){super(),this.credentials=t,this.pn=e,this.Bt=n,this.yn=!1}En(){if(this.yn)throw new j(q,"The client has already been terminated.")}ot(t,e,n){return this.En(),this.credentials.getToken().then(s=>this.pn.ot(t,e,n,s)).catch(t=>{throw t.code===P&&this.credentials._(),t})}ht(t,e,n){return this.En(),this.credentials.getToken().then(s=>this.pn.ht(t,e,n,s)).catch(t=>{throw t.code===P&&this.credentials._(),t})}terminate(){this.yn=!1}}async function Qe(t,e){const n=S(t),s=Be(n.Bt)+"/documents",r={writes:e.map(t=>Fe(n.Bt,t))};await n.ot("Commit",s,r)}async function Ye(t,e){const n=S(t),s=Be(n.Bt)+"/documents",r={documents:e.map(t=>Pe(n.Bt,t))},i=await n.ht("BatchGetDocuments",s,r),o=new Map;i.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){T(!!e.found),e.found.name,e.found.updateTime;const n=Re(t,e.found.name),s=Oe(e.found.updateTime),r=new kt({mapValue:{fields:e.found.fields}});return new Gt(n,s,r,{})}(t,e):"missing"in e?function(t,e){T(!!e.missing),T(!!e.readTime);const n=Re(t,e.missing),s=Oe(e.readTime);return new Ht(n,s)}(t,e):A()}(n.Bt,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());T(!!e),a.push(e)}),a}class We{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new j(_,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new j(_,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,function(t,e,n,s){if(!0===e&&!0===s)throw new j(_,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties}}const Ke=new Map;function Ze(t){if(t.In)throw new j(q,"The client has already been terminated.");if(!Ke.has(t)){y("ComponentProvider","Initializing Datastore");const r=function(t){return new dt(t,fetch.bind(null))}((e=t.Tn,n=t.An,s=t.Pn(),new Y(e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling))),i=Me(t.Tn),o=function(t,e,n){return new ze(t,r,i)}(t.Rn);Ke.set(t,o)}var e,n,s;return Ke.get(t)}class Xe{constructor(t,e){this.An="(lite)",this.Vn=new We({}),this.gn=!1,t instanceof W?(this.Tn=t,this.Rn=new G):(this.bn=t,this.Tn=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new j(_,'"projectId" not provided in firebase.initializeApp.');return new W(t.options.projectId)}(t),this.Rn=new H(e))}get app(){if(!this.bn)throw new j(q,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.bn}get vn(){return this.gn}get In(){return void 0!==this.Nn}$n(t){if(this.gn)throw new j(q,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.Vn=new We(t),void 0!==t.credentials&&(this.Rn=function(t){if(!t)return new G;switch(t.type){case"gapi":const e=t.client;return T(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Q(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new j(_,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}Dn(){return this.Vn}Pn(){return this.gn=!0,this.Vn}_delete(){return this.Nn||(this.Nn=this.Fn()),this.Nn}toJSON(){return{app:this.bn,g:this.Tn,settings:this.Vn}}Fn(){return function(t){const e=Ke.get(t);e&&(y("ComponentProvider","Removing Datastore"),Ke.delete(t),e.terminate())}(this),Promise.resolve()}}class Je{constructor(t){this.et=t}}class tn{constructor(t,e,n){this.Sn=e,this.xn=n,this.type="document",this.firestore=t}get qn(){return this.xn.path}get id(){return this.xn.path.C()}get path(){return this.xn.path.B()}get parent(){return new nn(this.firestore,this.Sn,this.xn.path.q())}withConverter(t){return new tn(this.firestore,t,this.xn)}}class en{constructor(t,e,n){this.Sn=e,this.On=n,this.type="query",this.firestore=t}withConverter(t){return new en(this.firestore,t,this.On)}}class nn extends en{constructor(t,e,n){super(t,e,new ae(n)),this.firestore=t,this.qn=n,this.type="collection"}get id(){return this.On.path.C()}get path(){return this.On.path.B()}get parent(){const t=this.qn.q();return t.L()?null:new tn(this.firestore,null,new tt(t))}withConverter(t){return new nn(this.firestore,t,this.qn)}}function sn(t,e,...n){if(t instanceof Je&&(t=t.et),1===arguments.length&&(e=gt.dt()),et("doc","path",e),t instanceof Xe){const s=Z.k(e,...n);return nt(s),new tn(t,null,new tt(s))}{if(!(t instanceof tn||t instanceof nn))throw new j(_,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t.qn.child(Z.k(e,...n));return nt(s),new tn(t.firestore,t instanceof nn?t.Sn:null,new tt(s))}}function rn(t,e){return t instanceof Je&&(t=t.et),e instanceof Je&&(e=e.et),t instanceof en&&e instanceof en&&t.firestore===e.firestore&&function(t,e){return function(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ie(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(n=t.filters[r],s=e.filters[r],n.op!==s.op||!n.field.isEqual(s.field)||!Lt(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!oe(t.startAt,e.startAt)&&oe(t.endAt,e.endAt)}(de(t),de(e))&&t.limitType===e.limitType}(t.On,e.On)&&t.Sn===e.Sn}class on{constructor(t){this.Cn=t}static fromBase64String(t){try{return new on(St.fromBase64String(t))}catch(t){throw new j(_,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new on(St.fromUint8Array(t))}toBase64(){return this.Cn.toBase64()}toUint8Array(){return this.Cn.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.Cn.isEqual(t.Cn)}}class an{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new j(_,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Ln=new J(t)}isEqual(t){return this.Ln.isEqual(t.Ln)}}class un{constructor(t){this._methodName=t}}class cn{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new j(_,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new j(_,"Longitude must be a number between -180 and 180, but was: "+e);this.Un=t,this.jn=e}get latitude(){return this.Un}get longitude(){return this.jn}isEqual(t){return this.Un===t.Un&&this.jn===t.jn}toJSON(){return{latitude:this.Un,longitude:this.jn}}_t(t){return wt(this.Un,t.Un)||wt(this.jn,t.jn)}}const ln=/^__.*__$/;class hn{constructor(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}Mn(t,e){return null!==this.Gt?new Se(t,this.data,this.Gt,e,this.fieldTransforms):new Te(t,this.data,e,this.fieldTransforms)}}class fn{constructor(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}Mn(t,e){return new Se(t,this.data,this.Gt,e,this.fieldTransforms)}}function dn(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw A()}}class pn{constructor(t,e,n,s,r,i){this.settings=t,this.g=e,this.Bt=n,this.ignoreUndefinedProperties=s,void 0===r&&this.Bn(),this.fieldTransforms=r||[],this.Gt=i||[]}get path(){return this.settings.path}get kn(){return this.settings.kn}Qn(t){return new pn(Object.assign(Object.assign({},this.settings),t),this.g,this.Bt,this.ignoreUndefinedProperties,this.fieldTransforms,this.Gt)}Wn(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Qn({path:n,zn:!1});return s.Gn(t),s}Yn(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Qn({path:n,zn:!1});return s.Bn(),s}Hn(t){return this.Qn({path:void 0,zn:!0})}Kn(t){return Rn(t,this.settings.methodName,this.settings.Jn||!1,this.path,this.settings.Zn)}contains(t){return void 0!==this.Gt.find(e=>t.U(e))||void 0!==this.fieldTransforms.find(e=>t.U(e.field))}Bn(){if(this.path)for(let t=0;t<this.path.length;t++)this.Gn(this.path.get(t))}Gn(t){if(0===t.length)throw this.Kn("Document fields must not be empty");if(dn(this.kn)&&ln.test(t))throw this.Kn('Document fields cannot begin and end with "__"')}}class mn{constructor(t,e,n){this.g=t,this.ignoreUndefinedProperties=e,this.Bt=n||Me(t)}Xn(t,e,n,s=!1){return new pn({kn:t,methodName:e,Zn:n,path:J.W(),zn:!1,Jn:s},this.g,this.Bt,this.ignoreUndefinedProperties)}}function gn(t){const e=t.Pn(),n=Me(t.Tn);return new mn(t.Tn,!!e.ignoreUndefinedProperties,n)}function wn(t,e,n,s,r,i={}){const o=t.Xn(i.merge||i.mergeFields?2:0,e,n,r);Dn("Data must be an object, but it was:",o,s);const a=_n(s,o);let u,c;if(i.merge)u=new Tt(o.Gt),c=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const s of i.mergeFields){const r=On(e,s,n);if(!o.contains(r))throw new j(_,`Field '${r}' is specified in your field mask but missing from your input data.`);qn(t,r)||t.push(r)}u=new Tt(t),c=o.fieldTransforms.filter(t=>u.Tt(t.field))}else u=null,c=o.fieldTransforms;return new hn(new kt(a),u,c)}class yn extends un{te(t){if(2!==t.kn)throw 1===t.kn?t.Kn(`${this._methodName}() can only appear at the top level of your update data`):t.Kn(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.Gt.push(t.path),null}isEqual(t){return t instanceof yn}}function vn(t,e,n){return new pn({kn:3,Zn:e.settings.Zn,methodName:t._methodName,zn:n},e.g,e.Bt,e.ignoreUndefinedProperties)}class bn extends un{te(t){return new be(t.path,new ge)}isEqual(t){return t instanceof bn}}class En extends un{constructor(t,e){super(t),this.ne=e}te(t){const e=vn(this,t,!0),n=this.ne.map(t=>In(t,e)),s=new we(n);return new be(t.path,s)}isEqual(t){return this===t}}class An extends un{constructor(t,e){super(t),this.ne=e}te(t){const e=vn(this,t,!0),n=this.ne.map(t=>In(t,e)),s=new ye(n);return new be(t.path,s)}isEqual(t){return this===t}}class Tn extends un{constructor(t,e){super(t),this.ee=e}te(t){const e=new ve(t.Bt,pe(t.Bt,this.ee));return new be(t.path,e)}isEqual(t){return this===t}}function Sn(t,e,n,s){const r=t.Xn(1,e,n);Dn("Data must be an object, but it was:",r,s);const i=[],o=new jt;At(s,(t,s)=>{const a=Pn(e,t,n);s instanceof Je&&(s=s.et);const u=r.Yn(a);if(s instanceof yn)i.push(a);else{const t=In(s,u);null!=t&&(i.push(a),o.set(a,t))}});const a=new Tt(i);return new fn(o.vt(),a,r.fieldTransforms)}function Vn(t,e,n,s,r,i){const o=t.Xn(1,e,n),a=[On(e,s,n)],u=[r];if(i.length%2!=0)throw new j(_,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(On(e,i[t])),u.push(i[t+1]);const c=[],l=new jt;for(let t=a.length-1;t>=0;--t)if(!qn(c,a[t])){const e=a[t];let n=u[t];n instanceof Je&&(n=n.et);const s=o.Yn(e);if(n instanceof yn)c.push(e);else{const t=In(n,s);null!=t&&(c.push(e),l.set(e,t))}}const h=new Tt(c);return new fn(l.vt(),h,o.fieldTransforms)}function Nn(t,e,n,s=!1){return In(n,t.Xn(s?4:3,e))}function In(t,e){if(t instanceof Je&&(t=t.et),xn(t))return Dn("Unsupported field value:",e,t),_n(t,e);if(t instanceof un)return function(t,e){if(!dn(e.kn))throw e.Kn(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Kn(`${t._methodName}() is not currently supported inside arrays`);const n=t.te(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.Gt.push(e.path),t instanceof Array){if(e.settings.zn&&4!==e.kn)throw e.Kn("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const r of t){let t=In(r,e.Hn(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof Je&&(t=t.et),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return pe(e.Bt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=vt.fromDate(t);return{timestampValue:De(e.Bt,n)}}if(t instanceof vt){const n=new vt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:De(e.Bt,n)}}if(t instanceof cn)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof on)return{bytesValue:function(t,e){return t.jt?e.toBase64():e.toUint8Array()}(e.Bt,t.Cn)};if(t instanceof tn){const n=e.g,s=t.firestore.Tn;if(!s.isEqual(n))throw e.Kn(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Le(t.firestore.Tn||e.g,t.xn.path)}}throw e.Kn(`Unsupported field value: ${rt(t)}`)}(t,e)}function _n(t,e){const n={};return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(t)?e.path&&e.path.length>0&&e.Gt.push(e.path):At(t,(t,s)=>{const r=In(s,e.Wn(t));null!=r&&(n[t]=r)}),{mapValue:{fields:n}}}function xn(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof vt||t instanceof cn||t instanceof on||t instanceof tn||t instanceof un)}function Dn(t,e,n){if(!xn(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=rt(n);throw"an object"===s?e.Kn(t+" a custom object"):e.Kn(t+" "+s)}}function On(t,e,n){if(e instanceof Je&&(e=e.et),e instanceof an)return e.Ln;if("string"==typeof e)return Pn(t,e);throw Rn("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Ln=new RegExp("[~\\*/\\[\\]]");function Pn(t,e,n){if(e.search(Ln)>=0)throw Rn(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new an(...e.split(".")).Ln}catch(s){throw Rn(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Rn(t,e,n,s,r){const i=s&&!s.L(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)");let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${s}`),o&&(u+=` in document ${r}`),u+=")"),new j(_,(a+=". ")+t+u)}function qn(t,e){return t.some(t=>t.isEqual(e))}class Bn{constructor(t,e,n,s,r){this.se=t,this.re=e,this.xn=n,this.ie=s,this.Sn=r}get id(){return this.xn.path.C()}get ref(){return new tn(this.se,this.Sn,this.xn)}exists(){return null!==this.ie}data(){if(this.ie){if(this.Sn){const t=new $n(this.se,this.re,this.xn,this.ie,null);return this.Sn.fromFirestore(t)}return this.re.oe(this.ie.Ft())}}get(t){if(this.ie){const e=this.ie.data().field(Un("DocumentSnapshot.get",t));if(null!==e)return this.re.oe(e)}}}class $n extends Bn{data(){return super.data()}}class Fn{constructor(t,e){this.ue=e,this.query=t}get docs(){return[...this.ue]}get size(){return this.docs.length}get empty(){return 0===this.docs.length}forEach(t,e){this.ue.forEach(t,e)}}function Un(t,e){return"string"==typeof e?Pn(t,e):e instanceof Je?e.et.Ln:e.Ln}class Cn{}class kn extends Cn{constructor(t,e,n){super(),this.ae=t,this.he=e,this.le=n,this.type="where"}ce(t){const e=gn(t.firestore),n=function(t,e,n,s,r,i,o){let a;if(r.Y()){if("array-contains"===i||"array-contains-any"===i)throw new j(_,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){Yn(o,i);const e=[];for(const n of o)e.push(Qn(s,t,n));a={arrayValue:{values:e}}}else a=Qn(s,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Yn(o,i),a=Nn(n,"where",o,"in"===i||"not-in"===i);const u=Yt.create(r,i,a);return function(t,e){if(e.Ot()){const n=le(t);if(null!==n&&!n.isEqual(e.field))throw new j(_,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=ce(t);null!==s&&Wn(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new j(_,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new j(_,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.On,0,e,t.firestore.Tn,this.ae,this.he,this.le);return new en(t.firestore,t.Sn,function(t,e){const n=t.filters.concat([e]);return new ae(t.path,t.collectionGroup,t.Ct.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.On,n))}}class jn extends Cn{constructor(t,e){super(),this.ae=t,this.fe=e,this.type="orderBy"}ce(t){const e=function(t,e,n){if(null!==t.startAt)throw new j(_,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new j(_,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new re(e,n);return function(t,e){if(null===ce(t)){const n=le(t);null!==n&&Wn(t,n,e.field)}}(t,s),s}(t.On,this.ae,this.fe);return new en(t.firestore,t.Sn,function(t,e){const n=t.Ct.concat([e]);return new ae(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.On,e))}}class Mn extends Cn{constructor(t,e,n){super(),this.type=t,this.de=e,this._e=n}ce(t){return new en(t.firestore,t.Sn,function(t,e,n){return new ae(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.On,this.de,this._e))}}class Gn extends Cn{constructor(t,e,n){super(),this.type=t,this.we=e,this.me=n}ce(t){const e=zn(t,this.type,this.we,this.me);return new en(t.firestore,t.Sn,function(t,e){return new ae(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.On,e))}}class Hn extends Cn{constructor(t,e,n){super(),this.type=t,this.we=e,this.me=n}ce(t){const e=zn(t,this.type,this.we,this.me);return new en(t.firestore,t.Sn,function(t,e){return new ae(t.path,t.collectionGroup,t.Ct.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.On,e))}}function zn(t,e,n,s){if(n[0]instanceof Je&&(n[0]=n[0].et),n[0]instanceof Bn)return function(t,e,n,s,r){if(!s)throw new j(D,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of fe(t))if(n.field.Y())i.push(Bt(e,s.key));else{const t=s.field(n.field);if(xt(t))throw new j(_,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.B();throw new j(_,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new se(i,r)}(t.On,t.firestore.Tn,e,n[0].ie,s);{const r=gn(t.firestore);return function(t,e,n,s,r,i){const o=t.Ct;if(r.length>o.length)throw new j(_,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<r.length;i++){const u=r[i];if(o[i].field.Y()){if("string"!=typeof u)throw new j(_,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof u}`);if(!he(t)&&-1!==u.indexOf("/"))throw new j(_,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Z.k(u));if(!tt.tt(n))throw new j(_,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new tt(n);a.push(Bt(e,r))}else{const t=Nn(n,s,u);a.push(t)}}return new se(a,i)}(t.On,t.firestore.Tn,r,e,n,s)}}function Qn(t,e,n){if(n instanceof Je&&(n=n.et),"string"==typeof n){if(""===n)throw new j(_,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!he(e)&&-1!==n.indexOf("/"))throw new j(_,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Z.k(n));if(!tt.tt(s))throw new j(_,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Bt(t,new tt(s))}if(n instanceof tn)return Bt(t,n.xn);throw new j(_,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${rt(n)}.`)}function Yn(t,e){if(!Array.isArray(t)||0===t.length)throw new j(_,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new j(_,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Wn(t,e,n){if(!n.isEqual(e))throw new j(_,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function Kn(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class Zn extends class{oe(t,e="none"){switch(Ot(t)){case 0:return null;case 1:return t.booleanValue;case 2:return It(t.integerValue||t.doubleValue);case 3:return this.pe(t.timestampValue);case 4:return this.ye(t,e);case 5:return t.stringValue;case 6:return this.Ee(_t(t.bytesValue));case 7:return this.Ie(t.referenceValue);case 8:return this.Te(t.geoPointValue);case 9:return this.Ae(t.arrayValue,e);case 10:return this.Pe(t.mapValue,e);default:throw A()}}Pe(t,e){const n={};return At(t.fields||{},(t,s)=>{n[t]=this.oe(s,e)}),n}Te(t){return new cn(It(t.latitude),It(t.longitude))}Ae(t,e){return(t.values||[]).map(t=>this.oe(t,e))}ye(t,e){switch(e){case"previous":const n=function t(e){const n=e.mapValue.fields.__previous_value__;return xt(n)?t(n):n}(t);return null==n?null:this.oe(n,e);case"estimate":return this.pe(Dt(t));default:return null}}pe(t){const e=Nt(t);return new vt(e.seconds,e.nanos)}Re(t,e){const n=Z.k(t);T(je(n));const s=new W(n.get(1),n.get(3)),r=new tt(n.S(5));return s.isEqual(e)||v(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}{constructor(t){super(),this.firestore=t}Ee(t){return new on(t)}Ie(t){const e=this.Re(t,this.firestore.Tn);return new tn(this.firestore,null,e)}}class Xn{constructor(t,e){this.se=t,this.Ve=e,this.ge=[],this.be=!1,this.ve=gn(t)}set(t,e,n){this.Ne();const s=Jn(t,this.se),r=Kn(s.Sn,e,n),i=wn(this.ve,"WriteBatch.set",s.xn,r,null!==s.Sn,n);return this.ge.push(i.Mn(s.xn,Ee.Qt())),this}update(t,e,n,...s){this.Ne();const r=Jn(t,this.se);let i;return e instanceof Je&&(e=e.et),i="string"==typeof e||e instanceof an?Vn(this.ve,"WriteBatch.update",r.xn,e,n,s):Sn(this.ve,"WriteBatch.update",r.xn,e),this.ge.push(i.Mn(r.xn,Ee.exists(!0))),this}delete(t){this.Ne();const e=Jn(t,this.se);return this.ge=this.ge.concat(new Ve(e.xn,Ee.Qt())),this}commit(){return this.Ne(),this.be=!0,this.ge.length>0?this.Ve(this.ge):Promise.resolve()}Ne(){if(this.be)throw new j(q,"A write batch can no longer be used after commit() has been called.")}}function Jn(t,e){if(t instanceof Je&&(t=t.et),t.firestore!==e)throw new j(_,"Provided document reference is from a different Firestore instance.");return t}class ts{constructor(t){this.$e=t,this.De=new Map,this.mutations=[],this.Fe=!1,this.Se=null,this.xe=new Set}async qe(t){if(this.Oe(),this.mutations.length>0)throw new j(_,"Firestore transactions require all reads to be executed before all writes.");const e=await Ye(this.$e,t);return e.forEach(t=>{t instanceof Ht||t instanceof Gt?this.Ce(t):A()}),e}set(t,e){this.write(e.Mn(t,this.zt(t))),this.xe.add(t.toString())}update(t,e){try{this.write(e.Mn(t,this.Le(t)))}catch(t){this.Se=t}this.xe.add(t.toString())}delete(t){this.write(new Ve(t,this.zt(t))),this.xe.add(t.toString())}async commit(){if(this.Oe(),this.Se)throw this.Se;const t=this.De;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=tt.J(e);this.mutations.push(new Ne(n,this.zt(n)))}),await Qe(this.$e,this.mutations),this.Fe=!0}Ce(t){let e;if(t instanceof Gt)e=t.version;else{if(!(t instanceof Ht))throw A();e=bt.min()}const n=this.De.get(t.key.toString());if(n){if(!e.isEqual(n))throw new j(B,"Document version changed between two reads.")}else this.De.set(t.key.toString(),e)}zt(t){const e=this.De.get(t.toString());return!this.xe.has(t.toString())&&e?Ee.updateTime(e):Ee.Qt()}Le(t){const e=this.De.get(t.toString());if(!this.xe.has(t.toString())&&e){if(e.isEqual(bt.min()))throw new j(_,"Can't update a document that doesn't exist.");return Ee.updateTime(e)}return Ee.exists(!0)}write(t){this.Oe(),this.mutations.push(t)}Oe(){}}class es{constructor(t,e,n,s){this.Yt=t,this.$e=e,this.updateFunction=n,this.Zt=s,this.Ue=5,this.je=new He(this.Yt,"transaction_retry")}run(){this.Me()}Me(){this.je.dn(async()=>{const t=new ts(this.$e),e=this.Be(t);e&&e.then(e=>{this.Yt.sn(()=>t.commit().then(()=>{this.Zt.resolve(e)}).catch(t=>{this.ke(t)}))}).catch(t=>{this.ke(t)})})}Be(t){try{const e=this.updateFunction(t);return!at(e)&&e.catch&&e.then?e:(this.Zt.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Zt.reject(t),null}}ke(t){this.Ue>0&&this.Qe(t)?(this.Ue-=1,this.Yt.sn(()=>(this.Me(),Promise.resolve()))):this.Zt.reject(t)}Qe(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!function(t){switch(e){case V:return A();case N:case I:case x:case R:case U:case C:case P:return!1;case _:case D:case O:case L:case q:case B:case $:case F:case k:return!0;default:return A()}}()}return!1}}function ns(){return"undefined"!=typeof document?document:null}class ss{constructor(){this.We=Promise.resolve(),this.ze=[],this.Ge=!1,this.Ye=[],this.He=null,this.Ke=!1,this.Je=[],this.je=new He(this,"async_queue_retry"),this.Ze=(()=>{const t=ns();t&&y("AsyncQueue","Visibility state changed to "+t.visibilityState),this.je.mn()});const t=ns();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ze)}get Xe(){return this.Ge}sn(t){this.enqueue(t)}ts(t){this.ns(),this.es(t)}ss(){if(!this.Ge){this.Ge=!0;const t=ns();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ze)}}enqueue(t){return this.ns(),this.Ge?new Promise(t=>{}):this.es(t)}rs(t){this.sn(()=>(this.ze.push(t),this.os()))}async os(){if(0!==this.ze.length){try{await this.ze[0](),this.ze.shift(),this.je.reset()}catch(t){if(!function(t){return"IndexedDbTransactionError"===t.name}(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}this.ze.length>0&&this.je.dn(()=>this.os())}}es(t){const e=this.We.then(()=>(this.Ke=!0,t().catch(t=>{throw this.He=t,this.Ke=!1,v("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.Ke=!1,t))));return this.We=e,e}wn(t,e,n){this.ns(),this.Je.indexOf(t)>-1&&(e=0);const s=Ge.Xt(this,t,e,n,t=>this.us(t));return this.Ye.push(s),s}ns(){this.He&&A()}cs(){}async hs(){let t;do{t=this.We,await t}while(t!==this.We)}ls(t){for(const e of this.Ye)if(e.Ht===t)return!0;return!1}fs(t){return this.hs().then(()=>{this.Ye.sort((t,e)=>t.Kt-e.Kt);for(const e of this.Ye)if(e.en(),"all"!==t&&e.Ht===t)break;return this.hs()})}ds(t){this.Je.push(t)}us(t){const e=this.Ye.indexOf(t);this.Ye.splice(e,1)}}class rs{constructor(t,e){this.se=t,this._s=e,this.ve=gn(t)}get(t){const e=Jn(t,this.se),n=new Zn(this.se);return this._s.qe([e.xn]).then(t=>{if(!t||1!==t.length)return A();const s=t[0];if(s instanceof Ht)return new Bn(this.se,n,e.xn,null,e.Sn);if(s instanceof Gt)return new Bn(this.se,n,s.key,s,e.Sn);throw A()})}set(t,e,n){const s=Jn(t,this.se),r=Kn(s.Sn,e,n),i=wn(this.ve,"Transaction.set",s.xn,r,null!==s.Sn,n);return this._s.set(s.xn,i),this}update(t,e,n,...s){const r=Jn(t,this.se);let i;return e instanceof Je&&(e=e.et),i="string"==typeof e||e instanceof an?Vn(this.ve,"Transaction.update",r.xn,e,n,s):Sn(this.ve,"Transaction.update",r.xn,e),this._s.update(r.xn,i),this}delete(t){const e=Jn(t,this.se);return this._s.delete(e.xn),this}}e._registerComponent(new c("firestore/lite",t=>((t,e)=>new Xe(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-lite","0.0.900","node"),t.Bytes=on,t.CollectionReference=nn,t.DocumentReference=tn,t.DocumentSnapshot=Bn,t.FieldPath=an,t.FieldValue=un,t.FirebaseFirestore=Xe,t.FirestoreError=j,t.GeoPoint=cn,t.Query=en,t.QueryConstraint=Cn,t.QueryDocumentSnapshot=$n,t.QuerySnapshot=Fn,t.Timestamp=vt,t.Transaction=rs,t.WriteBatch=Xn,t.addDoc=function(t,e){const n=sn(t=it(t,nn)),s=Kn(t.Sn,e),r=wn(gn(t.firestore),"addDoc",n.xn,s,null!==n.Sn,{});return Qe(Ze(t.firestore),[r.Mn(n.xn,Ee.exists(!1))]).then(()=>n)},t.arrayRemove=function(...t){return new An("arrayRemove",t)},t.arrayUnion=function(...t){return new En("arrayUnion",t)},t.collection=function(t,e,...n){if(t instanceof Je&&(t=t.et),et("collection","path",e),t instanceof Xe){const s=Z.k(e,...n);return st(s),new nn(t,null,s)}{if(!(t instanceof tn||t instanceof nn))throw new j(_,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=Z.k(t.path,...n).child(Z.k(e));return st(s),new nn(t.firestore,null,s)}},t.collectionGroup=function(t,e){if(t=it(t,Xe),et("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new j(_,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new en(t,null,function(t){return new ae(Z.W(),t)}(e))},t.deleteDoc=function(t){return Qe(Ze((t=it(t,tn)).firestore),[new Ve(t.xn,Ee.Qt())])},t.deleteField=function(){return new yn("deleteField")},t.doc=sn,t.documentId=function(){return new an("__name__")},t.endAt=function(...t){return new Hn("endAt",t,!1)},t.endBefore=function(...t){return new Hn("endBefore",t,!0)},t.getDoc=function(t){const e=Ze((t=it(t,tn)).firestore),n=new Zn(t.firestore);return Ye(e,[t.xn]).then(e=>{T(1===e.length);const s=e[0];return new Bn(t.firestore,n,t.xn,s instanceof Gt?s:null,t.Sn)})},t.getDocs=function(t){!function(t){if(ue(t)&&0===t.Ct.length)throw new j(F,"limitToLast() queries require specifying at least one orderBy() clause")}((t=it(t,en)).On);const e=Ze(t.firestore),n=new Zn(t.firestore);return async function(t,e){const n=S(t),s=Ue(n.Bt,de(e));return(await n.ht("RunQuery",s.parent,{structuredQuery:s.structuredQuery})).filter(t=>!!t.document).map(t=>(function(t,e,n){const s=Re(t,e.name),r=Oe(e.updateTime),i=new kt({mapValue:{fields:e.fields}});return new Gt(s,r,i,{hasCommittedMutations:!1})})(n.Bt,t.document))}(e,t.On).then(e=>{const s=e.map(e=>new $n(t.firestore,n,e.key,e,t.Sn));return ue(t.On)&&s.reverse(),new Fn(t,s)})},t.getFirestore=function(t){return e._getProvider(t,"firestore/lite").getImmediate()},t.increment=function(t){return new Tn("increment",t)},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore/lite");if(s.isInitialized())throw new j(q,"Firestore can only be initialized once per app.");const r=s.getImmediate();return r.$n(n),r},t.limit=function(t){return ot("limit",t),new Mn("limit",t,"F")},t.limitToLast=function(t){return ot("limitToLast",t),new Mn("limitToLast",t,"L")},t.orderBy=function(t,e="asc"){const n=e,s=Un("orderBy",t);return new jn(s,n)},t.query=function(t,...e){for(const n of e)t=n.ce(t);return t},t.queryEqual=rn,t.refEqual=function(t,e){return t instanceof Je&&(t=t.et),e instanceof Je&&(e=e.et),(t instanceof tn||t instanceof nn)&&(e instanceof tn||e instanceof nn)&&t.firestore===e.firestore&&t.path===e.path&&t.Sn===e.Sn},t.runTransaction=function(t,e){const n=Ze(t=it(t,Xe)),s=new pt;return new es(new ss,n,n=>e(new rs(t,n)),s).run(),s.promise},t.serverTimestamp=function(){return new bn("serverTimestamp")},t.setDoc=function(t,e,n){const s=Kn((t=it(t,tn)).Sn,e,n),r=wn(gn(t.firestore),"setDoc",t.xn,s,null!==t.Sn,n);return Qe(Ze(t.firestore),[r.Mn(t.xn,Ee.Qt())])},t.setLogLevel=function(t){w.setLogLevel(t)},t.snapshotEqual=function t(e,n){return e instanceof Je&&(e=e.et),n instanceof Je&&(n=n.et),e instanceof Bn&&n instanceof Bn?e.se===n.se&&e.xn.isEqual(n.xn)&&(null===e.ie?null===n.ie:e.ie.isEqual(n.ie))&&e.Sn===n.Sn:e instanceof Fn&&n instanceof Fn&&rn(e.query,n.query)&&yt(e.docs,n.docs,t)},t.startAfter=function(...t){return new Gn("startAfter",t,!1)},t.startAt=function(...t){return new Gn("startAt",t,!0)},t.terminate=function(t){return t=it(t,Xe),e._removeServiceInstance(t.app,"firestore/lite"),t._delete()},t.updateDoc=function(t,e,n,...s){const r=gn((t=it(t,tn)).firestore);let i;return e instanceof Je&&(e=e.et),i="string"==typeof e||e instanceof an?Vn(r,"updateDoc",t.xn,e,n,s):Sn(r,"updateDoc",t.xn,e),Qe(Ze(t.firestore),[i.Mn(t.xn,Ee.exists(!0))])},t.useFirestoreEmulator=function(t,e,n){const s=(t=it(t,Xe)).Dn();"firestore.googleapis.com"!==s.host&&s.host!==e&&b("Host has been set in both settings() and useEmulator(), emulator host will be used"),t.$n(Object.assign(Object.assign({},s),{host:`${e}:${n}`,ssl:!1}))},t.where=function(t,e,n){const s=e,r=Un("where",t);return new kn(r,s,n)},t.writeBatch=function(t){const e=Ze(t=it(t,Xe));return new Xn(t,t=>Qe(e,t))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore-lite.js - be sure to load firebase-app.js first.")}});