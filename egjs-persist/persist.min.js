!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.eg=t.eg||{},t.eg.Persist=e())}(this,function(){"use strict";var r="undefined"!=typeof window&&window||{},a=r.console,g=r.document,d=r.history,y=r.location,t=r.navigator,e=r.parseFloat,n=r.performance,i=null,o=null;try{i=r.localStorage,o=r.sessionStorage}catch(t){}var s,u,c,f,l,h="___persist___",p="___hash___",v="depths",_=""+p+v+h,w="state"+h,x="lastUrl",E=n&&n.navigation,m=E&&E.TYPE_NAVIGATE||0,O=(E&&E.TYPE_RELOAD,E&&E.TYPE_BACK_FORWARD||2),b=t?t.userAgent:"",R=(s=new RegExp("iPhone|iPad","i").test(b),u=new RegExp("Mac","i").test(b)&&!new RegExp("Chrome","i").test(b)&&new RegExp("Apple","i").test(b),c=new RegExp("Android ","i").test(b),f=new RegExp("wv; |inapp;","i").test(b),l=c?e(new RegExp("(Android)\\s([\\d_\\.]+|\\d_0)","i").exec(b)[2]):void 0,d&&"replaceState"in d&&"state"in d),P="None";function S(t){if(t){var e="__tmp__"+h;try{return t.setItem(e,h),t.getItem(e)===h}catch(t){return!1}}}var A,j=(S(o)?(A=o,P="SessionStorage"):S(i)?(A=i,P="LocalStorage"):d&&d.state&&(P="History"),A);function N(){a.warn("window.history or session/localStorage has no valid format data to be handled in persist.")}function k(t){var e,n;if(j?n=j.getItem(t):d.state?"object"==typeof d.state&&null!==d.state?n=d.state[t]:N():n=d.state,null===n)return{};var r="string"==typeof n&&0<n.length&&"null"!==n;try{var i=!("object"!=typeof(e=JSON.parse(n))||e instanceof Array);if(!r||!i)throw new Error}catch(t){N(),e={}}return e}function H(t,e){if(j)e?j.setItem(t,JSON.stringify(e)):j.removeItem(t);else try{var n=d&&null!=d.state?d.state:{};d&&"object"==typeof n?(n[t]=JSON.stringify(e),d.replaceState(n,document.title,y.href)):a.warn("To use a history object, it must be an object that is not a primitive type.")}catch(t){a.warn(t.message)}e?r[h]=!0:delete r[h]}function I(){return j}function T(t,e){if(R||j){var n=k(t)[e];return"null"!==n&&void 0!==n||(n=null),n}}function D(t,e,n){if(R||j){var r=k(t);r[e]=n,H(t,r)}}function K(t){H(t,null)}function U(t){return T(w,t)}function z(){return U(v)||[]}var J,M,F,L,Q,B=t?t.userAgent:"",C=(J=new RegExp("iPhone|iPad","i").test(B),M=new RegExp("Mac","i").test(B)&&!new RegExp("Chrome","i").test(B)&&new RegExp("Apple","i").test(B),F=new RegExp("Android ","i").test(B),L=new RegExp("wv; |inapp;","i").test(B),Q=F?e(new RegExp("(Android)\\s([\\d_\\.]+|\\d_0)","i").exec(B)[2]):void 0,!(J||M||F&&(Q<=4.3&&L||Q<3)));function Y(){return n&&n.navigation&&n.navigation.type}function V(){return y?y.href:""}function q(){return V().split("#")[0]}function G(t){return t+h}function W(){return G(q())}function X(t,e,n){var r=t;if(!r){var i=e[0];r=isNaN(i)||""===i?{}:[]}var o=e.shift();return 0===e.length?(r instanceof Array&&isNaN(o)&&a.warn("Don't use key string on array"),n(r,o)):r[o]=X(r[o],e,n),r}var Z={url:"",hashUrl:"",hash:null,length:0,useHash:!1};function $(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function tt(t){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function et(t,e){return(et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nt(t,e,n){return(nt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&et(i,n.prototype),i}).apply(null,arguments)}function rt(t){var r="function"==typeof Map?new Map:void 0;return(rt=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return nt(t,arguments,tt(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),et(n,t)})(t)}function it(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},at=function(h){function p(t,e){var n,r=e.length,i=P,o=I(),a="",s=[];if(o){for(var u=o.length,c=0;c<u;++c){var f=o.key(c),l=o.getItem(f)||"";s.push({key:f,size:l.length})}(s=s.sort(function(t,e){return e.size-t.size}).slice(0,3)).length&&(a=" The highest values of "+i+" are "+s.map(function(t){var e;return JSON.stringify(((e={})[t.key]=t.size,e))}).join(", ")+".")}return n=h.call(this,"Setting the value (size: "+r+") of '"+t+"' exceeded the "+i+"'s quota."+a)||this,ot(it(it(n)),p.prototype),n.name="PersistQuotaExceededError",n.storageType=i,n.key=t,n.size=r,n.values=s,n}return $(p,h),p}(rt(Error));function st(t,e){return void 0===e&&(e=W()),D(e,_,t)}function ut(t,e){var n=k(t),r=n[_];if(r&&r.length)if(void 0===e){var i={};for(var o in n)0===o.indexOf(p)&&(i[o]=n[o]);H(t,i)}else delete n[""+p+e],H(t,n);else H(t,null)}function ct(t){void 0===t&&(t=0);var e=Z.length,n=Z.hash,r=Z.url,i=Z.hashUrl,o=q(),a=V(),s=W(),u=y.hash,c=d.length,f=t;if(a!==i){var l;if(null==d.state)f=m,d.replaceState(((l={})[w]=!0,l),g.title,y.href);else t===O&&c!==e&&(f=m);Z.hash=u,Z.hashUrl=a,Z.length=c;var h=ft();if(f!==O){if(ut(s,u),f===m){var p=r===o?h.indexOf(n):0;if(-1<p&&null!=n)h.splice(p+1,h.length).forEach(function(t){ut(s,t)});var v=h.indexOf(u);~v&&h.splice(v,1)}h.indexOf(u)<0&&h.push(u),st(h)}}}function ft(t){return void 0===t&&(t=W()),T(t,_)||[]}function lt(t){return"QuotaExceededError"===t.name||"PersistQuotaExceededError"===t.name}function ht(t,e,n){if(function(){var t=z(),e=t.splice(0,1);if(!e.length)return!1;var n=e[0];if(K(G(n)),Z.url===n&&(Z.url="",pt(x,""),!t.length))return!1;return pt(v,t),!0}())return!0;throw lt(t)?new at(e,n?JSON.stringify(n):""):t}function pt(e,n){try{D(w,e,n)}catch(t){ht(t,w,n)&&(e===x?pt(e,n):e===v&&pt(e,n&&n.slice(1)))}}function vt(t){void 0===t&&(t=0);var e=q();if(Z.useHash&&ct(t),Z.url!==e){var n=Z.url;try{Z.url=e;var r=z();if(t===O){~r.indexOf(e)&&pt(x,e)}else{var i=U(x);if(ut(G(e)),t===m&&e!==i){var o=r.indexOf(i);if(-1<=o)r.splice(o+1,r.length).forEach(function(t){K(G(t))});var a=r.indexOf(e);~a&&r.splice(a,1)}r.indexOf(e)<0&&r.push(e),pt(v,r),pt(x,e)}}catch(t){throw Z.url=n,t}}}function gt(){try{vt(O)}catch(t){if(!lt(t))throw t}}"onpopstate"in r&&r.addEventListener("popstate",gt);try{vt(Y())}catch(t){if(!lt(t))throw t}var dt=function(){var t=function(){function t(t){this.key=t||""}t.clear=function(){z().forEach(function(t){K(G(t))}),K(w),Z.url="",Z.hashUrl="",Z.hash=null},t.isNeeded=function(){return C};var e=t.prototype;return e.get=function(t){return this._get(this.key,t)},e.set=function(t,e){return this._set(this.key,t,e)},e.remove=function(t){return this._remove(this.key,t)},e._get=function(t,e){vt(m);var n=T(W(),t);if(!e||0===e.length)return n;for(var r=e.split("."),i=n,o=!0,a=0;a<r.length;a++){if(!i){o=!1;break}i=i[r[a]]}return o&&null!=i?i:null},e._set=function(e,n,r){vt(m);var i=W(),t=T(i,e);try{if(0===n.length)D(i,e,r);else D(i,e,X(t,n.split("."),function(t,e){t[e]=r}))}catch(t){ht(t,i,r)&&this._set(e,n,r)}return this},e._remove=function(e,n){vt(m);var t=W(),r=T(t,e);try{if(0===n.length)D(t,e,null);else D(t,e,X(r,n.split("."),function(t,e){"object"==typeof t&&delete t[e]}))}catch(t){ht(t)&&this._remove(e,n)}return this},t}();return t.VERSION="2.7.0-beta.0",t.StorageManager={reset:K,setStateByKey:D,getStateByKey:T,getStorage:I},t}(),yt={HashPersist:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.get=function(t){return this._get(this._getKey(),this._getPath(t))},n.set=function(t,e){return this._set(this._getKey(),this._getPath(t),e)},n.remove=function(t){return this._remove(this._getKey(),this._getPath(t))},n._getKey=function(){return""+p+y.hash},n._getPath=function(t){var e=t;return e=Array.isArray(e)?[this.key].concat(e):this.key+"."+e},e}(dt),PersistQuotaExceededError:at,default:dt,updateDepth:vt,replaceDepth:function(){var t=q();if(Z.useHash&&function(){var t=Z.hash,e=Z.url,n=G(e),r=Z.hashUrl,i=V(),o=W(),a=y.hash,s=d.length;if(i!==r){Z.hash=a,Z.hashUrl=i,Z.length=s,ut(G(e),t);var u=ft(n),c=u.indexOf(t);-1<c&&u.splice(c,1);var f=o===n,l=f?u:ft(),h=l.indexOf(a);if(-1<h&&(ut(o,a),l.splice(h,1)),f){var p=-1===h||c<h?c:c-1;l.splice(p,0,a)}else l.splice(0,0,a),st(u,n);st(l,o)}}(),Z.url!==t){var e=Z.url;try{Z.url=t;var n=z(),r=n.indexOf(e);0<=r&&(n.splice(r,1),ut(G(e)));var i=n.indexOf(t);if(0<=i&&(n.splice(i,1),ut(G(t))),0<=r){var o=-1===i||r<i?r:r-1;n.splice(o,0,t)}else n.push(t);pt(v,n),pt(x,t)}catch(t){throw Z.url=e,t}}},registerHashPersist:function(){Z.useHash||(Z.useHash=!0,ct(Y()))},releaseEvent:function(){r.removeEventListener("popstate",gt)}};for(var _t in yt)dt[_t]=yt[_t];return dt});
//# sourceMappingURL=persist.min.js.map
