!function(window,document,undefined){var factory=function($,DataTable){"use strict";var ColVis=function(oDTSettings,oInit){this.CLASS&&"ColVis"==this.CLASS||alert("Warning: ColVis must be initialised with the keyword 'new'"),"undefined"==typeof oInit&&(oInit={});var camelToHungarian=$.fn.dataTable.camelToHungarian;return camelToHungarian&&(camelToHungarian(ColVis.defaults,ColVis.defaults,!0),camelToHungarian(ColVis.defaults,oInit)),this.s={dt:null,oInit:oInit,hidden:!0,abOriginal:[]},this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[],groupButtons:[],restore:null},ColVis.aInstances.push(this),this.s.dt=$.fn.dataTable.Api?new $.fn.dataTable.Api(oDTSettings).settings()[0]:oDTSettings,this._fnConstruct(oInit),this};return ColVis.prototype={button:function(){return this.dom.wrapper},fnRebuild:function(){this.rebuild()},rebuild:function(){for(var i=this.dom.buttons.length-1;i>=0;i--)this.dom.collection.removeChild(this.dom.buttons[i]);this.dom.buttons.splice(0,this.dom.buttons.length),this.dom.groupButtons.splice(0,this.dom.groupButtons.length),this.dom.restore&&this.dom.restore.parentNode(this.dom.restore),this._fnAddGroups(),this._fnAddButtons(),this._fnDrawCallback()},_fnConstruct:function(init){this._fnApplyCustomisation(init);var i,iLen,that=this;for(this.dom.wrapper=document.createElement("div"),this.dom.wrapper.className="ColVis",this.dom.button=$("<button />",{"class":this.s.dt.bJUI?"ColVis_Button ColVis_MasterButton ui-button ui-state-default":"ColVis_Button ColVis_MasterButton"}).append("<span>"+this.s.buttonText+"</span>").bind("mouseover"==this.s.activate?"mouseover":"click",function(e){e.preventDefault(),that._fnCollectionShow()}).appendTo(this.dom.wrapper)[0],this.dom.catcher=this._fnDomCatcher(),this.dom.collection=this._fnDomCollection(),this.dom.background=this._fnDomBackground(),this._fnAddGroups(),this._fnAddButtons(),i=0,iLen=this.s.dt.aoColumns.length;iLen>i;i++)this.s.abOriginal.push(this.s.dt.aoColumns[i].bVisible);this.s.dt.aoDrawCallback.push({fn:function(){that._fnDrawCallback.call(that)},sName:"ColVis"}),$(this.s.dt.oInstance).bind("column-reorder.dt",function(e,oSettings,oReorder){for(i=0,iLen=that.s.aiExclude.length;iLen>i;i++)that.s.aiExclude[i]=oReorder.aiInvertMapping[that.s.aiExclude[i]];var mStore=that.s.abOriginal.splice(oReorder.iFrom,1)[0];that.s.abOriginal.splice(oReorder.iTo,0,mStore),that.fnRebuild()}),$(this.s.dt.oInstance).bind("destroy.dt",function(){$(that.dom.wrapper).remove()}),this._fnDrawCallback()},_fnApplyCustomisation:function(init){$.extend(!0,this.s,ColVis.defaults,init),!this.s.showAll&&this.s.bShowAll&&(this.s.showAll=this.s.sShowAll),!this.s.restore&&this.s.bRestore&&(this.s.restore=this.s.sRestore);var groups=this.s.groups,hungarianGroups=this.s.aoGroups;if(groups)for(var i=0,ien=groups.length;ien>i;i++)groups[i].title&&(hungarianGroups[i].sTitle=groups[i].title),groups[i].columns&&(hungarianGroups[i].aiColumns=groups[i].columns)},_fnDrawCallback:function(){for(var button,columns=this.s.dt.aoColumns,buttons=this.dom.buttons,groups=this.s.aoGroups,i=0,ien=buttons.length;ien>i;i++)button=buttons[i],button.__columnIdx!==undefined&&$("input",button).prop("checked",columns[button.__columnIdx].bVisible);for(var allVisible=function(columnIndeces){for(var k=0,kLen=columnIndeces.length;kLen>k;k++)if(columns[columnIndeces[k]].bVisible===!1)return!1;return!0},allHidden=function(columnIndeces){for(var m=0,mLen=columnIndeces.length;mLen>m;m++)if(columns[columnIndeces[m]].bVisible===!0)return!1;return!0},j=0,jLen=groups.length;jLen>j;j++)allVisible(groups[j].aiColumns)?($("input",this.dom.groupButtons[j]).prop("checked",!0),$("input",this.dom.groupButtons[j]).prop("indeterminate",!1)):allHidden(groups[j].aiColumns)?($("input",this.dom.groupButtons[j]).prop("checked",!1),$("input",this.dom.groupButtons[j]).prop("indeterminate",!1)):$("input",this.dom.groupButtons[j]).prop("indeterminate",!0)},_fnAddGroups:function(){var nButton;if("undefined"!=typeof this.s.aoGroups)for(var i=0,iLen=this.s.aoGroups.length;iLen>i;i++)nButton=this._fnDomGroupButton(i),this.dom.groupButtons.push(nButton),this.dom.buttons.push(nButton),this.dom.collection.appendChild(nButton)},_fnAddButtons:function(){var nButton,columns=this.s.dt.aoColumns;if(-1===$.inArray("all",this.s.aiExclude))for(var i=0,iLen=columns.length;iLen>i;i++)-1===$.inArray(i,this.s.aiExclude)&&(nButton=this._fnDomColumnButton(i),nButton.__columnIdx=i,this.dom.buttons.push(nButton));"alpha"===this.s.order&&this.dom.buttons.sort(function(a,b){var titleA=columns[a.__columnIdx].sTitle,titleB=columns[b.__columnIdx].sTitle;return titleA===titleB?0:titleB>titleA?-1:1}),this.s.restore&&(nButton=this._fnDomRestoreButton(),nButton.className+=" ColVis_Restore",this.dom.buttons.push(nButton)),this.s.showAll&&(nButton=this._fnDomShowXButton(this.s.showAll,!0),nButton.className+=" ColVis_ShowAll",this.dom.buttons.push(nButton)),this.s.showNone&&(nButton=this._fnDomShowXButton(this.s.showNone,!1),nButton.className+=" ColVis_ShowNone",this.dom.buttons.push(nButton)),$(this.dom.collection).append(this.dom.buttons)},_fnDomRestoreButton:function(){var that=this,dt=this.s.dt;return $('<li class="ColVis_Special '+(dt.bJUI?"ui-button ui-state-default":"")+'">'+this.s.restore+"</li>").click(function(e){for(var i=0,iLen=that.s.abOriginal.length;iLen>i;i++)that.s.dt.oInstance.fnSetColumnVis(i,that.s.abOriginal[i],!1);that._fnAdjustOpenRows(),that.s.dt.oInstance.fnAdjustColumnSizing(!1),that.s.dt.oInstance.fnDraw(!1)})[0]},_fnDomShowXButton:function(str,action){var that=this,dt=this.s.dt;return $('<li class="ColVis_Special '+(dt.bJUI?"ui-button ui-state-default":"")+'">'+str+"</li>").click(function(e){for(var i=0,iLen=that.s.abOriginal.length;iLen>i;i++)-1===that.s.aiExclude.indexOf(i)&&that.s.dt.oInstance.fnSetColumnVis(i,action,!1);that._fnAdjustOpenRows(),that.s.dt.oInstance.fnAdjustColumnSizing(!1),that.s.dt.oInstance.fnDraw(!1)})[0]},_fnDomGroupButton:function(i){var that=this,dt=this.s.dt,oGroup=this.s.aoGroups[i];return $('<li class="ColVis_Special '+(dt.bJUI?"ui-button ui-state-default":"")+'"><label><input type="checkbox" /><span>'+oGroup.sTitle+"</span></label></li>").click(function(e){var showHide=!$("input",this).is(":checked");"li"!==e.target.nodeName.toLowerCase()&&(showHide=!showHide);for(var j=0;j<oGroup.aiColumns.length;j++)that.s.dt.oInstance.fnSetColumnVis(oGroup.aiColumns[j],showHide)})[0]},_fnDomColumnButton:function(i){var that=this,column=this.s.dt.aoColumns[i],dt=this.s.dt,title=null===this.s.fnLabel?column.sTitle:this.s.fnLabel(i,column.sTitle,column.nTh);return $("<li "+(dt.bJUI?'class="ui-button ui-state-default"':"")+'><label><input type="checkbox" /><span>'+title+"</span></label></li>").click(function(e){var showHide=!$("input",this).is(":checked");"li"!==e.target.nodeName.toLowerCase()&&("input"==e.target.nodeName.toLowerCase()||null===that.s.fnStateChange)&&(showHide=!showHide);var oldIndex=$.fn.dataTableExt.iApiIndex;$.fn.dataTableExt.iApiIndex=that._fnDataTablesApiIndex.call(that),dt.oFeatures.bServerSide?(that.s.dt.oInstance.fnSetColumnVis(i,showHide,!1),that.s.dt.oInstance.fnAdjustColumnSizing(!1),(""!==dt.oScroll.sX||""!==dt.oScroll.sY)&&that.s.dt.oInstance.oApi._fnScrollDraw(that.s.dt),that._fnDrawCallback()):that.s.dt.oInstance.fnSetColumnVis(i,showHide),$.fn.dataTableExt.iApiIndex=oldIndex,null!==that.s.fnStateChange&&("span"==e.target.nodeName.toLowerCase()&&e.preventDefault(),that.s.fnStateChange.call(that,i,showHide))})[0]},_fnDataTablesApiIndex:function(){for(var i=0,iLen=this.s.dt.oInstance.length;iLen>i;i++)if(this.s.dt.oInstance[i]==this.s.dt.nTable)return i;return 0},_fnDomCollection:function(){return $("<ul />",{"class":this.s.dt.bJUI?"ColVis_collection ui-buttonset ui-buttonset-multi":"ColVis_collection"}).css({display:"none",opacity:0,position:this.s.bCssPosition?"":"absolute"})[0]},_fnDomCatcher:function(){var that=this,nCatcher=document.createElement("div");return nCatcher.className="ColVis_catcher",$(nCatcher).click(function(){that._fnCollectionHide.call(that,null,null)}),nCatcher},_fnDomBackground:function(){var that=this,background=$("<div></div>").addClass("ColVis_collectionBackground").css("opacity",0).click(function(){that._fnCollectionHide.call(that,null,null)});return"mouseover"==this.s.activate&&background.mouseover(function(){that.s.overcollection=!1,that._fnCollectionHide.call(that,null,null)}),background[0]},_fnCollectionShow:function(){var iLeft,that=this,oPos=$(this.dom.button).offset(),nHidden=this.dom.collection,nBackground=this.dom.background,iDivX=parseInt(oPos.left,10),iDivY=parseInt(oPos.top+$(this.dom.button).outerHeight(),10);this.s.bCssPosition||(nHidden.style.top=iDivY+"px",nHidden.style.left=iDivX+"px"),$(nHidden).css({display:"block",opacity:0}),nBackground.style.bottom="0px",nBackground.style.right="0px";var oStyle=this.dom.catcher.style;if(oStyle.height=$(this.dom.button).outerHeight()+"px",oStyle.width=$(this.dom.button).outerWidth()+"px",oStyle.top=oPos.top+"px",oStyle.left=iDivX+"px",document.body.appendChild(nBackground),document.body.appendChild(nHidden),document.body.appendChild(this.dom.catcher),$(nHidden).animate({opacity:1},that.s.iOverlayFade),$(nBackground).animate({opacity:.1},that.s.iOverlayFade,"linear",function(){$.browser&&$.browser.msie&&"6.0"==$.browser.version&&that._fnDrawCallback()}),!this.s.bCssPosition){iLeft="left"==this.s.sAlign?iDivX:iDivX-$(nHidden).outerWidth()+$(this.dom.button).outerWidth(),nHidden.style.left=iLeft+"px";var iDivWidth=$(nHidden).outerWidth(),iDocWidth=($(nHidden).outerHeight(),$(document).width());iLeft+iDivWidth>iDocWidth&&(nHidden.style.left=iDocWidth-iDivWidth+"px")}this.s.hidden=!1},_fnCollectionHide:function(){var that=this;this.s.hidden||null===this.dom.collection||(this.s.hidden=!0,$(this.dom.collection).animate({opacity:0},that.s.iOverlayFade,function(e){this.style.display="none"}),$(this.dom.background).animate({opacity:0},that.s.iOverlayFade,function(e){document.body.removeChild(that.dom.background),document.body.removeChild(that.dom.catcher)}))},_fnAdjustOpenRows:function(){for(var aoOpen=this.s.dt.aoOpenRows,iVisible=this.s.dt.oApi._fnVisbleColumns(this.s.dt),i=0,iLen=aoOpen.length;iLen>i;i++)aoOpen[i].nTr.getElementsByTagName("td")[0].colSpan=iVisible}},ColVis.fnRebuild=function(oTable){var nTable=null;"undefined"!=typeof oTable&&(nTable=$.fn.dataTable.Api?new $.fn.dataTable.Api(oTable).table().node():oTable.fnSettings().nTable);for(var i=0,iLen=ColVis.aInstances.length;iLen>i;i++)("undefined"==typeof oTable||nTable==ColVis.aInstances[i].s.dt.nTable)&&ColVis.aInstances[i].fnRebuild()},ColVis.defaults={active:"click",buttonText:"Show / hide columns",aiExclude:[],bRestore:!1,sRestore:"Restore original",bShowAll:!1,sShowAll:"Show All",sAlign:"left",fnStateChange:null,iOverlayFade:500,fnLabel:null,bCssPosition:!1,aoGroups:[],order:"column"},ColVis.aInstances=[],ColVis.prototype.CLASS="ColVis",ColVis.VERSION="1.1.2",ColVis.prototype.VERSION=ColVis.VERSION,"function"==typeof $.fn.dataTable&&"function"==typeof $.fn.dataTableExt.fnVersionCheck&&$.fn.dataTableExt.fnVersionCheck("1.7.0")?$.fn.dataTableExt.aoFeatures.push({fnInit:function(oDTSettings){var init=oDTSettings.oInit,colvis=new ColVis(oDTSettings,init.colVis||init.oColVis||{});return colvis.button()},cFeature:"C",sFeature:"ColVis"}):alert("Warning: ColVis requires DataTables 1.7 or greater - www.datatables.net/download"),$.fn.dataTable.ColVis=ColVis,$.fn.DataTable.ColVis=ColVis,ColVis};"function"==typeof define&&define.amd?define(["jquery","datatables"],factory):"object"==typeof exports?factory(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.ColVis&&factory(jQuery,jQuery.fn.dataTable)}(window,document);