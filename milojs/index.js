!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function Facet(owner,config){this.name=_.firstLowerCase(this.constructor.name),this.owner=owner,this.config=config||{},this.init.apply(this,arguments)}var _=require("milo-core").proto;module.exports=Facet,_.extendProto(Facet,{init:function(){}})},{"milo-core":88}],2:[function(require,module,exports){"use strict";function FacetedObject(){function instantiateFacet(FacetClass,facetName){var fctConfig=facetsConfig[facetName];facets[facetName]=new FacetClass(this,fctConfig),facetsDescriptors[facetName]={enumerable:!0,value:facets[facetName]}}var facetsConfig=this.facetsConfig||{},facetsDescriptors={},facets={};if(this.constructor==FacetedObject)throw new Error("FacetedObject is an abstract class, can't be instantiated");this.facetsClasses&&_.eachKey(this.facetsClasses,instantiateFacet,this,!0),Object.defineProperties(this,facetsDescriptors),_.defineProperty(this,"facets",facets),this.init&&this.init.apply(this,arguments)}function FacetedObject$addFacet(FacetClass,facetConfig,facetName,throwOnErrors){check(FacetClass,Function),check(facetName,Match.Optional(String)),facetName=_.firstLowerCase(facetName||FacetClass.name);var protoFacets=this.constructor.prototype.facetsClasses;if(protoFacets&&protoFacets[facetName])throw new Error("facet "+facetName+" is already part of the class "+this.constructor.name);if(this[facetName]){var message="facet "+facetName+" is already present in object";if(throwOnErrors===!1)return logger.error("FacetedObject addFacet: ",message);throw new Error(message)}var newFacet=this.facets[facetName]=new FacetClass(this,facetConfig);return _.defineProperty(this,facetName,newFacet,_.ENUM),newFacet}function FacetedObject$$hasFacet(facetName){var protoFacets=this.prototype.facetsClasses;return protoFacets&&protoFacets[facetName]}function FacetedObject$$getFacetConfig(facetName){return this.hasFacet(facetName)?this.prototype.facetsConfig[facetName]:null}function FacetedObject$$createFacetedClass(name,facetsClasses,facetsConfig){function addInheritedFacets(superClass,facetsInfo,facetsInfoName){var inheritedFacetsInfo=superClass.prototype[facetsInfoName];return inheritedFacetsInfo?_(inheritedFacetsInfo).clone().extend(facetsInfo||{})._():facetsInfo}check(name,String),check(facetsClasses,Match.Optional(Match.ObjectHash(Match.Subclass(Facet,!0)))),check(facetsConfig,Match.Optional(Object)),facetsConfig&&_.eachKey(facetsConfig,function(fctConfig,fctName){if(!facetsClasses.hasOwnProperty(fctName))throw new Error("configuration for facet ("+fctName+") passed that is not in class")});var FacetedClass=_.createSubclass(this,name,!0);return facetsClasses=addInheritedFacets(this,facetsClasses,"facetsClasses"),facetsConfig=addInheritedFacets(this,facetsConfig,"facetsConfig"),_.extendProto(FacetedClass,{facetsClasses:facetsClasses,facetsConfig:facetsConfig}),FacetedClass}var Facet=require("./facet"),miloCore=require("milo-core"),_=miloCore.proto,logger=miloCore.util.logger,check=miloCore.util.check,Match=check.Match;module.exports=FacetedObject,_.extend(FacetedObject,{createFacetedClass:FacetedObject$$createFacetedClass,hasFacet:FacetedObject$$hasFacet,getFacetConfig:FacetedObject$$getFacetConfig}),_.extendProto(FacetedObject,{addFacet:FacetedObject$addFacet})},{"./facet":1,"milo-core":88}],3:[function(require,module,exports){"use strict";function ClassRegistry(FoundationClass){FoundationClass&&this.setClass(FoundationClass),this.__registeredClasses={}}function add(aClass,name){if(name=name||aClass.name,check(name,Match.IdentifierString,"class name must be identifier string"),!this.FoundationClass)throw new Error("foundation class must be set before adding classes to registry");if(aClass!=this.FoundationClass&&check(aClass,Match.Subclass(this.FoundationClass),"class must be a sub(class) of a foundation class"),this.__registeredClasses[name])throw new Error('class "'+name+'" is already registered');this.__registeredClasses[name]=aClass}function get(name){return check(name,String,"class name must be string"),this.__registeredClasses[name]}function remove(nameOrClass){check(nameOrClass,Match.OneOf(String,Function),"class or name must be supplied");var name="string"==typeof nameOrClass?nameOrClass:nameOrClass.name;if(!this.__registeredClasses[name])throw new Error("class is not registered");delete this.__registeredClasses[name]}function clean(){this.__registeredClasses={}}function setClass(FoundationClass){check(FoundationClass,Function),_.defineProperty(this,"FoundationClass",FoundationClass,_.ENUM)}var miloCore=require("milo-core"),_=miloCore.proto,check=miloCore.util.check,Match=check.Match;module.exports=ClassRegistry,_.extendProto(ClassRegistry,{add:add,get:get,remove:remove,clean:clean,setClass:setClass})},{"milo-core":88}],4:[function(require,module,exports){"use strict";function attrName(){return config.attrs.bind}function parse(){if(this.node){var value=this.get();if(value)var bindTo=value.match(ATTRIBUTE_REGEXP);if(!bindTo)throw new Error("invalid bind attribute "+value);return this.compClass=bindTo[1]||"Component",this.compFacets=bindTo[2]&&bindTo[2].split(FACETS_SPLIT_REGEXP)||void 0,this.compName=bindTo[3]||componentName(),this}}function validate(){if(check(this.compName,Match.IdentifierString),!this.compClass)throw new Error("empty component class name "+this.compClass);return this}function render(){return this.compName=this.compName||componentName(),ATTRIBUTE_TEMPLATE.replace("%compClass",this.compClass||"").replace("%compFacets",this.compFacets&&this.compFacets.length?"["+this.compFacets.join(", ")+"]":"").replace("%compName",this.compName)}function BindAttribute$$setInfo(el,componentClass,componentName,componentFacets){var attr=new BindAttribute(el);_.extend(attr,{compClass:componentClass,compName:componentName,compFacets:componentFacets}),attr.decorate()}var Attribute=require("./a_class"),config=require("../config"),miloCore=require("milo-core"),_=miloCore.proto,check=miloCore.util.check,Match=check.Match,componentName=require("../util/component_name"),ATTRIBUTE_REGEXP=/^([^\:\[\]]*)(?:\[([^\:\[\]]*)\])?\:?([^:]*)$/,FACETS_SPLIT_REGEXP=/\s*(?:\,|\s)\s*/,ATTRIBUTE_TEMPLATE="%compClass%compFacets:%compName",BindAttribute=_.createSubclass(Attribute,"BindAttribute",!0);_.extendProto(BindAttribute,{attrName:attrName,parse:parse,validate:validate,render:render}),_.extend(BindAttribute,{setInfo:BindAttribute$$setInfo}),module.exports=BindAttribute},{"../config":43,"../util/component_name":55,"./a_class":5,"milo-core":88}],5:[function(require,module,exports){"use strict";function Attribute(el,name){this.name=name||this.attrName(),this.el=el,this.node=el.attributes[this.name]}function Attribute$$remove(el,deep){var name=this.prototype.attrName();if(el.removeAttribute(name),deep){var selector="["+name+"]",children=el.querySelectorAll(selector);_.forEach(children,function(childEl){childEl.removeAttribute(name)})}}function Attribute$remove(){delete this.node}function Attribute$destroy(){delete this.el,delete this.node}function Attribute$get(){return this.el.getAttribute(this.name)}function Attribute$set(value){this.el.setAttribute(this.name,value)}function Attribute$decorate(){this.set(this.render())}function toBeImplemented(){throw new Error("calling the method of an absctract class")}var miloCore=require("milo-core"),_=miloCore.proto;module.exports=Attribute,_.extend(Attribute,{remove:Attribute$$remove}),_.extendProto(Attribute,{get:Attribute$get,set:Attribute$set,remove:Attribute$remove,decorate:Attribute$decorate,destroy:Attribute$destroy,attrName:toBeImplemented,parse:toBeImplemented,validate:toBeImplemented,render:toBeImplemented})},{"milo-core":88}],6:[function(require,module,exports){"use strict";function attrName(){return config.attrs.load}function parse(){if(this.node)return this.loadUrl=this.get(),this}function validate(){return this}function render(){return this.loadUrl}var Attribute=require("./a_class"),config=require("../config"),_=require("milo-core").proto,LoadAttribute=_.createSubclass(Attribute,"LoadAttribute",!0);_.extendProto(LoadAttribute,{attrName:attrName,parse:parse,validate:validate,render:render}),module.exports=LoadAttribute},{"../config":43,"./a_class":5,"milo-core":88}],7:[function(require,module,exports){"use strict";function attrName(){return config.attrs.options}function parse(){if(this.node)return this.optionsString=this.get(),this.options=qs.parse(this.optionsString),this}function validate(){return this}function render(){return qs.stringify(this.options)}var Attribute=require("./a_class"),config=require("../config"),_=require("milo-core").proto,qs=require("querystringparser"),OptionsAttribute=_.createSubclass(Attribute,"OptionsAttribute",!0);_.extendProto(OptionsAttribute,{attrName:attrName,parse:parse,validate:validate,render:render}),module.exports=OptionsAttribute},{"../config":43,"./a_class":5,"milo-core":88,querystringparser:123}],8:[function(require,module,exports){"use strict";module.exports={bind:require("./a_bind"),load:require("./a_load"),options:require("./a_options")}},{"./a_bind":4,"./a_load":6,"./a_options":7}],9:[function(require,module,exports){"use strict";function binder(scopeEl,rootScope,bindRootElement,throwOnErrors){return createBinderScope(scopeEl,function(scope,el,attr,throwOnErrors){var info=new ComponentInfo(scope,el,attr,throwOnErrors);return Component.create(info,throwOnErrors)},rootScope,bindRootElement,throwOnErrors)}function twoPass(scopeEl,rootScope,bindRootElement,throwOnErrors){var scanScope=binder.scan(scopeEl,rootScope,bindRootElement,throwOnErrors);return binder.create(scanScope,void 0,throwOnErrors)}function scan(scopeEl,rootScope,bindRootElement,throwOnErrors){return createBinderScope(scopeEl,function(scope,el,attr,throwOnErrors){return new ComponentInfo(scope,el,attr,throwOnErrors)},rootScope,bindRootElement,throwOnErrors)}function create(scanScope,hostObject,throwOnErrors){var scope=new Scope(scanScope._rootEl,hostObject),addMethod=throwOnErrors===!1?"_safeAdd":"_add";return scanScope._each(function(compInfo){var info=_.clone(compInfo);info.scope=scope;var aComponent=Component.create(info,throwOnErrors);scope[addMethod](aComponent,aComponent.name),aComponent.container&&(aComponent.container.scope=create(compInfo.container.scope,aComponent.container,throwOnErrors))}),scope}function createBinderScope(scopeEl,scopeObjectFactory,rootScope,bindRootElement,throwOnErrors){function createScopeForElement(scope,el,bindRootElement){function postChildrenBoundMessage(el){var elComp=Component.getComponent(el);elComp&&(elComp.postMessageSync("childrenbound"),elComp.childrenBound())}var attr=new BindAttribute(el);if(attr.node&&bindRootElement!==!1)var scopedObject=scopeObjectFactory(scope,el,attr,throwOnErrors),isContainer="undefined"!=typeof scopedObject&&scopedObject.container;if(el.childNodes&&el.childNodes.length){if(isContainer){var innerScope=new Scope(el);scopedObject.container.scope=innerScope,innerScope._hostObject=scopedObject.container}createScopeForChildren(el,isContainer?innerScope:scope)}return isContainer&&!scopedObject.container.scope&&(scopedObject.container.scope=new Scope(el)),scopedObject&&scope[addMethod](scopedObject,attr.compName),postChildrenBoundMessage(el),scopedObject}function createScopeForChildren(containerEl,scope){var children=utilDom.children(containerEl);return _.forEach(children,function(node){createScopeForElement(scope,node,!0)}),scope}scopeEl=scopeEl||document.body;var scope=rootScope||new Scope(scopeEl),addMethod=throwOnErrors===!1?"_safeAdd":"_add";return createScopeForElement(scope,scopeEl,bindRootElement),scope}var componentsRegistry=require("./components/c_registry"),Component=componentsRegistry.get("Component"),ComponentInfo=require("./components/c_info"),Scope=require("./components/scope"),BindAttribute=require("./attributes/a_bind"),miloCore=require("milo-core"),_=miloCore.proto,utilDom=require("./util/dom");binder.scan=scan,binder.create=create,binder.twoPass=twoPass,module.exports=binder},{"./attributes/a_bind":4,"./components/c_info":33,"./components/c_registry":34,"./components/scope":42,"./util/dom":59,"milo-core":88}],10:[function(require,module,exports){"use strict";var coreClasses=require("milo-core").classes,classes={Facet:require("./abstract/facet"),FacetedObject:require("./abstract/faceted_object"),Scope:require("./components/scope"),ClassRegistry:require("./abstract/registry"),Mixin:coreClasses.Mixin,MessageSource:coreClasses.MessageSource,MessengerMessageSource:coreClasses.MessengerMessageSource,MessengerAPI:coreClasses.MessengerAPI,DOMEventsSource:require("./components/msg_src/dom_events"),Transaction:require("./command/transaction"),TransactionHistory:require("./command/transaction_history")};module.exports=classes},{"./abstract/facet":1,"./abstract/faceted_object":2,"./abstract/registry":3,"./command/transaction":14,"./command/transaction_history":15,"./components/msg_src/dom_events":40,"./components/scope":42,"milo-core":88}],11:[function(require,module,exports){"use strict";function ActionsHistory(maxLength){this._maxLength=maxLength||1/0,this.actions=[],this.position=0}function ActionsHistory$store(command){if(_truncateToCurrentPosition.call(this),this.actions.push(command),this.actions.length>this._maxLength){var act=this.actions.shift();act.destroy()}return this.position=this.actions.length,this.position-1}function ActionsHistory$deleteLast(){if(this.actions.length){this.position--;var act=this.actions.pop();act.destroy()}}function _truncateToCurrentPosition(){for(var i=this.position;i<this.actions.length;i++)this.actions[i].destroy();this.actions.length=this.position}function ActionsHistory$undo(cb){if(0!==this.position){var act=this.actions[--this.position];return act.undo(cb),act}}function ActionsHistory$redo(cb){if(this.position!=this.actions.length){var act=this.actions[this.position++];return act.redo(cb),act}}function ActionsHistory$nextRedoAction(){return this.actions[this.position]}function ActionsHistory$undoAll(){for(;this.position;)this.undo()}function ActionsHistory$redoAll(){for(;this.position<this.actions.length;)this.redo()}function ActionsHistory$undoAllAsync(cb){this.position&&(this.undo(),this.position?_.deferMethod(this,"undoAllAsync",cb):cb&&_.defer(cb))}function ActionsHistory$redoAllAsync(cb){this.position<this.actions.length&&(this.redo(),this.position<this.actions.length?_.deferMethod(this,"redoAllAsync",cb):cb&&_.defer(cb))}function ActionsHistory$each(funcOrMethod,thisArg){var func="string"==typeof funcOrMethod?function(act){act[funcOrMethod]()}:funcOrMethod;this.actions.forEach(func,thisArg||this)}function ActionsHistory$eachReverse(funcOrMethod,thisArg){this.actions.reverse(),this.each(funcOrMethod,thisArg),this.actions.reverse()}function ActionsHistory$getLastAction(){return this.position&&this.actions[this.position-1]}function ActionsHistory$getDescription(){var actions=this.actions.map(function(act){return act.getDescription()});return{actions:actions,position:this.position,length:actions.length}}var miloCore=require("milo-core"),_=miloCore.proto;module.exports=ActionsHistory,_.extendProto(ActionsHistory,{store:ActionsHistory$store,deleteLast:ActionsHistory$deleteLast,undo:ActionsHistory$undo,redo:ActionsHistory$redo,nextUndoAction:ActionsHistory$getLastAction,nextRedoAction:ActionsHistory$nextRedoAction,undoAll:ActionsHistory$undoAll,redoAll:ActionsHistory$redoAll,undoAllAsync:ActionsHistory$undoAllAsync,redoAllAsync:ActionsHistory$redoAllAsync,each:ActionsHistory$each,eachReverse:ActionsHistory$eachReverse,getLastAction:ActionsHistory$getLastAction,getDescription:ActionsHistory$getDescription})},{"milo-core":88}],12:[function(require,module,exports){"use strict";var ClassRegistry=require("../abstract/registry"),Command=require("./index"),commandsRegistry=new ClassRegistry(Command);commandsRegistry.add(Command),module.exports=commandsRegistry},{"../abstract/registry":3,"./index":13}],13:[function(require,module,exports){"use strict";function Command(func){this.init.apply(this,arguments)}function Command$init(func){check(func,Match.Optional(Function)),this.func=func||function(){},this.args=_.slice(arguments,1)}function Command$execute(cb){var result=this.func.apply(this,this.args);return cb&&_.defer(cb),result}function Command$setUndo(undoCommand){this[UNDO_COMMAND]&&logger.warn("Command setUndo: undo command is already set"),this[UNDO_COMMAND]=undoCommand,undoCommand[UNDO_COMMAND]=this}function Command$getUndo(){return this[UNDO_COMMAND]}function Command$undo(cb){var undoCmd=this.getUndo();if(!undoCmd)return logger.error("Command undo called without undo command present");var result=undoCmd.execute();return cb&&_.defer(cb),result}function Command$setArguments(){this.args&&this.args.length&&logger.warn("Command setArguments: command arguments are already set"),this.args=_.toArray(arguments)}function Command$getArguments(){return this.args}function Command$changeArguments(){this.args=_.toArray(arguments)}function Command$addArguments(){this.args||(this.args=[]),_.appendArray(this.args,arguments)}function Command$$create(func){return _.newApply(this,arguments)}function Command$$createWithUndo(){throw new Error("createWithUndo should be implemented by subsclass")}function Command$destroy(){delete this.func,delete this.args;var undoCmd=this[UNDO_COMMAND];undoCmd&&(delete this[UNDO_COMMAND][UNDO_COMMAND],delete this[UNDO_COMMAND],undoCmd.destroy())}function Command$setComment(comment){this.comment=comment}function Command$getDescription(){return{func:this.func.name,comment:this.comment}}var miloCore=require("milo-core"),_=miloCore.proto,check=miloCore.util.check,Match=check.Match,logger=miloCore.util.logger,UNDO_COMMAND="_undoCommand";module.exports=Command,_.extendProto(Command,{init:Command$init,execute:Command$execute,setUndo:Command$setUndo,getUndo:Command$getUndo,undo:Command$undo,redo:Command$execute,setArguments:Command$setArguments,addArguments:Command$addArguments,getArguments:Command$getArguments,changeArguments:Command$changeArguments,destroy:Command$destroy,setComment:Command$setComment,getDescription:Command$getDescription}),_.extend(Command,{create:Command$$create,createWithUndo:Command$$createWithUndo})},{"milo-core":88}],14:[function(require,module,exports){"use strict";function Transaction(){this.commands=new ActionsHistory}function Transaction$execute(){this.commands.each("execute")}function Transaction$undo(cb){this.commands.undoAllAsync(cb)}function Transaction$redo(cb){this.commands.redoAllAsync(cb)}function Transaction$destroy(){this.commands.each("destroy")}function Transaction$storeCommand(command){this.commands.store(command)}function Transaction$merge(transaction){transaction.commands.each(function(cmd){this.commands.store(cmd)},this),transaction.comment&&(this.comment=transaction.comment)}function Transaction$setComment(comment){this.comment=comment}function Transaction$getDescription(){var commands=this.commands.getDescription();return{commands:commands.actions,comment:this.comment}}var ActionsHistory=require("./actions_history"),_=require("milo-core").proto;module.exports=Transaction,_.extendProto(Transaction,{execute:Transaction$execute,undo:Transaction$undo,redo:Transaction$redo,destroy:Transaction$destroy,storeCommand:Transaction$storeCommand,merge:Transaction$merge,setComment:Transaction$setComment,getDescription:Transaction$getDescription})},{"./actions_history":11,"milo-core":88}],15:[function(require,module,exports){"use strict";function TransactionHistory(maxLength){this.transactions=new ActionsHistory(maxLength),this.currentBatch=void 0,this.currentTransaction=void 0,this[SCHEDULED]=!1}function TransactionHistory$storeCommand(command,appendTransaction){if(appendTransaction&&!this.currentTransaction&&!this.currentBatch){var transaction=this.transactions.getLastAction();return transaction.storeCommand(command),_postTransactionMessage.call(this,"appended",transaction),transaction}return this.currentBatch||(this.currentBatch=new Transaction),this.currentBatch.storeCommand(command),this[SCHEDULED]||(this[SCHEDULED]=!0,_.deferMethod(this,_storeTransaction)),this.currentBatch}function TransactionHistory$deleteLastTransaction(){this.currentBatch||this.currentTransaction?(this.currentBatch=void 0,this.currentTransaction=void 0):this.transactions.deleteLast()}function _storeTransaction(){this.currentBatch?(_addBatchToTransaction.call(this),_.deferMethod(this,_storeTransaction)):(_storeCurrentTransaction.call(this),this[SCHEDULED]=!1)}function TransactionHistory$endTransaction(){_addBatchToTransaction.call(this),_storeCurrentTransaction.call(this)}function _addBatchToTransaction(){this.currentBatch&&(this.currentTransaction||(this.currentTransaction=new Transaction),this.currentTransaction.merge(this.currentBatch),this.currentBatch=void 0)}function _storeCurrentTransaction(){if(this.currentTransaction){var t=this.currentTransaction;this.transactions.store(t),_postTransactionMessage.call(this,"stored",t),this.currentTransaction=void 0}}function TransactionHistory$storeTransaction(transaction){this.endTransaction(),this.transactions.store(transaction),_postTransactionMessage.call(this,"stored",transaction)}function _postTransactionMessage(msg,transaction){this._messenger&&this._messenger.postMessage(msg,{transaction:transaction})}function _postTransactionMessageSync(msg,transaction){this._messenger&&this._messenger.postMessageSync(msg,{transaction:transaction})}function TransactionHistory$undo(cb){var t=this.transactions.nextUndoAction();if(t){_postTransactionMessageSync.call(this,"undoing",t);var self=this;return this.transactions.undo(function(){_postTransactionMessage.call(self,"undone",t),cb&&cb()}),t}}function TransactionHistory$redo(cb){var t=this.transactions.nextRedoAction();if(t){_postTransactionMessageSync.call(this,"redoing",t);var self=this;return this.transactions.redo(function(){_postTransactionMessage.call(self,"redone",t),cb&&cb()}),t}}function TransactionHistory$inTransaction(){return this[SCHEDULED]}function TransactionHistory$getDescription(){return this.transactions.getDescription()}function TransactionHistory$useMessenger(){return this._messenger=new Messenger(this,Messenger.defaultMethods),this._messenger}function TransactionHistory$destroy(){this._messenger&&this._messenger.destroy(),delete this.transactions}var ActionsHistory=require("./actions_history"),Transaction=require("./transaction"),miloCore=require("milo-core"),Messenger=miloCore.Messenger,_=miloCore.proto;module.exports=TransactionHistory;var SCHEDULED="_scheduled";_.extendProto(TransactionHistory,{storeCommand:TransactionHistory$storeCommand,endTransaction:TransactionHistory$endTransaction,storeTransaction:TransactionHistory$storeTransaction,deleteLastTransaction:TransactionHistory$deleteLastTransaction,undo:TransactionHistory$undo,redo:TransactionHistory$redo,inTransaction:TransactionHistory$inTransaction,getDescription:TransactionHistory$getDescription,useMessenger:TransactionHistory$useMessenger,destroy:TransactionHistory$destroy})},{"./actions_history":11,"./transaction":14,"milo-core":88}],16:[function(require,module,exports){"use strict";function Component$$createComponentClass(name,facetsConfig){if(Array.isArray(facetsConfig)){var configMap={};facetsConfig.forEach(function(fct){var fctName=_.firstLowerCase(fct);configMap[fctName]={}}),facetsConfig=configMap}var facetsClasses;"object"==typeof facetsConfig&&_.keys(facetsConfig).length&&(facetsClasses={},_.eachKey(facetsConfig,function(fctConfig,fct){var fctName=_.firstLowerCase(fct),fctClassName=_.firstUpperCase(fct);facetsClasses[fctName]=facetsRegistry.get(fctClassName)}));var ComponentClass=FacetedObject.createFacetedClass.call(this,name,facetsClasses,facetsConfig);return _registerWithDomStorage(name),ComponentClass}function _registerWithDomStorage(className){DOMStorage.registerDataType(className,Component_domStorageSerializer,Component_domStorageParser)}function Component_domStorageSerializer(component){var state=component.getState();return JSON.stringify(state)}function Component_domStorageParser(compStr,compClassName){var state=_.jsonParse(compStr);if(state)return Component.createFromState(state)}function Component$$create(info,throwOnErrors){var ComponentClass=info.ComponentClass;if("function"!=typeof ComponentClass){var message='create: component class should be function, "'+typeof ComponentClass+'" passed';if(throwOnErrors!==!1)throw new Error(message);logger.error("Component",message,";using base Component class instead"),ComponentClass=Component}var aComponent=new ComponentClass(info.scope,info.el,info.name,info);return info.extraFacetsClasses&&_.eachKey(info.extraFacetsClasses,function(FacetClass){aComponent.hasFacet(FacetClass)||aComponent.addFacet(FacetClass,void 0,void 0,throwOnErrors)}),aComponent}function Component$$copy(component,deepCopy){if(check(component,Component),check(deepCopy,Match.Optional(Boolean)),deepCopy&&!component.container)throw new Error("Cannot deep copy component without container facet");var newEl=component.dom?component.dom.copy(deepCopy):component.el.cloneNode(deepCopy),ComponentClass=component.constructor,aComponent=ComponentClass.createOnElement(newEl,void 0,component.scope,component.extraFacets),state=component._getState(deepCopy||!1);return aComponent.setState(state),_.deferMethod(aComponent,"broadcast","stateready"),aComponent}function Component$$createOnElement(el,innerHTML,rootScope,extraFacets){check(innerHTML,Match.Optional(String)),check(rootScope,Match.Optional(Scope)),check(extraFacets,Match.Optional([String])),el&&innerHTML&&(el.innerHTML=innerHTML),el=el||_createComponentElement.call(this,innerHTML),rootScope=rootScope||_findOrCreateComponentRootScope(el);var aComponent=_addAttributeAndBindComponent.call(this,el,rootScope,extraFacets);return aComponent.broadcast("stateready"),aComponent}function _createComponentElement(innerHTML){var Dom=facetsRegistry.get("Dom"),domFacetConfig=this.getFacetConfig("dom"),templateFacetConfig=this.getFacetConfig("template"),template=templateFacetConfig&&templateFacetConfig.template,elConfig={domConfig:domFacetConfig,template:template,content:innerHTML};return Dom.createElement(elConfig)}function _findOrCreateComponentRootScope(el){var parent=Component.getContainingComponent(el,!1,"Container");return parent?parent.container.scope:new Scope(el)}function _addAttributeAndBindComponent(el,rootScope,extraFacets){var attr=new BindAttribute(el);attr.compClass=this.name,attr.compFacets=extraFacets,attr.decorate();var miloBinder=require("../binder");return miloBinder(el,rootScope),rootScope[attr.compName]}function Component$$createFromState(state,rootScope,newUniqueName,throwOnErrors){check(state,Match.ObjectIncluding({compName:Match.Optional(String),compClass:Match.Optional(String),extraFacets:Match.Optional([String]),facetsStates:Match.Optional(Object),outerHTML:String}));var miloBinder=require("../binder"),wrapEl=_createComponentWrapElement(state,newUniqueName),scope=miloBinder(wrapEl,void 0,void 0,throwOnErrors),component=scope._any();return rootScope&&(component.scope=rootScope,rootScope._add(component)),component.setState(state),_.deferMethod(component,"broadcast","stateready"),component}function _createComponentWrapElement(state,newUniqueName){var wrapEl=document.createElement("div");wrapEl.innerHTML=state.outerHTML;var children=domUtils.children(wrapEl);if(1!=children.length)throw new Error("cannot create component: incorrect HTML, elements number: "+children.length+" (should be 1)");var compEl=children[0],attr=new BindAttribute(compEl);return attr.compName=newUniqueName?miloComponentName():state.compName,attr.compClass=state.compClass,attr.compFacets=state.extraFacets,attr.decorate(),wrapEl}function Component$$createFromDataTransfer(dataTransfer){var dataType=_.find(dataTransfer.types,function(type){return COMPONENT_DATA_TYPE_REGEX.test(type)});if(dataType){var state=_.jsonParse(dataTransfer.getData(dataType));if(state)return Component.createFromState(state,void 0,!0)}}function Component$init(scope,element,name,componentInfo){if(this.el=element||this.createElement(),this.el){var elComp=this.el[config.componentRef];elComp&&logger.warn("component "+name+" attached to element that already has component "+elComp.name),this.el[config.componentRef]=this}_.defineProperties(this,{componentInfo:componentInfo,extraFacets:[]},_.ENUM),this.name=name,this.scope=scope;var messenger=new Messenger(this);_.defineProperty(this,MESSENGER_PROPERTY,messenger),this.allFacets("check"),this.allFacets("start"),this.postMessageSync("starting"),this.start&&this.start()}function Component$start(){}function Component$childrenBound(){}function Component$createElement(){if("undefined"!=typeof document)return this.el=this.dom?this.dom.createElement():document.createElement("DIV"),this.el}function Component$hasFacet(facetNameOrClass){var facetName=_.firstLowerCase("function"==typeof facetNameOrClass?facetNameOrClass.name:facetNameOrClass),facet=this[facetName];return!facet instanceof ComponentFacet&&logger.warn("expected facet",facetName,"but this property name is used for something else"),!!facet}function Component$addFacet(facetNameOrClass,facetConfig,facetName,throwOnErrors){check(facetNameOrClass,Match.OneOf(String,Match.Subclass(ComponentFacet))),check(facetConfig,Match.Optional(Object)),check(facetName,Match.Optional(String));var FacetClass;if("string"==typeof facetNameOrClass){var facetClassName=_.firstUpperCase(facetNameOrClass);FacetClass=facetsRegistry.get(facetClassName)}else FacetClass=facetNameOrClass;facetName||(facetName=_.firstLowerCase(FacetClass.name)),this.extraFacets.push(facetName);var newFacet=FacetedObject.prototype.addFacet.call(this,FacetClass,facetConfig,facetName,throwOnErrors);newFacet.check&&newFacet.check(),newFacet.start&&newFacet.start()}function Component$allFacets(method){var args=_.slice(arguments,1);return _.mapKeys(this.facets,function(facet,fctName){if(facet&&"function"==typeof facet[method])return facet[method].apply(facet,args)})}function Component$rename(name,renameInScope){name=name||miloComponentName(),this.componentInfo.rename(name,!1),Scope.rename(this,name,renameInScope)}function Component$remove(preserveScopeProperty,quiet){this.scope&&(this.scope._remove(this.name,quiet),preserveScopeProperty||delete this.scope)}function Component$insertInto(parentEl,referenceEl){parentEl.insertBefore(this.el,referenceEl),this.setScopeParentFromDOM()}function Component$getState(){this.broadcast("getstatestarted",{rootComponent:this},void 0,!0);var state=this._getState(!0);return state.outerHTML=this.el.outerHTML,_.deferMethod(this,"broadcast","getstatecompleted",{rootComponent:this},void 0,!0),state}function Component$getTransferState(options){return this.transfer?this.transfer.getState(options):this.getState(options)}function Component$_getState(deepState){var facetsStates=this.allFacets("getState",deepState!==!1);return facetsStates=_.filterKeys(facetsStates,function(fctState){return!!fctState}),{compName:this.name,compClass:this.constructor.name,extraFacets:this.extraFacets,facetsStates:facetsStates}}function Component$setState(state){state.facetsStates&&_.eachKey(state.facetsStates,function(fctState,fctName){var facet=this[fctName];facet&&"function"==typeof facet.setState&&facet.setState(fctState)},this)}function Component$getScopeParent(conditionOrFacet){return _callGetScopeParent.call(this,_getScopeParent,conditionOrFacet)}function _callGetScopeParent(_getScopeParentFunc,conditionOrFacet){check(conditionOrFacet,Match.Optional(Match.OneOf(Function,String)));var conditionFunc=componentUtils._makeComponentConditionFunc(conditionOrFacet);
return _getScopeParentFunc.call(this,conditionFunc)}function _getScopeParent(conditionFunc){var parent;try{parent=this.scope._hostObject.owner}catch(e){}if(parent)return!conditionFunc||conditionFunc(parent)?parent:_getScopeParent.call(parent,conditionFunc)}function Component$getScopeParentWithClass(ComponentClass){return"string"==typeof ComponentClass&&(ComponentClass=milo.registry.components.get(ComponentClass)),ComponentClass=ComponentClass||this.constructor,_getScopeParent.call(this,function(comp){return comp instanceof ComponentClass})}function Component$getTopScopeParent(conditionOrFacet){return _callGetScopeParent.call(this,_getTopScopeParent,conditionOrFacet)}function _getTopScopeParent(conditionFunc){var topParent,parent=this;do parent=_getScopeParent.call(parent,conditionFunc),parent&&(topParent=parent);while(parent);return topParent}function Component$getTopScopeParentWithClass(ComponentClass){return ComponentClass=ComponentClass||this.constructor,_getTopScopeParent.call(this,function(comp){return comp instanceof ComponentClass})}function Component$setScopeParentFromDOM(){for(var parent,foundParent,parentEl=this.el.parentNode;parentEl&&!foundParent;)parent=Component.getComponent(parentEl),foundParent=parent&&parent.container,parentEl=parentEl.parentNode;if(this.remove(),foundParent)return this.rename(void 0,!1),parent.container.scope._add(this),parent}function Component$walkScopeTree(callback,thisArg){callback.call(thisArg,this),this.container&&this.container.scope._each(function(component){component.walkScopeTree(callback,thisArg)})}function Component$treePathOf(component){return domUtils.treePathOf(this.el,component.el)}function Component$getComponentAtTreePath(treePath,nearest){var node=domUtils.getNodeAtTreePath(this.el,treePath,nearest);return Component.getComponent(node)}function Component$insertAtTreePath(treePath,component,nearest){var wasInserted=domUtils.insertAtTreePath(this.el,treePath,component.el,nearest);return wasInserted&&component.setScopeParentFromDOM(),wasInserted}function Component$broadcast(msg,data,callback,synchronously){var postMethod=synchronously?"postMessageSync":"postMessage";this.walkScopeTree(function(component){component[postMethod](msg,data,callback)})}function Component$destroy(opts){return"boolean"==typeof opts?opts={quiet:opts}:opts||(opts={}),this._destroyed?void(opts.quiet||logger.warn("Component destroy: component is already destroyed")):(this.remove(!1,opts.quiet),this.allFacets("destroy",opts),this[MESSENGER_PROPERTY].destroy(),this.el&&(domUtils.detachComponent(this.el),domUtils.removeElement(this.el),delete this.el),this.componentInfo.destroy(),void(this._destroyed=!0))}function Component$isDestroyed(){return!!this._destroyed}var FacetedObject=require("../abstract/faceted_object"),facetsRegistry=require("./c_facets/cf_registry"),ComponentFacet=facetsRegistry.get("ComponentFacet"),componentUtils=require("./c_utils"),miloCore=require("milo-core"),Messenger=miloCore.Messenger,_=miloCore.proto,check=miloCore.util.check,Match=check.Match,config=require("../config"),miloComponentName=require("../util/component_name"),logger=miloCore.util.logger,domUtils=require("../util/dom"),BindAttribute=require("../attributes/a_bind"),Scope=require("./scope"),DOMStorage=require("../util/storage"),Component=_.createSubclass(FacetedObject,"Component",!0);module.exports=Component,_registerWithDomStorage("Component"),_.extend(Component,{createComponentClass:Component$$createComponentClass,create:Component$$create,copy:Component$$copy,createOnElement:Component$$createOnElement,isComponent:componentUtils.isComponent,getComponent:componentUtils.getComponent,getContainingComponent:componentUtils.getContainingComponent,createFromState:Component$$createFromState,createFromDataTransfer:Component$$createFromDataTransfer}),delete Component.createFacetedClass,_.extendProto(Component,{init:Component$init,start:Component$start,childrenBound:Component$childrenBound,createElement:Component$createElement,hasFacet:Component$hasFacet,addFacet:Component$addFacet,allFacets:Component$allFacets,rename:Component$rename,remove:Component$remove,insertInto:Component$insertInto,getState:Component$getState,getTransferState:Component$getTransferState,_getState:Component$_getState,setState:Component$setState,getScopeParent:Component$getScopeParent,getTopScopeParent:Component$getTopScopeParent,getScopeParentWithClass:Component$getScopeParentWithClass,getTopScopeParentWithClass:Component$getTopScopeParentWithClass,setScopeParentFromDOM:Component$setScopeParentFromDOM,walkScopeTree:Component$walkScopeTree,treePathOf:Component$treePathOf,getComponentAtTreePath:Component$getComponentAtTreePath,insertAtTreePath:Component$insertAtTreePath,broadcast:Component$broadcast,destroy:Component$destroy,isDestroyed:Component$isDestroyed});var MESSENGER_PROPERTY="_messenger";Messenger.useWith(Component,MESSENGER_PROPERTY,Messenger.defaultMethods);var COMPONENT_DATA_TYPE_REGEX=/x-application\/milo-component\/([a-z_$][0-9a-z_$]*)(?:\/())/i},{"../abstract/faceted_object":2,"../attributes/a_bind":4,"../binder":9,"../config":43,"../util/component_name":55,"../util/dom":59,"../util/storage":69,"./c_facets/cf_registry":32,"./c_utils":35,"./scope":42,"milo-core":88}],17:[function(require,module,exports){"use strict";function ComponentFacet$init(){this._createMessenger()}function _createMessenger(){_.defineProperty(this,MESSENGER_PROPERTY,new Messenger(this))}function ComponentFacet$start(){this.config.messages&&this.onConfigMessages(this.config.messages)}function ComponentFacet$onConfigMessages(messageSubscribers){var notYetRegisteredMap=_.mapKeys(messageSubscribers,function(subscriber,messages){var subscriberType=typeof subscriber;if("function"==subscriberType)return this.on(messages,subscriber);if("object"==subscriberType){var contextType=typeof subscriber.context;if("object"==contextType)return this.on(messages,subscriber);if("string"==contextType){if(subscriber.context==this.name||"facet"==subscriber.context)subscriber={subscriber:subscriber.subscriber,context:this};else{if("owner"!=subscriber.context)throw new Error("unknown subscriber context in configuration: "+subscriber.context);subscriber={subscriber:subscriber.subscriber,context:this.owner}}return this.on(messages,subscriber)}throw new Error("unknown subscriber context type in configuration: "+contextType)}throw new Error("unknown subscriber type in configuration: "+subscriberType)},this);return notYetRegisteredMap}function ComponentFacet$check(){if(this.require&&this.require.forEach(function(reqFacet){this.owner.hasFacet(reqFacet)||this.owner.addFacet(reqFacet)},this),this.configSchema)try{milo.util.check(this.config,this.configSchema)}catch(e){throw'Error validating config schema for "'+this.name+'" facet: '+e}}function ComponentFacet$destroy(){this[MESSENGER_PROPERTY]&&this[MESSENGER_PROPERTY].destroy(),this._destroyed=!0}function domParent(){var parentComponent=componentUtils.getContainingComponent(this.owner.el,!1,this.name);return parentComponent&&parentComponent[this.name]}function scopeParent(){var parentComponent=this.owner.getScopeParent(this.name);return parentComponent&&parentComponent[this.name]}function _postParent(getParentMethod,messageType,messageData){var parentFacet=getParentMethod.call(this);parentFacet&&parentFacet.postMessage(messageType,messageData)}function _setMessageSource(messageSource){this[MESSENGER_PROPERTY]._setMessageSource(messageSource)}function getMessageSource(){return this[MESSENGER_PROPERTY].getMessageSource()}function dispatchSourceMessage(message,data){return this.getMessageSource().dispatchMessage(message,data)}function _createMessageSource(MessageSourceClass,options){var messageSource=new MessageSourceClass(this,void 0,void 0,this.owner,options);this._setMessageSource(messageSource),_.defineProperty(this,"_messageSource",messageSource)}function _createMessageSourceWithAPI(MessageSourceClass,messengerAPIOrClass,options){var messageSource=new MessageSourceClass(this,void 0,messengerAPIOrClass,this.owner,options);this._setMessageSource(messageSource),_.defineProperty(this,"_messageSource",messageSource)}function requiresFacet(facetName){var facetRequire=this.prototype.require;return facetRequire&&(facetRequire.indexOf(_.firstUpperCase(facetName))>=0||facetRequire.indexOf(_.firstLowerCase(facetName))>=0)}var Facet=require("../abstract/facet"),miloCore=require("milo-core"),Messenger=miloCore.Messenger,componentUtils=require("./c_utils"),_=miloCore.proto,ComponentFacet=_.createSubclass(Facet,"ComponentFacet");module.exports=ComponentFacet;var postDomParent=_.partial(_postParent,domParent),postScopeParent=_.partial(_postParent,scopeParent);_.extendProto(ComponentFacet,{init:ComponentFacet$init,start:ComponentFacet$start,check:ComponentFacet$check,destroy:ComponentFacet$destroy,onConfigMessages:ComponentFacet$onConfigMessages,domParent:domParent,postDomParent:postDomParent,scopeParent:scopeParent,postScopeParent:postScopeParent,getMessageSource:getMessageSource,dispatchSourceMessage:dispatchSourceMessage,_createMessenger:_createMessenger,_setMessageSource:_setMessageSource,_createMessageSource:_createMessageSource,_createMessageSourceWithAPI:_createMessageSourceWithAPI}),_.extend(ComponentFacet,{requiresFacet:requiresFacet});var MESSENGER_PROPERTY="_messenger";Messenger.useWith(ComponentFacet,MESSENGER_PROPERTY,Messenger.defaultMethods)},{"../abstract/facet":1,"./c_utils":35,"milo-core":88}],18:[function(require,module,exports){"use strict";function Container$binder(){return miloBinder(this.owner.el,this.scope,!1)}function Container$start(){ComponentFacet.prototype.start.apply(this,arguments),this.scope=new Scope(this.owner.el,this)}function Container$path(path){function throwInvalidPath(){throw new Error("path "+path+" is invalid")}path=path.split(".");var len=path.length;(path[0]||len<2)&&throwInvalidPath();for(var comp=this.owner,i=1;i<len;i++){var name=path[i];if(allowedNamePattern.test(name)||throwInvalidPath(),!comp.container)return;if(comp=comp.container.scope[name],!comp)return}return comp}function Container$getState(deepCopy){var state={scope:{}};return deepCopy!==!1&&this.scope._each(function(component,compName){state.scope[compName]=component._getState()}),state}function Container$setState(state){_.eachKey(state.scope,function(compData,compName){var component=this.scope[compName];component?component.setState(compData):logger.warn('component "'+compName+'" does not exist on scope')},this)}function Container$destroy(opts){this.scope._each(function(component){opts.async?_.deferMethod(component,"destroy",opts):component.destroy(opts)}),this.scope._detachElement(),ComponentFacet.prototype.destroy.apply(this,arguments)}function Container$unwrap(renameChildren,destroy){domUtils.unwrapElement(this.owner.el),this.scope&&this.scope._each(function(child){child.remove(),renameChildren!==!1&&child.rename(void 0,!1),this.owner.scope&&this.owner.scope._add(child)},this),destroy!==!1&&this.owner.destroy()}function Container$append(comp){this.scope._add(comp),this.owner.el.appendChild(comp.el)}function Container$insertBefore(comp,sibling){this.scope._add(comp),this.owner.el.insertBefore(comp.el,sibling&&sibling.el)}function Container$remove(comp){this.scope._remove(comp.name),this.owner.el.removeChild(comp.el)}var ComponentFacet=require("../c_facet"),miloBinder=require("../../binder"),Scope=require("../scope"),miloCore=require("milo-core"),_=miloCore.proto,logger=miloCore.util.logger,facetsRegistry=require("./cf_registry"),domUtils=require("../../util/dom"),Container=_.createSubclass(ComponentFacet,"Container");_.extendProto(Container,{start:Container$start,path:Container$path,getState:Container$getState,setState:Container$setState,binder:Container$binder,destroy:Container$destroy,unwrap:Container$unwrap,append:Container$append,insertBefore:Container$insertBefore,remove:Container$remove}),facetsRegistry.add(Container),module.exports=Container;var allowedNamePattern=/^[A-Za-z][A-Za-z0-9\_\$]*$/},{"../../binder":9,"../../util/dom":59,"../c_facet":17,"../scope":42,"./cf_registry":32,"milo-core":88}],19:[function(require,module,exports){"use strict";function CssFacet$start(){CssFacet.super.start.apply(this,arguments),setupClassList.call(this),this.owner.on("starting",{subscriber:setupBinding,context:this}),modelUtils.path.wrapMessengerMethods.call(this),this.onSync("changedata",modelUtils.changeDataHandler),this.activeModelPaths={}}function setupClassList(){var getClassList=this.config.getClassList;this._classList=getClassList&&getClassList.call(this)||this.owner.el.classList}function setupBinding(){var bindingConfig=this.config.binding;if(bindingConfig){check(bindingConfig,{facetName:Match.Optional(String),getDataSource:Match.Optional(Function),depth:Match.Optional(String)});var facetName=bindingConfig.facetName,getDataSource=bindingConfig.getDataSource,depth=bindingConfig.depth;if(facetName){var facet=this.owner[facetName],facetDs="data"==facetName?facet:facet.m;this._facetBinding=milo.minder(facetDs,depth||"->>",this)}if(getDataSource){var ds=getDataSource.call(this.owner);this._dataSourceBinding=milo.minder(ds,depth||"->>",this)}}}function CssFacet$set(data){function _processProperties(path,data){_.eachKey(data,function(value,prop){var modelPath=path+("."!==prop.charAt(0)?"."+prop:prop);self.update(modelPath,value),"object"==typeof value&&null!==value&&Object.keys(value).length>0&&_processProperties(modelPath,value)})}if(check(data,Match.OneOf(Object,null,void 0)),data){var self=this;_processProperties("",data)}else this.del()}function CssFacet$del(){var classList=this._classList;_.eachKey(this.activeModelPaths,function(modelPaths,cssClass){modelPaths.clear(),classList.remove(cssClass)})}function CssFacet$path(modelPath){return modelPath?this.config.classes&&this.config.classes[modelPath]?new Path(this,modelPath):null:this}function CssFacet$update(modelPath,value){var cssConfig=this.config.classes[modelPath];if(cssConfig){var handler=updateHandlers[typeof cssConfig];handler.call(this,modelPath,cssConfig,value),this.postMessageSync("changed",{modelPath:modelPath,modelValue:value})}}function CssFacet$destroy(){CssFacet.super.destroy.apply(this,arguments),this._dataSourceBinding&&milo.minder.destroyConnector(this._dataSourceBinding),this._facetBinding&&milo.minder.destroyConnector(this._facetBinding),delete this._dataSourceBinding,delete this._facetBinding}function updateSimple(modelPath,cssClass,data){var classList=this._classList;if(_.eachKey(this.activeModelPaths,function(modelPaths,cssClass){modelPaths.has(modelPath)&&(modelPaths.delete(modelPath),0===modelPaths.size&&classList.remove(cssClass))}),cssClass&&data){cssClass=data?cssClass.replace(/\$/g,data):cssClass;var modelPaths=this.activeModelPaths[cssClass]||(this.activeModelPaths[cssClass]=new Set);modelPaths.add(modelPath),classList.add(cssClass)}}function updateByObject(modelPath,cssClasses,value){var cssClass=cssClasses[value];updateSimple.call(this,modelPath,cssClass,value)}function updateByFunction(modelPath,getCssClassFn,data){var cssClass=getCssClassFn.call(this,data);updateSimple.call(this,modelPath,cssClass,!0)}function Path(cssFacet,modelPath){this.cssFacet=cssFacet,this.modelPath=modelPath}var miloCore=require("milo-core"),_=miloCore.proto,check=miloCore.util.check,Match=check.Match,modelUtils=miloCore.Model._utils,createFacetClass=require("../../util/create_facet_class"),CssFacet=module.exports=createFacetClass({className:"Css",methods:{start:CssFacet$start,set:CssFacet$set,del:CssFacet$del,path:CssFacet$path,update:CssFacet$update,destroy:CssFacet$destroy}}),updateHandlers={string:updateSimple,object:updateByObject,function:updateByFunction};Path.prototype.set=function(value){this.cssFacet.update(this.modelPath,value)},Path.prototype.del=function(){this.set(null)}},{"../../util/create_facet_class":57,"milo-core":88}],20:[function(require,module,exports){"use strict";function Data$start(){pathUtils.wrapMessengerMethods.call(this),ComponentFacet.prototype.start.apply(this,arguments),this.elData=getElementDataAccess(this.owner.el),this._dataChangesQueue=[],this._prepareMessageSource(),this._path="."+this.owner.name,this._value=this.get(),this.onSync("",onOwnDataChange),this.onSync("datachangesfinished",onDataChangesFinished),this.onSync("childdata",onChildData),this.onSync("changedata",changeDataHandler)}function _prepareMessageSource(){var dataAPI=new DataMsgAPI(this.owner),dataEventsSource=new DOMEventsSource(this,proxyDataSourceMethods,dataAPI,this.owner);this._setMessageSource(dataEventsSource),_.defineProperty(this,"_dataEventsSource",dataEventsSource),Mixin.prototype._createProxyMethod.call(dataAPI,"value","value",this)}function onOwnDataChange(msgType,data){if(this._bubbleUpDataChange(data),this._queueDataChange(data),""===data.path){var inTransaction=getTransactionFlag(data);this.postMessage("datachangesfinished",{transaction:inTransaction})}}function Data$_bubbleUpDataChange(msgData){var parentData=this.scopeParent();if(parentData){var parentMsg=_.clone(msgData);parentMsg.path=(this._path||"."+this.owner.name)+parentMsg.path,parentData.postMessage("childdata",parentMsg||msgData)}}function Data$_queueDataChange(change){this._dataChangesQueue.push(change)}function onDataChangesFinished(msg,data){this._postDataChanges(data.inTransaction);var parentData=this.scopeParent();parentData&&parentData.postMessage("datachangesfinished",data)}function Data$_postDataChanges(inTransaction){var queue=this._dataChangesQueue.reverse();this.postMessageSync("datachanges",{changes:queue,transaction:inTransaction}),this._dataChangesQueue=[]}function onChildData(msgType,data){this.postMessage(data.path,data),this._bubbleUpDataChange(data),this._queueDataChange(data)}function Data$set(value){var inTransaction=getTransactionFlag(Data$set);try{return executeHook.call(this,"set",arguments)}catch(e){if(e!=noHook)throw e}setTransactionFlag(this._set,inTransaction);var oldValue=this._value,newValue=this._set(value),msg={path:"",type:"changed",newValue:newValue,oldValue:oldValue};return setTransactionFlag(msg,inTransaction),this.postMessage("",msg),newValue}function Data$_set(value){function setChildData(valueSet,childValue,key,pathSyntax){var childPath=pathSyntax.replace("$$",key),childDataFacet=this.path(childPath,"undefined"!=typeof childValue);childDataFacet&&(setTransactionFlag(childDataFacet.set,inTransaction),valueSet[key]=childDataFacet.set(childValue))}var valueSet,inTransaction=getTransactionFlag(Data$_set);if(null!==value&&"object"==typeof value)if(Array.isArray(value)){valueSet=[];var listFacet=this.owner.list;if(listFacet){var listLength=listFacet.count(),newItemsCount=value.length-listLength;newItemsCount>=3&&(listFacet._addItems(newItemsCount),listFacet._updateDataPaths(listLength,listFacet.count())),value.forEach(function(childValue,index){setChildData.call(this,valueSet,childValue,index,"[$$]")},this);for(var listCount=listFacet.count(),removeCount=listCount-value.length;removeCount-- >0;)listFacet._removeItem(value.length)}else logger.warn("Data: setting array data without List facet")}else valueSet={},_.eachKey(value,function(childValue,key){setChildData.call(this,valueSet,childValue,key,".$$")},this);else valueSet=this._setScalarValue(value);return this._value=valueSet,valueSet}function Data$del(){var inTransaction=getTransactionFlag(Data$del);try{var result=executeHook.call(this,"del");return postTransactionFinished.call(this,inTransaction),result}catch(e){if(e!=noHook)throw e}var oldValue=this._value;setTransactionFlag(this._del,inTransaction),this._del();var msg={path:"",type:"deleted",oldValue:oldValue};setTransactionFlag(msg,inTransaction),this.postMessage("",msg)}function Data$_del(){var inTransaction=getTransactionFlag(Data$_del);setTransactionFlag(this._set,inTransaction),this._set()}function Data$_setScalarValue(value){return this.elData.set(this.owner.el,value)}function Data$get(deepGet){try{return executeHook.call(this,"get",arguments)}catch(e){if(e!=noHook)throw e}return this._get(deepGet)}function Data$_get(deepGet){if(deepGet!==!1){var scopeData,comp=this.owner;return comp.list?(scopeData=[],comp.list.each(function(listItem,index){scopeData[index]=listItem.data.get()}),comp.container&&comp.container.scope._each(function(scopeItem,name){!comp.list.contains(scopeItem)&&scopeItem.data&&(scopeData[name]=scopeItem.data.get())})):comp.container?(scopeData={},comp.container.scope._each(function(scopeItem,name){scopeItem.data&&(scopeData[name]=scopeItem.data.get())})):scopeData=this._getScalarValue(),this._value=scopeData,scopeData}}function Data$_getScalarValue(){return this.elData.get(this.owner.el)}function Data$splice(spliceIndex,spliceHowMany){var result,inTransaction=getTransactionFlag(Data$splice);try{return result=executeHook.call(this,"splice",arguments),postTransactionFinished.call(this,inTransaction),result}catch(e){if(e!=noHook)throw e}if(setTransactionFlag(this._splice,inTransaction),result=this._splice.apply(this,arguments)){var msg={path:"",type:"splice",index:result.spliceIndex,removed:result.removed,addedCount:result.addedCount,newValue:this._value};return setTransactionFlag(msg,inTransaction),this.postMessage("",msg),result.removed}}function executeHook(methodName,args){var hook=this.config[methodName];switch(typeof hook){case"function":return hook.apply(this.owner,args);case"string":return this.owner[hook].apply(this.owner,args);default:throw noHook}}function Data$_splice(spliceIndex,spliceHowMany){var inTransaction=getTransactionFlag(Data$_splice),listFacet=this.owner.list;if(!listFacet)return logger.warn("Data: cannot use splice method without List facet");var removed=[],listLength=listFacet.count();if(arguments[0]=spliceIndex=modelUtils.normalizeSpliceIndex(spliceIndex,listLength),spliceHowMany>0&&listLength>0){for(var i=spliceIndex;i<spliceIndex+spliceHowMany;i++){var item=listFacet.item(spliceIndex);if(item){var itemData=item.data.get();listFacet._removeItem(spliceIndex)}else logger.warn("Data: no item for index",i);removed.push(itemData)}listFacet._updateDataPaths(spliceIndex,listFacet.count())}var added=[],argsLen=arguments.length,addItems=argsLen>2,addedCount=argsLen-2;if(addItems){listFacet._addItems(addedCount,spliceIndex);for(var i=2,j=spliceIndex;i<argsLen;i++,j++)item=listFacet.item(j),item?(setTransactionFlag(item.data.set,inTransaction),itemData=item.data.set(arguments[i])):logger.warn("Data: no item for index",j),added.push(itemData);listFacet._updateDataPaths(spliceIndex,listFacet.count())}return this._value=this.get(),{spliceIndex:spliceIndex,removed:removed,addedCount:addItems?addedCount:0}}function Data$len(){try{return executeHook.call(this,"len")}catch(e){if(e!=noHook)throw e}return this._len()}function Data$_len(){return this.owner.list?this.owner.list.count():void logger.error("Data: len called without list facet")}function Data$path(accessPath,createItem){if(!accessPath)return this;for(var parsedPath=pathUtils.parseAccessPath(accessPath),currentComponent=this.owner,i=0,len=parsedPath.length;i<len;i++){var pathNode=parsedPath[i],nodeKey=pathUtils.getPathNodeKey(pathNode);if("array"==pathNode.syntax&&currentComponent.list){var itemComponent=currentComponent.list.item(nodeKey);itemComponent||createItem===!1||(itemComponent=currentComponent.list._addItem(nodeKey),itemComponent.data._path=pathNode.property),currentComponent=itemComponent}else currentComponent.container&&(currentComponent=currentComponent.container.scope[nodeKey]);var currentDataFacet=currentComponent&&currentComponent.data;if(!currentDataFacet)break}return currentDataFacet}function Data$getPath(){return this._path}function Data$getKey(){var path=this._path;return"["==path[0]?+path.slice(1,-1):path.slice(1)}function Data$getState(deepState){return{state:this.get(deepState)}}function Data$setState(state){var el=this.owner.el,setterProperty=getElementDataAccess(el).property(el);if("innerHTML"!=setterProperty)return this.set(state.state)}var miloCore=require("milo-core"),Mixin=miloCore.classes.Mixin,ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),DOMEventsSource=require("../msg_src/dom_events"),DataMsgAPI=require("../msg_api/data"),getElementDataAccess=require("../msg_api/de_data"),Model=miloCore.Model,pathUtils=Model._utils.path,modelUtils=Model._utils.model,changeDataHandler=Model._utils.changeDataHandler,getTransactionFlag=changeDataHandler.getTransactionFlag,setTransactionFlag=changeDataHandler.setTransactionFlag,postTransactionFinished=changeDataHandler.postTransactionFinished,_=miloCore.proto,logger=miloCore.util.logger,Data=_.createSubclass(ComponentFacet,"Data");_.extendProto(Data,{start:Data$start,getState:Data$getState,setState:Data$setState,get:Data$get,set:Data$set,del:Data$del,splice:Data$splice,len:Data$len,path:Data$path,getPath:Data$getPath,getKey:Data$getKey,_get:Data$_get,_set:Data$_set,_del:Data$_del,_splice:Data$_splice,_len:Data$_len,_setScalarValue:Data$_setScalarValue,_getScalarValue:Data$_getScalarValue,_bubbleUpDataChange:Data$_bubbleUpDataChange,_queueDataChange:Data$_queueDataChange,_postDataChanges:Data$_postDataChanges,_prepareMessageSource:_prepareMessageSource}),facetsRegistry.add(Data),module.exports=Data,["push","pop","unshift","shift"].forEach(function(methodName){var method=Model.Path.prototype[methodName];_.defineProperty(Data.prototype,methodName,method)});var proxyDataSourceMethods={trigger:"trigger"},noHook={}},{"../c_facet":17,"../msg_api/data":37,"../msg_api/de_data":38,"../msg_src/dom_events":40,"./cf_registry":32,"milo-core":88}],21:[function(require,module,exports){"use strict";function Dom$$createElement(config){var domConfig=config.domConfig||{},tagName=domConfig.tagName||"div",newEl=document.createElement(tagName),content=config.content,template=config.template;return _applyConfigToElement(newEl,domConfig),"string"==typeof content&&(template?newEl.innerHTML=doT.template(template)({content:content}):newEl.innerHTML=content),newEl}function _applyConfigToElement(el,config){var cssClasses=config&&config.cls,configAttributes=config&&config.attributes;configAttributes&&_.eachKey(configAttributes,function(attrValue,attrName){el.setAttribute(attrName,attrValue)}),cssClasses&&_attachCssClasses(el,"add",cssClasses)}function start(){ComponentFacet.prototype.start.apply(this,arguments);var el=this.owner.el;_applyConfigToElement(el,this.config);var currentStyle=window.getComputedStyle(el);this._visible=currentStyle&&"none"!=currentStyle.display}function show(){this.toggle(!0)}function hide(){this.toggle(!1)}function toggle(doShow){doShow="undefined"==typeof doShow?!this._visible:!!doShow,this._visible=doShow;var el=this.owner.el;return el.style.display=doShow?"block":"none",doShow}function _manageCssClasses(methodName,cssClasses,enforce){_attachCssClasses(this.owner.el,methodName,cssClasses,enforce)}function _attachCssClasses(el,methodName,cssClasses,enforce){function callMethod(cssCls){doToggle?void 0===enforce?classList[methodName](cssCls):classList[methodName](cssCls,enforce):classList[methodName](cssCls)}var classList=el.classList,doToggle="toggle"==methodName;if(Array.isArray(cssClasses))cssClasses.forEach(callMethod);else{if("string"!=typeof cssClasses)throw new Error("unknown type of CSS classes parameter");callMethod(cssClasses)}}function detach(){this.owner.el&&domUtils.detachComponent(this.owner.el)}function setStyle(property,value){if(!this.owner.el)throw new Error("Cannot call setStyle on owner with no element: "+this.owner.constructor.name);this.owner.el.style[property]=value}function setStyles(properties){for(var property in properties)this.owner.el.style[property]=properties[property]}function copy(isDeep){return this.owner.el&&this.owner.el.cloneNode(isDeep)}function createElement(){var newEl=Dom.createElement(this.config);return newEl}function remove(){domUtils.removeElement(this.owner.el)}function append(el){this.owner.el.appendChild(el)}function prepend(el){var thisEl=this.owner.el,firstChild=thisEl.firstChild;firstChild?thisEl.insertBefore(el,firstChild):thisEl.appendChild(el)}function appendChildren(el){for(;el.childNodes.length;)this.append(el.childNodes[0])}function prependChildren(el){for(;el.childNodes.length;)this.prepend(el.childNodes[el.childNodes.length-1])}function insertAfter(el){var thisEl=this.owner.el,parent=thisEl.parentNode;parent.insertBefore(el,thisEl.nextSibling)}function insertBefore(el){var thisEl=this.owner.el,parent=thisEl.parentNode;parent.insertBefore(el,thisEl)}function appendToScopeParent(){var parent=this.owner.getScopeParent();parent&&parent.el.appendChild(this.owner.el)}function Dom$children(){return domUtils.children(this.owner.el)}function find(direction,iterator){if(!findDirections.hasOwnProperty(direction))throw new Error("incorrect find direction: "+direction);var el=this.owner.el,scope=this.owner.scope,treeWalker=document.createTreeWalker(scope._rootEl,NodeFilter.SHOW_ELEMENT);treeWalker.currentNode=el;for(var nextNode=treeWalker[findDirections[direction]](),found=!1;nextNode;){var attr=new BindAttribute(nextNode);if(attr.node&&(attr.parse().validate(),scope.hasOwnProperty(attr.compName))){var component=scope[attr.compName];if(!iterator||iterator(component)){found=!0;break}}treeWalker.currentNode=nextNode,nextNode=treeWalker[findDirections[direction]]()}if(found)return component}function hasTextBeforeSelection(){var selection=window.getSelection();if(!selection.isCollapsed)return!0;var text=selection.focusNode&&selection.focusNode.textContent,startPos=text&&" "==text.charAt(0)?1:0;if(selection.anchorOffset!=startPos)return!0;var treeWalker=document.createTreeWalker(this.owner.el,NodeFilter.SHOW_TEXT);treeWalker.currentNode=selection.anchorNode;for(var isText,prevNode=treeWalker.previousNode();prevNode&&!isText;)isText=!!prevNode&&""==!prevNode.nodeValue.trim(),prevNode=treeWalker.previousNode();return isText}function hasTextAfterSelection(){var selection=window.getSelection();if(!selection.isCollapsed)return!0;var text=selection.focusNode&&selection.focusNode.textContent,startPos=text&&" "==text.charAt(text.length-1)?selection.anchorNode.length-1:selection.anchorNode.length;if(selection.anchorOffset<startPos)return!0;var treeWalker=document.createTreeWalker(this.owner.el,NodeFilter.SHOW_TEXT);treeWalker.currentNode=selection.anchorNode;for(var isText,nextNode=treeWalker.nextNode();nextNode&&!isText;)isText=!!nextNode&&""==!nextNode.nodeValue.trim(),nextNode=treeWalker.nextNode();return isText}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),miloCore=require("milo-core"),_=miloCore.proto,doT=miloCore.util.doT,BindAttribute=require("../../attributes/a_bind"),domUtils=require("../../util/dom"),Dom=_.createSubclass(ComponentFacet,"Dom");_.extend(Dom,{createElement:Dom$$createElement}),_.extendProto(Dom,{start:start,show:show,hide:hide,toggle:toggle,detach:detach,remove:remove,append:append,prepend:prepend,appendChildren:appendChildren,prependChildren:prependChildren,insertAfter:insertAfter,insertBefore:insertBefore,appendToScopeParent:appendToScopeParent,children:Dom$children,setStyle:setStyle,setStyles:setStyles,copy:copy,createElement:createElement,addCssClasses:_.partial(_manageCssClasses,"add"),removeCssClasses:_.partial(_manageCssClasses,"remove"),toggleCssClasses:_.partial(_manageCssClasses,"toggle"),find:find,hasTextBeforeSelection:hasTextBeforeSelection,hasTextAfterSelection:hasTextAfterSelection}),facetsRegistry.add(Dom),module.exports=Dom;var findDirections={up:"previousNode",down:"nextNode"}},{"../../attributes/a_bind":4,"../../util/dom":59,"../c_facet":17,"./cf_registry":32,"milo-core":88}],22:[function(require,module,exports){"use strict";function Drag$init(){ComponentFacet.prototype.init.apply(this,arguments),this._createMessageSourceWithAPI(DOMEventsSource),this._dragData={};var dataTypeInfo=this.config._dataTypeInfo||"";this._dataTypeInfo="function"==typeof dataTypeInfo?dataTypeInfo:function(){return dataTypeInfo}}function Drag$setHandle(handleEl){return this.owner.el.contains(handleEl)?void(this._dragHandle=handleEl):logger.warn("drag handle should be inside element to be dragged");
}function Drag$start(){ComponentFacet.prototype.start.apply(this,arguments),_addDragAttribute.call(this),_createDragImage.call(this),_toggleDragCls.call(this,!1),this.onMessages({mousedown:onMouseDown,"mouseenter mouseleave mousemove":onMouseMovement,dragstart:onDragStart,drag:onDragging,dragend:onDragEnd}),this.owner.onMessages({getstatestarted:_removeDragAttribute,getstatecompleted:_addDragAttribute})}function _addDragAttribute(){this.el&&this.el.setAttribute("draggable",!0)}function _removeDragAttribute(){this.el&&this.el.removeAttribute("draggable")}function _createDragImage(){var dragImage=this.config.dragImage;dragImage&&(this._dragElement=new Image,this._dragElement.src=dragImage.url)}function onMouseDown(eventType,event){this.__mouseDownTarget=event.target,targetInDragHandle.call(this)&&(window.getSelection().empty(),event.stopPropagation())}function onMouseMovement(eventType,event){var shouldBeDraggable=targetInDragHandle.call(this);this.owner.el.setAttribute("draggable",shouldBeDraggable),"false"!=document.body.getAttribute("data-dragEnableEvent")&&event.stopPropagation()}function onDragStart(eventType,event){function setMeta(){var params=getMetaData.call(this,"params"),data=getMetaData.call(this,"data");this._dragMetaDataType=dt.setComponentMeta(owner,params,data),this._dragMetaData=data}function getMetaData(property){try{var func=this.config.meta[property]}catch(e){}return"string"==typeof func&&(func=owner[func]),_.result(func,owner)}function setAdditionalDataTypes(){this.config.dataTypes&&(this._dataTypesData=_.mapKeys(this.config.dataTypes,function(getDataFunc,dataType){"string"==typeof getDataFunc&&(getDataFunc=owner[getDataFunc]);var data=getDataFunc.call(this.owner,dataType);return"object"==typeof data&&(data=JSON.stringify(data)),data&&dt.setData(dataType,data),data},this))}if(event.stopPropagation(),this.config.off||!targetInDragHandle.call(this))return void event.preventDefault();var dragImage=this.config.dragImage;dragImage&&event.dataTransfer.setDragImage(this._dragElement,dragImage.x||0,dragImage.y||0);var owner=this.owner,dt=new DragDrop(event);this._dragData=dt.setComponentState(owner),setMeta.call(this),setAdditionalDataTypes.call(this),_setAllowedEffects.call(this,dt),_toggleDragCls.call(this,!0),DragDrop.service.postMessageSync("dragdropstarted",{eventType:"dragstart",dragDrop:dt,dragFacet:this})}function onDragging(eventType,event){if(!_dragIsDisabled.call(this,event)){var dt=new DragDrop(event);dt.setComponentState(this.owner,this._dragData),dt.setData(this._dragMetaDataType,this._dragMetaData),this._dataTypesData&&_.eachKey(this._dataTypesData,function(data,dataType){data&&dt.setData(dataType,data)}),_setAllowedEffects.call(this,dt)}}function onDragEnd(eventType,event){if(!_dragIsDisabled.call(this,event)){event.stopPropagation(),_toggleDragCls.call(this,!1);var dt=new DragDrop(event);DragDrop.service.postMessageSync("completedragdrop",{eventType:"dragend",dragDrop:dt,dragFacet:this})}}function _toggleDragCls(showHide){this.config.dragCls&&this.owner.el.classList.toggle(this.config.dragCls,showHide)}function _setAllowedEffects(DragDrop){var effects=_.result(this.config.allowedEffects,this.owner);DragDrop.setAllowedEffects(effects)}function targetInDragHandle(){return!this._dragHandle||this._dragHandle.contains(this.__mouseDownTarget)}function _dragIsDisabled(event){return!!this.config.off&&(event.preventDefault(),!0)}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),DOMEventsSource=require("../msg_src/dom_events"),DragDrop=require("../../util/dragdrop"),miloCore=require("milo-core"),_=miloCore.proto,logger=miloCore.util.logger,Drag=_.createSubclass(ComponentFacet,"Drag");_.extendProto(Drag,{init:Drag$init,start:Drag$start,setHandle:Drag$setHandle}),facetsRegistry.add(Drag),module.exports=Drag},{"../../util/dragdrop":62,"../c_facet":17,"../msg_src/dom_events":40,"./cf_registry":32,"milo-core":88}],23:[function(require,module,exports){"use strict";function Drop$init(){ComponentFacet.prototype.init.apply(this,arguments),this._createMessageSourceWithAPI(DOMEventsSource,new DropMsgAPI)}function Drop$start(){ComponentFacet.prototype.start.apply(this,arguments),this.owner.el.classList.add("cc-module-relative"),this.onMessages({"dragenter dragover":onDragging,drop:onDrop,"dragenter dragover dragleave drop dragin dragout":postToService})}function onDragging(eventType,event){var dt=new DragDrop(event);event.stopPropagation(),event.preventDefault(),_handleDropDependency.call(this,dt)||dt.setDropEffect("none")}function onDrop(eventType,event){event.stopPropagation();var dt=new DragDrop(event);DragDrop.service.postMessageSync("dragdropcompleted",{eventType:"drop",dragDrop:dt,dropFacet:this,component:this.owner})}function postToService(eventType,event){DragDrop.service.postMessageSync(eventType,{event:event,dropFacet:this,component:this.owner})}function _handleDropDependencyNothrottle(dt,originalDropComponent){var allow=this.config.allow,parentAllowed=!0;if(originalDropComponent=originalDropComponent||this.owner,allow&&allow.checkParent){var parent=this.owner.getScopeParent("Drop");parent&&(parentAllowed=_handleDropDependencyNothrottle.call(parent.drop,dt,originalDropComponent))}return parentAllowed&&this.isDropAllowed(dt,originalDropComponent)}function Drop$isDropAllowed(dt,originalDropComponent){var allow=this.config.allow;if(dt.isComponent()){var allowComps=allow&&allow.components,meta=dt.getComponentMeta();switch(typeof allowComps){case"undefined":return!0;case"boolean":return allowComps;case"string":return meta&&meta.compClass==allowComps;case"function":return allowComps.call(this.owner,meta,dt,originalDropComponent);case"object":if(Array.isArray(allowComps))return allowComps.indexOf(meta&&meta.compClass)>=0;var test=allowComps[meta&&meta.compClass];return!!_.result(test,this.owner,meta,dt);default:throw new Error("Incorrect allowed components in config")}}else{var dataTypes=allow&&allow.dataTypes;switch(typeof dataTypes){case"undefined":return!1;case"string":return dt.types.indexOf(dataTypes)>=0;case"boolean":return dataTypes;case"function":return dataTypes.call(this.owner,meta,dt,originalDropComponent)}}}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),DOMEventsSource=require("../msg_src/dom_events"),DropMsgAPI=require("../msg_api/drop"),DragDrop=require("../../util/dragdrop"),_=require("milo-core").proto,Drop=_.createSubclass(ComponentFacet,"Drop");_.extendProto(Drop,{init:Drop$init,start:Drop$start,isDropAllowed:Drop$isDropAllowed}),facetsRegistry.add(Drop),module.exports=Drop;var _handleDropDependency=_.throttle(_handleDropDependencyNothrottle,50)},{"../../util/dragdrop":62,"../c_facet":17,"../msg_api/drop":39,"../msg_src/dom_events":40,"./cf_registry":32,"milo-core":88}],24:[function(require,module,exports){"use strict";function Events$init(){ComponentFacet.prototype.init.apply(this,arguments);var domEventsSource=new DOMEventsSource(this,void 0,void 0,this.owner);this._setMessageSource(domEventsSource),_.defineProperty(this,MSG_SOURCE_KEY,domEventsSource)}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),miloCore=require("milo-core"),DOMEventsSource=require("../msg_src/dom_events"),_=miloCore.proto,Events=_.createSubclass(ComponentFacet,"Events");_.extendProto(Events,{init:Events$init}),facetsRegistry.add(Events),module.exports=Events;var MSG_SOURCE_KEY="_domEventsSource";DOMEventsSource.useWith(Events,MSG_SOURCE_KEY,["trigger"])},{"../c_facet":17,"../msg_src/dom_events":40,"./cf_registry":32,"milo-core":88}],25:[function(require,module,exports){"use strict";function Frame$init(){ComponentFacet.prototype.init.apply(this,arguments);var messageSource=new FrameMessageSource(this,void 0,void 0,this.owner);this._setMessageSource(messageSource),_.defineProperty(this,MSG_SOURCE_KEY,messageSource)}function Frame$start(){function postDomReady(event){self.postMessage("domready",event)}ComponentFacet.prototype.start.apply(this,arguments);var self=this;milo(postDomReady)}function Frame$destroy(){ComponentFacet.prototype.destroy.apply(this,arguments)}function Frame$getWindow(){return this.owner.el.contentWindow}function Frame$isReady(){var readyState=this.getWindow().document.readyState;return"loading"!=readyState&&readyState}function Frame$isMiloReady(){var frameMilo=this.getWindow().milo;return this.isReady()&&frameMilo&&frameMilo.milo_version}function Frame$milo(func){if("function"==typeof func){var self=this;this.whenMiloReady(function(){self.getWindow().milo(func)})}var win=this.getWindow();return win&&win.milo}function _makeWhenReadyFunc(isReadyFunc,event){return function(func){function callFunc(){func.apply(self,args)}var self=this,args=_.slice(arguments,1);isReadyFunc.call(this)?callFunc():this.on(event,callFunc)}}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),miloCore=require("milo-core"),FrameMessageSource=require("../msg_src/frame"),_=miloCore.proto,Frame=_.createSubclass(ComponentFacet,"Frame"),Frame$whenReady=_makeWhenReadyFunc(Frame$isReady,"domready"),Frame$whenMiloReady=_makeWhenReadyFunc(Frame$isMiloReady,"message:miloready");_.extendProto(Frame,{init:Frame$init,start:Frame$start,destroy:Frame$destroy,getWindow:Frame$getWindow,isReady:Frame$isReady,whenReady:Frame$whenReady,isMiloReady:Frame$isMiloReady,whenMiloReady:Frame$whenMiloReady,milo:Frame$milo}),facetsRegistry.add(Frame),module.exports=Frame;var MSG_SOURCE_KEY="_messageSource";FrameMessageSource.useWith(Frame,MSG_SOURCE_KEY,["trigger"])},{"../c_facet":17,"../msg_src/frame":41,"./cf_registry":32,"milo-core":88}],26:[function(require,module,exports){"use strict";function ItemFacet$getState(){return{state:{index:this.getIndex()}}}function ItemFacet$setState(state){this.setIndex(state.state.index)}function ItemFacet$getIndex(){return this.index}function ItemFacet$setIndex(index){this.index=index}function ItemFacet$removeItem(){return this.owner.isDestroyed()?logger.warn("ItemFacet: Attempted to call removeItem on destroyed component."):void this.list.removeItem(this.index)}function ItemFacet$extractItem(){this.list.extractItem(this.index)}function ItemFacet$isSample(){return this.list.itemSample==this.owner}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),miloCore=require("milo-core"),logger=miloCore.util.logger,_=miloCore.proto,ItemFacet=_.createSubclass(ComponentFacet,"Item");_.extendProto(ItemFacet,{getState:ItemFacet$getState,setState:ItemFacet$setState,getIndex:ItemFacet$getIndex,setIndex:ItemFacet$setIndex,removeItem:ItemFacet$removeItem,extractItem:ItemFacet$extractItem,isSample:ItemFacet$isSample,require:["Container","Dom","Data"]}),facetsRegistry.add(ItemFacet),module.exports=ItemFacet},{"../c_facet":17,"./cf_registry":32,"milo-core":88}],27:[function(require,module,exports){"use strict";function List$init(){ComponentFacet.prototype.init.apply(this,arguments),_.defineProperties(this,{_listItems:[],_listItemsHash:{}}),_.defineProperty(this,"itemSample",null,_.WRIT)}function List$start(){ComponentFacet.prototype.start.apply(this,arguments),this.owner.on("childrenbound",onChildrenBound)}function onChildrenBound(){var children=this.dom.children(),items=this.list._listItems,itemsHash=this.list._listItemsHash;if(children&&children.forEach(function(childEl){var comp=Component.getComponent(childEl);comp&&comp.item&&(items.push(comp),itemsHash[comp.name]=comp,comp.item.list=this.list)},this),items.length){var foundItem=items[0];items.splice(0,1),delete itemsHash[foundItem.name],items.forEach(function(item,index){item.item.setIndex(index)})}if(!foundItem)throw new Error("No child component has Item facet");this.list.itemSample=foundItem,foundItem.dom.hide(),foundItem.remove(!0),foundItem.dom.addCssClasses(LIST_SAMPLE_CSS_CLASS),foundItem.walkScopeTree(function(comp){delete comp.el[miloConfig.componentRef]}),this.list._createCacheTemplate()}function List$_createCacheTemplate(){if(!this.itemSample)return!1;var itemSample=this.itemSample,itemElCopy=itemSample.el.cloneNode(!0);itemElCopy.classList.remove(LIST_SAMPLE_CSS_CLASS);var attr=itemSample.componentInfo.attr;attr.compName="{{= it.componentName() }}",attr.el=itemElCopy,attr.decorate();var itemsTemplateStr="{{ var i = it.count; while(i--) { }}"+itemElCopy.outerHTML+"{{ } }}";this.itemsTemplate=doT.compile(itemsTemplateStr)}function List$item(index){return this._listItems[index]}function List$getItems(){return this._listItems.concat()}function List$count(){return this._listItems.length}function List$_setItem(index,component){this._listItems.splice(index,0,component),this._listItemsHash[component.name]=component,component.item.list=this,component.item.setIndex(+index)}function List$contains(component){return this._listItemsHash[component.name]==component}function List$addItem(index,itemData){return index=isNaN(+index)?this.count():+index,this.owner.data.splice(index,0,itemData||{}),this.item(index)}function List$_addItem(index){if(this.item(index))throw Error("attempt to create item with ID of existing item");var component=Component.copy(this.itemSample,!0),prevComponent=this._itemPreviousComponent(index);return prevComponent.el.parentNode?(prevComponent.dom.insertAfter(component.el),this._setItem(index,component),component.el.style.display="",component.el.classList.remove(LIST_SAMPLE_CSS_CLASS),_updateItemsIndexes.call(this,index+1),component):logger.warn("list item sample was removed from DOM, probably caused by wrong data. Reset list data with array")}function _updateItemsIndexes(fromIndex,toIndex){fromIndex=fromIndex||0,toIndex=toIndex||this.count();for(var i=fromIndex;i<toIndex;i++){var component=this._listItems[i];component?component.item.setIndex(i):logger.warn("List: no item at position",i)}}function List$addItems(itemsData,index){var spliceArgs=[void 0===index?this.count():index,0].concat(itemsData),dataFacet=this.owner.data;dataFacet.splice.apply(dataFacet,spliceArgs)}function List$_addItems(count,index){if(check(count,Match.Integer),count<0)throw new Error("can't add negative number of items");if(0!==count){var itemsHTML=this.itemsTemplate({componentName:componentName,count:count}),wrapEl=document.createElement(this.owner.el.tagName);wrapEl.innerHTML=itemsHTML,miloBinder(wrapEl,this.owner.container.scope);var children=domUtils.children(wrapEl);if(count!=children.length&&logger.error("number of items added is different from requested"),children&&children.length){var listLength=this.count(),spliceIndex=index<0?0:"undefined"==typeof index||index>listLength?listLength:index,prevComponent=0===spliceIndex?this.itemSample:this._listItems[spliceIndex-1],frag=document.createDocumentFragment(),newComponents=[];if(children.forEach(function(el,i){var component=Component.getComponent(el);return component?(newComponents.push(component),this._setItem(spliceIndex++,component),frag.appendChild(el),void(el.style.display="")):logger.error("List: element in new items is not a component")},this),_updateItemsIndexes.call(this,spliceIndex),!prevComponent.el.parentNode)return logger.warn("list item sample was removed from DOM, probably caused by wrong data. Reset list data with array");prevComponent.dom.insertAfter(frag),_.deferMethod(newComponents,"forEach",function(comp){comp.broadcast("stateready")})}}}function List$removeItem(index){return this.owner.data.splice(index,1)}function List$extractItem(index){var itemComp=this._removeItem(index,!1);return this._updateDataPaths(index,this.count()),itemComp}function List$_removeItem(index,doDestroyItem){var comp=this.item(index);return comp?(this._listItems[index]=void 0,delete this._listItemsHash[comp.name],doDestroyItem!==!1?comp.destroy():(comp.remove(),comp.dom.remove()),this._listItems.splice(index,1),_updateItemsIndexes.call(this,index),comp):logger.warn("attempt to remove list item with id that does not exist")}function List$replaceItem(index,newItem){var oldItem=this.item(index);oldItem.dom.insertAfter(newItem.el),this._removeItem(index),this._setItem(index,newItem)}function List$moveItem(fromIndex,toIndex){var componentToMove=this.extractItem(fromIndex),toComponent=this.item(toIndex);componentToMove.insertInto(this.owner.el,toComponent?toComponent.el:null),this._setItem(toIndex,componentToMove),_updateItemsIndexes.call(this,0)}function _itemPreviousComponent(index){for(;index>=0&&!this._listItems[index];)index--;return index>=0?this._listItems[index]:this.itemSample}function List$_updateDataPaths(fromIndex,toIndex){for(var i=fromIndex;i<toIndex;i++){var item=this.item(i);item?item.data._path="["+i+"]":logger.warn("Data: no item for index",i)}}function List$each(callback,thisArg){this._listItems.forEach(function(item,index){item?callback.apply(this,arguments):logger.warn("List$each: item",index,"is undefined")},thisArg||this)}function List$map(callback,thisArg){return this._listItems.map(function(item,index){return item?callback.apply(this,arguments):void logger.warn("List$map: item",index,"is undefined")},thisArg||this)}function List$destroy(){this.itemSample&&this.itemSample.destroy(!0),ComponentFacet.prototype.destroy.apply(this,arguments)}var ComponentFacet=require("../c_facet"),Component=require("../c_class"),facetsRegistry=require("./cf_registry"),miloCore=require("milo-core"),_=miloCore.proto,miloBinder=require("../../binder"),logger=miloCore.util.logger,doT=miloCore.util.doT,check=miloCore.util.check,Match=check.Match,domUtils=require("../../util/dom"),componentName=require("../../util/component_name"),miloConfig=require("../../config"),LIST_SAMPLE_CSS_CLASS="ml-list-item-sample",List=_.createSubclass(ComponentFacet,"List");_.extendProto(List,{init:List$init,start:List$start,destroy:List$destroy,require:["Container","Dom","Data"],_itemPreviousComponent:_itemPreviousComponent,item:List$item,getItems:List$getItems,count:List$count,contains:List$contains,addItem:List$addItem,addItems:List$addItems,replaceItem:List$replaceItem,moveItem:List$moveItem,removeItem:List$removeItem,extractItem:List$extractItem,each:List$each,map:List$map,_setItem:List$_setItem,_removeItem:List$_removeItem,_addItem:List$_addItem,_addItems:List$_addItems,_createCacheTemplate:List$_createCacheTemplate,_updateDataPaths:List$_updateDataPaths}),facetsRegistry.add(List),module.exports=List},{"../../binder":9,"../../config":43,"../../util/component_name":55,"../../util/dom":59,"../c_class":16,"../c_facet":17,"./cf_registry":32,"milo-core":88}],28:[function(require,module,exports){"use strict";function ModelFacet$init(){this.m=new Model(this.config.data,this),ComponentFacet.prototype.init.apply(this,arguments)}function ModelFacet$getState(){var modelValue=this.m.get();return"object"==typeof modelValue&&(modelValue=_.deepClone(modelValue)),{state:modelValue}}function ModelFacet$setState(state){return this.m.set(state.state)}function ModelFacet$_createMessenger(){this._messenger=this.m._messenger}function ModelFacet$destroy(){this.m.destroy(),ComponentFacet.prototype.destroy.apply(this,arguments)}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),miloCore=require("milo-core"),Model=miloCore.Model,_=miloCore.proto,ModelFacet=_.createSubclass(ComponentFacet,"Model");_.extendProto(ModelFacet,{init:ModelFacet$init,getState:ModelFacet$getState,setState:ModelFacet$setState,_createMessenger:ModelFacet$_createMessenger,destroy:ModelFacet$destroy}),facetsRegistry.add(ModelFacet),module.exports=ModelFacet,Model.useWith(ModelFacet,"m")},{"../c_facet":17,"./cf_registry":32,"milo-core":88}],29:[function(require,module,exports){"use strict";function Options$init(){this.m=new Model(this.config.options,this),Options.super.init.apply(this,arguments),this.m.proxyMethods(this)}function Options$start(){Options.super.start.apply(this,arguments);var attr=new OptionsAttribute(this.owner.el);if(attr.parse(),attr.options){this.config.coerceTypes&&_.eachKey(attr.options,function(val,key){return"true"==val?attr.options[key]=!0:"false"==val?attr.options[key]=!1:_.isNumeric(val)?attr.options[key]=+val:void 0});var current=_.deepClone(this.m.get()||{});_.deepExtend(current,attr.options),this.m.set(current)}}function Options$_createMessenger(){this._messenger=this.m._messenger}function Options$destroy(){this.m.destroy(),Options.super.destroy.apply(this,arguments)}var Model=require("milo-core").Model,createFacetClass=require("../../util/create_facet_class"),OptionsAttribute=require("../../attributes/a_options"),Options=module.exports=createFacetClass({className:"Options",superClassName:"ComponentFacet",methods:{init:Options$init,start:Options$start,_createMessenger:Options$_createMessenger,destroy:Options$destroy}})},{"../../attributes/a_options":7,"../../util/create_facet_class":57,"milo-core":88}],30:[function(require,module,exports){"use strict";function Template$init(){ComponentFacet.prototype.init.apply(this,arguments);var compile=this.config.interpolate===!1?void 0:this.config.compile||config.template.compile;this.set(this.config.template||"",compile,this.config.compileOptions)}function Template$start(){ComponentFacet.prototype.start.apply(this,arguments),this.config.autoRender&&(this.render(),this.config.autoBinder&&this.binder())}function Template$getCompiled(){return this._template}function Template$set(templateStr,compile,compileOptions){return check(templateStr,Match.OneOf(String,Function)),check(compile,Match.Optional(Function)),"function"==typeof templateStr?this._template=templateStr:(this._templateStr=templateStr,compile?this._compile=compile:compile=this._compile,compile&&(this._template=compile(templateStr,compileOptions))),this}function Template$render(data){return this.owner.el.innerHTML=this._template?this._template(data):this._templateStr,this}function Template$binder(){return this.owner.container?this.owner.container.binder():void logger.error("TemplateFacet: Binder called without container facet.")}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),miloCore=require("milo-core"),_=miloCore.proto,check=miloCore.util.check,logger=miloCore.util.logger,Match=check.Match,config=require("../../config"),Template=_.createSubclass(ComponentFacet,"Template");_.extendProto(Template,{init:Template$init,start:Template$start,set:Template$set,getCompiled:Template$getCompiled,render:Template$render,binder:Template$binder}),facetsRegistry.add(Template),module.exports=Template},{"../../config":43,"../c_facet":17,"./cf_registry":32,"milo-core":88}],31:[function(require,module,exports){"use strict";function Transfer$init(){ComponentFacet.prototype.init.apply(this,arguments),this._activeState="",this._defaultKey="",this._state={}}function Transfer$getState(){return this._state[this._activeState]||this._state[this._defaultKey]}function Transfer$setState(state){this._state[""]=state,this.setActiveState("")}function Transfer$setActiveState(key){this._activeState=key}function Transfer$setStateWithKey(key,state,isDefaultKey){if(!key)throw new Error("Transfer$setStateWithKey: no key");isDefaultKey?this._defaultKey=key:this._defaultKey=this._defaultKey||key,this._state[key]=state,this.setActiveState(key)}function Transfer$getStateWithKey(key){return"string"==typeof key&&this._state[key]}function Transfer$getComponentMeta(){var state=this.getState();return{compName:state&&state.compName,compClass:state&&state.compClass}}var ComponentFacet=require("../c_facet"),facetsRegistry=require("./cf_registry"),Transfer=_.createSubclass(ComponentFacet,"Transfer");_.extendProto(Transfer,{init:Transfer$init,getState:Transfer$getState,setState:Transfer$setState,setActiveState:Transfer$setActiveState,setStateWithKey:Transfer$setStateWithKey,getStateWithKey:Transfer$getStateWithKey,getComponentMeta:Transfer$getComponentMeta}),facetsRegistry.add(Transfer),module.exports=Transfer},{"../c_facet":17,"./cf_registry":32}],32:[function(require,module,exports){"use strict";var ClassRegistry=require("../../abstract/registry"),ComponentFacet=require("../c_facet"),facetsRegistry=new ClassRegistry(ComponentFacet);facetsRegistry.add(ComponentFacet),module.exports=facetsRegistry},{"../../abstract/registry":3,"../c_facet":17}],33:[function(require,module,exports){"use strict";function ComponentInfo(scope,el,attr,throwOnErrors){attr.parse().validate(),this.scope=scope,this.el=el,this.attr=attr,this.name=attr.compName,this.ComponentClass=getComponentClass(attr,throwOnErrors),this.extraFacetsClasses=getComponentExtraFacets(this.ComponentClass,attr,throwOnErrors),this.ComponentClass&&hasContainerFacet(this.ComponentClass,this.extraFacetsClasses)&&(this.container={})}function ComponentInfo$destroy(){delete this.el,this.attr.destroy()}function ComponentInfo$rename(name,renameInScope){name=name||componentName(),Scope.rename(this,name,renameInScope),this.attr.compName=name,this.attr.decorate()}function getComponentClass(attr,throwOnErrors){var ComponentClass=componentsRegistry.get(attr.compClass);return ComponentClass||reportBinderError(throwOnErrors,"class "+attr.compClass+" is not registered"),ComponentClass}function getComponentExtraFacets(ComponentClass,attr,throwOnErrors){var facets=attr.compFacets,extraFacetsClasses={};return Array.isArray(facets)&&facets.forEach(function(fctName){fctName=_.firstUpperCase(fctName),ComponentClass.hasFacet(fctName)&&reportBinderError(throwOnErrors,"class "+ComponentClass.name+" already has facet "+fctName),extraFacetsClasses[fctName]&&reportBinderError(throwOnErrors,"component "+attr.compName+" already has facet "+fctName);var FacetClass=facetsRegistry.get(fctName);extraFacetsClasses[fctName]=FacetClass}),extraFacetsClasses}function reportBinderError(throwOnErrors,message){if(throwOnErrors!==!1)throw new Error(message);logger.error("ComponentInfo binder error:",message)}function hasContainerFacet(ComponentClass,extraFacetsClasses){function classHasFacetThatRequiresContainer(){return ComponentClass.prototype.facetsClasses&&_.someKey(ComponentClass.prototype.facetsClasses,facetRequiresContainer)}function facetRequiresContainer(FacetClass){return FacetClass.requiresFacet("container")}return ComponentClass.hasFacet("container")||"Container"in extraFacetsClasses||_.someKey(extraFacetsClasses,facetRequiresContainer)||classHasFacetThatRequiresContainer()}var componentsRegistry=require("./c_registry"),facetsRegistry=require("./c_facets/cf_registry"),componentName=require("../util/component_name"),Scope=require("./scope"),miloCore=require("milo-core"),logger=miloCore.util.logger,_=miloCore.proto;module.exports=ComponentInfo,_.extendProto(ComponentInfo,{destroy:ComponentInfo$destroy,rename:ComponentInfo$rename})},{"../util/component_name":55,"./c_facets/cf_registry":32,"./c_registry":34,"./scope":42,"milo-core":88}],34:[function(require,module,exports){"use strict";var ClassRegistry=require("../abstract/registry"),Component=require("./c_class"),componentsRegistry=new ClassRegistry(Component);componentsRegistry.add(Component),module.exports=componentsRegistry},{"../abstract/registry":3,"./c_class":16}],35:[function(require,module,exports){"use strict";function isComponent(el){return el.hasOwnProperty(config.componentRef)}function getComponent(el){return el&&el[config.componentRef]}function getContainingComponent(node,returnCurrent,conditionOrFacet){check(returnCurrent,Match.Optional(Boolean)),check(conditionOrFacet,Match.Optional(Match.OneOf(Function,String)));var conditionFunc=_makeComponentConditionFunc(conditionOrFacet);return _getContainingComponent(node,returnCurrent,conditionFunc)}function _makeComponentConditionFunc(conditionOrFacet){if("function"==typeof conditionOrFacet)return conditionOrFacet;if("string"==typeof conditionOrFacet){var facetName=_.firstLowerCase(conditionOrFacet);return function(comp){return comp.hasFacet(facetName)}}}function _getContainingComponent(el,returnCurrent,conditionFunc){if(returnCurrent!==!1){var comp=getComponent(el);if(comp&&(!conditionFunc||conditionFunc(comp)))return comp}if(el.parentNode)return _getContainingComponent(el.parentNode,!0,conditionFunc)}var config=require("../config"),miloCore=require("milo-core"),check=miloCore.util.check,Match=check.Match,_=miloCore.proto;module.exports={isComponent:isComponent,getComponent:getComponent,getContainingComponent:getContainingComponent,_makeComponentConditionFunc:_makeComponentConditionFunc}},{"../config":43,"milo-core":88}],36:[function(require,module,exports){"use strict";var Component=require("../c_class"),componentsRegistry=require("../c_registry"),View=Component.createComponentClass("View",["container"]);componentsRegistry.add(View),module.exports=View},{"../c_class":16,"../c_registry":34}],37:[function(require,module,exports){"use strict";function DataMsgAPI$init(component){MessengerAPI.prototype.init.apply(this,arguments),this.component=component,this.elData=getElementDataAccess(component.el)}function DataMsgAPI$value(){var componentGetter=this.component.data.config.get,newValue="function"==typeof componentGetter?componentGetter.call(this.component):this.elData.get(this.component.el);return this.component.data._value=newValue,newValue}function translateToSourceMessage(message){var componentEvent=this.component.data.config.event,event=componentEvent||this.elData.event(this.component.el);if(""===message&&event)return event}function filterSourceMessage(sourceMessage,message,data){return data.newValue!=data.oldValue}function createInternalData(sourceMessage,message,data){var oldValue=this.component.data._value,newValue=this.value(),internalData={path:"",type:"changed",oldValue:oldValue,newValue:newValue};return internalData}var getElementDataAccess=require("./de_data"),miloCore=require("milo-core"),MessengerAPI=miloCore.classes.MessengerAPI,_=miloCore.proto,DataMsgAPI=_.createSubclass(MessengerAPI,"DataMsgAPI",!0);_.extendProto(DataMsgAPI,{init:DataMsgAPI$init,translateToSourceMessage:translateToSourceMessage,filterSourceMessage:filterSourceMessage,createInternalData:createInternalData,value:DataMsgAPI$value}),module.exports=DataMsgAPI},{"./de_data":38,"milo-core":88}],38:[function(require,module,exports){"use strict";function inputDataProperty(el){var inputType=inputElementTypes[el.type];return inputType?inputType.property:inputElementTypes.byDefault.property}function inputChangeEvent(el){var inputType=inputElementTypes[el.type];return inputType?inputType.event:inputElementTypes.byDefault.event}var _=require("milo-core").proto,getElementDataAccess=function(el){var tagName=el.tagName.toLowerCase(),elData=domElementsDataAccess[tagName];return elData||domElementsDataAccess.byDefault};module.exports=getElementDataAccess;var domElementsDataAccess={byDefault:{property:"innerHTML"},div:{property:"innerHTML"},span:{property:"innerHTML",event:"input"},p:{property:"innerHTML",event:"input"},input:{property:inputDataProperty,event:inputChangeEvent},textarea:{property:"value",event:"input"},select:{property:"value",event:"change"},img:{property:"src"},video:{property:"src"},caption:{property:"innerHTML",event:"input"},thead:{property:"innerHTML",event:"input"},tbody:{property:"innerHTML",event:"input"},tfoot:{property:"innerHTML",event:"input"}};_.eachKey(domElementsDataAccess,function(tagInfo){var property=tagInfo.property,event=tagInfo.event;"function"!=typeof property&&(tagInfo.property=function(){return property});var propFunc=tagInfo.property;"function"!=typeof event&&(tagInfo.event=function(){return event}),tagInfo.get||(tagInfo.get=function(el){return el[propFunc(el)]}),tagInfo.set||(tagInfo.set=function(el,value){return el[propFunc(el)]=null==value?"":value})});var inputElementTypes={byDefault:{property:"value",event:"input"},checkbox:{property:"checked",event:"change"},radio:{property:"checked",event:"change"},text:{property:"value",event:"input"}}},{"milo-core":88}],39:[function(require,module,exports){"use strict";function translateToSourceMessage(message){return dropEventsMap.hasOwnProperty(message)?dropEventsMap[message]:message}function resetFilterVars(){delete this._currentTarget,delete this._inside}function filterSourceMessage(sourceMessage,message,data){var ok=!0;return"dragenter"==sourceMessage&&"dragin"==message?(this._currentTarget=data.target,
ok=!this._inside,this._inside=!0):"dragleave"==sourceMessage&&"dragout"==message?(ok=this._currentTarget==data.target,ok&&resetFilterVars.call(this)):"drop"==sourceMessage&&resetFilterVars.call(this),ok}var miloCore=require("milo-core"),MessengerAPI=miloCore.classes.MessengerAPI,_=miloCore.proto,DropMsgAPI=_.createSubclass(MessengerAPI,"DropMsgAPI",!0);_.extendProto(DropMsgAPI,{translateToSourceMessage:translateToSourceMessage,filterSourceMessage:filterSourceMessage}),module.exports=DropMsgAPI;var dropEventsMap={dragin:"dragenter",dragout:"dragleave"}},{"milo-core":88}],40:[function(require,module,exports){"use strict";function init(hostObject,proxyMethods,messengerAPIOrClass,component){check(component,Component),this.component=component,MessageSource.prototype.init.apply(this,arguments)}function DOMEventsSource$destroy(){MessageSource.prototype.destroy.apply(this,arguments),delete this.component}function emitter(){return this.component.el}var DOMEmitterSource=require("../../services/dom_source"),miloCore=require("milo-core"),MessageSource=miloCore.classes.MessageSource,Component=require("../c_class"),_=miloCore.proto,check=miloCore.util.check,DOMEventsSource=_.createSubclass(DOMEmitterSource,"DOMEventsSource",!0);_.extendProto(DOMEventsSource,{init:init,destroy:DOMEventsSource$destroy,emitter:emitter}),module.exports=DOMEventsSource},{"../../services/dom_source":48,"../c_class":16,"milo-core":88}],41:[function(require,module,exports){"use strict";function init(hostObject,proxyMethods,messengerAPIOrClass,component){if(check(component,Component),this.component=component,"iframe"!=component.el.tagName.toLowerCase())throw new Error("component for FrameMessageSource can only be attached to iframe element");MessageSource.prototype.init.apply(this,arguments)}function frameWindow(){return this.component.el.contentWindow}function addSourceSubscriber(sourceMessage){var win=this.frameWindow();win?win.addEventListener("message",this,!1):logger.warn("FrameMessageSource: frame window is undefined")}function removeSourceSubscriber(sourceMessage){var win=this.frameWindow();win?win.removeEventListener("message",this,!1):logger.warn("FrameMessageSource: frame window is undefined")}function trigger(msgType,data){data=data||{},data.type=msgType,this.frameWindow().postMessage(data,"*")}function handleEvent(event){this.dispatchMessage(event.data.type,event)}var Component=require("../c_class"),miloCore=require("milo-core"),MessageSource=miloCore.classes.MessageSource,_=miloCore.proto,check=miloCore.util.check,logger=miloCore.util.logger,FrameMessageSource=_.createSubclass(MessageSource,"FrameMessageSource",!0);_.extendProto(FrameMessageSource,{init:init,addSourceSubscriber:addSourceSubscriber,removeSourceSubscriber:removeSourceSubscriber,trigger:trigger,frameWindow:frameWindow,handleEvent:handleEvent}),module.exports=FrameMessageSource},{"../c_class":16,"milo-core":88}],42:[function(require,module,exports){"use strict";function Scope(rootEl,hostObject){_.defineProperties(this,{_rootEl:rootEl,_hostObject:hostObject},_.WRIT)}function Scope$_add(object,name){if("string"==typeof name?object.name=name:name=object.name,this.hasOwnProperty(name))throw new Error("duplicate object name: "+name);checkName(name),__add.call(this,object,name)}function Scope$_safeAdd(object,name){"string"==typeof name?object.name=name:name=object.name;var shouldRename=this.hasOwnProperty(name);shouldRename?logger.error("Scope: duplicate object name: "+name):(shouldRename=!allowedNamePattern.test(name),shouldRename&&logger.error("Scope: name should start from letter, this name is not allowed: "+name)),shouldRename&&(name=componentName(),object.name=name),__add.call(this,object,name)}function __add(object,name){this[name]=object,object.scope=this,"function"==typeof object.postMessage&&object.postMessage("addedtoscope")}function Scope$_copy(aScope){check(aScope,Scope),aScope._each(Scope$_add,this)}function Scope$_move(component,otherScope){otherScope._add(component),this._remove(component.name),component.scope=otherScope}function Scope$_merge(scope){scope._each(function(comp){this._add(comp,comp.name),scope._remove(comp.name)},this)}function Scope$_each(callback,thisArg){_.eachKey(this,callback,thisArg||this,!0)}function Scope$_filter(callback,thisArg){return _.filterKeys(this,callback,thisArg||this,!0)}function checkName(name){if(!allowedNamePattern.test(name))throw new Error("name should start from letter, this name is not allowed: "+name)}function Scope$_length(){return Object.keys(this).length}function Scope$_any(){var key=Object.keys(this)[0];return key&&this[key]}function Scope$_remove(name,quiet){if(!(name in this))return void(quiet||logger.warn("removing object that is not in scope"));var object=this[name];delete this[name],"function"==typeof object.postMessage&&object.postMessage("removedfromscope")}function Scope$_clean(){this._each(function(object,name){delete this[name].scope,delete this[name]},this)}function Scope$_detachElement(){this._rootEl=null}function Scope$_has(object){return this.hasOwnProperty(object.name)}function Scope$$rename(obj,name,renameInScope){obj.scope&&renameInScope!==!1?(obj.scope._remove(obj.name),obj.scope._add(obj,name)):obj.name=name}var miloCore=require("milo-core"),_=miloCore.proto,componentName=require("../util/component_name"),check=miloCore.util.check,logger=miloCore.util.logger;_.extendProto(Scope,{_add:Scope$_add,_safeAdd:Scope$_safeAdd,_copy:Scope$_copy,_each:Scope$_each,_move:Scope$_move,_merge:Scope$_merge,_length:Scope$_length,_any:Scope$_any,_remove:Scope$_remove,_clean:Scope$_clean,_detachElement:Scope$_detachElement,_has:Scope$_has,_filter:Scope$_filter}),_.extend(Scope,{rename:Scope$$rename}),module.exports=Scope;var allowedNamePattern=/^[A-Za-z][A-Za-z0-9\_\$]*$/},{"../util/component_name":55,"milo-core":88}],43:[function(require,module,exports){"use strict";var miloCore=require("milo-core"),doT=miloCore.util.doT,config=module.exports=miloCore.config;config({attrs:{bind:"ml-bind",options:"ml-options",load:"ml-load"},componentRef:"___milo_component",componentPrefix:"milo_",template:{compile:doT.compile},domStorage:{typeSuffix:":___milo_data_type",prefixSeparator:"/",root:"",messageKey:"___milo_message/",messageTimestamp:"___milo_timestamp",quotaExceeded:{throwError:!0,message:!1}},dragDrop:{dataTypes:{component:"x-application/milo/component",componentMetaTemplate:"x-application/milo/component-meta/%class/%name/%params",componentMetaRegex:/^x\-application\/milo\/component\-meta\/([a-z0-9]+)\/([a-z0-9]+)\/([a-z0-9]*)$/}},request:{jsonpTimeout:6e4,jsonpCallbackPrefix:"___milo_callback_",optionsKey:"___milo_options",completedKey:"___milo_completed",defaults:{timeout:6e4}},websocket:{rpc:{timeout:15e3,responsePrefix:"response_"}},deprecationWarning:"once"})},{"milo-core":88}],44:[function(require,module,exports){"use strict";function loader(rootEl,removeAttribute,callback){milo(function(){_loader(rootEl,removeAttribute,callback)})}function _loader(rootEl,removeAttribute,callback){"function"==typeof rootEl&&(callback=rootEl,rootEl=void 0,removeAttribute=!1),"function"==typeof removeAttribute&&(callback=removeAttribute,removeAttribute=!1),rootEl=rootEl||document.body,miloMail.postMessage("loader",{state:"started"}),_loadViewsInElement(rootEl,removeAttribute,function(views){miloMail.postMessage("loader",{state:"finished",views:views}),callback(views)})}function _loadViewsInElement(rootEl,removeAttribute,callback){var loadElements=rootEl.getAttribute(config.attrs.load)?[rootEl]:rootEl.querySelectorAll("["+config.attrs.load+"]"),views={},totalCount=loadElements.length,loadedCount=0;_.forEach(loadElements,function(el){loadView(el,removeAttribute,function(err){views[el.id]=err||el,loadedCount++,loadedCount==totalCount&&callback(views)})})}function loadView(el,removeAttribute,callback){if(utilDom.children(el).length)throw new Error("can't load html into element that is not empty");var attr=new LoadAttribute(el);attr.parse().validate(),request.get(attr.loadUrl,function(err,html){return err?(err.message=err.message||"can't load file "+attr.loadUrl,void callback(err)):(el.innerHTML=html,removeAttribute&&LoadAttribute.remove(el),void callback(null))})}var miloMail=require("./services/mail"),request=require("./util/request"),miloCore=require("milo-core"),_=miloCore.proto,utilDom=require("./util/dom"),config=require("./config"),LoadAttribute=require("./attributes/a_load");module.exports=loader},{"./attributes/a_load":6,"./config":43,"./services/mail":49,"./util/dom":59,"./util/request":67,"milo-core":88}],45:[function(require,module,exports){"use strict";function milo(func){milo.util.domReady(func)}function destroy(){miloCore.destroy(),milo.mail.destroy(),milo.window.destroy(),milo.util.destroy()}var miloCore=require("milo-core"),_=miloCore.proto;require("./use_facets"),require("./components/classes/View"),_.extend(milo,{Messenger:miloCore.Messenger,Model:miloCore.Model,minder:miloCore.minder,loader:require("./loader"),binder:require("./binder"),mail:require("./services/mail"),window:require("./services/window"),config:require("./config"),util:require("./util"),classes:require("./classes"),attributes:require("./attributes"),ComponentFacet:require("./components/c_facet"),Component:require("./components/c_class"),Command:require("./command"),registry:require("./registry"),milo_version:require("../package.json").version,createComponentClass:require("./util/create_component_class"),createFacetClass:require("./util/create_facet_class"),destroy:destroy}),"object"==typeof module&&module.exports&&(module.exports=milo),"object"==typeof window&&(window.milo=milo,milo.mail.trigger("miloready"))},{"../package.json":125,"./attributes":8,"./binder":9,"./classes":10,"./command":13,"./components/c_class":16,"./components/c_facet":17,"./components/classes/View":36,"./config":43,"./loader":44,"./registry":46,"./services/mail":49,"./services/window":52,"./use_facets":53,"./util":65,"./util/create_component_class":56,"./util/create_facet_class":57,"milo-core":88}],46:[function(require,module,exports){"use strict";module.exports={facets:require("./components/c_facets/cf_registry"),components:require("./components/c_registry"),commands:require("./command/cmd_registry")}},{"./command/cmd_registry":12,"./components/c_facets/cf_registry":32,"./components/c_registry":34}],47:[function(require,module,exports){"use strict";var _=require("milo-core").proto,eventTypes={ClipboardEvent:["copy","cut","paste","beforecopy","beforecut","beforepaste"],Event:["input","readystatechange"],FocusEvent:["focus","blur","focusin","focusout"],KeyboardEvent:["keydown","keypress","keyup"],MouseEvent:["click","contextmenu","dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","mouseout","mouseover","show"],TouchEvent:["touchstart","touchend","touchmove","touchenter","touchleave","touchcancel"]};if("undefined"!=typeof window)var global=window;else global={},_.eachKey(eventTypes,function(eTypes,eventConstructorName){var eventConstructor=_.makeFunction(eventConstructorName,"type","properties","this.type = type; _.extend(this, properties);");global[eventConstructorName]=eventConstructor});var domEventsConstructors={};_.eachKey(eventTypes,function(eTypes,eventConstructorName){eTypes.forEach(function(type){if(Object.hasOwnProperty(domEventsConstructors,type))throw new Error("duplicate event type "+type);domEventsConstructors[type]=global[eventConstructorName]})}),module.exports=domEventsConstructors},{"milo-core":88}],48:[function(require,module,exports){"use strict";function init(hostObject,proxyMethods,messengerAPIOrClass,eventEmitter){this.eventEmitter=eventEmitter,MessageSource.prototype.init.apply(this,arguments)}function DOMEmitterSource$destroy(){MessageSource.prototype.destroy.apply(this,arguments),delete this.eventEmitter}function emitter(){return this.eventEmitter}function sourceSubscriberMethod(method,eventType){if(eventType&&"string"==typeof eventType){var capture=useCapturePattern.test(eventType);capture&&(eventType=eventType.replace(useCapturePattern,"")),this.emitter()[method](eventType,this,capture)}}function handleEvent(event){var isCapturePhase;"undefined"!=typeof window&&(isCapturePhase=event.eventPhase==window.Event.CAPTURING_PHASE);var msg=event.type+(isCapturePhase?useCapturePostfix:"");this.dispatchMessage(msg,event)}function DOMEmitterSource$postMessage(message,data){this.messenger.postMessageSync(message,data)}function trigger(eventType,properties){check(eventType,String),check(properties,Match.Optional(Object)),eventType=eventType.replace(useCapturePattern,"");var EventConstructor=domEventsConstructors[eventType];if("function"!=typeof EventConstructor)throw new Error("unsupported event type");"undefined"!=typeof properties&&(properties.type=eventType);var domEvent=new EventConstructor(eventType,properties),notCancelled=this.emitter().dispatchEvent(domEvent);return notCancelled}var miloCore=require("milo-core"),MessageSource=miloCore.classes.MessageSource,domEventsConstructors=require("./de_constrs"),_=miloCore.proto,check=miloCore.util.check,Match=check.Match,DOMEmitterSource=_.createSubclass(MessageSource,"DOMEmitterSource",!0);_.extendProto(DOMEmitterSource,{init:init,destroy:DOMEmitterSource$destroy,addSourceSubscriber:_.partial(sourceSubscriberMethod,"addEventListener"),removeSourceSubscriber:_.partial(sourceSubscriberMethod,"removeEventListener"),postMessage:DOMEmitterSource$postMessage,trigger:trigger,emitter:emitter,handleEvent:handleEvent}),module.exports=DOMEmitterSource;var useCapturePattern=/__capture$/,useCapturePostfix="__capture"},{"./de_constrs":47,"milo-core":88}],49:[function(require,module,exports){"use strict";var miloCore=require("milo-core"),Messenger=miloCore.Messenger,MailMsgAPI=require("./mail_api"),MailMessageSource=require("./mail_source"),miloMail=new Messenger,mailMsgSource=new MailMessageSource(miloMail,{trigger:"trigger"},new MailMsgAPI);miloMail._setMessageSource(mailMsgSource),module.exports=miloMail},{"./mail_api":50,"./mail_source":51,"milo-core":88}],50:[function(require,module,exports){"use strict";function translateToSourceMessage(message){return"domready"==message?"readystatechange":windowMessageRegExp.test(message)?"message":void 0}function filterSourceMessage(sourceMessage,msgType,msgData){return"readystatechange"==sourceMessage||("message"==sourceMessage?windowMessagePrefix+msgData.data.type==msgType:void 0)}var miloCore=require("milo-core"),MessengerAPI=miloCore.classes.MessengerAPI,_=miloCore.proto,MailMsgAPI=_.createSubclass(MessengerAPI,"MailMsgAPI",!0);_.extendProto(MailMsgAPI,{translateToSourceMessage:translateToSourceMessage,filterSourceMessage:filterSourceMessage}),module.exports=MailMsgAPI;var windowMessageRegExp=/^message\:/,windowMessagePrefix="message:"},{"milo-core":88}],51:[function(require,module,exports){"use strict";function addSourceSubscriber(sourceMessage){if(isReadyStateChange(sourceMessage))if("loading"==document.readyState)document.addEventListener("readystatechange",this,!1);else{var EventConstructor=domEventsConstructors.readystatechange,domEvent=new EventConstructor("readystatechange",{target:document});this.dispatchMessage("readystatechange",domEvent)}else this._windowSubscriberMethod("addEventListener",sourceMessage)}function removeSourceSubscriber(sourceMessage){isReadyStateChange(sourceMessage)?document.removeEventListener("readystatechange",this,!1):this._windowSubscriberMethod("removeEventListener",sourceMessage)}function isReadyStateChange(sourceMessage){return"readystatechange"==sourceMessage&&"object"==typeof document}function isWindowMessage(sourceMessage){return"message"==sourceMessage&&"object"==typeof window}function _windowSubscriberMethod(method,sourceMessage){isWindowMessage(sourceMessage)&&window[method]("message",this,!1)}function handleEvent(event){this.dispatchMessage(event.type,event)}function trigger(msgType,data){data=data||{},data.type="message:"+msgType,"object"==typeof window&&window.postMessage(data,"*")}var miloCore=require("milo-core"),MessageSource=miloCore.classes.MessageSource,domEventsConstructors=require("../de_constrs"),_=miloCore.proto,MailMessageSource=_.createSubclass(MessageSource,"MailMessageSource",!0);_.extendProto(MailMessageSource,{addSourceSubscriber:addSourceSubscriber,removeSourceSubscriber:removeSourceSubscriber,trigger:trigger,_windowSubscriberMethod:_windowSubscriberMethod,handleEvent:handleEvent}),module.exports=MailMessageSource},{"../de_constrs":47,"milo-core":88}],52:[function(require,module,exports){"use strict";function windowService_isTop(){return window.top==window.self||window.__karma__}var miloCore=require("milo-core"),Messenger=miloCore.Messenger,DOMEmitterSource=require("./dom_source"),_=miloCore.proto,windowService=new Messenger,domEmitterSource=new DOMEmitterSource(windowService,{trigger:"trigger"},void 0,window);windowService._setMessageSource(domEmitterSource),module.exports=windowService,_.extend(windowService,{isTop:windowService_isTop})},{"./dom_source":48,"milo-core":88}],53:[function(require,module,exports){"use strict";require("./components/c_facets/Css"),require("./components/c_facets/Dom"),require("./components/c_facets/Data"),require("./components/c_facets/Frame"),require("./components/c_facets/Events"),require("./components/c_facets/Options"),require("./components/c_facets/Template"),require("./components/c_facets/Container"),require("./components/c_facets/ModelFacet"),require("./components/c_facets/Drag"),require("./components/c_facets/Drop"),require("./components/c_facets/List"),require("./components/c_facets/Item"),require("./components/c_facets/Transfer")},{"./components/c_facets/Container":18,"./components/c_facets/Css":19,"./components/c_facets/Data":20,"./components/c_facets/Dom":21,"./components/c_facets/Drag":22,"./components/c_facets/Drop":23,"./components/c_facets/Events":24,"./components/c_facets/Frame":25,"./components/c_facets/Item":26,"./components/c_facets/List":27,"./components/c_facets/ModelFacet":28,"./components/c_facets/Options":29,"./components/c_facets/Template":30,"./components/c_facets/Transfer":31}],54:[function(require,module,exports){"use strict";function Encoder(){var skip=0,bits=0;this.output="",this.readByte=function(byte){return"string"==typeof byte&&(byte=byte.charCodeAt(0)),skip<0?bits|=byte>>-skip:bits=byte<<skip&248,skip>3?(skip-=8,1):(skip<4&&(this.output+=alphabet[bits>>3],skip+=5),0)},this.finish=function(check){var output=this.output+(skip<0?alphabet[bits>>3]:"")+(check?DOLLAR:"");return this.output="",output}}function Decoder(){var skip=0,byte=0;this.output="",this.readChar=function(char){"string"!=typeof char&&"number"==typeof char&&(char=String.fromCharCode(char)),char=char.toLowerCase();var val=lookup()[char];"undefined"!=typeof val&&(val<<=3,byte|=val>>>skip,skip+=5,skip>=8&&(this.output+=String.fromCharCode(byte),skip-=8,byte=skip>0?val<<5-skip&255:0))},this.finish=function(check){var output=this.output+(check?DOLLAR:"");return this.output="",output}}function encode(input){var encoder=new Encoder,output=encoder.update(input,!0);return output}function decode(input){var decoder=new Decoder,output=decoder.update(input,!0);return output}var alphabet="0123456789abcdefghjkmnpqrtuvwxyz",alias={o:0,i:1,l:1,s:5},DOLLAR=String.fromCharCode(36),lookup=function(){for(var table={},i=0;i<alphabet.length;i++)table[alphabet[i]]=i;for(var key in alias)alias.hasOwnProperty(key)&&(table[key]=table[""+alias[key]]);return lookup=function(){return table},table};Encoder.prototype.update=function(input,flush){for(var i=0;i<input.length;)i+=this.readByte(input[i]);var output=this.output;return this.output="",flush&&(output+=this.finish()),output},Decoder.prototype.update=function(input,flush){for(var i=0;i<input.length;i++)this.readChar(input[i]);var output=this.output;return this.output="",flush&&(output+=this.finish()),output},module.exports={Decoder:Decoder,Encoder:Encoder,encode:encode,decode:decode}},{}],55:[function(require,module,exports){"use strict";function componentName(){return prefix+uniqueId()}var uniqueId=require("./unique_id"),config=require("../config"),prefix=config.componentPrefix;module.exports=componentName},{"../config":43,"./unique_id":72}],56:[function(require,module,exports){"use strict";function createComponentClass(config){check(config,{superClassName:Match.Optional(String),className:String,facets:Match.Optional(Object),methods:Match.Optional(Match.ObjectHash(Function)),staticMethods:Match.Optional(Match.ObjectHash(Function))});var SuperClass=componentRegistry.get(config.superClassName||"Component"),ComponentClass=SuperClass.createComponentClass(config.className,config.facets);if(config.methods&&_.extendProto(ComponentClass,config.methods),config.staticMethods){if(void 0!==config.staticMethods.super)throw"'super' is a reserved keyword";_.extend(ComponentClass,config.staticMethods)}return ComponentClass.super=SuperClass.prototype,componentRegistry.add(ComponentClass),ComponentClass}var miloCore=require("milo-core"),_=miloCore.proto,check=miloCore.util.check,Match=check.Match,componentRegistry=require("../components/c_registry");module.exports=createComponentClass},{"../components/c_registry":34,"milo-core":88}],57:[function(require,module,exports){"use strict";function createFacetClass(config){check(config,{className:String,superClassName:Match.Optional(String),require:Match.Optional(Array),methods:Match.Optional(Match.ObjectHash(Function)),staticMethods:Match.Optional(Match.ObjectHash(Function)),configSchema:Match.Optional(Object)});var SuperClass=config.superClassName?facetRegistry.get(config.superClassName):FacetBaseClass,FacetClass=_.createSubclass(SuperClass,config.className);if(config.methods&&_.extendProto(FacetClass,config.methods),config.require&&_.extendProto(FacetClass,{require:config.require}),config.configSchema&&_.extendProto(FacetClass,{configSchema:config.configSchema}),config.staticMethods){if(void 0!==config.staticMethods.super)throw"'super' is a reserved keyword";_.extend(FacetClass,config.staticMethods)}return FacetClass.super=SuperClass.prototype,facetRegistry.add(FacetClass),FacetClass}var miloCore=require("milo-core"),_=miloCore.proto,check=miloCore.util.check,Match=check.Match,FacetBaseClass=require("../components/c_facet"),facetRegistry=require("../components/c_facets/cf_registry");module.exports=createFacetClass},{"../components/c_facet":17,"../components/c_facets/cf_registry":32,"milo-core":88}],58:[function(require,module,exports){"use strict";var miloCore=require("milo-core"),_=miloCore.proto,logger=miloCore.util.logger,config=require("../config");module.exports=function deprecate(fn,message){function deprecated(){return!config.deprecationWarning||warned&&"always"!=config.deprecationWarning||(logger.error(message||"Function "+fn.name+" is DEPRECATED"),warned=!0),fn.apply(this,arguments)}var warned;switch(typeof fn){case"object":return _.mapKeys(fn,function(f){return deprecate(f,message)});case"function":for(var prop in fn)deprecated[prop]=deprecate(fn[prop],message);return deprecated;default:return fn}}},{"../config":43,"milo-core":88}],59:[function(require,module,exports){"use strict";function children(el){return filterNodeListByType(el.childNodes,Node.ELEMENT_NODE)}function filterNodeListByType(nodeList,nodeType){return _.filter(nodeList,function(node){return node.nodeType==nodeType})}function containingElement(node){for(;node;){if(node.nodeType==Node.ELEMENT_NODE)return node;node=node.parentNode}return null}function selectElementContents(el){var doc=el.ownerDocument;if(!doc)return logger.error("selectElementContents: element has no document");var range=doc.createRange();range.selectNodeContents(el);var win=getNodeWindow(el),sel=win.getSelection();sel.removeAllRanges(),sel.addRange(range)}function selectElementText(el){var fromNode=firstTextNode(el),toNode=lastTextNode(el);fromNode&&toNode&&setSelection(fromNode,0,toNode,toNode.textContent.length)}function setCaretPosition(node,pos){var doc=node.ownerDocument;if(!doc)return logger.error("setCaretPosition: element has no document");var range=doc.createRange();range.setStart(node,pos);var win=getNodeWindow(node),sel=win.getSelection();sel.removeAllRanges(),sel.addRange(range)}function getSelectionDirection(sel){return _getDirection(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)}function _getDirection(fromNode,startOffset,toNode,endOffset){var docPosition=fromNode.compareDocumentPosition(toNode);return docPosition&Node.DOCUMENT_POSITION_FOLLOWING?1:docPosition&Node.DOCUMENT_POSITION_PRECEDING?-1:fromNode==toNode?startOffset<endOffset?1:startOffset>endOffset?-1:0:void 0}function setSelection(fromNode,startOffset,toNode,endOffset){var doc=fromNode.ownerDocument;if(!doc)return logger("setCaretPosition: element has no document");var container,originalContentEditable,backward=_getDirection(fromNode,startOffset,toNode,endOffset)==-1,range=doc.createRange(),win=getNodeWindow(fromNode),sel=win.getSelection();backward?(range.setStart(toNode,endOffset),range.setEnd(fromNode,startOffset),range.collapse(!1)):(range.setStart(fromNode,startOffset),range.setEnd(toNode,endOffset)),container=range.commonAncestorContainer==Node.ELEMENT_NODE?range.commonAncestorContainer:range.commonAncestorContainer.parentElement,container.isContentEditable||(originalContentEditable=container.contentEditable,container.contentEditable="true"),sel.removeAllRanges(),sel.addRange(range),backward&&sel.extend(toNode,endOffset),originalContentEditable&&(container.contentEditable=originalContentEditable)}function clearSelection(win){win=win||window;var sel=win.getSelection();sel.removeAllRanges()}function getElementOffset(el,includeBorder){var yPos,xPos;for(yPos=el.offsetTop,xPos=el.offsetLeft,el=el.offsetParent;el;)yPos+=el.offsetTop+getBorder(el,"Height",includeBorder),xPos+=el.offsetLeft+getBorder(el,"Width",includeBorder),el=el.offsetParent;return{topOffset:yPos,leftOffset:xPos}}function getBorder(el,type,includeBorder){if(includeBorder){var side="Height"==type?"top":"left",styles=window.getComputedStyle(el),sideValue=parseInt(styles.getPropertyValue("border-"+side+"-width"),10);if(sideValue)return sideValue}return 0}function removeElement(el,normalize){var parent=el.parentNode;parent&&(parent.removeChild(el),normalize&&parent.normalize())}function firstTextNode(node){if(node.nodeType==Node.TEXT_NODE)return node;var treeWalker=createTreeWalker(node,NodeFilter.SHOW_TEXT);return treeWalker.firstChild()}function lastTextNode(node){if(node.nodeType==Node.TEXT_NODE)return node;var treeWalker=createTreeWalker(node,NodeFilter.SHOW_TEXT);return treeWalker.lastChild()}function unwrapElement(el){var parent=el.parentNode;if(parent){var frag=document.createDocumentFragment(),children=_.slice(el.childNodes);children.forEach(frag.appendChild,frag),parent.replaceChild(frag,el),parent.normalize()}}function wrapInElement(wrapIntoEl,el){var parent=el.parentNode;parent&&(parent.insertBefore(wrapIntoEl,el),wrapIntoEl.appendChild(el))}function trimNodeRight(node){return _trimNode(node,"trimRight")}function trimNodeLeft(node){return _trimNode(node,"trimLeft")}function _trimNode(node,methodName){var len=node.length;return node.textContent=node.textContent[methodName](),len!==node.length}function detachComponent(el){delete el[config.componentRef]}function stripHtml(str){var div=document.createElement("DIV");return div.innerHTML=str,div.textContent||""}function walkTree(root,filter,iterator,context){for(var tw=document.createTreeWalker(root,filter);tw.nextNode();){var result=iterator.call(context||root,tw.currentNode);if(result===!1)break}}function treePathOf(rootEl,el){function containsEl(child){return child.contains(el)}if(rootEl&&rootEl.contains(el)){for(var treePath=[],node=rootEl;node!=el;){var nodeIndex=_.findIndex(node.childNodes,containsEl);treePath.push(nodeIndex),node=node.childNodes[nodeIndex]}return treePath}}function getNodeAtTreePath(rootEl,treePath,nearest){if(treePath){var len=treePath.length;if(0===len)return rootEl;for(var node=rootEl,i=0;i<len;i++){var children=node.childNodes;if(!children){nearest||(node=void 0);break}var childIndex=treePath[i],child=children[childIndex];if(!child){node=nearest?children[children.length-1]:void 0;break}node=child}return node}}function insertAtTreePath(rootEl,treePath,el,nearest){var toNormalize=el.nodeType==Node.TEXT_NODE;if(rootEl.contains(el)&&removeElement(el),0!==treePath.length){var parent=getNodeAtTreePath(rootEl,treePath.slice(0,-1),nearest),children=parent.childNodes;if(!children){if(!nearest)return;parent=parent.parentNode,children=parent.childNodes}var childIndex=treePath[treePath.length-1],child=children[childIndex];return child?(parent.insertBefore(el,child),toNormalize&&parent.normalize(),!0):0!==children.length||0!==childIndex&&!nearest?(child=children[childIndex-1],child||nearest?(parent.appendChild(el),toNormalize&&parent.normalize(),!0):void 0):(parent.appendChild(el),toNormalize&&parent.normalize(),!0)}}function isTreePathBefore(path1,path2){var isBefore,i=0;if(!Array.isArray(path1)&&Array.isArray(path2))return logger.error("isTreePathBefore: One or both paths are not valid treepath arrays.");for(i;i<path1.length;i++){if(path1[i]<path2[i]){isBefore=!0;break}if(path1[i]>path2[i]){isBefore=!1;break}}return"undefined"==typeof isBefore&&path1.length<path2.length&&logger.warn("isTreePathBefore: One node is inside another"),isBefore||!1}function htmlEntities(str){return str.replace(/[\u00A0-\u99999<>\&]/gim,function(i){return"&#"+i.charCodeAt(0)+";"})}function createTreeWalker(el,whatToShow){return whatToShow=whatToShow||NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,document.createTreeWalker(el,whatToShow)}function getNodeWindow(node){var doc=node.ownerDocument;return doc&&(doc.defaultView||doc.parentWindow)}function forEachNodesInRange(range,cb){function isNodeInsideRange(node){var nodeRange=document.createRange(),isInside=!1;return nodeRange.selectNode(node),nodeRange.compareBoundaryPoints(window.Range.START_TO_START,range)!=-1&&1!=nodeRange.compareBoundaryPoints(window.Range.END_TO_END,range)&&(isInside=!0),isInside}for(var currentNode,rangeContainer=range.commonAncestorContainer,doc=rangeContainer.ownerDocument,treeWalker=doc.createTreeWalker(rangeContainer,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);currentNode=treeWalker.nextNode();)isNodeInsideRange(currentNode)&&cb(currentNode)}function getComponentsFromRange(range){var win=getNodeWindow(range.startContainer),Component=win.milo.Component,components=[];return forEachNodesInRange(range,function(node){if(node.nodeType!=Node.TEXT_NODE){var comp=Component.getComponent(node);comp&&components.push(comp)}}),components}function deleteRangeWithComponents(range){var components=getComponentsFromRange(range);components.forEach(function(comp){comp.destroy(!0)}),range.deleteContents()}function areRangesEqual(range1,range2){return 0===range1.compareBoundaryPoints(window.Range.START_TO_START,range2)&&0===range1.compareBoundaryPoints(window.Range.END_TO_END,range2)}function xpathSelector(xpath,context){if(!document.evaluate)return logger.error("document.evaluate is not supported");context=context||document;var result=document.evaluate(xpath,context,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return result&&result.singleNodeValue}function xpathSelectorAll(xpath,context){if(!document.evaluate)return logger.error("document.evaluate is not supported");context=context||document;for(var node,result=document.evaluate(xpath,context,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),nodes=[],i=0;node=result.snapshotItem(i);)nodes[i++]=node;return nodes}function addDebugPoint(x,y){var dbEl=document.createElement("div");dbEl.setAttribute("style","width: 1px; height: 1px; position:fixed; left:"+x+"px; top:"+y+"px; background-color:red; z-index: 100"),setTimeout(function(){document.body.appendChild(dbEl)},200)}var config=require("../config"),miloCore=require("milo-core"),_=miloCore.proto,logger=miloCore.util.logger,domUtils={children:children,filterNodeListByType:filterNodeListByType,containingElement:containingElement,
selectElementContents:selectElementContents,selectElementText:selectElementText,getElementOffset:getElementOffset,setCaretPosition:setCaretPosition,getSelectionDirection:getSelectionDirection,setSelection:setSelection,clearSelection:clearSelection,removeElement:removeElement,unwrapElement:unwrapElement,wrapInElement:wrapInElement,detachComponent:detachComponent,firstTextNode:firstTextNode,lastTextNode:lastTextNode,trimNodeRight:trimNodeRight,trimNodeLeft:trimNodeLeft,stripHtml:stripHtml,htmlEntities:htmlEntities,walkTree:walkTree,createTreeWalker:createTreeWalker,treePathOf:treePathOf,getNodeAtTreePath:getNodeAtTreePath,insertAtTreePath:insertAtTreePath,isTreePathBefore:isTreePathBefore,getNodeWindow:getNodeWindow,getComponentsFromRange:getComponentsFromRange,deleteRangeWithComponents:deleteRangeWithComponents,forEachNodesInRange:forEachNodesInRange,areRangesEqual:areRangesEqual,xpathSelector:xpathSelector,xpathSelectorAll:xpathSelectorAll,addDebugPoint:addDebugPoint};module.exports=domUtils},{"../config":43,"milo-core":88}],60:[function(require,module,exports){"use strict";function DOMListeners(){this.listeners=[]}function DOMListeners$add(target,eventType,handler){this.listeners.push({target:target,eventType:eventType,handler:handler}),target.addEventListener(eventType,handler)}function DOMListeners$remove(target,eventType,handler){var listener={target:target,eventType:eventType,handler:handler},idx=_.findIndex(this.listeners,_.partial(_.isEqual,listener));idx>-1&&(this.listeners.splice(idx,1),_removeListener(listener))}function DOMListeners$removeAll(){this.listeners.forEach(_removeListener),this.listeners=[]}function _removeListener(l){l.target.removeEventListener(l.eventType,l.handler)}var _=require("milo-core").proto;module.exports=DOMListeners,_.extendProto(DOMListeners,{add:DOMListeners$add,remove:DOMListeners$remove,removeAll:DOMListeners$removeAll})},{"milo-core":88}],61:[function(require,module,exports){"use strict";function domReady(func){function callFunc(){func.apply(self,args)}var self=this,args=_.slice(arguments,1);isReady.call(this)?callFunc():(domReadySubscribed||(document.addEventListener("readystatechange",onDomReady),domReadySubscribed=!0),domReadyFuncs.push(callFunc))}function onDomReady(){document.removeEventListener("readystatechange",onDomReady),domReadyFuncs.forEach(function(func){func()})}function isReady(){var readyState=document.readyState;return"loading"!=readyState&&readyState}var _=require("milo-core").proto;module.exports=domReady;var domReadyFuncs=[],domReadySubscribed=!1;_.extend(domReady,{isReady:isReady})},{"milo-core":88}],62:[function(require,module,exports){"use strict";function DragDrop(event){this.event=event,this.dataTransfer=event.dataTransfer,this.types=this.dataTransfer.types;var items=this.dataTransfer.items;this.items=_.map(items||[],function(i){return{kind:i.kind,type:i.type}})}function DragDrop$$componentDataType(){return dragDropConfig.dataTypes.component}function DragDrop$$getDropPositionY(event,el){var dP=getDropPosition(event,el),isBelow=dP.clientY>dP.targetTop+dP.targetHeight/2;return isBelow?"below":"above"}function getDropPosition(event,el){try{var clientRect=el.getBoundingClientRect(),targetWidth=clientRect.width,targetHeight=clientRect.height,targetTop=clientRect.top,targetLeft=clientRect.left}catch(e){}return{clientX:event.clientX,clientY:event.clientY,targetWidth:targetWidth,targetHeight:targetHeight,targetTop:targetTop,targetLeft:targetLeft}}function DragDrop$isComponent(){return _.indexOf(this.types,DragDrop.componentDataType())>=0}function DragDrop$getComponentState(){var dataType=DragDrop.componentDataType(),stateStr=this.dataTransfer.getData(dataType),state=_.jsonParse(stateStr);return state}function DragDrop$setComponentState(component,stateStr){if(!stateStr){var state=component.getTransferState({requestedBy:"drag"});stateStr=JSON.stringify(state)}var dataType=DragDrop.componentDataType();return stateStr&&this.dataTransfer.setData(dataType,stateStr),this.dataTransfer.setData("text/html",component.el.outerHTML),stateStr}function DragDrop$setComponentMeta(component,params,data){var meta=_componentMeta(component),paramsStr=JSON.stringify(params||{}),dataType=dragDropConfig.dataTypes.componentMetaTemplate.replace("%class",_encode(meta.compClass||"")).replace("%name",_encode(meta.compName||"")).replace("%params",_encode(paramsStr||""));return data&&"object"==typeof data&&(data=JSON.stringify(data)),this.dataTransfer.setData(dataType,data||""),dataType}function _encode(str){return base32.encode(str).toLowerCase()}function _componentMeta(component){return component.transfer?component.transfer.getComponentMeta():{compClass:component.constructor.name,compName:component.name}}function DragDrop$getComponentMeta(){var match,metaDataType=_.find(this.types,function(dType){return match=dType.match(componentMetaRegex),!!match});if(metaDataType){for(var i=1;i<4;i++)match[i]=base32.decode(match[i]);return{compClass:match[1],compName:match[2],params:JSON.parse(match[3]),metaDataType:metaDataType,metaData:_.jsonParse(this.dataTransfer.getData(metaDataType))||this.dataTransfer.getData(metaDataType)}}}function DragDrop$getAllowedEffects(){return this.dataTransfer.effectAllowed}function DragDrop$setAllowedEffects(effects){this.dataTransfer.effectAllowed=effects}function DragDrop$getDropEffect(){return this.dataTransfer.dropEffect}function DragDrop$setDropEffect(effect){this.dataTransfer.dropEffect=effect}function DragDrop$isEffectAllowed(effect){var allowedEffects=this.getAllowedEffects(),isCopy="copy"==effect,isMove="move"==effect,isLink="link"==effect,isAllowed=isCopy||isLink||isMove;switch(allowedEffects){case"copy":case"move":case"link":return allowedEffects==effect;case"copyLink":return isCopy||isLink;case"copyMove":return isCopy||isMove;case"linkMove":return isLink||isMove;case"all":case"uninitialized":return isAllowed;case"none":return!1}}function DragDrop$getData(dataType){return this.dataTransfer.getData(dataType)}function DragDrop$setData(dataType,dataStr){this.dataTransfer.setData(dataType,dataStr)}function DragDrop$clearData(dataType){this.dataTransfer.clearData(dataType)}function onDragDropStarted(msg,data){_currentDragDrop=data.dragDrop,_currentDragFacet=data.dragFacet}function onDragDropCompleted(msg,data){_currentDragFacet&&_currentDragFacet.postMessageSync("dragdropcompleted",data),_currentDragDrop=void 0,_currentDragFacet=void 0}function onCompleteDragDrop(msg,data){_currentDragDrop&&dragDropService.postMessageSync("dragdropcompleted",data)}function getCurrentDragDrop(){return _currentDragDrop}function getCurrentDragSource(){return _currentDragFacet&&_currentDragFacet.owner}function DragDrop_destroy(){dragDropService.offAll()}var miloCore=require("milo-core"),Messenger=miloCore.Messenger,dragDropConfig=require("../config").dragDrop,componentMetaRegex=dragDropConfig.dataTypes.componentMetaRegex,_=miloCore.proto,base32=require("./base32");module.exports=DragDrop,_.extend(DragDrop,{componentDataType:DragDrop$$componentDataType,getDropPositionY:DragDrop$$getDropPositionY}),_.extendProto(DragDrop,{isComponent:DragDrop$isComponent,getComponentState:DragDrop$getComponentState,setComponentState:DragDrop$setComponentState,getComponentMeta:DragDrop$getComponentMeta,setComponentMeta:DragDrop$setComponentMeta,getAllowedEffects:DragDrop$getAllowedEffects,setAllowedEffects:DragDrop$setAllowedEffects,getDropEffect:DragDrop$getDropEffect,setDropEffect:DragDrop$setDropEffect,isEffectAllowed:DragDrop$isEffectAllowed,getData:DragDrop$getData,setData:DragDrop$setData,clearData:DragDrop$clearData});var _currentDragDrop,_currentDragFacet,dragDropService=new Messenger;_.extend(DragDrop,{service:dragDropService,destroy:DragDrop_destroy}),dragDropService.onMessages({dragdropstarted:onDragDropStarted,dragdropcompleted:onDragDropCompleted,completedragdrop:onCompleteDragDrop}),_.extend(dragDropService,{getCurrentDragDrop:getCurrentDragDrop,getCurrentDragSource:getCurrentDragSource})},{"../config":43,"./base32":54,"milo-core":88}],63:[function(require,module,exports){"use strict";function error$createClass(errorClassName){var ErrorClass=_.makeFunction(errorClassName,"message",'this.name = "'+errorClassName+'";             this.message = message || "There was an  error";');return _.makeSubclass(ErrorClass,Error),ErrorClass}function error$toBeImplemented(){throw new error.AbstractClass("calling the method of an absctract class")}var _=require("milo-core").proto,errorClassNames=["AbstractClass","Mixin","Messenger","Component","Attribute","Binder","Loader","MailMessageSource","Facet","Scope","Model","DomFacet","EditableFacet","List","Connector","Registry","FrameMessageSource","Drop","Angular","StorageMessageSource"],error={toBeImplemented:error$toBeImplemented,createClass:error$createClass};errorClassNames.forEach(function(name){error[name]=error$createClass(name+"Error")}),module.exports=error},{"milo-core":88}],64:[function(require,module,exports){"use strict";function fragment_getState(range,renameChildren,wrapperClassName){var rangeContainer=_getRangeContainer(range);if(!rangeContainer)return void logger.error("fragment.getState: range has no common container");var frag=range.cloneContents(),wrapper=_wrapFragmentInContainer(frag,wrapperClassName);_transferStates(rangeContainer,wrapper),renameChildren&&_renameChildren(wrapper);var wrapperState=wrapper.getState();return _.deferMethod(wrapper,"destroy"),wrapperState}function fragment_getStateAsync(range,renameChildren,callback){try{var rangeContainer=_getRangeContainer(range);if(!rangeContainer)return void callback(new Error("fragment.getState: range has no common container"));"function"==typeof renameChildren&&(callback=renameChildren,renameChildren=!1);var frag=range.cloneContents(),wrapper=_wrapFragmentInContainer(frag);_transferStates(rangeContainer,wrapper),_.defer(function(){wrapper.broadcast("stateready"),_.defer(function(){renameChildren&&_renameChildren(wrapper);var wrapperState=wrapper.getState();wrapper.destroy(),callback(null,wrapperState)})})}catch(err){callback(err)}}function _wrapFragmentInContainer(frag,wrapperClassName){var wrapEl=document.createElement("div"),attr=new BindAttribute(wrapEl);_.extend(attr,{compClass:wrapperClassName||"Component",compFacets:wrapperClassName?[]:["container"],compName:"wrapper"}),attr.decorate(),wrapEl.appendChild(frag);var scope=binder(wrapEl);return scope.wrapper}function _getRangeContainer(range){var el=domUtils.containingElement(range.commonAncestorContainer);return Component.getContainingComponent(el,!0,"container")}function _transferStates(fromComp,toComp){var fromScope=fromComp.container.scope;toComp.container.scope._each(function(toChildComp,name){var fromChildComp=fromScope[name];if(!fromChildComp)return logger.error("fragment.getState: conponent",name,"not found in range");var state=fromChildComp._getState(!0);toChildComp.setState(state)})}function _renameChildren(comp){comp.container.scope._each(function(child){child.rename()})}function expandRangeToSiblings(range){var siblings=getRangeSiblings(range);return range=createRangeFromSiblings(siblings)}function createRangeFromSiblings(nodes){var range=document.createRange();return nodes.siblings?(range.setStartBefore(nodes.start),range.setEndAfter(nodes.end)):range.selectNode(nodes.start),range}function getRangeSiblings(range){var containerNode=range.commonAncestorContainer,startNode=range.startContainer,endNode=range.endContainer;if(startNode==endNode)return startNode!=containerNode&&logger.error("deleteSelectionCommand logical error: start==end, but container is different"),{siblings:!1,start:startNode};if(startNode==containerNode||endNode==containerNode)return{siblings:!1,start:containerNode};var startSibling=_findContainingChild(containerNode,startNode),endSibling=_findContainingChild(containerNode,endNode);return startSibling&&endSibling?startSibling==endSibling?(logger.error("deleteSelectionCommand logical error: same siblings"),{siblings:!1,start:startSibling}):{siblings:!0,start:startSibling,end:endSibling}:void 0}function _findContainingChild(containerNode,selNode){return _.find(containerNode.childNodes,function(node){return node.contains(selNode)})}function _createNodesAndPathsFunc(func){return function(rootEl,fromObj){var toObj={siblings:fromObj.siblings,start:func(rootEl,fromObj.start)};return toObj.siblings&&(toObj.end=func(rootEl,fromObj.end)),toObj}}var Component=require("../components/c_class"),BindAttribute=require("../attributes/a_bind"),binder=require("../binder"),domUtils=require("./dom"),miloCore=require("milo-core"),logger=miloCore.util.logger,_=miloCore.proto,createRangePaths=_createNodesAndPathsFunc(domUtils.treePathOf),createRangeNodes=_createNodesAndPathsFunc(domUtils.getNodeAtTreePath);module.exports={getState:fragment_getState,getStateAsync:fragment_getStateAsync,expandRangeToSiblings:expandRangeToSiblings,getRangeSiblings:getRangeSiblings,createRangeFromSiblings:createRangeFromSiblings,createRangeFromNodes:createRangeFromSiblings,createRangePaths:createRangePaths,createRangeNodes:createRangeNodes}},{"../attributes/a_bind":4,"../binder":9,"../components/c_class":16,"./dom":59,"milo-core":88}],65:[function(require,module,exports){"use strict";function util_destroy(){util.request.destroy(),util.dragDrop.destroy()}var miloCore=require("milo-core"),deprecate=require("./deprecate"),util={logger:miloCore.util.logger,request:require("./request"),websocket:require("./websocket"),check:miloCore.util.check,error:deprecate(require("./error"),"milo.util.error is DEPRECATED and will be REMOVED soon!"),count:deprecate(require("./unique_id"),"milo.util.count is DEPRECATED! Use milo.util.uniqueId instead"),uniqueId:require("./unique_id"),componentName:require("./component_name"),dom:require("./dom"),domListeners:require("./dom_listeners"),selection:require("./selection"),fragment:require("./fragment"),jsonParse:deprecate(require("./json_parse"),"milo.util.jsonParse is DEPRECATED! Use _.jsonParse instead"),storage:require("./storage"),domReady:require("./domready"),dragDrop:require("./dragdrop"),deprecate:deprecate,doT:miloCore.util.doT,destroy:util_destroy,queryString:require("querystringparser")};module.exports=util},{"./component_name":55,"./deprecate":58,"./dom":59,"./dom_listeners":60,"./domready":61,"./dragdrop":62,"./error":63,"./fragment":64,"./json_parse":66,"./request":67,"./selection":68,"./storage":69,"./unique_id":72,"./websocket":73,"milo-core":88,querystringparser:123}],66:[function(require,module,exports){"use strict";function jsonParse(str){try{return JSON.parse(str)}catch(e){}}module.exports=jsonParse},{}],67:[function(require,module,exports){"use strict";function createPromiseOverride(functionName){return function(){return addAbortAbility(Promise.prototype[functionName].apply(this,arguments),this.abort)}}function request(url,opts,callback){var abort;return opts.url=url,opts.contentType=opts.contentType||"application/json;charset=UTF-8",_messenger&&request.postMessageSync("request",{options:opts}),addAbortAbility(new Promise(function(resolve,reject){var req=new XMLHttpRequest;req.open(opts.method,opts.url,!opts.sync),req.setRequestHeader("Content-Type",opts.contentType),setRequestHeaders(req,opts.headers),opts.sync||(req.timeout=opts.timeout||config.request.defaults.timeout),req.onloadend=req.ontimeout=req.onabort=function(e){abort=null,_onReady(e.type,req,callback,resolve,reject)},req[config.request.optionsKey]=opts,opts.trackCompletion!==!1&&_pendingRequests.push(req);var data=opts.data,ric=requestIdleCallback(function(deadline){ric=null;try{req.send(JSON.stringify(data))}catch(e){console.error("Request Error: ",url,e,opts)}},{timeout:req.timeout});abort=function(){abort&&!ric?req.abort():ric&&(cancelIdleCallback(ric),ric=null),abort=null}}),abort)}function addAbortAbility(promise,abort){return promise.abort=abort,promise.then=promiseThen,promise.catch=promiseCatch,promise}function setRequestHeaders(req,headers){headers&&_.eachKey(headers,function(value,key){req.setRequestHeader(key,value)})}function _onReady(eventType,req,callback,resolve,reject){function postMessage(msg){_messenger&&request.postMessage(msg,{status:status,response:req.responseText})}if(4==req.readyState&&!req[config.request.completedKey]){_.spliceItem(_pendingRequests,req);var error;try{if(req.status>=200&&req.status<400){try{postMessage("success"),callback&&callback(null,req.responseText,req)}catch(e){error=e}resolve(req.responseText)}else{var errorReason=req.status||eventType;try{postMessage("error"),postMessage("error"+errorReason),callback&&callback(errorReason,req.responseText,req)}catch(e){error=e}reject({reason:errorReason,response:req.responseText})}}catch(e){error=error||e}finally{req[config.request.completedKey]=!0}if(req.onloadend=req.ontimeout=req.onabort=void 0,_pendingRequests.length||postMessage("requestscompleted"),error){var errObj=new Error("Exception: "+error);throw logger.error(error.stack),errObj}}}function request$useMessenger(){_messenger=new Messenger(request,["on","once","onSync","off","onMessages","offMessages","postMessage","postMessageSync"])}function request$get(url,callback){return request(url,{method:"GET"},callback)}function request$post(url,data,callback){return request(url,{method:"POST",data:data},callback)}function request$put(url,data,callback){return request(url,{method:"PUT",data:data},callback)}function request$delete(url,data,callback){return request(url,{method:"DELETE",data:data},callback)}function request$json(url,callback){var promise=request(url,{method:"GET"}),jsonPromise=promise.then(JSON.parse);return callback&&jsonPromise.then(function(data){callback(null,data)},function(errData){callback(errData.reason,errData.response)}),jsonPromise}function request$jsonp(url,callback){var abort;return addAbortAbility(new Promise(function(resolve,reject){function _onResult(err,result){abort=null,_.spliceItem(_pendingRequests,window[uniqueCallback]);var error;try{postMessage(err?"error":"success",err,result),err&&(logger.error("No JSONP response or timeout"),postMessage("errorjsonptimeout",err)),callback&&callback(err,result)}catch(e){error=e}if(err?reject(err):resolve(result),cleanUp(),_pendingRequests.length||postMessage("requestscompleted"),error)throw error}function cleanUp(){clearTimeout(timeout),head.removeChild(script),delete window[uniqueCallback]}function postMessage(msg,status,result){_messenger&&request.postMessage(msg,{status:status,response:result})}var script=document.createElement("script"),head=window.document.head,uniqueCallback=config.request.jsonpCallbackPrefix+uniqueId(),opts=_.extend({url:url},jsonpOptions);_messenger&&request.postMessageSync("request",{options:opts}),_.isEqual(_.omitKeys(opts,"url"),jsonpOptions)||logger.warn("Ignored not allowed request options change in JSONP request - only URL can be changed");var timeout=setTimeout(function(){var err=new Error("No JSONP response or no callback in response");_onResult(err)},config.request.jsonpTimeout);window[uniqueCallback]=_.partial(_onResult,null),_pendingRequests.push(window[uniqueCallback]),script.type="text/javascript",script.src=opts.url+(opts.url.indexOf("?")==-1?"?":"&")+"callback="+uniqueCallback,head.appendChild(script),abort=function(){abort&&(abort=null,window[uniqueCallback]=cleanUp)}}),abort)}function request$file(opts,fileData,callback,progress){var abort;return addAbortAbility(new Promise(function(resolve,reject){"string"==typeof opts&&(opts={method:"POST",url:opts}),opts.method=opts.method||"POST",opts.file=!0,_messenger&&request.postMessageSync("request",{options:opts});var req=new XMLHttpRequest;if(progress&&(req.upload.onprogress=progress),req.open(opts.method,opts.url,!0),setRequestHeaders(req,opts.headers),req.timeout=opts.timeout||config.request.defaults.timeout,req.onloadend=req.ontimeout=req.onabort=function(e){abort=null,progress&&(req.upload.onprogress=void 0),_onReady(e.type,req,callback,resolve,reject)},opts.binary)req.send(fileData);else{var formData=new FormData;formData.append("file",fileData),req.send(formData)}req[config.request.optionsKey]=opts,opts.trackCompletion!==!1&&_pendingRequests.push(req),abort=function(){abort&&(abort=null,req.abort())}}),abort)}function request$destroy(){_messenger&&_messenger.destroy(),request._destroyed=!0}function whenRequestsCompleted(callback,timeout){callback=_.once(callback),timeout&&_.delay(callback,timeout,"timeout"),_pendingRequests.length?_messenger.once("requestscompleted",callback):_.defer(callback)}var miloCore=require("milo-core"),_=miloCore.proto,uniqueId=require("./unique_id"),config=require("../config"),logger=miloCore.util.logger,Messenger=miloCore.Messenger,cancelIdleCallback=window.cancelIdleCallback||window.clearTimeout,requestIdleCallback=window.requestIdleCallback||function(cb){var start=Date.now();return setTimeout(function(){cb({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-start))}})},1)};module.exports=request;var _pendingRequests=[],promiseThen=createPromiseOverride("then"),promiseCatch=createPromiseOverride("catch");_.extend(request,{get:request$get,post:request$post,put:request$put,delete:request$delete,json:request$json,jsonp:request$jsonp,file:request$file,useMessenger:request$useMessenger,destroy:request$destroy,whenRequestsCompleted:whenRequestsCompleted});var _messenger,jsonpOptions={method:"GET",jsonp:!0}},{"../config":43,"./unique_id":72,"milo-core":88}],68:[function(require,module,exports){"use strict";function TextSelection(win){return!this instanceof TextSelection?new TextSelection(win):(this.window=win||window,void this.init())}function TextSelection$init(){this.selection=this.window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0)),this.isCollapsed=this.selection.isCollapsed}function TextSelection$text(){if(this.range)return this._text||(this._text=this.range.toString()),this._text}function TextSelection$textNodes(){if(this.range)return this._textNodes||(this._textNodes=_getTextNodes.call(this)),this._textNodes}function TextSelection$clear(){this.selection.removeAllRanges()}function _getTextNodes(){var textNodes=[];if(this.isCollapsed)return textNodes;for(var selStart=this.range.startContainer,selEnd=this.range.endContainer,rangeContainer=this.range.commonAncestorContainer,treeWalker=this.window.document.createTreeWalker(rangeContainer,NodeFilter.SHOW_TEXT),node=treeWalker.currentNode=selStart;node&&(!inEnd||selEnd.contains(node));){textNodes.push(node);var inEnd=inEnd||selEnd.contains(node);node=treeWalker.nextNode()}return textNodes}function _getElement(thisPropName,rangePropName){if(this.range)return"undefined"==typeof this[thisPropName]&&(this[thisPropName]=containingElement(this.range[rangePropName])),this[thisPropName]}function _getComponent(thisPropName,elMethodName){if(this.range)return"undefined"==typeof this[thisPropName]&&(this[thisPropName]=Component.getContainingComponent(this[elMethodName]())),this[thisPropName]}function TextSelection$containedComponents(){if(this._containedComponents)return this._containedComponents;var components=this._containedComponents=[];return this.isCollapsed||!this.range?components:getComponentsFromRange(this.range)}function TextSelection$eachContainedComponent(callback,thisArg){if(!this.isCollapsed&&this.range){var components=this.containedComponents();components.forEach(callback,thisArg)}}function TextSelection$del(selectEndContainer){if(!this.isCollapsed&&this.range){var selPoint=this._getPostDeleteSelectionPoint(selectEndContainer);deleteRangeWithComponents(this.range),this._selectAfterDelete(selPoint),selPoint.node.parentNode.normalize()}}function _getPostDeleteSelectionPoint(selectEndContainer){var selNode=this.range.startContainer,selOffset=this.range.startOffset;return selectEndContainer&&this.range.startContainer!=this.range.endContainer&&(selNode=this.range.endContainer,selOffset=0),{node:selNode,offset:selOffset}}function _selectAfterDelete(selPoint){var selNode=selPoint.node,selOffset=selPoint.offset;if(selNode){selNode.nodeType==Node.TEXT_NODE&&(selNode.textContent=selNode.textContent.trimRight()),selNode.nodeValue||(selNode.nodeValue=" ");var position=selOffset>selNode.length?selNode.length:selOffset;setCaretPosition(selNode,position)}}function TextSelection$getRange(){return this.range}function TextSelection$getState(rootEl){var r=this.range,doc=rootEl.ownerDocument,win=doc.defaultView||doc.parentWindow;return r?TextSelection.createStateObject(rootEl,r.startContainer,r.startOffset,r.endContainer,r.endOffset):{window:win}}function TextSelection$$createStateObject(rootEl,startContainer,startOffset,endContainer,endOffset){endContainer=endContainer||startContainer,endOffset=endOffset||startOffset;var doc=rootEl.ownerDocument,win=doc.defaultView||doc.parentWindow;return{window:win,rootEl:rootEl,start:_getSelectionPointState(rootEl,startContainer,startOffset),end:_getSelectionPointState(rootEl,endContainer,endOffset)}}function _getSelectionPointState(rootEl,node,offset){var treePath=domUtils.treePathOf(rootEl,node);return treePath||logger.warn("Selection point is outside of root element"),{treePath:treePath,offset:offset}}function TextSelection$$createFromState(state){var domUtils=state.window.milo.util.dom;if(!(state.rootEl&&state.start&&state.end))return domUtils.clearSelection(state.window),new TextSelection(state.window);var startNode=_selectionNodeFromState(state.rootEl,state.start),endNode=_selectionNodeFromState(state.rootEl,state.end);try{return domUtils.setSelection(startNode,state.start.offset,endNode,state.end.offset),new TextSelection(state.window)}catch(e){logger.error("Text selection: can't create selection",e,e.message)}}function _selectionNodeFromState(rootEl,pointState){var node=domUtils.getNodeAtTreePath(rootEl,pointState.treePath);return node||logger.error("TextSelection createFromState: no node at treePath"),node}function TextSelection$$createFromRange(range,backward){var endRange,win=range.startContainer.ownerDocument.defaultView,sel=win.getSelection();return sel.removeAllRanges(),backward?(endRange=range.cloneRange(),endRange.collapse(!1),sel.addRange(endRange),sel.extend(range.startContainer,range.startOffset)):sel.addRange(range),new TextSelection(win)}function TextSelection$$getNormalizedRange(){var tw,previousNode,doc=this.range.commonAncestorContainer.ownerDocument,newRange=this.range.cloneRange();return newRange.endContainer.nodeType!==Node.TEXT_NODE&&(tw=doc.createTreeWalker(doc.body,NodeFilter.SHOW_TEXT),tw.currentNode=newRange.endContainer,previousNode=tw.previousNode(),newRange.setEnd(previousNode,previousNode.length)),newRange}function TextSelection$$getDirection(){return domUtils.getSelectionDirection(this.selection)}var domUtils=require("../dom"),containingElement=domUtils.containingElement,setCaretPosition=domUtils.setCaretPosition,getComponentsFromRange=domUtils.getComponentsFromRange,deleteRangeWithComponents=domUtils.deleteRangeWithComponents,miloCore=require("milo-core"),logger=miloCore.util.logger,Component=require("../../components/c_class"),_=miloCore.proto;module.exports=TextSelection;var TextSelection$startElement=_.partial(_getElement,"_startElement","startContainer"),TextSelection$endElement=_.partial(_getElement,"_endElement","endContainer"),TextSelection$containingElement=_.partial(_getElement,"_containingElement","commonAncestorContainer"),TextSelection$startComponent=_.partial(_getComponent,"_startComponent","startElement"),TextSelection$endComponent=_.partial(_getComponent,"_endComponent","endElement"),TextSelection$containingComponent=_.partial(_getComponent,"_containingComponent","containingElement");_.extendProto(TextSelection,{init:TextSelection$init,text:TextSelection$text,textNodes:TextSelection$textNodes,clear:TextSelection$clear,startElement:TextSelection$startElement,endElement:TextSelection$endElement,containingElement:TextSelection$containingElement,startComponent:TextSelection$startComponent,endComponent:TextSelection$endComponent,containingComponent:TextSelection$containingComponent,containedComponents:TextSelection$containedComponents,eachContainedComponent:TextSelection$eachContainedComponent,del:TextSelection$del,_getPostDeleteSelectionPoint:_getPostDeleteSelectionPoint,_selectAfterDelete:_selectAfterDelete,getRange:TextSelection$getRange,getState:TextSelection$getState,getNormalizedRange:TextSelection$$getNormalizedRange,getDirection:TextSelection$$getDirection}),_.extend(TextSelection,{createFromRange:TextSelection$$createFromRange,createFromState:TextSelection$$createFromState,createStateObject:TextSelection$$createStateObject})},{"../../components/c_class":16,"../dom":59,"milo-core":88}],69:[function(require,module,exports){"use strict";function DOMStorage(keyPrefix,sessionOnly,win){"undefined"!=typeof window&&(win=win||window,keyPrefix=config.domStorage.root+(keyPrefix?keyPrefix+config.domStorage.prefixSeparator:""),_.defineProperties(this,{keyPrefix:keyPrefix,sessionOnly:!!sessionOnly,window:win,_storage:sessionOnly?win.sessionStorage:win.localStorage,_typeSuffix:config.domStorage.typeSuffix,_keys:{}},_.WRIT))}function DOMStorage$set(data){if("object"==typeof data)_.eachKey(data,function(value,key){this.setItem(key,value)},this);else{var argsLen=arguments.length;if(argsLen%2)throw new Error("DOMStorage: set should have even number of arguments or object");for(var i=0;i<argsLen;i++){var key=arguments[i],value=arguments[++i];this.setItem(key,value)}}}function DOMStorage$get(){var data={};return _.deepForEach(arguments,function(key){data[key]=this.getItem(key)},this),data}function DOMStorage$remove(){_.deepForEach(arguments,function(key){this.removeItem(key)},this)}function DOMStorage$hasItem(key){var pKey=this._storageKey(key);return null!=this._storage.getItem(pKey)}function DOMStorage$getItem(key){var pKey=this._storageKey(key),dataType=_getKeyDataType.call(this,pKey),valueStr=this._storage.getItem(pKey),value=_parseData(valueStr,dataType);return value}function DOMStorage$setItem(key,value){var pKey=this._storageKey(key),dataType=_setKeyDataType.call(this,pKey,value),valueStr=_serializeData(value,dataType);try{this._storage.setItem(pKey,valueStr)}catch(e){if("QuotaExceededError"!=e.name)throw e;var cfg=config.domStorage.quotaExceeded;if(cfg.message&&milo.mail.postMessage("quotaexceedederror",value),cfg.throwError)throw e}this._keys[key]=!0,_domStorage[this.sessionOnly]._keys[pKey]=!0}function DOMStorage$removeItem(key){var pKey=this._storageKey(key);this._storage.removeItem(pKey),_removeKeyDataType.call(this,pKey),delete this._keys[key],delete _domStorage[this.sessionOnly]._keys[pKey]}function DOMStorage$getAllKeys(){var storedKeys=Object.keys(this._keys),keysInStorage=storedKeys.filter(function(key){return!!this.hasItem(key)||void delete this._keys[key]},this);return keysInStorage}function DOMStorage$getAllItems(){return this.get(this.getAllKeys())}function DOMStorage$_storageKey(key){return this.keyPrefix+key}function DOMStorage$_domStorageKey(storageKey){if(!(storageKey.indexOf(this._typeSuffix)>=0))return _.unPrefix(storageKey,this.keyPrefix)}function _getKeyDataType(pKey){return pKey=_dataTypeKey.call(this,pKey),this._storage.getItem(pKey)}function _setKeyDataType(pKey,value){var dataType=_getValueType(value);return pKey=_dataTypeKey.call(this,pKey),this._storage.setItem(pKey,dataType),dataType}function _removeKeyDataType(pKey){pKey=_dataTypeKey.call(this,pKey),this._storage.removeItem(pKey)}function _dataTypeKey(pKey){return pKey+this._typeSuffix}function _getValueType(value){var valueType=typeof value,className=value&&value.constructor.name,dataType=valuesDataTypes[className];return dataType||("object"!=valueType?valueType:null==value?"null":value.constructor.name)}function _serializeData(value,valueType){valueType=valueType||_getValueType(value);var serializer=dataSerializers[valueType];return serializer?serializer(value,valueType):value&&value.toString==Object.prototype.toString?JSON.stringify(value):""+value}function _parseData(valueStr,valueType){var parser=dataParsers[valueType];return parser?parser(valueStr,valueType):valueStr;
}function DOMStorage$$registerDataType(valueType,serializer,parser,storeAsDataType){serializer&&(dataSerializers[valueType]=serializer),parser&&(dataParsers[valueType]=parser),valuesDataTypes[valueType]=storeAsDataType||valueType}function DOMStorage$createMessenger(){var storageMessageSource=new StorageMessageSource(this),messenger=new Messenger(this,void 0,storageMessageSource);_.defineProperties(this,{_messenger:messenger,_messageSource:storageMessageSource},_.WRIT)}function DOMStorage$destroy(){this._storage=void 0,this.window=void 0,this._messenger&&this._messenger.destroy(),this._destroyed=!0}var miloCore=require("milo-core"),Messenger=miloCore.Messenger,StorageMessageSource=require("./msg_src"),config=require("../../config"),_=miloCore.proto;require("./model"),module.exports=DOMStorage;var _storedKeys={true:{},false:{}};_.extendProto(DOMStorage,{get:DOMStorage$get,set:DOMStorage$set,remove:DOMStorage$remove,hasItem:DOMStorage$hasItem,getItem:DOMStorage$getItem,setItem:DOMStorage$setItem,removeItem:DOMStorage$removeItem,_storageKey:DOMStorage$_storageKey,_domStorageKey:DOMStorage$_domStorageKey,getAllKeys:DOMStorage$getAllKeys,getAllItems:DOMStorage$getAllItems,createMessenger:DOMStorage$createMessenger,destroy:DOMStorage$destroy}),Messenger.useWith(DOMStorage,"_messenger",Messenger.defaultMethods),StorageMessageSource.useWith(DOMStorage,"_messageSource",["trigger"]);var _sessionStorage=new DOMStorage("",!0),_localStorage=new DOMStorage("",!1),_domStorage={true:_sessionStorage,false:_localStorage};_.extend(DOMStorage,{registerDataType:DOMStorage$$registerDataType,local:_localStorage,session:_sessionStorage,storage:_domStorage,_storedKeys:_storedKeys});var valuesDataTypes={},dataSerializers={Array:JSON.stringify},dataParsers={Object:_.jsonParse,Array:_.jsonParse,Date:function(valStr){return new Date(valStr)},boolean:function(valStr){return"true"==valStr},number:Number,function:_.toFunction,RegExp:_.toRegExp}},{"../../config":43,"./model":70,"./msg_src":71,"milo-core":88}],70:[function(require,module,exports){"use strict";function Model$$registerWithDOMStorage(){var DOMStorage=require("./index");DOMStorage.registerDataType("Model",Model_domStorageSerializer,Model_domStorageParser),DOMStorage.registerDataType("ModelPath",Model_domStorageSerializer,Model_domStorageParser,"Model")}function Model_domStorageSerializer(value){var data=value.get();return JSON.stringify(data)}function Model_domStorageParser(valueStr){var data=_.jsonParse(valueStr);return new Model(data)}var miloCore=require("milo-core"),Model=miloCore.Model,_=miloCore.proto;Model.registerWithDOMStorage=Model$$registerWithDOMStorage},{"./index":69,"milo-core":88}],71:[function(require,module,exports){"use strict";function init(hostObject,proxyMethods,messengerAPIOrClass){if("DOMStorage"!=hostObject.constructor.name)throw new Error("hostObject should be an instance of DOMStorage");this.storage=hostObject,this.messageKey=config.domStorage.messageKey,this.window=hostObject.window,MessageSource.prototype.init.apply(this,arguments)}function StorageMessageSource$addSourceSubscriber(sourceMessage){this.window.addEventListener("storage",this,!1)}function StorageMessageSource$removeSourceSubscriber(sourceMessage){this.window.removeEventListener("storage",this,!1)}function StorageMessageSource$postMessage(message,data){this.messenger.postMessageSync(message,data)}function StorageMessageSource$trigger(msgType,data){var key=this.messageKey+msgType;data=data||{},data[config.domStorage.messageTimestamp]=uniqueId(),_.deferMethod(this.storage,"setItem",key,data)}function handleEvent(event){if(event.storageArea==this.storage._storage&&"string"==typeof event.key){var key=this.storage._domStorageKey(event.key);if(key){var msgType=_.unPrefix(key,this.messageKey);if(msgType){var data=this.storage.getItem(key);data&&this.dispatchMessage(msgType,data)}}}}var miloCore=require("milo-core"),MessageSource=miloCore.classes.MessageSource,_=miloCore.proto,config=require("../../config"),uniqueId=require("../../util/unique_id"),StorageMessageSource=_.createSubclass(MessageSource,"StorageMessageSource",!0);_.extendProto(StorageMessageSource,{init:init,addSourceSubscriber:StorageMessageSource$addSourceSubscriber,removeSourceSubscriber:StorageMessageSource$removeSourceSubscriber,postMessage:StorageMessageSource$postMessage,trigger:StorageMessageSource$trigger,handleEvent:handleEvent}),module.exports=StorageMessageSource},{"../../config":43,"../../util/unique_id":72,"milo-core":88}],72:[function(require,module,exports){"use strict";function uniqueCount(){var newTimestamp=Date.now();return uniqueID=""+newTimestamp,timestamp==newTimestamp?(count=""===count?0:count+1,uniqueID+="_"+count):(timestamp=newTimestamp,count=""),uniqueID}var timestamp=Date.now(),count="",uniqueID=""+timestamp;uniqueCount.get=function(){return uniqueID},module.exports=uniqueCount},{}],73:[function(require,module,exports){"use strict";function websocket(){var wsMessenger=new Messenger,wsMsgSource=new WSMessageSource(wsMessenger,{send:"trigger",connect:"connect"},new WSMsgAPI);return wsMessenger._setMessageSource(wsMsgSource),wsMessenger}var Messenger=require("milo-core").Messenger,WSMessageSource=require("./msg_src"),WSMsgAPI=require("./msg_api");module.exports=websocket},{"./msg_api":74,"./msg_src":75,"milo-core":88}],74:[function(require,module,exports){"use strict";function translateToSourceMessage(message){return SOCKET_MESSAGES.indexOf(message)>=0?message:"message"}function filterSourceMessage(sourceMessage,message,msgData){if(SOCKET_MESSAGES.indexOf(message)>=0)return!0;if("message"==sourceMessage){var msgType=msgData&&msgData.type;return msgType==message}}function createInternalData(sourceMessage,message,event){var internalData="message"==sourceMessage?_.jsonParse(event.data)||event.data:event;return internalData}var miloCore=require("milo-core"),MessengerAPI=miloCore.classes.MessengerAPI,_=miloCore.proto,WSMsgAPI=_.createSubclass(MessengerAPI,"WSMsgAPI",!0);_.extendProto(WSMsgAPI,{translateToSourceMessage:translateToSourceMessage,filterSourceMessage:filterSourceMessage,createInternalData:createInternalData}),module.exports=WSMsgAPI;var SOCKET_MESSAGES=["open","close","error","message"]},{"milo-core":88}],75:[function(require,module,exports){"use strict";function WSMessageSource$connect(options){this._options=options=options||{};var host=options.host||window.location.host.replace(/:.*/,""),port=options.port||"8080";this._ws&&(this._ws.onopen=this.ws.onmessage=this.ws.onclose=this.ws.onerror=void 0,this._ws.close()),this._ws=new WebSocket("ws://"+host+":"+port)}function addSourceSubscriber(sourceMessage){_wsSubscriberMethod.call(this,"addEventListener",sourceMessage)}function removeSourceSubscriber(sourceMessage){_wsSubscriberMethod.call(this,"removeEventListener",sourceMessage)}function _wsSubscriberMethod(method,sourceMessage){return this._ws?void this._ws[method](sourceMessage,this):logger.error("websocket is not created")}function WSMessageSource$handleEvent(event){this.dispatchMessage(event.type,event)}function WSMessageSource$trigger(msg,data,callback){function onTimeout(){toggleRpcSubscription("off",data.callbackCorrId),callback(new Error("websocket rpc: timeout"))}function onResponse(msg,msgData){if(clearInterval(interval),"object"==typeof msgData){var err=msgData.error?new Error(msgData.error):null;callback(err,msgData.data)}else callback(new Error("websocket rpc: invalid response data"),msgData)}function toggleRpcSubscription(onOff,corrId){self.messenger[onOff](config.websocket.rpc.responsePrefix+corrId,onResponse)}if(!this._ws)return logger.error("websocket is not created");data=data||{},data.type=msg;var self=this;if(callback){data.callbackCorrId=uniqueId();var interval=_.delay(onTimeout,config.websocket.rpc.timeout);toggleRpcSubscription("once",data.callbackCorrId)}this._ws.send(JSON.stringify(data))}var miloCore=require("milo-core"),MessageSource=miloCore.classes.MessageSource,_=miloCore.proto,logger=miloCore.util.logger,uniqueId=require("../../util/unique_id"),config=require("../../config"),WSMessageSource=_.createSubclass(MessageSource,"WSMessageSource",!0);_.extendProto(WSMessageSource,{addSourceSubscriber:addSourceSubscriber,removeSourceSubscriber:removeSourceSubscriber,handleEvent:WSMessageSource$handleEvent,connect:WSMessageSource$connect,trigger:WSMessageSource$trigger}),module.exports=WSMessageSource},{"../../config":43,"../../util/unique_id":72,"milo-core":88}],76:[function(require,module,exports){},{}],77:[function(require,module,exports){(function(global){"use strict";function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length),that.__proto__=Buffer.prototype):(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?fromArrayBuffer(that,value,encodingOrOffset,length):"string"==typeof value?fromString(that,value,encodingOrOffset):fromObject(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function alloc(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromString(that,string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding);that=createBuffer(that,length);var actual=that.write(string,encoding);return actual!==length&&(that=that.slice(0,actual)),that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");return array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),Buffer.TYPED_ARRAY_SUPPORT?(that=array,that.__proto__=Buffer.prototype):that=fromArrayLike(that,array),that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return that=createBuffer(that,len),0===that.length?that:(obj.copy(that,0,0,len),that)}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||isnan(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val=255&val,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&(encoding=String(encoding).toLowerCase(),"ucs2"===encoding||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else foundIndex!==-1&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128===(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128===(192&secondByte)&&128===(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(codePoint=string.charCodeAt(i),codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isnan(val){return val!==val}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("isarray");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len,start<0&&(start=0)):start>len&&(start=len),end<0?(end+=len,end<0&&(end=0)):end>len&&(end=len),end<start&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=this.subarray(start,end),newBuf.__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?(255-this[offset]+1)*-1:this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8);
},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,byteLength=0|byteLength,!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,byteLength=0|byteLength,!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val=255&val);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":78,ieee754:79,isarray:80}],78:[function(require,module,exports){"use strict";function placeHoldersCount(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===b64[len-2]?2:"="===b64[len-1]?1:0}function byteLength(b64){return 3*b64.length/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr,len=b64.length;placeHolders=placeHoldersCount(b64),arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],maxChunkLength=16383,i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength)parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")}exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],79:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],80:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],81:[function(require,module,exports){"use strict";var classes={Mixin:require("ml-mixin"),MessageSource:require("./messenger/m_source"),MessengerMessageSource:require("./messenger/msngr_source"),MessengerAPI:require("./messenger/m_api"),MessengerRegexpAPI:require("./messenger/m_api_rx")};module.exports=classes},{"./messenger/m_api":84,"./messenger/m_api_rx":85,"./messenger/m_source":86,"./messenger/msngr_source":87,"ml-mixin":105}],82:[function(require,module,exports){"use strict";function config(options){_.deepExtend(config,options)}var _=require("protojs");module.exports=config,config({mixin:{instancePropertiesMap:"___mixin_instances"},check:!1,debug:!1})},{protojs:122}],83:[function(require,module,exports){"use strict";function init(hostObject,proxyMethods,messageSource){messageSource&&this._setMessageSource(messageSource),_initializeSubscribers.call(this)}function _initializeSubscribers(){_.defineProperties(this,{_messageSubscribers:{},_patternMessageSubscribers:{}},_.CONF)}function Messenger$destroy(){this.offAll();var messageSource=this.getMessageSource();messageSource&&messageSource.destroy()}function Messenger$on(messages,subscriber){return _Messenger_onWithOptions.call(this,messages,subscriber)}function Messenger$once(messages,subscriber){return _Messenger_onWithOptions.call(this,messages,subscriber,{dispatchTimes:1})}function Messenger$onceSync(messages,subscriber){return _Messenger_onWithOptions.call(this,messages,subscriber,{dispatchTimes:1,sync:!0})}function Messenger$onSync(messages,subscriber){return _Messenger_onWithOptions.call(this,messages,subscriber,{sync:!0})}function Messenger$onAsync(messages,subscriber){return _Messenger_onWithOptions.call(this,messages,subscriber,{sync:!1})}function _Messenger_onWithOptions(messages,subscriber,options){return check(messages,Match.OneOf(String,[String],RegExp)),check(subscriber,Match.OneOf(Function,{subscriber:Function,context:Match.Any,options:Match.Optional(Object)})),"function"==typeof subscriber&&(subscriber={subscriber:subscriber,context:this._hostObject}),options&&(subscriber.options=subscriber.options||{},_.extend(subscriber.options,options)),_Messenger_on.call(this,messages,subscriber)}function _Messenger_on(messages,subscriber){return _.defineProperty(subscriber,"__messages",messages),_eachMessage.call(this,"_registerSubscriber",messages,subscriber)}function _eachMessage(methodName,messages,subscriber){"string"==typeof messages&&(messages=messages.split(messagesSplitRegExp));var subscribersHash=this._chooseSubscribersHash(messages);if(messages instanceof RegExp)return this[methodName](subscribersHash,messages,subscriber);var changed=!1;return messages.forEach(function(message){var subscriptionChanged=this[methodName](subscribersHash,message,subscriber);changed=changed||subscriptionChanged},this),changed}function _registerSubscriber(subscribersHash,message,subscriber){if(!subscribersHash[message]||!subscribersHash[message].length){subscribersHash[message]=[],message instanceof RegExp&&(subscribersHash[message].pattern=message),this._messageSource&&this._messageSource.onSubscriberAdded(message);var noSubscribers=!0}var msgSubscribers=subscribersHash[message],notYetRegistered=noSubscribers||_indexOfSubscriber.call(this,msgSubscribers,subscriber)==-1;return notYetRegistered&&msgSubscribers.push(subscriber),notYetRegistered}function _indexOfSubscriber(list,subscriber){return _.findIndex(list,function(subscr){return subscriber.subscriber==subscr.subscriber&&subscriber.context==subscr.context})}function onMessages(messageSubscribers){check(messageSubscribers,Match.ObjectHash(Match.OneOf(Function,{subscriber:Function,context:Match.Any})));var notYetRegisteredMap=_.mapKeys(messageSubscribers,function(subscriber,messages){return this.on(messages,subscriber)},this);return notYetRegisteredMap}function Messenger$off(messages,subscriber){return check(messages,Match.OneOf(String,[String],RegExp)),check(subscriber,Match.Optional(Match.OneOf(Function,{subscriber:Function,context:Match.Any,options:Match.Optional(Object)}))),_Messenger_off.call(this,messages,subscriber)}function _Messenger_off(messages,subscriber){return _eachMessage.call(this,"_removeSubscriber",messages,subscriber)}function _removeSubscriber(subscribersHash,message,subscriber){var msgSubscribers=subscribersHash[message];if(!msgSubscribers||!msgSubscribers.length)return!1;if(subscriber){"function"==typeof subscriber&&(subscriber={subscriber:subscriber,context:this._hostObject});var subscriberIndex=_indexOfSubscriber.call(this,msgSubscribers,subscriber);if(subscriberIndex==-1)return!1;msgSubscribers.splice(subscriberIndex,1),msgSubscribers.length||this._removeAllSubscribers(subscribersHash,message)}else this._removeAllSubscribers(subscribersHash,message);return!0}function _removeAllSubscribers(subscribersHash,message){delete subscribersHash[message],this._messageSource&&"string"==typeof message&&this._messageSource.onSubscriberRemoved(message)}function offMessages(messageSubscribers){check(messageSubscribers,Match.ObjectHash(Match.Optional(Match.OneOf(Function,{subscriber:Function,context:Match.Any}))));var subscriberRemovedMap=_.mapKeys(messageSubscribers,function(subscriber,messages){return this.off(messages,subscriber)},this);return subscriberRemovedMap}function Messenger$offAll(){_offAllSubscribers.call(this,this._patternMessageSubscribers),_offAllSubscribers.call(this,this._messageSubscribers)}function _offAllSubscribers(subscribersHash){_.eachKey(subscribersHash,function(subscribers,message){this._removeAllSubscribers(subscribersHash,message)},this)}function postMessage(message,data,callback,_synchronous){check(message,Match.OneOf(String,RegExp)),check(callback,Match.Optional(Function));var subscribersHash=this._chooseSubscribersHash(message),msgSubscribers=subscribersHash[message];this._callSubscribers(message,data,callback,msgSubscribers,_synchronous),"string"==typeof message&&this._callPatternSubscribers(message,data,callback,msgSubscribers,_synchronous)}function postMessageSync(message,data,callback){this.postMessage(message,data,callback,!0)}function _callPatternSubscribers(message,data,callback,calledMsgSubscribers,_synchronous){_.eachKey(this._patternMessageSubscribers,function(patternSubscribers){var pattern=patternSubscribers.pattern;if(pattern.test(message)){if(calledMsgSubscribers)var patternSubscribers=patternSubscribers.filter(function(subscriber){var index=_indexOfSubscriber.call(this,calledMsgSubscribers,subscriber);return index==-1});this._callSubscribers(message,data,callback,patternSubscribers,_synchronous)}},this)}function _callSubscribers(message,data,callback,msgSubscribers,_synchronous){msgSubscribers&&msgSubscribers.length&&(msgSubscribers=msgSubscribers.slice(),msgSubscribers.forEach(function(subscriber){this._callSubscriber(subscriber,message,data,callback,_synchronous)},this))}function _callSubscriber(subscriber,message,data,callback,_synchronous){var syncSubscriber=subscriber.options&&subscriber.options.sync,synchro=_synchronous&&syncSubscriber!==!1||syncSubscriber,dispatchTimes=subscriber.options&&subscriber.options.dispatchTimes;if(dispatchTimes)if(dispatchTimes<=1){var messages=subscriber.__messages;this.off(messages,subscriber)}else dispatchTimes>1&&subscriber.options.dispatchTimes--;synchro?subscriber.subscriber.call(subscriber.context,message,data,callback):_setTimeout(function(){subscriber.subscriber.call(subscriber.context,message,data,callback)},0)}function useSetTimeout(setTimeoutFunc){_setTimeout=setTimeoutFunc}function getSubscribers(message,includePatternSubscribers){check(message,Match.OneOf(String,RegExp));var subscribersHash=this._chooseSubscribersHash(message),msgSubscribers=subscribersHash[message]?[].concat(subscribersHash[message]):[];return includePatternSubscribers!==!1&&"string"==typeof message&&_.eachKey(this._patternMessageSubscribers,function(patternSubscribers){var pattern=patternSubscribers.pattern;patternSubscribers&&patternSubscribers.length&&pattern.test(message)&&_.appendArray(msgSubscribers,patternSubscribers)}),msgSubscribers.length?msgSubscribers:void 0}function _chooseSubscribersHash(message){return message instanceof RegExp?this._patternMessageSubscribers:this._messageSubscribers}function _setMessageSource(messageSource){check(messageSource,MessageSource),_.defineProperty(this,"_messageSource",messageSource),messageSource.messenger=this}function getMessageSource(){return this._messageSource}var Mixin=require("ml-mixin"),MessageSource=require("./m_source"),_=require("protojs"),check=require("ml-check"),Match=check.Match,_setTimeout=setTimeout,Messenger=_.createSubclass(Mixin,"Messenger"),messagesSplitRegExp=Messenger.messagesSplitRegExp=/\s*(?:\,|\s)\s*/;_.extendProto(Messenger,{init:init,destroy:Messenger$destroy,on:Messenger$on,once:Messenger$once,onceSync:Messenger$onceSync,onSync:Messenger$onSync,onAsync:Messenger$onAsync,onMessage:Messenger$on,off:Messenger$off,offMessage:Messenger$off,onMessages:onMessages,offMessages:offMessages,offAll:Messenger$offAll,postMessage:postMessage,postMessageSync:postMessageSync,getSubscribers:getSubscribers,getMessageSource:getMessageSource,_chooseSubscribersHash:_chooseSubscribersHash,_registerSubscriber:_registerSubscriber,_removeSubscriber:_removeSubscriber,_removeAllSubscribers:_removeAllSubscribers,_callPatternSubscribers:_callPatternSubscribers,_callSubscribers:_callSubscribers,_callSubscriber:_callSubscriber,_setMessageSource:_setMessageSource}),Messenger.defaultMethods={on:"on",onSync:"onSync",once:"once",onceSync:"onceSync",off:"off",onMessages:"onMessages",offMessages:"offMessages",postMessage:"postMessage",postMessageSync:"postMessageSync",getSubscribers:"getSubscribers"},Messenger.useSetTimeout=useSetTimeout,module.exports=Messenger,Messenger.subscriptions=[]},{"./m_source":86,"ml-check":104,"ml-mixin":105,protojs:122}],84:[function(require,module,exports){"use strict";function MessengerAPI(){this.init&&this.init.apply(this,arguments)}function init(){_.defineProperty(this,"_internalMessages",{})}function MessengerAPI$destroy(){}function addInternalMessage(message){var internalMsgs,sourceMessage=this.translateToSourceMessage(message);if("undefined"!=typeof sourceMessage)return this._internalMessages.hasOwnProperty(sourceMessage)?(internalMsgs=this._internalMessages[sourceMessage],void(internalMsgs.indexOf(message)==-1?internalMsgs.push(message):require("../util/logger").warn("Duplicate addInternalMessage call for internal message "+message))):(internalMsgs=this._internalMessages[sourceMessage]=[],internalMsgs.push(message),sourceMessage)}function removeInternalMessage(message){function unexpectedNotificationWarning(){require("../util/logger").warn("notification received: un-subscribe from internal message "+message+" without previous subscription notification")}var sourceMessage=this.translateToSourceMessage(message);if("undefined"!=typeof sourceMessage){var internalMsgs=this._internalMessages[sourceMessage];if(internalMsgs&&internalMsgs.length){var messageIndex=internalMsgs.indexOf(message);if(messageIndex>=0){if(internalMsgs.splice(messageIndex,1),0==internalMsgs.length)return delete this._internalMessages[sourceMessage],sourceMessage}else unexpectedNotificationWarning()}else unexpectedNotificationWarning()}}function getInternalMessages(sourceMessage){return this._internalMessages[sourceMessage]}function translateToSourceMessage(message){return message}function createInternalData(sourceMessage,message,sourceData){return sourceData}function filterSourceMessage(sourceMessage,message,internalData){return!0}var _=require("protojs");module.exports=MessengerAPI,_.extendProto(MessengerAPI,{init:init,destroy:MessengerAPI$destroy,addInternalMessage:addInternalMessage,removeInternalMessage:removeInternalMessage,getInternalMessages:getInternalMessages,translateToSourceMessage:translateToSourceMessage,createInternalData:createInternalData,filterSourceMessage:filterSourceMessage})},{"../util/logger":100,protojs:122}],85:[function(require,module,exports){"use strict";function init(){MessengerAPI.prototype.init.apply(this,arguments),_.defineProperties(this,{_patternInternalMessages:{}}),this._catchAllSubscribed=!1}function addInternalMessage(message){var sourceMessage=MessengerAPI.prototype.addInternalMessage.apply(this,arguments);if(sourceMessage&&sourceMessage instanceof RegExp){if(this._internalMessages[sourceMessage].pattern=sourceMessage,this._patternInternalMessages[sourceMessage]=this._internalMessages[sourceMessage],this._catchAllSubscribed)return;return this._catchAllSubscribed=!0,/.*/}return sourceMessage}function removeInternalMessage(message){var sourceMessage=MessengerAPI.prototype.removeInternalMessage.apply(this,arguments);if(sourceMessage&&sourceMessage instanceof RegExp){delete this._patternInternalMessages[sourceMessage];var noPatternInternalMessages=!Object.keys(this._patternInternalMessages).length;if(noPatternInternalMessages)return this._catchAllSubscribed=!1,/.*/}return sourceMessage}function getInternalMessages(sourceMessage){var internalMessages=MessengerAPI.prototype.getInternalMessages.apply(this,arguments);if("string"==typeof sourceMessage){internalMessages=internalMessages||[];var internalMessagesHash=_.object(internalMessages,!0);_.eachKey(this._patternInternalMessages,function(patternMessages){var sourcePattern=patternMessages.pattern;sourcePattern.test(sourceMessage)&&patternMessages.forEach(function(message){internalMessagesHash[message]||(internalMessages.push(message),internalMessagesHash[message]=!0)})})}return internalMessages}var MessengerAPI=require("./m_api"),_=require("protojs"),MessengerRegexpAPI=_.createSubclass(MessengerAPI,"MessengerRegexpAPI");module.exports=MessengerRegexpAPI,_.extendProto(MessengerRegexpAPI,{init:init,addInternalMessage:addInternalMessage,removeInternalMessage:removeInternalMessage,getInternalMessages:getInternalMessages})},{"./m_api":84,protojs:122}],86:[function(require,module,exports){"use strict";function init(hostObject,proxyMethods,messengerAPI){this._prepareMessengerAPI(messengerAPI)}function MessageSource$destroy(){this.messengerAPI&&this.messengerAPI.destroy()}function setMessenger(messenger){_.defineProperty(this,"messenger",messenger)}function _prepareMessengerAPI(messengerAPI){check(messengerAPI,Match.Optional(MessengerAPI)),messengerAPI||(messengerAPI=new MessengerAPI),_.defineProperty(this,"messengerAPI",messengerAPI)}function onSubscriberAdded(message){var newSourceMessage=this.messengerAPI.addInternalMessage(message);"undefined"!=typeof newSourceMessage&&this.addSourceSubscriber(newSourceMessage)}function onSubscriberRemoved(message){var removedSourceMessage=this.messengerAPI.removeInternalMessage(message);"undefined"!=typeof removedSourceMessage&&this.removeSourceSubscriber(removedSourceMessage)}function dispatchMessage(sourceMessage,sourceData){var api=this.messengerAPI,internalMessages=api.getInternalMessages(sourceMessage);internalMessages&&internalMessages.forEach(function(message){var internalData=api.createInternalData(sourceMessage,message,sourceData),shouldDispatch=api.filterSourceMessage(sourceMessage,message,internalData);shouldDispatch&&this.postMessage(message,internalData)},this)}function postMessage(message,data){this.messenger.postMessage(message,data)}function toBeImplemented(){throw new Error("calling the method of an absctract class")}var Mixin=require("ml-mixin"),MessengerAPI=require("./m_api"),_=require("protojs"),check=require("ml-check"),Match=check.Match,MessageSource=_.createSubclass(Mixin,"MessageSource",!0);module.exports=MessageSource,_.extendProto(MessageSource,{init:init,destroy:MessageSource$destroy,setMessenger:setMessenger,onSubscriberAdded:onSubscriberAdded,onSubscriberRemoved:onSubscriberRemoved,dispatchMessage:dispatchMessage,postMessage:postMessage,_prepareMessengerAPI:_prepareMessengerAPI,trigger:toBeImplemented,addSourceSubscriber:toBeImplemented,removeSourceSubscriber:toBeImplemented})},{"./m_api":84,"ml-check":104,"ml-mixin":105,protojs:122}],87:[function(require,module,exports){"use strict";function init(hostObject,proxyMethods,messengerAPI,sourceMessenger){MessageSource.prototype.init.apply(this,arguments),this.sourceMessenger=sourceMessenger}function addSourceSubscriber(sourceMessage){this.sourceMessenger.onSync(sourceMessage,{context:this,subscriber:this.dispatchMessage})}function removeSourceSubscriber(sourceMessage){this.sourceMessenger.off(sourceMessage,{context:this,subscriber:this.dispatchMessage})}function MessengerMessageSource$postMessage(message,data){this.messenger.postMessageSync(message,data)}var MessageSource=require("./m_source"),_=require("protojs"),MessengerMessageSource=(require("ml-check"),_.createSubclass(MessageSource,"MessengerMessageSource"));module.exports=MessengerMessageSource,_.extendProto(MessengerMessageSource,{init:init,addSourceSubscriber:addSourceSubscriber,removeSourceSubscriber:removeSourceSubscriber,postMessage:MessengerMessageSource$postMessage})},{"./m_source":86,"ml-check":104,protojs:122}],88:[function(require,module,exports){"use strict";function destroy(){milo.minder.destroy()}var _=require("protojs"),milo={minder:require("./minder"),config:require("./config"),util:require("./util"),classes:require("./classes"),Messenger:require("./messenger"),Model:require("./model"),destroy:destroy,proto:_};"object"==typeof module&&module.exports&&(module.exports=milo),"object"==typeof window&&(window.milo=milo)},{"./classes":81,"./config":82,"./messenger":83,"./minder":89,"./model":92,"./util":99,protojs:122}],89:[function(require,module,exports){"use strict";function minder(ds1,mode,ds2,options){if(Array.isArray(ds1)){var connDescriptions=ds1,connectors=connDescriptions.map(function(descr){return new Connector(descr[0],descr[1],descr[2],descr[3])});return connectors.forEach(_addConnector),connectors}var cnct=new Connector(ds1,mode,ds2,options);return _addConnector(cnct),cnct}function _addConnector(cnct){cnct.___minder_id=_connectors.push(cnct)-1,cnct.on(/.*/,onConnectorMessage),minder.postMessage("added",{connector:cnct}),minder.postMessage("turnedon",{connector:cnct})}function onConnectorMessage(msg,data){var data=data?_.clone(data):{};_.extend(data,{id:this.___minder_id,connector:this}),minder.postMessage(msg,data),_receivedMessages.length||_isPropagating||(_.defer(_idleCheck),_isPropagating=!0),_receivedMessages.push({msg:msg,data:data})}function _idleCheck(){_receivedMessages.length?(_receivedMessages.length=0,_.defer(_idleCheck),minder.postMessage("propagationticked")):(_isPropagating=!1,minder.postMessage("propagationcompleted"))}function minder_isPropagating(){return _isPropagating}function minder_whenPropagationCompleted(callback){function executeCallback(){_isPropagating?minder.once("propagationcompleted",executeCallback):callback()}_isPropagating?minder.once("propagationcompleted",executeCallback):_.defer(executeCallback)}function minder_getConnectors(onOff){return"undefined"==typeof onOff?_connectors:_connectors.filter(function(cnct){return cnct.isOn===onOff})}function minder_destroyConnector(cnct){cnct.destroy();var index=_connectors.indexOf(cnct);index>=0?delete _connectors[index]:logger.warn("minder: connector destroyed that is not registered in minder")}function minder_getExpandedConnections(onOff,searchStr){var connectors=minder.getConnectors(onOff),connections=connectors.map(function(cnct){var connection={leftSource:_getExpandedSource(cnct.ds1),rightSource:_getExpandedSource(cnct.ds2),mode:cnct.mode,isOn:cnct.isOn};return cnct.options&&(connection.options=cnct.options),connection});return searchStr&&(connections=connections.filter(function(cnctn){return _sourceMatchesString(cnctn.leftSource,searchStr)||_sourceMatchesString(cnctn.rightSource,searchStr)})),connections}function _getExpandedSource(ds){var source=[];return"function"==typeof ds&&(ds._model&&ds._accessPath&&(source.unshift(ds._accessPath),ds=ds._model),source.unshift(ds),ds=ds._hostObject),"object"==typeof ds&&(source.unshift(ds),ds.owner&&source.unshift(ds.owner)),source}function _sourceMatchesString(source,matchStr){return source.some(function(srcNode){var className=srcNode.constructor&&srcNode.constructor.name;return _stringMatch(className,matchStr)||_stringMatch(srcNode.name,matchStr)||_stringMatch(srcNode,matchStr)})}function _stringMatch(str,substr){return str&&"string"==typeof str&&str.indexOf(substr)>=0}function minder_destroy(){function destroyDS(ds){ds&&!ds._destroyed&&ds.destroy()}_connectors.forEach(function(cnct){destroyDS(cnct.ds1),destroyDS(cnct.ds2),cnct.destroy()}),_messenger.destroy(),minder._destroyed=!0}var Connector=require("./model/connector"),Messenger=require("./messenger"),_=require("protojs"),logger=require("./util/logger");module.exports=minder;var _messenger=new Messenger(minder,Messenger.defaultMethods),_connectors=[],_receivedMessages=[],_isPropagating=!1;_.extend(minder,{getConnectors:minder_getConnectors,getExpandedConnections:minder_getExpandedConnections,isPropagating:minder_isPropagating,whenPropagationCompleted:minder_whenPropagationCompleted,destroyConnector:minder_destroyConnector,destroy:minder_destroy})},{"./messenger":83,"./model/connector":91,"./util/logger":100,protojs:122}],90:[function(require,module,exports){"use strict";function setTransactionFlag(func,flag){
_.defineProperty(func,"__inChangeTransaction",flag,_.CONF|_.WRIT)}function getTransactionFlag(func){var inTransaction=func.__inChangeTransaction;return delete func.__inChangeTransaction,inTransaction}function passTransactionFlag(fromFunc,toFunc){var inTransaction=getTransactionFlag(fromFunc);return setTransactionFlag(toFunc,inTransaction),inTransaction}function postTransactionFinished(){this.postMessageSync("datachanges",{transaction:!1,changes:[]})}function changeDataHandler(message,data,callback){processChanges.call(this,data.changes,callback)}function processChanges(transaction,callback){notify.call(this,callback,!1),processTransaction.call(this,prepareTransaction(validateTransaction(transaction))),notify.call(this,callback,!0)}function notify(callback,changeFinished){callback&&callback(null,changeFinished),this.postMessage(changeFinished?"changecompleted":"changestarted")}function validateTransaction(transaction){var source=transaction[0].source,sameSource=!0;if(transaction.length>1)for(var i=1,len=transaction.length;i<len;i++)transaction[i].source!=source&&(logger.error("changedata: changes from different sources in the same transaction, sources:",transaction[i].source.name,source.name),sameSource=!1,source=transaction[i].source);return transaction}function prepareTransaction(transaction){function checkChange(data){("splice"==data.type?checkSplice:checkMethod)(data)}function checkSplice(data){var parsedPath=pathUtils.parseAccessPath(data.path),parentPathChanged=pathsToChange.some(function(parentPath){if(!(parsedPath.length<parentPath.length))return _pathIsParentOf(parentPath,parsedPath)});if(!parentPathChanged){if(todo.push(data),!config.debug)throw exitLoop;pathsToSplice.push(parsedPath),hadSplice=!0}}function checkMethod(data){var parsedPath=pathUtils.parseAccessPath(data.path),parentPathSpliced=pathsToSplice&&pathsToSplice.some(function(parentPath){if(!(parsedPath.length<=parentPath.length||"array"!=parsedPath[parentPath.length].syntax))return _pathIsParentOf(parentPath,parsedPath)});if(!parentPathSpliced){hadSplice&&logger.error('changedata: child change is executed after splice; probably data source did not emit message with data.type=="finished"');var parentPathChanged=pathsToChange.some(function(parentPath){if(!(parsedPath.length<=parentPath.length))return _pathIsParentOf(parentPath,parsedPath)});parentPathChanged||(pathsToChange.push(parsedPath),todo.push(data))}}function _pathIsParentOf(parentPath,childPath){return parentPath.every(function(pathNode,index){return pathNode.property==childPath[index].property})}var hadSplice,todo=[],pathsToSplice=[],pathsToChange=[],exitLoop={};try{transaction.forEach(checkChange)}catch(e){if(e!=exitLoop)throw e}return todo}function processTransaction(transaction){function processChange(data){var modelPath=this.path(data.path,"removed"!=data.type&&"deleted"!=data.type);modelPath&&("splice"==data.type?executeSplice:executeMethod)(modelPath,data)}transaction.forEach(processChange,this),postTransactionFinished.call(this,!1)}function executeSplice(modelPath,data){var index=data.index,howMany=data.removed.length,spliceArgs=[index,howMany];spliceArgs=spliceArgs.concat(data.newValue.slice(index,index+data.addedCount)),setTransactionFlag(modelPath.splice,!0),modelPath.splice.apply(modelPath,spliceArgs)}function executeMethod(modelPath,data){var methodName=CHANGE_TYPE_TO_METHOD_MAP[data.type];methodName?(setTransactionFlag(modelPath[methodName],!0),modelPath[methodName](data.newValue)):logger.error("unknown data change type")}var logger=require("../util/logger"),config=require("../config"),pathUtils=require("./path_utils"),_=require("protojs");module.exports=changeDataHandler,_.extend(changeDataHandler,{setTransactionFlag:setTransactionFlag,getTransactionFlag:getTransactionFlag,passTransactionFlag:passTransactionFlag,postTransactionFinished:postTransactionFinished});var CHANGE_TYPE_TO_METHOD_MAP={added:"set",changed:"set",deleted:"del",removed:"del"}},{"../config":82,"../util/logger":100,"./path_utils":97,protojs:122}],91:[function(require,module,exports){"use strict";function Connector(ds1,mode,ds2,options){if(setupMode.call(this,mode),_.extend(this,{ds1:ds1,ds2:ds2,isOn:!1,_changesQueue1:[],_changesQueue2:[],_messenger:new Messenger(this,Messenger.defaultMethods)}),options){this.options=options;var pathTranslation=options.pathTranslation;if(pathTranslation){pathTranslation=_.clone(pathTranslation);var patternTranslation=getPatternTranslations(pathTranslation);_.extend(this,{pathTranslation1:reverseTranslationRules(pathTranslation),pathTranslation2:pathTranslation,patternTranslation1:reversePatternTranslationRules(patternTranslation),patternTranslation2:patternTranslation})}var dataTranslation=options.dataTranslation;dataTranslation&&(pathTranslation||options.noPathTranslation||logger.warn("dataTranslation without pathTranslation: translations won't be applied when properties are changed via a higher level object"),_.extend(this,{dataTranslation1:dataTranslation["<-"],dataTranslation2:dataTranslation["->"]}));var dataValidation=options.dataValidation;dataValidation&&_.extend(this,{dataValidation1:dataValidation["<-"],dataValidation2:dataValidation["->"]})}this.turnOn()}function setupMode(mode){function modeParseError(){throw new Error("invalid Connector mode: "+mode)}var parsedMode=mode.match(modePattern);parsedMode||modeParseError();var depth1=parsedMode[1].length,depth2=parsedMode[2].length;depth1&&depth2&&depth1!=depth2&&modeParseError(),depth1||depth2||modeParseError(),_.extend(this,{mode:mode,depth1:depth1,depth2:depth2})}function Connector$changeMode(mode){return this.turnOff(),setupMode.call(this,mode),this.turnOn(),this}function Connector$deferChangeMode(mode){return _.deferMethod(this,"changeMode",mode),this}function reverseTranslationRules(rules){var reverseRules={};return _.eachKey(rules,function(path2_value,path1_key){reverseRules[path2_value]=path1_key}),reverseRules}function getPatternTranslations(pathTranslation){function _throwInvalidTranslation(path1,path2){throw new Error("Invalid pattern translation: "+path1+", "+path2)}function _getStaticPath(path,starIndex){return path.replace(/[\.\[]?\*.*$/,"")}var patternTranslation=[];return _.eachKey(pathTranslation,function(path2_value,path1_key){var starIndex1=path1_key.indexOf("*"),starIndex2=path2_value.indexOf("*");starIndex1>=0&&starIndex2>=0?(path1_key.slice(starIndex1)!=path2_value.slice(starIndex2)&&_throwInvalidTranslation(path1_key,path2_value),delete pathTranslation[path1_key],patternTranslation.push({fromPattern:pathUtils.createRegexPath(path1_key),fromStaticPath:_getStaticPath(path1_key,starIndex1),toPattern:pathUtils.createRegexPath(path2_value),toStaticPath:_getStaticPath(path2_value,starIndex2)})):(starIndex1>=0||starIndex2>=0)&&_throwInvalidTranslation(path1_key,path2_value)}),patternTranslation}function reversePatternTranslationRules(patternTranslation){return patternTranslation.map(function(pt){return{fromPattern:pt.toPattern,fromStaticPath:pt.toStaticPath,toPattern:pt.fromPattern,toStaticPath:pt.fromStaticPath}})}function Connector$turnOn(){function linkDataSource(reverseLink,fromDS,toDS,changesQueue,pathTranslation,patternTranslation,dataTranslation,dataValidation){function onData(message,batch){function translatePath(sourcePath){if(pathTranslation){var translatedPath=pathTranslation[sourcePath];if(translatedPath)return translatedPath;if(!patternTranslation.length)return;var pt=_.find(patternTranslation,function(pTranslation){return pTranslation.fromPattern.test(sourcePath)});if(!pt)return;var translatedPath=sourcePath.replace(pt.fromStaticPath,pt.toStaticPath)}else if(!(subscriptionPattern instanceof RegExp&&subscriptionPattern.test(sourcePath)||subscriptionPattern==sourcePath))return;return translatedPath||sourcePath}function translateData(sourcePath,change){if(dataTranslation){var translate=dataTranslation[sourcePath];translate&&"function"==typeof translate&&(change.oldValue=translate(change.oldValue),change.newValue=translate(change.newValue))}}function validateData(sourcePath,change){function callValidator(validator){validator(change.newValue,function(err,response){response.path=sourcePath,alreadyFailed||!err&&!response.valid||++passedCount!=validators.length?response.valid||(alreadyFailed=!0,fromDS.postMessage("validated",response)):fromDS.postMessage("validated",response)})}if(propagateData(change),dataValidation){var validators=dataValidation[sourcePath],passedCount=0,alreadyFailed=!1;validators&&validators.forEach(callValidator)}}function propagateData(change){sendData.changes.push(change)}function postChangeData(){if(self[reverseLink])var callback=subscriptionSwitch;var transactions=mergeTransactions(changesQueue);changesQueue.length=0,transactions.forEach(function(transaction){toDS.postMessageSync("changedata",{changes:transaction},callback)})}function subscriptionSwitch(err,changeFinished){if(!err){var onOff=changeFinished?"onSync":"off";toDS[onOff]("datachanges",self[reverseLink]);var message=changeFinished?"changecompleted":"changestarted";self.postMessage(message,{source:fromDS,target:toDS})}}function mergeTransactions(batches){var currentTransaction,transactions=[];return batches.forEach(function(batch){batch.transaction||(currentTransaction=void 0),batch.changes.length&&(batch.transaction?currentTransaction?_.appendArray(currentTransaction,batch.changes):(currentTransaction=_.clone(batch.changes),transactions.push(currentTransaction)):transactions.push(batch.changes))}),transactions}var sendData={changes:[],transaction:batch.transaction};batch.changes.forEach(function(change){var sourcePath=change.path,targetPath=translatePath(sourcePath);if("undefined"!=typeof targetPath){var change=_.clone(change);_.extend(change,{source:fromDS,path:targetPath}),translateData(sourcePath,change),validateData(sourcePath,change)}}),changesQueue.length||_.defer(postChangeData),changesQueue.push(sendData)}return fromDS.onSync("datachanges",onData),onData}if(this.isOn)return logger.warn("data sources are already connected");var subscriptionPath=this._subscriptionPath=new Array(this.depth1||this.depth2).join("*"),subscriptionPattern=pathUtils.createRegexPath(subscriptionPath),self=this;this.depth1&&(this._link1=linkDataSource("_link2",this.ds2,this.ds1,this._changesQueue1,this.pathTranslation1,this.patternTranslation1,this.dataTranslation1,this.dataValidation1)),this.depth2&&(this._link2=linkDataSource("_link1",this.ds1,this.ds2,this._changesQueue2,this.pathTranslation2,this.patternTranslation2,this.dataTranslation2,this.dataValidation2)),this.isOn=!0,this.postMessage("turnedon")}function Connector$turnOff(){function unlinkDataSource(fromDS,linkName,pathTranslation){self[linkName]&&(fromDS.off("datachanges",self[linkName]),delete self[linkName])}if(!this.isOn)return logger.warn("data sources are already disconnected");var self=this;unlinkDataSource(this.ds1,"_link2",this.pathTranslation2),unlinkDataSource(this.ds2,"_link1",this.pathTranslation1),this.isOn=!1,this.postMessage("turnedoff")}function Connector$destroy(){this.turnOff(),this.postMessage("destroyed"),this._messenger.destroy(),delete this.ds1,delete this.ds2,this._destroyed=!0}var Messenger=require("../messenger"),pathUtils=require("./path_utils"),_=require("protojs"),logger=require("../util/logger");module.exports=Connector;var modePattern=/^(\<*)\-+(\>*)$/;_.extendProto(Connector,{turnOn:Connector$turnOn,turnOff:Connector$turnOff,destroy:Connector$destroy,changeMode:Connector$changeMode,deferChangeMode:Connector$deferChangeMode})},{"../messenger":83,"../util/logger":100,"./path_utils":97,protojs:122}],92:[function(require,module,exports){"use strict";function Model(data,hostObject,options){var model=function(accessPath){return Model$path.apply(model,arguments)};return model.__proto__=Model.prototype,model._hostObject=hostObject,model._options=options||{},model._options.reactive!==!1&&(model._prepareMessengers(),model.onSync("changedata",changeDataHandler)),data&&(model._data=data),model}function Model$get(){return this._data}function Model$path(accessPath){return accessPath?(_.splice(arguments,0,0,null,this),new(Function.prototype.bind.apply(ModelPath,arguments))):this}function proxyMessenger(modelHostObject){modelHostObject=modelHostObject||this._hostObject,Mixin.prototype._createProxyMethods.call(this[MESSENGER_PROPERTY],Messenger.defaultMethods,modelHostObject)}function Model$$useWith(hostClass,instanceKey,mixinMethods){mixinMethods=mixinMethods||modelMethodsToProxy,Mixin.useWith.call(Model,hostClass,instanceKey,mixinMethods)}function proxyMethods(modelHostObject){modelHostObject=modelHostObject||this._hostObject,Mixin.prototype._createProxyMethods.call(this,modelMethodsToProxy,modelHostObject)}function _prepareMessengers(){var internalMessenger=new Messenger(this,void 0,void 0),internalMessengerSource=new MessengerMessageSource(this,void 0,new ModelMsgAPI,internalMessenger),externalMessenger=new Messenger(this,void 0,internalMessengerSource);_.defineProperty(this,MESSENGER_PROPERTY,externalMessenger),_.defineProperty(this,"_internalMessenger",internalMessenger)}function _getHostObject(){return this._hostObject}function Model$destroy(){this[MESSENGER_PROPERTY].destroy(),this._internalMessenger.destroy(),this._destroyed=!0}var ModelPath=require("./m_path"),synthesize=require("./synthesize"),pathUtils=require("./path_utils"),modelUtils=require("./model_utils"),changeDataHandler=require("./change_data"),Messenger=require("../messenger"),MessengerMessageSource=require("../messenger/msngr_source"),ModelMsgAPI=require("./m_msg_api"),Mixin=require("ml-mixin"),_=require("protojs"),check=require("ml-check");check.Match,require("../util/logger");module.exports=Model,Model.prototype.__proto__=Model.__proto__,_.extendProto(Model,{path:Model$path,get:Model$get,proxyMessenger:proxyMessenger,proxyMethods:proxyMethods,_prepareMessengers:_prepareMessengers,_getHostObject:_getHostObject,destroy:Model$destroy}),_.extendProto(Model,synthesize.modelMethods),_.extend(Model,{Path:ModelPath,useWith:Model$$useWith,_utils:{path:pathUtils,model:modelUtils,changeDataHandler:changeDataHandler}});var MESSENGER_PROPERTY="_messenger";Messenger.useWith(Model,MESSENGER_PROPERTY,Messenger.defaultMethods),["len","push","pop","unshift","shift"].forEach(function(methodName){var method=ModelPath.prototype[methodName];_.defineProperty(Model.prototype,methodName,method)});var modelMethodsToProxy=["path","get","set","del","splice","len","push","pop","unshift","shift"]},{"../messenger":83,"../messenger/msngr_source":87,"../util/logger":100,"./change_data":90,"./m_msg_api":93,"./m_path":94,"./model_utils":95,"./path_utils":97,"./synthesize":98,"ml-check":104,"ml-mixin":105,protojs:122}],93:[function(require,module,exports){"use strict";function translateToSourceMessage(accessPath){return accessPath instanceof RegExp?accessPath:pathUtils.createRegexPath(accessPath)}var MessengerRegexpAPI=require("../messenger/m_api_rx"),pathUtils=require("./path_utils"),_=require("protojs"),ModelMsgAPI=_.createSubclass(MessengerRegexpAPI,"ModelMsgAPI");module.exports=ModelMsgAPI,_.extendProto(ModelMsgAPI,{translateToSourceMessage:translateToSourceMessage})},{"../messenger/m_api_rx":85,"./path_utils":97,protojs:122}],94:[function(require,module,exports){"use strict";function ModelPath(model,path){check(path,String);var modelPath=function(accessPath){return ModelPath$path.apply(modelPath,arguments)};modelPath.__proto__=ModelPath.prototype,_.defineProperties(modelPath,{_model:model,_path:path,_args:_.slice(arguments,1),_options:model._options});var parsedPath=pathUtils.parseAccessPath(path);_.defineProperty(modelPath,"_accessPath",interpolateAccessPath(parsedPath,modelPath._args)),modelPath._options.reactive!==!1&&(modelPath._prepareMessenger(),modelPath.onSync("changedata",changeDataHandler));var methods=synthesize(path,parsedPath);return _.defineProperties(modelPath,methods),Object.freeze(modelPath),modelPath}function interpolateAccessPath(parsedPath,args){return parsedPath.reduce(function(accessPathStr,currNode,index){var interpolate=currNode.interpolate;return accessPathStr+(interpolate?"array"==currNode.syntax?"["+args[interpolate]+"]":"."+args[interpolate]:currNode.property)},"")}function ModelPath$path(accessPath){if(!accessPath)return this;var thisPathArgsCount=this._args.length-1;thisPathArgsCount>0&&(accessPath=accessPath.replace(/\$[1-9][0-9]*/g,function(str){return"$"+(+str.slice(1)+thisPathArgsCount)}));var newPath=this._path+accessPath,args=[this._model,newPath].concat(this._args.slice(1)).concat(_.slice(arguments,1));return _.newApply(ModelPath,args)}function ModelPath$len(){return this.path(".length").get()||0}function ModelPath$push(){var length=this.len(),newLength=length+arguments.length;return _.splice(arguments,0,0,length,0),this.splice.apply(this,arguments),newLength}function ModelPath$pop(){return this.splice(this.len()-1,1)[0]}function ModelPath$unshift(){var length=this.len();return length+=arguments.length,_.splice(arguments,0,0,0,0),this.splice.apply(this,arguments),length}function ModelPath$shift(){return this.splice(0,1)[0]}function _prepareMessenger(){var mPathAPI=new ModelPathMsgAPI(this._accessPath),modelMessageSource=new MessengerMessageSource(this,void 0,mPathAPI,this._model),mPathMessenger=new Messenger(this,void 0,modelMessageSource);_.defineProperty(this,MESSENGER_PROPERTY,mPathMessenger)}function _getDefinition(){return{model:this._model,path:this._path,args:this._args}}function _createFromDefinition(definition){check(definition,{model:Function,path:String,args:Array});var m=definition.model;return m.apply(m,definition.args)}function ModelPath$destroy(){this[MESSENGER_PROPERTY].destroy()}var synthesize=require("./synthesize"),pathUtils=require("./path_utils"),changeDataHandler=require("./change_data"),Messenger=require("../messenger"),ModelPathMsgAPI=require("./path_msg_api"),MessengerMessageSource=require("../messenger/msngr_source"),_=require("protojs"),check=require("ml-check");check.Match;module.exports=ModelPath,ModelPath.prototype.__proto__=ModelPath.__proto__,_.extendProto(ModelPath,{path:ModelPath$path,len:ModelPath$len,push:ModelPath$push,pop:ModelPath$pop,unshift:ModelPath$unshift,shift:ModelPath$shift,_prepareMessenger:_prepareMessenger,_getDefinition:_getDefinition,destroy:ModelPath$destroy}),_.extend(ModelPath,{_createFromDefinition:_createFromDefinition});var MESSENGER_PROPERTY="_messenger";Messenger.useWith(ModelPath,MESSENGER_PROPERTY,Messenger.defaultMethods)},{"../messenger":83,"../messenger/msngr_source":87,"./change_data":90,"./path_msg_api":96,"./path_utils":97,"./synthesize":98,"ml-check":104,protojs:122}],95:[function(require,module,exports){"use strict";function normalizeSpliceIndex(spliceIndex,length){return spliceIndex>length?length:spliceIndex>=0?spliceIndex:spliceIndex+length>0?spliceIndex+length:0}var modelUtils={normalizeSpliceIndex:normalizeSpliceIndex};module.exports=modelUtils},{}],96:[function(require,module,exports){"use strict";function init(rootPath){MessengerAPI.prototype.init.apply(this,arguments),this.rootPath=rootPath}function translateToSourceMessage(message){return message instanceof RegExp?message:"datachanges"==message?message:this.rootPath+message}function createInternalData(sourceMessage,message,sourceData){if("datachanges"==message){var internalChanges=sourceData.changes.map(truncateChangePath,this).filter(function(change){return change}),internalData={changes:internalChanges,transaction:sourceData.transaction};return internalData}var internalData=truncateChangePath.call(this,sourceData);return internalData}function truncateChangePath(change){var fullPath=change.path,path=_.unPrefix(fullPath,this.rootPath);if("string"==typeof path){var change=_.clone(change);return change.fullPath=fullPath,change.path=path,change}}var MessengerAPI=require("../messenger/m_api"),_=(require("./path_utils"),require("../util/logger"),require("protojs")),ModelPathMsgAPI=_.createSubclass(MessengerAPI,"ModelPathMsgAPI");module.exports=ModelPathMsgAPI,_.extendProto(ModelPathMsgAPI,{init:init,translateToSourceMessage:translateToSourceMessage,createInternalData:createInternalData})},{"../messenger/m_api":84,"../util/logger":100,"./path_utils":97,protojs:122}],97:[function(require,module,exports){"use strict";function parseAccessPath(path,nodeParsePattern){nodeParsePattern=nodeParsePattern||pathParsePattern;var parsedPath=[];if(!path)return parsedPath;var unparsed=path.replace(nodeParsePattern,function(nodeStr){var pathNode={property:nodeStr};return _.extend(pathNode,pathNodeTypes[nodeStr[0]]),"$"==nodeStr[1]&&(pathNode.interpolate=getPathNodeKey(pathNode,!0)),parsedPath.push(pathNode),""});if(unparsed)throw new Error("incorrect model path: "+path);return parsedPath}function createRegexPath(path){if(check(path,Match.OneOf(String,RegExp)),path instanceof RegExp||path.indexOf("*")==-1)return path;var parsedPath=pathUtils.parseAccessPath(path,patternPathParsePattern),regexStr="^",patternsStarted=!1;parsedPath.forEach(function(pathNode){var prop=pathNode.property,regex=nodeRegex[prop];regex?(regexStr+="("+regex+"|)",patternsStarted=!0):regexStr+=prop.replace(/(\.|\[|\])/g,"\\$1")}),regexStr+="$";try{return new RegExp(regexStr)}catch(e){throw new Error("can't construct regex for path pattern: "+path)}}function getPathNodeKey(pathNode,interpolated){var prop=pathNode.property,startIndex=interpolated?2:1;return"array"==pathNode.syntax?prop.slice(startIndex,prop.length-1):prop.slice(startIndex)}function wrapMessengerMethods(methodsNames){methodsNames=methodsNames||["on","off"];var wrappedMethods=_.mapToObject(methodsNames,function(methodName){var origMethod=this[methodName];return function(path,subscriber){var regexPath=createRegexPath(path);origMethod.call(this,regexPath,subscriber)}},this);_.defineProperties(this,wrappedMethods)}var check=require("ml-check"),Match=check.Match,_=require("protojs"),pathUtils={parseAccessPath:parseAccessPath,createRegexPath:createRegexPath,getPathNodeKey:getPathNodeKey,wrapMessengerMethods:wrapMessengerMethods};module.exports=pathUtils;var propertyPathSyntax="\\.[A-Za-z_-][A-Za-z0-9_-]*",arrayPathSyntax="\\[[0-9]+\\]",interpolationSyntax="\\$[1-9][0-9]*",propertyInterpolateSyntax="\\."+interpolationSyntax,arrayInterpolateSyntax="\\["+interpolationSyntax+"\\]",propertyStarSyntax="\\.\\*",arrayStarSyntax="\\[\\*\\]",starSyntax="\\*",pathParseSyntax=[propertyPathSyntax,arrayPathSyntax,propertyInterpolateSyntax,arrayInterpolateSyntax].join("|"),pathParsePattern=new RegExp(pathParseSyntax,"g"),patternPathParseSyntax=[pathParseSyntax,propertyStarSyntax,arrayStarSyntax,starSyntax].join("|"),patternPathParsePattern=new RegExp(patternPathParseSyntax,"g"),pathNodeTypes={".":{syntax:"object",empty:"{}"},"[":{syntax:"array",empty:"[]"},"*":{syntax:"match",empty:"{}"}},nodeRegex={".*":propertyPathSyntax,"[*]":arrayPathSyntax};nodeRegex["*"]=nodeRegex[".*"]+"|"+nodeRegex["[*]"]},{"ml-check":104,protojs:122}],98:[function(require,module,exports){(function(Buffer){"use strict";function _synthesizePathMethods(path,parsedPath){var methods=_.mapKeys(synthesizers,function(synthszr){return _synthesize(synthszr,path,parsedPath)});return methods}function _synthesize(synthesizer,path,parsedPath){function addChangeMessage(messages,messagesHash,msg){messages.push(msg),messagesHash[msg.path]=msg}function addTreeChangesMessages(messages,messagesHash,rootPath,oldValue,newValue){var oldIsTree=valueIsTree(oldValue),newIsTree=valueIsTree(newValue);newIsTree&&addMessages(messages,messagesHash,rootPath,newValue,"added","newValue"),oldIsTree&&addMessages(messages,messagesHash,rootPath,oldValue,"removed","oldValue")}function addMessages(messages,messagesHash,rootPath,obj,msgType,valueProp){function _addMessages(rootPath,obj){if(Array.isArray(obj)){var pathSyntax=rootPath+"[$$]";obj.forEach(function(value,index){addMessage(value,index,pathSyntax)})}else{var pathSyntax=rootPath+".$$";_.eachKey(obj,function(value,key){addMessage(value,key,pathSyntax)})}}function addMessage(value,key,pathSyntax){var path=pathSyntax.replace("$$",key),existingMsg=messagesHash[path];if(existingMsg)existingMsg.type==msgType?logger.error("setter error: same message type posted on the same path"):(existingMsg.type="changed",existingMsg[valueProp]=value);else{var msg={path:path,type:msgType};msg[valueProp]=value,addChangeMessage(messages,messagesHash,msg)}valueIsTree(value)&&_addMessages(path,value)}_addMessages(rootPath,obj)}function cloneTree(value){return valueIsNormalObject(value)?_.deepClone(value):value}function valueIsTree(value){return valueIsNormalObject(value)&&Object.keys(value).length}function valueIsNormalObject(value){return!(null==value||"object"!=typeof value||value instanceof Date||value instanceof RegExp)}var methodCode=synthesizer({parsedPath:parsedPath,getPathNodeKey:pathUtils.getPathNodeKey});try{var createMethod=new Function("getTransactionFlag","addTreeChangesMessages","addChangeMessage","addMessages","cloneTree","valueIsTree","normalizeSpliceIndex",methodCode);return createMethod(getTransactionFlag,addTreeChangesMessages,addChangeMessage,addMessages,cloneTree,valueIsTree,normalizeSpliceIndex)}catch(e){throw Error("ModelPath method compilation error; path: "+path+", code: "+methodCode)}}var pathUtils=require("../path_utils"),modelUtils=require("../model_utils"),logger=require("../../util/logger"),doT=require("dot"),_=require("protojs"),changeDataHandler=require("../change_data"),getTransactionFlag=changeDataHandler.getTransactionFlag,templates=(changeDataHandler.postTransactionFinished,{get:Buffer("J3VzZSBzdHJpY3QnOwovKiBPbmx5IHVzZSB0aGlzIHN0eWxlIG9mIGNvbW1lbnRzLCBub3QgIi8vIiAqLwoKcmV0dXJuIGZ1bmN0aW9uIGdldCgpIHsKICAgIHZhciBtID0ge3sjIGRlZi5tb2RlbEFjY2Vzc1ByZWZpeCB9fTsKICAgIHJldHVybiBtIHt7fiBpdC5wYXJzZWRQYXRoIDpwYXRoTm9kZSB9fQogICAgICAgIHt7PyBwYXRoTm9kZS5pbnRlcnBvbGF0ZX19CiAgICAgICAgICAgICYmIChtID0gbVt0aGlzLl9hcmdzWyB7ez0gcGF0aE5vZGUuaW50ZXJwb2xhdGUgfX0gXV0pCiAgICAgICAge3s/P319CiAgICAgICAgICAgICYmIChtID0gbXt7PSBwYXRoTm9kZS5wcm9wZXJ0eSB9fSkKICAgICAgICB7ez99fSB7e359fTsKfTsK","base64"),set:Buffer("J3VzZSBzdHJpY3QnOwovKiBPbmx5IHVzZSB0aGlzIHN0eWxlIG9mIGNvbW1lbnRzLCBub3QgIi8vIiAqLwoKe3sjIGRlZi5pbmNsdWRlX2RlZmluZXMgfX0Ke3sjIGRlZi5pbmNsdWRlX2NyZWF0ZV90cmVlIH19CgoKLyoqCiAqIFRlbXBsYXRlIHRoYXQgc3ludGhlc2l6ZXMgc2V0dGVyIGZvciBNb2RlbCBhbmQgZm9yIE1vZGVsUGF0aAogKi8KcmV0dXJuIGZ1bmN0aW9uIHNldCh2YWx1ZSkgewogICAge3sjIGRlZi5pbml0VmFyczonc2V0JyB9fQoKICAgIHt7IyBkZWYuY3JlYXRlVHJlZTonc2V0JyB9fQoKICAgIHt7CiAgICAgICAgY3Vyck5vZGUgPSBuZXh0Tm9kZTsKICAgICAgICBjdXJyUHJvcCA9IGN1cnJOb2RlICYmIGN1cnJOb2RlLnByb3BlcnR5OwogICAgfX0KCiAgICB7eyAvKiBhc3NpZ24gdmFsdWUgdG8gdGhlIGxhc3QgcHJvcGVydHkgKi8gfX0KICAgIHt7PyBjdXJyUHJvcCB9fQogICAgICAgIHdhc0RlZiA9IHt7IyBkZWYud2FzRGVmaW5lZH19OwogICAgICAgIHt7IyBkZWYuY2hhbmdlQWNjZXNzUGF0aCB9fQoKICAgICAgICB2YXIgb2xkID0gbXt7IyBkZWYuY3VyclByb3AgfX07CgogICAgICAgIHt7IC8qIGNsb25lIHZhbHVlIHRvIHByZXZlbnQgc2FtZSByZWZlcmVuY2UgaW4gbGlua2VkIG1vZGVscyAqLyB9fQogICAgICAgIG17eyMgZGVmLmN1cnJQcm9wIH19ID0gY2xvbmVUcmVlKHZhbHVlKTsKICAgIHt7P319CgogICAge3sgLyogYWRkIG1lc3NhZ2UgcmVsYXRlZCB0byB0aGUgbGFzdCBwcm9wZXJ0eSBjaGFuZ2UgKi8gfX0KICAgIGlmICh0aGlzLl9vcHRpb25zLnJlYWN0aXZlICE9PSBmYWxzZSkgewogICAgICAgIGlmICghIHdhc0RlZikKICAgICAgICAgICAge3sjIGRlZi5hZGRNc2cgfX0gYWNjZXNzUGF0aCwgdHlwZTogJ2FkZGVkJywKICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiB2YWx1ZSB9KTsKICAgICAgICBlbHNlIGlmIChvbGQgIT0gdmFsdWUpCiAgICAgICAgICAgIHt7IyBkZWYuYWRkTXNnIH19IGFjY2Vzc1BhdGgsIHR5cGU6ICdjaGFuZ2VkJywKICAgICAgICAgICAgICAgIG9sZFZhbHVlOiBvbGQsIG5ld1ZhbHVlOiB2YWx1ZSB9KTsKCiAgICAgICAge3sgLyogYWRkIG1lc3NhZ2UgcmVsYXRlZCB0byBjaGFuZ2VzIGluIChzdWIpcHJvcGVydGllcyBpbnNpZGUgcmVtb3ZlZCBhbmQgYXNzaWduZWQgdmFsdWUgKi8gfX0KICAgICAgICBpZiAoISB3YXNEZWYgfHwgb2xkICE9IHZhbHVlKQogICAgICAgICAgICBhZGRUcmVlQ2hhbmdlc01lc3NhZ2VzKG1lc3NhZ2VzLCBtZXNzYWdlc0hhc2gsCiAgICAgICAgICAgICAgICBhY2Nlc3NQYXRoLCBvbGQsIHZhbHVlKTsgLyogZGVmaW5lZCBpbiB0aGUgZnVuY3Rpb24gdGhhdCBzeW50aGVzaXplcyBNb2RlbFBhdGggc2V0dGVyICovCgogICAgICAgIHt7IC8qIHBvc3QgYWxsIHN0b3JlZCBtZXNzYWdlcyAqLyB9fQogICAgICAgIHt7IyBkZWYucG9zdE1lc3NhZ2VzIH19CiAgICB9Cn07Cg==","base64"),del:Buffer("J3VzZSBzdHJpY3QnOwovKiBPbmx5IHVzZSB0aGlzIHN0eWxlIG9mIGNvbW1lbnRzLCBub3QgIi8vIiAqLwoKe3sjIGRlZi5pbmNsdWRlX2RlZmluZXMgfX0Ke3sjIGRlZi5pbmNsdWRlX3RyYXZlcnNlX3RyZWUgfX0KCnJldHVybiBmdW5jdGlvbiBkZWwoKSB7CiAgICB7eyMgZGVmLmluaXRWYXJzOidkZWwnIH19CgogICAge3s/IGl0LnBhcnNlZFBhdGgubGVuZ3RoIH19CiAgICAgICAge3sjIGRlZi50cmF2ZXJzZVRyZWUgfX0KCiAgICAgICAge3sKICAgICAgICAgICAgdmFyIGN1cnJOb2RlID0gaXQucGFyc2VkUGF0aFtjb3VudF07CiAgICAgICAgICAgIHZhciBjdXJyUHJvcCA9IGN1cnJOb2RlLnByb3BlcnR5OyAgICAgICAKICAgICAgICB9fQoKICAgICAgICBpZiAoISB0cmVlRG9lc05vdEV4aXN0ICYmIG0gJiYgbS5oYXNPd25Qcm9wZXJ0eSAmJiB7eyMgZGVmLndhc0RlZmluZWR9fSkgewogICAgICAgICAgICB2YXIgb2xkID0gbXt7IyBkZWYuY3VyclByb3AgfX07CiAgICAgICAgICAgIGRlbGV0ZSBte3sjIGRlZi5jdXJyUHJvcCB9fTsKICAgICAgICAgICAge3sjIGRlZi5jaGFuZ2VBY2Nlc3NQYXRoIH19CiAgICAgICAgICAgIHZhciBkaWREZWxldGUgPSB0cnVlOwogICAgICAgIH0KICAgIHt7Pz99fQogICAgICAgIGlmICh0eXBlb2YgbSAhPSAndW5kZWZpbmVkJykgewogICAgICAgICAgICB2YXIgb2xkID0gbTsKICAgICAgICAgICAge3sjIGRlZi5tb2RlbEFjY2Vzc1ByZWZpeCB9fSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGRpZERlbGV0ZSA9IHRydWU7CiAgICAgICAgfQogICAge3s/fX0KCiAgICBpZiAoZGlkRGVsZXRlICYmIHRoaXMuX29wdGlvbnMucmVhY3RpdmUgIT09IGZhbHNlKSB7CiAgICAgICAge3sjIGRlZi5hZGRNc2cgfX0gYWNjZXNzUGF0aCwgdHlwZTogJ2RlbGV0ZWQnLCBvbGRWYWx1ZTogb2xkIH0pOwoKICAgICAgICBhZGRUcmVlQ2hhbmdlc01lc3NhZ2VzKG1lc3NhZ2VzLCBtZXNzYWdlc0hhc2gsCiAgICAgICAgICAgIGFjY2Vzc1BhdGgsIG9sZCwgdW5kZWZpbmVkKTsgLyogZGVmaW5lZCBpbiB0aGUgZnVuY3Rpb24gdGhhdCBzeW50aGVzaXplcyBNb2RlbFBhdGggc2V0dGVyICovCgogICAgICAgIHt7IC8qIHBvc3QgYWxsIHN0b3JlZCBtZXNzYWdlcyAqLyB9fQogICAgICAgIHt7IyBkZWYucG9zdE1lc3NhZ2VzIH19CiAgICB9Cn07Cg==","base64"),splice:Buffer("J3VzZSBzdHJpY3QnOwovKiBPbmx5IHVzZSB0aGlzIHN0eWxlIG9mIGNvbW1lbnRzLCBub3QgIi8vIiAqLwoKe3sjIGRlZi5pbmNsdWRlX2RlZmluZXMgfX0Ke3sjIGRlZi5pbmNsdWRlX2NyZWF0ZV90cmVlIH19Cnt7IyBkZWYuaW5jbHVkZV90cmF2ZXJzZV90cmVlIH19CgpyZXR1cm4gZnVuY3Rpb24gc3BsaWNlKHNwbGljZUluZGV4LCBzcGxpY2VIb3dNYW55KSB7IC8qICwuLi4gLSBleHRyYSBhcmd1bWVudHMgdG8gc3BsaWNlIGludG8gYXJyYXkgKi8KICAgIHt7IyBkZWYuaW5pdFZhcnM6J3NwbGljZScgfX0KCiAgICB2YXIgYXJnc0xlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICB2YXIgYWRkSXRlbXMgPSBhcmdzTGVuID4gMjsKCiAgICBpZiAoYWRkSXRlbXMpIHsKICAgICAgICB7eyAvKiBvbmx5IGNyZWF0ZSBtb2RlbCB0cmVlIGlmIGl0ZW1zIGFyZSBpbnNlcnRlZCBpbiBhcnJheSAqLyB9fQoKICAgICAgICB7eyAvKiBpZiBtb2RlbCBpcyB1bmRlZmluZWQgaXQgd2lsbCBiZSBzZXQgdG8gYW4gZW1wdHkgYXJyYXkgKi8gfX0gIAogICAgICAgIHZhciB2YWx1ZSA9IFtdOwogICAgICAgIHt7IyBkZWYuY3JlYXRlVHJlZTonc3BsaWNlJyB9fQoKICAgICAgICB7ez8gbmV4dE5vZGUgfX0KICAgICAgICAgICAge3sKICAgICAgICAgICAgICAgIHZhciBjdXJyTm9kZSA9IG5leHROb2RlOwogICAgICAgICAgICAgICAgdmFyIGN1cnJQcm9wID0gY3Vyck5vZGUucHJvcGVydHk7CiAgICAgICAgICAgICAgICB2YXIgZW1wdHlQcm9wID0gJ1tdJzsKICAgICAgICAgICAgfX0KCiAgICAgICAgICAgIHt7IyBkZWYuY3JlYXRlVHJlZVN0ZXAgfX0KICAgICAgICB7ez99fQoKICAgIH0gZWxzZSBpZiAoc3BsaWNlSG93TWFueSA+IDApIHsKICAgICAgICB7eyAvKiBpZiBpdGVtcyBhcmUgbm90IGluc2VydGVkLCBvbmx5IHRyYXZlcnNlIG1vZGVsIHRyZWUgaWYgaXRlbXMgYXJlIGRlbGV0ZWQgZnJvbSBhcnJheSAqLyB9fQogICAgICAgIHt7PyBpdC5wYXJzZWRQYXRoLmxlbmd0aCB9fQogICAgICAgICAgICB7eyMgZGVmLnRyYXZlcnNlVHJlZSB9fQoKICAgICAgICAgICAge3sKICAgICAgICAgICAgICAgIHZhciBjdXJyTm9kZSA9IGl0LnBhcnNlZFBhdGhbY291bnRdOwogICAgICAgICAgICAgICAgdmFyIGN1cnJQcm9wID0gY3Vyck5vZGUucHJvcGVydHk7ICAgICAgIAogICAgICAgICAgICB9fQoKICAgICAgICAgICAge3sgLyogZXh0cmEgYnJhY2UgY2xvc2VzICdlbHNlJyBpbiBkZWYudHJhdmVyc2VUcmVlU3RlcCAqLyB9fQogICAgICAgICAgICB7eyMgZGVmLnRyYXZlcnNlVHJlZVN0ZXAgfX0gfQogICAgICAgIHt7P319CiAgICB9CgogICAge3sgLyogc3BsaWNlIGl0ZW1zICovIH19CiAgICBpZiAoYWRkSXRlbXMgfHwgKCEgdHJlZURvZXNOb3RFeGlzdCAmJiBtCiAgICAgICAgICAgICYmIG0ubGVuZ3RoID4gc3BsaWNlSW5kZXggKSApIHsKICAgICAgICB2YXIgb2xkTGVuZ3RoID0gbS5sZW5ndGggPSBtLmxlbmd0aCB8fCAwOwoKICAgICAgICBhcmd1bWVudHNbMF0gPSBzcGxpY2VJbmRleCA9IG5vcm1hbGl6ZVNwbGljZUluZGV4KHNwbGljZUluZGV4LCBtLmxlbmd0aCk7CgogICAgICAgIHt7IC8qIGNsb25lIGFkZGVkIGFyZ3VtZW50cyB0byBwcmV2ZW50IHNhbWUgcmVmZXJlbmNlcyBpbiBsaW5rZWQgbW9kZWxzICovIH19CiAgICAgICAgaWYgKGFkZEl0ZW1zKQogICAgICAgICAgICBmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3NMZW47IGkrKykKICAgICAgICAgICAgICAgIGFyZ3VtZW50c1tpXSA9IGNsb25lVHJlZShhcmd1bWVudHNbaV0pOwoKICAgICAgICB7eyAvKiBhY3R1YWwgc3BsaWNlIGNhbGwgKi8gfX0KICAgICAgICB2YXIgcmVtb3ZlZCA9IEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkobSwgYXJndW1lbnRzKTsKCiAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMucmVhY3RpdmUgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHt7IyBkZWYuYWRkTXNnIH19IGFjY2Vzc1BhdGgsIHR5cGU6ICdzcGxpY2UnLAogICAgICAgICAgICAgICAgICAgIGluZGV4OiBzcGxpY2VJbmRleCwgcmVtb3ZlZDogcmVtb3ZlZCwgYWRkZWRDb3VudDogYWRkSXRlbXMgPyBhcmdzTGVuIC0gMiA6IDAsCiAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWU6IG0gfSk7CgogICAgICAgICAgICBpZiAocmVtb3ZlZCAmJiByZW1vdmVkLmxlbmd0aCkKICAgICAgICAgICAgICAgIHJlbW92ZWQuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpbmRleCkgewogICAgICAgICAgICAgICAgICAgIHZhciBpdGVtUGF0aCA9IGFjY2Vzc1BhdGggKyAnWycgKyAoc3BsaWNlSW5kZXggKyBpbmRleCkgKyAnXSc7CiAgICAgICAgICAgICAgICAgICAge3sjIGRlZi5hZGRNc2cgfX0gaXRlbVBhdGgsIHR5cGU6ICdyZW1vdmVkJywgb2xkVmFsdWU6IGl0ZW0gfSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZUlzVHJlZShpdGVtKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTWVzc2FnZXMobWVzc2FnZXMsIG1lc3NhZ2VzSGFzaCwgaXRlbVBhdGgsIGl0ZW0sICdyZW1vdmVkJywgJ29sZFZhbHVlJyk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChhZGRJdGVtcykKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAyOyBpIDwgYXJnc0xlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1QYXRoID0gYWNjZXNzUGF0aCArICdbJyArIChzcGxpY2VJbmRleCArIGkgLSAyKSArICddJzsKICAgICAgICAgICAgICAgICAgICB7eyMgZGVmLmFkZE1zZyB9fSBpdGVtUGF0aCwgdHlwZTogJ2FkZGVkJywgbmV3VmFsdWU6IGl0ZW0gfSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZUlzVHJlZShpdGVtKSkKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTWVzc2FnZXMobWVzc2FnZXMsIG1lc3NhZ2VzSGFzaCwgaXRlbVBhdGgsIGl0ZW0sICdhZGRlZCcsICduZXdWYWx1ZScpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAge3sgLyogcG9zdCBhbGwgc3RvcmVkIG1lc3NhZ2VzICovIH19CiAgICAgICAgICAgIHt7IyBkZWYucG9zdE1lc3NhZ2VzIH19CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiByZW1vdmVkIHx8IFtdOwp9Cg==","base64")
}),include_defines=Buffer("J3VzZSBzdHJpY3QnOwovKiBPbmx5IHVzZSB0aGlzIHN0eWxlIG9mIGNvbW1lbnRzLCBub3QgIi8vIiAqLwoKLyoqCiAqIEluc2VydHMgaW5pdGlhbGl6YXRpb24gY29kZQogKi8KIHt7IyMgZGVmLmluaXRWYXJzOm1ldGhvZDoKICAgIHZhciBtID0ge3sjIGRlZi5tb2RlbEFjY2Vzc1ByZWZpeCB9fTsKICAgIHZhciBtZXNzYWdlcyA9IFtdLCBtZXNzYWdlc0hhc2ggPSB7fTsKICAgIHZhciBhY2Nlc3NQYXRoID0gJyc7CiAgICB2YXIgdHJlZURvZXNOb3RFeGlzdDsKICAgIC8qIGhhY2sgdG8gcHJldmVudCBzZW5kaW5nIGZpbmlzaGVkIGV2ZW50cyB0byBhbGxvdyBmb3IgcHJvcGFnYXRpb24gb2YgYmF0Y2hlcyB3aXRob3V0IHNwbGl0dGluZyB0aGVtICovCiAgICB2YXIgaW5DaGFuZ2VUcmFuc2FjdGlvbiA9IGdldFRyYW5zYWN0aW9uRmxhZygge3s9IG1ldGhvZCB9fSApOwogI319CgovKioKICogSW5zZXJ0cyB0aGUgYmVnaW5uaW5nIG9mIGZ1bmN0aW9uIGNhbGwgdG8gYWRkIG1lc3NhZ2UgdG8gbGlzdAogKi8Ke3sjIyBkZWYuYWRkTXNnOiBhZGRDaGFuZ2VNZXNzYWdlKG1lc3NhZ2VzLCBtZXNzYWdlc0hhc2gsIHsgcGF0aDogI319CgovKioKICogSW5zZXJ0cyBjdXJyZW50IHByb3BlcnR5L2luZGV4IGZvciBib3RoIG5vcm1hbCBhbmQgaW50ZXJwb2xhdGVkIHByb3BlcnRpZXMvaW5kZXhlcwogKi8Ke3sjIyBkZWYuY3VyclByb3A6e3s/IGN1cnJOb2RlLmludGVycG9sYXRlIH19W3RoaXMuX2FyZ3NbIHt7PSBjdXJyTm9kZS5pbnRlcnBvbGF0ZSB9fSBdXXt7Pz99fXt7PSBjdXJyUHJvcCB9fXt7P319ICN9fQoKLyoqCiAqIEluc2VydHMgY29uZGl0aW9uIHRvIHRlc3Qgd2hldGhlciBub3JtYWwvaW50ZXJwb2xhdGVkIHByb3BlcnR5L2luZGV4IGV4aXN0cwogKi8Ke3sjIyBkZWYud2FzRGVmaW5lZDogbS5oYXNPd25Qcm9wZXJ0eSgKICAgIHt7PyBjdXJyTm9kZS5pbnRlcnBvbGF0ZSB9fQogICAgICAgIHRoaXMuX2FyZ3NbIHt7PSBjdXJyTm9kZS5pbnRlcnBvbGF0ZSB9fSBdCiAgICB7ez8/fX0KICAgICAgICAne3s9IGl0LmdldFBhdGhOb2RlS2V5KGN1cnJOb2RlKSB9fScKICAgIHt7P319CikgI319CgoKLyoqCiAqIEluc2VydHMgY29kZSB0byB1cGRhdGUgYWNjZXNzIHBhdGggZm9yIGN1cnJlbnQgcHJvcGVydHkKICogQmVjYXVzZSBvZiB0aGUgcG9zc2liaWxpdHkgb2YgaW50ZXJwb2xhdGVkIHByb3BlcnRpZXMsIGl0IGNhbid0IGJlIGNhbGN1bGF0ZWQgaW4gdGVtcGxhdGUsIGl0IGNhbiBvbmx5IGJlIGNhbGN1bGF0ZWQgZHVyaW5nIGFjY2Vzc29yIGNhbGwuCiAqLwp7eyMjIGRlZi5jaGFuZ2VBY2Nlc3NQYXRoOgogICAgYWNjZXNzUGF0aCArPSB7ez8gY3Vyck5vZGUuaW50ZXJwb2xhdGUgfX0KICAgICAgICB7ez8gY3Vyck5vZGUuc3ludGF4ID09ICdhcnJheScgfX0KICAgICAgICAgICAgJ1snICsgdGhpcy5fYXJnc1sge3s9IGN1cnJOb2RlLmludGVycG9sYXRlIH19IF0gKyAnXSc7CiAgICAgICAge3s/P319CiAgICAgICAgICAgICcuJyArIHRoaXMuX2FyZ3NbIHt7PSBjdXJyTm9kZS5pbnRlcnBvbGF0ZSB9fSBdOwogICAgICAgIHt7P319CiAgICB7ez8/fX0KICAgICAgICAne3s9IGN1cnJQcm9wIH19JzsKICAgIHt7P319CiN9fQoKCi8qKgogKiBJbnNlcnRzIGNvZGUgdG8gcG9zdCBzdG9yZWQgbWVzc2FnZXMKICovCnt7IyMgZGVmLnBvc3RNZXNzYWdlczoKICAgIGlmIChtZXNzYWdlcy5sZW5ndGgpIHsKICAgICAgICB7eyMgZGVmLm1vZGVsUG9zdEJhdGNoQ29kZSB9fSgnZGF0YWNoYW5nZXMnLCB7CiAgICAgICAgICAgIGNoYW5nZXM6IG1lc3NhZ2VzLAogICAgICAgICAgICB0cmFuc2FjdGlvbjogaW5DaGFuZ2VUcmFuc2FjdGlvbgogICAgICAgIH0pOwoKICAgICAgICBtZXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uKG1zZykgewogICAgICAgICAgICB7eyMgZGVmLm1vZGVsUG9zdE1lc3NhZ2VDb2RlIH19KG1zZy5wYXRoLCBtc2cpOwogICAgICAgIH0sIHRoaXMpOwogICAgfQojfX0K","base64"),include_create_tree=Buffer("J3VzZSBzdHJpY3QnOwovKiBPbmx5IHVzZSB0aGlzIHN0eWxlIG9mIGNvbW1lbnRzLCBub3QgIi8vIiAqLwoKLyoqCiAqIEluc2VydHMgY29kZSB0byBjcmVhdGUgbW9kZWwgdHJlZSBhcyBuZWNjZXNzYXJ5IGZvciBgc2V0YCBhbmQgYHNwbGljZWAgYWNjZXNzb3JzIGFuZCB0byBhZGQgbWVzc2FnZXMgdG8gc2VuZCBsaXN0IGlmIHRoZSB0cmVlIGNoYW5nZXMuCiAqLwp7eyMjIGRlZi5jcmVhdGVUcmVlOm1ldGhvZDoKICAgIHZhciB3YXNEZWYgPSB0cnVlOwogICAgdmFyIG9sZCA9IG07CgogICAge3sgdmFyIGVtcHR5UHJvcCA9IGl0LnBhcnNlZFBhdGhbMF0gJiYgaXQucGFyc2VkUGF0aFswXS5lbXB0eTsgfX0KICAgIHt7PyBlbXB0eVByb3AgfX0KICAgICAgICB7eyAvKiBjcmVhdGUgdG9wIGxldmVsIG1vZGVsIGlmIGl0IHdhcyBub3QgcHJldmlvdXNseSBkZWZpbmVkICovIH19CiAgICAgICAgaWYgKCEgbSkgewogICAgICAgICAgICBtID0ge3sjIGRlZi5tb2RlbEFjY2Vzc1ByZWZpeCB9fSA9IHt7PSBlbXB0eVByb3AgfX07CiAgICAgICAgICAgIHdhc0RlZiA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMucmVhY3RpdmUgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICB7eyMgZGVmLmFkZE1zZyB9fSAnJywgdHlwZTogJ2FkZGVkJywKICAgICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiBtIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAge3s/P319CiAgICAgICAge3s/IG1ldGhvZCA9PSAnc3BsaWNlJyB9fQogICAgICAgICAgICBpZiAoISBtKSB7CiAgICAgICAge3s/fX0KICAgICAgICAgICAgICAgIG0gPSB7eyMgZGVmLm1vZGVsQWNjZXNzUHJlZml4IH19ID0gY2xvbmVUcmVlKHZhbHVlKTsKICAgICAgICAgICAgICAgIHdhc0RlZiA9IHR5cGVvZiBvbGQgIT0gJ3VuZGVmaW5lZCc7CiAgICAgICAge3s/IG1ldGhvZCA9PSAnc3BsaWNlJyB9fQogICAgICAgICAgICB9CiAgICAgICAge3s/fX0gICAgICAgCiAgICB7ez99fQoKCiAgICB7eyAvKiBjcmVhdGUgbW9kZWwgdHJlZSBpZiBpdCBkb2Vzbid0IGV4aXN0ICovIH19CiAgICB7eyAgdmFyIG1vZGVsRGF0YVByb3BlcnR5ID0gJyc7CiAgICAgICAgdmFyIG5leHROb2RlID0gaXQucGFyc2VkUGF0aFswXTsKICAgICAgICB2YXIgY291bnQgPSBpdC5wYXJzZWRQYXRoLmxlbmd0aCAtIDE7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICB2YXIgY3Vyck5vZGUgPSBuZXh0Tm9kZTsKICAgICAgICAgICAgdmFyIGN1cnJQcm9wID0gY3Vyck5vZGUucHJvcGVydHk7CiAgICAgICAgICAgIG5leHROb2RlID0gaXQucGFyc2VkUGF0aFtpICsgMV07CiAgICAgICAgICAgIHZhciBlbXB0eVByb3AgPSBuZXh0Tm9kZSAmJiBuZXh0Tm9kZS5lbXB0eTsKICAgIH19CgogICAgICAgIHt7IyBkZWYuY3JlYXRlVHJlZVN0ZXAgfX0KCiAgICB7eyAgfSAvKiBmb3IgbG9vcCAqLyB9fQojfX0KCgovKioKICogSW5zZXJ0cyBjb2RlIHRvIGNyZWF0ZSBvbmUgc3RlcCBpbiB0aGUgbW9kZWwgdHJlZQogKi8Ke3sjIyBkZWYuY3JlYXRlVHJlZVN0ZXA6CiAgICB7eyMgZGVmLmNoYW5nZUFjY2Vzc1BhdGggfX0KCiAgICBpZiAoISB7eyMgZGVmLndhc0RlZmluZWQgfX0pIHsgCiAgICAgICAge3sgLyogcHJvcGVydHkgZG9lcyBub3QgZXhpc3QgKi8gfX0KICAgICAgICBtID0gbXt7IyBkZWYuY3VyclByb3AgfX0gPSB7ez0gZW1wdHlQcm9wIH19OwoKICAgICAgICBpZiAodGhpcy5fb3B0aW9ucy5yZWFjdGl2ZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAge3sjIGRlZi5hZGRNc2cgfX0gYWNjZXNzUGF0aCwgdHlwZTogJ2FkZGVkJywgCiAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlOiBtIH0pOwogICAgICAgIH0KCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBte3sjIGRlZi5jdXJyUHJvcCB9fSAhPSAnb2JqZWN0JyB8fCBte3sjIGRlZi5jdXJyUHJvcCB9fSA9PT0gbnVsbCkgewogICAgICAgIHt7IC8qIHByb3BlcnR5IGlzIG5vdCBvYmplY3QgKi8gfX0KICAgICAgICB2YXIgb2xkID0gbXt7IyBkZWYuY3VyclByb3AgfX07CiAgICAgICAgbSA9IG17eyMgZGVmLmN1cnJQcm9wIH19ID0ge3s9IGVtcHR5UHJvcCB9fTsKCiAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMucmVhY3RpdmUgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHt7IyBkZWYuYWRkTXNnIH19IGFjY2Vzc1BhdGgsIHR5cGU6ICdjaGFuZ2VkJywgCiAgICAgICAgICAgICAgICAgIG9sZFZhbHVlOiBvbGQsIG5ld1ZhbHVlOiBtIH0pOwogICAgICAgIH0KCiAgICB9IGVsc2UgewogICAgICAgIHt7IC8qIHByb3BlcnR5IGV4aXN0cywganVzdCB0cmF2ZXJzZSBkb3duIHRoZSBtb2RlbCB0cmVlICovIH19CiAgICAgICAgbSA9IG17eyMgZGVmLmN1cnJQcm9wIH19OwogICAgfQojfX0K","base64"),include_traverse_tree=Buffer("J3VzZSBzdHJpY3QnOwovKiBPbmx5IHVzZSB0aGlzIHN0eWxlIG9mIGNvbW1lbnRzLCBub3QgIi8vIiAqLwoKLyoqCiAqIEluc2VydHMgY29kZSB0byB0cmF2ZXJzZSBtb2RlbCB0cmVlIGZvciBgZGVsZXRlYCBhbmQgYHNwbGljZWAgYWNjZXNzb3JzLgogKi8Ke3sjIyBkZWYudHJhdmVyc2VUcmVlOgogICAge3sgCiAgICAgICAgdmFyIGNvdW50ID0gaXQucGFyc2VkUGF0aC5sZW5ndGgtMTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7IAogICAgICAgICAgICB2YXIgY3Vyck5vZGUgPSBpdC5wYXJzZWRQYXRoW2ldOwogICAgICAgICAgICB2YXIgY3VyclByb3AgPSBjdXJyTm9kZS5wcm9wZXJ0eTsKICAgIH19CiAgICAgICAgICAgIHt7IyBkZWYudHJhdmVyc2VUcmVlU3RlcCB9fQoKICAgIHt7IH0gLyogZm9yIGxvb3AgKi8KCiAgICAgICAgdmFyIGkgPSBjb3VudDsKICAgICAgICB3aGlsZSAoaS0tKSB7IC8qIGNsb3NpbmcgYnJhY2VzIGZvciBlbHNlJ3MgYWJvdmUgKi8KICAgIH19CiAgICAgICAgICAgIH0KICAgIHt7IH0gLyogd2hpbGUgbG9vcCAqLyB9fQojfX0KCgovKioKICogSW5zZXJ0cyBjb2RlIHRvIHRyYXZlcnNlIG9uZSBzdGVwIGluIHRoZSBtb2RlbCB0cmVlCiAqLwp7eyMjIGRlZi50cmF2ZXJzZVRyZWVTdGVwOgogICAgaWYgKCEgKG0gJiYgbS5oYXNPd25Qcm9wZXJ0eSAmJiB7eyMgZGVmLndhc0RlZmluZWR9fSApICkKICAgICAgICB0cmVlRG9lc05vdEV4aXN0ID0gdHJ1ZTsKICAgIGVsc2UgewogICAgICAgIG0gPSBte3sjIGRlZi5jdXJyUHJvcCB9fTsKICAgICAgICB7eyMgZGVmLmNoYW5nZUFjY2Vzc1BhdGggfX0KICAgIHt7IC8qIGJyYWNlIGZyb20gZWxzZSBpcyBub3QgY2xvc2VkIG9uIHB1cnBvc2UgLSBhbGwgYnJhY2VzIGFyZSBjbG9zZWQgaW4gd2hpbGUgbG9vcCAqLyB9fQojfX0K","base64"),dotDef={include_defines:include_defines,include_create_tree:include_create_tree,include_traverse_tree:include_traverse_tree,getPathNodeKey:pathUtils.getPathNodeKey,modelAccessPrefix:"this._model._data",modelPostMessageCode:"this._model._internalMessenger.postMessage",modelPostBatchCode:"this._model.postMessageSync",internalMessenger:"this._model._internalMessenger"},modelDotDef=_(dotDef).clone().extend({modelAccessPrefix:"this._data",modelPostMessageCode:"this._internalMessenger.postMessage",modelPostBatchCode:"this.postMessageSync",internalMessenger:"this._internalMessenger"})._(),dotSettings=_.clone(doT.templateSettings);dotSettings.strip=!1;var synthesizers=_.mapKeys(templates,function(tmpl){return doT.template(tmpl,dotSettings,dotDef)}),modelSynthesizers=_.mapToObject(["set","del","splice"],function(methodName){return doT.template(templates[methodName],dotSettings,modelDotDef)}),synthesizePathMethods=_.memoize(_synthesizePathMethods,void 0,1e3),normalizeSpliceIndex=modelUtils.normalizeSpliceIndex;module.exports=synthesizePathMethods;var modelMethods=_.mapKeys(modelSynthesizers,function(synthesizer){return _synthesize(synthesizer,"",[])});synthesizePathMethods.modelMethods=modelMethods}).call(this,require("buffer").Buffer)},{"../../util/logger":100,"../change_data":90,"../model_utils":95,"../path_utils":97,buffer:77,dot:103,protojs:122}],99:[function(require,module,exports){"use strict";var config=require("../config"),util={logger:require("./logger"),check:require("ml-check"),doT:require("dot")};util.check.disable=!config.check,module.exports=util},{"../config":82,"./logger":100,dot:103,"ml-check":104}],100:[function(require,module,exports){"use strict";var Logger=require("./logger_class"),logger=new Logger({level:3});module.exports=logger},{"./logger_class":101}],101:[function(require,module,exports){"use strict";function pad(str){return str.length<maxLevelLength?str+new Array(maxLevelLength-str.length+1).join(" "):str}function colored(str,color){return"["+color+"m"+str+" -[39m"}function Logger(opts){_.extend(this,DEFAULT_OPTIONS),_.extend(this,opts||{});var messenger=new Messenger(this);_.defineProperty(this,MESSENGER_PROPERTY,messenger)}var _=require("protojs"),Messenger=require("../messenger"),levels=["error","warn","info","debug"],maxLevelLength=Math.max.apply(Math,levels.map(function(level){return level.length})),colors=[31,33,36,90],DEFAULT_OPTIONS={level:3,throwLevel:-1,enabled:!0,logPrefix:""},MESSENGER_PROPERTY="_messenger";Messenger.useWith(Logger,MESSENGER_PROPERTY,Messenger.defaultMethods),Logger.prototype.log=function(type){function logString(){return[self.logPrefix,type+":"].concat(args).join(" ")}var index=levels.indexOf(type);if(!this.enabled||index>this.level)return this;var args=_.slice(arguments,1),self=this;if(index<=this.throwLevel)throw new Error(logString());return index<=this.messageLevel&&this.postMessage("log",{level:index,type:type,str:logString()}),console.log.apply(console,[this.logPrefixColor?"   "+colored(this.logPrefix,this.logPrefixColor):this.logPrefix,(this.colors?" "+colored(pad(type),colors[index]):type)+":"].concat(args)),this},levels.forEach(function(name){Logger.prototype[name]=function(){this.log.apply(this,[name].concat(_.toArray(arguments)))}}),module.exports=Logger},{"../messenger":83,protojs:122}],102:[function(require,module,exports){!function(){"use strict";function resolveDefs(c,block,def){return("string"==typeof block?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){return 0===code.indexOf("def.")&&(code=code.substring(4)),code in def||(":"===assign?(c.defineParams&&value.replace(c.defineParams,function(m,param,v){def[code]={arg:param,text:v}}),code in def||(def[code]=value)):new Function("def","def['"+code+"']="+value)(def)),""}).replace(c.use||skip,function(m,code){c.useParams&&(code=code.replace(c.useParams,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");return def.__exp=def.__exp||{},def.__exp[rw]=def[d].text.replace(new RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2"),s+"def.__exp['"+rw+"']"}}));var v=new Function("def","return "+code)(def);return v?resolveDefs(c,v,def):v})}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var _globals,doT={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};doT.encodeHTMLSource=function(doNotSkipEncoded){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=doNotSkipEncoded?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(code){return code?code.toString().replace(matchHTML,function(m){return encodeHTMLRules[m]||m}):""}},_globals=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=doT:"function"==typeof define&&define.amd?define(function(){return doT}):_globals.doT=doT;var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var needhtmlencode,indv,cse=c.append?startend.append:startend.split,sid=0,str=c.use||c.define?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end}).replace(c.encode||skip,function(m,code){return needhtmlencode=!0,cse.startencode+unescape(code)+cse.end}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='":code?"';if("+unescape(code)+"){out+='":"';}out+='"}).replace(c.iterate||skip,function(m,iterate,vname,iname){return iterate?(sid+=1,indv=iname||"i"+sid,iterate=unescape(iterate),"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='"):"';} } out+='"}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),needhtmlencode&&(c.selfcontained||!_globals||_globals._encodeHTML||(_globals._encodeHTML=doT.encodeHTMLSource(c.doNotSkipEncoded)),str="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+doT.encodeHTMLSource.toString()+"("+(c.doNotSkipEncoded||"")+"));"+str);try{return new Function(c.varname,str)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+str),e}},doT.compile=function(tmpl,def){return doT.template(tmpl,null,def)}}()},{}],103:[function(require,module,exports){function InstallDots(o){this.__path=o.path||"./","/"!==this.__path[this.__path.length-1]&&(this.__path+="/"),this.__destination=o.destination||this.__path,"/"!==this.__destination[this.__destination.length-1]&&(this.__destination+="/"),this.__global=o.global||"window.render",this.__rendermodule=o.rendermodule||{},this.__settings=o.templateSettings?copy(o.templateSettings,copy(doT.templateSettings)):void 0,this.__includes={}}function addexports(exports){for(var ret="",i=0;i<exports.length;i++)ret+="itself."+exports[i]+"="+exports[i]+";";return ret}function copy(o,to){to=to||{};for(var property in o)to[property]=o[property];return to}function readdata(path){var data=fs.readFileSync(path);return data?data.toString():void console.log("problems with "+path)}var fs=require("fs"),doT=module.exports=require("./doT");doT.process=function(options){return new InstallDots(options).compileAll()},InstallDots.prototype.compileToFile=function(path,template,def){def=def||{};var fn,modulename=path.substring(path.lastIndexOf("/")+1,path.lastIndexOf(".")),defs=copy(this.__includes,copy(def)),settings=this.__settings||doT.templateSettings,compileoptions=copy(settings),defaultcompiled=doT.template(template,settings,defs),exports=[],compiled="";for(var property in defs)defs[property]!==def[property]&&defs[property]!==this.__includes[property]&&(fn=void 0,"string"==typeof defs[property]?fn=doT.template(defs[property],settings,defs):"function"==typeof defs[property]?fn=defs[property]:defs[property].arg&&(compileoptions.varname=defs[property].arg,fn=doT.template(defs[property].text,compileoptions,defs)),fn&&(compiled+=fn.toString().replace("anonymous",property),exports.push(property)));compiled+=defaultcompiled.toString().replace("anonymous",modulename),fs.writeFileSync(path,"(function(){"+compiled+"var itself="+modulename+", _encodeHTML=("+doT.encodeHTMLSource.toString()+"("+(settings.doNotSkipEncoded||"")+"));"+addexports(exports)+"if(typeof module!=='undefined' && module.exports) module.exports=itself;else if(typeof define==='function')define(function(){return itself;});else {"+this.__global+"="+this.__global+"||{};"+this.__global+"['"+modulename+"']=itself;}}());")},InstallDots.prototype.compilePath=function(path){var data=readdata(path);if(data)return doT.template(data,this.__settings||doT.templateSettings,copy(this.__includes))},InstallDots.prototype.compileAll=function(){console.log("Compiling all doT templates...");var k,l,name,defFolder=this.__path,sources=fs.readdirSync(defFolder);for(k=0,l=sources.length;k<l;k++)name=sources[k],/\.def(\.dot|\.jst)?$/.test(name)&&(console.log("Loaded def "+name),this.__includes[name.substring(0,name.indexOf("."))]=readdata(defFolder+name));for(k=0,l=sources.length;k<l;k++)name=sources[k],/\.dot(\.def|\.jst)?$/.test(name)&&(console.log("Compiling "+name+" to function"),this.__rendermodule[name.substring(0,name.indexOf("."))]=this.compilePath(defFolder+name)),/\.jst(\.dot|\.def)?$/.test(name)&&(console.log("Compiling "+name+" to file"),this.compileToFile(this.__destination+name.substring(0,name.indexOf("."))+".js",readdata(defFolder+name)));return this.__rendermodule}},{"./doT":102,fs:76}],104:[function(require,module,exports){"use strict";function Optional(pattern){this.pattern=pattern}function OneOf(choices){if(0===choices.length)throw new Error("Must provide at least one choice to Match.OneOf");this.choices=choices}function Where(condition){this.condition=condition}function ObjectIncluding(pattern){this.pattern=pattern}function ObjectHash(pattern){this.pattern=pattern}function Subclass(Superclass,matchSuperclassToo){this.Superclass=Superclass,this.matchSuperclass=matchSuperclassToo}function checkSubtree(value,pattern){if(pattern!==Match.Any){for(var i=0;i<typeofChecks.length;++i)if(pattern===typeofChecks[i][0]){if(typeof value===typeofChecks[i][1])return;throw new Match.Error("Expected "+typeofChecks[i][1]+", got "+typeof value)}if(null===pattern){if(null===value)return;throw new Match.Error("Expected null, got "+JSON.stringify(value))}if(pattern===Match.Integer){if("number"==typeof value&&(0|value)===value)return;throw new Match.Error("Expected Integer, got "+(value instanceof Object?JSON.stringify(value):value))}if(pattern===Match.IdentifierString){if("string"==typeof value&&Match.IdentifierString.test(value)&&_jsKeywords.indexOf(key)===-1)return;throw new Match.Error("Expected identifier string, got "+(value instanceof Object?JSON.stringify(value):value))}if(pattern===Object&&(pattern=Match.ObjectIncluding({})),pattern instanceof Array){if(1!==pattern.length)throw Error("Bad pattern: arrays must have one type element"+JSON.stringify(pattern));if(!Array.isArray(value))throw new Match.Error("Expected array, got "+JSON.stringify(value));return void value.forEach(function(valueElement,index){try{checkSubtree(valueElement,pattern[0])}catch(err){throw err instanceof Match.Error&&(err.path=_prependPath(index,err.path)),err}})}if(pattern instanceof Where){if(pattern.condition(value))return;throw new Match.Error("Failed Match.Where validation")}if(pattern instanceof Optional&&(pattern=Match.OneOf(void 0,pattern.pattern)),pattern instanceof OneOf){for(var i=0;i<pattern.choices.length;++i)try{return void checkSubtree(value,pattern.choices[i])}catch(err){if(!(err instanceof Match.Error))throw err}throw new Match.Error("Failed Match.OneOf or Match.Optional validation")}if(pattern instanceof Function){if(value instanceof pattern)return;throw new Match.Error("Expected "+pattern.constructor.name)}var unknownKeysAllowed=!1;if(pattern instanceof ObjectIncluding&&(unknownKeysAllowed=!0,pattern=pattern.pattern),pattern instanceof ObjectHash){var keyPattern=pattern.pattern,emptyHash=!0;for(var key in value)emptyHash=!1,check(value[key],keyPattern);if(emptyHash)throw new Match.Error("Expected "+pattern.constructor.name)}else if(pattern instanceof Subclass){var Superclass=pattern.Superclass;if(pattern.matchSuperclass&&value===Superclass)return;if(!(value.prototype instanceof Superclass))throw new Match.Error("Expected "+pattern.constructor.name+" of "+Superclass.name)}else{if("object"!=typeof pattern)throw Error("Bad pattern: unknown pattern type");if("object"!=typeof value)throw new Match.Error("Expected object, got "+typeof value);if(null===value)throw new Match.Error("Expected object, got null");var requiredPatterns={},optionalPatterns={};for(key in pattern)pattern[key]instanceof Optional?optionalPatterns[key]=pattern[key].pattern:requiredPatterns[key]=pattern[key];for(key in value){var subValue=value[key];try{if(requiredPatterns.hasOwnProperty(key))checkSubtree(subValue,requiredPatterns[key]),delete requiredPatterns[key];else if(optionalPatterns.hasOwnProperty(key))checkSubtree(subValue,optionalPatterns[key]);else if(!unknownKeysAllowed)throw new Match.Error("Unknown key")}catch(err){throw err instanceof Match.Error&&(err.path=_prependPath(key,err.path)),err}}for(key in requiredPatterns)throw new Match.Error("Missing key '"+key+"'")}}}function _prependPath(key,base){return"number"==typeof key||key.match(/^[0-9]+$/)?key="["+key+"]":key.match(Match.IdentifierString)&&_jsKeywords.indexOf(key)===-1||(key=JSON.stringify([key])),base&&"["!==base[0]?key+"."+base:key+base}var check=(require("protojs"),function(value,pattern){if(check.disabled!==!0)try{checkSubtree(value,pattern)}catch(err){throw err instanceof Match.Error&&err.path&&(err.message+=" in field "+err.path),err}});check.disabled=void 0,module.exports=check;var Match=check.Match={Optional:function(pattern){return new Optional(pattern)},OneOf:function(){return new OneOf(arguments)},Any:["__any__"],Where:function(condition){return new Where(condition)},ObjectIncluding:function(pattern){return new ObjectIncluding(pattern)},Integer:["__integer__"],IdentifierString:/^[a-z_$][0-9a-z_$]*$/i,ObjectHash:function(pattern){return new ObjectHash(pattern)},Subclass:function(Superclass,matchSuperclassToo){return new Subclass(Superclass,matchSuperclassToo)},Error:TypeError,test:function(value,pattern){try{return checkSubtree(value,pattern),!0}catch(e){if(e instanceof Match.Error)return!1;throw e}}},typeofChecks=[[String,"string"],[Number,"number"],[Boolean,"boolean"],[Function,"function"],[void 0,"undefined"]],_jsKeywords=["do","if","in","for","let","new","try","var","case","else","enum","eval","false","null","this","true","void","with","break","catch","class","const","super","throw","while","yield","delete","export","import","public","return","static","switch","typeof","default","extends","finally","package","private","continue","debugger","function","arguments","interface","protected","implements","instanceof"]},{protojs:122}],105:[function(require,module,exports){"use strict";function Mixin(hostObject,proxyMethods){check(hostObject,Match.Optional(Match.OneOf(Object,Function))),Object.defineProperty(this,"_hostObject",{value:hostObject}),proxyMethods&&this._createProxyMethods(proxyMethods),this.init&&this.init.apply(this,arguments)}function _createProxyMethod(proxyMethodName,mixinMethodName,hostObject){if(hostObject=hostObject||this._hostObject,hostObject[proxyMethodName])throw new Error("method "+proxyMethodName+" already defined in host object");var method=this[mixinMethodName];check(method,Function);var boundMethod=method.bind(this);Object.defineProperty(hostObject,proxyMethodName,{value:boundMethod,enumerable:!1,configurable:!1,writable:!0})}function _createProxyMethods(proxyMethods,hostObject){if(check(proxyMethods,Match.Optional(Match.OneOf([String],Match.ObjectHash(String)))),Array.isArray(proxyMethods))proxyMethods.forEach(function(methodName){_createProxyMethod.call(this,methodName,methodName,hostObject)},this);else for(var proxyMethodName in proxyMethods)if(proxyMethods.hasOwnProperty(proxyMethodName)){var mixinMethodName=proxyMethods[proxyMethodName];_createProxyMethod.call(this,proxyMethodName,mixinMethodName,hostObject)}}function Mixin_setInstanceKey(hostClass,method,instanceKey){check(hostClass,Function),check(instanceKey,Match.IdentifierString);var prop=INSTANCE_PROPERTIES_MAP,instanceKeys=hostClass[prop]=hostClass[prop]||{};if(instanceKeys[method.name])throw new Error("Mixin: instance property for method with name "+method.name+" is already set");instanceKeys[method.name]=instanceKey}function Mixin_addMethod(hostClass,instanceKey,mixinMethodName,hostMethodName){var method=this.prototype[mixinMethodName];check(method,Function);var wrappedMethod=_wrapMixinMethod.call(this,method);Object.defineProperty(hostClass.prototype,hostMethodName,{value:wrappedMethod,enumerable:!1,configurable:!1,writable:!0}),Mixin_setInstanceKey(hostClass,method,instanceKey)}function _wrapMixinMethod(method){return function(){var mixinInstance=_getMixinInstance.call(this,method.name);return method.apply(mixinInstance||this,arguments)}}function _getMixinInstance(methodName){if(this instanceof Mixin)return this;var instanceKeys=this.constructor[INSTANCE_PROPERTIES_MAP],mixinProp=instanceKeys[methodName],mixin=this[mixinProp];return mixin}function Mixin$$useWith(hostClass,instanceKey,mixinMethods){if(check(mixinMethods,Match.Optional(Match.OneOf([String],Match.ObjectHash(String)))),Array.isArray(mixinMethods))mixinMethods.forEach(function(methodName){Mixin_addMethod.call(this,hostClass,instanceKey,methodName,methodName)},this);else for(var hostMethodName in mixinMethods)if(mixinMethods.hasOwnProperty(hostMethodName)){var mixinMethodName=mixinMethods[hostMethodName];Mixin_addMethod.call(this,hostClass,instanceKey,mixinMethodName,hostMethodName)}}var check=(require("protojs"),require("ml-check")),Match=check.Match,INSTANCE_PROPERTIES_MAP="___mixin_instances";module.exports=Mixin,Mixin.prototype._createProxyMethod=_createProxyMethod,Mixin.prototype._createProxyMethods=_createProxyMethods,Mixin.useWith=Mixin$$useWith},{"ml-check":104,protojs:122}],106:[function(require,module,exports){"use strict";function find(self,callback,thisArg){for(var i=0;i<self.length;i++){var item=self[i];if(callback.call(thisArg,item,i,self))return item}}function findIndex(self,callback,thisArg){for(var i=0;i<self.length;i++){var item=self[i];if(callback.call(thisArg,item,i,self))return i}return-1}function appendArray(self,sourceArr){if(!sourceArr.length)return self;Array.isArray(sourceArr)||(sourceArr=Array.prototype.slice.call(sourceArr));var args=[self.length,0].concat(sourceArr);return Array.prototype.splice.apply(self,args),self}function prependArray(self,sourceArr){if(!sourceArr.length)return self;Array.isArray(sourceArr)||(sourceArr=Array.prototype.slice.call(sourceArr));var args=[0,0].concat(sourceArr);return Array.prototype.splice.apply(self,args),self}function toArray(self){return Array.prototype.slice.call(self)}function object(self,values){for(var obj={},valuesIsArray=Array.isArray(values),i=0;i<self.length;i++)obj[self[i]]=valuesIsArray?values[i]:values;return obj}function mapToObject(self,callback,thisArg){for(var obj={},i=0;i<self.length;i++){var value=self[i];obj[value]=callback.call(thisArg,value,i,self)}return obj}function unique(self,callback){var filtered=[];if(callback)for(var i=0;i<self.length;i++){for(var item=self[i],index=-1,j=0;j<filtered.length;j++)if(callback(item,filtered[j])){index=i;break}index==-1&&(filtered[filtered.length]=item)}else for(var i=0;i<self.length;i++){var item=self[i],index=filtered.indexOf(item);index==-1&&(filtered[filtered.length]=item)}return filtered}function deepForEach(self,callback,thisArg){function _deepForEach(arr){for(var i=0;i<arr.length;i++){var item=arr[i];Array.isArray(item)?_deepForEach(item,callback,thisArg):callback.call(thisArg,item,index++,self)}}var index=0;_deepForEach(self)}function spliceItem(self,item){var index=self.indexOf(item);return index>=0&&self.splice(index,1),self}module.exports={find:find,findIndex:findIndex,appendArray:appendArray,prependArray:prependArray,toArray:toArray,object:object,mapToObject:mapToObject,unique:unique,deepForEach:deepForEach,spliceItem:spliceItem};for(var nativeMethods=["join","pop","push","concat","reverse","shift","unshift","slice","splice","sort","filter","forEach","some","every","map","indexOf","lastIndexOf","reduce","reduceRight","find","findIndex"],i=0;i<nativeMethods.length;i++){var name=nativeMethods[i],nativeFunc=Array.prototype[name];nativeFunc&&(module.exports[name]=function(method){return function(){return method.call.apply(method,arguments)}}(nativeFunc))}},{}],107:[function(require,module,exports){"use strict";function makeFunction(self,arg1,arg2,funcBody){for(var name=self,count=arguments.length-1,funcBody=arguments[count],func,code="",i=1;i<count;i++)code+=", "+arguments[i];return code=["func = function ",name,"(",code.slice(2),") {\n",funcBody,"\n}"].join(""),eval(code),func}function partial(self){var args=slice.call(arguments,1),func=function(){return self.apply(this,args.concat(slice.call(arguments)))};return func}function partialRight(self){var args=slice.call(arguments,1),func=function(){return self.apply(this,slice.call(arguments).concat(args))};return func}function memoize(self,hashFunc,limit){var cache={},keysList=[];limit=limit||1e3;var func=function(){var key=hashFunc?hashFunc.apply(this,arguments):arguments[0];if(cache.hasOwnProperty(key))return cache[key];var result=cache[key]=self.apply(this,arguments);return keysList.push(key),keysList.length>limit&&delete cache[keysList.shift()],result};return func}function delay(self,wait){var args=slice.call(arguments,2),id=setTimeout(function(){self.apply(null,args)},wait);return id}function defer(self){var args=slice.call(arguments,1),id=setTimeout(function(){self.apply(null,args)});return id}function delayed(self,wait){var args=slice.call(arguments,2),func=function(){var passArgs=args.concat(slice.call(arguments)),context=this;return setTimeout(function(){self.apply(context,passArgs)},wait)};return func}function deferred(self){var args=slice.call(arguments,1),func=function(){var passArgs=args.concat(slice.call(arguments)),context=this;return setTimeout(function(){self.apply(context,passArgs)})};return func}function deferTicks(self,ticks){var id;if(ticks<2){var args=slice.call(arguments,2);id=setTimeout(function(){self.apply(null,args)})}else{var args=arguments;args[1]=ticks-1,id=setTimeout(function(){deferTicks.apply(null,args)})}return id}function delayMethod(self,funcOrMethodName,wait){var args=slice.call(arguments,3),func="string"==typeof funcOrMethodName?self[funcOrMethodName]:funcOrMethodName,id=setTimeout(function(){func.apply(self,args)},wait);return id}function deferMethod(self,funcOrMethodName){var args=slice.call(arguments,2),func="string"==typeof funcOrMethodName?self[funcOrMethodName]:funcOrMethodName,id=setTimeout(function(){func.apply(self,args)});return id}function debounce(self,wait,immediate){var timeout,args,context,timestamp,result,func=function(){function later(){var last=Date.now()-timestamp;last<wait?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=self.apply(context,args)))}context=this,args=arguments,timestamp=Date.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=self.apply(context,args)),result};return func}function throttle(self,wait,options){function later(){previous=options.leading===!1?0:Date.now(),timeout=null,result=self.apply(context,args)}var context,args,result,timeout=null,previous=0;options||(options={});var func=function(){var now=Date.now();previous||options.leading!==!1||(previous=now);
var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=self.apply(context,args)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result};return func}function once(self){var memo,ran=!1,func=function(){return ran?memo:(ran=!0,memo=self.apply(this,arguments),self=null,memo)};return func}function waitFor(self,callback,maxTimeout,timedOutFunc,checkInterval){function testCondition(){if(self())callback();else{if(!(Date.now()-start>=maxTimeout))return;timedOutFunc&&timedOutFunc()}clearInterval(id)}var start=Date.now();checkInterval=checkInterval||50;var id=setInterval(testCondition,checkInterval);return id}function not(self){var func=function(){return!self.apply(this,arguments)};return func}module.exports={makeFunction:makeFunction,partial:partial,partialRight:partialRight,memoize:memoize,delay:delay,defer:defer,delayed:delayed,deferred:deferred,deferTicks:deferTicks,delayMethod:delayMethod,deferMethod:deferMethod,debounce:debounce,throttle:throttle,once:once,waitFor:waitFor,not:not};var slice=Array.prototype.slice},{}],108:[function(require,module,exports){"use strict";module.exports={array:require("./array"),function:require("./function"),number:require("./number"),object:require("./object"),prototype:require("./prototype"),string:require("./string"),utils:require("./utils")}},{"./array":106,"./function":107,"./number":109,"./object":110,"./prototype":111,"./string":112,"./utils":113}],109:[function(require,module,exports){"use strict";function isNumeric(self){var result=!isNaN(parseFloat(self))&&isFinite(self);return result}module.exports={isNumeric:isNumeric}},{}],110:[function(require,module,exports){"use strict";function extend(self,obj,onlyEnumerable){var key,descriptors={};if(onlyEnumerable)for(key in obj)descriptors[key]=Object.getOwnPropertyDescriptor(obj,key);else for(var keys=Object.getOwnPropertyNames(obj),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(obj,key);return Object.defineProperties(self,descriptors),self}function clone(self,onlyEnumerable){var clonedObject;if(Array.isArray(self)?clonedObject=self.slice():self instanceof Date?clonedObject=new Date(self):self instanceof RegExp&&(clonedObject=new RegExp(self)),!clonedObject){var key,descriptors={};if(onlyEnumerable)for(key in self)descriptors[key]=Object.getOwnPropertyDescriptor(self,key);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(self,key);clonedObject=Object.create(self.constructor.prototype,descriptors)}return clonedObject}function findValue(self,callback,thisArg,onlyEnumerable){var key,result=void 0;if(onlyEnumerable)for(key in self){var item=self[key];if(callback.call(thisArg,item,key,self)){result=item;break}}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++){key=keys[i];var item=self[key];if(callback.call(thisArg,item,key,self)){result=item;break}}return result}function findKey(self,callback,thisArg,onlyEnumerable){var key,result=void 0;if(onlyEnumerable)for(key in self){var item=self[key];if(callback.call(thisArg,item,key,self)){result=key;break}}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++){key=keys[i];var item=self[key];if(callback.call(thisArg,item,key,self)){result=key;break}}return result}function defineProperty(self,propertyName,value,decriptorFlags){var descriptor={value:value};return decriptorFlags&&(descriptor.enumerable=!!(decriptorFlags&constants.ENUMERABLE),descriptor.configurable=!!(decriptorFlags&constants.CONFIGURABLE),descriptor.writable=!!(decriptorFlags&constants.WRITABLE)),Object.defineProperty(self,propertyName,descriptor),self}function defineProperties(self,propertyValues,decriptorFlags){for(var key,descriptors={},keys=Object.getOwnPropertyNames(propertyValues),i=0;i<keys.length;i++){key=keys[i];var value=propertyValues[key],descriptor={value:value};decriptorFlags&&(descriptor.enumerable=!!(decriptorFlags&constants.ENUMERABLE),descriptor.configurable=!!(decriptorFlags&constants.CONFIGURABLE),descriptor.writable=!!(decriptorFlags&constants.WRITABLE)),descriptors[key]=descriptor}return Object.defineProperties(self,descriptors),self}function deepExtend(self,obj,onlyEnumerable,preserveStructure){var result=_extendTree(self,obj,onlyEnumerable,preserveStructure,[]);return result}function _extendTree(selfNode,objNode,onlyEnumerable,preserveStructure,objTraversed){if(objTraversed.indexOf(objNode)>=0)return selfNode;if(objTraversed.push(objNode),Array.isArray(objNode))for(var key=0;key<objNode.length;key++){var value=objNode[key],hasProp=selfNode.hasOwnProperty(key),selfValue=selfNode[key],isSelfObj=!("object"!=typeof selfValue||null==selfValue||selfValue instanceof RegExp||selfValue instanceof Date),isValueObj=!("object"!=typeof value||null==value||value instanceof RegExp||value instanceof Date);if(preserveStructure&&hasProp&&isSelfObj!=isValueObj)throw new Error("deepExtend");if(isValueObj)hasProp&&isSelfObj||(selfNode[key]=Array.isArray(value)?[]:{}),_extendTree(selfNode[key],value,onlyEnumerable,preserveStructure,objTraversed);else{var descriptor=Object.getOwnPropertyDescriptor(objNode,key);Object.defineProperty(selfNode,key,descriptor)}}else{var key;if(onlyEnumerable)for(key in objNode){var value=objNode[key],hasProp=selfNode.hasOwnProperty(key),selfValue=selfNode[key],isSelfObj=!("object"!=typeof selfValue||null==selfValue||selfValue instanceof RegExp||selfValue instanceof Date),isValueObj=!("object"!=typeof value||null==value||value instanceof RegExp||value instanceof Date);if(preserveStructure&&hasProp&&isSelfObj!=isValueObj)throw new Error("deepExtend");if(isValueObj)hasProp&&isSelfObj||(selfNode[key]=Array.isArray(value)?[]:{}),_extendTree(selfNode[key],value,onlyEnumerable,preserveStructure,objTraversed);else{var descriptor=Object.getOwnPropertyDescriptor(objNode,key);Object.defineProperty(selfNode,key,descriptor)}}else for(var keys=Object.getOwnPropertyNames(objNode),i=0;i<keys.length;i++){key=keys[i];var value=objNode[key],hasProp=selfNode.hasOwnProperty(key),selfValue=selfNode[key],isSelfObj=!("object"!=typeof selfValue||null==selfValue||selfValue instanceof RegExp||selfValue instanceof Date),isValueObj=!("object"!=typeof value||null==value||value instanceof RegExp||value instanceof Date);if(preserveStructure&&hasProp&&isSelfObj!=isValueObj)throw new Error("deepExtend");if(isValueObj)hasProp&&isSelfObj||(selfNode[key]=Array.isArray(value)?[]:{}),_extendTree(selfNode[key],value,onlyEnumerable,preserveStructure,objTraversed);else{var descriptor=Object.getOwnPropertyDescriptor(objNode,key);Object.defineProperty(selfNode,key,descriptor)}}}return selfNode}function deepClone(self,onlyEnumerable){var clonedObject;return self instanceof Date?clonedObject=new Date(self):self instanceof RegExp?clonedObject=new RegExp(self):(clonedObject=Array.isArray(self)?[]:{},_extendTree(clonedObject,self,onlyEnumerable,!1,[])),clonedObject}function keys(self){var keys=Object.keys(self);return keys}function allKeys(self){var keys=Object.getOwnPropertyNames(self);return keys}function values(self,onlyEnumerable){var key,arr=[];if(onlyEnumerable)for(key in self)arr[arr.length]=self[key];else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],arr[arr.length]=self[key];return arr}function keyOf(self,searchElement,onlyEnumerable){var foundKey,key;if(onlyEnumerable){for(key in self)if(searchElement===self[key]){foundKey=key;break}}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)if(key=keys[i],searchElement===self[key]){foundKey=key;break}return foundKey}function allKeysOf(self,searchElement,onlyEnumerable){var key,foundKeys=[];if(onlyEnumerable)for(key in self)searchElement===self[key]&&(foundKeys[foundKeys.length]=key);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],searchElement===self[key]&&(foundKeys[foundKeys.length]=key);return foundKeys}function eachKey(self,callback,thisArg,onlyEnumerable){var key;if(onlyEnumerable)for(key in self)callback.call(thisArg,self[key],key,self);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],callback.call(thisArg,self[key],key,self);return self}function mapKeys(self,callback,thisArg,onlyEnumerable){var key,descriptors={};if(onlyEnumerable)for(key in self)descriptors[key]=Object.getOwnPropertyDescriptor(self,key),descriptors[key].value=callback.call(thisArg,self[key],key,self);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(self,key),descriptors[key].value=callback.call(thisArg,self[key],key,self);var obj=Object.create(self.constructor.prototype,descriptors);return obj}function reduceKeys(self,callback,initialValue,thisArg,onlyEnumerable){var key,memo=initialValue;if(onlyEnumerable)for(key in self)memo=callback.call(thisArg,memo,self[key],key,self);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],memo=callback.call(thisArg,memo,self[key],key,self);return memo}function filterKeys(self,callback,thisArg,onlyEnumerable){var key,descriptors={};if(onlyEnumerable)for(key in self)callback.call(thisArg,self[key],key,self)&&(descriptors[key]=Object.getOwnPropertyDescriptor(self,key));else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],callback.call(thisArg,self[key],key,self)&&(descriptors[key]=Object.getOwnPropertyDescriptor(self,key));var obj=Object.create(self.constructor.prototype,descriptors);return obj}function someKey(self,callback,thisArg,onlyEnumerable){var key;if(onlyEnumerable){for(key in self)if(callback.call(thisArg,self[key],key,self))return!0}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)if(key=keys[i],callback.call(thisArg,self[key],key,self))return!0;return!1}function everyKey(self,callback,thisArg,onlyEnumerable){var key;if(onlyEnumerable){for(key in self)if(!callback.call(thisArg,self[key],key,self))return!1}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)if(key=keys[i],!callback.call(thisArg,self[key],key,self))return!1;return!0}function pickKeys(self){for(var keys=concat.apply(Array.prototype,arguments),obj=Object.create(self.constructor.prototype),i=1;i<keys.length;i++){var key=keys[i];self.hasOwnProperty(key)&&(obj[key]=self[key])}return obj}function omitKeys(self){var clonedObject,onlyEnumerable,key,descriptors={};if(onlyEnumerable)for(key in self)descriptors[key]=Object.getOwnPropertyDescriptor(self,key);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(self,key);clonedObject=Object.create(self.constructor.prototype,descriptors);for(var keys=concat.apply(Array.prototype,arguments),i=1;i<keys.length;i++)delete clonedObject[keys[i]];return clonedObject}function isEqual(self,obj){var result;if(self===obj)return result=0!==self||1/self==1/obj;if(null==self||null==obj)return!1;var className=self.constructor.name;if(className!=obj.constructor.name)return!1;switch(className){case"String":result=self==String(obj);break;case"Number":result=self!=+self?obj!=+obj:0==self?1/self==1/obj:self==+obj;break;case"Date":case"Boolean":result=+self==+obj;break;case"RegExp":result=self.source==obj.source&&self.global==obj.global&&self.multiline==obj.multiline&&self.ignoreCase==obj.ignoreCase;break;default:if("object"!=typeof self||"object"!=typeof obj)return!1;if(Array.isArray(self)){if(self.length!=obj.length)return!1;for(var i=0;i<self.length;i++)if(result=isEqual(self[i],obj[i]),!result)return!1;return!0}if(Object.getOwnPropertyNames(self).length!=Object.getOwnPropertyNames(obj).length)return!1;result=!0;for(var key,keys=Object.getOwnPropertyNames(self),i=0;i<keys.length&&(key=keys[i],result=isEqual(self[key],obj[key]),result);i++);return result}return result}function isNot(self,obj){var equal=!isEqual(self,obj);return equal}module.exports={extend:extend,clone:clone,findValue:findValue,findKey:findKey,defineProperty:defineProperty,defineProperties:defineProperties,deepExtend:deepExtend,deepClone:deepClone,keys:keys,allKeys:allKeys,values:values,keyOf:keyOf,allKeysOf:allKeysOf,eachKey:eachKey,mapKeys:mapKeys,reduceKeys:reduceKeys,filterKeys:filterKeys,someKey:someKey,everyKey:everyKey,pickKeys:pickKeys,omitKeys:omitKeys,isEqual:isEqual,isNot:isNot};var concat=Array.prototype.concat,constants=module.exports._constants={ENUMERABLE:1,ENUM:1,CONFIGURABLE:2,CONF:2,WRITABLE:4,WRIT:4}},{}],111:[function(require,module,exports){"use strict";function extendProto(self,methods){for(var key,propDescriptors={},keys=Object.getOwnPropertyNames(methods),i=0;i<keys.length;i++)key=keys[i],propDescriptors[key]={enumerable:!1,configurable:!1,writable:!1,value:methods[key]};return Object.defineProperties(self.prototype,propDescriptors),self}function createSubclass(self,name,applyConstructor){var subclass;name=name||"";var constructorCode=applyConstructor===!1?"":"self.apply(this, arguments);";return eval("subclass = function "+name+"(){ "+constructorCode+" }"),subclass.prototype=Object.create(self.prototype),Object.defineProperty(subclass.prototype,"constructor",{enumerable:!1,configurable:!1,writable:!1,value:subclass}),__.deepExtend(subclass,self,!0),subclass}function makeSubclass(self,Superclass){return self.prototype=Object.create(Superclass.prototype),Object.defineProperty(self.prototype,"constructor",{enumerable:!1,configurable:!1,writable:!1,value:self}),self}function newApply(self,args){Array.isArray(args)||(args=Array.prototype.slice.call(args));var args=[null].concat(args),obj=new(Function.prototype.bind.apply(self,args));return obj}var __=require("../functions/object"),prototypeMethods=module.exports={extendProto:extendProto,createSubclass:createSubclass,makeSubclass:makeSubclass,newApply:newApply}},{"../functions/object":110}],112:[function(require,module,exports){"use strict";function firstUpperCase(self){var str=self?self[0].toUpperCase()+self.slice(1):self;return str}function firstLowerCase(self){var str=self?self[0].toLowerCase()+self.slice(1):self;return str}function toRegExp(self){var rx=self.match(regexpStringPattern);if(rx)var newRx=new RegExp(rx[1],rx[2]);return newRx}function toFunction(self){var func,code="func = "+self+";";try{eval(code)}catch(e){}return func}function toDate(self){if(self){try{var date=new Date(self)}catch(e){}if(date&&date.getTime&&!isNaN(date.getTime()))return date}}function toQueryString(self,encode){for(var key,qs="",params=self||{},encode=encode||encodeURIComponent,keys=Object.getOwnPropertyNames(params),i=0;i<keys.length;i++)key=keys[i],qs+=key+"="+encode(params[key])+"&";var str=qs.slice(0,-1);return str}function fromQueryString(self,decode){for(var pairs=self.split("&"),results={},decode=decode||decodeURIComponent,i=0;i<pairs.length;i++){var pair=pairs[i],splitPair=pair.split("=");if(splitPair.length<2)return;var key=splitPair[0],value=decode(splitPair[1]||"");if(!key)return;results[key]=value}return results}function jsonParse(self){try{var result=JSON.parse(self)}catch(e){}return result}function hashCode(self){for(var hash=5381,str=self,len=str.length,i=0;i<len;i++){var char=str.charCodeAt(i);hash=(hash<<5)+hash+char}return hash}function unPrefix(self,str){if(0==self.indexOf(str))var result=self.replace(str,"");return result}function format(self){var args=slice.call(arguments,1),result=self.replace(formatRegexp,function(item){return"$$"==item?"$":(item=item.slice(1),args[item-1])});return result}var slice=Array.prototype.slice,stringMethods=module.exports={firstUpperCase:firstUpperCase,firstLowerCase:firstLowerCase,toRegExp:toRegExp,toFunction:toFunction,toDate:toDate,toQueryString:toQueryString,fromQueryString:fromQueryString,jsonParse:jsonParse,hashCode:hashCode,unPrefix:unPrefix,format:format},regexpStringPattern=/^\/(.*)\/([gimy]*)$/,formatRegexp=/\$[0-9]+|\$\$/g},{}],113:[function(require,module,exports){"use strict";function times(self,callback,thisArg){for(var arr=Array(Math.max(0,self)),i=0;i<self;i++)arr[i]=callback.call(thisArg,i);return arr}function repeat(self,times){for(var arr=Array(Math.max(0,times)),i=0;i<times;i++)arr[i]=self;return arr}function tap(self,func){return func.call(self,self),self}function result(self,thisArg){var args=slice.call(arguments,2),result="function"==typeof self?self.apply(thisArg,args):self;return result}function identity(self){return self}function property(self){var func=function(obj){return obj[self]};return func}function compareProperty(self){var func=function(a,b){return a[self]<b[self]?-1:a[self]>b[self]?1:0};return func}function noop(){}var slice=Array.prototype.slice;module.exports={times:times,repeat:repeat,tap:tap,result:result,identity:identity,property:property,compareProperty:compareProperty,noop:noop}},{}],114:[function(require,module,exports){"use strict";function find(callback,thisArg){for(var self=this.self,i=0;i<self.length;i++){var item=self[i];if(callback.call(thisArg,item,i,self))return this.self=item,this}return this.self=void 0,this}function findIndex(callback,thisArg){for(var self=this.self,i=0;i<self.length;i++){var item=self[i];if(callback.call(thisArg,item,i,self))return this.self=i,this}return this.self=-1,this}function appendArray(sourceArr){if(!sourceArr.length)return this;Array.isArray(sourceArr)||(sourceArr=Array.prototype.slice.call(sourceArr));var args=[this.self.length,0].concat(sourceArr);return Array.prototype.splice.apply(this.self,args),this}function prependArray(sourceArr){if(!sourceArr.length)return this;Array.isArray(sourceArr)||(sourceArr=Array.prototype.slice.call(sourceArr));var args=[0,0].concat(sourceArr);return Array.prototype.splice.apply(this.self,args),this}function toArray(){return this.self=Array.prototype.slice.call(this.self),this}function object(values){for(var obj={},valuesIsArray=Array.isArray(values),self=this.self,i=0;i<self.length;i++)obj[self[i]]=valuesIsArray?values[i]:values;return this.self=obj,this}function mapToObject(callback,thisArg){for(var obj={},self=this.self,i=0;i<self.length;i++){var value=self[i];obj[value]=callback.call(thisArg,value,i,self)}return this.self=obj,this}function unique(callback){var filtered=[],self=this.self;if(callback)for(var i=0;i<self.length;i++){for(var item=self[i],index=-1,j=0;j<filtered.length;j++)if(callback(item,filtered[j])){index=i;break}index==-1&&(filtered[filtered.length]=item)}else for(var i=0;i<self.length;i++){var item=self[i],index=filtered.indexOf(item);index==-1&&(filtered[filtered.length]=item)}return this.self=filtered,this}function deepForEach(callback,thisArg){function _deepForEach(arr){for(var i=0;i<arr.length;i++){var item=arr[i];Array.isArray(item)?_deepForEach(item,callback,thisArg):callback.call(thisArg,item,index++,self)}}var self=this.self,index=0;_deepForEach(self)}function spliceItem(item){var index=this.self.indexOf(item);return index>=0&&this.self.splice(index,1),this}module.exports={find:find,findIndex:findIndex,appendArray:appendArray,prependArray:prependArray,toArray:toArray,object:object,mapToObject:mapToObject,unique:unique,deepForEach:deepForEach,spliceItem:spliceItem};for(var nativeMethods=["join","pop","push","concat","reverse","shift","unshift","slice","splice","sort","filter","forEach","some","every","map","indexOf","lastIndexOf","reduce","reduceRight","find","findIndex"],i=0;i<nativeMethods.length;i++){var name=nativeMethods[i],nativeFunc=Array.prototype[name];nativeFunc&&(module.exports[name]=function(method){return function(){return this.self=method.apply(this.self,arguments),this}}(nativeFunc))}},{}],115:[function(require,module,exports){"use strict";function makeFunction(arg1,arg2,funcBody){for(var name=this.self,count=arguments.length-1,funcBody=arguments[count],func,code="",i=0;i<count;i++)code+=", "+arguments[i];return code=["func = function ",name,"(",code.slice(2),") {\n",funcBody,"\n}"].join(""),eval(code),this.self=func,this}function partial(){var self=this.self,args=slice.call(arguments),func=function(){return self.apply(this,args.concat(slice.call(arguments)))};return this.self=func,this}function partialRight(){var self=this.self,args=slice.call(arguments),func=function(){return self.apply(this,slice.call(arguments).concat(args))};return this.self=func,this}function memoize(hashFunc,limit){var self=this.self,cache={},keysList=[];limit=limit||1e3;var func=function(){var key=hashFunc?hashFunc.apply(this,arguments):arguments[0];if(cache.hasOwnProperty(key))return cache[key];var result=cache[key]=self.apply(this,arguments);return keysList.push(key),keysList.length>limit&&delete cache[keysList.shift()],result};return this.self=func,this}function delay(wait){var self=this.self,args=slice.call(arguments,1),id=setTimeout(function(){self.apply(null,args)},wait);return this.self=id,this}function defer(){var self=this.self,args=arguments,id=setTimeout(function(){self.apply(null,args)});return this.self=id,this}function delayed(wait){var self=this.self,args=slice.call(arguments,1),func=function(){var passArgs=args.concat(slice.call(arguments)),context=this;return setTimeout(function(){self.apply(context,passArgs)},wait)};return this.self=func,this}function deferred(){var self=this.self,args=arguments,func=function(){var passArgs=args.concat(slice.call(arguments)),context=this;return setTimeout(function(){self.apply(context,passArgs)})};return this.self=func,this}function deferTicks(ticks){var id,self=this.self;if(ticks<2){var args=slice.call(arguments,1);id=setTimeout(function(){self.apply(null,args)})}else{var args=arguments;args[0]=ticks-1,id=setTimeout(function(){deferTicks.apply({self:self},args)})}return this.self=id,this}function delayMethod(funcOrMethodName,wait){var self=this.self,args=slice.call(arguments,2),func="string"==typeof funcOrMethodName?self[funcOrMethodName]:funcOrMethodName,id=setTimeout(function(){func.apply(self,args)},wait);return this.self=id,this}function deferMethod(funcOrMethodName){var self=this.self,args=slice.call(arguments,1),func="string"==typeof funcOrMethodName?self[funcOrMethodName]:funcOrMethodName,id=setTimeout(function(){func.apply(self,args)});return this.self=id,this}function debounce(wait,immediate){var timeout,args,context,timestamp,result,self=this.self,func=function(){function later(){var last=Date.now()-timestamp;last<wait?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=self.apply(context,args)))}context=this,args=arguments,timestamp=Date.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=self.apply(context,args)),result};return this.self=func,this}function throttle(wait,options){function later(){previous=options.leading===!1?0:Date.now(),timeout=null,result=self.apply(context,args)}var context,args,result,self=this.self,timeout=null,previous=0;options||(options={});var func=function(){var now=Date.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=self.apply(context,args)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result};return this.self=func,this}function once(){var memo,self=this.self,ran=!1,func=function(){return ran?memo:(ran=!0,memo=self.apply(this,arguments),self=null,memo)};return this.self=func,this}function waitFor(callback,maxTimeout,timedOutFunc,checkInterval){function testCondition(){if(self())callback();else{if(!(Date.now()-start>=maxTimeout))return;timedOutFunc&&timedOutFunc()}clearInterval(id)}var self=this.self,start=Date.now();checkInterval=checkInterval||50;var id=setInterval(testCondition,checkInterval);return this.self=id,this}function not(){var self=this.self,func=function(){return!self.apply(this,arguments)};return this.self=func,this}module.exports={makeFunction:makeFunction,partial:partial,partialRight:partialRight,memoize:memoize,delay:delay,defer:defer,delayed:delayed,deferred:deferred,deferTicks:deferTicks,delayMethod:delayMethod,deferMethod:deferMethod,debounce:debounce,throttle:throttle,once:once,waitFor:waitFor,not:not};var slice=Array.prototype.slice},{}],116:[function(require,module,exports){arguments[4][108][0].apply(exports,arguments)},{"./array":114,"./function":115,"./number":117,"./object":118,"./prototype":119,"./string":120,"./utils":121,dup:108}],117:[function(require,module,exports){"use strict";function isNumeric(){var result=!isNaN(parseFloat(this.self))&&isFinite(this.self);return this.self=result,this}module.exports={isNumeric:isNumeric}},{}],118:[function(require,module,exports){"use strict";function extend(obj,onlyEnumerable){var key,descriptors={};if(onlyEnumerable)for(key in obj)descriptors[key]=Object.getOwnPropertyDescriptor(obj,key);else for(var keys=Object.getOwnPropertyNames(obj),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(obj,key);return Object.defineProperties(this.self,descriptors),this}function clone(onlyEnumerable){var clonedObject,self=this.self;if(Array.isArray(self)?clonedObject=self.slice():self instanceof Date?clonedObject=new Date(self):self instanceof RegExp&&(clonedObject=new RegExp(self)),!clonedObject){var key,descriptors={};if(onlyEnumerable)for(key in self)descriptors[key]=Object.getOwnPropertyDescriptor(self,key);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(self,key);clonedObject=Object.create(self.constructor.prototype,descriptors)}return this.self=clonedObject,this}function findValue(callback,thisArg,onlyEnumerable){var key,self=this.self,result=void 0;if(onlyEnumerable)for(key in self){var item=self[key];if(callback.call(thisArg,item,key,self)){result=item;break}}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++){key=keys[i];var item=self[key];if(callback.call(thisArg,item,key,self)){result=item;break}}return this.self=result,this}function findKey(callback,thisArg,onlyEnumerable){var key,self=this.self,result=void 0;if(onlyEnumerable)for(key in self){var item=self[key];if(callback.call(thisArg,item,key,self)){result=key;break}}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++){key=keys[i];var item=self[key];if(callback.call(thisArg,item,key,self)){result=key;break}}return this.self=result,this}function defineProperty(propertyName,value,decriptorFlags){var descriptor={value:value};return decriptorFlags&&(descriptor.enumerable=!!(decriptorFlags&constants.ENUMERABLE),descriptor.configurable=!!(decriptorFlags&constants.CONFIGURABLE),descriptor.writable=!!(decriptorFlags&constants.WRITABLE)),Object.defineProperty(this.self,propertyName,descriptor),this}function defineProperties(propertyValues,decriptorFlags){for(var key,self=this.self,descriptors={},keys=Object.getOwnPropertyNames(propertyValues),i=0;i<keys.length;i++){key=keys[i];var value=propertyValues[key],descriptor={value:value};decriptorFlags&&(descriptor.enumerable=!!(decriptorFlags&constants.ENUMERABLE),descriptor.configurable=!!(decriptorFlags&constants.CONFIGURABLE),descriptor.writable=!!(decriptorFlags&constants.WRITABLE)),descriptors[key]=descriptor}return Object.defineProperties(self,descriptors),this.self=self,this}function deepExtend(obj,onlyEnumerable,preserveStructure){var result=_extendTree(this.self,obj,onlyEnumerable,preserveStructure,[]);return this.self=result,this}function _extendTree(selfNode,objNode,onlyEnumerable,preserveStructure,objTraversed){if(objTraversed.indexOf(objNode)>=0)return selfNode;if(objTraversed.push(objNode),Array.isArray(objNode))for(var key=0;key<objNode.length;key++){var value=objNode[key],hasProp=selfNode.hasOwnProperty(key),selfValue=selfNode[key],isSelfObj=!("object"!=typeof selfValue||null==selfValue||selfValue instanceof RegExp||selfValue instanceof Date),isValueObj=!("object"!=typeof value||null==value||value instanceof RegExp||value instanceof Date);if(preserveStructure&&hasProp&&isSelfObj!=isValueObj)throw new Error("deepExtend");if(isValueObj)hasProp&&isSelfObj||(selfNode[key]=Array.isArray(value)?[]:{}),_extendTree(selfNode[key],value,onlyEnumerable,preserveStructure,objTraversed);else{var descriptor=Object.getOwnPropertyDescriptor(objNode,key);Object.defineProperty(selfNode,key,descriptor)}}else{var key;if(onlyEnumerable)for(key in objNode){var value=objNode[key],hasProp=selfNode.hasOwnProperty(key),selfValue=selfNode[key],isSelfObj=!("object"!=typeof selfValue||null==selfValue||selfValue instanceof RegExp||selfValue instanceof Date),isValueObj=!("object"!=typeof value||null==value||value instanceof RegExp||value instanceof Date);if(preserveStructure&&hasProp&&isSelfObj!=isValueObj)throw new Error("deepExtend");if(isValueObj)hasProp&&isSelfObj||(selfNode[key]=Array.isArray(value)?[]:{}),_extendTree(selfNode[key],value,onlyEnumerable,preserveStructure,objTraversed);else{var descriptor=Object.getOwnPropertyDescriptor(objNode,key);Object.defineProperty(selfNode,key,descriptor)}}else for(var keys=Object.getOwnPropertyNames(objNode),i=0;i<keys.length;i++){key=keys[i];var value=objNode[key],hasProp=selfNode.hasOwnProperty(key),selfValue=selfNode[key],isSelfObj=!("object"!=typeof selfValue||null==selfValue||selfValue instanceof RegExp||selfValue instanceof Date),isValueObj=!("object"!=typeof value||null==value||value instanceof RegExp||value instanceof Date);if(preserveStructure&&hasProp&&isSelfObj!=isValueObj)throw new Error("deepExtend");if(isValueObj)hasProp&&isSelfObj||(selfNode[key]=Array.isArray(value)?[]:{}),_extendTree(selfNode[key],value,onlyEnumerable,preserveStructure,objTraversed);else{var descriptor=Object.getOwnPropertyDescriptor(objNode,key);Object.defineProperty(selfNode,key,descriptor)}}}return selfNode}function deepClone(onlyEnumerable){var clonedObject,self=this.self;return self instanceof Date?clonedObject=new Date(self):self instanceof RegExp?clonedObject=new RegExp(self):(clonedObject=Array.isArray(self)?[]:{},_extendTree(clonedObject,self,onlyEnumerable,!1,[])),this.self=clonedObject,this}function keys(){var keys=Object.keys(this.self);return this.self=keys,this}function allKeys(){var keys=Object.getOwnPropertyNames(this.self);return this.self=keys,this}function values(onlyEnumerable){var key,arr=[],self=this.self;if(onlyEnumerable)for(key in self)arr[arr.length]=self[key];else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],arr[arr.length]=self[key];return this.self=arr,this}function keyOf(searchElement,onlyEnumerable){var foundKey,key,self=this.self;if(onlyEnumerable){for(key in self)if(searchElement===self[key]){foundKey=key;break}}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)if(key=keys[i],searchElement===self[key]){foundKey=key;break}return this.self=foundKey,this}function allKeysOf(searchElement,onlyEnumerable){var key,foundKeys=[],self=this.self;if(onlyEnumerable)for(key in self)searchElement===self[key]&&(foundKeys[foundKeys.length]=key);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],searchElement===self[key]&&(foundKeys[foundKeys.length]=key);return this.self=foundKeys,this}function eachKey(callback,thisArg,onlyEnumerable){var key,self=this.self;if(onlyEnumerable)for(key in self)callback.call(thisArg,self[key],key,self);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],callback.call(thisArg,self[key],key,self);return this}function mapKeys(callback,thisArg,onlyEnumerable){var key,self=this.self,descriptors={};if(onlyEnumerable)for(key in self)descriptors[key]=Object.getOwnPropertyDescriptor(self,key),descriptors[key].value=callback.call(thisArg,self[key],key,self);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(self,key),descriptors[key].value=callback.call(thisArg,self[key],key,self);var obj=Object.create(self.constructor.prototype,descriptors);
return this.self=obj,this}function reduceKeys(callback,initialValue,thisArg,onlyEnumerable){var key,memo=initialValue,self=this.self;if(onlyEnumerable)for(key in self)memo=callback.call(thisArg,memo,self[key],key,self);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],memo=callback.call(thisArg,memo,self[key],key,self);return this.self=memo,this}function filterKeys(callback,thisArg,onlyEnumerable){var key,descriptors={},self=this.self;if(onlyEnumerable)for(key in self)callback.call(thisArg,self[key],key,self)&&(descriptors[key]=Object.getOwnPropertyDescriptor(self,key));else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],callback.call(thisArg,self[key],key,self)&&(descriptors[key]=Object.getOwnPropertyDescriptor(self,key));var obj=Object.create(self.constructor.prototype,descriptors);return this.self=obj,this}function someKey(callback,thisArg,onlyEnumerable){var key,self=this.self;if(onlyEnumerable){for(key in self)if(callback.call(thisArg,self[key],key,self))return!0}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)if(key=keys[i],callback.call(thisArg,self[key],key,self))return!0;return this.self=!1,this}function everyKey(callback,thisArg,onlyEnumerable){var key,self=this.self;if(onlyEnumerable){for(key in self)if(!callback.call(thisArg,self[key],key,self))return!1}else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)if(key=keys[i],!callback.call(thisArg,self[key],key,self))return!1;return this.self=!0,this}function pickKeys(){for(var self=this.self,keys=concat.apply(Array.prototype,arguments),obj=Object.create(self.constructor.prototype),i=0;i<keys.length;i++){var key=keys[i];self.hasOwnProperty(key)&&(obj[key]=self[key])}return this.self=obj,this}function omitKeys(){var clonedObject,onlyEnumerable,key,self=this.self,descriptors={};if(onlyEnumerable)for(key in self)descriptors[key]=Object.getOwnPropertyDescriptor(self,key);else for(var keys=Object.getOwnPropertyNames(self),i=0;i<keys.length;i++)key=keys[i],descriptors[key]=Object.getOwnPropertyDescriptor(self,key);clonedObject=Object.create(self.constructor.prototype,descriptors);for(var keys=concat.apply(Array.prototype,arguments),i=0;i<keys.length;i++)delete clonedObject[keys[i]];return this.self=clonedObject,this}function isEqual(obj){var result,self=this.self;if(self===obj)return result=0!==self||1/self==1/obj,this.self=result,this;if(null==self||null==obj)return this.self=!1,this;var className=self.constructor.name;if(className!=obj.constructor.name)return this.self=!1,this;switch(className){case"String":result=self==String(obj);break;case"Number":result=self!=+self?obj!=+obj:0==self?1/self==1/obj:self==+obj;break;case"Date":case"Boolean":result=+self==+obj;break;case"RegExp":result=self.source==obj.source&&self.global==obj.global&&self.multiline==obj.multiline&&self.ignoreCase==obj.ignoreCase;break;default:if("object"!=typeof self||"object"!=typeof obj)return this.self=!1,this;if(Array.isArray(self)){if(self.length!=obj.length)return this.self=!1,this;for(var i=0;i<self.length;i++)if(result=isEqual.call({self:self[i]},obj[i]).self,!result)return this.self=!1,this;return this.self=!0,this}if(Object.getOwnPropertyNames(self).length!=Object.getOwnPropertyNames(obj).length)return this.self=!1,this;result=!0;for(var key,keys=Object.getOwnPropertyNames(self),i=0;i<keys.length&&(key=keys[i],result=isEqual.call({self:self[key]},obj[key]).self,result);i++);return this.self=result,this}return this.self=result,this}function isNot(obj){var equal=!isEqual.call({self:this.self},obj).self;return this.self=equal,this}module.exports={extend:extend,clone:clone,findValue:findValue,findKey:findKey,defineProperty:defineProperty,defineProperties:defineProperties,deepExtend:deepExtend,deepClone:deepClone,keys:keys,allKeys:allKeys,values:values,keyOf:keyOf,allKeysOf:allKeysOf,eachKey:eachKey,mapKeys:mapKeys,reduceKeys:reduceKeys,filterKeys:filterKeys,someKey:someKey,everyKey:everyKey,pickKeys:pickKeys,omitKeys:omitKeys,isEqual:isEqual,isNot:isNot};var concat=Array.prototype.concat,constants=module.exports._constants={ENUMERABLE:1,ENUM:1,CONFIGURABLE:2,CONF:2,WRITABLE:4,WRIT:4}},{}],119:[function(require,module,exports){"use strict";function extendProto(methods){for(var key,self=this.self,propDescriptors={},keys=Object.getOwnPropertyNames(methods),i=0;i<keys.length;i++)key=keys[i],propDescriptors[key]={enumerable:!1,configurable:!1,writable:!1,value:methods[key]};return Object.defineProperties(self.prototype,propDescriptors),this.self=self,this}function createSubclass(name,applyConstructor){var self=this.self,subclass;name=name||"";var constructorCode=applyConstructor===!1?"":"self.apply(this, arguments);";return eval("subclass = function "+name+"(){ "+constructorCode+" }"),subclass.prototype=Object.create(self.prototype),Object.defineProperty(subclass.prototype,"constructor",{enumerable:!1,configurable:!1,writable:!1,value:subclass}),__.deepExtend(subclass,self,!0),this.self=subclass,this}function makeSubclass(Superclass){var self=this.self;return self.prototype=Object.create(Superclass.prototype),Object.defineProperty(self.prototype,"constructor",{enumerable:!1,configurable:!1,writable:!1,value:self}),this.self=self,this}function newApply(args){var self=this.self;Array.isArray(args)||(args=Array.prototype.slice.call(args));var args=[null].concat(args),obj=new(Function.prototype.bind.apply(self,args));return this.self=obj,this}var __=require("../functions/object"),prototypeMethods=module.exports={extendProto:extendProto,createSubclass:createSubclass,makeSubclass:makeSubclass,newApply:newApply}},{"../functions/object":110}],120:[function(require,module,exports){"use strict";function firstUpperCase(){var self=this.self,str=self?self[0].toUpperCase()+self.slice(1):self;return this.self=str,this}function firstLowerCase(){var self=this.self,str=self?self[0].toLowerCase()+self.slice(1):self;return this.self=str,this}function toRegExp(){var self=this.self,rx=self.match(regexpStringPattern);if(rx)var newRx=new RegExp(rx[1],rx[2]);return this.self=newRx,this}function toFunction(){var self=this.self,func,code="func = "+self+";";try{eval(code)}catch(e){}return this.self=func,this}function toDate(){var self=this.self;if(self){try{var date=new Date(self)}catch(e){}if(date&&date.getTime&&!isNaN(date.getTime()))return this.self=date,this}return this.self=void 0,this}function toQueryString(encode){for(var key,self=this.self,qs="",params=self||{},encode=encode||encodeURIComponent,keys=Object.getOwnPropertyNames(params),i=0;i<keys.length;i++)key=keys[i],qs+=key+"="+encode(params[key])+"&";var str=qs.slice(0,-1);return this.self=str,this}function fromQueryString(decode){for(var self=this.self,pairs=self.split("&"),results={},decode=decode||decodeURIComponent,i=0;i<pairs.length;i++){var pair=pairs[i],splitPair=pair.split("=");if(splitPair.length<2)return;var key=splitPair[0],value=decode(splitPair[1]||"");if(!key)return;results[key]=value}return this.self=results,this}function jsonParse(){var self=this.self;try{var result=JSON.parse(self)}catch(e){}return this.self=result,this}function hashCode(){for(var self=this.self,hash=5381,str=self,len=str.length,i=0;i<len;i++){var char=str.charCodeAt(i);hash=(hash<<5)+hash+char}return this.self=hash,this}function unPrefix(str){var self=this.self;if(0==self.indexOf(str))var result=self.replace(str,"");return this.self=result,this}function format(){var self=this.self,args=arguments,result=self.replace(formatRegexp,function(item){return"$$"==item?"$":(item=item.slice(1),args[item-1])});return this.self=result,this}var slice=Array.prototype.slice,stringMethods=module.exports={firstUpperCase:firstUpperCase,firstLowerCase:firstLowerCase,toRegExp:toRegExp,toFunction:toFunction,toDate:toDate,toQueryString:toQueryString,fromQueryString:fromQueryString,jsonParse:jsonParse,hashCode:hashCode,unPrefix:unPrefix,format:format},regexpStringPattern=/^\/(.*)\/([gimy]*)$/,formatRegexp=/\$[0-9]+|\$\$/g},{}],121:[function(require,module,exports){"use strict";function times(callback,thisArg){for(var self=this.self,arr=Array(Math.max(0,self)),i=0;i<self;i++)arr[i]=callback.call(thisArg,i);return this.self=arr,this}function repeat(times){for(var self=this.self,arr=Array(Math.max(0,times)),i=0;i<times;i++)arr[i]=self;return this.self=arr,this}function tap(func){var self=this.self;return func.call(self,self),this.self=self,this}function result(thisArg){var args=slice.call(arguments,1),result="function"==typeof self?self.apply(thisArg,args):self;return this.self=result,this}function identity(){var self=this.self;return this.self=self,this}function property(){var self=this.self,func=function(obj){return obj[self]};return this.self=func,this}function compareProperty(){var self=this.self,func=function(a,b){return a[self]<b[self]?-1:a[self]>b[self]?1:0};return this.self=func,this}function noop(){return this.self=void 0,this}var slice=Array.prototype.slice;module.exports={times:times,repeat:repeat,tap:tap,result:result,identity:identity,property:property,compareProperty:compareProperty,noop:noop}},{}],122:[function(require,module,exports){"use strict";function Proto(self){var wrapped=Object.create(Proto.prototype);return wrapped.self=self,wrapped}var funcs=require("./dotjs/functions"),methods=require("./dotjs/methods");for(var lib in funcs){var name,libFuncs=funcs[lib],libMethods=methods[lib];for(name in libFuncs)Proto[name]=libFuncs[name],Proto.prototype[name]=libMethods[name];if("object"==lib)for(name in libFuncs._constants)Proto[name]=libFuncs._constants[name]}Proto.prototype._=function(){return this.self},"object"==typeof window&&(window._&&(Proto.underscore=window._),window._=Proto),"object"==typeof module&&module.exports&&(module.exports=Proto)},{"./dotjs/functions":108,"./dotjs/methods":116}],123:[function(require,module,exports){"use strict";function QueryStringParser(){this.containsSparse=!1,this.cacheKey="",this.cacheVal=null}var QueryStringSerializer=require("./querystringserializer.js");module.exports=QueryStringParser;var rplus=/\+/g,rint=/^[0-9]+$/,isArray=Array.isArray,haveProp={}.hasOwnProperty;QueryStringParser.maxLength=32768,QueryStringParser.maxDepth=4,QueryStringParser.maxKeys=256,QueryStringParser.parse=function(str){if("string"==typeof str){var maxLength=QueryStringParser.maxLength;if(str.length>maxLength)throw new RangeError("str is too large (QueryStringParser.maxLength="+maxLength+")");var parser=new QueryStringParser;return parser.parseString(str,!1)}if(null!==str&&"object"==typeof str){var parser=new QueryStringParser;return parser.parseObject(str)}return{}},QueryStringParser.stringify=function(value){var serializer=new QueryStringSerializer;return serializer.serialize(value)},QueryStringParser.prototype.decode=function(str,shouldDecode,containsPlus){if(shouldDecode===!1)return str;containsPlus===!0&&(str=str.replace(rplus," "));try{return decodeURIComponent(str)}catch(e){return str}},QueryStringParser.prototype.maybeArrayIndex=function(str,arrayLength){var len=str.length;if(0===len)return arrayLength;var ch=str.charCodeAt(0);if(48===ch)return len>1?-1:0;if(48<=ch&&ch<=57){if(1===len)return ch-48;if(rint.test(str)){var v=parseInt(str,10);if(0<v&&v<=1073741822)return v}}return-1},QueryStringParser.prototype.getSlot=function(dictionary,prevKey,curKey){var slot;if(haveProp.call(dictionary,prevKey))slot=dictionary[prevKey];else{var index=this.maybeArrayIndex(curKey,0);slot=index>-1?[]:{},dictionary[prevKey]=slot}return slot},QueryStringParser.prototype.placeNestedValue=function(dictionary,key,value,i,prevKey,curKey){var slot=this.getSlot(dictionary,prevKey,curKey),index=-1;isArray(slot)&&(index=this.maybeArrayIndex(curKey,slot.length));for(var len=key.length,depth=2,maxDepth=QueryStringParser.maxDepth,start=-1;i<len;++i){var ch=key.charCodeAt(i);if(91===ch)start=i+1;else if(93===ch&&start>-1){if(prevKey=curKey,curKey=start===i?"":key.substring(start,i),start=-1,depth++,depth>maxDepth)throw new RangeError("Nesting depth of keys is too large (QueryStringParser.maxDepth="+maxDepth+")");slot=this.getSlot(slot,prevKey,curKey),index=isArray(slot)?this.maybeArrayIndex(curKey,slot.length):-1}}index>-1?""!==value&&(index===slot.length?slot.push(value):(this.containsSparse=!0,slot[index]=value)):this.insert(slot,curKey,value)},QueryStringParser.prototype.insert=function(dictionary,key,value){var ret=null;if(haveProp.call(dictionary,key)){var prev=dictionary[key];isArray(prev)?(prev.push(value),ret=prev):(ret=[prev,value],dictionary[key]=ret)}else dictionary[key]=value;return ret},QueryStringParser.prototype.push=function(dictionary,key,value){var ret=null;if(haveProp.call(dictionary,key)){var prev=dictionary[key];prev.push(value),ret=prev}else ret=[value],dictionary[key]=ret;return ret},QueryStringParser.prototype.maybePlaceNestedValue=function(dictionary,key,value){var len=key.length;if(93!==key.charCodeAt(len-1))return void this.placeValue(dictionary,key,value,!1);for(var curKey,prevKey,start=-1,i=0;i<len;++i){var ch=key.charCodeAt(i);if(91===ch)start=i+1,prevKey=key.slice(0,i);else if(93===ch){if(start<0)return void this.placeValue(dictionary,key,value,!1);curKey=start===i?"":key.slice(start,i),i++;break}}return void 0===curKey?void this.placeValue(dictionary,key,value,!1):void(""===curKey&&""!==value&&i===len?key===this.cacheKey?this.cacheVal.push(value):(this.cacheKey=key,this.cacheVal=this.push(dictionary,prevKey,value)):this.placeNestedValue(dictionary,key,value,i,prevKey,curKey))},QueryStringParser.prototype.placeValue=function(dictionary,key,value,possiblyNested){if(possiblyNested===!0)return void this.maybePlaceNestedValue(dictionary,key,value);if(key===this.cacheKey)return void this.cacheVal.push(value);var cache=this.insert(dictionary,key,value);null!==cache&&(this.cacheKey=key,this.cacheVal=cache)},QueryStringParser.prototype.compact=function(obj){if(isArray(obj)){for(var ret=[],keys=Object.keys(obj),i=0,len=keys.length;i<len;++i)ret.push(obj[keys[i]]);return ret}if("object"!=typeof obj)return obj;for(var keys=Object.keys(obj),i=0,len=keys.length;i<len;++i){var key=keys[i];obj[key]=this.compact(obj[key])}},QueryStringParser.prototype.parseObject=function(obj){var keys=Object.keys(obj),len=keys.length;if(0===len)return{};len--;for(var key,ret="",i=0;i<len;++i)key=keys[i],ret+=key+"="+obj[key]+"&";return key=keys[i],ret+=key+"="+obj[key],this.parseString(ret,!0)},QueryStringParser.prototype.parseString=function(str,noDecode){for(var maxKeys=QueryStringParser.maxKeys,keys=0,decodeKey=!1,decodeValue=!1,possiblyNested=!1,len=str.length,i=0,dictionary={},keyStart=0,keyEnd=0,valueStart=0,valueEnd=0,left=0,lastIndex=len-1,containsPlus=!1;i<len;++i){var ch=str.charCodeAt(i);if(91===ch)left++;else if(left>0&&93===ch)possiblyNested=!0,left--;else if(0===left&&61===ch){var j=i+1;keyEnd=i-1,valueEnd=valueStart=j;var key=str.slice(keyStart,keyEnd+1);for(key=this.decode(key,decodeKey,containsPlus),decodeKey=!1;j<len;++j)if(ch=str.charCodeAt(j),43!==ch&&37!==ch||noDecode||(43===ch&&(containsPlus=!0),decodeValue=!0),38===ch||j===lastIndex){valueEnd=j,i=j,38===ch&&valueEnd--;var value=str.slice(valueStart,valueEnd+1);if(value=this.decode(value,decodeValue,containsPlus),this.placeValue(dictionary,key,value,possiblyNested),containsPlus=decodeValue=!1,possiblyNested=!1,keyStart=j+1,keys++,keys>maxKeys)throw new RangeError("Amount of keys is too large (QueryStringParser.maxKeys="+maxKeys+")");break}}else 43!==ch&&37!==ch||noDecode||(43===ch&&(containsPlus=!0),decodeKey=!0)}if(keyStart!==len){var value="",key=str.slice(keyStart,len);key=this.decode(key,decodeKey,containsPlus),this.placeValue(dictionary,key,value,possiblyNested)}return this.containsSparse&&this.compact(dictionary),dictionary}},{"./querystringserializer.js":124}],124:[function(require,module,exports){"use strict";function isObject(obj){if(isArray(obj))return!0;if(null===obj||"object"!=typeof obj)return!1;var proto=getProto(obj);return proto===oProto||null===proto}function QueryStringSerializer(){}module.exports=QueryStringSerializer;var enc=encodeURIComponent,ARRAY=[],isArray=Array.isArray,getProto=Object.getPrototypeOf,oProto=getProto({});QueryStringSerializer.prototype.serialize=function(obj){if(null===obj||"object"!=typeof obj)throw new TypeError("the obj to stringify must be an object");for(var keys=Object.keys(obj),len=keys.length,array=ARRAY,stack=[],ret=[],cur=obj,keyPrefix="",i=0;i<len;++i){var key=keys===array?i:keys[i],value=cur[key];if(isObject(value))stack.push(keyPrefix,cur,keys,len,i),keyPrefix=""===keyPrefix?key:keyPrefix+"["+enc(key)+"]",isArray(value)?(keys=array,len=value.length):(keys=Object.keys(value),len=keys.length),i=-1,cur=value;else{"string"!=typeof value&&(value=""+value);var serializedKey=""===keyPrefix?enc(key):keyPrefix+"["+enc(key)+"]";ret.push(serializedKey+"="+enc(value))}i===len-1&&stack.length>0&&(i=stack.pop(),len=stack.pop(),keys=stack.pop(),cur=stack.pop(),keyPrefix=stack.pop())}return ret.join("&")}},{}],125:[function(require,module,exports){module.exports={name:"milojs",version:"1.6.0",description:"Browser/nodejs reactive programming and data driven DOM manipulation with modular components.",keywords:["framework","reactive","reactive programming","binding","data binding","mvc","model","view","controller","component","messenger","one-page app"],main:"lib/milo.js",scripts:{test:"./node_modules/.bin/mocha --recursive --reporter=spec","test-cov":"istanbul cover -x 'test' --dir ./coverage/node node_modules/mocha/bin/_mocha -- --recursive --reporter=spec","test-browser":"grunt karma && karma start --single-run --browsers Chrome","test-travis":"npm run test-cov && grunt build && karma start --single-run --browsers Firefox && istanbul report"},repository:{type:"git",url:"git://github.com/milojs/milo.git"},author:"MailOnline",license:"BSD",bugs:{url:"https://github.com/milojs/milo/issues"},dependencies:{"milo-core":"^1.0.6",querystringparser:"^0.1.1"},devDependencies:{async:"^2.1.2",brfs:"^1.4.3",browserify:"^13.1.1",eslintify:"^3.1.0",grunt:"^1.0.1","grunt-browserify":"^5.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^2.0.0","grunt-contrib-watch":"^1.0.0","grunt-exorcise":"^2.1.1","grunt-istanbul":"^0.7.1","grunt-karma":"^2.0.0","grunt-mocha-test":"^0.13.2",istanbul:"^0.4.5",karma:"^1.3.0","karma-chrome-launcher":"^2.0.0","karma-coverage":"^1.1.1","karma-firefox-launcher":"^1.0.0","karma-mocha":"^1.2.0","karma-spec-reporter":"0.0.26","karma-webdriver-launcher":"^1.0.4",mocha:"^3.1.2"}}},{}]},{},[45]);
//# sourceMappingURL=milo.min.js.map