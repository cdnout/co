/*!
  * vuefire v2.2.5
  * (c) 2020 Eduardo San Martin Morote
  * @license MIT
  */
/*!
  * vuefire v2.2.5
  * (c) 2020 Eduardo San Martin Morote
  * @license MIT
  */
function e(e,n){return n.split(".").reduce((function(e,n){return e[n]}),e)}function n(e,n,t){var r=(""+n).split("."),i=r.pop(),o=r.reduce((function(e,n){return e[n]}),e);return Array.isArray(o)?o.splice(Number(i),1,t):o[i]=t}function t(e){return e&&"object"==typeof e}function r(e){return e&&e.onSnapshot}function i(e,n){for(var t=0;t<e.length;t++)if(e[t][".key"]===n)return t;return-1}var o={reset:!0,serialize:function(e){var n=e.val(),r=t(n)?n:Object.defineProperty({},".value",{value:n});return Object.defineProperty(r,".key",{value:e.key}),r},wait:!1};function s(e,n,i){var o=[{},{}],s=Object.keys(i).reduce((function(e,n){var t=i[n];return e[t.path]=t.data(),e}),{});return function e(n,i,o,a){i=i||{};var f=a[0],c=a[1];for(var u in Object.getOwnPropertyNames(n).forEach((function(e){var t=Object.getOwnPropertyDescriptor(n,e);t&&!t.enumerable&&Object.defineProperty(f,e,t)})),n){var l=n[u];if(null==l||l instanceof Date||l.toDate||l.longitude&&l.latitude)f[u]=l;else if(r(l))f[u]="object"==typeof i&&u in i&&"string"!=typeof i[u]?i[u]:l.path,c[o+u]=l;else if(Array.isArray(l)){f[u]=Array(l.length);for(var d=0;d<l.length;d++){var v=l[d];v&&v.path in s&&(f[u][d]=s[v.path])}e(l,i[u]||f[u],o+u+".",[f[u],c])}else t(l)?(f[u]={},e(l,i[u],o+u+".",[f[u],c])):f[u]=l}}(e,n,"",o),o}var a={maxRefDepth:2,reset:!0,serialize:function(e){return Object.defineProperty(e.data()||{},"id",{value:e.id})},wait:!1};function f(e){for(var n in e)e[n].unsub()}function c(n,t,r,i,o,a,f,c){var u=s(n.serialize(i),e(t,r),o),d=u[0],v=u[1];a.set(t,r,d),l(n,t,r,o,v,a,f,c)}function u(e,n){var t=e.ref,r=e.target,i=e.path,o=e.depth,s=e.resolve,a=e.ops,u=Object.create(null),l=t.onSnapshot((function(e){e.exists?c(n,r,i,e,u,a,o,s):(a.set(r,i,null),s())}));return function(){l(),f(u)}}function l(n,t,r,i,o,s,a,f){var c=Object.keys(o);if(Object.keys(i).filter((function(e){return c.indexOf(e)<0})).forEach((function(e){i[e].unsub(),delete i[e]})),!c.length||++a>n.maxRefDepth)return f(r);var l=0,d=c.length,v=Object.create(null);function b(e){e in v&&++l>=d&&f(r)}c.forEach((function(f){var c=i[f],l=o[f],d=r+"."+f;if(v[d]=!0,c){if(c.path===l.path)return;c.unsub()}i[f]={data:function(){return e(t,d)},unsub:u({ref:l,target:t,path:d,depth:a,ops:s,resolve:b.bind(null,d)},n),path:l.path}}))}var d={set:function(e,t,r){return n(e,t,r)},add:function(e,n,t){return e.splice(n,0,t)},remove:function(e,n){return e.splice(n,1)}};function v(e,n,t,r){return new Promise((function(s,a){var f;f=Array.isArray(e[n])?function(e,n){var t=e.vm,r=e.key,s=e.collection,a=e.resolve,f=e.reject,c=e.ops;void 0===n&&(n=o);var u=Object.assign({},o,n),l=u.wait?[]:c.set(t,r,[]),d=s.on("child_added",(function(e,n){var t=n?i(l,n)+1:0;c.add(l,t,u.serialize(e))}),f),v=s.on("child_removed",(function(e){c.remove(l,i(l,e.key))}),f),b=s.on("child_changed",(function(e){c.set(l,i(l,e.key),u.serialize(e))}),f),h=s.on("child_moved",(function(e,n){var t=i(l,e.key),r=c.remove(l,t)[0],o=n?i(l,n)+1:0;c.add(l,o,r)}),f);return s.once("value",(function(e){u.wait&&c.set(t,r,l),a(e)})),function(e){if(s.off("child_added",d),s.off("child_changed",b),s.off("child_removed",v),s.off("child_moved",h),!1!==e){var n="function"==typeof e?e():[];c.set(t,r,n)}}}({vm:e,key:n,collection:t,resolve:s,reject:a,ops:d},r):function(e,n){var t=e.vm,r=e.key,i=e.document,s=e.resolve,a=e.reject,f=e.ops;void 0===n&&(n=o);var c=Object.assign({},o,n),u=i.on("value",(function(e){f.set(t,r,c.serialize(e))}),a);return i.once("value",s),function(e){if(i.off("value",u),!1!==e){var n="function"==typeof e?e():null;f.set(t,r,n)}}}({vm:e,key:n,document:t,resolve:s,reject:a,ops:d},r),e._firebaseUnbinds[n]=f}))}var b={bindName:"$rtdbBind",unbindName:"$rtdbUnbind",serialize:o.serialize,reset:o.reset,wait:o.wait},h=function(e,n){void 0===n&&(n=b);var t=e.config.optionMergeStrategies;t.firebase=t.provide;var r=Object.assign({},b,n),i=r.bindName,o=r.unbindName;e.prototype[o]=function(e,n){!function(e,n,t){e._firebaseUnbinds[n](t),delete e._firebaseSources[n],delete e._firebaseUnbinds[n]}(this,e,n)},e.prototype[i]=function(e,n,t){var i=Object.assign({},r,t);this._firebaseUnbinds[e]&&this[o](e,i.wait?"function"==typeof i.reset&&i.reset:i.reset);var s=v(this,e,n,i);return this._firebaseSources[e]=n,this.$firebaseRefs[e]=n.ref,s},e.mixin({beforeCreate:function(){this.$firebaseRefs=Object.create(null),this._firebaseSources=Object.create(null),this._firebaseUnbinds=Object.create(null)},created:function(){var e=this.$options.firebase;if("function"==typeof e&&(e=e.call(this)),e)for(var n in e)this[i](n,e[n],r)},beforeDestroy:function(){for(var e in this._firebaseUnbinds)this._firebaseUnbinds[e]();this._firebaseSources=null,this._firebaseUnbinds=null,this.$firebaseRefs=null}})},p={set:function(e,t,r){return n(e,t,r)},add:function(e,n,t){return e.splice(n,0,t)},remove:function(e,n){return e.splice(n,1)}};function y(n,t,r,i,o){return new Promise((function(u,d){var v;v="where"in r?function(e,n){var t=e.vm,r=e.key,i=e.collection,o=e.ops,c=e.resolve,u=e.reject;void 0===n&&(n=a);var d,v=Object.assign({},a,n),b=v.wait?[]:o.set(t,r,[]),h=c,p=[],y={added:function(e){var n=e.newIndex,t=e.doc;p.splice(n,0,Object.create(null));var r=p[n],i=s(v.serialize(t),void 0,r),a=i[0],f=i[1];o.add(b,n,a),l(v,b,n,r,f,o,0,c.bind(null,t))},modified:function(e){var n=e.oldIndex,t=e.newIndex,r=e.doc,i=p[n],a=b[n],f=s(v.serialize(r),a,i),u=f[0],d=f[1];p.splice(t,0,i),o.remove(b,n),o.add(b,t,u),l(v,b,t,i,d,o,0,c)},removed:function(e){var n=e.oldIndex;o.remove(b,n),f(p.splice(n,1)[0])}},m=i.onSnapshot((function(e){var n="function"==typeof e.docChanges?e.docChanges():e.docChanges;if(!d&&n.length){d=!0;for(var i=0,s=n.length,a=Object.create(null),f=0;f<s;f++)a[n[f].doc.id]=!0;c=function(e){e.id in a&&++i>=s&&(v.wait&&o.set(t,r,b),h(t[r]),c=function(){})}}n.forEach((function(e){y[e.type](e)})),n.length||(v.wait&&o.set(t,r,b),c(b))}),u);return function(e){if(m(),!1!==e){var n="function"==typeof e?e():[];o.set(t,r,n)}p.forEach(f)}}({vm:n,key:t,ops:i,collection:r,resolve:u,reject:d},o):function(n,t){var r=n.vm,i=n.key,o=n.document,s=n.resolve,u=n.reject,l=n.ops;void 0===t&&(t=a);var d,v,b,h=Object.assign({},a,t),p=Object.create(null);d=s,v=function(){return e(r,i)},b=!1,s=function(){if(!b)return b=!0,d(v())};var y=o.onSnapshot((function(e){e.exists?c(h,r,i,e,p,l,0,s):(l.set(r,i,null),s(null))}),u);return function(e){if(y(),!1!==e){var n="function"==typeof e?e():null;l.set(r,i,n)}f(p)}}({vm:n,key:t,ops:i,document:r,resolve:u,reject:d},o),n._firestoreUnbinds[t]=v}))}var m={bindName:"$bind",unbindName:"$unbind",serialize:a.serialize,reset:a.reset,wait:a.wait},j=function(e,n){void 0===n&&(n=m);var t=e.config.optionMergeStrategies;t.firestore=t.provide;var r=Object.assign({},m,n),i=r.bindName,o=r.unbindName;e.prototype[o]=function(e,n){this._firestoreUnbinds[e](n),delete this._firestoreUnbinds[e],delete this.$firestoreRefs[e]},e.prototype[i]=function(e,n,t){var i=Object.assign({},r,t);this._firestoreUnbinds[e]&&this[o](e,i.wait?"function"==typeof i.reset&&i.reset:i.reset);var s=y(this,e,n,p,i);return this.$firestoreRefs[e]=n,s},e.mixin({beforeCreate:function(){this._firestoreUnbinds=Object.create(null),this.$firestoreRefs=Object.create(null)},created:function(){var e=this.$options.firestore,n="function"==typeof e?e.call(this):e;if(n)for(var t in n)this[i](t,n[t],r)},beforeDestroy:function(){for(var e in this._firestoreUnbinds)this._firestoreUnbinds[e]();this._firestoreUnbinds=null,this.$firestoreRefs=null}})};export{j as firestorePlugin,h as rtdbPlugin};
