!function(t){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-scale","./load-image-meta"],t):"object"==typeof module&&module.exports?t(require("./load-image"),require("./load-image-scale"),require("./load-image-meta")):t(window.loadImage)}(function(f){"use strict";var e,a,r=f.transform,A=f.requiresCanvas,o=f.requiresMetaData,l=f.transformCoordinates,Q=f.getTransformedOptions;function i(t,e){var a=t&&t.orientation;return!0===a&&!f.orientation||1===a&&f.orientation||(!e||f.orientation)&&1<a&&a<9}function m(t,e){return t!==e&&(1===t&&1<e&&e<9||1<t&&t<9)}function b(t,e){if(1<e&&e<9)switch(t){case 2:case 4:return 4<e;case 5:case 7:return e%2==0;case 6:case 8:return 2===e||4===e||5===e||7===e}}(e=f).global.document&&((a=document.createElement("img")).onload=function(){var t;e.orientation=2===a.width&&3===a.height,e.orientation&&((t=e.createCanvas(1,1,!0).getContext("2d")).drawImage(a,1,1,1,1,0,0,1,1),e.orientationCropBug="255,255,255,255"!==t.getImageData(0,0,1,1).data.toString())},a.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k="),f.requiresCanvas=function(t){return i(t)||A.call(f,t)},f.requiresMetaData=function(t){return i(t,!0)||o.call(f,t)},f.transform=function(t,e,o,a,A){r.call(f,t,e,function(t,e){var a,A,r;!e||4<(a=f.orientation&&e.exif&&e.exif.get("Orientation"))&&a<9&&(A=e.originalWidth,r=e.originalHeight,e.originalWidth=r,e.originalHeight=A),o(t,e)},a,A)},f.getTransformedOptions=function(t,e,a){var A=Q.call(f,t,e),r=a.exif&&a.exif.get("Orientation"),o=A.orientation,i=f.orientation&&r;if(!0===o&&(o=r),!m(o,i))return A;var n,s,c=A.top,l=A.right,E=A.bottom,h=A.left,g={};for(var B in A)Object.prototype.hasOwnProperty.call(A,B)&&(g[B]=A[B]);if((4<(g.orientation=o)&&!(4<i)||o<5&&4<i)&&(g.maxWidth=A.maxHeight,g.maxHeight=A.maxWidth,g.minWidth=A.minHeight,g.minHeight=A.minWidth,g.sourceWidth=A.sourceHeight,g.sourceHeight=A.sourceWidth),1<i){switch(i){case 2:l=A.left,h=A.right;break;case 3:c=A.bottom,l=A.left,E=A.top,h=A.right;break;case 4:c=A.bottom,E=A.top;break;case 5:c=A.left,l=A.bottom,E=A.right,h=A.top;break;case 6:c=A.left,l=A.top,E=A.right,h=A.bottom;break;case 7:c=A.right,l=A.top,E=A.left,h=A.bottom;break;case 8:c=A.right,l=A.bottom,E=A.left,h=A.top}b(o,i)&&(n=c,s=l,c=E,l=h,E=n,h=s)}switch(g.top=c,g.right=l,g.bottom=E,g.left=h,o){case 2:g.right=h,g.left=l;break;case 3:g.top=E,g.right=h,g.bottom=c,g.left=l;break;case 4:g.top=E,g.bottom=c;break;case 5:g.top=h,g.right=E,g.bottom=l,g.left=c;break;case 6:g.top=l,g.right=E,g.bottom=h,g.left=c;break;case 7:g.top=l,g.right=c,g.bottom=h,g.left=E;break;case 8:g.top=h,g.right=c,g.bottom=l,g.left=E}return g},f.transformCoordinates=function(t,e,a){l.call(f,t,e,a);var A=e.orientation,r=f.orientation&&a.exif&&a.exif.get("Orientation");if(m(A,r)){var o=t.getContext("2d"),i=t.width,n=t.height,s=i,c=n;switch((4<A&&!(4<r)||A<5&&4<r)&&(t.width=n,t.height=i),4<A&&(s=n,c=i),r){case 2:o.translate(s,0),o.scale(-1,1);break;case 3:o.translate(s,c),o.rotate(Math.PI);break;case 4:o.translate(0,c),o.scale(1,-1);break;case 5:o.rotate(-.5*Math.PI),o.scale(-1,1);break;case 6:o.rotate(-.5*Math.PI),o.translate(-s,0);break;case 7:o.rotate(-.5*Math.PI),o.translate(-s,c),o.scale(1,-1);break;case 8:o.rotate(.5*Math.PI),o.translate(0,-c)}switch(b(A,r)&&(o.translate(s,c),o.rotate(Math.PI)),A){case 2:o.translate(i,0),o.scale(-1,1);break;case 3:o.translate(i,n),o.rotate(Math.PI);break;case 4:o.translate(0,n),o.scale(1,-1);break;case 5:o.rotate(.5*Math.PI),o.scale(1,-1);break;case 6:o.rotate(.5*Math.PI),o.translate(0,-n);break;case 7:o.rotate(.5*Math.PI),o.translate(i,-n),o.scale(-1,1);break;case 8:o.rotate(-.5*Math.PI),o.translate(-i,0)}}}});