!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}(function(o){"use strict";var l=o.global,f=o.transform,r=l.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),m=l.ArrayBuffer&&ArrayBuffer.prototype.slice||function(e,a){a=a||this.byteLength-e;var t=new Uint8Array(this,e,a),r=new Uint8Array(a);return r.set(t),r.buffer},p={jpeg:{65505:[],65517:[]}};function s(a,e,c,g){var d=this;function t(s,u){if(!(l.DataView&&r&&a&&12<=a.size&&"image/jpeg"===a.type))return s(g);var e=c.maxMetaDataSize||262144;o.readFile(r.call(a,0,e),function(e){var a=new DataView(e);if(65496!==a.getUint16(0))return u(new Error("Invalid JPEG file: Missing JPEG marker."));for(var t,r,i,n,o=2,l=a.byteLength-4,f=o;o<l&&(65504<=(t=a.getUint16(o))&&t<=65519||65534===t);){if(o+(r=a.getUint16(o+2)+2)>a.byteLength){console.log("Invalid JPEG metadata: Invalid segment size.");break}if((i=p.jpeg[t])&&!c.disableMetaDataParsers)for(n=0;n<i.length;n+=1)i[n].call(d,a,o,r,g,c);f=o+=r}!c.disableImageHead&&6<f&&(g.imageHead=m.call(e,0,f)),s(g)},u,"readAsArrayBuffer")||s(g)}return c=c||{},l.Promise&&"function"!=typeof e?(g=c=e||{},new Promise(t)):(g=g||{},t(e,e))}function i(e,a,t){return e&&a&&t?new Blob([t,r.call(e,a.byteLength)],{type:"image/jpeg"}):null}o.transform=function(a,t,r,i,n){o.requiresMetaData(t)?s(i,function(e){e!==n&&(l.console&&console.log(e),e=n),f.call(o,a,t,r,i,e)},t,n=n||{}):f.apply(o,arguments)},o.blobSlice=r,o.bufferSlice=m,o.replaceHead=function(a,t,r){var e={maxMetaDataSize:256,disableMetaDataParsers:!0};if(!r&&l.Promise)return s(a,e).then(function(e){return i(a,e.imageHead,t)});s(a,function(e){r(i(a,e.imageHead,t))},e)},o.parseMetaData=s,o.metaDataParsers=p});