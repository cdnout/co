!function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}(function(a){"use strict";function m(e){e&&(Object.defineProperty(this,"map",{value:this.ifds[e].map}),Object.defineProperty(this,"tags",{value:this.tags&&this.tags[e]||{}}))}m.prototype.ifds={ifd1:{name:"Thumbnail",map:m.prototype.map={Orientation:274,Thumbnail:"ifd1",Blob:513,Exif:34665,GPSInfo:34853,Interoperability:40965}},34665:{name:"Exif",map:{}},34853:{name:"GPSInfo",map:{}},40965:{name:"Interoperability",map:{}}},m.prototype.get=function(e){return this[e]||this[this.map[e]]};var c={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,i){return e.getUint16(t,i)},size:2},4:{getValue:function(e,t,i){return e.getUint32(t,i)},size:4},5:{getValue:function(e,t,i){return e.getUint32(t,i)/e.getUint32(t+4,i)},size:8},9:{getValue:function(e,t,i){return e.getInt32(t,i)},size:4},10:{getValue:function(e,t,i){return e.getInt32(t,i)/e.getInt32(t+4,i)},size:8}};function x(e,t,i,n,f,a){var s,r,o,l,g,u,d=c[n];if(d){if(!((r=4<(s=d.size*f)?t+e.getUint32(i+8,a):i+8)+s>e.byteLength)){if(1===f)return d.getValue(e,r,a);for(o=[],l=0;l<f;l+=1)o[l]=d.getValue(e,r+l*d.size,a);if(d.ascii){for(g="",l=0;l<o.length&&"\0"!==(u=o[l]);l+=1)g+=u;return g}return o}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")}function p(e,t,i){return(!e||e[i])&&(!t||!0!==t[i])}function v(e,t,i,n,f,a,s,r){var o,l,g,u,d,c;if(i+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((l=i+2+12*(o=e.getUint16(i,n)))+4>e.byteLength)){for(g=0;g<o;g+=1)u=i+2+12*g,p(s,r,d=e.getUint16(u,n))&&(c=x(e,t,u,e.getUint16(u+2,n),e.getUint32(u+4,n),n),f[d]=c,a&&(a[d]=u));return e.getUint32(l,n)}console.log("Invalid Exif data: Invalid directory size.")}}c[7]=c[1],a.parseExifData=function(l,e,t,g,i){if(!i.disableExif){var u,n,f,d=i.includeExifTags,c=i.excludeExifTags||{34665:{37500:!0}},x=e+10;if(1165519206===l.getUint32(e+4))if(x+8>l.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===l.getUint16(e+8)){switch(l.getUint16(x)){case 18761:u=!0;break;case 19789:u=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===l.getUint16(x+2,u)?(n=l.getUint32(x+4,u),g.exif=new m,i.disableExifOffsets||(g.exifOffsets=new m,g.exifTiffOffset=x,g.exifLittleEndian=u),(n=v(l,x,x+n,u,g.exif,g.exifOffsets,d,c))&&p(d,c,"ifd1")&&(g.exif.ifd1=n,g.exifOffsets&&(g.exifOffsets.ifd1=x+n)),Object.keys(g.exif.ifds).forEach(function(e){var t,i,n,f,a,s,r,o;i=e,n=l,f=x,a=u,s=d,r=c,(o=(t=g).exif[i])&&(t.exif[i]=new m(i),t.exifOffsets&&(t.exifOffsets[i]=new m(i)),v(n,f,f+o,a,t.exif[i],t.exifOffsets&&t.exifOffsets[i],s&&s[i],r&&r[i]))}),(f=g.exif.ifd1)&&f[513]&&(f[513]=function(e,t,i){if(i){if(!(t+i>e.byteLength))return new Blob([a.bufferSlice.call(e.buffer,t,t+i)],{type:"image/jpeg"});console.log("Invalid Exif data: Invalid thumbnail data.")}}(l,x+f[513],f[514]))):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},a.metaDataParsers.jpeg[65505].push(a.parseExifData),a.exifWriters={274:function(e,t,i){var n=t.exifOffsets[274];return n&&new DataView(e,n+8,2).setUint16(0,i,t.exifLittleEndian),e}},a.writeExifData=function(e,t,i,n){return a.exifWriters[t.exif.map[i]](e,t,n)},a.ExifMap=m});