"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,l){void 0===l&&(l=i),Object.defineProperty(e,l,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,l){void 0===l&&(l=i),e[l]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const interval_arithmetic_eval_1=__importStar(require("interval-arithmetic-eval")),eval_1=require("../helpers/eval"),utils_1=__importDefault(require("../utils"));function interval1d(e,t,i,l){var a=utils_1.default.space(e,i,l);const r=e.meta.xScale,n=e.meta.yScale;var o=n.domain()[0],u=n.domain()[1];const c=[];let s;for(s=0;s<a.length-1;s+=1){var _={lo:a[s],hi:a[s+1]},h=eval_1.interval(t,"fn",{x:_});interval_arithmetic_eval_1.Interval.isEmpty(h)||interval_arithmetic_eval_1.Interval.isWhole(h)||c.push([_,h]),interval_arithmetic_eval_1.Interval.isWhole(h)&&c.push(null)}for(s=1;s<c.length-1;s+=1)if(!c[s]){const e=c[s-1],t=c[s+1];e&&t&&!interval_arithmetic_eval_1.Interval.intervalsOverlap(e[1],t[1])&&(e[1].lo>t[1].hi&&(e[1].hi=Math.max(u,e[1].hi),t[1].lo=Math.min(o,t[1].lo)),e[1].hi<t[1].lo&&(e[1].lo=Math.min(o,e[1].lo),t[1].hi=Math.max(u,t[1].hi)))}return c.scaledDx=r(a[1])-r(a[0]),[c]}interval_arithmetic_eval_1.default.policies.disableRounding();let rectEps;function smallRect(e,t){return interval_arithmetic_eval_1.Interval.width(e)<rectEps}function quadTree(e,t,i){var l=eval_1.interval(i,"fn",{x:e,y:t});if(!interval_arithmetic_eval_1.Interval.zeroIn(l))return this;if(smallRect(e,t))return this.push([e,t]),this;var a=e.lo+(e.hi-e.lo)/2,r=t.lo+(t.hi-t.lo)/2,l={lo:a,hi:e.hi},e={lo:e.lo,hi:a},a={lo:r,hi:t.hi},r={lo:t.lo,hi:r};quadTree.call(this,l,a,i),quadTree.call(this,l,r,i),quadTree.call(this,e,a,i),quadTree.call(this,e,r,i)}function interval2d(e,t){const i=e.meta.xScale;var l=e.meta.xScale.domain(),e=e.meta.yScale.domain(),l={lo:l[0],hi:l[1]},e={lo:e[0],hi:e[1]};const a=[];return rectEps=i.invert(1)-i.invert(0),quadTree.call(a,l,e,t),a.scaledDx=1,[a]}const sampler=function(e,t,i,l){const a={implicit:interval2d,linear:interval1d};if(!a.hasOwnProperty(t.fnType))throw Error(t.fnType+" is not supported in the `interval` sampler");return a[t.fnType].apply(null,arguments)};exports.default=sampler;