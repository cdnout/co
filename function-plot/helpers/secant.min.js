"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const d3_selection_1=require("d3-selection"),eval_1=require("./eval"),datum_defaults_1=__importDefault(require("../datum-defaults")),graph_types_1=require("../graph-types/");function secant(e){const t=datum_defaults_1.default({isHelper:!0,skipTip:!0,skipBoundsCheck:!0,nSamples:2,graphType:"polyline"});function s(e,t){if(!("x0"in t))throw Error("secant must have the property `x0` defined");t.scope=t.scope||{};const s=t.x0,n="number"==typeof t.x1?t.x1:1/0;var a;Object.assign(t.scope,{x0:s,x1:n,y0:eval_1.builtIn(e,"fn",{x:s}),y1:eval_1.builtIn(e,"fn",{x:n})}),(a=t.scope).m=(a.y1-a.y0)/(a.x1-a.x0)}function n(e,t){s(e,t),t.fn="m * (x - x0) + y0"}function a(t,n){const a=this;n.updateOnMouseMove&&!n.$$mouseListener&&(n.$$mouseListener=function({x:e}){n.x1=e,s(t,n),c(a)},e.on("tip:update",n.$$mouseListener))}const c=function(s){s.each(function(c){const o=d3_selection_1.select(this),i=function(e){const s=this,c=[];e.secants=e.secants||[];for(let o=0;o<e.secants.length;o+=1){const i=e.secants[o]=Object.assign({},t,e.secants[o]);i.index=e.index,i.fn||(n.call(s,e,i),a.call(s,e,i)),c.push(i)}return c}.call(s,c),r=o.selectAll("g.secant").data(i),l=r.enter().append("g").attr("class","secant");r.merge(l).call(graph_types_1.polyline(e)),r.merge(l).selectAll("path").attr("opacity",.5),r.exit().remove()})};return c}exports.default=secant;