"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const d3_selection_1=require("d3-selection"),graph_types_1=require("../graph-types/"),eval_1=require("./eval"),datum_defaults_1=__importDefault(require("../datum-defaults"));function derivative(e){const t=datum_defaults_1.default({isHelper:!0,skipTip:!0,skipBoundsCheck:!0,nSamples:2,graphType:"polyline"});const i=function(r){r.each(function(a){const n=d3_selection_1.select(this),s=function(e){if(!e.derivative)return[];const i="number"==typeof e.derivative.x0?e.derivative.x0:1/0;return t.index=e.index,t.scope={m:eval_1.builtIn(e.derivative,"fn",{x:i}),x0:i,y0:eval_1.builtIn(e,"fn",{x:i})},t.fn="m * (x - x0) + y0",[t]}.call(r,a);(function(t){const r=this;t.derivative&&t.derivative.updateOnMouseMove&&!t.derivative.$$mouseListener&&(t.derivative.$$mouseListener=function({x:e}){t.derivative&&(t.derivative.x0=e),i(r)},e.on("tip:update",t.derivative.$$mouseListener))}).call(r,a);const l=n.selectAll("g.derivative").data(s),u=l.enter().append("g").attr("class","derivative");l.merge(u).call(graph_types_1.polyline(e)),l.merge(u).selectAll("path").attr("opacity",.5),l.exit().remove()})};return i}exports.default=derivative;