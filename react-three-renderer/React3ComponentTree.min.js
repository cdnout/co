"use strict";var _invariant=require("fbjs/lib/invariant"),_invariant2=_interopRequireDefault(_invariant),_React3ComponentFlags=require("./React3ComponentFlags"),_React3ComponentFlags2=_interopRequireDefault(_React3ComponentFlags),_idPropertyName=require("./utils/idPropertyName"),_idPropertyName2=_interopRequireDefault(_idPropertyName);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var internalInstanceKey="__react3InternalInstance$"+Math.random().toString(36).slice(2);function getRenderedHostOrTextFromComponent(e){for(var r=e,n=r._renderedComponent;n;)n=(r=n)._renderedComponent;return r}function precacheMarkup(e,r){(0,_invariant2.default)(!!r,"Markup is null!");var n=getRenderedHostOrTextFromComponent(e);(n._hostMarkup=r)[internalInstanceKey]=n}function uncacheMarkup(e){var r=e._hostMarkup;r&&(delete r[internalInstanceKey],e._hostMarkup=null)}function precacheChildMarkups(e,r){if(0==(e._flags&_React3ComponentFlags2.default.hasCachedChildMarkups)){var n=e._renderedChildren,t=Object.keys(n),a=r.childrenMarkup;e:for(var o=0;o<t.length;++o){var u=n[t[o]],p=getRenderedHostOrTextFromComponent(u)._hostID;if(0!==p){for(var i=0;i<a.length;++i){var s=a[i];if(s[_idPropertyName2.default]===p){precacheMarkup(u,s);continue e}}"production"!==process.env.NODE_ENV?(0,_invariant2.default)(!1,"Unable to find element with ID %s.",p):(0,_invariant2.default)(!1)}}e._flags|=_React3ComponentFlags2.default.hasCachedChildMarkups}}function getClosestInstanceFromMarkup(e){if(e[internalInstanceKey])return e[internalInstanceKey];for(var r=e,n=[];!r[internalInstanceKey];){if(n.push(r),!r.parentMarkup)return null;r=r.parentMarkup}for(var t=void 0,a=r[internalInstanceKey];a&&(t=a,n.length);)precacheChildMarkups(a,r),a=(r=n.pop())[internalInstanceKey];return t}function getInstanceFromMarkup(e){var r=getClosestInstanceFromMarkup(e);return null!==r&&r._hostMarkup===e?r:null}function getMarkupFromInstance(e){if("production"!==process.env.NODE_ENV?(0,_invariant2.default)(void 0!==e._hostMarkup,"getMarkupFromInstance: Invalid argument."):(0,_invariant2.default)(void 0!==e._hostMarkup),e._hostMarkup)return e._hostMarkup;for(var r=e,n=[];!r._hostMarkup;)n.push(r),(0,_invariant2.default)(r._hostParent,"React3 tree root should always have a node reference."),r=r._hostParent;for(;n.length;r=n.pop())precacheChildMarkups(r,r._hostMarkup);return r._hostMarkup}module.exports={getMarkupFromInstance:getMarkupFromInstance,getInstanceFromMarkup:getInstanceFromMarkup,precacheMarkup:precacheMarkup,uncacheMarkup:uncacheMarkup,precacheChildMarkups:precacheChildMarkups,getClosestInstanceFromMarkup:getClosestInstanceFromMarkup,getRenderedHostOrTextFromComponent:getRenderedHostOrTextFromComponent};