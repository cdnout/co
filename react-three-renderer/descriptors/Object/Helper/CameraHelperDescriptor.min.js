"use strict";var _createClass=function(){function t(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),_get=function e(a,r,t){null===a&&(a=Function.prototype);var n=Object.getOwnPropertyDescriptor(a,r);if(void 0===n){var o=Object.getPrototypeOf(a);return null===o?void 0:e(o,r,t)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(t):void 0},_three=require("three"),THREE=_interopRequireWildcard(_three),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_Object3DDescriptor2=require("../Object3DDescriptor"),_Object3DDescriptor3=_interopRequireDefault(_Object3DDescriptor2),_CameraUtils=require("../../../utils/CameraUtils"),_CameraUtils2=_interopRequireDefault(_CameraUtils);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a.default=e,a}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}var CameraHelperDescriptor=function(){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.hasProp("visible",{type:_propTypes2.default.bool,override:!0,update:function(e,a){e.userData._visible=a,e.visible=e.userData._hasCamera&&a},updateInitial:!0,default:!0}),r.hasProp("cameraName",{type:_propTypes2.default.string.isRequired,update:function(e,a){r._clearCameraEvents(e),e.userData._cameraName=a,r._startCameraFinder(e)},default:void 0}),r}return _inherits(t,_Object3DDescriptor3.default),_createClass(t,[{key:"construct",value:function(){return new THREE.CameraHelper(new THREE.PerspectiveCamera)}},{key:"applyInitialProps",value:function(a,e){var r=this;_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"applyInitialProps",this).call(this,a,e),a.userData._onCameraProjectionUpdate=function(){a.update()},a.userData._onCameraDispose=function(){r._startCameraFinder(a)},a.userData._onCameraRename=function(e){e.oldName===a.userData._cameraName&&r._startCameraFinder(a)},a.userData._onBeforeRender=function(){a.visible=a.userData._hasCamera&&a.userData._visible&&_CameraUtils2.default.current!==a.userData._camera},a.userData._cameraName=e.cameraName,a.userData._visible=!e.hasOwnProperty("visible")||e.visible,a.userData.events.once("addedIntoRoot",function(){a.userData.markup._rootInstance.addBeforeRenderListener(a.userData._onBeforeRender),r._startCameraFinder(a)})}},{key:"unmount",value:function(e){return this._clearCameraEvents(e),delete e.userData._onCameraProjectionUpdate,_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"unmount",this).call(this,e)}},{key:"_getCamera",value:function(e,a){var r,t=null;return!a||0<(r=e.getObjectsByName(a).filter(function(e){return e instanceof THREE.Camera})).length&&(t=r[0]),t}},{key:"_clearCameraEvents",value:function(e){e.userData._hasCamera&&(e.userData._camera.userData.events.removeListener("updateProjectionMatrix",e.userData._onCameraProjectionUpdate),e.userData._camera.userData.events.removeListener("dispose",e.userData._onCameraDispose),e.userData._camera.userData.events.removeListener("rename",e.userData._onCameraRename))}},{key:"_setCamera",value:function(e,a){var r,t=e.userData;t._camera!==a&&(this._clearCameraEvents(e),t._hasCamera=!0,t._camera=a,e.camera=a,e.matrix=a.matrixWorld,e.update(),e.visible=t._visible,(r=e.userData._camera.userData.events).on("rename",t._onCameraRename),r.on("updateProjectionMatrix",t._onCameraProjectionUpdate),r.once("dispose",t._onCameraDispose))}},{key:"_startCameraFinder",value:function(r){var t=this;this._clearCameraEvents(r);var e,n=r.userData.markup&&r.userData.markup._rootInstance;n&&(r.userData._hasCamera=!1,r.userData._camera=null,r.camera=new THREE.PerspectiveCamera,r.visible=!1,(e=this._getCamera(n,r.userData._cameraName))?this._setCamera(r,e):n.addAnimateListener(function e(){var a=t._getCamera(n,r.userData._cameraName);a&&(n.removeAnimateListener(e),t._setCamera(r,a))}))}}]),t}();module.exports=CameraHelperDescriptor;