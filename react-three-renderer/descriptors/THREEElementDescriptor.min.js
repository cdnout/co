"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},_createClass=function(){function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}}(),_invariant=require("fbjs/lib/invariant"),_invariant2=_interopRequireDefault(_invariant),_warning=require("fbjs/lib/warning"),_warning2=_interopRequireDefault(_warning),_events=require("events"),_events2=_interopRequireDefault(_events),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_checkReactTypeSpec=require("react/lib/checkReactTypeSpec"),_checkReactTypeSpec2=_interopRequireDefault(_checkReactTypeSpec),_React3Instance=require("../React3Instance"),_React3Instance2=_interopRequireDefault(_React3Instance);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var loggedTypeFailures,getDeclarationErrorAddendum,_checkPropTypes,EventEmitter=_events2.default.EventEmitter,THREEElementDescriptor=function(){function t(e){_classCallCheck(this,t),this.react3RendererInstance=e,this.propUpdates={},this.propDeletes={},this.propDefaults={},this._initialOnly={},this._updateInitial=[],this._simpleProperties=[],this.propTypes={},this._hasName=!1}return _createClass(t,[{key:"hasEvent",value:function(r){this._hasEvents=!0,this.hasProp(r,{type:_propTypes2.default.func,updateInitial:!0,update:function(e,t){e.userData._eventCallbacks[r]=t},default:null})}},{key:"removeProp",value:function(e){(0,_invariant2.default)(this.propTypes.hasOwnProperty(e),"The property %s has not been defined",e);var t=this._simpleProperties.indexOf(e);-1!==t&&this._simpleProperties.splice(t,1),delete this.propTypes[e],delete this.propDeletes[e],delete this.propUpdates[e],delete this.propDefaults[e];var r=this._updateInitial.indexOf(e);-1!==r&&this._updateInitial.splice(r,1),delete this._initialOnly[e]}},{key:"hasProp",value:function(t,r){var e,a=this;(0,_invariant2.default)(r.hasOwnProperty("type"),"The information should include a `type` property"),(0,_invariant2.default)(!this.propTypes.hasOwnProperty(t)||r.override,"The property %s has already been defined",t),!r.override||-1!==(e=this._simpleProperties.indexOf(t))&&this._simpleProperties.splice(e,1),this.propTypes[t]=r.type,r.hasOwnProperty("simple")?(this.registerSimpleProperties([t]),r.hasOwnProperty("default")&&(this.propDeletes[t]=function(e){a.propUpdates[t](e,r.default,!0)},this.propDefaults[t]=r.default)):(r.hasOwnProperty("update")&&(this.propUpdates[t]=r.update),r.hasOwnProperty("default")?((0,_invariant2.default)(r.hasOwnProperty("update"),"The information should include a `update` property if it has a `default` property"),this.propDeletes[t]=function(e){r.update(e,r.default,!0)},this.propDefaults[t]=r.default):(0,_invariant2.default)(r.update===this.triggerRemount,"The type information for "+this.constructor.name+"."+t+" should include a `default` property if it's not going to trigger remount"),r.hasOwnProperty("remove")&&(0,_invariant2.default)(!1,"Bad 'remove' info for "+this.constructor.name+"."+t),r.hasOwnProperty("updateInitial")&&((0,_invariant2.default)(r.hasOwnProperty("update"),"The information should include a `update` property if it has a`updateInitial` property"),"production"!==process.env.NODE_ENV&&(0,_invariant2.default)(r.hasOwnProperty("default")||3===this.propUpdates[t].length||this.propUpdates[t]===this.triggerRemount,"Prop info for "+this.constructor.name+"."+t+" has 'updateInitial', but no 'default', and the update function accepts "+this.propUpdates[t].length+" parameters instead of 3."),-1===this._updateInitial.indexOf(t)&&this._updateInitial.push(t)),r.initialOnly&&(0,_invariant2.default)(r.hasOwnProperty("updateInitial"),"The information should include a `updateInitial` property if it has an `initialOnly` property"),this._initialOnly[t]=r.initialOnly)}},{key:"hasName",value:function(){var r=this;this._hasName=!0,this.hasProp("name",{type:_propTypes2.default.string,update:function(e,t){r._updateName(e,t)},default:""})}},{key:"_updateName",value:function(e,t){var r=e.name;e.name=t,e.userData.events.emit("rename",{oldName:r,nextName:t});var a=e.userData.markup;a._rootInstance&&a._rootInstance.objectRenamed(e,r,t)}},{key:"placeRemountTrigger",value:function(e,t){e.userData._triggerRemount=t}},{key:"applyInitialProps",value:function(a,r){var n=this,e=new EventEmitter;this._hasName&&r.name&&(a.name=r.name),this._hasEvents&&(a.userData._eventCallbacks={}),e.on("resource.added",function(e){var t=a.userData.markup.childrenMarkup,r=_extends({},e,{distance:e.distance+1});t.forEach(function(e){return e.threeObject.userData.events.emit("resource.added",r)})}),e.on("resource.removed",function(e){var t=a.userData.markup.childrenMarkup,r=_extends({},e,{distance:e.distance+1});t.forEach(function(e){return e.threeObject.userData.events.emit("resource.removed",r)})}),a.userData.events=e,(a.userData._descriptor=this)._updateInitial.forEach(function(e){var t;r.hasOwnProperty(e)?n.propUpdates[e](a,r[e],!0):(t=void 0,n.propDefaults.hasOwnProperty(e)&&(t=n.propDefaults[e]),n.propUpdates[e](a,t,!1))}),this._simpleProperties.forEach(function(e){r.hasOwnProperty(e)&&(a[e]=r[e])})}},{key:"construct",value:function(){(0,_invariant2.default)(!1,"Missing constructor!")}},{key:"addChildren",value:function(){(0,_invariant2.default)(!1,"Cannot add children to "+this.constructor.name+"!")}},{key:"addChild",value:function(){(0,_invariant2.default)(!1,"Cannot add child to "+this.constructor.name+"!")}},{key:"moveChild",value:function(){(0,_invariant2.default)(!1,"Cannot move children in "+this.constructor.name+"!")}},{key:"removeChild",value:function(){(0,_invariant2.default)(!1,"Cannot remove children in "+this.constructor.name+"!")}},{key:"setParent",value:function(e,t){var r=t.userData.markup;r&&r._rootInstance&&r._rootInstance.objectMounted(e)}},{key:"componentWillUnmount",value:function(){}},{key:"unmount",value:function(e){var t=e.userData.markup;t._rootInstance&&t._rootInstance.objectRemoved(e),this._hasEvents&&delete e.userData._eventCallbacks,e.userData.events.emit("dispose",{object:e}),e.userData.events.removeAllListeners()}},{key:"removedFromParent",value:function(e){delete e.userData.events}},{key:"deleteProperty",value:function(e,t){this.propDeletes[t]?this.propDeletes[t](e):"production"!==process.env.NODE_ENV&&(0,_warning2.default)(!1,"Cannot delete property %s from "+this.constructor.name,t)}},{key:"updateProperty",value:function(e,t,r){this._initialOnly[t]?this.triggerRemount(e):this.propUpdates[t]?this.propUpdates[t](e,r,!0):((0,_warning2.default)(!1,"updating prop "+t+" ( "+r+" ) for "+this.constructor.name),this.triggerRemount(e))}},{key:"highlight",value:function(){}},{key:"hideHighlight",value:function(){}},{key:"useSimpleUpdates",value:function(e){for(var t=0;t<e.length;++t){var r=e[t];this.propUpdates[r]=this._updateSimple.bind(this,r)}}},{key:"_updateSimple",value:function(e,t,r){t[e]=r}},{key:"registerSimpleProperties",value:function(e){var t=this;e.forEach(function(e){-1===t._simpleProperties.indexOf(e)&&t._simpleProperties.push(e)}),this.useSimpleUpdates(e)}},{key:"getBoundingBoxes",value:function(){return[]}},{key:"triggerRemount",value:function(e){e.userData._triggerRemount&&(e.userData._triggerRemount(),delete e.userData._triggerRemount)}},{key:"beginPropertyUpdates",value:function(){}},{key:"completePropertyUpdates",value:function(){}},{key:"beginChildUpdates",value:function(){}},{key:"completeChildUpdates",value:function(){}}]),t}();"production"!==process.env.NODE_ENV&&(loggedTypeFailures={},getDeclarationErrorAddendum=function(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""},_checkPropTypes=function(e,t,r,a,n,i,o){for(var s=Object.keys(r),p=0;p<s.length;++p){var u,l,c=s[p];"children"!==c&&(t.hasOwnProperty(c)||((u="Foreign prop "+c+" found in "+e+".")in loggedTypeFailures||(l=getDeclarationErrorAddendum(n),loggedTypeFailures[u]=!0,(0,_warning2.default)(!1,u+l))))}(0,_checkReactTypeSpec2.default)(t,r,a,e,i,o)},THREEElementDescriptor.prototype.checkPropTypes=function(e,t,r,a){_checkPropTypes(e.type,this.propTypes,a,"prop",t,e,r)}),module.exports=THREEElementDescriptor;