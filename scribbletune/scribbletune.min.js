!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("fs")):"function"==typeof define&&define.amd?define(["fs"],t):"object"==typeof exports?exports.scribble=t(require("fs")):e.scribble=t(e.fs)}(self,function(t){return(()=>{var n={397:(e,o)=>{(()=>{"use strict";var n={413:e=>{e.exports=JSON.parse('{"5th":"100000010000","M7#5sus4":"100001001001","7#5sus4":"100001001010","sus4":"100001010000","M7sus4":"100001010001","7sus4":"100001010010","7no5":"100010000010","aug":"100010001000","M7b6":"100010001001","maj7#5":"100010001001","7#5":"100010001010","7b13":"100010001010","M":"100010010000","maj7":"100010010001","7th":"100010010010","6th":"100010010100","7add6":"100010010110","7b6":"100010011010","Mb5":"100010100000","M7b5":"100010100001","7b5":"100010100010","maj#4":"100010110001","7#11":"100010110010","M6#11":"100010110100","7#11b13":"100010111010","m#5":"100100001000","mb6M7":"100100001001","m7#5":"100100001010","m":"100100010000","m/ma7":"100100010001","m7":"100100010010","m6":"100100010100","mMaj7b6":"100100011001","dim":"100100100000","oM7":"100100100001","m7b5":"100100100010","dim7":"100100100100","o7M7":"100100100101","4th":"100101000010","madd4":"100101010000","m7add11":"100101010010","+add#9":"100110001000","7#5#9":"100110001010","7#9":"100110010010","13#9":"100110010110","7#9b13":"100110011010","maj7#9#11":"100110110001","7#9#11":"100110110010","13#9#11":"100110110110","7#9#11b13":"100110111010","sus2":"101000010000","M9#5sus4":"101001001001","sus24":"101001010000","M9sus4":"101001010001","11th":"101001010010","9sus4":"101001010010","13sus4":"101001010110","9no5":"101010000010","13no5":"101010000110","M#5add9":"101010001000","maj9#5":"101010001001","9#5":"101010001010","9b13":"101010001010","Madd9":"101010010000","maj9":"101010010001","9th":"101010010010","6/9":"101010010100","maj13":"101010010101","M7add13":"101010010101","13th":"101010010110","M9b5":"101010100001","9b5":"101010100010","13b5":"101010100110","9#5#11":"101010101010","maj9#11":"101010110001","9#11":"101010110010","69#11":"101010110100","M13#11":"101010110101","13#11":"101010110110","9#11b13":"101010111010","m9#5":"101100001010","madd9":"101100010000","mM9":"101100010001","m9":"101100010010","m69":"101100010100","m13":"101100010110","mMaj9b6":"101100011001","m9b5":"101100100010","m11A":"101101001010","m11":"101101010010","b9sus":"110001010010","11b9":"110001010010","7sus4b9b13":"110001011010","alt7":"110010000010","7#5b9":"110010001010","Maddb9":"110010010000","M7b9":"110010010001","7b9":"110010010010","13b9":"110010010110","7b9b13":"110010011010","7#5b9#11":"110010101010","7b9#11":"110010110010","13b9#11":"110010110110","7b9b13#11":"110010111010","mb6b9":"110100001000","7b9#9":"110110010010"}')},722:e=>{e.exports=JSON.parse('{"major pentatonic":"101010010100","ionian pentatonic":"100011010001","mixolydian pentatonic":"100011010010","ritusen":"101001010100","egyptian":"101001010010","neopolitan major pentatonic":"100011100010","vietnamese 1":"100101011000","pelog":"110100011000","kumoijoshi":"110001011000","hirajoshi":"101100011000","iwato":"110001100010","in-sen":"110001010010","lydian pentatonic":"100010110001","malkos raga":"100101001010","locrian pentatonic":"100101100010","minor pentatonic":"100101010010","minor six pentatonic":"100101010100","flat three pentatonic":"101100010100","flat six pentatonic":"101010011000","scriabin":"110010010100","whole tone pentatonic":"100010101010","lydian #5P pentatonic":"100010101001","lydian dominant pentatonic":"100010110010","minor #7M pentatonic":"100101010001","super locrian pentatonic":"100110100010","minor hexatonic":"101101010001","augmented":"100110011001","major blues":"101110010100","piongio":"101001010110","prometheus neopolitan":"110010100110","prometheus":"101010100110","mystery #1":"110010101010","six tone symmetric":"110011001100","whole tone":"101010101010","messiaen\'s mode #5":"110001110001","minor blues":"100101110010","locrian major":"101011101010","double harmonic lydian":"110010111001","harmonic minor":"101101011001","altered":"110110101010","locrian #2":"101101101010","mixolydian b6":"101011011010","lydian dominant":"101010110110","lydian":"101010110101","lydian augmented":"101010101101","dorian b2":"110101010110","melodic minor":"101101010101","locrian":"110101101010","ultralocrian":"110110101100","locrian 6":"110101100110","augmented heptatonic":"100111011001","romanian minor":"101100110110","dorian #4":"101100110110","lydian diminished":"101100110101","phrygian":"110101011010","leading whole tone":"101010101011","lydian minor":"101010111010","phrygian dominant":"110011011010","balinese":"110101011001","neopolitan major":"110101010101","aeolian":"101101011010","harmonic major":"101011011001","double harmonic major":"110011011001","dorian":"101101010110","hungarian minor":"101100111001","hungarian major":"100110110110","oriental":"110011100110","flamenco":"110110110010","todi raga":"110100111001","mixolydian":"101011010110","persian":"110011101001","major":"101011010101","enigmatic":"110010101011","major augmented":"101011001101","lydian #9":"100110110101","messiaen\'s mode #4":"111001111001","purvi raga":"110011111001","spanish heptatonic":"110111011010","bebop":"101011010111","bebop minor":"101111010110","bebop major":"101011011101","bebop locrian":"110101111010","minor bebop":"101101011011","diminished":"101101101101","ichikosucho":"101011110101","minor six diminished":"101101011101","half-whole diminished":"110110110110","kafi raga":"100111010111","messiaen\'s mode #6":"101011101011","composite blues":"101111110110","messiaen\'s mode #3":"101110111011","messiaen\'s mode #7":"111101111101","chromatic":"111111111111","ionian":"101011010101","minor":"101101011010"}')}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;t=r[e]={exports:{}};return n[e](t,t.exports,a),t.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{a.r(s),a.d(s,{chord:()=>r,chords:()=>t,inlineChord:()=>e,scale:()=>o,scales:()=>n});function i(e){var t,n,r=e.scale,o=e.chord,i=r||o,a=r?"scale":"chord";if("string"!=typeof i)throw new Error("".concat(i," is not a valid input for ").concat(a));if(-1===(e=i.indexOf(" "))?(t=i.slice(1),n=i[0],"b"!==i[1]&&"#"!==i[1]||(t=i.slice(2),n+=i[1])):(t=i.slice(-1===e?1:e+1),n=i.slice(0,e)),e={"C#":"Db","D#":"Eb","F#":"Gb","G#":"Ab","A#":"Bb"}[(o=n.replace(/\d/g,"")).toUpperCase()]||o.charAt(0).toUpperCase()+o.slice(1),o=""!==n.replace(/\D/g,"")?+n.replace(/\D/g,""):4,isNaN(o))throw new Error("".concat(n[0]," does not have a valid octave"));if(!d[t]&&!h[t])throw new Error("".concat(i," is not a valid ").concat(a));for(var s,c=(a=e,s=o,o=(e=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"]).map(function(e){return e+s}),e=e.map(function(e){return e+(1+s)}),(e=o.concat(e)).slice(e.indexOf(a+s))),u=[],l=0,p=0,f=r?d:h;l<f[t].length;)"1"===f[t][l]&&u.push(c[p]),l++,p++;return u}var d=a(722),h=a(413),e=function(e){var t,n,r="b9sus",o=4;return e.includes(r)?t=e.slice(0,e.indexOf(n=r)):(t=e[0],n=e.slice(1),"b"!==e[1]&&"#"!==e[1]||(t+=e[1],n=e.slice(2))),e.includes("_")&&(o=+e.split("_")[1],n=n.slice(0,n.indexOf("_"))),i({chord:t+o+" "+n})},t=function(){return Object.keys(h)},n=function(){return Object.keys(d)},r=function(e){return i({chord:e})},o=function(e){return i({scale:e})}})();var e,t=o;for(e in s)t[e]=s[e];s.__esModule&&Object.defineProperty(t,"__esModule",{value:!0})})()},126:function(e,t,n){e=n.nmd(e);n={};!function(e){e.DEFAULT_VOLUME=90;function o(e){if(!this)return new o(e);!e||null===e.type&&void 0===e.type||null===e.channel&&void 0===e.channel||null===e.param1&&void 0===e.param1||(this.setTime(e.time),this.setType(e.type),this.setChannel(e.channel),this.setParam1(e.param1),this.setParam2(e.param2))}var i=(e.DEFAULT_DURATION=128,e.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(e){var t=/([a-g])(#+|b+)?([0-9]+)$/i.exec(e),n=t[1].toLowerCase(),e=t[2]||"";return 12*parseInt(t[3],10)+i.midi_letter_pitches[n]+("#"==e.substr(0,1)?1:-1)*e.length},ensureMidiPitch:function(e){return"number"!=typeof e&&/[^0-9]/.test(e)?i.midiPitchFromNote(e):parseInt(e,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(e,t){var n=0,r=e;return t=t||!1,23<e&&(r=e-12*(n=Math.floor(e/12)-1)),r=i.midi_pitches_letter[r],(r=t&&0<r.indexOf("#")?i.midi_flattened_notes[r]:r)+n},mpqnFromBpm:function(e){for(var t=Math.floor(6e7/e),n=[];n.unshift(255&t),t>>=8;);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(e){if(void 0!==e[0])for(var t=0,n=e.length-1;0<=n;++t,--n)e[t];return Math.floor(6e7/e)},codes2Str:function(e){return String.fromCharCode.apply(null,e)},str2Bytes:function(e,t){if(t)for(;e.length/2<t;)e="0"+e;for(var n=[],r=e.length-1;0<=r;r-=2){var o=0===r?e[r]:e[r-1]+e[r];n.unshift(parseInt(o,16))}return n},translateTickTime:function(e){for(var t=127&e;e>>=7;)t<<=8,t|=127&e|128;for(var n=[];n.push(255&t),128&t;)t>>=8;return n}});o.NOTE_OFF=128,o.NOTE_ON=144,o.AFTER_TOUCH=160,o.CONTROLLER=176,o.PROGRAM_CHANGE=192,o.CHANNEL_AFTERTOUCH=208,o.PITCH_BEND=224,o.prototype.setTime=function(e){this.time=i.translateTickTime(e||0)},o.prototype.setType=function(e){if(e<o.NOTE_OFF||o.PITCH_BEND<e)throw new Error("Trying to set an unknown event: "+e);this.type=e},o.prototype.setChannel=function(e){if(e<0||15<e)throw new Error("Channel is out of bounds.");this.channel=e},o.prototype.setParam1=function(e){this.param1=e},o.prototype.setParam2=function(e){this.param2=e},o.prototype.toBytes=function(){var e=[],t=this.type|15&this.channel;return e.push.apply(e,this.time),e.push(t),e.push(this.param1),void 0!==this.param2&&null!==this.param2&&e.push(this.param2),e};function n(e){if(!this)return new n(e);this.setTime(e.time),this.setType(e.type),this.setData(e.data)}n.SEQUENCE=0,n.TEXT=1,n.COPYRIGHT=2,n.TRACK_NAME=3,n.INSTRUMENT=4,n.LYRIC=5,n.MARKER=6,n.CUE_POINT=7,n.CHANNEL_PREFIX=32,n.END_OF_TRACK=47,n.TEMPO=81,n.SMPTE=84,n.TIME_SIG=88,n.KEY_SIG=89,n.SEQ_EVENT=127,n.prototype.setTime=function(e){this.time=i.translateTickTime(e||0)},n.prototype.setType=function(e){this.type=e},n.prototype.setData=function(e){this.data=e},n.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var e,t=[];return t.push.apply(t,this.time),t.push(255,this.type),Array.isArray(this.data)?(t.push(this.data.length),t.push.apply(t,this.data)):"number"==typeof this.data?t.push(1,this.data):null!==this.data&&void 0!==this.data?(t.push(this.data.length),e=this.data.split("").map(function(e){return e.charCodeAt(0)}),t.push.apply(t,e)):t.push(0),t};function a(e){if(!this)return new a(e);this.events=(e||{}).events||[]}a.START_BYTES=[77,84,114,107],a.END_BYTES=[0,255,47,0],a.prototype.addEvent=function(e){return this.events.push(e),this},a.prototype.addNoteOn=a.prototype.noteOn=function(e,t,n,r){return this.events.push(new o({type:o.NOTE_ON,channel:e,param1:i.ensureMidiPitch(t),param2:r||90,time:n||0})),this},a.prototype.addNoteOff=a.prototype.noteOff=function(e,t,n,r){return this.events.push(new o({type:o.NOTE_OFF,channel:e,param1:i.ensureMidiPitch(t),param2:r||90,time:n||0})),this},a.prototype.addNote=a.prototype.note=function(e,t,n,r,o){return this.noteOn(e,t,r,o),n&&this.noteOff(e,t,n,o),this},a.prototype.addChord=a.prototype.chord=function(n,e,r,t){if(!Array.isArray(e)&&!e.length)throw new Error("Chord must be an array of pitches");return e.forEach(function(e){this.noteOn(n,e,0,t)},this),e.forEach(function(e,t){0===t?this.noteOff(n,e,r):this.noteOff(n,e)},this),this},a.prototype.setInstrument=a.prototype.instrument=function(e,t,n){return this.events.push(new o({type:o.PROGRAM_CHANGE,channel:e,param1:t,time:n||0})),this},a.prototype.setTempo=a.prototype.tempo=function(e,t){return this.events.push(new n({type:n.TEMPO,data:i.mpqnFromBpm(e),time:t||0})),this},a.prototype.toBytes=function(){var t=0,n=[],e=a.START_BYTES,r=a.END_BYTES;this.events.forEach(function(e){e=e.toBytes();t+=e.length,n.push.apply(n,e)}),t+=r.length;var o=i.str2Bytes(t.toString(16),4);return e.concat(o,n,r)};function r(e){if(!this)return new r(e);if((e=e||{}).ticks){if("number"!=typeof e.ticks)throw new Error("Ticks per beat must be a number!");if(e.ticks<=0||32768<=e.ticks||e.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=e.ticks||128,this.tracks=e.tracks||[]}r.HDR_CHUNKID="MThd",r.HDR_CHUNK_SIZE="\0\0\0",r.HDR_TYPE0="\0\0",r.HDR_TYPE1="\0",r.prototype.addTrack=function(e){return e?(this.tracks.push(e),this):(e=new a,this.tracks.push(e),e)},r.prototype.toBytes=function(){var e=this.tracks.length.toString(16),t=r.HDR_CHUNKID+r.HDR_CHUNK_SIZE;return 1<parseInt(e,16)?t+=r.HDR_TYPE1:t+=r.HDR_TYPE0,t+=i.codes2Str(i.str2Bytes(e,2)),t+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach(function(e){t+=i.codes2Str(e.toBytes())}),t},e.Util=i,e.File=r,e.Track=a,e.Event=o,e.MetaEvent=n}(n),null!==e?e.exports=n:null!==t||(this.Midi=n)},148:function(e,t,n){"use strict";var a=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||((r=r||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.arp=void 0;function s(e,t){var n=function(e){if(!e)throw new Error("Empty element");var t=e.replace(/\d/,""),e=e.replace(/\D/g,"")||4;if(!t)throw new Error("Incorrect note");return t+(+e+1)},r=e.map(n),n=r.map(n);return a(a(a([],e,!0),r,!0),n,!0).slice(0,t)}var c=n(397),u=n(604);t.arp=function(e){var o=[],i={count:4,order:"0123",chords:""};if("string"==typeof e)i.chords=e;else{if(e.order&&e.order.match(/\D/g))throw new TypeError("Invalid value for order");if(8<e.count||e.count<2)throw new TypeError("Invalid value for count");e.count&&!e.order&&(i.order=Array.from(Array(e.count).keys()).join("")),Object.assign(i,e)}if("string"==typeof i.chords)i.chords.split(" ").forEach(function(t,n){try{var r=s((0,c.inlineChord)(t),i.count),e=i.order.split("").map(function(e){return r[e]});o=a(a([],o,!0),e,!0)}catch(e){throw new Error("Cannot decode chord ".concat(n+1,' "').concat(t,'" in given "').concat(i.chords,'"'))}});else{if(!Array.isArray(i.chords))throw new TypeError("Invalid value for chords");i.chords.forEach(function(t,n){try{var r=s(t,i.count),e=i.order.split("").map(function(e){return r[e]});o=a(a([],o,!0),e,!0)}catch(e){throw new Error("".concat((0,u.errorHasMessage)(e)?e.message:e," in chord ").concat(n+1,' "').concat(t,'"'))}})}return o}},378:function(e,c,t){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,a,s,c){return new(s=s||Promise)(function(n,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function o(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,o)}i((c=c.apply(e,a||[])).next())})},i=this&&this.__generator||function(n,r){var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!((a=0<(a=s.trys).length&&a[a.length-1])||6!==t[0]&&2!==t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(c,"__esModule",{value:!0}),c.clip=c.renderingDuration=c.totalPatternDuration=c.recursivelyApplyPatternToDurations=c.getDuration=c.getNote=void 0;var r=t(604),a="4n";c.getNote=function(e,t,n){return"R"===e&&t.randomNotes&&0<t.randomNotes.length?t.randomNotes[(0,r.randomInt)(t.randomNotes.length-1)]:t.notes?t.notes[n%(t.notes.length||1)]:""},c.getDuration=function(e,t){return e.durations?e.durations[t%e.durations.length]:e.dur||e.subdiv||"8n"},c.recursivelyApplyPatternToDurations=function(e,t,n){return void 0===n&&(n=[]),e.forEach(function(e){"string"==typeof e&&("x"!==e&&"R"!==e||n.push(t),"_"===e&&n.length&&(n[n.length-1]+=t)),Array.isArray(e)&&(0,c.recursivelyApplyPatternToDurations)(e,t/e.length,n)}),n};function s(e,t,n){if(n=n||Tone.getContext(),!e.pattern)throw new Error("No pattern provided!");return e.durations||e.dur||(e.durations=(0,c.recursivelyApplyPatternToDurations)((0,r.expandStr)(e.pattern),Tone.Ticks(e.subdiv||a).toSeconds())),new Tone.Sequence({callback:t.getSeqFn(e),events:(0,r.expandStr)(e.pattern),subdivision:e.subdiv||a,context:n})}c.totalPatternDuration=function(e,t){return"number"==typeof t?t*(0,r.expandStr)(e).length:Tone.Ticks(t).toSeconds()*(0,r.expandStr)(e).length},c.renderingDuration=function(e,t,n,r){var o=e.split("").filter(function(e){return"x"===e}).length,i=e.split("").filter(function(e){return"R"===e}).length,a=null!=r&&r.length?o:o+i,s=n.length||1;return(0,c.totalPatternDuration)(e,t)/a*function(){for(var e=s<a?[s,a]:[a,s],t=e[0],n=e[1],r=n;r%t!=0;)r+=n;return r}()};var u,l=0;c.clip=function(e,t){if("string"==typeof(e=n(n({},{notes:["C4"],pattern:"x",shuffle:!1,sizzle:!1,sizzleReps:1,arpegiate:!1,subdiv:"4n",align:"1m",alignOffset:"0",amp:100,accentLow:70,randomNotes:null,offlineRendering:!1}),e||{})).notes&&(e.notes=e.notes.replace(/\s{2,}/g," "),e.notes=e.notes.split(" ")),e.notes=e.notes?e.notes.map(r.convertChordsToNotes):[],/[^x\-_[\]R]/.test(e.pattern))throw new TypeError("pattern can only comprise x - _ [ ] R, found ".concat(e.pattern));return e.shuffle&&(e.notes=(0,r.shuffle)(e.notes)),e.randomNotes&&"string"==typeof e.randomNotes&&(e.randomNotes=e.randomNotes.replace(/\s{2,}/g," ").split(/\s/)),e.randomNotes&&(e.randomNotes=e.randomNotes.map(r.convertChordsToNotes)),e.offlineRendering?function(r,e){u=u||Tone.getContext(),l++;var t=new Tone.Player({context:u,loop:!0});return Tone.Offline(function(n){return o(void 0,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return t=s(r,n),[4,Tone.loaded()];case 1:return e.sent(),t.start(),n.transport.start(),[2]}})})},e).then(function(e){t.buffer=e,0==--l&&(Tone.setContext(u),null===(e=r.offlineRenderingCallback)||void 0===e||e.call(r))}),t.toDestination(),t.sync(),t}(e,(0,c.renderingDuration)(e.pattern,e.subdiv||a,e.notes,e.randomNotes)):s(e,t,u)}},594:function(e,t,n){"use strict";var p=this&&this.__assign||function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},u=this&&this.__rest||function(e,t){var n={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Channel=void 0;function o(e){if("0"===(n=Tone.Transport.position.split(":"))[0]&&"0"===n[1])return 0;var t=Tone.Transport.ticks,n=(null==e?void 0:e.align)||"1m",e=(null==e?void 0:e.alignOffset)||"0",n=Tone.Ticks(n).toTicks(),e=Tone.Ticks(e).toTicks();return Tone.Ticks(Math.floor(t/n+1)*n+e)}var l=n(378),f=n(604),n=(r.setTransportTempo=function(e){Tone.Transport.bpm.value=e},r.startTransport=function(){Tone.start(),Tone.Transport.start()},r.stopTransport=function(e){void 0===e&&(e=!0),Tone.Transport.stop(),e&&Tone.Transport.cancel()},r.prototype.setVolume=function(e){var t,n;this.instrument&&(this.instrument.volume.value=e),this.external&&(null===(n=(t=this.external).setVolume)||void 0===n||n.call(t,e))},r.prototype.startClip=function(e,t){var n=this,r=this.channelClips[e];t=t||(0===t?0:o(r)),-1<this.activePatternIdx&&this.activePatternIdx!==e&&this.stopClip(this.activePatternIdx,t),r&&"started"!==r.state&&(this.counterResetTask=Tone.Transport.scheduleOnce(function(){n.clipNoteCount=0},t),this.activePatternIdx=e,null==r||r.start(t))},r.prototype.stopClip=function(e,t){var n=this.channelClips[e];t=t||(0===t?0:o(n)),null==n||n.stop(t),e===this.activePatternIdx&&(this.activePatternIdx=-1)},r.prototype.addClip=function(t,n){var r=this;n=n||this.channelClips.length,t.pattern?(this.channelClips[n]=(0,l.clip)(p({},t),this),["align","alignOffset"].forEach(function(e){t[e]&&(r.channelClips[n][e]=t[e])})):this.channelClips[n]=null},r.prototype.getSeqFn=function(s){var c=this;return this.external?function(e,t){var n,r;if("x"===t||"R"===t){var o=c.clipNoteCount;if(c.hasLoaded){var i=(0,l.getNote)(t,s,o)[0],a=(0,l.getDuration)(s,o),t=Tone.Time(a).toSeconds();c.playerCb({note:i,duration:a,time:e,counter:o});try{null===(r=(n=c.external).triggerAttackRelease)||void 0===r||r.call(n,i,t,e)}catch(e){c.eventCb("error",{e:e})}}c.clipNoteCount++}}:this.instrument instanceof Tone.Player?function(e,t){if("x"===t||"R"===t){t=c.clipNoteCount;if(c.hasLoaded){c.playerCb({note:"",duration:"",time:e,counter:t});try{c.instrument.start(e)}catch(e){c.eventCb("error",{e:e})}}c.clipNoteCount++}}:this.instrument instanceof Tone.PolySynth||this.instrument instanceof Tone.Sampler?function(e,t){if("x"===t||"R"===t){var n=c.clipNoteCount;if(c.hasLoaded){var r=(0,l.getNote)(t,s,n),t=(0,l.getDuration)(s,n);c.playerCb({note:r,duration:t,time:e,counter:n});try{c.instrument.triggerAttackRelease(r,t,e)}catch(e){c.eventCb("error",{e:e})}}c.clipNoteCount++}}:this.instrument instanceof Tone.NoiseSynth?function(e,t){if("x"===t||"R"===t){var n=c.clipNoteCount;if(c.hasLoaded){t=(0,l.getDuration)(s,n);c.playerCb({note:"",duration:t,time:e,counter:n});try{c.instrument.triggerAttackRelease(t,e)}catch(e){c.eventCb("error",{e:e})}}c.clipNoteCount++}}:function(e,t){if("x"===t||"R"===t){var n=c.clipNoteCount;if(c.hasLoaded){var r=(0,l.getNote)(t,s,n)[0],t=(0,l.getDuration)(s,n);c.playerCb({note:r,duration:t,time:e,counter:n});try{c.instrument.triggerAttackRelease(r,t,e)}catch(e){c.eventCb("error",{e:e})}}c.clipNoteCount++}}},r.prototype.eventCb=function(e,t){"function"==typeof this.eventCbFn&&(t.channel=this).eventCbFn(e,t)},r.prototype.playerCb=function(e){"function"==typeof this.playerCbFn&&(e.channel=this).playerCbFn(e)},r.prototype.checkToneObjLoaded=function(t,n){var e,r=this,o=t instanceof Tone.Sampler;if("loaded"in t){if(t.loaded)return void n();if(o)return;var i=!1;if(["buffer","_buffer","_buffers"].forEach(function(e){e in t&&(r.checkToneObjLoaded(t[e],n),i=!0)}),i)return}t instanceof Tone.ToneAudioBuffer||t instanceof Tone.ToneBufferSource||"loaded"in t&&"onload"in t?(e=t.onload,t.onload=function(){e&&"function"==typeof e&&(t.onload=e)(),n()}):n()},r.prototype.recreateToneObjectInContext=function(c,u){var l=this;return u=u||Tone.getContext(),new Promise(function(e,t){var n,r,o,i,a,s;c instanceof Tone.PolySynth?(n=Tone.PolySynth(Tone[c._dummyVoice.name],p(p({},c.get()),{context:u})),l.checkToneObjLoaded(n,function(){return e(n)})):c instanceof Tone.Player?r=Tone.Player({url:c._buffer,context:u,onload:function(){return l.checkToneObjLoaded(r,function(){return e(r)})}}):c instanceof Tone.Sampler?(o={attack:(i=c.get()).attack,curve:i.curve,release:i.release,volume:i.volume},i={baseUrl:c._buffers.baseUrl,urls:Object.fromEntries(c._buffers._buffers.entries())},a=Tone.Sampler(p(p(p({},o),i),{context:u,onload:function(){return l.checkToneObjLoaded(a,function(){return e(a)})}}))):(s=Tone[c.name](p(p({},c.get()),{context:u,onload:function(){return l.checkToneObjLoaded(s,function(){return e(s)})}})),l.checkToneObjLoaded(s,function(){return e(s)}))})},r.prototype.initOutputProducer=function(o,i){var a=this;return o=o||Tone.getContext(),new Promise(function(e,t){if(i.synth){if(i.instrument)throw new Error("Either synth or instrument can be provided, but not both.");var n,r;i.synth.synth?(n=i.synth.synth,r=i.synth.preset||{},a.instrument=new Tone[n](p(p({},r),{context:o,onload:function(){return a.checkToneObjLoaded(a.instrument,e)}}))):(a.instrument=i.synth,console.warn('The "synth" parameter with instrument will be deprecated in the future. Please use the "instrument" parameter instead.')),a.checkToneObjLoaded(a.instrument,e)}else if("string"==typeof i.instrument)a.instrument=new Tone[i.instrument]({context:o}),a.checkToneObjLoaded(a.instrument,e);else if(i.instrument)a.instrument=i.instrument,a.checkToneObjLoaded(a.instrument,e);else if(i.sample||i.buffer)a.instrument=new Tone.Player({url:i.sample||i.buffer,context:o,onload:function(){return a.checkToneObjLoaded(a.instrument,e)}});else if(i.samples)a.instrument=new Tone.Sampler({urls:i.samples,context:o,onload:function(){return a.checkToneObjLoaded(a.instrument,e)}});else if(i.sampler)a.instrument=i.sampler,a.checkToneObjLoaded(a.instrument,e);else if(i.player)a.instrument=i.player,a.checkToneObjLoaded(a.instrument,e);else{if(!i.external)throw new Error("One of required synth|instrument|sample|sampler|samples|buffer|player|external is not provided!");if(a.external=p({},i.external),a.instrument={context:o,volume:{value:0}},i.external.init)return i.external.init(o.rawContext).then(function(){e()}).catch(function(e){t(new Error("".concat(e.message," loading external output module of channel idx ").concat(a.idx,", ").concat(null!==(e=a.name)&&void 0!==e?e:"(no name)")))});e()}if(!a.instrument)throw new Error("Failed instantiating instrument from given params.")})},r.prototype.initInstrument=function(e,t){var n=this;return e=e||Tone.getContext(),t.external||(null===(t=this.instrument)||void 0===t?void 0:t.context)===e?new Promise(function(e,t){e()}):this.recreateToneObjectInContext(this.instrument,e).then(function(e){n.instrument=e})},r.prototype.adjustInstrument=function(e,n){var r=this;return e=e||Tone.getContext(),new Promise(function(e,t){n.volume&&r.setVolume(n.volume),e()})},r.prototype.initEffects=function(r,e){var o=this;r=r||Tone.getContext();function t(e){return"function"==typeof e.start?e.start():e}var n=(n=e.effects)?Array.isArray(n)?n:[n]:[];if(e.external){if(0!==n.length)throw new Error("Effects cannot be used with external output");return Promise.resolve()}return Promise.all(n.map(function(n){return new Promise(function(e,t){if("string"==typeof n)e(new Tone[n]({context:r}));else{if(n.context!==r)return o.recreateToneObjectInContext(n,r);e(n)}}).then(function(e){return e.toDestination()})})).then(function(e){return e.map(t)}).then(function(e){var t;(t=o.instrument).chain.apply(t,e).toDestination()})},Object.defineProperty(r.prototype,"clips",{get:function(){return this.channelClips},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"activeClipIdx",{get:function(){return this.activePatternIdx},enumerable:!1,configurable:!0}),r);function r(e){var n=this;this.idx=e.idx||0,this.name=e.name||"ch "+e.idx,this.activePatternIdx=-1,this.channelClips=[],this.clipNoteCount=0,e.clips,e.samples,e.sample,e.synth;var t=u(e,["clips","samples","sample","synth"]),r=(t.external,t.sampler,t.buffer,u(t,["external","sampler","buffer"])),o=(r.player,r.instrument,r.volume,u(r,["player","instrument","volume"])),i=o.eventCb,t=o.playerCb,r=(o.effects,u(o,["eventCb","playerCb","effects"])),o=r.context,a=void 0===o?Tone.getContext():o,s=u(r,["context"]);this.eventCbFn=i,this.playerCbFn=t,this.hasLoaded=!1,this.hasFailed=!1,this.initializerTask=this.initOutputProducer(a,e).then(function(){return n.initInstrument(a,e).then(function(){return n.adjustInstrument(a,e).then(function(){return n.initEffects(a,e)})})});var c=!1;try{e.clips.forEach(function(e,t){try{n.addClip(p(p({},e),s))}catch(e){throw new Error("".concat((0,f.errorHasMessage)(e)?e.message:e," in clip ").concat(t+1))}},this)}catch(e){c=e}this.initializerTask.then(function(){if(c)throw c;n.hasLoaded=!0,n.eventCb("loaded",{})}).catch(function(e){n.hasFailed=e,n.eventCb("error",{e:e})})}t.Channel=n},267:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.midi=void 0;var s=a(n(89)),c=i(n(126));t.midi=function(e,t,n){void 0===t&&(t="music.mid");n=l(e,n).toBytes();return null===t?n:(t.endsWith(".mid")||(t+=".mid"),"undefined"!=typeof window&&window.URL&&window.URL.createObjectURL?u(n,t):(s.default.writeFileSync(t,n,"binary"),void console.log("MIDI file generated: ".concat(t,"."))))};var u=function(e,t){for(var n=new Uint8Array(e.length),r=0;r<e.length;r++){var o=e.charCodeAt(r);n[r]=o}var i=new Blob([n],{type:"audio/midi"}),a=document.createElement("a");return a.href="undefined"!=typeof window&&void 0!==window.URL&&void 0!==window.URL.createObjectURL&&window.URL.createObjectURL(i)||"",a.download=t,a.innerText="Download MIDI file",a},l=function(e,t){var n=new c.File,r=new c.Track;"number"==typeof t&&r.setTempo(t),n.addTrack(r);for(var o=0,i=e;o<i.length;o++){var a=i[o],s=a.level||127;a.note?"string"==typeof a.note?(r.noteOn(0,a.note,a.length,s),r.noteOff(0,a.note,a.length,s)):r.addChord(0,a.note,a.length,s):r.noteOff(0,"",a.length)}return n}},668:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.progression=t.getChordsByProgression=t.getChordDegrees=void 0;var r=n(397),a=n(604);t.getChordDegrees=function(e){var t={ionian:["I","ii","iii","IV","V","vi","vii°"],dorian:["i","ii","III","IV","v","vi°","VII"],phrygian:["i","II","III","iv","v°","VI","vii"],lydian:["I","II","iii","iv°","V","vi","vii"],mixolydian:["I","ii","iii°","IV","v","vi","VII"],aeolian:["i","ii°","III","iv","v","VI","VII"],locrian:["i°","II","iii","iv","V","VI","vii"],"melodic minor":["i","ii","III+","IV","V","vi°","vii°"],"harmonic minor":["i","ii°","III+","iv","V","VI","vii°"]};return t.major=t.ionian,t.minor=t.aeolian,t[e]||[]};var i={i:0,ii:1,iii:2,iv:3,v:4,vi:5,vii:6};t.getChordsByProgression=function(e,t){var n=e.split(" ");n[0].match(/\d/)||(n[0]+="4",e=n.join(" "));var o=(0,r.scale)(e);return t.replace(/\s*,+\s*/g," ").split(" ").map(function(e){var t,n,r,t=(n=(t=e).replace(/\W/g,""),r="M",n.toLowerCase()===n&&(r="m"),-1<t.indexOf("°")?r+"7b5":-1<t.indexOf("+")?r+"#5":-1<t.indexOf("7")?"M"===r?"maj7":"m7":r),r=i[e.replace(/\W|\d/g,"").toLowerCase()],e=o[r],r=e.replace(/\D+/,"");return e.replace(/\d/,"")+t+"_"+r}).toString().replace(/,/g," ")};var n=function(e){var r=e.T,o=e.P,i=e.D;return function(e){void 0===e&&(e=4);var t=[];t.push((0,a.pickOne)(r));var n=1;for(n<e-1&&(t.push((0,a.pickOne)(o)),n++),n<e-1&&(0,a.dice)()&&(t.push((0,a.pickOne)(o)),n++),n<e-1&&(t.push((0,a.pickOne)(i)),n++),n<e-1&&(t.push((0,a.pickOne)(o)),n++),n<e-1&&(t.push((0,a.pickOne)(i)),n++),n<e-1&&(0,a.dice)()&&(t.push((0,a.pickOne)(o)),n++);n<e;)t.push((0,a.pickOne)(i)),n++;return t}},o=n({T:["I","vi"],P:["ii","IV"],D:["V"]}),s=n({T:["i","VI"],P:["ii","iv"],D:["V"]});t.progression=function(e,t){return void 0===t&&(t=4),"major"===e||"M"===e?o(t):"minor"===e||"m"===e?s(t):[]}},484:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var r=n(594),n=(o.prototype.uniqueIdx=function(e,t){if(!e)return t||0;var n=e.reduce(function(e,t){return!e.find(function(e){return e===t.idx})&&e.concat(t.idx)||e},[]);if(t&&!n.find(function(e){return e===t}))return t;for(var r=e.length;n.find(function(e){return e===r});)r+=1;return r},o.prototype.createChannel=function(e){e.idx=this.uniqueIdx(this.sessionChannels,e.idx);e=new r.Channel(e);return this.sessionChannels.push(e),e},Object.defineProperty(o.prototype,"channels",{get:function(){return this.sessionChannels},enumerable:!1,configurable:!0}),o.prototype.setTransportTempo=function(e){r.Channel.setTransportTempo(e)},o.prototype.startTransport=function(){r.Channel.startTransport()},o.prototype.stopTransport=function(e){r.Channel.stopTransport(e=void 0===e?!0:e)},o.prototype.startRow=function(t){this.sessionChannels.forEach(function(e){e.startClip(t)})},o.prototype.play=function(e){function c(e,t){e.forEach(function(e){return e.stop(t)})}var u=this,t=e.channelPatterns,e=e.clipDuration||"4:0:0",l=Tone.Time(e).toSeconds();t.forEach(function(e){var o=e.channelIdx,e=e.pattern,i=[],a=0,s="-";e.split("").forEach(function(e){var t,n,r;e!==s&&"_"!==e&&(c(i,a),t=o,r=a,i="-"===(n=e)?[]:u.channels.filter(function(e){return e.idx===t}).map(function(e){return null===(e=e.clips[n])||void 0===e?void 0:e.start(r)})),s=e,a+=l}),c(i,a)})},o);function o(e){var n=this;this.sessionChannels=(e=e||[]).map(function(e,t){return e.idx=e.idx||t,e.idx=n.uniqueIdx(n.sessionChannels,e.idx),new r.Channel(e)})}t.Session=n},604:(e,n,t)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.randomInt=n.convertChordsToNotes=n.convertChordToNotes=n.errorHasMessage=n.flat=n.dice=n.pickOne=n.sizzleMap=n.shuffle=n.expandStr=n.isNote=void 0;var i=t(397);n.isNote=function(e){return/^[a-gA-G](?:#|b)?\d$/.test(e)},n.expandStr=function(e){return e=(e=(e=(e=JSON.stringify(e.split(""))).replace(/,"\[",/g,", [")).replace(/"\[",/g,"[")).replace(/,"\]"/g,"]"),JSON.parse(e)},n.shuffle=function(r,o){void 0===o&&(o=!0);var i=r.length-1;return r.forEach(function(e,t){var n;i<=t||(n=o?Math.floor(Math.random()*(i-t))+1+t:Math.floor(Math.random()*(1+i-t))+t,r[t]=r[n],r[n]=e)}),r},n.sizzleMap=function(t){void 0===t&&(t=127);var e=Math.PI,n=[e/6,e/4,e/3,e/2,2*e/3,3*e/4,5*e/6,e],e=[0,e/6,e/4,e/3,e/2,2*e/3,3*e/4,5*e/6];return e.reverse(),n.concat(e).map(function(e){return Math.round(Math.sin(e)*t)})},n.pickOne=function(e){return 1<e.length?e[Math.round(Math.random())]:e[0]},n.dice=function(){return!!Math.round(Math.random())},n.flat=function(e){return e.reduce(function(e,t){return e.concat(t)},[])},n.errorHasMessage=function(e){return"string"==typeof e.message},n.convertChordToNotes=function(e){var t,n,r,o;try{t=(0,i.inlineChord)(e)}catch(e){r=e}try{n=(0,i.chord)(e.replace(/_/g," "))}catch(e){o=e}if(r||o)return r?o?(0,i.chord)(e):n:t;if(t.toString()!==n.toString())throw new Error("Chord ".concat(e," cannot decode, guessing ").concat(t," or ").concat(n));return t},n.convertChordsToNotes=function(e){if("string"==typeof e&&(0,n.isNote)(e))return[e];if(Array.isArray(e))return e.forEach(function(e){if(Array.isArray(e))e.forEach(function(e){if("string"!=typeof e||!(0,n.isNote)(e))throw new TypeError("array of arrays must comprise valid notes")});else if("string"!=typeof e||!(0,n.isNote)(e))throw new TypeError("array must comprise valid notes")}),e;if(!Array.isArray(e)){var t=(0,n.convertChordToNotes)(e);if(t&&t.length)return t}throw new Error("Chord ".concat(e," not found"))},n.randomInt=function(e){return void 0===e&&(e=1),Math.round(Math.random()*e)}},89:e=>{"use strict";e.exports=t}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;t=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.loaded=!0,t.exports}s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var c={};return(()=>{"use strict";var e=c;Object.defineProperty(e,"__esModule",{value:!0}),e.Session=e.midi=e.arp=e.progression=e.getChordsByProgression=e.getChordDegrees=e.clip=e.chords=e.chord=e.modes=e.scales=e.mode=e.scale=void 0;var t=s(397);Object.defineProperty(e,"scales",{enumerable:!0,get:function(){return t.scales}}),Object.defineProperty(e,"modes",{enumerable:!0,get:function(){return t.scales}}),Object.defineProperty(e,"chords",{enumerable:!0,get:function(){return t.chords}}),Object.defineProperty(e,"scale",{enumerable:!0,get:function(){return t.scale}}),Object.defineProperty(e,"mode",{enumerable:!0,get:function(){return t.scale}}),Object.defineProperty(e,"chord",{enumerable:!0,get:function(){return t.chord}});var n=s(378);Object.defineProperty(e,"clip",{enumerable:!0,get:function(){return n.clip}});var r=s(668);Object.defineProperty(e,"getChordDegrees",{enumerable:!0,get:function(){return r.getChordDegrees}}),Object.defineProperty(e,"getChordsByProgression",{enumerable:!0,get:function(){return r.getChordsByProgression}}),Object.defineProperty(e,"progression",{enumerable:!0,get:function(){return r.progression}});var o=s(148);Object.defineProperty(e,"arp",{enumerable:!0,get:function(){return o.arp}});var i=s(267);Object.defineProperty(e,"midi",{enumerable:!0,get:function(){return i.midi}});var a=s(484);Object.defineProperty(e,"Session",{enumerable:!0,get:function(){return a.Session}})})(),c})()});