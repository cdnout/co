!function(window){"use strict";var FilterJS=function(t,i,e,s){return new _FilterJS(t,i,e,s)};FilterJS.VERSION="1.5.1",$.fn.filterjs=function(t,i,e){var s=$(this);s.data("fjs")||s.data("fjs",new _FilterJS(t,s,i,e))},window.FilterJS=FilterJS;var _FilterJS=function(t,i,e,s){var r,n=0;this.data=t,this.view=e,this.container=i,this.options=s||{},this.categories_map={},this.record_ids=[],this.data.constructor!=Array&&(this.data=[this.data]);for(r in this.data[0])this.root=r,n+=1;return 1==n?this.getRecord=function(t,i){return i[t][this.root]}:(this.getRecord=function(t,i){return i[t]},this.root="fjs"),this.id_field=this.options.id_field||"id",this.render(this.data),this.parseOptions(),this.buildCategoryMap(this.data),this.bindEvents(),this.options.callbacks=this.options.callbacks||{},this.execCallBack("after_init",this.record_ids),this.execCallBack("after_add",this.data),this.options.filter_types=this.options.filter_types||{},this.options.filter_types.range||(this.options.filter_types.range=this.rangeFilter),this.options.streaming=this.options.streaming||{},this.options.streaming.data_url&&(this.options.streaming.stream_after=1e3*(this.options.streaming.stream_after||2),this.options.streaming.batch_size=this.options.streaming.batch_size||!1,this.streamData(this.options.streaming.stream_after)),void 0!=this.options.filter_on_init&&1!=this.options.filter_on_init||(this.options.filter_on_init=!0,this.filter()),this};_FilterJS.prototype={render:function(t,i){var e,s,r=$(this.container);if(t)for(var n=0,o=t.length;n<o;n++)e=this.getRecord(n,t),s=$(this.view(e)),s.attr({id:this.root+"_"+e[this.id_field],"data-fjs":!0}),s=r.append(s)},bindEvents:function(){var t=this,i=this.options.selectors,e=0,s=i.length;for(e;e<s;e++)this.bindSelectorEvent(i[e],t);this.options.search&&$(this.options.search.input).on("keyup",function(i){t.filter()})},bindSelectorEvent:function(t,i){$(t.element).on(t.events,function(t){i.filter()})},clear:function(){var t=this.options.selectors,i=0,e=t.length;for(i;i<e;i++)$(t[i].element).off(t[i].events);this.options.search&&$(this.options.search.input).off("keyup"),this.category_map=null,this.record_ids=null},filter:function(){var t,i,e,s,r=!1,n=0,o=this.options.selectors.length;if(o){for(n;n<o;n++)i=this.options.selectors[n],e=$(i.element).filter(i.select).map(function(){return $(this).val()}),e.length?(s=this.findObjects(e,this.categories_map[i.name],this.options.filter_types[i.type]),t=$.grep(t||this.record_ids,function(t){return s.indexOf(t)!=-1})):r=!0;r&&this.options.and_filter_on&&(t=[])}else t=this.record_ids;this.options.search&&(t=this.search(this.options.search,t)),this.hideShow(t),this.execCallBack("after_filter",t)},findObjects:function(t,i,e){var s,r,n=[],o=0,a=t.length;for(o;o<a;o++)r=t[o],s=e?$.map(i,function(t,i){if(e(r,i))return t}):i.constructor==Array?i:i[r],s&&(n=n.concat(s));return n},buildEvalString:function(t){var i,e=t.split(".ARRAY."),s=1,r=e.length;for(i=e[0],s;s<r;s++)i+=".filter_collect('"+e[s]+"')";return i},addFilterCriteria:function(t,i,e){this.categories_map[t]={};var s=this.parseSelectorOptions({name:t},[i]);e=e||$(s.element).data("ids")||[],this.options.selectors.push(s),this.categories_map[t]=e,this.bindSelectorEvent(s,this)},parseOptions:function(){var t,i,e,s=this.options.filter_criteria;this.options.selectors=[];for(e in s)i=s[e],t=this.parseSelectorOptions({name:e},i),this.options.selectors.push(t),i.push(this.buildEvalString(i[1])),this.categories_map[e]={}},parseSelectorOptions:function(t,i){t.element=i[0].split(/.EVENT.|.SELECT.|.TYPE./)[0],t.events=(i[0].match(/.EVENT.(\S*)/)||[])[1],t.select=(i[0].match(/.SELECT.(\S*)/)||[])[1],t.type=(i[0].match(/.TYPE.(\S*)/)||[])[1];var e=$(t.element),s=e.attr("type");return t.select||("INPUT"==e.get(0).tagName?"checkbox"==s||"radio"==s?t.select=":checked":"hidden"!=s&&"text"!=s||(t.select=":input"):"SELECT"==e.get(0).tagName&&(t.select="select")),t.events||("checkbox"==s||"radio"==s?t.events="click":"hidden"!=s&&"SELECT"!=e.get(0).tagName||(t.events="change")),t},buildCategoryMap:function(data){for(var filter_criteria=this.options.filter_criteria,record,categories,obj,x,i=0,l=data.length;i<l;i++){record=this.getRecord(i,data),this.record_ids.push(record[this.id_field]);for(name in filter_criteria)if(categories=eval("record."+filter_criteria[name][2]),obj=this.categories_map[name],categories&&categories.constructor==Array)for(var j=0,lj=categories.length;j<lj;j++)x=categories[j],obj[x]?obj[x].push(record[this.id_field]):obj[x]=[record[this.id_field]];else obj[categories]?obj[categories].push(record[this.id_field]):obj[categories]=[record[this.id_field]]}},hideShow:function(t){var i="#"+this.root+"_",e=0,s=t.length;for($(this.container+" > *[data-fjs]").hide(),e;e<s;e++)$(i+t[e]).show()},search:function(t,i){var e=$.trim($(t.input).val()),s=t.search_in,r=$.isNumeric(t.min_length)?t.min_length:1;if(e.length<r)return i;var n="#"+this.root+"_";return e=e.toUpperCase(),$.map(i,function(t){var i=$(n+t);if(s&&(i=i.find(s)),i.text().toUpperCase().indexOf(e)>=0)return t})},execCallBack:function(t,i){this.options.callbacks[t]&&this.options.callbacks[t].call(this,i)},rangeFilter:function(t,i){var e=t.split("-");if(2==e.length&&("below"==e[0]&&(e[0]=-(1/0)),"above"==e[1]&&(e[1]=1/0),Number(i)>=e[0]&&Number(i)<=e[1]))return!0},getRecordsByIds:function(t){var i,e=[],s=0,r=this.data.length;for(s;s<r;s++)i=this.getRecord(s,this.data),t.indexOf(i[this.id_field])!=-1&&e.push(i);return e},addData:function(t){if(void 0!=t&&0!=t.length){t.length,"#"+this.root+"_";this.execCallBack("before_add",t),this.data=this.data.concat(t),this.render(t),this.buildCategoryMap(t),this.execCallBack("after_add",t),this.filter()}},setStreamingTimer:function(){var t=this,i=this.options.streaming.batch_size?setInterval:setTimeout;return i(function(){t.streamData()},this.options.streaming.stream_after)},clearStreamingTimer:function(){this.timer&&clearTimeout(this.timer)},fetchData:function(){var t=this,i=this.options.params||{},e=this.options.streaming;i.offset=this.data.length,e.batch_size&&(i.limit=e.batch_size),this.options.search&&(i.q=$.trim($(this.options.search.input).val())),$.getJSON(e.data_url,i).done(function(e){null==i.limit||e&&e.length?(t.setStreamInterval(),t.addData(e)):t.stopStreaming()}).fail(function(i){t.stopStreaming()})},setStreamInterval:function(){var t=this;1!=t.options.streaming.stop_streaming&&(t.timer=setTimeout(function(){t.fetchData()},t.options.streaming.stream_after))},stopStreaming:function(){this.options.streaming.stop_streaming=!0,this.timer&&clearTimeout(this.timer)},resumeStreaming:function(){this.options.streaming.stop_streaming=!1,this.streamData(this.options.streaming.stream_after)},streamData:function(t){this.setStreamInterval(),this.options.streaming.batch_size||this.stopStreaming()}}}(this),Array.prototype.filter_collect=function(t,i){for(var i=i||[],e=0,s=this.length;e<s;e++){var r=this[e];r.constructor==Array?r.filter_collect(t,i):i.push(r[t])}return i},Array.prototype.indexOf||(Array.prototype.indexOf=function(t,i){for(var e=i||0,s=this.length;e<s;e++)if(this[e]===t)return e;return-1});
//# sourceMappingURL=filter.min.js.map