!function(a){"function"==typeof define&&define.amd?define(["jquery","./core","./touch"],a):a(jQuery,Formstone)}(function(a,t){"use strict";function l(){b=a(f.element)}function i(a){a.stepCount=(a.max-a.min)/a.step,a.offset=a.$track.offset(),a.vertical?(a.trackHeight=a.$track.outerHeight(),a.handleHeight=a.$handle.outerHeight(),a.increment=a.trackHeight/a.stepCount):(a.trackWidth=a.$track.outerWidth(),a.handleWidth=a.$handle.outerWidth(),a.increment=a.trackWidth/a.stepCount);var t=(a.$el.val()-a.min)/(a.max-a.min);e(a,t,!0)}function n(a){p.killEvent(a);var t=a.data;t.disabled||(i(t),s(a),t.$container.addClass(h.focus))}function s(a){p.killEvent();var t=a.data;t.disabled||e(t,t.vertical?1-(a.pageY-t.offset.top)/t.trackHeight:(a.pageX-t.offset.left)/t.trackWidth)}function r(a){p.killEvent(a);a=a.data;a.disabled||a.$container.removeClass(h.focus)}function o(a){a.data.$container.addClass(h.focus)}function c(a){a.data.$container.removeClass(h.focus)}function e(a,t,e){1<a.increment&&(t=a.vertical?Math.round(t*a.stepCount)*a.increment/a.trackHeight:Math.round(t*a.stepCount)*a.increment/a.trackWidth),t<0&&(t=0),1<t&&(t=1);var l=(a.min-a.max)*t,l=-parseFloat(l.toFixed(a.digits));a.$fill.css(a.vertical?"height":"width",100*t+"%"),a.$handle.css(a.vertical?"bottom":"left",100*t+"%"),(l+=a.min)!==a.value&&!1!==l&&!0!==e&&(a.$el.val(l).trigger(u.raw.change,[!0]),a.value=l)}function d(a,t){a=a.data;t||a.disabled||(t=(a.$el.val()-a.min)/(a.max-a.min),e(a,t))}function m(a){a=a.toString().split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a.join(".")}var t=t.Plugin("range",{widget:!0,defaults:{customClass:"",fill:!1,formatter:!1,labels:{max:!1,min:!1},theme:"fs-light",vertical:!1},classes:["track","handle","fill","marker","labels","label","label_min","label_max","vertical","focus","disabled"],methods:{_construct:function(a){a.formatter||(a.formatter=m),a.min=parseFloat(this.attr("min"))||0,a.max=parseFloat(this.attr("max"))||100,a.step=parseFloat(this.attr("step"))||1,a.digits=a.step.toString().length-a.step.toString().indexOf("."),a.value=parseFloat(this.val())||a.min+(a.max-a.min)/2;var t="";a.vertical="vertical"===this.attr("orient")||a.vertical,a.disabled=this.is(":disabled")||this.is("[readonly]"),t+='<div class="'+h.track+'" aria-hidden="true">',a.fill&&(t+='<span class="'+h.fill+'"></span>'),t+='<div class="'+h.handle+'" role="slider">',t+='<span class="'+h.marker+'"></span>',t+="</div>",t+="</div>";var e=[h.base,a.theme,a.customClass,a.vertical?h.vertical:"",a.labels?h.labels:"",a.disabled?h.disabled:""];this.addClass(h.element).wrap('<div class="'+e.join(" ")+'"></div>').after(t),a.$container=this.parents(f.base),a.$track=a.$container.find(f.track),a.$fill=a.$container.find(f.fill),a.$handle=a.$container.find(f.handle),a.$output=a.$container.find(f.output),a.labels&&(e='<span class="'+[h.label,h.label_max].join(" ")+'">'+a.formatter.call(this,a.labels.max||a.max)+"</span>",t='<span class="'+[h.label,h.label_min].join(" ")+'">'+a.formatter.call(this,(a.labels.max?a.labels:a).min)+"</span>",a.$container.prepend(a.vertical?e:t).append(a.vertical?t:e)),a.$labels=a.$container.find(f.label),this.on(u.focus,a,o).on(u.blur,a,c).on(u.change,a,d),a.$container.fsTouch({pan:!0,axis:a.vertical?"y":"x"}).on(u.panStart,a,n).on(u.pan,a,s).on(u.panEnd,a,r),l(),i.call(this,a)},_destruct:function(a){a.$container.off(u.namespace).fsTouch("destroy"),a.$track.remove(),a.$labels.remove(),this.unwrap().removeClass(h.element).off(u.namespace),l()},_resize:function(a){p.iterate.call(b,i)},enable:function(a){a.disabled&&(this.prop("disabled",!1),a.$container.removeClass(h.disabled),a.disabled=!1)},disable:function(a){a.disabled||(this.prop("disabled",!0),a.$container.addClass(h.disabled),a.disabled=!0)},resize:i,update:function(a){a.min=parseFloat(a.$el.attr("min"))||0,a.max=parseFloat(a.$el.attr("max"))||100,a.step=parseFloat(a.$el.attr("step"))||1,a.digits=a.step.toString().length-a.step.toString().indexOf("."),a.value=parseFloat(this.val())||a.min+(a.max-a.min)/2,a.labels&&(a.$labels.filter(f.label_max).html(a.formatter.call(this,a.labels.max||a.max)),a.$labels.filter(f.label_min).html(a.formatter.call(this,(a.labels.max?a.labels:a).min))),i.call(this,a)}}}),f=t.classes,h=f.raw,u=t.events,p=t.functions,b=[]});