!function(e){"function"==typeof define&&define.amd?define(["jquery","./core","./mediaquery"],e):e(jQuery,Formstone)}(function(c,i){"use strict";function t(){f.scrollDepth&&l()}function n(){var e,t=c(this),n=void 0!==t[0].href?t[0].href:"",o=document.domain.split(".").reverse(),o=null!==n.match(o[1]+"."+o[0]);n.match(/^mailto\:/i)?e="Email, Click, "+n.replace(/^mailto\:/i,""):n.match(/^tel\:/i)?e="Telephone, Click, "+n.replace(/^tel\:/i,""):n.match(f.fileTypes)?e="File, Download:"+(/[.]/.exec(n)?/[^.]+$/.exec(n):void 0)[0]+", "+n.replace(/ /g,"-"):o||(e="ExternalLink, Click, "+n),e&&t.attr(w,e)}function o(e){h.startTimer(T,250,a)}function a(){for(var e=u.scrollTop()+i.windowHeight,t=1/f.scrollStops,n=t,o=1;o<=f.scrollStops;o++){var a=Math.round(100*n).toString();!x[k][a].passed&&e>x[k][a].edge&&(x[k][a].passed=!0,s(c.extend(f.scrollFields,{eventCategory:"ScrollDepth",eventAction:k,eventLabel:a,nonInteraction:!0}))),n+=t}}function l(){var e,t,n=c.mediaquery("state"),o=v.outerHeight(),a={},i=1/f.scrollStops,l=i;n.minWidth&&(k="MinWidth:"+n.minWidth+"px");for(var r=1;r<=f.scrollStops;r++)e=parseInt(o*l),a[t=Math.round(100*l).toString()]={edge:"100"===t?e-10:e,passsed:!(!x[k]||!x[k][t])&&x[k][t].passed},l+=i;x[k]=a}function r(e){var t,n=c(this),o=n.attr("href"),a=n.data(g).split(",");for(t in f.eventCallback&&e.preventDefault(),a)a.hasOwnProperty(t)&&(a[t]=c.trim(a[t]));s({eventCategory:a[0],eventAction:a[1],eventLabel:a[2]||o,eventValue:a[3],nonInteraction:a[4]},n)}function s(e,t){d.location;var n,o=c.extend({hitType:"event"},e);void 0===t||t.attr("data-analytics-stop")||(e=void 0!==t[0].href?t[0].href:"",""!==(n=!e.match(/^mailto\:/i)&&!e.match(/^tel\:/i)&&e.indexOf(":")<0?d.location.protocol+"//"+d.location.hostname+"/"+e:e)&&((t=t.attr("target"))?d.open(n,t):f.eventCallback&&(o[t="hitCallback"]=function(){var e;b&&(h.clearTimer(b),e=n,document.location=e)},b=h.startTimer(b,f.eventTimeout,o[t])))),p(o)}function p(e){if("function"==typeof d.ga&&"function"==typeof d.ga.getAll)for(var t=d.ga.getAll(),n=0,o=t.length;n<o;n++)d.ga(t[n].get("name")+".send",e)}var e=i.Plugin("analytics",{methods:{_resize:t},utilities:{_delegate:function(){if(arguments.length&&"object"!=typeof arguments[0])if("destroy"===arguments[0])(function(){y&&v&&v.length&&(u.off(m.namespace),v.off(m.namespace),y=!1)}).apply(this);else{var e=Array.prototype.slice.call(arguments,1);switch(arguments[0]){case"pageview":(function(e){p(c.extend({hitType:"pageview"},e))}).apply(this,e);break;case"event":s.apply(this,e)}}else(function(e){!y&&v&&v.length&&(y=!0,(f=c.extend(f,e||{})).autoEvents&&v.find("a").not("["+w+"]").each(n),f.scrollDepth&&(l(),u.on(m.scroll,o).one(m.load,t)),v.on(m.click,"*["+w+"]",r))}).apply(this,arguments);return null}}}),f={autoEvents:!1,fileTypes:/\.(zip|exe|dmg|pdf|doc.*|xls.*|ppt.*|mp3|txt|rar|wma|mov|avi|wmv|flv|wav)$/i,eventCallback:!1,eventTimeout:1e3,scrollDepth:!1,scrollStops:5,scrollFields:{}},d=i.window,u=i.$window,v=null,h=e.functions,m=e.events,y=!1,g="analytics-event",w="data-"+g,x={},T=null,k="Site",b=null;i.Ready(function(){v=i.$body})});