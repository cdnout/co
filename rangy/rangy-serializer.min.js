(function(b,a){if(typeof define=="function"&&define.amd){define(["./rangy-core"],b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b(require("rangy"))}else{b(a.rangy)}}})(function(a){a.createModule("Serializer",["WrappedSelection"],function(r,c){var s="undefined";var b=r.util;if(typeof encodeURIComponent==s||typeof decodeURIComponent==s){c.fail("encodeURIComponent and/or decodeURIComponent method is missing")}var g=(function(){function A(E){var D=[];for(var C=0,B=E.length,F;C<B;++C){F=E.charCodeAt(C);if(F<128){D.push(F)}else{if(F<2048){D.push((F>>6)|192,(F&63)|128)}else{D.push((F>>12)|224,((F>>6)&63)|128,(F&63)|128)}}}return D}var y=null;function x(){var D=[];for(var C=0,B,E;C<256;++C){E=C;B=8;while(B--){if((E&1)==1){E=(E>>>1)^3988292384}else{E>>>=1}}D[C]=E>>>0}return D}function z(){if(!y){y=x()}return y}return function(G){var F=A(G),E=-1,C=z();for(var D=0,B=F.length,H;D<B;++D){H=(E^F[D])&255;E=(E>>>8)^C[H]}return(E^-1)>>>0}})();var t=r.dom;function f(x){return x.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function q(A,z){z=z||[];var D=A.nodeType,y=A.childNodes,C=y.length;var F=[D,A.nodeName,C].join(":");var x="",B="";switch(D){case 3:x=f(A.nodeValue);break;case 8:x="<!--"+f(A.nodeValue)+"-->";break;default:x="<"+F+">";B="</>";break}if(x){z.push(x)}for(var E=0;E<C;++E){q(y[E],z)}if(B){z.push(B)}return z}function d(x){var y=q(x).join("");return g(y).toString(16)}function h(z,A,x){var y=[],B=z;x=x||t.getDocument(z).documentElement;while(B&&B!=x){y.push(t.getNodeIndex(B,true));B=B.parentNode}return y.join("/")+":"+A}function e(D,x,C){if(!x){x=(C||document).documentElement}var B=D.split(":");var A=x;var z=B[0]?B[0].split("/"):[],y=z.length,E;while(y--){E=parseInt(z[y],10);if(E<A.childNodes.length){A=A.childNodes[E]}else{throw c.createError("deserializePosition() failed: node "+t.inspectNode(A)+" has no child with index "+E+", "+y)}}return new t.DomPosition(A,parseInt(B[1],10))}function j(y,A,x){x=x||r.DomRange.getRangeDocument(y).documentElement;if(!t.isOrIsAncestorOf(x,y.commonAncestorContainer)){throw c.createError("serializeRange(): range "+y.inspect()+" is not wholly contained within specified root node "+t.inspectNode(x))}var z=h(y.startContainer,y.startOffset,x)+","+h(y.endContainer,y.endOffset,x);if(!A){z+="{"+d(x)+"}"}return z}var v=/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/;function i(B,z,E){if(z){E=E||t.getDocument(z)}else{E=E||document;z=E.documentElement}var F=v.exec(B);var D=F[4];if(D){var x=d(z);if(D!==x){throw c.createError("deserializeRange(): checksums of serialized range root node ("+D+") and target root node ("+x+") do not match")}}var y=e(F[1],z,E),A=e(F[2],z,E);var C=r.createRange(E);C.setStartAndEnd(y.node,y.offset,A.node,A.offset);return C}function m(B,y,A){if(!y){y=(A||document).documentElement}var x=v.exec(B);var z=x[3];return !z||z===d(y)}function k(C,D,A){C=r.getSelection(C);var y=C.getAllRanges(),z=[];for(var B=0,x=y.length;B<x;++B){z[B]=j(y[B],D,A)}return z.join("|")}function w(E,A,D){if(A){D=D||t.getWindow(A)}else{D=D||window;A=D.document.documentElement}var z=E.split("|");var C=r.getSelection(D);var y=[];for(var B=0,x=z.length;B<x;++B){y[B]=i(z[B],A,D.document)}C.setRanges(y);return C}function l(D,z,C){var B;if(z){B=C?C.document:t.getDocument(z)}else{C=C||window;z=C.document.documentElement}var y=D.split("|");for(var A=0,x=y.length;A<x;++A){if(!m(y[A],z,B)){return false}}return true}var u="rangySerializedSelection";function p(z){var A=z.split(/[;,]/);for(var y=0,x=A.length,C,B;y<x;++y){C=A[y].split("=");if(C[0].replace(/^\s+/,"")==u){B=C[1];if(B){return decodeURIComponent(B.replace(/\s+$/,""))}}}return null}function n(y){y=y||window;var x=p(y.document.cookie);if(x){w(x,y.doc)}}function o(D,y){D=D||window;y=(typeof y=="object")?y:{};var x=y.expires?";expires="+y.expires.toUTCString():"";var C=y.path?";path="+y.path:"";var z=y.domain?";domain="+y.domain:"";var B=y.secure?";secure":"";var A=k(r.getSelection(D));D.document.cookie=encodeURIComponent(u)+"="+encodeURIComponent(A)+x+C+z+B}b.extend(r,{serializePosition:h,deserializePosition:e,serializeRange:j,deserializeRange:i,canDeserializeRange:m,serializeSelection:k,deserializeSelection:w,canDeserializeSelection:l,restoreSelectionFromCookie:n,saveSelectionCookie:o,getElementChecksum:d,nodeToInfoString:q});b.crc32=g});return a},this);