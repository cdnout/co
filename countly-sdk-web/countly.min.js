(function(d,z){"function"===typeof define&&define.amd?define([],function(){return z(d.Countly)}):"object"===typeof module&&module.exports?module.exports=z(d.Countly):d.Countly=z(d.Countly)})("undefined"!==typeof window?window:this,function(d){function z(b){var l=[];if("undefined"!==typeof b.options)for(var d=0;d<b.options.length;d++)b.options[d].selected&&l.push(b.options[d].value);return l.join(", ")}function na(){var b=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(d){var g=(b+16*Math.random())%16|0;b=Math.floor(b/16);return("x"===d?g:g&3|8).toString(16)})}function n(){return Math.floor((new Date).getTime()/1E3)}function Z(){var b=(new Date).getTime();B>=b?B++:B=b;return B}function g(b,l,g){if(l&&Object.keys(l).length){if("undefined"!==typeof l[b])return l[b]}else if("undefined"!==typeof d[b])return d[b];return g}function $(b,l,g){for(var m in d.i)d.i[m].tracking_crashes&&d.i[m].recordError(b,l,g)}function oa(b){var d=[],g;for(g in b)d.push(g+"="+encodeURIComponent(b[g]));
return d.join("&")}function aa(b){return"/"===b.substr(b.length-1)?b.substr(0,b.length-1):b}function C(b,d){for(var g={},m,n=0;n<d.length;n++)m=d[n],"undefined"!==typeof b[m]&&(g[m]=b[m]);return g}function ba(b){"undefined"===typeof b.pageY&&("number"===typeof b.clientX&&document.documentElement)&&(b.pageX=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.pageY=b.clientY+document.body.scrollTop+document.documentElement.scrollTop);return b}function R(){var b=document;return Math.max(Math.max(b.body.scrollHeight,
b.documentElement.scrollHeight),Math.max(b.body.offsetHeight,b.documentElement.offsetHeight),Math.max(b.body.clientHeight,b.documentElement.clientHeight))}function ca(){var b=document;return Math.max(Math.max(b.body.scrollWidth,b.documentElement.scrollWidth),Math.max(b.body.offsetWidth,b.documentElement.offsetWidth),Math.max(b.body.clientWidth,b.documentElement.clientWidth))}function pa(){var b=document;return Math.min(Math.min(b.body.clientHeight,b.documentElement.clientHeight),Math.min(b.body.offsetHeight,
b.documentElement.offsetHeight),window.innerHeight)}function qa(b){if(b)for(var d in b)if(Object.prototype.hasOwnProperty.call(b,d))return!0;return!1}function Q(b,d,g,m,n,z){var b=document.createElement(b),C;b.setAttribute(d,g);b.setAttribute(m,n);z&&(b.onreadystatechange=b.onload=function(){C||z();C=!0});document.getElementsByTagName("head")[0].appendChild(b)}function ra(b,d){Q("script","type","text/javascript","src",b,d)}function da(b,d){Q("link","rel","stylesheet","href",b,d)}function sa(){var b=
document.getElementById("cly-loader");if(!b){var b=document.head||document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css";d.styleSheet?d.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
d.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
b.appendChild(d);b=document.createElement("div");b.setAttribute("id","cly-loader");document.body.appendChild(b)}b.style.display="block"}function ta(){var b=document.getElementById("cly-loader");b&&(b.style.display="none")}d=d||{};d.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm feedback remote-config".split(" ");d.utm={source:!0,medium:!0,campaign:!0,term:!0,content:!0};d.q=d.q||[];d.onload=d.onload||[];var ea="20.11.0",ua="javascript_native_web",
va=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,Fa=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/;
d.CountlyClass=function(b){function l(a){if(!e.ignore_visitor)if(a.key){a.count||(a.count=1);var f=C(a,["key","count","sum","dur","segmentation"]);f.timestamp=Z();var k=new Date;f.hour=k.getHours();f.dow=k.getDay();t.push(f);h("cly_event",t);j("Adding event: ",a)}else j("Event must have key property")}function ma(){e.ignore_prefetch&&("undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState)&&(e.ignore_visitor=!0);e.ignore_bots&&Fa.test(navigator.userAgent)&&(e.ignore_visitor=
!0)}function B(a,f){try{var k=document.createElement("div");k.className="countly-iframe-wrapper";k.id="countly-iframe-wrapper-"+a._id;var b=document.createElement("span");b.className="countly-feedback-close-icon";b.id="countly-feedback-close-icon-"+a._id;b.innerText="x";var d=document.createElement("iframe");d.name="countly-feedback-iframe";d.id="countly-feedback-iframe";d.src=e.url+"/feedback?widget_id="+a._id+"&app_key="+e.app_key+"&device_id="+e.device_id+"&sdk_version="+ea;document.body.appendChild(k);
k.appendChild(b);k.appendChild(d);m(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(f){var c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.id="feedback-sticker-svg";c.setAttribute("aria-hidden","true");c.setAttribute("data-prefix","far");c.setAttribute("data-icon","grin");c.setAttribute("class","svg-inline--fa fa-grin fa-w-16");
c.setAttribute("role","img");c.setAttribute("xmlns","http://www.w3.org/2000/svg");c.setAttribute("viewBox","0 0 496 512");var r=document.createElementNS("http://www.w3.org/2000/svg","path");r.id="smileyPathInStickerSvg";r.setAttribute("fill","white");r.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");
var h=document.createElement("span");h.innerText=a.trigger_button_text;var g=document.createElement("div");g.style.color=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color;g.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;g.className="countly-feedback-sticker  "+a.trigger_position+"-"+a.trigger_size;g.id="countly-feedback-sticker-"+a._id;c.appendChild(r);g.appendChild(c);g.appendChild(h);document.body.appendChild(g);var l=document.getElementById("smileyPathInStickerSvg");
l&&(l.style.fill=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color);m(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(n){j("Somethings went wrong while element injecting process: "+
n)}}function J(){var a;if("undefined"!==typeof e.onload&&0<e.onload.length){for(a=0;a<e.onload.length;a++)if("function"===typeof e.onload[a])e.onload[a](e);e.onload=[]}}function K(){if(L){var a={name:L};e.check_consent("views")&&l({key:"[CLY]_view",dur:M?n()-S:T,segmentation:a});L=null}}function Q(){if(fa){var a=h("cly_session");if(!a||parseInt(a)<=n())F=!1,e.begin_session(!U);h("cly_session",n()+60*wa)}}function xa(a){a.app_key=e.app_key;a.device_id=e.device_id;a.sdk_name=ua;a.sdk_version=ea;e.check_consent("location")?
(e.country_code&&(a.country_code=e.country_code),e.city&&(a.city=e.city),null!==e.ip_address&&(a.ip_address=e.ip_address)):a.location="";a.timestamp=Z();var f=new Date;a.hour=f.getHours();a.dow=f.getDay()}function v(a){e.ignore_visitor||(!e.app_key||!e.device_id?j("app_key or device_id is missing"):(xa(a),s.length>Ga&&s.shift(),s.push(a),h("cly_queue",s,!0)))}function V(){J();if(e.test_mode||e.ignore_visitor)ga=!1;else{ga=!0;var a=0;if(ha&&"undefined"!==typeof d.q&&0<d.q.length){var f,k=d.q;d.q=[];
for(a=0;a<k.length;a++)if(f=k[a],j("Processing queued call",f),"function"===typeof f)f();else if(Array.isArray(f)&&0<f.length){var b=e,u=0;d.i[f[u]]&&(b=d.i[f[u]],u++);if("function"===typeof b[f[u]])b[f[u]].apply(b,f.slice(u+1));else if(0===f[u].indexOf("userData.")){var c=f[u].replace("userData.","");"function"===typeof b.userData[c]&&b.userData[c].apply(b,f.slice(u+1))}else"function"===typeof d[f[u]]&&d[f[u]].apply(d,f.slice(u+1))}}F&&(U&&M)&&(a=n(),a-G>Ha&&(e.session_duration(a-G),G=a));0<t.length&&
(t.length<=ya?(v({events:JSON.stringify(t)}),t=[]):(a=t.splice(0,ya),v({events:JSON.stringify(a)})),h("cly_event",t));!D&&(0<s.length&&ia&&n()>za)&&(ia=!1,a=s[0],qa(E)&&(H&&(clearTimeout(H),H=null),a.consent=JSON.stringify(E),E={}),j("Processing request",a),h("cly_queue",s,!0),N(e.url+Ia,a,function(a,f){j("Request Finished",f,a);a?za=n()+Ja:s.shift();h("cly_queue",s,!0);ia=!0}));setTimeout(V,Ka)}}function ja(){return h("cly_id")||na()}function W(){var a=JSON.parse(JSON.stringify(e.metrics||{}));a._app_version=
a._app_version||e.app_version;a._ua=a._ua||navigator.userAgent;if(screen.width){var f=screen.width?parseInt(screen.width):0,k=screen.height?parseInt(screen.height):0;if(0!==f&&0!==k){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)f=Math.round(f*window.devicePixelRatio),k=Math.round(k*window.devicePixelRatio);else if(90===Math.abs(window.orientation))var b=f,f=k,k=b;a._resolution=a._resolution||""+f+"x"+k}}window.devicePixelRatio&&(a._density=a._density||
window.devicePixelRatio);f=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof f&&(a._locale=a._locale||f);if("undefined"!==typeof document.referrer&&document.referrer.length&&(f=va.exec(document.referrer))&&f[11]&&f[11]!==window.location.hostname){f=!1;if(I&&I.length)for(k=0;k<I.length;k++)try{if(RegExp(I[k]).test(document.referrer)){j("Ignored:",document.referrer);f=!0;break}}catch(d){j("Problem with regex",I[k])}f||(a._store=a._store||
document.referrer)}j("Got metrics",a);return a}function j(){e.debug&&"undefined"!==typeof console&&(arguments[1]&&"object"===typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),ha||(arguments[0]="["+e.app_key+"] "+arguments[0]),console.log(Array.prototype.slice.call(arguments).join("\n")))}function N(a,f,k){try{j("Sending XML HTTP request");var b=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):null,f=f||{},d=oa(f),c="GET";
if(e.force_post||2E3<=d.length)c="POST";"GET"===c?b.open("GET",a+"?"+d,!0):(b.open("POST",a,!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"));for(var r in e.headers)b.setRequestHeader(r,e.headers[r]);b.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"===typeof k&&k(!1,f,this.responseText):4===this.readyState&&(j("Failed Server XML HTTP request",this.status),"function"===typeof k&&k(!0,f))};"GET"===c?b.send():b.send(d)}catch(h){j("Failed XML HTTP request",
h),"function"===typeof k&&k(!0,f)}}function Aa(a){h("cly_token",a)}function h(a,f,b,i){function d(a,f,b){var c=new Date;c.setTime(c.getTime()+864E5*b);b="; expires="+c.toGMTString();document.cookie=a+"="+f+b+"; path=/"}i||(a=e.app_key+"/"+a,e.namespace&&(a=aa(e.namespace)+"/"+a));var b=b||!1,i=!1,c,i=!0;try{"undefined"!==typeof localStorage&&localStorage.setItem("testLocal",!0)}catch(r){i=!1}"undefined"!==typeof f&&null!==f&&(f=e.serialize(f),i?localStorage.setItem(a,f):b||d(a,f,30));if("undefined"===
typeof f){if(i)c=localStorage.getItem(a);else if(!b)a:{a+="=";f=document.cookie.split(";");b=0;for(c=f.length;b<c;b++){for(i=f[b];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(a)){c=i.substring(a.length,i.length);break a}}c=null}return e.deserialize(c)}null===f&&(i?localStorage.removeItem(a):b||d(a,"",-1))}for(var e=this,ha=!d.i,F=!1,Ia="/i",Ka=g("interval",b,500),Ga=g("queue_size",b,1E3),s=[],t=[],x={},O=[],P={},I=g("ignore_referrers",b,[]),Ba=null,U=!0,G,Ca=0,L=null,S=0,T=0,za=0,
Ja=g("fail_timeout",b,60),Da=g("inactivity_time",b,20),X=0,Ha=g("session_update",b,60),ya=g("max_events",b,10),La=g("max_logs",b,100),fa=g("use_session_cookie",b,!0),wa=g("session_cookie_timeout",b,30),ia=!0,ga=!1,D=g("offline_mode",b,!1),E={},w={},M=!0,Ma=n(),q={},ka=0;ka<d.features.length;ka++)q[d.features[ka]]={};this.initialize=function(){this.serialize=b.serialize||d.serialize;this.deserialize=b.deserialize||d.deserialize;this.getViewName=b.getViewName||d.getViewName;this.getViewUrl=b.getViewUrl||
d.getViewUrl;this.namespace=g("namespace",b,"");this.app_key=g("app_key",b,null);this.onload=g("onload",b,[]);this.utm=g("utm",b,{source:!0,medium:!0,campaign:!0,term:!0,content:!0});this.ignore_prefetch=g("ignore_prefetch",b,!0);this.debug=g("debug",b,!1);this.test_mode=g("test_mode",b,!1);this.metrics=g("metrics",b,{});this.headers=g("headers",b,{});this.url=aa(g("url",b,""));this.app_version=g("app_version",b,"0.0");this.country_code=g("country_code",b,null);this.city=g("city",b,null);this.ip_address=
g("ip_address",b,null);this.ignore_bots=g("ignore_bots",b,!0);this.force_post=g("force_post",b,!1);this.remote_config=g("remote_config",b,!1);this.ignore_visitor=g("ignore_visitor",b,!1);this.require_consent=g("require_consent",b,!1);Array.isArray(I)||(I=[]);""===this.url&&(j("Please provide server URL"),this.ignore_visitor=!0);h("cly_ignore")&&(this.ignore_visitor=!0);if(h(e.namespace+"cly_id",void 0,!1,!0)){h("cly_id",h(e.namespace+"cly_id",void 0,!1,!0));h("cly_event",h(e.namespace+"cly_event",
void 0,!1,!0));h("cly_session",h(e.namespace+"cly_session",void 0,!1,!0));var a=h(e.namespace+"cly_queue",void 0,!1,!0);Array.isArray(a)&&(a=a.filter(function(a){return a.app_key===e.app_key}),h("cly_queue",a));h(e.namespace+"cly_cmp_id",void 0,!1,!0)&&(h("cly_cmp_id",h(e.namespace+"cly_cmp_id",void 0,!1,!0)),h("cly_cmp_uid",h(e.namespace+"cly_cmp_uid",void 0,!1,!0)));h(e.namespace+"cly_ignore",void 0,!1,!0)&&h("cly_ignore",h(e.namespace+"cly_ignore",void 0,!1,!0));h("cly_id",null,!1,!0);h("cly_event",
null,!1,!0);h("cly_session",null,!1,!0);h("cly_queue",null,!1,!0);h("cly_cmp_id",null,!1,!0);h("cly_cmp_uid",null,!1,!0);h("cly_ignore",null,!1,!0)}D?this.device_id||(this.device_id="[CLY]_temp_id"):this.device_id=g("device_id",b,ja());s=h("cly_queue")||[];t=h("cly_event")||[];x=h("cly_remote_configs")||{};ma();if(window.name&&0===window.name.indexOf("cly:"))try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(f){j("Could not parse name",window.name)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{this.passed_data=
JSON.parse(location.hash.replace("#cly:",""))}catch(k){j("Could not parse hash",location.hash)}if((this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&ha)&&this.passed_data.token&&this.passed_data.purpose)this.passed_data.token!==h("cly_old_token")&&(Aa(this.passed_data.token),h("cly_old_token",this.passed_data.token)),"heatmap"===this.passed_data.purpose&&(this.ignore_visitor=!0,sa(),ra(this.url+"/views/heatmap.js",ta));
if(!this.ignore_visitor){j("Countly initialized");if(location.search){for(var a=location.search.substring(1).split("&"),i={},u=!1,c=0;c<a.length;c++){var r=a[c].split("=");"cly_id"===r[0]?h("cly_cmp_id",r[1]):"cly_uid"===r[0]?h("cly_cmp_uid",r[1]):"cly_device_id"===r[0]?this.device_id=r[1]:0===(r[0]+"").indexOf("utm_")&&this.utm[r[0].replace("utm_","")]&&(i[r[0].replace("utm_","")]=r[1],u=!0)}if(u){for(var p in this.utm)i[p]?this.userData.set("utm_"+p,i[p]):this.userData.unset("utm_"+p);this.userData.save()}}D||
this.device_id!==h("cly_id")&&h("cly_id",this.device_id);this.remote_config&&this.fetch_remote_config(this.remote_config);J();setTimeout(V,1)}document.documentElement.setAttribute("data-countly-useragent",navigator.userAgent)};this.group_features=function(a){if(a)for(var f in a)q[f]?j("Feature name "+f+" is already reserved"):"string"===typeof a[f]?q[f]={features:[a[f]]}:a[f]&&Array.isArray(a[f])&&a[f].length?q[f]={features:a[f]}:j("Incorrect feature list for "+f+" value: "+a[f]);else j("Incorrect features: "+
a)};this.check_consent=function(a){if(!this.require_consent)return!0;if(q[a])return q[a]&&q[a].optin?!0:!1;j("No feature available for "+a);return!1};this.check_any_consent=function(){if(!this.require_consent)return!0;for(var a in q)if(q[a]&&q[a].optin)return!0;return!1};this.add_consent=function(a){j("Adding consent for "+a);if(Array.isArray(a))for(var f=0;f<a.length;f++)this.add_consent(a[f]);else q[a]?q[a].features?(q[a].optin=!0,this.add_consent(q[a].features)):!0!==q[a].optin&&(E[a]=!0,q[a].optin=
!0,Ea(),setTimeout(function(){"sessions"===a&&w.begin_session?(e.begin_session.apply(e,w.begin_session),w.begin_session=null):"views"===a&&w.track_pageview&&(L=null,e.track_pageview.apply(e,w.track_pageview),w.track_pageview=null);w.change_id&&(e.change_id.apply(e,w.change_id),w.change_id=null)},1)):j("No feature available for "+a)};this.remove_consent=function(a){j("Removing consent for "+a);if(Array.isArray(a))for(var f=0;f<a.length;f++)this.remove_consent(a[f]);else q[a]?(q[a].features?this.remove_consent(q[a].features):
!1!==q[a].optin&&(E[a]=!1,Ea()),q[a].optin=!1):j("No feature available for "+a)};var H,Ea=function(){H&&(clearTimeout(H),H=null);H=setTimeout(function(){qa(E)&&(v({consent:JSON.stringify(E)}),E={})},1E3)};this.enable_offline_mode=function(){D=!0;this.device_id="[CLY]_temp_id"};this.disable_offline_mode=function(a){D=!1;a&&this.device_id!==a?(this.device_id=a,h("cly_id",this.device_id),j("Changing id")):(this.device_id=ja(),this.device_id!==h("cly_id")&&h("cly_id",this.device_id));a=!1;if(0<s.length)for(var f=
0;f<s.length;f++)"[CLY]_temp_id"===s[f].device_id&&(s[f].device_id=this.device_id,a=!0);a&&h("cly_queue",s,!0)};this.begin_session=function(a,f){if(this.check_consent("sessions")){if(!F){this.report_orientation();m(window,"resize",function(){e.report_orientation()});G=n();F=!0;U=a?!1:!0;var b=h("cly_session");if(f||!fa||!b||parseInt(b)<=n())j("Session started"),b={begin_session:1},b.metrics=JSON.stringify(W()),v(b);h("cly_session",n()+60*wa)}}else w.begin_session=arguments};this.session_duration=
function(a){this.check_consent("sessions")&&F&&(j("Session extended",a),v({session_duration:a}),Q())};this.end_session=function(a,f){this.check_consent("sessions")&&F&&(a=a||n()-G,K(),!fa||f?(j("Ending session"),v({end_session:1,session_duration:a})):this.session_duration(a),F=!1)};this.change_id=function(a,f){if(this.device_id!==a){f||(0<t.length&&(v({events:JSON.stringify(t)}),t=[],h("cly_event",t)),this.end_session(null,!0),P={});var b=this.device_id;this.device_id=a;h("cly_id",this.device_id);
j("Changing id");f?this.check_any_consent()?v({old_device_id:b}):w.change_id=arguments:this.begin_session(!U,!0);this.remote_config&&(x={},h("cly_remote_configs",x),this.fetch_remote_config(this.remote_config))}};this.add_event=function(a){this.check_consent("events")&&l(a)};this.start_event=function(a){P[a]?j("Timed event with key "+a+" already started"):P[a]=n()};this.end_event=function(a){"string"===typeof a&&(a={key:a});a.key?P[a.key]?(a.dur=n()-P[a.key],this.add_event(a),delete P[a.key]):j("Timed event with key "+
a.key+" was not started"):j("Event must have key property")};this.report_orientation=function(a){this.check_consent("users")&&l({key:"[CLY]_orientation",segmentation:{mode:a||(window.innerWidth>window.innerHeight?"landscape":"portrait")}})};this.report_conversion=function(a,f){this.check_consent("attribution")&&(a=a||h("cly_cmp_id")||"cly_organic",f=f||h("cly_cmp_uid"),a&&f?v({campaign_id:a,campaign_user:f}):a&&v({campaign_id:a}))};this.user_details=function(a){this.check_consent("users")&&(j("Adding userdetails: ",
a),v({user_details:JSON.stringify(C(a,"name username email organization phone picture gender byear custom".split(" ")))}))};var y={},A=function(a,f,b){e.check_consent("users")&&(y[a]||(y[a]={}),"$push"===b||"$pull"===b||"$addToSet"===b?(y[a][b]||(y[a][b]=[]),y[a][b].push(f)):y[a][b]=f)};this.userData={set:function(a,f){y[a]=f},unset:function(a){y[a]=""},set_once:function(a,f){A(a,f,"$setOnce")},increment:function(a){A(a,1,"$inc")},increment_by:function(a,f){A(a,f,"$inc")},multiply:function(a,f){A(a,
f,"$mul")},max:function(a,f){A(a,f,"$max")},min:function(a,f){A(a,f,"$min")},push:function(a,f){A(a,f,"$push")},push_unique:function(a,f){A(a,f,"$addToSet")},pull:function(a,f){A(a,f,"$pull")},save:function(){e.check_consent("users")&&v({user_details:JSON.stringify({custom:y})});y={}}};this.report_trace=function(a){if(this.check_consent("apm")){for(var f="type name stz etz apm_metrics apm_attr".split(" "),b=0;b<f.length;b++)if("apm_attr"!==f[b]&&"undefined"===typeof a[f[b]]){j("APM trace must have a",
f[b]);return}f=C(a,f);f.timestamp=a.stz;a=new Date;f.hour=a.getHours();f.dow=a.getDay();v({apm:JSON.stringify(f)});j("Adding APM trace: ",f)}};this.track_errors=function(a){d.i[this.app_key].tracking_crashes=!0;window.cly_crashes||(window.cly_crashes=!0,Ba=a,window.onerror=function(a,b,i,e,c){if("undefined"!==typeof c)$(c,!1);else{var e=e||window.event&&window.event.errorCharacter,d="";"undefined"!==typeof a&&(d+=a+"\n");"undefined"!==typeof b&&(d+="at "+b);"undefined"!==typeof i&&(d+=":"+i);"undefined"!==
typeof e&&(d+=":"+e);d+="\n";try{for(var h=[],j=arguments.callee.caller;j;)h.push(j.name),j=j.caller;d+=h.join("\n")}catch(g){}$(d,!1)}},window.addEventListener("unhandledrejection",function(a){$(Error("Unhandled rejection (reason: "+(a.reason&&a.reason.stack?a.reason.stack:a.reason)+")."),!0)}))};this.log_error=function(a,f){this.recordError(a,!0,f)};this.add_log=function(a){this.check_consent("crashes")&&(O.length>La&&O.shift(),O.push(a))};this.fetch_remote_config=function(a,f,b){if(this.check_consent("remote-config")){var i=
{method:"fetch_remote_config"};this.check_consent("sessions")&&(i.metrics=JSON.stringify(W()));a&&(!b&&"function"===typeof a?(b=a,a=null):Array.isArray(a)&&a.length&&(i.keys=JSON.stringify(a)));f&&(!b&&"function"===typeof f?(b=f,f=null):Array.isArray(f)&&f.length&&(i.omit_keys=JSON.stringify(f)));xa(i);N(this.url+"/o/sdk",i,function(a,f,d){try{var e=JSON.parse(d);if(i.keys||i.omit_keys)for(var j in e)x[j]=e[j];else x=e;h("cly_remote_configs",x)}catch(g){}"function"===typeof b&&b(a,x)})}else j("Remote config requires explicit consent"),
"function"===typeof b&&b(Error("Remote config requires explicit consent"),x)};this.get_remote_config=function(a){return"undefined"!==typeof a?x[a]:x};this.stop_time=function(){M&&(M=!1,Ca=n()-G,T=n()-S)};this.start_time=function(){M||(M=!0,G=n()-Ca,S=n()-T,T=0,Q())};this.track_sessions=function(){function a(){document[k]?e.stop_time():e.start_time()}function b(){X>=Da&&e.start_time();X=0}this.begin_session();this.start_time();m(window,"beforeunload",function(){e.end_session()});m(window,"unload",
function(){e.end_session()});var k="hidden";k in document?document.addEventListener("visibilitychange",a):(k="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(k="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(k="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?(m(window,"focusin",function(){e.start_time()}),m(window,"focusout",function(){e.stop_time()})):(m(window,"focus",function(){e.start_time()}),
m(window,"blur",function(){e.stop_time()}),m(window,"pageshow",function(){e.start_time()}),m(window,"pagehide",function(){e.stop_time()}));m(window,"mousemove",b);m(window,"click",b);m(window,"keydown",b);m(window,"scroll",b);setInterval(function(){X++;X>=Da&&e.stop_time()},6E4)};this.track_pageview=function(a,b,k){K();a&&Array.isArray(a)&&(b=a,a=null);a||(a=this.getViewName());if(b&&b.length)for(var i=0;i<b.length;i++)try{if(RegExp(b[i]).test(a)){j("Ignored:",a);return}}catch(d){j("Problem with regex",
b[i])}L=a;S=n();i={name:a,visit:1,domain:window.location.hostname,view:this.getViewUrl()};if("undefined"!==typeof document.referrer&&document.referrer.length){var c=va.exec(document.referrer);c&&(c[11]&&c[11]!==window.location.hostname)&&(i.start=1)}if(k)for(var e in k)"undefined"===typeof i[e]&&(i[e]=k[e]);this.check_consent("views")?l({key:"[CLY]_view",segmentation:i}):w.track_pageview=arguments};this.track_view=function(a,b,k){this.track_pageview(a,b,k)};this.track_clicks=function(a){var a=a||
document,b=!0;m(a,"click",function(a){if(b){b=!1;ba(a);if("undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY){var i=R(),d=ca();e.check_consent("clicks")&&l({key:"[CLY]_action",segmentation:{type:"click",x:a.pageX,y:a.pageY,width:d,height:i,domain:window.location.hostname,view:e.getViewUrl()}})}setTimeout(function(){b=!0},1E3)}})};this.track_scrolls=function(a){function b(){if(k){k=!1;var a=R(),f=ca(),d=pa();e.check_consent("scrolls")&&l({key:"[CLY]_action",segmentation:{type:"scroll",y:i+
d,width:f,height:a,domain:window.location.hostname,view:e.getViewUrl()}})}}var a=a||window,k=!0,i=0;m(a,"scroll",function(){i=Math.max(i,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)});m(a,"beforeunload",b);m(a,"unload",b)};this.track_links=function(a){a=a||document;m(a,"click",function(a){var b=Y(a).closest("a");b&&(ba(a),e.check_consent("clicks")&&l({key:"linkClick",segmentation:{href:b.href,text:b.innerText,id:b.id,view:e.getViewUrl()}}))})};this.track_forms=function(a,
b){function k(a){return a.name||a.id||a.type||a.nodeName}a=a||document;m(a,"submit",function(a){var a=Y(a),d={id:a.attributes.id&&a.attributes.id.nodeValue,name:a.attributes.name&&a.attributes.name.nodeValue,action:a.attributes.action&&a.attributes.action.nodeValue,method:a.attributes.method&&a.attributes.method.nodeValue,view:e.getViewUrl()},c;if("undefined"!==typeof a.elements){for(var h=0;h<a.elements.length;h++)if((c=a.elements[h])&&"password"!==c.type&&-1===c.className.indexOf("cly_user_ignore"))"undefined"===
typeof d["input:"+k(c)]&&(d["input:"+k(c)]=[]),"select"===c.nodeName.toLowerCase()?"undefined"!==typeof c.multiple?d["input:"+k(c)].push(z(c)):d["input:"+k(c)].push(c.options[c.selectedIndex].value):"input"===c.nodeName.toLowerCase()?"undefined"!==typeof c.type?"checkbox"===c.type.toLowerCase()||"radio"===c.type.toLowerCase()?c.checked&&d["input:"+k(c)].push(c.value):("hidden"!==c.type.toLowerCase()||b)&&d["input:"+k(c)].push(c.value):d["input:"+k(c)].push(c.value):"textarea"===c.nodeName.toLowerCase()?
d["input:"+k(c)].push(c.value):"undefined"!==typeof c.value&&d["input:"+k(c)].push(c.value);for(var j in d)d[j]&&"function"===typeof d[j].join&&(d[j]=d[j].join(", "))}e.check_consent("forms")&&l({key:"formSubmit",segmentation:d})})};this.collect_from_forms=function(a,b){a=a||document;m(a,"submit",function(d){var d=Y(d),i={},h=!1,c;if("undefined"!==typeof d.elements){var g={},p=a.getElementsByTagName("LABEL"),l;for(l=0;l<p.length;l++)p[l].htmlFor&&""!==p[l].htmlFor&&(g[p[l].htmlFor]=p[l].innerText||
p[l].textContent||p[l].innerHTML);for(l=0;l<d.elements.length;l++)if((c=d.elements[l])&&"password"!==c.type&&-1===c.className.indexOf("cly_user_ignore"))if(p="","select"===c.nodeName.toLowerCase()?p="undefined"!==typeof c.multiple?z(c):c.options[c.selectedIndex].value:"input"===c.nodeName.toLowerCase()?"undefined"!==typeof c.type?"checkbox"===c.type.toLowerCase()||"radio"===c.type.toLowerCase()?c.checked&&(p=c.value):p=c.value:p=c.value:"textarea"===c.nodeName.toLowerCase()?p=c.value:"undefined"!==
typeof c.value&&(p=c.value),c.className&&-1!==c.className.indexOf("cly_user_")){var m=c.className.split(" ");for(c=0;c<m.length;c++)if(0===m[c].indexOf("cly_user_")){i[m[c].replace("cly_user_","")]=p;h=!0;break}}else if(c.type&&"email"===c.type.toLowerCase()||c.name&&-1!==c.name.toLowerCase().indexOf("email")||c.id&&-1!==c.id.toLowerCase().indexOf("email")||c.id&&g[c.id]&&-1!==g[c.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(p))i.email||(i.email=p),h=!0;else if(c.name&&-1!==
c.name.toLowerCase().indexOf("username")||c.id&&-1!==c.id.toLowerCase().indexOf("username")||c.id&&g[c.id]&&-1!==g[c.id].toLowerCase().indexOf("username"))i.username||(i.username=p),h=!0;else if(c.name&&(-1!==c.name.toLowerCase().indexOf("tel")||-1!==c.name.toLowerCase().indexOf("phone")||-1!==c.name.toLowerCase().indexOf("number"))||c.id&&(-1!==c.id.toLowerCase().indexOf("tel")||-1!==c.id.toLowerCase().indexOf("phone")||-1!==c.id.toLowerCase().indexOf("number"))||c.id&&g[c.id]&&(-1!==g[c.id].toLowerCase().indexOf("tel")||
-1!==g[c.id].toLowerCase().indexOf("phone")||-1!==g[c.id].toLowerCase().indexOf("number")))i.phone||(i.phone=p),h=!0;else if(c.name&&(-1!==c.name.toLowerCase().indexOf("org")||-1!==c.name.toLowerCase().indexOf("company"))||c.id&&(-1!==c.id.toLowerCase().indexOf("org")||-1!==c.id.toLowerCase().indexOf("company"))||c.id&&g[c.id]&&(-1!==g[c.id].toLowerCase().indexOf("org")||-1!==g[c.id].toLowerCase().indexOf("company")))i.organization||(i.organization=p),h=!0;else if(c.name&&-1!==c.name.toLowerCase().indexOf("name")||
c.id&&-1!==c.id.toLowerCase().indexOf("name")||c.id&&g[c.id]&&-1!==g[c.id].toLowerCase().indexOf("name"))i.name||(i.name=""),i.name+=p+" ",h=!0}h&&(j("Gathered user data",i),b?e.user_details({custom:i}):e.user_details(i))})};this.collect_from_facebook=function(a){FB&&FB.api&&FB.api("/me",function(b){var d={};b.name&&(d.name=b.name);b.email&&(d.email=b.email);"male"===b.gender?d.gender="M":"female"===b.gender&&(d.gender="F");if(b.birthday){var i=b.birthday.split("/").pop();i&&4===i.length&&(d.byear=
i)}b.work&&(b.work[0]&&b.work[0].employer&&b.work[0].employer.name)&&(d.organization=b.work[0].employer.name);if(a){d.custom={};for(var h in a){for(var i=a[h].split("."),c=b,g=0;g<i.length&&!(c=c[i[g]],"undefined"===typeof c);g++);"undefined"!==typeof c&&(d.custom[h]=c)}}e.user_details(d)})};this.opt_out=function(){this.ignore_visitor=!0;h("cly_ignore",!0)};this.opt_in=function(){h("cly_ignore",!1);this.ignore_visitor=!1;ma();!this.ignore_visitor&&!ga&&V()};this.report_feedback=function(a){if(this.check_consent("star-rating")||
this.check_consent("feedback"))if(a.widget_id)if(a.rating){if(this.check_consent("events")){var b={key:"[CLY]_star_rating",count:1,segmentation:{}};b.segmentation=C(a,"widget_id contactMe platform app_version rating email comment".split(" "));b.segmentation.app_version||(b.segmentation.app_version=this.metrics._app_version||this.app_version);j("Reporting feedback: ",b);this.add_event(b)}}else j("Feedback must contain rating property");else j("Feedback must contain widget_id property")};this.show_feedback_popup=
function(a){if(this.check_consent("star-rating")||this.check_consent("feedback"))D?j("Cannot show feedback popup in offline mode"):N(this.url+"/o/feedback/widget",{widget_id:a},function(a,b,d){a&&j("Error occurred",a);try{var e=JSON.parse(d);B(e,!1)}catch(c){j("JSON parse failed: "+c)}})};this.initialize_feedback_popups=function(a){if(this.check_consent("star-rating")||this.check_consent("feedback")){a||(a=h("cly_fb_widgets"));for(var b=document.getElementsByClassName("countly-feedback-sticker");0<
b.length;)b[0].remove();N(this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a)},function(a,b,f){if(a)j("Errors occurred:",a);else try{for(var c=JSON.parse(f),a=0;a<c.length;a++)if("true"===c[a].is_active&&c[a].target_devices[la.device])if("string"===typeof c[a].hide_sticker&&(c[a].hide_sticker="true"===c[a].hide_sticker?!0:!1),"all"===c[a].target_page&&!c[a].hide_sticker)B(c[a],!0);else for(var d=c[a].target_pages,b=0;b<d.length;b++){var e=d[b].substr(0,d[b].length-1)===window.location.pathname.substr(0,
d[b].length-1),h=d[b]===window.location.pathname;(d[b].includes("*")&&e||h)&&!c[a].hide_sticker&&B(c[a],!0)}}catch(g){j("JSON parse error: "+g)}})}};this.enable_feedback=function(a){if(this.check_consent("star-rating")||this.check_consent("feedback"))D?j("Cannot enable feedback in offline mode"):(h("cly_fb_widgets",a.popups||a.widgets),da(this.url+"/star-rating/stylesheets/countly-feedback-web.css"),a=a.popups||a.widgets,0<a.length?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),
this.initialize_feedback_popups(a)):j("You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback"))};this.get_available_feedback_widgets=function(a){!this.check_consent("star-rating")&&!this.check_consent("feedback")?a&&a(null,Error("Consent for feedback not provided.")):D?j("Cannot enable feedback in offline mode."):N(this.url+"/o/sdk",{method:"feedback",device_id:this.device_id,app_key:this.app_key},function(b,d,e){if(b)j("Error occured while fetching feedbacks",
b),a&&a(null,b);else try{var h=JSON.parse(e).result||[];a&&a(h,null)}catch(c){j("Error while processing feedbacks",c),a&&a(null,c)}})};this.present_feedback_widget=function(a){function b(a){document.getElementById("countly-surveys-wrapper-"+a._id).style.display="block";document.getElementById("csbg").style.display="block"}if(this.check_consent("star-rating")||this.check_consent("feedback"))if(!a||"object"!==typeof a||Array.isArray(a))j("Please provide atleast one feedback widget object.");else try{var e=
this.url;if("nps"===a.type)e+="/feedback/nps";else if("survey"===a.type)e+="/feedback/survey";else{j("Feedback widget only accepts nps and survey types.");return}var e=e+("?widget_id="+a._id),e=e+("&app_key="+this.app_key),e=e+("&device_id="+this.device_id),e=e+("&sdk_name="+ua),e=e+("&platform="+this.platform),e=e+("&app_version="+this.app_version),e=e+("&sdk_version="+ea),e=e+("&origin="+window.origin),e=e+"&widget_v=web",i=document.createElement("iframe");i.name="countly-surveys-iframe";i.id="countly-surveys-iframe";
i.src=e;var h=!1;i.onload=function(){h&&(document.getElementById("countly-surveys-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none");h=!0};da(this.url+"/surveys/stylesheets/countly-surveys.css");for(var c=document.getElementById("csbg");c;)c.remove(),c=document.getElementById("csbg");for(var g=document.getElementsByClassName("countly-surveys-wrapper"),e=0;e<g.length;e++)g[e].remove();document.body.insertAdjacentHTML("beforeend",'<div id="csbg"></div>');g=document.createElement("div");
g.className="countly-surveys-wrapper";g.id="countly-surveys-wrapper-"+a._id;"survey"===a.type&&(g.className=g.className+" "+a.appearance.position);document.body.appendChild(g);g.appendChild(i);m(window,"message",function(b){var c={};try{c=JSON.parse(b.data)}catch(f){j("Error while parsing message body "+f)}b.origin===d.url&&c.close&&(document.getElementById("countly-surveys-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none")});if("survey"===a.type){var l=!1;
switch(a.showPolicy){case "afterPageLoad":"complete"===document.readyState?l||(l=!0,b(a)):m(document,"readystatechange",function(c){"complete"===c.target.readyState&&!l&&(l=!0,b(a))});break;case "afterConstantDelay":setTimeout(function(){l||(l=!0,b(a))},1E4);break;case "onAbandon":"complete"===document.readyState?m(document,"mouseleave",function(){l||(l=!0,b(a))}):m(document,"readystatechange",function(c){"complete"===c.target.readyState&&m(document,"mouseleave",function(){l||(l=!0,b(a))})});break;
case "onScrollHalfwayDown":m(window,"scroll",function(){if(!l){var c=Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),d=R();c>=d/2&&(l=!0,b(a))}});break;default:l||(l=!0,b(a))}}else"nps"===a.type&&(document.getElementById("countly-surveys-wrapper-"+a._id).style.display="block",document.getElementById("csbg").style.display="block")}catch(n){j("Somethings went wrong while presenting the feedback",n)}};this.recordError=function(a,b,d){if(this.check_consent("crashes")&&
a){var d=d||Ba,e="";"object"===typeof a?"undefined"!==typeof a.stack?e=a.stack:("undefined"!==typeof a.name&&(e+=a.name+":"),"undefined"!==typeof a.message&&(e+=a.message+"\n"),"undefined"!==typeof a.fileName&&(e+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(e+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(e+=":"+a.columnNumber)):e=a+"";b=b?!0:!1;a=W();e={_resolution:a._resolution,_error:e,_app_version:a._app_version,_run:n()-Ma,_not_os_specific:!0,_javascript:!0};if(a=navigator.battery||
navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)e._bat=Math.floor(100*a.level);"undefined"!==typeof navigator.onLine&&(e._online=navigator.onLine?!0:!1);e._background=document.hasFocus()?!1:!0;0<O.length&&(e._logs=O.join("\n"));O=[];e._nonfatal=b;e._view=this.getViewName();"undefined"!==typeof d&&(e._custom=d);try{var h=document.createElement("canvas").getContext("experimental-webgl");e._opengl=h.getParameter(h.VERSION)}catch(c){}v({crash:JSON.stringify(e)})}};this.onStorageChange=
function(a,b){switch(a){case "cly_queue":s=e.deserialize(b||"[]");break;case "cly_event":t=e.deserialize(b||"[]");break;case "cly_remote_configs":x=e.deserialize(b||"{}");break;case "cly_ignore":e.ignore_visitor=e.deserialize(b);break;case "cly_id":e.device_id=e.deserialize(b)}};this._internals={store:h,getDocWidth:ca,getDocHeight:R,getViewportHeight:pa,get_page_coord:ba,get_event_target:Y,add_event:m,getProperties:C,stripTrailingSlash:aa,prepareParams:oa,sendXmlHttpRequest:N,getMsTimestamp:Z,getTimestamp:n,
log:j,getMetrics:W,generateUUID:na,isUUID:function(){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(e.device_id)},getId:ja,heartBeat:V,toRequestQueue:v,reportViewDuration:K,loadJS:ra,loadCSS:da,getLastView:function(){return L},setToken:Aa,getToken:function(){var a=h("cly_token");h("cly_token",null);return a},showLoader:sa,hideLoader:ta,add_cly_events:l,detect_device:la,getRequestQueue:function(){return s},getEventQueue:function(){return t},clearQueue:function(){s=
[];h("cly_queue",[]);t=[];h("cly_event",[])}};this.initialize()};d.init=function(b){var b=b||{},g=b.app_key||d.app_key;if(!d.i||!d.i[g]){b=new d.CountlyClass(b);if(!d.i){d.i={};for(var m in b)d[m]||(d[m]=b[m])}d.i[g]=b}return d.i[g]};var B=0;Element.prototype.closest||(Element.prototype.closest=function(b){for(var d=this,b=b.toUpperCase();d;){if(d.nodeName.toUpperCase()===b)return d;d=d.parentElement}});var m=function(b,d,g){"undefined"!==typeof b.addEventListener?b.addEventListener(d,g,!1):b.attachEvent("on"+
d,g)},Y=function(b){return b?"undefined"!==typeof b.target?b.target:b.srcElement:window.event.srcElement},la,J=navigator.userAgent.toLowerCase(),K=function(b){b&&(J=(b+"").toLowerCase());return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(J)?"tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(J)?"phone":"desktop"};
la={device:K(),detect:K,isMobile:"desktop"!==K()?!0:!1,userAgent:J};window.addEventListener("storage",function(b){var g=(b.key+"").split("/"),m=g.pop(),g=g.pop();if(d.i&&d.i[g])d.i[g].onStorageChange(m,b.newValue)});d.serialize=function(b){"object"===typeof b&&(b=JSON.stringify(b));return b};d.deserialize=function(b){try{b=JSON.parse(b)}catch(d){}return b};d.getViewName=function(){return window.location.pathname};d.getViewUrl=function(){return window.location.pathname};return d});
