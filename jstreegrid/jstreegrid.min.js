!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(G){function J(e,t){return"jstree_"+e+"_grid_"+(t||"").replace(i,"\\$&")+"_col"}function c(e){return G.makeArray(e.map(function(){return this.id}))}function K(r,e,t,i){if(null==i&&(i=G()),null==e||0===e.length)return i;var s,n=G(),d=[].concat(t),n="string"==typeof e?(s=J(r,e),d.map(function(e){return"#"+s+e}).join(", ")):(n=[],e.forEach(function(e,t){var i=J(r,e);n=n.concat(d.map(function(e){return"#"+i+e}))}),n.join(", "));return 1==d.length?i.find(n):G(n)}function R(e,t){return e=null!=e?"function"==typeof e?e(t):null!==t.data&&void 0!==t.data&&void 0!==t.data[e]?t.data[e]:"":""}var y,Z=/^\s*$/g,i=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,ee="data-jstreegrid",b="data-jstreegrid-column",te="jstree-search",p=!1,S=!1,W=null,k=0,ie=/<\/?[^>]+>/gi,a=function(e,t,i,r,s){var n,d;if(r.data=G.extend(!0,{},t.data),t&&t.children_d&&s)for(n=0,d=t.children_d.length;n<d;n++)a(e,e.get_node(t.children_d[n]),i,i.get_node(r.children_d[n]),s)},re=function(e,t){var i=e.get_node(t),r=i.children,r=!r||r.length<=0||!i.state.opened?t:re(e,r[r.length-1]);return r};G.jstree.defaults.grid={width:"auto"},G.jstree.plugins.grid=function(e,d){function h(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}this._initialize=function(){if(!this._initialized){var e=this.settings.grid||{},d=this.element,s=this._gridSettings={columns:e.columns||[],treeClass:"jstree-grid-col-0",context:e.contextmenu||!1,columnWidth:e.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:e.resizable,draggable:e.draggable,stateful:e.stateful,headerAsTitle:e.headerAsTitle||!1,indent:0,sortOrder:"text",sortAsc:!0,caseInsensitive:e.caseInsensitive,fixedHeader:!1!==e.fixedHeader,width:e.width,height:e.height,gridcontextmenu:e.gridcontextmenu,treecol:0,gridcols:[]},a=s.columns,o=0,l=!1;!0===s.gridcontextmenu?s.gridcontextmenu=function(i,e,r,t,s,n,d){return{edit:{label:"Edit",action:function(e){var t=n.get_node(r);i._edit(t,s,d)}}}}:!1===s.gridcontextmenu&&(s.gridcontextmenu=!1);for(var t=0,i=e.columns.length;t<i;t++)e.columns[t].tree?(o=t,s.treecol=o):s.gridcols.push(t);this.uniq=Math.ceil(1e3*Math.random()),this.rootid=d.attr("id"),/msie/.test(navigator.userAgent.toLowerCase())&&parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(s.defaultConf.display="inline",s.defaultConf.zoom="1"),p||(p=!0,G('<style type="text/css">'+[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;-ms-scroll-limit: 0 0 0 0;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px; cursor: default;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD; z-index: 1;}",".jstree-grid-hidden {display: none;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {table-layout: fixed; width: 100%; overflow: auto; position: relative;}",".jstree-grid-midwrapper {display: table-row;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;-ms-scroll-limit: 0 0 0 0;}",".jstree-grid-ellipsis {text-overflow: ellipsis;}",".jstree-grid-col-0 {width: 100%;}"].join("\n")+"</style>").appendTo("head")),this.gridWrapper=G("<div></div>").addClass("jstree-grid-wrapper").insertAfter(d),this.midWrapper=G("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),e.width&&this.gridWrapper.width(e.width),e.height&&this.gridWrapper.height(e.height);for(t=0,i=a.length;t<i;t++)G("<div></div>").addClass("jstree-default jstree-grid-column jstree-grid-column-"+t+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+o+")").append(d),d.addClass("jstree-grid-cell"),s.fixedHeader&&this.gridWrapper.scroll(function(){G(this).find(".jstree-grid-header").css("top",G(this).scrollTop())});var r,n,h=G.proxy(this.settings.sort,this);this.settings.sort=function(e,t){var i,r=this.colrefs;return"text"===s.sortOrder?(i=this.get_text(e).toLowerCase().localeCompare(this.get_text(t).toLowerCase()),i=s.caseInsensitive?1===i:1===h(e,t)):(e=this.get_node(e),t=this.get_node(t),e="function"==typeof(r=r[s.sortOrder].value)?r(e):e.data[r],void 0!==(r="function"==typeof r?r(t):t.data[r])&&(i=s.caseInsensitive?e.toLowerCase()>r.toLowerCase():r<e)),s.sortAsc||(i=!i),i?1:-1},s.draggable&&(G.ui&&G.ui.sortable?G(this.midWrapper).sortable({axis:"x",handle:".jstree-grid-header",cancel:".jstree-grid-separator",start:function(e,t){r=t.item.index()},stop:function(e,t){n=t.item.index(),s.columns.splice(n,0,s.columns.splice(r,1)[0])}}):console.warn("[jstree-grid] draggable option requires jQuery UI")),this.searchColumn=function(e){var t={};if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&i%1==0&&i<a.length&&0<=i&&(t[i]=e[i]);l=t,0!==Object.keys(t).length?this.search("someValue"):this.search(""),l=!1};for(t=0,i=a.length;t<i;t++){var c=a[t];"function"!=typeof c.search_callback&&(c.search_callback=function(e,t,i,r){return new G.vakata.search(e,!0,{caseSensitive:g.case_sensitive,fuzzy:g.fuzzy}).search(t).isMatch})}var g=this.settings.search,u=(u=g.search_callback)||function(e,t){var i=new G.vakata.search(e,!0,{caseSensitive:g.case_sensitive,fuzzy:g.fuzzy}),r=i.search(t.text).isMatch;if(!r)for(var s=0,n=a.length;s<n;s++)if(o!==s){d=a[s];var d=R(d.value,t);if(null!=d&&""!=d&&(r=i.search(d).isMatch))break}return r};g.search_callback=function(e,t){var i=!1;if(l){for(var r in l)if(l.hasOwnProperty(r)){var s=l[r];if(""!=s){var n=a[r];if(!(i=o==r?n.search_callback(s,t.text,t,n):n.search_callback(s,R(n.value,t),t,n)))break}}d.trigger("columnSearch_grid.jstree")}else i=u(e,t),d.trigger("omniSearch_grid.jstree");return i},this._initialized=!0}},this.init=function(e,t){d.init.call(this,e,t),this._initialize()},this.bind=function(){d.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",G.proxy(function(e,t){var i=this.get_node(t||"#",!0),t=h();this._detachColumns(t),this._prepare_grid(i),this._reattachColumns(t)},this)).on("delete_node.jstree",G.proxy(function(e,t){var i;void 0!==t.node.id&&(this.gridWrapper,i=[t.node.id],t.node&&t.node.children_d&&(i=i.concat(t.node.children_d)),K(this.uniq,i,this._gridSettings.gridcols).remove())},this)).on("show_node.jstree",G.proxy(function(e,t){this._hideOrShowTree(t.node,!1)},this)).on("hide_node.jstree",G.proxy(function(e,t){this._hideOrShowTree(t.node,!0)},this)).on("close_node.jstree",G.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",G.proxy(function(e,t){},this)).on("load_node.jstree",G.proxy(function(e,t){},this)).on("loaded.jstree",G.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",G.proxy(function(e,t){var i=this.element.find("[class~='jstree-anchor']:first").outerHeight(),r=this.element.attr("class")||"";G('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+i+"px; height: "+i+"px;}</style>").appendTo("head"),r=r.split(/\s+/).map(function(e){return e.match(/^jstree(-|$)/)?"":e}),this.gridWrapper.addClass(r.join(" "))},this)).on("move_node.jstree",G.proxy(function(e,t){t.new_instance.element.find("li > a").each(G.proxy(function(e,t){},this))},this)).on("hover_node.jstree",G.proxy(function(e,t,i){t=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&K(this.uniq,this._hover_node,this._gridSettings.gridcols).removeClass("jstree-hovered"),this._hover_node=t,K(this.uniq,t,this._gridSettings.gridcols).addClass("jstree-hovered")},this)).on("dehover_node.jstree",G.proxy(function(e,t,i){t=t.node.id;this._hover_node=null,K(this.uniq,t,this._gridSettings.gridcols).removeClass("jstree-hovered")},this)).on("select_node.jstree",G.proxy(function(e,t,i){var r=t.node.id;K(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",G.proxy(function(e,t,i){t=t.node.id;K(this.uniq,t,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",G.proxy(function(e,t,i){t=t.node||[];K(this.uniq,t,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("search.jstree",G.proxy(function(e,t){var i,r=this.gridWrapper,s=this,n=(new Date).getTime(),d=c(t.nodes.filter(".jstree-node"));if(this.holdingCells={},t.nodes.length){var a=h(),r=r.find("div.jstree-grid-cell-regular");this._detachColumns(a),this._data.search.som&&(this._data.search.smc&&(i=t.nodes.add(t.nodes.find(".jstree-node"))),i=(i||t.nodes).add(t.nodes.parentsUntil(".jstree")),r.hide(),i.filter(".jstree-node").each(function(e,t){var i=t.id;if(i){s._prepare_grid(t);for(var e=0,r=s._gridSettings.gridcols.length;e<r;e++)e!==s._gridSettings.treecol&&K(s.uniq,i,s._gridSettings.gridcols[e],G(s._domManipulation.columns[e])).show()}}));for(var o=0,l=this._gridSettings.gridcols.length;o<l;o++)o!==this._gridSettings.treecol&&K(s.uniq,d,this._gridSettings.gridcols[o],G(this._domManipulation.columns[o])).addClass(te);this._reattachColumns(a),a=(new Date).getTime(),this.element.trigger("search-complete.jstree-grid",[{time:a-n}])}return!0},this)).on("clear_search.jstree",G.proxy(function(e,t){var i=this.gridWrapper,t=c(t.nodes.filter(".jstree-node"));return i.find("div.jstree-grid-cell").show(),K(this.uniq,t,this._gridSettings.gridcols).removeClass(te),!0},this)).on("copy_node.jstree",function(e,t){var i=t.new_instance,r=t.old_instance,s=i.get_node(t.node,!0);return a(r,t.original,i,t.node,!0),i._detachColumns(s.id),i._prepare_grid(s),i._reattachColumns(s.id),!0}).on("show_ellipsis.jstree",G.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).addClass("jstree-grid-ellipsis"),!0},this)).on("hide_ellipsis.jstree",G.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).removeClass("jstree-grid-ellipsis"),!0},this)).on("enable_node.jstree",G.proxy(function(e,t){var i=t.node.id;K(this.uniq,i,this._gridSettings.gridcols).removeClass("jstree-disabled"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").removeClass("jstree-disabled")},this)).on("disable_node.jstree",G.proxy(function(e,t){var i=t.node.id;K(this.uniq,i,this._gridSettings.gridcols).addClass("jstree-disabled"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-disabled")},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",G.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",G.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",G.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",G.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-hover")},this)),this._gridSettings.stateful&&this.element.on("resize_column.jstree-grid",G.proxy(function(e,t,i){localStorage["jstree-root-"+this.rootid+"-column-"+t]=i},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),d.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;(e?K(this.uniq,t,this._gridSettings.gridcols):i.find("div.jstree-grid-cell-regular")).remove()},this._prepare_headers=function(){var e,t,i,r,s,n,d,a=this,o=this._gridSettings,l=o.columns||[],h=o.columnWidth,c=o.resizable||!1,g=o.isThemeroller,u=g?"themeroller":"regular",p=!1,f=this.gridparent,m=this.rootid,_=o.defaultConf;this.parent=f,this.colrefs={};for(var v=0,j=l.length;v<j;v++){for(i=l[v].headerClass||"",r=l[v].columnClass||"",C=l[v].header||"",headerTitle=l[v].headerTitle||"";d=String(Math.floor(1e4*Math.random())),void 0!==this.colrefs[d];);s=l[v].value?d:"text",this.colrefs[s]=l[v],C&&(p=!0),t=o.stateful&&localStorage["jstree-root-"+m+"-column-"+v]?localStorage["jstree-root-"+m+"-column-"+v]:l[v].width||h;var w=l[v].minWidth||t,x=l[v].maxWidth||t;"auto"!==t&&"string"!=typeof t&&(t-=g?7:10),e=this.midWrapper.children("div.jstree-grid-column-"+v),(n=G("<div></div>").css(_).addClass("jstree-grid-div-"+this.uniq+"-"+v+" "+(g?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+u+" "+i+" "+r).html(C)).addClass((g?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+u),!0===this.settings.core.themes.ellipsis&&n.addClass("jstree-grid-ellipsis");var C=o.headerAsTitle&&!headerTitle?C:headerTitle||"";(C=C.replace(ie,""))&&n.attr("title",C),n.prependTo(e),n.attr(b,s),n.outerWidth(),G("<div class='jstree-grid-separator jstree-grid-separator-"+u+(g?" ui-widget-header":"")+(c?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(n),e.width(t),e.css("min-width",w),e.css("max-width",x)}n.addClass((g?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+u),void 0===l[l.length-1].width&&(e.css({width:"auto"}),n.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),p?o.header=void 0:G("div.jstree-grid-header").hide(),!this.bound&&c&&(this.bound=!0,G(document).mouseup(function(){var e,t,i;S&&(i=W.prevAll(".jstree-grid-column").length,t=W.closest(".jstree-grid-wrapper").find(".jstree"),(e=G.jstree.reference(t)).settings.grid.columns,W.parent().children("div.jstree-grid-column"),(isNaN(i)||i<0)&&(e._gridSettings.treeWidthDiff=t.find("ins:eq(0)").width()+t.find("[class~='jstree-anchor']:eq(0)").width()-e._gridSettings.columns[0].width),e=e._gridSettings.columns[i].width=parseFloat(W.css("width")),S=!1,W=null,t.trigger("resize_column.jstree-grid",[i,e]))}).mousemove(function(e){var t,i;!S||0!==(t=(y=e.pageX)-k)&&(i=W.width(),e=(parseFloat(W.css("width"))||W.innerWidth())+(t=t<0?Math.max(t,-i):t),(0<t||0<i)&&10<e&&(W.width(e+"px"),W.css("min-width",e+"px"),W.css("max-width",e+"px"),k=y))}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(e){return S=!0,k=e.pageX,W=G(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(e){var t=G(this).closest("div.jstree-grid-column"),i=parseFloat(t.css("width")),r=0,s=t.prevAll(".jstree-grid-column").length,n=t.width();t.find(".jstree-grid-cell").each(function(){var e,t=G(this);t.css("position","absolute"),t.css("width","auto"),e=t.outerWidth(),t.css("position","relative"),r<e&&(r=e)}),i=i+(i=(i=r-i)<0?Math.max(i,-n):i)+"px",t.width(i),t.css("min-width",i),t.css("max-width",i),G(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[s,i])}).on("click",".jstree-grid-separator",function(e){e.stopPropagation()})),this.gridWrapper.on("click",".jstree-grid-header-cell",function(e){var t;a.sort&&(t=G(this).attr(b),t=o.sortOrder===t&&!0===o.sortAsc?(o.sortAsc=!1,"&darr;"):(o.sortOrder=t,o.sortAsc=!0,"&uarr;"),G(this.closest(".jstree-grid-wrapper")).find(".jstree-grid-sort-icon").remove(),G("<span></span>").addClass("jstree-grid-sort-icon").appendTo(G(this)).html(t),t=a.get_node("#"),a.sort(t,!0),a.redraw_node(t,!0))})},this._domManipulation=null,this._detachColumns=function(e){if(null==this._domManipulation){var t=this._gridSettings.columns||[],i=(this._gridSettings.treecol,this.midWrapper);this._domManipulation={id:e,oldActiveElement:document.activeElement,columns:{}};for(var r=0,s=t.length;r<s;r++)this._domManipulation.columns[r]=i.children(".jstree-grid-column-"+r)[0],this._domManipulation.columns[r].parentNode.removeChild(this._domManipulation.columns[r])}return this._domManipulation},this._reattachColumns=function(e){if(null==this._domManipulation)return!1;if(this._domManipulation.id===e){for(var e=this._gridSettings.columns||[],t=(this._gridSettings.treecol,this.midWrapper),i=0,r=e.length;i<r;i++)t[0].appendChild(this._domManipulation.columns[i]);this._domManipulation.oldActiveElement!==document.activeElement&&G(this._domManipulation.oldActiveElement).focus(),this._domManipulation=null}return!0},this.open_node=function(e,t,i){var r=G.isArray(e),s=null;if(r||"#"!==(s=this.get_node(e)).id){s=r?h():s.id;this._detachColumns(s);i=d.open_node.call(this,e,t,i);return this._reattachColumns(s),i}},this.redraw_node=function(e,t,i,r){var s=G.isArray(e)?h():this.get_node(e).id;return this._detachColumns(s),(e=d.redraw_node.call(this,e,t,i,r))&&this._prepare_grid(e),this._reattachColumns(s),e},this.refresh=function(){return this._clean_grid(),d.refresh.apply(this,arguments)},this.set_id=function(i,e){var t,r=this.uniq;i&&(t=i.id);var s,n=d.set_id.apply(this,arguments);return n&&void 0!==t&&(this.gridWrapper,s=[t],i&&i.children_d&&(s=s.concat(i.children_d)),K(r,s,this._gridSettings.gridcols).attr(ee,i.id).removeClass(J(r,t)).addClass(J(r,i.id)).each(function(e,t){G(t).attr("id",J(r,i.id)+(e+1))})),n},this._hideOrShowTree=function(e,t){this._detachColumns(e.id),this._hideOrShowNode(e,t,this._gridSettings.columns||[],this._gridSettings.treecol),this._reattachColumns(e.id)},this._hideOrShowNode=function(e,t,i,r){for(var s,n=0,d=i.length;n<d;n++)n!==r&&(s=K(this.uniq,e.id,n,G(this._domManipulation.columns[n])),t?s.addClass("jstree-grid-hidden"):s.removeClass("jstree-grid-hidden"));if(e.state.opened&&e.children)for(n=0,d=e.children.length;n<d;n++)this._hideOrShowNode(this.get_node(e.children[n]),t,i,r)},this._hide_grid=function(e){if(!e)return!0;this._detachColumns(e.id);for(var t=e.children||[],i=this._gridSettings.columns||[],r=this._gridSettings.treecol,s=0,n=t.length;s<n;s++){for(var d=this.get_node(t[s]),a=0,o=i.length;a<o;a++)a!==r&&K(this.uniq,d.id,a,G(this._domManipulation.columns[a])).remove();d.state.opened&&this._hide_grid(d)}this._reattachColumns(e.id)},this.holdingCells={},this.getHoldingCells=function(e,t,i){if(e.state.hidden||!e.state.opened)return G();for(var r,s=G(),n=e.children||[],d=this.uniq,a=0;a<n.length;a++)i[r=J(d,n[a])+t]&&(s=s.add(i[r]).add(this.getHoldingCells(this.get_node(n[a]),t,i)));return s},this._edit=function(t,i,r){if(!t)return!1;if(t.data||(t.data={}),!r)return!1;"div"===(r=G(r)).prop("tagName").toLowerCase()&&(r=r.children("span:first"));var e=this._data.core.rtl,s=this.element.width(),n=t.data[i.value],d=G("<div />",{css:{position:"absolute",top:"-200px",left:e?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),a=G("<input />",{value:n,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:G.proxy(function(){var e=a.val();""===e||e===n?e=n:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:n}),e=h(),this._detachColumns(e),this._prepare_grid(this.get_node(t,!0)),this._reattachColumns(e)),a.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=n),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){a.width(Math.min(d.text("pW"+this.value).width(),s))},keypress:function(e){if(13===e.which)return!1}}),e={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(a),a.css(e).width(Math.min(d.text("pW"+a[0].value).width(),s))[0].select()},this.grid_hide_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).hide()},this.grid_show_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).show()},this._prepare_grid=function(e){var t,i,r,s,n,d,a,o,l,h,c,g,u,p,f,m,_,v=this._gridSettings,j=v.treeClass,w=this,x=v.columns||[],C=v.isThemeroller,y=this.uniq,b=v.treecol,S=this.element,W=this.rootid,k=C?"themeroller":"regular",M=this.get_node(e),z=v.columnWidth,q=v.defaultConf,A=this.midWrapper,T=M.id,O=this.get_node(M.parent).children,P=G.inArray(T,O),N=this.holdingCells,E=!1,L=G(e),D=L.children("[class~='jstree-anchor']"),I=D.hasClass(te),V=D.hasClass("jstree-clicked");if(1===D.length){M.state.opened,d=J(y,T),a="#"===M.parent?null:M.parent,D.addClass(j),m=L,_=w,e=(f=D).hasClass("jstree-anchor")?f:f.children("[class~='jstree-anchor']"),j=_.settings.grid.columns[0],f="",j.title&&("_DATA_"===j.title?f=_.get_text(m):m.attr(j.title)&&(f=m.attr(j.title))),(f=f.replace(ie,""))&&e.attr("title",f),i=D,h=P<=0?M.parent:re(this,O[P-1]),c=P>=O.length-1?"NULL":O[P+1],u=M.children&&0<M.children.length?M.children[0]:"NULL";this.settings.grid;for(var F,H,B,U,$,Q,X=0,Y=x.length;X<Y;X++)b!==X&&(H=x[X],B=null==this._domManipulation?A.children("div:eq("+X+")"):G(this._domManipulation.columns[X]),U=H.cellClass||"",$=H.wideCellClass||"",Q=H.columnClass||"",B.addClass(Q),t=R(H.value,M),"function"==typeof H.format&&(t=H.format(t)),H.images?(g=H.images[t]||H.images.default)&&(p="*"===g[0]?'<span class="'+g.substr(1)+'"></span>':'<img src="'+g+'">'):p=t,null!=p&&!Z.test(p)||(p="&nbsp;"),(r=H.valueClass&&null!==M.data&&void 0!==M.data&&M.data[H.valueClass]||"")&&H.valueClassPrefix&&""!==H.valueClassPrefix&&(r=H.valueClassPrefix+r),(s=H.wideValueClass&&null!==M.data&&void 0!==M.data&&M.data[H.wideValueClass]||"")&&H.wideValueClassPrefix&&""!==H.wideValueClassPrefix&&(s=H.wideValueClassPrefix+s),n=(n=H.title&&null!==M.data&&void 0!==M.data&&M.data[H.title]||"").replace(ie,""),"auto"!==(o=H.width||z)&&(o-=7),(!(i=K(y,T,X,B))||i.length<1)&&(i=G("<div></div>"),G("<span></span>").appendTo(i),i.attr("id",d+X),i.addClass(d),i.attr(ee,T),I?i.addClass(te):i.removeClass(te),V?i.addClass("jstree-clicked"):i.removeClass("jstree-clicked"),!0===this.settings.core.themes.ellipsis&&X!==b&&i.addClass("jstree-grid-ellipsis")),M.state.hidden?i.addClass("jstree-grid-hidden"):i.removeClass("jstree-grid-hidden"),M.state.disabled?i.addClass("jstree-disabled"):i.removeClass("jstree-disabled"),l=K(y,h,X,B),Q=K(y,c,X,B),g=K(y,u,X,B),o=K(y,a,X,B),a?(E=!!(o&&0<o.length)&&(l&&0<l.length?i.insertAfter(l):g&&0<g.length?i.insertBefore(g):Q&&0<Q.length?i.insertBefore(Q):i.insertAfter(o),!0),N[d+X]=i):(l&&0<l.length?i.insertAfter(l):g&&0<g.length?i.insertBefore(g):Q&&0<Q.length?i.insertBefore(Q):i.appendTo(B),E=!0),E&&(F=this.getHoldingCells(M,X,N),i.after(F)),(F=i.children("span")).addClass(U+" "+r).html(p),(i=i.css(q).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+W+" jstree-grid-cell-"+k+" "+$+" "+s+(C?" ui-state-default":"")).addClass("jstree-grid-col-"+X).addClass("jstree-animated")).click(function(i,r,s,n){return function(e){var t=jQuery.Event("select_cell.jstree-grid");i.trigger(t,[{value:s,column:n.header,node:r,grid:G(this),sourceName:n.value}]),t.isDefaultPrevented()||r.children(".jstree-anchor").trigger("click.jstree",e)}}(S,L,t,H)),i.on("contextmenu",function(t,i,r,s,n){return function(e){v.gridcontextmenu&&(e.preventDefault(),G.vakata.context.show(this,{x:e.pageX,y:e.pageY},v.gridcontextmenu(w,t,i,r,s,n,e.target)))}}(S,L,t,H,this)),i.hover(function(e,t){return function(){t.hover_node(e)}}(L,this),function(e,t){return function(){t.dehover_node(e)}}(L,this)),n&&F.attr("title",n),S.trigger("render_cell.jstree-grid",[{value:t,column:H.header,node:L,sourceName:H.value}]));i.addClass("jstree-grid-cell-last"+(C?" ui-state-default":"")),void 0===x[x.length-1].width&&i.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}});