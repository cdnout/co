function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"function"==typeof define&&define.amd?define(["exports","warning","../../globals/js/settings","../../globals/js/misc/mixin","../../globals/js/mixins/create-component","../../globals/js/mixins/init-component-by-launcher","../../globals/js/mixins/evented-show-hide-state","../../globals/js/mixins/handles","../../globals/js/misc/event-matches","../../globals/js/misc/on"],t):"undefined"!=typeof exports?t(exports,require("warning"),require("../../globals/js/settings"),require("../../globals/js/misc/mixin"),require("../../globals/js/mixins/create-component"),require("../../globals/js/mixins/init-component-by-launcher"),require("../../globals/js/mixins/evented-show-hide-state"),require("../../globals/js/mixins/handles"),require("../../globals/js/misc/event-matches"),require("../../globals/js/misc/on")):(t(t={},e.warning,e.settings,e.mixin,e.createComponent,e.initComponentByLauncher,e.eventedShowHideState,e.handles,e.eventMatches,e.on),e.modal=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e,r,a,i,l,c,u,d,f,h){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(n){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=s(n);return e=o?(e=s(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==_typeof(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,r=t(r),a=t(a),i=t(i),l=t(l),c=t(c),u=t(u),d=t(d),f=t(f),h=t(h);var n=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(s,(0,i.default)(l.default,c.default,u.default,d.default));var e,t,n,o=y(s);function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e,t))._handleFocusinListener=void 0,n._handleKeydownListener=void 0,n._handleFocusin=function(t){var e=n.element.querySelector(n.options.selectorModalContainer)||n.element;n.element.classList.contains(n.options.classVisible)&&!e.contains(t.target)&&n.options.selectorsFloatingMenus.every(function(e){return!(0,f.default)(t,e)})&&n.element.querySelector(a.default.selectorTabbable).focus()},n._hookCloseActions(),n}return e=s,n=[{key:"options",get:function(){var e=a.default.prefix;return{selectorInit:"[data-modal]",selectorModalClose:"[data-modal-close]",selectorPrimaryFocus:"[data-modal-primary-focus]",selectorsFloatingMenus:[".".concat(e,"--overflow-menu-options"),".".concat(e,"--tooltip"),".flatpickr-calendar"],selectorModalContainer:".".concat(e,"--modal-container"),classVisible:"is-visible",classBody:"".concat(e,"--body--with-modal-open"),attribInitTarget:"data-modal-target",initEventNames:["click"],eventBeforeShown:"modal-beingshown",eventAfterShown:"modal-shown",eventBeforeHidden:"modal-beinghidden",eventAfterHidden:"modal-hidden"}}}],(t=[{key:"createdByLauncher",value:function(e){this.show(e)}},{key:"shouldStateBeChanged",value:function(e){return"shown"===e?!this.element.classList.contains(this.options.classVisible):this.element.classList.contains(this.options.classVisible)}},{key:"_changeState",value:function(t,e,n){var o,s,i,l=this;this._handleFocusinListener&&(this._handleFocusinListener=this.unmanage(this._handleFocusinListener).release()),"shown"===t&&(i=(s="onfocusin"in this.element.ownerDocument.defaultView)?"focusin":"focus",this._handleFocusinListener=this.manage((0,h.default)(this.element.ownerDocument,i,this._handleFocusin,!s))),"hidden"===t?(this.element.classList.toggle(this.options.classVisible,!1),this.element.ownerDocument.body.classList.toggle(this.options.classBody,!1),(this.options.selectorFocusOnClose||this.previouslyFocusedNode)&&(this.element.ownerDocument.querySelector(this.options.selectorFocusOnClose)||this.previouslyFocusedNode).focus()):"shown"===t&&(this.element.classList.toggle(this.options.classVisible,!0),this.element.ownerDocument.body.classList.toggle(this.options.classBody,!0)),o=this.manage((0,h.default)(this.element,"transitionend",function(){var e;o=o&&l.unmanage(o).release(),"shown"===t&&0<l.element.offsetWidth&&0<l.element.offsetHeight&&(l.previouslyFocusedNode=l.element.ownerDocument.activeElement,(e=l.element.querySelector(l.options.selectorPrimaryFocus)||l.element.querySelector(a.default.selectorTabbable)).focus(),"production"!==process.env.NODE_ENV&&"production"!==process.env.NODE_ENV&&(0,r.default)(e,"Modals need to contain a focusable element by either using "+"`".concat(l.options.selectorPrimaryFocus,"` or settings.selectorTabbable."))),n()}))}},{key:"_hookCloseActions",value:function(){var n=this;this.manage((0,h.default)(this.element,"click",function(e){var t=(0,f.default)(e,n.options.selectorModalClose);t&&(e.delegateTarget=t),!t&&e.target!==n.element||n.hide(e)})),this._handleKeydownListener&&(this._handleKeydownListener=this.unmanage(this._handleKeydownListener).release()),this._handleKeydownListener=this.manage((0,h.default)(this.element.ownerDocument.body,"keydown",function(e){27===e.which&&n.shouldStateBeChanged("hidden")&&(e.stopPropagation(),n.hide(e))}))}}])&&m(e.prototype,t),n&&m(e,n),s.components=new WeakMap,s}();e.default=n});