!function(s){if("undefined"==typeof s.org)s.org={};else if("object"!=typeof s.org)throw new Error("Name org already exists and it's not an object");if("undefined"==typeof s.org.pkijs)s.org.pkijs={};else if("object"!=typeof s.org.pkijs)throw new Error("Name org.pkijs already exists and it's not an object but "+typeof s.org.pkijs);if("undefined"==typeof s.org.pkijs.simpl)s.org.pkijs.simpl={};else if("object"!=typeof s.org.pkijs.simpl)throw new Error("Name org.pkijs.simpl already exists and it's not an object but "+typeof s.org.pkijs.simpl);if("undefined"==typeof s.org.pkijs.simpl.ocsp)s.org.pkijs.simpl.ocsp={};else if("object"!=typeof s.org.pkijs.simpl.ocsp)throw new Error("Name org.pkijs.simpl.ocsp already exists and it's not an object but "+typeof s.org.pkijs.simpl.ocsp);if("undefined"==typeof s.org.pkijs.simpl.tsp)s.org.pkijs.simpl.tsp={};else if("object"!=typeof s.org.pkijs.simpl.tsp)throw new Error("Name org.pkijs.simpl.tsp already exists and it's not an object but "+typeof s.org.pkijs.simpl.tsp);s.org.pkijs.simpl.ocsp.CertID=function(){this.hashAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.issuerNameHash=new s.org.pkijs.asn1.OCTETSTRING,this.issuerKeyHash=new s.org.pkijs.asn1.OCTETSTRING,this.serialNumber=new s.org.pkijs.asn1.INTEGER,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.ocsp.CertID.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.hashAlgorithm=arguments[0].hashAlgorithm||new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.issuerNameHash=arguments[0].issuerNameHash||new s.org.pkijs.asn1.OCTETSTRING,this.issuerKeyHash=arguments[0].issuerKeyHash||new s.org.pkijs.asn1.OCTETSTRING,this.serialNumber=arguments[0].serialNumber||new s.org.pkijs.asn1.INTEGER)},s.org.pkijs.simpl.ocsp.CertID.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.ocsp.CertID({names:{hashAlgorithm:"hashAlgorithm",issuerNameHash:"issuerNameHash",issuerKeyHash:"issuerKeyHash",serialNumber:"serialNumber"}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for CertID");this.hashAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber},s.org.pkijs.simpl.ocsp.CertID.prototype.toSchema=function(){return new s.org.pkijs.asn1.SEQUENCE({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})},s.org.pkijs.simpl.ocsp.CertID.prototype.toJSON=function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}},s.org.pkijs.simpl.ocsp.Request=function(){this.reqCert=new s.org.pkijs.simpl.ocsp.CertID,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.ocsp.Request.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.reqCert=arguments[0].reqCert||new s.org.pkijs.simpl.ocsp.CertID,"singleRequestExtensions"in arguments[0]&&(this.singleRequestExtensions=arguments[0].singleRequestExtensions))},s.org.pkijs.simpl.ocsp.Request.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.ocsp.Request({names:{reqCert:{names:{block_name:"reqCert"}},singleRequestExtensions:{names:{block_name:"singleRequestExtensions"}}}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for Request");if(this.reqCert=new s.org.pkijs.simpl.ocsp.CertID({schema:t.result.reqCert}),"singleRequestExtensions"in t.result){this.singleRequestExtensions=new Array;for(var i=t.result.singleRequestExtensions.value_block.value,r=0;r<i.length;r++)this.singleRequestExtensions.push(new s.org.pkijs.simpl.EXTENSION({schema:i[r]}))}},s.org.pkijs.simpl.ocsp.Request.prototype.toSchema=function(){var e=new Array;if(e.push(this.reqCert.toSchema()),"singleRequestExtensions"in this){for(var t=new Array,i=0;i<this.singleRequestExtensions.length;i++)t.push(this.singleRequestExtensions[i].toSchema());e.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[new s.org.pkijs.asn1.SEQUENCE({value:t})]}))}return new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.ocsp.Request.prototype.toJSON=function(){var s={reqCert:this.reqCert.toJSON()};if("singleRequestExtensions"in this){s.singleRequestExtensions=new Array;for(var e=0;e<this.singleRequestExtensions.length;e++)s.singleRequestExtensions.push(this.singleRequestExtensions[e].toJSON())}return s},s.org.pkijs.simpl.ocsp.TBSRequest=function(){this.tbs=new ArrayBuffer(0),this.requestList=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.ocsp.TBSRequest.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.tbs=arguments[0].tbs||new ArrayBuffer(0),"version"in arguments[0]&&(this.version=arguments[0].version),"requestorName"in arguments[0]&&(this.requestorName=arguments[0].requestorName),this.requestList=arguments[0].requestList||new Array,"requestExtensions"in arguments[0]&&(this.requestExtensions=arguments[0].requestExtensions))},s.org.pkijs.simpl.ocsp.TBSRequest.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.ocsp.TBSRequest());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for TBSRequest");this.tbs=t.result.TBSRequest.value_before_decode,"TBSRequest.version"in t.result&&(this.version=t.result["TBSRequest.version"].value_block.value_dec),"TBSRequest.requestorName"in t.result&&(this.requestorName=new s.org.pkijs.simpl.GENERAL_NAME({schema:t.result["TBSRequest.requestorName"]}));for(var i=t.result["TBSRequest.requests"],r=0;r<i.length;r++)this.requestList.push(new s.org.pkijs.simpl.ocsp.Request({schema:i[r]}));if("TBSRequest.requestExtensions"in t.result){this.requestExtensions=new Array;for(var n=t.result["TBSRequest.requestExtensions"].value_block.value,r=0;r<n.length;r++)this.requestExtensions.push(new s.org.pkijs.simpl.EXTENSION({schema:n[r]}))}},s.org.pkijs.simpl.ocsp.TBSRequest.prototype.toSchema=function(e){"undefined"==typeof e&&(e=!1);var t;if(e===!1){if(0===this.tbs.byteLength)return s.org.pkijs.schema.ocsp.TBSRequest();t=s.org.pkijs.fromBER(this.tbs).result}else{var i=new Array;"version"in this&&i.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[new s.org.pkijs.asn1.INTEGER({value:this.version})]})),"requestorName"in this&&i.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:[this.requestorName.toSchema()]}));for(var r=new Array,n=0;n<this.requestList.length;n++)r.push(this.requestList[n].toSchema());if(i.push(new s.org.pkijs.asn1.SEQUENCE({value:r})),"requestExtensions"in this){for(var o=new Array,a=0;a<this.requestExtensions.length;a++)o.push(this.requestExtensions[a].toSchema());i.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:2},value:[new s.org.pkijs.asn1.SEQUENCE({value:o})]}))}t=new s.org.pkijs.asn1.SEQUENCE({value:i})}return t},s.org.pkijs.simpl.ocsp.TBSRequest.prototype.toJSON=function(){var s={};"version"in this&&(s.version=this.version),"requestorName"in this&&(s.requestorName=this.requestorName.toJSON()),s.requestList=new Array;for(var e=0;e<this.requestList.length;e++)s.requestList.push(this.requestList[e].toJSON());if("requestExtensions"in this){s.requestExtensions=new Array;for(var e=0;e<this.requestExtensions.length;e++)s.requestExtensions.push(this.requestExtensions[e].toJSON())}return s},s.org.pkijs.simpl.ocsp.Signature=function(){this.signatureAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=new s.org.pkijs.asn1.BITSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.ocsp.Signature.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.signatureAlgorithm=arguments[0].signatureAlgorithm||new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=arguments[0].signature||new s.org.pkijs.asn1.BITSTRING,"certs"in arguments[0]&&(this.certs=arguments[0].certs))},s.org.pkijs.simpl.ocsp.Signature.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.ocsp.Signature({names:{signatureAlgorithm:{names:{block_name:"signatureAlgorithm"}},signature:"signature",certs:"certs"}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for ocsp.Signature");if(this.signatureAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,"certs"in t.result){this.certs=new Array;for(var i=t.result.certs,r=0;i>r;r++)this.certs.push(new s.org.pkijs.simpl.CERT({schema:i[r]}))}},s.org.pkijs.simpl.ocsp.Signature.prototype.toSchema=function(){var e=new Array;if(e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),"certs"in this){for(var t=new Array,i=0;i<this.certs.length;i++)t.push(this.certs[i].toSchema());e.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[new s.org.pkijs.asn1.SEQUENCE({value:t})]}))}return new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.ocsp.Signature.prototype.toJSON=function(){var s={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};if("certs"in this){s.certs=new Array;for(var e=0;e<this.certs.length;e++)s.certs.push(this.certs[e].toJSON())}return s},s.org.pkijs.simpl.OCSP_REQUEST=function(){this.requestList=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.OCSP_REQUEST.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.tbsRequest=arguments[0].tbsRequest||new s.org.pkijs.simpl.ocsp.TBSRequest,"optionalSignature"in arguments[0]&&(this.optionalSignature=arguments[0].optionalSignature))},s.org.pkijs.simpl.OCSP_REQUEST.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.OCSP_REQUEST());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for OCSP_REQUEST");"TBSRequest.version"in t.result&&(this.version=t.result["TBSRequest.version"].value_block.value_dec),"TBSRequest.requestorName"in t.result&&(this.requestorName=new s.org.pkijs.simpl.GENERAL_NAME({schema:t.result["TBSRequest.requestorName"]}));for(var i=t.result["TBSRequest.requests"],r=0;r<i.length;r++)this.requestList.push(new s.org.pkijs.simpl.ocsp.Request({schema:i[r]}));if("TBSRequest.requestExtensions"in t.result){this.requestExtensions=new Array;for(var n=t.result["TBSRequest.requestExtensions"].value_block.value,r=0;r<n.length;r++)this.requestExtensions.push(new s.org.pkijs.simpl.EXTENSION({schema:n[r]}))}"optionalSignature"in t.result&&(this.optionalSignature=new s.org.pkijs.simpl.ocsp.Signature({schema:t.result.optionalSignature}))},s.org.pkijs.simpl.OCSP_REQUEST.prototype.toSchema=function(){var e=new Array,t=new Array;"version"in this&&t.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[new s.org.pkijs.asn1.INTEGER({value:this.version})]})),"requestorName"in this&&t.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:[this.requestorName.toSchema()]}));for(var i=new Array,r=0;r<this.requestList.length;r++)i.push(this.requestList[r].toSchema());if(t.push(new s.org.pkijs.asn1.SEQUENCE({value:i})),"requestExtensions"in this){for(var n=new Array,o=0;o<this.requestExtensions.length;o++)n.push(this.requestExtensions[o].toSchema());t.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:2},value:[new s.org.pkijs.asn1.SEQUENCE({value:n})]}))}return e.push(new s.org.pkijs.asn1.SEQUENCE({value:t})),"optionalSignature"in this&&e.push(this.optionalSignature.toSchema()),new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.OCSP_REQUEST.prototype.sign=function(e,t){var i=this;if("undefined"==typeof e)return new Promise(function(s,e){e("Need to provide a private key for signing")});if("undefined"==typeof t)t="SHA-1";else{var r=s.org.pkijs.getOIDByAlgorithm({name:t});if(""===r)return new Promise(function(s,e){e("Unsupported hash algorithm: "+t)})}if("optionalSignature"in this==!1)return new Promise(function(s,e){e('Need to create "optionalSignature" field before signing')});var n=s.org.pkijs.getAlgorithmParameters(e.algorithm.name,"sign");switch(n.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":i.optionalSignature.signatureAlgorithm.algorithm_id=s.org.pkijs.getOIDByAlgorithm(n.algorithm);break;case"RSA-PSS":switch(t.toUpperCase()){case"SHA-256":n.algorithm.saltLength=32;break;case"SHA-384":n.algorithm.saltLength=48;break;case"SHA-512":n.algorithm.saltLength=64}var o={};if("SHA-1"!==t.toUpperCase()){var a=s.org.pkijs.getOIDByAlgorithm({name:t});if(""===a)return new Promise(function(s,e){e("Unsupported hash algorithm: "+t)});o.hashAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:a,algorithm_params:new org.pkijs.asn1.NULL}),o.maskGenAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.8",algorithm_params:o.hashAlgorithm.toSchema()})}20!==n.algorithm.saltLength&&(o.saltLength=n.algorithm.saltLength);var p=new s.org.pkijs.simpl.x509.RSASSA_PSS_params(o);i.optionalSignature.signatureAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.10",algorithm_params:p.toSchema()});break;default:return new Promise(function(s,t){t("Unsupported signature algorithm: "+e.algorithm.name)})}var h=this.tbsRequest.toSchema(!0).toBER(!1),u=s.org.pkijs.getCrypto();return"undefined"==typeof u?new Promise(function(s,e){e("Unable to create WebCrypto object")}):u.sign(n.algorithm,e,new Uint8Array(h)).then(function(e){"ECDSA"===n.algorithm.name&&(e=s.org.pkijs.createCMSECDSASignature(e)),i.optionalSignature.signature=new s.org.pkijs.asn1.BITSTRING({value_hex:e})},function(s){return new Promise(function(e,t){t("Signing error: "+s)})})},s.org.pkijs.simpl.OCSP_REQUEST.prototype.toJSON=function(){var s={};"version"in this&&(s.version=this.version),"requestorName"in this&&(s.requestorName=this.requestorName.toJSON()),s.requestList=new Array;for(var e=0;e<this.requestList.length;e++)s.requestList.push(this.requestList[e].toJSON());if("requestExtensions"in this){s.requestExtensions=new Array;for(var e=0;e<this.requestExtensions.length;e++)s.requestExtensions.push(this.requestExtensions[e].toJSON())}return"optionalSignature"in this&&(s.optionalSignature=this.optionalSignature.toJSON()),s},s.org.pkijs.simpl.ocsp.ResponseBytes=function(){this.responseType="",this.response=new s.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.ocsp.ResponseBytes.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.responseType=arguments[0].responseType||"",this.response=arguments[0].response||new s.org.pkijs.asn1.OCTETSTRING)},s.org.pkijs.simpl.ocsp.ResponseBytes.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.ocsp.ResponseBytes({names:{responseType:"responseType",response:"response"}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for ResponseBytes");this.responseType=t.result.responseType.value_block.toString(),this.response=t.result.response},s.org.pkijs.simpl.ocsp.ResponseBytes.prototype.toSchema=function(){return new s.org.pkijs.asn1.SEQUENCE({value:[new s.org.pkijs.asn1.OID({value:this.responseType}),this.response]})},s.org.pkijs.simpl.ocsp.ResponseBytes.prototype.toJSON=function(){return{responseType:this.responseType,response:this.response.toJSON()}},s.org.pkijs.simpl.OCSP_RESPONSE=function(){this.responseStatus=new s.org.pkijs.asn1.ENUMERATED,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.OCSP_RESPONSE.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.responseStatus=arguments[0].responseStatus||new s.org.pkijs.asn1.ENUMERATED,"responseBytes"in arguments[0]&&(this.responseBytes=arguments[0].responseBytes))},s.org.pkijs.simpl.OCSP_RESPONSE.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.OCSP_RESPONSE());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for OCSP_RESPONSE");this.responseStatus=t.result.responseStatus,"responseBytes"in t.result&&(this.responseBytes=new s.org.pkijs.simpl.ocsp.ResponseBytes({schema:t.result.responseBytes}))},s.org.pkijs.simpl.OCSP_RESPONSE.prototype.toSchema=function(){var e=new Array;return e.push(this.responseStatus),"responseBytes"in this&&e.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.responseBytes.toSchema()]})),new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.OCSP_RESPONSE.prototype.verify=function(){var e=this;if("responseBytes"in this==!1)return new Promise(function(s,e){e("Empty ResponseBytes field")});if("1.3.6.1.5.5.7.48.1.1"===this.responseBytes.responseType){var t=s.org.pkijs.fromBER(this.responseBytes.response.value_block.value_hex),i=new s.org.pkijs.simpl.OCSP_BASIC_RESPONSE({schema:t.result});return i.verify()}return new Promise(function(s,t){t("Unknown ResponseBytes type: "+e.responseBytes.responseType)})},s.org.pkijs.simpl.OCSP_RESPONSE.prototype.sign=function(e,t){var i=this;if("1.3.6.1.5.5.7.48.1.1"===this.responseBytes.responseType){var r=s.org.pkijs.fromBER(this.responseBytes.response.value_block.value_hex),n=new s.org.pkijs.simpl.OCSP_BASIC_RESPONSE({schema:r.result});return n.sign(e,t)}return new Promise(function(s,e){e("Unknown ResponseBytes type: "+i.responseBytes.responseType)})},s.org.pkijs.simpl.OCSP_RESPONSE.prototype.toJSON=function(){var s={responseStatus:this.responseStatus.toJSON()};return"responseBytes"in this&&(s.responseBytes=this.responseBytes.toJSON()),s},s.org.pkijs.simpl.ocsp.SingleResponse=function(){this.certID=new s.org.pkijs.simpl.ocsp.CertID,this.certStatus=new s.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:3},value:[]}),this.thisUpdate=new Date(0,0,0),arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.ocsp.SingleResponse.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.certID=arguments[0].certID||new s.org.pkijs.simpl.ocsp.CertID,this.certStatus=arguments[0].certStatus||new s.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:3},value:[]}),this.thisUpdate=arguments[0].thisUpdate||new Date(0,0,0),"nextUpdate"in arguments[0]&&(this.nextUpdate=arguments[0].nextUpdate),"singleExtensions"in arguments[0]&&(this.singleExtensions=arguments[0].singleExtensions))},s.org.pkijs.simpl.ocsp.SingleResponse.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.ocsp.SingleResponse({names:{certID:{names:{block_name:"certID"}},certStatus:"certStatus",thisUpdate:"thisUpdate",nextUpdate:"nextUpdate",singleExtensions:"singleExtensions"}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for SingleResponse");if(this.certID=new s.org.pkijs.simpl.ocsp.CertID({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),"nextUpdate"in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),"singleExtensions"in t.result){this.singleExtensions=new Array;for(var i=t.result.singleExtensions.value_block.value,r=0;r<i.length;r++)this.singleExtensions.push(new s.org.pkijs.simpl.EXTENSION({schema:i[r]}))}},s.org.pkijs.simpl.ocsp.SingleResponse.prototype.toSchema=function(){var e=new Array;if(e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new s.org.pkijs.asn1.GENERALIZEDTIME({value_date:this.thisUpdate})),"nextUpdate"in this&&e.push(new s.org.pkijs.asn1.GENERALIZEDTIME({value_date:this.nextUpdate})),"singleExtensions"in this){for(var t=new Array,i=0;i<this.singleExtensions.length;i++)t.push(this.singleExtensions[i].toSchema());e.push(new s.org.pkijs.asn1.SEQUENCE({value:t}))}return new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.ocsp.SingleResponse.prototype.toJSON=function(){var s={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};if("nextUpdate"in this&&(s.nextUpdate=this.nextUpdate),"singleExtensions"in this){s.singleExtensions=new Array;for(var e=0;e<this.singleExtensions.length;e++)s.singleExtensions.push(this.singleExtensions[e].toJSON())}return s},s.org.pkijs.simpl.ocsp.ResponseData=function(){this.tbs=new ArrayBuffer(0),this.responderID=new s.org.pkijs.simpl.RDN,this.producedAt=new Date(0,0,0),this.responses=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.ocsp.ResponseData.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&("version"in arguments[0]&&(this.version=arguments[0].version),this.responderID=arguments[0].responderID||new s.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:10},value:[]}),this.producedAt=arguments[0].producedAt||new Date(0,0,0),this.responses=arguments[0].responses||new Array,"responseExtensions"in arguments[0]&&(this.responseExtensions=arguments[0].responseExtensions))},s.org.pkijs.simpl.ocsp.ResponseData.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.ocsp.ResponseData());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for ocsp.ResponseData");this.tbs=t.result.ResponseData.value_before_decode,"ResponseData.version"in t.result&&(this.version=t.result["ResponseData.version"].value_block.value_dec),1===t.result["ResponseData.responderID"].id_block.tag_number?this.responderID=new s.org.pkijs.simpl.RDN({schema:t.result["ResponseData.responderID"].value_block.value[0]}):this.responderID=t.result["ResponseData.responderID"].value_block.value[0],this.producedAt=t.result["ResponseData.producedAt"].toDate();for(var i=t.result["ResponseData.responses"],r=0;r<i.length;r++)this.responses.push(new s.org.pkijs.simpl.ocsp.SingleResponse({schema:i[r]}));if("ResponseData.responseExtensions"in t.result){this.responseExtensions=new Array;for(var n=t.result["ResponseData.responseExtensions"].value_block.value,r=0;r<n.length;r++)this.responseExtensions.push(new s.org.pkijs.simpl.EXTENSION({schema:n[r]}))}},s.org.pkijs.simpl.ocsp.ResponseData.prototype.toSchema=function(e){"undefined"==typeof e&&(e=!1);var t;if(e===!1){if(0===this.tbs.length)return s.org.pkijs.schema.ocsp.ResponseData();t=s.org.pkijs.fromBER(this.tbs).result}else{var i=new Array;"version"in this&&i.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[new s.org.pkijs.asn1.INTEGER({value:this.version})]})),this.responderID instanceof s.org.pkijs.simpl.RDN?i.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:1},value:[this.responderID.toSchema()]})):i.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:2},value:[this.responderID]})),i.push(new s.org.pkijs.asn1.GENERALIZEDTIME({value_date:this.producedAt}));for(var r=new Array,n=0;n<this.responses.length;n++)r.push(this.responses[n].toSchema());if(i.push(new s.org.pkijs.asn1.SEQUENCE({value:r})),"responseExtensions"in this){for(var o=new Array,a=0;a<this.responseExtensions.length;a++)o.push(this.responseExtensions[a].toSchema());i.push(new s.org.pkijs.asn1.SEQUENCE({value:o}))}t=new s.org.pkijs.asn1.SEQUENCE({value:i})}return t},s.org.pkijs.simpl.ocsp.ResponseData.prototype.toJSON=function(){var s={};if("version"in this&&(s.version=this.version),"responderID"in this&&(s.responderID=this.responderID),"producedAt"in this&&(s.producedAt=this.producedAt),"responses"in this){s.responses=new Array;for(var e=0;e<this.responses.length;e++)s.responses.push(this.responses[e].toJSON())}if("responseExtensions"in this){s.responseExtensions=new Array;for(var e=0;e<this.responseExtensions.length;e++)s.responseExtensions.push(this.responseExtensions[e].toJSON())}return s},s.org.pkijs.simpl.OCSP_BASIC_RESPONSE=function(){this.tbsResponseData=new s.org.pkijs.simpl.ocsp.ResponseData,this.signatureAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=new s.org.pkijs.asn1.BITSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.OCSP_BASIC_RESPONSE.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.tbsResponseData=arguments[0].tbsResponseData||new s.org.pkijs.simpl.ocsp.ResponseData,this.signatureAlgorithm=arguments[0].signatureAlgorithm||new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=arguments[0].signature||new s.org.pkijs.asn1.BITSTRING,"certs"in arguments[0]&&(this.certs=arguments[0].certs))},s.org.pkijs.simpl.OCSP_BASIC_RESPONSE.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.OCSP_BASIC_RESPONSE());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for OCSP_BASIC_RESPONSE");if(this.tbsResponseData=new s.org.pkijs.simpl.ocsp.ResponseData({schema:t.result["BasicOCSPResponse.tbsResponseData"]}),this.signatureAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:t.result["BasicOCSPResponse.signatureAlgorithm"]}),this.signature=t.result["BasicOCSPResponse.signature"],"BasicOCSPResponse.certs"in t.result){this.certs=new Array;for(var i=t.result["BasicOCSPResponse.certs"],r=0;r<i.length;r++)this.certs.push(new s.org.pkijs.simpl.CERT({schema:i[r]}))}},s.org.pkijs.simpl.OCSP_BASIC_RESPONSE.prototype.toSchema=function(){var e=new Array;if(e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),"certs"in this){for(var t=new Array,i=0;i<this.certs.length;i++)t.push(this.certs[i].toSchema());e.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[new s.org.pkijs.asn1.SEQUENCE({value:t})]}))}return new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.OCSP_BASIC_RESPONSE.prototype.verify=function(){function e(s){if(s.issuer.isEqual(i.issuer)===!0&&s.serialNumber.isEqual(i.serialNumber)===!0)return null;for(var e=!1,t=0;t<s.extensions.length;t++)"2.5.29.19"===s.extensions[t].extnID&&"cA"in s.extensions[t].parsedValue&&s.extensions[t].parsedValue.cA===!0&&(e=!0);return e?s:null}if("certs"in this==!1)return new Promise(function(s,e){e("No certificates attached to the BasicOCSPResponce")});var t=this,i=null,r=this.certs,n=(new Uint8Array(this.signature.value_block.value_hex),new Uint8Array(this.tbsResponseData.tbs)),o=-1,a=Promise.resolve(),p="",h=new Array;arguments[0]instanceof Object&&"trusted_certs"in arguments[0]&&(h=arguments[0].trusted_certs);var u=s.org.pkijs.getCrypto();if("undefined"==typeof u)return new Promise(function(s,e){e("Unable to create WebCrypto object")});if(p=s.org.pkijs.getHashAlgorithm(this.signatureAlgorithm),""===p)return new Promise(function(s,e){e("Unsupported signature algorithm: "+t.signatureAlgorithm.algorithm_id)});var l=0,c={};if(this.tbsResponseData.responderID instanceof s.org.pkijs.simpl.RDN)l=0,c=this.tbsResponseData.responderID;else{if(!(this.tbsResponseData.responderID instanceof s.org.pkijs.asn1.OCTETSTRING))return new Promise(function(s,e){e("Wrong value for responderID")});l=1,c=this.tbsResponseData.responderID}a=0===l?a.then(function(){for(var s=0;s<r.length;s++)if(r[s].subject.isEqual(c)){o=s;break}}):a.then(function(){for(var e=new Array,t=0;t<r.length;t++)e.push(u.digest({name:"sha-1"},new Uint8Array(r[t].subjectPublicKeyInfo.subjectPublicKey.value_block.value_hex)));return Promise.all(e).then(function(e){for(var t=0;t<r.length;t++)if(s.org.pkijs.isEqual_buffer(e[t],c.value_block.value_hex)){o=t;break}})});var m=new Array;return a=a.then(function(s){if(-1===o)return new Promise(function(s,e){e("Correct certificate was not found in OCSP response")});i=r[o];for(var n=0;n<t.certs.length;n++)m.push(e(t.certs[n]));return Promise.all(m).then(function(s){var e=new Array;e.push(i);for(var r=0;r<s.length;r++)null!==s[r]&&e.push(s[r]);var n=new org.pkijs.simpl.CERT_CHAIN({certs:e,trusted_certs:h});return"crls"in t&&(n.crls=t.crls),n.verify().then(function(s){return s.result===!0?new Promise(function(s,e){s()}):new Promise(function(s,e){e("Validation of signer's certificate failed")})},function(s){return new Promise(function(e,t){t("Validation of signer's certificate failed with error: "+(s instanceof Object?s.result_message:s))})})},function(s){return new Promise(function(e,t){t("Error during checking certificates for CA flag: "+s)})})}),a=a.then(function(){var e=s.org.pkijs.getAlgorithmByOID(r[o].signatureAlgorithm.algorithm_id);if("name"in e==!1)return new Promise(function(s,e){e("Unsupported public key algorithm: "+r[o].signatureAlgorithm.algorithm_id)});var t=e.name,i=s.org.pkijs.getAlgorithmParameters(t,"importkey");"hash"in i.algorithm&&(i.algorithm.hash.name=p);var n=r[o].subjectPublicKeyInfo.toSchema(),a=n.toBER(!1),h=new Uint8Array(a);return u.importKey("spki",h,i.algorithm,!0,i.usages)}),a=a.then(function(e){var i=s.org.pkijs.getAlgorithmParameters(e.algorithm.name,"verify");"hash"in i.algorithm&&(i.algorithm.hash.name=p);var r=t.signature.value_block.value_hex;if("ECDSA"===e.algorithm.name){var o=s.org.pkijs.fromBER(r);r=s.org.pkijs.createECDSASignatureFromCMS(o.result)}if("RSA-PSS"===e.algorithm.name){var a;try{a=new s.org.pkijs.simpl.x509.RSASSA_PSS_params({schema:t.signatureAlgorithm.algorithm_params})}catch(h){return new Promise(function(s,e){e(h)})}"saltLength"in a?i.algorithm.saltLength=a.saltLength:i.algorithm.saltLength=20;var l="SHA-1";if("hashAlgorithm"in a){var c=s.org.pkijs.getAlgorithmByOID(a.hashAlgorithm.algorithm_id);if("name"in c==!1)return new Promise(function(s,e){e("Unrecognized hash algorithm: "+a.hashAlgorithm.algorithm_id)});l=c.name}i.algorithm.hash.name=l}return u.verify(i.algorithm,e,new Uint8Array(r),n)})},s.org.pkijs.simpl.OCSP_BASIC_RESPONSE.prototype.sign=function(e,t){var i=this;if("undefined"==typeof e)return new Promise(function(s,e){e("Need to provide a private key for signing")});if("undefined"==typeof t)t="SHA-1";else{var r=s.org.pkijs.getOIDByAlgorithm({name:t});if(""===r)return new Promise(function(s,e){e("Unsupported hash algorithm: "+t)})}var n=s.org.pkijs.getAlgorithmParameters(e.algorithm.name,"sign");switch(n.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":i.signatureAlgorithm.algorithm_id=s.org.pkijs.getOIDByAlgorithm(n.algorithm);break;case"RSA-PSS":switch(t.toUpperCase()){case"SHA-256":n.algorithm.saltLength=32;break;case"SHA-384":n.algorithm.saltLength=48;break;case"SHA-512":n.algorithm.saltLength=64}var o={};if("SHA-1"!==t.toUpperCase()){var a=s.org.pkijs.getOIDByAlgorithm({name:t});if(""===a)return new Promise(function(s,e){e("Unsupported hash algorithm: "+t)});o.hashAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:a,algorithm_params:new org.pkijs.asn1.NULL}),o.maskGenAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.8",algorithm_params:o.hashAlgorithm.toSchema()})}20!==n.algorithm.saltLength&&(o.saltLength=n.algorithm.saltLength);var p=new s.org.pkijs.simpl.x509.RSASSA_PSS_params(o);i.signatureAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.10",algorithm_params:p.toSchema()});break;default:return new Promise(function(s,t){t("Unsupported signature algorithm: "+e.algorithm.name)})}i.tbsResponseData.tbs=i.tbsResponseData.toSchema(!0).toBER(!1);var h=s.org.pkijs.getCrypto();return"undefined"==typeof h?new Promise(function(s,e){e("Unable to create WebCrypto object")}):h.sign(n.algorithm,e,new Uint8Array(i.tbsResponseData.tbs)).then(function(e){"ECDSA"===n.algorithm.name&&(e=s.org.pkijs.createCMSECDSASignature(e)),
i.signature=new s.org.pkijs.asn1.BITSTRING({value_hex:e})},function(s){return new Promise(function(e,t){t("Signing error: "+s)})})},s.org.pkijs.simpl.OCSP_BASIC_RESPONSE.prototype.toJSON=function(){var s={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};if("certs"in this){s.certs=new Array;for(var e=0;e<this.certs.length;e++)s.certs.push(this.certs[e].toJSON())}return s},s.org.pkijs.simpl.tsp.MessageImprint=function(){this.hashAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.hashedMessage=new s.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.tsp.MessageImprint.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.hashAlgorithm=arguments[0].hashAlgorithm||new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.hashedMessage=arguments[0].hashedMessage||new s.org.pkijs.asn1.OCTETSTRING)},s.org.pkijs.simpl.tsp.MessageImprint.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.tsp.MessageImprint({names:{hashAlgorithm:{names:{block_name:"hashAlgorithm"}},hashedMessage:"hashedMessage"}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for MessageImprint");this.hashAlgorithm=new s.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage},s.org.pkijs.simpl.tsp.MessageImprint.prototype.toSchema=function(){return new s.org.pkijs.asn1.SEQUENCE({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})},s.org.pkijs.simpl.tsp.MessageImprint.prototype.toJSON=function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}},s.org.pkijs.simpl.TSP_REQUEST=function(){this.version=0,this.messageImprint=new s.org.pkijs.simpl.tsp.MessageImprint,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.TSP_REQUEST.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.messageImprint=arguments[0].messageImprint||new s.org.pkijs.simpl.tsp.MessageImprint,"reqPolicy"in arguments[0]&&(this.reqPolicy=arguments[0].reqPolicy),"nonce"in arguments[0]&&(this.nonce=arguments[0].nonce),"certReq"in arguments[0]&&(this.certReq=arguments[0].certReq),"extensions"in arguments[0]&&(this.extensions=arguments[0].extensions))},s.org.pkijs.simpl.TSP_REQUEST.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.TSP_REQUEST());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for TSP_REQUEST");if(this.version=t.result["TimeStampReq.version"].value_block.value_dec,this.messageImprint=new s.org.pkijs.simpl.tsp.MessageImprint({schema:t.result["TimeStampReq.messageImprint"]}),"TimeStampReq.reqPolicy"in t.result&&(this.reqPolicy=t.result["TimeStampReq.reqPolicy"].value_block.toString()),"TimeStampReq.nonce"in t.result&&(this.nonce=t.result["TimeStampReq.nonce"]),"TimeStampReq.certReq"in t.result&&(this.certReq=t.result["TimeStampReq.certReq"].value_block.value),"TimeStampReq.extensions"in t.result){this.extensions=new Array;for(var i=t.result["TimeStampReq.extensions"],r=0;r<i.length;r++)this.extensions.push(new s.org.pkijs.simpl.EXTENSION({schema:i[r]}))}},s.org.pkijs.simpl.TSP_REQUEST.prototype.toSchema=function(){var e=new Array;if(e.push(new s.org.pkijs.asn1.INTEGER({value:this.version})),e.push(this.messageImprint.toSchema()),"reqPolicy"in this&&e.push(new s.org.pkijs.asn1.OID({value:this.reqPolicy})),"nonce"in this&&e.push(this.nonce),"certReq"in this&&e.push(new s.org.pkijs.asn1.BOOLEAN({value:this.certReq})),"extensions"in this){for(var t=new Array,i=0;i<this.extensions.length;i++)t.push(this.extensions[i].toSchema());e.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:t}))}return new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.TSP_REQUEST.prototype.toJSON=function(){var s={version:this.version,messageImprint:this.messageImprint.toJSON()};if("reqPolicy"in this&&(s.reqPolicy=this.reqPolicy),"nonce"in this&&(s.nonce=this.nonce.toJSON()),"certReq"in this&&(s.certReq=this.certReq),"extensions"in this){s.extensions=new Array;for(var e=0;e<this.extensions.length;e++)s.extensions.push(this.extensions[e].toJSON())}return s},s.org.pkijs.simpl.tsp.Accuracy=function(){arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.tsp.Accuracy.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&("seconds"in arguments[0]&&(this.seconds=arguments[0].seconds),"millis"in arguments[0]&&(this.millis=arguments[0].millis),"micros"in arguments[0]&&(this.micros=arguments[0].micros))},s.org.pkijs.simpl.tsp.Accuracy.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.tsp.Accuracy({names:{seconds:"seconds",millis:"millis",micros:"micros"}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for tsp.Accuracy");if("seconds"in t.result&&(this.seconds=t.result.seconds.value_block.value_dec),"millis"in t.result){var i=new s.org.pkijs.asn1.INTEGER({value_hex:t.result.millis.value_block.value_hex});this.millis=i.value_block.value_dec}if("micros"in t.result){var r=new s.org.pkijs.asn1.INTEGER({value_hex:t.result.micros.value_block.value_hex});this.micros=r.value_block.value_dec}},s.org.pkijs.simpl.tsp.Accuracy.prototype.toSchema=function(){var e=new Array;if("seconds"in this&&e.push(new s.org.pkijs.asn1.INTEGER({value:this.seconds})),"millis"in this){var t=new s.org.pkijs.asn1.INTEGER({value:this.millis});e.push(new s.org.pkijs.asn1.ASN1_PRIMITIVE({id_block:{tag_class:3,tag_number:0},value_hex:t.value_block.value_hex}))}if("micros"in this){var i=new s.org.pkijs.asn1.INTEGER({value:this.micros});e.push(new s.org.pkijs.asn1.ASN1_PRIMITIVE({id_block:{tag_class:3,tag_number:1},value_hex:i.value_block.value_hex}))}return new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.tsp.Accuracy.prototype.toJSON=function(){var s={};return"seconds"in this&&(s.seconds=this.seconds),"millis"in this&&(s.millis=this.millis),"micros"in this&&(s.micros=this.micros),s},s.org.pkijs.simpl.TST_INFO=function(){this.version=0,this.policy="",this.messageImprint=new s.org.pkijs.simpl.tsp.MessageImprint,this.serialNumber=new s.org.pkijs.asn1.INTEGER,this.genTime=new Date(0,0,0),arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.TST_INFO.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.policy=arguments[0].policy||"",this.messageImprint=arguments[0].messageImprint||new s.org.pkijs.simpl.tsp.MessageImprint,this.serialNumber=arguments[0].serialNumber||new s.org.pkijs.asn1.INTEGER,this.genTime=arguments[0].genTime||new Date(0,0,0),"accuracy"in arguments[0]&&(this.accuracy=arguments[0].accuracy),"ordering"in arguments[0]&&(this.ordering=arguments[0].ordering),"nonce"in arguments[0]&&(this.nonce=arguments[0].nonce),"tsa"in arguments[0]&&(this.tsa=arguments[0].tsa),"extensions"in arguments[0]&&(this.extensions=arguments[0].extensions))},s.org.pkijs.simpl.TST_INFO.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.TST_INFO());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for TST_INFO");if(this.version=t.result["TSTInfo.version"].value_block.value_dec,this.policy=t.result["TSTInfo.policy"].value_block.toString(),this.messageImprint=new s.org.pkijs.simpl.tsp.MessageImprint({schema:t.result["TSTInfo.messageImprint"]}),this.serialNumber=t.result["TSTInfo.serialNumber"],this.genTime=t.result["TSTInfo.genTime"].toDate(),"TSTInfo.accuracy"in t.result&&(this.accuracy=new s.org.pkijs.simpl.tsp.Accuracy({schema:t.result["TSTInfo.accuracy"]})),"TSTInfo.ordering"in t.result&&(this.ordering=t.result["TSTInfo.ordering"].value_block.value),"TSTInfo.nonce"in t.result&&(this.nonce=t.result["TSTInfo.nonce"]),"TSTInfo.tsa"in t.result&&(this.tsa=new s.org.pkijs.simpl.GENERAL_NAME({schema:t.result["TSTInfo.tsa"]})),"TSTInfo.extensions"in t.result)for(var i=t.result["TSTInfo.extensions"],r=0;r<i.length;r++)this.extensions.push(new s.org.pkijs.simpl.EXTENSION({schema:i[r]}))},s.org.pkijs.simpl.TST_INFO.prototype.toSchema=function(){var e=new Array;if(e.push(new s.org.pkijs.asn1.INTEGER({value:this.version})),e.push(new s.org.pkijs.asn1.OID({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new s.org.pkijs.asn1.GENERALIZEDTIME({value_date:this.genTime})),"accuracy"in this&&e.push(this.accuracy.toSchema()),"ordering"in this&&e.push(new s.org.pkijs.asn1.BOOLEAN({value:this.ordering})),"nonce"in this&&e.push(this.nonce),"tsa"in this&&e.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[this.tsa.toSchema()]})),"extensions"in this){for(var t=new Array,i=0;i<this.extensions.length;i++)t.push(this.extensions[i].toSchema());e.push(new s.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:t}))}return new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.TST_INFO.prototype.toJSON=function(){var s={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};if("accuracy"in this&&(s.accuracy=this.accuracy.toJSON()),"ordering"in this&&(s.ordering=this.ordering),"nonce"in this&&(s.nonce=this.nonce.toJSON()),"tsa"in this&&(s.tsa=this.tsa.toJSON()),"extensions"in this){s.extensions=new Array;for(var e=0;e<this.extensions.length;e++)s.extensions.push(this.extensions[e].toJSON())}return s},s.org.pkijs.simpl.tsp.PKIStatusInfo=function(){this.status=2,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.tsp.PKIStatusInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.status=s.org.pkijs.getValue(arguments[0],"status",2),"statusStrings"in arguments[0]&&(this.statusStrings=arguments[0].statusStrings),"failInfo"in arguments[0]&&(this.failInfo=arguments[0].failInfo))},s.org.pkijs.simpl.tsp.PKIStatusInfo.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.tsp.PKIStatusInfo({names:{status:"status",statusStrings:"statusStrings",failInfo:"failInfo"}}));if(t.verified===!1)throw new Error("Object's schema was not verified against input data for PKIStatusInfo");var i=t.result.status;if(i.value_block.is_hex_only===!0||i.value_block.value_dec<0||i.value_block.value_dec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=i.value_block.value_dec,"statusStrings"in t.result&&(this.statusStrings=t.result.statusStrings),"failInfo"in t.result&&(this.failInfo=t.result.failInfo)},s.org.pkijs.simpl.tsp.PKIStatusInfo.prototype.toSchema=function(){var e=new Array;return e.push(new s.org.pkijs.asn1.INTEGER({value:this.status})),"statusStrings"in this&&e.push(new s.org.pkijs.asn1.SEQUENCE({optional:!0,value:this.statusStrings})),"failInfo"in this&&e.push(this.failInfo),new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.tsp.PKIStatusInfo.prototype.toJSON=function(){var s={status:this.status};if("statusStrings"in this){s.statusStrings=new Array;for(var e=0;e<this.statusStrings.length;e++)s.statusStrings.push(this.statusStrings[e].toJSON())}return"failInfo"in this&&(s.failInfo=this.failInfo.toJSON()),s},s.org.pkijs.simpl.TSP_RESPONSE=function(){this.status=new s.org.pkijs.simpl.tsp.PKIStatusInfo,arguments[0]instanceof Object&&"schema"in arguments[0]?s.org.pkijs.simpl.TSP_RESPONSE.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.status=arguments[0].status||new s.org.pkijs.simpl.tsp.PKIStatusInfo,"timeStampToken"in arguments[0]&&(this.timeStampToken=arguments[0].timeStampToken))},s.org.pkijs.simpl.TSP_RESPONSE.prototype.fromSchema=function(e){var t=s.org.pkijs.compareSchema(e,e,s.org.pkijs.schema.TSP_RESPONSE());if(t.verified===!1)throw new Error("Object's schema was not verified against input data for TSP_RESPONSE");this.status=new s.org.pkijs.simpl.tsp.PKIStatusInfo({schema:t.result["TimeStampResp.status"]}),"TimeStampResp.timeStampToken"in t.result&&(this.timeStampToken=new s.org.pkijs.simpl.CMS_CONTENT_INFO({schema:t.result["TimeStampResp.timeStampToken"]}))},s.org.pkijs.simpl.TSP_RESPONSE.prototype.toSchema=function(){var e=new Array;return e.push(this.status.toSchema()),"timeStampToken"in this&&e.push(this.timeStampToken.toSchema()),new s.org.pkijs.asn1.SEQUENCE({value:e})},s.org.pkijs.simpl.TSP_RESPONSE.prototype.verify=function(){var e=this;if("timeStampToken"in this==!1)return new Promise(function(s,e){e("timeStampToken is absent in TSP response")});var t=new Array;if(arguments[0]instanceof Object&&"trusted_certs"in arguments[0]&&(t=arguments[0].trusted_certs),"1.2.840.113549.1.7.2"!==this.timeStampToken.contentType)return new Promise(function(s,t){t("Wrong format of timeStampToken: "+e.timeStampToken.contentType)});var i=new s.org.pkijs.simpl.CMS_SIGNED_DATA({schema:this.timeStampToken.content});return i.verify({signer:0,trusted_certs:t})},s.org.pkijs.simpl.TSP_RESPONSE.prototype.sign=function(e,t){var i=this;if("timeStampToken"in this==!1)return new Promise(function(s,e){e("timeStampToken is absent in TSP response")});if("1.2.840.113549.1.7.2"!==this.timeStampToken.contentType)return new Promise(function(s,e){e("Wrong format of timeStampToken: "+i.timeStampToken.contentType)});var r=new s.org.pkijs.simpl.CMS_SIGNED_DATA({schema:this.timeStampToken.content});return r.sign(e,0,t)},s.org.pkijs.simpl.TSP_RESPONSE.prototype.toJSON=function(){var s={status:this.status};return"timeStampToken"in this&&(s.timeStampToken=this.timeStampToken.toJSON()),s}}("undefined"!=typeof exports?exports:window);