!function(e){if("undefined"==typeof e.org)e.org={};else if("object"!=typeof e.org)throw new Error("Name org already exists and it's not an object");if("undefined"==typeof e.org.pkijs)e.org.pkijs={};else if("object"!=typeof e.org.pkijs)throw new Error("Name org.pkijs already exists and it's not an object but "+typeof e.org.pkijs);if("undefined"==typeof e.org.pkijs.simpl)e.org.pkijs.simpl={};else if("object"!=typeof e.org.pkijs.simpl)throw new Error("Name org.pkijs.simpl already exists and it's not an object but "+typeof e.org.pkijs.simpl);if("undefined"==typeof e.org.pkijs.simpl.cms)e.org.pkijs.simpl.cms={};else if("object"!=typeof e.org.pkijs.simpl.cms)throw new Error("Name org.pkijs.simpl.cms already exists and it's not an object but "+typeof e.org.pkijs.simpl.cms);e.org.pkijs.simpl.cms.kdfWithCounter=function(t,i,r,n){switch(t.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:return new Promise(function(e,i){i("Unknown hash function: "+t)})}if(i instanceof ArrayBuffer==!1)return new Promise(function(e,t){t('Please set "Zbuffer" as "ArrayBuffer"')});if(0===i.byteLength)return new Promise(function(e,t){t('"Zbuffer" has zero length, error')});if(n instanceof ArrayBuffer==!1)return new Promise(function(e,t){t('Please set "SharedInfo" as "ArrayBuffer"')});if(r>255)return new Promise(function(e,t){t('Please set "Counter" variable to value less or equal to 255')});var s=new ArrayBuffer(4),o=new Uint8Array(s);o[0]=0,o[1]=0,o[2]=0,o[3]=r;var a=new ArrayBuffer(0),c=e.org.pkijs.getCrypto();return"undefined"==typeof c?new Promise(function(e,t){t("Unable to create WebCrypto object")}):(a=e.org.pkijs.concat_buffers(a,i),a=e.org.pkijs.concat_buffers(a,s),a=e.org.pkijs.concat_buffers(a,n),c.digest({name:t},a).then(function(e){return{counter:r,result:e}}))},e.org.pkijs.simpl.cms.kdf=function(t,i,r,n){var s=0,o=1,a=new Array;switch(t.toUpperCase()){case"SHA-1":s=160;break;case"SHA-256":s=256;break;case"SHA-384":s=384;break;case"SHA-512":s=512;break;default:return new Promise(function(e,i){i("Unknown hash function: "+t)})}if(i instanceof ArrayBuffer==!1)return new Promise(function(e,t){t('Please set "Zbuffer" as "ArrayBuffer"')});if(0===i.byteLength)return new Promise(function(e,t){t('"Zbuffer" has zero length, error')});if(n instanceof ArrayBuffer==!1)return new Promise(function(e,t){t('Please set "SharedInfo" as "ArrayBuffer"')});var c=r/s;Math.floor(c)>0&&(o=Math.floor(c),c-o>0&&o++);for(var p=1;o>=p;p++)a.push(e.org.pkijs.simpl.cms.kdfWithCounter(t,i,p,n));return Promise.all(a).then(function(e){for(var t=new ArrayBuffer(0),i=1,n=!0;n;){n=!1;for(var s=0;s<e.length;s++)if(e[s].counter===i){t=org.pkijs.concat_buffers(t,e[s].result),n=!0;break}i++}if(r>>=3,t.byteLength>r){for(var o=new ArrayBuffer(r),a=new Uint8Array(o),c=new Uint8Array(t),s=0;r>s;s++)a[s]=c[s];return o}return t},function(e){return new Promise(function(t,i){i(e)})})},e.org.pkijs.simpl.CMS_CONTENT_INFO=function(){this.contentType="",this.content=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.contentType=arguments[0].contentType||"",this.content=arguments[0].content||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_CONTENT_INFO());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_CONTENT_INFO");this.contentType=i.result.contentType.value_block.toString(),this.content=i.result.content},e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.contentType}),new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.content]})]})},e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.toJSON=function(){var t={contentType:this.contentType};return this.content instanceof e.org.pkijs.asn1.ANY||(t.content=this.content.toJSON()),t},e.org.pkijs.simpl.cms.OtherCertificateFormat=function(){this.otherCertFormat="",this.otherCert=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.otherCertFormat=arguments[0].contentType||"",this.otherCert=arguments[0].content||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherCertificateFormat());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherCertificateFormat");this.otherCertFormat=i.result.otherCertFormat.value_block.toString(),this.otherCert=i.result.otherCert},e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.otherCertFormat}),this.otherCert]})},e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.toJSON=function(){var t={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof e.org.pkijs.asn1.ANY||(t.otherCert=this.otherCert.toJSON()),t},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat=function(){this.otherRevInfoFormat="",this.otherRevInfo=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.otherRevInfoFormat=arguments[0].contentType||"",this.otherRevInfo=arguments[0].content||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherRevocationInfoFormat());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherRevocationInfoFormat");this.otherRevInfoFormat=i.result.otherRevInfoFormat.value_block.toString(),this.otherRevInfo=i.result.otherRevInfo},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.otherRevInfoFormat}),this.otherRevInfo]})},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.toJSON=function(){var t={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof e.org.pkijs.asn1.ANY||(t.otherRevInfo=this.otherRevInfo.toJSON()),t},e.org.pkijs.simpl.CMS_CERTIFICATE_SET=function(){this.certificates=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.certificates=arguments[0].certificates||new Array)},e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_CERTIFICATE_SET());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_CERTIFICATE_SET");for(var r=i.result.certificates,n=0;r>n;n++)1===r.id_block.tag_class?this.certificates.push(new e.org.pkijs.simpl.CERT({schema:r[n]})):this.certificates.push(r[n])},e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.certificates.length;i++)this.certificates[i]instanceof e.org.pkijs.simpl.CERT?t.push(this.certificates[i].toSchema()):t.push(this.certificates[i]);return new e.org.pkijs.asn1.SET({value:t})},e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.toJSON=function(){var e={};e.certificates=new Array;for(var t=0;t<this.certificates.length;t++)e.certificates.push(this.certificates[t].toJSON());return e},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES=function(){this.crls=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.crls=arguments[0].crls||new Array)},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CSM_REVOCATION_INFO_CHOICES());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CSM_REVOCATION_INFO_CHOICES");for(var r=i.result.crls,n=0;r>n;n++)1===r.id_block.tag_class?this.crls.push(new e.org.pkijs.simpl.CRL({schema:r[n]})):this.crls.push(r[n])},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.crls.length;i++)this.crls[i]instanceof e.org.pkijs.simpl.CRL?t.push(this.crls[i].toSchema()):t.push(this.crls[i]);return new e.org.pkijs.asn1.SET({value:t})},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.toJSON=function(){var e={};e.crls=new Array;for(var t=0;t<this.crls.length;t++)e.crls.push(this.crls[t].toJSON());return e},e.org.pkijs.simpl.cms.IssuerAndSerialNumber=function(){this.issuer=new e.org.pkijs.simpl.RDN,this.serialNumber=new e.org.pkijs.asn1.INTEGER,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.issuer=arguments[0].issuer||new e.org.pkijs.simpl.RDN,this.serialNumber=arguments[0].serialNumber||new e.org.pkijs.asn1.INTEGER)},e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.IssuerAndSerialNumber({names:{issuer:{names:{block_name:"issuer"}},serialNumber:"serialNumber"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for IssuerAndSerialNumber");this.issuer=new e.org.pkijs.simpl.RDN({schema:i.result.issuer}),this.serialNumber=i.result.serialNumber},e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[this.issuer.toSchema(),this.serialNumber]})},e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.toJSON=function(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}},e.org.pkijs.simpl.cms.Attribute=function(){this.attrType="",this.attrValues=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.Attribute.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.attrType=arguments[0].attrType||"",this.attrValues=arguments[0].attrValues||new Array)},e.org.pkijs.simpl.cms.Attribute.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.Attribute({names:{attrType:"attrType",attrValues:"attrValues"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for Attribute");this.attrType=i.result.attrType.value_block.toString(),this.attrValues=i.result.attrValues},e.org.pkijs.simpl.cms.Attribute.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.attrType}),new e.org.pkijs.asn1.SET({value:this.attrValues})]})},e.org.pkijs.simpl.cms.Attribute.prototype.toJSON=function(){var e={attrType:this.attrType};e.attrValues=new Array;for(var t=0;t<this.attrValues.length;t++)e.attrValues.push(this.attrValues[t].toJSON());return e},e.org.pkijs.simpl.x509.RSAES_OAEP_params=function(){arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.x509.RSAES_OAEP_params.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&("hashAlgorithm"in arguments[0]&&(this.hashAlgorithm=arguments[0].hashAlgorithm),"maskGenAlgorithm"in arguments[0]&&(this.maskGenAlgorithm=arguments[0].maskGenAlgorithm),"pSourceAlgorithm"in arguments[0]&&(this.pSourceAlgorithm=arguments[0].pSourceAlgorithm))},e.org.pkijs.simpl.x509.RSAES_OAEP_params.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.x509.RSAES_OAEP_params({names:{hashAlgorithm:{names:{block_name:"hashAlgorithm"}},maskGenAlgorithm:{names:{block_name:"maskGenAlgorithm"}},pSourceAlgorithm:{names:{block_name:"pSourceAlgorithm"}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RSAES_OAEP_params");"hashAlgorithm"in i.result&&(this.hashAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.hashAlgorithm})),"maskGenAlgorithm"in i.result&&(this.maskGenAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.maskGenAlgorithm})),"pSourceAlgorithm"in i.result&&(this.pSourceAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.pSourceAlgorithm}))},e.org.pkijs.simpl.x509.RSAES_OAEP_params.prototype.toSchema=function(){var t=new Array;return"hashAlgorithm"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.hashAlgorithm.toSchema()]})),"maskGenAlgorithm"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:1},value:[this.maskGenAlgorithm.toSchema()]})),"pSourceAlgorithm"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:2},value:[this.pSourceAlgorithm.toSchema()]})),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.x509.RSAES_OAEP_params.prototype.toJSON=function(){var e={};return"hashAlgorithm"in this&&(e.hashAlgorithm=this.hashAlgorithm.toJSON()),"maskGenAlgorithm"in this&&(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),"pSourceAlgorithm"in this&&(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e},e.org.pkijs.simpl.cms.PBKDF2_params=function(){this.salt=new e.org.pkijs.emptyObject,this.iterationCount=0,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.PBKDF2_params.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.salt=arguments[0].salt||new e.org.pkijs.emptyObject,this.iterationCount=arguments[0].iterationCount||0,"keyLength"in arguments[0]&&(this.keyLength=arguments[0].keyLength),"prf"in arguments[0]&&(this.prf=arguments[0].prf))},e.org.pkijs.simpl.cms.PBKDF2_params.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.PBKDF2_params({names:{salt_primitive:"salt",salt_constructed:{names:{block_name:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{block_name:"prf",optional:!0}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for PBKDF2_params");this.salt=i.result.salt,this.iterationCount=i.result.iterationCount.value_block.value_dec,"keyLength"in i.result&&(this.keyLength=i.result.keyLength.value_block.value_dec),"prf"in i.result&&(this.prf=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.prf}))},e.org.pkijs.simpl.cms.PBKDF2_params.prototype.toSchema=function(){var t=new Array;return t.push(this.salt),t.push(new e.org.pkijs.asn1.INTEGER({value:this.iterationCount})),"keyLength"in this&&t.push(new e.org.pkijs.asn1.INTEGER({value:this.keyLength})),"prf"in this&&t.push(this.prf.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.PBKDF2_params.prototype.toJSON=function(){var e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return"keyLength"in this&&(e.keyLength=this.keyLength),"prf"in this&&(e.prf=this.prf.toJSON()),e},e.org.pkijs.simpl.cms.SignedUnsignedAttributes=function(){this.type=0,this.attributes=new Array,this.encoded_value=new ArrayBuffer(0),arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.type=arguments[0].type||0,this.attributes=arguments[0].attributes||new Array)},e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.SignedUnsignedAttributes({names:{attributes:"attributes"}},this.type));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for SignedUnsignedAttributes");this.type=i.result.id_block.tag_number,this.encoded_value=i.result.value_before_decode;var r=new Uint8Array(this.encoded_value);if(r[0]=49,"attributes"in i.result!=!1)for(var n=i.result.attributes,s=0;s<n.length;s++)this.attributes.push(new e.org.pkijs.simpl.cms.Attribute({schema:n[s]}));else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")},e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.attributes.length;i++)t.push(this.attributes[i].toSchema());return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:this.type},value:t})},e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.toJSON=function(){var e={type:this.type};e.attributes=new Array;for(var t=0;t<this.attributes.length;t++)e.attributes.push(this.attributes[t].toJSON());return e},e.org.pkijs.simpl.CMS_SIGNER_INFO=function(){this.version=0,this.sid=new e.org.pkijs.asn1.ANY,this.digestAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signatureAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.sid=arguments[0].sid||new e.org.pkijs.asn1.ANY,this.digestAlgorithm=arguments[0].digestAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,"signedAttrs"in arguments[0]&&(this.signedAttrs=arguments[0].signedAttrs),this.signatureAlgorithm=arguments[0].signatureAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=arguments[0].signature||new e.org.pkijs.asn1.OCTETSTRING,"unsignedAttrs"in arguments[0]&&(this.unsignedAttrs=arguments[0].unsignedAttrs))},e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_SIGNER_INFO());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_SIGNER_INFO");this.version=i.result["SignerInfo.version"].value_block.value_dec;var r=i.result["SignerInfo.sid"];1===r.id_block.tag_class?this.sid=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:r}):this.sid=r,this.digestAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result["SignerInfo.digestAlgorithm"]}),"SignerInfo.signedAttrs"in i.result&&(this.signedAttrs=new e.org.pkijs.simpl.cms.SignedUnsignedAttributes({schema:i.result["SignerInfo.signedAttrs"]})),this.signatureAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result["SignerInfo.signatureAlgorithm"]}),this.signature=i.result["SignerInfo.signature"],"SignerInfo.unsignedAttrs"in i.result&&(this.unsignedAttrs=new e.org.pkijs.simpl.cms.SignedUnsignedAttributes,this.unsignedAttrs.type=1,this.unsignedAttrs.fromSchema(i.result["SignerInfo.unsignedAttrs"]))},e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),this.sid instanceof e.org.pkijs.simpl.cms.IssuerAndSerialNumber?t.push(this.sid.toSchema()):t.push(this.sid),t.push(this.digestAlgorithm.toSchema()),"signedAttrs"in this&&t.push(this.signedAttrs.toSchema()),t.push(this.signatureAlgorithm.toSchema()),t.push(this.signature),"unsignedAttrs"in this&&t.push(this.unsignedAttrs.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.toJSON=function(){var t={version:this.version};return this.sid instanceof e.org.pkijs.asn1.ANY||(t.sid=this.sid.toJSON()),t.digestAlgorithm=this.digestAlgorithm.toJSON(),"signedAttrs"in this&&(t.signedAttrs=this.signedAttrs.toJSON()),t.signatureAlgorithm=this.signatureAlgorithm.toJSON(),t.signature=this.signature.toJSON(),"unsignedAttrs"in this&&(t.unsignedAttrs=this.unsignedAttrs.toJSON()),t},e.org.pkijs.simpl.cms.EncapsulatedContentInfo=function(){if(this.eContentType="",arguments[0]instanceof Object&&"schema"in arguments[0])e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.fromSchema.call(this,arguments[0].schema);else if(arguments[0]instanceof Object&&(this.eContentType=arguments[0].eContentType||"","eContent"in arguments[0]&&(this.eContent=arguments[0].eContent,1===this.eContent.id_block.tag_class&&4===this.eContent.id_block.tag_number&&this.eContent.id_block.is_constructed===!1))){for(var t=new e.org.pkijs.asn1.OCTETSTRING({id_block:{is_constructed:!0},is_constructed:!0}),i=0,r=this.eContent.value_block.value_hex.byteLength;r>0;){for(var n=new Uint8Array(this.eContent.value_block.value_hex,i,i+65536>this.eContent.value_block.value_hex.byteLength?this.eContent.value_block.value_hex.byteLength-i:65536),s=new ArrayBuffer(n.length),o=new Uint8Array(s),a=0;a<o.length;a++)o[a]=n[a];t.value_block.value.push(new e.org.pkijs.asn1.OCTETSTRING({value_hex:s})),r-=n.length,i+=n.length}this.eContent=t}},e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.EncapsulatedContentInfo({names:{eContentType:"eContentType",eContent:"eContent"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for EncapsulatedContentInfo");this.eContentType=i.result.eContentType.value_block.toString(),"eContent"in i.result&&(this.eContent=i.result.eContent)},e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.OID({value:this.eContentType})),"eContent"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[this.eContent]})),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.toJSON=function(){var e={eContentType:this.eContentType};return"eContent"in this&&(e.eContent=this.eContent.toJSON()),e},e.org.pkijs.simpl.CMS_SIGNED_DATA=function(){this.version=0,this.digestAlgorithms=new Array,this.encapContentInfo=new e.org.pkijs.simpl.cms.EncapsulatedContentInfo,this.signerInfos=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.digestAlgorithms=arguments[0].digestAlgorithms||new Array,this.encapContentInfo=arguments[0].encapContentInfo||new e.org.pkijs.simpl.cms.EncapsulatedContentInfo,"certificates"in arguments[0]&&(this.certificates=arguments[0].certificates),"crls"in arguments[0]&&(this.crls=arguments[0].crls),this.signerInfos=arguments[0].signerInfos||new Array)},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_SIGNED_DATA());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_SIGNED_DATA");this.version=i.result["SignedData.version"].value_block.value_dec;for(var r=i.result["SignedData.digestAlgorithms"],n=0;n<r.length;n++)this.digestAlgorithms.push(new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:r[n]}));if(this.encapContentInfo=new e.org.pkijs.simpl.cms.EncapsulatedContentInfo({schema:i.result["SignedData.encapContentInfo"]}),"SignedData.certificates"in i.result){this.certificates=new Array;for(var s=i.result["SignedData.certificates"],o=0;o<s.length;o++)1===s[o].id_block.tag_class?this.certificates.push(new e.org.pkijs.simpl.CERT({schema:s[o]})):this.certificates.push(new e.org.pkijs.simpl.cms.OtherCertificateFormat({schema:s[o]}))}if("SignedData.crls"in i.result){this.crls=new Array;for(var a=i.result["SignedData.crls"],c=0;c<a.length;c++)1===a[c].id_block.tag_class?this.crls.push(new e.org.pkijs.simpl.CRL({schema:a[c]})):this.crls.push(new e.org.pkijs.simpl.cms.OtherRevocationInfoFormat({schema:a[c]}))}for(var p=i.result["SignedData.signerInfos"],h=0;h<p.length;h++)this.signerInfos.push(new e.org.pkijs.simpl.CMS_SIGNER_INFO({schema:p[h]}))},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.toSchema=function(t){"undefined"==typeof t&&(t=!1);var i=new Array;i.push(new e.org.pkijs.asn1.INTEGER({value:this.version}));for(var r=new Array,n=0;n<this.digestAlgorithms.length;n++)r.push(this.digestAlgorithms[n].toSchema(t));if(i.push(new e.org.pkijs.asn1.SET({value:r})),i.push(this.encapContentInfo.toSchema()),"certificates"in this){for(var s=new Array,o=0;o<this.certificates.length;o++)s.push(this.certificates[o].toSchema(t));i.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:s}))}if("crls"in this){for(var a=new Array,c=0;c<this.crls.length;c++)a.push(this.crls[c].toSchema(t));i.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:a}))}for(var p=new Array,h=0;h<this.signerInfos.length;h++)p.push(this.signerInfos[h].toSchema(t));return i.push(new e.org.pkijs.asn1.SET({value:p})),new e.org.pkijs.asn1.SEQUENCE({value:i})},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.verify=function(){function t(e){if(e.issuer.isEqual(p.issuer)===!0&&e.serialNumber.isEqual(p.serialNumber)===!0)return null;for(var t=!1,i=0;i<e.extensions.length;i++)"2.5.29.19"===e.extensions[i].extnID&&"cA"in e.extensions[i].parsedValue&&e.extensions[i].parsedValue.cA===!0&&(t=!0);return t?e:null}var i=Promise.resolve(),r=this.certificates,n=this.signerInfos,s=this.encapContentInfo,o=new ArrayBuffer(0),a="",c=-1,p={},h=new Array,m=this,l=e.org.pkijs.getCrypto();if("undefined"==typeof l)return new Promise(function(e,t){t("Unable to create WebCrypto object")});if(arguments[0]instanceof Object&&("signer"in arguments[0]&&(c=arguments[0].signer),"data"in arguments[0]&&(o=arguments[0].data),"trusted_certs"in arguments[0]&&(h=arguments[0].trusted_certs)),-1===c)return new Promise(function(e,t){t("Unable to get signer index from input parameters")});if("certificates"in this==!1)return new Promise(function(e,t){t("No certificates attached to this signed data")});i=this.signerInfos[c].sid instanceof e.org.pkijs.simpl.cms.IssuerAndSerialNumber?i.then(function(){for(var e=0;r.length;e++)if(r[e].issuer.isEqual(n[c].sid.issuer)&&r[e].serialNumber.isEqual(n[c].sid.serialNumber))return p=r[e],new Promise(function(e,t){e()});return new Promise(function(e,t){t("Unable to find signer certificate")})}):i.then(function(){for(var t=new Array,i=0;i<r.length;i++)t.push(l.digest({name:"sha-1"},new Uint8Array(r[i].subjectPublicKeyInfo.subjectPublicKey.value_block.value_hex)));return Promise.all(t).then(function(t){for(var i=0;i<r.length;i++)if(e.org.pkijs.isEqual_buffer(t[i],n[c].sid.value_block.value_hex))return p=r[i],new Promise(function(e,t){e()});return new Promise(function(e,t){t("Unable to find signer certificate")})},function(e){return new Promise(function(e,t){t("Unable to find signer certificate")})})});for(var u=new Array,g=0;g<this.certificates.length;g++)u.push(t(this.certificates[g]));return i=i.then(function(e){return Promise.all(u).then(function(e){var t=new Array;t.push(p);for(var i=0;i<e.length;i++)null!==e[i]&&t.push(e[i]);var r=new org.pkijs.simpl.CERT_CHAIN({certs:t,trusted_certs:h});return"crls"in m&&(r.crls=m.crls),r.verify().then(function(e){return e.result===!0?new Promise(function(e,t){e()}):new Promise(function(e,t){t("Validation of signer's certificate failed")})},function(e){return new Promise(function(t,i){i("Validation of signer's certificate failed with error: "+(e instanceof Object?e.result_message:e))})})},function(e){return new Promise(function(t,i){i("Error during checking certificates for CA flag: "+e)})})}),i=i.then(function(){var t=e.org.pkijs.getAlgorithmByOID(n[c].digestAlgorithm.algorithm_id);return"name"in t==!1?new Promise(function(e,t){t("Unsupported signature algorithm: "+m.signerInfos[c].digestAlgorithm.algorithm_id)}):(a=t.name,new Promise(function(e,t){e()}))}),i=i.then(function(){if("signedAttrs"in n[c])o=n[c].signedAttrs.encoded_value;else if("eContent"in s)if(1===s.eContent.id_block.tag_class&&4===s.eContent.id_block.tag_number)if(s.eContent.id_block.is_constructed===!1)o=s.eContent.value_block.value_hex;else for(var t=0;t<s.eContent.value_block.value.length;t++)o=e.org.pkijs.concat_buffers(o,s.eContent.value_block.value[t].value_block.value_hex);else o=s.eContent.value_block.value_hex;else if(0===o.byteLength)return new Promise(function(e,t){t("Missed detached data input array")})}),i=i.then(function(){var t=e.org.pkijs.getAlgorithmByOID(p.signatureAlgorithm.algorithm_id);if("name"in t==!1)return new Promise(function(e,t){t("Unsupported public key algorithm: "+p.signatureAlgorithm.algorithm_id)});var i=t.name,r=e.org.pkijs.getAlgorithmParameters(i,"importkey");"hash"in r.algorithm&&(r.algorithm.hash.name=a);var n=p.subjectPublicKeyInfo.toSchema(),s=n.toBER(!1),o=new Uint8Array(s);return l.importKey("spki",o,r.algorithm,!0,r.usages)}),i=i.then(function(t){var i=e.org.pkijs.getAlgorithmParameters(t.algorithm.name,"verify");"hash"in i.algorithm&&(i.algorithm.hash.name=a);var r=n[c].signature.value_block.value_hex;if("ECDSA"===t.algorithm.name){var s=e.org.pkijs.fromBER(r);r=e.org.pkijs.createECDSASignatureFromCMS(s.result)}if("RSA-PSS"===t.algorithm.name){var p;try{p=new e.org.pkijs.simpl.x509.RSASSA_PSS_params({schema:n[c].signatureAlgorithm.algorithm_params})}catch(h){return new Promise(function(e,t){t(h)})}"saltLength"in p?i.algorithm.saltLength=p.saltLength:i.algorithm.saltLength=20;var m="SHA-1";if("hashAlgorithm"in p){var u=e.org.pkijs.getAlgorithmByOID(p.hashAlgorithm.algorithm_id);if("name"in u==!1)return new Promise(function(e,t){t("Unrecognized hash algorithm: "+p.hashAlgorithm.algorithm_id)});m=u.name}i.algorithm.hash.name=m}return l.verify(i.algorithm,t,new Uint8Array(r),new Uint8Array(o))},function(e){return new Promise(function(t,i){i(e)})})},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.sign=function(t,i,r){var n=this,s=new ArrayBuffer(0),o="";if("undefined"==typeof t)return new Promise(function(e,t){t("Need to provide a private key for signing")});if("undefined"==typeof r&&(r="SHA-1"),o=e.org.pkijs.getOIDByAlgorithm({name:r}),""===o)return new Promise(function(e,t){t("Unsupported hash algorithm: "+r)});for(var a=!1,c=0;c<n.digestAlgorithms.length;c++)if(n.digestAlgorithms[c].algorithm_id===o){a=!0;break}a===!1&&n.digestAlgorithms.push(new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:o,algorithm_params:new org.pkijs.asn1.NULL})),n.signerInfos[i].digestAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:o,algorithm_params:new org.pkijs.asn1.NULL});var p=e.org.pkijs.getAlgorithmParameters(t.algorithm.name,"sign");switch(p.algorithm.hash.name=r,t.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":n.signerInfos[i].signatureAlgorithm.algorithm_id=e.org.pkijs.getOIDByAlgorithm(p.algorithm);break;case"RSA-PSS":switch(r.toUpperCase()){case"SHA-256":p.algorithm.saltLength=32;break;case"SHA-384":p.algorithm.saltLength=48;break;case"SHA-512":p.algorithm.saltLength=64}var h={};if("SHA-1"!==r.toUpperCase()){if(o=e.org.pkijs.getOIDByAlgorithm({name:r}),""===o)return new Promise(function(e,t){t("Unsupported hash algorithm: "+r)});h.hashAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:o,algorithm_params:new org.pkijs.asn1.NULL}),h.maskGenAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.8",algorithm_params:h.hashAlgorithm.toSchema()})}20!==p.algorithm.saltLength&&(h.saltLength=p.algorithm.saltLength);var m=new e.org.pkijs.simpl.x509.RSASSA_PSS_params(h);n.signerInfos[i].signatureAlgorithm=new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.10",algorithm_params:m.toSchema()});break;default:return new Promise(function(e,i){i("Unsupported signature algorithm: "+t.algorithm.name)})}if("signedAttrs"in n.signerInfos[i])if(0!==n.signerInfos[i].signedAttrs.encoded_value.byteLength)s=n.signerInfos[i].signedAttrs.encoded_value;else{s=n.signerInfos[i].signedAttrs.toSchema(!0).toBER(!1);
var l=new Uint8Array(s);l[0]=49}else if("eContent"in n.encapContentInfo)if(1===n.encapContentInfo.eContent.id_block.tag_class&&4===n.encapContentInfo.eContent.id_block.tag_number)if(n.encapContentInfo.eContent.id_block.is_constructed===!1)s=n.encapContentInfo.eContent.value_block.value_hex;else for(var c=0;c<n.encapContentInfo.eContent.value_block.value.length;c++)s=e.org.pkijs.concat_buffers(s,n.encapContentInfo.eContent.value_block.value[c].value_block.value_hex);else s=n.encapContentInfo.eContent.value_block.value_hex;else if(0===s.byteLength)return new Promise(function(e,t){t("Missed detached data input array")});var u=e.org.pkijs.getCrypto();return"undefined"==typeof u?new Promise(function(e,t){t("Unable to create WebCrypto object")}):u.sign(p.algorithm,t,new Uint8Array(s)).then(function(t){return"ECDSA"===p.algorithm.name&&(t=e.org.pkijs.createCMSECDSASignature(t)),n.signerInfos[i].signature=new e.org.pkijs.asn1.OCTETSTRING({value_hex:t}),new Promise(function(e,i){e(t)})},function(e){return new Promise(function(t,i){i("Signing error: "+e)})})},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.toJSON=function(){var e={version:this.version};e.digestAlgorithms=new Array;for(var t=0;t<this.digestAlgorithms.length;t++)e.digestAlgorithms.push(this.digestAlgorithms[t].toJSON());if(e.encapContentInfo=this.encapContentInfo.toJSON(),"certificates"in this){e.certificates=new Array;for(var t=0;t<this.certificates.length;t++)e.certificates.push(this.certificates[t].toJSON())}if("crls"in this){e.crls=new Array;for(var t=0;t<this.crls.length;t++)e.crls.push(this.crls[t].toJSON())}e.signerInfos=new Array;for(var t=0;t<this.signerInfos.length;t++)e.signerInfos.push(this.signerInfos[t].toJSON());return e},e.org.pkijs.simpl.cms.ECC_CMS_SharedInfo=function(){this.keyInfo=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.suppPubInfo=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.ECC_CMS_SharedInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.keyInfo=arguments[0].keyInfo||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,"entityUInfo"in arguments[0]&&(this.entityUInfo=arguments[0].entityUInfo),this.suppPubInfo=arguments[0].suppPubInfo||new e.org.pkijs.asn1.OCTETSTRING)},e.org.pkijs.simpl.cms.ECC_CMS_SharedInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.ECC_CMS_SharedInfo({names:{keyInfo:{names:{block_name:"keyInfo"}},entityUInfo:"entityUInfo",suppPubInfo:"suppPubInfo"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for ECC_CMS_SharedInfo");this.keyInfo=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyInfo}),"entityUInfo"in i.result&&(this.entityUInfo=i.result.entityUInfo.value_block.value[0]),this.suppPubInfo=i.result.suppPubInfo.value_block.value[0]},e.org.pkijs.simpl.cms.ECC_CMS_SharedInfo.prototype.toSchema=function(){var t=new Array;return t.push(this.keyInfo.toSchema()),"entityUInfo"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.entityUInfo]})),t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:2},value:[this.suppPubInfo]})),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.ECC_CMS_SharedInfo.prototype.toJSON=function(){var e={keyInfo:this.keyInfo.toJSON()};return"entityUInfo"in this&&(e.entityUInfo=this.entityUInfo.toJSON()),e.suppPubInfo=this.suppPubInfo.toJSON(),e},e.org.pkijs.simpl.cms.RecipientIdentifier=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientIdentifier({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientIdentifier");1===i.result.block_name.id_block.tag_class?(this.variant=1,this.value=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.block_name})):(this.variant=2,this.value=i.result.block_name.value_block.value[0])},e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.toSchema=function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.value]});default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.KeyTransRecipientInfo=function(){this.version=-1,this.rid=new e.org.pkijs.emptyObject,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,this.recipientCertificate=new e.org.pkijs.simpl.CERT,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||-1,this.rid=arguments[0].rid||new e.org.pkijs.emptyObject,this.keyEncryptionAlgorithm=arguments[0].keyEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING,this.recipientCertificate=arguments[0].recipientCertificate||new e.org.pkijs.simpl.CERT)},e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KeyTransRecipientInfo({names:{version:"version",rid:{names:{block_name:"rid"}},keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KeyTransRecipientInfo");this.version=i.result.version.value_block.value_dec,3===i.result.rid.id_block.tag_class?this.rid=i.result.rid.value_block.value[0]:this.rid=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.rid}),this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),this.rid instanceof e.org.pkijs.simpl.cms.IssuerAndSerialNumber?t.push(this.rid.toSchema()):t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.rid]})),t.push(this.keyEncryptionAlgorithm.toSchema()),t.push(this.encryptedKey),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.toJSON=function(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.OriginatorPublicKey=function(){this.algorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.publicKey=new e.org.pkijs.asn1.BITSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.algorithm=arguments[0].algorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.publicKey=arguments[0].publicKey||new e.org.pkijs.asn1.BITSTRING)},e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OriginatorPublicKey({names:{algorithm:{names:{block_name:"algorithm"}},publicKey:"publicKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OriginatorPublicKey");this.algorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.algorithm}),this.publicKey=i.result.publicKey},e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[this.algorithm.toSchema(),this.publicKey]})},e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.toJSON=function(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OriginatorIdentifierOrKey({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OriginatorIdentifierOrKey");1===i.result.block_name.id_block.tag_class?(this.variant=1,this.value=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.block_name})):0===i.result.block_name.id_block.tag_number?(i.result.block_name.id_block.tag_class=1,i.result.block_name.id_block.tag_number=4,this.variant=2,this.value=i.result.block_name):(i.result.block_name.id_block.tag_class=1,i.result.block_name.id_block.tag_number=16,this.variant=3,this.value=new e.org.pkijs.simpl.cms.OriginatorPublicKey({schema:i.result.block_name}))},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.toSchema=function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.id_block.tag_class=3,this.value.id_block.tag_number=0,this.value;case 3:var t=this.value.toSchema();return t.id_block.tag_class=3,t.id_block.tag_number=1,t;default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant&&3!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.OtherKeyAttribute=function(){this.keyAttrId="",arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.keyAttrId=arguments[0].keyAttrId||new e.org.pkijs.asn1.OID,"keyAttr"in arguments[0]&&(this.keyAttr=arguments[0].keyAttr))},e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherKeyAttribute({names:{keyAttrId:"keyAttrId",keyAttr:"keyAttr"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherKeyAttribute");this.keyAttrId=i.result.keyAttrId.value_block.toString(),"keyAttr"in i.result&&(this.keyAttr=i.result.keyAttr)},e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.OID({value:this.keyAttrId})),"keyAttr"in this&&t.push(this.keyAttr.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.toJSON=function(){var e={keyAttrId:this.keyAttrId};return"keyAttr"in this&&(e.keyAttr=this.keyAttr.toJSON()),e},e.org.pkijs.simpl.cms.RecipientKeyIdentifier=function(){this.subjectKeyIdentifier=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.subjectKeyIdentifier=arguments[0].subjectKeyIdentifier||new e.org.pkijs.asn1.OCTETSTRING,"date"in arguments[0]&&(this.date=arguments[0].date),"other"in arguments[0]&&(this.other=arguments[0].other))},e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientKeyIdentifier({names:{subjectKeyIdentifier:"subjectKeyIdentifier",date:"date",other:{names:{block_name:"other"}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientKeyIdentifier");this.subjectKeyIdentifier=i.result.subjectKeyIdentifier,"date"in i.result&&(this.date=i.result.date),"other"in i.result&&(this.other=new e.org.pkijs.simpl.cms.OtherKeyAttribute({schema:i.result.other}))},e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.toSchema=function(){var t=new Array;return t.push(this.subjectKeyIdentifier),"date"in this&&t.push(this.date),"other"in this&&t.push(this.other.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.toJSON=function(){var e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KeyAgreeRecipientIdentifier({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientIdentifier");1===i.result.block_name.id_block.tag_class?(this.variant=1,this.value=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.block_name})):(this.variant=2,i.result.block_name.id_block.tag_class=1,i.result.block_name.id_block.tag_number=16,this.value=new e.org.pkijs.simpl.cms.RecipientKeyIdentifier({schema:i.result.block_name}))},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.toSchema=function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:this.value.toSchema().value_block.value});default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.RecipientEncryptedKey=function(){this.rid=new e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.rid=arguments[0].rid||new e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING)},e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientEncryptedKey({names:{rid:{names:{block_name:"rid"}},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKey");this.rid=new e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier({schema:i.result.rid}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[this.rid.toSchema(),this.encryptedKey]})},e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.toJSON=function(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.RecipientEncryptedKeys=function(){this.encryptedKeys=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.encryptedKeys=arguments[0].encryptedKeys||new Array)},e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientEncryptedKeys({names:{RecipientEncryptedKeys:"RecipientEncryptedKeys"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKeys");for(var r=i.result.RecipientEncryptedKeys,n=0;n<r.length;n++)this.encryptedKeys.push(new e.org.pkijs.simpl.cms.RecipientEncryptedKey({schema:r[n]}))},e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.encryptedKeys.length;i++)t.push(this.encryptedKeys[i].toSchema());return new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.toJSON=function(){var e={};e.encryptedKeys=new Array;for(var t=0;t<this.encryptedKeys.length;t++)e.encryptedKeys.push(this.encryptedKeys[t].toJSON());return e},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo=function(){this.version=0,this.originator=new e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.recipientEncryptedKeys=new e.org.pkijs.simpl.cms.RecipientEncryptedKeys,this.recipientCertificate=new e.org.pkijs.simpl.CERT,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.originator=arguments[0].originator||new e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey,"ukm"in arguments[0]&&(this.ukm=arguments[0].ukm),this.keyEncryptionAlgorithm=arguments[0].keyEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.recipientEncryptedKeys=arguments[0].recipientEncryptedKeys||new e.org.pkijs.simpl.cms.RecipientEncryptedKeys,this.recipientCertificate=arguments[0].recipientCertificate||new e.org.pkijs.simpl.CERT)},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KeyAgreeRecipientInfo({names:{version:"version",originator:{names:{block_name:"originator"}},ukm:"ukm",keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},recipientEncryptedKeys:{names:{block_name:"recipientEncryptedKeys"}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientInfo");this.version=i.result.version.value_block.value_dec,this.originator=new e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey({schema:i.result.originator}),"ukm"in i.result&&(this.ukm=i.result.ukm),this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new e.org.pkijs.simpl.cms.RecipientEncryptedKeys({schema:i.result.recipientEncryptedKeys})},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.originator.toSchema()]})),"ukm"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:[this.ukm]})),t.push(this.keyEncryptionAlgorithm.toSchema()),t.push(this.recipientEncryptedKeys.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.toJSON=function(){return{version:this.version,originator:this.originator.toJSON(),ukm:this.ukm.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()}},e.org.pkijs.simpl.cms.KEKIdentifier=function(){this.keyIdentifier=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KEKIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.keyIdentifier=arguments[0].keyIdentifier||new e.org.pkijs.asn1.OCTETSTRING,"date"in arguments[0]&&(this.date=arguments[0].date),"other"in arguments[0]&&(this.other=arguments[0].other))},e.org.pkijs.simpl.cms.KEKIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KEKIdentifier({names:{keyIdentifier:"keyIdentifier",date:"date",other:{names:{block_name:"other"}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KEKIdentifier");this.keyIdentifier=i.result.keyIdentifier,"date"in i.result&&(this.date=i.result.date),"other"in i.result&&(this.other=new e.org.pkijs.simpl.cms.OtherKeyAttribute({schema:i.result.other}))},e.org.pkijs.simpl.cms.KEKIdentifier.prototype.toSchema=function(){var t=new Array;return t.push(this.keyIdentifier),"date"in this&&t.push(this.date),"other"in this&&t.push(this.other.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.KEKIdentifier.prototype.toJSON=function(){var e={keyIdentifier:this.keyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e},e.org.pkijs.simpl.cms.KEKRecipientInfo=function(){this.version=0,this.kekid=new e.org.pkijs.simpl.cms.KEKIdentifier,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,this.preDefinedKEK=new ArrayBuffer(0),arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.kekid=arguments[0].kekid||new e.org.pkijs.simpl.cms.KEKIdentifier,this.keyEncryptionAlgorithm=arguments[0].keyEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING,this.preDefinedKEK=arguments[0].preDefinedKEK||new ArrayBuffer(0))},e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KEKRecipientInfo({names:{version:"version",kekid:{names:{block_name:"kekid"}},keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KEKRecipientInfo");this.version=i.result.version.value_block.value_dec,this.kekid=new e.org.pkijs.simpl.cms.KEKIdentifier({schema:i.result.kekid}),this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.INTEGER({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})},e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.toJSON=function(){return{version:this.version,kekid:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.PasswordRecipientinfo=function(){this.version=-1,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,this.password=new ArrayBuffer(0),arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&("version"in arguments[0]?this.version=arguments[0].version:this.version=-1,"keyDerivationAlgorithm"in arguments[0]&&(this.keyDerivationAlgorithm=arguments[0].keyDerivationAlgorithm),this.keyEncryptionAlgorithm=arguments[0].keyEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING,this.password=arguments[0].password||new ArrayBuffer(0))},e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.PasswordRecipientinfo({names:{version:"version",keyDerivationAlgorithm:"keyDerivationAlgorithm",keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for PasswordRecipientinfo");this.version=i.result.version.value_block.value_dec,"keyDerivationAlgorithm"in i.result&&(i.result.keyDerivationAlgorithm.id_block.tag_class=1,i.result.keyDerivationAlgorithm.id_block.tag_number=16,this.keyDerivationAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyDerivationAlgorithm})),this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),"keyDerivationAlgorithm"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:this.keyDerivationAlgorithm.toSchema().value_block.value})),t.push(this.keyEncryptionAlgorithm.toSchema()),t.push(this.encryptedKey),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.toJSON=function(){return{version:this.version,keyDerivationAlgorithm:this.keyDerivationAlgorithm.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.OtherRecipientInfo=function(){this.oriType="",this.oriValue=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.oriType=arguments[0].oriType||"",this.oriValue=arguments[0].oriValue||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherRecipientInfo({names:{oriType:"oriType",oriValue:"oriValue"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherRecipientInfo");this.oriType=i.result.oriType.value_block.toString(),this.oriValue=i.result.oriValue},e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.oriType}),this.oriValue]})},e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.toJSON=function(){var t={oriType:this.oriType};return this.oriValue instanceof e.org.pkijs.asn1.ANY||(t.oriValue=this.oriValue.toJSON()),t},e.org.pkijs.simpl.CMS_RECIPIENT_INFO=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_RECIPIENT_INFO({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_RECIPIENT_INFO");if(1===i.result.block_name.id_block.tag_class)this.variant=1,this.value=new e.org.pkijs.simpl.cms.KeyTransRecipientInfo({schema:i.result.block_name});else{var r=i.result.block_name.id_block.tag_number;switch(i.result.block_name.id_block.tag_class=1,i.result.block_name.id_block.tag_number=16,r){case 1:this.variant=2,this.value=new e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo({schema:i.result.block_name});break;case 2:this.variant=3,this.value=new e.org.pkijs.simpl.cms.KEKRecipientInfo({schema:i.result.block_name});break;case 3:this.variant=4,this.value=new e.org.pkijs.simpl.cms.PasswordRecipientinfo({schema:i.result.block_name});break;case 4:this.variant=5,this.value=new e.org.pkijs.simpl.cms.OtherRecipientInfo({schema:i.result.block_name})}}},e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.toSchema=function(){var t=this.value.toSchema();switch(this.variant){case 1:return t;case 2:case 3:case 4:return t.id_block.tag_class=3,t.id_block.tag_number=this.variant-1,t;default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.OriginatorInfo=function(){this.certs=new e.org.pkijs.simpl.CMS_CERTIFICATE_SET,this.crls=new e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OriginatorInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.certs=arguments[0].certs||new e.org.pkijs.simpl.CMS_CERTIFICATE_SET,this.crls=arguments[0].crls||new e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES)},e.org.pkijs.simpl.cms.OriginatorInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OriginatorInfo({names:{certs:"certs",crls:"crls"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OriginatorInfo");i.result.certs.id_block.tag_class=1,i.result.certs.id_block.tag_number=17,this.certs=new e.org.pkijs.simpl.CMS_CERTIFICATE_SET({schema:i.result.certs}),i.result.crls.id_block.tag_class=1,i.result.crls.id_block.tag_number=17,this.crls=new e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES({schema:i.result.crls})},e.org.pkijs.simpl.cms.OriginatorInfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:this.certs.toSchema().value_block.value}),new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:this.crls.toSchema().value_block.value})]})},e.org.pkijs.simpl.cms.OriginatorInfo.prototype.toJSON=function(){return{certs:this.certs.toJSON(),crls:this.crls.toJSON()}},e.org.pkijs.simpl.cms.EncryptedContentInfo=function(){if(this.contentType="",this.contentEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,arguments[0]instanceof Object&&"schema"in arguments[0])e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.fromSchema.call(this,arguments[0].schema);else if(arguments[0]instanceof Object&&(this.contentType=arguments[0].contentType||"",this.contentEncryptionAlgorithm=arguments[0].contentEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,"encryptedContent"in arguments[0]&&(this.encryptedContent=arguments[0].encryptedContent,1===this.encryptedContent.id_block.tag_class&&4===this.encryptedContent.id_block.tag_number&&this.encryptedContent.id_block.is_constructed===!1))){for(var t=new e.org.pkijs.asn1.OCTETSTRING({id_block:{is_constructed:!0},is_constructed:!0}),i=0,r=this.encryptedContent.value_block.value_hex.byteLength;r>0;){for(var n=new Uint8Array(this.encryptedContent.value_block.value_hex,i,i+1024>this.encryptedContent.value_block.value_hex.byteLength?this.encryptedContent.value_block.value_hex.byteLength-i:1024),s=new ArrayBuffer(n.length),o=new Uint8Array(s),a=0;a<o.length;a++)o[a]=n[a];t.value_block.value.push(new e.org.pkijs.asn1.OCTETSTRING({value_hex:s})),r-=n.length,i+=n.length}this.encryptedContent=t}},e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.EncryptedContentInfo({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{block_name:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");
this.contentType=i.result.contentType.value_block.toString(),this.contentEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.contentEncryptionAlgorithm}),"encryptedContent"in i.result&&(this.encryptedContent=i.result.encryptedContent,this.encryptedContent.id_block.tag_class=1,this.encryptedContent.id_block.tag_number=4)},e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.toSchema=function(){var t={is_indefinite_form:!1},i=new Array;if(i.push(new e.org.pkijs.asn1.OID({value:this.contentType})),i.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){t.is_indefinite_form=this.encryptedContent.id_block.is_constructed;var r=this.encryptedContent;r.id_block.tag_class=3,r.id_block.tag_number=0,r.len_block.is_indefinite_form=this.encryptedContent.id_block.is_constructed,i.push(r)}return new e.org.pkijs.asn1.SEQUENCE({len_block:t,value:i})},e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.toJSON=function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e},e.org.pkijs.simpl.CMS_ENVELOPED_DATA=function(){this.version=0,this.recipientInfos=new Array,this.encryptedContentInfo=new e.org.pkijs.simpl.cms.EncryptedContentInfo,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,"originatorInfo"in arguments[0]&&(this.originatorInfo=arguments[0].originatorInfo),this.recipientInfos=arguments[0].recipientInfos||new Array,this.encryptedContentInfo=arguments[0].encryptedContentInfo||new e.org.pkijs.simpl.cms.EncryptedContentInfo,"unprotectedAttrs"in arguments[0]&&(this.unprotectedAttrs=arguments[0].unprotectedAttrs))},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_ENVELOPED_DATA({names:{version:"version",originatorInfo:"originatorInfo",recipientInfos:"recipientInfos",encryptedContentInfo:{names:{block_name:"encryptedContentInfo"}},unprotectedAttrs:"unprotectedAttrs"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_ENVELOPED_DATA");this.version=i.result.version.value_block.value_dec,"originatorInfo"in i.result&&(i.result.originatorInfo.id_block.tag_class=1,i.result.originatorInfo.id_block.tag_number=16,this.originatorInfo=new e.org.pkijs.simpl.cms.OriginatorInfo({schema:i.result.originatorInfo}));for(var r=i.result.recipientInfos,n=0;n<r.length;n++)this.recipientInfos.push(new e.org.pkijs.simpl.CMS_RECIPIENT_INFO({schema:r[n]}));if(this.encryptedContentInfo=new e.org.pkijs.simpl.cms.EncryptedContentInfo({schema:i.result.encryptedContentInfo}),"unprotectedAttrs"in i.result){this.unprotectedAttrs=new Array;for(var s=i.result.unprotectedAttrs,o=0;o<s.length;o++)this.unprotectedAttrs.push(new e.org.pkijs.simpl.ATTRIBUTE({schema:s[o]}))}},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.toSchema=function(){var t=new Array;t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),"originatorInfo"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:this.originatorInfo.toSchema().value_block.value}));for(var i=new Array,r=0;r<this.recipientInfos.length;r++)i.push(this.recipientInfos[r].toSchema());if(t.push(new e.org.pkijs.asn1.SET({value:i})),t.push(this.encryptedContentInfo.toSchema()),"unprotectedAttrs"in this){for(var n=new Array,s=0;s<this.unprotectedAttrs.length;s++)n.push(this.unprotectedAttrs[s].toSchema());t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:n}))}return new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.toJSON=function(){var e={version:this.version};"originatorInfo"in this&&(e.originatorInfo=this.originatorInfo.toJSON()),e.recipientInfos=new Array;for(var t=0;t<this.recipientInfos.length;t++)e.recipientInfos.push(this.recipientInfos[t].toJSON());if(e.encryptedContentInfo=this.encryptedContentInfo.toJSON(),"unprotectedAttrs"in this){e.unprotectedAttrs=new Array;for(var t=0;t<this.unprotectedAttrs.length;t++)e.unprotectedAttrs.push(this.unprotectedAttrs[t].toJSON())}return e},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.addRecipientByCertificate=function(t,i,r){var n=0,s=i||{};if(-1!==t.subjectPublicKeyInfo.algorithm.algorithm_id.indexOf("1.2.840.113549"))n=1,r=1;else{if(-1===t.subjectPublicKeyInfo.algorithm.algorithm_id.indexOf("1.2.840.10045"))throw new Error("Unknown type of certificate's public key: "+t.subjectPublicKeyInfo.algorithm.algorithm_id);n=2,r=2}switch("oaepHashAlgorithm"in s==!1&&(s.oaepHashAlgorithm="SHA-512"),"kdfAlgorithm"in s==!1&&(s.kdfAlgorithm="SHA-512"),"kekEncryptionLength"in s==!1&&(s.kekEncryptionLength=256),r){case 1:var o=e.org.pkijs.getOIDByAlgorithm({name:"RSA-OAEP"});if(""===o)throw new Error("Can not find OID for OAEP");var a=e.org.pkijs.getOIDByAlgorithm({name:s.oaepHashAlgorithm});if(""===a)throw new Error("Unknown OAEP hash algorithm: "+s.oaepHashAlgorithm);var c=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:a,algorithm_params:new e.org.pkijs.asn1.NULL}),p=new e.org.pkijs.simpl.x509.RSAES_OAEP_params({hashAlgorithm:c,maskGenAlgorithm:new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.8",algorithm_params:c.toSchema()})}),h=new e.org.pkijs.simpl.cms.KeyTransRecipientInfo({version:0,rid:new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({issuer:t.issuer,serialNumber:t.serialNumber}),keyEncryptionAlgorithm:new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:o,algorithm_params:p.toSchema()}),recipientCertificate:t});this.recipientInfos.push(new e.org.pkijs.simpl.CMS_RECIPIENT_INFO({variant:1,value:h}));break;case 2:var m=new e.org.pkijs.simpl.cms.RecipientEncryptedKey({rid:new e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier({variant:1,value:new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({issuer:t.issuer,serialNumber:t.serialNumber})})}),l=e.org.pkijs.getOIDByAlgorithm({name:"AES-KW",length:s.kekEncryptionLength});if(""===l)throw new Error("Unknown length for key encryption algorithm: "+s.kekEncryptionLength);var u=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:l,algorithm_params:new e.org.pkijs.asn1.NULL}),g=e.org.pkijs.getOIDByAlgorithm({name:"ECDH",kdf:s.kdfAlgorithm});if(""===g)throw new Error("Unknown KDF algorithm: "+s.kdfAlgorithm);var f=new ArrayBuffer(64),y=new Uint8Array(f);e.org.pkijs.getRandomValues(y);var h=new org.pkijs.simpl.cms.KeyAgreeRecipientInfo({version:3,ukm:new org.pkijs.asn1.OCTETSTRING({value_hex:f}),keyEncryptionAlgorithm:new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:g,algorithm_params:u.toSchema()}),recipientEncryptedKeys:new org.pkijs.simpl.cms.RecipientEncryptedKeys({encryptedKeys:[m]}),recipientCertificate:t});this.recipientInfos.push(new e.org.pkijs.simpl.CMS_RECIPIENT_INFO({variant:2,value:h}));break;default:throw new Error('Unknown "variant" value: '+r)}return!0},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.addRecipientByPreDefinedData=function(t,i,r){var n=i||{};if(t instanceof ArrayBuffer==!1)throw new Error('Please pass "preDefinedData" in ArrayBuffer type');if(0===t.byteLength)throw new Error("Pre-defined data could have zero length");if("keyIdentifier"in n==!1){var s=new ArrayBuffer(16),o=new Uint8Array(s);e.org.pkijs.getRandomValues(o),n.keyIdentifier=s}switch("hmacHashAlgorithm"in n==!1&&(n.hmacHashAlgorithm="SHA-512"),"iterationCount"in n==!1&&(n.iterationCount=2048),"keyEncryptionAlgorithm"in n==!1&&(n.keyEncryptionAlgorithm={name:"AES-KW",length:256}),"keyEncryptionAlgorithmParams"in n==!1&&(n.keyEncryptionAlgorithmParams=new e.org.pkijs.asn1.NULL),r){case 1:var a=e.org.pkijs.getOIDByAlgorithm(n.keyEncryptionAlgorithm);if(""===a)throw new Error('Incorrect value for "keyEncryptionAlgorithm"');var c=new e.org.pkijs.simpl.cms.KEKRecipientInfo({version:4,kekid:new e.org.pkijs.simpl.cms.KEKIdentifier({keyIdentifier:new e.org.pkijs.asn1.OCTETSTRING({value_hex:n.keyIdentifier})}),keyEncryptionAlgorithm:new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:a,algorithm_params:n.keyEncryptionAlgorithmParams}),preDefinedKEK:t});this.recipientInfos.push(new e.org.pkijs.simpl.CMS_RECIPIENT_INFO({variant:3,value:c}));break;case 2:var p=e.org.pkijs.getOIDByAlgorithm({name:"PBKDF2"});if(""===p)throw new Error("Can not find OID for PBKDF2");var h=new ArrayBuffer(64),m=new Uint8Array(h);e.org.pkijs.getRandomValues(m);var l=e.org.pkijs.getOIDByAlgorithm({name:"HMAC",hash:{name:n.hmacHashAlgorithm}});if(""===l)throw new Error('Incorrect value for "hmacHashAlgorithm": '+n.hmacHashAlgorithm);var u=new e.org.pkijs.simpl.cms.PBKDF2_params({salt:new e.org.pkijs.asn1.OCTETSTRING({value_hex:h}),iterationCount:n.iterationCount,prf:new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:l,algorithm_params:new e.org.pkijs.asn1.NULL})}),a=e.org.pkijs.getOIDByAlgorithm(n.keyEncryptionAlgorithm);if(""===a)throw new Error('Incorrect value for "keyEncryptionAlgorithm"');var c=new e.org.pkijs.simpl.cms.PasswordRecipientinfo({version:0,keyDerivationAlgorithm:new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:p,algorithm_params:u.toSchema()}),keyEncryptionAlgorithm:new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:a,algorithm_params:n.keyEncryptionAlgorithmParams}),password:t});this.recipientInfos.push(new e.org.pkijs.simpl.CMS_RECIPIENT_INFO({variant:4,value:c}));break;default:throw new Error('Unknown value for "variant": '+r)}},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.encrypt=function(t,i){function r(t){var i,r,n,s,o,c=Promise.resolve();return c=c.then(function(i){var r=a.recipientInfos[t].value.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithm_params;if(r instanceof e.org.pkijs.asn1.OID==!1)return new Promise(function(e,i){i('Incorrect "recipientCertificate" for index '+t)});var o=r.value_block.toString();switch(o){case"1.2.840.10045.3.1.7":n="P-256",s=256;break;case"1.3.132.0.34":n="P-384",s=384;break;case"1.3.132.0.35":n="P-521",s=528;break;default:return new Promise(function(e,i){i("Incorrect curve OID for index "+t)})}return n}),c=c.then(function(e){return k.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"])},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){return i=e.publicKey,r=e.privateKey,k.exportKey("spki",i)},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){return o=e,a.recipientInfos[t].value.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:n},usages:[]}})},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){return k.deriveBits({name:"ECDH","public":e},r,s)},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(i){var r=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_params}),n=e.org.pkijs.getAlgorithmByOID(r.algorithm_id);if("name"in n==!1)return new Promise(function(e,t){t("Incorrect OID for key encryption algorithm: "+r.algorithm_id)});for(var s=n.length,o=new ArrayBuffer(4),c=new Uint8Array(o),p=3;p>=0;p--)c[p]=s,s>>=8;var h=new org.pkijs.simpl.cms.ECC_CMS_SharedInfo({keyInfo:new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:r.algorithm_id,algorithm_params:new org.pkijs.asn1.NULL}),entityUInfo:a.recipientInfos[t].value.ukm,suppPubInfo:new org.pkijs.asn1.OCTETSTRING({value_hex:o})}),m=h.toSchema().toBER(!1),l=e.org.pkijs.getAlgorithmByOID(a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id);return"name"in l==!1?new Promise(function(e,i){i("Incorrect OID for key encryption algorithm: "+a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id)}):e.org.pkijs.simpl.cms.kdf(l.kdf,i,n.length,m)},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){return k.importKey("raw",e,{name:"AES-KW"},!0,["wrapKey"])},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){return k.wrapKey("raw",m,e,{name:"AES-KW"})},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(i){var r=org.pkijs.fromBER(o),n=new org.pkijs.simpl.cms.OriginatorIdentifierOrKey;n.variant=3,n.value=new org.pkijs.simpl.cms.OriginatorPublicKey({schema:r.result}),"algorithm_params"in n.value.algorithm&&delete n.value.algorithm.algorithm_params,a.recipientInfos[t].value.originator=n,a.recipientInfos[t].value.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new e.org.pkijs.asn1.OCTETSTRING({value_hex:i})},function(e){return new Promise(function(t,i){i(e)})})}function n(t){var i=Promise.resolve();return i=i.then(function(i){var r=a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_params,n=new e.org.pkijs.simpl.x509.RSAES_OAEP_params({schema:r}),s=e.org.pkijs.getAlgorithmByOID(n.hashAlgorithm.algorithm_id);return"name"in s==!1?new Promise(function(e,t){t("Incorrect OID for hash algorithm: "+n.hashAlgorithm.algorithm_id)}):a.recipientInfos[t].value.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"RSA-OAEP",hash:{name:s.name}},usages:["encrypt","wrapKey"]}})},function(e){return new Promise(function(t,i){i(e)})}),i=i.then(function(e){return k.encrypt({name:"RSA-OAEP"},e,u)},function(e){return new Promise(function(t,i){i(e)})}),i=i.then(function(i){a.recipientInfos[t].value.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING({value_hex:i})},function(e){return new Promise(function(t,i){i(e)})})}function s(t){var i,r=Promise.resolve();return r=r.then(function(r){return i=e.org.pkijs.getAlgorithmByOID(a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id),"name"in i==!1?new Promise(function(e,i){i('Incorrect OID for "keyEncryptionAlgorithm": '+a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id)}):k.importKey("raw",new Uint8Array(a.recipientInfos[t].value.preDefinedKEK),i,!0,["wrapKey"])},function(e){return new Promise(function(t,i){i(e)})}),r=r.then(function(e){return k.wrapKey("raw",m,e,i)},function(e){return new Promise(function(t,i){i(e)})}),r=r.then(function(i){a.recipientInfos[t].value.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING({value_hex:i})},function(e){return new Promise(function(t,i){i(e)})})}function o(t){var i,r,n=Promise.resolve();return n=n.then(function(r){if("keyDerivationAlgorithm"in a.recipientInfos[t].value==!1)return new Promise(function(e,t){t('Please append encoded "keyDerivationAlgorithm"')});if("algorithm_params"in a.recipientInfos[t].value.keyDerivationAlgorithm==!1)return new Promise(function(e,t){t('Incorrectly encoded "keyDerivationAlgorithm"')});try{i=new e.org.pkijs.simpl.cms.PBKDF2_params({schema:a.recipientInfos[t].value.keyDerivationAlgorithm.algorithm_params})}catch(n){return new Promise(function(e,t){t('Incorrectly encoded "keyDerivationAlgorithm"')})}},function(e){return new Promise(function(t,i){i(e)})}),n=n.then(function(e){var i=new Uint8Array(a.recipientInfos[t].value.password);return k.importKey("raw",i,"PBKDF2",!0,["deriveKey"])},function(e){return new Promise(function(t,i){i(e)})}),n=n.then(function(n){if(r=e.org.pkijs.getAlgorithmByOID(a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id),"name"in r==!1)return new Promise(function(e,i){i('Incorrect OID for "keyEncryptionAlgorithm": '+a.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id)});var s="SHA-1";if("prf"in i){var o=e.org.pkijs.getAlgorithmByOID(i.prf.algorithm_id);if("name"in o==!1)return new Promise(function(e,t){t("Incorrect OID for HMAC hash algorithm")});s=o.hash.name}var c=new Uint8Array(i.salt.value_block.value_hex),p=i.iterationCount;return k.deriveKey({name:"PBKDF2",hash:{name:s},salt:c,iterations:p},n,r,!0,["wrapKey"])},function(e){return new Promise(function(t,i){i(e)})}),n=n.then(function(e){return k.wrapKey("raw",m,e,r)},function(e){return new Promise(function(t,i){i(e)})}),n=n.then(function(i){a.recipientInfos[t].value.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING({value_hex:i})},function(e){return new Promise(function(t,i){i(e)})})}var a=this,c=Promise.resolve(),p=new ArrayBuffer(16),h=new Uint8Array(p);e.org.pkijs.getRandomValues(h);var m,l,u,g=new Uint8Array(i),f=new Array,y=e.org.pkijs.getOIDByAlgorithm(t);if(""===y)return new Promise(function(e,t){t('Wrong "contentEncryptionAlgorithm" value')});var k=e.org.pkijs.getCrypto();return"undefined"==typeof k?new Promise(function(e,t){t("Unable to create WebCrypto object")}):(c=c.then(function(e){return k.generateKey(t,!0,["encrypt"])}),c=c.then(function(e){return m=e,k.encrypt({name:t.name,iv:h},m,g)},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){return l=e,k.exportKey("raw",m)},function(e){return new Promise(function(t,i){i(e)})}).then(function(e){return u=e,!0},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(t){a.version=2,a.encryptedContentInfo=new e.org.pkijs.simpl.cms.EncryptedContentInfo({contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:y,algorithm_params:new org.pkijs.asn1.OCTETSTRING({value_hex:p})}),encryptedContent:new org.pkijs.asn1.OCTETSTRING({value_hex:l})})},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){for(var t=0;t<a.recipientInfos.length;t++){var i=Promise.resolve();switch(a.recipientInfos[t].variant){case 1:i=n(t);break;case 2:i=r(t);break;case 3:i=s(t);break;case 4:i=o(t);break;default:return new Promise(function(e,i){i("Uknown recipient type in array with index "+t)})}f.push(i)}},function(e){return new Promise(function(t,i){i(e)})}),c=c.then(function(e){return Promise.all(f)},function(e){return new Promise(function(t,i){i(e)})}))},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.decrypt=function(t,r){function n(t){var i,r,n,s,o=Promise.resolve();return o=o.then(function(s){if("recipientCertificate"in h==!1)return new Promise(function(e,t){t('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo"')});if("recipientPrivateKey"in h==!1)return new Promise(function(e,t){t('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"')});var o=h.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithm_params;if(o instanceof e.org.pkijs.asn1.OID==!1)return new Promise(function(e,i){i('Incorrect "recipientCertificate" for index '+t)});switch(n=o.value_block.toString()){case"1.2.840.10045.3.1.7":i="P-256",r=256;break;case"1.3.132.0.34":i="P-384",r=384;break;case"1.3.132.0.35":i="P-521",r=528;break;default:return new Promise(function(e,i){i("Incorrect curve OID for index "+t)})}return m.importKey("pkcs8",h.recipientPrivateKey,{name:"ECDH",namedCurve:i},!0,["deriveBits"])},function(e){return new Promise(function(t,i){i(e)})}),o=o.then(function(r){s=r,"algorithm_params"in c.recipientInfos[t].value.originator.value.algorithm==!1&&(c.recipientInfos[t].value.originator.value.algorithm.algorithm_params=new e.org.pkijs.asn1.OID({value:n}));var o=c.recipientInfos[t].value.originator.value.toSchema().toBER(!1);return m.importKey("spki",o,{name:"ECDH",namedCurve:i},!0,[])},function(e){return new Promise(function(t,i){i(e)})}),o=o.then(function(e){return m.deriveBits({name:"ECDH","public":e},s,r)},function(e){return new Promise(function(t,i){i(e)})}),o=o.then(function(i){var r=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_params}),n=e.org.pkijs.getAlgorithmByOID(r.algorithm_id);if("name"in n==!1)return new Promise(function(e,t){t("Incorrect OID for key encryption algorithm: "+r.algorithm_id)});for(var s=n.length,o=new ArrayBuffer(4),a=new Uint8Array(o),p=3;p>=0;p--)a[p]=s,s>>=8;var h=new org.pkijs.simpl.cms.ECC_CMS_SharedInfo({keyInfo:new org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:r.algorithm_id,algorithm_params:new org.pkijs.asn1.NULL}),entityUInfo:c.recipientInfos[t].value.ukm,suppPubInfo:new org.pkijs.asn1.OCTETSTRING({value_hex:o})}),m=h.toSchema().toBER(!1),l=e.org.pkijs.getAlgorithmByOID(c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id);return"name"in l==!1?new Promise(function(e,i){i("Incorrect OID for key encryption algorithm: "+c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id)}):e.org.pkijs.simpl.cms.kdf(l.kdf,i,n.length,m)},function(e){return new Promise(function(t,i){i(e)})}),o=o.then(function(e){return m.importKey("raw",e,{name:"AES-KW"},!0,["unwrapKey"])},function(e){return new Promise(function(t,i){i(e)})}),o=o.then(function(i){var r=e.org.pkijs.getAlgorithmByOID(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id);return"name"in r==!1?new Promise(function(e,t){t('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id)}):m.unwrapKey("raw",c.recipientInfos[t].value.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.value_block.value_hex,i,{name:"AES-KW"},r,!0,["decrypt"])},function(e){return new Promise(function(t,i){i(e)})})}function s(t){var i=Promise.resolve();return i=i.then(function(i){if("recipientPrivateKey"in h==!1)return new Promise(function(e,t){t('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"')});var r=c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_params,n=new e.org.pkijs.simpl.x509.RSAES_OAEP_params({schema:r}),s=e.org.pkijs.getAlgorithmByOID(n.hashAlgorithm.algorithm_id);return"name"in s==!1?new Promise(function(e,t){t("Incorrect OID for hash algorithm: "+n.hashAlgorithm.algorithm_id)}):m.importKey("pkcs8",h.recipientPrivateKey,{name:"RSA-OAEP",hash:{name:s.name}},!0,["decrypt"])},function(e){return new Promise(function(t,i){i(e)})}),i=i.then(function(e){return m.decrypt({name:"RSA-OAEP"},e,c.recipientInfos[t].value.encryptedKey.value_block.value_hex)},function(e){return new Promise(function(t,i){i(e)})}),i=i.then(function(t){var i=e.org.pkijs.getAlgorithmByOID(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id);return"name"in i==!1?new Promise(function(e,t){t('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id)}):m.importKey("raw",t,i,!0,["decrypt"])})}function o(t){var i,r=Promise.resolve();return r=r.then(function(r){return"preDefinedData"in h==!1?new Promise(function(e,t){t('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"')}):(i=e.org.pkijs.getAlgorithmByOID(c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id),"name"in i==!1?new Promise(function(e,i){i('Incorrect OID for "keyEncryptionAlgorithm": '+c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id)}):m.importKey("raw",h.preDefinedData,i,!0,["unwrapKey"]))},function(e){return new Promise(function(t,i){i(e)})}),r=r.then(function(r){var n=e.org.pkijs.getAlgorithmByOID(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id);return"name"in n==!1?new Promise(function(e,t){t('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id)}):m.unwrapKey("raw",c.recipientInfos[t].value.encryptedKey.value_block.value_hex,r,i,n,!0,["decrypt"])},function(e){return new Promise(function(t,i){i(e)})})}function a(t){var i,r,n=Promise.resolve();return n=n.then(function(r){if("preDefinedData"in h==!1)return new Promise(function(e,t){t('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"')});if("keyDerivationAlgorithm"in c.recipientInfos[t].value==!1)return new Promise(function(e,t){t('Please append encoded "keyDerivationAlgorithm"')});if("algorithm_params"in c.recipientInfos[t].value.keyDerivationAlgorithm==!1)return new Promise(function(e,t){t('Incorrectly encoded "keyDerivationAlgorithm"')});try{i=new e.org.pkijs.simpl.cms.PBKDF2_params({schema:c.recipientInfos[t].value.keyDerivationAlgorithm.algorithm_params})}catch(n){return new Promise(function(e,t){t('Incorrectly encoded "keyDerivationAlgorithm"')})}return m.importKey("raw",h.preDefinedData,"PBKDF2",!0,["deriveKey"])},function(e){return new Promise(function(t,i){i(e)})}),n=n.then(function(n){if(r=e.org.pkijs.getAlgorithmByOID(c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id),"name"in r==!1)return new Promise(function(e,i){i('Incorrect OID for "keyEncryptionAlgorithm": '+c.recipientInfos[t].value.keyEncryptionAlgorithm.algorithm_id)});var s="SHA-1";if("prf"in i){var o=e.org.pkijs.getAlgorithmByOID(i.prf.algorithm_id);if("name"in o==!1)return new Promise(function(e,t){t("Incorrect OID for HMAC hash algorithm")});s=o.hash.name}var a=new Uint8Array(i.salt.value_block.value_hex),p=i.iterationCount;return m.deriveKey({name:"PBKDF2",hash:{name:s},salt:a,iterations:p},n,r,!0,["unwrapKey"])},function(e){return new Promise(function(t,i){i(e)})}),n=n.then(function(i){var n=e.org.pkijs.getAlgorithmByOID(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id);return"name"in n==!1?new Promise(function(e,t){t('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id)}):m.unwrapKey("raw",c.recipientInfos[t].value.encryptedKey.value_block.value_hex,i,r,n,!0,["decrypt"])},function(e){return new Promise(function(t,i){i(e)})})}var c=this,p=Promise.resolve(),h=r||{};if(t+1>this.recipientInfos.length)return new Promise(function(e,t){t('Maximum value for "index" is: '+(this.recipientInfos.length-1))});var m=e.org.pkijs.getCrypto();return"undefined"==typeof m?new Promise(function(e,t){t("Unable to create WebCrypto object")}):(p=p.then(function(e){var r=Promise.resolve();switch(c.recipientInfos[t].variant){case 1:r=s(t);break;case 2:r=n(t);break;case 3:r=o(t);break;case 4:r=a(t);break;default:return new Promise(function(e,t){t("Uknown recipient type in array with index "+i)})}return r},function(e){return new Promise(function(t,i){i(e)})}),p=p.then(function(t){var i=e.org.pkijs.getAlgorithmByOID(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id);if("name"in i==!1)return new Promise(function(e,t){t('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_id)});var r=c.encryptedContentInfo.contentEncryptionAlgorithm.algorithm_params.value_block.value_hex,n=new Uint8Array(r),s=new ArrayBuffer(0);if(c.encryptedContentInfo.encryptedContent.id_block.is_constructed===!1)s=c.encryptedContentInfo.encryptedContent.value_block.value_hex;else for(var o=0;o<c.encryptedContentInfo.encryptedContent.value_block.value.length;o++)s=e.org.pkijs.concat_buffers(s,c.encryptedContentInfo.encryptedContent.value_block.value[o].value_block.value_hex);return m.decrypt({name:i.name,iv:n},t,s)},function(e){return new Promise(function(t,i){i(e)})}))}}("undefined"!=typeof exports?exports:window);