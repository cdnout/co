"use strict";const{buildSchemas:buildSchemas}=require("./schemas"),{ValidatorSelector:ValidatorSelector,SerializerCompiler:buildDefaultSerializer}=require("./schema-compilers");function buildSchemaController(e,i){if(e)return new SchemaController(e,i);const r=Object.assign({bucket:buildSchemas,compilersFactory:{buildValidator:ValidatorSelector(),buildSerializer:buildDefaultSerializer}},i);return new SchemaController(void 0,r)}class SchemaController{constructor(e,i){this.opts=i||e&&e.opts,this.addedSchemas=!1,this.compilersFactory=this.opts.compilersFactory,e?(this.schemaBucket=this.opts.bucket(e.getSchemas()),this.validatorCompiler=e.getValidatorCompiler(),this.serializerCompiler=e.getSerializerCompiler(),this.parent=e):this.schemaBucket=this.opts.bucket()}add(e){return this.addedSchemas=!0,this.schemaBucket.add(e)}getSchema(e){return this.schemaBucket.getSchema(e)}getSchemas(){return this.schemaBucket.getSchemas()}setValidatorCompiler(e){this.validatorCompiler=e}setSerializerCompiler(e){this.serializerCompiler=e}getValidatorCompiler(){return this.validatorCompiler||this.parent&&this.parent.getValidatorCompiler()}getSerializerCompiler(){return this.serializerCompiler||this.parent&&this.parent.getSerializerCompiler()}setupValidator(e){void 0!==this.validatorCompiler&&!this.addedSchemas||(this.validatorCompiler=this.compilersFactory.buildValidator(this.schemaBucket.getSchemas(),e.ajv))}setupSerializer(e){void 0!==this.serializerCompiler&&!this.addedSchemas||(this.serializerCompiler=this.compilersFactory.buildSerializer(this.schemaBucket.getSchemas()))}}module.exports=SchemaController,module.exports.buildSchemaController=buildSchemaController;