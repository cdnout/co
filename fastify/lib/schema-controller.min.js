"use strict";const buildSchemas=require("./schemas")["buildSchemas"],SerializerSelector=require("@fastify/fast-json-stringify-compiler"),ValidatorSelector=require("@fastify/ajv-compiler");function buildSchemaController(e,r){if(e)return new SchemaController(e,r);let i={buildValidator:ValidatorSelector(),buildSerializer:SerializerSelector()};r&&r.compilersFactory&&(i=Object.assign(i,r.compilersFactory));r={bucket:r&&r.bucket||buildSchemas,compilersFactory:i};return new SchemaController(void 0,r)}class SchemaController{constructor(e,r){this.opts=r||e&&e.opts,this.addedSchemas=!1,this.compilersFactory=this.opts.compilersFactory,e?(this.schemaBucket=this.opts.bucket(e.getSchemas()),this.validatorCompiler=e.getValidatorCompiler(),this.serializerCompiler=e.getSerializerCompiler(),this.parent=e):this.schemaBucket=this.opts.bucket()}add(e){return this.addedSchemas=!0,this.schemaBucket.add(e)}getSchema(e){return this.schemaBucket.getSchema(e)}getSchemas(){return this.schemaBucket.getSchemas()}setValidatorCompiler(e){this.validatorCompiler=e}setSerializerCompiler(e){this.serializerCompiler=e}getValidatorCompiler(){return this.validatorCompiler||this.parent&&this.parent.getValidatorCompiler()}getSerializerCompiler(){return this.serializerCompiler||this.parent&&this.parent.getSerializerCompiler()}getSerializerBuilder(){return this.compilersFactory.buildSerializer||this.parent&&this.parent.getSerializerBuilder()}getValidatorBuilder(){return this.compilersFactory.buildValidator||this.parent&&this.parent.getValidatorBuilder()}setupValidator(e){void 0!==this.validatorCompiler&&!this.addedSchemas||(this.validatorCompiler=this.getValidatorBuilder()(this.schemaBucket.getSchemas(),e.ajv))}setupSerializer(e){void 0!==this.serializerCompiler&&!this.addedSchemas||(this.serializerCompiler=this.getSerializerBuilder()(this.schemaBucket.getSchemas(),e.serializerOpts))}}SchemaController.buildSchemaController=buildSchemaController,module.exports=SchemaController;