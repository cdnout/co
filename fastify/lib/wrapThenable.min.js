"use strict";const{kReplyIsError:kReplyIsError,kReplySent:kReplySent,kReplySentOverwritten:kReplySentOverwritten}=require("./symbols"),{FST_ERR_PROMISE_NOT_FULFILLED:FST_ERR_PROMISE_NOT_FULFILLED}=require("./errors");function wrapThenable(e,r){e.then(function(e){if(!0!==r[kReplySentOverwritten])if(void 0!==e||204===r.raw.statusCode&&!1===r[kReplySent])try{r.send(e)}catch(e){r[kReplySent]=!1,r[kReplyIsError]=!0,r.send(e)}else!1===r[kReplySent]&&r.log.error({err:new FST_ERR_PROMISE_NOT_FULFILLED},"Promise may not be fulfilled with 'undefined' when statusCode is not 204")},function(e){!0!==r[kReplySentOverwritten]&&!0!==r.sent?(r[kReplySent]=!1,r[kReplyIsError]=!0,r.send(e)):r.log.error({err:e},"Promise errored, but reply.sent = true was set")})}module.exports=wrapThenable;