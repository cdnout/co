/**
 * Copyright (c) 2016 Sendbird DBA (Smile Family, Inc.)
 * Sendbird JavaScript SDK v3.0.144
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("axios"),require("form-data"),require("ws")):"function"==typeof define&&define.amd?define(["axios","form-data","ws"],n):(e=e||self).SendBird=n(e.axios,e.FormData,e.WebSocket)}(this,function(h,p,r){"use strict";function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}function n(n,e){var t,r=Object.keys(n);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(n),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),r.push.apply(r,t)),r}function g(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach(function(e){var n,t;n=r,e=i[t=e],t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function s(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&l(e,n)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,n){return(l=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function d(e,n,t){return(d=u()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);r=new(Function.bind.apply(e,r));return t&&l(r,t.prototype),r}).apply(null,arguments)}function t(e){var r="function"==typeof Map?new Map:void 0;return(t=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return d(e,arguments,a(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),l(t,e)})(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(t){var r=u();return function(){var e,n=a(t);return e=r?(e=a(this).constructor,Reflect.construct(n,arguments,e)):n.apply(this,arguments),n=this,!(e=e)||"object"!=typeof e&&"function"!=typeof e?y(n):e}}function _(e,n,t){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){e=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=a(e)););return e}(e,n);if(e){n=Object.getOwnPropertyDescriptor(e,n);return n.get?n.get.call(t):n.value}})(e,n,t||e)}function T(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return t}(e,n)||m(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,n){if(e){if("string"==typeof e)return v(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(e,n):void 0}}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}h=h&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h,p=p&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var ue=function(){function e(){c(this,e)}return o(e,null,[{key:"OS_VERSION",get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}},{key:"SDK_VERSION",get:function(){return"3.0.144"}},{key:"SDK_MAJOR_VERSION",get:function(){return e.SDK_VERSION.split(".")[0]}},{key:"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",get:function(){return 100}},{key:"INTERNAL_CALL",get:function(){return"ic"}}]),e}(),E={},U=new WeakMap,ce=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,t),U.set(this,"object"===le(e)&&e?e:{})}return o(t,[{key:"container",get:function(){return U.get(this)}},{key:"get",value:function(e){return U.get(this)[e]}},{key:"set",value:function(e,n){U.get(this)[e]=n}},{key:"remove",value:function(e){var n=U.get(this);n.hasOwnProperty(e)&&delete n[e]}}],[{key:"create",value:function(e,n){return E[e]=new t(n),E[e]}},{key:"get",value:function(e){return e=e||Zn.getInstance()._iid,E[e]}}]),t}(),de=function(){s(i,t(Error));var r=f(i);function i(e,n){var t;return c(this,i),(t=r.call(this,n)).name="SendBirdException",t.code=n||0,t.message=e,t}return o(i,[{key:"isSessionKeyExpiredError",get:function(){return 400309===this.code}},{key:"isSessionTokenExpiredError",get:function(){return 400302===this.code}}],[{key:"INVALID_INITIALIZATION",get:function(){return 800100}},{key:"CONNECTION_REQUIRED",get:function(){return 800101}},{key:"CONNECTION_CANCELED",get:function(){return 800102}},{key:"INVALID_PARAMETER",get:function(){return 800110}},{key:"NETWORK_ERROR",get:function(){return 800120}},{key:"NETWORK_ROUTING_ERROR",get:function(){return 800121}},{key:"MALFORMED_DATA",get:function(){return 800130}},{key:"MALFORMED_ERROR_DATA",get:function(){return 800140}},{key:"WRONG_CHANNEL_TYPE",get:function(){return 800150}},{key:"MARK_AS_READ_RATE_LIMIT_EXCEEDED",get:function(){return 800160}},{key:"QUERY_IN_PROGRESS",get:function(){return 800170}},{key:"ACK_TIMEOUT",get:function(){return 800180}},{key:"LOGIN_TIMEOUT",get:function(){return 800190}},{key:"WEBSOCKET_CONNECTION_CLOSED",get:function(){return 800200}},{key:"WEBSOCKET_CONNECTION_FAILED",get:function(){return 800210}},{key:"REQUEST_FAILED",get:function(){return 800220}},{key:"FILE_UPLOAD_CANCEL_FAILED",get:function(){return 800230}},{key:"REQUEST_CANCELED",get:function(){return 800240}},{key:"REQUEST_DUPLICATED",get:function(){return 800250}},{key:"FILE_SIZE_LIMIT_EXCEEDED",get:function(){return 800260}},{key:"SESSION_TOKEN_REQUEST_FAILED",get:function(){return 800500}},{key:"SESSION_TOKEN_REFRESHED",get:function(){return 800501}},{key:"SESSION_TOKEN_REFRESH_FAILED",get:function(){return 800502}}]),i}(),b=function(){function e(){c(this,e),this.sessionToken=null,this.sessionKey=null,this.eKey=null}return o(e,[{key:"hasSession",value:function(){return!!this.sessionKey}}]),e}(),A={},B=function(){function i(e){var n,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(n in c(this,i),this._iid=e,t){var r=t[n];"function"==typeof r&&(this[n]=this.getClonedClass(r))}A[e]=this}return o(i,[{key:"getClonedClass",value:function(t){var r=this._iid;return function(){s(n,t);var e=f(n);function n(){return c(this,n),e.apply(this,arguments)}return o(n,[{key:"_iid",get:function(){return r}}],[{key:"_iid",get:function(){return r}},{key:"_name",get:function(){return t.name}}]),n}()}}],[{key:"get",value:function(e){return e?A[e]:{}}}]),i}(),S={verbose:"VERBOSE",info:"INFO",debug:"DEBUG",warn:"WARN",error:"ERROR"},I=function(){function e(){c(this,e)}return o(e,[{key:"getLogLevelText",value:function(e){return S[e]}}]),e}(),N=function(){s(n,I);var e=f(n);function n(){return c(this,n),e.apply(this,arguments)}return o(n,[{key:"log",value:function(e){for(var n,t,r,i=this.getLogLevelText(e);i.length<8;)i+=" ";for(var a=arguments.length,s=new Array(1<a?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];switch(s.unshift("[".concat(i,"]")),e){case"verbose":(n=console).log.apply(n,s);break;case"debug":(t=console).log.apply(t,s);break;case"info":(t=console).info.apply(t,s);break;case"warn":(r=console).warn.apply(r,s);break;case"error":(r=console).error.apply(r,s)}}},{key:"groupStart",value:function(){var e;(e=console).group.apply(e,arguments)}},{key:"groupEnd",value:function(){var e;(e=console).groupEnd.apply(e,arguments)}}]),n}(),e={DEBUG:"debug",PRODUCTION:"production"},k=e.PRODUCTION,R={VERBOSE:"verbose",DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error"},O=["error","warn","info","debug","verbose"],M=R.WARN,L=O.indexOf(M),P=[new N],he=function(){function i(){c(this,i)}return o(i,null,[{key:"Mode",get:function(){return e}},{key:"mode",get:function(){return k},set:function(e){-1<Object.keys(i.Mode).map(function(e){return i.Mode[e]}).indexOf(e)&&(k=e)}},{key:"supportedLogLevels",get:function(){return R}},{key:"logLevel",get:function(){return O[L]},set:function(e){O.includes(e)||(e=M),L=O.indexOf(e)}},{key:"defaultLogLevel",get:function(){return M}},{key:"isDisplayableLogLevel",value:function(e){e=O.indexOf(e);return 0<=e&&e<=L}},{key:"log",value:function(n){for(var e=arguments.length,t=new Array(1<e?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];i.isDisplayableLogLevel(n)&&P.forEach(function(e){return e.log.apply(e,[n].concat(t))})}},{key:"verbose",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];i.log.apply(i,[R.VERBOSE].concat(n))}},{key:"debug",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];i.log.apply(i,[R.DEBUG].concat(n))}},{key:"info",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];i.log.apply(i,[R.INFO].concat(n))}},{key:"warn",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];i.log.apply(i,[R.WARN].concat(n))}},{key:"error",value:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];i.log.apply(i,[R.ERROR].concat(n))}},{key:"group",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=[];(r=Array.isArray(t[t.length-1])?t.pop():r).some(function(e){return i.isDisplayableLogLevel(e.level)})&&P.filter(function(e){return e instanceof N}).forEach(function(n){n.groupStart.apply(n,t),r.forEach(function(e){return n.log.apply(n,[e.level].concat(C(e.messages)))}),n.groupEnd()})}}]),i}(),w=function(){function e(){c(this,e),this._queue=[],this.locked=!1}return o(e,[{key:"lock",value:function(e){var n=this;this.locked?this._queue.push(e):(this.locked=!0,e(function(){return n.unlock()}))}},{key:"unlock",value:function(){var e;this.locked=!1,0<this._queue.length&&(e=this._queue.shift(),this.lock(e))}}]),e}(),D=function(){function n(e){c(this,n),this.sb=e,this.mutex=new w,this.pingTimer=null,this.pingTimeoutTimer=null}return o(n,[{key:"ping",value:function(){var e=this,n=B.get(this.sb._iid).Command.bPing(),t=ce.get(this.sb._iid).container,r=t.wsAdapter,t=t.pongTimeout;r.client.send(n),he.debug("`PING`"),this.pingTimeoutTimer=setTimeout(function(){he.debug("`PING` timeout."),e.stop(),r.client.handler&&r.client.handler.onError()},t)}},{key:"pong",value:function(){this.pingTimeoutTimer&&(clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null)}},{key:"refreshTimer",value:function(){var n=this,t=ce.get(this.sb._iid).container.pingInterval;this.mutex.lock(function(e){n.stop(),n.pingTimer=setInterval(function(){n.ping()},t),e()})}},{key:"start",value:function(){this.refreshTimer(),this.ping()}},{key:"stop",value:function(){this.pingTimer&&(clearInterval(this.pingTimer),this.pingTimer=null),this.pingTimeoutTimer&&(clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null)}}]),n}();var H=[de.CONNECTION_REQUIRED,de.NETWORK_ERROR,de.ACK_TIMEOUT,de.WEBSOCKET_CONNECTION_CLOSED,de.WEBSOCKET_CONNECTION_FAILED,de.FILE_UPLOAD_CANCEL_FAILED,de.REQUEST_CANCELED,500901,500910,900200],pe=function(){function e(){c(this,e)}return o(e,null,[{key:"deepEqual",value:function(e,n){if(e===n)return!0;e=g({},e),n=g({},n);return(!e.messageId||!n.messageId||e.messageId===n.messageId)&&((!e.reqId||!n.reqId||e.reqId===n.reqId)&&(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,JSON.stringify(e)===JSON.stringify(n)))}},{key:"isResendableError",value:function(e){return 0<e&&0<=H.indexOf(e)}},{key:"isFile",value:function(e){var n="object"===le(e)&&null!==e&&"string"==typeof e.name&&"string"==typeof e.uri&&"string"==typeof e.type;if(!n)if("undefined"==typeof window&&"undefined"!=typeof process){if("undefined"!=typeof Buffer)return e instanceof Buffer}else{if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n}}]),e}(),F=function(){function t(e){if(c(this,t),this.fields={},e)for(var n in e)this.fields[n]={value:e[n]},pe.isFile(e[n])&&(this.fields[n].filename=e[n].name);this.options={},this.internal=!1,this.upload={reqId:null,deleteRequest:null,progressHandler:null}}return o(t,[{key:"add",value:function(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.fields[e]={value:n,filename:t}}},{key:"remove",value:function(e){this.fields.hasOwnProperty(e)&&delete this.fields[e]}},{key:"yield",value:function(){var e,n=!1;for(e in this.fields)if(pe.isFile(this.fields[e].value)){n=!0;break}if(n){var t,r=new p;for(t in this.fields){var i,a=this.fields[t];pe.isFile(a.value)?(i=a.value).filename||i.name?r.append(t,a.value,i.filename||i.name):i.data?r.append(t,a.value,a.data.name):r.append(t,a.value,"unnamed"):r.append(t,a.value)}return r}var s,o={};for(s in this.fields)o[s]=this.fields[s].value;return o}}]),t}(),G=888e3,x=function(){function A(e){c(this,A),this.sb=e,this.cls=B.get(this.sb._iid)}return o(A,[{key:"checkRouting",value:function(e){var n;this.sb.customApiHost&&this.sb.customWsHost?"function"==typeof e&&e(null,{apiHost:this.sb.customApiHost,wsHost:this.sb.customWsHost}):(n=this.sb.getApplicationId(),e(null,{apiHost:"https://api-".concat(n,".sendbird.com"),wsHost:"wss://ws-".concat(n,".sendbird.com")}))}},{key:"_buildUrl",value:function(e){var n=e.apiHost,t=e.url,e=e.params;return(e&&e.internal?"".concat(n,"/v").concat(ue.SDK_MAJOR_VERSION,"/sdk"):"".concat(n,"/v").concat(ue.SDK_MAJOR_VERSION)).concat(t)}},{key:"_createHeader",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=n.noSessionKey,r=void 0!==t&&t,i=n.accessToken,a=void 0===i?null:i,s=e instanceof p&&"function"==typeof e.getHeaders?e.getHeaders():{},t=ce.get(this.sb._iid).container,n=t.appId,i=t.auth,e=t.extensions,t=t.getUserAgentWithExtensions;return s.SendBird="JS,".concat(ue.OS_VERSION,",").concat(ue.SDK_VERSION,",").concat(n),s["SB-User-Agent"]=encodeURIComponent(t(e)),!r&&i.sessionKey&&(s["Session-Key"]=i.sessionKey),a&&(s["App-Id"]=n,s["Access-Token"]=a),s["Request-Sent-Timestamp"]=(new Date).getTime().toString(),s}},{key:"_createQuery",value:function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};try{var t,r=[];for(t in e){var i,a=e[t];null!=a&&(i="",i="object"===le(a)?Array.isArray(a)?a.map(function(e){return encodeURIComponent(e)}).join(","):encodeURIComponent(JSON.stringify(a)):encodeURIComponent(a),r.push("".concat(t,"=").concat(i)))}return 0<r.length?"".concat(n,"?").concat(r.join("&")):n}catch(e){return he.debug("createWithEncodedGetParams is failed. - ",e),n}}},{key:"_validateStatus",value:function(e){return 200<=e&&e<400}},{key:"_handleError",value:function(e){var n=e.request,e=e.response;if(n){if(n.isAbort||n.aborted)return new de("Request has been canceled.",de.REQUEST_CANCELED);if(e){n=e.data,e=n?n.message:"Request failed.",n=n?n.code:de.REQUEST_FAILED;return new de(e,n)}return new de("Request failed.",de.REQUEST_FAILED)}return new de("There was a network error.",de.NETWORK_ERROR)}},{key:"get",value:function(i,a,s){var o=this;this.checkRouting(function(e,n){var t,r;e?s(new de("Request failed.",de.REQUEST_FAILED),null):(t=o._buildUrl({apiHost:n.apiHost,url:i,params:a}),e=a?a.yield():{},n=o._createHeader(e,a?a.options:{}),he.group("GET request",[{level:he.supportedLogLevels.DEBUG,messages:["url:",i]},{level:he.supportedLogLevels.DEBUG,messages:["data:",e]}]),r=[],h.get(o._createQuery(t,e),{headers:n,validateStatus:o._validateStatus}).then(function(e){try{var n=e.data;r.push({level:he.supportedLogLevels.DEBUG,messages:["data:",n]}),s(null,n)}catch(e){throw{code:G,rawError:e}}}).catch(function(e){if(e.code===G)throw e.rawError;e=o._handleError(e);r.push({level:he.supportedLogLevels.ERROR,messages:["error:",e]}),e.isSessionKeyExpiredError?ce.get(o.sb._iid).container.sessionManager.refresh(function(e){return s(e,null)}):s(e,null)}).finally(function(){return he.group("GET response",r)}))})}},{key:"dummyCall",value:function(r){var i=this;this.checkRouting(function(e,n){var t;e?r(new de("Request failed.",de.REQUEST_FAILED),null):(e=n.apiHost,n=i._createHeader(),he.group("GET request",[{level:he.supportedLogLevels.DEBUG,messages:["url:",""]}]),t=[],h.get(i._createQuery(e),{headers:n,validateStatus:i._validateStatus}).then(function(e){try{var n=e.data;t.push({level:he.supportedLogLevels.DEBUG,messages:["data:",n]}),r(null,n)}catch(e){throw{code:G,rawError:e}}}).catch(function(e){if(e.code===G)throw e.rawError;e=i._handleError(e);t.push({level:he.supportedLogLevels.ERROR,messages:["error:",e]}),r(e,null)}).finally(function(){return he.group("GET response",t)}))})}},{key:"post",value:function(l,u,c){var d=this;this.checkRouting(function(e,n){var t,r,i,a,s,o;e?c(new de("Request failed.",de.REQUEST_FAILED),null):(t=d._buildUrl({apiHost:n.apiHost,url:l,params:u}),r=u?u.yield():{},i=d._createHeader(r,u?u.options:{}),a=[{level:he.supportedLogLevels.DEBUG,messages:["url:",l]},{level:he.supportedLogLevels.DEBUG,messages:["data:",r]}],o=null,r instanceof p&&(o=(s=h.CancelToken.source()).token,e=d.cls.FileMessageQueue,(n=u.upload.reqId)&&(a.push({level:he.supportedLogLevels.DEBUG,messages:["request id:",n]}),e.uploadRequest[n]=s)),he.group("POST request",a),a=[],h.post(t,"function"==typeof r.getBuffer?r.getBuffer():r,{headers:i,validateStatus:d._validateStatus,cancelToken:o,onUploadProgress:function(e){u.upload.progressHandler&&u.upload.progressHandler(e,u.upload.reqId)}}).then(function(e){try{var n=e.data;"function"==typeof u.upload.deleteRequest&&u.upload.deleteRequest(),a.push({level:he.supportedLogLevels.DEBUG,messages:["data:",n]}),c(null,n)}catch(e){throw{code:G,rawError:e}}}).catch(function(e){if(e.code===G)throw e.rawError;"function"==typeof u.upload.deleteRequest&&u.upload.deleteRequest();e=d._handleError(e);a.push({level:he.supportedLogLevels.ERROR,messages:["error:",e]}),e.isSessionKeyExpiredError?ce.get(d.sb._iid).container.sessionManager.refresh(function(e){return c(e,null)}):c(e,null)}).finally(function(){return he.group("POST response",a)}))})}},{key:"put",value:function(i,a,s){var o=this;this.checkRouting(function(e,n){var t,r;e?s(new de("Request failed.",de.REQUEST_FAILED),null):(t=o._buildUrl({apiHost:n.apiHost,url:i,params:a}),e=a?a.yield():{},n=o._createHeader(e,a?a.options:{}),he.group("PUT request",[{level:he.supportedLogLevels.DEBUG,messages:["url:",i]},{level:he.supportedLogLevels.DEBUG,messages:["data:",e]}]),r=[],h.put(t,e,{headers:n,validateStatus:o._validateStatus}).then(function(e){try{var n=e.data;r.push({level:he.supportedLogLevels.DEBUG,messages:["data:",n]}),s(null,n)}catch(e){throw{code:G,rawError:e}}}).catch(function(e){if(e.code===G)throw e.rawError;e=o._handleError(e);r.push({level:he.supportedLogLevels.ERROR,messages:["error:",e]}),e.isSessionKeyExpiredError?ce.get(o.sb._iid).container.sessionManager.refresh(function(e){return s(e,null)}):s(e,null)}).finally(function(){return he.group("PUT response",r)}))})}},{key:"delete",value:function(i,a,s){var o=this;this.checkRouting(function(e,n){var t,r;e?s(new de("Request failed.",de.REQUEST_FAILED),null):(t=o._buildUrl({apiHost:n.apiHost,url:i,params:a}),e=a?a.yield():{},n=o._createHeader(e,a?a.options:{}),he.group("DELETE request",[{level:he.supportedLogLevels.DEBUG,messages:["url:",i]},{level:he.supportedLogLevels.DEBUG,messages:["data:",e]}]),r=[],h.delete(o._createQuery(t,e),{headers:n,validateStatus:o._validateStatus}).then(function(e){try{var n=e.data;r.push({level:he.supportedLogLevels.DEBUG,messages:["data:",n]}),s(null,n)}catch(e){throw{code:G,rawError:e}}}).catch(function(e){if(e.code===G)throw e.rawError;e=o._handleError(e);r.push({level:he.supportedLogLevels.ERROR,messages:["error:",e]}),e.isSessionKeyExpiredError?ce.get(o.sb._iid).container.sessionManager.refresh(function(e){return s(e,null)}):s(e,null)}).finally(function(){return he.group("DELETE response",r)}))})}},{key:"refreshSessionKey",value:function(e,t){var r=this,i=e.accessToken;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_SESSION_KEY.replace("%s",encodeURIComponent(n.userId)),(n=new F).options.noSessionKey=!0,n.options.accessToken=i,r.post(e,n,t))})}},{key:"updateCurrentUserInfo",value:function(e,t){var r=this,i=e.nickname,a=e.profileUrl,s=e.profileImage,o=e.preferredLanguages;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID.replace("%s",encodeURIComponent(n.userId)),n=new F,i&&n.add("nickname",i),a&&n.add("profile_url",a),s&&n.add("profile_file",s,s.name),o&&n.add("preferred_languages",o),r.put(e,n,t))})}},{key:"getMyGroupChannelChangeLogs",value:function(e,t){var r=this,i=e.ts,a=e.token,s=e.customTypes,o=e.includeEmpty,l=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS.replace("%s",encodeURIComponent(n.userId)),n=new F({show_read_receipt:!0,show_delivery_receipt:!0,show_member:!0}),a&&n.add("token",a),i&&n.add("change_ts",i),s&&0<s.length&&n.add("custom_types",s),"boolean"==typeof o&&n.add("show_empty",o),"boolean"==typeof l&&n.add("show_frozen",l),r.get(e,n,t))})}},{key:"getChannelInvitationPreference",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(n.userId)),r.get(n,null,t))})}},{key:"getGroupChannelCount",value:function(e,r){var i=this,a=e.memberStateFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var e=i.cls.GroupChannel,n=A.Path.USERS_USERID_GROUP_CHANNEL_COUNT.replace("%s",encodeURIComponent(n.userId)),t="";switch(a){case e.MemberStateFilter.JOINED:t="joined";break;case e.MemberStateFilter.INVITED:t="invited";break;case e.MemberStateFilter.INVITED_BY_FRIEND:t="invited_by_friend";break;case e.MemberStateFilter.INVITED_BY_NON_FRIEND:t="invited_by_non_friend";break;default:t="all"}e=new F({state:t});i.get(n,e,r)}})}},{key:"getUnreadItemCount",value:function(e,t){var r=this,i=e.keys;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_UNREAD_ITEM_COUNT.replace("%s",encodeURIComponent(n.userId)),n=new F({item_keys:i}),r.get(e,n,t))})}},{key:"getTotalUnreadMessageCount",value:function(e,t){var r=this,i=e.customTypesFilter,a=e.superChannelFilter;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_UNREAD_MESSAGE_COUNT.replace("%s",encodeURIComponent(n.userId)),n=new F({super_mode:a}),null!==i&&0<i.length&&n.add("custom_types",i),r.get(e,n,t))})}},{key:"getTotalUnreadChannelCount",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_UNREAD_CHANNEL_COUNT.replace("%s",encodeURIComponent(n.userId)),r.get(n,null,t))})}},{key:"searchMessages",value:function(e,r){var i=this,a=e.keyword,s=e.limit,o=e.reverse,l=e.exactMatch,u=e.channelUrl,c=e.channelCustomType,d=e.messageTimestampFrom,h=e.messageTimestampTo,p=e.order,g=e.nextToken;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.SEARCH_MESSAGE,e=new F({limit:s,reverse:o,query:a,custom_type:c}),d&&e.add("message_ts_from",d),h&&e.add("message_ts_to",h),u&&e.add("channel_url",u),p&&e.add("sort_field",p),"boolean"==typeof l&&e.add("exact_match",l),null!==g&&0<g.length&&e.add("after",g),i.get(t,e,r))})}},{key:"markAsReadAll",value:function(e,t){var r=this,i=e.channelUrls;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_MARKASREADALL.replace("%s",encodeURIComponent(n.userId)),n=new F,i&&n.add("channel_urls",i),r.put(e,n,t))})}},{key:"markAsDelivered",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASDELIVERED.replace("%s",encodeURIComponent(a)),e=new F,s&&e.add("user_id",s),i.put(t,e,r))})}},{key:"setChannelInvitationPreference",value:function(e,t){var r=this,i=e.isAutoAccept;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(n.userId)),n=new F({auto_accept:i}),r.put(e,n,t))})}},{key:"blockUser",value:function(e,t){var r=this,i=e.blockedUserId;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(n.userId)),n=new F({target_id:i}),r.post(e,n,t))})}},{key:"unblockUser",value:function(e,t){var r=this,i=e.unblockedUserId;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_BLOCK_TARGETID.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(i)),r.delete(n,null,t))})}},{key:"getPushTriggerOption",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),r.get(n,null,t))})}},{key:"setPushTriggerOption",value:function(e,t){var r=this,i=e.pushTriggerOption;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),n=new F({push_trigger_option:i}),r.put(e,n,t))})}},{key:"getPushTokens",value:function(e,t){var r=this,i=e.ts,a=e.token,s=e.type;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSH_DEVICE_TOKENS.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(s)),n=new F,a&&n.add("token",a),i&&n.add("created_ts",i),r.get(e,n,t))})}},{key:"getPushTemplate",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(n.userId)),r.get(n,null,t))})}},{key:"setPushTemplate",value:function(e,t){var r=this,i=e.templateName;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(n.userId)),n=new F({name:i}),r.put(e,n,t))})}},{key:"getDoNotDisturb",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),r.get(n,null,t))})}},{key:"setDoNotDisturb",value:function(e,t){var r=this,i=e.doNotDisturbOn,a=e.startHour,s=e.startMin,o=e.endHour,l=e.endMin,u=e.timezone;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),n=new F({do_not_disturb:i,start_hour:a,start_min:s,end_hour:o,end_min:l,timezone:u}),r.put(e,n,t))})}},{key:"getSnoozePeriod",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),r.get(n,null,t))})}},{key:"setSnoozePeriod",value:function(e,t){var r=this,i=e.snoozeOn,a=e.startTs,s=e.endTs;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),n=new F({snooze_enabled:i,snooze_start_ts:a,snooze_end_ts:s}),r.put(e,n,t))})}},{key:"registerGCMPushToken",value:function(e,t){var r=this,i=e.token;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(n.userId)),n=new F({gcm_reg_token:i,always_push:!0}),r.post(e,n,t))})}},{key:"unregisterGCMPushToken",value:function(e,t){var r=this,i=e.token;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSH_GCM_TOKEN.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(i)),r.delete(n,null,t))})}},{key:"unregisterAllGCMPushTokens",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(n.userId)),r.delete(n,null,t))})}},{key:"registerAPNSPushToken",value:function(e,t){var r=this,i=e.token;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(n.userId)),n=new F({apns_device_token:i,always_push:!0}),r.post(e,n,t))})}},{key:"unregisterAPNSPushToken",value:function(e,t){var r=this,i=e.token;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSH_APNS_TOKEN.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(i)),r.delete(n,null,t))})}},{key:"unregisterAllAPNSPushTokens",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(n.userId)),r.delete(n,null,t))})}},{key:"unregisterAllPushTokens",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSH.replace("%s",encodeURIComponent(n.userId)),r.delete(n,null,t))})}},{key:"loadFriendList",value:function(e,t){var r=this,i=e.token,a=e.limit;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.FRIENDS.replace("%s",encodeURIComponent(n.userId)),n=new F({limit:a,token:i}),r.get(e,n,t))})}},{key:"getFriendChangeLogsByToken",value:function(e,t){var r=this,i=e.token;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.FRIENDS_CHANGE_LOGS.replace("%s",encodeURIComponent(n.userId)),n=new F,i&&n.add("token",i),r.get(e,n,t))})}},{key:"addFriends",value:function(e,t){var r=this,i=e.userIds;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.FRIENDS.replace("%s",encodeURIComponent(n.userId)),n=new F({user_ids:i}),r.post(e,n,t))})}},{key:"deleteFriends",value:function(e,t){var r=this,i=e.userIds;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.FRIENDS.replace("%s",encodeURIComponent(n.userId)),n=new F({user_ids:i}),r.delete(e,n,t))})}},{key:"uploadFriendDiscoveries",value:function(e,r){var i=this,a=e.discoveries;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(e=A.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(n.userId)),t=[],a.forEach(function(e){t.push({friend_discovery_key:e.friendDiscoveryKey,friend_name:"string"==typeof e.friendName||e.friendName?e.friendName:null})}),n=new F({friend_discoveries:t}),i.put(e,n,r))})}},{key:"deleteFriendDiscoveries",value:function(e,t){var r=this,i=e.discoveryKeys;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(n.userId)),n=new F({friend_discovery_keys:i}),r.delete(e,n,t))})}},{key:"loadUserList",value:function(e,r){var i=this,a=e.token,s=e.limit,o=e.userIdsFilter,l=e.metaDataKeyFilter,u=e.metaDataValuesFilter,c=e.nicknameStartsWithFilter;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.USERS,e=new F({token:a,limit:s}),o&&0<o.length&&e.add("user_ids",o),l&&u&&0<u.length&&(e.add("metadatakey",l),e.add("metadatavalues_in",u)),c&&e.add("nickname_startswith",c),i.get(t,e,r))})}},{key:"loadBlockedUserList",value:function(e,t){var r=this,i=e.token,a=e.limit,s=e.userIdsFilter;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(n.userId)),n=new F({token:i,limit:a}),s&&0<s.length&&n.add("user_ids",s),r.get(e,n,t))})}},{key:"createUserMetaData",value:function(e,t){var r=this,i=e.metaData;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId)),n=new F({metadata:i}),r.post(e,n,t))})}},{key:"updateUserMetaData",value:function(e,t){var r=this,i=e.metaData,a=e.upsert;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId)),n=new F({metadata:i,upsert:a}),r.put(e,n,t))})}},{key:"deleteUserMetaData",value:function(e,t){var r=this,i=e.metaDataKey;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_METADATA_KEY.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(i)),r.delete(n,null,t))})}},{key:"deleteAllUserMetaData",value:function(e,t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId)),r.delete(n,null,t))})}},{key:"getMessageChangeLogs",value:function(e,r){var i=this,a=e.channelUrl,s=e.ts,o=e.timestamp,l=e.token,u=e.isOpenChannel,c=e.includeMetaArray,d=e.includeReactions,h=e.includeReplies,p=e.includeParentMessageText,g=e.includeThreadInfo;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(u?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS).replace("%s",encodeURIComponent(a)),e=new F,l&&e.add("token",l),s&&e.add("change_ts",s),o&&e.add("change_ts",o),"boolean"==typeof c&&e.add("with_sorted_meta_array",c),"boolean"==typeof d&&e.add("include_reactions",d),"boolean"==typeof h&&e.add("include_replies",h),"boolean"==typeof p&&e.add("include_parent_text_message",p),"boolean"==typeof g&&e.add("include_thread_info",g),i.get(t,e,r))})}},{key:"getMyMutedInfo",value:function(e,t){var r=this,i=e.channelUrl,a=e.userId,s=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(s?A.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID:A.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID).replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(a)),r.get(e,null,t))})}},{key:"loadBannedUserList",value:function(e,r){var i=this,a=e.token,s=e.limit,o=e.channelUrl,l=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(l?A.Path.OPENCHANNELS_CHANNELURL_BAN:A.Path.GROUPCHANNELS_CHANNELURL_BAN).replace("%s",encodeURIComponent(o)),e=new F({token:a,limit:s}),i.get(t,e,r))})}},{key:"loadMutedUserList",value:function(e,r){var i=this,a=e.token,s=e.limit,o=e.channelUrl,l=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(l?A.Path.OPENCHANNELS_CHANNELURL_MUTE:A.Path.GROUPCHANNELS_CHANNELURL_MUTE).replace("%s",encodeURIComponent(o)),e=new F({token:a,limit:s}),i.get(t,e,r))})}},{key:"getMessageList",value:function(e,r){var i=this,a=e.channel,s=e.token,o=e.tokenType,l=e.isInclusive,n=e.prevResultSize,u=void 0===n?0:n,n=e.nextResultSize,c=void 0===n?0:n,d=e.shouldReverse,h=e.messageType,p=e.customType,g=e.customTypes,y=e.senderUserIds,f=e.includeMetaArray,_=e.includeReactions,m=e.includeThreadInfo,v=e.includeReplies,E=e.includeParentMessageText,C=e.showSubchannelMessagesOnly,U=e.rootMessageId,b=e.parentMessageId;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(a.isOpenChannel()?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES:A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES).replace("%s",a.url),e=new F({is_sdk:String(!0),prev_limit:String(u),next_limit:String(c),include:String(l),reverse:String(d)}),"timestamp"===o?e.add("message_ts",s):"messageId"===o&&e.add("message_id",String(s)),h&&e.add("message_type",String(h)),p&&e.add("custom_type",String(p)),Array.isArray(g)&&0<g.length&&e.add("custom_types",g),Array.isArray(y)&&0<y.length&&e.add("sender_ids",y),"boolean"==typeof f&&e.add("with_sorted_meta_array",f),"boolean"==typeof _&&e.add("include_reactions",_),"boolean"==typeof m&&e.add("include_thread_info",m),"boolean"==typeof v&&e.add("include_replies",v),"boolean"==typeof E&&e.add("include_parent_message_text",E),"boolean"==typeof C&&a.isOpenChannel()&&e.add("show_subchannel_messages_only",C),U&&e.add("root_message_id",U),b&&e.add("parent_message_id",b),i.get(t,e,r))})}},{key:"translateUserMessage",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.messageId,l=e.translationTargetLanguages;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION).replace("%s",encodeURIComponent(a)).replace("%s",o),e=new F({target_langs:l}),i.post(t,e,r))})}},{key:"getMessage",value:function(e,t){var r=this,i=e.channel,a=e.messageId;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(i.isOpenChannel()?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID).replace("%s",encodeURIComponent(i.url)).replace("%s",encodeURIComponent(a)),r.get(e,null,t))})}},{key:"deleteMessage",value:function(e,t){var r=this,i=e.channelUrl,a=e.isOpenChannel,s=e.messageId;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(a?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID).replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(s)),r.delete(e,null,t))})}},{key:"muteUser",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.description,l=e.seconds,u=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(u?A.Path.GROUPCHANNELS_CHANNELURL_MUTE:A.Path.OPENCHANNELS_CHANNELURL_MUTE).replace("%s",encodeURIComponent(a)),e=new F({user_id:s}),l&&(0<l||-1!==l)&&e.add("seconds",l),o&&e.add("description",o),i.post(t,e,r))})}},{key:"unmuteUser",value:function(e,t){var r=this,i=e.channelUrl,a=e.userId,s=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(s?A.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID:A.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID).replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(a)),r.delete(e,null,t))})}},{key:"banUser",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.description,l=e.seconds,u=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(u?A.Path.GROUPCHANNELS_CHANNELURL_BAN:A.Path.OPENCHANNELS_CHANNELURL_BAN).replace("%s",encodeURIComponent(a)),e=new F({user_id:s}),o&&e.add("description",o),e.add("seconds",String(l)),i.post(t,e,r))})}},{key:"unbanUser",value:function(e,t){var r=this,i=e.channelUrl,a=e.userId,s=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(s?A.Path.GROUPCHANNELS_CHANNELURL_BAN_USERID:A.Path.OPENCHANNELS_CHANNELURL_BAN_USERID).replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(a)),r.delete(e,null,t))})}},{key:"getMetaCounters",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.keys;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER:A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER).replace("%s",encodeURIComponent(a)),e=new F({keys:o}),i.get(t,e,r))})}},{key:"createMetaCounters",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.metaCounter;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER:A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER).replace("%s",encodeURIComponent(a)),e=new F({metacounter:o}),i.post(t,e,r))})}},{key:"updateMetaCounters",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.metaCounter,l=e.upsert,u=e.mode;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER:A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER).replace("%s",encodeURIComponent(a)),e=new F({metacounter:o,upsert:l,mode:u}),i.put(t,e,r))})}},{key:"deleteMetaCounter",value:function(e,t){var r=this,i=e.channelUrl,a=e.isOpenChannel,s=e.key;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(a?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER_KEY:A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY).replace("%s",encodeURIComponent(i)).replace("%s",s),r.delete(e,null,t))})}},{key:"deleteAllMetaCounters",value:function(e,t){var r=this,i=e.channelUrl,a=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(a?A.Path.OPENCHANNELS_CHANNELURL_METACOUNTER:A.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER).replace("%s",encodeURIComponent(i)),r.delete(e,null,t))})}},{key:"getMetaData",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.keys;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_CHANNELURL_METADATA:A.Path.GROUPCHANNELS_CHANNELURL_METADATA).replace("%s",encodeURIComponent(a)),e=new F({keys:o}),i.get(t,e,r))})}},{key:"createMetaData",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.metaData;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_CHANNELURL_METADATA:A.Path.GROUPCHANNELS_CHANNELURL_METADATA).replace("%s",encodeURIComponent(a)),e=new F({metadata:o}),i.post(t,e,r))})}},{key:"updateMetaData",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.metaData,l=e.upsert;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_CHANNELURL_METADATA:A.Path.GROUPCHANNELS_CHANNELURL_METADATA).replace("%s",encodeURIComponent(a)),e=new F({metadata:o,upsert:l}),i.put(t,e,r))})}},{key:"deleteMetaData",value:function(e,t){var r=this,i=e.channelUrl,a=e.isOpenChannel,s=e.key;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(a?A.Path.OPENCHANNELS_CHANNELURL_METADATA_KEY:A.Path.GROUPCHANNELS_CHANNELURL_METADATA_KEY).replace("%s",encodeURIComponent(i)).replace("%s",s),r.delete(e,null,t))})}},{key:"deleteAllMetaData",value:function(e,t){var r=this,i=e.channelUrl,a=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(a?A.Path.OPENCHANNELS_CHANNELURL_METADATA:A.Path.GROUPCHANNELS_CHANNELURL_METADATA).replace("%s",encodeURIComponent(i)),r.delete(e,null,t))})}},{key:"loadOperatorList",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.token,l=e.limit;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.OPENCHANNELS_OPERATORS:A.Path.GROUPCHANNELS_OPERATORS).replace("%s",encodeURIComponent(a)),e=new F({token:o,limit:l}),i.get(t,e,r))})}},{key:"getOpenChannel",value:function(e,r){var i=this,a=e.channelUrl,s=e.internalCall;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a)),(e=new F({})).internal=s===ue.INTERNAL_CALL,i.get(t,e,r))})}},{key:"loadOpenChannelList",value:function(e,r){var i=this,a=e.token,s=e.limit,o=e.nameKeyword,l=e.urlKeyword,u=e.customTypes,c=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.OPENCHANNELS,e=new F({token:a,limit:s}),o&&e.add("name_contains",o),l&&e.add("url_contains",l),u&&0<u.length&&e.add("custom_types",u),"boolean"==typeof c&&e.add("show_frozen",c),i.get(t,e,r))})}},{key:"loadParticipantList",value:function(e,r){var i=this,a=e.token,s=e.limit,o=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.OPENCHANNELS_CHANNELURL_PARTICIPANTS.replace("%s",encodeURIComponent(o)),e=new F({token:a,limit:s}),i.get(t,e,r))})}},{key:"createOpenChannel",value:function(e,r){var i=this,a=e.name,s=e.coverUrlOrImage,o=e.data,l=e.operatorUserIds,u=e.customType;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.OPENCHANNELS,e=new F,"string"==typeof s&&e.add("cover_url",s),pe.isFile(s)&&e.add("cover_file",s),null!==a&&"string"==typeof a&&e.add("name",a),o&&e.add("data",o),l&&(Array.isArray(l)?e.add("operators",l):e.add("operators",[l])),u&&e.add("custom_type",u),i.post(t,e,r))})}},{key:"updateOpenChannel",value:function(e,r){var i=this,a=e.channelUrl,s=e.name,o=e.coverUrlOrImage,l=e.data,u=e.operatorUserIds,c=e.customType;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a)),e=new F,"string"==typeof o&&e.add("cover_url",o),pe.isFile(o)&&e.add("cover_file",o,o.name),null!==s&&"string"==typeof s&&e.add("name",s),null!==l&&"string"==typeof l&&e.add("data",l),null!==u&&(Array.isArray(u)?e.add("operator_ids",u):e.add("operator_ids",[u])),null!==c&&"string"==typeof c&&e.add("custom_type",c),i.put(t,e,r))})}},{key:"deleteOpenChannel",value:function(e,t){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(i)),r.delete(e,null,t))})}},{key:"getGroupChannel",value:function(e,r){var i=this,a=e.channelUrl,s=e.showMember,o=e.internalCall;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a)),(e=new F({show_member:s,show_read_receipt:!0,show_delivery_receipt:!0})).internal=o===ue.INTERNAL_CALL,i.get(t,e,r))})}},{key:"loadGroupChannelList",value:function(e,t){var r=this,i=e.token,a=e.limit,s=e.includeEmpty,o=e.order,l=e.userIdsFilter,u=e.nicknameContainsFilter,c=e.channelNameContainsFilter,d=e.channelUrlsFilter,h=e.customTypesFilter,p=e.customTypeStartsWithFilter,g=e.memberStateFilter,y=e.superChannelFilter,f=e.publicChannelFilter,_=e.unreadChannelFilter,m=e.metadataOrderKeyFilter,v=e.hiddenChannelFilter,E=e.searchFilter,C=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.MYGROUPCHANNELS.replace("%s",encodeURIComponent(n.userId)),n=new F({token:i,limit:a,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:String(s),member_state_filter:g}),h&&0<h.length&&n.add("custom_types",h),u&&n.add("members_nickname_contains",u),c&&n.add("name_contains",c),E.hasOwnProperty("search_query")&&E.hasOwnProperty("search_fields")&&(n.add("search_query",E.search_query),n.add("search_fields",E.search_fields)),l.userIds&&0<l.userIds.length&&(l.includeMode?(n.add("members_include_in",l.userIds),n.add("query_type",l.queryType.toUpperCase())):n.add("members_exactly_in",l.userIds)),d&&0<d.length&&n.add("channel_urls",d),n.add("super_mode",y),n.add("public_mode",f),n.add("unread_filter",_),m&&n.add("metadata_order_key",m),p&&n.add("custom_type_startswith",p),v&&n.add("hidden_mode",v),"boolean"==typeof C&&n.add("show_frozen",C),r.get(e,n,t))})}},{key:"loadPublicGroupChannelList",value:function(e,r){var i=this,a=e.token,s=e.limit,o=e.includeEmpty,l=e.order,u=e.channelNameContainsFilter,c=e.channelUrlsFilter,d=e.customTypesFilter,h=e.customTypeStartsWithFilter,p=e.superChannelFilter,g=e.membershipFilter,y=e.metadataOrderKeyFilter,f=e.includeFrozen;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=i.cls.GroupChannel,e=A.Path.GROUPCHANNELS,t=new F({token:a,limit:s,order:l,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:String(o),public_mode:t.PublicChannelFilter.PUBLIC,public_membership_mode:g}),d&&0<d.length&&t.add("custom_types",d),u&&t.add("name_contains",u),c&&0<c.length&&t.add("channel_urls",c),t.add("super_mode",p),y&&t.add("metadata_order_key",y),h&&t.add("custom_type_startswith",h),"boolean"==typeof f&&t.add("show_frozen",f),i.get(e,t,r))})}},{key:"createGroupChannel",value:function(e,t){var r=this,i=e.isDistinct,a=e.isSuper,s=e.isBroadcast,o=e.isPublic,l=e.channelUrl,u=e.isDiscoverable,c=e.isStrict,d=e.name,h=e.data,p=e.customType,g=e.coverUrl,y=e.coverImage,f=e.accessCode,_=e.isEphemeral,n=e._invitedUserIds,m=void 0===n?[]:n,v=e.operatorUserIds,E=e.messageSurvivalSeconds;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS,n=new F({user_ids:[n.userId].concat(C(m)).filter(function(e,n,t){return n===t.indexOf(e)})}),null!==g&&"string"==typeof g&&n.add("cover_url",g),pe.isFile(y)&&n.add("cover_file",y,y.name),null!==l&&n.add("channel_url",l),null!==i&&n.add("is_distinct",i),null!==a&&n.add("is_super",a),null!==s&&n.add("is_broadcast",s),null!==o&&n.add("is_public",o),null!==u&&n.add("is_discoverable",u),null!==c&&n.add("strict",c),null!==_&&n.add("is_ephemeral",_),f&&n.add("access_code",f),null!==d&&"string"==typeof d&&n.add("name",d),h&&n.add("data",h),p&&n.add("custom_type",p),Array.isArray(v)&&0<v.length&&n.add("operator_ids",v),null!==E&&-1<E&&n.add("message_survival_seconds",E),r.post(e,n,t))})}},{key:"updateGroupChannel",value:function(e,r){var i=this,a=e.isDistinct,s=e.isPublic,o=e.channelUrl,l=e.isDiscoverable,u=e.name,c=e.data,d=e.customType,h=e.coverUrl,p=e.coverImage,g=e.accessCode,y=e.operatorUserIds,f=e.messageSurvivalSeconds;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(o)),e=new F,null!==a&&e.add("is_distinct",a),null!==s&&e.add("is_public",s),null!==l&&e.add("is_discoverable",l),null!==g&&e.add("access_code",g),null!==h&&"string"==typeof h&&e.add("cover_url",h),pe.isFile(p)&&e.add("cover_file",p,p.name),null!==u&&"string"==typeof u&&e.add("name",u),null!==c&&"string"==typeof c&&e.add("data",c),null!==d&&"string"==typeof d&&e.add("custom_type",d),null!==y&&(Array.isArray(y)?e.add("operator_ids",y):y&&e.add("operator_ids",[y])),null!==f&&-1<f&&e.add("message_survival_seconds",f),i.put(t,e,r))})}},{key:"addOperators",value:function(e,r){var i=this,a=e.channelUrl,n=e.isOpenChannel,s=void 0!==n&&n,o=e.operatorUserIds;this.sb.ConnectionManager.ready(function(e,n){var t;e||(t=(s?A.Path.OPENCHANNELS_CHANNELURL_OPERATORS:A.Path.GROUPCHANNELS_CHANNELURL_OPERATORS).replace("%s",encodeURIComponent(a)),e=new F({operator_ids:o}),i.post(t,e,r))})}},{key:"removeOperators",value:function(e,r){var i=this,a=e.channelUrl,n=e.isOpenChannel,s=void 0!==n&&n,o=e.operatorUserIds;this.sb.ConnectionManager.ready(function(e,n){var t;e||(t=(s?A.Path.OPENCHANNELS_CHANNELURL_OPERATORS:A.Path.GROUPCHANNELS_CHANNELURL_OPERATORS).replace("%s",encodeURIComponent(a)),e=new F({operator_ids:o}),i.delete(t,e,r))})}},{key:"inviteToGroupChannel",value:function(e,r){var i=this,a=e.channelUrl,s=e.userIds;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.GROUPCHANNELS_CHANNELURL_INVITE.replace("%s",encodeURIComponent(a)),e=new F({user_ids:s}),i.post(t,e,r))})}},{key:"acceptInvitation",value:function(e,t){var r=this,i=e.channelUrl,a=e.accessCode;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION.replace("%s",encodeURIComponent(i)),n=new F({user_id:n.userId}),a&&n.add("access_code",a),r.put(e,n,t))})}},{key:"declineInvitation",value:function(e,t){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION.replace("%s",encodeURIComponent(i)),n=new F({user_id:n.userId}),r.put(e,n,t))})}},{key:"joinGroupChannel",value:function(e,t){var r=this,i=e.channelUrl,a=e.accessCode;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_CHANNELURL_JOIN.replace("%s",encodeURIComponent(i)),n=new F({user_id:n.userId}),a&&n.add("access_code",a),r.put(e,n,t))})}},{key:"leaveGroupChannel",value:function(e,t){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_CHANNELURL_LEAVE.replace("%s",encodeURIComponent(i)),n=new F({user_id:n.userId}),r.put(e,n,t))})}},{key:"hideGroupChannel",value:function(e,t){var r=this,i=e.channelUrl,a=e.hidePreviousMessages,s=e.allowAutoUnhide;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(i)),n=new F({user_id:n.userId,hide_previous_messages:a,allow_auto_unhide:s}),r.put(e,n,t))})}},{key:"unhideGroupChannel",value:function(e,t){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(i)),r.delete(e,null,t))})}},{key:"freeze",value:function(e,r){var i=this,a=e.channelUrl,s=e.isGroupChannel,o=e.freezing;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(s?A.Path.GROUPCHANNELS_CHANNELURL_FREEZE:A.Path.OPENCHANNELS_CHANNELURL_FREEZE).replace("%s",encodeURIComponent(a)),e=new F({freeze:o}),i.put(t,e,r))})}},{key:"deleteGroupChannel",value:function(e,t){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(i)),r.delete(e,null,t))})}},{key:"loadMemberList",value:function(e,r){var i=this,a=e.channelUrl,s=e.token,o=e.limit,l=e.mutedMemberFilter,u=e.order,c=e.memberStateFilter,d=e.nicknameStartsWithFilter;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.GROUPCHANNELS_MEMBERS.replace("%s",encodeURIComponent(a)),e=new F({token:s,limit:o,order:u.toLowerCase(),muted_member_filter:l.toLowerCase(),member_state_filter:c,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0}),d&&e.add("nickname_startswith",d),i.get(t,e,r))})}},{key:"report",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.reportCategory,l=e.reportingUserId,u=e.reportDescription;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.REPORT_CHANNELS.replace("%s",encodeURIComponent(s?"open_channels":"group_channels")).replace("%s",encodeURIComponent(a)),e=new F({report_category:o}),null!=l&&e.add("reporting_user_id",l),null!=u&&e.add("report_description",u),i.post(t,e,r))})}},{key:"reportUser",value:function(e,r){var i=this,a=e.offendingUserId,s=e.channelUrl,o=e.isOpenChannel,l=e.reportCategory,u=e.reportingUserId,c=e.reportDescription;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.REPORT_USERS.replace("%s",encodeURIComponent(a)),e=new F({channel_url:s,channel_type:o?"open_channels":"group_channels",report_category:l}),null!=u&&e.add("reporting_user_id",u),null!=c&&e.add("report_description",c),i.post(t,e,r))})}},{key:"reportMessage",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.messageId,l=e.reportCategory,u=e.reportingUserId,c=e.reportDescription,d=e.offendingUserId;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=A.Path.REPORT_MESSAGES.replace("%s",encodeURIComponent(s?"open_channels":"group_channels")).replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(o)),e=new F({report_category:l,offending_user_id:d}),null!=u&&e.add("reporting_user_id",u),null!=c&&e.add("report_description",c),i.post(t,e,r))})}},{key:"sendUserMessage",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.message,l=e.data,u=e.customType,c=e.translationTargetLanguages,d=e.metaArrays,h=e.mentionType,p=e.mentionedUserIds,g=e.pushNotificationDeliveryOption,y=e.rootMessageId,f=e.parentMessageId;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=i.cls.FileMessageParams,e=(s?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES:A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES).replace("%s",encodeURIComponent(a)),n=new F({message_type:"MESG",user_id:n.userId,message:o,mention_type:h,mentioned_user_ids:[]}),null!=l&&n.add("data",l),null!=u&&n.add("custom_type",u),c&&n.add("translation_target_langs",c),d&&0<d.length&&n.add("sorted_metaarray",d.map(function(e){return e.encode()})),h===i.cls.BaseMessageParams.MentionType.CHANNEL?n.add("mentioned_user_ids",[]):Array.isArray(p)&&0<p.length&&n.add("mentioned_user_ids",p),g&&g!==t.PushNotificationDeliveryOption.DEFAULT&&n.add("push_option",g),y&&n.add("root_message_id",y),f&&n.add("parent_message_id",f),i.post(e,n,r))})}},{key:"sendFileMessage",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.fileUrl,l=e.fileName,u=e.fileSize,c=e.fileType,d=e.data,h=e.customType,p=e.thumbnailSizes,g=e.requireAuth,y=e.metaArrays,f=e.mentionType,_=e.mentionedUserIds,m=e.pushNotificationDeliveryOption,v=e.rootMessageId,E=e.parentMessageId;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=i.cls.FileMessageParams,e=(s?A.Path.OPENCHANNELS_CHANNELURL_MESSAGES:A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES).replace("%s",encodeURIComponent(a)),n=new F({message_type:"FILE",user_id:n.userId,url:o,mention_type:f,mentioned_user_ids:[]}),null!=l&&n.add("file_name",l),null!=u&&n.add("file_size",u),null!=c&&n.add("file_type",c),null!=d&&n.add("custom_field",d),null!=h&&n.add("custom_type",h),p&&n.add("thumbnails",p),g&&n.add("require_auth",g),y&&0<y.length&&n.add("sorted_metaarray",y.map(function(e){return e.encode()})),f===i.cls.BaseMessageParams.MentionType.CHANNEL?n.add("mentioned_user_ids",[]):Array.isArray(_)&&0<_.length&&n.add("mentioned_user_ids",_),m&&m!==t.PushNotificationDeliveryOption.DEFAULT&&n.add("push_option",m),v&&n.add("root_message_id",v),E&&n.add("parent_message_id",E),i.post(e,n,r))})}},{key:"uploadFile",value:function(e,a){var s=this,o=e.file,l=e.thumbnailSizes,u=e.channelUrl,c=e.progressHandler,d=e.reqId;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=ce.get(s.sb._iid).container.appInfo;if(t)if("number"==typeof o.size||o.size||(o.size=0),"number"==typeof o.size)if(o.size<=t.uploadSizeLimit){var e=A.Path.STORAGE_FILE,r=new F;if(r.add("file",o,o.name),u&&"string"==typeof u&&r.add("channel_url",u),l)for(var i=0;i<l.length;i++)r.add("thumbnail"+(i+1),l[i].maxWidth+","+l[i].maxHeight);r.upload.reqId=d,r.upload.deleteRequest=function(){var e=s.cls.FileMessageQueue;e.uploadRequest[d]&&delete e.uploadRequest[d]},r.upload.progressHandler=function(e){c&&"function"==typeof c&&c(e,d)},s.post(e,r,a)}else a(new de("The file size exceeded the upload limit: ".concat(t.uploadSizeLimit),de.FILE_SIZE_LIMIT_EXCEEDED),null);else a(new de("Invalid file size: ".concat(o.size),de.INVALID_PARAMETER),null);else a(new de("Connection should be made first.",de.CONNECTION_REQUIRED),null)}})}},{key:"registerScheduledUserMessage",value:function(e,t){var r=this,i=e.groupChannelParams,a=e.channelUrl,s=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=(s?A.Path.OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:A.Path.GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES).replace("%s",encodeURIComponent(a)),n=new F({scheduled_dt:i._getScheduleString(),user_id:n.userId,message:i.message,data:i.data}),i.customType&&n.add("custom_type",i.customType),i.metaArrayKeys&&0<Object.keys(i.metaArrayKeys).length&&n.add("metaarray",i.metaArrayKeys),i.mentionType&&n.add("mention_type",i._mentionType),i._mentionType===r.cls.BaseMessageParams.MentionType.CHANNEL?n.add("mentioned_user_ids",[]):Array.isArray(i._mentionedUserIds)&&0<i._mentionedUserIds.length&&n.add("mentioned_user_ids",i._mentionedUserIds),i.translationTargetLanguages&&0<i.translationTargetLanguages.length&&n.add("translation_target_langs",i.translationTargetLanguages),i.pushNotificationDeliveryOption&&i.pushNotificationDeliveryOption!==r.cls.BaseMessageParams.PushNotificationDeliveryOption.DEFAULT&&n.add("push_option",i.pushNotificationDeliveryOption),r.post(e,n,t))})}},{key:"getMyPushTriggerOption",value:function(e,t){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(i)),r.get(n,null,t))})}},{key:"setMyPushTriggerOption",value:function(e,t){var r=this,i=e.channelUrl,a=e.pushTriggerOption,s=e.enable;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(i)),n=new F,a&&n.add("push_trigger_option",a),"boolean"==typeof s&&n.add("enable",s),r.put(e,n,t))})}},{key:"setMyCountPreference",value:function(e,t){var r=this,i=e.channelUrl,a=e.countPreference;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_COUNT_PREFERENCE.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(i)),n=new F({count_preference:a}),r.put(e,n,t))})}},{key:"resetMyHistory",value:function(e,t){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.GROUPCHANNELS_RESET_USER_HISTORY.replace("%s",encodeURIComponent(i)),r.put(e,null,t))})}},{key:"addReaction",value:function(e,r){var i=this,a=e.isGroupChannel,s=e.channelUrl,o=e.messageId,l=e.key;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(a?A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION).replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(o)),e=new F({reaction:l}),i.post(t,e,r))})}},{key:"deleteReaction",value:function(e,r){var i=this,a=e.isGroupChannel,s=e.channelUrl,o=e.messageId,l=e.key;this.sb.ConnectionManager.ready(function(e,n){var t;e?r(e,null):(t=(a?A.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:A.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION).replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(o)),e=new F({reaction:l}),i.delete(t,e,r))})}},{key:"getAllEmoji",value:function(t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):r.get(A.Path.EMOJI_CATEGORIES,null,t)})}},{key:"getEmojiCategory",value:function(e,t){var r=this,i=e.categoryId;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.EMOJI_CATEGORIES_CATEGORYID.replace("%s",i),r.get(e,null,t))})}},{key:"getEmoji",value:function(e,t){var r=this,i=e.emojiKey;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.EMOJIS_EMOJIKEY.replace("%s",i),r.get(e,null,t))})}},{key:"getAllowFriendDiscovery",value:function(t){var r=this;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(n=A.Path.USERS_USERID_ALLOW_FRIEND_DISCOVERY.replace("%s",encodeURIComponent(n.userId)),r.get(n,null,t))})}},{key:"setAllowFriendDiscovery",value:function(e,t){var r=this,i=e.allowFriendDiscovery;this.sb.ConnectionManager.ready(function(e,n){e?t(e,null):(e=A.Path.USERS_USERID_ALLOW_FRIEND_DISCOVERY.replace("%s",encodeURIComponent(n.userId)),n=new F,"boolean"==typeof i&&n.add("allow_friend_discovery",i),r.put(e,n,t))})}}],[{key:"Path",get:function(){return{USERS:"/users",USERS_USERID:"/users/%s",USERS_USERID_LOGIN:"/users/%s/login",USERS_USERID_SESSION_KEY:"/users/%s/session_key",USERS_USERID_METADATA:"/users/%s/metadata",USERS_USERID_METADATA_KEY:"/users/%s/metadata/%s",USERS_USERID_MARKASREADALL:"/users/%s/mark_as_read_all",USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS:"/users/%s/my_group_channels/changelogs",USERS_USERID_UNREAD_ITEM_COUNT:"/users/%s/unread_item_count",USERS_USERID_UNREAD_MESSAGE_COUNT:"/users/%s/unread_message_count",USERS_USERID_UNREAD_CHANNEL_COUNT:"/users/%s/unread_channel_count",USERS_USERID_PUSH_GCM_TOKEN:"/users/%s/push/gcm/%s",USERS_USERID_PUSH_GCM:"/users/%s/push/gcm",USERS_USERID_PUSH_DEVICE_TOKENS:"/users/%s/push/%s/device_tokens",USERS_USERID_PUSHPREFERENCE_CHANNELURL:"/users/%s/push_preference/%s",USERS_USERID_PUSHPREFERENCE:"/users/%s/push_preference/",USERS_USERID_PUSH_TEMPLATE:"/users/%s/push/template",USERS_USERID_BLOCK:"/users/%s/block",USERS_USERID_BLOCK_TARGETID:"/users/%s/block/%s",USERS_USERID_PUSH_APNS_TOKEN:"/users/%s/push/apns/%s",USERS_USERID_PUSH_APNS:"/users/%s/push/apns",USERS_USERID_PUSH:"/users/%s/push",USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE:"/users/%s/channel_invitation_preference",USERS_USERID_GROUP_CHANNEL_COUNT:"/users/%s/group_channel_count",USERS_COUNT_PREFERENCE:"/users/%s/count_preference/%s",USERS_USERID_ALLOW_FRIEND_DISCOVERY:"/users/%s/allow_friend_discovery",OPENCHANNELS:"/open_channels",OPENCHANNELS_CHANNELURL:"/open_channels/%s",OPENCHANNELS_CHANNELURL_MESSAGES:"/open_channels/%s/messages",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/open_channels/%s/messages/%s",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/open_channels/%s/messages/%s/translation",OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/open_channels/%s/messages/changelogs",OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/open_channels/%s/scheduled_messages",OPENCHANNELS_CHANNELURL_PARTICIPANTS:"/open_channels/%s/participants",OPENCHANNELS_CHANNELURL_OPERATORS:"/open_channels/%s/operators",OPENCHANNELS_CHANNELURL_METADATA:"/open_channels/%s/metadata",OPENCHANNELS_CHANNELURL_METADATA_KEY:"/open_channels/%s/metadata/%s",OPENCHANNELS_CHANNELURL_METACOUNTER:"/open_channels/%s/metacounter",OPENCHANNELS_CHANNELURL_METACOUNTER_KEY:"/open_channels/%s/metacounter/%s",OPENCHANNELS_CHANNELURL_BAN:"/open_channels/%s/ban",OPENCHANNELS_CHANNELURL_BAN_USERID:"/open_channels/%s/ban/%s",OPENCHANNELS_CHANNELURL_MUTE:"/open_channels/%s/mute",OPENCHANNELS_CHANNELURL_MUTE_USERID:"/open_channels/%s/mute/%s",OPENCHANNELS_CHANNELURL_FREEZE:"/open_channels/%s/freeze",OPENCHANNELS_OPERATORS:"/open_channels/%s/operators",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:"/open_channels/%s/messages/%s/reactions",GROUPCHANNELS:"/group_channels",MYGROUPCHANNELS:"/users/%s/my_group_channels",GROUPCHANNELS_CHANNELURL:"/group_channels/%s",GROUPCHANNELS_CHANNELURL_INVITE:"/group_channels/%s/invite",GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION:"/group_channels/%s/accept",GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION:"/group_channels/%s/decline",GROUPCHANNELS_CHANNELURL_HIDE:"/group_channels/%s/hide",GROUPCHANNELS_CHANNELURL_LEAVE:"/group_channels/%s/leave",GROUPCHANNELS_CHANNELURL_JOIN:"/group_channels/%s/join",GROUPCHANNELS_CHANNELURL_OPERATORS:"/group_channels/%s/operators",GROUPCHANNELS_CHANNELURL_MESSAGES:"/group_channels/%s/messages",GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD:"/group_channels/%s/messages/mark_as_read",GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASDELIVERED:"/group_channels/%s/messages/mark_as_delivered",GROUPCHANNELS_CHANNELURL_MESSAGES_TOTALCOUNT:"/group_channels/%s/messages/total_count",GROUPCHANNELS_CHANNELURL_MESSAGES_UNREADCOUNT:"/group_channels/%s/messages/unread_count",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/group_channels/%s/messages/%s",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/group_channels/%s/messages/%s/translation",GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/group_channels/%s/messages/changelogs",GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/group_channels/%s/scheduled_messages",GROUPCHANNELS_CHANNELURL_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_METADATA:"/group_channels/%s/metadata",GROUPCHANNELS_CHANNELURL_METADATA_KEY:"/group_channels/%s/metadata/%s",GROUPCHANNELS_CHANNELURL_METACOUNTER:"/group_channels/%s/metacounter",GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY:"/group_channels/%s/metacounter/%s",GROUPCHANNELS_RESET_USER_HISTORY:"/group_channels/%s/reset_user_history",GROUPCHANNELS_OPERATORS:"/group_channels/%s/operators",GROUPCHANNELS_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_BAN:"/group_channels/%s/ban",GROUPCHANNELS_CHANNELURL_BAN_USERID:"/group_channels/%s/ban/%s",GROUPCHANNELS_CHANNELURL_MUTE:"/group_channels/%s/mute",GROUPCHANNELS_CHANNELURL_MUTE_USERID:"/group_channels/%s/mute/%s",GROUPCHANNELS_CHANNELURL_FREEZE:"/group_channels/%s/freeze",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:"/group_channels/%s/messages/%s/reactions",STORAGE_FILE:"/storage/file",STORAGE_PROFILE:"/storage/profile_image",FRIENDS:"/users/%s/friends",FRIENDS_CHANGE_LOGS:"/users/%s/friends/changelogs",FRIENDS_DISCOVERIES:"/users/%s/friend_discoveries",SEARCH_MESSAGE:"/search/messages",REPORT_USERS:"/report/users/%s",REPORT_CHANNELS:"/report/%s/%s",REPORT_MESSAGES:"/report/%s/%s/messages/%s",EMOJIS_EMOJIKEY:"/emojis/%s",EMOJI_CATEGORIES:"/emoji_categories",EMOJI_CATEGORIES_CATEGORYID:"/emoji_categories/%s"}}}]),A}(),j=function(){function t(e,n){c(this,t),this.sb=e,this.ws=null,this.wsHost=null,this.WebSocket=null,this.handler=n||new t.ConnectionHandler,this.explicitDisconnect=!1,this.lastActiveMillis=0;try{this.WebSocket="undefined"==typeof WebSocket?r:WebSocket}catch(e){this.WebSocket=WebSocket}}return o(t,[{key:"connect",value:function(e,n,t){var i=this;he.debug("`WebSocketClient.connect` called.");var r=ce.get(this.sb._iid).container,a=r.pinger,s=r.auth,o=r.extensions,l=r.getUserAgentWithExtensions,u=r.sessionManager;this.wsHost=t;try{var c="/?p=JS&pv="+encodeURIComponent(ue.OS_VERSION)+"&sv="+encodeURIComponent(ue.SDK_VERSION)+"&ai="+encodeURIComponent(this.sb.getApplicationId());if(s.sessionKey?c+="&key="+encodeURIComponent(s.sessionKey):c+="&user_id="+encodeURIComponent(e)+"&access_token="+encodeURIComponent(n),c+="&active=1",c+="&SB-User-Agent="+encodeURIComponent(l(o)),c+="&Request-Sent-Timestamp="+(new Date).getTime().toString(),c+="&include_extra_data="+encodeURIComponent(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"].join(",")),u.handler&&(c+="&expiring_session=1"),this.ws=new this.WebSocket(this.wsHost+c),!this.ws)return this.sb.isReconnectingOnError=!0,void this.handler.onError("ws does not exist.")}catch(e){return this.sb.isReconnectingOnError=!0,void this.handler.onError(e)}try{this.sb.getDebugMode()&&"undefined"!=typeof window&&(window.ws=this.ws)}catch(e){he.debug("`window` object does not exist.")}var d=!1;this.ws.onopen=function(e){he.debug("`WebSocket.onopen` called."),i.handler.onOpen(e)},this.ws.onmessage=function(e){i.active();var n,t=e.data.split("\n");for(n in t){var r=t[n];if(r&&"string"==typeof r){try{if("PONG"===r.substring(0,4)){a.pong();continue}}catch(e){he.debug("`WebSocket.onmessage` command check error:",e)}i.handler.onMessage(r)}}},this.ws.onerror=function(e){he.debug("`WebSocket.onerror` called:",e),a&&a.stop(),d=!0,i.sb.isReconnectingOnError=!0,i.handler.onError(e)},this.ws.onclose=function(e){he.group("`WebSocket.onclose` called.",[{level:he.supportedLogLevels.DEBUG,messages:["e",e]},{level:he.supportedLogLevels.DEBUG,messages:["explicitDisconnect",i.explicitDisconnect]}]),a&&a.stop(),i.explicitDisconnect?i.handler.onClose(e):d||i.handler.onError(e),i.explicitDisconnect=!1}}},{key:"disconnect",value:function(e,n){he.group("`WebSocketClient.onclose` called.",[{level:he.supportedLogLevels.DEBUG,messages:["explicit",e]}]);var t=ce.get(this.sb._iid).container.pinger;t&&t.stop(),this.explicitDisconnect=!0===e,this.ws&&(this.ws.onopen=function(){},this.ws.onmessage=function(){},this.ws.onclose=function(){n&&n()},this.ws.onerror=function(){},this.ws.close(),this.ws=null),this.explicitDisconnect?this.handler.onClose():this.handler.onError(),this.explicitDisconnect=!1}},{key:"send",value:function(e,n){var t;1!==this.ws.readyState?n&&n(new de("Connection is not valid. Please reconnect.",de.WEBSOCKET_CONNECTION_CLOSED),null):(t=ce.get(this.sb._iid).container.pinger,this.ws.send(e.encode()),"PING"!==e.command&&t.refreshTimer(),n&&n(null,null))}},{key:"active",value:function(){this.lastActiveMillis=(new Date).getTime()}},{key:"getConnectionState",value:function(){try{return 1===this.ws.readyState?this.sb.ConnectionState.OPEN:0===this.ws.readyState?this.sb.ConnectionState.CONNECTING:this.sb.ConnectionState.CLOSED}catch(e){return this.sb.ConnectionState.CLOSED}}}]),t}();j.ConnectionHandler=function(){return function e(){c(this,e),this.onReady=function(){},this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){}}}();var q=3,z=24,Q=3,Y=2,K=function(){function n(e){c(this,n),this.sb=e,this.cls=B.get(this.sb._iid),this.client=new j(this.sb),this.connectParams={retryCount:1},this.reconnectParams={interval:q,retryCount:Q,multiplier:Y,maxInterval:z},this.connectCount=0,this.reconnectCount=0,this.reconnectDelay=0}return o(n,[{key:"isConnected",get:function(){return this.client&&this.client.getConnectionState()===this.sb.ConnectionState.OPEN}},{key:"connect",value:function(t,r){var i=this,e=ce.get(this.sb._iid).container,n=e.auth,a=e.apiClient,s=e.commandHandler;n.sessionToken=r||null;var o=this.cls.GroupChannel,l=null,e=new j.ConnectionHandler;this.client=new j(this.sb,e),e.onMessage=function(e){s.onRawCommandReceived(e)},this.sb.loginHandler=function(e,n){i.sb.connecting=!1,e?i.disconnect({clearSession:!0,err:e},null):(clearInterval(i.sb.globalTimer),(e=function(){if(o.cachedChannels)for(var e in o.cachedChannels){var n=o.cachedChannels[e];if(n.invalidateTypingStatus())for(var t in i.sb.channelHandlers)i.sb.channelHandlers[t].onTypingStatusUpdated(n)}})(),i.sb.globalTimer=setInterval(e,1e3),i.flushConnectionCallbacks(null,n),i.sb.connecting=!1,i.sb.reconnecting=!1,i.sb.ConnectionManager.processAllReadyHandler(null))},e.onOpen=function(){i.connectCount=0,i.sb.loginTimer=setTimeout(function(){i.sb.loginTimer=null,i.sb.onLoginTimerCancel=null,i.flushConnectionCallbacks(new de("Connection timeout.",de.LOGIN_TIMEOUT),null),i.sb.disconnect(null)},i.sb.Options.websocketResponseTimeout),i.sb.onLoginTimerCancel=function(){i.connectCount=0,i.flushConnectionCallbacks(new de("Connection has been canceled.",de.REQUEST_FAILED),null)},i.sb.connecting=!1},e.onError=function(e){he.debug("Connect: `WebSocketClient.ConnectionHandler.onError` called.",e),n.sessionKey?(i.sb.isReconnectingOnError=!0,i.sb.ConnectionManager.errorAllReadyHandler(),i.reconnect(t,!0),i.sb.connecting=!1):i.connectCount<i.connectParams.retryCount?(i.connectCount++,i.client.connect(t,r,l)):(i.connectCount=0,i.flushConnectionCallbacks(new de("Websocket connection failed.",de.WEBSOCKET_CONNECTION_FAILED),null),i.sb.connecting=!1)},e.onClose=function(){he.debug("Connect: `WebSocketClient.ConnectionHandler.onClose` called."),i.connectCount=0,i.sb.connecting=!1},a.checkRouting(function(e,n){e?(i.sb.connecting=!1,i.flushConnectionCallbacks(new de("Connection routing failed.",de.REQUEST_FAILED),null)):(l=n.wsHost,a.dummyCall(function(e){e&&he.error("API dummy call failed:",e)}),i.client.connect(t,r,l))})}},{key:"reconnect",value:function(i){var a=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=ce.get(this.sb._iid).container,t=n.auth,r=n.apiClient,s=n.commandHandler,o=n.sessionManager,l=this.cls.OpenChannel;if(this.sb.reconnecting=!0,this.sb.reconnectTimer)he.debug("Reconnect: still reconnecting.");else{if(this.reconnectCount+=1,this.reconnectCount<=1){if(e)for(var u in this.sb.connectionHandlers)this.sb.connectionHandlers[u].onReconnectStarted();this.reconnectDelay=0}else this.reconnectDelay=Math.min(1e3*this.reconnectParams.interval*Math.pow(this.reconnectParams.multiplier,this.reconnectCount-2),0<this.reconnectParams.maxInterval?1e3*this.reconnectParams.maxInterval:Number.MAX_SAFE_INTEGER);if(!i||!t.sessionKey||0<this.reconnectParams.retryCount&&this.reconnectCount>this.reconnectParams.retryCount){for(var c in this.disconnect({clearSession:!1,err:new de("Websocket connection failed.",de.WEBSOCKET_CONNECTION_FAILED)},null),this.reconnectCount=0,this.sb.connectionHandlers)this.sb.connectionHandlers[c].onReconnectFailed();return this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1,void this.sb.ConnectionManager.errorAllReadyHandler()}this.sb.onReconnectTimerCancel=function(){a.reconnectCount=0},this.sb.reconnectTimer=setTimeout(function(){a.sb.reconnectTimer=null,a.sb.onReconnectTimerCancel=null,a.client&&a.client.disconnect(!0);var e=new j.ConnectionHandler;a.client=new j(a.sb,e),a.sb.loginHandler=function(e,n){if(e)e.isSessionKeyExpiredError?o.refresh(function(){}):(clearTimeout(a.sb.reconnectTimer),a.sb.reconnectTimer=null,a.reconnect(i,!1));else{for(var t in a.reconnectCount=0,a.sb.connecting=!1,a.sb.reconnecting=!1,a.sb.isReconnectingOnError=!1,a.sb.connectionHandlers)a.sb.connectionHandlers[t].onReconnectSucceeded();if(a.sb.ConnectionManager.processAllReadyHandler(null),a.sb.isReconnectingOnError)for(var r in a.sb.ConnectionManager.networkHandlers)a.sb.ConnectionManager.networkHandlers[r].onReconnected();Object.keys(l.enteredChannels).forEach(function(t){l.enteredChannels[t].enter(function(e,n){e&&(e=a.cls.FileMessageQueue,delete l.enteredChannels[t],e.delete(t))})})}},e.onOpen=function(){he.debug("Reconnect: `WebSocketClient.ConnectionHandler.onOpen` called."),a.sb.loginTimer=setTimeout(function(){he.debug("Reconnect: `loginTimer` timeout."),a.sb.loginTimer=null,a.reconnect(i,!0)},a.sb.Options.websocketResponseTimeout),a.sb.onLoginTimerCancel=null,a.sb.reconnecting=!1},e.onMessage=function(e){s.onRawCommandReceived(e)},e.onError=function(e){he.debug("Reconnect: `WebSocketClient.ConnectionHandler.onError` called.",e),a.sb.isReconnectingOnError=!0,a.sb.ConnectionManager.errorAllReadyHandler(),a.reconnect(i,!0)},e.onClose=function(){he.debug("Reconnect: `WebSocketClient.ConnectionHandler.onClose` called."),a.sb.reconnecting=!1},r.checkRouting(function(e,n){e?a.reconnect(i,!0):(a.sb.getCurrentApiHost()!==n.apiHost&&r.get("/",null,function(){}),a.client.connect(i,null,n.wsHost))})},this.reconnectDelay)}}},{key:"disconnect",value:function(e,n){var t=ce.get(this.sb._iid),r=t.container.ackStateMap,i=this.cls,a=i.GroupChannel,s=i.OpenChannel,i=e.clearSession,e=e.err;if(this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.onLoginTimerCancel&&(this.sb.onLoginTimerCancel(),this.sb.onLoginTimerCancel=null),this.sb.loginTimer=null),this.sb.reconnectTimer&&(clearTimeout(this.sb.reconnectTimer),this.sb.onReconnectTimerCancel&&(this.sb.onReconnectTimerCancel(),this.sb.onReconnectTimerCancel=null),this.sb.reconnectTimer=null),this.client&&(this.reconnectCount=0,this.client.disconnect(!0),this.client=null),i){for(var o in s.clearEnteredChannels(),s.clearCache(),a.clearCache(),this.sb.globalTimer&&(clearInterval(this.sb.globalTimer),this.sb.globalTimer=null),r)clearTimeout(r[o].timer);this.sb.currentUser=null,t.set("ackStateMap",{}),t.set("subscribedUnreadMessageCount",{all:0,custom_types:{},ts:0}),t.set("auth",new b)}e&&(this.flushConnectionCallbacks(e,null),this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1),n&&n(null,null)}},{key:"flushConnectionCallbacks",value:function(n,t){var e=this.sb.connectionCallbacks;this.sb.connectionCallbacks=[],e.forEach(function(e){return e(n,t)})}}]),n}(),V=function(){function u(e){var n=e.type,t=e.nullable,r=void 0!==t&&t,i=e.optional,a=void 0!==i&&i,s=e.optionalIf,t=void 0===s?null:s,i=e.ignoreIf,s=void 0===i?null:i,i=e.defaultValue,i=void 0===i?null:i,e=e.constraint,e=void 0===e?null:e;c(this,u),this.type=n,this.nullable=r,this.optional=a,this.optionalIf=t,this.ignoreIf=s,this.defaultValue=i,this.constraint=e}return o(u,[{key:"isMatchingType",value:function(t){function n(e,n){return"string"==typeof n?le(e)===n||"array"===n&&Array.isArray(e)||"file"===n&&pe.isFile(e)||"null"===n&&null===e||"date"===n&&e instanceof Date:"function"==typeof n?e instanceof n:"object"===le(n)&&-1<Object.keys(n).map(function(e){return n[e]}).indexOf(t)}return n(t,this.type)||Array.isArray(this.type)&&this.type.some(function(e){return n(t,e)})||this.nullable&&null===t}}],[{key:"parse",value:function(e,n){for(e=u.toArray(e);0<e.length&&void 0===e[e.length-1];)e.pop();var t=!1,r=null;"callback"===n[n.length-1].type&&("function"==typeof e[e.length-1]&&(r=e.pop()),n.pop(),t=!0);var i,a=[],s=null,o=0;for(i in n){var l=n[i];"function"==typeof l.ignoreIf&&l.ignoreIf(e)?a.push(l.hasOwnProperty("defaultValue")?l.defaultValue:null):l.isMatchingType(e[o])?(l.nullable&&null===e[o]||!l.constraint||l.constraint(e[o])||(s=u.error),a.push(e[o]),o++):l.optional||"function"==typeof l.optionalIf&&l.optionalIf(e)?a.push(l.hasOwnProperty("defaultValue")?l.defaultValue:null):(s=u.error,a.push(e[o]),o++)}return t&&r&&a.push(r),[s=e.length!==o?u.error:s].concat(a)}},{key:"error",get:function(){return new de("Invalid parameter.",de.INVALID_PARAMETER)}},{key:"toArray",value:function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t]);return n}}]),u}(),W=function(){function n(e){c(this,n),this.sb=e,this.authCount=0,this.readyHandlers=[],this.networkHandlers={},this.authenticateTimer=1e4,this.authInfoRequester=null}return o(n,[{key:"addReadyHandler",value:function(e){e&&"function"==typeof e&&this.readyHandlers.push(e)}},{key:"ready",value:function(e){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],t=ce.get(this.sb._iid).container,r=t.auth,t=t.isInBackground;n&&r.hasSession()?e&&(this.sb.currentUser?e(null,this.sb.currentUser):(this.addReadyHandler(e),this.errorAllReadyHandler()),this.sb.getConnectionState()!==this.sb.ConnectionState.CLOSED||t||this.sb.reconnect()):(this.addReadyHandler(e),this.sb.isReconnectingOnError?this.errorAllReadyHandler():this.sb.getConnectionState()===this.sb.ConnectionState.OPEN?this.processAllReadyHandler(null):this.sb.getConnectionState()===this.sb.ConnectionState.CONNECTING||this.errorAllReadyHandler())}},{key:"processAllReadyHandler",value:function(n){var t,e;0<this.readyHandlers.length&&(t=this.sb.currentUser,e=this.readyHandlers,this.readyHandlers=[],e.forEach(function(e){e&&"function"==typeof e&&e(n,t)}))}},{key:"errorAllReadyHandler",value:function(){this.processAllReadyHandler(new de("Connection should be made first.",de.CONNECTION_REQUIRED))}},{key:"NetworkHandler",value:function(){this.onReconnected=function(){}}},{key:"addNetworkHandler",value:function(e,n){this.networkHandlers[e]=n}},{key:"removeNetworkHandler",value:function(e){delete this.networkHandlers[e]}},{key:"removeAllNetworkHandler",value:function(){this.networkHandlers={}}},{key:"authenticate",value:function(t){var r,i=this;this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnecting?(this.sb.connecting=!1,t(null,this.sb.currentUser)):this.authInfoRequester&&"function"==typeof this.authInfoRequester?(this.sb.connecting=!0,this.authCount++,r=setTimeout(function(){r=null,i.authCount--,0===i.authCount&&0===i.sb.connectionCallbacks.length&&(i.sb.connecting=!1),i.errorAllReadyHandler(),t(new de("Connection should be made first.",de.CONNECTION_REQUIRED),null)},this.authenticateTimer),this.authInfoRequester(function(e){var n;r&&(clearTimeout(r),r=null,i.authCount--,n=function(e,n){i.sb.connecting=!1,t(e,null)},e&&e.hasOwnProperty("userId")?e.accessToken?e.apiHost&&e.wsHost?i.sb.connect(e.userId,e.accessToken,e.apiHost,e.wsHost,n):i.sb.connect(e.userId,e.accessToken,n):e.apiHost&&e.wsHost?i.sb.connect(e.userId,e.apiHost,e.wsHost,n):i.sb.connect(e.userId,n):t(V.error,null))})):t(V.error,null)}}]),n}(),J=function e(){c(this,e),this.onSessionExpired=function(){},this.onSessionTokenRequired=function(e,n){return e(null)},this.onSessionError=function(e){},this.onSessionRefreshed=function(){},this.onSessionClosed=function(){}},X=function(){function n(e){c(this,n),this.sb=e,this.handler=null,this.callbacks=[]}return o(n,[{key:"_refreshSessionKey",value:function(){var n=this;ce.get(this._iid).container.wsAdapter.isConnected?this._refreshSessionKeyByCommand(function(e){e?e.isSessionTokenExpiredError?n._handleRefreshError(e):n._refreshSessionKeyByApi(function(e){e?n._handleRefreshError(e):n._handleRefreshSuccess()}):n._handleRefreshSuccess()}):this._refreshSessionKeyByApi(function(e){e?n._handleRefreshError(e):n._handleRefreshSuccess()})}},{key:"_refreshSessionKeyByCommand",value:function(r){var i=this.sb,a=ce.get(this._iid).container.auth,e=B.get(this._iid).Command,e=e.bSessionRefresh({token:a.sessionToken,requestId:e.generateRequestId()});i.sendCommand(e,function(e,n){var t;i.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),e&&(e.hasOwnProperty("error")?n=new de("Failed to refresh the session key.",de.SESSION_TOKEN_REFRESH_FAILED):e.hasOwnProperty("new_key")&&(a.sessionKey=e.new_key)),r(n)})}},{key:"_refreshSessionKeyByApi",value:function(a){var s=this;(function t(r){var i,e,n;r<3?(n=ce.get(s._iid).container,i=n.auth,e=n.apiClient,n={},i.sessionToken&&(n.accessToken=i.sessionToken),e.refreshSessionKey(n,function(e,n){e?e.isSessionTokenExpiredError?a(new de("Failed to refresh the session key.",de.SESSION_TOKEN_REFRESH_FAILED)):t(r+1):(n=n.key,i.sessionKey=n,a(null))})):a(new de("Failed to refresh the session key.",de.SESSION_TOKEN_REFRESH_FAILED))})(0)}},{key:"_handleRefreshSuccess",value:function(){var e=this.sb;e.reconnectTimer&&(clearTimeout(e.reconnectTimer),e.reconnectTimer=null),e.reconnect(),this._flushCallbacks(new de("Session key refreshed.",de.SESSION_TOKEN_REFRESHED)),this.handler&&this.handler.onSessionRefreshed()}},{key:"_handleRefreshError",value:function(e){this._flushCallbacks(e),this.handler&&this.handler.onSessionError(e)}},{key:"_handleClose",value:function(){var e=this;this.sb.disconnect(function(){e._flushCallbacks(new de("Failed to refresh the session key.",de.SESSION_TOKEN_REFRESH_FAILED)),e.handler&&e.handler.onSessionClosed()})}},{key:"_flushCallbacks",value:function(n){this.callbacks.forEach(function(e){return e(n)}),this.callbacks=[]}},{key:"setHandler",value:function(e){e instanceof J&&(this.handler=e)}},{key:"refresh",value:function(e){var n=this,t=this.sb,r=ce.get(this._iid).container.auth;this.handler?(this.callbacks.push(e),1===this.callbacks.length&&(this.handler.onSessionExpired(),r.sessionToken?this.handler.onSessionTokenRequired(function(e){e?(r.sessionToken=e,n._refreshSessionKey()):n._handleClose()},function(){t.reconnectTimer&&(clearTimeout(t.reconnectTimer),t.reconnectTimer=null);var e=new de("Failed to get the session token.",de.SESSION_TOKEN_REQUEST_FAILED);n._flushCallbacks(e),n.handler&&n.handler.onSessionError(e)}):this._refreshSessionKey())):e(null)}}]),n}(),Z=function(){function n(e){c(this,n),this.sb=e}return o(n,[{key:"onlineWorker",value:function(){try{var e;"undefined"!=typeof navigator&&navigator.onLine&&(e=ce.get(this.sb._iid).container.auth,this.sb.reconnecting||this.sb.connecting||!e.sessionKey||this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnect())}catch(e){he.debug("There is no `window.addEventListener.ononline` or `navigator.onLine`")}}},{key:"offlineWorker",value:function(){try{var e,n;"undefined"==typeof navigator||navigator.onLine||(e=(n=ce.get(this.sb._iid).container).auth,n=n.pinger,this.sb.reconnecting||this.sb.connecting||!e.sessionKey||(n&&n.stop(),this.sb.reconnect()))}catch(e){he.debug("There is no `window.addEventListener.ononline` or `navigator.onLine`")}}},{key:"start",value:function(){try{"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&"boolean"==typeof navigator.onLine&&(window.addEventListener("online",this.onlineWorker),window.addEventListener("offline",this.offlineWorker))}catch(e){he.debug("There is no `window.addEventListener.ononline` or `navigator.onLine`")}}},{key:"stop",value:function(){try{window.removeEventListener("online",this.onlineWorker,!1),window.removeEventListener("offline",this.offlineWorker,!1)}catch(e){he.debug("There is no `window.addEventListener.ononline` or `navigator.onLine`")}}}]),n}(),$=4,ee=(new Date).getTime(),ne=function(){function i(e,n){var t,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;switch(c(this,i),this.command=e,this.requestId=r,arguments.length){case 1:!e||e.length<=$?(this.command="NOOP",this.payload="{}"):(this.decode(e),!this.isRequestIdCommand||(t=this.getJsonElement())&&(this.requestId=t.req_id||""));break;case 2:case 3:!this.requestId&&this.isRequestIdCommand&&(this.requestId=i.generateRequestId()),n.req_id=this.requestId||"",this.payload=JSON.stringify(n)}}return o(i,[{key:"isRequestIdCommand",get:function(){return this.isAckRequired||"EROR"===this.command}},{key:"isAckRequired",get:function(){return"MESG"===this.command||"FILE"===this.command||"ENTR"===this.command||"EXIT"===this.command||"READ"===this.command||"MEDI"===this.command||"FEDI"===this.command}},{key:"encode",value:function(){return this.command+this.payload+"\n"}},{key:"decode",value:function(e){e=e.trim(),this.command=e.substring(0,$),this.payload=e.substring($)}},{key:"getJsonElement",value:function(){return JSON.parse(this.payload)}}],[{key:"bSessionRefresh",value:function(e){return new this("LOGI",{token:e.token},e.requestId)}},{key:"bPing",value:function(){return new this("PING",{id:(new Date).getTime(),active:1})}},{key:"bMessage",value:function(e){var n=e.channelUrl,t=e.message,r=e.data,i=e.customType,a=e.metaArrays,s=e.mentionType,o=e.mentionedUserIds,l=e.translationTargetLanguages,u=e.pushNotificationDeliveryOption,c=e.requestId,d=void 0===c?null:c,h=e.silent,p=void 0!==h&&h,g=e.rootMessageId,y=void 0===g?null:g,c=e.parentMessageId,h=void 0===c?null:c,g=B.get(this._iid),e=g.UserMessageParams,c=g.BaseMessageParams,g={};return g.channel_url=n,g.message=t,g.data=r,a&&0<a.length&&(g.metaarray=a.map(function(e){return e.encode()})),s&&(g.mention_type=s),g.mentioned_user_ids=[],s===c.MentionType.CHANNEL?g.mentioned_user_ids=[]:Array.isArray(o)&&0<o.length&&(g.mentioned_user_ids=o),i&&(g.custom_type=i),l&&0<l.length&&(g.target_langs=l),u&&u!==e.PushNotificationDeliveryOption.DEFAULT&&(g.push_option=u),p&&(g.silent=p),y&&(g.root_message_id=y),h&&(g.parent_message_id=h),new this("MESG",g,d)}},{key:"bFile",value:function(e){var n=e.channelUrl,t=e.url,r=e.name,i=e.type,a=e.size,s=e.data,o=e.customType,l=e.thumbnailSizes,u=e.requireAuth,c=e.metaArrays,d=e.mentionType,h=e.mentionedUserIds,p=e.pushNotificationDeliveryOption,g=e.requestId,y=void 0===g?null:g,f=e.silent,_=void 0!==f&&f,m=e.rootMessageId,v=void 0===m?null:m,g=e.parentMessageId,f=void 0===g?null:g,m=B.get(this._iid),e=m.BaseMessageParams,g=m.FileMessageParams,m={};return m.channel_url=n,m.url=t,m.name=r||"",m.type=i||"",m.size=a||0,m.custom=s,o&&(m.custom_type=o),l&&(m.thumbnails=l),u&&(m.require_auth=u),c&&0<c.length&&(m.metaarray=c.map(function(e){return e.encode()})),d&&(m.mention_type=d),m.mentioned_user_ids=[],d===e.MentionType.CHANNEL?m.mentioned_user_ids=[]:Array.isArray(h)&&0<h.length&&(m.mentioned_user_ids=h),p&&p!==g.PushNotificationDeliveryOption.DEFAULT&&(m.push_option=p),_&&(m.silent=_),v&&(m.root_message_id=v),f&&(m.parent_message_id=f),new this("FILE",m,y)}},{key:"bUpdateUserMessage",value:function(e){var n=e.channelUrl,t=e.messageId,r=e.message,i=void 0===r?null:r,a=e.data,s=void 0===a?null:a,o=e.customType,l=void 0===o?null:o,u=e.mentionType,r=void 0===u?null:u,a=e.mentionedUserIds,o=void 0===a?null:a,u=e.metaArrayParams,a=void 0===u?null:u,e=B.get(this._iid).BaseMessageParams,u={};return u.channel_url=n,u.msg_id=t,null!=i&&void 0!==i&&(u.message=i),null!=s&&void 0!==s&&(u.data=s),null!=l&&void 0!==l&&(u.custom_type=l),r&&(u.mention_type=r),r===e.MentionType.CHANNEL?u.mentioned_user_ids=[]:Array.isArray(o)&&0<o.length&&(u.mentioned_user_ids=o),a&&(u.metaarray=a),new this("MEDI",u)}},{key:"bUpdateFileMessage",value:function(e){var n=e.channelUrl,t=e.messageId,r=e.data,i=void 0===r?null:r,a=e.customType,s=void 0===a?null:a,o=e.mentionType,l=void 0===o?null:o,r=e.mentionedUserIds,a=void 0===r?null:r,o=e.metaArrayParams,r=void 0===o?null:o,e=B.get(this._iid).BaseMessageParams,o={};return o.channel_url=n,o.msg_id=t,null!=i&&void 0!==i&&(o.data=i),null!=s&&void 0!==s&&(o.custom_type=s),l&&(o.mention_type=l),l===e.MentionType.CHANNEL?o.mentioned_user_ids=[]:Array.isArray(a)&&0<a.length&&(o.mentioned_user_ids=a),r&&(o.metaarray=r),new this("FEDI",o)}},{key:"bRead",value:function(e){var n=e.channelUrl,e={};return e.channel_url=n,new this("READ",e)}},{key:"bMessageAck",value:function(e){var n=e.channelUrl,t=e.messageId,e={};return e.channel_url=n,e.msg_id=t,new this("MACK",e)}},{key:"bTypeStart",value:function(e){var n=e.channelUrl,t=e.time,e={};return e.channel_url=n,e.time=t,new this("TPST",e)}},{key:"bTypeEnd",value:function(e){var n=e.channelUrl,t=e.time,e={};return e.channel_url=n,e.time=t,new this("TPEN",e)}},{key:"bEnter",value:function(e){var n=e.channelUrl,e={};return e.channel_url=n,new this("ENTR",e)}},{key:"bExit",value:function(e){var n=e.channelUrl,e={};return e.channel_url=n,new this("EXIT",e)}},{key:"generateRequestId",value:function(){return ee++,String(ee)}}]),i}(),te=1048576,re=new WeakMap,ge=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,a);var n=[];if(e.hasOwnProperty("premium_feature_list")&&Array.isArray(e.premium_feature_list))try{var t=e.premium_feature_list;n.push.apply(n,C(t))}catch(e){}var r=[];if(e.hasOwnProperty("application_attributes")&&Array.isArray(e.application_attributes))try{var i=e.application_attributes;r.push.apply(r,C(i))}catch(e){}re.set(this,{emojiHash:e.hasOwnProperty("emoji_hash")?e.emoji_hash:"",uploadSizeLimit:e.hasOwnProperty("file_upload_size_limit")?e.file_upload_size_limit*te:Number.MAX_VALUE,useReaction:e.hasOwnProperty("use_reaction")&&e.use_reaction,applicationAttributes:r,premiumFeatureList:n})}return o(a,[{key:"emojiHash",get:function(){return re.get(this).emojiHash}},{key:"uploadSizeLimit",get:function(){return re.get(this).uploadSizeLimit}},{key:"premiumFeatureList",get:function(){return re.get(this).premiumFeatureList}},{key:"applicationAttributes",get:function(){return re.get(this).applicationAttributes}},{key:"isUsingReaction",get:function(){return re.get(this).useReaction}}]),a}(),ie=function(){function e(){c(this,e),this.messageId=null,this.userId=null,this.key=null,this.operation="",this.updatedAt=null}return o(e,null,[{key:"createFromJson",value:function(e){var n=parseInt(e.msg_id),t=e.user_id,r=e.operation,i=e.reaction,a=e.updated_at;if(n&&"string"==typeof t&&"string"==typeof r&&0<=["add","delete"].indexOf(r.toLowerCase())&&"string"==typeof i&&i&&"number"==typeof a){e=new this;return e.messageId=n,e.userId=t,e.key=i,e.operation=r.toLowerCase(),e.updatedAt=a,e}return null}}]),e}();function ae(i,e,a){return new Promise(function(t,r){e(function(e,n){a&&"function"==typeof a&&(ce.get(i).container.isErrorFirstInCallback?a(e,n):a(n,e)),e?r(e):t(n)})})}var se=function(){function e(){c(this,e)}return o(e,null,[{key:"serialize",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=JSON.parse(JSON.stringify(e));return n&&n(e),function n(t){return Object.keys(t).forEach(function(e){t[e]&&"object"===le(t[e])&&n(t[e])}),Object.freeze(t)}(e)}},{key:"deserialize",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=JSON.parse(JSON.stringify(e));return n&&n(e),e}}]),e}(),oe={TIMESTAMP:"timestamp",MESSAGE_ID:"messageId"},ye=new WeakMap,fe=function(){function n(e){c(this,n),this.messageId=0,this.messageType=n.MESSAGE_TYPE_BASE,this.channelUrl="",this.data=null,this.customType=null,this.silent=!1,this.createdAt=0,this.updatedAt=0,this.channelType=null,this.metaArrays=[],this.reactions=[],this.mentionType=null,this.mentionedUsers=[],this.sendingStatus=null,ye.set(this,0),this.parentMessageId=0,this.parentMessageText=null,this.threadInfo=null,this.ogMetaData=null,this.isOperatorMessage=!1,e&&this.__update(e)}return o(n,[{key:"serialize",value:function(){return se.serialize(this,function(e){e.hasOwnProperty("_sender")&&(e.sender=e._sender,delete e._sender)})}},{key:"isIdentical",value:function(e){return!("object"!==le(e)||!e.hasOwnProperty("messageId"))&&(0!==this.messageId&&0!==e.messageId?this.messageId===e.messageId:this.reqId===e.reqId)}},{key:"isEqual",value:function(e){return pe.deepEqual(this,e)}},{key:"isOpenChannel",value:function(){var e=B.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=B.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isUserMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_USER}},{key:"isAdminMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_ADMIN}},{key:"isFileMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_FILE}},{key:"__update",value:function(e){var n=this,t=Zn.getInstance(this._iid),r=B.get(this._iid),i=r.User,a=r.BaseChannel,s=r.BaseMessageParams,o=r.Reaction,l=r.MessageMetaArray,u=r.ThreadInfo,r=r.OGMetaData;e.hasOwnProperty("msg_id")&&(this.messageId=parseInt(e.msg_id)),e.hasOwnProperty("message_id")&&(this.messageId=parseInt(e.message_id)),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.silent=!!e.hasOwnProperty("silent")&&e.silent,this.createdAt=e.hasOwnProperty("ts")?parseInt(e.ts):0,e.hasOwnProperty("created_at")&&(this.createdAt=parseInt(e.created_at)),this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):a.CHANNEL_TYPE_GROUP;var c=e.hasOwnProperty("metaarray")?e.metaarray:{},d=e.hasOwnProperty("metaarray_key_order")?e.metaarray_key_order:Object.keys(c).sort(function(e,n){return e.localeCompare(n)});this.metaArrays=[];for(var h=0;h<d.length;h++){var p=d[h];this.metaArrays.push(new l(p,c[p]||[]))}if(e.hasOwnProperty("sorted_metaarray")&&(a=e.sorted_metaarray,Array.isArray(a)&&(this.metaArrays=a.map(function(e){return new l(e.key,e.value)}))),this.reactions=[],e.hasOwnProperty("reactions")&&Array.isArray(e.reactions))for(var g in e.reactions){g=o.createFromJson(e.reactions[g]);g&&this.reactions.push(g)}this.mentionType=e.hasOwnProperty("mention_type")?e.mention_type:s.MentionType.USERS,this.mentionedUsers=[],e.hasOwnProperty("mentioned_users")&&e.mentioned_users.forEach(function(e){e=new i(e);n.mentionedUsers.push(e)}),this.sendingStatus=0<this.messageId?t.MessageSendingStatus.SUCCEEDED:t.MessageSendingStatus.FAILED,e.hasOwnProperty("sending_status")&&(this.sendingStatus=e.sending_status),e.hasOwnProperty("root_message_id")&&ye.set(this,parseInt(e.root_message_id)),e.hasOwnProperty("parent_message_id")&&(this.parentMessageId=parseInt(e.parent_message_id)),e.hasOwnProperty("parent_message_text")&&(this.parentMessageText=e.parent_message_text),this.threadInfo=new u(e.thread_info),e.hasOwnProperty("og_tag")&&(this.ogMetaData=new r(e.og_tag)),this.isOperatorMessage=!!e.hasOwnProperty("is_op_msg")&&e.is_op_msg}},{key:"getMetaArraysByKeys",value:function(n){return Array.isArray(n)?this.metaArrays.filter(function(e){return-1<n.indexOf(e.key)}):[]}},{key:"metaArray",get:function(){var n={};return this.metaArrays.forEach(function(e){n[e.key]=e.value}),n},set:function(e){if("object"===le(e)&&e){var n,t=B.get(this._iid).MessageMetaArray,r=[];for(n in e)r.push(new t(n,e[n]));this.metaArrays=r}}},{key:"getMetaArrayByKeys",value:function(e){var n={};return this.getMetaArraysByKeys(e).forEach(function(e){n[e.key]=e.value}),n}},{key:"applyReactionEvent",value:function(e){var n=this,t=B.get(this._iid).Reaction,r=T(V.parse(arguments,[new V({type:ie,constraint:function(e){return parseInt(e.messageId)===parseInt(n.messageId)}})]),2),i=r[0];if(e=r[1],!i){var a,s=!1;for(a in this.reactions)if(this.reactions[a].key===e.key){this.reactions[a]._applyEvent(e),this.reactions[a].isEmpty&&this.reactions.splice(a,1),s=!0;break}s||"add"!==e.operation||this.reactions.push(new t(e.key,[e.userId],e.updatedAt))}}},{key:"_getThreadedMessageList",value:function(i,a,s,e){var o=this,n=B.get(this._iid).ThreadedMessageListParams,n=T(V.parse(arguments,[new V({type:"number"}),new V({type:"string",constraint:function(e){return Object.values(oe).includes(e)}}),new V({type:n,constraint:function(e){return e._validate()}}),new V({type:"callback"})]),5),t=n[0];return i=n[1],a=n[2],s=n[3],e=n[4],ae(this._iid,function(r){var e,n;t?r(t,null):(e=(n=B.get(o._iid)).GroupChannel,n=n.OpenChannel,o.isGroupChannel()?e.getChannel(o.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;Zn.getInstance(o._iid).getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n?r(n,null):ce.get(o._iid).container.apiClient.getMessageList(g(g({channel:e,token:i,tokenType:a},s),{},{shouldReverse:s.reverse,rootMessageId:o.messageId,includeReplies:!0,includeThreadInfo:!0}),function(e,n){var t;e?r(e,null):(t=B.get(o._iid).BaseChannel,n=(e=n.messages.map(function(e){return t.buildMessage(e,o)}).filter(function(e){return null!==e})).filter(function(e){return e.messageId===o.messageId})[0],e=e.filter(function(e){return e.parentMessageId===o.messageId}),r(null,{parentMessage:n,threadedReplies:e}))})}):o.isOpenChannel()&&n.getChannel(o.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;Zn.getInstance(o._iid).getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n?r(n,null):ce.get(o._iid).container.apiClient.getMessageList(g(g({channel:e,token:i,tokenType:a},s),{},{shouldReverse:s.reverse,rootMessageId:o.messageId,includeReplies:!0,includeThreadInfo:!0}),function(e,n){var t;e?r(e,null):(t=B.get(o._iid).BaseChannel,n=(e=n.messages.map(function(e){return t.buildMessage(e,o)}).filter(function(e){return null!==e})).filter(function(e){return e.messageId===o.messageId})[0],e=e.filter(function(e){return e.parentMessageId===o.messageId}),r(null,{parentMessage:n,threadedReplies:e}))})}))},e)}},{key:"getThreadedMessagesByTimestamp",value:function(e,n,t){return this._getThreadedMessageList(e,oe.TIMESTAMP,n,t)}},{key:"applyThreadInfoUpdateEvent",value:function(e){var n=B.get(this._iid),t=n.ThreadInfo,r=n.ThreadInfoUpdateEvent,i=ye.get(this),r=T(V.parse(arguments,[new V({type:r,constraint:function(e){return parseInt(e.targetMessageId)===parseInt(i)}})]),2),n=r[0];if(e=r[1],n)return!1;e=e.threadInfo;return this.threadInfo=new t(e),!0}}],[{key:"MESSAGE_TYPE_BASE",get:function(){return"base"}},{key:"MESSAGE_TYPE_ADMIN",get:function(){return"admin"}},{key:"MESSAGE_TYPE_USER",get:function(){return"user"}},{key:"MESSAGE_TYPE_FILE",get:function(){return"file"}},{key:"SendingStatus",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",CANCELED:"canceled",SUCCEEDED:"succeeded"}}},{key:"getMessage",value:function(i,e){var a=this,n=B.get(this._iid),s=n.BaseChannel,n=n.MessageRetrievalParams,n=T(V.parse(arguments,[new V({type:n,constraint:function(e){return e._validate()}}),new V({type:"callback"})]),3),o=n[0];return i=n[1],e=n[2],ae(this._iid,function(r){if(o)r(o,null);else{var e=B.get(a._iid),n=e.GroupChannel,t=e.OpenChannel;switch(i.channelType){case s.CHANNEL_TYPE_GROUP:n.getChannel(i.channelUrl,ue.INTERNAL_CALL,function(t,e){var n;Zn.getInstance(a._iid).getErrorFirstCallback()&&(e=(n=[t,e])[0],t=n[1]),e?r(e,null):ce.get(a._iid).container.apiClient.getMessage(g({channel:t},i),function(e,n){e?r(e,null):(n=s.buildMessage(n,t),r(null,n))})});break;case s.CHANNEL_TYPE_OPEN:t.getChannel(i.channelUrl,ue.INTERNAL_CALL,function(t,e){var n;Zn.getInstance(a._iid).getErrorFirstCallback()&&(e=(n=[t,e])[0],t=n[1]),e?r(e,null):ce.get(a._iid).container.apiClient.getMessage(g({channel:t},i),function(e,n){e?r(e,null):(n=s.buildMessage(n,t),r(null,n))})})}}},e)}}]),n}(),_e=function(){function t(e){c(this,t),this.nickname="",this.plainProfileUrl="",this.userId="",this.connectionStatus="",this.lastSeenAt=null,this.metaData={},this.isActive=!0,this.friendDiscoveryKey=null,this.friendName=null,this._preferredLanguages=null,this.requireAuth=null,e&&this.__update(e)}return o(t,[{key:"preferredLanguages",get:function(){return this._preferredLanguages}},{key:"__update",value:function(e){var n=ce.get(this._iid).container.auth;e.hasOwnProperty("guest_id")&&(this.userId=String(e.guest_id)),e.hasOwnProperty("user_id")&&(this.userId=String(e.user_id)),e.hasOwnProperty("name")&&(this.nickname=String(e.name)),e.hasOwnProperty("nickname")&&(this.nickname=String(e.nickname)),e.hasOwnProperty("require_auth_for_profile_image")?this.requireAuth=e.require_auth_for_profile_image:this.requireAuth=null,(e.hasOwnProperty("image")||e.hasOwnProperty("profile_url"))&&(this.plainProfileUrl=String(e.image||e.profile_url||""),Object.defineProperty(this,"profileUrl",{value:this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(n.eKey):this.plainProfileUrl,configurable:!0,writable:!1})),!e.hasOwnProperty("is_online")||e.is_online===t.NON_AVAILABLE?this.connectionStatus=t.NON_AVAILABLE:this.connectionStatus=e.is_online?t.ONLINE:t.OFFLINE,e.hasOwnProperty("last_seen_at")?this.lastSeenAt=parseInt(e.last_seen_at):this.lastSeenAt=0,e.hasOwnProperty("metadata")?this.metaData=e.metadata:this.metaData={},e.hasOwnProperty("is_active")?this.isActive=void 0===e.is_active||e.is_active:this.isActive=!0,e.hasOwnProperty("friend_discovery_key")?this.friendDiscoveryKey=e.friend_discovery_key:this.friendDiscoveryKey=null,e.hasOwnProperty("friend_name")?this.friendName=e.friend_name:this.friendName=null,e.hasOwnProperty("preferred_languages")?this._preferredLanguages=e.preferred_languages||null:this._preferredLanguages=null}},{key:"_updateMetaData",value:function(e){var n,t,r,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=B.get(this._iid).GroupChannel;for(n in e)i?delete this.metaData[n]:this.metaData[n]=e[n];for(t in a.cachedChannels)!a.cachedChannels.hasOwnProperty(t)||(r=a.cachedChannels[t]).memberMap.hasOwnProperty(this.userId)&&(r.memberMap[this.userId].metaData=this.metaData)}},{key:"serialize",value:function(){return se.serialize(this,function(e){e.hasOwnProperty("_preferredLanguages")&&(e.preferredLanguages=e._preferredLanguages,delete e._preferredLanguages)})}},{key:"getOriginalProfileUrl",value:function(){var e="",e=-1<this.plainProfileUrl.indexOf("://")?this.plainProfileUrl.split("/")[2]:this.plainProfileUrl.split("/")[0];if(e=e.split("?")[0],(-1<e.indexOf("sendbird.com")||-1<e.indexOf("intoz.com")||-1<e.indexOf("file-local"))&&-1<this.plainProfileUrl.indexOf(e+"/profile_images/")){e=this.plainProfileUrl.replace("profile_images/","");return e===this.plainProfileUrl?"":e}return""}},{key:"createMetaData",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"object",constraint:function(e){return 0<Object.keys(e).length&&!Array.isArray(e)}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.createUserMetaData({metaData:e},function(e,n){e||r._updateMetaData(n),t(e,n)})},n)}},{key:"updateMetaData",value:function(e,n,t){var r=this,i=T(V.parse(arguments,[new V({type:"object",constraint:function(n){return!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),4),a=i[0];return e=i[1],n=i[2],t=i[3],ae(this._iid,function(t){a?t(a,null):ce.get(r._iid).container.apiClient.updateUserMetaData({metaData:e,upsert:n},function(e,n){e||r._updateMetaData(n),t(e,n)})},t)}},{key:"deleteMetaData",value:function(e,n){var i=this,t=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"callback"})]),3),a=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){var r;a?t(a,null):((r={})[e]="",ce.get(i._iid).container.apiClient.deleteUserMetaData({metaDataKey:e},function(e,n){e||i._updateMetaData(r,!0),t(e,n)}))},n)}},{key:"deleteAllMetaData",value:function(e){var i=this;return ae(this._iid,function(t){var r=i.metaData;ce.get(i._iid).container.apiClient.deleteAllUserMetaData({},function(e,n){e||i._updateMetaData(r,!0),t(e,n)})},e)}}],[{key:"objectify",value:function(e){var n=e.userId,t=void 0===n?null:n,r=e.nickname,i=void 0===r?"":r,a=e.plainProfileUrl,s=void 0===a?"":a,o=e.connectionStatus,l=void 0===o?"":o,u=e.lastSeenAt,c=void 0===u?0:u,n=e.metaData,r=void 0===n?{}:n,a=e.isActive,o=void 0===a||a,u=e.friendDiscoveryKey,n=void 0===u?null:u,a=e.friendName,u=void 0===a?null:a,a=e.preferredLanguages,a=void 0===a?null:a,e=e.requireAuth;return{user_id:t,nickname:i,profile_url:s,is_online:l,last_seen_at:c,metadata:r,is_active:o,friend_discovery_key:n,friend_name:u,preferred_languages:a,require_auth_for_profile_image:void 0!==e&&e}}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c){return this.objectify({userId:e,nickname:n,plainProfileUrl:t,connectionStatus:r,lastSeenAt:i,metaData:a,isActive:s,friendDiscoveryKey:o,friendName:l,preferredLanguages:u,requireAuth:c})}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid).User,e=se.deserialize(e);return new n(n.objectify(e))}},{key:"NON_AVAILABLE",get:function(){return"nonavailable"}},{key:"ONLINE",get:function(){return"online"}},{key:"OFFLINE",get:function(){return"offline"}}]),t}(),me={TIMESTAMP:"timestamp",MESSAGE_ID:"messageId"},ve=function(){function R(e){c(this,R),this.url="",this.channelType=R.CHANNEL_TYPE_BASE,this.name="",this.coverUrl="",this.creator=null,this.createdAt=0,this.data=null,this.customType=null,this.isFrozen=!1,this.isEphemeral=!1,e&&(this.__update(e),e.__wk&&(this.__wk=e.__wk))}return o(R,[{key:"__update",value:function(e){this.url=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.name=e.hasOwnProperty("name")?String(e.name):"",this.coverUrl=e.hasOwnProperty("cover_url")?String(e.cover_url):"",this.createdAt=e.hasOwnProperty("created_at")?1e3*e.created_at:0,this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?e.custom_type:"",this.isFrozen=!!e.hasOwnProperty("freeze")&&e.freeze,this.isEphemeral=!!e.hasOwnProperty("is_ephemeral")&&e.is_ephemeral,e.hasOwnProperty("created_by")&&null!==e.created_by&&"object"===le(e.created_by)&&0<Object.keys(e.created_by).length?this.creator=new _e(e.created_by):this.creator=null}},{key:"isGroupChannel",value:function(){var e=B.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){var e=B.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"createOperatorListQuery",value:function(){return new(B.get(this._iid).OperatorListQuery)(this)}},{key:"createMessageListQuery",value:function(){return new(B.get(this._iid).MessageListQuery)(this)}},{key:"createPreviousMessageListQuery",value:function(){return new(B.get(this._iid).PreviousMessageListQuery)(this)}},{key:"serialize",value:function(){return se.serialize(this,function(e){var n;null===e.lastMessage||"object"!==le(e.lastMessage)||(n=e.lastMessage).hasOwnProperty("_sender")&&(n.sender=n._sender,delete n._sender,e.lastMessage=n),e.hasOwnProperty("_messageOffsetTimestamp")&&(e.messageOffsetTimestamp=e._messageOffsetTimestamp,delete e._messageOffsetTimestamp)})}},{key:"getMessageChangeLogsByTimestamp",value:function(e,n,t,r){var a=this,i=T(V.parse(arguments,[new V({type:"number",constraint:function(e){return 0<=e}}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),5),s=i[0];return e=i[1],n=i[2],t=i[3],r=i[4],ae(this._iid,function(i){s?i(s,null):ce.get(a._iid).container.apiClient.getMessageChangeLogs({channelUrl:a.url,ts:e,token:null,isOpenChannel:a.isOpenChannel(),includeMetaArray:n,includeReactions:t},function(e,n){var t,r=null;e||(t=B.get(a._iid).BaseChannel,r={updatedMessages:n.updated.map(function(e){return t.buildMessage(e,a)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}),i(e,r)})},r)}},{key:"getMessageChangeLogsByToken",value:function(e,n,t,r){var a=this,i=T(V.parse(arguments,[new V({type:"string",nullable:!0}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),5),s=i[0];return e=i[1],n=i[2],t=i[3],r=i[4],ae(this._iid,function(i){s?i(s,null):ce.get(a._iid).container.apiClient.getMessageChangeLogs({channelUrl:a.url,ts:null,token:e,isOpenChannel:a.isOpenChannel(),includeMetaArray:n,includeReactions:t},function(e,n){var t,r=null;e||(t=B.get(a._iid).BaseChannel,r={updatedMessages:n.updated.map(function(e){return t.buildMessage(e,a)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}),i(e,r)})},r)}},{key:"getMessageChangeLogsSinceToken",value:function(e,n,t){var i=this,r=B.get(this._iid),a=r.BaseChannel,r=r.MessageChangeLogsParams,r=T(V.parse(arguments,[new V({type:"string",nullable:!0}),new V({type:r}),new V({type:"callback"})]),4),s=r[0];return e=r[1],n=r[2],t=r[3],ae(this._iid,function(r){s?r(s,null):ce.get(i._iid).container.apiClient.getMessageChangeLogs(g({channelUrl:i.url,ts:null,token:e,isOpenChannel:i.isOpenChannel()},n),function(e,n){var t=null;e||(t={updatedMessages:n.updated.map(function(e){return a.buildMessage(e,i)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}),r(e,t)})},t)}},{key:"getMessageChangeLogsSinceTimestamp",value:function(e,n,t){var i=this,r=B.get(this._iid),a=r.BaseChannel,r=r.MessageChangeLogsParams,r=T(V.parse(arguments,[new V({type:"number",constraint:function(e){return 0<=e}}),new V({type:r}),new V({type:"callback"})]),4),s=r[0];return e=r[1],n=r[2],t=r[3],ae(this._iid,function(r){s?r(s,null):ce.get(i._iid).container.apiClient.getMessageChangeLogs(g({channelUrl:i.url,timestamp:e,token:null,isOpenChannel:i.isOpenChannel()},n),function(e,n){var t=null;e||(t={updatedMessages:n.updated.map(function(e){return a.buildMessage(e,i)}),deletedMessageIds:n.deleted.map(function(e){return parseInt(e.message_id)}),hasMore:n.has_more,token:n.next}),r(e,t)})},t)}},{key:"getMyMutedInfo",value:function(e){var n=this;return ae(this._iid,function(r){var e=Zn.getInstance(n._iid);ce.get(n._iid).container.apiClient.getMyMutedInfo({channelUrl:n.url,userId:e.currentUser?e.currentUser.userId:null,isGroupChannel:n.isGroupChannel()},function(e,n){var t=null;e||(t={isMuted:n.is_muted,startAt:n.start_at,endAt:n.end_at,remainingDuration:n.remaining_duration,description:n.description}),r(e,t)})},e)}},{key:"_parseMessageListParams",value:function(e){for(var n=new(B.get(this._iid).MessageListParams),t=null,r=!1,i=0,a=0,s=!1,o="",l="",u=null,c=!1,d=!1,h=null,p=arguments.length,g=new Array(1<p?p-1:0),y=1;y<p;y++)g[y-1]=arguments[y];switch(e){case"prev":var f=T(V.parse(g,[new V({type:"number"}),new V({type:"boolean"}),new V({type:"number"}),new V({type:"boolean"}),new V({type:"string"}),new V({type:"string"}),new V({type:"array",optional:!0}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),11),t=f[0],r=(f[1],f[2]),i=f[3],s=f[4],o=f[5],l=f[6],u=f[7],c=f[8],d=f[9],h=f[10];break;case"next":var _=T(V.parse(g,[new V({type:"number"}),new V({type:"boolean"}),new V({type:"number"}),new V({type:"boolean"}),new V({type:"string"}),new V({type:"string"}),new V({type:"array",optional:!0}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),11);t=_[0],_[1],r=_[2],a=_[3],s=_[4],o=_[5],l=_[6],u=_[7],c=_[8],d=_[9],h=_[10];break;case"prevnext":_=T(V.parse(g,[new V({type:"number"}),new V({type:"number"}),new V({type:"number"}),new V({type:"boolean"}),new V({type:"string"}),new V({type:"string"}),new V({type:"array",optional:!0}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),11);t=_[0],_[1],i=_[2],a=_[3],s=_[4],o=_[5],l=_[6],u=_[7],c=_[8],d=_[9],h=_[10],r=!0}return t?[null,h]:(n.isInclusive=r,n.prevResultSize=i,n.nextResultSize=a,n.reverse=s,n.messageType=o,n.customType=l,n.senderUserIds=u,n.includeMetaArray=c,n.includeReactions=d,[n,h])}},{key:"_getMessageList",value:function(e,n,t,r){var i=this,a=B.get(this._iid).MessageListParams,a=T(V.parse(arguments,[new V({type:"number"}),new V({type:"string",constraint:function(e){return Object.values(me).includes(e)}}),new V({type:a,constraint:function(e){return e._validate()}}),new V({type:"callback"})]),5),s=a[0];return e=a[1],n=a[2],t=a[3],r=a[4],ae(this._iid,function(r){s?r(s,null):ce.get(i._iid).container.apiClient.getMessageList(g(g({channel:i,token:e,tokenType:n},t),{},{shouldReverse:t.reverse}),function(e,n){var t;e?r(e,null):(t=B.get(i._iid).BaseChannel,n=n.messages.map(function(e){return t.buildMessage(e,i)}).filter(function(e){return null!==e}),r(null,n))})},r)}},{key:"getPreviousMessagesByTimestamp",value:function(e){var n=T(this._parseMessageListParams.apply(this,["prev"].concat(C(V.toArray(arguments)))),2),t=n[0],n=n[1];return this._getMessageList(e,me.TIMESTAMP,t,n)}},{key:"getNextMessagesByTimestamp",value:function(e){var n=T(this._parseMessageListParams.apply(this,["next"].concat(C(V.toArray(arguments)))),2),t=n[0],n=n[1];return this._getMessageList(e,me.TIMESTAMP,t,n)}},{key:"getPreviousAndNextMessagesByTimestamp",value:function(e){var n=T(this._parseMessageListParams.apply(this,["prevnext"].concat(C(V.toArray(arguments)))),2),t=n[0],n=n[1];return this._getMessageList(e,me.TIMESTAMP,t,n)}},{key:"getPreviousMessagesByID",value:function(e){var n=T(this._parseMessageListParams.apply(this,["prev"].concat(C(V.toArray(arguments)))),2),t=n[0],n=n[1];return this._getMessageList(e,me.MESSAGE_ID,t,n)}},{key:"getNextMessagesByID",value:function(e){var n=T(this._parseMessageListParams.apply(this,["next"].concat(C(V.toArray(arguments)))),2),t=n[0],n=n[1];return this._getMessageList(e,me.MESSAGE_ID,t,n)}},{key:"getPreviousAndNextMessagesByID",value:function(e){var n=T(this._parseMessageListParams.apply(this,["prevnext"].concat(C(V.toArray(arguments)))),2),t=n[0],n=n[1];return this._getMessageList(e,me.MESSAGE_ID,t,n)}},{key:"getMessagesByTimestamp",value:function(e,n,t){return this._getMessageList(e,me.TIMESTAMP,n,t)}},{key:"getMessagesByMessageId",value:function(e,n,t){return this._getMessageList(e,me.MESSAGE_ID,n,t)}},{key:"_sendUserMessage",value:function(e){var a=this,n=e.reqId,t=e.message,r=e.data,i=e.customType,s=e.metaArrays,o=e.mentionType,l=e.mentionedUserIds,u=e.pushNotificationDeliveryOption,c=e.rootMessageId,d=e.parentMessageId,h=e.translationTargetLanguages,p=e.silent,g=void 0!==p&&p,y=e.callback,f=B.get(this._iid),_=f.Command,m=f.UserMessage,n=n||_.generateRequestId(),v=Zn.getInstance(this._iid),E={};Array.isArray(h)&&h.forEach(function(e){return E[e]=""});var C=m.objectify({messageId:0,reqId:n,user:v.currentUser||{},channel:this,message:t,data:r,customType:i,metaArrays:s,mentionType:o,mentionedUserIds:l,rootMessageId:c,parentMessageId:d,translations:E,silent:g,createdAt:(new Date).getTime()}),p=new m(C);if(p.requestState=v.MessageRequestState.PENDING,p.sendingStatus=v.MessageSendingStatus.PENDING,p.requestedMentionUserIds=l,!v.currentUser){e=new de("Connection should be made first.",de.CONNECTION_REQUIRED),f=new m(C);return f.requestState=v.MessageRequestState.FAILED,f.sendingStatus=v.MessageSendingStatus.FAILED,f.requestedMentionUserIds=l,f.errorCode=e.code,y(e,f),p}var U=_.bMessage({channelUrl:this.url,message:t,data:r,customType:i,metaArrays:s,mentionType:o,mentionedUserIds:l,requestId:n,rootMessageId:c,parentMessageId:d,silent:g,translationTargetLanguages:h,pushNotificationDeliveryOption:u});return p.reqId=U.requestId,this.isGroupChannel()&&v.getConnectionState()!==v.ConnectionState.OPEN&&v.currentUser&&!v.connecting&&!v.reconnecting&&"string"==typeof i&&0===i.indexOf("SB_VIDEOCHAT")?ce.get(v._iid).container.apiClient.sendUserMessage({channelUrl:this.url,isOpenChannel:this.isOpenChannel(),message:t,data:r,customType:i,translationTargetLanguages:h,metaArrays:s,mentionType:o,mentionedUserIds:l,pushNotificationDeliveryOption:u,rootMessageId:c,parentMessageId:d},function(e,n){var t=null;e?((t=new m(C)).requestState=v.MessageRequestState.FAILED,t.sendingStatus=v.MessageSendingStatus.FAILED,e.code===de.REQUEST_CANCELED&&(t.sendingStatus=v.MessageSendingStatus.CANCELED),t.requestedMentionUserIds=l,t.errorCode=e.code):((t=new m(n)).requestState=v.MessageRequestState.SUCCEEDED,t.sendingStatus=v.MessageSendingStatus.SUCCEEDED),y(e,t)}):v.sendCommand(U,function(e,n){var t;if(v.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n){var r=new m(C);r.reqId=U.requestId,r.requestState=v.MessageRequestState.FAILED,r.sendingStatus=v.MessageSendingStatus.FAILED,n.code===de.REQUEST_CANCELED&&(r.sendingStatus=v.MessageSendingStatus.CANCELED),r.requestedMentionUserIds=l,r.errorCode=n.code,y(new de(n.message,n.code),r)}else{r=new m(e.getJsonElement()),e=v.currentUser;if(e&&r._sender&&e.userId===r._sender.userId&&(e.nickname!==r._sender.nickname&&(e.nickname=r._sender.nickname),e.plainProfileUrl!==r._sender.plainProfileUrl&&(e.plainProfileUrl=r._sender.plainProfileUrl),pe.deepEqual(e.metaData,r._sender.metaData)||(e.metaData=r._sender.metaData)),a.isGroupChannel())for(var i in a.lastMessage=r,v.channelHandlers)v.channelHandlers[i].onChannelChanged(a);r.requestState=v.MessageRequestState.SUCCEEDED,r.sendingStatus=v.MessageSendingStatus.SUCCEEDED,y(null,r)}}),p}},{key:"sendUserMessage",value:function(){var e=V.toArray(arguments),t=e.pop(),n=null,r=null,i=B.get(this._iid).UserMessageParams;if("function"==typeof t)if(e[0]instanceof i)null===(r=e[0]).data&&(r.data=""),null===r.customType&&(r.customType="");else if("string"==typeof e[0])switch((r=new i).message=e[0],e.length){case 1:break;case 2:r.data=e[1]||"";break;case 3:r.data=e[1]||"",r.customType=e[2]||"";break;case 4:r.data=e[1]||"",r.customType=e[2]||"",r.translationTargetLanguages=Array.isArray(e[3])?e[3]:[e[3]];break;default:n=V.error}else n=V.error;else n=V.error;var a=ce.get(this._iid).container.isErrorFirstInCallback;return!n&&r._validate()&&r.message?this._sendUserMessage(g(g({},r),{},{metaArrays:r.metaArrays,mentionType:r.mentionType,mentionedUserIds:r._mentionedUserIds,rootMessageId:r.rootMessageId,parentMessageId:r.parentMessageId,translationTargetLanguages:r._translationTargetLanguages,callback:function(e,n){a?t(e,n):t(n,e)}})):(a?t(V.error,null):t(null,V.error),null)}},{key:"resendUserMessage",value:function(r,e){var i=this,n=B.get(this._iid),t=n.UserMessage,a=n.UserMessageParams,s=null,t=T(V.parse(arguments,[new V({type:t,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===i.url&&"string"==typeof e.message&&"string"==typeof e.data&&"string"==typeof e.customType&&"object"===le(e.translations)&&!Array.isArray(e.translations)}}),new V({type:"callback"})]),3),s=t[0];return r=t[1],e=t[2],ae(this._iid,function(e){var n,t;s?(s.message+=" Please check if the failed message is resend-able with `message.isResendable().`",e(s,null)):(n=Object.keys(r.translations),t=a.PushNotificationDeliveryOption.DEFAULT,i._sendUserMessage(g(g({},r),{},{mentionedUserIds:r.requestedMentionUserIds,translationTargetLanguages:n,pushNotificationDeliveryOption:t,reqId:r.reqId,callback:e})))},e)}},{key:"updateUserMessage",value:function(n,e,t,r,i){var a=this,s=B.get(this._iid),o=s.Command,l=s.UserMessage,u=s.UserMessageParams,c=arguments,d=null,h=null;if("number"==typeof n)switch(c.length){case 3:var p=T(V.parse(c,[new V({type:"number"}),new V({type:u}),new V({type:"callback"})]),4),d=p[0];n=p[1],h=p[2],i=p[3];break;case 5:h=new u,p=T(V.parse(c,[new V({type:"number"}),new V({type:"string",nullable:!0}),new V({type:"string",nullable:!0}),new V({type:"string",nullable:!0}),new V({type:"callback"})]),6);d=p[0],n=p[1],e=p[2],t=p[3],r=p[4],i=p[5],h.message=e,h.data=t,h.customType=r}return ae(this._iid,function(r){var e,i;!d&&h&&h._validate()?(e=o.bUpdateUserMessage(g(g({channelUrl:a.url,messageId:n},h),{},{mentionType:h._mentionType,mentionedUserIds:h._mentionedUserIds})),(i=Zn.getInstance(a._iid)).sendCommand(e,function(e,n){i.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]);var t=null;n||(t=new l(e.getJsonElement())),r(n,t)})):r(V.error,null)},i)}},{key:"translateUserMessage",value:function(e,n,t){var i=this,r=Zn.getInstance(this._iid),a=B.get(this._iid).UserMessage,s=T(V.parse(arguments,[new V({type:a,constraint:function(e){return e.channelUrl===i.url&&e.sendingStatus===r.MessageSendingStatus.SUCCEEDED}}),new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),4),o=s[0];return e=s[1],n=s[2],t=s[3],ae(this._iid,function(r){o?r(o,null):ce.get(i._iid).container.apiClient.translateUserMessage({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),messageId:e.messageId,translationTargetLanguages:n},function(e,n){var t=null;e||(t=new a(n)),r(e,t)})},t)}},{key:"_parseFileMessageArguments",value:function(e){var n=B.get(this._iid),t=n.BaseMessageParams,n=n.FileMessageParams,r={error:null,file:null,name:null,type:null,size:null,data:"",customType:"",thumbnailSizes:[],metaArrays:[],mentionType:t.MentionType.USERS,mentionedUserIds:[],pushNotificationDeliveryOption:n.PushNotificationDeliveryOption.DEFAULT,rootMessageId:null,parentMessageId:null,progressHandler:null,silent:!1,callback:null};if("function"==typeof e[e.length-1]&&(r.callback=e.pop()),"function"==typeof e[e.length-1]&&(r.progressHandler=e.pop()),e[0]instanceof n)r.file=e[0].file||e[0].fileUrl,r.name=e[0].fileName,r.type=e[0].mimeType,r.size=e[0].fileSize,r.data=e[0].data,r.customType=e[0].customType,r.thumbnailSizes=e[0].thumbnailSizes,r.metaArrays=e[0].metaArrays,r.mentionType=e[0]._mentionType,r.mentionedUserIds=e[0]._mentionedUserIds,r.pushNotificationDeliveryOption=e[0].pushNotificationDeliveryOption||n.PushNotificationDeliveryOption.DEFAULT,r.rootMessageId=e[0].rootMessageId,r.parentMessageId=e[0].parentMessageId,r.silent=e[0].silent,e[0]._validate()||(r.error=V.error);else if(pe.isFile(e[0])||"string"==typeof e[0]){switch(r.file=e[0],e.length){case 1:break;case 2:r.data=e[1];break;case 3:r.data=e[1],r.customType=e[2];break;case 4:r.data=e[1],r.customType=e[2],r.thumbnailSizes=e[3];break;case 5:r.name=e[1],r.type=e[2],r.size=e[3],r.data=e[4];break;case 6:r.name=e[1],r.type=e[2],r.size=e[3],r.data=e[4],r.customType=e[5];break;case 7:r.name=e[1],r.type=e[2],r.size=e[3],r.data=e[4],r.customType=e[5],r.thumbnailSizes=e[6]}n=T(V.parse([r.file,r.name,r.type,r.size,r.data,r.customType,r.thumbnailSizes],[new V({type:["file","string"]}),new V({type:"string",nullable:!0}),new V({type:"string",nullable:!0}),new V({type:"number",nullable:!0,constraint:function(e){return 0<=e}}),new V({type:"string",nullable:!0}),new V({type:"string",nullable:!0}),new V({type:"array"})]),8);r.error=n[0],r.file=n[1],r.name=n[2],r.type=n[3],r.size=n[4],r.data=n[5],r.customType=n[6],r.thumbnailSizes=n[7]}else r.error=V.error;return pe.isFile(r.file)&&(r.name=r.name||r.file.name,r.type=r.type||r.file.type,r.size=r.size||r.file.size),r}},{key:"_createTempFileMessage",value:function(e){try{var n=Zn.getInstance(this._iid),t=B.get(this._iid),r=t.Command,t=t.FileMessage,n=t.objectify(g(g({},e),{},{messageId:0,reqId:r.generateRequestId(),user:n.currentUser||{},channel:this,plainUrl:"string"==typeof e.file?e.file:"",thumbnails:e.thumbnailSizes.map(function(e){return{url:"",plainUrl:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}}),sendingStatus:n.MessageSendingStatus.PENDING,createdAt:(new Date).getTime()}));return new t(n)}catch(e){return null}}},{key:"sendFileMessage",value:function(){var e=this._parseFileMessageArguments(V.toArray(arguments)),n=null,t=B.get(this._iid).Command.generateRequestId();e.error||((n=this._createTempFileMessage(e)).requestedMentionUserIds=e.mentionedUserIds,t=n.reqId);var r=Zn.getInstance(this._iid);r&&r.currentUser||(e.error=new de("Connection should be made first.",de.CONNECTION_REQUIRED));r=B.get(this._iid).FileMessageQueue;return r.create(this).addJob(new r.Job({fileInfo:e,pendingMessage:n,requestId:t,error:e.error,response:null})),n}},{key:"sendFileMessages",value:function(r){var n=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=e.progress||function(){},a=e.sent||function(){},s=e.complete||function(){};if(Array.isArray(r)&&0<r.length&&r.length<=20){var o=[];return r.forEach(function(e,t){o.push(n.sendFileMessage(e,i,function(e,n){a(e,n),t===r.length-1&&s(null)}))}),o}return s(V.error),null}},{key:"resendFileMessage",value:function(t,r,e){var i=this,n=B.get(this._iid),a=n.FileMessage,s=n.FileMessageParams,o=null,a=T(V.parse(arguments,[new V({type:a,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===i.url&&"string"==typeof e.data&&"string"==typeof e.customType&&Array.isArray(e.thumbnails)}}),new V({type:"file",optionalIf:function(e){return!!e[0].url},defaultValue:null}),new V({type:"callback"})]),4),o=a[0];return t=a[1],r=a[2],e=a[3],ae(this._iid,function(e){var n;o?(o.message+=" Please check if the failed message is resend-able with `message.isResendable().`",e(o,null)):(n=new s,t.url?n.fileUrl=t.url:n.file=r,n.fileName=t.name,n.fileSize=t.size,n.mimeType=t.type,n.data=t.data,n.customType=t.customType,n.mentionType=t.mentionType,n.mentionedUserIds=t.requestedMentionUserIds,n.metaArrays=t.metaArrays,n.thumbnailSizes=t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),i.sendFileMessage(n,e))},e)}},{key:"updateFileMessage",value:function(n,e,t,r){var a=this,i=B.get(this._iid),s=i.Command,o=i.FileMessage,l=i.FileMessageParams,u=arguments,c=null,d=null;if("number"==typeof n)switch(u.length){case 3:var h=T(V.parse(u,[new V({type:"number"}),new V({type:l}),new V({type:"callback"})]),4),c=h[0];n=h[1],d=h[2],r=h[3],d&&(d._isUpdate=!0);break;case 4:d=new l,h=T(V.parse(u,[new V({type:"number"}),new V({type:"string",nullable:!0}),new V({type:"string",nullable:!0}),new V({type:"callback"})]),5);c=h[0],n=h[1],e=h[2],t=h[3],r=h[4],d.data=e,d.customType=t,d._isUpdate=!0}return ae(this._iid,function(r){var e,i;!c&&d&&d._validate()?(e=s.bUpdateFileMessage(g(g({channelUrl:a.url,messageId:n},d),{},{mentionType:d._mentionType,mentionedUserIds:d._mentionedUserIds})),(i=Zn.getInstance(a._iid)).sendCommand(e,function(e,n){i.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]);var t=null;n||(t=new o(e.getJsonElement())),r(n,t)})):r(V.error,null)},r)}},{key:"cancelUploadingFileMessage",value:function(e,t){var n=T(V.parse(arguments,[new V({type:["number","string"]}),new V({type:"callback"})]),3),r=n[0];e=n[1],t=n[2];var i=ce.get(this._iid).container.isErrorFirstInCallback;return r?(i?t(r,null):t(null,r),!1):B.get(this._iid).FileMessageQueue.create(this).cancelUploadItemByRequestId(e,function(e,n){return i?t(e,n):t(n,e)})}},{key:"addReaction",value:function(i,e,n){var t=this,a=Zn.getInstance(this._iid),s=B.get(this._iid).ReactionEvent,r=T(V.parse(arguments,[new V({type:fe}),new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"callback"})]),4),o=r[0];return i=r[1],e=r[2],n=r[3],ae(this._iid,function(r){o?r(o,null):i.sendingStatus===a.MessageSendingStatus.SUCCEEDED?ce.get(t._iid).container.apiClient.addReaction({isGroupChannel:i.isGroupChannel(),channelUrl:i.channelUrl,messageId:i.messageId,key:e},function(e,n){var t=null;e||(t=s.createFromJson(g(g({},n),{},{msg_id:i.messageId}))),r(e,t)}):r(new de("Cannot add reaction to a non-succeeded message.",de.REQUEST_FAILED),null)},n)}},{key:"deleteReaction",value:function(i,e,n){var t=this,a=Zn.getInstance(this._iid),s=B.get(this._iid).ReactionEvent,r=T(V.parse(arguments,[new V({type:fe}),new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"callback"})]),4),o=r[0];return i=r[1],e=r[2],n=r[3],ae(this._iid,function(r){o?r(o,null):i.sendingStatus===a.MessageSendingStatus.SUCCEEDED?ce.get(t._iid).container.apiClient.deleteReaction({isGroupChannel:i.isGroupChannel(),channelUrl:i.channelUrl,messageId:i.messageId,key:e},function(e,n){var t=null;e||(t=s.createFromJson(g(g({},n),{},{msg_id:i.messageId}))),r(e,t)}):r(new de("Cannot remove reaction to a non-succeeded message.",de.REQUEST_FAILED),null)},n)}},{key:"deleteMessage",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"object",constraint:function(e){return!Array.isArray(e)&&null!==e&&e.hasOwnProperty("messageId")}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.deleteMessage({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),messageId:e.messageId},function(e,n){return t(e,null)})},n)}},{key:"copyUserMessage",value:function(e,n,t){var r=B.get(this._iid),i=(r.Command,r.UserMessage),a=r.BaseMessageParams,i=T(V.parse(arguments,[new V({type:R}),new V({type:i}),new V({type:"callback"})]),4),r=i[0];e=i[1],n=i[2],t=i[3];i=ce.get(this._iid).container.isErrorFirstInCallback;if(r)return i?t(V.error,null):t(null,V.error),null;if(this.url!==n.channelUrl){var s=new de("The message does not belong to this channel",de.INVALID_PARAMETER);return i?t(s,null):t(null,s),null}var o={},s=Object.keys(n.translations);s.forEach(function(e){return o[e]=""});a=a.PushNotificationDeliveryOption.DEFAULT;return e._sendUserMessage(g(g({},n),{},{reqId:null,pushNotificationDeliveryOption:a,translationTargetLanguages:s,rootMessageId:null,parentMessageId:null,parentMessageText:null,callback:t}))}},{key:"copyFileMessage",value:function(i,e,a){var n=B.get(this._iid),t=n.Command,s=(n.GroupChannel,n.FileMessage),r=n.BaseMessageParams,o=(n.FileMessageParams,n.User),l=T(V.parse(arguments,[new V({type:R}),new V({type:s}),new V({type:"callback"})]),4),u=l[0];i=l[1],e=l[2],a=l[3];var c=ce.get(this._iid),d=c.container.isErrorFirstInCallback;if(u)return d?a(V.error,null):a(null,V.error),null;if(this.url!==e.channelUrl){var h=new de("The message does not belong to this channel");return d?a(h,null):a(null,h),null}var p=Zn.getInstance(this._iid),g=e.url,y=e.name,f=e.type,_=e.size,m=e.data,v=e.customType,E=e.mentionType,C=e.mentionedUserIds,U=e.mentionedUsers,b=e.metaArrays,A=e.thumbnails,S=e.requireAuth,I=e.messageSurvivalSeconds,n=e.silent,l=t.generateRequestId(),N=p.currentUser||{},u=i.url,h=i.isOpenChannel(),e=U.filter(function(e){return new o(o.objectify(e))}),U=r.PushNotificationDeliveryOption.DEFAULT,k=s.objectify({messageId:0,reqId:l,user:N,channel:i,plainUrl:g,name:y,type:f,size:_,data:m,customType:v,mentionType:E,mentionedUserIds:C,mentionedUsers:e,requestedMentionUserIds:C,metaArrays:b,thumbnails:A,requireAuth:S,messageSurvivalSeconds:I,silent:n,createdAt:(new Date).getTime()}),r=new s(k);if(r.requestState=p.MessageRequestState.PENDING,r.sendingStatus=p.MessageSendingStatus.PENDING,!p.currentUser){e=new de("Connection should be made first.",de.CONNECTION_REQUIRED),I=new s(k);return I.requestState=p.MessageRequestState.FAILED,I.sendingStatus=p.MessageSendingStatus.FAILED,I.errorCode=e.code,d?a(e,I):a(I,e),r}n=t.bFile({requestId:l,channelUrl:u,url:g,name:y,type:f,size:_,data:m,customType:v,metaArrays:b,mentionType:E,mentionedUserIds:C,thumbnailSizes:A,requireAuth:S,pushNotificationDeliveryOption:U,silent:n});return p.getConnectionState()===p.ConnectionState.OPEN||p.connecting||p.reconnecting?p.sendCommand(n,function(e,n){var t;if(p.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)n.code!==de.INVALID_PARAMETER?((t=new s(k)).requestState=p.MessageRequestState.FAILED,t.sendingStatus=p.MessageSendingStatus.FAILED,n.code!==de.FILE_UPLOAD_CANCEL_FAILED&&n.code!==SendBridException.REQUEST_CANCELED||(t.sendingStatus=p.MessageSendingStatus.CANCELED),t.errorCode=n.code,d?a(n,t):a(t,n)):d?a(n,null):a(null,n);else{n=new s(e.getJsonElement()),e=n._sender;if(N&&e&&N.userId===e.userId&&(N.nickname!==e.nickname&&(N.nickname=e.nickname),N.plainProfileUrl!==e.plainProfileUrl&&(N.plainProfileUrl=e.plainProfileUrl)),i.isGroupChannel())for(var r in i.lastMessage=n,p.channelHandlers)p.channelHandlers[r].onChannelChanged(i);d?a(null,n):a(n,null)}}):c.container.apiClient.sendFileMessage({channelUrl:u,isOpenChannel:h,fileUrl:g,fileName:y,fileType:f,fileSize:_,data:m,customType:v,metaArrays:b,mentionType:E,mentionedUserIds:C,thumbnailSizes:A,requireAuth:S,pushNotificationDeliveryOption:U},function(e,n){if(e){var t;e.code!==de.INVALID_PARAMETER?((t=new s(commnad.getJsonElement())).requestState=p.MessageRequestState.FAILED,t.sendingStatus=p.MessageSendingStatus.FAILED,e.code!==de.FILE_UPLOAD_CANCEL_FAILED&&e.code!==SendBridException.REQUEST_CANCELED||(t.sendingStatus=p.MessageSendingStatus.CANCELED),t.errorCode=e.code,d?a(e,t):a(t,e)):d?a(e,null):a(null,e)}else{e=new s(n),n=e._sender;if(N&&n&&N.userId===n.userId&&(N.nickname!==n.nickname&&(N.nickname=n.nickname),N.plainProfileUrl!==n.plainProfileUrl&&(N.plainProfileUrl=n.plainProfileUrl)),i.isGroupChannel())for(var r in i.lastMessage=e,p.channelHandlers)p.channelHandlers[r].onChannelChanged(i);d?a(null,e):a(e,null)}}),r}},{key:"addOperators",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.addOperators({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),operatorUserIds:e},function(e,n){return t(e,n)})},n)}},{key:"removeOperators",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.removeOperators({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),operatorUserIds:e},function(e,n){return t(e,n)})},n)}},{key:"getMetaCounters",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.getMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),keys:e},function(e,n){return t(e,n)})},n)}},{key:"getAllMetaCounters",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.getMetaCounters({channelUrl:n.url,isOpenChannel:n.isOpenChannel(),keys:[]},function(e,n){return t(e,n)})},e)}},{key:"createMetaCounters",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.createMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e},function(e,n){return t(e,n)})},n)}},{key:"updateMetaCounters",value:function(e,n,t){var r=this,i=T(V.parse(arguments,[new V({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),4),a=i[0];return e=i[1],n=i[2],t=i[3],ae(this._iid,function(t){a?t(a,null):ce.get(r._iid).container.apiClient.updateMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e,upsert:n,mode:"set"},function(e,n){return t(e,n)})},t)}},{key:"increaseMetaCounters",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.updateMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e,upsert:!1,mode:"increase"},function(e,n){return t(e,n)})},n)}},{key:"decreaseMetaCounters",value:function(e,n){var t=this,r=T(V.parse(arguments,[new V({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new V({type:"callback"})]),3),a=r[0];return e=r[1],n=r[2],ae(this._iid,function(i){a?i(a,null):ce.get(t._iid).container.apiClient.updateMetaCounters({channelUrl:t.url,isOpenChannel:t.isOpenChannel(),metaCounter:e,upsert:!1,mode:"decrease"},function(e,n){var t=null;if(!e)for(var r in t={},n)t[r]=n[r];i(e,t)})},n)}},{key:"deleteMetaCounter",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.deleteMetaCounter({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),key:e},function(e,n){return t(e,n)})},n)}},{key:"deleteAllMetaCounters",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.deleteAllMetaCounters({channelUrl:n.url,isOpenChannel:n.isOpenChannel()},function(e,n){return t(e,n)})},e)}},{key:"getMetaData",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.getMetaData({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),keys:e},function(e,n){return t(e,n)})},n)}},{key:"getAllMetaData",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.getMetaData({channelUrl:n.url,isOpenChannel:n.isOpenChannel(),keys:[]},function(e,n){return t(e,n)})},e)}},{key:"createMetaData",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.createMetaData({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaData:e},function(e,n){return t(e,n)})},n)}},{key:"updateMetaData",value:function(e,n,t){var r=this,i=T(V.parse(arguments,[new V({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length}}),new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"callback"})]),4),a=i[0];return e=i[1],n=i[2],t=i[3],ae(this._iid,function(t){a?t(a,null):ce.get(r._iid).container.apiClient.updateMetaData({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaData:e,upsert:n},function(e,n){return t(e,n)})},t)}},{key:"deleteMetaData",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.deleteMetaData({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),key:e},function(e,n){return t(e,n)})},n)}},{key:"deleteAllMetaData",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.deleteAllMetaData({channelUrl:n.url,isOpenChannel:n.isOpenChannel()},function(e,n){return t(e,n)})},e)}},{key:"_updateMessageMetaArray",value:function(t,l,u,e){var c=this;return ae(this._iid,function(r){var i,e=B.get(c._iid),n=e.Command,a=e.UserMessage,s=e.FileMessage,o=e.AdminMessage,e=null;l.isUserMessage()?e=n.bUpdateUserMessage({channelUrl:t,messageId:l.messageId,metaArrayParams:u}):l.isFileMessage()&&(e=n.bUpdateFileMessage({channelUrl:t,messageId:l.messageId,metaArrayParams:u})),e?(i=Zn.getInstance(c._iid)).sendCommand(e,function(e,n){i.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]);var t=null;n||(l.isUserMessage()?t=new a(e.getJsonElement()):l.isFileMessage()?t=new s(e.getJsonElement()):l.isAdminMessage()&&(t=new o(e.getJsonElement()))),r(n,t)}):r(V.error,null)},e)}},{key:"createMessageMetaArrayKeys",value:function(e,n,t){var r=B.get(this._iid).MessageMetaArray,i=T(V.parse(arguments,[new V({type:fe}),new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e&&""!==e})}}),new V({type:"callback"})]),4),a=i[0];if(e=i[1],n=i[2],t=i[3],a)return ae(this._iid,function(e){e(a,null)},t);var s=[];if(Array.isArray(n))for(var o=0;o<n.length;o++){var l=n[o];s.push(new r(l,[]))}return this._updateMessageMetaArray(this.url,e,{array:s.map(function(e){return e.encode()}),mode:"add",upsert:!0},t)}},{key:"deleteMessageMetaArrayKeys",value:function(e,n,t){var r=B.get(this._iid).MessageMetaArray,i=T(V.parse(arguments,[new V({type:fe}),new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e&&""!==e})}}),new V({type:"callback"})]),4),a=i[0];if(e=i[1],n=i[2],t=i[3],a)return ae(this._iid,function(e){e(a,null)},t);var s=[];if(Array.isArray(n))for(var o=0;o<n.length;o++){var l=n[o];s.push(new r(l,[]))}return this._updateMessageMetaArray(this.url,e,{array:s.map(function(e){return e.encode()}),mode:"remove",upsert:!0},t)}},{key:"addMessageMetaArrayValues",value:function(e,n,t){var r=B.get(this._iid).MessageMetaArray,i=T(V.parse(arguments,[new V({type:fe}),new V({type:"object",constraint:function(n){return n&&(Array.isArray(n)&&0<n.length&&n.every(function(e){return e instanceof r})||0<Object.keys(n).length&&Object.keys(n).every(function(e){return Array.isArray(n[e])&&0<n[e].length&&n[e].every(function(e){return"string"==typeof e&&0<e.length})}))}}),new V({type:"callback"})]),4),a=i[0];if(e=i[1],n=i[2],t=i[3],a)return ae(this._iid,function(e){e(a,null)},t);i=Array.isArray(n)?n.map(function(e){return e.encode()}):Object.keys(n).map(function(e){return{key:e,value:n[e]}});return this._updateMessageMetaArray(this.url,e,{array:i,mode:"add",upsert:!0},t)}},{key:"removeMessageMetaArrayValues",value:function(e,n,t){var r=B.get(this._iid).MessageMetaArray,i=T(V.parse(arguments,[new V({type:fe}),new V({type:"object",constraint:function(n){return n&&(Array.isArray(n)&&0<n.length&&n.every(function(e){return e instanceof r})||0<Object.keys(n).length&&Object.keys(n).every(function(e){return Array.isArray(n[e])&&0<n[e].length&&n[e].every(function(e){return"string"==typeof e&&0<e.length})}))}}),new V({type:"callback"})]),4),a=i[0];if(e=i[1],n=i[2],t=i[3],a)return ae(this._iid,function(e){e(a,null)},t);i=Array.isArray(n)?n.map(function(e){return e.encode()}):Object.keys(n).map(function(e){return{key:e,value:n[e]}});return this._updateMessageMetaArray(this.url,e,{array:i,mode:"remove",upsert:!0},t)}},{key:"report",value:function(n,r,e){var i=this,t=B.get(this._iid).BaseChannel,t=T(V.parse(arguments,[new V({type:t.ReportCategory}),new V({type:"string"}),new V({type:"callback"})]),4),a=t[0];return n=t[1],r=t[2],e=t[3],ae(this._iid,function(t){var e;a?t(a,null):(e=Zn.getInstance(i._iid),ce.get(i._iid).container.apiClient.report({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),reportCategory:n,reportingUserId:e.currentUser?e.currentUser.userId:null,reportDescription:r},function(e,n){t(e,null)}))},e)}},{key:"reportUser",value:function(n,r,i,e){var a=this,t=B.get(this._iid).BaseChannel,t=T(V.parse(arguments,[new V({type:_e}),new V({type:t.ReportCategory}),new V({type:"string"}),new V({type:"callback"})]),5),s=t[0];return n=t[1],r=t[2],i=t[3],e=t[4],ae(this._iid,function(t){var e;s?t(s,null):(e=Zn.getInstance(a._iid),ce.get(a._iid).container.apiClient.reportUser({channelUrl:a.url,isOpenChannel:a.isOpenChannel(),reportCategory:r,offendingUserId:n.userId,reportingUserId:e.currentUser?e.currentUser.userId:null,reportDescription:i},function(e,n){t(e,null)}))},e)}},{key:"reportMessage",value:function(n,r,i,e){var a=this,t=B.get(this._iid).BaseChannel,t=T(V.parse(arguments,[new V({type:fe}),new V({type:t.ReportCategory}),new V({type:"string"}),new V({type:"callback"})]),5),s=t[0];return n=t[1],r=t[2],i=t[3],e=t[4],ae(this._iid,function(t){var e;s?t(s,null):(e=Zn.getInstance(a._iid),ce.get(a._iid).container.apiClient.reportMessage({messageId:n.messageId,channelUrl:a.url,isOpenChannel:a.isOpenChannel(),reportCategory:r,offendingUserId:n.sender.userId,reportingUserId:e.currentUser?e.currentUser.userId:null,reportDescription:i},function(e,n){t(e,null)}))},e)}}],[{key:"CHANNEL_TYPE_OPEN",get:function(){return"open"}},{key:"CHANNEL_TYPE_GROUP",get:function(){return"group"}},{key:"CHANNEL_TYPE_BASE",get:function(){return"base"}},{key:"MessageTypeFilter",get:function(){return{ALL:"",USER:"MESG",FILE:"FILE",ADMIN:"ADMM"}}},{key:"ReportCategory",get:function(){return{SPAM:"spam",HARASSING:"harassing",SUSPICIOUS:"suspicious",INAPPROPRIATE:"inappropriate"}}},{key:"buildMessage",value:function(e,n){var t=B.get(this._iid),r=t.UserMessage,i=t.FileMessage,a=t.AdminMessage;if(e)switch(e.hasOwnProperty("channel_type")||(e.channel_type=n.channelType),e.type){case"MESG":return new r(e);case"FILE":var s=e.file;return new i(g(g({},e),{},{url:String(s.url),name:String(s.name),type:String(s.type),size:parseInt(s.size),data:String(s.data)}));case"BRDM":case"ADMM":return new a(e)}return null}}]),R}(),Ee=function(){function n(e){c(this,n),e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0,this.data=e.hasOwnProperty("data")?e.data:null,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):ve.CHANNEL_TYPE_GROUP)}return o(n,[{key:"isGroupChannel",value:function(){return this.channelType===ve.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){return this.channelType===ve.CHANNEL_TYPE_OPEN}}]),n}();Ee.CATEGORY_NONE=0,Ee.CATEGORY_CHANNEL_ENTER=10102,Ee.CATEGORY_CHANNEL_EXIT=10103,Ee.CATEGORY_USER_CHANNEL_MUTE=10201,Ee.CATEGORY_USER_CHANNEL_UNMUTE=10200,Ee.CATEGORY_USER_CHANNEL_BAN=10601,Ee.CATEGORY_USER_CHANNEL_UNBAN=10600,Ee.CATEGORY_CHANNEL_FREEZE=10701,Ee.CATEGORY_CHANNEL_UNFREEZE=10700,Ee.CATEGORY_TYPING_START=10900,Ee.CATEGORY_TYPING_END=10901,Ee.CATEGORY_CHANNEL_JOIN=1e4,Ee.CATEGORY_CHANNEL_LEAVE=10001,Ee.CATEGORY_CHANNEL_OPERATOR_UPDATE=10002,Ee.CATEGORY_CHANNEL_INVITE=10020,Ee.CATEGORY_CHANNEL_DECLINE_INVITE=10022,Ee.CATEGORY_CHANNEL_PROP_CHANGED=11e3,Ee.CATEGORY_CHANNEL_DELETED=12e3,Ee.CATEGORY_CHANNEL_META_DATA_CHANGED=11100,Ee.CATEGORY_CHANNEL_META_COUNTERS_CHANGED=11200,Ee.CATEGORY_CHANNEL_HIDE=13e3,Ee.CATEGORY_CHANNEL_UNHIDE=13001;function Ce(e){c(this,Ce),e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0)}Ce.CATEGORY_USER_BLOCK=20001,Ce.CATEGORY_USER_UNBLOCK=2e4,Ce.CATEGORY_FRIEND_DISCOVERED=20900;var Ue=function(){function n(e){c(this,n),this.sb=e,this.cls=B.get(this.sb._iid)}return o(n,[{key:"onRawCommandReceived",value:function(e){var g=this,n=this.cls,t=n.Command,c=n.User,d=n.Member,r=n.BaseChannel,h=n.GroupChannel,o=n.OpenChannel,i=n.UserMessage,a=n.FileMessage,s=n.AdminMessage,y=n.BaseMessageParams,l=n.ReactionEvent,u=n.ReadStatus,p=n.ThreadInfoUpdateEvent,f=ce.get(this.sb._iid),n=f.container,_=n.pinger,m=n.auth,v=n.subscribedUnreadMessageCount,E=n.sessionManager,n=n.ackStateMap,C=new t(e),U=C.getJsonElement();if(U.hasOwnProperty("unread_cnt")&&"object"===le(U.unread_cnt)){var b=!1,A=U.unread_cnt.ts;if("number"==typeof A&&A>v.ts){if(v.all!==U.unread_cnt.all&&(b=!0),v.all=0<=U.unread_cnt.all?U.unread_cnt.all:0,U.unread_cnt.custom_types)for(var S in U.unread_cnt.custom_types)v.custom_types[S]!==U.unread_cnt.custom_types[S]&&(b=!0),v.custom_types[S]=U.unread_cnt.custom_types[S];b=b&&0<v.ts,v.ts=A}if(b)for(var I in this.sb.userEventHandlers)this.sb.userEventHandlers[I].onTotalUnreadMessageCountUpdated(v.all,v.custom_types)}e=C.requestId;if(e){A=n[e];A&&(clearTimeout(A.timer),(A=A.handler)&&("EROR"===C.command?A(new de(U.message,U.code),null):A(null,C)),n.hasOwnProperty(e)&&delete n[e])}else switch(_&&"LOGI"!==C.command&&_.refreshTimer(),C.command){case"LOGI":this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.loginTimer=null,this.sb.onLoginTimerCancel=null,U.hasOwnProperty("error")?(this.sb.isSessionOpened=!1,this.sb.loginHandler(new de(U.message,U.code),null)):(this.sb.isSessionOpened=!0,U.hasOwnProperty("key")&&(m.sessionKey=U.key),U.hasOwnProperty("ekey")&&(m.eKey=U.ekey),U.hasOwnProperty("user_id")&&(this.sb.currentUser=new c(U)),"number"==typeof U.ping_interval&&0<U.ping_interval&&f.set("pingInterval",1e3*U.ping_interval),"number"==typeof U.pong_timeout&&0<U.pong_timeout&&f.set("pongTimeout",1e3*U.pong_timeout),"number"==typeof U.login_ts&&f.set("connectedAt",1e3*U.login_ts),"number"==typeof U.max_unread_cnt_on_super_group?f.set("maxUnreadCountOfSuperGroupChannel",U.max_unread_cnt_on_super_group):f.set("maxUnreadCountOfSuperGroupChannel",ue.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL),U.profile_image_encryption&&f.set("profileImageEncryption",!0),_&&_.start(),U.hasOwnProperty("file_upload_size_limit")&&U.hasOwnProperty("premium_feature_list")&&U.hasOwnProperty("emoji_hash")&&f.set("appInfo",new ge(U)),this.sb.loginHandler(null,this.sb.currentUser)),this.sb.connecting=!1,this.sb.reconnecting=!1);break;case"EXPR":U.hasOwnProperty("expires_in")&&"number"==typeof U.expires_in&&0<U.expires_in&&E.refresh(function(){});break;case"MESG":case"FILE":case"BRDM":case"ADMM":var N,k,R,T,O,M,L=null;"MESG"===C.command?L=new i(U):"FILE"===C.command?L=new a(U):"BRDM"!==C.command&&"ADMM"!==C.command||(L=new s(U)),L&&(N=this.sb.currentUser?this.sb.currentUser.userId:null,k=L.silent,R=!!U.force_update_last_message,T=L._sender&&L._sender.userId===N,L.isGroupChannel()?(O=t.bMessageAck({channelUrl:L.channelUrl,messageId:L.messageId}),this.sb.sendCommand(O),M=h.cachedChannels.hasOwnProperty(L.channelUrl),h.getChannel(L.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n){e.isHidden=!1,e.hiddenState=h.HiddenState.UNHIDDEN,h.cachedChannels[e.url]=e,L._sender&&e.memberMap.hasOwnProperty(L._sender.userId)&&((r=e.memberMap[L._sender.userId]).nickname!==L._sender.nickname&&(r.nickname=L._sender.nickname),r.plainProfileUrl!==L._sender.plainProfileUrl&&(r.plainProfileUrl=L._sender.plainProfileUrl),pe.deepEqual(r.metaData,L._sender.metaData)||(r.metaData=L._sender.metaData),r.isBlockedByMe!==L._sender.isBlockedByMe&&(r.isBlockedByMe=L._sender.isBlockedByMe));var r=g.sb.currentUser;r&&T&&(r.nickname!==L._sender.nickname&&(r.nickname=L._sender.nickname),r.plainProfileUrl!==L._sender.plainProfileUrl&&(r.plainProfileUrl=L._sender.plainProfileUrl),pe.deepEqual(r.metaData,L._sender.metaData)||(r.metaData=L._sender.metaData));var i,a=!1;if(L.mentionType===y.MentionType.CHANNEL)T||(a=!0);else if(L.mentionType===y.MentionType.USERS)for(var s=0;s<L.mentionedUsers.length;s++)if(!T&&L.mentionedUsers[s].userId===N){a=!0;break}if(k&&!T||(e.isEphemeral||M)&&((!e.lastMessage||e.lastMessage.createdAt<L.createdAt)&&(e.lastMessage=L),T||e._setGroupChannelUnreadCount(e.unreadMessageCount+1,e.unreadMentionCount+(a?1:0))),R&&(!e.lastMessage||e.lastMessage.createdAt<L.createdAt)&&(e.lastMessage=L),!k||T)for(var o in g.sb.channelHandlers)g.sb.channelHandlers[o].onChannelChanged(e);for(i in g.sb.channelHandlers){var l=g.sb.channelHandlers[i];l.onMessageReceived(e,L),a&&l.onMentionReceived(e,L)}}})):L.isOpenChannel()&&o.getChannel(L.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n){var r,i=!1;if(L.mentionType===y.MentionType.CHANNEL)i=!0;else if(L.mentionType===y.MentionType.USERS)for(var a=0;a<L.mentionedUsers.length;a++)if(L.mentionedUsers[a].userId===N){i=!0;break}for(r in g.sb.channelHandlers){var s=g.sb.channelHandlers[r];o.enteredChannels[e.url]&&s.onMessageReceived(e,L),i&&s.onMentionReceived(e,L)}}}));break;case"MEDI":case"FEDI":case"AEDI":var P,w,D,H,F=null;"MEDI"===C.command?F=new i(U):"FEDI"===C.command?F=new a(U):"AEDI"===C.command&&(F=new s(U)),F&&(P=this.sb.currentUser?this.sb.currentUser.userId:null,w=F.silent,D=F.sender&&F.sender.userId===P,F.isGroupChannel()?(H=h.cachedChannels.hasOwnProperty(F.channelUrl),h.getChannel(F.channelUrl,ue.INTERNAL_CALL,function(e,n){if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n){var t=e.cachedReadReceiptStatus[P],n=t&&t>=F.createAt,t=g.sb.currentUser;t&&D&&(t.nickname!==F._sender.nickname&&(t.nickname=F._sender.nickname),t.plainProfileUrl!==F._sender.plainProfileUrl&&(t.plainProfileUrl=F._sender.plainProfileUrl),pe.deepEqual(t.metaData,F._sender.metaData)||(t.metaData=F._sender.metaData));var r,t=!1,i=!1;if(!D&&!n&&U&&U.hasOwnProperty("old_values")){var n=U.old_values.mention_type||F.mentionType,a=U.old_values.mentioned_user_ids||F.mentionedUsers.map(function(e){return e.userId});if(n===y.MentionType.USERS&&F.mentionType===y.MentionType.USERS){for(var s=!1,o=!1,l=0;l<a.length;l++)if(a[l]===P){s=!0;break}for(var u=0;u<F.mentionedUsers.length;u++)if(F.mentionedUsers[u].userId===P){o=!0;break}!s&&o&&(i=!0,!w&&H&&(e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1),t=!0))}else if(n===y.MentionType.USERS&&F.mentionType===y.MentionType.CHANNEL){for(var c=!1,d=0;d<a.length;d++)if(a[d]===P){c=!0;break}c||(i=!0,!w&&H&&(e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1),t=!0))}}if(!e.lastMessage||e.lastMessage.createdAt<F.createdAt?(e.lastMessage=F,t=!0):e.lastMessage.createdAt===F.createdAt&&e.lastMessage.messageId===F.messageId&&(H?e.lastMessage.updatedAt<F.updatedAt&&(e.lastMessage=F,t=!0):t=!0),(!w||D)&&t)for(var h in g.sb.channelHandlers)g.sb.channelHandlers[h].onChannelChanged(e);for(r in g.sb.channelHandlers){var p=g.sb.channelHandlers[r];p.onMessageUpdated(e,F),i&&p.onMentionReceived(e,F)}}})):F.isOpenChannel()&&o.getChannel(F.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n)for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onMessageUpdated(e,F)}));break;case"DELM":var G=String(U.channel_type),B=String(U.channel_url),x=parseInt(U.msg_id);switch(G){case r.CHANNEL_TYPE_GROUP:h.getChannel(B,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"));else for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onMessageDeleted(e,x)});break;case r.CHANNEL_TYPE_OPEN:o.getChannel(B,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"));else for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onMessageDeleted(e,x)})}break;case"READ":var j=new u(U),q=h.cachedChannels.hasOwnProperty(j.channelUrl);h.getChannel(j.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n&&(q&&e.updateReadReceipt(j.reader.userId,j.timestamp),g.sb.currentUser))if(j.reader.userId===g.sb.currentUser.userId){if(q){if(0<e.unreadMessageCount||0<e.unreadMentionCount)for(var r in e._setGroupChannelUnreadCount(0,0),g.sb.channelHandlers)g.sb.channelHandlers[r].onChannelChanged(e)}else if(0===e.unreadMessageCount||0===e.unreadMentionCount)for(var i in g.sb.channelHandlers)g.sb.channelHandlers[i].onChannelChanged(e)}else for(var a in g.sb.channelHandlers)g.sb.channelHandlers[a].onReadReceiptUpdated(e)});break;case"MRCT":var G=String(U.channel_type),z=String(U.channel_url),Q=l.createFromJson(U);switch(G){case r.CHANNEL_TYPE_GROUP:h.getChannel(z,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"));else for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onReactionUpdated(e,Q)});break;case r.CHANNEL_TYPE_OPEN:o.getChannel(z,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"));else for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onReactionUpdated(e,Q)})}break;case"DLVR":var Y=String(U.channel_url),K=U.hasOwnProperty("updated")?U.updated:null,V=h.cachedChannels.hasOwnProperty(Y);h.getChannel(Y,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n){var r,i=!1;for(r in K)g.sb.currentUser&&r===g.sb.currentUser.userId&&(i=!0),V&&e.updateDeliveryReceipt(r,parseInt(K[r]));if(h.cachedChannels[e.url]=e,!i||1!==Object.keys(K).length)for(var a in g.sb.channelHandlers)g.sb.channelHandlers[a].onDeliveryReceiptUpdated(e)}});break;case"MTHD":var W=String(U.channel_url),Y=String(U.channel_type),J=p.createFromJson(U);switch(Y){case r.CHANNEL_TYPE_GROUP:h.getChannel(W,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n)for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onThreadInfoUpdated(e,J)});break;case r.CHANNEL_TYPE_OPEN:o.getChannel(W,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n)for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onThreadInfoUpdated(e,J)})}break;case"SYEV":var X=new Ee(U),Z=U.ts;switch(X.category){case Ee.CATEGORY_CHANNEL_JOIN:case Ee.CATEGORY_CHANNEL_LEAVE:h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(r,e){var n;if(g.sb.getErrorFirstCallback()&&(e=(n=[r,e])[0],r=n[1]),e)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var i=X.data.hasOwnProperty("member_count")?X.data.member_count:null,a=X.data.hasOwnProperty("joined_member_count")?X.data.joined_member_count:null;if(X.category===Ee.CATEGORY_CHANNEL_JOIN)(X.data.hasOwnProperty("users")?X.data.users:[X.data]).forEach(function(e){r.isSuper||r.isBroadcast?r.setLatestMemberCount(i,a,U.ts):(e.state=d.JOINED,r.addMember(new d(e),Z),r.updateJoinedMemberCount());var n,t=new c(e);for(n in g.sb.currentUser&&t.userId===g.sb.currentUser.userId&&(r.myMemberState="joined",h.cachedChannels[r.url]=r),g.sb.channelHandlers)g.sb.channelHandlers[n].onUserJoined(r,t)});else{var t,s=new c(X.data);for(t in g.sb.currentUser&&s.userId===g.sb.currentUser.userId?(r.isPublic||h.removeCachedChannel(X.channelUrl),r.myMemberState="none",r.invitedAt=0,r._setGroupChannelUnreadCount(0,0)):h.cachedChannels[r.url]=r,r.isSuper||r.isBroadcast?r.setLatestMemberCount(i,a,U.ts):(r.removeMember(s),r.updateJoinedMemberCount()),g.sb.channelHandlers)g.sb.channelHandlers[t].onUserLeft(r,s)}}});break;case Ee.CATEGORY_CHANNEL_OPERATOR_UPDATE:X.isGroupChannel()?h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var r,i,a=X.data.operators.map(function(e){return new c(e)}),s=a.map(function(e){return e.userId});for(r in e.members)e.members[r].role=0<=s.indexOf(e.members[r].userId)?h.Role.OPERATOR:h.Role.NONE;for(i in e.myRole=g.sb.currentUser&&0<=s.indexOf(g.sb.currentUser.userId)?h.Role.OPERATOR:h.Role.NONE,g.sb.channelHandlers)g.sb.channelHandlers[i].onOperatorUpdated(e,a)}}):X.isOpenChannel()&&o.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else for(var r in e.operators=X.data.operators.map(function(e){return new c(e)}),g.sb.channelHandlers)g.sb.channelHandlers[r].onOperatorUpdated(e,e.operators)});break;case Ee.CATEGORY_CHANNEL_INVITE:h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var r=null;X.data&&X.data.inviter&&0<Object.keys(X.data.inviter).length&&(r=new c(X.data.inviter));for(var i,a=[],s=0;s<X.data.invitees.length;s++){var o=new c(X.data.invitees[s]);a.push(o),X.data.invitees[s].state=d.INVITED;var l,u=new d(X.data.invitees[s]);e.isSuper||e.isBroadcast?(l=X.data.hasOwnProperty("member_count")?X.data.member_count:null,o=X.data.hasOwnProperty("joined_member_count")?X.data.joined_member_count:null,e.setLatestMemberCount(l,o,U.ts)):e.addMember(u,Z),g.sb.currentUser&&u.userId===g.sb.currentUser.userId&&(e.isHidden=!1,"joined"!==e.myMemberState&&(e.myMemberState="invited"),e.invitedAt=U.ts,h.cachedChannels[e.url]=e)}for(i in g.sb.channelHandlers)g.sb.channelHandlers[i].onUserReceivedInvitation(e,r,a)}});break;case Ee.CATEGORY_CHANNEL_DECLINE_INVITE:h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){if(g.sb.getErrorFirstCallback()&&(n=(r=[e,n])[0],e=r[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var t=null;X.data&&X.data.inviter&&0<Object.keys(X.data.inviter).length&&(t=new c(X.data.inviter));var r,i,a=new c(X.data.invitee);for(i in g.sb.currentUser&&a.userId===g.sb.currentUser.userId&&(e.invitedAt=0,e.myMemberState="none",e.isPublic||h.removeCachedChannel(X.channelUrl)),e.isSuper||e.isBroadcast?(r=X.data.hasOwnProperty("member_count")?X.data.member_count:null,n=X.data.hasOwnProperty("joined_member_count")?X.data.joined_member_count:null,e.setLatestMemberCount(r,n,U.ts)):e.removeMember(a),g.sb.currentUser&&a.userId!==g.sb.currentUser.userId&&(h.cachedChannels[e.url]=e),g.sb.channelHandlers)g.sb.channelHandlers[i].onUserDeclinedInvitation(e,t,a)}});break;case Ee.CATEGORY_TYPING_START:case Ee.CATEGORY_TYPING_END:h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var r,n=new c(X.data);for(r in X.category===Ee.CATEGORY_TYPING_START?e.updateTypingStatus(n,!0):e.updateTypingStatus(n,!1),g.sb.channelHandlers)g.sb.channelHandlers[r].onTypingStatusUpdated(e)}});break;case Ee.CATEGORY_CHANNEL_ENTER:case Ee.CATEGORY_CHANNEL_EXIT:o.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{X.data.hasOwnProperty("participant_count")&&(e.participantCount=X.data.participant_count);var r=new c(X.data);if(X.category===Ee.CATEGORY_CHANNEL_ENTER)for(var i in g.sb.channelHandlers)g.sb.channelHandlers[i].onUserEntered(e,r);else for(var a in g.sb.channelHandlers)g.sb.channelHandlers[a].onUserExited(e,r)}});break;case Ee.CATEGORY_USER_CHANNEL_MUTE:case Ee.CATEGORY_USER_CHANNEL_UNMUTE:X.isOpenChannel()?o.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var r=new c(X.data);if(X.category===Ee.CATEGORY_USER_CHANNEL_MUTE)for(var i in g.sb.channelHandlers)g.sb.channelHandlers[i].onUserMuted(e,r);else for(var a in g.sb.channelHandlers)g.sb.channelHandlers[a].onUserUnmuted(e,r)}}):h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var r=new c(X.data);if(g.sb.currentUser&&r.userId===g.sb.currentUser.userId&&(e.myMutedState=X.category===Ee.CATEGORY_USER_CHANNEL_MUTE?"muted":"unmuted"),Array.isArray(e.members)&&e.members.forEach(function(e){e&&e.userId===r.userId&&(e.isMuted=X.category===Ee.CATEGORY_USER_CHANNEL_MUTE)}),X.category===Ee.CATEGORY_USER_CHANNEL_MUTE)for(var i in g.sb.channelHandlers)g.sb.channelHandlers[i].onUserMuted(e,r);else for(var a in g.sb.channelHandlers)g.sb.channelHandlers[a].onUserUnmuted(e,r)}});break;case Ee.CATEGORY_USER_CHANNEL_BAN:case Ee.CATEGORY_USER_CHANNEL_UNBAN:X.isOpenChannel()?o.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var r,i=new c(X.data);if(X.category===Ee.CATEGORY_USER_CHANNEL_BAN)for(r in g.sb.currentUser&&i.userId===g.sb.currentUser.userId&&(delete o.enteredChannels[X.channelUrl],g.cls.FileMessageQueue.delete(X.channelUrl)),g.sb.channelHandlers)g.sb.channelHandlers[r].onUserBanned(e,i);else for(var a in g.sb.channelHandlers)g.sb.channelHandlers[a].onUserUnbanned(e,i)}}):h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var t,r,i=new c(X.data);if(X.category===Ee.CATEGORY_USER_CHANNEL_BAN)for(r in g.sb.currentUser&&i.userId===g.sb.currentUser.userId&&(e.isPublic||h.removeCachedChannel(X.channelUrl),e.myMemberState="none",e.invitedAt=0,e._setGroupChannelUnreadCount(0,0)),e.isSuper||e.isBroadcast?(t=X.data.hasOwnProperty("member_count")?X.data.member_count:null,n=X.data.hasOwnProperty("joined_member_count")?X.data.joined_member_count:null,e.setLatestMemberCount(t,n,U.ts)):(e.removeMember(i),e.updateJoinedMemberCount()),g.sb.channelHandlers)g.sb.channelHandlers[r].onUserBanned(e,i);else for(var a in g.sb.channelHandlers)g.sb.channelHandlers[a].onUserUnbanned(e,i)}});break;case Ee.CATEGORY_CHANNEL_FREEZE:case Ee.CATEGORY_CHANNEL_UNFREEZE:X.isOpenChannel()?o.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else if(e.isFrozen=X.data.freeze,o.cachedChannels[e.url]=e,X.category===Ee.CATEGORY_CHANNEL_FREEZE)for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onChannelFrozen(e);else for(var i in g.sb.channelHandlers)g.sb.channelHandlers[i].onChannelUnfrozen(e)}):h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else if(e.isFrozen=X.data.freeze,h.cachedChannels[e.url]=e,X.category===Ee.CATEGORY_CHANNEL_FREEZE)for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onChannelFrozen(e);else for(var i in g.sb.channelHandlers)g.sb.channelHandlers[i].onChannelUnfrozen(e)});break;case Ee.CATEGORY_CHANNEL_DELETED:for(var $ in(X.isGroupChannel()?h:o).removeCachedChannel(X.channelUrl),this.sb.channelHandlers)this.sb.channelHandlers[$].onChannelDeleted(X.channelUrl,X.isGroupChannel()?"group":"open");break;case Ee.CATEGORY_CHANNEL_PROP_CHANGED:X.isOpenChannel()?o.getChannelWithoutCache(X.channelUrl,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else for(var r in g.sb.channelHandlers)g.sb.channelHandlers[r].onChannelChanged(e)}):h.getChannelWithoutCache(X.channelUrl,function(e,n){if(g.sb.getErrorFirstCallback()&&(n=(r=[e,n])[0],e=r[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else{var t,r=e.unreadMessageCount,n=e.unreadMentionCount;for(t in e.myCountPreference!==h.CountPreference.ALL&&(e.myCountPreference===h.CountPreference.UNREAD_MESSAGE_COUNT_ONLY?n=0:e.myCountPreference===h.CountPreference.UNREAD_MENTION_COUNT_ONLY?r=0:n=r=0),e._setGroupChannelUnreadCount(r,n),g.sb.channelHandlers)g.sb.channelHandlers[t].onChannelChanged(e)}});break;case Ee.CATEGORY_CHANNEL_META_DATA_CHANGED:case Ee.CATEGORY_CHANNEL_META_COUNTERS_CHANGED:var ee=X.data.hasOwnProperty("created"),ne=X.data.hasOwnProperty("updated"),te=X.data.hasOwnProperty("deleted");X.isOpenChannel()?o.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else for(var r in g.sb.channelHandlers){r=g.sb.channelHandlers[r];X.category===Ee.CATEGORY_CHANNEL_META_DATA_CHANGED?(ee&&r.onMetaDataCreated(e,X.data.created),ne&&r.onMetaDataUpdated(e,X.data.updated),te&&r.onMetaDataDeleted(e,X.data.deleted)):(ee&&r.onMetaCountersCreated(e,X.data.created),ne&&r.onMetaCountersUpdated(e,X.data.updated),te&&r.onMetaCountersDeleted(e,X.data.deleted))}}):h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else for(var r in g.sb.channelHandlers){r=g.sb.channelHandlers[r];X.category===Ee.CATEGORY_CHANNEL_META_DATA_CHANGED?(ee&&r.onMetaDataCreated(e,X.data.created),ne&&r.onMetaDataUpdated(e,X.data.updated),te&&r.onMetaDataDeleted(e,X.data.deleted)):(ee&&r.onMetaCountersCreated(e,X.data.created),ne&&r.onMetaCountersUpdated(e,X.data.updated),te&&r.onMetaCountersDeleted(e,X.data.deleted))}});break;case Ee.CATEGORY_CHANNEL_HIDE:case Ee.CATEGORY_CHANNEL_UNHIDE:h.getChannel(X.channelUrl,ue.INTERNAL_CALL,function(e,n){var t;if(g.sb.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n)he.debug("Discard command:","`".concat(C.command,"`"),X.category);else if(X.category===Ee.CATEGORY_CHANNEL_HIDE)for(var r in e.isHidden=!0,X.data&&(X.data.hasOwnProperty("allow_auto_unhide")&&(e.hiddenState=X.data.allow_auto_unhide?h.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:h.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),X.data.hasOwnProperty("hide_previous_messages")&&X.data.hide_previous_messages&&e._setGroupChannelUnreadCount(0,0)),U.hasOwnProperty("ts_message_offset")&&(e._messageOffsetTimestamp=U.ts_message_offset),h.cachedChannels[e.url]=e,g.sb.channelHandlers)g.sb.channelHandlers[r].onChannelHidden(e);else for(var i in e.isHidden=!1,e.hiddenState=h.HiddenState.UNHIDDEN,h.cachedChannels[e.url]=e,g.sb.channelHandlers)g.sb.channelHandlers[i].onChannelChanged(e)})}break;case"USEV":var re=new Ee(U);switch(re.category){case Ce.CATEGORY_USER_BLOCK:case Ce.CATEGORY_USER_UNBLOCK:var ie=re.data.blocker.user_id,ae=re.data.blockee.user_id;Object.keys(h.cachedChannels).forEach(function(e){var n=h.cachedChannels[e];try{g.sb.currentUser&&(g.sb.currentUser.userId===ie?n.memberMap[ae].isBlockedByMe=re.category===Ce.CATEGORY_USER_BLOCK:g.sb.currentUser.userId===ae&&(n.memberMap[ie].isBlockingMe=re.category===Ce.CATEGORY_USER_BLOCK))}catch(e){}});break;case Ce.CATEGORY_FRIEND_DISCOVERED:var se,oe=re.data.friend_discoveries.map(function(e){return new c(e)});for(se in this.sb.userEventHandlers)this.sb.userEventHandlers[se].onFriendsDiscovered(oe)}break;case"LEAV":case"JOIN":case"PONG":case"MTIO":case"TPST":case"TPEN":break;default:he.debug("Discard command:","`".concat(C.command,"`"))}}}]),n}(),be={},Ae={},Se=function(){function n(e){c(this,n),this.channel=e,this.uploadQueue=[],this.messageQueue=[],this.latestTimestampToSendMessage=0,B.get(this._iid).FileMessageQueue.queueMap[e.url]=this}return o(n,[{key:"_handleMessageQueueUpdated",value:function(e){var t=this;switch(he.debug("`fileMessageQueue` message queue updated:",this.messageQueue),e){case"add":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue();break;case"update":case"remove":if(0<this.messageQueue.length){var r=B.get(this._iid).FileMessageQueue,i=this.messageQueue[0];if(i)if(i.state===r.State.UPLOADED){if(i&&i.state===r.State.UPLOADED){for(i.state=r.State.SENDING,0===this.latestTimestampToSendMessage&&(this.latestTimestampToSendMessage=(new Date).getTime()-200);(new Date).getTime()-this.latestTimestampToSendMessage<200;);this.latestTimestampToSendMessage=(new Date).getTime(),this._sendUploadedMessage(i,function(e,n){i.state=r.State.SENT,i.error=e||null,i.response=n||null,t._handleMessageQueueUpdated("update")})}}else i.state===r.State.SENT&&this._finalizeMessage()}}}},{key:"_handleUploadQueueUpdated",value:function(e,n){var t=this;switch(he.debug("`fileMessageQueue` upload queue updated:",this.uploadQueue),e){case"add":var r=B.get(this._iid).FileMessageQueue;n.state=r.State.UPLOADING,n.error?(-1<this.messageQueue.map(function(e){return e.requestId}).indexOf(n.requestId)&&(n.state=r.State.SENT,this._handleMessageQueueUpdated("update")),this._finalizeUpload(n.requestId)):this._uploadFile(n,function(e){n.error&&n.state===r.State.SENT||(n.state=r.State.UPLOADED),n.fileInfo=e,t._handleMessageQueueUpdated("update"),t._finalizeUpload(n.requestId)});break;case"update":break;case"remove":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue()}}},{key:"_moveFirstPendingMessageToUploadQueue",value:function(){var n=B.get(this._iid).FileMessageQueue,e=this.messageQueue.filter(function(e){return e.state===n.State.PENDING});0<e.length&&(e=e[0],this.uploadQueue.push(e),this._handleUploadQueueUpdated("add",e))}},{key:"_sendUploadedMessage",value:function(e,r){var n=B.get(this._iid),t=n.Command,i=n.FileMessage,a=e.fileInfo,s=t.bFile(g(g({},a),{},{requestId:e.requestId,channelUrl:this.channel.url,url:a.file,metaArrays:a.metaArrays})),o=Zn.getInstance(this._iid),e=ce.get(this._iid);o.getConnectionState()===o.ConnectionState.OPEN||!o.currentUser||o.connecting||o.reconnecting?o.sendCommand(s,function(e,n){var t;o.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n?((t=new i(s.getJsonElement())).requestedMentionUserIds=a.mentionedUserIds,r(n,t)):(e=new i(e.getJsonElement()),r(null,e))}):e.container.apiClient.sendFileMessage(g(g({channelUrl:this.channel.url,isOpenChannel:this.channel.isOpenChannel()},a),{},{fileUrl:a.file,fileName:a.name,fileSize:a.size,fileType:a.type,metaArrays:a.metaArrays}),function(e,n){n=new i(e?s.getJsonElement():n);e&&(n.requestedMentionUserIds=a.mentionedUserIds),r(e,n)})}},{key:"_uploadFile",value:function(t,r){var i,a=t.fileInfo,e=t.pendingMessage;"string"!=typeof a.file&&a.file?(i=B.get(this._iid).FileMessageQueue,ce.get(this._iid).container.apiClient.uploadFile(g(g({},a),{},{fileType:a.type,channelUrl:this.channel.url,reqId:e?e.reqId:null}),function(e,n){e?(t.state=i.State.SENT,t.error=e,t.response=null):(n="object"===le(n)?n:JSON.parse(n),a.file=n.url,a.thumbnailSizes=n.hasOwnProperty("thumbnails")?n.thumbnails:[],a.requireAuth=!!n.hasOwnProperty("require_auth")&&n.require_auth,a.size=n.hasOwnProperty("file_size")?n.file_size:a.size),r(a)})):(a.thumbnailSizes=[],a.requireAuth=!1,r(a))}},{key:"_finalizeUpload",value:function(e){e=this.uploadQueue.map(function(e){return e.requestId}).indexOf(e);-1<e&&(0<(e=this.uploadQueue.splice(e,1)).length&&this._handleUploadQueueUpdated("remove",e[0]))}},{key:"_finalizeMessage",value:function(){var e=ce.get(this._iid).container.isErrorFirstInCallback,n=Zn.getInstance(this._iid),t=B.get(this._iid).FileMessageQueue,r=this.messageQueue[0];if(r&&r.state===t.State.SENT){r.state=t.State.DONE;var i=r.response,a=r.error,s=r.fileInfo.callback;if(i&&!a){t=n.currentUser;if(t&&i._sender&&t.userId===i._sender.userId&&(t.nickname!==i._sender.nickname&&(t.nickname=i._sender.nickname),t.plainProfileUrl!==i._sender.plainProfileUrl&&(t.plainProfileUrl=i._sender.plainProfileUrl)),this.channel.isGroupChannel())for(var o in this.channel.lastMessage=i,n.channelHandlers)n.channelHandlers[o].onChannelChanged(this.channel);return e?s(null,i):s(i,null),this.messageQueue.shift(),void this._handleMessageQueueUpdated("remove")}a&&(i=r.pendingMessage)&&(a.code!==de.INVALID_PARAMETER?(i.requestState=n.MessageRequestState.FAILED,i.sendingStatus=n.MessageSendingStatus.FAILED,a.code!==de.FILE_UPLOAD_CANCEL_FAILED&&a.code!==de.REQUEST_CANCELED||(i.sendingStatus=n.MessageSendingStatus.CANCELED),i.requestedMentionUserIds=r.fileInfo.mentionedUserIds,i.errorCode=a.code):i=null),e?s(a,i):s(i,a),this.messageQueue.shift(),this._handleMessageQueueUpdated("remove")}}},{key:"addJob",value:function(e){this.messageQueue.push(e),this._handleMessageQueueUpdated("add")}},{key:"cancelUploadItemByRequestId",value:function(e,n){this._finalizeUpload(e);var t=this.messageQueue.map(function(e){return e.requestId}).indexOf(e);if(-1<t){var r=B.get(this._iid).FileMessageQueue,t=this.messageQueue[t];!t||t.state!==r.State.UPLOADING&&t.state!==r.State.PENDING||(t.state=r.State.SENT,t.response=null,t.error=new de("Uploading has been completed or canceled.",de.FILE_UPLOAD_CANCEL_FAILED),this._handleMessageQueueUpdated("update"));e=r.uploadRequest[e];if(e)return e.cancel("Upload has been canceled."),n(null,!0),!0;n(new de("Uploading has been completed or canceled.",de.FILE_UPLOAD_CANCEL_FAILED),!1)}else n(new de("Uploading has been completed or canceled.",de.FILE_UPLOAD_CANCEL_FAILED),!1);return!1}}],[{key:"State",get:function(){return{PENDING:"pending",UPLOADING:"uploading",UPLOADED:"uploaded",SENDING:"sending",SENT:"sent",DONE:"done"}}},{key:"getByChannelUrl",value:function(e){return B.get(this._iid).FileMessageQueue.queueMap[e]}},{key:"create",value:function(e){var n=B.get(this._iid).FileMessageQueue;return n.queueMap.hasOwnProperty(e.url)||(n.queueMap[e.url]=new n(e)),n.queueMap[e.url]}},{key:"delete",value:function(e){var n=B.get(this._iid).FileMessageQueue;n.queueMap.hasOwnProperty(e)&&delete n.queueMap[e]}},{key:"clear",value:function(){Ae[this._iid]={}}},{key:"queueMap",get:function(){return Ae[this._iid]||(Ae[this._iid]={}),Ae[this._iid]}},{key:"uploadRequest",get:function(){return be[this._iid]||(be[this._iid]={}),be[this._iid]}}]),n}();Se.Job=function(){return function e(n){var t=n.fileInfo,r=n.requestId,i=n.pendingMessage,a=n.state,s=n.error,s=void 0===s?null:s,n=n.response,n=void 0===n?null:n;c(this,e),this.fileInfo=t,this.requestId=r,this.pendingMessage=i,this.state=a||Se.State.PENDING,this.error=s,this.response=n}}();var Ie=function(){function e(){c(this,e)}return o(e,null,[{key:"create",value:function(){return"".concat(parseInt(1e5*Math.random()),"-").concat((new Date).getTime())}}]),e}(),Ne={},ke={},Re=new WeakMap,Te=new WeakMap,Oe=new WeakMap,Me=function(){s(a,ve);var t=f(a);function a(e){var n;return c(this,a),(n=t.call(this,e)).channelType=ve.CHANNEL_TYPE_GROUP,n.isDistinct=!1,n.isSuper=!1,n.isBroadcast=!1,n.isPublic=!1,n.unreadMessageCount=0,n.inviter=null,n.members=[],n.memberMap={},n.lastMessage=null,n.memberCount=0,n.joinedMemberCount=0,n.cachedReadReceiptStatus={},n.cachedDeliveryReceiptStatus=null,n.myPushTriggerOption=a.PushTriggerOption.DEFAULT,n.isPushEnabled,n.isHidden=!1,n.hiddenState=a.HiddenState.UNHIDDEN,n.isDiscoverable=!0,n.myLastRead=0,n.messageSurvivalSeconds=-1,n._messageOffsetTimestamp=0,n._cachedLastDeliveredReceipt={sentAt:0,timeout:null},Re.set(y(n),{}),Te.set(y(n),{start:0,end:0}),Oe.set(y(n),0),e&&n._update(e),n}return o(a,[{key:"messageOffsetTimestamp",get:function(){return this._messageOffsetTimestamp}},{key:"_setGroupChannelUnreadCount",value:function(e,n){try{var t;"number"==typeof e&&0<=e&&("all"===this.myCountPreference||"unread_message_count_only"===this.myCountPreference?this.isSuper||this.isBroadcast?(t=ce.get(this._iid).container.maxUnreadCountOfSuperGroupChannel,this.unreadMessageCount=t<=e?t:e):this.unreadMessageCount=e:this.unreadMessageCount=0),"number"==typeof n&&0<=n&&("all"===this.myCountPreference||"unread_mention_count_only"===this.myCountPreference?this.unreadMentionCount=n:this.unreadMentionCount=0)}catch(e){}}},{key:"_update",value:function(e){var n=B.get(this._iid),t=n.BaseChannel,r=n.GroupChannel,i=n.User,a=n.Member;if(this.isAccessCodeRequired=e.is_access_code_required||!1,this.isDistinct=e.is_distinct||!1,this.isPushEnabled=e.is_push_enabled||!1,this.isHidden=!!e.hasOwnProperty("is_hidden")&&e.is_hidden,this.myPushTriggerOption=e.push_trigger_option||r.PushTriggerOption.DEFAULT,this.myCountPreference=e.hasOwnProperty("count_preference")?e.count_preference:r.CountPreference.ALL,this.unreadMessageCount=0,this.unreadMentionCount=0,this._setGroupChannelUnreadCount(parseInt(e.unread_message_count),parseInt(e.unread_mention_count)),e.hasOwnProperty("read_receipt"))for(var s in this.cachedReadReceiptStatus={},e.read_receipt){var o=e.read_receipt[s];this.updateReadReceipt(s,parseInt(o))}if(e.hasOwnProperty("delivery_receipt")&&"object"===le(e.delivery_receipt)&&null!==e.delivery_receipt)for(var l in this.cachedDeliveryReceiptStatus||(this.cachedDeliveryReceiptStatus={}),e.delivery_receipt){var u=e.delivery_receipt[l];this.updateDeliveryReceipt(l,parseInt(u))}if(e.hasOwnProperty("user_last_read")&&"number"==typeof e.user_last_read?this.myLastRead=e.user_last_read:this.myLastRead=0,e.hasOwnProperty("members")){this.members=[],this.memberMap={};for(var c=0;c<e.members.length;c++){var d=new a(e.members[c]);this.members.push(d),this.memberMap[d.userId]=d}}this.myMemberState=e.member_state||"none",this.myRole=e.my_role||r.Role.NONE,e.hasOwnProperty("is_muted")?"string"==typeof e.is_muted?this.myMutedState=e.is_muted:"boolean"==typeof e.is_muted?this.myMutedState=e.is_muted?"muted":"unmuted":this.myMutedState="unmuted":this.myMutedState="unmuted",e.hasOwnProperty("member_count")&&(this.memberCount=parseInt(e.member_count)),e.hasOwnProperty("joined_member_count")&&(this.joinedMemberCount=parseInt(e.joined_member_count)),e.hasOwnProperty("last_message")&&"object"===le(e.last_message)&&e.last_message?e.last_message instanceof fe?this.lastMessage=e.last_message:this.lastMessage=t.buildMessage(e.last_message,this):this.lastMessage=null,e.hasOwnProperty("inviter")&&null!==e.inviter&&"object"===le(e.inviter)&&0<Object.keys(e.inviter).length?this.inviter=new i(e.inviter):this.inviter=null,this.invitedAt=e.invited_at||0,e.hasOwnProperty("is_super")&&"boolean"==typeof e.is_super?this.isSuper=e.is_super:this.isSuper=!1,e.hasOwnProperty("is_broadcast")&&"boolean"==typeof e.is_broadcast?this.isBroadcast=e.is_broadcast:this.isBroadcast=!1,e.hasOwnProperty("is_public")&&"boolean"==typeof e.is_public?this.isPublic=e.is_public:this.isPublic=!1,e.hasOwnProperty("hidden_state")?this.hiddenState=e.hidden_state:this.hiddenState=r.HiddenState.UNHIDDEN,e.hasOwnProperty("is_discoverable")&&"boolean"==typeof e.is_discoverable?this.isDiscoverable=e.is_discoverable:this.isDiscoverable=this.isPublic,e.hasOwnProperty("ts_message_offset")&&(this._messageOffsetTimestamp=e.ts_message_offset),e.hasOwnProperty("message_survival_seconds")&&"number"==typeof e.message_survival_seconds&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"addMember",value:function(e){var n,t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.isSuper||this.isBroadcast||(n=B.get(this._iid).Member,(t=this.removeMember(e))&&t.state===n.JOINED&&(e.state=n.JOINED),this.memberMap[e.userId]=e,this.members.push(e),this.memberCount++,this.updateReadReceipt(e.userId,r),this.updateDeliveryReceipt(e.userId,r))}},{key:"removeMember",value:function(e){var n=null;if(!this.isSuper&&!this.isBroadcast&&this.memberMap.hasOwnProperty(e.userId)){delete this.memberMap[e.userId];for(var t=0;t<this.members.length;t++){var r=this.members[t];if(r.userId===e.userId){n=r,this.members.splice(t,1);break}}this.memberCount--}return n}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"isIdentical",value:function(e){return e&&this.url===e.url}},{key:"isEqual",value:function(e){return pe.deepEqual(this,e)}},{key:"createMemberListQuery",value:function(){return new(B.get(this._iid).MemberListQuery)(this.url)}},{key:"createBannedUserListQuery",value:function(){return new(B.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:this.isOpenChannel()})}},{key:"refresh",value:function(e){return B.get(this._iid).GroupChannel.getChannelWithoutCache(this.url,e)}},{key:"updateChannel",value:function(){var n=this,t=V.toArray(arguments),e=void 0;"function"==typeof t[t.length-1]&&(e=t.pop());var r=B.get(this._iid),i=r.GroupChannel,r=r.GroupChannelParams;if(t[0]instanceof r&&1===t.length)return ae(this._iid,function(r){var e=t[0];e.channelUrl=n.url,e._validate()?ce.get(n._iid).container.apiClient.updateGroupChannel(g(g({},e),{},{operatorUserIds:e.operatorUserIds}),function(e,n){var t=null;e||(t=i.upsert(n)),r(e,t)}):r(V.error,null)},e);if(3===t.length){var a=new r;return a.channelUrl=this.url,a.name=t[0],"string"==typeof t[1]?a.coverUrl=t[1]:a.coverImage=t[1],a.data=t[2],this.updateChannel(a,e)}if(4===t.length){a=new r;return a.channelUrl=this.url,a.isDistinct=t[0],a.name=t[1],"string"==typeof t[1]?a.coverUrl=t[2]:a.coverImage=t[2],a.data=t[3],this.updateChannel(a,e)}if(5!==t.length)return ae(this._iid,function(e){return e(V.error,null)},e);r=new r;return r.channelUrl=this.url,r.isDistinct=t[0],r.name=t[1],"string"==typeof t[2]?r.coverUrl=t[2]:r.coverImage=t[2],r.data=t[3],r.customType=t[4],this.updateChannel(r,e)}},{key:"invite",value:function(e,n){var t=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return 0<e.length&&e.every(function(e){return!!e.userId&&"string"==typeof e.userId})}}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],r?ae(this._iid,function(e){return e(V.error,null)},n):this.inviteWithUserIds(e.map(function(e){return e.userId}),n)}},{key:"inviteWithUserIds",value:function(e,n){var i=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),a=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){a?r(a,null):ce.get(i._iid).container.apiClient.inviteToGroupChannel({channelUrl:i.url,userIds:e},function(e,n){var t=null;e||(t=B.get(i._iid).GroupChannel.upsert(n)),r(e,t)})},n)}},{key:"acceptInvitation",value:function(e,n){var i=this,t=T(V.parse(arguments,[new V({type:"string",optional:!0,defaultValue:null}),new V({type:"callback"})]),3),a=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){a?r(a,null):ce.get(i._iid).container.apiClient.acceptInvitation({channelUrl:i.url,accessCode:e},function(e,n){var t=null;e||((t=B.get(i._iid).GroupChannel.upsert(n)).myMemberState="joined"),r(e,t)})},n)}},{key:"declineInvitation",value:function(e){var a=this;return ae(this._iid,function(i){ce.get(a._iid).container.apiClient.declineInvitation({channelUrl:a.url},function(e,n){var t,r=null;e||((r=(t=B.get(a._iid).GroupChannel).upsert(n)).myMemberState="none",a.isPublic||t.removeCachedChannel(a.url)),i(e,r)})},e)}},{key:"join",value:function(e,n){var i=this,t=T(V.parse(arguments,[new V({type:"string",optional:!0,defaultValue:null}),new V({type:"callback"})]),3),a=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){a?r(a,null):ce.get(i._iid).container.apiClient.joinGroupChannel({channelUrl:i.url,accessCode:e},function(e,n){var t=null;e||((t=B.get(i._iid).GroupChannel.upsert(n)).myMemberState="joined"),r(e,t)})},n)}},{key:"leave",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.leaveGroupChannel({channelUrl:n.url},function(e,n){return t(e,null)})},e)}},{key:"muteUser",value:function(e,n,t,r){return this.muteUserWithUserId(e?e.userId:null,n,t,r)}},{key:"muteUserWithUserId",value:function(e,n,r,t){var i=this,a=T(V.parse(arguments,[new V({type:"string"}),new V({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new V({type:"string",optional:!0,defaultValue:""}),new V({type:"callback"})]),5),s=a[0];return e=a[1],n=a[2],r=a[3],t=a[4],ae(this._iid,function(t){s?t(s,null):ce.get(i._iid).container.apiClient.muteUser({channelUrl:i.url,userId:e,description:r,seconds:n,isGroupChannel:!0},function(e,n){t(e,null)})},t)}},{key:"unmuteUser",value:function(e,n){return this.unmuteUserWithUserId(e?e.userId:null,n)}},{key:"unmuteUserWithUserId",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.unmuteUser({channelUrl:r.url,userId:e,isGroupChannel:!0},function(e,n){t(e,null)})},n)}},{key:"banUser",value:function(e,n,t,r){return this.banUserWithUserId(e?e.userId:null,n,t,r)}},{key:"banUserWithUserId",value:function(e,n,r,t){var i=this,a=T(V.parse(arguments,[new V({type:"string"}),new V({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new V({type:"string"}),new V({type:"callback"})]),5),s=a[0];return e=a[1],n=a[2],r=a[3],t=a[4],ae(this._iid,function(t){s?t(s,null):ce.get(i._iid).container.apiClient.banUser({channelUrl:i.url,userId:e,description:r,seconds:n,isGroupChannel:!0},function(e,n){t(e,null)})},t)}},{key:"unbanUser",value:function(e,n){return this.unbanUserWithUserId(e?e.userId:null,n)}},{key:"unbanUserWithUserId",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.unbanUser({channelUrl:r.url,userId:e,isGroupChannel:!0},function(e,n){t(e,null)})},n)}},{key:"updateJoinedMemberCount",value:function(){var n;this.isSuper||this.isBroadcast||(n=B.get(this._iid).Member,this.joinedMemberCount=this.members.filter(function(e){return e.state===n.JOINED}).length)}},{key:"setLatestMemberCount",value:function(e,n,t){"number"==typeof e&&"number"==typeof n&&"number"==typeof t&&t>=Oe.get(this)&&(Oe.set(this,t),this.memberCount=e,this.joinedMemberCount=n)}},{key:"hide",value:function(i,a,e){var s=this,n=T(V.parse(arguments,[new V({type:"boolean",optional:!0,defaultValue:!1}),new V({type:"boolean",optional:!0,defaultValue:!0}),new V({type:"callback"})]),4),t=n[0];return i=n[1],a=n[2],e=n[3],ae(this._iid,function(r){t?r(t,null):ce.get(s._iid).container.apiClient.hideGroupChannel({channelUrl:s.url,hidePreviousMessages:i,allowAutoUnhide:a},function(e,n){var t;e||(t=B.get(s._iid).GroupChannel,s.isHidden=!0,s.hiddenState=a?t.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:t.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,i&&s._setGroupChannelUnreadCount(0,0),n.hasOwnProperty("ts_message_offset")&&(s._messageOffsetTimestamp=n.ts_message_offset),t.cachedChannels[s.url]=s),r(e,n)})},e)}},{key:"unhide",value:function(e){var i=this;return ae(this._iid,function(r){ce.get(i._iid).container.apiClient.unhideGroupChannel({channelUrl:i.url},function(e,n){var t;e||(t=B.get(i._iid).GroupChannel,i.isHidden=!1,i.hiddenState=t.HiddenState.UNHIDDEN,t.cachedChannels[i.url]=i),r(e,n)})},e)}},{key:"freeze",value:function(e){var i=this;return ae(this._iid,function(r){ce.get(i._iid).container.apiClient.freeze({channelUrl:i.url,isGroupChannel:!0,freezing:!0},function(e,n){var t;e||(t=B.get(i._iid).GroupChannel,i.isFrozen=!0,t.cachedChannels[i.url]=i),r(e,null)})},e)}},{key:"unfreeze",value:function(e){var i=this;return ae(this._iid,function(r){ce.get(i._iid).container.apiClient.freeze({channelUrl:i.url,isGroupChannel:!0,freezing:!1},function(e,n){var t;e||(t=B.get(i._iid).GroupChannel,i.isFrozen=!1,t.cachedChannels[i.url]=i),r(e,null)})},e)}},{key:"delete",value:function(e){var r=this;return ae(this._iid,function(t){ce.get(r._iid).container.apiClient.deleteGroupChannel({channelUrl:r.url},function(e,n){e||B.get(r._iid).GroupChannel.removeCachedChannel(r.url),t(e,n)})},e)}},{key:"markAsRead",value:function(){var i=this,e=B.get(this._iid).Command,a=Zn.getInstance(this._iid),e=e.bRead({channelUrl:this.url});a.sendCommand(e,function(e,n){var t;if(a.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),!n&&a.currentUser&&(i.updateReadReceipt(a.currentUser.userId,e.getJsonElement().ts),0<i.unreadMessageCount||0<i.unreadMentionCount))for(var r in i._setGroupChannelUnreadCount(0,0),a.channelHandlers)a.channelHandlers[r].onChannelChanged(i)})}},{key:"getUnreadMemberCount",value:function(e){var n=Zn.getInstance(this._iid),t=B.get(this._iid).Member;if(e instanceof fe&&!e.isAdminMessage()&&n.currentUser&&!this.isSuper&&!this.isBroadcast){for(var r=0,i=e.createdAt,a=this.members,s=0;s<a.length;s++){var o=a[s];n.currentUser.userId===o.userId||o.state!==t.JOINED||e.sender&&e.sender.userId===o.userId||(this.cachedReadReceiptStatus[o.userId]||0)<i&&r++}return r}return 0}},{key:"getReadReceipt",value:function(e){return this.getUnreadMemberCount(e)}},{key:"markAsDelivered",value:function(){function e(){var e=Zn.getInstance(r._iid),t=e.currentUser?e.currentUser.userId:null;ce.get(r._iid).container.apiClient.markAsDelivered({channelUrl:r.url,userId:t},function(e,n){e?he.debug(e):(n=n.hasOwnProperty("ts")?n.ts:0,r.updateDeliveryReceipt(t,n))})}var r=this,n=this._cachedLastDeliveredReceipt;n&&Date.now()-n.sentAt<1e3?(n.timeout&&clearTimeout(n.timeout),n.timeout=setTimeout(function(){n.sentAt=Date.now(),e()},n.sentAt+1e3-Date.now())):(n.sentAt=Date.now(),e())}},{key:"getUndeliveredMemberCount",value:function(e){var n=Zn.getInstance(this._iid),t=B.get(this._iid).Member;if(this.cachedDeliveryReceiptStatus&&e instanceof fe&&!e.isAdminMessage()&&n.currentUser&&!this.isSuper&&!this.isBroadcast){var r=e.createdAt,i=0,a=function(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=m(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}(this.members);try{for(a.s();!(s=a.n()).done;){var s=s.value;n.currentUser.userId===s.userId||s.state!==t.JOINED||e.sender&&e.sender.userId===s.userId||this.cachedDeliveryReceiptStatus[s.userId]<r&&i++}}catch(e){a.e(e)}finally{a.f()}return i}return 0}},{key:"getDeliveryReceipt",value:function(e){return this.getUndeliveredMemberCount(e)}},{key:"getReadMembers",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=Zn.getInstance(this._iid);if(t.currentUser&&!this.isSuper&&!this.isBroadcast&&e instanceof fe&&!e.isAdminMessage()){for(var r=[],i=0;i<this.members.length;i++){var a=this.members[i];(n||a.userId!==t.currentUser.userId&&a.userId!==e.sender.userId)&&(this.cachedReadReceiptStatus[a.userId]||0)>=e.createdAt&&r.push(a)}return r}return[]}},{key:"getUnreadMembers",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=Zn.getInstance(this._iid);if(t.currentUser&&!this.isSuper&&!this.isBroadcast&&e instanceof fe&&!e.isAdminMessage()){for(var r=[],i=0;i<this.members.length;i++){var a=this.members[i];(n||a.userId!==t.currentUser.userId&&a.userId!==e.sender.userId)&&(this.cachedReadReceiptStatus[a.userId]||0)<e.createdAt&&r.push(a)}return r}return[]}},{key:"getReadStatus",value:function(){var r=this,i=0<arguments.length&&void 0!==arguments[0]&&arguments[0],a=Zn.getInstance(this._iid);if(!a.currentUser||this.isSuper||this.isBroadcast)return{};var e,s={};for(e in this.cachedReadReceiptStatus)(function(n){if(!i&&n===a.currentUser.userId)return;var e=r.cachedReadReceiptStatus[n],t=r.members.filter(function(e){return e.userId===n});s[n]={user:0<t.length?t[0]:null,last_seen_at:parseInt(e)}})(e);return s}},{key:"updateReadReceipt",value:function(e,n){var t=this.cachedReadReceiptStatus[e];(!t||t<n)&&(this.cachedReadReceiptStatus[e]=n,(t=Zn.getInstance(this._iid)).currentUser&&e===t.currentUser.userId&&(this.myLastRead=n))}},{key:"updateDeliveryReceipt",value:function(e,n){var t;this.cachedDeliveryReceiptStatus&&(this.cachedDeliveryReceiptStatus.hasOwnProperty(e)&&(t=this.cachedDeliveryReceiptStatus[e])&&!(t<n)||(this.cachedDeliveryReceiptStatus[e]=n))}},{key:"startTyping",value:function(){var e=Zn.getInstance(this._iid),n=(new Date).getTime(),t=e.Options.typingIndicatorThrottle;("number"!=typeof t||t<1e3||9e3<t)&&(t=1e3);var r=Te.get(this);n-r.start>=t&&(r.end=0,r.start=n,r=B.get(this._iid).Command.bTypeStart({channelUrl:this.url,time:r.start}),e.sendCommand(r,null))}},{key:"endTyping",value:function(){var e=Zn.getInstance(this._iid),n=(new Date).getTime(),t=e.Options.typingIndicatorThrottle;("number"!=typeof t||t<1e3||9e3<t)&&(t=1e3);var r=Te.get(this);n-r.end>=t&&(r.start=0,r.end=n,r=B.get(this._iid).Command.bTypeEnd({channelUrl:this.url,time:r.end}),e.sendCommand(r,null))}},{key:"invalidateTypingStatus",value:function(){var e,n=Re.get(this),t=(new Date).getTime(),r=!1;for(e in n)1e4<=t-n[e].ts&&(delete n[e],r=!0);return r}},{key:"getTypingMembers",value:function(){var e,n=[];for(e in Re.get(this)){var t=this.memberMap[e];t&&n.push(t)}return n}},{key:"getTypingUsers",value:function(){var e,n=Re.get(this),t=[];for(e in n){var r=n[e].user;t.push(r)}return t}},{key:"updateTypingStatus",value:function(e,n){var t=Re.get(this);n?t[e.userId]={user:e,ts:(new Date).getTime()}:delete t[e.userId]}},{key:"isTyping",value:function(){var e=Re.get(this);return 0!==Object.keys(e).length}},{key:"registerScheduledUserMessage",value:function(e,n){var i=this,t=B.get(this._iid),a=t.ScheduledUserMessage,t=t.ScheduledUserMessageParams,t=T(V.parse(arguments,[new V({type:t,constraint:function(e){return"string"==typeof e.message&&"string"==typeof e._getScheduleString()}}),new V({type:"callback"})]),3),s=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){s?r(s,null):ce.get(i._iid).container.apiClient.registerScheduledUserMessage({groupChannelParams:e,channelUrl:i.url,isOpenChannel:!1},function(e,n){var t=null;e||(t=new a(n),(n=Zn.getInstance(i._iid).currentUser)&&t._sender&&n.userId===t._sender.userId&&(n.nickname=t._sender.nickname,n.plainProfileUrl=t._sender.plainProfileUrl,n.metaData=t._sender.metaData)),r(e,t)})},n)}},{key:"getPushPreference",value:function(e){var i=this;return ae(this._iid,function(r){ce.get(i._iid).container.apiClient.getMyPushTriggerOption({channelUrl:i.url},function(e,n){var t=null;if(!e){try{t=n.enable}catch(e){t=!1}i.isPushEnabled=t}r&&r(e,t)})},e)}},{key:"setPushPreference",value:function(e,n){var i=this;return ae(this._iid,function(t){var r=B.get(i._iid).GroupChannel;ce.get(i._iid).container.apiClient.setMyPushTriggerOption({channelUrl:i.url,enable:e},function(e,n){e||(i.isPushEnabled=n.enable,i.isPushEnabled||(i.myPushTriggerOption=r.PushTriggerOption.OFF)),t(e,n)})},n)}},{key:"getMyPushTriggerOption",value:function(e){var i=this;return ae(this._iid,function(r){ce.get(i._iid).container.apiClient.getMyPushTriggerOption({channelUrl:i.url},function(e,n){var t=null;if(!e){try{t=n.push_trigger_option||a.PushTriggerOption.DEFAULT}catch(e){he.debug(e)}i.myPushTriggerOption=t}r(e,t)})},e)}},{key:"setMyPushTriggerOption",value:function(e,n){var i=this,t=B.get(this._iid).GroupChannel,t=T(V.parse(arguments,[new V({type:t.PushTriggerOption}),new V({type:"callback"})]),3),a=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){a?r(a,null):ce.get(i._iid).container.apiClient.setMyPushTriggerOption({channelUrl:i.url,pushTriggerOption:e},function(e,n){var t=null;if(!e){try{t=n.push_trigger_option}catch(e){he.debug(e)}i.myPushTriggerOption=t}r(e,t)})},n)}},{key:"setMyCountPreference",value:function(e,n){var i=this,a=B.get(this._iid).GroupChannel,t=T(V.parse(arguments,[new V({type:a.CountPreference}),new V({type:"callback"})]),3),s=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){s?r(s,null):ce.get(i._iid).container.apiClient.setMyCountPreference({channelUrl:i.url,countPreference:e},function(e,n){var t=null;e||(t=i.myCountPreference=n.count_preference,i._setGroupChannelUnreadCount(i.unreadMessageCount,i.unreadMentionCount),a.cachedChannels[i.url]=i),r(e,t)})},n)}},{key:"resetMyHistory",value:function(e){var i=this;return ae(this._iid,function(r){ce.get(i._iid).container.apiClient.resetMyHistory({channelUrl:i.url},function(e,n){var t;!e&&n.hasOwnProperty("ts_message_offset")&&(t=B.get(i._iid).GroupChannel,i._messageOffsetTimestamp=n.ts_message_offset,t.cachedChannels[i.url]=i),r(e,n)})},e)}}],[{key:"MemberStateFilter",get:function(){return{ALL:"all",JOINED:"joined_only",INVITED:"invited_only",INVITED_BY_FRIEND:"invited_by_friend",INVITED_BY_NON_FRIEND:"invited_by_non_friend"}}},{key:"PushTriggerOption",get:function(){return{DEFAULT:"default",ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}},{key:"CountPreference",get:function(){return{ALL:"all",UNREAD_MESSAGE_COUNT_ONLY:"unread_message_count_only",UNREAD_MENTION_COUNT_ONLY:"unread_mention_count_only",OFF:"off"}}},{key:"HiddenState",get:function(){return{UNHIDDEN:"unhidden",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"PublicChannelFilter",get:function(){return{ALL:"all",PUBLIC:"public",PRIVATE:"private"}}},{key:"SuperChannelFilter",get:function(){return{ALL:"all",SUPER:"super",NON_SUPER:"nonsuper"}}},{key:"UnreadChannelFilter",get:function(){return{ALL:"all",UNREAD_MESSAGE:"unread_message"}}},{key:"HiddenChannelFilter",get:function(){return{UNHIDDEN:"unhidden_only",HIDDEN:"hidden_only",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"Role",get:function(){return{OPERATOR:"operator",NONE:"none"}}},{key:"UnreadItemKey",get:function(){return{GROUP_CHANNEL_UNREAD_MENTION_COUNT:"group_channel_unread_mention_count",NONSUPER_UNREAD_MENTION_COUNT:"non_super_group_channel_unread_mention_count",SUPER_UNREAD_MENTION_COUNT:"super_group_channel_unread_mention_count",GROUP_CHANNEL_UNREAD_MESSAGE_COUNT:"group_channel_unread_message_count",NONSUPER_UNREAD_MESSAGE_COUNT:"non_super_group_channel_unread_message_count",SUPER_UNREAD_MESSAGE_COUNT:"super_group_channel_unread_message_count",GROUP_CHANNEL_INVITATION_COUNT:"group_channel_invitation_count",NONSUPER_INVITATION_COUNT:"non_super_group_channel_invitation_count",SUPER_INVITATION_COUNT:"super_group_channel_invitation_count"}}},{key:"cachedChannels",get:function(){return Ne[this._iid]||(Ne[this._iid]={}),Ne[this._iid]}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid),t=n.User,r=n.Member,i=n.GroupChannel,a=n.BaseMessage,s=n.UserMessage,o=n.FileMessage,l=n.AdminMessage,n=se.deserialize(e),e=null!=(e=n.lastMessage)&&"object"===le(e)?e.messageType===a.MESSAGE_TYPE_USER?new s(s.objectify(g(g({},e),{},{channel:{url:e.channelUrl,channelType:e.channelType},user:e.sender,mentionedUsers:e.mentionedUsers}))):e.messageType===a.MESSAGE_TYPE_FILE?new o(o.objectify(g(g({},e),{},{channel:{url:e.channelUrl,channelType:e.channelType},user:e.sender,mentionedUsers:e.mentionedUsers}))):new l(l.objectify(g(g({},e),{},{channel:{url:e.channelUrl,channelType:e.channelType},mentionedUsers:e.mentionedUsers}))):null;return new i({channel_url:n.url,name:n.name,cover_url:n.coverUrl,data:n.data,custom_type:n.customType,invited_at:n.invitedAt,created_at:n.createdAt/1e3,is_access_code_required:n.isAccessCodeRequired,is_distinct:n.isDistinct,is_super:n.isSuper,is_broadcast:n.isBroadcast,is_public:n.isPublic,is_discoverable:n.isDiscoverable,is_hidden:n.isHidden,is_ephemeral:n.isEphemeral,is_muted:n.myMutedState,is_push_enabled:n.isPushEnabled,freeze:n.isFrozen,unread_message_count:n.unreadMessageCount,unread_mention_count:n.unreadMentionCount,push_trigger_option:n.myPushTriggerOption,count_preference:n.myCountPreference,hidden_state:n.hiddenState,member_count:n.memberCount,joined_member_count:n.joinedMemberCount,member_state:n.myMemberState,my_role:n.myRole,user_last_read:n.myLastRead,ts_message_offset:n.messageOffsetTimestamp,message_survival_seconds:n.messageSurvivalSeconds,read_receipt:n.cachedReadReceiptStatus,delivery_receipt:n.cachedDeliveryReceiptStatus,members:n.members.map(function(e){return r.objectify(g({user:e},e))}),last_message:e,created_by:null!==n.creator&&void 0!==n.creator&&"object"===le(n.creator)?t.objectify(n.creator):null,inviter:null!==n.inviter&&void 0!==n.inviter&&"object"===le(n.inviter)?t.objectify(n.inviter):null})}},{key:"upsert",value:function(e){var n,t=B.get(this._iid).GroupChannel,r=new t(e);return t.cachedChannels.hasOwnProperty(r.url)?(r.isEphemeral&&(n=t.cachedChannels[r.url],e.last_message=n.lastMessage,e.unread_message_count=n.unreadMessageCount),t.cachedChannels[r.url].update(e)):t.cachedChannels[r.url]=r,t.cachedChannels[r.url]}},{key:"removeCachedChannel",value:function(e){var n=B.get(this._iid),t=n.GroupChannel,n=n.FileMessageQueue;t.cachedChannels[e]&&delete t.cachedChannels[e],n.delete(e)}},{key:"clearCache",value:function(){Ne[this._iid]={},B.get(this._iid).FileMessageQueue.clear()}},{key:"getChannel",value:function(n,e){var t,r=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"string",optional:!0,nullable:!0,defaultValue:null}),new V({type:"callback"})]),4),i=r[0];if(n=r[1],t=r[2],e=r[3],i)return ae(this._iid,function(e){e(i,null)},e);var a=B.get(this._iid).GroupChannel;return a.cachedChannels[n]?ae(this._iid,function(e){e(null,a.cachedChannels[n])},e):a.getChannelWithoutCache(n,t,e)}},{key:"getChannelWithoutCache",value:function(e,n){var t,i=this,r=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"string",optional:!0,nullable:!0,defaultValue:null}),new V({type:"callback"})]),4),a=r[0];return e=r[1],t=r[2],n=r[3],ae(this._iid,function(r){a?r(a,null):ce.get(i._iid).container.apiClient.getGroupChannel({channelUrl:e,internalCall:t,showMember:!0},function(e,n){var t=null;e||(t=i.upsert(n)),r(e,t)})},n)}},{key:"createDistinctChannelIfNotExist",value:function(e,n){var a=this,t=B.get(this._iid).GroupChannelParams,t=T(V.parse(arguments,[new V({type:t,constraint:function(e){return e._validate()}}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],ae(this._iid,function(i){r?i(r,null):(e.isPublic||(e.accessCode=null),ce.get(a._iid).container.apiClient.createGroupChannel(g(g({},e),{},{isDistinct:!0}),function(e,n){var t,r=null;e||(r={channel:new(t=B.get(a._iid).GroupChannel)(n),isCreated:n.is_created},t.cachedChannels[r.channel.url]=r.channel),i(e,r)}))},n)}},{key:"createChannel",value:function(){var n=this,t=V.toArray(arguments),e=void 0;"function"==typeof t[t.length-1]&&(e=t.pop());var r=B.get(this._iid),i=r.GroupChannel,r=r.GroupChannelParams;if(t[0]instanceof r&&1===t.length)return ae(this._iid,function(r){var e=t[0];e.isPublic||(e.accessCode=null),e._validate()?ce.get(n._iid).container.apiClient.createGroupChannel(e,function(e,n){var t=null;e||(t=new i(n),i.cachedChannels[t.url]=t),r(e,t)}):r(V.error,null)},e);if(Array.isArray(t[0])){var a=new r;switch(t.length){case 1:a.addUsers(t[0]);break;case 2:a.addUsers(t[0]),a.isDistinct=t[1];break;case 3:a.addUsers(t[0]),a.isDistinct=t[1],a.customType=t[2];break;case 5:a.addUsers(t[0]),a.isDistinct=t[1],a.name=t[2],"string"==typeof t[3]?a.coverUrl=t[3]:a.coverImage=t[3],a.data=t[4];break;case 6:a.addUsers(t[0]),a.isDistinct=t[1],a.name=t[2],"string"==typeof t[3]?a.coverUrl=t[3]:a.coverImage=t[3],a.data=t[4],a.customType=t[5];break;default:return ae(this._iid,function(e){return e(V.error,null)},e)}return e?i.createChannel(a,e):i.createChannel(a)}return ae(this._iid,function(e){return e(V.error,null)},e)}},{key:"createChannelWithUserIds",value:function(){var e=V.toArray(arguments),n=void 0;"function"==typeof e[e.length-1]&&(n=e.pop());var t=B.get(this._iid),r=t.GroupChannel,i=new t.GroupChannelParams;switch(e.length){case 1:i.addUserIds(e[0]);break;case 2:i.addUserIds(e[0]),i.isDistinct=e[1];break;case 3:i.addUserIds(e[0]),i.isDistinct=e[1],i.customType=e[2];break;case 5:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4];break;case 6:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4],i.customType=e[5];break;default:return ae(this._iid,function(e){return e(V.error,null)},n)}return r.createChannel(i,n)}},{key:"createMyGroupChannelListQuery",value:function(){return new(B.get(this._iid).GroupChannelListQuery)}},{key:"createPublicGroupChannelListQuery",value:function(){return new(B.get(this._iid).PublicGroupChannelListQuery)}},{key:"markAsReadAllLastSentAt",get:function(){return ke[this._iid]||0},set:function(e){ke[this._iid]=e}},{key:"getChannelCount",value:function(e,n){return Zn.getInstance(this._iid).getGroupChannelCount(e,n)}},{key:"getUnreadItemCount",value:function(e,n){return Zn.getInstance(this._iid).getUnreadItemCount(e,n)}},{key:"getTotalUnreadMessageCount",value:function(){var e=V.toArray(arguments),n="function"==typeof e[e.length-1]?e.pop():null,t=Zn.getInstance(this._iid);return t.getTotalUnreadMessageCount.apply(t,C(e).concat([n]))}},{key:"getTotalUnreadChannelCount",value:function(e){return Zn.getInstance(this._iid).getTotalUnreadChannelCount(e)}}]),a}(),Le=function(){s(r,_e);var t=f(r);function r(e){var n;return c(this,r),(n=t.call(this,e)).state="",n.role="",n.isMuted=!1,n.isBlockedByMe=!1,n.isBlockingMe=!1,e&&n._update(e),n}return o(r,[{key:"_update",value:function(e){this.state=e.state,this.role=e.role||Me.Role.NONE,e.hasOwnProperty("is_muted")&&(this.isMuted=e.is_muted),e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me),e.hasOwnProperty("is_blocking_me")&&(this.isBlockingMe=e.is_blocking_me)}},{key:"parse",value:function(e){this._update(e)}}],[{key:"objectify",value:function(e){var n=B.get(this._iid).User,t=e.user,r=e.state,i=e.role,a=void 0===i?"":i,s=e.isMuted,i=void 0!==s&&s,s=e.isBlockedByMe,s=void 0!==s&&s,e=e.isBlockingMe,e=void 0!==e&&e,t=n.objectify(t);return t.state=r,t.role=a,t.is_muted=i,t.is_blocked_by_me=s,t.is_blocking_me=e,t}},{key:"build",value:function(e,n,t,r,i,a){var s=B.get(this._iid).User;return this.objectify({user:new s(e),state:n,role:t,isMuted:r,isBlockedByMe:i,isBlockingMe:a})}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid).Member,e=se.deserialize(e);return new n(n.objectify(g({user:e},e)))}},{key:"JOINED",get:function(){return"joined"}},{key:"INVITED",get:function(){return"invited"}}]),r}(),Pe=function(){s(r,_e);var t=f(r);function r(e){var n;return c(this,r),(n=t.call(this,e)).role="",n.isBlockedByMe=!1,e&&n._update(e),n}return o(r,[{key:"parse",value:function(e){this._update(e)}},{key:"_update",value:function(e){this.role=e.role||Me.Role.NONE,e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me)}}],[{key:"objectify",value:function(e){var n=B.get(this._iid).User,t=e.user,r=e.role,r=void 0===r?"":r,e=e.isBlockedByMe,e=void 0!==e&&e,t=n.objectify(t);return t.role=r,t.is_blocked_by_me=e,t}},{key:"build",value:function(e,n){var t=B.get(this._iid).User;return this.objectify({user:new t(e),isBlockedByMe:n})}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid).Sender,e=se.deserialize(e);return new n(n.objectify(g({user:e},e)))}}]),r}(),we=function(){function n(e){c(this,n),this.emojiHash=null,this.emojiCategories=null,e&&this._update(e)}return o(n,[{key:"_update",value:function(e){var n=B.get(this._iid).EmojiCategory;this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map(function(e){return new n(e)}):[]}}]),n}(),De=function(){function n(e){c(this,n),this.id=null,this.name=null,this.url=null,this.emojis=null,e&&this._update(e)}return o(n,[{key:"_update",value:function(e){var n=B.get(this._iid).Emoji;this.id=e.id||0,this.name=e.name||"",this.url=e.url||"",this.emojis=e.emojis?e.emojis.map(function(e){return new n(e)}):[]}}]),n}(),He=function(){function n(e){c(this,n),this.key=null,this.url=null,e&&this._update(e)}return o(n,[{key:"_update",value:function(e){this.key=e.key,this.url=e.url}}]),n}(),Fe={},Ge={},Be=function(){s(r,ve);var t=f(r);function r(e){var n;return c(this,r),(n=t.call(this,e)).channelType=ve.CHANNEL_TYPE_OPEN,n.participantCount=0,n.operators=[],e&&n._update(e),n}return o(r,[{key:"_update",value:function(e){var n=B.get(this._iid).User;e.hasOwnProperty("participant_count")&&(this.participantCount=parseInt(e.participant_count)),e.hasOwnProperty("operators")&&Array.isArray(e.operators)&&(this.operators=e.operators.map(function(e){return new n(e)}))}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"createParticipantListQuery",value:function(){return new(B.get(this._iid).ParticipantListQuery)({channelUrl:this.url})}},{key:"createMutedUserListQuery",value:function(){return new(B.get(this._iid).MutedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"createBannedUserListQuery",value:function(){return new(B.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"isOperator",value:function(e){return!!e&&this.isOperatorWithUserId(e.userId)}},{key:"isOperatorWithUserId",value:function(e){return-1<this.operators.map(function(e){return e.userId}).indexOf(e)}},{key:"refresh",value:function(e){return B.get(this._iid).OpenChannel.getChannelWithoutCache(this.url,e)}},{key:"enter",value:function(e){var a=this;return ae(this._iid,function(r){var e=B.get(a._iid).Command.bEnter({channelUrl:a.url}),i=Zn.getInstance(a._iid);i.sendCommand(e,function(e,n){var t;i.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n?(n=n?new de(n.message,n.code):null,r(n,null)):(B.get(a._iid).OpenChannel.enteredChannels[a.url]=a).refresh(function(){return r(null,null)})})},e)}},{key:"exit",value:function(e){var s=this;return ae(this._iid,function(r){var e=B.get(s._iid),n=e.Command,i=e.FileMessageQueue,n=n.bExit({channelUrl:s.url}),a=Zn.getInstance(s._iid);a.sendCommand(n,function(e,n){var t;a.getErrorFirstCallback()&&(n=(t=[e,n])[0],e=t[1]),n?(n=n?new de(n.message,n.code):null,r(n,null)):(delete B.get(s._iid).OpenChannel.enteredChannels[s.url],i.delete(s.url),r(null,null))})},e)}},{key:"updateChannel",value:function(){var n=this,t=V.toArray(arguments),e=null;"function"==typeof t[t.length-1]&&(e=t.pop());var r=B.get(this._iid),i=r.OpenChannel,r=r.OpenChannelParams;if(t[0]instanceof r&&1===t.length)return ae(this._iid,function(r){var e=t[0];e.channelUrl=n.url,e._validate()?ce.get(n._iid).container.apiClient.updateOpenChannel(e,function(e,n){var t=null;e||(t=i.upsert(n)),r(e,t)}):r(V.error,null)},e);if(3===t.length){var a=new r;return a.channelUrl=this.url,a.name=t[0],a.coverUrlOrImage=t[1],a.data=t[2],a.operatorUserIds=this.operators.map(function(e){return e.userId}),this.updateChannel(a,e)}if(4===t.length){a=new r;return a.channelUrl=this.url,a.name=t[0],a.coverUrlOrImage=t[1],a.data=t[2],Array.isArray(t[3])&&(a.operatorUserIds=t[3]),this.updateChannel(a,e)}if(5!==t.length)return ae(this._iid,function(e){return e(V.error,null)},e);r=new r;return r.channelUrl=this.url,r.name=t[0],r.coverUrlOrImage=t[1],r.data=t[2],Array.isArray(t[3])&&(r.operatorUserIds=t[3]),r.customType=t[4],this.updateChannel(r,e)}},{key:"updateChannelWithOperatorUserIds",value:function(){var e=V.toArray(arguments),n=void 0;switch("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){case 4:case 5:return this.updateChannel.apply(this,C(e).concat([n]));default:return ae(this._iid,function(e){return e(V.error,null)},n)}}},{key:"muteUser",value:function(e,n,t,r){return this.muteUserWithUserId(e?e.userId:null,n,t,r)}},{key:"muteUserWithUserId",value:function(e,n,r,t){var i=this,a=T(V.parse(arguments,[new V({type:"string"}),new V({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new V({type:"string",optional:!0,defaultValue:""}),new V({type:"callback"})]),5),s=a[0];return e=a[1],n=a[2],r=a[3],t=a[4],ae(this._iid,function(t){s?t(s,null):ce.get(i._iid).container.apiClient.muteUser({channelUrl:i.url,userId:e,description:r,seconds:n,isGroupChannel:!1},function(e,n){t(e,null)})},t)}},{key:"unmuteUser",value:function(e,n){return this.unmuteUserWithUserId(e?e.userId:null,n)}},{key:"unmuteUserWithUserId",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.unmuteUser({channelUrl:r.url,userId:e,isGroupChannel:!1},function(e,n){t(e,null)})},n)}},{key:"banUser",value:function(e,n,t){return this.banUserWithUserId(e?e.userId:null,n,t)}},{key:"banUserWithUserId",value:function(e,n,t){var r=this,i=T(V.parse(arguments,[new V({type:"string"}),new V({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new V({type:"callback"})]),4),a=i[0];return e=i[1],n=i[2],t=i[3],ae(this._iid,function(t){a?t(a,null):ce.get(r._iid).container.apiClient.banUser({channelUrl:r.url,userId:e,description:null,seconds:n,isGroupChannel:!1},function(e,n){t(e,null)})},t)}},{key:"unbanUser",value:function(e,n){return this.unbanUserWithUserId(e?e.userId:null,n)}},{key:"unbanUserWithUserId",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.unbanUser({channelUrl:r.url,userId:e,isGroupChannel:!1},function(e,n){t(e,null)})},n)}},{key:"delete",value:function(e){var r=this;return ae(this._iid,function(t){ce.get(r._iid).container.apiClient.deleteOpenChannel({channelUrl:r.url},function(e,n){e||(delete B.get(r._iid).OpenChannel.cachedChannels[r.url],B.get(r._iid).FileMessageQueue.delete(r.url)),t(e,n)})},e)}}],[{key:"cachedChannels",get:function(){return Fe[this._iid]||(Fe[this._iid]={}),Fe[this._iid]}},{key:"enteredChannels",get:function(){return Ge[this._iid]||(Ge[this._iid]={}),Ge[this._iid]}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid),t=n.User,n=n.OpenChannel,e=se.deserialize(e);return new n({channel_url:e.url,name:e.name,cover_url:e.coverUrl,data:e.data,custom_type:e.customType,created_at:e.createdAt/1e3,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,participant_count:e.participantCount,operators:e.operators.map(function(e){return t.objectify(e)})})}},{key:"getChannel",value:function(n,e){var t,r=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"string",optional:!0,nullable:!0,defaultValue:null}),new V({type:"callback"})]),4),i=r[0];if(n=r[1],t=r[2],e=r[3],i)return ae(this._iid,function(e){e(i,null)},e);var a=B.get(this._iid).OpenChannel;return a.cachedChannels[n]?ae(this._iid,function(e){e(null,a.cachedChannels[n])},e):a.getChannelWithoutCache(n,t,e)}},{key:"getChannelWithoutCache",value:function(e,n){var t,i=this,r=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"string",optional:!0,nullable:!0,defaultValue:null}),new V({type:"callback"})]),4),a=r[0];return e=r[1],t=r[2],n=r[3],ae(this._iid,function(r){a?r(a,null):ce.get(i._iid).container.apiClient.getOpenChannel({channelUrl:e,internalCall:t},function(e,n){var t=null;e||(t=B.get(i._iid).OpenChannel.upsert(n)),r(e,t)})},n)}},{key:"createChannel",value:function(){var i=this,n=V.toArray(arguments),e=null;"function"==typeof n[n.length-1]&&(e=n.pop());var t=B.get(this._iid),r=t.OpenChannel,t=t.OpenChannelParams;if(n[0]instanceof t&&1===n.length)return ae(this._iid,function(r){var e=n[0];e._validate()?ce.get(i._iid).container.apiClient.createOpenChannel(e,function(e,n){var t=null;e||(t=B.get(i._iid).OpenChannel.upsert(n)),r(e,t)}):r(V.error,null)},e);var a=new t;switch(n.length){case 0:break;case 1:a.name=n[0];break;case 2:a.name=n[0],a.coverUrlOrImage=n[1];break;case 3:a.name=n[0],a.coverUrlOrImage=n[1],a.data=n[2];break;case 4:a.name=n[0],a.coverUrlOrImage=n[1],a.data=n[2],a.operatorUserIds=n[3];break;case 5:a.name=n[0],a.coverUrlOrImage=n[1],a.data=n[2],a.operatorUserIds=n[3],a.customType=n[4];break;default:return ae(this._iid,function(e){return e(V.error,null)},e)}return e?r.createChannel(a,e):r.createChannel(a)}},{key:"createChannelWithOperatorUserIds",value:function(){var e=V.toArray(arguments),n=void 0;switch("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){case 4:case 5:return this.createChannel.apply(this,C(e).concat([n]));default:return ae(this._iid,function(e){return e(V.error,null)},n)}}},{key:"upsert",value:function(e){var n=new(B.get(this._iid).OpenChannel)(e);return this.cachedChannels.hasOwnProperty(n.url)?this.cachedChannels[n.url].update(e):this.cachedChannels[n.url]=n,this.cachedChannels[n.url]}},{key:"removeCachedChannel",value:function(e){this.cachedChannels[e]&&delete this.cachedChannels[e],B.get(this._iid).FileMessageQueue.delete(e)}},{key:"clearCache",value:function(){Fe[this._iid]={},B.get(this._iid).FileMessageQueue.clear()}},{key:"clearEnteredChannels",value:function(){Ge[this._iid]={}}},{key:"createOpenChannelListQuery",value:function(){return new(B.get(this._iid).OpenChannelListQuery)}}]),r}(),xe=function(){s(r,fe);var t=f(r);function r(e){var n;return c(this,r),(n=t.call(this,e)).messageType=fe.MESSAGE_TYPE_USER,n.message=null,n._sender=null,n.reqId="",n.translations={},n.requestState=null,n.requestedMentionUserIds=[],n.errorCode=0,n.messageSurvivalSeconds=-1,n.plugins=[],e&&n._update(e),n}return o(r,[{key:"_update",value:function(e){var n=Zn.getInstance(this._iid),t=B.get(this._iid),r=t.Sender,i=t.Plugin;this.message=String(e.message),this._sender=new r(e.user),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.translations=e.hasOwnProperty("translations")?e.translations:{},this.requestState=0<this.messageId?n.MessageRequestState.SUCCEEDED:n.MessageRequestState.FAILED,e.hasOwnProperty("sending_status")&&(this.requestState=e.sending_status,this.requestState===n.MessageSendingStatus.CANCELED&&(this.requestState=n.MessageRequestState.FAILED)),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code),this.messageSurvivalSeconds=-1,e.hasOwnProperty("message_survival_seconds")&&(this.messageSurvivalSeconds=e.message_survival_seconds),this.plugins=[],e.hasOwnProperty("plugins")&&Array.isArray(e.plugins)&&(this.plugins=e.plugins.map(function(e){return new i(e)}))}},{key:"sender",get:function(){var e=Zn.getInstance(this._iid),n=B.get(this._iid).GroupChannel;return e.Options.useMemberAsMessageSender&&this.isGroupChannel()&&(!(n=n.cachedChannels[this.channelUrl])||(n=n.memberMap[this._sender.userId])&&(this._sender.nickname!==n.nickname&&(this._sender.nickname=n.nickname),this._sender.plainProfileUrl!==n.plainProfileUrl&&(this._sender.plainProfileUrl=n.plainProfileUrl),pe.deepEqual(this._sender.metaData,n.metaData)||(this._sender.metaData=n.metaData))),this._sender},set:function(e){this._sender=e}},{key:"isResendable",value:function(){var e=Zn.getInstance(this._iid);return this.sendingStatus===e.MessageSendingStatus.FAILED&&pe.isResendableError(this.errorCode)}}],[{key:"objectify",value:function(e){var n,t=Zn.getInstance(this._iid),r=B.get(this._iid),i=r.BaseChannel,a=r.BaseMessageParams,s=r.Sender,o=r.User,l=r.ThreadInfo,u=r.OGMetaData,c=r.Plugin,d=e.messageId,h=e.reqId,p=void 0===h?"":h,g=e.user,y=e.channel,f=e.message,_=e.data,m=void 0===_?"":_,v=e.customType,E=void 0===v?"":v,C=e.mentionType,U=void 0===C?a.MentionType.USERS:C,b=e.mentionedUsers,A=void 0===b?[]:b,S=e.mentionedUserIds,I=void 0===S?[]:S,N=e.requestedMentionUserIds,k=void 0===N?[]:N,R=e.reactions,T=void 0===R?[]:R,O=e.metaArrays,M=void 0===O?[]:O,L=e.rootMessageId,P=void 0===L?0:L,w=e.parentMessageId,r=void 0===w?0:w,h=e.parentMessageText,_=void 0===h?"":h,v=e.threadInfo,a=void 0===v?null:v,C=e.translations,b=void 0===C?{}:C,S=e.sendingStatus,N=e.errorCode,R=void 0===N?0:N,O=e.silent,L=void 0!==O&&O,w=e.isGlobalBlocked,h=void 0!==w&&w,v=e.messageSurvivalSeconds,C=void 0===v?-1:v,N=e.ogMetaData,O=void 0===N?null:N,w=e.isOperatorMessage,v=void 0!==w&&w,N=e.plugins,w=void 0===N?[]:N,N=e.createdAt,e=e.updatedAt,e=void 0===e?0:e,D={};for(n in D.req_id=p,D.msg_id=d,D.user=s.objectify({user:g,role:t.currentUser&&t.currentUser.userId===g.userId?y.myRole:g.role,isBlockedByMe:g.isBlockedByMe}),D.channel_url=y.url,D.channel_type=y.channelType===i.CHANNEL_TYPE_OPEN?i.CHANNEL_TYPE_OPEN:i.CHANNEL_TYPE_GROUP,D.message=f,D.data=m,D.custom_type=E,D.translations=b,D.is_global_block=!!h,D.ts=N,D.updated_at=e,D.mention_type=U,D.mentioned_users=A.map(function(e){return o.objectify(e)}),D.mentioned_user_ids=I,D.requested_mention_user_ids=k,D.reactions=T.map(function(e){return e.serialize()}),D.metaarray={},M){var H=M[n].key;D.metaarray[H]=M[n].value}return D.metaarray_key_order=M.map(function(e){return e.key}),D.root_message_id=P,D.parent_message_id=r,D.parent_message_text=_,a&&(D.thread_info=l.objectify(a)),D.sending_status=0<d?t.MessageSendingStatus.SUCCEEDED:t.MessageSendingStatus.FAILED,S&&(D.sending_status=S),D.silent=!!L,D.error_code=R,D.message_survival_seconds=C,O&&(D.og_tag=u.objectify(O)),D.is_op_msg=!!v,D.plugins=w.map(function(e){return c.objectify(e)}),D}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c,d,h,p,g,y,f,_,m,v,E,C,U,b,A,S,I){return this.objectify({messageId:n,reqId:e,user:t,channel:r,message:i,data:a,customType:s,mentionType:p,mentionedUsers:g,mentionedUserIds:v,requestedMentionUserIds:C,reactions:h,metaArrays:d,rootMessageId:y,parentMessageId:f,parentMessageText:_,threadInfo:m,translations:o,sendingStatus:E,errorCode:U,isGlobalBlocked:l,messageSurvivalSeconds:b,ogMetaData:A,isOperatorMessage:S,plugins:I,createdAt:u,updatedAt:c})}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid).UserMessage,e=se.deserialize(e);return new n(n.objectify(g(g({},e),{},{channel:{url:e.channelUrl,channelType:e.channelType},user:e.sender})))}}]),r}(),je=function(){s(r,fe);var t=f(r);function r(e){var n;return c(this,r),(n=t.call(this,e)).messageType=fe.MESSAGE_TYPE_FILE,n.plainUrl=null,n.name="File",n.size=0,n.type=null,n.thumbnails=[],n._sender=null,n.reqId="",n.requireAuth=null,n.requestState=null,n.requestedMentionUserIds=[],n.errorCode=0,n.messageSurvivalSeconds=-1,e&&n._update(e),n}return o(r,[{key:"_update",value:function(e){var n=Zn.getInstance(this._iid),t=ce.get(this._iid).container.auth,r=B.get(this._iid).Sender;if(this._sender=new r(e.user),this.requireAuth=!!e.hasOwnProperty("require_auth")&&e.require_auth,this.plainUrl=String(e.url).split("?auth=")[0],Object.defineProperty(this,"url",{value:this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(t.eKey):this.plainUrl,configurable:!0,writable:!1}),this.name=e.hasOwnProperty("name")?e.name:"File",this.size=parseInt(e.size)||0,this.type=String(e.type),e.hasOwnProperty("custom")&&(this.data=String(e.custom)),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.thumbnails=e.hasOwnProperty("thumbnails")?e.thumbnails:[],this.requireAuth)for(var i in this.thumbnails)this.thumbnails[i].plainUrl=String(this.thumbnails[i].url).split("?auth=")[0],this.thumbnails[i].url=this.requireAuth?"".concat(this.thumbnails[i].plainUrl,"?auth=").concat(t.eKey):this.thumbnails[i].plainUrl;this.requestState=0<this.messageId?n.MessageRequestState.SUCCEEDED:n.MessageRequestState.FAILED,e.hasOwnProperty("sending_status")&&(this.requestState=e.sending_status,this.requestState===n.MessageSendingStatus.CANCELED&&(this.requestState=n.MessageRequestState.FAILED)),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code),this.messageSurvivalSeconds=-1,e.hasOwnProperty("message_survival_seconds")&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"sender",get:function(){var e=Zn.getInstance(this._iid),n=B.get(this._iid).GroupChannel;return e.Options.useMemberAsMessageSender&&this.isGroupChannel()&&(!(n=n.cachedChannels[this.channelUrl])||(n=n.memberMap[this._sender.userId])&&(this._sender.nickname!==n.nickname&&(this._sender.nickname=n.nickname),this._sender.plainProfileUrl!==n.plainProfileUrl&&(this._sender.plainProfileUrl=n.plainProfileUrl),pe.deepEqual(this._sender.metaData,n.metaData)||(this._sender.metaData=n.metaData))),this._sender},set:function(e){this._sender=e}},{key:"isResendable",value:function(){var e=Zn.getInstance(this._iid);return this.sendingStatus===e.MessageSendingStatus.FAILED&&pe.isResendableError(this.errorCode)}}],[{key:"objectify",value:function(e){var n=Zn.getInstance(this._iid),t=B.get(this._iid),r=t.BaseChannel,i=t.BaseMessageParams,a=t.Sender,s=t.User,o=t.ThreadInfo,l=t.OGMetaData,u=e.messageId,c=e.reqId,d=void 0===c?"":c,h=e.user,p=void 0===h?{}:h,g=e.channel,y=e.plainUrl,f=e.name,_=e.type,m=e.size,v=void 0===m?0:m,E=e.data,C=void 0===E?"":E,U=e.customType,b=void 0===U?"":U,A=e.mentionType,S=void 0===A?i.MentionType.USERS:A,I=e.mentionedUsers,N=void 0===I?[]:I,k=e.mentionedUserIds,R=void 0===k?[]:k,T=e.requestedMentionUserIds,O=void 0===T?[]:T,M=e.reactions,L=void 0===M?[]:M,P=e.metaArrays,w=void 0===P?[]:P,D=e.rootMessageId,t=void 0===D?0:D,c=e.parentMessageId,h=void 0===c?0:c,m=e.parentMessageText,E=void 0===m?"":m,U=e.threadInfo,i=void 0===U?null:U,A=e.thumbnails,I=void 0===A?[]:A,k=e.requireAuth,T=void 0!==k&&k,M=e.sendingStatus,P=e.errorCode,D=void 0===P?0:P,c=e.silent,m=void 0!==c&&c,U=e.isGlobalBlocked,A=void 0!==U&&U,k=e.messageSurvivalSeconds,P=void 0===k?-1:k,c=e.ogMetaData,U=void 0===c?null:c,k=e.isOperatorMessage,c=void 0!==k&&k,k=e.createdAt,e=e.updatedAt,e=void 0===e?0:e,H={};H.req_id=d,H.msg_id=u,H.user=a.objectify({user:p,role:n.currentUser&&n.currentUser.userId===p.userId?g.myRole:p.role,isBlockedByMe:p.isBlockedByMe}),H.channel_url=g.url,H.channel_type=g.channelType===r.CHANNEL_TYPE_OPEN?r.CHANNEL_TYPE_OPEN:r.CHANNEL_TYPE_GROUP,H.url=y,H.name=f,H.type=_,H.size=v,H.custom=C,H.custom_type=b,H.thumbnails=I,H.require_auth=T,H.is_global_block=!!A,H.ts=k,H.updated_at=e,H.mention_type=S,H.mentioned_users=N.map(function(e){return s.objectify(e)}),H.mentioned_user_ids=R,H.requested_mention_user_ids=O,H.reactions=L.map(function(e){return e.serialize()}),H.metaarray={};for(var F=0;F<w.length;F++){var G=w[F].key;H.metaarray[G]=w[F].value}return H.metaarray_key_order=w.map(function(e){return e.key}),H.root_message_id=t,H.parent_message_id=h,H.parent_message_text=E,i&&(H.thread_info=o.objectify(i)),H.sending_status=0<u?n.MessageSendingStatus.SUCCEEDED:n.MessageSendingStatus.FAILED,M&&(H.sending_status=M),H.silent=!!m,H.error_code=D,H.message_survival_seconds=P,U&&(H.og_tag=l.objectify(U)),H.is_op_msg=!!c,H}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c,d,h,p,g,y,f,_,m,v,E,C,U,b,A,S,I,N,k,R){return this.objectify({messageId:n,reqId:e,user:t,channel:r,plainUrl:i,name:a,type:s,size:o,data:l,customType:u,mentionType:_,mentionedUsers:m,mentionedUserIds:b,requestedMentionUserIds:S,reactions:f,metaArrays:y,rootMessageId:v,parentMessageId:E,parentMessageText:C,threadInfo:U,thumbnails:h,requireAuth:p,sendingStatus:A,errorCode:I,isGlobalBlocked:c,messageSurvivalSeconds:N,ogMetaData:k,isOperatorMessage:R,createdAt:d,updatedAt:g})}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid).FileMessage,e=se.deserialize(e);return new n(n.objectify(g(g({},e),{},{channel:{url:e.channelUrl,channelType:e.channelType},user:e.sender})))}}]),r}(),qe=function(){s(r,fe);var t=f(r);function r(e){var n;return c(this,r),(n=t.call(this,e)).messageType=fe.MESSAGE_TYPE_ADMIN,n.message="",n.translations={},e&&n._update(e),n}return o(r,[{key:"_update",value:function(e){this.message=String(e.message),this.translations=e.hasOwnProperty("translations")?e.translations:{}}}],[{key:"objectify",value:function(e){var n=B.get(this._iid),t=n.BaseChannel,r=n.BaseMessageParams,i=n.User,a=n.ThreadInfo,s=n.OGMetaData,o=e.messageId,l=e.channel,u=e.message,c=e.data,d=void 0===c?"":c,h=e.customType,p=void 0===h?"":h,g=e.mentionType,y=void 0===g?r.MentionType.USERS:g,f=e.mentionedUsers,_=void 0===f?[]:f,m=e.reactions,v=void 0===m?[]:m,E=e.metaArrays,C=void 0===E?[]:E,n=e.rootMessageId,c=void 0===n?0:n,h=e.parentMessageId,r=void 0===h?0:h,g=e.parentMessageText,f=void 0===g?"":g,m=e.threadInfo,E=void 0===m?null:m,n=e.translations,h=void 0===n?{}:n,g=e.silent,m=void 0!==g&&g,n=e.ogMetaData,g=void 0===n?null:n,n=e.createdAt,e=e.updatedAt,e=void 0===e?0:e,U={msg_id:o,channel_url:l.url,channel_type:l.channelType===t.CHANNEL_TYPE_OPEN?t.CHANNEL_TYPE_OPEN:t.CHANNEL_TYPE_GROUP,message:u,data:d,custom_type:p,silent:m,ts:n,updated_at:e};U.translations=h,U.mention_type=y,U.mentioned_users=_.map(function(e){return i.objectify(e)}),U.reactions=v.map(function(e){return e.serialize()}),U.metaarray={};for(var b=0;b<C.length;b++){var A=C[b].key;U.metaarray[A]=C[b].value}return U.metaarray_key_order=C.map(function(e){return e.key}),U.root_message_id=c,U.parent_message_id=r,U.parent_message_text=f,E&&(U.thread_info=a.objectify(E)),g&&(U.og_tag=s.objectify(g)),U}},{key:"build",value:function(e,n,t,r,i,a,s,o,l,u,c,d,h,p,g,y,f){return this.objectify({messageId:e,channel:n,message:t,data:r,customType:i,mentionType:c,mentionedUsers:d,reactions:u,metaArrays:l,rootMessageId:h,parentMessageId:p,parentMessageText:g,threadInfo:y,translations:a,ogMetaData:f,createdAt:s,updatedAt:o})}},{key:"buildFromSerializedData",value:function(e){var n=B.get(this._iid).AdminMessage,e=se.deserialize(e);return new n(n.objectify(g(g({},e),{},{channel:{url:e.channelUrl,channelType:e.channelType}})))}}]),r}(),ze=function(){function d(e){c(this,d);var n=B.get(this._iid),t=n.BaseMessage,n=n.BaseMessageParams;this.scheduledId=0,this.scheduledDateTimeString="",this.scheduledTimezone="",this.status=d.Status.SCHEDULED,this.createdAt=0,this.updatedAt=0,this._messageType=t.MESSAGE_TYPE_BASE,this._sender=null,this._channelType="",this.channelUrl="",this.message="",this.customType="",this.data="",this.metaArrays=[],this.mentionType=n.MentionType.USERS,this.mentionedUsers=[],this.pushNotificationDeliveryOption=n.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=[],this.errorMessage="",this.errorCode=0,e&&this._update(e)}return o(d,[{key:"sender",get:function(){var e=Zn.getInstance(this._iid),n=B.get(this._iid).GroupChannel;return e.Options.useMemberAsMessageSender&&this.isGroupChannel()&&(!(n=n.cachedChannels[this.channelUrl])||(n=n.memberMap[this._sender.userId])&&(this._sender.nickname!==n.nickname&&(this._sender.nickname=n.nickname),this._sender.plainProfileUrl!==n.plainProfileUrl&&(this._sender.plainProfileUrl=n.plainProfileUrl),pe.deepEqual(this._sender.metaData,n.metaData)||(this._sender.metaData=n.metaData))),this._sender},set:function(e){this._sender=e}},{key:"_update",value:function(e){var n=this,t=B.get(this._iid),r=t.User,i=t.Sender,a=t.BaseMessageParams,s=t.MessageMetaArray;this.scheduledId=e.hasOwnProperty("scheduled_id")?parseInt(e.scheduled_id):0,this.scheduledDateTimeString=e.hasOwnProperty("scheduled_dt")?String(e.scheduled_dt):"",this.scheduledTimezone=e.hasOwnProperty("scheduled_timezone")?String(e.scheduled_timezone):"",this.status=e.hasOwnProperty("status")?String(e.status):"",this.createdAt=e.hasOwnProperty("created_at")?parseInt(e.created_at):0,this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this._channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):"",this._messageType=e.hasOwnProperty("type")?String(e.type):"",this._sender=e.hasOwnProperty("user")?new i(e.user):null,this.message=e.hasOwnProperty("message")?String(e.message):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.data=e.hasOwnProperty("data")?String(e.data):"";var o=e.hasOwnProperty("metaarray")?e.metaarray:{},l=e.hasOwnProperty("metaarray_key_order")?e.metaarray_key_order:Object.keys(o).sort(function(e,n){return e.localeCompare(n)});this.metaArrays=[];for(var u=0;u<l.length;u++){var c=l[u];this.metaArrays.push(new s(c,o[c]||[]))}this.mentionType=e.hasOwnProperty("mention_type")?e.mention_type:a.MentionType.USERS,this.mentionedUsers=[],e.hasOwnProperty("mentioned_users")&&e.mentioned_users.forEach(function(e){e=new r(e);n.mentionedUsers.push(e)}),this.pushNotificationDeliveryOption=e.hasOwnProperty("push_option")?e.push_option:a.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=e.hasOwnProperty("translation_target_langs")?e.translation_target_langs:[],this.status===d.Status.FAILED&&(e.hasOwnProperty("error")&&e.error.hasOwnProperty("message")&&(this.errorMessage=String(e.error.message)),e.hasOwnProperty("error")&&e.error.hasOwnProperty("code")&&(this.errorCode=parseInt(e.error.code)))}},{key:"isOpenChannel",value:function(){var e=B.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=B.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_GROUP}},{key:"metaArray",get:function(){var n={};return this.metaArrays.forEach(function(e){n[e.key]=e.value}),n},set:function(e){if("object"===le(e)&&e){var n,t=B.get(this._iid).MessageMetaArray,r=[];for(n in e)r.push(new t(n,e[n]));this.metaArrays=r}}}],[{key:"Status",get:function(){return{SCHEDULED:"scheduled",SENT:"sent",CANCELED:"canceled",FAILED:"failed"}}}]),d}(),Qe=function(){function e(){c(this,e),this.threadInfo=null,this.targetMessageId=0,this.channelUrl=null,this.channelType=null}return o(e,null,[{key:"createFromJson",value:function(e){var n=B.get(this._iid),t=n.BaseChannel,r=n.ThreadInfo,i=e.thread_info,a=e.root_message_id,n=e.channel_url,e=e.channel_type;if(!i||"object"!==le(i)||"string"!=typeof a&&"number"!=typeof a||"string"!=typeof n||"string"!=typeof e||![t.CHANNEL_TYPE_GROUP].includes(e))return null;t=new this;return t.threadInfo=new r(i),t.targetMessageId=parseInt(a),t.channelUrl=n,t.channelType=e,t}}]),e}(),Ye=function(){function e(){c(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this.metaDataKeyFilter="",this.metaDataValuesFilter=[],this.nicknameStartsWithFilter=null,this._token=""}return o(e,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIdsFilter)&&"string"==typeof s.metaDataKeyFilter&&Array.isArray(s.metaDataValuesFilter)&&!!s.metaDataKeyFilter==0<s.metaDataValuesFilter.length&&("string"==typeof s.nicknameStartsWithFilter||null===s.nicknameStartsWithFilter)?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadUserList(g(g({},s),{},{token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.users.map(function(e){return new t(e)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),e}(),Ke=function(){function n(e){c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._isOpenChannel=!1,this._channelUrl=null,this._token="",e.channelUrl&&(this._channelUrl=e.channelUrl),e.isOpenChannel&&(this._isOpenChannel=e.isOpenChannel)}return o(n,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadBannedUserList(g(g({},s),{},{channelUrl:s._channelUrl,isOpenChannel:s._isOpenChannel,token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.banned_list.map(function(e){return new t(e.user)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),n}(),Ve=function(){function e(){c(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this._token=""}return o(e,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIdsFilter)?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadBlockedUserList(g(g({},s),{},{token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.users.map(function(e){return new t(e)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),e}(),We=function(){function e(){c(this,e),this.isLoading=!1,this.hasMore=!0,this.limit=20,this._token=""}return o(e,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasMore?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadFriendList(g(g({},s),{},{token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasMore=!!r,i=n.users.map(function(e){return new t(e)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),e}(),Je=function(){function n(){c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=n.ORDER_LATEST_LAST_MESSAGE,this._token="",this._searchFilter={},this._userIdsFilter={userIds:[],includeMode:!0,queryType:n.QueryType.AND},this._userIdsExactFilter=[],this._userIdsIncludeFilter=[],this._userIdsIncludeFilterQueryType=n.QueryType.AND,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=Me.MemberStateFilter.ALL,this.customTypesFilter=[],this.channelUrlsFilter=[],this.superChannelFilter=Me.SuperChannelFilter.ALL,this.publicChannelFilter=Me.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=Me.UnreadChannelFilter.ALL,this.metadataOrderKeyFilter=null,this.hiddenChannelFilter=Me.HiddenChannelFilter.UNHIDDEN,this.includeFrozen=!0}return o(n,[{key:"userIdsExactFilter",get:function(){return this._userIdsExactFilter},set:function(e){Array.isArray(e)&&(this._userIdsExactFilter=e,this._userIdsIncludeFilter=[],this._userIdsFilter.userIds=this._userIdsExactFilter,this._userIdsFilter.includeMode=!1)}},{key:"userIdsIncludeFilter",get:function(){return this._userIdsIncludeFilter},set:function(e){Array.isArray(e)&&(this._userIdsIncludeFilter=e,this._userIdsExactFilter=[],this._userIdsFilter.userIds=this._userIdsIncludeFilter,this._userIdsFilter.includeMode=!0)}},{key:"userIdsIncludeFilterQueryType",get:function(){return this._userIdsIncludeFilterQueryType},set:function(e){-1<Object.keys(n.QueryType).map(function(e){return n.QueryType[e]}).indexOf(e)&&(this._userIdsIncludeFilterQueryType=e.toUpperCase(),this._userIdsFilter.queryType=this._userIdsIncludeFilterQueryType)}},{key:"setSearchFilter",value:function(e,n){Array.isArray(e)&&0!==e.length&&"string"==typeof n&&n&&(this._searchFilter={search_query:n,search_fields:e.join(",").toLocaleLowerCase()})}},{key:"serialize",value:function(){return se.serialize(this,function(e){e.isLoading=!1})}},{key:"next",value:function(e){var u=this;return ae(this._iid,function(o){var e=B.get(u._iid),l=e.GroupChannel,n=e.GroupChannelListQuery;!("number"==typeof u.limit&&0<u.limit&&"boolean"==typeof u.includeEmpty&&"string"==typeof u.order&&-1<[n.ORDER_CHRONOLOGICAL,n.ORDER_LATEST_LAST_MESSAGE,n.CHANNEL_NAME_ALPHABETICAL,n.METADATA_VALUE_ALPHABETICAL].indexOf(u.order.toLowerCase())&&Array.isArray(u._userIdsExactFilter)&&Array.isArray(u._userIdsIncludeFilter)&&Array.isArray(u.customTypesFilter)&&Array.isArray(u.channelUrlsFilter)&&-1<Object.keys(n.QueryType).map(function(e){return n.QueryType[e]}).indexOf(u._userIdsIncludeFilterQueryType.toUpperCase())&&-1<Object.keys(l.MemberStateFilter).map(function(e){return l.MemberStateFilter[e]}).indexOf(u.memberStateFilter)&&-1<Object.keys(l.SuperChannelFilter).map(function(e){return l.SuperChannelFilter[e]}).indexOf(u.superChannelFilter)&&-1<Object.keys(l.PublicChannelFilter).map(function(e){return l.PublicChannelFilter[e]}).indexOf(u.publicChannelFilter)&&-1<Object.keys(l.UnreadChannelFilter).map(function(e){return l.UnreadChannelFilter[e]}).indexOf(u.unreadChannelFilter)&&-1<Object.keys(l.HiddenChannelFilter).map(function(e){return l.HiddenChannelFilter[e]}).indexOf(u.hiddenChannelFilter))||"string"!=typeof u.customTypeStartsWithFilter&&null!==u.customTypeStartsWithFilter||"string"!=typeof u.nicknameContainsFilter||"string"!=typeof u.channelNameContainsFilter||"string"!=typeof u.metadataOrderKeyFilter&&null!==u.metadataOrderKeyFilter||"boolean"!=typeof u.includeFrozen?o(V.error,null):u.isLoading?o(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):u.hasNext?(u.isLoading=!0,ce.get(u._iid).container.apiClient.loadGroupChannelList(g(g({},u),{},{token:u._token,userIdsFilter:u._userIdsFilter,searchFilter:u._searchFilter}),function(e,n){if(e)return u.isLoading=!1,void o(e,null);var t=[],r=String(n.next);u._token=r,u.hasNext=!!r;for(var i=n.channels,a=0;a<i.length;a++){var s=l.upsert(i[a]);t.push(s)}u.isLoading=!1,o(e,t)})):o(null,[])},e)}}],[{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}},{key:"QueryType",get:function(){return{AND:"AND",OR:"OR"}}},{key:"SearchField",get:function(){return{MEMBER_NICKNAME:"member_nickname",CHANNEL_NAME:"channel_name"}}},{key:"buildFromSerializedData",value:function(e){var n,t=B.get(this._iid).GroupChannel,r=se.deserialize(e),i=t.createMyGroupChannelListQuery();for(n in r)i.hasOwnProperty(n)&&(i[n]=r[n]);return i}}]),n}(),Xe=function(){function n(e){c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.mutedMemberFilter=n.MutedMemberFilter.ALL,this.memberStateFilter=Me.MemberStateFilter.ALL,this.nicknameStartsWithFilter=null,this.order=n.Order.MEMBER_NICKNAME_ALPHABETICAL,this._token="",this._channelUrl=e}return o(n,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(i){var e=B.get(s._iid),n=e.GroupChannel,a=e.Member,t=e.MemberListQuery;"number"==typeof s.limit&&0<s.limit&&-1<Object.keys(t.MutedMemberFilter).map(function(e){return t.MutedMemberFilter[e]}).indexOf(s.mutedMemberFilter)&&-1<Object.keys(n.MemberStateFilter).map(function(e){return n.MemberStateFilter[e]}).indexOf(s.memberStateFilter)&&-1<Object.keys(t.Order).map(function(e){return t.Order[e]}).indexOf(s.order)&&("string"==typeof s.nicknameStartsWithFilter||null===s.nicknameStartsWithFilter)?s.isLoading?i(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadMemberList(g(g({},s),{},{channelUrl:s._channelUrl,token:s._token}),function(e,n){var t,r=null;e||(t=String(n.next),s._token=t,s.hasNext=!!t,r=n.members.map(function(e){return new a(e)})),s.isLoading=!1,i(e,r)})):i(null,[]):i(V.error,null)},e)}}],[{key:"MutedMemberFilter",get:function(){return{ALL:"all",MUTED:"muted",UNMUTED:"unmuted"}}},{key:"Order",get:function(){return{MEMBER_NICKNAME_ALPHABETICAL:"member_nickname_alphabetical",OPERATOR_THEN_MEMBER_ALPHABETICAL:"operator_then_member_alphabetical"}}}]),n}(),Ze=function(){function n(e){c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",e.channelUrl&&(this._channelUrl=e.channelUrl),e.isOpenChannel&&(this._isOpenChannel=e.isOpenChannel)}return o(n,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadMutedUserList(g(g({},s),{},{channelUrl:s._channelUrl,isOpenChannel:s._isOpenChannel,token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.muted_list.map(function(e){return new t(e)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),n}(),$e=function(){function e(){c(this,e),this.limit=20,this.isLoading=!1,this.hasNext=!0,this.nameKeyword=null,this.urlKeyword=null,this.customTypes=[],this.includeFrozen=!0}return o(e,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){!("number"==typeof s.limit&&0<s.limit&&Array.isArray(s.customTypes))||"string"!=typeof s.nameKeyword&&null!==s.nameKeyword||"string"!=typeof s.urlKeyword&&null!==s.urlKeyword||"boolean"!=typeof s.includeFrozen?a(V.error,null):s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadOpenChannelList(g(g({},s),{},{token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).OpenChannel,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.channels.map(function(e){return t.upsert(e)})),s.isLoading=!1,a(e,i)})):a(null,[])},e)}}]),e}(),en=new WeakMap,nn=function(){function n(e){c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",en.set(this,e)}return o(n,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){var e;"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,e=en.get(s),ce.get(s._iid).container.apiClient.loadOperatorList(g(g({},s),{},{token:s._token,channelUrl:e.url,isOpenChannel:e.isOpenChannel()}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.operators.map(function(e){return new t(e)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),n}(),tn=new WeakMap,rn=function(){function n(e){c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",e&&tn.set(this,e.channelUrl)}return o(n,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadParticipantList(g(g({},s),{},{channelUrl:tn.get(s),token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.participants.map(function(e){return new t(e)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),n}(),an=new WeakMap,sn=function(){function u(e,n){var t=n.limit,r=void 0===t?20:t,i=n.reverse,a=void 0!==i&&i,s=n.exactMatch,o=void 0!==s&&s,l=n.channelUrl,t=void 0===l?"":l,i=n.channelCustomType,s=void 0===i?"":i,l=n.messageTimestampFrom,i=void 0===l?null:l,l=n.messageTimestampTo,l=void 0===l?null:l,n=n.order,n=void 0===n?"score":n;c(this,u),this.isLoading=!1,this.hasNext=!0,an.set(this,{keyword:e,limit:r,reverse:a,exactMatch:o,channelUrl:t,channelCustomType:s,messageTimestampFrom:i,messageTimestampTo:l,order:n,previousToken:"",nextToken:""})}return o(u,[{key:"key",get:function(){return an.get(this).keyword}},{key:"limit",get:function(){return an.get(this).limit}},{key:"reverse",get:function(){return an.get(this).reverse}},{key:"exactMatch",get:function(){return an.get(this).exactMatch}},{key:"channelUrl",get:function(){return an.get(this).channelUrl}},{key:"channelCustomType",get:function(){return an.get(this).channelCustomType}},{key:"messageTimestampFrom",get:function(){return an.get(this).messageTimestampFrom}},{key:"messageTimestampTo",get:function(){return an.get(this).messageTimestampTo}},{key:"order",get:function(){return an.get(this).order}},{key:"next",value:function(e){var d=this,n=B.get(this._iid),h=n.BaseChannel,p=n.GroupChannel,g=n.OpenChannel;return ae(this._iid,function(a){var e=an.get(d),n=e.keyword,t=e.limit,r=e.reverse,i=e.exactMatch,s=e.channelUrl,o=e.channelCustomType,l=e.messageTimestampFrom,u=e.messageTimestampTo,c=e.order,e=e.nextToken;!("number"==typeof t&&0<t&&t<=1e3&&"boolean"==typeof r&&"boolean"==typeof i)||"string"!=typeof s&&null!==s||"string"!=typeof o&&null!==o||"number"!=typeof l&&null!==l||"number"!=typeof u&&null!==u||!(0<=["score","ts"].indexOf(c))?a(V.error,null):d.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):d.hasNext?(d.isLoading=!0,ce.get(d._iid).container.apiClient.searchMessages({keyword:n,limit:t,reverse:r,exactMatch:i,channelUrl:s,channelCustomType:o,messageTimestampFrom:l,messageTimestampTo:u,order:c,nextToken:e},function(e,n){var t=null;if(!e){for(var r in t=[],n.results){var i,r=n.results[r];r.channel.hasOwnProperty("members")?(i=new p(r.channel),p.cachedChannels[i.url]=i,t.push(h.buildMessage(r,i))):(i=new g(r.channel),g.cachedChannels[i.url]=i,t.push(h.buildMessage(r,i)))}d.hasNext=n.has_next,an.get(d).nextToken=n.end_cursor}d.isLoading=!1,a(e,t)})):a(null,[])},e)}}]),u}(),on=new WeakMap,ln=new WeakMap,un=function(){function n(e){c(this,n),this.isLoading=!1,this.hasMore=!0,this.limit=20,ln.set(this,Number.MAX_SAFE_INTEGER),on.set(this,e),this.reverse=!1,this.messageTypeFilter=null,this.customTypeFilter=null,this.customTypesFilter=null,this.senderUserIdsFilter=[],this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1,this.showSubchannelMessagesOnly=!1}return o(n,[{key:"load",value:function(a,n,t,e){var s=this,o=B.get(this._iid).BaseChannel,l=null,r=T(V.parse(arguments,[new V({type:"number",optional:!0,defaultValue:this.limit}),new V({type:"boolean",optional:!0,defaultValue:this.reverse}),new V({type:["string","number"],optional:!0,defaultValue:this.messageTypeFilter,constraint:function(e){return-1<Object.keys(o.MessageTypeFilter).map(function(e){return o.MessageTypeFilter[e]}).indexOf(e)||-1<[0,1,2,3].indexOf(e)}}),new V({type:"callback"})]),5),l=r[0];return a=r[1],n=r[2],t=r[3],e=r[4],ae(this._iid,function(r){if(l=!Array.isArray(s.senderUserIdsFilter)||s.senderUserIdsFilter.some(function(e){return"string"!=typeof e})?V.error:l)r(l,null);else{if(s.limit=a,s.reverse=n,s.messageTypeFilter=t,"number"==typeof s.messageTypeFilter)switch(s.messageTypeFilter){case 0:s.messageTypeFilter=o.MessageTypeFilter.ALL;break;case 1:s.messageTypeFilter=o.MessageTypeFilter.USER;break;case 2:s.messageTypeFilter=o.MessageTypeFilter.FILE;break;case 3:s.messageTypeFilter=o.MessageTypeFilter.ADMIN}var i,e;s.isLoading?r(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasMore?(s.isLoading=!0,i=on.get(s),e=ce.get(s._iid),"boolean"==typeof s.includeReaction&&s.includeReaction&&(s.includeReactions=s.includeReaction),e.container.apiClient.getMessageList({channel:i,token:ln.get(s)||(new Date).getTime()+1e4,tokenType:"timestamp",isInclusive:!1,prevResultSize:a,nextResultSize:0,shouldReverse:n,messageType:t,customType:s.customTypeFilter,customTypes:s.customTypesFilter,senderUserIds:s.senderUserIdsFilter,includeMetaArray:s.includeMetaArray,includeReactions:s.includeReactions,includeReplies:s.includeReplies,includeParentMessageText:s.includeParentMessageText,includeThreadInfo:s.includeThreadInfo,showSubchannelMessagesOnly:s.showSubchannelMessagesOnly},function(e,n){var t=null;e||((0===(t=n.messages.map(function(e){return o.buildMessage(e,i)})).length||t.length<a)&&(s.hasMore=!1),n=ln.get(s),ln.set(s,Math.min.apply(Math,C(t.map(function(e){return e.createdAt})).concat([n])))),s.isLoading=!1,r(e,t)})):r(null,[])}},e)}}]),n}(),cn=function(){function n(){c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=Je.ORDER_LATEST_LAST_MESSAGE,this._token="",this.channelNameContainsFilter="",this.channelUrlsFilter=[],this.customTypesFilter=[],this.customTypeStartsWithFilter=null,this.superChannelFilter=Me.SuperChannelFilter.ALL,this.membershipFilter=n.MembershipType.JOINED,this.metadataOrderKeyFilter=null,this.includeFrozen=!0}return o(n,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(i){var a=B.get(s._iid).GroupChannel;!("number"==typeof s.limit&&0<s.limit&&"boolean"==typeof s.includeEmpty&&"string"==typeof s.order&&-1<[n.ORDER_CHRONOLOGICAL,n.CHANNEL_NAME_ALPHABETICAL,n.METADATA_VALUE_ALPHABETICAL,n.ORDER_LATEST_LAST_MESSAGE].indexOf(s.order.toLowerCase())&&Array.isArray(s.customTypesFilter)&&Array.isArray(s.channelUrlsFilter)&&-1<Object.keys(n.MembershipType).map(function(e){return n.MembershipType[e]}).indexOf(s.membershipFilter)&&-1<Object.keys(a.SuperChannelFilter).map(function(e){return a.SuperChannelFilter[e]}).indexOf(s.superChannelFilter))||"string"!=typeof s.customTypeStartsWithFilter&&null!==s.customTypeStartsWithFilter||"string"!=typeof s.channelNameContainsFilter||"string"!=typeof s.metadataOrderKeyFilter&&null!==s.metadataOrderKeyFilter||"boolean"!=typeof s.includeFrozen?i(V.error,null):s.isLoading?i(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadPublicGroupChannelList(g(g({},s),{},{token:s._token}),function(e,n){var t,r=null;e||(t=String(n.next),s._token=t,s.hasNext=!!t,r=n.channels.map(function(e){return a.upsert(e)})),s.isLoading=!1,i(e,r)})):i(null,[])},e)}}],[{key:"MembershipType",get:function(){return{ALL:"all",JOINED:"joined"}}},{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}}]),n}(),dn=function(){function e(){c(this,e),this.isDistinct=null,this.isSuper=null,this.isBroadcast=null,this.isPublic=null,this.channelUrl=null,this.isEphemeral=null,this.isDiscoverable=null,this.isStrict=null,this.name=null,this.data=null,this.customType=null,this.channelCover=null,this.coverUrl=null,this.coverImage=null,this.accessCode=null,this.messageSurvivalSeconds=null,this._invitedUserIds=[];var n=null;Object.defineProperty(this,"operators",{set:function(e){Array.isArray(e)&&e.filter(function(e){return e.hasOwnProperty("userId")}).length===e.length&&(n=e.map(function(e){return e.userId}))}}),Object.defineProperty(this,"operatorUserIds",{get:function(){return n},set:function(e){Array.isArray(e)&&e.filter(function(e){return"string"==typeof e}).length===e.length&&(n=e)}})}return o(e,[{key:"_validate",value:function(){return Array.isArray(this._invitedUserIds)&&this._invitedUserIds.every(function(e){return"string"==typeof e})&&("string"==typeof this.channelUrl||null===this.channelUrl)&&("string"==typeof this.coverUrl||null===this.coverUrl)&&(pe.isFile(this.coverImage)||null===this.coverImage)&&("string"==typeof this.name||null===this.name)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&("boolean"==typeof this.isDistinct||null===this.isDistinct)&&("boolean"==typeof this.isSuper||null===this.isSuper)&&("boolean"==typeof this.isBroadcast||null===this.isBroadcast)&&("boolean"==typeof this.isPublic||null===this.isPublic)&&("boolean"==typeof this.isEphemeral||null===this.isEphemeral)&&("boolean"==typeof this.isDiscoverable||null===this.isDiscoverable)&&("boolean"==typeof this.isStrict||null===this.isStrict)&&(Array.isArray(this.operatorUserIds)&&this.operatorUserIds.every(function(e){return"string"==typeof e})||null===this.operatorUserIds)&&("string"==typeof this.accessCode||null===this.accessCode)&&("number"==typeof this.messageSurvivalSeconds||null===this.messageSurvivalSeconds)}},{key:"addUsers",value:function(e){var n;Array.isArray(e)&&(n=e.filter(function(e){return e.hasOwnProperty("userId")&&"string"==typeof e.userId}).map(function(e){return e.userId}),(e=this._invitedUserIds).push.apply(e,C(n)))}},{key:"addUser",value:function(e){e.hasOwnProperty("userId")&&"string"==typeof e.userId&&this._invitedUserIds.push(e.userId)}},{key:"addUserIds",value:function(e){var n;Array.isArray(e)&&(n=e.filter(function(e){return"string"==typeof e}),(e=this._invitedUserIds).push.apply(e,C(n)))}},{key:"addUserId",value:function(e){"string"==typeof e&&this._invitedUserIds.push(e)}}]),e}(),hn=function(){function e(){c(this,e),this.channelUrl=null,this.name=null,this.coverUrlOrImage=null,this.data=null,this.customType=null,this._operatorUserIds=[]}return o(e,[{key:"operatorUserIds",get:function(){return this._operatorUserIds},set:function(e){Array.isArray(e)&&e.every(function(e){return"string"==typeof e})&&(this._operatorUserIds=e)}},{key:"operators",set:function(e){Array.isArray(e)&&e.every(function(e){return e.hasOwnProperty("userId")})&&(this._operatorUserIds=e.map(function(e){return e.userId}))}},{key:"_validate",value:function(){return(Array.isArray(this.operatorUserIds)&&this.operatorUserIds.every(function(e){return"string"==typeof e})||null===this.operatorUserIds)&&("string"==typeof this.coverUrlOrImage||pe.isFile(this.coverUrlOrImage)||null===this.coverUrlOrImage)&&("string"==typeof this.name||null===this.name)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&("string"==typeof this.channelUrl||null===this.channelUrl)}}]),e}(),pn=new WeakMap,gn=function(){function e(){c(this,e),this._mentionType=e.MentionType.USERS,this._mentionedUserIds=[],this._cachedMentionedUsers=[],this._cachedMentionedUserIds=[],this._metaArrays=[],pn.set(this,null),this._parentMessageId=null}return o(e,[{key:"mentionType",get:function(){return this._mentionType},set:function(e){var n=B.get(this._iid).BaseMessageParams;-1<Object.keys(n.MentionType).map(function(e){return n.MentionType[e]}).indexOf(e)&&(this._mentionType=e)}},{key:"mentionedUserIds",get:function(){return this._cachedMentionedUserIds},set:function(e){if(Array.isArray(e))for(var n=Zn.getInstance(this._iid),t=0;t<e.length;t++){var r=e[t];if("string"!=typeof r){this._cachedMentionedUserIds=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r)<0&&n.currentUser&&n.currentUser.userId!==r&&(this._cachedMentionedUserIds.push(r),this._mentionedUserIds.push(r))}}},{key:"mentionedUsers",get:function(){return this._cachedMentionedUsers},set:function(e){if(Array.isArray(e))for(var n=Zn.getInstance(this._iid),t=0;t<e.length;t++){var r=e[t];if(!r.hasOwnProperty("userId")){this._cachedMentionedUsers=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r.userId)<0&&n.currentUser&&n.currentUser.userId!==r.userId&&(this._cachedMentionedUsers.push(r),this._mentionedUserIds.push(r.userId))}}},{key:"metaArrayKeys",get:function(){return this._metaArrays.map(function(e){return e.key})},set:function(e){var n=B.get(this._iid).MessageMetaArray,t={};if(Array.isArray(e)){this._metaArrays=[];for(var r=0;r<e.length;r++)"string"!=typeof e[r]||t[e[r]]||(t[e[r]]=!0,this._metaArrays.push(new n(e[r])))}}},{key:"metaArrays",get:function(){return this._metaArrays},set:function(e){var n=B.get(this._iid).MessageMetaArray;if(Array.isArray(e)){this._metaArrays=[];for(var t=0;t<e.length;t++){var r,i=e[t];i instanceof n&&((r=this._metaArrays.map(function(e){return e.key}).indexOf(i.key))<0?this._metaArrays.push(i):(r=this._metaArrays[r].value).push.apply(r,C(i.value)))}}}},{key:"rootMessageId",get:function(){return pn.get(this)}},{key:"parentMessageId",get:function(){return this._parentMessageId},set:function(e){pn.set(this,e),this._parentMessageId=e}},{key:"_validate",value:function(){var e=B.get(this._iid),n=e.BaseMessageParams,t=e.MessageMetaArray,e=pn.get(this);return-1<Object.keys(n.MentionType).map(function(e){return n.MentionType[e]}).indexOf(this.mentionType)&&this._mentionedUserIds.every(function(e){return"string"==typeof e})&&Array.isArray(this._metaArrays)&&this._metaArrays.every(function(e){return e instanceof t})&&("number"==typeof e||null===e)&&("number"==typeof this._parentMessageId||null===this._parentMessageId)}}],[{key:"MentionType",get:function(){return{USERS:"users",CHANNEL:"channel"}}},{key:"PushNotificationDeliveryOption",get:function(){return{DEFAULT:"default",SUPPRESS:"suppress"}}}]),e}(),yn=function(){s(t,gn);var n=f(t);function t(){var e;return c(this,t),(e=n.call(this)).message=null,e.data=null,e.customType=null,e.pushNotificationDeliveryOption=null,e._translationTargetLanguages=[],e}return o(t,[{key:"targetLanguages",get:function(){return this.translationTargetLanguages},set:function(e){this.translationTargetLanguages=e}},{key:"translationTargetLanguages",get:function(){return this._translationTargetLanguages},set:function(e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("string"!=typeof e[n])return void(this._translationTargetLanguages=[]);this._translationTargetLanguages=e}}},{key:"_validate",value:function(){var n=B.get(this._iid).BaseMessageParams;return _(a(t.prototype),"_validate",this).call(this)&&("string"==typeof this.message||null===this.message)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&Array.isArray(this.translationTargetLanguages)&&this.translationTargetLanguages.every(function(e){return"string"==typeof e})&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(n.PushNotificationDeliveryOption).map(function(e){return n.PushNotificationDeliveryOption[e]}).indexOf(this.pushNotificationDeliveryOption))}}]),t}(),fn=function(){s(t,gn);var n=f(t);function t(){var e;return c(this,t),(e=n.call(this)).fileName=null,e.mimeType=null,e.fileSize=null,e.data=null,e.customType=null,e.pushNotificationDeliveryOption=null,e._isUpdate=!1,e._file=null,e._fileUrl=null,e._thumbnailSizes=[],e}return o(t,[{key:"file",get:function(){return this._file},set:function(e){pe.isFile(e)&&(this._fileUrl=null,this._file=e)}},{key:"fileUrl",get:function(){return this._fileUrl},set:function(e){"string"==typeof e&&(this._fileUrl=e,this._file=null)}},{key:"thumbnailSizes",get:function(){return this._thumbnailSizes},set:function(e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("object"!==le(e[n])||"number"!=typeof e[n].maxWidth||"number"!=typeof e[n].maxHeight)return void(this._thumbnailSizes=[]);this._thumbnailSizes=e}}},{key:"_validate",value:function(){var n=B.get(this._iid).BaseMessageParams;return _(a(t.prototype),"_validate",this).call(this)&&(this._isUpdate||pe.isFile(this.file)||"string"==typeof this.fileUrl)&&("string"==typeof this.fileName||null===this.fileName)&&("string"==typeof this.mimeType||null===this.mimeType)&&("number"==typeof this.fileSize||null===this.fileSize)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&(null===this._thumbnailSizes||this._thumbnailSizes.every(function(e){return"object"===le(e)&&0<e.maxWidth&&0<e.maxHeight}))&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(n.PushNotificationDeliveryOption).map(function(e){return n.PushNotificationDeliveryOption[e]}).indexOf(this.pushNotificationDeliveryOption))}}]),t}(),_n=function(){s(r,yn);var t=f(r);function r(e){var n;return c(this,r),(n=t.call(this)).year=null,n.month=null,n.day=null,n.hour=null,n.min=null,n.timezone=null,n._scheduledDateTimeString=null,e&&n._update(e),n}return o(r,[{key:"scheduledDateTimeString",get:function(){return this._scheduledDateTimeString||("number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2):null)},set:function(e){e&&"string"==typeof e&&(this._scheduledDateTimeString=e)}},{key:"_update",value:function(e){e.hasOwnProperty("message")&&(this.message=e.message),e.hasOwnProperty("year")&&(this.year=e.year),e.hasOwnProperty("month")&&(this.month=e.month),e.hasOwnProperty("day")&&(this.day=e.day),e.hasOwnProperty("hour")&&(this.hour=e.hour),e.hasOwnProperty("min")&&(this.min=e.min),e.hasOwnProperty("timezone")&&(this.timezone=e.timezone)}},{key:"_getScheduleString",value:function(){return this.scheduledDateTimeString?this.scheduledDateTimeString+" "+this.timezone:"number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2)+" "+this.timezone:null}},{key:"setSchedule",value:function(e,n,t,r,i,a){"number"==typeof e&&4===e.toString().length&&"number"==typeof n&&1<=n&&n<=12&&"number"==typeof t&&1<=t&&t<=31&&"number"==typeof r&&0<=r&&r<=24&&"number"==typeof i&&0<=i&&i<=60&&"string"==typeof a&&0<a.length&&(this.scheduledDateTimeString=e.toString()+"-"+("0"+n.toString()).substr(-2)+"-"+("0"+t.toString()).substr(-2)+" "+("0"+r.toString()).substr(-2)+":"+("0"+i.toString()).substr(-2),this.timezone=a)}}]),r}(),mn=function e(){c(this,e),this.channelCustomTypesFilter=[],this.superChannelFilter=Me.SuperChannelFilter.ALL},vn=function(){function e(){c(this,e),this.channelUrl=null,this.channelType=null,this.messageId=0,this.includeMetaArray=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return o(e,[{key:"_validate",value:function(){var e=B.get(this._iid).BaseChannel;return"string"==typeof this.channelUrl&&"string"==typeof this.channelType&&[e.CHANNEL_TYPE_BASE,e.CHANNEL_TYPE_OPEN,e.CHANNEL_TYPE_GROUP].includes(this.channelType)&&"number"==typeof this.messageId&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),e}(),En=function(){function n(){c(this,n);var e=B.get(this._iid).BaseChannel;this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageType=e.MessageTypeFilter.ALL,this.customType=null,this.customTypes=null,this.senderUserIds=null,this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1,this.showSubchannelMessagesOnly=!1}return o(n,[{key:"_validate",value:function(){"boolean"==typeof this.includeReaction&&this.includeReaction&&(this.includeReactions=this.includeReaction);var e=B.get(this._iid).BaseChannel;return"number"==typeof this.prevResultSize&&"number"==typeof this.nextResultSize&&"boolean"==typeof this.isInclusive&&"boolean"==typeof this.reverse&&"string"==typeof this.messageType&&Object.values(e.MessageTypeFilter).includes(this.messageType)&&("string"==typeof this.customType||null===this.customType)&&(Array.isArray(this.customTypes)&&this.customTypes.every(function(e){return"string"==typeof e||null===e})||null===this.customTypes)&&(Array.isArray(this.senderUserIds)&&this.senderUserIds.every(function(e){return"string"==typeof e})||null===this.senderUserIds)&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeReplies&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo&&"boolean"==typeof this.showSubchannelMessagesOnly}}]),n}(),Cn=function(){function n(){c(this,n);var e=B.get(this._iid).BaseChannel;this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageType=e.MessageTypeFilter.ALL,this.customType=null,this.customTypes=null,this.senderUserIds=null,this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeParentMessageText=!1}return o(n,[{key:"_validate",value:function(){"boolean"==typeof this.includeReaction&&this.includeReaction&&(this.includeReactions=this.includeReaction);var e=B.get(this._iid).BaseChannel;return"number"==typeof this.prevResultSize&&"number"==typeof this.nextResultSize&&"boolean"==typeof this.isInclusive&&"boolean"==typeof this.reverse&&"string"==typeof this.messageType&&Object.values(e.MessageTypeFilter).includes(this.messageType)&&("string"==typeof this.customType||null===this.customType)&&(Array.isArray(this.customTypes)&&this.customTypes.every(function(e){return"string"==typeof e||null===e})||null===this.customTypes)&&(Array.isArray(this.senderUserIds)&&this.senderUserIds.every(function(e){return"string"==typeof e})||null===this.senderUserIds)&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeParentMessageText}}]),n}(),Un=function(){function e(){c(this,e),this.includeMetaArray=!1,this.includeReaction=null,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return o(e,[{key:"_validate",value:function(){return"boolean"==typeof this.includeReaction&&this.includeReaction&&(this.includeReactions=this.includeReaction),"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeReplies&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),e}(),bn=function(){function e(){c(this,e),this.customTypes=[],this.includeEmpty=!1,this.includeFrozen=!0}return o(e,[{key:"_validate",value:function(){return(Array.isArray(this.customTypes)&&this.customTypes.every(function(e){return"string"==typeof e})||null===this.customTypes)&&("boolean"==typeof this.includeEmpty||null===this.includeEmpty)&&"boolean"==typeof this.includeFrozen}}]),e}(),An=function e(){c(this,e),this.onReconnectStarted=function(){},this.onReconnectSucceeded=function(){},this.onReconnectFailed=function(){}},Sn=function e(){c(this,e),this.onFriendsDiscovered=function(e){},this.onTotalUnreadMessageCountUpdated=function(e,n){}},In=function e(){c(this,e),this.onMessageReceived=function(e,n){},this.onMessageUpdated=function(e,n){},this.onMessageDeleted=function(e,n){},this.onReadReceiptUpdated=function(e){},this.onReactionUpdated=function(e,n){},this.onDeliveryReceiptUpdated=function(e){},this.onTypingStatusUpdated=function(e){},this.onUserJoined=function(e,n){},this.onUserLeft=function(e,n){},this.onOperatorUpdated=function(e,n){},this.onUserEntered=function(e,n){},this.onUserExited=function(e,n){},this.onUserMuted=function(e,n){},this.onUserUnmuted=function(e,n){},this.onUserBanned=function(e,n){},this.onUserUnbanned=function(e,n){},this.onChannelFrozen=function(e){},this.onChannelUnfrozen=function(e){},this.onChannelChanged=function(e){},this.onChannelDeleted=function(e,n){},this.onUserReceivedInvitation=function(e,n,t){},this.onUserDeclinedInvitation=function(e,n,t){},this.onMetaDataCreated=function(e,n){},this.onMetaDataUpdated=function(e,n){},this.onMetaDataDeleted=function(e,n){},this.onMetaCountersCreated=function(e,n){},this.onMetaCountersUpdated=function(e,n){},this.onMetaCountersDeleted=function(e,n){},this.onChannelHidden=function(e){},this.onMentionReceived=function(e,n){},this.onThreadInfoUpdated=function(e,n){}},Nn=function e(n){var t,r;c(this,e),n&&(t=(r=B.get(this._iid)).User,r=r.BaseChannel,this.reader=new t(n.user),this.timestamp=parseInt(n.ts),this.channelUrl=n.hasOwnProperty("channel_url")?String(n.channel_url):"",this.channelType=n.hasOwnProperty("channel_type")?String(n.channel_type):r.CHANNEL_TYPE_GROUP)},kn=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];c(this,t),this.key=e,this.value=Array.isArray(n)&&n.every(function(e){return"string"==typeof e})?n:[]}return o(t,[{key:"encode",value:function(){return{key:this.key,value:this.value||[]}}}]),t}(),Rn=new WeakMap,Tn=function(){function a(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;c(this,a),this.key=e,this.userIds=n,this.updatedAt=t;var r,i={};for(r in this.userIds)i[this.userIds[r]]=this.updatedAt;Rn.set(this,i)}return o(a,[{key:"isEmpty",get:function(){return 0===this.userIds.length}},{key:"serialize",value:function(){return{key:this.key,user_ids:this.userIds,updated_at:this.updatedAt}}},{key:"_applyEvent",value:function(e){if(e instanceof ie){var n=Rn.get(this);if(e.key===this.key&&(!n[e.userId]||n[e.userId]<e.updatedAt)){var t=this.userIds.indexOf(e.userId);switch(e.operation){case"add":t<0&&this.userIds.push(e.userId);break;case"delete":0<=t&&this.userIds.splice(t,1)}n[e.userId]=e.updatedAt}}}}],[{key:"createFromJson",value:function(e){var n=e.key,t=e.user_ids,e=e.updated_at;return"string"==typeof n&&n&&Array.isArray(t)&&0<t.length&&"number"==typeof e?new this(n,t,e):null}}]),a}(),On=function(){function n(e){c(this,n),this.replyCount=0,this.mostRepliedUsers=[],this.lastRepliedAt=0,this.updatedAt=0,e&&this._update(e)}return o(n,[{key:"_update",value:function(e){var n=B.get(this._iid).User;e.hasOwnProperty("reply_count")&&(this.replyCount=parseInt(e.reply_count)),e.hasOwnProperty("most_replies")&&Array.isArray(e.most_replies)&&e.most_replies.every(function(e){return"object"===le(e)})&&(this.mostRepliedUsers=e.most_replies.map(function(e){return new n(e)})),e.hasOwnProperty("last_replied_at")&&(this.lastRepliedAt=parseInt(e.last_replied_at)),e.hasOwnProperty("updated_at")&&(this.updatedAt=parseInt(e.updated_at))}}],[{key:"objectify",value:function(e){var n=B.get(this._iid).User,t=e.replyCount,r=e.mostRepliedUsers,i=e.lastRepliedAt,a=e.updatedAt,e={};return e.reply_count=t,Array.isArray(r)&&r.every(function(e){return e instanceof n})&&(e.most_replies=r.map(function(e){return n.objectify(e)})),e.last_replied_at=i,e.updated_at=a,e}},{key:"build",value:function(e,n,t,r){return this.objectify({replyCount:e,mostRepliedUsers:n,lastRepliedAt:t,updatedAt:r})}}]),n}(),Mn=function(){function n(e){c(this,n),this.title=null,this.url=null,this.description=null,this.defaultImage=null,e&&this._update(e)}return o(n,[{key:"_update",value:function(e){var n=B.get(this._iid).OGImage;e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new n(e["og:image"]))}}],[{key:"objectify",value:function(e){var n=B.get(this._iid).OGImage,t=e.title,r=void 0===t?null:t,i=e.url,a=void 0===i?null:i,t=e.description,i=void 0===t?null:t,t=e.defaultImage,e=void 0===t?null:t,t={};return t["og:title"]=r,t["og:url"]=a,t["og:description"]=i,e&&(t["og:image"]=n.objectify(e)),t}}]),n}(),Ln=function(){function n(e){c(this,n),this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,e&&this._update(e)}return o(n,[{key:"_update",value:function(e){e.hasOwnProperty("url")&&(this.url=e.url),e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=parseInt(e.width)),e.hasOwnProperty("height")&&(this.height=parseInt(e.height)),e.hasOwnProperty("alt")&&(this.alt=e.alt)}}],[{key:"objectify",value:function(e){var n=e.url,t=void 0===n?null:n,r=e.secureUrl,i=void 0===r?null:r,a=e.type,s=void 0===a?null:a,n=e.width,r=void 0===n?0:n,a=e.height,n=void 0===a?0:a,a=e.alt,e=void 0===a?null:a,a={};return a.url=t,a.secure_url=i,a.type=s,a.width=r,a.height=n,a.alt=e,a}}]),n}(),Pn=function(){function n(e){c(this,n),this.type=null,this.vendor=null,this.detail={},e&&this._update(e)}return o(n,[{key:"_update",value:function(e){this.type=e.hasOwnProperty("type")?e.type:"",this.vendor=e.hasOwnProperty("vendor")?e.vendor:"",e.hasOwnProperty("detail")&&"object"===le(e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}}],[{key:"objectify",value:function(e){var n=e.type,t=void 0===n?"":n,r=e.vendor,n=void 0===r?"":r,r=e.detail,e=void 0===r?{}:r,r={};return r.type=t,r.vendor=n,r.detail=e,r}}]),n}(),wn=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];c(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIds=e,this.metaDataKey="",this.metaDataValues=[],this._token=""}return o(n,[{key:"next",value:function(e){var s=this;return ae(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIds)&&"string"==typeof s.metaDataKey&&Array.isArray(s.metaDataValues)&&!!s.metaDataKey==0<s.metaDataValues.length?s.isLoading?a(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,ce.get(s._iid).container.apiClient.loadUserList(g(g({},s),{},{userIdsFilter:s.userIds,metaDataKeyFilter:s.metaDataKey,metaDataValuesFilter:s.metaDataValues,token:s._token}),function(e,n){var t,r,i=null;e||(t=B.get(s._iid).User,r=String(n.next),s._token=r,s.hasNext=!!r,i=n.users.map(function(e){return new t(e)})),s.isLoading=!1,a(e,i)})):a(null,[]):a(V.error,null)},e)}}]),n}(),Dn=new WeakMap,Hn=function(){function n(e){c(this,n),this.isLoading=!1,Dn.set(this,e)}return o(n,[{key:"prev",value:function(t,s,o,e){var l=arguments,u=this;return ae(this._iid,function(r){var i,a=B.get(u._iid).BaseChannel,e=T(V.parse(l,[new V({type:"number"}),new V({type:"number"}),new V({type:"boolean"}),new V({type:"function"})]),5),n=e[0];t=e[1],s=e[2],o=e[3],r=e[4],n?r(n,null):u.isLoading?r(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):(u.isLoading=!0,i=Dn.get(u),ce.get(u._iid).container.apiClient.getMessageList({channelUrl:i.url,channelType:i.channelType,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:0,shouldReverse:o,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return a.buildMessage(e,i)})),u.isLoading=!1,r(e,t)}))},e)}},{key:"next",value:function(t,s,o,e){var l=arguments,u=this;return ae(this._iid,function(r){var i,a=B.get(u._iid).BaseChannel,e=T(V.parse(l,[new V({type:"number"}),new V({type:"number"}),new V({type:"boolean"}),new V({type:"function"})]),5),n=e[0];t=e[1],s=e[2],o=e[3],r=e[4],n?r(n,null):u.isLoading?r(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):(u.isLoading=!0,i=Dn.get(u),ce.get(u._iid).container.apiClient.getMessageList({channelUrl:i.url,channelType:i.channelType,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:0,nextResultSize:s,shouldReverse:o,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return a.buildMessage(e,i)})),u.isLoading=!1,r(e,t)}))},e)}},{key:"load",value:function(t,s,o,l,e){var u=arguments,c=this;return ae(this._iid,function(r){var i,a=B.get(c._iid).BaseChannel,e=T(V.parse(u,[new V({type:"number"}),new V({type:"number"}),new V({type:"number"}),new V({type:"boolean"}),new V({type:"callback"})]),6),n=e[0];t=e[1],s=e[2],o=e[3],l=e[4],r=e[5],n?r(n,null):c.isLoading?r(new de("Query in progress.",de.QUERY_IN_PROGRESS),null):(c.isLoading=!0,i=Dn.get(c),ce.get(c._iid).container.apiClient.getMessageList({channelUrl:i.url,channelType:i.channelType,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:o,shouldReverse:l,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return a.buildMessage(e,i)})),c.isLoading=!1,r(e,t)}))},e)}}]),n}(),Fn={PENDING:0,FULFILLED:1,REJECTED:2},Gn=function(){function l(e){var n=this;c(this,l),this.state=Fn.PENDING,this._value=null,this._reason=null;if("function"!=typeof e)throw"Promise resolver ".concat(e," is not a function");e(function(e){n.state===Fn.PENDING&&(n.state=Fn.FULFILLED,n._value=e)},function(e){n.state===Fn.PENDING&&(n.state=Fn.REJECTED,n._reason=e)})}return o(l,[{key:"length",get:function(){return 1}},{key:"then",value:function(e,n){var t=this,r=this;switch(this.state){case Fn.PENDING:setTimeout(function(){return t.then(e,n)},100);break;case Fn.FULFILLED:e&&"function"==typeof e&&(r=e(this._value));break;case Fn.REJECTED:n&&"function"==typeof n&&(r=n(this._reason))}return r instanceof l?r:this}},{key:"catch",value:function(e){var n=this,t=this;switch(this.state){case Fn.PENDING:setTimeout(function(){return n.catch(e)},100);break;case Fn.FULFILLED:break;case Fn.REJECTED:t=e(this._reason)}return t instanceof l?t:this}},{key:"finally",value:function(e){var n=this,t=this;switch(this.state){case Fn.PENDING:setTimeout(function(){return n.finally(e)},100);break;case Fn.FULFILLED:case Fn.REJECTED:t=e()}return t instanceof l?t:this}}],[{key:"all",value:function(o){return new l(function(r,i){if(Array.isArray(o)||"string"==typeof o)if(0<o.length){var e,n=[];for(e in o)o[e]instanceof l?n.push(o[e]):n.push(l.resolve(o[e]));var a=new Array(n.length).fill(null),s=n.length,t=function(e,n,t){n?i(n):(s--,a[e]=t,s<=0&&r(a))};n.forEach(function(e,n){e.then(function(e){t(n,null,e)}).catch(function(e){t(n,e,null)})})}else r([]);else i(new Error("Uncaught (in promise) TypeError: ".concat(le(o)," ").concat(o," is not iterable")))})}},{key:"resolve",value:function(n){return new l(function(e){e(n)})}},{key:"reject",value:function(t){return new l(function(e,n){n(t)})}}]),l}(),Bn=function(){"undefined"==typeof Promise&&("undefined"!=typeof window?window.Promise=Gn:"undefined"!=typeof global?global.Promise=Gn:"undefined"!=typeof self?self.Promise=Gn:"undefined"!=typeof globalThis&&(globalThis.Promise=Gn)),Object.values||(Object.values=function(n){return Object.keys(n).map(function(e){return n[e]})}),Number.MAX_SAFE_INTEGER||Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:Math.pow(2,53)-1})},xn=15e3,jn=5e3,qn=1e4,zn=5e3,Qn=3e5,Yn=1e3,Kn=1e3,Vn=9e3,Wn=null,Jn={},Xn=!1,Zn=function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,s),Bn();var n=!1;if((e.newInstance||!Wn||Wn&&e.appId!==Wn.getApplicationId()&&Wn.getConnectionState()===Wn.ConnectionState.CLOSED)&&(n=!0,Wn=this),n){try{if(!e.hasOwnProperty("appId"))return he.warn("Must be set appId."),Wn=null}catch(e){return he.warn("Must be set appId."),Wn=null}var t=Ie.create();Object.defineProperty(this,"_iid",{get:function(){return t}}),(Jn[t]=this).customApiHost=null,this.customWsHost=null,this.connecting=!1,this.reconnecting=!1,this.isReconnectingOnError=!1,this.connectionCallbacks=[],this.ConnectionManager=new W(this),this.GCMPushToken="",this.APNSPushToken="",this.PUSH_TEMPLATE_DEFAULT="default",this.PUSH_TEMPLATE_ALTERNATIVE="alternative",this.currentUser=null,this.isSessionOpened=!1,this.globalTimer,this.loginTimer,this.reconnectTimer,this.loginHandler=null,this.onLoginTimerCancel,this.onReconnectTimerCancel,this.BaseChannel={MessageTypeFilter:ve.MessageTypeFilter};var r,i={User:_e,Member:Le,GroupChannel:Me,OpenChannel:Be,UserMessage:xe,FileMessage:je,AdminMessage:qe,GroupChannelListQuery:Je,MemberListQuery:Xe,GroupChannelParams:dn,OpenChannelParams:hn,BaseMessageParams:gn,UserMessageParams:yn,FileMessageParams:fn,ScheduledUserMessageParams:_n,GroupChannelTotalUnreadMessageCountParams:mn,MessageRetrievalParams:vn,MessageListParams:En,ThreadedMessageListParams:Cn,MessageChangeLogsParams:Un,GroupChannelChangeLogsParams:bn,MessageMetaArray:kn,UserEventHandler:Sn,SessionHandler:J,ChannelHandler:In,ConnectionHandler:An},n={SessionManager:X,BaseChannel:ve,BaseMessage:fe,UserListQuery:wn,ApplicationUserListQuery:Ye,BannedUserListQuery:Ke,BlockedUserListQuery:Ve,FriendListQuery:We,MutedUserListQuery:Ze,OpenChannelListQuery:$e,OperatorListQuery:nn,ParticipantListQuery:rn,MessageListQuery:Hn,PreviousMessageListQuery:un,MessageSearchQuery:sn,PublicGroupChannelListQuery:cn,ScheduledUserMessage:ze,ThreadInfo:On,ThreadInfoUpdateEvent:Qe,OGMetaData:Mn,OGImage:Ln,Plugin:Pn,Command:ne,Sender:Pe,ReadStatus:Nn,Reaction:Tn,ReactionEvent:ie,Emoji:He,EmojiCategory:De,EmojiContainer:we,FileMessageQueue:Se},a=new B(this._iid,g(g({},i),n));for(r in a)i[r]&&(this[r]=a[r]);ce.create(t,{appId:e.appId,pinger:new D(this),apiClient:new x(this),wsAdapter:new K(this),commandHandler:new Ue(this),onlineDetector:new Z(this),ackStateMap:{},subscribedUnreadMessageCount:{all:0,custom_types:{},ts:0},maxUnreadCountOfSuperGroupChannel:ue.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,auth:new b,appInfo:null,pingInterval:xn,pongTimeout:jn,connectedAt:0,extensions:{},supportedExtensionKeys:["sb_uikit","sb_syncmanager"],getUserAgentWithExtensions:function(e){var n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",e=e.sb_uikit?"u".concat(e.sb_uikit):"";return"JS/c".concat(ue.SDK_VERSION,"/").concat(n,"/").concat(e)},sessionManager:new a.SessionManager(this),stateChangeEnabled:!0,isInBackground:!1,closedByGoingBackground:!1,isErrorFirstInCallback:!1}),this.userEventHandlers={},this.channelHandlers={},this.connectionHandlers={},this.Options={_useMemberAsMessageSender:!0,get UseMemberAsMessageSender(){return this._useMemberAsMessageSender},set UseMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},get useMemberAsMessageSender(){return this._useMemberAsMessageSender},set useMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},_typingIndicatorThrottle:Yn,get typingIndicatorThrottle(){return this._typingIndicatorThrottle},set typingIndicatorThrottle(e){"number"==typeof e&&Kn<=e&&e<=Vn&&(this._typingIndicatorThrottle=e)},_websocketResponseTimeout:qn,get websocketResponseTimeout(){return this._websocketResponseTimeout},set websocketResponseTimeout(e){"number"==typeof e&&zn<=e&&e<=Qn&&(this._websocketResponseTimeout=e)}}}return Wn}return o(s,[{key:"ConnectionState",get:function(){return{CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSED:"CLOSED"}}},{key:"MessageRequestState",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",SUCCEEDED:"succeeded"}}},{key:"MessageSendingStatus",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",CANCELED:"canceled",SUCCEEDED:"succeeded"}}},{key:"pushTokenRegistrationState",get:function(){return{SUCCESS:"success",PENDING:"pending",ERROR:"error"}}},{key:"PushTriggerOption",get:function(){return{ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}},{key:"appInfo",get:function(){return ce.get(this._iid).container.appInfo}},{key:"ekey",get:function(){var e=ce.get(this._iid).container.auth;return e?e.eKey:""}},{key:"getApplicationId",value:function(){return ce.get(this._iid).get("appId")}},{key:"getCurrentUserId",value:function(){return this.currentUser?this.currentUser.userId:null}},{key:"getDebugMode",value:function(){return Xn}},{key:"setDebugMode",value:function(e){Xn=e,he.mode=e?he.Mode.DEBUG:he.Mode.PRODUCTION}},{key:"getErrorFirstCallback",value:function(){return ce.get(this._iid).container.isErrorFirstInCallback}},{key:"setErrorFirstCallback",value:function(e){"boolean"==typeof e&&ce.get(this._iid).set("isErrorFirstInCallback",e)}},{key:"getCurrentApiHost",value:function(){return this.customApiHost||"https://api.sendbird.com"}},{key:"clearCurrentApiHost",value:function(){this.customApiHost=null}},{key:"getCurrentWsHost",value:function(){return this.customWsHost||"wss://ws.sendbird.com"}},{key:"clearCurrentWsHost",value:function(){this.customWsHost=null}},{key:"getConnectionState",value:function(){try{var e=ce.get(this._iid).container.wsAdapter;return this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:e.client?this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:this.isSessionOpened?e.client.getConnectionState():this.ConnectionState.CLOSED:this.ConnectionState.CLOSED}catch(e){return this.ConnectionState.CLOSED}}},{key:"getPendingGCMToken",value:function(){return this.GCMPushToken}},{key:"getPendingAPNSToken",value:function(){return this.APNSPushToken}},{key:"hasLoggedIn",value:function(){var e=ce.get(this._iid);return this.currentUser&&e.get("auth").hasSession()}},{key:"getLastConnectedAt",value:function(){var e=ce.get(this._iid);return this.getConnectionState()===this.ConnectionState.OPEN&&this.currentUser?e.get("connectedAt"):0}},{key:"connect",value:function(n,t,r,i,e){var a=this,s=ce.get(this._iid).container,o=s.wsAdapter,s=s.onlineDetector;s&&s.start();var s=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||3===e.length}}),new V({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new V({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new V({type:"callback"})]),6),l=s[0];return n=s[1],t=s[2],r=s[3],i=s[4],e=s[5],ae(this._iid,function(e){l?e(l,null):(a.customApiHost=r,a.customWsHost=i,a.connecting=!0,a.reconnecting=!1,a.isReconnectingOnError=!1,a.reconnectTimer&&(clearTimeout(a.reconnectTimer),a.reconnectTimer=null,a.onReconnectTimerCancel=null),a.getConnectionState()===a.ConnectionState.OPEN&&a.currentUser&&a.currentUser.userId===n?(a.connecting=!1,e(null,a.currentUser)):(a.connectionCallbacks.push(e),1===a.connectionCallbacks.length&&(o.disconnect({clearSession:!0,err:null},null),o.connect(n,t))))},e)}},{key:"reconnect",value:function(){var e=ce.get(this._iid).container,n=e.wsAdapter;if(e.auth.sessionKey&&this.currentUser){e=!0;return 0<n.reconnectCount&&(e=!1),n.disconnect({clearSession:!1,err:new de("Connection has been canceled.",de.CONNECTION_CANCELED)},null),n.reconnectCount=0,n.reconnect(this.currentUser.userId,e),!0}return!1}},{key:"disconnect",value:function(e){var r=this;return ae(this._iid,function(e){var n=ce.get(r._iid).container,t=n.wsAdapter,n=n.onlineDetector;n&&n.stop(),t.disconnect({clearSession:!0,err:new de("Connection has been canceled.",de.CONNECTION_CANCELED)},e)},e)}},{key:"setBackgroundState",value:function(){var e=ce.get(this._iid),n=e.container,t=n.wsAdapter,r=n.stateChangeEnabled;!n.isInBackground&&r&&(e.set("isInBackground",!0),this.getConnectionState()!==this.ConnectionState.CLOSED?(e.set("closedByGoingBackground",!0),t.disconnect({clearSession:!1,err:new de("Websocket connection failed.",de.WEBSOCKET_CONNECTION_FAILED)},null)):e.set("closedByGoingBackground",!1))}},{key:"setForegroundState",value:function(){var e=ce.get(this._iid),n=e.container,t=n.wsAdapter,r=n.stateChangeEnabled,i=n.isInBackground,n=n.closedByGoingBackground;i&&r&&(e.set("isInBackground",!1),n&&this.currentUser&&t.reconnect(this.currentUser.userId,!0))}},{key:"enableStateChange",value:function(){ce.get(this._iid).set("enableStateChange",!0)}},{key:"disableStateChange",value:function(){ce.get(this._iid).set("enableStateChange",!1)}},{key:"addExtension",value:function(e,n){var t=ce.get(this._iid).container,r=t.extensions;-1<t.supportedExtensionKeys.indexOf(e)&&(r[e]=n)}},{key:"createUserListQuery",value:function(e){return new(B.get(this._iid).UserListQuery)(e)}},{key:"createApplicationUserListQuery",value:function(){return new(B.get(this._iid).ApplicationUserListQuery)}},{key:"createBlockedUserListQuery",value:function(){return new(B.get(this._iid).BlockedUserListQuery)}},{key:"createFriendListQuery",value:function(){return new(B.get(this._iid).FriendListQuery)}},{key:"createMessageSearchQuery",value:function(e,n){return new(B.get(this._iid).MessageSearchQuery)(e,n)}},{key:"sendCommand",value:function(o,e){var l=this;return ae(this._iid,function(s){l.ConnectionManager.ready(function(e,n){var t,r,i,a;e?s(e,null):(e=(t=ce.get(l._iid).container).wsAdapter,r=t.ackStateMap,null!=e&&null!=e.client&&e.client.getConnectionState()===l.ConnectionState.OPEN&&l.getConnectionState()===l.ConnectionState.OPEN?o.isAckRequired?(i=o.requestId,a={handler:s,timer:setTimeout(function(){s(new de("Command received no ack.",de.ACK_TIMEOUT),null),delete r[i]},l.Options.websocketResponseTimeout)},r[i]=a,e.client.send(o,function(e){e&&(clearTimeout(a.timer),s(e,null))})):e.client.send(o,s):s(new de("Connection is not valid. Please reconnect.",de.WEBSOCKET_CONNECTION_CLOSED),null))},!1)},e)}},{key:"setSessionHandler",value:function(e){ce.get(this._iid).container.sessionManager.handler=e}},{key:"addUserEventHandler",value:function(e,n){n instanceof B.get(this._iid).UserEventHandler&&(this.userEventHandlers[e]=n)}},{key:"removeUserEventHandler",value:function(e){delete this.userEventHandlers[e]}},{key:"removeAllUserEventHandler",value:function(){this.userEventHandlers={}}},{key:"addChannelHandler",value:function(e,n){n instanceof B.get(this._iid).ChannelHandler&&(this.channelHandlers[e]=n)}},{key:"removeChannelHandler",value:function(e){delete this.channelHandlers[e]}},{key:"removeAllChannelHandlers",value:function(){this.channelHandlers={}}},{key:"addConnectionHandler",value:function(e,n){n instanceof B.get(this._iid).ConnectionHandler&&(this.connectionHandlers[e]=n)}},{key:"removeConnectionHandler",value:function(e){delete this.connectionHandlers[e]}},{key:"removeAllConnectionHandlers",value:function(){this.connectionHandlers={}}},{key:"updateCurrentUserInfo",value:function(i,a,e){var s=this,n=T(V.parse(arguments,[new V({type:"string",nullable:!0}),new V({type:"string",nullable:!0}),new V({type:"callback"})]),4),t=n[0];return i=n[1],a=n[2],e=n[3],ae(this._iid,function(r){t?r(t,null):ce.get(s._iid).container.apiClient.updateCurrentUserInfo({nickname:i,profileUrl:a},function(e,n){var t=null;e||(s.currentUser&&(i&&(s.currentUser.nickname=i),a&&(s.currentUser.plainProfileUrl=a)),t=s.currentUser),r(e,t)})},e)}},{key:"updateCurrentUserInfoWithProfileImage",value:function(i,e,n){var a=this,t=T(V.parse(arguments,[new V({type:"string",nullable:!0}),new V({type:"file",nullable:!0}),new V({type:"callback"})]),4),s=t[0];return i=t[1],e=t[2],n=t[3],ae(this._iid,function(r){s?r(s,null):ce.get(a._iid).container.apiClient.updateCurrentUserInfo({nickname:i,profileImage:e},function(e,n){var t=null;e||(a.currentUser&&(i&&(a.currentUser.nickname=i),n.profile_url&&(a.currentUser.plainProfileUrl=n.profile_url)),t=a.currentUser),r(e,t)})},n)}},{key:"updateCurrentUserInfoWithPreferredLanguages",value:function(i,e){var a=this,n=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),t=n[0];return i=n[1],e=n[2],ae(this._iid,function(r){t?r(t,null):ce.get(a._iid).container.apiClient.updateCurrentUserInfo({preferredLanguages:i},function(e,n){var t=null;e||(a.currentUser&&i&&(a.currentUser._preferredLanguages=i),t=a.currentUser),r(e,t)})},e)}},{key:"registerGCMPushTokenForCurrentUser",value:function(e,n){var i=this,t=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"callback"})]),3),a=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){a?r(a,i.pushTokenRegistrationState.ERROR):i.currentUser?ce.get(i._iid).container.apiClient.registerGCMPushToken({token:e},function(e,n){var t=i.pushTokenRegistrationState.ERROR;e||(i.GCMPushToken="",t=i.pushTokenRegistrationState.SUCCESS),r(e,t)}):(i.GCMPushToken=e,r(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterGCMPushTokenForCurrentUser",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):r.currentUser?ce.get(r._iid).container.apiClient.unregisterGCMPushToken({token:e},function(e,n){t(e,null)}):(r.GCMPushToken=e,t(null,r.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterGCMPushTokenAllForCurrentUser",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.unregisterAllGCMPushTokens({},function(e,n){t(e,null)})},e)}},{key:"registerAPNSPushTokenForCurrentUser",value:function(e,n){var i=this,t=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"callback"})]),3),a=t[0];return e=t[1],n=t[2],ae(this._iid,function(r){a?r(a,i.pushTokenRegistrationState.ERROR):i.currentUser?ce.get(i._iid).container.apiClient.registerAPNSPushToken({token:e},function(e,n){var t=i.pushTokenRegistrationState.ERROR;e||(i.APNSPushToken="",t=i.pushTokenRegistrationState.SUCCESS),r(e,t)}):(i.APNSPushToken=e,r(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterAPNSPushTokenForCurrentUser",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return 0<e.length}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):r.currentUser?ce.get(r._iid).container.apiClient.unregisterAPNSPushToken({token:e},function(e,n){t(e,null)}):(r.APNSPushToken=e,t(null,r.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterAPNSPushTokenAllForCurrentUser",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.unregisterAllAPNSPushTokens({},function(e,n){t(e,null)})},e)}},{key:"unregisterPushTokenAllForCurrentUser",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.unregisterAllPushTokens({},function(e,n){t(e,null)})},e)}},{key:"getMyGroupChannelChangeLogsByToken",value:function(e,n,t,r){var s=this,i=null,a=T(V.parse(arguments,[new V({type:"string",nullable:!0}),new V({type:"array",optional:!0,nullable:!0,defaultValue:null}),new V({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new V({type:"callback"})]),5);i=a[0],e=a[1],n=a[2],t=a[3],r=a[4];var o=B.get(this._iid).GroupChannelChangeLogsParams,l=null;return i?(a=T(V.parse(arguments,[new V({type:"string",nullable:!0}),new V({type:o,constraint:function(e){return e._validate()}}),new V({type:"callback"})]),4),i=a[0],e=a[1],l=a[2],r=a[3]):((l=new o).customTypes=n,l.includeEmpty=t,l.includeFrozen=!0),ae(this._iid,function(a){i?a(i,null):ce.get(s._iid).container.apiClient.getMyGroupChannelChangeLogs(g({ts:null,token:e},l),function(e,n){var t,r,i;e?a(e,null):(t=B.get(s._iid).GroupChannel,r=n.updated.map(function(e){return new t(e)}),i=n.deleted,e=n.has_more,n=n.next,a(null,{updatedChannels:r,deletedChannelUrls:i,hasMore:e,token:n}))})},r)}},{key:"getMyGroupChannelChangeLogsByTimestamp",value:function(e,n,t,r){var s=this,i=null,a=T(V.parse(arguments,[new V({type:"number",constraint:function(e){return 0<=e}}),new V({type:"array",optional:!0,nullable:!0,defaultValue:null}),new V({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new V({type:"callback"})]),5);i=a[0],e=a[1],n=a[2],t=a[3],r=a[4];var o=B.get(this._iid).GroupChannelChangeLogsParams,l=null;return i?(a=T(V.parse(arguments,[new V({type:"number",constraint:function(e){return 0<=e}}),new V({type:o,constraint:function(e){return e._validate()}}),new V({type:"callback"})]),4),i=a[0],e=a[1],l=a[2],r=a[3]):((l=new o).customTypes=n,l.includeEmpty=t,l.includeFrozen=!0),ae(this._iid,function(a){i?a(i,null):ce.get(s._iid).container.apiClient.getMyGroupChannelChangeLogs(g({ts:e,token:null},l),function(e,n){var t,r,i;e?a(e,null):(t=B.get(s._iid).GroupChannel,r=n.updated.map(function(e){return new t(e)}),i=n.deleted,e=n.has_more,n=n.next,a(null,{updatedChannels:r,deletedChannelUrls:i,hasMore:e,token:n}))})},r)}},{key:"getChannelInvitationPreference",value:function(e){var n=this;return ae(this._iid,function(r){ce.get(n._iid).container.apiClient.getChannelInvitationPreference({},function(e,n){var t=null;e||(t={autoAccept:n.auto_accept}),r(e,t)})},e)}},{key:"setChannelInvitationPreference",value:function(e,n){var t=this,r=T(V.parse(arguments,[new V({type:"boolean"}),new V({type:"callback"})]),3),i=r[0];return e=r[1],n=r[2],ae(this._iid,function(r){i?r(i,null):ce.get(t._iid).container.apiClient.setChannelInvitationPreference({isAutoAccept:e},function(e,n){var t=null;e||(t={autoAccept:n.auto_accept}),r(e,t)})},n)}},{key:"getDoNotDisturb",value:function(e){var n=this;return ae(this._iid,function(r){ce.get(n._iid).container.apiClient.getDoNotDisturb({},function(e,n){var t=null;e||(t={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone}),r(e,t)})},e)}},{key:"setDoNotDisturb",value:function(e,n,t,i,a,s,r){var o=this,l=T(V.parse(arguments,[new V({type:"boolean"}),new V({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new V({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new V({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new V({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new V({type:"string"}),new V({type:"callback"})]),8),u=l[0];return e=l[1],n=l[2],t=l[3],i=l[4],a=l[5],s=l[6],r=l[7],ae(this._iid,function(r){u?r(u,null):ce.get(o._iid).container.apiClient.setDoNotDisturb({doNotDisturbOn:e,startHour:n,startMin:t,endHour:i,endMin:a,timezone:s},function(e,n){var t=null;e||(t={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone}),r(e,t)})},r)}},{key:"getSnoozePeriod",value:function(e){var n=this;return ae(this._iid,function(r){ce.get(n._iid).container.apiClient.getSnoozePeriod({},function(e,n){var t=null;e||(t={isSnoozeOn:n.snooze_enabled,startTs:n.snooze_start_ts,endTs:n.snooze_end_ts}),r(e,t)})},e)}},{key:"setSnoozePeriod",value:function(e,n,t,r){var i=this,a=T(V.parse(arguments,[new V({type:"boolean"}),new V({type:"number",constraint:function(e){return 0<e}}),new V({type:"number",constraint:function(e){return 0<e}}),new V({type:"callback"})]),5),s=a[0];return e=a[1],n=a[2],t=a[3],r=a[4],ae(this._iid,function(r){s?r(s,null):ce.get(i._iid).container.apiClient.setSnoozePeriod({snoozeOn:e,startTs:n,endTs:t},function(e,n){var t=null;e||(t={isSnoozeOn:n.snooze_enabled,startTs:n.snooze_start_ts,endTs:n.snooze_end_ts}),r(e,t)})},r)}},{key:"blockUser",value:function(e,n){var t=T(V.parse(arguments,[new V({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],r?ae(this._iid,function(e){e(r,null)},n):this.blockUserWithUserId(e.userId,n)}},{key:"blockUserWithUserId",value:function(e,n){var t=this,r=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return e&&(!t.currentUser||e!==t.currentUser.userId)}}),new V({type:"callback"})]),3),i=r[0];return e=r[1],n=r[2],ae(this._iid,function(r){i?r(i,null):ce.get(t._iid).container.apiClient.blockUser({blockedUserId:e},function(e,n){var t=null;e||(t=new _e(n)),r(e,t)})},n)}},{key:"unblockUser",value:function(e,n){var t=T(V.parse(arguments,[new V({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],r?ae(this._iid,function(e){e(r,null)},n):this.unblockUserWithUserId(e.userId,n)}},{key:"unblockUserWithUserId",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string",constraint:function(e){return e&&(!r.currentUser||e!==r.currentUser.userId)}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.unblockUser({unblockedUserId:e},function(e,n){t(e,null)})},n)}},{key:"getPushTriggerOption",value:function(e){var n=this;return ae(this._iid,function(t){ce.get(n._iid).container.apiClient.getPushTriggerOption({},function(e,n){t(e,n?n.push_trigger_option:null)})},e)}},{key:"setPushTriggerOption",value:function(e,n){var r=this;return ae(this._iid,function(t){-1<Object.keys(r.PushTriggerOption).map(function(e){return r.PushTriggerOption[e]}).indexOf(e)?ce.get(r._iid).container.apiClient.setPushTriggerOption({pushTriggerOption:e},function(e,n){t(e,n?n.push_trigger_option:null)}):t(V.error,null)},n)}},{key:"getGroupChannelCount",value:function(e,n){var t=this,r=B.get(this._iid).GroupChannel,r=T(V.parse(arguments,[new V({type:r.MemberStateFilter,optional:!0,defaultValue:r.MemberStateFilter.ALL}),new V({type:"callback"})]),3),i=r[0];return e=r[1],n=r[2],ae(this._iid,function(r){i?r(i,null):ce.get(t._iid).container.apiClient.getGroupChannelCount({memberStateFilter:e},function(e,n){var t=null;e||(t=parseInt(n.group_channel_count)),r(e,t)})},n)}},{key:"getTotalUnreadChannelCount",value:function(e){var n=this;return ae(this._iid,function(r){ce.get(n._iid).container.apiClient.getTotalUnreadChannelCount({},function(e,n){var t=null;e||(t=parseInt(n.unread_count)),r(e,t)})},e)}},{key:"getTotalUnreadMessageCount",value:function(t,e){var i=this,n=B.get(this._iid),a=n.GroupChannel,s=n.GroupChannelTotalUnreadMessageCountParams,n=T(V.parse(arguments,[new V({type:"object",optional:!0,defaultValue:null,constraint:function(e){return Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||e instanceof s}}),new V({type:"callback"})]),3),o=n[0];return t=n[1],e=n[2],ae(this._iid,function(r){var e,n;o?r(o,null):(e=a.SuperChannelFilter.ALL,t instanceof s&&(t=(n=t).channelCustomTypesFilter,e=n.superChannelFilter),ce.get(i._iid).container.apiClient.getTotalUnreadMessageCount({customTypesFilter:t,superChannelFilter:e},function(e,n){var t=null;e||(t=parseInt(n.unread_count)),r(e,t)}))},e)}},{key:"getUnreadItemCount",value:function(r,e){var n=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return 0<e.length&&e.every(function(e){return-1<Object.keys(Me.UnreadItemKey).map(function(e){return Me.UnreadItemKey[e]}).indexOf(e)})}}),new V({type:"callback"})]),3),i=t[0];return r=t[1],e=t[2],ae(this._iid,function(t){var e;i?t(i,null):(e=r.filter(function(e,n){return r.indexOf(e)===n}),ce.get(n._iid).container.apiClient.getUnreadItemCount({keys:e},function(e,n){t(e,n)}))},e)}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){var e=ce.get(this._iid).container.subscribedUnreadMessageCount;return 0<=e.all?e.all:0}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){var e=ce.get(this._iid).container.subscribedUnreadMessageCount;if(0<Object.keys(e.custom_types).length){var n,t=0;for(n in e.custom_types)t+=e.custom_types[n];return t}return 0}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){if(e&&"string"==typeof e){var n=ce.get(this._iid).container.subscribedUnreadMessageCount;return n.custom_types.hasOwnProperty(e)?n.custom_types[e]:0}return 0}},{key:"getMyPushTokensByToken",value:function(e,n,t){var r=this,i=T(V.parse(arguments,[new V({type:"string"}),new V({type:"string",constraint:function(e){return-1<["gcm","apns","apns_voip"].indexOf(e)}}),new V({type:"callback"})]),4),a=i[0];return e=i[1],n=i[2],t=i[3],ae(this._iid,function(t){a?t(a,null):ce.get(r._iid).container.apiClient.getPushTokens({ts:null,token:e,type:n},function(e,n){e?t(e,null):(e=n.type,t(null,{deviceTokens:n.device_tokens,type:e?e.toLowerCase():"unknown",hasMore:n.has_more,token:n.token}))})},t)}},{key:"getPushTemplate",value:function(e){var n=this;return ae(this._iid,function(r){ce.get(n._iid).container.apiClient.getPushTemplate({},function(e,n){var t=null;e||(t=n.name.toString()),r(e,t)})},e)}},{key:"setPushTemplate",value:function(e,n){var t=this;return ae(this._iid,function(r){-1<[t.PUSH_TEMPLATE_DEFAULT,t.PUSH_TEMPLATE_ALTERNATIVE].indexOf(e)?ce.get(t._iid).container.apiClient.setPushTemplate({templateName:e},function(e,n){var t=null;e||(t=n.name.toString()),r(e,t)}):r(V.error,null)},n)}},{key:"markAsReadAll",value:function(e){var s=this;return ae(this._iid,function(r){var i=B.get(s._iid).GroupChannel,a=(new Date).getTime();a-i.markAsReadAllLastSentAt<1e3?r(new de("MarkAsRead rate limit exceeded.",de.MARK_AS_READ_RATE_LIMIT_EXCEEDED),null):(i.markAsReadAllLastSentAt=a,ce.get(s._iid).container.apiClient.markAsReadAll({channelUrls:null},function(e,n){if(!e)for(var t in i.cachedChannels)s.currentUser&&i.cachedChannels[t].updateReadReceipt(s.currentUser.userId,a),i.cachedChannels[t]._setGroupChannelUnreadCount(0,0);r(e,null)}))},e)}},{key:"markAsReadWithChannelUrls",value:function(a,e){var s=this,n=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),t=n[0];return a=n[1],e=n[2],ae(this._iid,function(r){var i;t?r(t,null):(i=(new Date).getTime(),ce.get(s._iid).container.apiClient.markAsReadAll({channelUrls:a},function(e,n){if(!e)for(var t in a){t=a[t];Me.cachedChannels[t]&&(s.currentUser&&Me.cachedChannels[t].updateReadReceipt(s.currentUser.userId,i),Me.cachedChannels[t]._setGroupChannelUnreadCount(0,0))}r(e,null)}))},e)}},{key:"markAsDelivered",value:function(e){"string"==typeof e&&B.get(this._iid).GroupChannel.getChannel(e,ue.INTERNAL_CALL,function(e,n){e||n.markAsDelivered()})}},{key:"getFriendChangeLogsByToken",value:function(e,n){var a=this,t=T(V.parse(arguments,[new V({type:"string",optional:!0,defaultValue:null}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],ae(this._iid,function(i){r?i(r,null):ce.get(a._iid).container.apiClient.getFriendChangeLogsByToken({token:e},function(e,n){var t,r=null;e||(t=B.get(a._iid).User,r={updatedUsers:n.updated.map(function(e){return new t(e)}),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next}),i(e,r)})},n)}},{key:"uploadFriendDiscoveries",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return e.every(function(e){return e.hasOwnProperty("friendDiscoveryKey")})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.uploadFriendDiscoveries({discoveries:e},function(e,n){t(e,n)})},n)}},{key:"deleteFriendDiscovery",value:function(e,n){var t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],r?ae(this._iid,function(e){e(r,null)},n):this.deleteFriendDiscoveries([e],n)}},{key:"deleteFriendDiscoveries",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.deleteFriendDiscoveries({discoveryKeys:e},function(e,n){t(e,n)})},n)}},{key:"addFriends",value:function(e,n){var a=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],ae(this._iid,function(i){r?i(r,null):ce.get(a._iid).container.apiClient.addFriends({userIds:e},function(e,n){var t,r=null;e||(t=B.get(a._iid).User,r=n.users.map(function(e){return new t(e)})),i(e,r)})},n)}},{key:"deleteFriend",value:function(e,n){var t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),r=t[0];return e=t[1],n=t[2],r?ae(this._iid,function(e){e(r,null)},n):this.deleteFriends([e],n)}},{key:"deleteFriends",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.deleteFriends({userIds:e},function(e,n){t(e,n)})},n)}},{key:"getAllEmoji",value:function(e){var r=this,n=T(V.parse(arguments,[new V({type:"callback"})]),2),i=n[0];return e=n[1],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.getAllEmoji(function(e,n){e?t(e,null):(n=new(B.get(r._iid).EmojiContainer)(n),t(null,n))})},e)}},{key:"getEmojiCategory",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"number",constraint:function(e){return 0<=e}}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.getEmojiCategory({categoryId:e},function(e,n){e?t(e,null):(n=new(B.get(r._iid).EmojiCategory)(n),t(null,n))})},n)}},{key:"getEmoji",value:function(e,n){var r=this,t=T(V.parse(arguments,[new V({type:"string"}),new V({type:"callback"})]),3),i=t[0];return e=t[1],n=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(r._iid).container.apiClient.getEmoji({emojiKey:e},function(e,n){e?t(e,null):(n=new(B.get(r._iid).Emoji)(n),t(null,n))})},n)}},{key:"getAllowFriendDiscovery",value:function(e){var n=this,t=T(V.parse(arguments,[new V({type:"callback"})]),2),r=t[0];return e=t[1],ae(this._iid,function(t){r?t(r,null):ce.get(n._iid).container.apiClient.getAllowFriendDiscovery(function(e,n){n=n.allow_friend_discovery;e||t(null,n)})},e)}},{key:"setAllowFriendDiscovery",value:function(r,e){var n=this,t=T(V.parse(arguments,[new V({type:"boolean"}),new V({type:"callback"})]),3),i=t[0];return r=t[1],e=t[2],ae(this._iid,function(t){i?t(i,null):ce.get(n._iid).container.apiClient.setAllowFriendDiscovery({allowFriendDiscovery:r},function(e,n){e||t(null,r)})},e)}}],[{key:"version",get:function(){return ue.SDK_VERSION}},{key:"LogLevel",get:function(){return he.supportedLogLevels}},{key:"getInstance",value:function(e){return e?Jn[e]:Wn}},{key:"getLogLevel",value:function(){return he.logLevel}},{key:"setLogLevel",value:function(e){var n=Object.values(he.supportedLogLevels);n.includes(e)?he.logLevel=e:(he.logLevel=he.defaultLogLevel,n=n.map(function(e){return"'".concat(e,"'")}).join(", "),he.warn("`logLevel` parameter should be one of","".concat(n,","),"not `'".concat(e,"'`."),"Set to default log level","`".concat(he.defaultLogLevel,"`.")))}}]),s}();return Zn});