var Gmail=function(e){var t;if(void 0!==e)t=e;else if("undefined"!=typeof jQuery)t=jQuery;else try{t=require("jquery")}catch(e){}var r="undefined"!=typeof window?window.opener:null;if(r)try{r.document.domain!==window.document.domain&&(console.warn("GmailJS: window.opener domain differs from window domain."),r=null)}catch(e){console.warn("GmailJS: Unable to access window.opener!",e),r=null}var a={get:{},observe:{},check:{data:{}},tools:{},tracker:{},dom:{},chat:{},compose:{},helper:{get:{}}};function n(e="Migrate to new API compatible with new Gmail to silence this warning!"){a.DISABLE_OLD_GMAIL_API_DEPRECATION_WARNINGS||console.warn("GmailJS: using deprecated API for old Gmail.",e)}a.DISABLE_OLD_GMAIL_API_DEPRECATION_WARNINGS=!1,a.version="0.8.0",a.tracker.globals="undefined"!=typeof GLOBALS?GLOBALS:r&&r.GLOBALS||[],a.tracker.view_data="undefined"!=typeof VIEW_DATA?VIEW_DATA:r&&r.VIEW_DATA||[],a.tracker.ik=a.tracker.globals[9]||"",a.tracker.hangouts=void 0,a.cache={},a.cache.debug_xhr_fetch=!1,a.cache.emailIdCache={},a.cache.emailLegacyIdCache={},a.cache.threadCache={},a.get.last_active=function(){var e=a.tracker.globals[17][15];return{time:e[1],ip:e[3],mac_address:e[9],time_relative:e[10]}},a.get.loggedin_accounts=function(){var e,t,r,n=[],o=a.tracker.globals[17];for(e in o)if("mla"===(r=o[e])[0]){for(t in r[1])n.push({name:r[1][t][4],email:r[1][t][0],index:r[1][t][3]});return n}return n},a.get.user_email=function(){return a.tracker.globals[10]},a.get.manager_email=function(){return a.helper.get.is_delegated_inbox()?a.get.delegated_to_email():a.get.user_email()},a.get.delegated_to_email=function(){if(!a.helper.get.is_delegated_inbox())return null;var e,r,n=window.location.pathname,o=parseInt(n.substring(n.indexOf("/u/")+"/u/".length),10),i=a.get.loggedin_accounts();if(i&&i.length>0)for(e in i)if((r=i[e]).index===o)return r.email;return t(".gb_rb[href$='/u/"+o+"'] .gb_yb").text().split(" ")[0]},a.helper.get.is_locale=function(e){if(!e||"string"!=typeof e||e.length<2)return!1;if(e.match(/[0-9]/))return!1;var t=e.slice(0,2);return t.toLowerCase()===t||t.toUpperCase()===t},a.helper.filter_locale=function(e){return a.helper.get.is_locale(e)?e.substring(0,2).toLowerCase():null},a.helper.array_starts_with=function(e,t){return!!(e&&e.length>0&&e[0]===t)},a.helper.get.array_sublist=function(e,t){if(e)for(var r=0;r<e.length;r++){var n=e[r];if(a.helper.array_starts_with(n,t))return n}return null},a.helper.get.locale_from_url_params=function(e){if(e&&e.indexOf&&(0===e.indexOf("https://")||0===e.indexOf("http://"))){var t=e.split("?");if(t.length>1)for(var r=t[1].split("&"),a=0;a<r.length;a++){var n=r[a].split("=");if(2===n.length&&"hl"===n[0])return n[1]}}return null},a.helper.get.locale_from_globals_item=function(e){if(!e)return null;for(var t=0;t<e.length;t++){var r=e[t],n=a.helper.get.locale_from_url_params(r);if(n)return n}return e[8]},a.get.localization=function(){var e=a.tracker.globals,t=a.helper.get.array_sublist(e[17],"ui");if(null!==t&&t.length>8){let e=a.helper.get.locale_from_globals_item(t);if(e=a.helper.filter_locale(e))return e}if(null!==e[12]){let t=a.helper.get.locale_from_url_params(e[12]);if(t=a.helper.filter_locale(t))return t}return null},a.check.is_new_data_layer=function(){return"true"===window.GM_SPT_ENABLED},a.check.is_new_gui=function(){return"true"===window.GM_RFT_ENABLED},a.check.is_thread=function(){var e=t(".nH .if").children(":eq(1)").children().children(":eq(1)").children(),r=a.get.email_ids();return e.length>1||r.length>1},a.dom.inbox_content=function(){return t("div[role=main]:first")},a.check.is_preview_pane=function(){var e=a.dom.inbox_content().find("[gh=tl]"),r=!1;return e.each(function(){t(this).hasClass("aia")&&(r=!0)}),r},a.check.is_multiple_inbox=function(){return a.dom.inboxes().length>1},a.check.is_horizontal_split=function(){return 0===a.dom.inbox_content().find("[gh=tl]").find(".nn").length},a.check.is_vertical_split=function(){return!1===a.check.is_horizontal_split()},a.check.is_tabbed_inbox=function(){return 1===t(".aKh").length},a.check.is_right_side_chat=function(){var e=t(".ApVoH");return 0!==e.length&&":wf"===e[0].getAttribute("aria-labelledby")},a.check.should_compose_fullscreen=function(){console.warn("gmail.js: This function is known to be unreliable, and may be deprecated in a future release.");var e=[];try{e=a.tracker.globals[17][4][1][32]}catch(t){e=["bx_scfs","false"]}return"true"===e[1]},a.check.is_google_apps_user=function(){var e=a.get.user_email();return-1===e.indexOf("gmail.com",e.length-"gmail.com".length)},a.get.storage_info=function(){var e=t(".md.mj").find("div")[0],r=t(e).find("span")[0].text,a=t(e).find("span")[1].text,n=100*parseFloat(r.replace(/[^0-9\.]/g,""))/parseFloat(a.replace(/[^0-9\.]/g,""));return{used:r,total:a,percent:Math.floor(n)}},a.dom.inboxes=function(){return a.dom.inbox_content().find("[gh=tl]")},a.dom.email_subject=function(){for(var e=t(".hP"),r=0;r<e.length;r++)if(t(e[r]).is(":visible"))return t(e[r]);return t()},a.get.email_subject=function(){return a.dom.email_subject().text()},a.dom.email_body=function(){return t(".nH.hx")},a.dom.toolbar=function(){for(var e=t("[gh='mtb']");1===t(e).children().length;)e=t(e).children().first();return e},a.dom.right_toolbar=function(){for(var e=t("[gh='tm'] [gh='s']").parent();1===t(e).children().length;)e=t(e).children().first();return e},a.check.is_inside_email=function(){if("email"!==a.get.current_page()&&!a.check.is_preview_pane())return!1;for(var e=t(".ii.gt .a3s"),r=[],n=0;n<e.length;n++){var o=e[n].getAttribute("class").split(" ")[2];"undefined"!==o&&void 0!==o&&r.push(e[n])}return r.length>0},a.check.is_plain_text=function(){for(var e=a.tracker.globals[17][4][1],t=0;t<e.length;t++){var r=e[t];if("bx_cm"===r[0])return"0"===r[1]}return!1},a.dom.email_contents=function(){for(var e=t(".ii.gt div.a3s.aXjCH"),r=[],a=0;a<e.length;a++){var n=e[a].getAttribute("class").split(" ")[2],o=e[a].getAttribute("contenteditable");"undefined"!==n&&void 0!==n&&"true"!==o&&r.push(e[a])}return r},a.get.email_ids=function(){if(n(),a.check.is_inside_email()){var e=a.get.email_data();return Object.keys(e.threads)}return[]},a.get.compose_ids=function(){for(var e=[],r=t(".M9 [name=draft]"),a=0;a<r.length;a++)"undefined"!==r[a].value&&e.push(r[a].value);return e},a.get.thread_id=function(){n();const e=document.querySelector("h2[data-legacy-thread-id]");return null!==e?e.dataset.legacyThreadId:void 0},a.get.email_id=function(){return n(),a.get.thread_id()},a.check.is_priority_inbox=function(){return t(".qh").length>0},a.check.is_rapportive_installed=function(){return 1===t("#rapportive-sidebar").length},a.check.is_streak_installed=function(){return t("[id^='bentoBox'],[id*=' bentoBox'],[class*=' bentoBox'],[class*='bentoBox']").length>0},a.check.is_anydo_installed=function(){return t("[id^='anydo'],[id*=' anydo'],[class*=' anydo'],[class*='anydo']").length>0},a.check.is_boomerang_installed=function(){return t("[id^='b4g_'],[id*=' b4g_'],[class*=' b4g_'],[class*='b4g_']").length>0},a.check.is_xobni_installed=function(){return t("#xobni_frame").length>0},a.check.is_signal_installed=function(){return t("[id^='Signal'],[id*=' Signal'],[class*=' signal'],[class*='signal']").length>0},a.check.are_shortcuts_enabled=function(){for(var e=void 0,t=!0,r=a.tracker.globals[17][4][1],n=0;n<r.length;n++){var o=r[n];if("bx_hs"===o[0]){e=o[1];break}}if(void 0!==e){t={0:!0,1:!1}[e]}return t},a.dom.get_left_sidebar_links=function(){return t("div[role=navigation] [title]")},a.dom.header=function(){return t("#gb")},a.dom.search_bar=function(){return t("[gh=sb]")},a.get.search_query=function(){return a.dom.search_bar().find("input")[0].value},a.get.unread_inbox_emails=function(){return a.helper.get.navigation_count("inbox")},a.get.unread_draft_emails=function(){return a.helper.get.navigation_count("drafts")},a.get.unread_spam_emails=function(){return a.helper.get.navigation_count("spam")},a.get.unread_forum_emails=function(){return a.helper.get.navigation_count("forums")},a.get.unread_update_emails=function(){return a.helper.get.navigation_count("updates")},a.get.unread_promotion_emails=function(){return a.helper.get.navigation_count("promotions")},a.get.unread_social_emails=function(){return a.helper.get.navigation_count("social_updates")},a.helper.get.navigation_count=function(e){const r=a.tools.i18n(e),n=t("div[role=navigation]").find("[title*='"+r+"']");if((n||n.length>0)&&-1!==n[0].title.indexOf(r)){const e=parseInt(n[0].attributes["aria-label"].value.replace(/[^0-9]/g,""));if(!isNaN(e))return e}return 0},a.get.beta=function(){return{new_nav_bar:0===t("#gbz").length}},a.get.unread_emails=function(){return{inbox:a.get.unread_inbox_emails(),drafts:a.get.unread_draft_emails(),spam:a.get.unread_spam_emails(),forum:a.get.unread_forum_emails(),update:a.get.unread_update_emails(),promotions:a.get.unread_promotion_emails(),social:a.get.unread_social_emails()}},a.tools.error=function(e){if(!console)throw e;console.error(e)},a.tools.parse_url=function(e){for(var t=/[?&]([^=#]+)=([^&#]*)/g,r={},a=t.exec(e);a;)r[a[1]]=a[2],a=t.exec(e);return r},a.tools.sleep=function(e){for(var t=(new Date).getTime();!((new Date).getTime()-t>e););},a.tools.multitry=function(e,t,r,n,o,i){if(void 0!==o&&o>=t)return i;o=void 0===o?0:o;var s=r();if(n(s))return s;a.tools.sleep(e),a.tools.multitry(e,t,r,n,o+1,s)},a.tools.deparam=function(e,t){var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a={},n={true:!0,false:!1,null:null};return function(e,t){for(var r=[],a=0;a<e.length;a++)r.push(t(e[a]))}(e.replace(/\+/g," ").split("&"),function(e,o){var i,s=e.split("="),l=decodeURIComponent(s[0]),c=a,d=0,u=l.split("]["),_=u.length-1;if(/\[/.test(u[0])&&/\]$/.test(u[_])?(u[_]=u[_].replace(/\]$/,""),_=(u=u.shift().split("[").concat(u)).length-1):_=0,2===s.length)if(i=decodeURIComponent(s[1]),t&&(i=i&&!isNaN(i)?+i:"undefined"===i?void 0:void 0!==n[i]?n[i]:i),_)for(;d<=_;d++)c=c[l=""===u[d]?c.length:u[d]]=d<_?c[l]||(u[d+1]&&isNaN(u[d+1])?{}:[]):i;else r(a[l])?a[l].push(i):void 0!==a[l]?a[l]=[a[l],i]:a[l]=i;else l&&(a[l]=t?void 0:"")}),a},a.tools.get_pathname_from_url=function(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.pathname}return e},a.tools.parse_actions=function(e,t){if("fup"===e.url.act||"fuv"===e.url.act||e.body_is_object)return!(!e.body_is_object||!a.observe.bound("upload_attachment"))&&{upload_attachment:[e.body_params]};e.url.search;var r={},n={tae:"add_to_tasks","rc_^i":"archive",tr:"delete",dm:"delete_message_in_thread",dl:"delete_forever",dc_:"delete_label",dr:"discard_draft",el:"expand_categories",cffm:"filter_messages_like_these",arl:"label",mai:"mark_as_important",mani:"mark_as_not_important",us:"mark_as_not_spam",sp:"mark_as_spam",mt:"move_label",ib:"move_to_inbox",ig:"mute",rd:"read",sd:"save_draft",sm:"send_message",mo:"show_newly_arrived_message",st:"star",cs:"undo_send",ug:"unmute",ur:"unread",xst:"unstar",new_mail:"new_email",poll:"poll",refresh:"refresh",rtr:"restore_message_in_thread",open_email:"open_email",toggle_threads:"toggle_threads"};"string"==typeof e.url.ik&&(a.tracker.ik=e.url.ik),"string"==typeof e.url.at&&(a.tracker.at=e.url.at),"string"==typeof e.url.rid&&-1!==e.url.rid.indexOf("mail")&&(a.tracker.rid=e.url.rid);var o=decodeURIComponent(e.url.act),i=e.body_params,s="string"==typeof i.t?[i.t]:i.t,l=null;switch(o){case"cs":case"ur":case"rd":case"tr":case"sp":case"us":case"ib":case"dl":case"st":case"xst":case"mai":case"mani":case"ig":case"ug":case"dr":case"mt":case"cffm":case"rc_^i":l=[s,e.url,e.body];break;case"arl":case"dc_":l=[s,e.url,e.body,e.url.acn];break;case"sd":l=[s,e.url,i];break;case"tae":case"sm":l=[e.url,e.body,i];break;case"el":l=[e.url,e.body,"1"===i.ex];break;case"dm":case"rtr":case"mo":l=[i.m,e.url,e.body]}return"string"==typeof e.url._reqid&&"tl"===e.url.view&&void 0!==e.url.auto&&(l=[e.url.th,e.url,e.body],a.observe.bound("new_email")&&(r.new_email=l)),"cv"!==e.url.view&&"ad"!==e.url.view||"string"!=typeof e.url.th||"string"!=typeof e.url.search||void 0!==e.url.rid||(l=[e.url.th,e.url,e.body],a.observe.bound("open_email")&&(r.open_email=l)),"cv"!==e.url.view&&"ad"!==e.url.view||"object"!=typeof e.url.th||"string"!=typeof e.url.search||void 0===e.url.rid||(l=[e.url.th,e.url,e.body],a.observe.bound("toggle_threads")&&(r.toggle_threads=l)),"cv"!==e.url.view&&"ad"!==e.url.view||"string"!=typeof e.url.th||"string"!=typeof e.url.search||void 0===e.url.rid||void 0!==e.url.msgs&&(l=[e.url.th,e.url,e.body],a.observe.bound("toggle_threads")&&(r.toggle_threads=l)),"string"==typeof e.url.SID&&"string"==typeof e.url.zx&&-1!==e.body.indexOf("req0_")&&(a.tracker.SID=e.url.SID,l=[e.url,e.body,i],a.observe.bound("poll")&&(r.poll=l)),"string"==typeof e.url.ik&&"string"==typeof e.url.search&&0===e.body.length&&"string"==typeof e.url._reqid&&(l=[e.url,e.body,i],a.observe.bound("refresh")&&(r.refresh=l)),l&&n[o]&&a.observe.bound(n[o])&&(r[n[o]]=l),"POST"!==e.method||"string"!=typeof e.url.SID&&"string"!=typeof e.url.ik&&"string"!=typeof e.url.act||(r.http_event=[e]),a.check.is_new_data_layer()&&a.tools.parse_request_payload(e,r),r},a.check.data.is_thread_id=function(e){return e&&"string"==typeof e&&/^thread-[a|f]:/.test(e)},a.check.data.is_thread=function(e){return e&&"object"==typeof e&&e[1]&&a.check.data.is_thread_id(e[1])},a.check.data.is_email_id=function(e){return e&&"string"==typeof e&&-1===e.indexOf("bump-")&&/^msg-[a|f]:/.test(e)},a.check.data.is_email=function(e){return e&&"object"==typeof e&&e[1]&&a.check.data.is_email_id(e[1])},a.check.data.is_legacy_email_id=function(e){return e&&"string"==typeof e&&/^[0-9a-f]{16,}$/.test(e)},a.check.data.is_action=function(e){return a.check.data.is_first_type_action(e)||a.check.data.is_second_type_action(e)},a.check.data.is_first_type_action=function(e){return e&&e[1]&&Array.isArray(e[1])&&1===e[1].length&&"string"==typeof e[1][0]},a.check.data.is_second_type_action=function(e){return e&&e[2]&&Array.isArray(e[2])&&e[2].length&&"string"==typeof e[2][0]},a.check.data.is_smartlabels_array=function(e){if(!e||!Array.isArray(e)||0===e.length)return!1;for(let t of e){if("string"!=typeof t)return!1;if(!/^\^[a-z]+/.test(t))return!1}return!0},a.check.data.is_json_string=function(e){if(!e||"string"!=typeof e)return!1;let t=e.trim();return t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]")},a.tools.get_thread_id=function(e){return a.check.data.is_thread(e)&&e[1]},a.tools.get_thread_data=function(e){return e&&e[2]&&"object"==typeof e[2]&&e[2][7]&&"object"==typeof e[2][7]&&e[2][7]},a.tools.get_action=function(e){return a.tools.get_first_type_action(e)||a.tools.get_second_type_action(e)},a.tools.get_first_type_action=function(e){return e&&e[1]&&e[1].join("")},a.tools.get_second_type_action=function(e){return e&&e[2]&&e[2].join("")},a.tools.get_message_ids=function(e){return e&&e[3]&&Array.isArray(e[3])&&e[3]},a.tools.extract_from_graph=function(e,t){const r=[],a=function(e){try{return t(e)}catch(e){return!1}},n=function(e){if(a(e))r.push(e);else for(let t in e){let o=e[t];if(a(o))r.push(o);else if(Array.isArray(o))for(let t of o)n(t,e);else"object"==typeof o&&n(o)}};return n(e),r},a.tools.check_event_type=function(e){const t={"^a":"archive","^k":"delete","^x_":"label","^u^us":"read","^u":"unread","^us":"new_email","^o":"open_email"},r=a.tools.get_thread_data(e);if(r&&a.check.data.is_action(r)){const e=a.tools.get_action(r);return e.startsWith("^x_")&&a.check.data.is_first_type_action(r)?t["^x_"]:t[e]}return null},a.tools.parse_fd_bv_contacts=function(e){if(!e||!Array.isArray(e))return[];const t=[];for(let r of e)t.push(a.tools.parse_fd_bv_contact(r));return t},a.tools.parse_fd_bv_contact=function(e){try{return{name:e[3],address:e[2]}}catch(e){return null}},a.tools.parse_fd_attachments=function(e){let t=[];if(Array.isArray(e))for(let r of e){let e=r[1][4]||"";t.push({attachment_id:r[1][2],name:e[3],type:e[4],url:a.tools.check_fd_attachment_url(e[2]),size:Number.parseInt(e[5])})}return t},a.tools.check_fd_attachment_url=function(e){var t=a.tracker.globals[7];return e&&t&&e.indexOf(t)<0&&(e=e.replace("/mail/?",t+"?")),e},a.tools.parse_fd_request_html_payload=function(e){let t=null;try{const r=e[2][6][2];for(let e of r)t=(t||"")+e[3][2]}catch(e){}return t},a.tools.parse_fd_embedded_json_content_html=function(e){let t=null;try{const r=e[9][2];for(let e of r)t=(t||"")+e[3][2]}catch(e){}return t},a.tools.parse_fd_request_payload_get_email2=function(e,t){try{return e[2][2].filter(e=>e[1]===t)[0]}catch(e){return{}}},a.tools.parse_fd_embedded_json_get_email=function(e,t){try{return e[2][5].filter(e=>e[1]===t)[0]}catch(e){return{}}},a.tools.parse_fd_request_payload=function(e){let t=e[2];if(!t||!Array.isArray(t))return null;try{const e=[],r=t;for(let t of r){const r=t[1];let n=t[3];for(let o of n){const n=o[1],i=a.tools.parse_fd_request_payload_get_email2(t,n),s=o[2][35],l=o[2][8],c=o[2][5],d=Number.parseInt(o[2][17]),u=new Date(d),_=a.tools.parse_fd_request_html_payload(o),m=a.tools.parse_fd_attachments(o[2][14]),h=o[2][11][17];let f=a.tools.parse_fd_bv_contact(i[2]);f||(f={address:h,name:""});const p={id:n,legacy_email_id:s,thread_id:r,smtp_id:l,subject:c,timestamp:d,content_html:_,date:u,from:f,to:a.tools.parse_fd_bv_contacts(o[2][1]),cc:a.tools.parse_fd_bv_contacts(o[2][2]),bcc:a.tools.parse_fd_bv_contacts(o[2][3]),attachments:m};a.cache.debug_xhr_fetch&&(p.$email_node=o,p.$thread_node=t),e.push(p)}}return e}catch(e){return console.warn("Gmail.js encountered an error trying to parse email-data on fd request!",e),null}},a.tools.parse_fd_embedded_json=function(e){let t=e[2];if(!t||!Array.isArray(t))return null;try{const e=[],r=t;for(let t of r){const r=t[2][4];let n=t[2][5];for(let o of n){const n=o[1],i=a.tools.parse_fd_embedded_json_get_email(t,n),s=o[56],l=o[14],c=o[8],d=Number.parseInt(o[18]),u=new Date(d),_=a.tools.parse_fd_embedded_json_content_html(o),m=a.tools.parse_fd_attachments(o[12]),h=o[19][17];let f=a.tools.parse_fd_bv_contact(i[2]);f||(f={address:h,name:""});const p={id:n,legacy_email_id:s,thread_id:r,smtp_id:l,subject:c,timestamp:d,content_html:_,date:u,from:f,to:a.tools.parse_fd_bv_contacts(o[3]),cc:a.tools.parse_fd_bv_contacts(o[4]),bcc:a.tools.parse_fd_bv_contacts(o[5]),attachments:m};a.cache.debug_xhr_fetch&&(p.$email_node=o,p.$thread_node=t),e.push(p)}}return e}catch(e){return console.warn("Gmail.js encountered an error trying to parse email-data on embedded json!",e),null}},a.tools.parse_bv_request_payload=function(e){let t=e[3];if(!t||!Array.isArray(t))return null;try{const e=[],r=t;for(let t of r){const r=t[1][1],n=t[1][4];let o=t[1][5];for(let i of o){const o=i[1],s=i[56],l="",c=r,d=Number.parseInt(i[18]),u=[],_={id:o,legacy_email_id:s,thread_id:n,smtp_id:l,subject:c,timestamp:d,content_html:"",date:new Date(d),from:{address:void 0!==i[2][2]?i[2][2]:"",name:void 0!==i[2][3]?i[2][3]:""},to:[],cc:[],bcc:[],attachments:u};a.cache.debug_xhr_fetch&&(_.$email_node=i,_.$thread_node=t),e.push(_)}}return e}catch(e){return console.warn("Gmail.js encountered an error trying to parse email-data on bv request!",e),null}},a.tools.parse_bv_embedded_json=function(e){let t=e[1][1];if(!t||!Array.isArray(t))return null;try{const e=[],r=t;for(let t of r){const r=t[5][1],n=t[5][4];let o=t[5][5];for(let i of o){const o=i[1],s=i[56],l="",c=r,d=Number.parseInt(i[18]),u=[],_={id:o,legacy_email_id:s,thread_id:n,smtp_id:l,subject:c,timestamp:d,content_html:"",date:new Date(d),from:{address:void 0!==i[2][2]?i[2][2]:"",name:void 0!==i[2][3]?i[2][3]:""},to:[],cc:[],bcc:[],attachments:u};a.cache.debug_xhr_fetch&&(_.$email_node=i,_.$thread_node=t),e.push(_)}}return e}catch(e){return console.warn("Gmail.js encountered an error trying to parse email-data on bv request!",e),null}},a.tools.parse_sent_message_html_payload=function(e){let t=null;try{const r=e[9][2];for(let e of r)t=(t||"")+e[2]}catch(e){}return t},a.tools.parse_sent_message_attachments=function(e){let t=[];if(Array.isArray(e))for(let r of e)t.push({id:r[5],name:r[2],type:r[1],url:r[6],size:Number.parseInt(r[3])});return t},a.tools.parse_sent_message_payload=function(e){try{let t=e;const r=t[1],n=t[8],o=Number.parseInt(t[7]),i=new Date(o),s=a.tools.parse_sent_message_html_payload(t),l=t[9][7],c=a.tools.parse_sent_message_attachments(t[12]);return{1:r,id:r,subject:n,timestamp:o,content_html:s,ishtml:l,date:i,from:a.tools.parse_fd_bv_contact(t[2]),to:a.tools.parse_fd_bv_contacts(t[3]),cc:a.tools.parse_fd_bv_contacts(t[4]),bcc:a.tools.parse_fd_bv_contacts(t[5]),attachments:c,email_node:e}}catch(e){return console.warn("Gmail.js encountered an error trying to parse sent message!",e),null}},a.tools.parse_request_payload=function(e,t,r){const n=a.tools.get_pathname_from_url(e.url_raw);if(!r&&!n)return;const o=(n||"").endsWith("/i/s"),i=(n||"").endsWith("/i/fd");if(!r&&!i&&!o)return;i&&(t.load_email_data=[null]);const s=a.tools.extract_from_graph(e,a.check.data.is_thread),l=a.tools.extract_from_graph(e,a.check.data.is_email);for(let r of l)for(let n in r){let o=r[n];if(a.check.data.is_smartlabels_array(o)){let n=a.tools.parse_sent_message_payload(r);-1!==o.indexOf("^pfg")?t.send_message=[e.url,e.body,n]:o.indexOf("^scheduled")>-1&&(t.send_scheduled_message=[e.url,e.body,n])}}try{if(Array.isArray(s)&&a.check.data.is_thread(s[0])){const r=a.tools.check_event_type(s[0]);if(r){const n=s.map(e=>a.tools.get_thread_data(e)),o=s.map(e=>a.tools.get_thread_id(e)),i=n.map(e=>a.tools.get_message_ids(e)).reduce((e,t)=>e.concat(t),[]);t[r]=[null,e.url,e.body,i,o]}}}catch(e){console.error("Error: ",e)}},a.tools.parse_response=function(e){if(a.check.data.is_json_string(e))try{return JSON.parse(e)}catch(e){}if(e.startsWith("<!DOCTYPE html")||-1!==e.indexOf("display:inline-block"))return[];let t=[];try{for(e=(e=e.replace(/\n/g," ")).substring(e.indexOf("'")+1,e.length);e.replace(/\s/g,"").length>1;){let r=e.substring(0,e.indexOf("[")).replace(/\s/g,"");r||(r=e.length);let a=parseInt(r,10)-2+e.indexOf("["),n=e.substring(e.indexOf("["),a),o=JSON.parse(n);t.push(o),e=(e=e.substring(e.indexOf("["),e.length)).substring(n.length,e.length)}}catch(e){}return t},a.tools.parse_attachment_url=function(e){var t=e.split(":");return{type:t[0],url:t[2]+":"+t[3]}};var o=function(e,t){for(var r in t)e[r]=t[r]},i=function(e,t){for(var r=0;r<t.length;r++){var a=t[r];e.push(a)}return e};a.tools.parse_requests=function(e,t){e.url_raw=e.url,e.url=a.tools.parse_url(e.url),"object"==typeof e.body?(e.body_params=e.body,e.body_is_object=!0):a.check.data.is_json_string(e.body)?e.body_params=JSON.parse(e.body):void 0!==e.body?e.body_params=a.tools.deparam(e.body):e.body_params={},"object"!=typeof a.tracker.events&&"object"!=typeof a.tracker.actions&&(a.tracker.events=[],a.tracker.actions=[]),a.tracker.events.unshift(e);var r=a.tools.parse_actions(e,t);return"POST"===e.method&&"string"==typeof e.url.act&&a.tracker.actions.unshift(e),a.tracker.events.length>50&&a.tracker.events.pop(),a.tracker.actions.length>10&&a.tracker.actions.pop(),r},a.tools.patch=function(e,t){t(e)},a.tools.cache_email_data=function(e,t){if(null===e)return;const r=a.cache;let n=!1;"fd_request_payload"!==t&&"fd_embedded_json"!==t||(n=!0);for(let t of e){void 0===r.emailIdCache[t.id]?(r.emailIdCache[t.id]=t,r.emailLegacyIdCache[t.legacy_email_id]=t):n&&(r.emailIdCache[t.id]=t,r.emailLegacyIdCache[t.legacy_email_id]=t);let e=r.threadCache[t.thread_id];if(e||(e={thread_id:t.thread_id,emails:[]},r.threadCache[t.thread_id]=e),0===e.emails.filter(e=>e.id===t.id).length)e.emails.push(t);else if(n){let r=e.emails.findIndex(e=>e.id===t.id);e.emails[r]=t}}},a.tools.xhr_watcher=function(){if(a.tracker.xhr_init)return;a.tracker.xhr_init=!0;const e=a.helper.get_xhr_window();a.tools.patch(e.XMLHttpRequest.prototype.open,t=>{e.XMLHttpRequest.prototype.open=function(e,r,a,n,o){var i=t.apply(this,arguments);return this.xhrParams={method:e.toString(),url:r.toString()},i}}),a.tools.patch(e.XMLHttpRequest.prototype.send,r=>{e.XMLHttpRequest.prototype.send=function(e){var n=!1;if(this.xhrParams&&(this.xhrParams.body=e,n=a.tools.parse_requests(this.xhrParams,this)),a.observe.trigger("before",n,this)&&(e=a.check.is_new_data_layer()?arguments[0]=this.xhrParams.body_is_object?this.xhrParams.body_params:JSON.stringify(this.xhrParams.body_params):arguments[0]=this.xhrParams.body_is_object?this.xhrParams.body_params:t.param(this.xhrParams.body_params,!0).replace(/\+/g,"%20")),a.observe.bound(n,"after")||a.check.is_new_data_layer()){var o=this.onreadystatechange,i=this;this.onreadystatechange=function(e){if(this.readyState===this.DONE){if(""===e.target.responseType||"text"===e.target.responseType?i.xhrResponse=a.tools.parse_response(e.target.responseText):i.xhrResponse=e.target.response,a.check.is_new_data_layer()){if(a.tools.get_pathname_from_url(i.xhrParams.url_raw).endsWith("/i/fd")){let e=a.tools.parse_fd_request_payload(i.xhrResponse);null!=e&&(a.tools.cache_email_data(e,"fd_request_payload"),n.load_email_data=[e])}if(a.tools.get_pathname_from_url(i.xhrParams.url_raw).endsWith("/i/bv")){let e=a.tools.parse_bv_request_payload(i.xhrResponse);null!=e&&(a.tools.cache_email_data(e,"bv_request_payload"),n.load_email_data=[e])}}a.observe.trigger("after",n,i)}o&&o.apply(this,arguments)}}var s=r.apply(this,arguments);return a.observe.trigger("on",n,this),s}})},a.tools.embedded_data_watcher=function(){if(!a.tracker.embedded_data_init){a.tracker.embedded_data_init=!0;var e=window._GM_setData;window._GM_setData=function(t){if(void 0!==t&&void 0!==t.Cl6csf&&void 0!==t.Cl6csf[0][2]){let e=a.tools.parse_fd_embedded_json(JSON.parse(t.Cl6csf[0][2]));a.tools.cache_email_data(e,"fd_embedded_json")}if(void 0!==t&&void 0!==t.a6jdv&&void 0!==t.a6jdv[0][2]){let e=a.tools.parse_bv_embedded_json(JSON.parse(t.a6jdv[0][2]));a.tools.cache_email_data(e,"bv_embedded_json")}e(t)}}},a.helper.get_xhr_window=function(){if(a.check.is_new_gui())return top;var e=null;return top.document.getElementById("js_frame")?e=top.document.getElementById("js_frame"):r&&(e=r.top.document.getElementById("js_frame")),e||(e=r?r.top:top),e.contentDocument?e.contentDocument.defaultView:e},a.observe.http_requests=function(){return a.tracker.events},a.observe.actions=function(){return a.tracker.actions},a.observe.bind=function(e,t,r){"object"!=typeof a.tracker.watchdog&&(a.tracker.watchdog={before:{},on:{},after:{},dom:{}},a.tracker.bound={}),"object"!=typeof a.tracker.watchdog[e]&&a.tools.error("api.observe.bind called with invalid type: "+e),"dom"!==e&&a.tools.xhr_watcher(),"object"!=typeof a.tracker.watchdog[e][t]&&(a.tracker.watchdog[e][t]=[]),a.tracker.watchdog[e][t].push(r),a.tracker.bound[t]=void 0===a.tracker.bound[t]?1:a.tracker.bound[t]+1,a.tracker.bound[e]=void 0===a.tracker.bound[e]?1:a.tracker.bound[e]+1},a.observe.on=function(e,t,r){if(a.observe.on_dom(e,t))return!0;a.observe.bind("on",e,t),r&&a.observe.after(e,t)},a.observe.before=function(e,t){a.observe.bind("before",e,t)},a.observe.after=function(e,t){a.observe.bind("after",e,t)},a.observe.bound=function(e,r){if("object"!=typeof a.tracker.watchdog)return!1;if(e){if("object"==typeof e){var n=!1;return t.each(e,function(e,t){"object"==typeof a.tracker.watchdog[r][e]&&(n=!0)}),n}return r?"object"==typeof a.tracker.watchdog[r][e]:a.tracker.bound[e]>0}if(r)return a.tracker.bound[r]>0;a.tools.error("api.observe.bound called with invalid args")},a.observe.off=function(e,r){if("object"!=typeof a.tracker.watchdog)return!0;var n=r?[r]:["before","on","after","dom"];t.each(n,function(r,n){if("object"!=typeof a.tracker.watchdog[n])return!0;e?"object"==typeof a.tracker.watchdog[n][e]&&(a.tracker.bound[e]-=a.tracker.watchdog[n][e].length,a.tracker.bound[n]-=a.tracker.watchdog[n][e].length,delete a.tracker.watchdog[n][e]):t.each(a.tracker.watchdog[n],function(e,t){"object"==typeof a.tracker.watchdog[n][e]&&(a.tracker.bound[e]-=a.tracker.watchdog[n][e].length,a.tracker.bound[n]-=a.tracker.watchdog[n][e].length,delete a.tracker.watchdog[n][e])})})},a.observe.trigger=function(e,r,n){if(!r)return!1;var o=!1;return t.each(r,function(r,i){i=t.extend([],i),"after"===e&&i.push(n.xhrResponse),i.push(n),a.observe.bound(r,e)&&(o=!0,t.each(a.tracker.watchdog[e][r],function(e,t){t.apply(void 0,i)}))}),o},a.observe.trigger_dom=function(e,r,n){n||(n=function(e,t){t(e)}),a.tracker.watchdog.dom[e]&&t.each(a.tracker.watchdog.dom[e],function(e,t){n(r,t)})},a.observe.initialize_dom_observers=function(){a.tracker.dom_observer_init=!0,a.tracker.supported_observers=["view_thread","view_email","load_email_menu","recipient_change","compose"],a.tracker.dom_observers={view_thread:{class:["Bu","nH"],sub_selector:"div.if",handler:function(e,t){t(e=new a.dom.thread(e))}},view_email:{class:["Bu","nH",""],sub_selector:"div.adn",handler:function(e,t){t(e=new a.dom.email(e))}},load_email_menu:{class:"J-N",selector:"div[role=menu] div[role=menuitem]:first-child",handler:function(e,t){t(e=e.closest("div[role=menu]"))}},recipient_change:{class:"vR",handler:function(e,t){"object"!=typeof a.tracker.recipient_matches&&(a.tracker.recipient_matches=[]),a.tracker.recipient_matches.push(e),setTimeout(function(){if(a.tracker.recipient_matches.length){var e=new a.dom.compose(a.tracker.recipient_matches[0].closest("div.M9")),r=e.recipients();t(e,r,a.tracker.recipient_matches),a.tracker.recipient_matches=[]}},100)}},compose:{class:"An",handler:function(e,t){var r=e;if((e=e.closest("div.M9")).length){var n;if((e=new a.dom.compose(e)).is_inline())n=0===e.find("input[name=subject]").val().indexOf("Fw")?"forward":"reply";else n="compose",r.closest("div.AD").find(".Ha").mouseup(function(){return a.tracker.composeCancelledCallback&&a.tracker.composeCancelledCallback(e),!0});t(e,n)}}}},a.tracker.custom_supported_observers&&(t.merge(a.tracker.supported_observers,a.tracker.custom_supported_observers),t.extend(!0,a.tracker.dom_observers,a.tracker.custom_dom_observers)),a.tracker.dom_observer_map={},t.each(a.tracker.dom_observers,function(e,r){t.isArray(r.class)||(r.class=[r.class]),t.each(r.class,function(t,r){a.tracker.dom_observer_map[r]||(a.tracker.dom_observer_map[r]=[]),a.tracker.dom_observer_map[r].push(e)})})},a.observe.register=function(e,r){a.tracker.dom_observer_init&&a.tools.error("Error: Please register all custom DOM observers before binding handlers using gmail.observe.on etc"),a.tracker.custom_supported_observers||(a.tracker.custom_supported_observers=[],a.tracker.custom_dom_observers={});var n={};"object"!=typeof r||t.isArray(r)?n.class=r:t.each(["class","selector","sub_selector","handler"],function(e,t){r[t]&&(n[t]=r[t])}),a.tracker.custom_supported_observers.push(e),a.tracker.custom_dom_observers[e]=n},a.observe.on_dom=function(e,r){if(a.tracker.dom_observer_init||a.observe.initialize_dom_observers(),t.inArray(e,a.tracker.supported_observers)>-1){if(!a.tracker.observing_dom)a.tracker.observing_dom=!0,t(window.document).on("DOMNodeInserted",function(e){a.tools.insertion_observer(e.target,a.tracker.dom_observers,a.tracker.dom_observer_map)}),new MutationObserver(function(e){for(var r=0;r<e.length;r++)for(var n=e[r],o=n.removedNodes,i=0;i<o.length;i++){if("vR"===o[i].className){var s=a.tracker.dom_observer_map.vR,l=a.tracker.dom_observers.recipient_change.handler;a.observe.trigger_dom(s,t(n.target),l)}}}).observe(document.body,{subtree:!0,childList:!0});return a.observe.bind("dom",e,r),!0}if("compose_cancelled"===e)a.tracker.composeCancelledCallback=r;else if("load"===e){if(a.dom.inbox_content().length)return r();var n=0,o=setInterval(function(){if(a.dom.inbox_content().length>0)return clearInterval(o),r();++n>50&&(clearInterval(o),setTimeout(r,5e3))},200);return!0}},a.tools.insertion_observer=function(e,r,n,o){if(a.tracker.dom_observer_map){var i=e.className||"",s=i.trim?i.trim().split(/\s+/):[];s.length||s.push(""),t.each(s,function(o,i){var s=n[i];if(s)for(var l of s)if(l&&a.tracker.watchdog.dom[l]){var c=t(e),d=r[l];if(d.selector&&!c.is(d.selector))return;if(d.sub_selector&&(c=c.find(d.sub_selector)),c.length){var u=d.handler?d.handler:function(e,t){t(e)};a.observe.trigger_dom(l,c,u)}}})}},a.tools.make_request=function(e,r,a){var n=decodeURIComponent(e.replace(/%23/g,"#-#-#")),o={type:r=r||"GET",url:n=encodeURI(n).replace(/#-#-#/gi,"%23"),async:!1,dataType:"text"};return a&&(o.cache=!1),t.ajax(o).responseText},a.tools.make_request_async=function(e,r,a,n,o){var i=decodeURIComponent(e.replace(/%23/g,"#-#-#")),s={type:r=r||"GET",url:i=encodeURI(i).replace(/#-#-#/gi,"%23"),async:!0,dataType:"text"};o&&(s.cache=!1),t.ajax(s).done(function(e,t,r){a(r.responseText)}).fail(function(e,t,r){console.error("Request Failed",r),"function"==typeof n&&n(e,t,r)})},a.tools.make_request_download_promise=function(e,t){const r=Date.now();e+="&cacheCounter="+r;let a="text";return t&&(a="arraybuffer"),new Promise((r,n)=>{const o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=a,o.onreadystatechange=(()=>{if(o.readyState===XMLHttpRequest.DONE&&o.status>=200&&o.status<=302){const e=o.response;if(e)if(t){const t=new Uint8Array(e);r(t)}else r(e)}}),o.onerror=(e=>{n(e)}),o.send()})},a.tools.parse_view_data=function(e){for(var t=[],r=[],a=0;a<e.length;a++)if("tb"===e[a][0])for(var n=0;n<e[a][2].length;n++)r.push(e[a][2][n]);for(var o=0;o<r.length;o++){var i=r[o];t.push({id:i[0],title:i[9],excerpt:i[10],time:i[15],sender:i[28],attachment:i[13],labels:i[5]})}return t},a.helper.get.is_delegated_inbox=function(){return 1===t(".identityUserDelegatedAccount").length},a.helper.get.visible_emails_pre=function(e){var r=a.get.current_page(),n=window.location.origin+window.location.pathname+"?ui=2&ik="+a.tracker.ik+"&rid="+a.tracker.rid+"&view=tl&num=120&rt=1",o=t(".aqK:visible .Dj").find("span:first").text().replace(",","").replace(".","").split("–")[0];n+=o?"&start="+(o=parseInt(o-1))+"&sstart="+o:"&start=0";var i="";if(0===r.indexOf("label/"))n+="&cat="+r.split("/")[1]+"&search=cat";else if(0===r.indexOf("category/"))-1!==r.indexOf("forums")?i="group":-1!==r.indexOf("updates")?i="notification":-1!==r.indexOf("promotion")?i="promo":-1!==r.indexOf("social")&&(i="social"),n+="&cat=^smartlabel_"+i+"&search=category";else if(0===r.indexOf("search/")){var s=t("input[name=at]").val();n+="&qs=true&q="+r.split("/")[1]+"&at="+s+"&search=query"}else"inbox"===r?"true"===t("div[aria-label='Social']").attr("aria-selected")?n+="&cat=^smartlabel_"+(i="social")+"&search=category":"true"===t("div[aria-label='Promotions']").attr("aria-selected")?n+="&cat=^smartlabel_"+(i="promo")+"&search=category":"true"===t("div[aria-label='Updates']").attr("aria-selected")?n+="&cat=^smartlabel_"+(i="notification")+"&search=category":"true"===t("div[aria-label='Forums']").attr("aria-selected")?n+="&cat=^smartlabel_"+(i="group")+"&search=category":e?n+="&search="+e:a.check.is_google_apps_user()?n+="&search=inbox":n+="&search=mbox":n+="&search="+r;return n},a.helper.get.visible_emails_post=function(e){var t=[];if(!e)return t;var r=e.substring(e.indexOf("["),e.length),n=JSON.parse(r);for(var o in a.tracker.view_data=n,a.tracker.view_data)if("function"!=typeof a.tracker.view_data[o]){var s=a.tools.parse_view_data(a.tracker.view_data[o]);s.length>0&&i(t,s)}return t},a.get.visible_emails=function(e){var t=a.helper.get.visible_emails_pre(e),r=a.tools.make_request(t);return a.helper.get.visible_emails_post(r)},a.get.visible_emails_async=function(e,t){var r=a.helper.get.visible_emails_pre(t);a.tools.make_request_async(r,"GET",function(t){var r=a.helper.get.visible_emails_post(t);e(r)})},a.get.selected_emails_data=function(e){var r=[];if(a.check.is_inside_email())r.push(a.get.email_data());else if(t("[gh='tl'] div[role='checkbox'][aria-checked='true']").length){var n=null,o=a.get.visible_emails(e);t("[gh='tl'] div[role='checkbox']").each(function(e){"true"===t(this).attr("aria-checked")&&(n=a.get.email_data(o[e].id),r.push(n))})}return r},a.get.current_page=function(e){var t=(e=e||window.location.hash).split("#").pop().split("?").shift()||"inbox";if(t.match(/\/[0-9a-zA-Z]{16,}$/gi))return"email";if(0===t.indexOf("search/")||0===t.indexOf("category/")||0===t.indexOf("label/")){var r=t.split("/");return r[0]+"/"+r[1]}return t.split("/").shift()},a.tools.infobox=function(e,r,a){var n=t(".b8.UC");if(n.length>0){n.stop(!1,!0);var o=n.find(".vh");if(a?o.html(e):o.text(e),void 0!==r){var i=n.attr("style");n.removeAttr("style").fadeTo(r,0,function(){t(this).attr("style",i)})}else n.removeAttr("style")}},a.tools.rerender=function(e){var t,r=window.location.href;t=-1!==window.location.hash.indexOf("/")?r.replace(/#.*?\//,"#/"):r.replace(/#.*/,"#"),window.location.replace(t),setTimeout(function(){window.location.replace(r),window.history.back(),e&&e()},0)},a.tools.get_reply_to=function(e){var t=e?e[4]:[];return 0!==t.length?a.tools.extract_email_address(t[0]):null},a.tools.parse_attachment_data=function(e){if(!e[7]||!e[7][0])return null;var t="";"undefined"!=typeof window&&(t=window.location.origin+window.location.pathname);var r=e[7][0];a.tracker.attachment_data=r;for(var n=[],o=0;o<r.length;o++){var i=r[o];n.push({attachment_id:i[0],name:i[1],type:i[2],size:i[3],url:t+i[9]})}return n},a.tools.parse_email_data=function(e){var r={};for(var n in e){var o=e[n];if("cs"===o[0]&&(r.thread_id=o[1],r.first_email=o[8][0],r.last_email=o[2],r.total_emails=o[3],r.total_threads=o[8],r.people_involved=o[15],r.subject=o[23]),"ms"===o[0]){void 0===r.threads&&(r.threads={}),r.threads[o[1]]={},r.threads[o[1]].is_deleted=o[9]&&o[9].indexOf("^k")>-1,r.threads[o[1]].reply_to_id=o[2],r.threads[o[1]].from=o[5],r.threads[o[1]].from_email=o[6],r.threads[o[1]].timestamp=o[7],r.threads[o[1]].datetime=o[24],r.threads[o[1]].attachments=o[21].split(","),r.threads[o[1]].attachments_details=o[13]?a.tools.parse_attachment_data(o[13]):null,r.threads[o[1]].subject=o[12],r.threads[o[1]].content_html=o[13]?o[13][6]:o[8],r.threads[o[1]].to=o[13]?o[13][1]:void 0!==o[37]?o[37][1]:[],r.threads[o[1]].cc=o[13]?o[13][2]:[],r.threads[o[1]].bcc=o[13]?o[13][3]:[],r.threads[o[1]].reply_to=a.tools.get_reply_to(o[13]),r.threads[o[1]].labels=o[9];try{r.threads[o[1]].content_plain=o[13]?t(o[13][6]).text():o[8]}catch(e){r.threads[o[1]].content_plain=o[13]?o[13][6]:o[8]}}}return r},a.helper.get.email_data_pre=function(e){n("Migrate code to use gmail.new.get.email_data() to fix this problem."),a.check.is_inside_email()&&void 0===e&&(e=a.get.thread_id());var t=null;return void 0!==e&&(t=window.location.origin+window.location.pathname+"?ui=2&ik="+a.tracker.ik+"&rid="+a.tracker.rid+"&view=cv&th="+e+"&msgs=&mb=0&rt=1&search=inbox"),t},a.helper.get.email_data_post=function(e){if(!e)return{};var t=e.substring(e.indexOf("["),e.length),r=JSON.parse(t);return a.tracker.email_data=r[0],a.tools.parse_email_data(a.tracker.email_data)},a.get.email_data=function(e){var t=a.helper.get.email_data_pre(e);if(null!==t){var r=a.tools.make_request(t);return a.helper.get.email_data_post(r)}return{}},a.get.email_data_async=function(e,t){var r=a.helper.get.email_data_pre(e);null!==r?a.tools.make_request_async(r,"GET",function(e){var r=a.helper.get.email_data_post(e);t(r)}):t({})},a.helper.get.legacy_email_id=function(e){if(!e)return null;if(a.check.data.is_legacy_email_id(e))return e;if(e.legacy_email_id)return e.legacy_email_id;if(a.check.data.is_email_id(e)){console.warn("GmailJS: Warning! Using new-style ID in method expecting legacy-style IDs! Attempting to resolve via cache, but there's no guarantee this will work!");const t=a.cache.emailIdCache[e];return t&&t.legacy_email_id}return e.$el&&e.$el[0]&&(e=e.$el[0]),e.dataset&&e.dataset.legacyMessageId?e.dataset.legacyMessageId:null},a.helper.get.new_email_id=function(e){if(!e)return null;if(a.check.data.is_email_id(e))return e;if(e.id&&!e.$el)return e.id;if(a.check.data.is_legacy_email_id(e)){console.warn("GmailJS: Warning! Using legacy-style ID in method expecting new-style IDs! Attempting to resolve via cache, but there's no guarantee this will work!");const t=a.cache.emailLegacyIdCache[e];return t&&t.id}if(e.$el&&e.$el[0]&&(e=e.$el[0]),e.dataset&&e.dataset.messageId){let t=e.dataset.messageId;return 0===t.indexOf("#")&&(t=t.substring(1)),t}return null},a.helper.get.thread_id=function(e){if(!e)return null;if(a.check.data.is_thread_id(e))return e;if(e.thread_id)return e.thread_id;if(a.check.data.is_email_id(e)){console.warn("GmailJS: Warning! Using email-ID in method expecting thread-ID! Attempting to resolve via cache, but there's no guarantee this will work!");const t=a.cache.emailIdCache[e];return t&&t.thread_id}if(a.check.data.is_legacy_email_id(e)){console.warn("GmailJS: Warning! Using legacy-style ID in method expecting thread-ID! Attempting to resolve via cache, but there's no guarantee this will work!");const t=a.cache.emailLegacyIdCache[e];return t&&t.thread_id}if(e.$el&&e.$el[0]&&(e=e.$el[0]),e.dataset&&e.dataset.threadPermId){let t=e.dataset.threadPermId;return 0===t.indexOf("#")&&(t=t.substring(1)),t}if(e.dataset&&e.dataset.messageId){let t=e.dataset.messageId;0===t.indexOf("#")&&(t=t.substring(1)),console.warn("GmailJS: Warning! Using DomEmail instance to lookup thread-ID. Attempting to resolve via cache, but there's no guarantee this will work!");const r=a.cache.emailIdCache[t];return r&&r.thread_id}return null},a.helper.clean_thread_id=function(e){return e.startsWith("#")&&(e=e.substring(1)),e},a.helper.get.email_source_pre=function(e){!e&&a.check.is_inside_email()&&(e=a.get.email_id());const t=a.helper.get.legacy_email_id(e);return t?window.location.origin+window.location.pathname+"?view=att&th="+t+"&attid=0&disp=comp&safe=1&zw":null},a.get.email_source=function(e){console.warn("Gmail.js: This function has been deprecated and will be removed in an upcoming release! Please migrate to email_source_async or email_source_promise!");var t=a.helper.get.email_source_pre(e);return null!==t?a.tools.make_request(t,"GET",!0):""},a.get.email_source_async=function(e,t,r,n){a.get.email_source_promise(e,n).then(t).catch(r)},a.get.email_source_promise=function(e,t){const r=a.helper.get.email_source_pre(e);return null!==r?a.tools.make_request_download_promise(r,t):new Promise((e,t)=>{t("Unable to resolve URL for email source!")})},a.get.displayed_email_data=function(){var e=a.get.email_data();return a.check.is_conversation_view()?s(e):l(e)},a.get.displayed_email_data_async=function(e){a.get.email_data_async(void 0,function(t){a.check.is_conversation_view()?e(s(t)):e(l(t))})};var s=function(e){var t=e,r=t.threads,a=t.total_threads,n=0===(window.location.hash.split("#")[1]||"").indexOf("trash");for(var o in r){var i=r[o];(n?i.is_deleted:!i.is_deleted)||(delete r[o],a.splice(a.indexOf(o),1),t.total_emails--)}return t},l=function(e){var t={};for(var r in e.threads){if(document.querySelector("div[data-legacy-message-id='"+r+"']")){var n=e.threads[r];t.first_email=r,t.last_email=r,t.subject=e.subject,t.threads={},t.threads[r]=n,t.total_emails=1,t.total_threads=[r],t.people_involved=[],t.people_involved.push([n.from,n.from_email]),n.to.forEach(function(e){var r=a.tools.extract_email_address(e),n=a.tools.extract_name(e.replace(r,""))||"";t.people_involved.push([n,r])});break}}return t};a.check.is_conversation_view=function(){if(a.check.is_new_data_layer()){return-1!==a.tracker.globals[24].indexOf(7164)}for(var e=void 0,t=a.tracker.globals[17][4][1],r=0;r<t.length;r++){var n=t[r];if("bx_vmb"===n[0]){e=n[1];break}}return"0"===e||void 0===e},a.tools.extract_email_address=function(e){var t=e?e.match(/[\+a-z0-9._-]+@[a-z0-9._-]+\.[a-z0-9._-]+/gi):void 0;return t?t[0]:void 0},a.tools.extract_name=function(e){var t=e?e.match(/[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF"._\s-]+/gi):void 0;return t&&t[0]?t[0].trim():void 0},a.tools.i18n=function(e){var t;switch(a.get.localization()){case"fr":t={inbox:"Boîte de réception",drafts:"Brouillons",spam:"Spam",forums:"Forums",updates:"Mises à jour",promotions:"Promotions",social_updates:"Réseaux sociaux"};break;case"no":t={inbox:"Innboks",drafts:"Utkast",spam:"Søppelpost",forums:"Forumer",updates:"Oppdateringer",promotions:"Reklame",social_updates:"Sosialt"};break;case"nl":t={inbox:"Postvak IN",drafts:"Concepten",spam:"Spam",forums:"Forums",updates:"Updates",promotions:"Reclame",social_updates:"Sociaal"};break;case"it":t={inbox:"Posta in arrivo",drafts:"Bozza",spam:"Spam",forums:"Forum",updates:"Aggiornamenti",promotions:"Promozioni",social_updates:"Social"};break;case"en":default:t={inbox:"Inbox",drafts:"Drafts",spam:"Spam",forums:"Forums",updates:"Updates",promotions:"Promotions",social_updates:"Social Updates"}}return t[e]};var c=function(e,r,a,n,o,i){var s=t(document.createElement("div"));s.attr("class","G-Ni J-J5-Ji");var l=t(document.createElement("div")),c="T-I J-J5-Ji ";return c+=null!=o&&""!==o?a+o:a+n,l.attr("class",c),l.html(e),l.click(r),t(document.createElement("div")).attr("class","asa"),s.html(l),i.append(s),s};return a.tools.add_toolbar_button=function(e,t,r){return c(e,t,"lS ","T-I-ax7 ar7",r,a.dom.toolbar())},a.tools.add_right_toolbar_button=function(e,t,r){return c(e,t,"ash ","T-I-ax7 L3",r,a.dom.right_toolbar())},a.tools.add_compose_button=function(e,r,a,n){var o=t(document.createElement("div")),i="T-I J-J5-Ji aoO T-I-atl L3 gmailjscomposebutton ";return void 0!==n&&(i+=n),o.attr("class",i),o.attr("style","margin-left: 8px; max-width: 500px;"),o.html(r),o.click(a),e.find(".gU.Up  > .J-J5-Ji").append(o),o},a.tools.add_attachment_button=function(e,r,a,n,o){var i=t(document.createElement("div"));i.attr("class","T-I J-J5-Ji aQv T-I-ax7 L3"),i.attr("style","user-select: none;"),i.attr("aria-label",n),i.attr("data-tooltip",n);i.mouseover(function(){this.classList.add("T-I-JW")}),i.mouseout(function(){this.classList.remove("T-I-JW")});var s=t(document.createElement("div")),l="wtScjd J-J5-Ji aYr";return a&&(l+=" "+a),s.attr("class",l),r&&s.html(r),i.append(s),i.click(o),e.$el.find("div.aQw").append(i),i},a.tools.remove_modal_window=function(){t("#gmailJsModalBackground").remove(),t("#gmailJsModalWindow").remove()},a.tools.add_modal_window=function(e,r,n,o,i,s,l){i=i||a.tools.remove_modal_window,o=o||a.tools.remove_modal_window,s=s||"OK",l=l||"Cancel";var c=t(document.createElement("div"));c.attr("id","gmailJsModalBackground"),c.attr("class","Kj-JD-Jh"),c.attr("aria-hidden","true"),c.attr("style","opacity:0.75;width:100%;height:100%;");var d=t(document.createElement("div"));d.attr("id","gmailJsModalWindow"),d.attr("class","Kj-JD"),d.attr("tabindex","0"),d.attr("role","alertdialog"),d.attr("aria-labelledby","gmailJsModalWindowTitle"),d.attr("style","left:50%;top:50%;opacity:1;");var u=t(document.createElement("div"));u.attr("class","Kj-JD-K7 Kj-JD-K7-GIHV4");var _=t(document.createElement("span"));_.attr("id","gmailJsModalWindowTitle"),_.attr("class","Kj-JD-K7-K0"),_.attr("role","heading"),_.html(e);var m=t(document.createElement("span"));m.attr("id","gmailJsModalWindowClose"),m.attr("class","Kj-JD-K7-Jq"),m.attr("role","button"),m.attr("tabindex","0"),m.attr("aria-label","Close"),m.click(i),u.append(_),u.append(m);var h=t(document.createElement("div"));h.attr("id","gmailJsModalWindowContent"),h.attr("class","Kj-JD-Jz"),h.html(r);var f=t(document.createElement("div"));f.attr("class","Kj-JD-Jl");var p=t(document.createElement("button"));p.attr("id","gmailJsModalWindowOk"),p.attr("class","J-at1-auR J-at1-atl"),p.attr("name","ok"),p.text(s),p.click(n);var g=t(document.createElement("button"));g.attr("id","gmailJsModalWindowCancel"),g.attr("name","cancel"),g.text(l),g.click(o),f.append(p),f.append(g),d.append(u),d.append(h),d.append(f),t(document.body).append(c),t(document.body).append(d);var b=function(){d.css({top:(t(window).height()-d.outerHeight())/2,left:(t(window).width()-d.outerWidth())/2})};b(),d.on("DOMSubtreeModified",b),t(window).resize(b)},a.tools.toggle_minimize=function(){var e=t("[alt='Minimize']")[0];return!!e&&(e.click(),!0)},a.chat.is_hangouts=function(){if(void 0!==a.tracker.hangouts)return a.tracker.hangouts;var e=t(".dw");if(e.length>1)throw"Figuring out is hangouts - more than one dw classes found";if(0===e.length)throw"Figuring out is hangouts - no dw classes found";var r=e[0],n=t(".nH.aJl.nn",r);return n.length>0?(a.tracker.hangouts=!0,!0):(n=t(".nH.nn",r)).length>2?(a.tracker.hangouts=!1,!1):void 0},a.dom.visible_messages=function(){const e=[];return t('tbody>tr.zA[role="row"]:visible',a.dom.inbox_content()).each((r,n)=>{const o=t("*[email][name]",n),i=t("*[role=link]",n),s=n.querySelector("span[data-thread-id]");e.push({from:{name:o.attr("name"),email:o.attr("email")},summary:i[0].innerText,thread_id:a.helper.clean_thread_id(s.dataset.threadId||""),legacy_email_id:s.dataset.legacyMessageId,$el:t(n)})}),e},a.dom.composes=function(){var e=[];return t("div.M9").each(function(t,r){e.push(new a.dom.compose(r))}),e},a.dom.helper={},a.dom.helper.trigger_address=function(e){let t=e[0],r=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,key:"Tab",shiftKey:!0,keyCode:9});t.focus(),t.dispatchEvent(r)},a.dom.compose=function(e){return this.constructor!==a.dom.compose?new a.dom.compose(e):((e=t(e))&&(e.hasClass("M9")||e.hasClass("AD"))||a.tools.error("api.dom.compose called with invalid element"),this.$el=e,this)},o(a.dom.compose.prototype,{id:function(){return this.dom("id").val()},email_id:function(){let e=this.dom("draft").val();return e&&e.startsWith("#")?e.substring(1):e},thread_id:function(){let e=this.dom("thread").val()||"";return a.helper.clean_thread_id(e)},is_inline:function(){return this.$el.closest("td.Bu").length>0},recipients:function(e){"object"!=typeof e&&(e={});var t=e.type?"[name="+e.type+"]":"",r=e.flat?[]:{to:[],cc:[],bcc:[]};return this.$el.find(".GS input[type=hidden]"+t).each(function(t,a){e.flat?r.push(a.value):(r[a.name]||(r[a.name]=[]),r[a.name].push(a.value))}),r},to:function(e){const t=this.dom("to").val(e);return a.dom.helper.trigger_address(t),t},cc:function(e){if(e){this.dom("show_cc").click()}const t=this.dom("cc").val(e);return a.dom.helper.trigger_address(t),t},bcc:function(e){if(e){this.dom("show_bcc").click()}const t=this.dom("bcc").val(e);return a.dom.helper.trigger_address(t),t},subject:function(e){return e&&this.dom("all_subjects").val(e),(e=this.dom("subjectbox").val())||this.dom("subject").val()},from:function(){var e=this.dom("from");if(e.length){var t=e.val();if(t)return a.tools.extract_email_address(t)}return a.get.user_email()},body:function(e){var t=this.dom("body");return e&&t.html(e),t.html()},send:function(){return this.dom("send_button").click()},find:function(e){return this.$el.find(e)},close:function(){const e=document.createEvent("Events");e.initEvent("keydown",!0,!0),e.which=27,e.keyCode=27;var t=this.dom("body");t.focus(),t[0].dispatchEvent(e)},dom:function(e){if(!e)return this.$el;var t={to:"textarea[name=to]",cc:"textarea[name=cc]",bcc:"textarea[name=bcc]",id:"input[name=composeid]",draft:"input[name=draft]",thread:"input[name=rt]",subject:"input[name=subject]",subjectbox:"input[name=subjectbox]",all_subjects:"input[name=subjectbox], input[name=subject]",body:"div[contenteditable=true]",reply:"M9",forward:"M9",from:"input[name=from]",send_button:"div.T-I.T-I-atl:not(.gmailjscomposebutton)",show_cc:"span.aB.gQ.pE",show_bcc:"span.aB.gQ.pB"};return t[e]||a.tools.error('Dom lookup failed. Unable to find config for "'+e+'"',t,e,t[e]),this.$el.find(t[e])}}),a.dom.email=function(e){if(this.constructor!==a.dom.email)return new a.dom.email(e);if("string"==typeof e&&a.check.data.is_legacy_email_id(e))this.id=e,this.$el=t("div.adn[data-legacy-message-id='"+this.id+"']");else if("string"==typeof e&&a.check.data.is_email_id(e)){const r=document.querySelector("div.adn[data-message-id='"+e.replace("msg-f:","\\#msg-f\\:")+"']");this.id=r.dataset.legacyMessageId,this.$el=t(r)}else e&&(e.classList&&e.classList.contains("adn")||e.hasClass&&e.hasClass("adn"))?(this.$el=t(e),this.id=this.$el.data("legacyMessageId")):a.tools.error("api.dom.email called with invalid element/id");return this},o(a.dom.email.prototype,{body:function(e){var t=this.dom("body");return e&&t.html(e),t.html()},from:function(e,t){var r=this.dom("from");return e&&r.attr("email",e),t&&(r.attr("name",t),r.html(t)),{email:r.attr("email"),name:r.attr("name"),el:r}},to:function(e){if(e){t.isArray(e)||(e=[e]);var r=[];t.each(e,function(e,a){r.push(t("<span />").attr({dir:"ltr",email:a.email,name:a.name}).addClass("g2").html(a.name).wrap("<p/>").parent().html())}),this.dom("to_wrapper").html("to "+r.join(", "))}var a=[];return this.dom("to").each(function(){var e=t(this);a.push({email:e.attr("email"),name:e.attr("name"),el:e})}),a},attachments:function(){var e=[];return this.dom("attachments").each(function(){var r=t(this),n={};n.$el=r,n.name=r.find(".aV3").html(),n.size=r.find(".SaH2Ve").html();var o=r.attr("download_url");if(o){var i=a.tools.parse_attachment_url(o);n.url=i.url,n.type=i.type}e.push(n)}),e},data:function(){if("object"!=typeof a.dom.email_cache&&(a.dom.email_cache={}),!a.dom.email_cache[this.id]){var e=a.get.email_data(this.id);t.each(e.threads,function(e,t){a.dom.email_cache[e]=t})}return a.dom.email_cache[this.id]},source:function(){return a.get.email_source(this.id)},dom:function(e){if(!e)return this.$el;var t={body:"div.a3s",from:"span[email].gD",to:"span[email].g2",to_wrapper:"span.hb",timestamp:"span.g3",star:"div.zd",attachments:"div.hq.gt div.aQH span.aZo",reply_button:"div[role=button].aaq",menu_button:"div[role=button].aap",details_button:"div[role=button].ajz"};return t[e]||a.tools.error('Dom lookup failed. Unable to find config for "'+e+'"'),this.$el.find(t[e])}}),a.dom.thread=function(e){return this.constructor!==a.dom.thread?new a.dom.thread(e):(e&&e.hasClass("if")||a.tools.error("api.dom.thread called with invalid element/id"),this.$el=e,this)},o(a.dom.thread.prototype,{dom:function(e){if(!e)return this.$el;var t={opened_email:"div.adn",subject:"h2.hP",labels:"div.hN"};return t[e]||a.tools.error('Dom lookup failed. Unable to find config for "'+e+'"'),this.$el.find(t[e])}}),a.compose.start_compose=function(){var e=document.getElementsByClassName("T-I T-I-KE L3")[0];return!!e&&(e.click(),!0)},a.old={},a.old.get=a.get,a.new={},a.new.get={},a.new.get.email_id=function(e){if(!e){const t=document.querySelectorAll(".adn[data-message-id]");if(!t||0===t.length)return null;e=t[t.length-1]}return a.helper.get.new_email_id(e)},a.new.get.thread_id=function(){const e=document.querySelector("[data-thread-perm-id]");return e?e.dataset.threadPermId:null},a.new.get.email_data=function(e){e=e||a.new.get.email_id();const t=a.helper.get.new_email_id(e);return t?a.cache.emailIdCache[t]:null},a.new.get.thread_data=function(e){e=e||a.new.get.thread_id();const t=a.helper.get.thread_id(e);return t?a.cache.threadCache[t]:null},"undefined"!=typeof document&&a.tools.xhr_watcher(),"undefined"!=typeof document&&a.tools.embedded_data_watcher(),a};"undefined"!=typeof exports&&(exports.Gmail=Gmail);