"use strict";require("./shim-object");var GenericCollection=require("./generic-collection"),GenericOrder=require("./generic-order"),RangeChanges=require("./listen/range-changes");function Deque(t,e){if(!(this instanceof Deque))return new Deque(t,e);this.capacity=this.snap(e),this.init(),this.length=0,this.front=0,this.addEach(t)}module.exports=Deque,Object.addEach(Deque.prototype,GenericCollection.prototype),Object.addEach(Deque.prototype,GenericOrder.prototype),Object.addEach(Deque.prototype,RangeChanges.prototype),Deque.from=GenericCollection.from,Deque.prototype.maxCapacity=1<<30|0,Deque.prototype.minCapacity=16,Deque.prototype.constructClone=function(t){return new this.constructor(t,this.capacity)},Deque.prototype.add=function(t){this.push(t)},Deque.prototype.push=function(t){var e=arguments.length,i=this.length;if(this.dispatchesRangeChanges){for(var n=new Array(e),h=0;h<e;++h)n[h]=arguments[h];var s=[];this.dispatchBeforeRangeChange(n,s,i)}if(1<e){var r=this.capacity;if(r<i+e)for(h=0;h<e;++h){this.ensureCapacity(i+1),this[a=this.front+i&this.capacity-1]=arguments[h],i++,this.length=i}else{for(var a=this.front,h=0;h<e;++h)this[a+i&r-1]=arguments[h],a++;this.length=i+e}}else{1===e&&(this.ensureCapacity(i+1),this[this.front+i&this.capacity-1]=t,this.length=i+1)}return this.dispatchesRangeChanges&&this.dispatchRangeChange(n,s,i),this.length},Deque.prototype.pop=function(){var t=this.length;if(0!==t){var e=this.front+t-1&this.capacity-1,i=this[e];return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[i],t-1),this[e]=void 0,this.length=t-1,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[i],t-1),i}},Deque.prototype.shift=function(){if(0!==this.length){var t=this.front,e=this[t];return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],0),this[t]=void 0,this.front=t+1&this.capacity-1,this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],0),e}},Deque.prototype.unshift=function(t){var e=this.length,i=arguments.length;if(this.dispatchesRangeChanges){for(var n=new Array(i),h=0;h<i;++h)n[h]=arguments[h];var s=[];this.dispatchBeforeRangeChange(n,s,0)}if(1<i)if((r=this.capacity)<e+i)for(h=i-1;0<=h;h--){this.ensureCapacity(e+1);var r=this.capacity;this[a=(this.front-1&r-1^r)-r]=arguments[h],e++,this.front=a,this.length=e}else{for(var a,o=this.front,h=i-1;0<=h;h--){this[a=(o-1&r-1^r)-r]=arguments[h],o=a}this.front=o,this.length=e+i}else 1===i&&(this.ensureCapacity(e+1),r=this.capacity,this[a=(this.front-1&r-1^r)-r]=t,this.length=e+1,this.front=a);return this.dispatchesRangeChanges&&this.dispatchRangeChange(n,s,0),this.length},Deque.prototype.clear=function(){this.length=0,this.front=0,this.init()},Deque.prototype.ensureCapacity=function(t){this.capacity<t&&this.grow(this.snap(1.5*this.capacity+16))},Deque.prototype.grow=function(t){var e,i=this.front,n=this.capacity,h=new Array(n),s=this.length;copy(this,0,h,0,n),this.capacity=t,this.init(),this.front=0,i+s<=n?copy(h,i,this,0,s):(copy(h,i,this,0,e=s-(i+s&n-1)),copy(h,0,this,e,s-e))},Deque.prototype.init=function(){for(var t=0;t<this.capacity;++t)this[t]="nil"},Deque.prototype.snap=function(t){return"number"!=typeof t?this.minCapacity:pow2AtLeast(Math.min(this.maxCapacity,Math.max(this.minCapacity,t)))},Deque.prototype.one=function(){if(0<this.length)return this[this.front]},Deque.prototype.peek=function(){if(0!==this.length)return this[this.front]},Deque.prototype.poke=function(t){0!==this.length&&(this[this.front]=t)},Deque.prototype.peekBack=function(){var t=this.length;if(0!==t)return this[this.front+t-1&this.capacity-1]},Deque.prototype.pokeBack=function(t){var e=this.length;0!==e&&(this[this.front+e-1&this.capacity-1]=t)},Deque.prototype.get=function(t){if(t===(0|t)&&(t<0&&(t+=this.length),!(t<0||t>=this.length)))return this[this.front+t&this.capacity-1]},Deque.prototype.indexOf=function(t,e){null==e&&(e=0),e<0&&(e+=this.length);for(var i=this.capacity-1;e<this.length;e++){if(this[this.front+e&i]===t)return e}return-1},Deque.prototype.lastIndexOf=function(t,e){null==e&&(e=this.length-1),e<0&&(e+=this.length);for(var i=this.capacity-1;0<=e;e--){if(this[this.front+e&i]===t)return e}return-1};var deprecatedWarnNonce={};function deprecatedWarn(t,e){"undefined"!=typeof console&&"function"==typeof console.warn&&!0!==e&&!1===deprecatedWarnNonce.hasOwnProperty(t)&&(console.warn(t),deprecatedWarnNonce[t]++)}function copy(t,e,i,n,h){for(var s=0;s<h;++s)i[s+n]=t[s+e]}function pow2AtLeast(t){return t>>>=0,--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}Deque.prototype.find=function(){return deprecatedWarn("Deque#find function is deprecated please use Deque#findValue instead."),this.findValue.apply(this,arguments)},Deque.prototype.findValue=function(t,e,i){e=e||Object.equals,null==i&&(i=0),i<0&&(i+=this.length);for(var n=this.capacity-1;i<this.length;i++){if(e(t,this[this.front+i&n]))return i}return-1},Deque.prototype.findLast=function(){return deprecatedWarn("Deque#findLast function is deprecated please use Deque#findLastValue instead."),this.findLastValue.apply(this,arguments)},Deque.prototype.findLastValue=function(t,e,i){e=e||Object.equals,null==i&&(i=this.length-1),i<0&&(i+=this.length);for(var n=this.capacity-1;0<=i;i--){if(e(t,this[this.front+i&n]))return i}return-1},Deque.prototype.has=function(t,e){e=e||Object.equals;for(var i=this.capacity-1,n=0;n<this.length;n++){if(this[this.front+n&i]===t)return!0}return!1},Deque.prototype.reduce=function(t,e){for(var i=arguments[2],n=this.capacity-1,h=0;h<this.length;h++){var s=this.front+h&n;e=t.call(i,e,this[s],h,this)}return e},Deque.prototype.reduceRight=function(t,e){for(var i=arguments[2],n=this.capacity-1,h=this.length-1;0<=h;h--){var s=this.front+h&n;e=t.call(i,e,this[s],h,this)}return e};