"use strict";module.exports=List;var Shim=require("./shim"),GenericCollection=require("./generic-collection"),GenericOrder=require("./generic-order");function List(t,e,i){return List._init(List,this,t,e,i)}function ListIterator(t){this.head=t,this.at=t.next}function Node(t){this.value=t,this.prev=null,this.next=null}List._init=function(t,e,i,n,r){if(!(e instanceof t))return new t(i,n,r);var o=e.head=new e.Node;(o.next=o).prev=o,e.contentEquals=n||Object.equals,e.getDefault=r||Function.noop,e.length=0,e.addEach(i)},List.List=List,Object.addEach(List.prototype,GenericCollection.prototype),Object.addEach(List.prototype,GenericOrder.prototype),List.from=GenericCollection.from,List.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.getDefault)},List.prototype.find=function(t,e,i){e=e||this.contentEquals;for(var n=this.head,r=this.scan(i,n.next);r!==n;){if(e(r.value,t))return r;r=r.next}},List.prototype.findLast=function(t,e,i){e=e||this.contentEquals;for(var n=this.head,r=this.scan(i,n.prev);r!==n;){if(e(r.value,t))return r;r=r.prev}},List.prototype.has=function(t,e){return!!this.find(t,e)},List.prototype.get=function(t,e){var i=this.find(t,e);return i?i.value:this.getDefault(t)},List.prototype.delete=function(t,e){var i=this.findLast(t,e);return!!i&&(i.delete(),this.length--,!0)},List.prototype.deleteAll=function(t,e){e=e||this.contentEquals;for(var i=this.head,n=i.next,r=0;n!==i;)e(t,n.value)&&(n.delete(),r++),n=n.next;return this.length-=r,r},List.prototype.clear=function(){this.head.next=this.head.prev=this.head,this.length=0},List.prototype.add=function(t){var e=new this.Node(t);return this._addNode(e)},List.prototype._addNode=function(t){return this.head.addBefore(t),this.length++,!0},List.prototype.push=function(){for(var t=this.head,e=0;e<arguments.length;e++){var i=arguments[e],n=new this.Node(i);t.addBefore(n)}this.length+=arguments.length},List.prototype.unshift=function(){for(var t=this.head,e=0;e<arguments.length;e++){var i=arguments[e],n=new this.Node(i);t.addAfter(n),t=n}this.length+=arguments.length},List.prototype._shouldPop=function(){var t,e=this.head;return e.prev!==e&&(t=e.prev.value),t},List.prototype.pop=function(t,e){var i,n,r,o=this.head;return o.prev!==o&&(i=o.prev.value,n=this.length-1,r=t?t.call(this,i,n):void 0,o.prev.delete(),this.length--,e&&e.call(this,i,n,r)),i},List.prototype.shift=function(t,e){var i,n,r=this.head;return r.prev!==r&&(i=r.next.value,n=t?t.call(this,i,0):void 0,r.next.delete(),this.length--,e&&e.call(this,i,0,n)),i},List.prototype.peek=function(){if(this.head!==this.head.next)return this.head.next.value},List.prototype.poke=function(t){this.head!==this.head.next?this.head.next.value=t:this.push(t)},List.prototype.one=function(){return this.peek()},List.prototype.scan=function(t,e){var i=this.head;if("number"!=typeof t)return t||e;var n=t;if(0<=n)for(t=i.next;n&&(n--,(t=t.next)!=i););else for(t=i;n<0&&(n++,(t=t.prev)!=i););return t},List.prototype.slice=function(t,e){var i=[],n=this.head;for(t=this.scan(t,n.next),e=this.scan(e,n);t!==e&&t!==n;)i.push(t.value),t=t.next;return i},List.prototype.splice=function(t,e){return this.swap(t,e,Array.prototype.slice.call(arguments,2))},List.prototype.swap=function(t,e,i,n,r){var o=t;t=this.scan(t,this.head),null==e&&(e=1/0),i=Array.from(i);for(var s=[],h=t;e--&&0<=e&&h!==this.head;)s.push(h.value),h=h.next;n&&n.call(this,t,i,s);for(var h=t,a=0,h=t;a<s.length;a++,h=h.next)h.delete();null==o&&h===this.head&&(h=this.head.next);for(a=0;a<i.length;a++){var p=new this.Node(i[a]);h.addBefore(p)}return this.length+=i.length-s.length,r&&r.call(this,t,i,s),s},List.prototype.reverse=function(){var t=this.head;do{var e=t.next;t.next=t.prev,t.prev=e,t=t.next}while(t!==this.head);return this},List.prototype.sort=function(){this.swap(0,this.length,this.sorted.apply(this,arguments))},List.prototype.reduce=function(t,e){for(var i=arguments[2],n=this.head,r=n.next;r!==n;)e=t.call(i,e,r.value,r,this),r=r.next;return e},List.prototype.reduceRight=function(t,e){for(var i=arguments[2],n=this.head,r=n.prev;r!==n;)e=t.call(i,e,r.value,r,this),r=r.prev;return e},List.prototype.updateIndexes=function(t,e){for(;t!==this.head;)t.index=e++,t=t.next},List.prototype.iterate=function(){return new ListIterator(this.head)},ListIterator.prototype.__iterationObject=null,Object.defineProperty(ListIterator.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),ListIterator.prototype.next=function(){var t;return this.at===this.head?(this._iterationObject.done=!0,this._iterationObject.value=void 0):(t=this.at.value,this.at=this.at.next,this._iterationObject.value=t),this._iterationObject},(List.prototype.Node=Node).prototype.delete=function(){this.prev.next=this.next,this.next.prev=this.prev},Node.prototype.addBefore=function(t){var e=this.prev;(((this.prev=t).prev=e).next=t).next=this},Node.prototype.addAfter=function(t){var e=this.next;(((this.next=t).next=e).prev=t).prev=this};