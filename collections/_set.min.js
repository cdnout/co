"use strict";var Set,GlobalSet,Shim=require("./shim"),GenericCollection=require("./generic-collection"),GenericSet=require("./generic-set");void 0!==global.Set&&"function"==typeof global.Set.prototype.values&&(((GlobalSet=module.exports=global.Set).Set=GlobalSet).prototype.reduce=function(e,o){var r=arguments[2];return this.forEach(function(t){o=e.call(r,o,t,this)}),o},GlobalSet.prototype.reduceRight=function(t,e){for(var o,r=arguments[2],n=this.values(),i=this.size,l=new Array(this.size),s=i;o=n.next().value;)l[--s]=o;for(;s<i;)e=t.call(r,e,l[s++],this);return e},GlobalSet.prototype.equals=function(t,o){var r=this;return t&&"function"==typeof t.reduce&&this.size===(t.size||t.length)&&t.reduce(function(t,e){return t&&r.has(e,o)},!0)},GlobalSet.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},GlobalSet.prototype.toJSON=function(){return this.entriesArray()},GlobalSet.prototype.one=function(){if(0<this.size)return this.values().next().value},GlobalSet.prototype.pop=function(){if(this.size){for(var t,e,o=this.values();t=o.next().value;)e=t;return this.delete(e,this.size-1),e}},GlobalSet.prototype.shift=function(){if(this.size){var t=this.values().next().value;return this.delete(t,0),t}},Object.defineProperty(GlobalSet.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),GlobalSet.from=function(t){var e=new this;return e.addEach(t),e},Object.addEach(GlobalSet.prototype,GenericCollection.prototype,!1),Object.addEach(GlobalSet.prototype,GenericSet.prototype,!1));var CollectionsSet,List=require("./_list"),FastSet=require("./_fast-set"),Iterator=require("./iterator");(CollectionsSet=function t(e,o,r,n){return t._init(t,this,e,o,r,n)})._init=function(t,e,o,r,n,i){if(!(e instanceof t))return new t(o,r,n,i);r=r||Object.equals,n=n||Object.hash,i=i||Function.noop,e.contentEquals=r,e.contentHash=n,e.getDefault=i,e.order=new e.Order(void 0,r),e.store=new e.Store(void 0,function(t,e){return r(t.value,e.value)},function(t){return n(t.value)}),e.length=0,e.addEach(o)},(CollectionsSet.Set=CollectionsSet).CollectionsSet=CollectionsSet,Object.addEach(CollectionsSet.prototype,GenericCollection.prototype),Object.addEach(CollectionsSet.prototype,GenericSet.prototype),CollectionsSet.from=GenericCollection.from,Object.defineProperty(CollectionsSet.prototype,"size",GenericCollection._sizePropertyDescriptor),CollectionsSet.prototype.Order=List,CollectionsSet.prototype.Store=FastSet,CollectionsSet.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},CollectionsSet.prototype.has=function(t){var e=new this.order.Node(t);return this.store.has(e)},CollectionsSet.prototype.get=function(t,e){if(e)throw new Error("Set#get does not support second argument: equals");var o=new this.order.Node(t);return(o=this.store.get(o))?o.value:this.getDefault(t)},CollectionsSet.prototype.add=function(t){var e=new this.order.Node(t);if(this.store.has(e))return!1;this.length;return this.order.add(t),e=this.order.head.prev,this.store.add(e),this.length++,!0},CollectionsSet.prototype.delete=function(t,e){if(e)throw new Error("Set#delete does not support second argument: equals");var o=new this.order.Node(t);return!!this.store.has(o)&&(o=this.store.get(o),this.store.delete(o),this.order.splice(o,1),this.length--,!0)},CollectionsSet.prototype.pop=function(){if(this.length){var t=this.order.head.prev.value;return this.delete(t),t}},CollectionsSet.prototype.shift=function(){if(this.length){var t=this.order.head.next.value;return this.delete(t),t}},CollectionsSet.prototype.one=function(){if(0<this.length)return this.store.one().value},CollectionsSet.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0},Object.defineProperty(CollectionsSet.prototype,"_clear",{value:CollectionsSet.prototype.clear}),CollectionsSet.prototype.reduce=function(o,t){var r=arguments[2],e=this.order,n=0;return e.reduce(function(t,e){return o.call(r,t,e,n++,this)},t,this)},CollectionsSet.prototype.reduceRight=function(o,t){var r=arguments[2],e=this.order,n=this.length-1;return e.reduceRight(function(t,e){return o.call(r,t,e,n--,this)},t,this)},CollectionsSet.prototype.iterate=function(){return this.order.iterate()},CollectionsSet.prototype.values=function(){return new Iterator(this.valuesArray(),!0)},CollectionsSet.prototype.log=function(){var t=this.store;return t.log.apply(t,arguments)},GlobalSet?(GlobalSet.prototype.valuesArray=GenericSet.prototype.valuesArray,GlobalSet.prototype.entriesArray=GenericSet.prototype.entriesArray,(module.exports=GlobalSet).CollectionsSet=CollectionsSet):module.exports=CollectionsSet;