"use strict";module.exports=Iterator;var Object=require("./shim-object"),GenericCollection=require("./generic-collection");function Iterator(t,e){var r=e&&t&&t.values&&t.values();if(r&&"function"==typeof r.next)return r;if(!(this instanceof Iterator))return new Iterator(t);if(Array.isArray(t)||"string"==typeof t)return Iterator.iterate(t);if((t=Object(t))instanceof Iterator)return t;if(t.next)this.next=function(){return t.next()};else if(t.iterate){var o=t.iterate();this.next=function(){return o.next()}}else{if("[object Function]"!==Object.prototype.toString.call(t))throw new TypeError("Can't iterate "+t);this.next=t}}Iterator.prototype.forEach=GenericCollection.prototype.forEach,Iterator.prototype.map=GenericCollection.prototype.map,Iterator.prototype.filter=GenericCollection.prototype.filter,Iterator.prototype.every=GenericCollection.prototype.every,Iterator.prototype.some=GenericCollection.prototype.some,Iterator.prototype.any=GenericCollection.prototype.any,Iterator.prototype.all=GenericCollection.prototype.all,Iterator.prototype.min=GenericCollection.prototype.min,Iterator.prototype.max=GenericCollection.prototype.max,Iterator.prototype.sum=GenericCollection.prototype.sum,Iterator.prototype.average=GenericCollection.prototype.average,Iterator.prototype.flatten=GenericCollection.prototype.flatten,Iterator.prototype.zip=GenericCollection.prototype.zip,Iterator.prototype.enumerate=GenericCollection.prototype.enumerate,Iterator.prototype.sorted=GenericCollection.prototype.sorted,Iterator.prototype.group=GenericCollection.prototype.group,Iterator.prototype.reversed=GenericCollection.prototype.reversed,Iterator.prototype.toArray=GenericCollection.prototype.toArray,Iterator.prototype.toObject=GenericCollection.prototype.toObject,Iterator.prototype.iterator=GenericCollection.prototype.iterator,Iterator.prototype.__iterationObject=null,Object.defineProperty(Iterator.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:void 0})}}),Iterator.prototype.constructClone=function(t){var e=[];return e.addEach(t),e},Iterator.prototype.mapIterator=function(e){var r=Iterator(this),o=arguments[1],n=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;return new r.constructor(function(){var t;return!0!==r._iterationObject.done&&(t=e.call(o,r.next().value,n++,r),r._iterationObject.value=t),r._iterationObject})},Iterator.prototype.filterIterator=function(e){var r=Iterator(this),o=arguments[1],n=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;return new r.constructor(function(){for(var t;;){if(!0===(t=r.next()).done)return t;if(e.call(o,t.value,n++,r))return t}})},Iterator.prototype.reduce=function(t){var e,r=Iterator(this),o=arguments[1],n=arguments[2],i=0;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError;if(!0===(e=r.next()).done){if(1<arguments.length)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}for(o=1<arguments.length?t.call(n,o,e.value,i,r):e.value,i++;;){if(!0===(e=r.next()).done)return o;o=t.call(n,o,e.value,i,r),i++}},Iterator.prototype.concat=function(){return Iterator.concat(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.dropWhile=function(t){var e,r,o=Iterator(this),n=arguments[1],i=!1,a=0;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError;for(;!0!==(r=o.next()).done;){if(!t.call(n,r.value,a,o)){i=!0,e=r.value;break}a++}return i?o.constructor([e]).concat(o):o.constructor([])},Iterator.prototype.takeWhile=function(e){var r=Iterator(this),o=arguments[1],n=0;if("[object Function]"!=Object.prototype.toString.call(e))throw new TypeError;return new r.constructor(function(){var t;return!0!==r._iterationObject.done&&(t=r.next().value,e.call(o,t,n++,r)?r._iterationObject.value=t:(r._iterationObject.done=!0,r._iterationObject.value=void 0)),r._iterationObject})},Iterator.prototype.zipIterator=function(){return Iterator.unzip(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.enumerateIterator=function(t){return Iterator.count(t).zipIterator(this)},Iterator.iterate=function(t){var e=0;return new Iterator(function(){if("object"==typeof t)for(;!(e in t);){if(e>=t.length){this._iterationObject.done=!0,this._iterationObject.value=void 0;break}e+=1}else e>=t.length&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);return this._iterationObject.done||(this._iterationObject.value=t[e],e+=1),this._iterationObject})},Iterator.cycle=function(r,o){var n;return arguments.length<2&&(o=1/0),new Iterator(function(){var t,e;return n&&(e=n()),n&&!0!==e.done||(e=0<o?(o--,t=Iterator.iterate(r),(n=t.next.bind(t))()):(this._iterationObject.done=!0,this._iterationObject)),e})},Iterator.concat=function(r){var o;return r=Iterator(r),new Iterator(function(){var t,e;return o&&(e=o()),(!e||!0===e.done)&&!1===(e=r.next()).done?(t=Iterator(e.value),(o=t.next.bind(t))()):e})},Iterator.unzip=function(o){return 0===(o=Iterator(o).map(Iterator)).length?new Iterator([]):new Iterator(function(){var e,r,t=o.map(function(t){return!0===(r=t.next()).done&&(e=!0),r.value});return e?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=t,this._iterationObject})},Iterator.zip=function(){return Iterator.unzip(Array.prototype.slice.call(arguments))},Iterator.chain=function(){return Iterator.concat(Array.prototype.slice.call(arguments))},Iterator.range=function(e,r,o){return arguments.length<3&&(o=1),arguments.length<2&&(r=e,e=0),e=e||0,o=o||1,new Iterator(function(){r<=e&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);var t=e;return e+=o,this._iterationObject.value=t,this._iterationObject})},Iterator.count=function(t,e){return Iterator.range(t,1/0,e)},Iterator.repeat=function(t,e){return new Iterator.range(e).mapIterator(function(){return t})};