"use strict";var Shim=require("./shim"),Dict=require("./_dict"),List=require("./_list"),GenericCollection=require("./generic-collection"),GenericSet=require("./generic-set"),TreeLog=require("./tree-log"),object_has=Object.prototype.hasOwnProperty;function FastSet(t,e,o,n){if(!(this instanceof FastSet))return new FastSet(t,e,o,n);e=e||Object.equals,o=o||Object.hash,n=n||Function.noop,this.contentEquals=e,this.contentHash=o,this.getDefault=n;var r=this;this.buckets=new this.Buckets(null,function(){return new r.Bucket}),this.length=0,this.addEach(t)}(module.exports=FastSet).FastSet=FastSet,Object.addEach(FastSet.prototype,GenericCollection.prototype),Object.addEach(FastSet.prototype,GenericSet.prototype),FastSet.from=GenericCollection.from,FastSet.prototype.Buckets=Dict,FastSet.prototype.Bucket=List,FastSet.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},FastSet.prototype.has=function(t){var e=this.contentHash(t);return this.buckets.get(e).has(t)},FastSet.prototype.get=function(t,e){if(e)throw new Error("FastSet#get does not support second argument: equals");var o=this.contentHash(t),n=this.buckets;return n.has(o)?n.get(o).get(t):this.getDefault(t)},FastSet.prototype.delete=function(t,e){if(e)throw new Error("FastSet#delete does not support second argument: equals");var o=this.contentHash(t),n=this.buckets;if(n.has(o)){var r=n.get(o);if(r.delete(t))return this.length--,0===r.length&&n.delete(o),!0}return!1},FastSet.prototype.clear=function(){this.buckets.clear(),this.length=0},FastSet.prototype.add=function(t){var e=this.contentHash(t),o=this.buckets;return o.has(e)||o.set(e,new this.Bucket(null,this.contentEquals)),!o.get(e).has(t)&&(o.get(e).add(t),this.length++,!0)},FastSet.prototype.reduce=function(o,t){var n=arguments[2],e=this.buckets,r=0;return e.reduce(function(t,e){return e.reduce(function(t,e){return o.call(n,t,e,r++,this)},t,this)},t,this)},FastSet.prototype.one=function(){if(0<this.length)return this.buckets.one().one()},FastSet.prototype.iterate=function(){return this.buckets.valuesArray().flatten().iterate()},FastSet.prototype.log=function(s,i,c,a){s=s||TreeLog.unicodeSharp,i=i||this.logNode,c||(c=console.log,a=console),c=c.bind(a);for(var t,e,u,h,o=this.buckets,n=o.size,r=o.keys(),l=0;t=r.next().value;)u=l===n-1?(e=s.fromAbove," "):(e=0===l?s.branchDown:s.fromBoth,s.strafe),h=o.get(t),c.call(a,e+s.through+s.branchDown+" "+t),h.forEach(function(t,e){var o,n,r=e===h.head.prev?(o=s.fromAbove," "):(o=s.fromBoth,s.strafe);i(e,function(t){n?c.call(a,u+" "+r+"  "+t):(c.call(a,u+" "+o+s.through+s.through+t),n=!0)},function(t){c.call(a,u+" "+s.strafe+"  "+t)})}),l++},FastSet.prototype.logNode=function(t,e){var o=t.value;Object(o)===o?JSON.stringify(o,null,4).split("\n").forEach(function(t){e(" "+t)}):e(" "+o)};