"use strict";var Map,GlobalMap,protoIsSupported,map_makeObservable,_keysArrayFunction,_valuesArrayFunction,_entriesArrayFunction,map_clear,map_set,map_delete,observableMapProperties,ChangeDispatchMap,Shim=require("./shim"),GenericCollection=require("./generic-collection");void 0!==global.Map&&"function"==typeof global.Set.prototype.values&&((GlobalMap=Map=module.exports=global.Map).Map=Map,map_makeObservable=(protoIsSupported={}.__proto__===Object.prototype)?function(){this.__proto__=ChangeDispatchMap}:function(){Object.defineProperties(this,observableSetProperties)},Object.defineProperty(Map.prototype,"makeObservable",{value:map_makeObservable,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Map.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),Map.prototype.constructClone=function(e){return new this.constructor(e)},Map.prototype.isMap=!0,Map.prototype.addEach=function(t){if(t&&Object(t)===t)if("function"==typeof t.forEach)!0===t.isMap?t.forEach(function(e,t){this.set(t,e)},this):t.forEach(function(e){this.set(e[0],e[1])},this);else if("number"==typeof t.length)for(var e=0;e<t.length;e++)this.add(t[e],e);else Object.keys(t).forEach(function(e){this.set(e,t[e])},this);else if(t&&"number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);return this},Map.prototype.add=function(e,t){return this.set(t,e)},Map.prototype.reduce=function(r,o){var i=arguments[2];return this.forEach(function(e,t,a){o=r.call(i,o,e,t,this)}),o},Map.prototype.reduceRight=function(e,t){for(var a,r=arguments[2],o=this.keys(),i=this.size,n=new Array(this.size),p=0;a=o.next().value;)n[--i]=a;for(;p++<i;)t=e.call(r,t,this.get(n[p]),n[p],this);return t},Map.prototype.equals=function(t,a){return a=a||Object.equals,this===t||(t&&"function"==typeof t.every?t.size===this.size&&t.every(function(e,t){return a(this.get(t),e)},this):Object.keys(t).length===this.size&&Object.keys(t).every(function(e){return a(this.get(e),t[e])},this))},_keysArrayFunction=function(e,t){return t},Map.prototype.keysArray=function(){return this.map(_keysArrayFunction)},_valuesArrayFunction=function(e,t){return e},Map.prototype.valuesArray=function(){return this.map(_valuesArrayFunction)},_entriesArrayFunction=function(e,t){return[t,e]},Map.prototype.entriesArray=function(){return this.map(_entriesArrayFunction)},Map.prototype.toJSON=function(){return this.entriesArray()},Map.prototype.items=function(){return this.entriesArray()},Map.from=function(e){var t=new this;return t.addEach(e),t},Object.defineProperty(Map.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),map_clear=Map.prototype.clear,map_set=Map.prototype.set,map_delete=Map.prototype.delete,observableMapProperties={clear:{value:function(){var e;this.dispatchesMapChanges&&(this.forEach(function(e,t){this.dispatchBeforeMapChange(t,e)},this),e=this.keysArray()),map_clear.call(this),this.dispatchesMapChanges&&e.forEach(function(e){this.dispatchMapChange(e)},this)},writable:!0,configurable:!0},set:{value:function(e,t){var a=this.get(e);return a?this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,a):this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),map_set.call(this,e,t),this.dispatchesMapChanges&&this.dispatchMapChange(e,t),this},writable:!0,configurable:!0},delete:{value:function(e){return!!this.has(e)&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.get(e)),map_delete.call(this,e),this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0)}}},Object.addEach(Map.prototype,GenericCollection.prototype,!1),ChangeDispatchMap=Object.create(Map.prototype,observableMapProperties));var Set=require("./_set").CollectionsSet,GenericMap=require("./generic-map"),CollectionsMap=Map=function e(t,a,r,o){if(!(this instanceof e))return new e(t,a,r,o);a=a||Object.equals,r=r||Object.hash,o=o||Function.noop,this.contentEquals=a,this.contentHash=r,this.getDefault=o,this.store=new Set(void 0,function(e,t){return a(e.key,t.key)},function(e){return r(e.key)}),this.length=0,this.addEach(t)};Map.Map=Map,Object.addEach(Map.prototype,GenericCollection.prototype),Object.addEach(Map.prototype,GenericMap.prototype),Object.defineProperty(Map.prototype,"size",GenericCollection._sizePropertyDescriptor),Map.from=GenericCollection.from,Map.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},Map.prototype.log=function(e,r,t,a){r=r||this.logNode,this.store.log(e,function(e,t,a){r(e.value.value,t,a)},t,a)},Map.prototype.logNode=function(e,t){t(" key: "+e.key),t(" value: "+e.value)},GlobalMap?(module.exports=GlobalMap).CollectionsMap=CollectionsMap:module.exports=CollectionsMap;