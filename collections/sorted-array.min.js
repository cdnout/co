"use strict";module.exports=SortedArray;var Shim=require("./shim"),GenericCollection=require("./generic-collection"),PropertyChanges=require("./listen/property-changes"),RangeChanges=require("./listen/range-changes");function SortedArray(r,t,e,a){if(!(this instanceof SortedArray))return new SortedArray(r,t,e,a);Array.isArray(r)?r=(this.array=r).splice(0,r.length):this.array=[],this.contentEquals=t||Object.equals,this.contentCompare=e||Object.compare,this.getDefault=a||Function.noop,this.length=0,this.addEach(r)}function search(r,t,e){for(var a=0,n=r.length-1;a<=n;){var o=a+n>>1,s=e(t,r[o]);if(0<s)a=1+o;else{if(!(s<0))return o;n=o-1}}return-(a+1)}function determineIncomparableRange(r,t,e,a,n){for(var o=r,s=r;0<o&&0===a(e,t[o-1]);)o--;for(;s<t.length-1&&0===a(e,t[s+1]);)s++;return{start:o,end:s}}function searchFirst(r,t,e,a){var n=search(r,t,e);if(n<0)return-1;for(var o=determineIncomparableRange(n,r,t,e,a),s=o.start;s<=o.end;s++)if(a(t,r[s]))return s;return-1}function searchLast(r,t,e,a){var n=search(r,t,e);if(n<0)return-1;for(var o=determineIncomparableRange(n,r,t,e,a),s=o.end;s>=o.start;s--)if(a(t,r[s]))return s;return-1}function searchForInsertionIndex(r,t,e){var a=search(r,t,e);if(a<0)return-a-1;for(var n=r.length-1;a<n&&0===e(t,r[a+1]);)a++;return a}(SortedArray.SortedArray=SortedArray).from=GenericCollection.from,Object.addEach(SortedArray.prototype,GenericCollection.prototype),Object.addEach(SortedArray.prototype,PropertyChanges.prototype),Object.addEach(SortedArray.prototype,RangeChanges.prototype),SortedArray.prototype.isSorted=!0,SortedArray.prototype.constructClone=function(r){return new this.constructor(r,this.contentEquals,this.contentCompare,this.getDefault)},SortedArray.prototype.has=function(r,t){if(t)throw new Error("SortedSet#has does not support second argument: equals");return-1!==searchFirst(this.array,r,this.contentCompare,this.contentEquals)},SortedArray.prototype.get=function(r,t){if(t)throw new Error("SortedArray#get does not support second argument: equals");var e=searchFirst(this.array,r,this.contentCompare,this.contentEquals);return-1!==e?this.array[e]:this.getDefault(r)},SortedArray.prototype.add=function(r){var t=searchForInsertionIndex(this.array,r,this.contentCompare);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([r],Array.empty,t),this.array.splice(t,0,r),this.length++,this.dispatchesRangeChanges&&this.dispatchRangeChange([r],Array.empty,t),!0},SortedArray.prototype.delete=function(r,t){if(t)throw new Error("SortedArray#delete does not support second argument: equals");var e=searchFirst(this.array,r,this.contentCompare,this.contentEquals);return-1!==e&&(this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(Array.empty,[r],e),this.array.spliceOne(e),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange(Array.empty,[r],e),!0)},SortedArray.prototype.deleteAll=function(r,t){if(t){var e=this.array.deleteAll(r,t);return this.length-=e,e}var a=searchFirst(this.array,r,this.contentCompare,this.contentEquals);if(-1===a)return 0;for(var n=a;this.contentEquals(r,this.array[n]);)n++;var o=this.slice(a,n);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(Array.empty,o,a),this.array.splice(a,o.length),this.length-=o.length,this.dispatchesRangeChanges&&this.dispatchRangeChange(Array.empty,o,a),o.length},SortedArray.prototype.indexOf=function(r){return searchFirst(this.array,r,this.contentCompare,this.contentEquals)},SortedArray.prototype.lastIndexOf=function(r){return searchLast(this.array,r,this.contentCompare,this.contentEquals)};var deprecatedWarnNonce={};function deprecatedWarn(r,t){"undefined"!=typeof console&&"function"==typeof console.warn&&!0!==t&&!1===deprecatedWarnNonce.hasOwnProperty(r)&&(console.warn(r),deprecatedWarnNonce[r]++)}SortedArray.prototype.find=function(r,t,e){return deprecatedWarn("This SortedArray#find usage is deprecated please use SortedArray#findValue"),this.findValue.apply(this,arguments)},SortedArray.prototype.findValue=function(r,t,e){if(t)throw new Error("SortedArray#findValue does not support second argument: equals");if(e)throw new Error("SortedArray#findValue does not support third argument: index");return searchFirst(this.array,r,this.contentCompare,this.contentEquals)},SortedArray.prototype.findLast=function(r,t,e){return deprecatedWarn("This SortedArray#findLast usage is deprecated please use SortedArray#findLastValue"),this.findLastValue.apply(this,arguments)},SortedArray.prototype.findLastValue=function(r,t,e){if(t)throw new Error("SortedArray#findLastValue does not support second argument: equals");if(e)throw new Error("SortedArray#findLastValue does not support third argument: index");return searchLast(this.array,r,this.contentCompare,this.contentEquals)},SortedArray.prototype.push=function(){this.addEach(arguments)},SortedArray.prototype.unshift=function(){this.addEach(arguments)},SortedArray.prototype.pop=function(){var r=this.array.pop();return this.length=this.array.length,r},SortedArray.prototype.shift=function(){var r=this.array.shift();return this.length=this.array.length,r},SortedArray.prototype.slice=function(){return this.array.slice.apply(this.array,arguments)},SortedArray.prototype.splice=function(r,t){return this.swap(r,t,Array.prototype.slice.call(arguments,2))},SortedArray.prototype.swap=function(r,t,e){if(void 0===r&&void 0===t)return Array.empty;(r=r||0)<0&&(r+=this.length),void 0===t&&(t=1/0);var a=this.slice(r,r+t);return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(e,a,r),this.array.splice(r,t),this.length-=a.length,this.dispatchesRangeChanges&&this.dispatchRangeChange(Array.empty,a,r),this.addEach(e),a},SortedArray.prototype.reduce=function(a,r){var n=arguments[2];return this.array.reduce(function(r,t,e){return a.call(n,r,t,e,this)},r,this)},SortedArray.prototype.reduceRight=function(){var a=arguments[2];return this.array.reduceRight(function(r,t,e){return callback.call(a,r,t,e,this)},basis,this)},SortedArray.prototype.min=function(){if(this.length)return this.array[0]},SortedArray.prototype.max=function(){if(this.length)return this.array[this.length-1]},SortedArray.prototype.one=function(){return this.array.one()},SortedArray.prototype.clear=function(){var r;this.dispatchesRangeChanges&&(r=this.array.slice(),this.dispatchBeforeRangeChange(Array.empty,r,0)),this.length=0,this.array.clear(),this.dispatchesRangeChanges&&this.dispatchRangeChange(Array.empty,r,0)},SortedArray.prototype.equals=function(r,t){return this.array.equals(r,t)},SortedArray.prototype.compare=function(r,t){return this.array.compare(r,t)},SortedArray.prototype.iterate=function(r,t){return new this.Iterator(this.array,r,t)},SortedArray.prototype.toJSON=function(){return this.toArray()},SortedArray.prototype.Iterator=Array.prototype.Iterator;