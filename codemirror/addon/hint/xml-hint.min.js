!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(I){"use strict";var T=I.Pos;function j(t,e,r){return r?0<=t.indexOf(e):0==t.lastIndexOf(e,0)}I.registerHelper("hint","xml",function(t,e){var r=e&&e.schemaInfo,n=e&&e.quoteChar||'"',s=e&&e.matchInMiddle;if(r){var i=t.getCursor(),o=t.getTokenAt(i);if(o.end>i.ch&&(o.end=i.ch,o.string=o.string.slice(0,i.ch-o.start)),(d=I.innerMode(t.getMode(),o.state)).mode.xmlCurrentTag){var a,l,g,c=[],f=!1,h=/\btag\b/.test(o.type)&&!/>$/.test(o.string),u=h&&/^\w/.test(o.string);u?(M=t.getLine(i.line).slice(Math.max(0,o.start-2),o.start),(g=/<\/$/.test(M)?"close":/<$/.test(M)?"open":null)&&(l=o.start-("close"==g?2:1))):h&&"<"==o.string?g="open":h&&"</"==o.string&&(g="close");e=d.mode.xmlCurrentTag(d.state);if(!h&&!e||g){u&&(a=o.string),f=g;var d,p=d.mode.xmlCurrentContext?d.mode.xmlCurrentContext(d.state):[],p=(d=p.length&&p[p.length-1])&&r[d],m=d?p&&p.children:r["!top"];if(m&&"close"!=g)for(var y=0;y<m.length;++y)a&&!j(m[y],a,s)||c.push("<"+m[y]);else if("close"!=g)for(var v in r)!r.hasOwnProperty(v)||"!top"==v||"!attrs"==v||a&&!j(v,a,s)||c.push("<"+v);d&&(!a||"close"==g&&j(d,a,s))&&c.push("</"+d+">")}else{var x,C=(p=e&&r[e.name])&&p.attrs,b=r["!attrs"];if(!C&&!b)return;if(C){if(b){var O,w={};for(O in b)b.hasOwnProperty(O)&&(w[O]=b[O]);for(O in C)C.hasOwnProperty(O)&&(w[O]=C[O]);C=w}}else C=b;if("string"==o.type||"="==o.string){var A,M,p=(M=t.getRange(T(i.line,Math.max(0,i.ch-60)),T(i.line,"string"==o.type?o.start:o.end))).match(/([^\s\u00a0=<>\"\']+)=$/);if(!p||!C.hasOwnProperty(p[1])||!(A=C[p[1]]))return;"function"==typeof A&&(A=A.call(this,t)),"string"==o.type&&(a=o.string,M=0,/['"]/.test(o.string.charAt(0))&&(n=o.string.charAt(0),a=o.string.slice(1),M++),p=o.string.length,/['"]/.test(o.string.charAt(p-1))&&(n=o.string.charAt(p-1),a=o.string.substr(M,p-2)),!M||(P=t.getLine(i.line)).length>o.end&&P.charAt(o.end)==n&&o.end++,f=!0);var P=function(t){if(t)for(var e=0;e<t.length;++e)a&&!j(t[e],a,s)||c.push(n+t[e]+n);return $()};return A&&A.then?A.then(P):P(A)}for(x in"attribute"==o.type&&(a=o.string,f=!0),C)!C.hasOwnProperty(x)||a&&!j(x,a,s)||c.push(x)}return $()}}function $(){return{list:c,from:f?T(i.line,null==l?o.start:l):i,to:f?T(i.line,o.end):i}}})});