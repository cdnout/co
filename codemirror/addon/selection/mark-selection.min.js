!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(o){"use strict";function r(e){e.state.markedSelection&&e.operation(function(){!function(e){if(!e.somethingSelected())return f(e);if(1<e.listSelections().length)return c(e);var t=e.getCursor("start"),n=e.getCursor("end"),o=e.state.markedSelection;if(!o.length)return l(e,t,n);var r=o[0].find(),i=o[o.length-1].find();if(!r||!i||n.line-t.line<=d||0<=u(t,i.to)||u(n,r.from)<=0)return c(e);for(;0<u(t,r.from);)o.shift().clear(),r=o[0].find();u(t,r.from)<0&&(r.to.line-t.line<d?(o.shift().clear(),l(e,t,r.to,0)):l(e,t,r.from,0));for(;u(n,i.to)<0;)o.pop().clear(),i=o[o.length-1].find();0<u(n,i.to)&&(n.line-i.from.line<d?(o.pop().clear(),l(e,i.from,n)):l(e,i.to,n))}(e)})}function i(e){e.state.markedSelection&&e.state.markedSelection.length&&e.operation(function(){f(e)})}o.defineOption("styleSelectedText",!1,function(e,t,n){n=n&&n!=o.Init;t&&!n?(e.state.markedSelection=[],e.state.markedSelectionStyle="string"==typeof t?t:"CodeMirror-selectedtext",c(e),e.on("cursorActivity",r),e.on("change",i)):!t&&n&&(e.off("cursorActivity",r),e.off("change",i),f(e),e.state.markedSelection=e.state.markedSelectionStyle=null)});var d=8,m=o.Pos,u=o.cmpPos;function l(e,t,n,o){if(0!=u(t,n))for(var r=e.state.markedSelection,i=e.state.markedSelectionStyle,l=t.line;;){var f=l==t.line?t:m(l,0),c=l+d,a=c>=n.line,s=a?n:m(c,0),s=e.markText(f,s,{className:i});if(null==o?r.push(s):r.splice(o++,0,s),a)break;l=c}}function f(e){for(var t=e.state.markedSelection,n=0;n<t.length;++n)t[n].clear();t.length=0}function c(e){f(e);for(var t=e.listSelections(),n=0;n<t.length;n++)l(e,t[n].from(),t[n].to())}});