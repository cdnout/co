!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function s(e,t,i,n){this.cm=e,this.node=t,this.options=i,this.height=n,this.cleared=!1}function l(e,t){for(var i=t.nextSibling;i;i=i.nextSibling)if(i==e.getWrapperElement())return 1}e.defineExtension("addPanel",function(e,t){t=t||{},this.state.panels||function(n){var e=n.getWrapperElement(),t=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,r=parseInt(t.height),o=n.state.panels={setHeight:e.style.height,panels:[],wrapper:document.createElement("div")},i=n.hasFocus(),t=n.getScrollInfo();e.parentNode.insertBefore(o.wrapper,e),o.wrapper.appendChild(e),n.scrollTo(t.left,t.top),i&&n.focus();n._setSize=n.setSize,null!=r&&(n.setSize=function(e,t){t=t||o.wrapper.offsetHeight,"number"!=typeof(o.setHeight=t)&&(t=(i=/^(\d+\.?\d*)px$/.exec(t))?Number(i[1]):(o.wrapper.style.height=t,o.wrapper.offsetHeight));var i=t-o.panels.map(function(e){return e.node.getBoundingClientRect().height}).reduce(function(e,t){return e+t},0);n._setSize(e,i),r=t})}(this);var i=this.state.panels,n=i.wrapper,r=this.getWrapperElement(),o=t.replace instanceof s&&!t.replace.cleared;t.after instanceof s&&!t.after.cleared?n.insertBefore(e,t.before.node.nextSibling):t.before instanceof s&&!t.before.cleared?n.insertBefore(e,t.before.node):o?(n.insertBefore(e,t.replace.node),t.replace.clear(!0)):"bottom"==t.position?n.appendChild(e):"before-bottom"==t.position?n.insertBefore(e,r.nextSibling):"after-top"==t.position?n.insertBefore(e,r):n.insertBefore(e,n.firstChild);r=t&&t.height||e.offsetHeight,n=new s(this,e,t,r);return i.panels.push(n),this.setSize(),t.stable&&l(this,e)&&this.scrollTo(null,this.getScrollInfo().top+r),n}),s.prototype.clear=function(e){var t;this.cleared||(this.cleared=!0,(t=this.cm.state.panels).panels.splice(t.panels.indexOf(this),1),this.cm.setSize(),this.options.stable&&l(this.cm,this.node)&&this.cm.scrollTo(null,this.cm.getScrollInfo().top-this.height),t.wrapper.removeChild(this.node),0!=t.panels.length||e||function(e){var t=e.state.panels;e.state.panels=null;var i=e.getWrapperElement(),n=e.hasFocus(),r=e.getScrollInfo();t.wrapper.parentNode.replaceChild(i,t.wrapper),e.scrollTo(r.left,r.top),n&&e.focus();i.style.height=t.setHeight,e.setSize=e._setSize,e.setSize()}(this.cm))},s.prototype.changed=function(){this.height=this.node.getBoundingClientRect().height,this.cm.setSize()}});