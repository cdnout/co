(function(e){e.widget("ui.selectableScroll",e.ui.selectable,{options:{scrollElement:null,scrollSnapX:5,scrollSnapY:5,scrollAmount:25,scrollIntervalTime:100},_create:function(){this.element.addClass("ui-selectable");this.dragged=false;this.helperClasses=["no-top","no-right","no-bottom","no-left"];this.scrollElement=this.options.scrollElement||this.element;this.refresh();this._mouseInit();this.helper=e("<div class='ui-selectable-helper'></div>")},refresh:function(){var t=this.scrollElement.offset();var n=this.scrollElement.prop("scrollLeft");var r=this.scrollElement.prop("scrollTop");this.selectees=e(this.options.filter,this.scrollElement[0]);this.selectees.addClass("ui-selectee");this.selectees.each(function(){var i=e(this),s=i.offset();e.data(this,"selectable-item",{element:this,$element:i,left:s.left,top:s.top,right:s.left+i.outerWidth(),bottom:s.top+i.outerHeight(),relative:{left:s.left-t.left+n,top:s.top-t.top+r,right:s.left-t.left+n+i.outerWidth(),bottom:s.top-t.top+r+i.outerHeight()},startselected:false,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},_mouseStart:function(t){var n=e.ui.selectable.prototype._mouseStart.call(this,t);this.lastDragEvent=null;this.scrollInfo={elementOffset:this.scrollElement.offset(),scrollHeight:this.scrollElement.prop("scrollHeight"),scrollWidth:this.scrollElement.prop("scrollWidth"),elementHeight:this.scrollElement.height(),elementWidth:this.scrollElement.width()};this.scrollInfo.dragStartXPos=t.pageX-this.scrollInfo.elementOffset.left+this.scrollElement.prop("scrollLeft");this.scrollInfo.dragStartYPos=t.pageY-this.scrollInfo.elementOffset.top+this.scrollElement.prop("scrollTop");this.scrollIntervalId=null;return n},_updateHelper:function(t){var n,r,i,s;var o=[];if(t.x1-t.scrollLeft<0){o.push("no-left");n=this.scrollInfo.elementOffset.left}else{n=this.scrollInfo.elementOffset.left+t.x1-t.scrollLeft}if(t.y1-t.scrollTop<0){o.push("no-top");r=this.scrollInfo.elementOffset.top}else{r=this.scrollInfo.elementOffset.top+t.y1-t.scrollTop}if(t.x2-t.scrollLeft>this.scrollInfo.elementWidth){o.push("no-right");i=this.scrollInfo.elementOffset.left+this.scrollInfo.elementWidth}else{i=this.scrollInfo.elementOffset.left+t.x2-t.scrollLeft}if(t.y2-t.scrollTop>this.scrollInfo.elementHeight){o.push("no-bottom");s=this.scrollInfo.elementOffset.top+this.scrollInfo.elementHeight}else{s=this.scrollInfo.elementOffset.top+t.y2-t.scrollTop}for(var u=0;u<this.helperClasses.length;u++){var a=this.helperClasses[u];if(e.inArray(a,o)!==-1){this.helper.addClass(a)}else{this.helper.removeClass(a)}}this.helper.css({left:n,top:r,width:i-n,height:s-r})},_scrollIfNeeded:function(e){var t=this.scrollElement.prop("scrollLeft");var n=this.scrollElement.prop("scrollTop");var r=false;if(this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left<this.options.scrollSnapX&&t>0){t=t<this.options.scrollAmount?0:t-this.options.scrollAmount;this.scrollElement.prop("scrollLeft",t);r=true}if(this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top<this.options.scrollSnapY&&n>0){n=n<this.options.scrollAmount?0:n-this.options.scrollAmount;this.scrollElement.prop("scrollTop",n);r=true}if(this.lastDragEvent.pageX-this.scrollInfo.elementOffset.left>this.scrollInfo.elementWidth-this.options.scrollSnapX&&this.scrollInfo.scrollWidth>t+this.scrollInfo.elementWidth){t=t+this.options.scrollAmount>this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth?this.scrollInfo.scrollWidth-this.scrollInfo.elementWidth:t+this.options.scrollAmount;this.scrollElement.prop("scrollLeft",t);r=true}if(this.lastDragEvent.pageY-this.scrollInfo.elementOffset.top>this.scrollInfo.elementHeight-this.options.scrollSnapY&&this.scrollInfo.scrollHeight>t+this.scrollInfo.elementHeight){n=n+this.options.scrollAmount>this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight?this.scrollInfo.scrollHeight-this.scrollInfo.elementHeight:n+this.options.scrollAmount;this.scrollElement.prop("scrollTop",n);r=true}return{scrollLeft:t,scrollTop:n,keepScrolling:r}},_calcRelativePosition:function(e){var t=e.x-this.scrollInfo.elementOffset.left+e.scrollLeft;var n=e.y-this.scrollInfo.elementOffset.top+e.scrollTop;return{x:t,y:n}},_calcRelativeArea:function(e){var t=e.xPos<this.scrollInfo.dragStartXPos?e.xPos:this.scrollInfo.dragStartXPos;var n=e.yPos<this.scrollInfo.dragStartYPos?e.yPos:this.scrollInfo.dragStartYPos;var r=e.xPos>this.scrollInfo.dragStartXPos?e.xPos:this.scrollInfo.dragStartXPos;var i=e.yPos>this.scrollInfo.dragStartYPos?e.yPos:this.scrollInfo.dragStartYPos;return{x1:t,y1:n,x2:r,y2:i}},_updateSelectees:function(t){var n=this;this.selectees.each(function(){var r=e.data(this,"selectable-item"),i=false;if(!r||r.element===n.element[0]){return}if(n.options.tolerance==="touch"){i=!(r.relative.left>t.x2||r.relative.right<t.x1||r.relative.top>t.y2||r.relative.bottom<t.y1)}else if(n.options.tolerance==="fit"){i=r.relative.left>t.x1&&r.relative.right<t.x2&&r.relative.top>t.y1&&r.relative.bottom<t.y2}if(i){if(r.selected){r.$element.removeClass("ui-selected");r.selected=false}if(r.unselecting){r.$element.removeClass("ui-unselecting");r.unselecting=false}if(!r.selecting){r.$element.addClass("ui-selecting");r.selecting=true;n._trigger("selecting",n.lastDragEvent,{selecting:r.element})}}else{if(r.selecting){if((n.lastDragEvent.metaKey||n.lastDragEvent.ctrlKey)&&r.startselected){r.$element.removeClass("ui-selecting");r.selecting=false;r.$element.addClass("ui-selected");r.selected=true}else{r.$element.removeClass("ui-selecting");r.selecting=false;if(r.startselected){r.$element.addClass("ui-unselecting");r.unselecting=true}n._trigger("unselecting",n.lastDragEvent,{unselecting:r.element})}}if(r.selected){if(!n.lastDragEvent.metaKey&&!n.lastDragEvent.ctrlKey&&!r.startselected){r.$element.removeClass("ui-selected");r.selected=false;r.$element.addClass("ui-unselecting");r.unselecting=true;n._trigger("unselecting",n.lastDragEvent,{unselecting:r.element})}}}})},_mouseDrag:function(e){this.dragged=true;if(this.options.disabled){return}this.lastDragEvent=e;var t=this._scrollIfNeeded();this._updateIntervals({keepScrolling:t.keepScrolling});this._updateUi({doUpdateHelper:true});return false},_updateUi:function(e){var t=this._scrollIfNeeded({pageX:this.lastDragEvent.pageX,pageY:this.lastDragEvent.pageY});var n=this._calcRelativePosition({x:this.lastDragEvent.pageX,y:this.lastDragEvent.pageY,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop});var r=this._calcRelativeArea({xPos:n.x,yPos:n.y});if(e.doUpdateHelper){this._updateHelper({scrollLeft:t.scrollLeft,scrollTop:t.scrollTop,x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2})}this._updateSelectees({x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2})},_updateIntervals:function(e){var t=this;if(e.keepScrolling&&!this.scrollIntervalId){this.scrollIntervalId=setInterval(function(){t._updateUi({doUpdateHelper:false})},this.options.scrollIntervalTime)}if(!e.keepScrolling&&this.scrollIntervalId)this._clearIntervals()},_clearIntervals:function(){if(this.scrollIntervalId)clearInterval(this.scrollIntervalId);this.scrollIntervalId=null},_mouseStop:function(t){this._clearIntervals();var n=e.ui.selectable.prototype._mouseStop.call(this,t);return n}})})(jQuery)
