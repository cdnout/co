(()=>{var r={1924:(t,e,r)=>{"use strict";var n=r(210),i=r(5559),o=i(n("String.prototype.indexOf"));t.exports=function(t,e){e=n(t,!!e);return"function"==typeof e&&-1<o(t,".prototype.")?i(e):e}},5559:(t,e,r)=>{"use strict";var n=r(8612),r=r(210),i=r("%Function.prototype.apply%"),o=r("%Function.prototype.call%"),s=r("%Reflect.apply%",!0)||n.call(o,i),a=r("%Object.getOwnPropertyDescriptor%",!0),c=r("%Object.defineProperty%",!0),u=r("%Math.max%");if(c)try{c({},"a",{value:1})}catch(t){c=null}t.exports=function(t){var e=s(n,o,arguments);return a&&c&&a(e,"length").configurable&&c(e,"length",{value:1+u(0,t.length-(arguments.length-1))}),e};function l(){return s(n,i,arguments)}c?c(t.exports,"apply",{value:l}):t.exports.apply=l},6313:t=>{var e=function(){"use strict";function m(t,e){return null!=e&&t instanceof e}var w,S,I;try{w=Map}catch(m){w=function(){}}try{S=Set}catch(m){S=function(){}}try{I=Promise}catch(m){I=function(){}}function O(t,p,e,d,y){"object"==typeof p&&(e=p.depth,d=p.prototype,y=p.includeNonEnumerable,p=p.circular);var v=[],g=[],b="undefined"!=typeof Buffer;return void 0===p&&(p=!0),function n(t,i){if(null===t)return null;if(0===i)return t;var r,e,o;if("object"!=typeof t)return t;if(m(t,w))r=new w;else if(m(t,S))r=new S;else if(m(t,I))r=new I(function(e,r){t.then(function(t){e(n(t,i-1))},function(t){r(n(t,i-1))})});else if(O.__isArray(t))r=[];else if(O.__isRegExp(t))r=new RegExp(t.source,P(t)),t.lastIndex&&(r.lastIndex=t.lastIndex);else if(O.__isDate(t))r=new Date(t.getTime());else{if(b&&Buffer.isBuffer(t))return r=Buffer.allocUnsafe?Buffer.allocUnsafe(t.length):new Buffer(t.length),t.copy(r),r;m(t,Error)?r=Object.create(t):void 0===d?(e=Object.getPrototypeOf(t),r=Object.create(e)):(r=Object.create(d),e=d)}if(p){var s=v.indexOf(t);if(-1!=s)return g[s];v.push(t),g.push(r)}for(c in m(t,w)&&t.forEach(function(t,e){e=n(e,i-1),t=n(t,i-1);r.set(e,t)}),m(t,S)&&t.forEach(function(t){t=n(t,i-1);r.add(t)}),t)(o=e?Object.getOwnPropertyDescriptor(e,c):o)&&null==o.set||(r[c]=n(t[c],i-1));if(Object.getOwnPropertySymbols)for(var a=Object.getOwnPropertySymbols(t),c=0;c<a.length;c++){var u=a[c];(f=Object.getOwnPropertyDescriptor(t,u))&&!f.enumerable&&!y||(r[u]=n(t[u],i-1),f.enumerable||Object.defineProperty(r,u,{enumerable:!1}))}if(y){var l=Object.getOwnPropertyNames(t);for(c=0;c<l.length;c++){var f,h=l[c];(f=Object.getOwnPropertyDescriptor(t,h))&&f.enumerable||(r[h]=n(t[h],i-1),Object.defineProperty(r,h,{enumerable:!1}))}}return r}(t,e=void 0===e?1/0:e)}function e(t){return Object.prototype.toString.call(t)}function P(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return O.clonePrototype=function(t){if(null===t)return null;function e(){}return e.prototype=t,new e},O.__objToStr=e,O.__isDate=function(t){return"object"==typeof t&&"[object Date]"===e(t)},O.__isArray=function(t){return"object"==typeof t&&"[object Array]"===e(t)},O.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===e(t)},O.__getRegExpFlags=P,O}();t.exports&&(t.exports=e)},5643:t=>{t.exports=!1},624:t=>{function n(t){if(t){var e,r=t;for(e in n.prototype)r[e]=n.prototype[e];return r}}(t.exports=n).prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},n.prototype.once=function(t,e){var r=this;function n(){r.off(t,n),e.apply(this,arguments)}return this._callbacks=this._callbacks||{},n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks[t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},7187:t=>{"use strict";var e="object"==typeof Reflect?Reflect:null,c=e&&"function"==typeof e.apply?e.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},r=e&&"function"==typeof e.ownKeys?e.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)},n=Number.isNaN||function(t){return t!=t};function i(){i.init.call(this)}t.exports=i,t.exports.once=function(i,o){return new Promise(function(t,e){function r(t){i.removeListener(o,n),e(t)}function n(){"function"==typeof i.removeListener&&i.removeListener("error",r),t([].slice.call(arguments))}d(i,o,n,{once:!0}),"error"!==o&&"function"==typeof i.on&&d(i,"error",r,{once:!0})})},(i.EventEmitter=i).prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function s(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function a(t,e,r,n){var i,o;return u(r),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,r.listener||r),i=t._events),o=i[e]),void 0===o?(o=i[e]=r,++t._eventsCount):("function"==typeof o?o=i[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),0<(i=s(t))&&o.length>i&&!o.warned&&(o.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=t,n.type=e,n.count=o.length,console&&console.warn&&console.warn(n))),t}function l(t,e,r){t={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},e=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(t);return e.listener=r,t.wrapFn=e}function f(t,e,r){t=t._events;if(void 0===t)return[];t=t[e];{if(void 0===t)return[];if("function"==typeof t)return r?[t.listener||t]:[t];if(r){for(var n=t,i=new Array(n.length),o=0;o<i.length;++o)i[o]=n[o].listener||n[o];return i}return p(t,t.length)}}function h(t){var e=this._events;if(void 0!==e){e=e[t];if("function"==typeof e)return 1;if(void 0!==e)return e.length}return 0}function p(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function d(r,n,i,o){if("function"==typeof r.on)o.once?r.once(n,i):r.on(n,i);else{if("function"!=typeof r.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r);r.addEventListener(n,function t(e){o.once&&r.removeEventListener(n,t),i(e)})}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return s(this)},i.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){if((o=0<e.length?e[0]:o)instanceof Error)throw o;n=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw n.context=o,n}var o=i[t];if(void 0===o)return!1;if("function"==typeof o)c(o,this,e);else for(var s=o.length,a=p(o,s),r=0;r<s;++r)c(a[r],this,e);return!0},i.prototype.on=i.prototype.addListener=function(t,e){return a(this,t,e,!1)},i.prototype.prependListener=function(t,e){return a(this,t,e,!0)},i.prototype.once=function(t,e){return u(e),this.on(t,l(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,l(this,t,e)),this},i.prototype.off=i.prototype.removeListener=function(t,e){var r,n,i,o,s;if(u(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;0<=o;o--)if(r[o]===e||r[o].listener===e){s=r[o].listener,i=o;break}if(i<0)return this;if(0===i)r.shift();else{var a=r;var c=i;for(;c+1<a.length;c++)a[c]=a[c+1];a.pop()}1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},i.prototype.removeAllListeners=function(t){var e,r;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(o=e.length-1;0<=o;o--)this.removeListener(t,e[o]);return this},i.prototype.listeners=function(t){return f(this,t,!0)},i.prototype.rawListeners=function(t){return f(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):h.call(t,e)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return 0<this._eventsCount?r(this._events):[]}},9804:t=>{var s=Object.prototype.hasOwnProperty,a=Object.prototype.toString;t.exports=function(t,e,r){if("[object Function]"!==a.call(e))throw new TypeError("iterator must be a function");var n=t.length;if(n===+n)for(var i=0;i<n;i++)e.call(r,t[i],i,t);else for(var o in t)s.call(t,o)&&e.call(r,t[o],o,t)}},7648:t=>{"use strict";var c=Array.prototype.slice,u=Object.prototype.toString;t.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==u.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var n=c.call(arguments,1),t=Math.max(0,r.length-n.length),i=[],o=0;o<t;o++)i.push("$"+o);var s,a=Function("binder","return function ("+i.join(",")+"){ return binder.apply(this,arguments); }")(function(){var t;return this instanceof a?(t=r.apply(this,n.concat(c.call(arguments))),Object(t)===t?t:this):r.apply(e,n.concat(c.call(arguments)))});return r.prototype&&((s=function(){}).prototype=r.prototype,a.prototype=new s,s.prototype=null),a}},8612:(t,e,r)=>{"use strict";r=r(7648);t.exports=Function.prototype.bind||r},210:(t,e,r)=>{"use strict";var n,h=SyntaxError,i=Function,p=TypeError,o=function(t){try{return i('"use strict"; return ('+t+").constructor;")()}catch(t){}},d=Object.getOwnPropertyDescriptor;if(d)try{d({},"")}catch(t){d=null}function s(){throw new p}function y(t){var e,r;return"%AsyncFunction%"===t?e=o("async function () {}"):"%GeneratorFunction%"===t?e=o("function* () {}"):"%AsyncGeneratorFunction%"===t?e=o("async function* () {}"):"%AsyncGenerator%"===t?(r=y("%AsyncGeneratorFunction%"))&&(e=r.prototype):"%AsyncIteratorPrototype%"===t&&(r=y("%AsyncGenerator%"))&&(e=u(r.prototype)),g[t]=e}var a=d?function(){try{return s}catch(t){try{return d(arguments,"callee").get}catch(t){return s}}}():s,c=r(1405)(),u=Object.getPrototypeOf||function(t){return t.__proto__},v={},l="undefined"==typeof Uint8Array?n:u(Uint8Array),g={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":c?u([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":c?u(u([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&c?u((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&c?u((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":c?u(""[Symbol.iterator]()):n,"%Symbol%":c?Symbol:n,"%SyntaxError%":h,"%ThrowTypeError%":a,"%TypedArray%":l,"%TypeError%":p,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},b={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},c=r(8612),m=r(7642),w=c.call(Function.call,Array.prototype.concat),S=c.call(Function.apply,Array.prototype.splice),I=c.call(Function.call,String.prototype.replace),O=c.call(Function.call,String.prototype.slice),P=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g;t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new p("intrinsic name must be a non-empty string");if(1<arguments.length&&"boolean"!=typeof e)throw new p('"allowMissing" argument must be a boolean');var r=function(t){var e=O(t,0,1),r=O(t,-1);if("%"===e&&"%"!==r)throw new h("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new h("invalid intrinsic syntax, expected opening `%`");var i=[];return I(t,P,function(t,e,r,n){i[i.length]=r?I(n,A,"$1"):e||t}),i}(t),n=0<r.length?r[0]:"",i=function(t,e){var r,n=t;if(m(b,n)&&(n="%"+(r=b[n])[0]+"%"),m(g,n)){var i=g[n];if(void 0!==(i=i===v?y(n):i)||e)return{alias:r,name:n,value:i};throw new p("intrinsic "+t+" exists, but is not available. Please file an issue!")}throw new h("intrinsic "+t+" does not exist!")}("%"+n+"%",e),o=(i.name,i.value),s=!1,i=i.alias;i&&(n=i[0],S(r,w([0,1],i)));for(var a=1,c=!0;a<r.length;a+=1){var u=r[a],l=O(u,0,1),f=O(u,-1);if(('"'===l||"'"===l||"`"===l||'"'===f||"'"===f||"`"===f)&&l!==f)throw new h("property names with quotes must have matching quotes");if("constructor"!==u&&c||(s=!0),m(g,l="%"+(n+="."+u)+"%"))o=g[l];else if(null!=o){if(!(u in o)){if(e)return;throw new p("base intrinsic for "+t+" exists, but the property is not available.")}o=d&&a+1>=r.length?(c=!!(f=d(o,u)))&&"get"in f&&!("originalValue"in f.get)?f.get:o[u]:(c=m(o,u),o[u]),c&&!s&&(g[l]=o)}}return o}},1405:(t,e,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(5419);t.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},5419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},6410:(t,e,r)=>{"use strict";var n=r(5419);t.exports=function(){return n()&&!!Symbol.toStringTag}},7642:(t,e,r)=>{"use strict";r=r(8612);t.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},5717:t=>{"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){var r;e&&(t.super_=e,(r=function(){}).prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t)}},2584:(t,e,r)=>{"use strict";function n(t){return!(o&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===s(t)}function i(t){return!!n(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&0<=t.length&&"[object Array]"!==s(t)&&"[object Function]"===s(t.callee)}var o=r(6410)(),s=r(1924)("Object.prototype.toString"),r=function(){return n(arguments)}();n.isLegacyArguments=i,t.exports=r?n:i},9134:t=>{t.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron")}},8662:(t,e,r)=>{"use strict";var n,i=Object.prototype.toString,o=Function.prototype.toString,s=/^\s*(?:function)?\*/,a=r(6410)(),c=Object.getPrototypeOf;t.exports=function(t){return"function"==typeof t&&(!!s.test(o.call(t))||(a?!!c&&(void 0===n&&(e=function(){if(!a)return!1;try{return Function("return function*() {}")()}catch(t){}}(),n=!!e&&c(e)),c(t)===n):"[object GeneratorFunction]"===i.call(t)));var e}},6898:t=>{"use strict";t.exports=t=>!!t&&("symbol"==typeof Symbol.observable&&"function"==typeof t[Symbol.observable]?t===t[Symbol.observable]():"function"==typeof t["@@observable"]&&t===t["@@observable"]())},5692:(t,e,r)=>{"use strict";var i=r(9804),n=r(3083),o=r(1924),s=o("Object.prototype.toString"),a=r(6410)(),c="undefined"==typeof globalThis?r.g:globalThis,u=n(),l=o("Array.prototype.indexOf",!0)||function(t,e){for(var r=0;r<t.length;r+=1)if(t[r]===e)return r;return-1},f=o("String.prototype.slice"),h={},p=r(882),d=Object.getPrototypeOf;a&&p&&d&&i(u,function(t){var e,r=new c[t];Symbol.toStringTag in r&&(r=d(r),(e=p(r,Symbol.toStringTag))||(r=d(r),e=p(r,Symbol.toStringTag)),h[t]=e.get)}),t.exports=function(t){return!(!t||"object"!=typeof t)&&(a&&Symbol.toStringTag in t?!!p&&(r=t,n=!1,i(h,function(t,e){if(!n)try{n=t.call(r)===e}catch(t){}}),n):(t=f(s(t),8,-1),-1<l(u,t)));var r,n}},6194:function(t,e,r){var n;void 0!==(e="function"==typeof(n=function(){{const c=r(693),u=r(7462),l=r(3086);function t(){this.mode="reference",this.dbref=null,this.dirtyPartitions=[]}return t.prototype.generateDestructured=function*(t){var e,r,n,i;if((t=t||{}).hasOwnProperty("partition")||(t.partition=-1),-1!==t.partition){if(0<=t.partition)for(n=this.dbref.collections[t.partition].data.length,i=0;i<n;i++)yield JSON.stringify(this.dbref.collections[t.partition].data[i])}else{for(r=this.dbref.copy(),e=0;e<r.collections.length;e++)r.collections[e].data=[];yield r.serialize({serializationMethod:"normal"})}},t.prototype.loadDatabase=function(n,i){var o,s,a=this;this.dbref=null,c.stat(n,function(t,e){var r;if(t)return"ENOENT"===t.code?void i(null):void i(t);e.isFile()?(s=c.createReadStream(n),o=new l,(s=u.createInterface(s,o)).on("line",function(t){if(null===a.dbref&&""!==t)try{a.dbref=JSON.parse(t)}catch(t){r=t}}),s.on("close",function(){r?i(r):0<a.dbref.collections.length&&a.loadNextCollection(n,0,function(){i(a.dbref)})})):i(new Error(n+" is not a valid file."))})},t.prototype.loadNextCollection=function(e,r,n){var i,t=c.createReadStream(e+"."+r),o=new l,s=u.createInterface(t,o),a=this;s.on("line",function(t){if(""!==t){try{i=JSON.parse(t)}catch(t){n(t)}a.dbref.collections[r].data.push(i)}}),s.on("close",function(t){i=s=null,++r<a.dbref.collections.length?a.loadNextCollection(e,r,n):n()})},t.prototype.getPartition=function*(){var t,e=this.dbref.collections.length;for(yield-1,t=0;t<e;t++)this.dbref.collections[t].dirty&&(yield t)},t.prototype.exportDatabase=function(t,e,r){this.dbref=e;e=this.getPartition();this.saveNextPartition(t,e,function(){r(null)})},t.prototype.saveNextPartition=function(t,e,r){var n=this,i=e.next();if(i.done)r();else{var o,s=t+(-1===i.value?"":"."+i.value),a=c.createWriteStream(s);for(o of(a.on("close",function(){n.saveNextPartition(t,e,r)}),this.generateDestructured({partition:i.value})))a.write(o+"\n");a.end()}},t}})?n.apply(e,[]):n)&&(t.exports=e)},7996:function(t,e){var r;void 0!==(e="function"==typeof(r=function(){return t.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadKey=t.prototype.loadDatabase=function(e,r){var t=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(t,e,function(t){"function"==typeof r?0===t.id?r(null):r(t.val):console.log(t.val)}):this.catalog=new s(function(t){n.catalog=t,n.loadDatabase(e,r)})},t.prototype.saveKey=t.prototype.saveDatabase=function(e,r,n){var t=this.app,i=this;function o(t){t&&!0===t.success?n(null):n(new Error("Error saving database")),i.options.closeAfterSave&&i.closeDatabase()}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(t,e,r,o):this.catalog=new s(function(t){i.saveDatabase(e,r,o)})},t.prototype.deleteKey=t.prototype.deleteDatabase=function(e,r){var t=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(t,e,function(t){t=t.id;0!==t?n.catalog.deleteAppKey(t,r):"function"==typeof r&&r({success:!0})}):this.catalog=new s(function(t){n.catalog=t,n.deleteDatabase(e,r)})},t.prototype.deleteDatabasePartitions=function(e){var r=this;this.getDatabaseList(function(t){t.forEach(function(t){t.startsWith(e)&&r.deleteDatabase(t)})})},t.prototype.getKeyList=t.prototype.getDatabaseList=function(n){var t=this.app,e=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(t,function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].key);"function"==typeof n?n(e):e.forEach(function(t){console.log(t)})}):this.catalog=new s(function(t){e.catalog=t,e.getDatabaseList(n)})},t.prototype.getCatalogSummary=function(a){this.app;var e=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(t){for(var e,r,n,i,o=[],s=0;s<t.length;s++)r=(e=t[s]).app||"",n=e.key||"",i=e.val||"",r=2*r.length+2*n.length+i.length+1,o.push({app:e.app,key:e.key,size:r});"function"==typeof a?a(o):o.forEach(function(t){console.log(t)})}):this.catalog=new s(function(t){e.catalog=t,e.getCatalogSummary(a)})},s.prototype.initializeLokiCatalog=function(e){var t=indexedDB.open("LokiCatalog",1),r=this;t.onupgradeneeded=function(t){var t=t.target.result;t.objectStoreNames.contains("LokiAKV")&&t.deleteObjectStore("LokiAKV"),t.objectStoreNames.contains("LokiAKV")||((t=t.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0})).createIndex("app","app",{unique:!1}),t.createIndex("key","key",{unique:!1}),t.createIndex("appkey","appkey",{unique:!0}))},t.onsuccess=function(t){r.db=t.target.result,"function"==typeof e&&e(r)},t.onerror=function(t){throw t}},s.prototype.getAppKey=function(t,e,r){var n,i,t=t+","+e,e=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(t);e.onsuccess=(n=r,function(t){t=t.target.result;null==t&&(t={id:0,success:!1}),"function"==typeof n?n(t):console.log(t)}),e.onerror=(i=r,function(t){if("function"!=typeof i)throw t;i({id:0,success:!1})})},s.prototype.getAppKeyById=function(t,e,r){var n,i;this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(t).onsuccess=(n=r,i=e,function(t){"function"==typeof i?i(t.target.result,n):console.log(t.target.result)})},s.prototype.setAppKey=function(n,i,o,s){var e,a=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),c=a.index("appkey").get(n+","+i);c.onsuccess=function(t){t=t.target.result;null==t?t={app:n,key:i,appkey:n+","+i,val:o}:t.val=o;var e,r,t=a.put(t);t.onerror=(e=s,function(t){"function"==typeof e?e({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(c.error))}),t.onsuccess=(r=s,function(t){"function"==typeof r&&r({success:!0})})},c.onerror=(e=s,function(t){"function"==typeof e?e({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(c.error))})},s.prototype.deleteAppKey=function(t,e){var r,n,i=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(t);i.onsuccess=(r=e,function(t){"function"==typeof r&&r({success:!0})}),i.onerror=(n=e,function(t){"function"==typeof n?n({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(i.error))})},s.prototype.getAppKeys=function(t,e){var r,n,i,o=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),t=IDBKeyRange.only(t),o=o.openCursor(t);o.onsuccess=(n=[],i=e,function(t){var e,t=t.target.result;t?(e=t.value,n.push(e),t.continue()):"function"==typeof i?i(n):console.log(n)}),o.onerror=(r=e,function(t){"function"==typeof r?r(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},s.prototype.getAllKeys=function(t){var e,r,n,i=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor();i.onsuccess=(r=[],n=t,function(t){var e,t=t.target.result;t?(e=t.value,r.push(e),t.continue()):"function"==typeof n?n(r):console.log(r)}),i.onerror=(e=t,function(t){"function"==typeof e&&e(null)})},t;function t(t,e){if(this.app="loki",this.options=e||{},void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function s(t){this.db=null,this.initializeLokiCatalog(t)}})?r.apply(e,[]):r)&&(t.exports=e)},3050:function(t,e,z){var r=function(){"use strict";var I=Object.prototype.hasOwnProperty;function p(t){var e,r;if(Array.isArray(t)){for(r=0;r<t.length;r++)p(t[r]);s(t)}else if(null!==t&&"object"==typeof t){for(e in t)t.hasOwnProperty(e)&&p(t[e]);s(t)}}function s(t){Object.isFrozen(t)||Object.freeze(t)}function a(t){return Object.isFrozen(t)?h(t,"shallow"):t}var O={copyProperties:function(t,e){for(var r in t)e[r]=t[r]},resolveTransformObject:function(t,e,r){var n,i;if("number"!=typeof r&&(r=0),10<=++r)return t;for(n in t)"string"==typeof t[n]&&0===t[n].indexOf("[%lktxp]")?(i=t[n].substring(8),e.hasOwnProperty(i)&&(t[n]=e[i])):"object"==typeof t[n]&&(t[n]=O.resolveTransformObject(t[n],e,r));return t},resolveTransformParams:function(t,e){var r,n,i=[];if(void 0===e)return t;for(r=0;r<t.length;r++)n=h(t[r],"shallow-recurse-objects"),i.push(O.resolveTransformObject(n,e));return i},getIn:function(t,e,r){if(null!=t){if(!r)return t[e];if("string"==typeof e&&(e=e.split(".")),!Array.isArray(e))throw new Error("path must be a string or array. Found "+typeof e);for(var n=0,i=e.length;null!=t&&n<i;)t=t[e[n++]];return n&&n==i?t:void 0}}},b={aeq:t,lt:e,gt:r};function t(t,e){var r,n,i,o;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==i||9!==o)return i===o}return r=Number(t),n=Number(e),r==r||n==n?r===n:(r=t.toString())==e.toString()}function e(t,e,r){var n,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?r:o<s}return n=Number(t),i=Number(e),n==n&&i==i?n<i||!(i<n)&&r:n==n&&i!=i||(i!=i||n==n)&&(t<e||!(e<t)&&(t==e?r:(n=t.toString())<(i=e.toString())||n==i&&r))}function r(t,e,r){var n,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?r:s<o}return n=Number(t),i=Number(e),n==n&&i==i?i<n||!(n<i)&&r:(n!=n||i==i)&&(i==i&&n!=n||e<t||!(t<e)&&(t==e?r:(n=t.toString())>(i=e.toString())||n==i&&r))}function d(t,e,r){return b.aeq(t,e)?0:b.lt(t,e,!1)?r?1:-1:b.gt(t,e,!1)?r?-1:1:0}function P(t,e,r,n,i,o){var s,a=o||0,o=e[a],c=!1;if("object"==typeof t&&o in t&&(s=t[o]),a+1>=e.length)c=r(s,n,i);else if(Array.isArray(s))for(var u=0,l=s.length;u<l&&!0!==(c=P(s[u],e,r,n,i,a+1));u+=1);else c=P(s,e,r,n,i,a+1);return c}function n(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(t){return I.call(e,t)}:null}function o(t,e,r){for(var n in e)if(I.call(e,n))return A[n](t,e[n],r);return!1}var A={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return b.aeq(t,e)},$gt:function(t,e){return b.gt(t,e,!1)},$gte:function(t,e){return b.gt(t,e,!0)},$lt:function(t,e){return b.lt(t,e,!1)},$lte:function(t,e){return b.lt(t,e,!0)},$jgt:function(t,e){return e<t},$jgte:function(t,e){return e<=t},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return null!=t&&b.gt(t,e[0],!0)&&b.lt(t,e[1],!0)},$jbetween:function(t,e){return null!=t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$inSet:function(t,e){return e.has(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!A.$containsAny(t,e)},$containsAny:function(t,e){t=n(t);return null!==t&&(Array.isArray(e)?e.some(t):t(e))},$contains:function(t,e){t=n(t);return null!==t&&(Array.isArray(e)?e.every(t):t(e))},$elemMatch:function(t,n){return!!Array.isArray(t)&&t.some(function(r){return Object.keys(n).every(function(t){var e=n[t];return"object"==typeof e&&e||(e={$eq:e}),-1!==t.indexOf(".")?P(r,t.split("."),o,n[t],r):o(r[t],e,r)})})},$type:function(t,e,r){var n=typeof t;return"object"===n&&(Array.isArray(t)?n="array":t instanceof Date&&(n="date")),"object"!=typeof e?n===e:o(n,e,r)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e,r){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:o(t.length,e,r))},$len:function(t,e,r){return"string"==typeof t&&("object"!=typeof e?t.length===e:o(t.length,e,r))},$where:function(t,e){return!0===e(t)},$not:function(t,e,r){return!o(t,e,r)},$and:function(t,e,r){for(var n=0,i=e.length;n<i;n+=1)if(!o(t,e[n],r))return!1;return!0},$or:function(t,e,r){for(var n=0,i=e.length;n<i;n+=1)if(o(t,e[n],r))return!0;return!1},$exists:function(t,e){return e?void 0!==t:void 0===t}},x=(["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach(function(t){var n=A[t];A["$"+t]=function(t,e,r){if("string"==typeof e)return n(t,r[e]);if("function"==typeof e)return n(t,e(r));throw new Error("Invalid argument to $$ matcher")}}),{$eq:A.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0});function h(e,t){if(null==e)return null;var r;switch(t||"parse-stringify"){case"parse-stringify":r=JSON.parse(JSON.stringify(e));break;case"jquery-extend-deep":r=jQuery.extend(!0,{},e);break;case"shallow":r=Object.create(e.constructor.prototype),Object.keys(e).map(function(t){r[t]=e[t]});break;case"shallow-assign":r=Object.create(e.constructor.prototype),Object.assign(r,e);break;case"shallow-recurse-objects":r=h(e,"shallow"),Object.keys(e).forEach(function(t){"object"==typeof e[t]&&"Object"===e[t].constructor.name?r[t]=h(e[t],"shallow-recurse-objects"):Array.isArray(e[t])&&(r[t]=function(t,e){if("parse-stringify"==e)return h(t,e);for(var r=[],n=0,i=t.length;n<i;n++)r[n]=h(t[n],e);return r}(e[t],"shallow-recurse-objects"))})}return r}function i(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return}}function c(){}function u(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=void 0!==z.g&&(z.g.android||z.g.NSObject)?"NATIVESCRIPT":"undefined"==typeof window||void 0!==z.g&&z.g.window&&"undefined"!=typeof process?"NODEJS":"undefined"==typeof document||-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function l(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function f(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function y(){try{this.fs=z(693)}catch(t){this.fs=null}}function v(){}function g(t,e){return this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function m(t,e,r){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new g(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function w(t,e){this.name=t,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=t,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var a=this,r=((e=e||{}).hasOwnProperty("unique")&&(Array.isArray(e.unique)||(e.unique=[e.unique]),e.unique.forEach(function(t){a.uniqueNames.push(t)})),e.hasOwnProperty("exact")&&e.exact.forEach(function(t){a.constraints.exact[t]=new N(t)}),this.adaptiveBinaryIndices=!e.hasOwnProperty("adaptiveBinaryIndices")||e.adaptiveBinaryIndices,this.transactional=!!e.hasOwnProperty("transactional")&&e.transactional,this.cloneObjects=!!e.hasOwnProperty("clone")&&e.clone,this.cloneMethod=e.hasOwnProperty("cloneMethod")?e.cloneMethod:"parse-stringify",this.asyncListeners=!!e.hasOwnProperty("asyncListeners")&&e.asyncListeners,this.disableMeta=!!e.hasOwnProperty("disableMeta")&&e.disableMeta,this.disableChangesApi=!e.hasOwnProperty("disableChangesApi")||e.disableChangesApi,this.disableDeltaChangesApi=!e.hasOwnProperty("disableDeltaChangesApi")||e.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!e.hasOwnProperty("autoupdate")&&e.autoupdate,this.serializableIndices=!e.hasOwnProperty("serializableIndices")||e.serializableIndices,this.disableFreeze=!e.hasOwnProperty("disableFreeze")||e.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(e.ttl||-1,e.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[],[]);if(e&&e.indices)if("[object Array]"===Object.prototype.toString.call(e.indices))r=e.indices;else{if("string"!=typeof e.indices)throw new TypeError("Indices needs to be a string or an array of strings");r=[e.indices]}for(var n=0;n<r.length;n++)this.ensureIndex(r[n]);function c(t,e){var r=null!==e&&"object"==typeof e?Object.keys(e):null;if(r&&r.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var n={},i=0;i<r.length;i++){var o,s=r[i];e.hasOwnProperty(s)&&(!t.hasOwnProperty(s)||0<=a.uniqueNames.indexOf(s)||"$loki"==s||"meta"==s?n[s]=e[s]:void 0!==(o=c(t[s],e[s]))&&o!={}&&(n[s]=o))}return 0===Object.keys(n).length?void 0:n}return t===e?void 0:e}function i(){a.changes=[]}this.observerCallback=function(t){var e="function"==typeof Set?new Set:[];e.add||(e.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),t.forEach(function(t){e.add(t.object)}),e.forEach(function(t){if(!I.call(t,"$loki"))return a.removeAutoUpdateObserver(t);try{a.update(t)}catch(t){}})},this.getChangeDelta=function(t,e){return e?c(e,t):JSON.parse(JSON.stringify(t))},this.getObjectDelta=c,this.getChanges=function(){return a.changes},this.flushChanges=i,this.setChangesApi=function(t){a.disableChangesApi=!t,t||(a.disableDeltaChangesApi=!1)},this.on("delete",function(t){a.disableChangesApi||a.createChange(a.name,"R",t)}),this.on("warning",function(t){a.lokiConsoleWrapper.warn(t)}),i()}function S(t){return-1!==t.indexOf(".")}function k(t){return parseFloat(t,10)}function j(t,e){return t+e}function B(t,e){return t-e}function _(t){return t.reduce(j,0)/t.length}function E(t,e,r){if(!1===r)return t[e];for(var n=e.split("."),i=t;0<n.length;)i=i[n.shift()];return i}function C(t,e,r){for(var n,i,o=0,s=t.length;o<s;){if(0===(n=r.apply(null,[e,t[i=o+s>>1]])))return{found:!0,index:i};n<0?s=i:o=1+i}return{found:!1,index:s}}function D(r){return function(t,e){return C(t,e,r)}}function M(){}function L(t){this.field=t,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function N(t){this.index=Object.create(null),this.field=t}return c.prototype.events={},c.prototype.asyncListeners=!1,c.prototype.on=function(t,e){var r,n=this;return Array.isArray(t)?t.forEach(function(t){n.on(t,e)}):(r=(r=this.events[t])?r:this.events[t]=[]).push(e),e},c.prototype.emit=function(t){var e,r=this;if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].length&&(e=Array.prototype.slice.call(arguments,1),this.events[t].forEach(function(t){r.asyncListeners?setTimeout(function(){t.apply(r,e)},1):t.apply(r,e)}))},c.prototype.addListener=c.prototype.on,c.prototype.removeListener=function(t,e){var r=this;Array.isArray(t)?t.forEach(function(t){r.removeListener(t,e)}):this.events[t]&&(t=this.events[t]).splice(t.indexOf(e),1)},((u.prototype=new c).constructor=u).prototype.getIndexedAdapter=function(){return z(7996)},u.prototype.configureOptions=function(t,e){var r,n={fs:y,localStorage:v,memory:l};this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t&&(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof n[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new n[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),t.autoload&&e&&(r=this,setTimeout(function(){r.loadDatabase(t,t.autoloadCallback)},1)),this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)),this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new n[this.persistenceMethod]))},u.prototype.copy=function(t){var e,r,n=new u(this.filename,{env:"NA"});if(t=t||{},n.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(n.autosaveHandle=null,n.persistenceAdapter=null,e=n.collections.length,r=0;r<e;r++)n.collections[r].constraints=null,n.collections[r].ttl=null;return n},u.prototype.addCollection=function(t,e){var r,n=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&0<e.ttl)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<n;r+=1)if(this.collections[r].name===t)return this.collections[r];e=new w(t,e);return e.isIncremental=this.isIncremental,this.collections.push(e),this.verbose&&(e.lokiConsoleWrapper=console),e},u.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},u.prototype.getCollection=function(t){for(var e=this.collections.length,r=0;r<e;r+=1)if(this.collections[r].name===t)return this.collections[r];return this.emit("warning","collection "+t+" not found"),null},u.prototype.renameCollection=function(t,e){t=this.getCollection(t);return t&&(t.name=e),t},u.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},u.prototype.removeCollection=function(t){for(var e=this.collections.length,r=0;r<e;r+=1)if(this.collections[r].name===t){var n,i=new w(t,{}),o=this.collections[r];for(n in o)o.hasOwnProperty(n)&&i.hasOwnProperty(n)&&(o[n]=i[n]);return void this.collections.splice(r,1)}},u.prototype.getName=function(){return this.name},u.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":case"lokiConsoleWrapper":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},u.prototype.toJson=u.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":default:return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured()}},u.prototype.serializeDestructured=function(t){var e,r,n,i,o,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&0<=t.partition)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((o=new u(this.filename)).loadJSONObject(this),e=0;e<o.collections.length;e++)o.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,e=0;e<this.collections.length;e++)if(n=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=n.length,r=0;r<i;r++)s.push(n[r]),n[r]=null;s.push("")}else s.push(n);return t.partitioned?(t.delimited,s):t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},u.prototype.serializeCollection=function(t){var e,r,n=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,n=[],r=0;r<e;r++)n.push(JSON.stringify(this.collections[t.collectionIndex].data[r]));return t.delimited?(n.push(""),n.join(t.delimiter)):n},u.prototype.deserializeDestructured=function(t,e){var r,n,i,o=[],s=0,a=1,c=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(n=(r=JSON.parse(t[0])).collections.length,s=0;s<n;s++)r.collections[s].data=this.deserializeCollection(t[s+1],e);return r}if(e.delimited){if(o=t.split(e.delimiter),t=null,0===o.length)return null}else o=t;for(n=(r=JSON.parse(o[0])).collections.length,o[0]=null;!c;)o[a],""===o[a]?++s>n&&(c=!0):(i=JSON.parse(o[a]),r.collections[s].data.push(i)),o[a++]=null;return r},u.prototype.deserializeCollection=function(t,e){var r,n,i=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(i=t.split(e.delimiter)).pop():i=t,n=i.length,r=0;r<n;r++)i[r]=JSON.parse(i[r]);return i},u.prototype.loadJSON=function(t,e){var r;if(0===t.length)r={};else switch(this.options.serializationMethod){case"normal":case"pretty":default:r=JSON.parse(t);break;case"destructured":r=this.deserializeDestructured(t)}this.loadJSONObject(r,e)},u.prototype.loadJSONObject=function(t,e){var r,n,i,o,s,a,c=0,u=t.collections?t.collections.length:0;for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&e&&!e.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];c<u;c+=1){if(r=t.collections[c],(n=this.addCollection(r.name,{disableChangesApi:r.disableChangesApi,disableDeltaChangesApi:r.disableDeltaChangesApi,disableMeta:r.disableMeta,disableFreeze:!r.hasOwnProperty("disableFreeze")||r.disableFreeze})).adaptiveBinaryIndices=!!r.hasOwnProperty("adaptiveBinaryIndices")&&!0===r.adaptiveBinaryIndices,n.transactional=r.transactional,n.asyncListeners=r.asyncListeners,n.cloneObjects=r.cloneObjects,n.cloneMethod=r.cloneMethod||"parse-stringify",n.autoupdate=r.autoupdate,n.changes=r.changes,n.dirtyIds=r.dirtyIds||[],e&&!0===e.retainDirtyFlags?n.dirty=r.dirty:n.dirty=!1,i=r.data.length,o=0,e&&e.hasOwnProperty(r.name))for(s=function(t){var r,n=e[t.name];return n.proto?(r=n.inflate||O.copyProperties,function(t){var e=new n.proto;return r(t,e),e}):n.inflate}(r);o<i;o++)a=s(r.data[o]),n.data[o]=a,n.addAutoUpdateObserver(a),n.disableFreeze||p(n.data[o]);else for(;o<i;o++)n.data[o]=r.data[o],n.addAutoUpdateObserver(n.data[o]),n.disableFreeze||p(n.data[o]);if(n.maxId=void 0===r.maxId?0:r.maxId,void 0!==r.binaryIndices&&(n.binaryIndices=r.binaryIndices),void 0!==r.transforms&&(n.transforms=r.transforms),n.uniqueNames=[],r.hasOwnProperty("uniqueNames")&&(n.uniqueNames=r.uniqueNames),void 0!==r.DynamicViews){for(var l=0;l<r.DynamicViews.length;l++){var f=r.DynamicViews[l],h=n.addDynamicView(f.name,f.options);h.resultdata=f.resultdata,h.resultsdirty=f.resultsdirty,h.filterPipeline=f.filterPipeline,h.sortCriteriaSimple=f.sortCriteriaSimple,h.sortCriteria=f.sortCriteria,h.sortFunction=null,h.sortDirty=f.sortDirty,n.disableFreeze||(p(h.filterPipeline),h.sortCriteriaSimple?p(h.sortCriteriaSimple):h.sortCriteria&&p(h.sortCriteria)),h.resultset.filteredrows=f.resultset.filteredrows,h.resultset.filterInitialized=f.resultset.filterInitialized,h.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(n.ensureAllIndexes(!0),n.dirty=!0)}}},u.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},u.prototype.generateChangesNotification=function(t){function e(t){return t.name}var r=[],n=t||this.collections.map(e);return this.collections.forEach(function(t){-1!==n.indexOf(e(t))&&(r=r.concat(t.getChanges()))}),r},u.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},u.prototype.clearChanges=function(){this.collections.forEach(function(t){t.flushChanges&&t.flushChanges()})},l.prototype.loadDatabase=function(t,e){var r=this;this.options.asyncResponses?setTimeout(function(){r.hashStore.hasOwnProperty(t)?e(r.hashStore[t].value):e(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},l.prototype.saveDatabase=function(t,e,r){var n,i=this;this.options.asyncResponses?setTimeout(function(){n=i.hashStore.hasOwnProperty(t)?i.hashStore[t].savecount:0,i.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},r()},this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},r())},l.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},f.prototype.loadDatabase=function(t,r){var n=this;this.dbname=t,this.dbref=new u(t),this.adapter.loadDatabase(t,function(t){var e;t?("string"!=typeof t&&r(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()")),e=JSON.parse(t),n.dbref.loadJSONObject(e),e=null,n.dbref.collections.length,0!==n.dbref.collections.length?(n.pageIterator={collection:0,pageIndex:0},n.loadNextPartition(0,function(){r(n.dbref)})):r(n.dbref)):r(t)})},f.prototype.loadNextPartition=function(e,r){var t=this.dbname+"."+e,n=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(r);this.adapter.loadDatabase(t,function(t){t=n.dbref.deserializeCollection(t,{delimited:!0,collectionIndex:e});n.dbref.collections[e].data=t,++e<n.dbref.collections.length?n.loadNextPartition(e,r):r()})},f.prototype.loadNextPage=function(i){var t=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,o=this;this.adapter.loadDatabase(t,function(t){var e,r=t.split(o.options.delimiter),n=r.length,t=(t="")===r[n-1];for(t&&(r.pop(),""===r[(n=r.length)-1]&&1===n&&(r.pop(),n=r.length)),e=0;e<n;e++)o.dbref.collections[o.pageIterator.collection].data.push(JSON.parse(r[e])),r[e]=null;r=[],t?++o.pageIterator.collection<o.dbref.collections.length?o.loadNextPartition(o.pageIterator.collection,i):i():(o.pageIterator.pageIndex++,o.loadNextPage(i))})},f.prototype.exportDatabase=function(t,e,r){var n,i=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],n=0;n<i;n++)e.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition(function(t){r(t)})},f.prototype.saveNextPartition=function(e){var r=this,t=this.dirtyPartitions.shift(),n=this.dbname+(-1===t?"":"."+t);if(this.options.paging&&-1!==t)return this.pageIterator={collection:t,docIndex:0,pageIndex:0},void this.saveNextPage(function(t){0===r.dirtyPartitions.length?e(t):r.saveNextPartition(e)});t=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:t});this.adapter.saveDatabase(n,t,function(t){t?e(t):0===r.dirtyPartitions.length?e(null):r.saveNextPartition(e)})},f.prototype.saveNextPage=function(e){function t(t){u="",t&&e(t),l?e(null):(n.pageIterator.pageIndex++,n.saveNextPage(e))}var r,n=this,i=this.dbref.collections[this.pageIterator.collection],o=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,s=0,a=i.data.length,c=this.options.delimiter.length,u="",l=!1,f=!1;for(0===i.data.length&&(l=!0);;)if(l||(r=JSON.stringify(i.data[this.pageIterator.docIndex]),u+=r,s+=r.length,++this.pageIterator.docIndex>=a&&(l=!0)),(f=s>=this.options.pageSize?!0:f)&&!l||(u+=this.options.delimiter,s+=c),l||f)return void this.adapter.saveDatabase(o,u,t)},y.prototype.loadDatabase=function(r,n){var i=this;this.fs.stat(r,function(t,e){!t&&e.isFile()?i.fs.readFile(r,{encoding:"utf8"},function(t,e){n(t?new Error(t):e)}):n(null)})},y.prototype.saveDatabase=function(e,t,r){var n=this,i=e+"~";this.fs.writeFile(i,t,function(t){t?r(new Error(t)):n.fs.rename(i,e,r)})},y.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,function(t){t?e(new Error(t)):e()})},v.prototype.loadDatabase=function(t,e){i()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},v.prototype.saveDatabase=function(t,e,r){i()?(localStorage.setItem(t,e),r(null)):r(new Error("localStorage is not available"))},v.prototype.deleteDatabase=function(t,e){i()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},u.prototype.throttledSaveDrain=function(t,e){var r=this,n=(new Date).getTime();this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending?e.recursiveWait?this.throttledCallbacks.push(function(){return r.throttledSavePending?e.recursiveWaitLimit&&n-e.started>e.recursiveWaitLimitDuration?void t(!1):void r.throttledSaveDrain(t,e):void t(!0)}):this.throttledCallbacks.push(t):t(!0)},u.prototype.loadDatabaseInternal=function(r,t){var n=t||function(t,e){if(t)throw t},i=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(t){if("string"==typeof t){var e=!1;try{i.loadJSON(t,r||{}),e=!0}catch(t){n(t)}e&&(n(null),i.emit("loaded","database "+i.filename+" loaded"))}else{if(t)return t instanceof Error?void n(t):"object"==typeof t?(i.loadJSONObject(t,r||{}),n(null),void i.emit("loaded","database "+i.filename+" loaded")):void n("unexpected adapter response : "+t);n(null),void i.emit("loaded","empty database "+i.filename+" loaded")}}):n(new Error("persistenceAdapter not configured"))},u.prototype.loadDatabase=function(e,r){var n=this;this.throttledSaves?this.throttledSaveDrain(function(t){if(t)return n.throttledSavePending=!0,void n.loadDatabaseInternal(e,function(t){0===n.throttledCallbacks.length?n.throttledSavePending=!1:n.saveDatabase(),"function"==typeof r&&r(t)});"function"==typeof r&&r(new Error("Unable to pause save throttling long enough to read database"))},e):this.loadDatabaseInternal(e,r)},u.prototype.saveDatabaseInternal=function(t){var r,e=t||function(t){if(t)throw t},n=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,function(){var t;if(n.ignoreAutosave=!1,!r)return t=n.copy({removeNonSerializable:!0}),r=n.collections.map(function(t){return[t.dirty,t.dirtyIds]}),n.collections.forEach(function(t){t.dirty=!1,t.dirtyIds=[]}),t;e(new Error("adapter error - getLokiCopy called more than once"))},function(t){n.ignoreAutosave=!1,t&&r&&n.collections.forEach(function(t,e){e=r[e];t.dirty=t.dirty||e[0],t.dirtyIds=t.dirtyIds.concat(e[1])}),e(t)})):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(t){n.autosaveClearFlags(),e(t)}):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),function(t){e(t)})):e(new Error("persistenceAdapter not configured"))},u.prototype.save=u.prototype.saveDatabase=function(t){var r,n;this.throttledSaves?this.throttledSavePending?this.throttledCallbacks.push(t):(r=this.throttledCallbacks,this.throttledCallbacks=[],r.unshift(t),this.throttledSavePending=!0,(n=this).saveDatabaseInternal(function(e){n.throttledSavePending=!1,r.forEach(function(t){"function"==typeof t&&setTimeout(function(){t(e)},1)}),0<n.throttledCallbacks.length&&n.saveDatabase()})):this.saveDatabaseInternal(t)},u.prototype.deleteDatabase=function(t,e){var r="function"!=typeof t||e?e||function(t,e){if(t)throw t}:t;null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(t){r(t)}):r(new Error("persistenceAdapter not configured"))},u.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},u.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},u.prototype.autosaveEnable=function(t,e){this.autosave=!0;var r=5e3,n=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(r=this.autosaveInterval),this.autosaveHandle=setInterval(function(){n.autosaveDirty()&&!n.ignoreAutosave&&n.saveDatabase(e)},r)},u.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},g.prototype.reset=function(){return 0<this.filteredrows.length&&(this.filteredrows=[]),this.filterInitialized=!1,this},g.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},g.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new g(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},g.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new g(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},g.prototype.branch=g.prototype.copy=function(){var t=new g(this.collection);return 0<this.filteredrows.length&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},g.prototype.transform=function(t,e){var r,n,i=this;if("object"!=typeof(t="string"==typeof t&&this.collection.transforms.hasOwnProperty(t)?this.collection.transforms[t]:t)||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==e&&(t=O.resolveTransformParams(t,e)),r=0;r<t.length;r++)switch((n=t[r]).type){case"find":i.find(n.value);break;case"where":i.where(n.value);break;case"simplesort":i.simplesort(n.property,n.desc||n.options);break;case"compoundsort":i.compoundsort(n.value);break;case"sort":i.sort(n.value);break;case"limit":i=i.limit(n.value);break;case"offset":i=i.offset(n.value);break;case"map":i=i.map(n.value,n.dataOptions);break;case"eqJoin":i=i.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":i=i.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":i.update(n.value);break;case"remove":i.remove()}return i},g.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var r,n;r=t,n=this.collection.data;return this.filteredrows.sort(function(t,e){return r(n[t],n[e])}),this},g.prototype.simplesort=function(r,t){var e=10,n=this.collection.data.length,i=this.filteredrows.length,o=this.collection.binaryIndices.hasOwnProperty(r);if(!0===(t=void 0!==t&&!1!==t?t:{desc:!1})&&(t={desc:!0}),0===i){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(r))return this.collection.ensureIndex(r),this.filteredrows=this.collection.binaryIndices[r].values.slice(0),t.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!t.disableIndexIntersect&&o&&(n/i<=(e=t.useJavascriptSorting?6:e)||t.forceIndexIntersect)){for(var s=this.filteredrows,a={},c=0;c<i;c++)a[s[c]]=!0;o=this.collection.binaryIndices[r].values;return this.filteredrows=o.filter(function(t){return a[t]}),t.desc&&this.filteredrows.reverse(),this}if(t.useJavascriptSorting)return this.sort(function(t,e){return t[r]===e[r]?0:t[r]>e[r]?1:t[r]<e[r]?-1:void 0});var u,l,f,h,p;u=r,l=t.desc,f=this.collection.data;return this.filteredrows.sort(function(t,e){return p=~u.indexOf(".")?(p=u.split("."),h=O.getIn(f[t],p,!0),O.getIn(f[e],p,!0)):(h=f[t][u],f[e][u]),d(h,p,l)}),this},g.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var r=0,n=t.length;r<n;r+=1)e=t[r],Array.isArray(e)||(t[r]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var f,h;f=t,h=this.collection.data;return this.filteredrows.sort(function(t,e){for(var r,n,i,o,s=f,a=h[t],c=h[e],u=0,l=s.length;u<l;u++)if(i=~(o=(r=s[u])[0]).indexOf(".")?(i=o.split("."),n=O.getIn(a,i,!0),O.getIn(c,i,!0)):(n=a[o],c[o]),0!==(o=d(n,i,r[1])))return o;return 0}),this},g.prototype.$or=g.prototype.findOr=function(t){for(var e,r,n,i=0,o=[],s=[],a=(this.count(),0),c=t.length;a<c;a++)for(r=(e=this.branch().find(t[a]).filteredrows).length,i=0;i<r;i++)void 0===s[n=e[i]]&&(s[n]=!0,o.push(n));return this.filteredrows=o,this.filterInitialized=!0,this},g.prototype.$and=g.prototype.findAnd=function(t){for(var e=0,r=t.length;e<r;e++){if(0===this.count())return this;this.find(t[e])}return this},g.prototype.find=function(t,e){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var r,n,i,o,s,a,c,u=t||"getAll",t=!1,l=[],f=[],h=null;if(e=e||!1,"object"==typeof u){for(r in u)(o={})[r]=u[r],f.push(o),I.call(u,r)&&(n=r,i=u[r]);if(1<f.length)return this.find({$and:f},e)}if(!n||"getAll"===u)return e&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=0<this.collection.data.length?[0]:[],this.filterInitialized=!0)),this;if("$and"===n||"$or"===n)return this[n](i),e&&1<this.filteredrows.length&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===i||"object"!=typeof i||i instanceof Date)s="$eq",a=i;else{if("object"!=typeof i)throw new Error("Do not know what you want to do.");for(c in i)if(I.call(i,c)){a=i[s=c];break}}"$regex"!==s&&"object"!=typeof a||(a=function t(e,r){if("$regex"===e)Array.isArray(r)?r=new RegExp(r[0],r[1]):r instanceof RegExp||(r=new RegExp(r));else if("object"==typeof r)for(var n in r)"$regex"!==n&&"object"!=typeof r[n]||(r[n]=t(n,r[n]));return r}(s,a));var p=-1!==n.indexOf(".");!this.filterInitialized&&this.collection.binaryIndices[n]&&x[s]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(n),t=!0,h=this.collection.binaryIndices[n]),!t&&"$in"===s&&Array.isArray(a)&&"undefined"!=typeof Set&&(a=new Set(a),s="$inSet");var d,y,v=A[s],g=this.collection.data,b=0,m=0,w=0;if(this.filterInitialized){if(m=(d=this.filteredrows).length,p){for(n=n.split("."),b=0;b<m;b++)if(P(y=g[w=d[b]],n,v,a,y)&&(l.push(w),e))return this.filteredrows=l,this}else for(b=0;b<m;b++)if(v((y=g[w=d[b]])[n],a,y)&&(l.push(w),e))return this.filteredrows=l,this}else if(t){var S=this.collection.calculateRange(s,n,a);if("$in"!==s){for(b=S[0];b<=S[1];b++)if(!0!==x[s]){if(x[s](O.getIn(g[h.values[b]],n,p),a)&&(l.push(h.values[b]),e))return this.filteredrows=l,this.filterInitialized=!0,this}else if(l.push(h.values[b]),e)return this.filteredrows=l,this.filterInitialized=!0,this}else for(b=0,m=S.length;b<m;b++)if(l.push(h.values[S[b]]),e)return this.filteredrows=l,this.filterInitialized=!0,this}else if(m=g.length,p){for(n=n.split("."),b=0;b<m;b++)if(P(y=g[b],n,v,a,y)&&(l.push(b),e))return this.filteredrows=l,this.filterInitialized=!0,this}else for(b=0;b<m;b++)if(v((y=g[b])[n],a,y)&&(l.push(b),e))return this.filteredrows=l,this.filterInitialized=!0,this;return this.filteredrows=l,this.filterInitialized=!0,this},g.prototype.where=function(t){var e,r=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var n=this.filteredrows.length;n--;)!0===e(this.collection.data[this.filteredrows[n]])&&r.push(this.filteredrows[n]);return this.filteredrows=r,this}for(var i=this.collection.data.length;i--;)!0===e(this.collection.data[i])&&r.push(i);return this.filteredrows=r,this.filterInitialized=!0,this}catch(t){throw t}},g.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},g.prototype.data=function(t){var e,r,n,i=[],o=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(a=o.length,n=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<a;r++)e=h(o[r],n),t.removeMeta&&(delete e.$loki,delete e.meta),i.push(e);return i}return o.slice()}this.filterInitialized=!0}var s=this.filteredrows,a=s.length;if(this.collection.cloneObjects||t.forceClones)for(n=t.forceCloneMethod||this.collection.cloneMethod,r=0;r<a;r++)e=h(o[s[r]],n),t.removeMeta&&(delete e.$loki,delete e.meta),i.push(e);else for(r=0;r<a;r++)i.push(o[s[r]]);return i},g.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,r=this.filteredrows.length,n=this.collection.data,i=0;i<r;i++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(t(n[this.filteredrows[i]]),this.collection.update(n[this.filteredrows[i]])):(t(e=h(n[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(e));return this},g.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},g.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},g.prototype.eqJoin=function(t,e,r,n,i){var o,s,a=[],c=[],u="function"==typeof e,l="function"==typeof r,f={},h=(s=this.data(i)).length;if(t instanceof w)a=t.chain().data(i);else if(t instanceof g)a=t.data(i);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");a=t}for(var p=a.length,d=0;d<p;d++)f[o=l?r(a[d]):a[d][r]]=a[d];n=n||function(t,e){return{left:t,right:e}};for(var y=0;y<h;y++)o=u?e(s[y]):s[y][e],c.push(n(s[y],f[o]||{}));return this.collection=new w("joinData"),this.collection.insert(c),this.filteredrows=[],this.filterInitialized=!1,this},g.prototype.map=function(t,e){e=this.data(e).map(t);return this.collection=new w("mappedData"),this.collection.insert(e),this.filteredrows=[],this.filterInitialized=!1,this},((m.prototype=new c).constructor=m).prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},m.prototype.rematerialize=function(t){t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new g(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var e,r,n,i=Object.isFrozen(this.filterPipeline);if(t.hasOwnProperty("removeWhereFilters"))for(i&&(this.filterPipeline=this.filterPipeline.slice()),r=e=this.filterPipeline.length;r--;)"where"===this.filterPipeline[r].type&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var o=this.filterPipeline;for(this.filterPipeline=[],e=o.length,n=0;n<e;n++)this.applyFind(o[n].val,o[n].uid);return i&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},m.prototype.branchResultset=function(t,e){var r=this.resultset.branch();return void 0===t?r:r.transform(t,e)},m.prototype.toJSON=function(){var t=new m(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},m.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var e=Object.isFrozen(this.filterPipeline),r=0<this.filterPipeline.length;this.filterPipeline=[],e&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,!(this.sortDirty=!1)===t.queueSortPhase&&this.queueSortPhase(),r&&this.emit("filter")},m.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},m.prototype.applySimpleSort=function(t,e){return this.sortCriteriaSimple={propname:t,options:e||!1},this.collection.disableFreeze||p(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},m.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.collection.disableFreeze||p(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},m.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},m.prototype.commit=function(){return this.cachedresultset=null,this},m.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},m.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,r=this.filterPipeline.length;e<r;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},m.prototype._addFilter=function(t){var e=Object.isFrozen(this.filterPipeline);e&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||p(t),this.filterPipeline.push(t),e&&Object.freeze(this.filterPipeline),this.resultset[t.type](t.val)},m.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline,e=Object.isFrozen(t);this.filterPipeline=[];for(var r=0,n=t.length;r<n;r+=1)this._addFilter(t[r]);return e&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},m.prototype.applyFilter=function(t){var e,r=this._indexOfFilterWithId(t.uid);return 0<=r?((e=Object.isFrozen(this.filterPipeline))&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[r]=t,e&&(s(t),Object.freeze(this.filterPipeline)),this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this)},m.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},m.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},m.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);t=Object.isFrozen(this.filterPipeline);return t&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(e,1),t&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},m.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},m.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},m.prototype.queueRebuildEvent=function(){var t;this.rebuildPending||(this.rebuildPending=!0,t=this,setTimeout(function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))},this.options.minRebuildInterval))},m.prototype.queueSortPhase=function(){var t;this.sortDirty||(this.sortDirty=!0,"active"===(t=this).options.sortPriority?setTimeout(function(){t.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent())},m.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},m.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var r,n=this.resultset.filteredrows,e=e?-1:n.indexOf(+t),i=n.length,o=new g(this.collection);o.filteredrows=[t],o.filterInitialized=!0;for(var s=0,a=this.filterPipeline.length;s<a;s++)o[(r=this.filterPipeline[s]).type](r.val);var c=0===o.filteredrows.length?-1:0;return-1!==e||-1!=c?-1===e&&-1!=c?(n.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==e&&-1==c?(e<i-1?(n.splice(e,1),this.options.persistent&&this.resultdata.splice(e,1)):(n.length=i-1,this.options.persistent&&(this.resultdata.length=i-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==e&&-1!=c?(this.options.persistent&&(this.resultdata[e]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},m.prototype.removeDocument=function(t){var e,r,n,i={},o={},s=this.resultset,a=this.resultset.filteredrows,c=a.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(r=(t=Array.isArray(t)?t:[t]).length,e=0;e<r;e++)i[t[e]]=!0;for(u=0;u<c;u++)i[a[u]]&&(o[u]=!0);0<Object.keys(o).length&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(t,e){return!o[e]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(t,e){return!o[e]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(var c=s.filteredrows.length,u=0;u<c;u++)n=t.filter(function(e){return function(t){return t<s.filteredrows[e]}}(u)),s.filteredrows[u]-=n.length},m.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},((w.prototype=new c).contructor=w).prototype.createChange=function(t,e,r,n){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(r)):this.getChangeDelta(r,n)})},w.prototype.insertMeta=function(t){var e,r;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,r=0;r<e;r++)t[r].hasOwnProperty("meta")||(t[r].meta={}),t[r].meta.created=(new Date).getTime(),t[r].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},w.prototype.updateMeta=function(t){return!this.disableMeta&&t&&(this.disableFreeze||((t=a(t)).meta=a(t.meta)),t.meta.updated=(new Date).getTime(),t.meta.revision+=1),t},w.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},w.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},w.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},w.prototype.updateMetaWithChange=function(t,e,r){return t=this.updateMeta(t,r),this.createUpdateChange(t,e),t},w.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},w.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},w.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},w.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},w.prototype.getTransform=function(t){return this.transforms[t]},w.prototype.setTransform=function(t,e){this.transforms[t]=e},w.prototype.removeTransform=function(t){delete this.transforms[t]},w.prototype.byExample=function(t){var e,r,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(((r={})[e]=t[e],r));return{$and:n}},w.prototype.findObject=function(t){return this.findOne(this.byExample(t))},w.prototype.findObjects=function(t){return this.find(this.byExample(t))},w.prototype.ttlDaemonFuncGen=function(){var t=this,r=this.ttl.age;return function(){var e=Date.now();t.chain().where(function(t){t=t.meta.updated||t.meta.created;return r<e-t}).remove()}},w.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},w.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),r=0;r<t;r+=1)e[r]=r;return e},w.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},w.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null==t)throw new Error("Attempting to set index without an associated property");var r,n,i,o,s;this.binaryIndices[t]&&!e&&!this.binaryIndices[t].dirty||!0===this.adaptiveBinaryIndices&&this.binaryIndices.hasOwnProperty(t)&&!e||(e={name:t,dirty:!0,values:this.prepareFullDocIndex()},this.binaryIndices[t]=e,r=t,n=this.data,s=!!~r.indexOf(".")&&r.split("."),e.values.sort(function(t,e){if(o=s?(i=O.getIn(n[t],s,!0),O.getIn(n[e],s,!0)):(i=n[t][r],n[e][r]),i!==o){if(b.lt(i,o,!1))return-1;if(b.gt(i,o,!1))return 1}return 0}),e.dirty=!1,this.dirty=!0)},w.prototype.checkAllIndexes=function(t){var e,r=this.binaryIndices,n=[];for(e in r)!I.call(r,e)||this.checkIndex(e,t)||n.push(e);return n},w.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||1<e.randomSamplingFactor)&&(e.randomSamplingFactor=.1);var r,n,i,o,s,a=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),(o=(s=this.binaryIndices[t].values).length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===o)return!0;var c=-1!==t.indexOf(".");if(1===o)a=0===s[0];else if(e.randomSampling){if(A.$lte(O.getIn(this.data[s[0]],t,c),O.getIn(this.data[s[1]],t,c))||(a=!1),a=A.$lte(O.getIn(this.data[s[o-2]],t,c),O.getIn(this.data[s[o-1]],t,c))?a:!1)for(n=Math.floor((o-1)*e.randomSamplingFactor),r=0;r<n-1;r++)if(i=Math.floor(Math.random()*(o-1)),!A.$lte(O.getIn(this.data[s[i]],t,c),O.getIn(this.data[s[i+1]],t,c))){a=!1;break}}else for(r=0;r<o-1;r++)if(!A.$lte(O.getIn(this.data[s[r]],t,c),O.getIn(this.data[s[r+1]],t,c))){a=!1;break}return!a&&e.repair&&this.ensureIndex(t,!0),a},w.prototype.getBinaryIndexValues=function(t){for(var e=this.binaryIndices[t].values,r=[],n=0;n<e.length;n++)r.push(O.getIn(this.data[e[n]],t,!0));return r},w.prototype.getUniqueIndex=function(t,e){var r=this.constraints.unique[t];return!r&&e?this.ensureUniqueIndex(t):r},w.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new L(t),this.data.forEach(function(t){e.set(t)}),e},w.prototype.ensureAllIndexes=function(t){var e,r=this.binaryIndices;for(e in r)I.call(r,e)&&this.ensureIndex(e,t)},w.prototype.flagBinaryIndexesDirty=function(){var t,e=this.binaryIndices;for(t in e)I.call(e,t)&&(e[t].dirty=!0)},w.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},w.prototype.count=function(t){return(t?this.chain().find(t).filteredrows:this.data).length},w.prototype.ensureId=function(){if(!this.idIndex){for(var t=this.data,e=0,r=t.length,n=new Array(r);e<r;e++)n[e]=t[e].$loki;this.idIndex=n}},w.prototype.ensureIdAsync=function(t){this.async(function(){this.ensureId()},t)},w.prototype.addDynamicView=function(t,e){t=new m(this,t,e);return this.DynamicViews.push(t),t},w.prototype.removeDynamicView=function(e){this.DynamicViews=this.DynamicViews.filter(function(t){return t.name!==e})},w.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},w.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},w.prototype.findAndRemove=function(t){this.chain().find(t).remove()},w.prototype.insert=function(t,e){if(!Array.isArray(t))return this.insertOne(t);var r,n=[],e=e&&!this.cloneObjects&&this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length;e&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",t);for(var i=0,o=t.length;i<o;i++){if(!(r=this.insertOne(t[i],!0)))return;n.push(r)}}finally{e&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",n),1===(n=this.cloneObjects?h(n,this.cloneMethod):n).length?n[0]:n},w.prototype.insertOne=function(t,e){var r=null;if("object"!=typeof t?r=new TypeError("Document needs to be an object"):null===t&&(r=new TypeError("Object cannot be null")),null!==r)throw this.emit("error",r),r;r=this.cloneObjects?h(t,this.cloneMethod):t;if(this.disableFreeze||(r=a(r)),this.disableMeta||(void 0===r.meta?r.meta={revision:0,created:0}:this.disableFreeze||(r.meta=a(r.meta))),e||this.emit("pre-insert",r),this.add(r))return this.disableChangesApi?this.insertMeta(r):this.insertMetaWithChange(r),this.disableFreeze||p(r),t=this.cloneObjects?h(r,this.cloneMethod):r,e||this.emit("insert",t),this.addAutoUpdateObserver(t),t},w.prototype.clear=function(t){var e=this;t=t||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===t.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach(function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]})},w.prototype.update=function(t){var e,r,n;if(Array.isArray(t)){n=t.length,(e=!this.cloneObjects&&this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length)&&(this.adaptiveBinaryIndices=!1);try{for(r=0;r<n;r+=1)this.update(t[r])}finally{e&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!I.call(t,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var i,o,s,a,c,u=this.get(t.$loki,!0),l=this;if(!u)throw new Error("Trying to update a document not in collection.");i=u[0],s=u[1],o=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?h(t,this.cloneMethod):t,this.emit("pre-update",t),this.uniqueNames.forEach(function(t){l.getUniqueIndex(t,!0).update(i,o)}),(this.data[s]=o)!==t&&this.addAutoUpdateObserver(t);for(var f=0;f<this.DynamicViews.length;f++)this.DynamicViews[f].evaluateDocument(s,!1);if(this.adaptiveBinaryIndices)for(a in this.binaryIndices)this.adaptiveBinaryIndexUpdate(s,a);else this.flagBinaryIndexesDirty();return this.idIndex[s]=o.$loki,this.isIncremental&&this.dirtyIds.push(o.$loki),this.commit(),this.dirty=!0,o=this.disableChangesApi?this.updateMeta(o):this.updateMetaWithChange(o,i),this.disableFreeze||p(o),c=this.cloneObjects?h(o,this.cloneMethod):o,this.emit("update",c,i),c}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}}},w.prototype.add=function(t){if("object"!=typeof t)throw new TypeError("Object being added needs to be an object");if(void 0!==t.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var e=this.maxId;t.$loki=e,this.disableMeta||(t.meta.version=0);for(var r=0,n=this.uniqueNames.length;r<n;r++)this.getUniqueIndex(this.uniqueNames[r],!0).set(t);this.idIndex&&this.idIndex.push(e),this.isIncremental&&this.dirtyIds.push(e),this.data.push(t);for(var i,o=this.data.length-1,s=this.DynamicViews.length,r=0;r<s;r++)this.DynamicViews[r].evaluateDocument(o,!0);if(this.adaptiveBinaryIndices)for(i in this.binaryIndices)this.adaptiveBinaryIndexInsert(o,i);else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?h(t,this.cloneMethod):t}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}},w.prototype.updateWhere=function(t,e){var r,n=this.where(t),i=0;try{for(;i<n.length;i++)r=e(n[i]),this.update(r)}catch(t){this.rollback(),this.lokiConsoleWrapper.error(t.message)}},w.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},w.prototype.removeDataOnly=function(){this.remove(this.data.slice())},w.prototype.removeBatchByPositions=function(r){var t,e,n,i,o,s=r.length,a={},c=Object.keys(this.binaryIndices).length,u=Object.keys(this.constraints.unique).length,l=this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length,f=this;try{for(this.startTransaction(),this.ensureId(),n=0;n<s;n++)a[this.idIndex[r[n]]]=!0;if(0<(t=this.DynamicViews.length)||0<c||0<u){if(0<t)for(e=0;e<t;e++)this.DynamicViews[e].removeDocument(r);if(this.adaptiveBinaryIndices&&!l)for(o in this.binaryIndices)this.adaptiveBinaryIndexRemove(r,o);else this.flagBinaryIndexesDirty();u&&this.uniqueNames.forEach(function(t){var e=f.getUniqueIndex(t);if(e)for(n=0;n<s;n++)null!==(i=f.data[r[n]])[t]&&void 0!==i[t]&&e.remove(i[t])})}if(!this.disableChangesApi||1<this.events.delete.length)for(n=0;n<s;n++)this.emit("delete",this.data[r[n]]);if(this.data=this.data.filter(function(t){return!a[t.$loki]}),this.isIncremental)for(n=0;n<s;n++)this.dirtyIds.push(this.idIndex[r[n]]);this.idIndex=this.idIndex.filter(function(t){return!a[t]}),this.adaptiveBinaryIndices&&l&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(r){return this.rollback(),l&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(r.message),this.emit("error",r),null}},w.prototype.removeBatch=function(t){for(var e=t.length,r=this.data.length,n={},i=[],o=0;o<r;o++)n[this.data[o].$loki]=o;for(o=0;o<e;o++)"object"==typeof t[o]?i.push(n[t[o].$loki]):i.push(n[t[o]]);this.removeBatchByPositions(i)},w.prototype.remove=function(r){if("object"!=typeof(r="number"==typeof r?this.get(r):r))throw new Error("Parameter is not an object");if(Array.isArray(r))this.removeBatch(r);else{if(!I.call(r,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var t=this.get(r.$loki,!0),e=t[1],n=this;this.uniqueNames.forEach(function(t){var e;null!==r[t]&&void 0!==r[t]&&(e=n.getUniqueIndex(t))&&e.remove(r[t])});for(var i,o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(e);if(this.adaptiveBinaryIndices)for(i in this.binaryIndices)this.adaptiveBinaryIndexRemove(e,i);else this.flagBinaryIndexesDirty();return this.data.splice(e,1),this.removeAutoUpdateObserver(r),this.idIndex.splice(e,1),this.isIncremental&&this.dirtyIds.push(r.$loki),this.commit(),this.dirty=!0,this.emit("delete",t[0]),delete(r=this.disableFreeze?r:a(r)).$loki,delete r.meta,this.disableFreeze||s(r),r}catch(t){return this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),null}}},w.prototype.get=function(t,e){this.idIndex||this.ensureId();var r,e=e||!1,n=this.idIndex,i=n.length-1,o=0;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;n[o]<n[i];)n[r=o+i>>1]<t?o=1+r:i=r;return i===o&&n[o]===t?e?[this.data[o],o]:this.data[o]:null},w.prototype.getBinaryIndexPosition=function(t,e){var r=O.getIn(this.data[t],e,!0),n=this.binaryIndices[e].values,e=this.calculateRange("$eq",e,r);if(0===e[0]&&-1===e[1])return null;for(var r=e[0],i=e[1],o=r;o<=i;o++)if(n[o]===t)return o;return null},w.prototype.adaptiveBinaryIndexInsert=function(t,e){var r=-1!==e.indexOf("."),n=this.binaryIndices[e].values,i=O.getIn(this.data[t],e,r),n=(!0===this.serializableIndices&&i instanceof Date&&(this.data[t][e]=i.getTime(),i=O.getIn(this.data[t],e)),0===n.length?0:this.calculateRangeStart(e,i,!0,r));this.binaryIndices[e].values.splice(n,0,t)},w.prototype.adaptiveBinaryIndexUpdate=function(t,e){for(var r=this.binaryIndices[e].values,n=r.length,i=0;i<n&&r[i]!==t;i++);this.binaryIndices[e].values.splice(i,1),this.adaptiveBinaryIndexInsert(t,e)},w.prototype.adaptiveBinaryIndexRemove=function(t,e,r){var n,i,o,s,a,c,u=this.binaryIndices[e],l={};if(Array.isArray(t)){if(1!==(s=t.length)){for(o=0;o<s;o++)l[t[o]]=!0;if(u.values=u.values.filter(function(t){return!l[t]}),!0===r)return;var f=t.slice();for(f.sort(function(t,e){return t-e}),n=u.values.length,i=0;i<n;i++){for(a=u.values[i],o=c=0;o<s&&a>f[o];o++)c++;u.values[i]-=c}return}t=t[0]}if(null===(e=this.getBinaryIndexPosition(t,e)))return null;if(u.values.splice(e,1),!0!==r)for(n=u.values.length,i=0;i<n;i++)u.values[i]>t&&u.values[i]--},w.prototype.calculateRangeStart=function(t,e,r,n){var i,o=this.data,s=this.binaryIndices[t].values,a=0,c=s.length-1;if(0===s.length)return-1;for(O.getIn(o[s[a]],t,n),O.getIn(o[s[c]],t,n);a<c;)b.lt(O.getIn(o[s[i=a+c>>1]],t,n),e,!1)?a=1+i:c=i;var u=a;return b.aeq(e,O.getIn(o[s[u]],t,n))?u:b.lt(e,O.getIn(o[s[u]],t,n),!1)?r?u:u-1:r?u+1:u},w.prototype.calculateRangeEnd=function(t,e,r){var n,i=this.data,o=this.binaryIndices[t].values,s=0,a=o.length-1;if(0===o.length)return-1;for(O.getIn(i[o[s]],t,r),O.getIn(i[o[a]],t,r);s<a;)b.lt(e,O.getIn(i[o[n=s+a>>1]],t,r),!1)?a=n:s=1+n;var c=a;return b.aeq(e,O.getIn(i[o[c]],t,r))?c:b.gt(e,O.getIn(i[o[c]],t,r),!1)?c+1:b.aeq(e,O.getIn(i[o[c-1]],t,r))?c-1:c},w.prototype.calculateRange=function(t,e,r){var n,i,o,s=this.data,a=this.binaryIndices[e].values,c=a.length-1;if(0===s.length)return[0,-1];var u=-1!==e.indexOf("."),l=O.getIn(s[a[0]],e,u),f=O.getIn(s[a[c]],e,u);switch(t){case"$eq":case"$aeq":case"$dteq":if(b.lt(r,l,!1)||b.gt(r,f,!1))return[0,-1];break;case"$gt":if(b.gt(r,f,!0))return[0,-1];if(b.gt(l,r,!1))return[0,c];break;case"$gte":if(b.gt(r,f,!1))return[0,-1];if(b.gt(l,r,!0))return[0,c];break;case"$lt":if(b.lt(r,l,!0))return[0,-1];if(b.lt(f,r,!1))return[0,c];break;case"$lte":if(b.lt(r,l,!1))return[0,-1];if(b.lt(f,r,!0))return[0,c];break;case"$between":return b.gt(r[0],f,!1)||b.lt(r[1],l,!1)?[0,-1]:((n=this.calculateRangeStart(e,r[0],!1,u))<0&&n++,(o=this.calculateRangeEnd(e,r[1],u))>c&&o--,b.gt(O.getIn(s[a[n]],e,u),r[0],!0)||n++,b.lt(O.getIn(s[a[o]],e,u),r[1],!0)||o--,o<n?[0,-1]:[n,o]);case"$in":for(var h=[],p=[],d=0,y=r.length;d<y;d++)for(var v=this.calculateRange("$eq",e,r[d]),g=v[0];g<=v[1];g++)void 0===h[g]&&(h[g]=!0,p.push(g));return p}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":n=this.calculateRangeStart(e,r,!1,u),i=O.getIn(s[a[n]],e,u)}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":o=this.calculateRangeEnd(e,r,u),O.getIn(s[a[o]],e,u)}switch(t){case"$eq":case"$aeq":case"$dteq":return b.aeq(i,r)?[n,o]:[0,-1];case"$gt":return b.aeq(O.getIn(s[a[o]],e,u),r)?[o+1,c]:[o,c];case"$gte":return b.aeq(O.getIn(s[a[n]],e,u),r)?[n,c]:[n+1,c];case"$lt":return b.aeq(O.getIn(s[a[n]],e,u),r)?[0,n-1]:[0,n];case"$lte":return b.aeq(O.getIn(s[a[o]],e,u),r)?[0,o]:[0,o-1];default:return[0,s.length-1]}},w.prototype.by=function(e,t){var r;if(void 0===t)return r=this,function(t){return r.by(e,t)};t=this.getUniqueIndex(e,!0).get(t);return this.cloneObjects?h(t,this.cloneMethod):t},w.prototype.findOne=function(t){t=t||{};t=this.chain().find(t,!0).data();return Array.isArray(t)&&0===t.length?null:this.cloneObjects?h(t[0],this.cloneMethod):t[0]},w.prototype.chain=function(t,e){var r=new g(this);return void 0===t?r:r.transform(t,e)},w.prototype.find=function(t){return this.chain().find(t).data()},w.prototype.findOneUnindexed=function(t,e){for(var r=this.data.length;r--;)if(O.getIn(this.data[r],t,!0)===e)return this.data[r];return null},w.prototype.startTransaction=function(){if(this.transactional){this.cachedData=h(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},w.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},w.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},w.prototype.async=function(t,e){setTimeout(function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()},0)},w.prototype.where=function(t){return this.chain().where(t).data()},w.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},w.prototype.eqJoin=function(t,e,r,n,i){return new g(this).eqJoin(t,e,r,n,i)},w.prototype.stages={},w.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},w.prototype.commitLog=[],w.prototype.stage=function(t,e){var r=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=r},w.prototype.commitStage=function(t,e){var r,n=this.getStage(t),i=(new Date).getTime();for(r in n)this.update(n[r]),this.commitLog.push({timestamp:i,message:e,data:JSON.parse(JSON.stringify(n[r]))});this.stages[t]={}},w.prototype.no_op=function(){},w.prototype.extract=function(t){for(var e=0,r=this.data.length,n=S(t),i=[];e<r;e+=1)i.push(E(this.data[e],t,n));return i},w.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},w.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},w.prototype.maxRecord=function(t){for(var e,r=0,n=this.data.length,i=S(t),o={index:0,value:void 0};r<n;r+=1)(void 0===e||e<E(this.data[r],t,i))&&(e=E(this.data[r],t,i),o.index=this.data[r].$loki);return o.value=e,o},w.prototype.minRecord=function(t){for(var e,r=0,n=this.data.length,i=S(t),o={index:0,value:void 0};r<n;r+=1)(void 0===e||e>E(this.data[r],t,i))&&(e=E(this.data[r],t,i),o.index=this.data[r].$loki);return o.value=e,o},w.prototype.extractNumerical=function(t){return this.extract(t).map(k).filter(Number).filter(function(t){return!isNaN(t)})},w.prototype.avg=function(t){return _(this.extractNumerical(t))},w.prototype.stdDev=function(t){return t=this.extractNumerical(t),e=_(t),t=_(t.map(function(t){t-=e;return t*t})),Math.sqrt(t);var e},w.prototype.mode=function(t){var e,r,n,i={};for(r in this.extract(t).forEach(function(t){i[t]?i[t]+=1:i[t]=1}),i)e?e<i[r]&&(n=r):(n=r,e=i[r]);return n},w.prototype.median=function(t){var t=this.extractNumerical(t),e=(t.sort(B),Math.floor(t.length/2));return t.length%2?t[e]:(t[e-1]+t[e])/2},M.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:e<t?1:0},setSort:function(t){this.bs=new D(t)},bs:function(){return new D(this.sort)},set:function(t,e){var r=this.bs(this.keys,t);r.found?this.values[r.index]=e:(this.keys.splice(r.index,0,t),this.values.splice(r.index,0,e))},get:function(t){return this.values[C(this.keys,t,this.sort).index]}},L.prototype.keyMap={},L.prototype.lokiMap={},L.prototype.set=function(t){var e=t[this.field];if(null!=e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},L.prototype.get=function(t){return this.keyMap[t]},L.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},L.prototype.update=function(t,e){var r;this.lokiMap[t.$loki]!==e[this.field]?(r=this.lokiMap[t.$loki],this.set(e),this.keyMap[r]=void 0):this.keyMap[t[this.field]]=e},L.prototype.remove=function(t){var e=this.keyMap[t];if(null==e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},L.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},N.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var r,n=this.index[t];for(r in n)n[r]==e&&n.splice(r,1);n.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},u.deepFreeze=p,u.freeze=s,u.unFreeze=a,u.LokiOps=A,u.Collection=w,u.DynamicView=m,u.Resultset=g,u.KeyValueStore=M,u.LokiMemoryAdapter=l,u.LokiPartitioningAdapter=f,u.LokiLocalStorageAdapter=v,u.LokiFsAdapter=y,u.persistenceAdapters={fs:y,localStorage:v},u.aeq=t,u.lt=e,u.gt=r,u.Comparators=b,u};void 0!==(r=r.apply(e,[]))&&(t.exports=r)},1528:function(e,r){var n,i;!function(t){"use strict";"object"==typeof e.exports?e.exports=t():(i=[],void 0!==(i="function"==typeof(n=t)?n.apply(r,i):n)&&(e.exports=i))}(function(){"use strict";var e=Object.prototype.toString;function u(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function l(t){if(!t)return 1;if(h(t)&&0===t.length)return 1;if("string"!=typeof t){for(var e in t)if(u(t,e))return;return 1}}function f(t){return e.call(t)}var h=Array.isArray||function(t){return"[object Array]"===e.call(t)};function p(t){var e=parseInt(t);return e.toString()===t?e:t}function t(i){function s(r){return Object.keys(s).reduce(function(t,e){return"create"!==e&&"function"==typeof s[e]&&(t[e]=s[e].bind(s,r)),t},{})}var o,a;function r(t,e){if(o(t,e))return t[e]}function c(t,e,r,n){if(!(e="number"==typeof e?[e]:e)||0===e.length)return t;if("string"==typeof e)return c(t,e.split(".").map(p),r,n);var i=e[0],o=a(t,i);return 1===e.length?(void 0!==o&&n||(t[i]=r),o):(void 0===o&&("number"==typeof e[1]?t[i]=[]:t[i]={}),c(t[i],e.slice(1),r,n))}return o=(i=i||{}).includeInheritedProps?function(){return!0}:function(t,e){return"number"==typeof e&&Array.isArray(t)||u(t,e)},a=i.includeInheritedProps?function(t,e){t=r(t,e="string"!=typeof e&&"number"!=typeof e?String(e):e);if("__proto__"===e||"prototype"===e||"constructor"===e&&"function"==typeof t)throw new Error("For security reasons, object's magic properties cannot be set");return t}:r,s.has=function(t,e){if("number"==typeof e?e=[e]:"string"==typeof e&&(e=e.split(".")),!e||0===e.length)return!!t;for(var r=0;r<e.length;r++){var n=p(e[r]);if(!("number"==typeof n&&h(t)&&n<t.length||(i.includeInheritedProps?n in Object(t):u(t,n))))return!1;t=t[n]}return!0},s.ensureExists=function(t,e,r){return c(t,e,r,!0)},s.set=c,s.insert=function(t,e,r,n){var i=s.get(t,e);n=~~n,h(i)||s.set(t,e,i=[]),i.splice(n,0,r)},s.empty=function(t,e){var r,n;if(!l(e)&&null!=t&&(r=s.get(t,e))){if("string"==typeof r)return s.set(t,e,"");if("boolean"==typeof r||"[object Boolean]"===f(r))return s.set(t,e,!1);if("number"==typeof r)return s.set(t,e,0);if(h(r))r.length=0;else{if("object"!=typeof r||"[object Object]"!==f(r))return s.set(t,e,null);for(n in r)o(r,n)&&delete r[n]}}},s.push=function(t,e){var r=s.get(t,e);h(r)||s.set(t,e,r=[]),r.push.apply(r,Array.prototype.slice.call(arguments,2))},s.coalesce=function(t,e,r){for(var n,i=0,o=e.length;i<o;i++)if(void 0!==(n=s.get(t,e[i])))return n;return r},s.get=function(t,e,r){if(!(e="number"==typeof e?[e]:e)||0===e.length)return t;if(null==t)return r;if("string"==typeof e)return s.get(t,e.split("."),r);var n=p(e[0]),i=a(t,n);return void 0===i?r:1===e.length?i:s.get(t[n],e.slice(1),r)},s.del=function(t,e){if(null==t)return t;if(l(e="number"==typeof e?[e]:e))return t;if("string"==typeof e)return s.del(t,e.split("."));var r=p(e[0]);return a(t,r),o(t,r)?1!==e.length?s.del(t[r],e.slice(1)):(h(t)?t.splice(r,1):delete t[r],t):t},s}var r=t();return r.create=t,r.withInheritedProps=t({includeInheritedProps:!0}),r})},1368:t=>{t.exports=function(){"use strict";var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function c(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+e[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+e[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+e[3]-1044525330|0)<<22|n>>>10)+i|0;n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+e[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+e[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+e[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+e[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+e[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+e[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+e[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+e[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+e[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+e[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+e[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+e[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+e[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+e[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+e[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+e[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+e[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+e[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+e[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+e[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+e[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+e[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+e[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+e[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+e[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+e[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+e[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+e[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+e[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+e[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+e[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+e[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+e[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+e[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+e[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+e[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+e[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+e[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+e[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+e[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+e[9]-343485551|0)<<21|n>>>11)+i|0,t[0]=r+t[0]|0,t[1]=n+t[1]|0,t[2]=i+t[2]|0,t[3]=o+t[3]|0}function u(t){for(var e=[],r=0;r<64;r+=4)e[r>>2]=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8)+(t.charCodeAt(r+2)<<16)+(t.charCodeAt(r+3)<<24);return e}function l(t){for(var e=[],r=0;r<64;r+=4)e[r>>2]=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+(t[r+3]<<24);return e}function r(t){for(var e,r,n,i,o=t.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)c(s,u(t.substring(a-64,a)));for(e=(t=t.substring(a-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<e;a+=1)r[a>>2]|=t.charCodeAt(a)<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(c(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,c(s,r),s}function s(t){for(var e=0;e<t.length;e+=1)t[e]=function(t){for(var e="",r=0;r<4;r+=1)e+=n[t>>8*r+4&15]+n[t>>8*r&15];return e}(t[e]);return t.join("")}function i(t){return t=/[\u0080-\uFFFF]/.test(t)?unescape(encodeURIComponent(t)):t}function a(t){for(var e=[],r=t.length,n=0;n<r-1;n+=2)e.push(parseInt(t.substr(n,2),16));return String.fromCharCode.apply(String,e)}function o(){this.reset()}return s(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(t,e){var r=this.byteLength,t=f(t,r),n=r;return(n=void 0!==e?f(e,r):n)<t?new ArrayBuffer(0):(e=n-t,r=new ArrayBuffer(e),n=new Uint8Array(r),t=new Uint8Array(this,t,e),n.set(t),r)}),o.prototype.append=function(t){return this.appendBinary(i(t)),this},o.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;for(var e=this._buff.length,r=64;r<=e;r+=64)c(this._hash,u(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},o.prototype.end=function(t){for(var e,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r.charCodeAt(o)<<(o%4<<3);return this._finish(i,n),e=s(this._hash),t&&(e=a(e)),this.reset(),e},o.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},o.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},o.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},o.prototype._finish=function(t,e){var r,n=e;if(t[n>>2]|=128<<(n%4<<3),55<n)for(c(this._hash,t),n=0;n<16;n+=1)t[n]=0;e=(e=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(e[2],16),e=parseInt(e[1],16)||0,t[14]=r,t[15]=e,c(this._hash,t)},o.hash=function(t,e){return o.hashBinary(i(t),e)},o.hashBinary=function(t,e){t=s(r(t));return e?a(t):t},(o.ArrayBuffer=function(){this.reset()}).prototype.append=function(t){r=this._buff.buffer,n=t,i=!0,(o=new Uint8Array(r.byteLength+n.byteLength)).set(new Uint8Array(r)),o.set(new Uint8Array(n),r.byteLength);var e,r,n,i,o,s=i?o:o.buffer,a=s.length;for(this._length+=t.byteLength,e=64;e<=a;e+=64)c(this._hash,l(s.subarray(e-64,e)));return this._buff=e-64<a?new Uint8Array(s.buffer.slice(e-64)):new Uint8Array(0),this},o.ArrayBuffer.prototype.end=function(t){for(var e,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r[o]<<(o%4<<3);return this._finish(i,n),e=s(this._hash),t&&(e=a(e)),this.reset(),e},o.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.ArrayBuffer.prototype.getState=function(){var t,e=o.prototype.getState.call(this);return e.buff=(t=e.buff,String.fromCharCode.apply(null,new Uint8Array(t))),e},o.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,e){for(var r=t.length,n=new ArrayBuffer(r),i=new Uint8Array(n),o=0;o<r;o+=1)i[o]=t.charCodeAt(o);return e?i:n}(t.buff,!0),o.prototype.setState.call(this,t)},o.ArrayBuffer.prototype.destroy=o.prototype.destroy,o.ArrayBuffer.prototype._finish=o.prototype._finish,o.ArrayBuffer.hash=function(t,e){t=s(function(t){for(var e,r,n,i,o=t.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)c(s,l(t.subarray(a-64,a)));for(e=(t=a-64<o?t.subarray(a-64):new Uint8Array(0)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<e;a+=1)r[a>>2]|=t[a]<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(c(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,c(s,r),s}(new Uint8Array(t)));return e?a(t):t},o;function f(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}}()},7462:(t,e,r)=>{var u=r(2825),l=r(7187).EventEmitter,r=r(9539),f=t.exports=function(t,n){if(!(this instanceof f))return new f(t,n);l.call(this),(n=n||{}).maxLineLength=n.maxLineLength||4096,n.retainBuffer=!!n.retainBuffer;function r(t,e){try{var r=o.slice(0,s);i.emit("line",n.retainBuffer?r:r.toString(),t,e)}catch(t){i.emit("error",t)}finally{s=0}}var i=this,o=new Buffer(n.maxLineLength),s=0,a=0,c=0;this.input="string"==typeof t?u.createReadStream(t,n):t,this.input.on("open",function(t){i.emit("open",t)}).on("data",function(t){for(var e=0;e<t.length;e++)10==t[e]||13==t[e]?10==t[e]&&r(++a,c):(o[s]=t[e],s++),c++}).on("error",function(t){i.emit("error",t)}).on("end",function(){s&&r(++a,c),i.emit("end")}).on("close",function(){i.emit("close")})};r.inherits(f,l)},8322:t=>{t.exports=function(){"use strict";var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function c(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+e[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+e[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+e[3]-1044525330|0)<<22|n>>>10)+i|0;n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+e[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+e[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+e[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+e[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+e[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+e[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+e[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+e[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+e[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+e[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+e[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+e[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+e[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+e[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+e[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+e[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+e[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+e[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+e[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+e[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+e[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+e[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+e[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+e[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+e[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+e[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+e[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+e[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+e[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+e[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+e[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+e[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+e[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+e[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+e[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+e[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+e[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+e[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+e[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+e[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+e[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+e[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+e[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+e[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+e[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+e[9]-343485551|0)<<21|n>>>11)+i|0,t[0]=r+t[0]|0,t[1]=n+t[1]|0,t[2]=i+t[2]|0,t[3]=o+t[3]|0}function u(t){for(var e=[],r=0;r<64;r+=4)e[r>>2]=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8)+(t.charCodeAt(r+2)<<16)+(t.charCodeAt(r+3)<<24);return e}function l(t){for(var e=[],r=0;r<64;r+=4)e[r>>2]=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+(t[r+3]<<24);return e}function r(t){for(var e,r,n,i,o=t.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)c(s,u(t.substring(a-64,a)));for(e=(t=t.substring(a-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<e;a+=1)r[a>>2]|=t.charCodeAt(a)<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(c(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,c(s,r),s}function s(t){for(var e=0;e<t.length;e+=1)t[e]=function(t){for(var e="",r=0;r<4;r+=1)e+=n[t>>8*r+4&15]+n[t>>8*r&15];return e}(t[e]);return t.join("")}function i(t){return t=/[\u0080-\uFFFF]/.test(t)?unescape(encodeURIComponent(t)):t}function a(t){for(var e=[],r=t.length,n=0;n<r-1;n+=2)e.push(parseInt(t.substr(n,2),16));return String.fromCharCode.apply(String,e)}function o(){this.reset()}return s(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(t,e){var r=this.byteLength,t=f(t,r),n=r;return(n=void 0!==e?f(e,r):n)<t?new ArrayBuffer(0):(e=n-t,r=new ArrayBuffer(e),n=new Uint8Array(r),t=new Uint8Array(this,t,e),n.set(t),r)}),o.prototype.append=function(t){return this.appendBinary(i(t)),this},o.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;for(var e=this._buff.length,r=64;r<=e;r+=64)c(this._hash,u(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},o.prototype.end=function(t){for(var e,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r.charCodeAt(o)<<(o%4<<3);return this._finish(i,n),e=s(this._hash),t&&(e=a(e)),this.reset(),e},o.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},o.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},o.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},o.prototype._finish=function(t,e){var r,n=e;if(t[n>>2]|=128<<(n%4<<3),55<n)for(c(this._hash,t),n=0;n<16;n+=1)t[n]=0;e=(e=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(e[2],16),e=parseInt(e[1],16)||0,t[14]=r,t[15]=e,c(this._hash,t)},o.hash=function(t,e){return o.hashBinary(i(t),e)},o.hashBinary=function(t,e){t=s(r(t));return e?a(t):t},(o.ArrayBuffer=function(){this.reset()}).prototype.append=function(t){r=this._buff.buffer,n=t,i=!0,(o=new Uint8Array(r.byteLength+n.byteLength)).set(new Uint8Array(r)),o.set(new Uint8Array(n),r.byteLength);var e,r,n,i,o,s=i?o:o.buffer,a=s.length;for(this._length+=t.byteLength,e=64;e<=a;e+=64)c(this._hash,l(s.subarray(e-64,e)));return this._buff=e-64<a?new Uint8Array(s.buffer.slice(e-64)):new Uint8Array(0),this},o.ArrayBuffer.prototype.end=function(t){for(var e,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r[o]<<(o%4<<3);return this._finish(i,n),e=s(this._hash),t&&(e=a(e)),this.reset(),e},o.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.ArrayBuffer.prototype.getState=function(){var t,e=o.prototype.getState.call(this);return e.buff=(t=e.buff,String.fromCharCode.apply(null,new Uint8Array(t))),e},o.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,e){for(var r=t.length,n=new ArrayBuffer(r),i=new Uint8Array(n),o=0;o<r;o+=1)i[o]=t.charCodeAt(o);return e?i:n}(t.buff,!0),o.prototype.setState.call(this,t)},o.ArrayBuffer.prototype.destroy=o.prototype.destroy,o.ArrayBuffer.prototype._finish=o.prototype._finish,o.ArrayBuffer.hash=function(t,e){t=s(function(t){for(var e,r,n,i,o=t.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)c(s,l(t.subarray(a-64,a)));for(e=(t=a-64<o?t.subarray(a-64):new Uint8Array(0)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<e;a+=1)r[a>>2]|=t[a]<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(c(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,c(s,r),s}(new Uint8Array(t)));return e?a(t):t},o;function f(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}}()},3086:(t,e,r)=>{var n=r(624);function i(){n.call(this)}i.prototype=new n,((t.exports=i).Stream=i).prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",a));var o=!1;function s(){o||(o=!0,e.end())}function a(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function c(t){if(u(),!this.hasListeners("error"))throw t}function u(){r.off("data",n),e.off("drain",i),r.off("end",s),r.off("close",a),r.off("error",c),e.off("error",c),r.off("end",u),r.off("close",u),e.off("end",u),e.off("close",u)}return r.on("error",c),e.on("error",c),r.on("end",u),r.on("close",u),e.on("end",u),e.on("close",u),e.emit("pipe",r),e}},2467:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=e.deserialize=e.registerSerializer=void 0;const n=r(7381);let i=n.DefaultSerializer;e.registerSerializer=function(t){i=n.extendSerializer(i,t)},e.deserialize=function(t){return i.deserialize(t)},e.serialize=function(t){return i.serialize(t)}},7381:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultSerializer=e.extendSerializer=void 0,e.extendSerializer=function(t,e){const r=t.deserialize.bind(t),n=t.serialize.bind(t);return{deserialize:t=>e.deserialize(t,r),serialize:t=>e.serialize(t,n)}};const r={deserialize:t=>Object.assign(Error(t.message),{name:t.name,stack:t.stack}),serialize:t=>({__error_marker:"$$error",message:t.message,name:t.name,stack:t.stack})};e.DefaultSerializer={deserialize(t){return(e=t)&&"object"==typeof e&&"__error_marker"in e&&"$$error"===e.__error_marker?r.deserialize(t):t;var e},serialize:t=>t instanceof Error?r.serialize(t):t}},8258:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.$worker=e.$transferable=e.$terminate=e.$events=e.$errors=void 0,e.$errors=Symbol("thread.errors"),e.$events=Symbol("thread.events"),e.$terminate=Symbol("thread.terminate"),e.$transferable=Symbol("thread.transferable"),e.$worker=Symbol("thread.worker")},8180:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transfer=e.isTransferDescriptor=void 0;const n=r(8258);e.isTransferDescriptor=function(t){return t&&"object"==typeof t&&t[n.$transferable]},e.Transfer=function(t,e){if(!e){if(!t||"object"!=typeof t)throw Error();e=[t]}return{[n.$transferable]:!0,send:t,transferables:e}}},3229:(t,e)=>{"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerMessageType=e.MasterMessageType=void 0,(r=e.MasterMessageType||(e.MasterMessageType={})).cancel="cancel",r.run="run",(r=e.WorkerMessageType||(e.WorkerMessageType={})).error="error",r.init="init",r.result="result",r.running="running",r.uncaughtError="uncaughtError"},3447:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={isWorkerRuntime:function(){var t="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||t)},postMessageToMaster:function(t,e){self.postMessage(t,e)},subscribeToMasterMessages:function(e){const t=t=>{e(t.data)};return self.addEventListener("message",t),()=>{self.removeEventListener("message",t)}}}},1934:function(t,e,r){"use strict";var s=this&&this.__awaiter||function(t,s,a,c){return new(a=a||Promise)(function(r,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function i(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?r(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,i)}o((c=c.apply(t,s||[])).next())})},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;const i=n(r(6898)),a=r(2467),o=r(8180),c=r(3229),u=n(r(3447));var l=r(2467),f=(Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}}),r(8180));Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return f.Transfer}}),e.isWorkerRuntime=u.default.isWorkerRuntime;let h=!1;const p=new Map,d=t=>t&&t.type===c.MasterMessageType.run,y=t=>i.default(t)||t&&"object"==typeof t&&"function"==typeof t.subscribe;function v(t){return o.isTransferDescriptor(t)?{payload:t.send,transferables:t.transferables}:{payload:t,transferables:void 0}}function g(t,e){var{payload:e,transferables:r}=v(e),t={type:c.WorkerMessageType.error,uid:t,error:a.serialize(e)};u.default.postMessageToMaster(t,r)}function b(t,e,r){var{payload:r,transferables:n}=v(r),t={type:c.WorkerMessageType.result,uid:t,complete:!!e||void 0,payload:r};u.default.postMessageToMaster(t,n)}function m(e){try{var t={type:c.WorkerMessageType.uncaughtError,error:a.serialize(e)};u.default.postMessageToMaster(t)}catch(t){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",t,"\nOriginal error:",e)}}function w(n,i,o){s(this,void 0,void 0,function*(){let t;try{t=i(...o)}catch(t){return g(n,t)}var e=y(t)?"observable":"promise",r=n;if(r={type:c.WorkerMessageType.running,uid:r,resultType:e},u.default.postMessageToMaster(r),y(t)){const i=t.subscribe(t=>b(n,!1,a.serialize(t)),t=>{g(n,a.serialize(t)),p.delete(n)},()=>{b(n,!0),p.delete(n)});p.set(n,i)}else try{const i=yield t;b(n,!0,a.serialize(i))}catch(t){g(n,a.serialize(t))}})}e.expose=function(e){if(!u.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(h)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(h=!0,"function"==typeof e)u.default.subscribeToMasterMessages(t=>{d(t)&&!t.method&&w(t.uid,e,t.args.map(a.deserialize))}),t={type:c.WorkerMessageType.init,exposed:{type:"function"}},u.default.postMessageToMaster(t);else{if("object"!=typeof e||!e)throw Error("Invalid argument passed to expose(). Expected a function or an object, got: "+e);u.default.subscribeToMasterMessages(t=>{d(t)&&t.method&&w(t.uid,e[t.method],t.args.map(a.deserialize))});t=Object.keys(e).filter(t=>"function"==typeof e[t]);t={type:c.WorkerMessageType.init,exposed:{type:"module",methods:t}},u.default.postMessageToMaster(t)}var t;u.default.subscribeToMasterMessages(t=>{if(t&&t.type===c.MasterMessageType.cancel){const e=t.uid,r=p.get(e);r&&(r.unsubscribe(),p.delete(e))}var e})},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&u.default.isWorkerRuntime()&&(self.addEventListener("error",t=>{setTimeout(()=>m(t.error||t),250)}),self.addEventListener("unhandledrejection",t=>{const e=t.reason;e&&"string"==typeof e.message&&setTimeout(()=>m(e),250)})),"undefined"!=typeof process&&"function"==typeof process.on&&u.default.isWorkerRuntime()&&(process.on("uncaughtException",t=>{setTimeout(()=>m(t),250)}),process.on("unhandledRejection",t=>{t&&"string"==typeof t.message&&setTimeout(()=>m(t),250)}))},384:t=>{t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},5955:(t,e,r)=>{"use strict";var n=r(2584),i=r(8662),o=r(6430),s=r(5692);function a(t){return t.call.bind(t)}var c,u,l="undefined"!=typeof BigInt,f="undefined"!=typeof Symbol,h=a(Object.prototype.toString),p=a(Number.prototype.valueOf),d=a(String.prototype.valueOf),y=a(Boolean.prototype.valueOf);function v(t,e){if("object"!=typeof t)return!1;try{return e(t),!0}catch(t){return!1}}function g(t){return"[object Map]"===h(t)}function b(t){return"[object Set]"===h(t)}function m(t){return"[object WeakMap]"===h(t)}function w(t){return"[object WeakSet]"===h(t)}function S(t){return"[object ArrayBuffer]"===h(t)}function I(t){return"undefined"!=typeof ArrayBuffer&&(S.working?S(t):t instanceof ArrayBuffer)}function O(t){return"[object DataView]"===h(t)}function P(t){return"undefined"!=typeof DataView&&(O.working?O(t):t instanceof DataView)}l&&(c=a(BigInt.prototype.valueOf)),f&&(u=a(Symbol.prototype.valueOf)),e.isArgumentsObject=n,e.isGeneratorFunction=i,e.isTypedArray=s,e.isPromise=function(t){return"undefined"!=typeof Promise&&t instanceof Promise||null!==t&&"object"==typeof t&&"function"==typeof t.then&&"function"==typeof t.catch},e.isArrayBufferView=function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):s(t)||P(t)},e.isUint8Array=function(t){return"Uint8Array"===o(t)},e.isUint8ClampedArray=function(t){return"Uint8ClampedArray"===o(t)},e.isUint16Array=function(t){return"Uint16Array"===o(t)},e.isUint32Array=function(t){return"Uint32Array"===o(t)},e.isInt8Array=function(t){return"Int8Array"===o(t)},e.isInt16Array=function(t){return"Int16Array"===o(t)},e.isInt32Array=function(t){return"Int32Array"===o(t)},e.isFloat32Array=function(t){return"Float32Array"===o(t)},e.isFloat64Array=function(t){return"Float64Array"===o(t)},e.isBigInt64Array=function(t){return"BigInt64Array"===o(t)},e.isBigUint64Array=function(t){return"BigUint64Array"===o(t)},g.working="undefined"!=typeof Map&&g(new Map),e.isMap=function(t){return"undefined"!=typeof Map&&(g.working?g(t):t instanceof Map)},b.working="undefined"!=typeof Set&&b(new Set),e.isSet=function(t){return"undefined"!=typeof Set&&(b.working?b(t):t instanceof Set)},m.working="undefined"!=typeof WeakMap&&m(new WeakMap),e.isWeakMap=function(t){return"undefined"!=typeof WeakMap&&(m.working?m(t):t instanceof WeakMap)},w.working="undefined"!=typeof WeakSet&&w(new WeakSet),e.isWeakSet=w,S.working="undefined"!=typeof ArrayBuffer&&S(new ArrayBuffer),e.isArrayBuffer=I,O.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&O(new DataView(new ArrayBuffer(1),0,1)),e.isDataView=P;var A="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function x(t){return"[object SharedArrayBuffer]"===h(t)}function k(t){return void 0!==A&&((x.working=void 0===x.working?x(new A):x.working)?x(t):t instanceof A)}function j(t){return v(t,p)}function _(t){return v(t,d)}function E(t){return v(t,y)}function C(t){return l&&v(t,c)}function D(t){return f&&v(t,u)}e.isSharedArrayBuffer=k,e.isAsyncFunction=function(t){return"[object AsyncFunction]"===h(t)},e.isMapIterator=function(t){return"[object Map Iterator]"===h(t)},e.isSetIterator=function(t){return"[object Set Iterator]"===h(t)},e.isGeneratorObject=function(t){return"[object Generator]"===h(t)},e.isWebAssemblyCompiledModule=function(t){return"[object WebAssembly.Module]"===h(t)},e.isNumberObject=j,e.isStringObject=_,e.isBooleanObject=E,e.isBigIntObject=C,e.isSymbolObject=D,e.isBoxedPrimitive=function(t){return j(t)||_(t)||E(t)||C(t)||D(t)},e.isAnyArrayBuffer=function(t){return"undefined"!=typeof Uint8Array&&(I(t)||k(t))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(t){Object.defineProperty(e,t,{enumerable:!1,value:function(){throw new Error(t+" is not supported in userland")}})})},9539:(t,p,e)=>{var r,n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),r={},n=0;n<e.length;n++)r[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return r},a=/%[sdj%]/g,i=(p.format=function(t){if(!S(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(c(arguments[r]));return e.join(" ")}for(var r=1,n=arguments,i=n.length,o=String(t).replace(a,function(t){if("%%"===t)return"%";if(i<=r)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}}),s=n[r];r<i;s=n[++r])m(s)||!l(s)?o+=" "+s:o+=" "+c(s);return o},p.deprecate=function(t,e){if("undefined"!=typeof process&&!0===process.noDeprecation)return t;if("undefined"==typeof process)return function(){return p.deprecate(t,e).apply(this,arguments)};var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),r=!0}return t.apply(this,arguments)}},{}),o=/^$/;function c(t,e){var r={seen:[],stylize:u};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),b(e)?r.showHidden=e:e&&p._extend(r,e),I(r.showHidden)&&(r.showHidden=!1),I(r.depth)&&(r.depth=2),I(r.colors)&&(r.colors=!1),I(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),d(r,t,r.depth)}function s(t,e){e=c.styles[e];return e?"["+c.colors[e][0]+"m"+t+"["+c.colors[e][1]+"m":t}function u(t,e){return t}function d(e,r,n){if(e.customInspect&&r&&x(r.inspect)&&r.inspect!==p.inspect&&(!r.constructor||r.constructor.prototype!==r))return S(t=r.inspect(n,e))?t:d(e,t,n);t=e;var t,i=I(s=r)?t.stylize("undefined","undefined"):S(s)?(i="'"+JSON.stringify(s).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",t.stylize(i,"string")):w(s)?t.stylize(""+s,"number"):b(s)?t.stylize(""+s,"boolean"):m(s)?t.stylize("null","null"):void 0;if(i)return i;var o,s=Object.keys(r),a=(o={},s.forEach(function(t,e){o[t]=!0}),o);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),A(r)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return y(r);if(0===s.length){if(x(r))return l=r.name?": "+r.name:"",e.stylize("[Function"+l+"]","special");if(O(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(P(r))return e.stylize(Date.prototype.toString.call(r),"date");if(A(r))return y(r)}var c,u,l="",f=!1,h=["{","}"];return g(r)&&(f=!0,h=["[","]"]),x(r)&&(l=" [Function"+(r.name?": "+r.name:"")+"]"),O(r)&&(l=" "+RegExp.prototype.toString.call(r)),P(r)&&(l=" "+Date.prototype.toUTCString.call(r)),A(r)&&(l=" "+y(r)),0!==s.length||f&&0!=r.length?n<0?O(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),s=f?function(e,r,n,i,t){for(var o=[],s=0,a=r.length;s<a;++s)j(r,String(s))?o.push(v(e,r,n,i,String(s),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(v(e,r,n,i,t,!0))}),o}(e,r,n,a,s):s.map(function(t){return v(e,r,n,a,t,f)}),e.seen.pop(),c=l,u=h,60<(s=s).reduce(function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?u[0]+(""===c?"":c+"\n ")+" "+s.join(",\n  ")+" "+u[1]:u[0]+c+" "+s.join(", ")+" "+u[1]):h[0]+l+h[1]}function y(t){return"["+Error.prototype.toString.call(t)+"]"}function v(t,e,r,n,i,o){var s,a;if((e=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=e.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):e.set&&(a=t.stylize("[Setter]","special")),j(n,i)||(s="["+i+"]"),a||(t.seen.indexOf(e.value)<0?-1<(a=m(r)?d(t,e.value,null):d(t,e.value,r-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),I(s)){if(o&&i.match(/^\d+$/))return a;s=(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+a}function g(t){return Array.isArray(t)}function b(t){return"boolean"==typeof t}function m(t){return null===t}function w(t){return"number"==typeof t}function S(t){return"string"==typeof t}function I(t){return void 0===t}function O(t){return l(t)&&"[object RegExp]"===f(t)}function l(t){return"object"==typeof t&&null!==t}function P(t){return l(t)&&"[object Date]"===f(t)}function A(t){return l(t)&&("[object Error]"===f(t)||t instanceof Error)}function x(t){return"function"==typeof t}function f(t){return Object.prototype.toString.call(t)}function h(t){return t<10?"0"+t.toString(10):t.toString(10)}process.env.NODE_DEBUG&&(r=(r=process.env.NODE_DEBUG).replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),o=new RegExp("^"+r+"$","i")),p.debuglog=function(e){var r;return e=e.toUpperCase(),i[e]||(o.test(e)?(r=process.pid,i[e]=function(){var t=p.format.apply(p,arguments);console.error("%s %d: %s",e,r,t)}):i[e]=function(){}),i[e]},(p.inspect=c).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},p.types=e(5955),p.isArray=g,p.isBoolean=b,p.isNull=m,p.isNullOrUndefined=function(t){return null==t},p.isNumber=w,p.isString=S,p.isSymbol=function(t){return"symbol"==typeof t},p.isUndefined=I,p.isRegExp=O,p.types.isRegExp=O,p.isObject=l,p.isDate=P,p.types.isDate=P,p.isError=A,p.types.isNativeError=A,p.isFunction=x,p.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},p.isBuffer=e(384);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(t,e){return Object.prototype.hasOwnProperty.call(t,e)}p.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[h(t.getHours()),h(t.getMinutes()),h(t.getSeconds())].join(":"),[t.getDate(),k[t.getMonth()],e].join(" ")),p.format.apply(p,arguments))},p.inherits=e(5717),p._extend=function(t,e){if(!e||!l(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t};var _="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;p.promisify=function(o){if("function"!=typeof o)throw new TypeError('The "original" argument must be of type Function');if(_&&o[_]){var t;if("function"!=typeof(t=o[_]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,_,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var r,n,t=new Promise(function(t,e){r=t,n=e}),e=[],i=0;i<arguments.length;i++)e.push(arguments[i]);e.push(function(t,e){t?n(t):r(e)});try{o.apply(this,e)}catch(t){n(t)}return t}return Object.setPrototypeOf(t,Object.getPrototypeOf(o)),_&&Object.defineProperty(t,_,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(o))},p.promisify.custom=_,p.callbackify=function(o){if("function"!=typeof o)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var r=t.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");function n(){return r.apply(i,arguments)}var i=this;o.apply(this,t).then(function(t){process.nextTick(n.bind(null,null,t))},function(t){process.nextTick(function(t,e){var r;return t||((r=new Error("Promise was rejected with a falsy value")).reason=t,t=r),e(t)}.bind(null,t,n))})}return Object.setPrototypeOf(t,Object.getPrototypeOf(o)),Object.defineProperties(t,n(o)),t}},6430:(t,e,r)=>{"use strict";var o=r(9804),n=r(3083),i=r(1924),s=i("Object.prototype.toString"),a=r(6410)(),c="undefined"==typeof globalThis?r.g:globalThis,n=n(),u=i("String.prototype.slice"),l={},f=r(882),h=Object.getPrototypeOf,p=(a&&f&&h&&o(n,function(t){var e,r;"function"==typeof c[t]&&(e=new c[t],Symbol.toStringTag in e&&(e=h(e),(r=f(e,Symbol.toStringTag))||(e=h(e),r=f(e,Symbol.toStringTag)),l[t]=r.get))}),r(5692));t.exports=function(t){return!!p(t)&&(a&&Symbol.toStringTag in t?(n=t,i=!1,o(l,function(t,e){if(!i)try{var r=t.call(n);r===e&&(i=r)}catch(t){}}),i):u(s(t),8,-1));var n,i}},693:()=>{},2825:()=>{},199:()=>{},3083:(t,e,r)=>{"use strict";var n=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],i="undefined"==typeof globalThis?r.g:globalThis;t.exports=function(){for(var t=[],e=0;e<n.length;e++)"function"==typeof i[n[e]]&&(t[t.length]=n[e]);return t}},882:(t,e,r)=>{"use strict";r=r(210)("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(t){r=null}t.exports=r}},n={};function Ne(t){var e=n[t];if(void 0!==e)return e.exports;e=n[t]={exports:{}};return r[t].call(e.exports,e,e.exports,Ne),e.exports}Ne.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return Ne.d(e,{a:e}),e},Ne.d=(t,e)=>{for(var r in e)Ne.o(e,r)&&!Ne.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},Ne.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),Ne.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=Ne(3050),B=Ne.n(t),t=(Ne(6313),Ne(8322),Ne(9134)),t=Ne.n(t),z=0;function v(){var t=(new Date).getTime();return z=t=t<=z?z+1:t}function F(t){var e=0<arguments.length&&void 0!==t?t:0;return new Promise(function(t){return setTimeout(t,e)})}Promise.resolve(!0),Promise.resolve(!1),Promise.resolve(null);var T=Promise.resolve();function $(t){var e=0<arguments.length&&void 0!==t?t:null;return"object"==typeof window&&window.requestIdleCallback?new Promise(function(t){return window.requestIdleCallback(t,{timeout:e})}):F(0)}function f(t){if(t)return t;throw new Error("ensureNotFalsy() is falsy")}function R(t){for(var e=0<arguments.length&&void 0!==t?t:10,r="",n="abcdefghijklmnopqrstuvwxyz",i=0;i<e;i++)r+=n.charAt(Math.floor(Math.random()*n.length));return r}function g(t){return Object.assign({},t)}function b(t,e){t=t.get(e);if(t)return t;throw new Error("missing value from map "+e)}t()();var q=function(t,e){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}q(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function U(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&n>=t.length?void 0:t)&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function p(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function d(t){return"function"==typeof t}function W(t){t=t(function(t){Error.call(t),t.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t}Object.create,Object.create;var V=W(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}});function J(t,e){t&&0<=(e=t.indexOf(e))&&t.splice(e,1)}r.prototype.unsubscribe=function(){var t,e,r,n,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=U(o),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else o.remove(this);o=this.initialTeardown;if(d(o))try{o()}catch(t){i=t instanceof V?t.errors:[t]}o=this._finalizers;if(o){this._finalizers=null;try{for(var c=U(o),u=c.next();!u.done;u=c.next()){var l=u.value;try{G(l)}catch(t){i=null!=i?i:[],t instanceof V?i=p(p([],h(i)),h(t.errors)):i.push(t)}}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}if(i)throw new V(i)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)G(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!=(e=this._finalizers)?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&J(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&J(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=((t=new r).closed=!0,t);var o=r,K=o.EMPTY;function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}function Q(t){return t instanceof o||t&&"closed"in t&&d(t.remove)&&d(t.add)&&d(t.unsubscribe)}function G(t){d(t)?t():t.unsubscribe()}var H=null,Y=null,Z=void 0,X=!1,tt=!1,s={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=s.delegate;return null!=i&&i.setTimeout?i.setTimeout.apply(i,p([t,e],h(r))):setTimeout.apply(void 0,p([t,e],h(r)))},clearTimeout:function(t){var e=s.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function et(){}var rt=nt("C",void 0,void 0);function nt(t,e,r){return{kind:t,value:e,error:r}}var n=null;function a(t){if(X){var e=!n;if(e&&(n={errorThrown:!1,error:null}),t(),e){var e=n,r=e.errorThrown,e=e.error;if(n=null,r)throw e}}else t()}e(i,it=o),i.create=function(t,e,r){return new lt(t,e,r)},i.prototype.next=function(t){this.isStopped?ht(nt("N",t,void 0),this):this._next(t)},i.prototype.error=function(t){this.isStopped?ht(nt("E",void 0,t),this):(this.isStopped=!0,this._error(t))},i.prototype.complete=function(){this.isStopped?ht(rt,this):(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,it.prototype.unsubscribe.call(this),this.destination=null)},i.prototype._next=function(t){this.destination.next(t)},i.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},i.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}};var it,ot=i,st=Function.prototype.bind;function i(t){var e=it.call(this)||this;return e.isStopped=!1,t?Q(e.destination=t)&&t.add(e):e.destination=pt,e}function at(t,e){return st.call(t,e)}c.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){u(t)}},c.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){u(t)}else u(t)},c.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){u(t)}};var ct,ut=c,lt=(e(ft,ct=ot),ft);function ft(t,e,r){var n=ct.call(this)||this,r=d(t)||!t?{next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=r?r:void 0}:n&&tt?((e=Object.create(t)).unsubscribe=function(){return n.unsubscribe()},{next:t.next&&at(t.next,e),error:t.error&&at(t.error,e),complete:t.complete&&at(t.complete,e)}):t;return n.destination=new ut(r),n}function c(t){this.partialObserver=t}function u(t){var e,r;X?(e=t,X&&n&&(n.errorThrown=!0,n.error=e)):(r=t,s.setTimeout(function(){if(!H)throw r;H(r)}))}function ht(t,e){var r=Y;r&&s.setTimeout(function(){return r(t,e)})}var pt={closed:!0,next:et,error:function(t){throw t},complete:et},t="function"==typeof Symbol&&Symbol.observable||"@@observable";function dt(t){return t}l.prototype.lift=function(t){var e=new l;return e.source=this,e.operator=t,e},l.prototype.subscribe=function(t,e,r){var n,i=this,o=(n=t)&&n instanceof ot||n&&d(n.next)&&d(n.error)&&d(n.complete)&&Q(n)?t:new lt(t,e,r);return a(function(){var t=i.operator,e=i.source;o.add(t?t.call(o,e):e?i._subscribe(o):i._trySubscribe(o))}),o},l.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},l.prototype.forEach=function(n,t){var i=this;return new(t=vt(t))(function(t,e){var r=new lt({next:function(t){try{n(t)}catch(t){e(t),r.unsubscribe()}},error:e,complete:t});i.subscribe(r)})},l.prototype._subscribe=function(t){var e;return null==(e=this.source)?void 0:e.subscribe(t)},l.prototype[t]=function(){return this},l.prototype.pipe=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(0===(e=t).length?dt:1===e.length?e[0]:function(t){return e.reduce(function(t,e){return e(t)},t)})(this)},l.prototype.toPromise=function(t){var n=this;return new(t=vt(t))(function(t,e){var r;n.subscribe(function(t){return r=t},function(t){return e(t)},function(){return t(r)})})},l.create=function(t){return new l(t)};var yt=l;function l(t){t&&(this._subscribe=t)}function vt(t){return null!=(t=null!=t?t:Z)?t:Promise}var gt,bt,mt=W(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),wt=(e(m,bt=yt),m.prototype.lift=function(t){var e=new St(this,this);return e.operator=t,e},m.prototype._throwIfClosed=function(){if(this.closed)throw new mt},m.prototype.next=function(i){var o=this;a(function(){var e,t;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var r=U(o.currentObservers),n=r.next();!n.done;n=r.next())n.value.next(i)}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}})},m.prototype.error=function(e){var r=this;a(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=e;for(var t=r.observers;t.length;)t.shift().error(e)}})},m.prototype.complete=function(){var e=this;a(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},m.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(m.prototype,"observed",{get:function(){var t;return 0<(null==(t=this.observers)?void 0:t.length)},enumerable:!1,configurable:!0}),m.prototype._trySubscribe=function(t){return this._throwIfClosed(),bt.prototype._trySubscribe.call(this,t)},m.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},m.prototype._innerSubscribe=function(t){var e=this,r=this.hasError,n=this.isStopped,i=this.observers;return r||n?K:(this.currentObservers=null,i.push(t),new o(function(){e.currentObservers=null,J(i,t)}))},m.prototype._checkFinalizedStatuses=function(t){var e=this.hasError,r=this.thrownError,n=this.isStopped;e?t.error(r):n&&t.complete()},m.prototype.asObservable=function(){var t=new yt;return t.source=this,t},m.create=function(t,e){return new St(t,e)},m),St=(e(y,gt=wt),y.prototype.next=function(t){var e,r;null!=(r=null==(e=this.destination)?void 0:e.next)&&r.call(e,t)},y.prototype.error=function(t){var e,r;null!=(r=null==(e=this.destination)?void 0:e.error)&&r.call(e,t)},y.prototype.complete=function(){var t,e;null!=(e=null==(t=this.destination)?void 0:t.complete)&&e.call(t)},y.prototype._subscribe=function(t){var e;return null!=(e=null==(e=this.source)?void 0:e.subscribe(t))?e:K},y);function y(t,e){var r=gt.call(this)||this;return r.destination=t,r.source=e,r}function m(){var t=bt.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}function It(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ot(t){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pt(t,e,r){return(Pt=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(t){return}}}()?Reflect.construct:function(t,e,r){var n=[null],e=(n.push.apply(n,e),new(Function.bind.apply(t,n)));return r&&w(e,r.prototype),e}).apply(null,arguments)}function At(t){var r="function"==typeof Map?new Map:void 0;return function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return Pt(t,arguments,Ot(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),w(e,t)}(t)}xt=At(Error),t=xt,(P=S).prototype=Object.create(t.prototype),w(P.prototype.constructor=P,t),S.prototype.toString=function(){return this.message},P=S,(t=[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])&&It(P.prototype,t),O&&It(P,O),Object.defineProperty(P,"prototype",{writable:!1});var xt,kt=S;function S(t,e){var r,n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e="RxError ("+(r=t)+"):\n"+e+"\n"+(n=i,r="",0===Object.keys(n).length?r:(r=(r+="Given parameters: {\n")+Object.keys(n).map(function(t){var e="[object Object]";try{e=JSON.stringify(n[t],function(t,e){return void 0===e?null:e},2)}catch(t){}return t+":"+e}).join("\n"))+"}");return(r=xt.call(this,e)||this).code=t,r.message=e,r.parameters=i,r.rxdb=!0,r}function I(t,e){return new kt(t,"RxDB Error-Code "+t+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+t+"\n        ",e)}TypeError;var t=Ne(5643),O=Ne.n(t),P={add:function(t){"function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope||"function"==typeof window.addEventListener&&(window.addEventListener("beforeunload",function(){t()},!0),window.addEventListener("unload",function(){t()},!0))}},t=Ne(199),t=Ne.n(t),jt=O()?t():P,A=new Set,_t=!1;function Et(t){if(_t||(_t=!0,jt.add(Ct)),"function"!=typeof t)throw new Error("Listener is no function");return A.add(t),{remove:function(){return A.delete(t)},run:function(){return A.delete(t),t()}}}function Ct(){var e=[];return A.forEach(function(t){e.push(t()),A.delete(t)}),Promise.all(e)}(O=Mt.prototype).addWrite=function(){this.writesSinceLastRun=this.writesSinceLastRun+1,this.run()},O.run=function(){var i=this;return!this.databaseSettings.adapter||2<this.saveQueueC||(this.saveQueueC=this.saveQueueC+1,this.saveQueue=this.saveQueue.then(function(){try{return Promise.resolve($()).then(function(){if(0!==i.writesSinceLastRun)return Promise.resolve($().then(function(){return $()})).then(function(){var n;if(0!==i.writesSinceLastRun)return n=i.writesSinceLastRun,i.writesSinceLastRun=0,new Promise(function(e,r){i.lokiDatabase.saveDatabase(function(t){t?(i.writesSinceLastRun=i.writesSinceLastRun+n,r(t)):(i.databaseSettings.autosaveCallback&&i.databaseSettings.autosaveCallback(),e())})})})})}catch(t){return Promise.reject(t)}}).catch(function(){}).then(function(){i.saveQueueC=i.saveQueueC-1})),this.saveQueue};var Dt=Mt;function Mt(t,e){this.writesSinceLastRun=0,this.saveQueue=T,this.saveQueueC=0,this.lokiDatabase=t,this.databaseSettings=e}Promise.resolve(!1);var Lt=Promise.resolve(!0),x=Promise.resolve();function k(e,r){return e=e||0,new Promise(function(t){return setTimeout(function(){return t(r)},e)})}function Nt(){return Math.random().toString(36).substring(2)}var Bt=0,zt=0;function Ft(){var t=(new Date).getTime();return t===Bt?1e3*t+ ++zt:(zt=0,1e3*(Bt=t))}var Tt="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0),t={create:function(t){var e={messagesCallback:null,bc:new BroadcastChannel(t),subFns:[]};return e.bc.onmessage=function(t){e.messagesCallback&&e.messagesCallback(t.data)},e},close:function(t){t.bc.close(),t.subFns=[]},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){try{return t.bc.postMessage(e,!1),x}catch(t){return Promise.reject(t)}},canBeUsed:function(){if(Tt&&"undefined"==typeof window)return!1;if("function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:Ft},$t=(Rt.prototype.has=function(t){return this.set.has(t)},Rt.prototype.add=function(t){var i=this;this.timeMap.set(t,qt()),this.set.add(t),setTimeout(function(){for(var t=i,e=qt()-t.ttl,r=t.set[Symbol.iterator]();;){var n=r.next().value;if(!n)return;if(!(t.timeMap.get(n)<e))return;t.timeMap.delete(n),t.set.delete(n)}},0)},Rt.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},Rt);function Rt(t){this.ttl=t,this.set=new Set,this.timeMap=new Map}function qt(){return(new Date).getTime()}function Ut(t){var t=0<arguments.length&&void 0!==t?t:{},e=JSON.parse(JSON.stringify(t));return void 0===e.webWorkerSupport&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=45e3),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),t.idb&&"function"==typeof t.idb.onclose&&(e.idb.onclose=t.idb.onclose),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=6e4),t.methods&&(e.methods=t.methods),e.node||(e.node={}),e.node.ttl||(e.node.ttl=12e4),e.node.maxParallelWrites||(e.node.maxParallelWrites=2048),void 0===e.node.useFastPath&&(e.node.useFastPath=!0),e}var j="messages";function Wt(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function Vt(r,t){var e,n,i,o;e=r,t=t,n=(new Date).getTime()-t,i=e.transaction(j).objectStore(j),o=[],new Promise(function(r){i.openCursor().onsuccess=function(t){var e,t=t.target.result;t&&(e=t.value).time<n?(o.push(e),t.continue()):r(o)}}).then(function(t){return Promise.all(t.map(function(t){return t=t.id,e=r.transaction([j],"readwrite").objectStore(j).delete(t),new Promise(function(t){e.onsuccess=function(){return t()}});var e}))})}function Jt(r){return!r.closed&&r.messagesCallback?(t=r.db,n=r.lastCursorId,i=t.transaction(j).objectStore(j),o=[],new Promise(function(e){(function(){try{var t=IDBKeyRange.bound(n+1,1/0);return i.openCursor(t)}catch(t){return i.openCursor()}})().onsuccess=function(t){t=t.target.result;t?t.value.id<n+1?t.continue(n+1):(o.push(t.value),t.continue()):e(o)}}).then(function(t){return t.filter(function(t){return!!t}).map(function(t){return t.id>r.lastCursorId&&(r.lastCursorId=t.id),t}).filter(function(t){return e=r,!((t=t).uuid===e.uuid||e.eMIs.has(t.id)||t.data.time<e.messagesCallbackTime);var e}).sort(function(t,e){return t.time-e.time}).forEach(function(t){r.messagesCallback&&(r.eMIs.add(t.id),r.messagesCallback(t.data))}),x})):x;var t,n,i,o}P={create:function(r,n){return n=Ut(n),(i=Wt().open("pubkey.broadcast-channel-0-"+r,1)).onupgradeneeded=function(t){t.target.result.createObjectStore(j,{keyPath:"id",autoIncrement:!0})},new Promise(function(t,e){i.onerror=function(t){return e(t)},i.onsuccess=function(){t(i.result)}}).then(function(t){var e={closed:!1,lastCursorId:0,channelName:r,options:n,uuid:Nt(),eMIs:new $t(2*n.idb.ttl),writeBlockPromise:x,messagesCallback:null,readQueuePromises:[],db:t};return t.onclose=function(){e.closed=!0,n.idb.onclose&&n.idb.onclose()},function t(e){e.closed||Jt(e).then(function(){return k(e.options.idb.fallbackInterval)}).then(function(){return t(e)})}(e),e});var i},close:function(t){t.closed=!0,t.db.close()},onMessage:function(t,e,r){t.messagesCallbackTime=r,t.messagesCallback=e,Jt(t)},postMessage:function(o,s){return o.writeBlockPromise=o.writeBlockPromise.then(function(){return t=o.db,e=o.uuid,r=s,n={uuid:e,time:(new Date).getTime(),data:r},i=t.transaction([j],"readwrite"),new Promise(function(t,e){i.oncomplete=function(){return t()},i.onerror=function(t){return e(t)},i.objectStore(j).add(n)});var t,e,r,n,i}).then(function(){0===Math.floor(11*Math.random()+0)&&Vt(o.db,o.options.idb.ttl)}),o.writeBlockPromise},canBeUsed:function(){return!Tt&&!!Wt()},type:"idb",averageResponseTime:function(t){return 2*t.idb.fallbackInterval},microSeconds:Ft};function Kt(){var t;if("undefined"==typeof window)return null;try{t=window.localStorage,t=window["ie8-eventlistener/storage"]||window.localStorage}catch(t){}return t}function Qt(t){return"pubkey.broadcastChannel-"+t}function Gt(){if(Tt)return!1;var t=Kt();if(!t)return!1;try{var e="__broadcastchannel_check";t.setItem(e,"works"),t.removeItem(e)}catch(t){return!1}return!0}var O={create:function(t,e){if(e=Ut(e),!Gt())throw new Error("BroadcastChannel: localstorage cannot be used");var r,n=Nt(),i=new $t(e.localstorage.removeTimeout),o={channelName:t,uuid:n,eMIs:i};return o.listener=(r=Qt(t),window.addEventListener("storage",s),s),o;function s(t){t.key===r&&(t=JSON.parse(t.newValue),!o.messagesCallback||t.uuid===n||!t.token||i.has(t.token)||t.data.time&&t.data.time<o.messagesCallbackTime||(i.add(t.token),o.messagesCallback(t.data)))}},close:function(t){t=t.listener;window.removeEventListener("storage",t)},onMessage:function(t,e,r){t.messagesCallbackTime=r,t.messagesCallback=e},postMessage:function(i,o){return new Promise(function(n){k().then(function(){var t=Qt(i.channelName),e={token:Nt(),time:(new Date).getTime(),data:o,uuid:i.uuid},e=JSON.stringify(e),r=(Kt().setItem(t,e),document.createEvent("Event"));r.initEvent("storage",!0,!0),r.key=t,r.newValue=e,window.dispatchEvent(r),n()})})},canBeUsed:Gt,type:"localstorage",averageResponseTime:function(){var t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?240:120},microSeconds:Ft},_=Ft,Ht=new Set;const Yt={create:function(t){t={name:t,messagesCallback:null};return Ht.add(t),t},close:function(t){Ht.delete(t)},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(e,r){return new Promise(function(t){return setTimeout(function(){Array.from(Ht).filter(function(t){return t.name===e.name}).filter(function(t){return t!==e}).filter(function(t){return!!t.messagesCallback}).forEach(function(t){return t.messagesCallback(r)}),t()},5)})},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:_};function Zt(t,e){var r;this.id=ee++,te.add(this),this.name=t,this.options=Ut(e),this.method=function(e){var t=[].concat(e.methods,Xt).filter(Boolean);if(e.type){if("simulate"===e.type)return Yt;var r=t.find(function(t){return t.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}r=(t=e.webWorkerSupport||Tt?t:t.filter(function(t){return"idb"!==t.type})).find(function(t){return t.canBeUsed()});if(r)return r;throw new Error("No useable method found in "+JSON.stringify(Xt.map(function(t){return t.type})))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,(t=(r=this).method.create(r.name,r.options))&&"function"==typeof t.then?(r._prepP=t).then(function(t){r._state=t}):r._state=t}var Xt=[t,P,O],te=new Set,ee=0;function re(e,t,r){var n={time:e.method.microSeconds(),type:t,data:r};return(e._prepP||x).then(function(){var t=e.method.postMessage(e._state,n);return e._uMP.add(t),t.catch().then(function(){return e._uMP.delete(t)}),t})}function ne(t){return 0<t._addEL.message.length||0<t._addEL.internal.length}function ie(t,e,r){var n,i,o;t._addEL[e].push(r),!(n=t)._iL&&ne(n)&&(i=function(r){n._addEL[r.type].forEach(function(t){var e=t.time-1e5;r.time>=e&&t.fn(r.data)})},o=n.method.microSeconds(),n._prepP?n._prepP.then(function(){n._iL=!0,n.method.onMessage(n._state,i,o)}):(n._iL=!0,n.method.onMessage(n._state,i,o)))}function oe(t,e,r){t._addEL[e]=t._addEL[e].filter(function(t){return t!==r}),(e=t)._iL&&!ne(e)&&(e._iL=!1,t=e.method.microSeconds(),e.method.onMessage(e._state,null,t))}Zt._pubkey=!0,Zt.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return re(this,"message",t)},postInternal:function(t){return re(this,"internal",t)},set onmessage(t){var e={time:this.method.microSeconds(),fn:t};oe(this,"message",this._onML),t&&"function"==typeof t?(this._onML=e,ie(this,"message",e)):this._onML=null},addEventListener:function(t,e){ie(this,t,{time:this.method.microSeconds(),fn:e})},removeEventListener:function(t,e){oe(this,t,this._addEL[t].find(function(t){return t.fn===e}))},close:function(){var t,e=this;if(!this.closed)return te.delete(this),this.closed=!0,t=this._prepP||x,this._onML=null,this._addEL.message=[],t.then(function(){return Promise.all(Array.from(e._uMP))}).then(function(){return Promise.all(e._befC.map(function(t){return t()}))}).then(function(){return e.method.close(e._state)})},get type(){return this.method.type},get isClosed(){return this.closed}};var se=function(t,e){function r(t){"leader"===t.context&&("death"===t.action&&(n.hasLeader=!1),"tell"===t.action&&(n.hasLeader=!0))}var n=this;this.broadcastChannel=t,this._options=e,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=Nt(),this._aplQ=x,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};function E(t,e){e={context:"leader",action:e,token:t.token};return t.broadcastChannel.postInternal(e)}function C(t,e,r){if(!t.s){if(r instanceof ae){if(!r.s)return void(r.o=C.bind(null,t,e));1&e&&(e=r.s),r=r.v}r&&r.then?r.then(C.bind(null,t,e),C.bind(null,t,2)):(t.s=e,t.v=r,(e=t.o)&&e(t))}}se.prototype={applyOnce:function(s){var a=this;if(this.isLeader)return k(0,!0);if(this.isDead)return k(0,!1);if(1<this._aplQC)return this._aplQ;function t(){if(a.isLeader)return Lt;function t(t){"leader"===t.context&&t.token!=a.token&&(i.push(t),"apply"===t.action&&t.token>a.token&&e(),"tell"===t.action&&(e(),a.hasLeader=!0))}var e,r=!1,n=new Promise(function(t){e=function(){r=!0,t()}}),i=[],o=(a.broadcastChannel.addEventListener("internal",t),s?4*a._options.responseTime:a._options.responseTime);return E(a,"apply").then(function(){return Promise.race([k(o),n.then(function(){return Promise.reject(new Error)})])}).then(function(){return E(a,"apply")}).then(function(){return Promise.race([k(o),n.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return a.broadcastChannel.removeEventListener("internal",t),!r&&function(e){e.isLeader=!0,e.hasLeader=!0;function t(t){"leader"===t.context&&"apply"===t.action&&E(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),E(e,"tell"))}var r=Et(function(){return e.die()});e._unl.push(r);return e.broadcastChannel.addEventListener("internal",t),e._lstns.push(t),E(e,"tell")}(a).then(function(){return!0})})}return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(t).then(function(){a._aplQC=a._aplQC-1}),this._aplQ.then(function(){return a.isLeader})},awaitLeadership:function(){return this._aLP||(this._aLP=(i=this).isLeader?x:new Promise(function(t){var e=!1;function r(){e||(e=!0,i.broadcastChannel.removeEventListener("internal",n),t(!0))}i.applyOnce().then(function(){i.isLeader&&r()}),function t(){k(i._options.fallbackInterval).then(function(){if(!i.isDead&&!e)return i.isLeader?void r():i.applyOnce(!0).then(function(){(i.isLeader?r:t)()})})}();var n=function(t){"leader"===t.context&&"death"===t.action&&(i.hasLeader=!1,i.applyOnce().then(function(){i.isLeader&&r()}))};i.broadcastChannel.addEventListener("internal",n),i._lstns.push(n)})),this._aLP;var i},set onduplicate(t){this._dpL=t},die:function(){var e=this;return this._lstns.forEach(function(t){return e.broadcastChannel.removeEventListener("internal",t)}),this._lstns=[],this._unl.forEach(function(t){return t.remove()}),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,E(this,"death")}};ce.prototype.then=function(r,n){var i=new ce,t=this.s;if(t){t=1&t?r:n;if(t){try{C(i,1,t(this.v))}catch(t){C(i,2,t)}return i}return this}return this.o=function(t){try{var e=t.v;1&t.s?C(i,1,r?r(e):e):n?C(i,1,n(e)):C(i,2,e)}catch(t){C(i,2,t)}},i};var ae=ce;function ce(){}function D(t){return t instanceof ae&&1&t.s}function M(t){try{if(t.closed)throw I("SNH",{args:{instanceClosed:t.closed,databaseName:t.databaseName,collectionName:t.collectionName}});if(t.internals.localState)return Promise.resolve(t.internals.localState);var e=f(t.internals.leaderElector);return Promise.resolve(ue(e)).then(function(){return t.internals.localState||!(!e.isLeader||t.internals.localState)&&(t.internals.localState=we({databaseName:t.databaseName,collectionName:t.collectionName,options:t.options,schema:t.schema,multiInstance:!!t.internals.leaderElector},t.databaseSettings),f(t.internals.localState))})}catch(t){return Promise.reject(t)}}function ue(t){try{var e=function(e,r,n){for(var t;;){var i=e();if(!(i=D(i)?i.v:i))return o;if(i.then){t=0;break}var o=n();if(o&&o.then){if(!D(o)){t=1;break}o=o.s}if(r){var s=r();if(s&&s.then&&!D(s)){t=2;break}}}var a=new ae,c=C.bind(null,a,2);return(0===t?i.then(l):1===t?o.then(u):s.then(f)).then(void 0,c),a;function u(t){o=t;do{if(r&&(s=r())&&s.then&&!D(s))return void s.then(f).then(void 0,c);if(!(i=e())||D(i)&&!i.v)return void C(a,1,o);if(i.then)return void i.then(l).then(void 0,c)}while(!(o=D(o=n())?o.v:o)||!o.then);o.then(u).then(void 0,c)}function l(t){t?(o=n())&&o.then?o.then(u).then(void 0,c):u(o):C(a,1,o)}function f(){(i=e())?i.then?i.then(l).then(void 0,c):l(i):C(a,1,o)}}(function(){return!t.hasLeader},void 0,function(){return Promise.resolve(t.applyOnce()).then(function(){return Promise.resolve(F(0)).then(function(){})})});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(t){return Promise.reject(t)}}function L(s,a,c){try{var u="function"==typeof s.query?le:"rxdb-lokijs-remote-request-key-object",l=f(s.internals.leaderElector);return Promise.resolve(ue(l)).then(function(){var r,n,i=l.broadcastChannel,t=new Promise(function(e){r=function(t){"leader"===t.context&&"death"===t.action&&e({retry:!0})},i.addEventListener("internal",r)}),o=R(12),e=new Promise(function(e,t){n=function(t){t.type===u&&!0===t.response&&t.requestId===o&&(t.isError?e({retry:!1,error:t.result}):e({retry:!1,result:t.result}))},i.addEventListener("message",n)});return i.postMessage({response:!1,type:u,operation:a,params:c,requestId:o,databaseName:s.databaseName,collectionName:s.collectionName}),Promise.race([t,e]).then(function(t){if(i.removeEventListener("message",n),i.removeEventListener("internal",r),t.retry)return s[a].apply(s,c);if(t.error)throw t.error;return t.result})})}catch(s){return Promise.reject(s)}}var le="rxdb-lokijs-remote-request";function fe(t){if(!t.$loki)return t;t=g(t);return t.$lastWriteAt&&(t._meta={lwt:t.$lastWriteAt},delete t.$lastWriteAt),delete t.$loki,t}var he=new Set,pe={disableChangesApi:!0,disableMeta:!0,disableDeltaChangesApi:!0,disableFreeze:!0,cloneMethod:"shallow-assign",clone:!1,transactional:!1,autoupdate:!1},de=new Map;function ye(s,a){var c,t=de.get(s);return t||(c=!!a.adapter,t=function(){try{var t=function(){var t=[];return c&&t.push(Et(function(){return r.run()})),{database:i,databaseSettings:n,saveQueue:r,collections:{},unloads:t}},e=c?"adapter":"memory",n=(a.persistenceMethod&&(e=a.persistenceMethod),Object.assign({autoload:c,persistenceMethod:e,verbose:!0},a,{autoload:!1,autosave:!1,throttledSaves:!1})),i=new(B())(s+".db",g(n)),r=new Dt(i,n),o=function(){var t;if(c)return t=new Promise(function(e,r){i.loadDatabase({},function(t){n.autoloadCallback&&n.autoloadCallback(t),t?r(t):e()})}),r.saveQueue=r.saveQueue.then(function(){return t}),Promise.resolve(t).then(function(){})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(t){return Promise.reject(t)}}(),de.set(s,t)),t}function ve(t,e){if(!e.sort)throw I("SNH",{query:e});var r=e.sort;return function(n,i){var o=0;if(r.find(function(t){var e=Object.keys(t)[0],t="asc"===Object.values(t)[0]?1:-1,r=n[e],e=i[e];return r!==e&&(o=e<r?t:-1*t,!0)}),o)return o;throw I("SNH",{args:{query:e,a:n,b:i}})}}function ge(t){return"string"==typeof t?t:t.key}function be(t,e,r){var e=r.document[e],n=[!!r.previous,r.previous&&r.previous._deleted,!!r.document._deleted].map(function(t){return t?"1":"0"}).join("");return t.databaseName+"|"+t.collectionName+"|"+e+"||"+n+"|"+r.document._rev}Ne(1528);function me(n,i,o){try{var t=function(){var t=new Ie(n,i.databaseName,i.collectionName,i.schema,s,i.options,o);return i.multiInstance&&f(s.leaderElector).awaitLeadership().then(function(){t.closed||M(t)}),t},s={},e=function(){if(!i.multiInstance)return s.localState=we(i,o),Promise.resolve(s.localState).then(function(){});r=n,t=i.databaseName,(e=r.leaderElectorByLokiDbName.get(t))?e.intancesCount=e.intancesCount+1:(e={leaderElector:function(t,e){if(t._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");n=t,r=(r=e)||{},(r=JSON.parse(JSON.stringify(r))).fallbackInterval||(r.fallbackInterval=3e3),r.responseTime||(r.responseTime=n.method.averageResponseTime(n.options));var r,n,i=new se(t,e=r);return t._befC.push(function(){return i.die()}),t._leaderElector=i}(new Zt("rxdb-lokijs-"+t)),intancesCount:1},r.leaderElectorByLokiDbName.set(t,e));var t,e,r=e.leaderElector;s.leaderElector=r}();return Promise.resolve(e&&e.then?e.then(t):t())}catch(n){return Promise.reject(n)}}function we(i,t){try{return i.options||(i.options={}),Promise.resolve(ye(i.databaseName,t)).then(function(t){var e=[],r=(i.schema.indexes&&i.schema.indexes.forEach(function(t){Array.isArray(t)||e.push(t)}),ge(i.schema.primaryKey)),n=(e.push(r),i.collectionName+"-"+i.schema.version),r=Object.assign({},n,{indices:e,unique:[r]},pe),n=t.database.addCollection(n,r);return t.collections[i.collectionName]=n,{databaseState:t,collection:n}})}catch(i){return Promise.reject(i)}}var Se=v(),Ie=((_=Oe.prototype).bulkWrite=function(e){try{var y=this;if(0===e.length)throw I("P2",{args:{documentWrites:e}});return Promise.resolve(M(y)).then(function(n){if(!n)return L(y,"bulkWrite",[e]);var i,o,s,a,c,u,l,f,h,p={success:{},error:{}},r=new Map,d=new Map,t=(e.forEach(function(t){var t=t.document[y.primaryPath],e=n.collection.by(y.primaryPath,t);e&&(d.set(t,e),r.set(t,fe(e)))}),o=(i=y).primaryPath,s=r,t=e,a=[],c=[],u=[],l=[],f={id:R(10),events:[]},h=v(),t.forEach(function(t){var e=t.document[o],r=s.get(e);if(r){var n=r._rev;if(!t.previous&&r._deleted&&(t.previous=r),!t.previous&&!r._deleted||t.previous&&n!==t.previous._rev)u.push({isError:!0,status:409,documentId:e,writeRow:t,documentInDb:r});else{c.push(t);n=null,r=t.document;if(t.previous&&t.previous._deleted&&!r._deleted?n={id:e,operation:"INSERT",previous:null,doc:r}:!t.previous||t.previous._deleted||r._deleted?t.previous&&!t.previous._deleted&&r._deleted&&(n={id:e,operation:"DELETE",previous:t.previous,doc:null}):n={id:e,operation:"UPDATE",previous:t.previous,doc:r},n)l.push(e),f.events.push({eventId:be(i,o,t),documentId:e,change:n,startTime:h,endTime:v()});else if(!(t.previous&&t.previous._deleted&&t.document._deleted))throw I("SNH",{args:{writeRow:t}})}}else{r=!!t.document._deleted;a.push(t),r||(l.push(e),f.events.push({eventId:be(i,o,t),documentId:e,change:{doc:t.document,id:e,operation:"INSERT",previous:null},startTime:h,endTime:v()}))}}),{bulkInsertDocs:a,bulkUpdateDocs:c,errors:u,changedDocumentIds:l,eventBulk:f});return t.bulkInsertDocs.forEach(function(t){var e=t.document[y.primaryPath];n.collection.insert(g(t.document)),p.success[e]=t.document}),t.bulkUpdateDocs.forEach(function(t){var e=t.document[y.primaryPath],r=b(d,e),r=Object.assign({},t.document,{$loki:r.$loki});n.collection.update(r),p.success[e]=t.document}),t.errors.forEach(function(t){p.error[t.documentId]=t}),n.databaseState.saveQueue.addWrite(),y.changes$.next(t.eventBulk),p})}catch(e){return Promise.reject(e)}},_.findDocumentsById=function(t,i){try{var o=this;return Promise.resolve(M(o)).then(function(r){if(!r)return L(o,"findDocumentsById",[t,i]);var n={};return t.forEach(function(t){var e=r.collection.by(o.primaryPath,t);!e||e._deleted&&!i||(n[t]=fe(e))}),n})}catch(t){return Promise.reject(t)}},_.query=function(e){try{var r=this;return Promise.resolve(M(r)).then(function(t){if(!t)return L(r,"query",[e]);t=t.collection.chain().find(e.selector);return e.sort&&(t=t.sort(ve(r.schema,e))),e.skip&&(t=t.offset(e.skip)),{documents:(t=e.limit?t.limit(e.limit):t).data().map(fe)}})}catch(e){return Promise.reject(e)}},_.getAttachmentData=function(t,e){throw new Error("Attachments are not implemented in the lokijs RxStorage. Make a pull request.")},_.getChangedDocumentsSince=function(n,i){try{var o=this;return Promise.resolve(M(o)).then(function(t){if(!t)return L(o,"getChangedDocumentsSince",[n,i]);var r,e=i?i.lwt:1,t=t.collection.chain().find({"_meta.lwt":{$gte:e}}).sort((r=o.primaryPath,function(t,e){return t._meta.lwt===e._meta.lwt?e[r]<t[r]?1:-1:t._meta.lwt-e._meta.lwt})).data(),e=t[0];return i&&e&&e[o.primaryPath]===i.id&&e._meta.lwt===i.lwt&&t.shift(),(t=t.slice(0,n)).map(function(t){return{document:fe(t),checkpoint:{id:t[o.primaryPath],lwt:t._meta.lwt}}})})}catch(n){return Promise.reject(n)}},_.changeStream=function(){return this.changes$.asObservable()},_.cleanup=function(r){try{var n=this;return Promise.resolve(M(n)).then(function(t){if(!t)return L(n,"cleanup",[r]);var e=v()-r,e=t.collection.chain().find({_deleted:!0,"_meta.lwt":{$lt:e}}).limit(10).data();return 0<e.length&&(t.collection.remove(e),t.databaseState.saveQueue.addWrite()),10!==e.length})}catch(r){return Promise.reject(r)}},_.close=function(){try{var t=function(){var t,e,r;t=n.storage,e=n.databaseName,(r=t.leaderElectorByLokiDbName.get(e))&&(r.intancesCount=r.intancesCount-1,0===r.intancesCount&&(r.leaderElector.broadcastChannel.close(),t.leaderElectorByLokiDbName.delete(e)))},n=this,e=(n.closed=!0,n.changes$.complete(),he.delete(n),function(){if(n.internals.localState)return Promise.resolve(n.internals.localState).then(function(e){return Promise.resolve(ye(n.databaseName,n.databaseSettings)).then(function(t){return Promise.resolve(t.saveQueue.run()).then(function(){return Promise.resolve(function(e,r){try{return Promise.resolve(de.get(e)).then(function(n){if(n)return Promise.resolve(n.saveQueue.run()).then(function(){r.forEach(function(t){t=t.name;delete n.collections[t]});var t=function(){if(0===Object.keys(n.collections).length)return de.delete(e),n.unloads.forEach(function(t){return t.remove()}),Promise.resolve(new Promise(function(e,r){n.database.close(function(t){t?r(t):e()})})).then(function(){})}();if(t&&t.then)return t.then(function(){})})})}catch(e){return Promise.reject(e)}}(n.databaseName,[e.collection])).then(function(){})})})})}());return Promise.resolve(e&&e.then?e.then(t):t())}catch(t){return Promise.reject(t)}},_.remove=function(){try{var e=this;return Promise.resolve(M(e)).then(function(t){return t?(t.databaseState.database.removeCollection(t.collection.name),e.close()):L(e,"remove",[])})}catch(e){return Promise.reject(e)}},Oe);function Oe(t,e,r,n,i,o,s){var a=this;this.changes$=new wt,this.lastChangefeedSequence=0,this.instanceId=Se++,this.closed=!1,this.storage=t,this.databaseName=e,this.collectionName=r,this.schema=n,this.internals=i,this.options=o,this.databaseSettings=s,this.primaryPath=ge(this.schema.primaryKey),he.add(this),this.internals.leaderElector&&this.internals.leaderElector.awaitLeadership().then(function(){f(a.internals.leaderElector).broadcastChannel.addEventListener("message",function(t){try{return Promise.resolve(function(s,a){try{var t=function(){var r,t,n,i,e,o;if(a.type===le&&a.requestId&&a.databaseName===s.databaseName&&a.collectionName===s.collectionName&&!a.response)return n=a.operation,i=a.params,e=!(t=function(){var t={response:!0,requestId:a.requestId,databaseName:s.databaseName,collectionName:s.collectionName,result:r,isError:e,type:a.type};f(s.internals.leaderElector).broadcastChannel.postMessage(t)}),(o=function(e){try{var t=Promise.resolve(s[n].apply(s,i)).then(function(t){r=t})}catch(t){return e(t)}return t&&t.then?t.then(void 0,e):t}(function(t){e=!0,r=t}))&&o.then?o.then(t):t()}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(s){return Promise.reject(s)}}(a,t))}catch(t){return Promise.reject(t)}})})}var t=Ne(1368),Pe=Ne.n(t),Ae=self.setImmediate||self.setTimeout;function xe(e,t,r,n,i){var o;(0<r||n<t.size)&&(r=r,n=n,t=(o=t).webkitSlice?o.webkitSlice(r,n):o.slice(r,n)),o=t,(r=new FileReader).onloadend=function(t){t=t.target.result||new ArrayBuffer(0);e.append(t),i()},r.readAsArrayBuffer(o)}function ke(t,e,r,n,i){(0<r||n<e.length)&&(e=e.substring(r,n)),t.appendBinary(e),i()}function je(e,r){var t="string"==typeof e,n=t?e.length:e.size,i=Math.min(32768,n),o=Math.ceil(n/i),s=0,a=new(t?Pe():Pe().ArrayBuffer),c=t?ke:xe;function u(){Ae(f)}function l(){t=a.end(!0);var t=btoa(t);r(t),a.destroy()}function f(){var t=s*i;c(a,e,t,t+i,++s<o?u:l)}f()}var _e={hash:function(t){return new Promise(function(e){je(t,function(t){e(t)})})},hashKey:"md5",doesBroadcastChangestream:function(){return!1},prepareQuery:function(t,e){return 0<Object.keys(f(e.selector)).length?e.selector={$and:[{_deleted:!1},e.selector]}:e.selector={_deleted:!1},e},getSortComparator:function(t,e){return ve(0,e)},getQueryMatcher:function(t,e){return function(t){if(t._deleted)return!1;t=g(t),t._deleted=!!t._deleted,t={data:[t],binaryIndices:{}},Object.setPrototypeOf(t,B().Collection.prototype),t={collection:t};return Object.setPrototypeOf(t,B().Resultset.prototype),t.find(e.selector,!0),0<t.filteredrows.length}}},Ee=(Ce.prototype.createStorageInstance=function(t){return me(this,t,this.databaseSettings)},Ce);function Ce(t){this.name="lokijs",this.statics=_e,this.leaderElectorByLokiDbName=new Map,this.databaseSettings=t}P=Ne(1934);const De=P.expose;P.registerSerializer,P.Transfer;var Me={storage:function(t){return new Ee(0<arguments.length&&void 0!==t?t:{})}({adapter:new(Ne(6194))})},Le=0,N=new Map;De({createStorageInstance:function(t){try{var e=Le++;return Promise.resolve(Me.storage.createStorageInstance(t)).then(function(t){return N.set(e,t),e})}catch(t){return Promise.reject(t)}},bulkWrite:function(t,e){return b(N,t).bulkWrite(e)},findDocumentsById:function(t,e,r){return b(N,t).findDocumentsById(e,r)},query:function(t,e){return b(N,t).query(e)},getAttachmentData:function(t,e,r){return b(N,t).getAttachmentData(e,r)},getChangedDocumentsSince:function(t,e,r){return b(N,t).getChangedDocumentsSince(e,r)},changeStream:function(t){return b(N,t).changeStream()},cleanup:function(t,e){return b(N,t).cleanup(e)},close:function(t){return b(N,t).close()},remove:function(t){return b(N,t).remove()}})})()})();