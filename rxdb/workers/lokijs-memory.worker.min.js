(()=>{var r={6313:e=>{var t=function(){"use strict";function b(e,t){return null!=t&&e instanceof t}var w,I,S;try{w=Map}catch(b){w=function(){}}try{I=Set}catch(b){I=function(){}}try{S=Promise}catch(b){S=function(){}}function P(e,d,t,p,y){"object"==typeof d&&(t=d.depth,p=d.prototype,y=d.includeNonEnumerable,d=d.circular);var v=[],m=[],g="undefined"!=typeof Buffer;return void 0===d&&(d=!0),function n(e,i){if(null===e)return null;if(0===i)return e;var r,t,o;if("object"!=typeof e)return e;if(b(e,w))r=new w;else if(b(e,I))r=new I;else if(b(e,S))r=new S(function(t,r){e.then(function(e){t(n(e,i-1))},function(e){r(n(e,i-1))})});else if(P.__isArray(e))r=[];else if(P.__isRegExp(e))r=new RegExp(e.source,O(e)),e.lastIndex&&(r.lastIndex=e.lastIndex);else if(P.__isDate(e))r=new Date(e.getTime());else{if(g&&Buffer.isBuffer(e))return r=Buffer.allocUnsafe?Buffer.allocUnsafe(e.length):new Buffer(e.length),e.copy(r),r;b(e,Error)?r=Object.create(e):void 0===p?(t=Object.getPrototypeOf(e),r=Object.create(t)):(r=Object.create(p),t=p)}if(d){var s=v.indexOf(e);if(-1!=s)return m[s];v.push(e),m.push(r)}for(l in b(e,w)&&e.forEach(function(e,t){t=n(t,i-1),e=n(e,i-1);r.set(t,e)}),b(e,I)&&e.forEach(function(e){e=n(e,i-1);r.add(e)}),e)(o=t?Object.getOwnPropertyDescriptor(t,l):o)&&null==o.set||(r[l]=n(e[l],i-1));if(Object.getOwnPropertySymbols)for(var a=Object.getOwnPropertySymbols(e),l=0;l<a.length;l++){var c=a[l];(h=Object.getOwnPropertyDescriptor(e,c))&&!h.enumerable&&!y||(r[c]=n(e[c],i-1),h.enumerable||Object.defineProperty(r,c,{enumerable:!1}))}if(y){var u=Object.getOwnPropertyNames(e);for(l=0;l<u.length;l++){var h,f=u[l];(h=Object.getOwnPropertyDescriptor(e,f))&&h.enumerable||(r[f]=n(e[f],i-1),Object.defineProperty(r,f,{enumerable:!1}))}}return r}(e,t=void 0===t?1/0:t)}function t(e){return Object.prototype.toString.call(e)}function O(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return P.clonePrototype=function(e){if(null===e)return null;function t(){}return t.prototype=e,new t},P.__objToStr=t,P.__isDate=function(e){return"object"==typeof e&&"[object Date]"===t(e)},P.__isArray=function(e){return"object"==typeof e&&"[object Array]"===t(e)},P.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===t(e)},P.__getRegExpFlags=O,P}();e.exports&&(e.exports=t)},5643:e=>{e.exports=!1},9134:e=>{e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron")}},6898:e=>{"use strict";e.exports=e=>!!e&&("symbol"==typeof Symbol.observable&&"function"==typeof e[Symbol.observable]?e===e[Symbol.observable]():"function"==typeof e["@@observable"]&&e===e["@@observable"]())},7996:function(e,t){var r;void 0!==(t="function"==typeof(r=function(){return e.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},e.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},e.prototype.loadKey=e.prototype.loadDatabase=function(t,r){var e=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(e,t,function(e){"function"==typeof r?0===e.id?r(null):r(e.val):console.log(e.val)}):this.catalog=new s(function(e){n.catalog=e,n.loadDatabase(t,r)})},e.prototype.saveKey=e.prototype.saveDatabase=function(t,r,n){var e=this.app,i=this;function o(e){e&&!0===e.success?n(null):n(new Error("Error saving database")),i.options.closeAfterSave&&i.closeDatabase()}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(e,t,r,o):this.catalog=new s(function(e){i.saveDatabase(t,r,o)})},e.prototype.deleteKey=e.prototype.deleteDatabase=function(t,r){var e=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(e,t,function(e){e=e.id;0!==e?n.catalog.deleteAppKey(e,r):"function"==typeof r&&r({success:!0})}):this.catalog=new s(function(e){n.catalog=e,n.deleteDatabase(t,r)})},e.prototype.deleteDatabasePartitions=function(t){var r=this;this.getDatabaseList(function(e){e.forEach(function(e){e.startsWith(t)&&r.deleteDatabase(e)})})},e.prototype.getKeyList=e.prototype.getDatabaseList=function(n){var e=this.app,t=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(e,function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].key);"function"==typeof n?n(t):t.forEach(function(e){console.log(e)})}):this.catalog=new s(function(e){t.catalog=e,t.getDatabaseList(n)})},e.prototype.getCatalogSummary=function(a){this.app;var t=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(e){for(var t,r,n,i,o=[],s=0;s<e.length;s++)r=(t=e[s]).app||"",n=t.key||"",i=t.val||"",r=2*r.length+2*n.length+i.length+1,o.push({app:t.app,key:t.key,size:r});"function"==typeof a?a(o):o.forEach(function(e){console.log(e)})}):this.catalog=new s(function(e){t.catalog=e,t.getCatalogSummary(a)})},s.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),r=this;e.onupgradeneeded=function(e){var e=e.target.result;e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),e.objectStoreNames.contains("LokiAKV")||((e=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0})).createIndex("app","app",{unique:!1}),e.createIndex("key","key",{unique:!1}),e.createIndex("appkey","appkey",{unique:!0}))},e.onsuccess=function(e){r.db=e.target.result,"function"==typeof t&&t(r)},e.onerror=function(e){throw e}},s.prototype.getAppKey=function(e,t,r){var n,i,e=e+","+t,t=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(e);t.onsuccess=(n=r,function(e){e=e.target.result;null==e&&(e={id:0,success:!1}),"function"==typeof n?n(e):console.log(e)}),t.onerror=(i=r,function(e){if("function"!=typeof i)throw e;i({id:0,success:!1})})},s.prototype.getAppKeyById=function(e,t,r){var n,i;this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(e).onsuccess=(n=r,i=t,function(e){"function"==typeof i?i(e.target.result,n):console.log(e.target.result)})},s.prototype.setAppKey=function(n,i,o,s){var t,a=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),l=a.index("appkey").get(n+","+i);l.onsuccess=function(e){e=e.target.result;null==e?e={app:n,key:i,appkey:n+","+i,val:o}:e.val=o;var t,r,e=a.put(e);e.onerror=(t=s,function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(l.error))}),e.onsuccess=(r=s,function(e){"function"==typeof r&&r({success:!0})})},l.onerror=(t=s,function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(l.error))})},s.prototype.deleteAppKey=function(e,t){var r,n,i=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(e);i.onsuccess=(r=t,function(e){"function"==typeof r&&r({success:!0})}),i.onerror=(n=t,function(e){"function"==typeof n?n({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(i.error))})},s.prototype.getAppKeys=function(e,t){var r,n,i,o=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),e=IDBKeyRange.only(e),o=o.openCursor(e);o.onsuccess=(n=[],i=t,function(e){var t,e=e.target.result;e?(t=e.value,n.push(t),e.continue()):"function"==typeof i?i(n):console.log(n)}),o.onerror=(r=t,function(e){"function"==typeof r?r(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(e))})},s.prototype.getAllKeys=function(e){var t,r,n,i=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor();i.onsuccess=(r=[],n=e,function(e){var t,e=e.target.result;e?(t=e.value,r.push(t),e.continue()):"function"==typeof n?n(r):console.log(r)}),i.onerror=(t=e,function(e){"function"==typeof t&&t(null)})},e;function e(e,t){if(this.app="loki",this.options=t||{},void 0!==e&&(this.app=e),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function s(e){this.db=null,this.initializeLokiCatalog(e)}})?r.apply(t,[]):r)&&(e.exports=t)},3050:function(e,t,N){var r=function(){"use strict";var S=Object.prototype.hasOwnProperty;function d(e){var t,r;if(Array.isArray(e)){for(r=0;r<e.length;r++)d(e[r]);s(e)}else if(null!==e&&"object"==typeof e){for(t in e)e.hasOwnProperty(t)&&d(e[t]);s(e)}}function s(e){Object.isFrozen(e)||Object.freeze(e)}function a(e){return Object.isFrozen(e)?f(e,"shallow"):e}var P={copyProperties:function(e,t){for(var r in e)t[r]=e[r]},resolveTransformObject:function(e,t,r){var n,i;if("number"!=typeof r&&(r=0),10<=++r)return e;for(n in e)"string"==typeof e[n]&&0===e[n].indexOf("[%lktxp]")?(i=e[n].substring(8),t.hasOwnProperty(i)&&(e[n]=t[i])):"object"==typeof e[n]&&(e[n]=P.resolveTransformObject(e[n],t,r));return e},resolveTransformParams:function(e,t){var r,n,i=[];if(void 0===t)return e;for(r=0;r<e.length;r++)n=f(e[r],"shallow-recurse-objects"),i.push(P.resolveTransformObject(n,t));return i},getIn:function(e,t,r){if(null!=e){if(!r)return e[t];if("string"==typeof t&&(t=t.split(".")),!Array.isArray(t))throw new Error("path must be a string or array. Found "+typeof t);for(var n=0,i=t.length;null!=e&&n<i;)e=e[t[n++]];return n&&n==i?e:void 0}}},g={aeq:e,lt:t,gt:r};function e(e,t){var r,n,i,o;if(e===t)return!0;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=e==e?9:0}switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}if(9!==i||9!==o)return i===o}return r=Number(e),n=Number(t),r==r||n==n?r===n:(r=e.toString())==t.toString()}function t(e,t,r){var n,i,o,s;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}switch(t){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=t==t?9:0}if(9!==o||9!==s)return o===s?r:o<s}return n=Number(e),i=Number(t),n==n&&i==i?n<i||!(i<n)&&r:n==n&&i!=i||(i!=i||n==n)&&(e<t||!(t<e)&&(e==t?r:(n=e.toString())<(i=t.toString())||n==i&&r))}function r(e,t,r){var n,i,o,s;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}switch(t){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=t==t?9:0}if(9!==o||9!==s)return o===s?r:s<o}return n=Number(e),i=Number(t),n==n&&i==i?i<n||!(n<i)&&r:(n!=n||i==i)&&(i==i&&n!=n||t<e||!(e<t)&&(e==t?r:(n=e.toString())>(i=t.toString())||n==i&&r))}function p(e,t,r){return g.aeq(e,t)?0:g.lt(e,t,!1)?r?1:-1:g.gt(e,t,!1)?r?-1:1:0}function O(e,t,r,n,i,o){var s,a=o||0,o=t[a],l=!1;if("object"==typeof e&&o in e&&(s=e[o]),a+1>=t.length)l=r(s,n,i);else if(Array.isArray(s))for(var c=0,u=s.length;c<u&&!0!==(l=O(s[c],t,r,n,i,a+1));c+=1);else l=O(s,t,r,n,i,a+1);return l}function n(t){return"string"==typeof t||Array.isArray(t)?function(e){return-1!==t.indexOf(e)}:"object"==typeof t&&null!==t?function(e){return S.call(t,e)}:null}function o(e,t,r){for(var n in t)if(S.call(t,n))return k[n](e,t[n],r);return!1}var k={$eq:function(e,t){return e===t},$aeq:function(e,t){return e==t},$ne:function(e,t){return t!=t?e==e:e!==t},$dteq:function(e,t){return g.aeq(e,t)},$gt:function(e,t){return g.gt(e,t,!1)},$gte:function(e,t){return g.gt(e,t,!0)},$lt:function(e,t){return g.lt(e,t,!1)},$lte:function(e,t){return g.lt(e,t,!0)},$jgt:function(e,t){return t<e},$jgte:function(e,t){return t<=e},$jlt:function(e,t){return e<t},$jlte:function(e,t){return e<=t},$between:function(e,t){return null!=e&&g.gt(e,t[0],!0)&&g.lt(e,t[1],!0)},$jbetween:function(e,t){return null!=e&&e>=t[0]&&e<=t[1]},$in:function(e,t){return-1!==t.indexOf(e)},$inSet:function(e,t){return t.has(e)},$nin:function(e,t){return-1===t.indexOf(e)},$keyin:function(e,t){return e in t},$nkeyin:function(e,t){return!(e in t)},$definedin:function(e,t){return void 0!==t[e]},$undefinedin:function(e,t){return void 0===t[e]},$regex:function(e,t){return t.test(e)},$containsString:function(e,t){return"string"==typeof e&&-1!==e.indexOf(t)},$containsNone:function(e,t){return!k.$containsAny(e,t)},$containsAny:function(e,t){e=n(e);return null!==e&&(Array.isArray(t)?t.some(e):e(t))},$contains:function(e,t){e=n(e);return null!==e&&(Array.isArray(t)?t.every(e):e(t))},$elemMatch:function(e,n){return!!Array.isArray(e)&&e.some(function(r){return Object.keys(n).every(function(e){var t=n[e];return"object"==typeof t&&t||(t={$eq:t}),-1!==e.indexOf(".")?O(r,e.split("."),o,n[e],r):o(r[e],t,r)})})},$type:function(e,t,r){var n=typeof e;return"object"===n&&(Array.isArray(e)?n="array":e instanceof Date&&(n="date")),"object"!=typeof t?n===t:o(n,t,r)},$finite:function(e,t){return t===isFinite(e)},$size:function(e,t,r){return!!Array.isArray(e)&&("object"!=typeof t?e.length===t:o(e.length,t,r))},$len:function(e,t,r){return"string"==typeof e&&("object"!=typeof t?e.length===t:o(e.length,t,r))},$where:function(e,t){return!0===t(e)},$not:function(e,t,r){return!o(e,t,r)},$and:function(e,t,r){for(var n=0,i=t.length;n<i;n+=1)if(!o(e,t[n],r))return!1;return!0},$or:function(e,t,r){for(var n=0,i=t.length;n<i;n+=1)if(o(e,t[n],r))return!0;return!1},$exists:function(e,t){return t?void 0!==e:void 0===e}},x=(["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach(function(e){var n=k[e];k["$"+e]=function(e,t,r){if("string"==typeof t)return n(e,r[t]);if("function"==typeof t)return n(e,t(r));throw new Error("Invalid argument to $$ matcher")}}),{$eq:k.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0});function f(t,e){if(null==t)return null;var r;switch(e||"parse-stringify"){case"parse-stringify":r=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":r=jQuery.extend(!0,{},t);break;case"shallow":r=Object.create(t.constructor.prototype),Object.keys(t).map(function(e){r[e]=t[e]});break;case"shallow-assign":r=Object.create(t.constructor.prototype),Object.assign(r,t);break;case"shallow-recurse-objects":r=f(t,"shallow"),Object.keys(t).forEach(function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name?r[e]=f(t[e],"shallow-recurse-objects"):Array.isArray(t[e])&&(r[e]=function(e,t){if("parse-stringify"==t)return f(e,t);for(var r=[],n=0,i=e.length;n<i;n++)r[n]=f(e[n],t);return r}(t[e],"shallow-recurse-objects"))})}return r}function i(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(e){return}}function l(){}function c(e,t){this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!t||!t.hasOwnProperty("verbose"))&&t.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};t&&t.hasOwnProperty("env")?this.ENV=t.env:this.ENV=void 0!==N.g&&(N.g.android||N.g.NSObject)?"NATIVESCRIPT":"undefined"==typeof window||void 0!==N.g&&N.g.window&&"undefined"!=typeof process?"NODEJS":"undefined"==typeof document||-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}function u(e){this.hashStore={},this.options=e||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function h(e,t){if(this.mode="reference",this.adapter=null,this.options=t||{},this.dbref=null,this.dbname="",this.pageIterator={},!e)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===e.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=e,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function y(){try{this.fs=N(693)}catch(e){this.fs=null}}function v(){}function m(e,t){return this.collection=e,this.filteredrows=[],this.filterInitialized=!1,this}function b(e,t,r){this.collection=e,this.name=t,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new m(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function w(e,t){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var a=this,r=((t=t||{}).hasOwnProperty("unique")&&(Array.isArray(t.unique)||(t.unique=[t.unique]),t.unique.forEach(function(e){a.uniqueNames.push(e)})),t.hasOwnProperty("exact")&&t.exact.forEach(function(e){a.constraints.exact[e]=new $(e)}),this.adaptiveBinaryIndices=!t.hasOwnProperty("adaptiveBinaryIndices")||t.adaptiveBinaryIndices,this.transactional=!!t.hasOwnProperty("transactional")&&t.transactional,this.cloneObjects=!!t.hasOwnProperty("clone")&&t.clone,this.cloneMethod=t.hasOwnProperty("cloneMethod")?t.cloneMethod:"parse-stringify",this.asyncListeners=!!t.hasOwnProperty("asyncListeners")&&t.asyncListeners,this.disableMeta=!!t.hasOwnProperty("disableMeta")&&t.disableMeta,this.disableChangesApi=!t.hasOwnProperty("disableChangesApi")||t.disableChangesApi,this.disableDeltaChangesApi=!t.hasOwnProperty("disableDeltaChangesApi")||t.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!t.hasOwnProperty("autoupdate")&&t.autoupdate,this.serializableIndices=!t.hasOwnProperty("serializableIndices")||t.serializableIndices,this.disableFreeze=!t.hasOwnProperty("disableFreeze")||t.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(t.ttl||-1,t.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[],[]);if(t&&t.indices)if("[object Array]"===Object.prototype.toString.call(t.indices))r=t.indices;else{if("string"!=typeof t.indices)throw new TypeError("Indices needs to be a string or an array of strings");r=[t.indices]}for(var n=0;n<r.length;n++)this.ensureIndex(r[n]);function l(e,t){var r=null!==t&&"object"==typeof t?Object.keys(t):null;if(r&&r.length&&["string","boolean","number"].indexOf(typeof t)<0){for(var n={},i=0;i<r.length;i++){var o,s=r[i];t.hasOwnProperty(s)&&(!e.hasOwnProperty(s)||0<=a.uniqueNames.indexOf(s)||"$loki"==s||"meta"==s?n[s]=t[s]:void 0!==(o=l(e[s],t[s]))&&o!={}&&(n[s]=o))}return 0===Object.keys(n).length?void 0:n}return e===t?void 0:t}function i(){a.changes=[]}this.observerCallback=function(e){var t="function"==typeof Set?new Set:[];t.add||(t.add=function(e){return-1===this.indexOf(e)&&this.push(e),this}),e.forEach(function(e){t.add(e.object)}),t.forEach(function(e){if(!S.call(e,"$loki"))return a.removeAutoUpdateObserver(e);try{a.update(e)}catch(e){}})},this.getChangeDelta=function(e,t){return t?l(t,e):JSON.parse(JSON.stringify(e))},this.getObjectDelta=l,this.getChanges=function(){return a.changes},this.flushChanges=i,this.setChangesApi=function(e){a.disableChangesApi=!e,e||(a.disableDeltaChangesApi=!1)},this.on("delete",function(e){a.disableChangesApi||a.createChange(a.name,"R",e)}),this.on("warning",function(e){a.lokiConsoleWrapper.warn(e)}),i()}function I(e){return-1!==e.indexOf(".")}function _(e){return parseFloat(e,10)}function C(e,t){return e+t}function L(e,t){return e-t}function A(e){return e.reduce(C,0)/e.length}function j(e,t,r){if(!1===r)return e[t];for(var n=t.split("."),i=e;0<n.length;)i=i[n.shift()];return i}function D(e,t,r){for(var n,i,o=0,s=e.length;o<s;){if(0===(n=r.apply(null,[t,e[i=o+s>>1]])))return{found:!0,index:i};n<0?s=i:o=1+i}return{found:!1,index:s}}function E(r){return function(e,t){return D(e,t,r)}}function M(){}function z(e){this.field=e,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function $(e){this.index=Object.create(null),this.field=e}return l.prototype.events={},l.prototype.asyncListeners=!1,l.prototype.on=function(e,t){var r,n=this;return Array.isArray(e)?e.forEach(function(e){n.on(e,t)}):(r=(r=this.events[e])?r:this.events[e]=[]).push(t),t},l.prototype.emit=function(e){var t,r=this;if(!e||!this.events[e])throw new Error("No event "+e+" defined");this.events[e].length&&(t=Array.prototype.slice.call(arguments,1),this.events[e].forEach(function(e){r.asyncListeners?setTimeout(function(){e.apply(r,t)},1):e.apply(r,t)}))},l.prototype.addListener=l.prototype.on,l.prototype.removeListener=function(e,t){var r=this;Array.isArray(e)?e.forEach(function(e){r.removeListener(e,t)}):this.events[e]&&(e=this.events[e]).splice(e.indexOf(t),1)},((c.prototype=new l).constructor=c).prototype.getIndexedAdapter=function(){return N(7996)},c.prototype.configureOptions=function(e,t){var r,n={fs:y,localStorage:v,memory:u};this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==e&&(this.options=e,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof n[e.persistenceMethod]&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new n[e.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),e.autoload&&t&&(r=this,setTimeout(function(){r.loadDatabase(e,e.autoloadCallback)},1)),this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)),this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new n[this.persistenceMethod]))},c.prototype.copy=function(e){var t,r,n=new c(this.filename,{env:"NA"});if(e=e||{},n.loadJSONObject(this,{retainDirtyFlags:!0}),e.hasOwnProperty("removeNonSerializable")&&!0===e.removeNonSerializable)for(n.autosaveHandle=null,n.persistenceAdapter=null,t=n.collections.length,r=0;r<t;r++)n.collections[r].constraints=null,n.collections[r].ttl=null;return n},c.prototype.addCollection=function(e,t){var r,n=this.collections.length;if(t&&!0===t.disableMeta){if(!1===t.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===t.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof t.ttl&&0<t.ttl)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<n;r+=1)if(this.collections[r].name===e)return this.collections[r];t=new w(e,t);return t.isIncremental=this.isIncremental,this.collections.push(t),this.verbose&&(t.lokiConsoleWrapper=console),t},c.prototype.loadCollection=function(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)},c.prototype.getCollection=function(e){for(var t=this.collections.length,r=0;r<t;r+=1)if(this.collections[r].name===e)return this.collections[r];return this.emit("warning","collection "+e+" not found"),null},c.prototype.renameCollection=function(e,t){e=this.getCollection(e);return e&&(e.name=t),e},c.prototype.listCollections=function(){for(var e=this.collections.length,t=[];e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t},c.prototype.removeCollection=function(e){for(var t=this.collections.length,r=0;r<t;r+=1)if(this.collections[r].name===e){var n,i=new w(e,{}),o=this.collections[r];for(n in o)o.hasOwnProperty(n)&&i.hasOwnProperty(n)&&(o[n]=i[n]);return void this.collections.splice(r,1)}},c.prototype.getName=function(){return this.name},c.prototype.serializeReplacer=function(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":case"lokiConsoleWrapper":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return t}},c.prototype.toJson=c.prototype.serialize=function(e){switch((e=e||{}).hasOwnProperty("serializationMethod")||(e.serializationMethod=this.options.serializationMethod),e.serializationMethod){case"normal":default:return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured()}},c.prototype.serializeDestructured=function(e){var t,r,n,i,o,s=[];if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),!0===e.partitioned&&e.hasOwnProperty("partition")&&0<=e.partition)return this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:e.partition});for((o=new c(this.filename)).loadJSONObject(this),t=0;t<o.collections.length;t++)o.collections[t].data=[];if(!0===e.partitioned&&-1===e.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,t=0;t<this.collections.length;t++)if(n=this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:t}),!1===e.partitioned&&!1===e.delimited){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=n.length,r=0;r<i;r++)s.push(n[r]),n[r]=null;s.push("")}else s.push(n);return e.partitioned?(e.delimited,s):e.delimited?(s.push(""),s.join(e.delimiter)):(s.push(""),s)},c.prototype.serializeCollection=function(e){var t,r,n=[];if((e=e||{}).hasOwnProperty("delimited")||(e.delimited=!0),!e.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(t=this.collections[e.collectionIndex].data.length,n=[],r=0;r<t;r++)n.push(JSON.stringify(this.collections[e.collectionIndex].data[r]));return e.delimited?(n.push(""),n.join(e.delimiter)):n},c.prototype.deserializeDestructured=function(e,t){var r,n,i,o=[],s=0,a=1,l=!1;if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.partitioned){if(t.hasOwnProperty("partition"))return-1===t.partition?JSON.parse(e[0]):this.deserializeCollection(e[t.partition+1],t);for(n=(r=JSON.parse(e[0])).collections.length,s=0;s<n;s++)r.collections[s].data=this.deserializeCollection(e[s+1],t);return r}if(t.delimited){if(o=e.split(t.delimiter),e=null,0===o.length)return null}else o=e;for(n=(r=JSON.parse(o[0])).collections.length,o[0]=null;!l;)o[a],""===o[a]?++s>n&&(l=!0):(i=JSON.parse(o[a]),r.collections[s].data.push(i)),o[a++]=null;return r},c.prototype.deserializeCollection=function(e,t){var r,n,i=[];for((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.delimited?(i=e.split(t.delimiter)).pop():i=e,n=i.length,r=0;r<n;r++)i[r]=JSON.parse(i[r]);return i},c.prototype.loadJSON=function(e,t){var r;if(0===e.length)r={};else switch(this.options.serializationMethod){case"normal":case"pretty":default:r=JSON.parse(e);break;case"destructured":r=this.deserializeDestructured(e)}this.loadJSONObject(r,t)},c.prototype.loadJSONObject=function(e,t){var r,n,i,o,s,a,l=0,c=e.collections?e.collections.length:0;for(this.name=e.name,e.hasOwnProperty("throttledSaves")&&t&&!t.hasOwnProperty("throttledSaves")&&(this.throttledSaves=e.throttledSaves),this.collections=[];l<c;l+=1){if(r=e.collections[l],(n=this.addCollection(r.name,{disableChangesApi:r.disableChangesApi,disableDeltaChangesApi:r.disableDeltaChangesApi,disableMeta:r.disableMeta,disableFreeze:!r.hasOwnProperty("disableFreeze")||r.disableFreeze})).adaptiveBinaryIndices=!!r.hasOwnProperty("adaptiveBinaryIndices")&&!0===r.adaptiveBinaryIndices,n.transactional=r.transactional,n.asyncListeners=r.asyncListeners,n.cloneObjects=r.cloneObjects,n.cloneMethod=r.cloneMethod||"parse-stringify",n.autoupdate=r.autoupdate,n.changes=r.changes,n.dirtyIds=r.dirtyIds||[],t&&!0===t.retainDirtyFlags?n.dirty=r.dirty:n.dirty=!1,i=r.data.length,o=0,t&&t.hasOwnProperty(r.name))for(s=function(e){var r,n=t[e.name];return n.proto?(r=n.inflate||P.copyProperties,function(e){var t=new n.proto;return r(e,t),t}):n.inflate}(r);o<i;o++)a=s(r.data[o]),n.data[o]=a,n.addAutoUpdateObserver(a),n.disableFreeze||d(n.data[o]);else for(;o<i;o++)n.data[o]=r.data[o],n.addAutoUpdateObserver(n.data[o]),n.disableFreeze||d(n.data[o]);if(n.maxId=void 0===r.maxId?0:r.maxId,void 0!==r.binaryIndices&&(n.binaryIndices=r.binaryIndices),void 0!==r.transforms&&(n.transforms=r.transforms),n.uniqueNames=[],r.hasOwnProperty("uniqueNames")&&(n.uniqueNames=r.uniqueNames),void 0!==r.DynamicViews){for(var u=0;u<r.DynamicViews.length;u++){var h=r.DynamicViews[u],f=n.addDynamicView(h.name,h.options);f.resultdata=h.resultdata,f.resultsdirty=h.resultsdirty,f.filterPipeline=h.filterPipeline,f.sortCriteriaSimple=h.sortCriteriaSimple,f.sortCriteria=h.sortCriteria,f.sortFunction=null,f.sortDirty=h.sortDirty,n.disableFreeze||(d(f.filterPipeline),f.sortCriteriaSimple?d(f.sortCriteriaSimple):f.sortCriteria&&d(f.sortCriteria)),f.resultset.filteredrows=h.resultset.filteredrows,f.resultset.filterInitialized=h.resultset.filterInitialized,f.rematerialize({removeWhereFilters:!0})}e.databaseVersion<1.5&&(n.ensureAllIndexes(!0),n.dirty=!0)}}},c.prototype.close=function(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(e),e=void 0)),e&&this.on("close",e),this.emit("close")},c.prototype.generateChangesNotification=function(e){function t(e){return e.name}var r=[],n=e||this.collections.map(t);return this.collections.forEach(function(e){-1!==n.indexOf(t(e))&&(r=r.concat(e.getChanges()))}),r},c.prototype.serializeChanges=function(e){return JSON.stringify(this.generateChangesNotification(e))},c.prototype.clearChanges=function(){this.collections.forEach(function(e){e.flushChanges&&e.flushChanges()})},u.prototype.loadDatabase=function(e,t){var r=this;this.options.asyncResponses?setTimeout(function(){r.hashStore.hasOwnProperty(e)?t(r.hashStore[e].value):t(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(e)?t(this.hashStore[e].value):t(null)},u.prototype.saveDatabase=function(e,t,r){var n,i=this;this.options.asyncResponses?setTimeout(function(){n=i.hashStore.hasOwnProperty(e)?i.hashStore[e].savecount:0,i.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r()},this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(e)?this.hashStore[e].savecount:0,this.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r())},u.prototype.deleteDatabase=function(e,t){this.hashStore.hasOwnProperty(e)&&delete this.hashStore[e],"function"==typeof t&&t()},h.prototype.loadDatabase=function(e,r){var n=this;this.dbname=e,this.dbref=new c(e),this.adapter.loadDatabase(e,function(e){var t;e?("string"!=typeof e&&r(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()")),t=JSON.parse(e),n.dbref.loadJSONObject(t),t=null,n.dbref.collections.length,0!==n.dbref.collections.length?(n.pageIterator={collection:0,pageIndex:0},n.loadNextPartition(0,function(){r(n.dbref)})):r(n.dbref)):r(e)})},h.prototype.loadNextPartition=function(t,r){var e=this.dbname+"."+t,n=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(r);this.adapter.loadDatabase(e,function(e){e=n.dbref.deserializeCollection(e,{delimited:!0,collectionIndex:t});n.dbref.collections[t].data=e,++t<n.dbref.collections.length?n.loadNextPartition(t,r):r()})},h.prototype.loadNextPage=function(i){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,o=this;this.adapter.loadDatabase(e,function(e){var t,r=e.split(o.options.delimiter),n=r.length,e=(e="")===r[n-1];for(e&&(r.pop(),""===r[(n=r.length)-1]&&1===n&&(r.pop(),n=r.length)),t=0;t<n;t++)o.dbref.collections[o.pageIterator.collection].data.push(JSON.parse(r[t])),r[t]=null;r=[],e?++o.pageIterator.collection<o.dbref.collections.length?o.loadNextPartition(o.pageIterator.collection,i):i():(o.pageIterator.pageIndex++,o.loadNextPage(i))})},h.prototype.exportDatabase=function(e,t,r){var n,i=t.collections.length;for(this.dbref=t,this.dbname=e,this.dirtyPartitions=[-1],n=0;n<i;n++)t.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition(function(e){r(e)})},h.prototype.saveNextPartition=function(t){var r=this,e=this.dirtyPartitions.shift(),n=this.dbname+(-1===e?"":"."+e);if(this.options.paging&&-1!==e)return this.pageIterator={collection:e,docIndex:0,pageIndex:0},void this.saveNextPage(function(e){0===r.dirtyPartitions.length?t(e):r.saveNextPartition(t)});e=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:e});this.adapter.saveDatabase(n,e,function(e){e?t(e):0===r.dirtyPartitions.length?t(null):r.saveNextPartition(t)})},h.prototype.saveNextPage=function(t){function e(e){c="",e&&t(e),u?t(null):(n.pageIterator.pageIndex++,n.saveNextPage(t))}var r,n=this,i=this.dbref.collections[this.pageIterator.collection],o=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,s=0,a=i.data.length,l=this.options.delimiter.length,c="",u=!1,h=!1;for(0===i.data.length&&(u=!0);;)if(u||(r=JSON.stringify(i.data[this.pageIterator.docIndex]),c+=r,s+=r.length,++this.pageIterator.docIndex>=a&&(u=!0)),(h=s>=this.options.pageSize?!0:h)&&!u||(c+=this.options.delimiter,s+=l),u||h)return void this.adapter.saveDatabase(o,c,e)},y.prototype.loadDatabase=function(r,n){var i=this;this.fs.stat(r,function(e,t){!e&&t.isFile()?i.fs.readFile(r,{encoding:"utf8"},function(e,t){n(e?new Error(e):t)}):n(null)})},y.prototype.saveDatabase=function(t,e,r){var n=this,i=t+"~";this.fs.writeFile(i,e,function(e){e?r(new Error(e)):n.fs.rename(i,t,r)})},y.prototype.deleteDatabase=function(e,t){this.fs.unlink(e,function(e){e?t(new Error(e)):t()})},v.prototype.loadDatabase=function(e,t){i()?t(localStorage.getItem(e)):t(new Error("localStorage is not available"))},v.prototype.saveDatabase=function(e,t,r){i()?(localStorage.setItem(e,t),r(null)):r(new Error("localStorage is not available"))},v.prototype.deleteDatabase=function(e,t){i()?(localStorage.removeItem(e),t(null)):t(new Error("localStorage is not available"))},c.prototype.throttledSaveDrain=function(e,t){var r=this,n=(new Date).getTime();this.throttledSaves||e(!0),(t=t||{}).hasOwnProperty("recursiveWait")||(t.recursiveWait=!0),t.hasOwnProperty("recursiveWaitLimit")||(t.recursiveWaitLimit=!1),t.hasOwnProperty("recursiveWaitLimitDuration")||(t.recursiveWaitLimitDuration=2e3),t.hasOwnProperty("started")||(t.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending?t.recursiveWait?this.throttledCallbacks.push(function(){return r.throttledSavePending?t.recursiveWaitLimit&&n-t.started>t.recursiveWaitLimitDuration?void e(!1):void r.throttledSaveDrain(e,t):void e(!0)}):this.throttledCallbacks.push(e):e(!0)},c.prototype.loadDatabaseInternal=function(r,e){var n=e||function(e,t){if(e)throw e},i=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(e){if("string"==typeof e){var t=!1;try{i.loadJSON(e,r||{}),t=!0}catch(e){n(e)}t&&(n(null),i.emit("loaded","database "+i.filename+" loaded"))}else{if(e)return e instanceof Error?void n(e):"object"==typeof e?(i.loadJSONObject(e,r||{}),n(null),void i.emit("loaded","database "+i.filename+" loaded")):void n("unexpected adapter response : "+e);n(null),void i.emit("loaded","empty database "+i.filename+" loaded")}}):n(new Error("persistenceAdapter not configured"))},c.prototype.loadDatabase=function(t,r){var n=this;this.throttledSaves?this.throttledSaveDrain(function(e){if(e)return n.throttledSavePending=!0,void n.loadDatabaseInternal(t,function(e){0===n.throttledCallbacks.length?n.throttledSavePending=!1:n.saveDatabase(),"function"==typeof r&&r(e)});"function"==typeof r&&r(new Error("Unable to pause save throttling long enough to read database"))},t):this.loadDatabaseInternal(t,r)},c.prototype.saveDatabaseInternal=function(e){var r,t=e||function(e){if(e)throw e},n=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,function(){var e;if(n.ignoreAutosave=!1,!r)return e=n.copy({removeNonSerializable:!0}),r=n.collections.map(function(e){return[e.dirty,e.dirtyIds]}),n.collections.forEach(function(e){e.dirty=!1,e.dirtyIds=[]}),e;t(new Error("adapter error - getLokiCopy called more than once"))},function(e){n.ignoreAutosave=!1,e&&r&&n.collections.forEach(function(e,t){t=r[t];e.dirty=e.dirty||t[0],e.dirtyIds=e.dirtyIds.concat(t[1])}),t(e)})):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(e){n.autosaveClearFlags(),t(e)}):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),function(e){t(e)})):t(new Error("persistenceAdapter not configured"))},c.prototype.save=c.prototype.saveDatabase=function(e){var r,n;this.throttledSaves?this.throttledSavePending?this.throttledCallbacks.push(e):(r=this.throttledCallbacks,this.throttledCallbacks=[],r.unshift(e),this.throttledSavePending=!0,(n=this).saveDatabaseInternal(function(t){n.throttledSavePending=!1,r.forEach(function(e){"function"==typeof e&&setTimeout(function(){e(t)},1)}),0<n.throttledCallbacks.length&&n.saveDatabase()})):this.saveDatabaseInternal(e)},c.prototype.deleteDatabase=function(e,t){var r="function"!=typeof e||t?t||function(e,t){if(e)throw e}:e;null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(e){r(e)}):r(new Error("persistenceAdapter not configured"))},c.prototype.autosaveDirty=function(){for(var e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1},c.prototype.autosaveClearFlags=function(){for(var e=0;e<this.collections.length;e++)this.collections[e].dirty=!1},c.prototype.autosaveEnable=function(e,t){this.autosave=!0;var r=5e3,n=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(r=this.autosaveInterval),this.autosaveHandle=setInterval(function(){n.autosaveDirty()&&!n.ignoreAutosave&&n.saveDatabase(t)},r)},c.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},m.prototype.reset=function(){return 0<this.filteredrows.length&&(this.filteredrows=[]),this.filterInitialized=!1,this},m.prototype.toJSON=function(){var e=this.copy();return e.collection=null,e},m.prototype.limit=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var t=new m(this.collection);return t.filteredrows=this.filteredrows.slice(0,e),t.filterInitialized=!0,t},m.prototype.offset=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var t=new m(this.collection);return t.filteredrows=this.filteredrows.slice(e),t.filterInitialized=!0,t},m.prototype.branch=m.prototype.copy=function(){var e=new m(this.collection);return 0<this.filteredrows.length&&(e.filteredrows=this.filteredrows.slice()),e.filterInitialized=this.filterInitialized,e},m.prototype.transform=function(e,t){var r,n,i=this;if("object"!=typeof(e="string"==typeof e&&this.collection.transforms.hasOwnProperty(e)?this.collection.transforms[e]:e)||!Array.isArray(e))throw new Error("Invalid transform");for(void 0!==t&&(e=P.resolveTransformParams(e,t)),r=0;r<e.length;r++)switch((n=e[r]).type){case"find":i.find(n.value);break;case"where":i.where(n.value);break;case"simplesort":i.simplesort(n.property,n.desc||n.options);break;case"compoundsort":i.compoundsort(n.value);break;case"sort":i.sort(n.value);break;case"limit":i=i.limit(n.value);break;case"offset":i=i.offset(n.value);break;case"map":i=i.map(n.value,n.dataOptions);break;case"eqJoin":i=i.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":i=i.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":i.update(n.value);break;case"remove":i.remove()}return i},m.prototype.sort=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var r,n;r=e,n=this.collection.data;return this.filteredrows.sort(function(e,t){return r(n[e],n[t])}),this},m.prototype.simplesort=function(r,e){var t=10,n=this.collection.data.length,i=this.filteredrows.length,o=this.collection.binaryIndices.hasOwnProperty(r);if(!0===(e=void 0!==e&&!1!==e?e:{desc:!1})&&(e={desc:!0}),0===i){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(r))return this.collection.ensureIndex(r),this.filteredrows=this.collection.binaryIndices[r].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&o&&(n/i<=(t=e.useJavascriptSorting?6:t)||e.forceIndexIntersect)){for(var s=this.filteredrows,a={},l=0;l<i;l++)a[s[l]]=!0;o=this.collection.binaryIndices[r].values;return this.filteredrows=o.filter(function(e){return a[e]}),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort(function(e,t){return e[r]===t[r]?0:e[r]>t[r]?1:e[r]<t[r]?-1:void 0});var c,u,h,f,d;c=r,u=e.desc,h=this.collection.data;return this.filteredrows.sort(function(e,t){return d=~c.indexOf(".")?(d=c.split("."),f=P.getIn(h[e],d,!0),P.getIn(h[t],d,!0)):(f=h[e][c],h[t][c]),p(f,d,u)}),this},m.prototype.compoundsort=function(e){if(0===e.length)throw new Error("Invalid call to compoundsort, need at least one property");var t;if(1===e.length)return t=e[0],Array.isArray(t)?this.simplesort(t[0],t[1]):this.simplesort(t,!1);for(var r=0,n=e.length;r<n;r+=1)t=e[r],Array.isArray(t)||(e[r]=[t,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var h,f;h=e,f=this.collection.data;return this.filteredrows.sort(function(e,t){for(var r,n,i,o,s=h,a=f[e],l=f[t],c=0,u=s.length;c<u;c++)if(i=~(o=(r=s[c])[0]).indexOf(".")?(i=o.split("."),n=P.getIn(a,i,!0),P.getIn(l,i,!0)):(n=a[o],l[o]),0!==(o=p(n,i,r[1])))return o;return 0}),this},m.prototype.$or=m.prototype.findOr=function(e){for(var t,r,n,i=0,o=[],s=[],a=(this.count(),0),l=e.length;a<l;a++)for(r=(t=this.branch().find(e[a]).filteredrows).length,i=0;i<r;i++)void 0===s[n=t[i]]&&(s[n]=!0,o.push(n));return this.filteredrows=o,this.filterInitialized=!0,this},m.prototype.$and=m.prototype.findAnd=function(e){for(var t=0,r=e.length;t<r;t++){if(0===this.count())return this;this.find(e[t])}return this},m.prototype.find=function(e,t){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var r,n,i,o,s,a,l,c=e||"getAll",e=!1,u=[],h=[],f=null;if(t=t||!1,"object"==typeof c){for(r in c)(o={})[r]=c[r],h.push(o),S.call(c,r)&&(n=r,i=c[r]);if(1<h.length)return this.find({$and:h},t)}if(!n||"getAll"===c)return t&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=0<this.collection.data.length?[0]:[],this.filterInitialized=!0)),this;if("$and"===n||"$or"===n)return this[n](i),t&&1<this.filteredrows.length&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===i||"object"!=typeof i||i instanceof Date)s="$eq",a=i;else{if("object"!=typeof i)throw new Error("Do not know what you want to do.");for(l in i)if(S.call(i,l)){a=i[s=l];break}}"$regex"!==s&&"object"!=typeof a||(a=function e(t,r){if("$regex"===t)Array.isArray(r)?r=new RegExp(r[0],r[1]):r instanceof RegExp||(r=new RegExp(r));else if("object"==typeof r)for(var n in r)"$regex"!==n&&"object"!=typeof r[n]||(r[n]=e(n,r[n]));return r}(s,a));var d=-1!==n.indexOf(".");!this.filterInitialized&&this.collection.binaryIndices[n]&&x[s]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(n),e=!0,f=this.collection.binaryIndices[n]),!e&&"$in"===s&&Array.isArray(a)&&"undefined"!=typeof Set&&(a=new Set(a),s="$inSet");var p,y,v=k[s],m=this.collection.data,g=0,b=0,w=0;if(this.filterInitialized){if(b=(p=this.filteredrows).length,d){for(n=n.split("."),g=0;g<b;g++)if(O(y=m[w=p[g]],n,v,a,y)&&(u.push(w),t))return this.filteredrows=u,this}else for(g=0;g<b;g++)if(v((y=m[w=p[g]])[n],a,y)&&(u.push(w),t))return this.filteredrows=u,this}else if(e){var I=this.collection.calculateRange(s,n,a);if("$in"!==s){for(g=I[0];g<=I[1];g++)if(!0!==x[s]){if(x[s](P.getIn(m[f.values[g]],n,d),a)&&(u.push(f.values[g]),t))return this.filteredrows=u,this.filterInitialized=!0,this}else if(u.push(f.values[g]),t)return this.filteredrows=u,this.filterInitialized=!0,this}else for(g=0,b=I.length;g<b;g++)if(u.push(f.values[I[g]]),t)return this.filteredrows=u,this.filterInitialized=!0,this}else if(b=m.length,d){for(n=n.split("."),g=0;g<b;g++)if(O(y=m[g],n,v,a,y)&&(u.push(g),t))return this.filteredrows=u,this.filterInitialized=!0,this}else for(g=0;g<b;g++)if(v((y=m[g])[n],a,y)&&(u.push(g),t))return this.filteredrows=u,this.filterInitialized=!0,this;return this.filteredrows=u,this.filterInitialized=!0,this},m.prototype.where=function(e){var t,r=[];if("function"!=typeof e)throw new TypeError("Argument is not a stored view or a function");t=e;try{if(this.filterInitialized){for(var n=this.filteredrows.length;n--;)!0===t(this.collection.data[this.filteredrows[n]])&&r.push(this.filteredrows[n]);return this.filteredrows=r,this}for(var i=this.collection.data.length;i--;)!0===t(this.collection.data[i])&&r.push(i);return this.filteredrows=r,this.filterInitialized=!0,this}catch(e){throw e}},m.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},m.prototype.data=function(e){var t,r,n,i=[],o=this.collection.data;if((e=e||{}).removeMeta&&!e.forceClones&&(e.forceClones=!0,e.forceCloneMethod=e.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(e.forceClones=!0,e.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||e.forceClones){for(a=o.length,n=e.forceCloneMethod||this.collection.cloneMethod,r=0;r<a;r++)t=f(o[r],n),e.removeMeta&&(delete t.$loki,delete t.meta),i.push(t);return i}return o.slice()}this.filterInitialized=!0}var s=this.filteredrows,a=s.length;if(this.collection.cloneObjects||e.forceClones)for(n=e.forceCloneMethod||this.collection.cloneMethod,r=0;r<a;r++)t=f(o[s[r]],n),e.removeMeta&&(delete t.$loki,delete t.meta),i.push(t);else for(r=0;r<a;r++)i.push(o[s[r]]);return i},m.prototype.update=function(e){if("function"!=typeof e)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var t,r=this.filteredrows.length,n=this.collection.data,i=0;i<r;i++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(e(n[this.filteredrows[i]]),this.collection.update(n[this.filteredrows[i]])):(e(t=f(n[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(t));return this},m.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},m.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(e){throw e}},m.prototype.eqJoin=function(e,t,r,n,i){var o,s,a=[],l=[],c="function"==typeof t,u="function"==typeof r,h={},f=(s=this.data(i)).length;if(e instanceof w)a=e.chain().data(i);else if(e instanceof m)a=e.data(i);else{if(!Array.isArray(e))throw new TypeError("joinData needs to be an array or result set");a=e}for(var d=a.length,p=0;p<d;p++)h[o=u?r(a[p]):a[p][r]]=a[p];n=n||function(e,t){return{left:e,right:t}};for(var y=0;y<f;y++)o=c?t(s[y]):s[y][t],l.push(n(s[y],h[o]||{}));return this.collection=new w("joinData"),this.collection.insert(l),this.filteredrows=[],this.filterInitialized=!1,this},m.prototype.map=function(e,t){t=this.data(t).map(e);return this.collection=new w("mappedData"),this.collection.insert(t),this.filteredrows=[],this.filterInitialized=!1,this},((b.prototype=new l).constructor=b).prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},b.prototype.rematerialize=function(e){e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new m(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var t,r,n,i=Object.isFrozen(this.filterPipeline);if(e.hasOwnProperty("removeWhereFilters"))for(i&&(this.filterPipeline=this.filterPipeline.slice()),r=t=this.filterPipeline.length;r--;)"where"===this.filterPipeline[r].type&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var o=this.filterPipeline;for(this.filterPipeline=[],t=o.length,n=0;n<t;n++)this.applyFind(o[n].val,o[n].uid);return i&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},b.prototype.branchResultset=function(e,t){var r=this.resultset.branch();return void 0===e?r:r.transform(e,t)},b.prototype.toJSON=function(){var e=new b(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortCriteriaSimple=this.sortCriteriaSimple||null,e.sortDirty=this.sortDirty,e.collection=null,e},b.prototype.removeFilters=function(e){e=e||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var t=Object.isFrozen(this.filterPipeline),r=0<this.filterPipeline.length;this.filterPipeline=[],t&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,!(this.sortDirty=!1)===e.queueSortPhase&&this.queueSortPhase(),r&&this.emit("filter")},b.prototype.applySort=function(e){return this.sortFunction=e,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},b.prototype.applySimpleSort=function(e,t){return this.sortCriteriaSimple={propname:e,options:t||!1},this.collection.disableFreeze||d(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},b.prototype.applySortCriteria=function(e){return this.sortCriteria=e,this.collection.disableFreeze||d(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},b.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},b.prototype.commit=function(){return this.cachedresultset=null,this},b.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},b.prototype._indexOfFilterWithId=function(e){if("string"==typeof e||"number"==typeof e)for(var t=0,r=this.filterPipeline.length;t<r;t+=1)if(e===this.filterPipeline[t].uid)return t;return-1},b.prototype._addFilter=function(e){var t=Object.isFrozen(this.filterPipeline);t&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||d(e),this.filterPipeline.push(e),t&&Object.freeze(this.filterPipeline),this.resultset[e.type](e.val)},b.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var e=this.filterPipeline,t=Object.isFrozen(e);this.filterPipeline=[];for(var r=0,n=e.length;r<n;r+=1)this._addFilter(e[r]);return t&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},b.prototype.applyFilter=function(e){var t,r=this._indexOfFilterWithId(e.uid);return 0<=r?((t=Object.isFrozen(this.filterPipeline))&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[r]=e,t&&(s(e),Object.freeze(this.filterPipeline)),this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(e),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this)},b.prototype.applyFind=function(e,t){return this.applyFilter({type:"find",val:e,uid:t}),this},b.prototype.applyWhere=function(e,t){return this.applyFilter({type:"where",val:e,uid:t}),this},b.prototype.removeFilter=function(e){var t=this._indexOfFilterWithId(e);if(t<0)throw new Error("Dynamic view does not contain a filter with ID: "+e);e=Object.isFrozen(this.filterPipeline);return e&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(t,1),e&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},b.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},b.prototype.data=function(e){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(e)},b.prototype.queueRebuildEvent=function(){var e;this.rebuildPending||(this.rebuildPending=!0,e=this,setTimeout(function(){e.rebuildPending&&(e.rebuildPending=!1,e.emit("rebuild",e))},this.options.minRebuildInterval))},b.prototype.queueSortPhase=function(){var e;this.sortDirty||(this.sortDirty=!0,"active"===(e=this).options.sortPriority?setTimeout(function(){e.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent())},b.prototype.performSortPhase=function(e){(this.sortDirty||this.resultsdirty)&&(e=e||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),e.suppressRebuildEvent||this.emit("rebuild",this))},b.prototype.evaluateDocument=function(e,t){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var r,n=this.resultset.filteredrows,t=t?-1:n.indexOf(+e),i=n.length,o=new m(this.collection);o.filteredrows=[e],o.filterInitialized=!0;for(var s=0,a=this.filterPipeline.length;s<a;s++)o[(r=this.filterPipeline[s]).type](r.val);var l=0===o.filteredrows.length?-1:0;return-1!==t||-1!=l?-1===t&&-1!=l?(n.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==t&&-1==l?(t<i-1?(n.splice(t,1),this.options.persistent&&this.resultdata.splice(t,1)):(n.length=i-1,this.options.persistent&&(this.resultdata.length=i-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==t&&-1!=l?(this.options.persistent&&(this.resultdata[t]=this.collection.data[e]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},b.prototype.removeDocument=function(e){var t,r,n,i={},o={},s=this.resultset,a=this.resultset.filteredrows,l=a.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(r=(e=Array.isArray(e)?e:[e]).length,t=0;t<r;t++)i[e[t]]=!0;for(c=0;c<l;c++)i[a[c]]&&(o[c]=!0);0<Object.keys(o).length&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(e,t){return!o[t]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(e,t){return!o[t]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(var l=s.filteredrows.length,c=0;c<l;c++)n=e.filter(function(t){return function(e){return e<s.filteredrows[t]}}(c)),s.filteredrows[c]-=n.length},b.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(e){throw e}},((w.prototype=new l).contructor=w).prototype.createChange=function(e,t,r,n){this.changes.push({name:e,operation:t,obj:"U"!=t||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(r)):this.getChangeDelta(r,n)})},w.prototype.insertMeta=function(e){var t,r;if(!this.disableMeta&&e)if(Array.isArray(e))for(t=e.length,r=0;r<t;r++)e[r].hasOwnProperty("meta")||(e[r].meta={}),e[r].meta.created=(new Date).getTime(),e[r].meta.revision=0;else e.meta||(e.meta={}),e.meta.created=(new Date).getTime(),e.meta.revision=0},w.prototype.updateMeta=function(e){return!this.disableMeta&&e&&(this.disableFreeze||((e=a(e)).meta=a(e.meta)),e.meta.updated=(new Date).getTime(),e.meta.revision+=1),e},w.prototype.createInsertChange=function(e){this.createChange(this.name,"I",e)},w.prototype.createUpdateChange=function(e,t){this.createChange(this.name,"U",e,t)},w.prototype.insertMetaWithChange=function(e){this.insertMeta(e),this.createInsertChange(e)},w.prototype.updateMetaWithChange=function(e,t,r){return e=this.updateMeta(e,r),this.createUpdateChange(e,t),e},w.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},w.prototype.addAutoUpdateObserver=function(e){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(e,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},w.prototype.removeAutoUpdateObserver=function(e){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(e,this.observerCallback)},w.prototype.addTransform=function(e,t){if(this.transforms.hasOwnProperty(e))throw new Error("a transform by that name already exists");this.transforms[e]=t},w.prototype.getTransform=function(e){return this.transforms[e]},w.prototype.setTransform=function(e,t){this.transforms[e]=t},w.prototype.removeTransform=function(e){delete this.transforms[e]},w.prototype.byExample=function(e){var t,r,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(((r={})[t]=e[t],r));return{$and:n}},w.prototype.findObject=function(e){return this.findOne(this.byExample(e))},w.prototype.findObjects=function(e){return this.find(this.byExample(e))},w.prototype.ttlDaemonFuncGen=function(){var e=this,r=this.ttl.age;return function(){var t=Date.now();e.chain().where(function(e){e=e.meta.updated||e.meta.created;return r<t-e}).remove()}},w.prototype.setTTL=function(e,t){e<0?clearInterval(this.ttl.daemon):(this.ttl.age=e,this.ttl.ttlInterval=t,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),t))},w.prototype.prepareFullDocIndex=function(){for(var e=this.data.length,t=new Array(e),r=0;r<e;r+=1)t[r]=r;return t},w.prototype.configureOptions=function(e){(e=e||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=e.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},w.prototype.ensureIndex=function(e,t){if(void 0===t&&(t=!1),null==e)throw new Error("Attempting to set index without an associated property");var r,n,i,o,s;this.binaryIndices[e]&&!t&&!this.binaryIndices[e].dirty||!0===this.adaptiveBinaryIndices&&this.binaryIndices.hasOwnProperty(e)&&!t||(t={name:e,dirty:!0,values:this.prepareFullDocIndex()},this.binaryIndices[e]=t,r=e,n=this.data,s=!!~r.indexOf(".")&&r.split("."),t.values.sort(function(e,t){if(o=s?(i=P.getIn(n[e],s,!0),P.getIn(n[t],s,!0)):(i=n[e][r],n[t][r]),i!==o){if(g.lt(i,o,!1))return-1;if(g.gt(i,o,!1))return 1}return 0}),t.dirty=!1,this.dirty=!0)},w.prototype.checkAllIndexes=function(e){var t,r=this.binaryIndices,n=[];for(t in r)!S.call(r,t)||this.checkIndex(t,e)||n.push(t);return n},w.prototype.checkIndex=function(e,t){(t=t||{}).randomSamplingFactor&&!1!==t.randomSampling&&(t.randomSampling=!0),t.randomSamplingFactor=t.randomSamplingFactor||.1,(t.randomSamplingFactor<0||1<t.randomSamplingFactor)&&(t.randomSamplingFactor=.1);var r,n,i,o,s,a=!0;if(!this.binaryIndices.hasOwnProperty(e))throw new Error("called checkIndex on property without an index: "+e);if(this.adaptiveBinaryIndices||this.ensureIndex(e),(o=(s=this.binaryIndices[e].values).length)!==this.data.length)return t.repair&&this.ensureIndex(e,!0),!1;if(0===o)return!0;var l=-1!==e.indexOf(".");if(1===o)a=0===s[0];else if(t.randomSampling){if(k.$lte(P.getIn(this.data[s[0]],e,l),P.getIn(this.data[s[1]],e,l))||(a=!1),a=k.$lte(P.getIn(this.data[s[o-2]],e,l),P.getIn(this.data[s[o-1]],e,l))?a:!1)for(n=Math.floor((o-1)*t.randomSamplingFactor),r=0;r<n-1;r++)if(i=Math.floor(Math.random()*(o-1)),!k.$lte(P.getIn(this.data[s[i]],e,l),P.getIn(this.data[s[i+1]],e,l))){a=!1;break}}else for(r=0;r<o-1;r++)if(!k.$lte(P.getIn(this.data[s[r]],e,l),P.getIn(this.data[s[r+1]],e,l))){a=!1;break}return!a&&t.repair&&this.ensureIndex(e,!0),a},w.prototype.getBinaryIndexValues=function(e){for(var t=this.binaryIndices[e].values,r=[],n=0;n<t.length;n++)r.push(P.getIn(this.data[t[n]],e,!0));return r},w.prototype.getUniqueIndex=function(e,t){var r=this.constraints.unique[e];return!r&&t?this.ensureUniqueIndex(e):r},w.prototype.ensureUniqueIndex=function(e){var t=this.constraints.unique[e];return t||-1==this.uniqueNames.indexOf(e)&&this.uniqueNames.push(e),this.constraints.unique[e]=t=new z(e),this.data.forEach(function(e){t.set(e)}),t},w.prototype.ensureAllIndexes=function(e){var t,r=this.binaryIndices;for(t in r)S.call(r,t)&&this.ensureIndex(t,e)},w.prototype.flagBinaryIndexesDirty=function(){var e,t=this.binaryIndices;for(e in t)S.call(t,e)&&(t[e].dirty=!0)},w.prototype.flagBinaryIndexDirty=function(e){this.binaryIndices[e]&&(this.binaryIndices[e].dirty=!0)},w.prototype.count=function(e){return(e?this.chain().find(e).filteredrows:this.data).length},w.prototype.ensureId=function(){if(!this.idIndex){for(var e=this.data,t=0,r=e.length,n=new Array(r);t<r;t++)n[t]=e[t].$loki;this.idIndex=n}},w.prototype.ensureIdAsync=function(e){this.async(function(){this.ensureId()},e)},w.prototype.addDynamicView=function(e,t){e=new b(this,e,t);return this.DynamicViews.push(e),e},w.prototype.removeDynamicView=function(t){this.DynamicViews=this.DynamicViews.filter(function(e){return e.name!==t})},w.prototype.getDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null},w.prototype.findAndUpdate=function(e,t){"function"==typeof e?this.updateWhere(e,t):this.chain().find(e).update(t)},w.prototype.findAndRemove=function(e){this.chain().find(e).remove()},w.prototype.insert=function(e,t){if(!Array.isArray(e))return this.insertOne(e);var r,n=[],t=t&&!this.cloneObjects&&this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length;t&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",e);for(var i=0,o=e.length;i<o;i++){if(!(r=this.insertOne(e[i],!0)))return;n.push(r)}}finally{t&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",n),1===(n=this.cloneObjects?f(n,this.cloneMethod):n).length?n[0]:n},w.prototype.insertOne=function(e,t){var r=null;if("object"!=typeof e?r=new TypeError("Document needs to be an object"):null===e&&(r=new TypeError("Object cannot be null")),null!==r)throw this.emit("error",r),r;r=this.cloneObjects?f(e,this.cloneMethod):e;if(this.disableFreeze||(r=a(r)),this.disableMeta||(void 0===r.meta?r.meta={revision:0,created:0}:this.disableFreeze||(r.meta=a(r.meta))),t||this.emit("pre-insert",r),this.add(r))return this.disableChangesApi?this.insertMeta(r):this.insertMetaWithChange(r),this.disableFreeze||d(r),e=this.cloneObjects?f(r,this.cloneMethod):r,t||this.emit("insert",e),this.addAutoUpdateObserver(e),e},w.prototype.clear=function(e){var t=this;e=e||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===e.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach(function(e){t.binaryIndices[e].dirty=!1,t.binaryIndices[e].values=[]})},w.prototype.update=function(e){var t,r,n;if(Array.isArray(e)){n=e.length,(t=!this.cloneObjects&&this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length)&&(this.adaptiveBinaryIndices=!1);try{for(r=0;r<n;r+=1)this.update(e[r])}finally{t&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!S.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var i,o,s,a,l,c=this.get(e.$loki,!0),u=this;if(!c)throw new Error("Trying to update a document not in collection.");i=c[0],s=c[1],o=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?f(e,this.cloneMethod):e,this.emit("pre-update",e),this.uniqueNames.forEach(function(e){u.getUniqueIndex(e,!0).update(i,o)}),(this.data[s]=o)!==e&&this.addAutoUpdateObserver(e);for(var h=0;h<this.DynamicViews.length;h++)this.DynamicViews[h].evaluateDocument(s,!1);if(this.adaptiveBinaryIndices)for(a in this.binaryIndices)this.adaptiveBinaryIndexUpdate(s,a);else this.flagBinaryIndexesDirty();return this.idIndex[s]=o.$loki,this.isIncremental&&this.dirtyIds.push(o.$loki),this.commit(),this.dirty=!0,o=this.disableChangesApi?this.updateMeta(o):this.updateMetaWithChange(o,i),this.disableFreeze||d(o),l=this.cloneObjects?f(o,this.cloneMethod):o,this.emit("update",l,i),l}catch(e){throw this.rollback(),this.lokiConsoleWrapper.error(e.message),this.emit("error",e),e}}},w.prototype.add=function(e){if("object"!=typeof e)throw new TypeError("Object being added needs to be an object");if(void 0!==e.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var t=this.maxId;e.$loki=t,this.disableMeta||(e.meta.version=0);for(var r=0,n=this.uniqueNames.length;r<n;r++)this.getUniqueIndex(this.uniqueNames[r],!0).set(e);this.idIndex&&this.idIndex.push(t),this.isIncremental&&this.dirtyIds.push(t),this.data.push(e);for(var i,o=this.data.length-1,s=this.DynamicViews.length,r=0;r<s;r++)this.DynamicViews[r].evaluateDocument(o,!0);if(this.adaptiveBinaryIndices)for(i in this.binaryIndices)this.adaptiveBinaryIndexInsert(o,i);else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?f(e,this.cloneMethod):e}catch(e){throw this.rollback(),this.lokiConsoleWrapper.error(e.message),this.emit("error",e),e}},w.prototype.updateWhere=function(e,t){var r,n=this.where(e),i=0;try{for(;i<n.length;i++)r=t(n[i]),this.update(r)}catch(e){this.rollback(),this.lokiConsoleWrapper.error(e.message)}},w.prototype.removeWhere=function(e){var t;"function"==typeof e?(t=this.data.filter(e),this.remove(t)):this.chain().find(e).remove()},w.prototype.removeDataOnly=function(){this.remove(this.data.slice())},w.prototype.removeBatchByPositions=function(r){var e,t,n,i,o,s=r.length,a={},l=Object.keys(this.binaryIndices).length,c=Object.keys(this.constraints.unique).length,u=this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length,h=this;try{for(this.startTransaction(),this.ensureId(),n=0;n<s;n++)a[this.idIndex[r[n]]]=!0;if(0<(e=this.DynamicViews.length)||0<l||0<c){if(0<e)for(t=0;t<e;t++)this.DynamicViews[t].removeDocument(r);if(this.adaptiveBinaryIndices&&!u)for(o in this.binaryIndices)this.adaptiveBinaryIndexRemove(r,o);else this.flagBinaryIndexesDirty();c&&this.uniqueNames.forEach(function(e){var t=h.getUniqueIndex(e);if(t)for(n=0;n<s;n++)null!==(i=h.data[r[n]])[e]&&void 0!==i[e]&&t.remove(i[e])})}if(!this.disableChangesApi||1<this.events.delete.length)for(n=0;n<s;n++)this.emit("delete",this.data[r[n]]);if(this.data=this.data.filter(function(e){return!a[e.$loki]}),this.isIncremental)for(n=0;n<s;n++)this.dirtyIds.push(this.idIndex[r[n]]);this.idIndex=this.idIndex.filter(function(e){return!a[e]}),this.adaptiveBinaryIndices&&u&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(r){return this.rollback(),u&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(r.message),this.emit("error",r),null}},w.prototype.removeBatch=function(e){for(var t=e.length,r=this.data.length,n={},i=[],o=0;o<r;o++)n[this.data[o].$loki]=o;for(o=0;o<t;o++)"object"==typeof e[o]?i.push(n[e[o].$loki]):i.push(n[e[o]]);this.removeBatchByPositions(i)},w.prototype.remove=function(r){if("object"!=typeof(r="number"==typeof r?this.get(r):r))throw new Error("Parameter is not an object");if(Array.isArray(r))this.removeBatch(r);else{if(!S.call(r,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var e=this.get(r.$loki,!0),t=e[1],n=this;this.uniqueNames.forEach(function(e){var t;null!==r[e]&&void 0!==r[e]&&(t=n.getUniqueIndex(e))&&t.remove(r[e])});for(var i,o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(t);if(this.adaptiveBinaryIndices)for(i in this.binaryIndices)this.adaptiveBinaryIndexRemove(t,i);else this.flagBinaryIndexesDirty();return this.data.splice(t,1),this.removeAutoUpdateObserver(r),this.idIndex.splice(t,1),this.isIncremental&&this.dirtyIds.push(r.$loki),this.commit(),this.dirty=!0,this.emit("delete",e[0]),delete(r=this.disableFreeze?r:a(r)).$loki,delete r.meta,this.disableFreeze||s(r),r}catch(e){return this.rollback(),this.lokiConsoleWrapper.error(e.message),this.emit("error",e),null}}},w.prototype.get=function(e,t){this.idIndex||this.ensureId();var r,t=t||!1,n=this.idIndex,i=n.length-1,o=0;if(e="number"==typeof e?e:parseInt(e,10),isNaN(e))throw new TypeError("Passed id is not an integer");for(;n[o]<n[i];)n[r=o+i>>1]<e?o=1+r:i=r;return i===o&&n[o]===e?t?[this.data[o],o]:this.data[o]:null},w.prototype.getBinaryIndexPosition=function(e,t){var r=P.getIn(this.data[e],t,!0),n=this.binaryIndices[t].values,t=this.calculateRange("$eq",t,r);if(0===t[0]&&-1===t[1])return null;for(var r=t[0],i=t[1],o=r;o<=i;o++)if(n[o]===e)return o;return null},w.prototype.adaptiveBinaryIndexInsert=function(e,t){var r=-1!==t.indexOf("."),n=this.binaryIndices[t].values,i=P.getIn(this.data[e],t,r),n=(!0===this.serializableIndices&&i instanceof Date&&(this.data[e][t]=i.getTime(),i=P.getIn(this.data[e],t)),0===n.length?0:this.calculateRangeStart(t,i,!0,r));this.binaryIndices[t].values.splice(n,0,e)},w.prototype.adaptiveBinaryIndexUpdate=function(e,t){for(var r=this.binaryIndices[t].values,n=r.length,i=0;i<n&&r[i]!==e;i++);this.binaryIndices[t].values.splice(i,1),this.adaptiveBinaryIndexInsert(e,t)},w.prototype.adaptiveBinaryIndexRemove=function(e,t,r){var n,i,o,s,a,l,c=this.binaryIndices[t],u={};if(Array.isArray(e)){if(1!==(s=e.length)){for(o=0;o<s;o++)u[e[o]]=!0;if(c.values=c.values.filter(function(e){return!u[e]}),!0===r)return;var h=e.slice();for(h.sort(function(e,t){return e-t}),n=c.values.length,i=0;i<n;i++){for(a=c.values[i],o=l=0;o<s&&a>h[o];o++)l++;c.values[i]-=l}return}e=e[0]}if(null===(t=this.getBinaryIndexPosition(e,t)))return null;if(c.values.splice(t,1),!0!==r)for(n=c.values.length,i=0;i<n;i++)c.values[i]>e&&c.values[i]--},w.prototype.calculateRangeStart=function(e,t,r,n){var i,o=this.data,s=this.binaryIndices[e].values,a=0,l=s.length-1;if(0===s.length)return-1;for(P.getIn(o[s[a]],e,n),P.getIn(o[s[l]],e,n);a<l;)g.lt(P.getIn(o[s[i=a+l>>1]],e,n),t,!1)?a=1+i:l=i;var c=a;return g.aeq(t,P.getIn(o[s[c]],e,n))?c:g.lt(t,P.getIn(o[s[c]],e,n),!1)?r?c:c-1:r?c+1:c},w.prototype.calculateRangeEnd=function(e,t,r){var n,i=this.data,o=this.binaryIndices[e].values,s=0,a=o.length-1;if(0===o.length)return-1;for(P.getIn(i[o[s]],e,r),P.getIn(i[o[a]],e,r);s<a;)g.lt(t,P.getIn(i[o[n=s+a>>1]],e,r),!1)?a=n:s=1+n;var l=a;return g.aeq(t,P.getIn(i[o[l]],e,r))?l:g.gt(t,P.getIn(i[o[l]],e,r),!1)?l+1:g.aeq(t,P.getIn(i[o[l-1]],e,r))?l-1:l},w.prototype.calculateRange=function(e,t,r){var n,i,o,s=this.data,a=this.binaryIndices[t].values,l=a.length-1;if(0===s.length)return[0,-1];var c=-1!==t.indexOf("."),u=P.getIn(s[a[0]],t,c),h=P.getIn(s[a[l]],t,c);switch(e){case"$eq":case"$aeq":case"$dteq":if(g.lt(r,u,!1)||g.gt(r,h,!1))return[0,-1];break;case"$gt":if(g.gt(r,h,!0))return[0,-1];if(g.gt(u,r,!1))return[0,l];break;case"$gte":if(g.gt(r,h,!1))return[0,-1];if(g.gt(u,r,!0))return[0,l];break;case"$lt":if(g.lt(r,u,!0))return[0,-1];if(g.lt(h,r,!1))return[0,l];break;case"$lte":if(g.lt(r,u,!1))return[0,-1];if(g.lt(h,r,!0))return[0,l];break;case"$between":return g.gt(r[0],h,!1)||g.lt(r[1],u,!1)?[0,-1]:((n=this.calculateRangeStart(t,r[0],!1,c))<0&&n++,(o=this.calculateRangeEnd(t,r[1],c))>l&&o--,g.gt(P.getIn(s[a[n]],t,c),r[0],!0)||n++,g.lt(P.getIn(s[a[o]],t,c),r[1],!0)||o--,o<n?[0,-1]:[n,o]);case"$in":for(var f=[],d=[],p=0,y=r.length;p<y;p++)for(var v=this.calculateRange("$eq",t,r[p]),m=v[0];m<=v[1];m++)void 0===f[m]&&(f[m]=!0,d.push(m));return d}switch(e){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":n=this.calculateRangeStart(t,r,!1,c),i=P.getIn(s[a[n]],t,c)}switch(e){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":o=this.calculateRangeEnd(t,r,c),P.getIn(s[a[o]],t,c)}switch(e){case"$eq":case"$aeq":case"$dteq":return g.aeq(i,r)?[n,o]:[0,-1];case"$gt":return g.aeq(P.getIn(s[a[o]],t,c),r)?[o+1,l]:[o,l];case"$gte":return g.aeq(P.getIn(s[a[n]],t,c),r)?[n,l]:[n+1,l];case"$lt":return g.aeq(P.getIn(s[a[n]],t,c),r)?[0,n-1]:[0,n];case"$lte":return g.aeq(P.getIn(s[a[o]],t,c),r)?[0,o]:[0,o-1];default:return[0,s.length-1]}},w.prototype.by=function(t,e){var r;if(void 0===e)return r=this,function(e){return r.by(t,e)};e=this.getUniqueIndex(t,!0).get(e);return this.cloneObjects?f(e,this.cloneMethod):e},w.prototype.findOne=function(e){e=e||{};e=this.chain().find(e,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?f(e[0],this.cloneMethod):e[0]},w.prototype.chain=function(e,t){var r=new m(this);return void 0===e?r:r.transform(e,t)},w.prototype.find=function(e){return this.chain().find(e).data()},w.prototype.findOneUnindexed=function(e,t){for(var r=this.data.length;r--;)if(P.getIn(this.data[r],e,!0)===t)return this.data[r];return null},w.prototype.startTransaction=function(){if(this.transactional){this.cachedData=f(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},w.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},w.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},w.prototype.async=function(e,t){setTimeout(function(){if("function"!=typeof e)throw new TypeError("Argument passed for async execution is not a function");e(),t()},0)},w.prototype.where=function(e){return this.chain().where(e).data()},w.prototype.mapReduce=function(e,t){try{return t(this.data.map(e))}catch(e){throw e}},w.prototype.eqJoin=function(e,t,r,n,i){return new m(this).eqJoin(e,t,r,n,i)},w.prototype.stages={},w.prototype.getStage=function(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]},w.prototype.commitLog=[],w.prototype.stage=function(e,t){var r=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=r},w.prototype.commitStage=function(e,t){var r,n=this.getStage(e),i=(new Date).getTime();for(r in n)this.update(n[r]),this.commitLog.push({timestamp:i,message:t,data:JSON.parse(JSON.stringify(n[r]))});this.stages[e]={}},w.prototype.no_op=function(){},w.prototype.extract=function(e){for(var t=0,r=this.data.length,n=I(e),i=[];t<r;t+=1)i.push(j(this.data[t],e,n));return i},w.prototype.max=function(e){return Math.max.apply(null,this.extract(e))},w.prototype.min=function(e){return Math.min.apply(null,this.extract(e))},w.prototype.maxRecord=function(e){for(var t,r=0,n=this.data.length,i=I(e),o={index:0,value:void 0};r<n;r+=1)(void 0===t||t<j(this.data[r],e,i))&&(t=j(this.data[r],e,i),o.index=this.data[r].$loki);return o.value=t,o},w.prototype.minRecord=function(e){for(var t,r=0,n=this.data.length,i=I(e),o={index:0,value:void 0};r<n;r+=1)(void 0===t||t>j(this.data[r],e,i))&&(t=j(this.data[r],e,i),o.index=this.data[r].$loki);return o.value=t,o},w.prototype.extractNumerical=function(e){return this.extract(e).map(_).filter(Number).filter(function(e){return!isNaN(e)})},w.prototype.avg=function(e){return A(this.extractNumerical(e))},w.prototype.stdDev=function(e){return e=this.extractNumerical(e),t=A(e),e=A(e.map(function(e){e-=t;return e*e})),Math.sqrt(e);var t},w.prototype.mode=function(e){var t,r,n,i={};for(r in this.extract(e).forEach(function(e){i[e]?i[e]+=1:i[e]=1}),i)t?t<i[r]&&(n=r):(n=r,t=i[r]);return n},w.prototype.median=function(e){var e=this.extractNumerical(e),t=(e.sort(L),Math.floor(e.length/2));return e.length%2?e[t]:(e[t-1]+e[t])/2},M.prototype={keys:[],values:[],sort:function(e,t){return e<t?-1:t<e?1:0},setSort:function(e){this.bs=new E(e)},bs:function(){return new E(this.sort)},set:function(e,t){var r=this.bs(this.keys,e);r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,t))},get:function(e){return this.values[D(this.keys,e,this.sort).index]}},z.prototype.keyMap={},z.prototype.lokiMap={},z.prototype.set=function(e){var t=e[this.field];if(null!=t){if(this.keyMap[t])throw new Error("Duplicate key for property "+this.field+": "+t);this.keyMap[t]=e,this.lokiMap[e.$loki]=t}},z.prototype.get=function(e){return this.keyMap[e]},z.prototype.byId=function(e){return this.keyMap[this.lokiMap[e]]},z.prototype.update=function(e,t){var r;this.lokiMap[e.$loki]!==t[this.field]?(r=this.lokiMap[e.$loki],this.set(t),this.keyMap[r]=void 0):this.keyMap[e[this.field]]=t},z.prototype.remove=function(e){var t=this.keyMap[e];if(null==t)throw new Error("Key is not in unique index: "+this.field);this.keyMap[e]=void 0,this.lokiMap[t.$loki]=void 0},z.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},$.prototype={set:function(e,t){this.index[e]?this.index[e].push(t):this.index[e]=[t]},remove:function(e,t){var r,n=this.index[e];for(r in n)n[r]==t&&n.splice(r,1);n.length<1&&(this.index[e]=void 0)},get:function(e){return this.index[e]},clear:function(e){this.index={}}},c.deepFreeze=d,c.freeze=s,c.unFreeze=a,c.LokiOps=k,c.Collection=w,c.DynamicView=b,c.Resultset=m,c.KeyValueStore=M,c.LokiMemoryAdapter=u,c.LokiPartitioningAdapter=h,c.LokiLocalStorageAdapter=v,c.LokiFsAdapter=y,c.persistenceAdapters={fs:y,localStorage:v},c.aeq=e,c.lt=t,c.gt=r,c.Comparators=g,c};void 0!==(r=r.apply(t,[]))&&(e.exports=r)},1528:function(t,r){var n,i;!function(e){"use strict";"object"==typeof t.exports?t.exports=e():(i=[],void 0!==(i="function"==typeof(n=e)?n.apply(r,i):n)&&(t.exports=i))}(function(){"use strict";var t=Object.prototype.toString;function c(e,t){return null!=e&&Object.prototype.hasOwnProperty.call(e,t)}function u(e){if(!e)return 1;if(f(e)&&0===e.length)return 1;if("string"!=typeof e){for(var t in e)if(c(e,t))return;return 1}}function h(e){return t.call(e)}var f=Array.isArray||function(e){return"[object Array]"===t.call(e)};function d(e){var t=parseInt(e);return t.toString()===e?t:e}function e(i){function s(r){return Object.keys(s).reduce(function(e,t){return"create"!==t&&"function"==typeof s[t]&&(e[t]=s[t].bind(s,r)),e},{})}var o,a;function r(e,t){if(o(e,t))return e[t]}function l(e,t,r,n){if(!(t="number"==typeof t?[t]:t)||0===t.length)return e;if("string"==typeof t)return l(e,t.split(".").map(d),r,n);var i=t[0],o=a(e,i);return 1===t.length?(void 0!==o&&n||(e[i]=r),o):(void 0===o&&("number"==typeof t[1]?e[i]=[]:e[i]={}),l(e[i],t.slice(1),r,n))}return o=(i=i||{}).includeInheritedProps?function(){return!0}:function(e,t){return"number"==typeof t&&Array.isArray(e)||c(e,t)},a=i.includeInheritedProps?function(e,t){e=r(e,t="string"!=typeof t&&"number"!=typeof t?String(t):t);if("__proto__"===t||"prototype"===t||"constructor"===t&&"function"==typeof e)throw new Error("For security reasons, object's magic properties cannot be set");return e}:r,s.has=function(e,t){if("number"==typeof t?t=[t]:"string"==typeof t&&(t=t.split(".")),!t||0===t.length)return!!e;for(var r=0;r<t.length;r++){var n=d(t[r]);if(!("number"==typeof n&&f(e)&&n<e.length||(i.includeInheritedProps?n in Object(e):c(e,n))))return!1;e=e[n]}return!0},s.ensureExists=function(e,t,r){return l(e,t,r,!0)},s.set=l,s.insert=function(e,t,r,n){var i=s.get(e,t);n=~~n,f(i)||s.set(e,t,i=[]),i.splice(n,0,r)},s.empty=function(e,t){var r,n;if(!u(t)&&null!=e&&(r=s.get(e,t))){if("string"==typeof r)return s.set(e,t,"");if("boolean"==typeof r||"[object Boolean]"===h(r))return s.set(e,t,!1);if("number"==typeof r)return s.set(e,t,0);if(f(r))r.length=0;else{if("object"!=typeof r||"[object Object]"!==h(r))return s.set(e,t,null);for(n in r)o(r,n)&&delete r[n]}}},s.push=function(e,t){var r=s.get(e,t);f(r)||s.set(e,t,r=[]),r.push.apply(r,Array.prototype.slice.call(arguments,2))},s.coalesce=function(e,t,r){for(var n,i=0,o=t.length;i<o;i++)if(void 0!==(n=s.get(e,t[i])))return n;return r},s.get=function(e,t,r){if(!(t="number"==typeof t?[t]:t)||0===t.length)return e;if(null==e)return r;if("string"==typeof t)return s.get(e,t.split("."),r);var n=d(t[0]),i=a(e,n);return void 0===i?r:1===t.length?i:s.get(e[n],t.slice(1),r)},s.del=function(e,t){if(null==e)return e;if(u(t="number"==typeof t?[t]:t))return e;if("string"==typeof t)return s.del(e,t.split("."));var r=d(t[0]);return a(e,r),o(e,r)?1!==t.length?s.del(e[r],t.slice(1)):(f(e)?e.splice(r,1):delete e[r],e):e},s}var r=e();return r.create=e,r.withInheritedProps=e({includeInheritedProps:!0}),r})},1368:e=>{e.exports=function(){"use strict";var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function l(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0;n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function c(e){for(var t=[],r=0;r<64;r+=4)t[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);return t}function u(e){for(var t=[],r=0;r<64;r+=4)t[r>>2]=e[r]+(e[r+1]<<8)+(e[r+2]<<16)+(e[r+3]<<24);return t}function r(e){for(var t,r,n,i,o=e.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)l(s,c(e.substring(a-64,a)));for(t=(e=e.substring(a-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<t;a+=1)r[a>>2]|=e.charCodeAt(a)<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(l(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,l(s,r),s}function s(e){for(var t=0;t<e.length;t+=1)e[t]=function(e){for(var t="",r=0;r<4;r+=1)t+=n[e>>8*r+4&15]+n[e>>8*r&15];return t}(e[t]);return e.join("")}function i(e){return e=/[\u0080-\uFFFF]/.test(e)?unescape(encodeURIComponent(e)):e}function a(e){for(var t=[],r=e.length,n=0;n<r-1;n+=2)t.push(parseInt(e.substr(n,2),16));return String.fromCharCode.apply(String,t)}function o(){this.reset()}return s(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var r=this.byteLength,e=h(e,r),n=r;return(n=void 0!==t?h(t,r):n)<e?new ArrayBuffer(0):(t=n-e,r=new ArrayBuffer(t),n=new Uint8Array(r),e=new Uint8Array(this,e,t),n.set(e),r)}),o.prototype.append=function(e){return this.appendBinary(i(e)),this},o.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;for(var t=this._buff.length,r=64;r<=t;r+=64)l(this._hash,c(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},o.prototype.end=function(e){for(var t,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r.charCodeAt(o)<<(o%4<<3);return this._finish(i,n),t=s(this._hash),e&&(t=a(t)),this.reset(),t},o.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},o.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},o.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},o.prototype._finish=function(e,t){var r,n=t;if(e[n>>2]|=128<<(n%4<<3),55<n)for(l(this._hash,e),n=0;n<16;n+=1)e[n]=0;t=(t=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(t[2],16),t=parseInt(t[1],16)||0,e[14]=r,e[15]=t,l(this._hash,e)},o.hash=function(e,t){return o.hashBinary(i(e),t)},o.hashBinary=function(e,t){e=s(r(e));return t?a(e):e},(o.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){r=this._buff.buffer,n=e,i=!0,(o=new Uint8Array(r.byteLength+n.byteLength)).set(new Uint8Array(r)),o.set(new Uint8Array(n),r.byteLength);var t,r,n,i,o,s=i?o:o.buffer,a=s.length;for(this._length+=e.byteLength,t=64;t<=a;t+=64)l(this._hash,u(s.subarray(t-64,t)));return this._buff=t-64<a?new Uint8Array(s.buffer.slice(t-64)):new Uint8Array(0),this},o.ArrayBuffer.prototype.end=function(e){for(var t,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r[o]<<(o%4<<3);return this._finish(i,n),t=s(this._hash),e&&(t=a(t)),this.reset(),t},o.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.ArrayBuffer.prototype.getState=function(){var e,t=o.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},o.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){for(var r=e.length,n=new ArrayBuffer(r),i=new Uint8Array(n),o=0;o<r;o+=1)i[o]=e.charCodeAt(o);return t?i:n}(e.buff,!0),o.prototype.setState.call(this,e)},o.ArrayBuffer.prototype.destroy=o.prototype.destroy,o.ArrayBuffer.prototype._finish=o.prototype._finish,o.ArrayBuffer.hash=function(e,t){e=s(function(e){for(var t,r,n,i,o=e.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)l(s,u(e.subarray(a-64,a)));for(t=(e=a-64<o?e.subarray(a-64):new Uint8Array(0)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<t;a+=1)r[a>>2]|=e[a]<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(l(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,l(s,r),s}(new Uint8Array(e)));return t?a(e):e},o;function h(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}}()},8322:e=>{e.exports=function(){"use strict";var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function l(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|o>>>20)+r|0)&r|~o&n)+t[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0;n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|o>>>20)+r|0)&r|~o&n)+t[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&i|~n&o)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|o>>>20)+r|0)&r|~o&n)+t[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|o>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+o|0)&r|o&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|o>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+o|0)&r|o&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|o>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+o|0)&r|o&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n&o|i&~o)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|o>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+o|0)&r|o&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|o>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+o|0)^o^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|o>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+o|0)^o^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|o>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+o|0)^o^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((o=((o+=((r=((r+=(n^i^o)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|o>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+o|0)^o^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[14]-1416354905|0)<<15|i>>>17)+o|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[10]-1051523|0)<<15|i>>>17)+o|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[6]-1560198380|0)<<15|i>>>17)+o|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((o=((o+=(n^((r=((r+=(i^(n|~o))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|o>>>22)+r|0)^((i=((i+=(r^(o|~n))+t[2]+718787259|0)<<15|i>>>17)+o|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function c(e){for(var t=[],r=0;r<64;r+=4)t[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);return t}function u(e){for(var t=[],r=0;r<64;r+=4)t[r>>2]=e[r]+(e[r+1]<<8)+(e[r+2]<<16)+(e[r+3]<<24);return t}function r(e){for(var t,r,n,i,o=e.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)l(s,c(e.substring(a-64,a)));for(t=(e=e.substring(a-64)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<t;a+=1)r[a>>2]|=e.charCodeAt(a)<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(l(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,l(s,r),s}function s(e){for(var t=0;t<e.length;t+=1)e[t]=function(e){for(var t="",r=0;r<4;r+=1)t+=n[e>>8*r+4&15]+n[e>>8*r&15];return t}(e[t]);return e.join("")}function i(e){return e=/[\u0080-\uFFFF]/.test(e)?unescape(encodeURIComponent(e)):e}function a(e){for(var t=[],r=e.length,n=0;n<r-1;n+=2)t.push(parseInt(e.substr(n,2),16));return String.fromCharCode.apply(String,t)}function o(){this.reset()}return s(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var r=this.byteLength,e=h(e,r),n=r;return(n=void 0!==t?h(t,r):n)<e?new ArrayBuffer(0):(t=n-e,r=new ArrayBuffer(t),n=new Uint8Array(r),e=new Uint8Array(this,e,t),n.set(e),r)}),o.prototype.append=function(e){return this.appendBinary(i(e)),this},o.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;for(var t=this._buff.length,r=64;r<=t;r+=64)l(this._hash,c(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},o.prototype.end=function(e){for(var t,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r.charCodeAt(o)<<(o%4<<3);return this._finish(i,n),t=s(this._hash),e&&(t=a(t)),this.reset(),t},o.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},o.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},o.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},o.prototype._finish=function(e,t){var r,n=t;if(e[n>>2]|=128<<(n%4<<3),55<n)for(l(this._hash,e),n=0;n<16;n+=1)e[n]=0;t=(t=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(t[2],16),t=parseInt(t[1],16)||0,e[14]=r,e[15]=t,l(this._hash,e)},o.hash=function(e,t){return o.hashBinary(i(e),t)},o.hashBinary=function(e,t){e=s(r(e));return t?a(e):e},(o.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){r=this._buff.buffer,n=e,i=!0,(o=new Uint8Array(r.byteLength+n.byteLength)).set(new Uint8Array(r)),o.set(new Uint8Array(n),r.byteLength);var t,r,n,i,o,s=i?o:o.buffer,a=s.length;for(this._length+=e.byteLength,t=64;t<=a;t+=64)l(this._hash,u(s.subarray(t-64,t)));return this._buff=t-64<a?new Uint8Array(s.buffer.slice(t-64)):new Uint8Array(0),this},o.ArrayBuffer.prototype.end=function(e){for(var t,r=this._buff,n=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)i[o>>2]|=r[o]<<(o%4<<3);return this._finish(i,n),t=s(this._hash),e&&(t=a(t)),this.reset(),t},o.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.ArrayBuffer.prototype.getState=function(){var e,t=o.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},o.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){for(var r=e.length,n=new ArrayBuffer(r),i=new Uint8Array(n),o=0;o<r;o+=1)i[o]=e.charCodeAt(o);return t?i:n}(e.buff,!0),o.prototype.setState.call(this,e)},o.ArrayBuffer.prototype.destroy=o.prototype.destroy,o.ArrayBuffer.prototype._finish=o.prototype._finish,o.ArrayBuffer.hash=function(e,t){e=s(function(e){for(var t,r,n,i,o=e.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=o;a+=64)l(s,u(e.subarray(a-64,a)));for(t=(e=a-64<o?e.subarray(a-64):new Uint8Array(0)).length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<t;a+=1)r[a>>2]|=e[a]<<(a%4<<3);if(r[a>>2]|=128<<(a%4<<3),55<a)for(l(s,r),a=0;a<16;a+=1)r[a]=0;return i=(i=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(i[2],16),i=parseInt(i[1],16)||0,r[14]=n,r[15]=i,l(s,r),s}(new Uint8Array(e)));return t?a(e):e},o;function h(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}}()},2467:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=t.deserialize=t.registerSerializer=void 0;const n=r(7381);let i=n.DefaultSerializer;t.registerSerializer=function(e){i=n.extendSerializer(i,e)},t.deserialize=function(e){return i.deserialize(e)},t.serialize=function(e){return i.serialize(e)}},7381:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultSerializer=t.extendSerializer=void 0,t.extendSerializer=function(e,t){const r=e.deserialize.bind(e),n=e.serialize.bind(e);return{deserialize:e=>t.deserialize(e,r),serialize:e=>t.serialize(e,n)}};const r={deserialize:e=>Object.assign(Error(e.message),{name:e.name,stack:e.stack}),serialize:e=>({__error_marker:"$$error",message:e.message,name:e.name,stack:e.stack})};t.DefaultSerializer={deserialize(e){return(t=e)&&"object"==typeof t&&"__error_marker"in t&&"$$error"===t.__error_marker?r.deserialize(e):e;var t},serialize:e=>e instanceof Error?r.serialize(e):e}},8258:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$worker=t.$transferable=t.$terminate=t.$events=t.$errors=void 0,t.$errors=Symbol("thread.errors"),t.$events=Symbol("thread.events"),t.$terminate=Symbol("thread.terminate"),t.$transferable=Symbol("thread.transferable"),t.$worker=Symbol("thread.worker")},8180:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transfer=t.isTransferDescriptor=void 0;const n=r(8258);t.isTransferDescriptor=function(e){return e&&"object"==typeof e&&e[n.$transferable]},t.Transfer=function(e,t){if(!t){if(!e||"object"!=typeof e)throw Error();t=[e]}return{[n.$transferable]:!0,send:e,transferables:t}}},3229:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerMessageType=t.MasterMessageType=void 0,(r=t.MasterMessageType||(t.MasterMessageType={})).cancel="cancel",r.run="run",(r=t.WorkerMessageType||(t.WorkerMessageType={})).error="error",r.init="init",r.result="result",r.running="running",r.uncaughtError="uncaughtError"},3447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={isWorkerRuntime:function(){var e="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||e)},postMessageToMaster:function(e,t){self.postMessage(e,t)},subscribeToMasterMessages:function(t){const e=e=>{t(e.data)};return self.addEventListener("message",e),()=>{self.removeEventListener("message",e)}}}},1934:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,s,a,l){return new(a=a||Promise)(function(r,t){function n(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,i)}o((l=l.apply(e,s||[])).next())})},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.expose=t.isWorkerRuntime=t.Transfer=t.registerSerializer=void 0;const i=n(r(6898)),a=r(2467),o=r(8180),l=r(3229),c=n(r(3447));var u=r(2467),h=(Object.defineProperty(t,"registerSerializer",{enumerable:!0,get:function(){return u.registerSerializer}}),r(8180));Object.defineProperty(t,"Transfer",{enumerable:!0,get:function(){return h.Transfer}}),t.isWorkerRuntime=c.default.isWorkerRuntime;let f=!1;const d=new Map,p=e=>e&&e.type===l.MasterMessageType.run,y=e=>i.default(e)||e&&"object"==typeof e&&"function"==typeof e.subscribe;function v(e){return o.isTransferDescriptor(e)?{payload:e.send,transferables:e.transferables}:{payload:e,transferables:void 0}}function m(e,t){var{payload:t,transferables:r}=v(t),e={type:l.WorkerMessageType.error,uid:e,error:a.serialize(t)};c.default.postMessageToMaster(e,r)}function g(e,t,r){var{payload:r,transferables:n}=v(r),e={type:l.WorkerMessageType.result,uid:e,complete:!!t||void 0,payload:r};c.default.postMessageToMaster(e,n)}function b(t){try{var e={type:l.WorkerMessageType.uncaughtError,error:a.serialize(t)};c.default.postMessageToMaster(e)}catch(e){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",e,"\nOriginal error:",t)}}function w(n,i,o){s(this,void 0,void 0,function*(){let e;try{e=i(...o)}catch(e){return m(n,e)}var t=y(e)?"observable":"promise",r=n;if(r={type:l.WorkerMessageType.running,uid:r,resultType:t},c.default.postMessageToMaster(r),y(e)){const i=e.subscribe(e=>g(n,!1,a.serialize(e)),e=>{m(n,a.serialize(e)),d.delete(n)},()=>{g(n,!0),d.delete(n)});d.set(n,i)}else try{const i=yield e;g(n,!0,a.serialize(i))}catch(e){m(n,a.serialize(e))}})}t.expose=function(t){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(f)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(f=!0,"function"==typeof t)c.default.subscribeToMasterMessages(e=>{p(e)&&!e.method&&w(e.uid,t,e.args.map(a.deserialize))}),e={type:l.WorkerMessageType.init,exposed:{type:"function"}},c.default.postMessageToMaster(e);else{if("object"!=typeof t||!t)throw Error("Invalid argument passed to expose(). Expected a function or an object, got: "+t);c.default.subscribeToMasterMessages(e=>{p(e)&&e.method&&w(e.uid,t[e.method],e.args.map(a.deserialize))});e=Object.keys(t).filter(e=>"function"==typeof t[e]);e={type:l.WorkerMessageType.init,exposed:{type:"module",methods:e}},c.default.postMessageToMaster(e)}var e;c.default.subscribeToMasterMessages(e=>{if(e&&e.type===l.MasterMessageType.cancel){const t=e.uid,r=d.get(t);r&&(r.unsubscribe(),d.delete(t))}var t})},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&c.default.isWorkerRuntime()&&(self.addEventListener("error",e=>{setTimeout(()=>b(e.error||e),250)}),self.addEventListener("unhandledrejection",e=>{const t=e.reason;t&&"string"==typeof t.message&&setTimeout(()=>b(t),250)})),"undefined"!=typeof process&&"function"==typeof process.on&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",e=>{setTimeout(()=>b(e),250)}),process.on("unhandledRejection",e=>{e&&"string"==typeof e.message&&setTimeout(()=>b(e),250)}))},693:()=>{},199:()=>{}},n={};function $t(e){var t=n[e];if(void 0!==t)return t.exports;t=n[e]={exports:{}};return r[e].call(t.exports,t,t.exports,$t),t.exports}$t.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return $t.d(t,{a:t}),t},$t.d=(e,t)=>{for(var r in t)$t.o(t,r)&&!$t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},$t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),$t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=$t(3050),L=$t.n(e),e=($t(6313),$t(8322),$t(9134)),e=$t.n(e),N=0;function v(){var e=(new Date).getTime();return N=e=e<=N?N+1:e}function B(e){var t=0<arguments.length&&void 0!==e?e:0;return new Promise(function(e){return setTimeout(e,t)})}Promise.resolve(!0),Promise.resolve(!1),Promise.resolve(null);var T=Promise.resolve();function q(e){var t=0<arguments.length&&void 0!==e?e:null;return"object"==typeof window&&window.requestIdleCallback?new Promise(function(e){return window.requestIdleCallback(e,{timeout:t})}):B(0)}function h(e){if(e)return e;throw new Error("ensureNotFalsy() is falsy")}function F(e){for(var t=0<arguments.length&&void 0!==e?e:10,r="",n="abcdefghijklmnopqrstuvwxyz",i=0;i<t;i++)r+=n.charAt(Math.floor(Math.random()*n.length));return r}function m(e){return Object.assign({},e)}function g(e,t){e=e.get(t);if(e)return e;throw new Error("missing value from map "+t)}e()();var R=function(e,t){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}R(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function W(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function d(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function p(e){return"function"==typeof e}function U(e){e=e(function(e){Error.call(e),e.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e}Object.create,Object.create;var V=U(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}});function J(e,t){e&&0<=(t=e.indexOf(t))&&e.splice(t,1)}r.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=W(o),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);o=this.initialTeardown;if(p(o))try{o()}catch(e){i=e instanceof V?e.errors:[e]}o=this._finalizers;if(o){this._finalizers=null;try{for(var l=W(o),c=l.next();!c.done;c=l.next()){var u=c.value;try{H(u)}catch(e){i=null!=i?i:[],e instanceof V?i=d(d([],f(i)),f(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}if(i)throw new V(i)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)H(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(t=this._finalizers)?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&J(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&J(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=((e=new r).closed=!0,e);var o=r,K=o.EMPTY;function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}function Q(e){return e instanceof o||e&&"closed"in e&&p(e.remove)&&p(e.add)&&p(e.unsubscribe)}function H(e){p(e)?e():e.unsubscribe()}var G=null,Y=null,X=void 0,Z=!1,ee=!1,s={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=s.delegate;return null!=i&&i.setTimeout?i.setTimeout.apply(i,d([e,t],f(r))):setTimeout.apply(void 0,d([e,t],f(r)))},clearTimeout:function(e){var t=s.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function te(){}var re=ne("C",void 0,void 0);function ne(e,t,r){return{kind:e,value:t,error:r}}var n=null;function a(e){if(Z){var t=!n;if(t&&(n={errorThrown:!1,error:null}),e(),t){var t=n,r=t.errorThrown,t=t.error;if(n=null,r)throw t}}else e()}t(i,ie=o),i.create=function(e,t,r){return new ue(e,t,r)},i.prototype.next=function(e){this.isStopped?fe(ne("N",e,void 0),this):this._next(e)},i.prototype.error=function(e){this.isStopped?fe(ne("E",void 0,e),this):(this.isStopped=!0,this._error(e))},i.prototype.complete=function(){this.isStopped?fe(re,this):(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,ie.prototype.unsubscribe.call(this),this.destination=null)},i.prototype._next=function(e){this.destination.next(e)},i.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},i.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}};var ie,oe=i,se=Function.prototype.bind;function i(e){var t=ie.call(this)||this;return t.isStopped=!1,e?Q(t.destination=e)&&e.add(t):t.destination=de,t}function ae(e,t){return se.call(e,t)}l.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){c(e)}},l.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){c(e)}else c(e)},l.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){c(e)}};var le,ce=l,ue=(t(he,le=oe),he);function he(e,t,r){var n=le.call(this)||this,r=p(e)||!e?{next:null!=e?e:void 0,error:null!=t?t:void 0,complete:null!=r?r:void 0}:n&&ee?((t=Object.create(e)).unsubscribe=function(){return n.unsubscribe()},{next:e.next&&ae(e.next,t),error:e.error&&ae(e.error,t),complete:e.complete&&ae(e.complete,t)}):e;return n.destination=new ce(r),n}function l(e){this.partialObserver=e}function c(e){var t,r;Z?(t=e,Z&&n&&(n.errorThrown=!0,n.error=t)):(r=e,s.setTimeout(function(){if(!G)throw r;G(r)}))}function fe(e,t){var r=Y;r&&s.setTimeout(function(){return r(e,t)})}var de={closed:!0,next:te,error:function(e){throw e},complete:te},e="function"==typeof Symbol&&Symbol.observable||"@@observable";function pe(e){return e}u.prototype.lift=function(e){var t=new u;return t.source=this,t.operator=e,t},u.prototype.subscribe=function(e,t,r){var n,i=this,o=(n=e)&&n instanceof oe||n&&p(n.next)&&p(n.error)&&p(n.complete)&&Q(n)?e:new ue(e,t,r);return a(function(){var e=i.operator,t=i.source;o.add(e?e.call(o,t):t?i._subscribe(o):i._trySubscribe(o))}),o},u.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},u.prototype.forEach=function(n,e){var i=this;return new(e=ve(e))(function(e,t){var r=new ue({next:function(e){try{n(e)}catch(e){t(e),r.unsubscribe()}},error:t,complete:e});i.subscribe(r)})},u.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},u.prototype[e]=function(){return this},u.prototype.pipe=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return(0===(t=e).length?pe:1===t.length?t[0]:function(e){return t.reduce(function(e,t){return t(e)},e)})(this)},u.prototype.toPromise=function(e){var n=this;return new(e=ve(e))(function(e,t){var r;n.subscribe(function(e){return r=e},function(e){return t(e)},function(){return e(r)})})},u.create=function(e){return new u(e)};var ye=u;function u(e){e&&(this._subscribe=e)}function ve(e){return null!=(e=null!=e?e:X)?e:Promise}var me,ge,be=U(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),we=(t(b,ge=ye),b.prototype.lift=function(e){var t=new Ie(this,this);return t.operator=e,t},b.prototype._throwIfClosed=function(){if(this.closed)throw new be},b.prototype.next=function(i){var o=this;a(function(){var t,e;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var r=W(o.currentObservers),n=r.next();!n.done;n=r.next())n.value.next(i)}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}})},b.prototype.error=function(t){var r=this;a(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var e=r.observers;e.length;)e.shift().error(t)}})},b.prototype.complete=function(){var t=this;a(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},b.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(b.prototype,"observed",{get:function(){var e;return 0<(null==(e=this.observers)?void 0:e.length)},enumerable:!1,configurable:!0}),b.prototype._trySubscribe=function(e){return this._throwIfClosed(),ge.prototype._trySubscribe.call(this,e)},b.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},b.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,n=this.isStopped,i=this.observers;return r||n?K:(this.currentObservers=null,i.push(e),new o(function(){t.currentObservers=null,J(i,e)}))},b.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,n=this.isStopped;t?e.error(r):n&&e.complete()},b.prototype.asObservable=function(){var e=new ye;return e.source=this,e},b.create=function(e,t){return new Ie(e,t)},b),Ie=(t(y,me=we),y.prototype.next=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.next)&&r.call(t,e)},y.prototype.error=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.error)&&r.call(t,e)},y.prototype.complete=function(){var e,t;null!=(t=null==(e=this.destination)?void 0:e.complete)&&t.call(e)},y.prototype._subscribe=function(e){var t;return null!=(t=null==(t=this.source)?void 0:t.subscribe(e))?t:K},y);function y(e,t){var r=me.call(this)||this;return r.destination=e,r.source=t,r}function b(){var e=ge.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}function Se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t,r){return(Oe=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),1}catch(e){return}}}()?Reflect.construct:function(e,t,r){var n=[null],t=(n.push.apply(n,t),new(Function.bind.apply(e,n)));return r&&w(t,r.prototype),t}).apply(null,arguments)}function ke(e){var r="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return Oe(e,arguments,Pe(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),w(t,e)}(e)}xe=ke(Error),e=xe,(O=I).prototype=Object.create(e.prototype),w(O.prototype.constructor=O,e),I.prototype.toString=function(){return this.message},O=I,(e=[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])&&Se(O.prototype,e),P&&Se(O,P),Object.defineProperty(O,"prototype",{writable:!1});var xe,_e=I;function I(e,t){var r,n,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},t="RxError ("+(r=e)+"):\n"+t+"\n"+(n=i,r="",0===Object.keys(n).length?r:(r=(r+="Given parameters: {\n")+Object.keys(n).map(function(e){var t="[object Object]";try{t=JSON.stringify(n[e],function(e,t){return void 0===t?null:t},2)}catch(e){}return e+":"+t}).join("\n"))+"}");return(r=xe.call(this,t)||this).code=e,r.message=t,r.parameters=i,r.rxdb=!0,r}function S(e,t){return new _e(e,"RxDB Error-Code "+e+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+e+"\n        ",t)}TypeError;var e=$t(5643),P=$t.n(e),O={add:function(e){"function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope||"function"==typeof window.addEventListener&&(window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0))}},e=$t(199),e=$t.n(e),Ce=P()?e():O,k=new Set,Ae=!1;function je(e){if(Ae||(Ae=!0,Ce.add(De)),"function"!=typeof e)throw new Error("Listener is no function");return k.add(e),{remove:function(){return k.delete(e)},run:function(){return k.delete(e),e()}}}function De(){var t=[];return k.forEach(function(e){t.push(e()),k.delete(e)}),Promise.all(t)}(P=Me.prototype).addWrite=function(){this.writesSinceLastRun=this.writesSinceLastRun+1,this.run()},P.run=function(){var i=this;return!this.databaseSettings.adapter||2<this.saveQueueC||(this.saveQueueC=this.saveQueueC+1,this.saveQueue=this.saveQueue.then(function(){try{return Promise.resolve(q()).then(function(){if(0!==i.writesSinceLastRun)return Promise.resolve(q().then(function(){return q()})).then(function(){var n;if(0!==i.writesSinceLastRun)return n=i.writesSinceLastRun,i.writesSinceLastRun=0,new Promise(function(t,r){i.lokiDatabase.saveDatabase(function(e){e?(i.writesSinceLastRun=i.writesSinceLastRun+n,r(e)):(i.databaseSettings.autosaveCallback&&i.databaseSettings.autosaveCallback(),t())})})})})}catch(e){return Promise.reject(e)}}).catch(function(){}).then(function(){i.saveQueueC=i.saveQueueC-1})),this.saveQueue};var Ee=Me;function Me(e,t){this.writesSinceLastRun=0,this.saveQueue=T,this.saveQueueC=0,this.lokiDatabase=e,this.databaseSettings=t}Promise.resolve(!1);var ze=Promise.resolve(!0),x=Promise.resolve();function _(t,r){return t=t||0,new Promise(function(e){return setTimeout(function(){return e(r)},t)})}function $e(){return Math.random().toString(36).substring(2)}var Le=0,Ne=0;function Be(){var e=(new Date).getTime();return e===Le?1e3*e+ ++Ne:(Ne=0,1e3*(Le=e))}var Te="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0),e={create:function(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),x}catch(e){return Promise.reject(e)}},canBeUsed:function(){if(Te&&"undefined"==typeof window)return!1;if("function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:Be},qe=(Fe.prototype.has=function(e){return this.set.has(e)},Fe.prototype.add=function(e){var i=this;this.timeMap.set(e,Re()),this.set.add(e),setTimeout(function(){for(var e=i,t=Re()-e.ttl,r=e.set[Symbol.iterator]();;){var n=r.next().value;if(!n)return;if(!(e.timeMap.get(n)<t))return;e.timeMap.delete(n),e.set.delete(n)}},0)},Fe.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},Fe);function Fe(e){this.ttl=e,this.set=new Set,this.timeMap=new Map}function Re(){return(new Date).getTime()}function We(e){var e=0<arguments.length&&void 0!==e?e:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var C="messages";function Ue(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function Ve(r,e){var t,n,i,o;t=r,e=e,n=(new Date).getTime()-e,i=t.transaction(C).objectStore(C),o=[],new Promise(function(r){i.openCursor().onsuccess=function(e){var t,e=e.target.result;e&&(t=e.value).time<n?(o.push(t),e.continue()):r(o)}}).then(function(e){return Promise.all(e.map(function(e){return e=e.id,t=r.transaction([C],"readwrite").objectStore(C).delete(e),new Promise(function(e){t.onsuccess=function(){return e()}});var t}))})}function Je(r){return!r.closed&&r.messagesCallback?(e=r.db,n=r.lastCursorId,i=e.transaction(C).objectStore(C),o=[],new Promise(function(t){(function(){try{var e=IDBKeyRange.bound(n+1,1/0);return i.openCursor(e)}catch(e){return i.openCursor()}})().onsuccess=function(e){e=e.target.result;e?e.value.id<n+1?e.continue(n+1):(o.push(e.value),e.continue()):t(o)}}).then(function(e){return e.filter(function(e){return!!e}).map(function(e){return e.id>r.lastCursorId&&(r.lastCursorId=e.id),e}).filter(function(e){return t=r,!((e=e).uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime);var t}).sort(function(e,t){return e.time-t.time}).forEach(function(e){r.messagesCallback&&(r.eMIs.add(e.id),r.messagesCallback(e.data))}),x})):x;var e,n,i,o}O={create:function(r,n){return n=We(n),(i=Ue().open("pubkey.broadcast-channel-0-"+r,1)).onupgradeneeded=function(e){e.target.result.createObjectStore(C,{keyPath:"id",autoIncrement:!0})},new Promise(function(e,t){i.onerror=function(e){return t(e)},i.onsuccess=function(){e(i.result)}}).then(function(e){var t={closed:!1,lastCursorId:0,channelName:r,options:n,uuid:$e(),eMIs:new qe(2*n.idb.ttl),writeBlockPromise:x,messagesCallback:null,readQueuePromises:[],db:e};return e.onclose=function(){t.closed=!0,n.idb.onclose&&n.idb.onclose()},function e(t){t.closed||Je(t).then(function(){return _(t.options.idb.fallbackInterval)}).then(function(){return e(t)})}(t),t});var i},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,Je(e)},postMessage:function(o,s){return o.writeBlockPromise=o.writeBlockPromise.then(function(){return e=o.db,t=o.uuid,r=s,n={uuid:t,time:(new Date).getTime(),data:r},i=e.transaction([C],"readwrite"),new Promise(function(e,t){i.oncomplete=function(){return e()},i.onerror=function(e){return t(e)},i.objectStore(C).add(n)});var e,t,r,n,i}).then(function(){0===Math.floor(11*Math.random()+0)&&Ve(o.db,o.options.idb.ttl)}),o.writeBlockPromise},canBeUsed:function(){return!Te&&!!Ue()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:Be};function Ke(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function Qe(e){return"pubkey.broadcastChannel-"+e}function He(){if(Te)return!1;var e=Ke();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var P={create:function(e,t){if(t=We(t),!He())throw new Error("BroadcastChannel: localstorage cannot be used");var r,n=$e(),i=new qe(t.localstorage.removeTimeout),o={channelName:e,uuid:n,eMIs:i};return o.listener=(r=Qe(e),window.addEventListener("storage",s),s),o;function s(e){e.key===r&&(e=JSON.parse(e.newValue),!o.messagesCallback||e.uuid===n||!e.token||i.has(e.token)||e.data.time&&e.data.time<o.messagesCallbackTime||(i.add(e.token),o.messagesCallback(e.data)))}},close:function(e){e=e.listener;window.removeEventListener("storage",e)},onMessage:function(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t},postMessage:function(i,o){return new Promise(function(n){_().then(function(){var e=Qe(i.channelName),t={token:$e(),time:(new Date).getTime(),data:o,uuid:i.uuid},t=JSON.stringify(t),r=(Ke().setItem(e,t),document.createEvent("Event"));r.initEvent("storage",!0,!0),r.key=e,r.newValue=t,window.dispatchEvent(r),n()})})},canBeUsed:He,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:Be},A=Be,Ge=new Set;const Ye={create:function(e){e={name:e,messagesCallback:null};return Ge.add(e),e},close:function(e){Ge.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(t,r){return new Promise(function(e){return setTimeout(function(){Array.from(Ge).filter(function(e){return e.name===t.name}).filter(function(e){return e!==t}).filter(function(e){return!!e.messagesCallback}).forEach(function(e){return e.messagesCallback(r)}),e()},5)})},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:A};function Xe(e,t){var r;this.id=tt++,et.add(this),this.name=e,this.options=We(t),this.method=function(t){var e=[].concat(t.methods,Ze).filter(Boolean);if(t.type){if("simulate"===t.type)return Ye;var r=e.find(function(e){return e.type===t.type});if(r)return r;throw new Error("method-type "+t.type+" not found")}r=(e=t.webWorkerSupport||Te?e:e.filter(function(e){return"idb"!==e.type})).find(function(e){return e.canBeUsed()});if(r)return r;throw new Error("No useable method found in "+JSON.stringify(Ze.map(function(e){return e.type})))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,(e=(r=this).method.create(r.name,r.options))&&"function"==typeof e.then?(r._prepP=e).then(function(e){r._state=e}):r._state=e}var Ze=[e,O,P],et=new Set,tt=0;function rt(t,e,r){var n={time:t.method.microSeconds(),type:e,data:r};return(t._prepP||x).then(function(){var e=t.method.postMessage(t._state,n);return t._uMP.add(e),e.catch().then(function(){return t._uMP.delete(e)}),e})}function nt(e){return 0<e._addEL.message.length||0<e._addEL.internal.length}function it(e,t,r){var n,i,o;e._addEL[t].push(r),!(n=e)._iL&&nt(n)&&(i=function(r){n._addEL[r.type].forEach(function(e){var t=e.time-1e5;r.time>=t&&e.fn(r.data)})},o=n.method.microSeconds(),n._prepP?n._prepP.then(function(){n._iL=!0,n.method.onMessage(n._state,i,o)}):(n._iL=!0,n.method.onMessage(n._state,i,o)))}function ot(e,t,r){e._addEL[t]=e._addEL[t].filter(function(e){return e!==r}),(t=e)._iL&&!nt(t)&&(t._iL=!1,e=t.method.microSeconds(),t.method.onMessage(t._state,null,e))}Xe._pubkey=!0,Xe.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return rt(this,"message",e)},postInternal:function(e){return rt(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};ot(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,it(this,"message",t)):this._onML=null},addEventListener:function(e,t){it(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){ot(this,e,this._addEL[e].find(function(e){return e.fn===t}))},close:function(){var e,t=this;if(!this.closed)return et.delete(this),this.closed=!0,e=this._prepP||x,this._onML=null,this._addEL.message=[],e.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(e){return e()}))}).then(function(){return t.method.close(t._state)})},get type(){return this.method.type},get isClosed(){return this.closed}};var st=function(e,t){function r(e){"leader"===e.context&&("death"===e.action&&(n.hasLeader=!1),"tell"===e.action&&(n.hasLeader=!0))}var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=$e(),this._aplQ=x,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};function j(e,t){t={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(t)}function D(e,t,r){if(!e.s){if(r instanceof at){if(!r.s)return void(r.o=D.bind(null,e,t));1&t&&(t=r.s),r=r.v}r&&r.then?r.then(D.bind(null,e,t),D.bind(null,e,2)):(e.s=t,e.v=r,(t=e.o)&&t(e))}}st.prototype={applyOnce:function(s){var a=this;if(this.isLeader)return _(0,!0);if(this.isDead)return _(0,!1);if(1<this._aplQC)return this._aplQ;function e(){if(a.isLeader)return ze;function e(e){"leader"===e.context&&e.token!=a.token&&(i.push(e),"apply"===e.action&&e.token>a.token&&t(),"tell"===e.action&&(t(),a.hasLeader=!0))}var t,r=!1,n=new Promise(function(e){t=function(){r=!0,e()}}),i=[],o=(a.broadcastChannel.addEventListener("internal",e),s?4*a._options.responseTime:a._options.responseTime);return j(a,"apply").then(function(){return Promise.race([_(o),n.then(function(){return Promise.reject(new Error)})])}).then(function(){return j(a,"apply")}).then(function(){return Promise.race([_(o),n.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return a.broadcastChannel.removeEventListener("internal",e),!r&&function(t){t.isLeader=!0,t.hasLeader=!0;function e(e){"leader"===e.context&&"apply"===e.action&&j(t,"tell"),"leader"!==e.context||"tell"!==e.action||t._dpLC||(t._dpLC=!0,t._dpL(),j(t,"tell"))}var r=je(function(){return t.die()});t._unl.push(r);return t.broadcastChannel.addEventListener("internal",e),t._lstns.push(e),j(t,"tell")}(a).then(function(){return!0})})}return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(e).then(function(){a._aplQC=a._aplQC-1}),this._aplQ.then(function(){return a.isLeader})},awaitLeadership:function(){return this._aLP||(this._aLP=(i=this).isLeader?x:new Promise(function(e){var t=!1;function r(){t||(t=!0,i.broadcastChannel.removeEventListener("internal",n),e(!0))}i.applyOnce().then(function(){i.isLeader&&r()}),function e(){_(i._options.fallbackInterval).then(function(){if(!i.isDead&&!t)return i.isLeader?void r():i.applyOnce(!0).then(function(){(i.isLeader?r:e)()})})}();var n=function(e){"leader"===e.context&&"death"===e.action&&(i.hasLeader=!1,i.applyOnce().then(function(){i.isLeader&&r()}))};i.broadcastChannel.addEventListener("internal",n),i._lstns.push(n)})),this._aLP;var i},set onduplicate(e){this._dpL=e},die:function(){var t=this;return this._lstns.forEach(function(e){return t.broadcastChannel.removeEventListener("internal",e)}),this._lstns=[],this._unl.forEach(function(e){return e.remove()}),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,j(this,"death")}};lt.prototype.then=function(r,n){var i=new lt,e=this.s;if(e){e=1&e?r:n;if(e){try{D(i,1,e(this.v))}catch(e){D(i,2,e)}return i}return this}return this.o=function(e){try{var t=e.v;1&e.s?D(i,1,r?r(t):t):n?D(i,1,n(t)):D(i,2,t)}catch(e){D(i,2,e)}},i};var at=lt;function lt(){}function E(e){return e instanceof at&&1&e.s}function M(e){try{if(e.closed)throw S("SNH",{args:{instanceClosed:e.closed,databaseName:e.databaseName,collectionName:e.collectionName}});if(e.internals.localState)return Promise.resolve(e.internals.localState);var t=h(e.internals.leaderElector);return Promise.resolve(ct(t)).then(function(){return e.internals.localState||!(!t.isLeader||e.internals.localState)&&(e.internals.localState=wt({databaseName:e.databaseName,collectionName:e.collectionName,options:e.options,schema:e.schema,multiInstance:!!e.internals.leaderElector},e.databaseSettings),h(e.internals.localState))})}catch(e){return Promise.reject(e)}}function ct(e){try{var t=function(t,r,n){for(var e;;){var i=t();if(!(i=E(i)?i.v:i))return o;if(i.then){e=0;break}var o=n();if(o&&o.then){if(!E(o)){e=1;break}o=o.s}if(r){var s=r();if(s&&s.then&&!E(s)){e=2;break}}}var a=new at,l=D.bind(null,a,2);return(0===e?i.then(u):1===e?o.then(c):s.then(h)).then(void 0,l),a;function c(e){o=e;do{if(r&&(s=r())&&s.then&&!E(s))return void s.then(h).then(void 0,l);if(!(i=t())||E(i)&&!i.v)return void D(a,1,o);if(i.then)return void i.then(u).then(void 0,l)}while(!(o=E(o=n())?o.v:o)||!o.then);o.then(c).then(void 0,l)}function u(e){e?(o=n())&&o.then?o.then(c).then(void 0,l):c(o):D(a,1,o)}function h(){(i=t())?i.then?i.then(u).then(void 0,l):u(i):D(a,1,o)}}(function(){return!e.hasLeader},void 0,function(){return Promise.resolve(e.applyOnce()).then(function(){return Promise.resolve(B(0)).then(function(){})})});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}function z(s,a,l){try{var c="function"==typeof s.query?ut:"rxdb-lokijs-remote-request-key-object",u=h(s.internals.leaderElector);return Promise.resolve(ct(u)).then(function(){var r,n,i=u.broadcastChannel,e=new Promise(function(t){r=function(e){"leader"===e.context&&"death"===e.action&&t({retry:!0})},i.addEventListener("internal",r)}),o=F(12),t=new Promise(function(t,e){n=function(e){e.type===c&&!0===e.response&&e.requestId===o&&(e.isError?t({retry:!1,error:e.result}):t({retry:!1,result:e.result}))},i.addEventListener("message",n)});return i.postMessage({response:!1,type:c,operation:a,params:l,requestId:o,databaseName:s.databaseName,collectionName:s.collectionName}),Promise.race([e,t]).then(function(e){if(i.removeEventListener("message",n),i.removeEventListener("internal",r),e.retry)return s[a].apply(s,l);if(e.error)throw e.error;return e.result})})}catch(s){return Promise.reject(s)}}var ut="rxdb-lokijs-remote-request";function ht(e){if(!e.$loki)return e;e=m(e);return e.$lastWriteAt&&(e._meta={lwt:e.$lastWriteAt},delete e.$lastWriteAt),delete e.$loki,e}var ft=new Set,dt={disableChangesApi:!0,disableMeta:!0,disableDeltaChangesApi:!0,disableFreeze:!0,cloneMethod:"shallow-assign",clone:!1,transactional:!1,autoupdate:!1},pt=new Map;function yt(s,a){var l,e=pt.get(s);return e||(l=!!a.adapter,e=function(){try{var e=function(){var e=[];return l&&e.push(je(function(){return r.run()})),{database:i,databaseSettings:n,saveQueue:r,collections:{},unloads:e}},t=l?"adapter":"memory",n=(a.persistenceMethod&&(t=a.persistenceMethod),Object.assign({autoload:l,persistenceMethod:t,verbose:!0},a,{autoload:!1,autosave:!1,throttledSaves:!1})),i=new(L())(s+".db",m(n)),r=new Ee(i,n),o=function(){var e;if(l)return e=new Promise(function(t,r){i.loadDatabase({},function(e){n.autoloadCallback&&n.autoloadCallback(e),e?r(e):t()})}),r.saveQueue=r.saveQueue.then(function(){return e}),Promise.resolve(e).then(function(){})}();return Promise.resolve(o&&o.then?o.then(e):e())}catch(e){return Promise.reject(e)}}(),pt.set(s,e)),e}function vt(e,t){if(!t.sort)throw S("SNH",{query:t});var r=t.sort;return function(n,i){var o=0;if(r.find(function(e){var t=Object.keys(e)[0],e="asc"===Object.values(e)[0]?1:-1,r=n[t],t=i[t];return r!==t&&(o=t<r?e:-1*e,!0)}),o)return o;throw S("SNH",{args:{query:t,a:n,b:i}})}}function mt(e){return"string"==typeof e?e:e.key}function gt(e,t,r){var t=r.document[t],n=[!!r.previous,r.previous&&r.previous._deleted,!!r.document._deleted].map(function(e){return e?"1":"0"}).join("");return e.databaseName+"|"+e.collectionName+"|"+t+"||"+n+"|"+r.document._rev}$t(1528);function bt(n,i,o){try{var e=function(){var e=new St(n,i.databaseName,i.collectionName,i.schema,s,i.options,o);return i.multiInstance&&h(s.leaderElector).awaitLeadership().then(function(){e.closed||M(e)}),e},s={},t=function(){if(!i.multiInstance)return s.localState=wt(i,o),Promise.resolve(s.localState).then(function(){});r=n,e=i.databaseName,(t=r.leaderElectorByLokiDbName.get(e))?t.intancesCount=t.intancesCount+1:(t={leaderElector:function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");n=e,r=(r=t)||{},(r=JSON.parse(JSON.stringify(r))).fallbackInterval||(r.fallbackInterval=3e3),r.responseTime||(r.responseTime=n.method.averageResponseTime(n.options));var r,n,i=new st(e,t=r);return e._befC.push(function(){return i.die()}),e._leaderElector=i}(new Xe("rxdb-lokijs-"+e)),intancesCount:1},r.leaderElectorByLokiDbName.set(e,t));var e,t,r=t.leaderElector;s.leaderElector=r}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(n){return Promise.reject(n)}}function wt(i,e){try{return i.options||(i.options={}),Promise.resolve(yt(i.databaseName,e)).then(function(e){var t=[],r=(i.schema.indexes&&i.schema.indexes.forEach(function(e){Array.isArray(e)||t.push(e)}),mt(i.schema.primaryKey)),n=(t.push(r),i.collectionName+"-"+i.schema.version),r=Object.assign({},n,{indices:t,unique:[r]},dt),n=e.database.addCollection(n,r);return e.collections[i.collectionName]=n,{databaseState:e,collection:n}})}catch(i){return Promise.reject(i)}}var It=v(),St=((A=Pt.prototype).bulkWrite=function(t){try{var y=this;if(0===t.length)throw S("P2",{args:{documentWrites:t}});return Promise.resolve(M(y)).then(function(n){if(!n)return z(y,"bulkWrite",[t]);var i,o,s,a,l,c,u,h,f,d={success:{},error:{}},r=new Map,p=new Map,e=(t.forEach(function(e){var e=e.document[y.primaryPath],t=n.collection.by(y.primaryPath,e);t&&(p.set(e,t),r.set(e,ht(t)))}),o=(i=y).primaryPath,s=r,e=t,a=[],l=[],c=[],u=[],h={id:F(10),events:[]},f=v(),e.forEach(function(e){var t=e.document[o],r=s.get(t);if(r){var n=r._rev;if(!e.previous&&r._deleted&&(e.previous=r),!e.previous&&!r._deleted||e.previous&&n!==e.previous._rev)c.push({isError:!0,status:409,documentId:t,writeRow:e,documentInDb:r});else{l.push(e);n=null,r=e.document;if(e.previous&&e.previous._deleted&&!r._deleted?n={id:t,operation:"INSERT",previous:null,doc:r}:!e.previous||e.previous._deleted||r._deleted?e.previous&&!e.previous._deleted&&r._deleted&&(n={id:t,operation:"DELETE",previous:e.previous,doc:null}):n={id:t,operation:"UPDATE",previous:e.previous,doc:r},n)u.push(t),h.events.push({eventId:gt(i,o,e),documentId:t,change:n,startTime:f,endTime:v()});else if(!(e.previous&&e.previous._deleted&&e.document._deleted))throw S("SNH",{args:{writeRow:e}})}}else{r=!!e.document._deleted;a.push(e),r||(u.push(t),h.events.push({eventId:gt(i,o,e),documentId:t,change:{doc:e.document,id:t,operation:"INSERT",previous:null},startTime:f,endTime:v()}))}}),{bulkInsertDocs:a,bulkUpdateDocs:l,errors:c,changedDocumentIds:u,eventBulk:h});return e.bulkInsertDocs.forEach(function(e){var t=e.document[y.primaryPath];n.collection.insert(m(e.document)),d.success[t]=e.document}),e.bulkUpdateDocs.forEach(function(e){var t=e.document[y.primaryPath],r=g(p,t),r=Object.assign({},e.document,{$loki:r.$loki});n.collection.update(r),d.success[t]=e.document}),e.errors.forEach(function(e){d.error[e.documentId]=e}),n.databaseState.saveQueue.addWrite(),y.changes$.next(e.eventBulk),d})}catch(t){return Promise.reject(t)}},A.findDocumentsById=function(e,i){try{var o=this;return Promise.resolve(M(o)).then(function(r){if(!r)return z(o,"findDocumentsById",[e,i]);var n={};return e.forEach(function(e){var t=r.collection.by(o.primaryPath,e);!t||t._deleted&&!i||(n[e]=ht(t))}),n})}catch(e){return Promise.reject(e)}},A.query=function(t){try{var r=this;return Promise.resolve(M(r)).then(function(e){if(!e)return z(r,"query",[t]);e=e.collection.chain().find(t.selector);return t.sort&&(e=e.sort(vt(r.schema,t))),t.skip&&(e=e.offset(t.skip)),{documents:(e=t.limit?e.limit(t.limit):e).data().map(ht)}})}catch(t){return Promise.reject(t)}},A.getAttachmentData=function(e,t){throw new Error("Attachments are not implemented in the lokijs RxStorage. Make a pull request.")},A.getChangedDocumentsSince=function(n,i){try{var o=this;return Promise.resolve(M(o)).then(function(e){if(!e)return z(o,"getChangedDocumentsSince",[n,i]);var r,t=i?i.lwt:1,e=e.collection.chain().find({"_meta.lwt":{$gte:t}}).sort((r=o.primaryPath,function(e,t){return e._meta.lwt===t._meta.lwt?t[r]<e[r]?1:-1:e._meta.lwt-t._meta.lwt})).data(),t=e[0];return i&&t&&t[o.primaryPath]===i.id&&t._meta.lwt===i.lwt&&e.shift(),(e=e.slice(0,n)).map(function(e){return{document:ht(e),checkpoint:{id:e[o.primaryPath],lwt:e._meta.lwt}}})})}catch(n){return Promise.reject(n)}},A.changeStream=function(){return this.changes$.asObservable()},A.cleanup=function(r){try{var n=this;return Promise.resolve(M(n)).then(function(e){if(!e)return z(n,"cleanup",[r]);var t=v()-r,t=e.collection.chain().find({_deleted:!0,"_meta.lwt":{$lt:t}}).limit(10).data();return 0<t.length&&(e.collection.remove(t),e.databaseState.saveQueue.addWrite()),10!==t.length})}catch(r){return Promise.reject(r)}},A.close=function(){try{var e=function(){var e,t,r;e=n.storage,t=n.databaseName,(r=e.leaderElectorByLokiDbName.get(t))&&(r.intancesCount=r.intancesCount-1,0===r.intancesCount&&(r.leaderElector.broadcastChannel.close(),e.leaderElectorByLokiDbName.delete(t)))},n=this,t=(n.closed=!0,n.changes$.complete(),ft.delete(n),function(){if(n.internals.localState)return Promise.resolve(n.internals.localState).then(function(t){return Promise.resolve(yt(n.databaseName,n.databaseSettings)).then(function(e){return Promise.resolve(e.saveQueue.run()).then(function(){return Promise.resolve(function(t,r){try{return Promise.resolve(pt.get(t)).then(function(n){if(n)return Promise.resolve(n.saveQueue.run()).then(function(){r.forEach(function(e){e=e.name;delete n.collections[e]});var e=function(){if(0===Object.keys(n.collections).length)return pt.delete(t),n.unloads.forEach(function(e){return e.remove()}),Promise.resolve(new Promise(function(t,r){n.database.close(function(e){e?r(e):t()})})).then(function(){})}();if(e&&e.then)return e.then(function(){})})})}catch(t){return Promise.reject(t)}}(n.databaseName,[t.collection])).then(function(){})})})})}());return Promise.resolve(t&&t.then?t.then(e):e())}catch(e){return Promise.reject(e)}},A.remove=function(){try{var t=this;return Promise.resolve(M(t)).then(function(e){return e?(e.databaseState.database.removeCollection(e.collection.name),t.close()):z(t,"remove",[])})}catch(t){return Promise.reject(t)}},Pt);function Pt(e,t,r,n,i,o,s){var a=this;this.changes$=new we,this.lastChangefeedSequence=0,this.instanceId=It++,this.closed=!1,this.storage=e,this.databaseName=t,this.collectionName=r,this.schema=n,this.internals=i,this.options=o,this.databaseSettings=s,this.primaryPath=mt(this.schema.primaryKey),ft.add(this),this.internals.leaderElector&&this.internals.leaderElector.awaitLeadership().then(function(){h(a.internals.leaderElector).broadcastChannel.addEventListener("message",function(e){try{return Promise.resolve(function(s,a){try{var e=function(){var r,e,n,i,t,o;if(a.type===ut&&a.requestId&&a.databaseName===s.databaseName&&a.collectionName===s.collectionName&&!a.response)return n=a.operation,i=a.params,t=!(e=function(){var e={response:!0,requestId:a.requestId,databaseName:s.databaseName,collectionName:s.collectionName,result:r,isError:t,type:a.type};h(s.internals.leaderElector).broadcastChannel.postMessage(e)}),(o=function(t){try{var e=Promise.resolve(s[n].apply(s,i)).then(function(e){r=e})}catch(e){return t(e)}return e&&e.then?e.then(void 0,t):e}(function(e){t=!0,r=e}))&&o.then?o.then(e):e()}();return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(s){return Promise.reject(s)}}(a,e))}catch(e){return Promise.reject(e)}})})}var e=$t(1368),Ot=$t.n(e),kt=self.setImmediate||self.setTimeout;function xt(t,e,r,n,i){var o;(0<r||n<e.size)&&(r=r,n=n,e=(o=e).webkitSlice?o.webkitSlice(r,n):o.slice(r,n)),o=e,(r=new FileReader).onloadend=function(e){e=e.target.result||new ArrayBuffer(0);t.append(e),i()},r.readAsArrayBuffer(o)}function _t(e,t,r,n,i){(0<r||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t),i()}function Ct(t,r){var e="string"==typeof t,n=e?t.length:t.size,i=Math.min(32768,n),o=Math.ceil(n/i),s=0,a=new(e?Ot():Ot().ArrayBuffer),l=e?_t:xt;function c(){kt(h)}function u(){e=a.end(!0);var e=btoa(e);r(e),a.destroy()}function h(){var e=s*i;l(a,t,e,e+i,++s<o?c:u)}h()}var At={hash:function(e){return new Promise(function(t){Ct(e,function(e){t(e)})})},hashKey:"md5",doesBroadcastChangestream:function(){return!1},prepareQuery:function(e,t){return 0<Object.keys(h(t.selector)).length?t.selector={$and:[{_deleted:!1},t.selector]}:t.selector={_deleted:!1},t},getSortComparator:function(e,t){return vt(0,t)},getQueryMatcher:function(e,t){return function(e){if(e._deleted)return!1;e=m(e),e._deleted=!!e._deleted,e={data:[e],binaryIndices:{}},Object.setPrototypeOf(e,L().Collection.prototype),e={collection:e};return Object.setPrototypeOf(e,L().Resultset.prototype),e.find(t.selector,!0),0<e.filteredrows.length}}},jt=(Dt.prototype.createStorageInstance=function(e){return bt(this,e,this.databaseSettings)},Dt);function Dt(e){this.name="lokijs",this.statics=At,this.leaderElectorByLokiDbName=new Map,this.databaseSettings=e}O=$t(1934);const Et=O.expose;O.registerSerializer,O.Transfer;var Mt={storage:function(e){return new jt(0<arguments.length&&void 0!==e?e:{})}()},zt=0,$=new Map;Et({createStorageInstance:function(e){try{var t=zt++;return Promise.resolve(Mt.storage.createStorageInstance(e)).then(function(e){return $.set(t,e),t})}catch(e){return Promise.reject(e)}},bulkWrite:function(e,t){return g($,e).bulkWrite(t)},findDocumentsById:function(e,t,r){return g($,e).findDocumentsById(t,r)},query:function(e,t){return g($,e).query(t)},getAttachmentData:function(e,t,r){return g($,e).getAttachmentData(t,r)},getChangedDocumentsSince:function(e,t,r){return g($,e).getChangedDocumentsSince(t,r)},changeStream:function(e){return g($,e).changeStream()},cleanup:function(e,t){return g($,e).cleanup(t)},close:function(e){return g($,e).close()},remove:function(e){return g($,e).remove()}})})()})();