/**
 * @license
 * v1.3.11
 * MIT (https://github.com/pnp/pnpjs/blob/master/LICENSE)
 * Copyright (c) 2020 Microsoft
 * docs: https://pnp.github.io/pnpjs/
 * source: https://github.com/pnp/pnpjs
 * bugs: https://github.com/pnp/pnpjs/issues
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@pnp/common"),require("@pnp/logging")):"function"==typeof define&&define.amd?define(["exports","@pnp/common","@pnp/logging"],t):t((e.pnp=e.pnp||{},e.pnp.odata={}),e.pnp.common,e.pnp.logging)}(this,function(e,s,u){"use strict";var o=(Object.defineProperty(t.prototype,"store",{get:function(){return"local"===this.storeName?t.storage.local:t.storage.session},enumerable:!0,configurable:!0}),t.storage=new s.PnPClientStorage,t);function t(e){this.key=e,this.expiration=s.dateAdd(new Date,"second",s.RuntimeConfig.defaultCachingTimeoutSeconds),this.storeName=s.RuntimeConfig.defaultCachingStore}var i=(n.prototype.parse=function(e){var t=this;return this.parser.parse(e).then(function(e){return t.cacheData(e)})},n.prototype.cacheData=function(e){return null!==this.cacheOptions.store&&this.cacheOptions.store.put(this.cacheOptions.key,e,this.cacheOptions.expiration),e},n);function n(e,t){this.parser=e,this.cacheOptions=t}var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function c(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(s=(i<3?o(s):3<i?o(t,n,s):o(t,n))||s);return 3<i&&s&&Object.defineProperty(t,n,s),s}var p,l=(a(h,p=Error),h.init=function(t){return t.clone().text().then(function(e){return new h("Error making HttpClient request in queryable ["+t.status+"] "+t.statusText+" ::> "+e,t.clone())})},h);function h(e,t,n,r){void 0===n&&(n=t.status),void 0===r&&(r=t.statusText);var o=p.call(this,e)||this;return o.response=t,o.status=n,o.statusText=r,o.isHttpRequestError=!0,o}var f=(g.prototype.parse=function(n){var r=this;return new Promise(function(e,t){r.handleError(n,t)&&r.parseImpl(n,e,t)})},g.prototype.parseImpl=function(e,t,n){var r=this;e.headers.has("Content-Length")&&0===parseFloat(e.headers.get("Content-Length"))||204===e.status?t({}):e.text().then(function(e){return 0<e.replace(/\s/gi,"").length?JSON.parse(e):{}}).then(function(e){return t(r.parseODataJSON(e))}).catch(function(e){return n(e)})},g.prototype.handleError=function(e,t){return e.ok||l.init(e).then(t),e.ok},g.prototype.parseODataJSON=function(e){var t=this.rawJson=e;return s.hOP(e,"d")?t=s.hOP(e.d,"results")?e.d.results:e.d:s.hOP(e,"value")&&(t=e.value),t},g);function g(){this.rawJson={}}var d,y=(a(v,d=f),v);function v(){return null!==d&&d.apply(this,arguments)||this}var m,b=(a(_,m=f),_.prototype.parseImpl=function(e,t){e.text().then(t)},_);function _(){return null!==m&&m.apply(this,arguments)||this}var P,q=(a(w,P=f),w.prototype.parseImpl=function(e,t){e.blob().then(t)},w);function w(){return null!==P&&P.apply(this,arguments)||this}var C,O=(a(D,C=f),D.prototype.parseImpl=function(e,t){e.json().then(t)},D);function D(){return null!==C&&C.apply(this,arguments)||this}var I,L=(a(T,I=f),T.prototype.parseImpl=function(e,t){s.isFunc(e.arrayBuffer)?e.arrayBuffer().then(t):e.buffer().then(t)},T);function T(){return null!==I&&I.apply(this,arguments)||this}var B,j=(a(x,B=f),x.prototype.parseImpl=function(e,t){this.parser(e).then(t)},x);function x(e){var t=B.call(this)||this;return t.parser=e,t}function R(t,n){return new Promise(function(e){t.result=n,t.hasResult=!0,e(t)})}function E(e){return 0<e.pipeline.length?e.pipeline.shift()(e):Promise.resolve(e)}function S(e){e.pipeline.length<1&&u.Logger.write("["+e.requestId+"] ("+(new Date).getTime()+") Request pipeline contains no methods!",2);var t=E(e).then(function(e){return t=e,u.Logger.log({data:0===u.Logger.activeLogLevel?t.result:{},level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Returning result from pipeline. Set logging to verbose to see data."}),Promise.resolve(t.result);var t}).catch(function(e){throw u.Logger.error(e),e});return e.isBatched&&e.batch.addResolveBatchDependency(t),t}function U(i){return void 0===i&&(i=!1),function(n,r,e){var o=e.value;e.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!i&&0<e.length&&s.hOP(e[0],"hasResult")&&e[0].hasResult?(u.Logger.write("["+e[0].requestId+"] ("+(new Date).getTime()+") Skipping request pipeline method "+r+", existing result in pipeline.",0),Promise.resolve(e[0])):(u.Logger.write("["+e[0].requestId+"] ("+(new Date).getTime()+") Calling request pipeline method "+r+".",0),o.apply(n,e).then(function(e){return E(e)}))}}}var N=(k.logStart=function(t){return new Promise(function(e){u.Logger.log({data:1===u.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Beginning "+t.verb+" request ("+t.requestAbsoluteUrl+")"}),e(t)})},k.caching=function(r){return new Promise(function(t){if(r.isCached){u.Logger.write("["+r.requestId+"] ("+(new Date).getTime()+") Caching is enabled for request, checking cache...",1);var e=new o(r.requestAbsoluteUrl.toLowerCase());if(void 0!==r.cachingOptions&&(e=s.extend(e,r.cachingOptions)),null!==e.store){var n=e.store.get(e.key);if(null!==n)return u.Logger.log({data:1===u.Logger.activeLogLevel?{}:n,level:1,message:"["+r.requestId+"] ("+(new Date).getTime()+") Value returned from cache."}),s.isFunc(r.batchDependency)&&r.batchDependency(),s.hOP(r.parser,"hydrate")&&(n=r.parser.hydrate(n)),R(r,n).then(function(e){return t(e)})}u.Logger.write("["+r.requestId+"] ("+(new Date).getTime()+") Value not found in cache.",1),r.parser=new i(r.parser,e)}return t(r)})},k.send=function(i){return new Promise(function(t,n){if(i.isBatched){var e=i.batch.add(i.requestAbsoluteUrl,i.verb,i.options,i.parser,i.requestId);s.isFunc(i.batchDependency)&&i.batchDependency(),u.Logger.write("["+i.requestId+"] ("+(new Date).getTime()+") Batching request in batch "+i.batch.batchId+".",1),t(R(i,e))}else{u.Logger.write("["+i.requestId+"] ("+(new Date).getTime()+") Sending request.",1);var r=i.clientFactory(),o=s.extend(i.options||{},{method:i.verb});r.fetch(i.requestAbsoluteUrl,o).then(function(e){return i.parser.parse(e)}).then(function(e){return R(i,e)}).then(function(e){return t(e)}).catch(function(e){return n(e)})}})},k.logEnd=function(t){return new Promise(function(e){t.isBatched?u.Logger.log({data:1===u.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") "+t.verb+" request will complete in batch "+t.batch.batchId+"."}):u.Logger.log({data:1===u.Logger.activeLogLevel?{}:t,level:1,message:"["+t.requestId+"] ("+(new Date).getTime()+") Completing "+t.verb+" request."}),e(t)})},c([U(!0)],k,"logStart",null),c([U()],k,"caching",null),c([U()],k,"send",null),c([U(!0)],k,"logEnd",null),k);function k(){}function A(){return[N.logStart,N.caching,N.send,N.logEnd].slice(0)}var F=(J.prototype.toUrl=function(){return this._url},J.prototype.concat=function(e){return this._url+=e,this},Object.defineProperty(J.prototype,"query",{get:function(){return this._query},enumerable:!0,configurable:!0}),J.prototype.configure=function(e){return s.mergeOptions(this._options,e),this},J.prototype.configureFrom=function(e){return s.mergeOptions(this._options,e._options),this},J.prototype.usingCaching=function(e){return s.RuntimeConfig.globalCacheDisable||(this._useCaching=!0,void 0!==e&&(this._cachingOptions=e)),this},J.prototype.withPipeline=function(e){return this._requestPipeline=e.slice(0),this},J.prototype.getCore=function(e,t){return void 0===e&&(e=new O),void 0===t&&(t={}),this._cloneParentWasCaching&&this.usingCaching(this._cloneParentCacheOptions),this.reqImpl("GET",t,e)},J.prototype.postCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new O),this.reqImpl("POST",e,t)},J.prototype.patchCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new O),this.reqImpl("PATCH",e,t)},J.prototype.deleteCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new O),this.reqImpl("DELETE",e,t)},J.prototype.putCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new O),this.reqImpl("PUT",e,t)},J.prototype.reqImpl=function(t,n,r){var o=this;return void 0===n&&(n={}),this.getRequestPipeline(t,n,r).then(function(e){return o.toRequestContext(t,n,r,e)}).then(function(e){return S(e)})},J.prototype.append=function(e){this._url=s.combine(this._url,e)},Object.defineProperty(J.prototype,"parentUrl",{get:function(){return this._parentUrl},enumerable:!0,configurable:!0}),J.prototype.extend=function(e,t){this._parentUrl=e._url,this._url=s.combine(this._parentUrl,t||""),this.configureFrom(e)},J.prototype._clone=function(e,t){return e.configureFrom(this),this._useCaching&&(e._cloneParentWasCaching=!0,e._cloneParentCacheOptions=this._cachingOptions),e},J.prototype.getRequestPipeline=function(e,t,n){var r=this;return void 0===t&&(t={}),new Promise(function(e){s.objectDefinedNotNull(r._requestPipeline)&&s.isArray(r._requestPipeline)?e(r._requestPipeline):e(A())})},J);function J(){this._query=new Map,this._options={},this._url="",this._parentUrl="",this._useCaching=!1,this._cachingOptions=null,this._cloneParentWasCaching=!1,this._cloneParentCacheOptions=null,this._requestPipeline=null}var H,M=(a(W,H=F),W.prototype.inBatch=function(e){if(null!==this.batch)throw Error("This query is already part of a batch.");return s.objectDefinedNotNull(e)&&(this._batch=e),this},W.prototype.toUrl=function(){return this._url},W.prototype.get=function(e,t){return void 0===e&&(e=new y),void 0===t&&(t={}),this.getCore(e,t)},W.prototype.getCore=function(e,t){return void 0===e&&(e=new y),void 0===t&&(t={}),H.prototype.getCore.call(this,e,t)},W.prototype.postCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new y),H.prototype.postCore.call(this,e,t)},W.prototype.patchCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new y),H.prototype.patchCore.call(this,e,t)},W.prototype.deleteCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new y),H.prototype.deleteCore.call(this,e,t)},W.prototype.putCore=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=new y),H.prototype.putCore.call(this,e,t)},W.prototype.reqImpl=function(e,t,n){return void 0===t&&(t={}),this.hasBatch&&(this._batchDependency=this.addBatchDependency()),H.prototype.reqImpl.call(this,e,t,n)},W.prototype.addBatchDependency=function(){return null!==this._batch?this._batch.addDependency():function(){return null}},Object.defineProperty(W.prototype,"hasBatch",{get:function(){return s.objectDefinedNotNull(this._batch)},enumerable:!0,configurable:!0}),Object.defineProperty(W.prototype,"batch",{get:function(){return this.hasBatch?this._batch:null},enumerable:!0,configurable:!0}),W.prototype._clone=function(e,t){return e=H.prototype._clone.call(this,e,t),t.includeBatch&&(e=e.inBatch(this._batch)),e},W);function W(){var e=H.call(this)||this;return e._batch=null,e._batchDependency=null,e}var G=(Object.defineProperty(Q.prototype,"batchId",{get:function(){return this._batchId},enumerable:!0,configurable:!0}),Object.defineProperty(Q.prototype,"requests",{get:function(){return this._reqs},enumerable:!0,configurable:!0}),Q.prototype.add=function(e,t,n,r,o){var i={id:o,method:t.toUpperCase(),options:n,parser:r,reject:null,resolve:null,url:e},s=new Promise(function(e,t){i.resolve=e,i.reject=t});return this._reqs.push(i),s},Q.prototype.addDependency=function(){var t=function(){};return this._deps.push(new Promise(function(e){t=e})),t},Q.prototype.addResolveBatchDependency=function(e){this._rDeps.push(e)},Q.prototype.execute=function(){var e=this;return Promise.all(this._deps).then(function(){return Promise.all(e._deps)}).then(function(){return e.executeImpl()}).then(function(){return Promise.all(e._rDeps)}).then(function(){})},Q);function Q(e){void 0===e&&(e=s.getGUID()),this._batchId=e,this._reqs=[],this._deps=[],this._rDeps=[]}e.CachingOptions=o,e.CachingParserWrapper=i,e.HttpRequestError=l,e.ODataParserBase=f,e.ODataDefaultParser=y,e.TextParser=b,e.BlobParser=q,e.JSONParser=O,e.BufferParser=L,e.LambdaParser=j,e.setResult=R,e.pipe=S,e.requestPipelineMethod=U,e.PipelineMethods=N,e.getDefaultPipeline=A,e.Queryable=F,e.ODataQueryable=M,e.ODataBatch=G,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=odata.es5.umd.min.js.map
