export{_on as on};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};import{isWindowClosed}from"cross-domain-utils/src";import{ZalgoPromise}from"zalgo-promise/src";import{once as onceFunction,safeInterval}from"belter/src";import{addRequestListener}from"../drivers";import{WILDCARD}from"../conf";import{global}from"../global";export function listen(n){if(!n.name)throw new Error("Expected options.name");if(!n.handler)throw new Error("Expected options.handler");var o=n.name,r=n.window,e=n.domain,t={handler:n.handler,handleError:n.errorHandler||function(n){throw n},window:r,domain:e||WILDCARD,name:o},i=addRequestListener({name:o,win:r,domain:e},t);if(n.once){var a=t.handler;t.handler=onceFunction(function(){return i.cancel(),a.apply(this,arguments)})}if(t.window&&n.errorOnClose)var l=safeInterval(function(){r&&"object"===(void 0===r?"undefined":_typeof(r))&&isWindowClosed(r)&&(l.cancel(),t.handleError(new Error("Post message target window is closed")))},50);return{cancel:function(){i.cancel()}}};function _on(n,o,r){return"function"==typeof o&&(r=o,o={}),(o=o||{}).name=n,o.handler=r||o.handler,listen(o)}export function once(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];"function"==typeof o&&(r=o,o={}),o=o||{},r=r||o.handler;var e=o.errorHandler,t=new ZalgoPromise(function(t,i){(o=o||{}).name=n,o.once=!0,o.handler=function(n){if(t(n),r)return r(n)},o.errorHandler=function(n){if(i(n),e)return e(n)}}),i=listen(o);return t.cancel=i.cancel,t};export function listener(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{on:function(o,r){return _on(o,n,r)}}};global.on=_on;