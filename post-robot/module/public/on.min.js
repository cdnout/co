"use strict";exports.__esModule=!0,exports.on=on,exports.once=once;var _src=require("zalgo-promise/src"),_drivers=require("../drivers"),_conf=require("../conf");const getDefaultServerOptions=()=>({});function on(e,r,n){if(!e)throw new Error("Expected name");if("function"==typeof(r=r||getDefaultServerOptions())&&(n=r,r=getDefaultServerOptions()),!n)throw new Error("Expected handler");(r=r||{}).name=e,r.handler=n||r.handler;const o=r.window,t=r.domain,c={handler:r.handler,handleError:r.errorHandler||(e=>{throw e}),window:o,domain:t||_conf.WILDCARD,name:e},a=(0,_drivers.addRequestListener)({name:e,win:o,domain:t},c);return{cancel(){a.cancel()}}}function once(e,r,n){"function"==typeof(r=r||getDefaultServerOptions())&&(n=r,r=getDefaultServerOptions());const o=new _src.ZalgoPromise;let t;return r.errorHandler=(e=>{t.cancel(),o.reject(e)}),t=on(e,r,e=>{if(t.cancel(),o.resolve(e),n)return n(e)}),o.cancel=t.cancel,o}