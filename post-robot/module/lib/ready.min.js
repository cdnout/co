import{WeakMap}from"cross-domain-safe-weakmap/src";import{getAncestor}from"cross-domain-utils/src";import{ZalgoPromise}from"zalgo-promise/src";import{noop}from"belter/src";import{MESSAGE_NAME,WILDCARD}from"../conf";import{global}from"../global";global.readyPromises=global.readyPromises||new WeakMap,global.knownWindows=global.knownWindows||new WeakMap;export function onHello(o){global.on(MESSAGE_NAME.HELLO,{domain:WILDCARD},function(n){var r=n.source,e=n.origin;return o({source:r,origin:e})})};export function sayHello(o){return global.send(o,MESSAGE_NAME.HELLO,{},{domain:WILDCARD,timeout:-1}).then(function(o){return{origin:o.origin}})};export function markWindowKnown(o){global.knownWindows.set(o,!0)};export function isWindowKnown(o){return global.knownWindows.get(o)};export function initOnReady(){onHello(function(o){var n=o.source,r=o.origin,e=global.readyPromises.get(n)||new ZalgoPromise;e.resolve({origin:r}),global.readyPromises.set(n,e)});var o=getAncestor();o&&sayHello(o).catch(noop)};export function onChildWindowReady(o){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Window",e=global.readyPromises.get(o);return e||(e=new ZalgoPromise,global.readyPromises.set(o,e),-1!==n&&setTimeout(function(){return e.reject(new Error(r+" did not load after "+n+"ms"))},n),e)};