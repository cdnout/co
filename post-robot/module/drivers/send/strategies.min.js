"use strict";exports.__esModule=!0,exports.SEND_MESSAGE_STRATEGIES=void 0;var _src=require("cross-domain-utils/src"),_conf=require("../../conf"),_lib=require("../../lib"),_global=require("../../global"),_bridge=require("../../bridge");const SEND_MESSAGE_STRATEGIES={};exports.SEND_MESSAGE_STRATEGIES=SEND_MESSAGE_STRATEGIES,SEND_MESSAGE_STRATEGIES[_conf.SEND_STRATEGY.POST_MESSAGE]=((e,o,r)=>{if(0===r.indexOf(_src.PROTOCOL.FILE)&&(r=_conf.WILDCARD),__TEST__){if((0,_lib.needsGlobalMessagingForBrowser)()&&!1===(0,_src.isSameTopWindow)(window,e))return;if(0===r.indexOf(_src.PROTOCOL.MOCK)){if(!(0,_src.isActuallySameDomain)(e))throw new Error(`Attempting to send message to mock domain ${r}, but window is actually cross-domain`);const o=(0,_src.getDomain)(e);if(o!==r)throw new Error(`Mock domain target ${r} does not match window domain ${o}`);r=(0,_src.getActualDomain)(e)}}e.postMessage(o,r)}),__POST_ROBOT__.__IE_POPUP_SUPPORT__&&(SEND_MESSAGE_STRATEGIES[_conf.SEND_STRATEGY.BRIDGE]=((e,o,r)=>{if(!(0,_bridge.needsBridgeForBrowser)()&&!(0,_bridge.isBridge)())throw new Error("Bridge not needed for browser");if((0,_src.isSameDomain)(e))throw new Error("Post message through bridge disabled between same domain windows");if(!1!==(0,_src.isSameTopWindow)(window,e))throw new Error("Can only use bridge to communicate between two different windows, not between frames");(0,_bridge.sendBridgeMessage)(e,r,o)})),(__POST_ROBOT__.__IE_POPUP_SUPPORT__||__POST_ROBOT__.__GLOBAL_MESSAGE_SUPPORT__)&&(SEND_MESSAGE_STRATEGIES[_conf.SEND_STRATEGY.GLOBAL]=((e,o)=>{if(!(0,_lib.needsGlobalMessagingForBrowser)())throw new Error("Global messaging not needed for browser");if(!(0,_src.isSameDomain)(e))throw new Error("Post message through global disabled between different domain windows");if(!1!==(0,_src.isSameTopWindow)(window,e))throw new Error("Can only use global to communicate between two different windows, not between frames");const r=(0,_global.getGlobal)(e);if(!r)throw new Error("Can not find postRobot global on foreign window");r.receiveMessage({source:window,origin:(0,_src.getDomain)(),data:o})}));