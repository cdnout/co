"use strict";var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var d=e.length-1;0<=d;d--)(i=e[d])&&(a=(n<3?i(a):3<n?i(t,r,a):i(t,r))||a);return 3<n&&a&&Object.defineProperty(t,r,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var gridOptionsWrapper_1=require("./gridOptionsWrapper"),columnApi_1=require("./columnController/columnApi"),columnController_1=require("./columnController/columnController"),rowRenderer_1=require("./rendering/rowRenderer"),filterManager_1=require("./filter/filterManager"),eventService_1=require("./eventService"),gridPanel_1=require("./gridPanel/gridPanel"),logger_1=require("./logger"),popupService_1=require("./widgets/popupService"),context_1=require("./context/context"),focusedCellController_1=require("./focusedCellController"),component_1=require("./widgets/component"),gridApi_1=require("./gridApi"),componentAnnotations_1=require("./widgets/componentAnnotations"),events_1=require("./events"),resizeObserverService_1=require("./misc/resizeObserverService"),sideBar_1=require("./entities/sideBar"),utils_1=require("./utils"),GridCore=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.init=function(){var t=this;this.logger=this.loggerFactory.create("GridCore");var e=this.enterprise?i.TEMPLATE_ENTERPRISE:i.TEMPLATE_NORMAL;this.setTemplate(e),[this.gridApi,this.filterManager,this.rowRenderer,this.popupService].forEach(function(e){return e.registerGridCore(t)}),this.enterprise&&this.clipboardService.registerGridCore(this),this.gridOptionsWrapper.addLayoutElement(this.getGui()),this.setSideBarVisible(this.gridOptionsWrapper.isShowToolPanel()),this.eGridDiv.appendChild(this.getGui()),this.addDestroyFunc(function(){t.eGridDiv.removeChild(t.getGui())}),this.$scope&&(e=this.$scope.$watch(this.quickFilterOnScope,function(e){return t.filterManager.setQuickFilter(e)}),this.addDestroyFunc(e)),this.addRtlSupport(),this.logger.log("ready"),this.gridOptionsWrapper.addLayoutElement(this.eRootWrapperBody);var r=this.gridPanel.getGui();this.addDestroyableEventListener(r,"focusin",function(){utils_1._.addCssClass(r,"ag-has-focus")}),this.addDestroyableEventListener(r,"focusout",function(e){r.contains(e.relatedTarget)||utils_1._.removeCssClass(r,"ag-has-focus")});var o=this.resizeObserverService.observeResize(this.eGridDiv,this.onGridSizeChanged.bind(this));this.addDestroyFunc(function(){return o()})},i.prototype.onGridSizeChanged=function(){var e={type:events_1.Events.EVENT_GRID_SIZE_CHANGED,api:this.gridApi,columnApi:this.columnApi,clientWidth:this.eGridDiv.clientWidth,clientHeight:this.eGridDiv.clientHeight};this.eventService.dispatchEvent(e)},i.prototype.addRtlSupport=function(){var e=this.gridOptionsWrapper.isEnableRtl()?"ag-rtl":"ag-ltr";utils_1._.addCssClass(this.getGui(),e)},i.prototype.getRootGui=function(){return this.getGui()},i.prototype.isSideBarVisible=function(){return!!this.sideBarComp&&this.sideBarComp.isDisplayed()},i.prototype.setSideBarVisible=function(e){this.sideBarComp?this.sideBarComp.setDisplayed(e):e&&console.warn("ag-Grid: toolPanel is only available in ag-Grid Enterprise")},i.prototype.closeToolPanel=function(){this.sideBarComp?this.sideBarComp.close():console.warn("ag-Grid: toolPanel is only available in ag-Grid Enterprise")},i.prototype.getSideBar=function(){return this.gridOptions.sideBar},i.prototype.refreshSideBar=function(){this.sideBarComp&&this.sideBarComp.refresh()},i.prototype.setSideBar=function(e){this.eRootWrapperBody.removeChild(this.sideBarComp.getGui()),this.gridOptions.sideBar=sideBar_1.SideBarDefParser.parse(e),this.sideBarComp.reset(),this.eRootWrapperBody.appendChild(this.sideBarComp.getGui())},i.prototype.getOpenedToolPanel=function(){return this.sideBarComp?this.sideBarComp.openedItem():null},i.prototype.openToolPanel=function(e){this.sideBarComp?this.sideBarComp.openToolPanel(e):console.warn("ag-Grid: toolPanel is only available in ag-Grid Enterprise")},i.prototype.isToolPanelShowing=function(){return this.sideBarComp.isToolPanelShowing()},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.logger.log("Grid DOM removed")},i.prototype.ensureNodeVisible=function(e,t){if(void 0===t&&(t="top"),this.doingVirtualPaging)throw new Error("Cannot use ensureNodeVisible when doing virtual paging, as we cannot check rows that are not in memory");for(var r=this.rowModel.getRowCount(),o="function"==typeof e,i=-1,n=0;n<r;n++){var a=this.rowModel.getRow(n);if(o){if(e(a)){i=n;break}}else if(e===a||e===a.data){i=n;break}}0<=i&&this.gridPanel.ensureIndexVisible(i,t)},i.TEMPLATE_NORMAL='<div class="ag-root-wrapper">\n            <div class="ag-root-wrapper-body" ref="rootWrapperBody">\n                <ag-grid-comp ref="gridPanel"></ag-grid-comp>\n            </div>\n            <ag-pagination></ag-pagination>\n        </div>',i.TEMPLATE_ENTERPRISE='<div class="ag-root-wrapper">\n            <ag-grid-header-drop-zones></ag-grid-header-drop-zones>\n            <div ref="rootWrapperBody" class="ag-root-wrapper-body">\n                <ag-grid-comp ref="gridPanel"></ag-grid-comp>\n                <ag-side-bar ref="sideBar"></ag-side-bar>\n            </div>\n            <ag-status-bar ref="statusBar"></ag-status-bar>\n            <ag-pagination></ag-pagination>\n            <ag-watermark></ag-watermark>\n        </div>',__decorate([context_1.Autowired("enterprise"),__metadata("design:type",Boolean)],i.prototype,"enterprise",void 0),__decorate([context_1.Autowired("gridOptions"),__metadata("design:type",Object)],i.prototype,"gridOptions",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],i.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("rowModel"),__metadata("design:type",Object)],i.prototype,"rowModel",void 0),__decorate([context_1.Autowired("resizeObserverService"),__metadata("design:type",resizeObserverService_1.ResizeObserverService)],i.prototype,"resizeObserverService",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],i.prototype,"columnController",void 0),__decorate([context_1.Autowired("rowRenderer"),__metadata("design:type",rowRenderer_1.RowRenderer)],i.prototype,"rowRenderer",void 0),__decorate([context_1.Autowired("filterManager"),__metadata("design:type",filterManager_1.FilterManager)],i.prototype,"filterManager",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],i.prototype,"eventService",void 0),__decorate([context_1.Autowired("eGridDiv"),__metadata("design:type",HTMLElement)],i.prototype,"eGridDiv",void 0),__decorate([context_1.Autowired("$scope"),__metadata("design:type",Object)],i.prototype,"$scope",void 0),__decorate([context_1.Autowired("quickFilterOnScope"),__metadata("design:type",String)],i.prototype,"quickFilterOnScope",void 0),__decorate([context_1.Autowired("popupService"),__metadata("design:type",popupService_1.PopupService)],i.prototype,"popupService",void 0),__decorate([context_1.Autowired("focusedCellController"),__metadata("design:type",focusedCellController_1.FocusedCellController)],i.prototype,"focusedCellController",void 0),__decorate([context_1.Autowired("loggerFactory"),__metadata("design:type",logger_1.LoggerFactory)],i.prototype,"loggerFactory",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],i.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],i.prototype,"gridApi",void 0),__decorate([context_1.Optional("clipboardService"),__metadata("design:type",Object)],i.prototype,"clipboardService",void 0),__decorate([componentAnnotations_1.RefSelector("gridPanel"),__metadata("design:type",gridPanel_1.GridPanel)],i.prototype,"gridPanel",void 0),__decorate([componentAnnotations_1.RefSelector("sideBar"),__metadata("design:type",Object)],i.prototype,"sideBarComp",void 0),__decorate([componentAnnotations_1.RefSelector("rootWrapperBody"),__metadata("design:type",HTMLElement)],i.prototype,"eRootWrapperBody",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],i.prototype,"init",null),i}(component_1.Component);exports.GridCore=GridCore;