"use strict";var __decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(s=(r<3?n(s):3<r?n(t,i,s):n(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var eventService_1=require("../eventService"),events_1=require("../events"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),selectionController_1=require("../selectionController"),valueService_1=require("../valueService/valueService"),columnController_1=require("../columnController/columnController"),columnApi_1=require("../columnController/columnApi"),context_1=require("../context/context"),constants_1=require("../constants"),valueCache_1=require("../valueService/valueCache"),gridApi_1=require("../gridApi"),utils_1=require("../utils"),RowNode=function(){function o(){this.childrenMapped={},this.selectable=!0,this.__objectId=o.OBJECT_ID_SEQUENCE++,this.alreadyRendered=!1,this.selected=!1}return o.prototype.setData=function(e){var t=this.data;this.data=e,this.valueCache.onDataChanged(),this.updateDataOnDetailNode(),this.checkRowSelectable();t=this.createDataChangedEvent(e,t,!1);this.dispatchLocalEvent(t)},o.prototype.updateDataOnDetailNode=function(){this.detailNode&&(this.detailNode.data=this.data)},o.prototype.createDataChangedEvent=function(e,t,i){return{type:o.EVENT_DATA_CHANGED,node:this,oldData:t,newData:e,update:i}},o.prototype.createLocalRowEvent=function(e){return{type:e,node:this}},o.prototype.updateData=function(e){var t=this.data;this.data=e,this.updateDataOnDetailNode(),this.checkRowSelectable(),this.updateDataOnDetailNode();t=this.createDataChangedEvent(e,t,!0);this.dispatchLocalEvent(t)},o.prototype.getRowIndexString=function(){return this.rowPinned===constants_1.Constants.PINNED_TOP?"t-"+this.rowIndex:this.rowPinned===constants_1.Constants.PINNED_BOTTOM?"b-"+this.rowIndex:this.rowIndex.toString()},o.prototype.createDaemonNode=function(){var e=new o;return this.context.wireBean(e),e.id=this.id,e.data=this.data,e.daemon=!0,e.selected=this.selected,e.level=this.level,e},o.prototype.setDataAndId=function(e,t){var i=utils_1._.exists(this.id)?this.createDaemonNode():null,o=this.data;this.data=e,this.updateDataOnDetailNode(),this.setId(t),this.selectionController.syncInRowNode(this,i),this.checkRowSelectable();o=this.createDataChangedEvent(e,o,!1);this.dispatchLocalEvent(o)},o.prototype.checkRowSelectable=function(){var e=this.gridOptionsWrapper.getIsRowSelectableFunc(),t=e&&utils_1._.exists(this);this.setRowSelectable(!t||e(this))},o.prototype.setRowSelectable=function(e){this.selectable!==e&&(this.selectable=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_SELECTABLE_CHANGED)))},o.prototype.setId=function(e){var t=this.gridOptionsWrapper.getRowNodeIdFunc();t?this.data?this.id=t(this.data):this.id=void 0:this.id=e},o.prototype.isPixelInRange=function(e){return e>=this.rowTop&&e<this.rowTop+this.rowHeight},o.prototype.clearRowTop=function(){this.oldRowTop=this.rowTop,this.setRowTop(null)},o.prototype.setFirstChild=function(e){this.firstChild!==e&&(this.firstChild=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_FIRST_CHILD_CHANGED)))},o.prototype.setLastChild=function(e){this.lastChild!==e&&(this.lastChild=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_LAST_CHILD_CHANGED)))},o.prototype.setChildIndex=function(e){this.childIndex!==e&&(this.childIndex=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_CHILD_INDEX_CHANGED)))},o.prototype.setRowTop=function(e){this.rowTop!==e&&(this.rowTop=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_TOP_CHANGED)))},o.prototype.setDragging=function(e){this.dragging!==e&&(this.dragging=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_DRAGGING_CHANGED)))},o.prototype.setAllChildrenCount=function(e){this.allChildrenCount!==e&&(this.allChildrenCount=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_ALL_CHILDREN_COUNT_CHANGED)))},o.prototype.setRowHeight=function(e,t){void 0===t&&(t=!1),this.rowHeight=e,this.rowHeightEstimated=t,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_HEIGHT_CHANGED))},o.prototype.setRowIndex=function(e){this.rowIndex=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_ROW_INDEX_CHANGED))},o.prototype.setUiLevel=function(e){this.uiLevel!==e&&(this.uiLevel=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_UI_LEVEL_CHANGED)))},o.prototype.setExpanded=function(e){this.expanded!==e&&(this.expanded=e,this.eventService&&this.eventService.dispatchEvent(this.createLocalRowEvent(o.EVENT_EXPANDED_CHANGED)),e=this.createGlobalRowEvent(events_1.Events.EVENT_ROW_GROUP_OPENED),this.mainEventService.dispatchEvent(e),this.gridOptionsWrapper.isGroupIncludeFooter()&&this.gridApi.redrawRows({rowNodes:[this]}))},o.prototype.createGlobalRowEvent=function(e){return{type:e,node:this,data:this.data,rowIndex:this.rowIndex,rowPinned:this.rowPinned,context:this.gridOptionsWrapper.getContext(),api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi()}},o.prototype.dispatchLocalEvent=function(e){this.eventService&&this.eventService.dispatchEvent(e)},o.prototype.setDataValue=function(e,t){e=this.columnController.getPrimaryColumn(e);this.valueService.setValue(this,e,t),this.dispatchCellChangedEvent(e,t)},o.prototype.setGroupValue=function(e,t){e=this.columnController.getGridColumn(e);utils_1._.missing(this.groupData)&&(this.groupData={}),this.groupData[e.getColId()]=t,this.dispatchCellChangedEvent(e,t)},o.prototype.setAggData=function(e){var i=this,t=utils_1._.getAllKeysInObjects([this.aggData,e]);this.aggData=e,this.eventService&&t.forEach(function(e){var t=i.columnController.getGridColumn(e),e=i.aggData?i.aggData[e]:void 0;i.dispatchCellChangedEvent(t,e)})},o.prototype.hasChildren=function(){return this.group||this.childrenAfterGroup&&0<this.childrenAfterGroup.length},o.prototype.isEmptyRowGroupNode=function(){return this.group&&utils_1._.missingOrEmpty(this.childrenAfterGroup)},o.prototype.dispatchCellChangedEvent=function(e,t){t={type:o.EVENT_CELL_CHANGED,node:this,column:e,newValue:t};this.dispatchLocalEvent(t)},o.prototype.resetQuickFilterAggregateText=function(){this.quickFilterAggregateText=null},o.prototype.isExpandable=function(){return this.hasChildren()||this.master},o.prototype.isSelected=function(){return this.footer?this.sibling.isSelected():this.selected},o.prototype.depthFirstSearch=function(t){this.childrenAfterGroup&&this.childrenAfterGroup.forEach(function(e){return e.depthFirstSearch(t)}),t(this)},o.prototype.calculateSelectedFromChildren=function(){var e,t=!1,i=!1,o=!1;if(this.childrenAfterGroup)for(var n=0;n<this.childrenAfterGroup.length;n++){var r=this.childrenAfterGroup[n];if(r.selectable)switch(r.isSelected()){case!0:t=!0;break;case!1:i=!0;break;default:o=!0}}e=o?void 0:!(!t||i)||!(!t&&i)&&void 0,this.selectThisNode(e)},o.prototype.setSelectedInitialValue=function(e){this.selected=e},o.prototype.setSelected=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),this.setSelectedParams({newValue:e,clearSelection:t,suppressFinishActions:i,rangeSelect:!1})},o.prototype.isRowPinned=function(){return this.rowPinned===constants_1.Constants.PINNED_TOP||this.rowPinned===constants_1.Constants.PINNED_BOTTOM},o.prototype.setSelectedParams=function(e){var t=this.gridOptionsWrapper.isGroupSelectsChildren(),i=!0===e.newValue,o=!0===e.clearSelection,n=!0===e.suppressFinishActions,r=!0===e.rangeSelect,s=t&&!0===e.groupSelectsFiltered;if(void 0===this.id)return console.warn("ag-Grid: cannot select node until id for node is known"),0;if(this.rowPinned)return console.warn("ag-Grid: cannot select pinned rows"),0;if(this.footer)return this.sibling.setSelectedParams(e);if(r){var r=this.selectionController.getLastSelectedNode()!==this,a=this.gridOptionsWrapper.isRowSelectionMulti();if(r&&a)return this.doRowRangeSelection()}a=0;return s&&this.group||this.selectThisNode(i)&&a++,t&&this.group&&(a+=this.selectChildNodes(i,s)),n||(!i||!o&&this.gridOptionsWrapper.isRowSelectionMulti()||(a+=this.selectionController.clearOtherNodes(this)),0<a&&(this.selectionController.updateGroupsFromChildrenSelections(),o={type:events_1.Events.EVENT_SELECTION_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.mainEventService.dispatchEvent(o)),i&&this.selectionController.setLastSelectedNode(this)),a},o.prototype.doRowRangeSelection=function(){var t=0,i=this.gridOptionsWrapper.isGroupSelectsChildren(),e=this.selectionController.getLastSelectedNode();this.rowModel.getNodesInRangeForSelection(this,e).forEach(function(e){e.group&&i||e.selectThisNode(!0)&&t++}),this.selectionController.updateGroupsFromChildrenSelections();e={type:events_1.Events.EVENT_SELECTION_CHANGED,api:this.gridApi,columnApi:this.columnApi};return this.mainEventService.dispatchEvent(e),t},o.prototype.isParentOfNode=function(e){for(var t=this.parent;t;){if(t===e)return!0;t=t.parent}return!1},o.prototype.selectThisNode=function(e){if(!this.selectable||this.selected===e)return!1;this.selected=e,this.eventService&&this.dispatchLocalEvent(this.createLocalRowEvent(o.EVENT_ROW_SELECTED));e=this.createGlobalRowEvent(events_1.Events.EVENT_ROW_SELECTED);return this.mainEventService.dispatchEvent(e),!0},o.prototype.selectChildNodes=function(e,t){var i=t?this.childrenAfterFilter:this.childrenAfterGroup,o=0;if(!utils_1._.missing(i)){for(var n=0;n<i.length;n++)o+=i[n].setSelectedParams({newValue:e,clearSelection:!1,suppressFinishActions:!0,groupSelectsFiltered:t});return o}},o.prototype.addEventListener=function(e,t){this.eventService||(this.eventService=new eventService_1.EventService),this.eventService.addEventListener(e,t)},o.prototype.removeEventListener=function(e,t){this.eventService.removeEventListener(e,t)},o.prototype.onMouseEnter=function(){this.dispatchLocalEvent(this.createLocalRowEvent(o.EVENT_MOUSE_ENTER))},o.prototype.onMouseLeave=function(){this.dispatchLocalEvent(this.createLocalRowEvent(o.EVENT_MOUSE_LEAVE))},o.prototype.getFirstChildOfFirstChild=function(e){for(var t,i=this,o=!0,n=!1;o&&!n;){var r=i.parent;utils_1._.exists(r)&&i.firstChild?r.rowGroupColumn===e&&(n=!0,t=r):o=!1,i=r}return n?t:null},o.OBJECT_ID_SEQUENCE=0,o.EVENT_ROW_SELECTED="rowSelected",o.EVENT_DATA_CHANGED="dataChanged",o.EVENT_CELL_CHANGED="cellChanged",o.EVENT_ALL_CHILDREN_COUNT_CHANGED="allChildrenCountChanged",o.EVENT_MOUSE_ENTER="mouseEnter",o.EVENT_MOUSE_LEAVE="mouseLeave",o.EVENT_HEIGHT_CHANGED="heightChanged",o.EVENT_TOP_CHANGED="topChanged",o.EVENT_FIRST_CHILD_CHANGED="firstChildChanged",o.EVENT_LAST_CHILD_CHANGED="lastChildChanged",o.EVENT_CHILD_INDEX_CHANGED="childIndexChanged",o.EVENT_ROW_INDEX_CHANGED="rowIndexChanged",o.EVENT_EXPANDED_CHANGED="expandedChanged",o.EVENT_SELECTABLE_CHANGED="selectableChanged",o.EVENT_UI_LEVEL_CHANGED="uiLevelChanged",o.EVENT_DRAGGING_CHANGED="draggingChanged",__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],o.prototype,"mainEventService",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],o.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("selectionController"),__metadata("design:type",selectionController_1.SelectionController)],o.prototype,"selectionController",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],o.prototype,"columnController",void 0),__decorate([context_1.Autowired("valueService"),__metadata("design:type",valueService_1.ValueService)],o.prototype,"valueService",void 0),__decorate([context_1.Autowired("rowModel"),__metadata("design:type",Object)],o.prototype,"rowModel",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_1.Context)],o.prototype,"context",void 0),__decorate([context_1.Autowired("valueCache"),__metadata("design:type",valueCache_1.ValueCache)],o.prototype,"valueCache",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],o.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],o.prototype,"gridApi",void 0),o}();exports.RowNode=RowNode;