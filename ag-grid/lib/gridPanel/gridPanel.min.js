"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__decorate=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(s=(r<3?n(s):3<r?n(t,o,s):n(t,o))||s);return 3<r&&s&&Object.defineProperty(t,o,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var gridOptionsWrapper_1=require("../gridOptionsWrapper"),columnController_1=require("../columnController/columnController"),columnApi_1=require("../columnController/columnApi"),rowRenderer_1=require("../rendering/rowRenderer"),context_1=require("../context/context"),eventService_1=require("../eventService"),events_1=require("../events"),dragService_1=require("../dragAndDrop/dragService"),constants_1=require("../constants"),mouseEventService_1=require("./mouseEventService"),focusedCellController_1=require("../focusedCellController"),scrollVisibleService_1=require("./scrollVisibleService"),rowContainerComponent_1=require("../rendering/rowContainerComponent"),paginationProxy_1=require("../rowModels/paginationProxy"),paginationAutoPageSizeService_1=require("../rowModels/paginationAutoPageSizeService"),popupEditorWrapper_1=require("../rendering/cellEditors/popupEditorWrapper"),alignedGridsService_1=require("../alignedGridsService"),pinnedRowModel_1=require("../rowModels/pinnedRowModel"),gridApi_1=require("../gridApi"),animationFrameService_1=require("../misc/animationFrameService"),rowComp_1=require("../rendering/rowComp"),navigationService_1=require("./navigationService"),valueService_1=require("../valueService/valueService"),touchListener_1=require("../widgets/touchListener"),dragAndDropService_1=require("../dragAndDrop/dragAndDropService"),rowDragFeature_1=require("./rowDragFeature"),maxDivHeightScaler_1=require("../rendering/maxDivHeightScaler"),overlayWrapperComponent_1=require("../rendering/overlays/overlayWrapperComponent"),component_1=require("../widgets/component"),autoHeightCalculator_1=require("../rendering/autoHeightCalculator"),columnAnimationService_1=require("../rendering/columnAnimationService"),autoWidthCalculator_1=require("../rendering/autoWidthCalculator"),beans_1=require("../rendering/beans"),componentAnnotations_1=require("../widgets/componentAnnotations"),headerRootComp_1=require("../headerRendering/headerRootComp"),resizeObserverService_1=require("../misc/resizeObserverService"),utils_1=require("../utils"),GRID_PANEL_NORMAL_TEMPLATE='<div class="ag-root ag-unselectable" role="grid" unselectable="on">\n        <ag-header-root ref="headerRoot" unselectable="on"></ag-header-root>\n        <div class="ag-floating-top" ref="eTop" role="presentation" unselectable="on">\n            <div class="ag-pinned-left-floating-top" ref="eLeftTop" role="presentation" unselectable="on"></div>\n            <div class="ag-floating-top-viewport" ref="eTopViewport" role="presentation" unselectable="on">\n                <div class="ag-floating-top-container" ref="eTopContainer" role="presentation" unselectable="on"></div>\n            </div>\n            <div class="ag-pinned-right-floating-top" ref="eRightTop" role="presentation" unselectable="on"></div>\n            <div class="ag-floating-top-full-width-container" ref="eTopFullWidthContainer" role="presentation" unselectable="on"></div>\n        </div>\n        <div class="ag-body-viewport" ref="eBodyViewport" role="presentation" unselectable="on">\n            <div class="ag-pinned-left-cols-container" ref="eLeftContainer" role="presentation" unselectable="on"></div>\n            <div class="ag-center-cols-clipper" ref="eCenterColsClipper" role="presentation" unselectable="on">\n                <div class="ag-center-cols-viewport" ref="eCenterViewport" role="presentation" unselectable="on">\n                    <div class="ag-center-cols-container" ref="eCenterContainer" role="rowgroup" unselectable="on"></div>\n                </div>\n            </div>\n            <div class="ag-pinned-right-cols-container" ref="eRightContainer" role="presentation" unselectable="on"></div>\n            <div class="ag-full-width-container" ref="eFullWidthContainer" role="presentation" unselectable="on"></div>\n        </div>\n        <div class="ag-floating-bottom" ref="eBottom" role="presentation" unselectable="on">\n            <div class="ag-pinned-left-floating-bottom" ref="eLeftBottom" role="presentation" unselectable="on"></div>\n            <div class="ag-floating-bottom-viewport" ref="eBottomViewport" role="presentation" unselectable="on">\n                <div class="ag-floating-bottom-container" ref="eBottomContainer" role="presentation" unselectable="on"></div>\n            </div>\n            <div class="ag-pinned-right-floating-bottom" ref="eRightBottom" role="presentation" unselectable="on"></div>\n            <div class="ag-floating-bottom-full-width-container" ref="eBottomFullWidthContainer" role="presentation" unselectable="on"></div>\n        </div>\n        <div class="ag-body-horizontal-scroll" ref="eHorizontalScrollBody" aria-hidden="true">\n            <div class="ag-horizontal-left-spacer" ref="eHorizontalLeftSpacer"></div>\n            <div class="ag-body-horizontal-scroll-viewport" ref="eBodyHorizontalScrollViewport">\n                <div class="ag-body-horizontal-scroll-container" ref="eBodyHorizontalScrollContainer"></div>\n            </div>\n            <div class="ag-horizontal-right-spacer" ref="eHorizontalRightSpacer"></div>\n        </div>\n        <ag-overlay-wrapper ref="overlayWrapper"></ag-overlay-wrapper>\n    </div>',GridPanel=function(t){function e(){var e=t.call(this,GRID_PANEL_NORMAL_TEMPLATE)||this;return e.scrollLeft=-1,e.scrollTop=-1,e.nextScrollTop=-1,e.resetLastHorizontalScrollElementDebounce=utils_1._.debounce(e.resetLastHorizontalScrollElement.bind(e),500),e}return __extends(e,t),e.prototype.getVScrollPosition=function(){return{top:this.eBodyViewport.scrollTop,bottom:this.eBodyViewport.scrollTop+this.eBodyViewport.offsetHeight}},e.prototype.getHScrollPosition=function(){return{left:this.eCenterViewport.scrollLeft,right:this.eCenterViewport.scrollLeft+this.eCenterViewport.offsetWidth}},e.prototype.onRowDataChanged=function(){this.showOrHideOverlay()},e.prototype.showOrHideOverlay=function(){var e=this.paginationProxy.isEmpty(),t=this.gridOptionsWrapper.isSuppressNoRowsOverlay();this[e&&!t?"showNoRowsOverlay":"hideOverlay"]()},e.prototype.onNewColumnsLoaded=function(){this.columnController.isReady()&&!this.paginationProxy.isEmpty()&&this.hideOverlay()},e.prototype.init=function(){var o=this;this.scrollWidth=this.gridOptionsWrapper.getScrollbarWidth(),this.enableRtl=this.gridOptionsWrapper.isEnableRtl(),this.printLayout=this.gridOptionsWrapper.getDomLayout()===constants_1.Constants.DOM_LAYOUT_PRINT,this.gridOptionsWrapper.addLayoutElement(this.getGui()),this.gridOptionsWrapper.addLayoutElement(this.eBodyViewport),this.suppressScrollOnFloatingRow(),this.setupRowAnimationCssClass(),this.buildRowContainerComponents(),this.addEventListeners(),this.addDragListeners(),this.addScrollListener(),this.gridOptionsWrapper.isRowModelDefault()&&!this.gridOptionsWrapper.getRowData()&&this.showLoadingOverlay(),this.setCellTextSelection(this.gridOptionsWrapper.isEnableCellTextSelect()),this.setPinnedContainerSize(),this.setHeaderAndFloatingHeights(),this.disableBrowserDragging(),this.addMouseListeners(),this.addKeyboardEvents(),this.addBodyViewportListener(),this.addStopEditingWhenGridLosesFocus(),this.mockContextMenuForIPad(),this.addRowDragListener(),this.$scope&&this.addAngularApplyCheck(),this.onDisplayedColumnsWidthChanged(),this.gridApi.registerGridComp(this),this.alignedGridsService.registerGridComp(this),this.headerRootComp.registerGridComp(this),this.navigationService.registerGridComp(this),this.heightScaler.registerGridComp(this),this.autoHeightCalculator.registerGridComp(this),this.columnAnimationService.registerGridComp(this),this.autoWidthCalculator.registerGridComp(this),this.paginationAutoPageSizeService.registerGridComp(this),this.beans.registerGridComp(this),this.rowRenderer.registerGridComp(this),this.animationFrameService.registerGridComp(this),this.rangeController&&this.rangeController.registerGridComp(this),[this.eCenterViewport,this.eBodyViewport].forEach(function(e){var t=o.resizeObserverService.observeResize(e,o.onCenterViewportResized.bind(o));o.addDestroyFunc(function(){return t()})})},e.prototype.onDomLayoutChanged=function(){var e=this.gridOptionsWrapper.getDomLayout()===constants_1.Constants.DOM_LAYOUT_PRINT;this.printLayout!==e&&(this.printLayout=e,this.setWidthsOfContainers(),this.setPinnedContainerSize())},e.prototype.onCenterViewportResized=function(){utils_1._.isVisible(this.eCenterViewport)?this.checkViewportAndScrolls():this.bodyHeight=0},e.prototype.setColumnMovingCss=function(e){this.addOrRemoveCssClass("ag-column-moving",e)},e.prototype.setCellTextSelection=function(t){void 0===t&&(t=!1),[this.eTop,this.eBodyViewport,this.eBottom].forEach(function(e){return utils_1._.addOrRemoveCssClass(e,"ag-selectable",t)})},e.prototype.addRowDragListener=function(){var e=new rowDragFeature_1.RowDragFeature(this.eBodyViewport,this);this.getContext().wireBean(e),this.dragAndDropService.addDropTarget(e)},e.prototype.addStopEditingWhenGridLosesFocus=function(){var e,r=this;this.gridOptionsWrapper.isStopEditingWhenGridLosesFocus()&&(e=function(e){for(var t=!1,o=e.relatedTarget;utils_1._.exists(o)&&!t;)var i=!!r.gridOptionsWrapper.getDomData(o,popupEditorWrapper_1.PopupEditorWrapper.DOM_KEY_POPUP_EDITOR_WRAPPER),n=r.eBodyViewport===o||r.eBottom===o||r.eTop===o,t=i||n,o=o.parentNode;t||r.rowRenderer.stopEditing()},this.addDestroyableEventListener(this.eBodyViewport,"focusout",e),this.addDestroyableEventListener(this.eTop,"focusout",e),this.addDestroyableEventListener(this.eBottom,"focusout",e))},e.prototype.addAngularApplyCheck=function(){function e(){o||(o=!0,window.setTimeout(function(){o=!1,t.$scope.$apply()},0))}var t=this,o=!1;this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,e),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_VIRTUAL_COLUMNS_CHANGED,e)},e.prototype.disableBrowserDragging=function(){this.addGuiEventListener("dragstart",function(e){if(e.target instanceof HTMLImageElement)return e.preventDefault(),!1})},e.prototype.addEventListeners=function(){this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,this.onDisplayedColumnsWidthChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_PINNED_ROW_DATA_CHANGED,this.setHeaderAndFloatingHeights.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_ROW_DATA_CHANGED,this.onRowDataChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_ROW_DATA_UPDATED,this.onRowDataChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_NEW_COLUMNS_LOADED,this.onNewColumnsLoaded.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_HEADER_HEIGHT,this.setHeaderAndFloatingHeights.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_PIVOT_HEADER_HEIGHT,this.setHeaderAndFloatingHeights.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_GROUP_HEADER_HEIGHT,this.setHeaderAndFloatingHeights.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_PIVOT_GROUP_HEADER_HEIGHT,this.setHeaderAndFloatingHeights.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_FLOATING_FILTERS_HEIGHT,this.setHeaderAndFloatingHeights.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_DOM_LAYOUT,this.onDomLayoutChanged.bind(this))},e.prototype.addDragListeners=function(){var o=this;this.gridOptionsWrapper.isEnableRangeSelection()&&!utils_1._.missing(this.rangeController)&&[this.eLeftContainer,this.eRightContainer,this.eCenterContainer,this.eTop,this.eBottom].forEach(function(e){var t={eElement:e,onDragStart:o.rangeController.onDragStart.bind(o.rangeController),onDragStop:o.rangeController.onDragStop.bind(o.rangeController),onDragging:o.rangeController.onDragging.bind(o.rangeController)};o.dragService.addDragSource(t),o.addDestroyFunc(function(){return o.dragService.removeDragSource(t)})})},e.prototype.addMouseListeners=function(){var i=this;["click","mousedown","dblclick","contextmenu","mouseover","mouseout"].forEach(function(t){var o=i.processMouseEvent.bind(i,t);i.eAllCellContainers.forEach(function(e){return i.addDestroyableEventListener(e,t,o)})})},e.prototype.addKeyboardEvents=function(){var i=this;["keydown","keypress"].forEach(function(t){var o=i.processKeyboardEvent.bind(i,t);i.eAllCellContainers.forEach(function(e){i.addDestroyableEventListener(e,t,o)})})},e.prototype.addBodyViewportListener=function(){var o=this;this.addDestroyableEventListener(this.eBodyViewport,"contextmenu",function(e){var t=utils_1._.getTarget(e);t!==o.eBodyViewport&&t!==o.eCenterViewport||(o.onContextMenu(e,null,null,null,null),o.preventDefaultOnContextMenu(e))})},e.prototype.getBodyClientRect=function(){if(this.eBodyViewport)return this.eBodyViewport.getBoundingClientRect()},e.prototype.getRowForEvent=function(e){for(var t=utils_1._.getTarget(e);t;){var o=this.gridOptionsWrapper.getDomData(t,rowComp_1.RowComp.DOM_DATA_KEY_RENDERED_ROW);if(o)return o;t=t.parentElement}return null},e.prototype.processKeyboardEvent=function(e,t){var o=utils_1._.getCellCompForEvent(this.gridOptionsWrapper,t);if(o){var i=o.getRenderedRow().getRowNode(),n=o.getColumn(),r=o.isEditing();if(!utils_1._.isUserSuppressingKeyboardEvent(this.gridOptionsWrapper,t,i,n,r))switch(e){case"keydown":!r&&this.navigationService.handlePageScrollingKey(t)||o.onKeyDown(t),this.doClipboardOperations(t,o);break;case"keypress":o.onKeyPress(t)}"keydown"===e&&(r=o.createEvent(t,events_1.Events.EVENT_CELL_KEY_DOWN),this.beans.eventService.dispatchEvent(r)),"keypress"===e&&(t=o.createEvent(t,events_1.Events.EVENT_CELL_KEY_PRESS),this.beans.eventService.dispatchEvent(t))}},e.prototype.doClipboardOperations=function(e,t){if((e.ctrlKey||e.metaKey)&&!t.isEditing()&&this.mouseEventService.isEventFromThisGrid(e))switch(e.which){case constants_1.Constants.KEY_A:return this.onCtrlAndA(e);case constants_1.Constants.KEY_C:return this.onCtrlAndC(e);case constants_1.Constants.KEY_V:return this.onCtrlAndV();case constants_1.Constants.KEY_D:return this.onCtrlAndD(e)}},e.prototype.scrollToTop=function(){this.eBodyViewport.scrollTop=0},e.prototype.processMouseEvent=function(e,t){var o,i;this.mouseEventService.isEventFromThisGrid(t)&&!utils_1._.isStopPropagationForAgGrid(t)&&(o=this.getRowForEvent(t),i=this.mouseEventService.getRenderedCellForEvent(t),"contextmenu"===e?this.handleContextMenuMouseEvent(t,null,o,i):(i&&i.onMouseEvent(e,t),o&&o.onMouseEvent(e,t)),this.preventDefaultOnContextMenu(t))},e.prototype.mockContextMenuForIPad=function(){var i=this;utils_1._.isUserAgentIPad()&&this.eAllCellContainers.forEach(function(e){var t=new touchListener_1.TouchListener(e);i.addDestroyableEventListener(t,touchListener_1.TouchListener.EVENT_LONG_TAP,function(e){var t=i.getRowForEvent(e.touchEvent),o=i.mouseEventService.getRenderedCellForEvent(e.touchEvent);i.handleContextMenuMouseEvent(null,e.touchEvent,t,o)}),i.addDestroyFunc(function(){return t.destroy()})})},e.prototype.handleContextMenuMouseEvent=function(e,t,o,i){var n=o?o.getRowNode():null,r=i?i.getColumn():null,s=null;r&&(o=e||t,i.dispatchCellContextMenuEvent(o),s=this.valueService.getValue(r,n)),this.onContextMenu(e,t,n,r,s)},e.prototype.onContextMenu=function(e,t,o,i,n){var r;!this.gridOptionsWrapper.isAllowContextMenuWithControlKey()&&e&&(e.ctrlKey||e.metaKey)||this.contextMenuFactory&&!this.gridOptionsWrapper.isSuppressContextMenu()&&(r=e||t.touches[0],this.contextMenuFactory.showMenu(o,i,n,r),(e||t).preventDefault())},e.prototype.preventDefaultOnContextMenu=function(e){var t=this.gridOptionsWrapper,o=e.which;(t.isPreventDefaultOnContextMenu()||t.isSuppressMiddleClickScrolls()&&2===o)&&e.preventDefault()},e.prototype.onCtrlAndA=function(e){var t=this.columnController,o=this.pinnedRowModel,i=this.paginationProxy,n=this.rangeController,r=constants_1.Constants.PINNED_BOTTOM,s=constants_1.Constants.PINNED_TOP;if(n&&i.isRowsToRender()){var a=[o.isEmpty(s),o.isEmpty(r)],l=a[0]?null:s,i=void 0,s=void 0,s=a[1]?(i=null,this.paginationProxy.getRowCount()-1):(i=r,o.getPinnedBottomRowData().length-1),t=t.getAllDisplayedColumns();if(utils_1._.missingOrEmpty(t))return;n.setCellRange({rowStartIndex:0,rowStartPinned:l,rowEndIndex:s,rowEndPinned:i,columnStart:t[0],columnEnd:utils_1._.last(t)})}e.preventDefault()},e.prototype.onCtrlAndC=function(e){var t;this.clipboardService&&!this.gridOptionsWrapper.isEnableCellTextSelection()&&(t=this.focusedCellController.getFocusedCell(),this.clipboardService.copyToClipboard(),e.preventDefault(),t&&this.focusedCellController.setFocusedCell(t.rowIndex,t.column,t.rowPinned,!0))},e.prototype.onCtrlAndV=function(){this.enterprise&&!this.gridOptionsWrapper.isSuppressClipboardPaste()&&this.clipboardService.pasteFromClipboard()},e.prototype.onCtrlAndD=function(e){this.enterprise&&(this.clipboardService.copyRangeDown(),e.preventDefault())},e.prototype.ensureIndexVisible=function(e,t){if(!this.printLayout){var o=this.paginationProxy.getRowCount();if("number"!=typeof e||e<0||o<=e)console.warn("invalid row index for ensureIndexVisible: "+e);else{this.paginationProxy.goToPageWithIndex(e);var i=this.paginationProxy.getRow(e);do{var n=i.rowTop,r=i.rowHeight,s=this.paginationProxy.getPixelOffset(),a=i.rowTop-s,l=a+i.rowHeight,p=this.getVScrollPosition(),d=this.heightScaler.getOffset(),c=p.top+d,h=p.bottom+d,u=h-c,s=this.heightScaler.getScrollPositionForPixel(a),p=this.heightScaler.getScrollPositionForPixel(l-u),d=Math.min((s+p)/2,a),u=null}while("top"===t?u=s:"bottom"===t?u=p:"middle"===t?u=d:a<c?u=s:h<l&&(u=p),null!==u&&(this.eBodyViewport.scrollTop=u,this.rowRenderer.redrawAfterScroll()),n!==i.rowTop||r!==i.rowHeight);this.animationFrameService.flushAllFrames()}}},e.prototype.getCenterWidth=function(){return this.eCenterViewport.clientWidth},e.prototype.isVerticalScrollShowing=function(){var e=this.gridOptionsWrapper.isAlwaysShowVerticalScroll();return utils_1._.addOrRemoveCssClass(this.eBodyViewport,"ag-force-vertical-scroll",e),e||utils_1._.isVerticalScrollShowing(this.eBodyViewport)},e.prototype.isHorizontalScrollShowing=function(){return utils_1._.isHorizontalScrollShowing(this.eCenterViewport)},e.prototype.checkViewportAndScrolls=function(){this.updateScrollVisibleService(),this.checkBodyHeight(),this.onHorizontalViewportChanged(),this.setPinnedContainerSize()},e.prototype.updateScrollVisibleService=function(){this.updateScrollVisibleServiceImpl(),setTimeout(this.updateScrollVisibleServiceImpl.bind(this),500)},e.prototype.updateScrollVisibleServiceImpl=function(){var e={horizontalScrollShowing:!1,verticalScrollShowing:!1};e.verticalScrollShowing=this.isVerticalScrollShowing(),e.horizontalScrollShowing=this.isHorizontalScrollShowing(),this.scrollVisibleService.setScrollsVisible(e),this.setHorizontalScrollVisible(e.horizontalScrollShowing),this.setVerticalScrollPaddingVisible(e.verticalScrollShowing)},e.prototype.setHorizontalScrollVisible=function(e){var t=this.gridOptionsWrapper.isSuppressHorizontalScroll(),o=e&&this.gridOptionsWrapper.getScrollbarWidth()||0,t=t?0:o,e=utils_1._.isBrowserIE()&&e;this.eCenterViewport.style.height="calc(100% + "+o+"px)",utils_1._.setFixedHeight(this.eHorizontalScrollBody,t),utils_1._.setFixedHeight(this.eBodyHorizontalScrollViewport,t+(e?1:0)),utils_1._.setFixedHeight(this.eBodyHorizontalScrollContainer,t)},e.prototype.setVerticalScrollPaddingVisible=function(e){e=e?"scroll":"hidden";this.eTop.style.overflowY=this.eBottom.style.overflowY=e,this.setFakeHScrollSpacerWidths()},e.prototype.updateRowCount=function(){var e=(this.headerRootComp.getHeaderRowCount()+this.paginationProxy.getRowCount()).toString();this.getGui().setAttribute("aria-rowcount",e)},e.prototype.ensureColumnVisible=function(e){var t,o,i,n,r,s=this.columnController.getGridColumn(e);s&&(s.isPinned()?console.warn("calling ensureIndexVisible on a "+s.getPinned()+" pinned column doesn't make sense for column "+s.getColId()):this.columnController.isColumnDisplayed(s)?(o=(t=s.getLeft())+s.getActualWidth(),i=this.eCenterViewport.clientWidth,r=this.getCenterViewportScrollLeft(),e=this.columnController.getBodyContainerWidth(),r=this.enableRtl?(n=e-r-i,e-r):i+(n=r),n=t<n,r=r<o,s=i<s.getActualWidth(),n=n||s,s=r,r=this.getCenterViewportScrollLeft(),(n||s)&&(r=this.enableRtl?n?e-i-t:e-o:n?t:o-i,this.setCenterViewportScrollLeft(r)),this.onHorizontalViewportChanged(),this.animationFrameService.flushAllFrames()):console.warn("column is not currently visible"))},e.prototype.showLoadingOverlay=function(){this.gridOptionsWrapper.isSuppressLoadingOverlay()||this.overlayWrapper.showLoadingOverlay()},e.prototype.showNoRowsOverlay=function(){this.gridOptionsWrapper.isSuppressNoRowsOverlay()||this.overlayWrapper.showNoRowsOverlay()},e.prototype.hideOverlay=function(){this.overlayWrapper.hideOverlay()},e.prototype.sizeColumnsToFit=function(e){var t=this,o=this.eBodyViewport.clientWidth;0<o?this.columnController.sizeColumnsToFit(o,"sizeColumnsToFit"):void 0===e?window.setTimeout(function(){t.sizeColumnsToFit(100)},0):100===e?window.setTimeout(function(){t.sizeColumnsToFit(500)},100):500===e?window.setTimeout(function(){t.sizeColumnsToFit(-1)},500):console.warn("ag-Grid: tried to call sizeColumnsToFit() but the grid is coming back with zero width, maybe the grid is not visible yet on the screen?")},e.prototype.getCenterContainer=function(){return this.eCenterContainer},e.prototype.getDropTargetBodyContainers=function(){return[this.eCenterViewport,this.eTopViewport,this.eBottomViewport]},e.prototype.getDropTargetLeftContainers=function(){return[this.eLeftContainer,this.eLeftBottom,this.eLeftTop]},e.prototype.getDropTargetRightContainers=function(){return[this.eRightContainer,this.eRightBottom,this.eRightTop]},e.prototype.buildRowContainerComponents=function(){var o=this;this.eAllCellContainers=[this.eLeftContainer,this.eRightContainer,this.eCenterContainer,this.eTop,this.eBottom,this.eFullWidthContainer],this.rowContainerComponents={body:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eCenterContainer,eWrapper:this.eCenterColsClipper,eViewport:this.eBodyViewport}),fullWidth:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eFullWidthContainer}),pinnedLeft:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eLeftContainer}),pinnedRight:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eRightContainer}),floatingTop:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eTopContainer}),floatingTopPinnedLeft:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eLeftTop}),floatingTopPinnedRight:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eRightTop}),floatingTopFullWidth:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eTopFullWidthContainer,hideWhenNoChildren:!0}),floatingBottom:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eBottomContainer}),floatingBottomPinnedLeft:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eLeftBottom}),floatingBottomPinnedRight:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eRightBottom}),floatingBottomFullWith:new rowContainerComponent_1.RowContainerComponent({eContainer:this.eBottomFullWidthContainer,hideWhenNoChildren:!0})},utils_1._.iterateObject(this.rowContainerComponents,function(e,t){t&&o.getContext().wireBean(t)})},e.prototype.setupRowAnimationCssClass=function(){function e(){var e=t.gridOptionsWrapper.isAnimateRows()&&!t.heightScaler.isScaling();utils_1._.addOrRemoveCssClass(t.eBodyViewport,"ag-row-animation",e),utils_1._.addOrRemoveCssClass(t.eBodyViewport,"ag-row-no-animation",!e)}var t=this;e(),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_HEIGHT_SCALE_CHANGED,e)},e.prototype.suppressScrollOnFloatingRow=function(){var e=this;this.addDestroyableEventListener(this.eTopViewport,"scroll",function(){return e.eTopViewport.scrollLeft=0}),this.addDestroyableEventListener(this.eBottomViewport,"scroll",function(){return e.eTopViewport.scrollLeft=0})},e.prototype.getRowContainers=function(){return this.rowContainerComponents},e.prototype.getFloatingTopBottom=function(){return[this.eTop,this.eBottom]},e.prototype.onDisplayedColumnsChanged=function(){this.setPinnedContainerSize(),this.setHeaderAndFloatingHeights(),this.onHorizontalViewportChanged(),this.updateScrollVisibleService()},e.prototype.onDisplayedColumnsWidthChanged=function(){this.setWidthsOfContainers(),this.onHorizontalViewportChanged(),this.updateScrollVisibleService(),this.enableRtl&&this.horizontallyScrollHeaderCenterAndFloatingCenter()},e.prototype.setWidthsOfContainers=function(){this.setCenterWidth(),this.setPinnedContainerSize()},e.prototype.setCenterWidth=function(){var e=this.columnController.getBodyContainerWidth();this.printLayout&&(e+=this.columnController.getPinnedLeftContainerWidth()+this.columnController.getPinnedRightContainerWidth()),this.headerRootComp.setHeaderContainerWidth(e);e+="px";this.eCenterContainer.style.width=e,this.eBottomContainer.style.width=e,this.eTopContainer.style.width=e,this.printLayout||(this.eBodyHorizontalScrollContainer.style.width=e)},e.prototype.setPinnedLeftWidth=function(){var t=this,e=this.pinningLeft,o=this.columnController.getPinnedLeftContainerWidth(),i=this.pinningLeft=!this.printLayout&&0<o,n=[this.eLeftContainer,this.eLeftTop,this.eLeftBottom];e!==i&&this.headerRootComp.setLeftVisible(i),n.forEach(function(e){return utils_1._.setDisplayed(e,t.pinningLeft)}),i&&n.forEach(function(e){return utils_1._.setFixedWidth(e,o)})},e.prototype.setPinnedRightWidth=function(){var e=this.pinningRight,t=this.columnController.getPinnedRightContainerWidth(),o=this.pinningRight=!this.printLayout&&0<t,i=[this.eRightContainer,this.eRightTop,this.eRightBottom];e!==o&&this.headerRootComp.setRightVisible(o),i.forEach(function(e){return utils_1._.setDisplayed(e,o)}),o&&i.forEach(function(e){return utils_1._.setFixedWidth(e,t)})},e.prototype.setPinnedContainerSize=function(){this.setPinnedLeftWidth(),this.setPinnedRightWidth(),this.setFakeHScrollSpacerWidths()},e.prototype.setFakeHScrollSpacerWidths=function(){var e=this.columnController.getPinnedRightContainerWidth();!this.enableRtl&&this.isVerticalScrollShowing()&&(e+=this.scrollWidth),utils_1._.setFixedWidth(this.eHorizontalRightSpacer,e),utils_1._.addOrRemoveCssClass(this.eHorizontalRightSpacer,"ag-scroller-corner",e<=this.scrollWidth);e=this.columnController.getPinnedLeftContainerWidth();this.enableRtl&&this.isVerticalScrollShowing()&&(e+=this.scrollWidth),utils_1._.setFixedWidth(this.eHorizontalLeftSpacer,e),utils_1._.addOrRemoveCssClass(this.eHorizontalLeftSpacer,"ag-scroller-corner",e<=this.scrollWidth)},e.prototype.checkBodyHeight=function(){var e=this.eBodyViewport.clientHeight;this.bodyHeight!==e&&(this.bodyHeight=e,e={type:events_1.Events.EVENT_BODY_HEIGHT_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(e))},e.prototype.setHeaderAndFloatingHeights=function(){var e=this,t=e.columnController,o=e.gridOptionsWrapper,i=e.pinnedRowModel,n=e.eTop,r=e.eBottom,s=0,e=t.getHeaderRowCount(),t=t.isPivotMode()?(s=0,a=o.getPivotGroupHeaderHeight(),o.getPivotHeaderHeight()):(o.isFloatingFilter()&&e++,s=o.isFloatingFilter()?1:0,a=o.getGroupHeaderHeight(),o.getHeaderHeight()),e=e-(1+s),o=s*o.getFloatingFiltersHeight();o+=e*a,o+=t,this.headerRootComp.setHeight(o);var a=i.getPinnedTopTotalHeight();a&&(a+=1);t=i.getPinnedBottomTotalHeight();t&&(t+=1);o=a+"px",i=t+"px";n.style.minHeight=o,n.style.height=o,n.style.display=a?"inherit":"none",r.style.minHeight=i,r.style.height=i,r.style.display=t?"inherit":"none",this.checkBodyHeight()},e.prototype.getBodyHeight=function(){return this.bodyHeight},e.prototype.setHorizontalScrollPosition=function(e){this.eCenterViewport.scrollLeft=e,this.doHorizontalScroll(e)},e.prototype.setVerticalScrollPosition=function(e){this.eBodyViewport.scrollTop=e},e.prototype.scrollHorizontally=function(e){var t=this.eCenterViewport.scrollLeft;return this.setHorizontalScrollPosition(t+e),this.eCenterViewport.scrollLeft-t},e.prototype.scrollVertically=function(e){var t=this.eBodyViewport.scrollTop;return this.setVerticalScrollPosition(t+e),this.eBodyViewport.scrollTop-t},e.prototype.addScrollListener=function(){this.addDestroyableEventListener(this.eCenterViewport,"scroll",this.onCenterViewportScroll.bind(this)),this.addDestroyableEventListener(this.eBodyHorizontalScrollViewport,"scroll",this.onFakeHorizontalScroll.bind(this)),this.addDestroyableEventListener(this.eBodyViewport,"scroll",this.onVerticalScroll.bind(this))},e.prototype.onVerticalScroll=function(){var e=this.eBodyViewport.scrollTop;this.animationFrameService.setScrollTop(e),this.nextScrollTop=e,this.gridOptionsWrapper.isSuppressAnimationFrame()?this.redrawRowsAfterScroll():this.animationFrameService.schedule()},e.prototype.executeFrame=function(){var e=this.scrollTop!==this.nextScrollTop;return e&&(this.scrollTop=this.nextScrollTop,this.redrawRowsAfterScroll()),e},e.prototype.isControllingScroll=function(e){return this.lastHorizontalScrollElement?e===this.lastHorizontalScrollElement:(this.lastHorizontalScrollElement=e,!0)},e.prototype.onFakeHorizontalScroll=function(){this.isControllingScroll(this.eBodyHorizontalScrollViewport)&&this.onBodyHorizontalScroll(this.eBodyHorizontalScrollViewport)},e.prototype.onCenterViewportScroll=function(){this.isControllingScroll(this.eCenterViewport)&&this.onBodyHorizontalScroll(this.eCenterViewport)},e.prototype.onBodyHorizontalScroll=function(e){var t=this.eCenterViewport,o=t.scrollWidth,t=t.clientWidth,e=Math.floor(utils_1._.getScrollLeft(e,this.enableRtl));e<0||o<e+t||(this.doHorizontalScroll(e),this.resetLastHorizontalScrollElementDebounce())},e.prototype.resetLastHorizontalScrollElement=function(){this.lastHorizontalScrollElement=null},e.prototype.doHorizontalScroll=function(e){this.scrollLeft=e;var t={type:events_1.Events.EVENT_BODY_SCROLL,api:this.gridApi,columnApi:this.columnApi,direction:"horizontal",left:this.scrollLeft,top:this.scrollTop};this.eventService.dispatchEvent(t),this.horizontallyScrollHeaderCenterAndFloatingCenter(e),this.onHorizontalViewportChanged()},e.prototype.redrawRowsAfterScroll=function(){var e={type:events_1.Events.EVENT_BODY_SCROLL,direction:"vertical",api:this.gridApi,columnApi:this.columnApi,left:this.scrollLeft,top:this.scrollTop};this.eventService.dispatchEvent(e)},e.prototype.onHorizontalViewportChanged=function(){var e=this.eCenterViewport.clientWidth,t=this.getCenterViewportScrollLeft();this.columnController.setVirtualViewportPosition(e,t)},e.prototype.getCenterViewportScrollLeft=function(){return utils_1._.getScrollLeft(this.eCenterViewport,this.enableRtl)},e.prototype.setCenterViewportScrollLeft=function(e){utils_1._.setScrollLeft(this.eCenterViewport,e,this.enableRtl)},e.prototype.horizontallyScrollHeaderCenterAndFloatingCenter=function(e){void 0===e&&(e=this.getCenterViewportScrollLeft());var t=this.enableRtl?e:-e,o=this.eCenterViewport,i=o.clientWidth,o=o.scrollWidth;Math.abs(t)+i>o||this.enableRtl&&t<0||!this.enableRtl&&0<t||(this.headerRootComp.setHorizontalScroll(t),this.eBottomContainer.style.transform="translateX("+t+"px)",this.eTopContainer.style.transform="translateX("+t+"px)",t=this.lastHorizontalScrollElement===this.eCenterViewport?this.eBodyHorizontalScrollViewport:this.eCenterViewport,utils_1._.setScrollLeft(t,e,this.enableRtl))},e.prototype.addScrollEventListener=function(e){this.eBodyViewport.addEventListener("scroll",e)},e.prototype.removeScrollEventListener=function(e){this.eBodyViewport.removeEventListener("scroll",e)},__decorate([context_1.Autowired("alignedGridsService"),__metadata("design:type",alignedGridsService_1.AlignedGridsService)],e.prototype,"alignedGridsService",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],e.prototype,"columnController",void 0),__decorate([context_1.Autowired("rowRenderer"),__metadata("design:type",rowRenderer_1.RowRenderer)],e.prototype,"rowRenderer",void 0),__decorate([context_1.Autowired("pinnedRowModel"),__metadata("design:type",pinnedRowModel_1.PinnedRowModel)],e.prototype,"pinnedRowModel",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],e.prototype,"eventService",void 0),__decorate([context_1.Autowired("animationFrameService"),__metadata("design:type",animationFrameService_1.AnimationFrameService)],e.prototype,"animationFrameService",void 0),__decorate([context_1.Autowired("navigationService"),__metadata("design:type",navigationService_1.NavigationService)],e.prototype,"navigationService",void 0),__decorate([context_1.Autowired("autoHeightCalculator"),__metadata("design:type",autoHeightCalculator_1.AutoHeightCalculator)],e.prototype,"autoHeightCalculator",void 0),__decorate([context_1.Autowired("columnAnimationService"),__metadata("design:type",columnAnimationService_1.ColumnAnimationService)],e.prototype,"columnAnimationService",void 0),__decorate([context_1.Autowired("autoWidthCalculator"),__metadata("design:type",autoWidthCalculator_1.AutoWidthCalculator)],e.prototype,"autoWidthCalculator",void 0),__decorate([context_1.Autowired("paginationAutoPageSizeService"),__metadata("design:type",paginationAutoPageSizeService_1.PaginationAutoPageSizeService)],e.prototype,"paginationAutoPageSizeService",void 0),__decorate([context_1.Autowired("beans"),__metadata("design:type",beans_1.Beans)],e.prototype,"beans",void 0),__decorate([context_1.Autowired("paginationProxy"),__metadata("design:type",paginationProxy_1.PaginationProxy)],e.prototype,"paginationProxy",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],e.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],e.prototype,"gridApi",void 0),__decorate([context_1.Autowired("dragService"),__metadata("design:type",dragService_1.DragService)],e.prototype,"dragService",void 0),__decorate([context_1.Autowired("mouseEventService"),__metadata("design:type",mouseEventService_1.MouseEventService)],e.prototype,"mouseEventService",void 0),__decorate([context_1.Autowired("focusedCellController"),__metadata("design:type",focusedCellController_1.FocusedCellController)],e.prototype,"focusedCellController",void 0),__decorate([context_1.Autowired("$scope"),__metadata("design:type",Object)],e.prototype,"$scope",void 0),__decorate([context_1.Autowired("scrollVisibleService"),__metadata("design:type",scrollVisibleService_1.ScrollVisibleService)],e.prototype,"scrollVisibleService",void 0),__decorate([context_1.Autowired("valueService"),__metadata("design:type",valueService_1.ValueService)],e.prototype,"valueService",void 0),__decorate([context_1.Autowired("dragAndDropService"),__metadata("design:type",dragAndDropService_1.DragAndDropService)],e.prototype,"dragAndDropService",void 0),__decorate([context_1.Autowired("maxDivHeightScaler"),__metadata("design:type",maxDivHeightScaler_1.MaxDivHeightScaler)],e.prototype,"heightScaler",void 0),__decorate([context_1.Autowired("enterprise"),__metadata("design:type",Boolean)],e.prototype,"enterprise",void 0),__decorate([context_1.Autowired("resizeObserverService"),__metadata("design:type",resizeObserverService_1.ResizeObserverService)],e.prototype,"resizeObserverService",void 0),__decorate([context_1.Optional("rangeController"),__metadata("design:type",Object)],e.prototype,"rangeController",void 0),__decorate([context_1.Optional("contextMenuFactory"),__metadata("design:type",Object)],e.prototype,"contextMenuFactory",void 0),__decorate([context_1.Optional("clipboardService"),__metadata("design:type",Object)],e.prototype,"clipboardService",void 0),__decorate([componentAnnotations_1.RefSelector("eBodyViewport"),__metadata("design:type",HTMLElement)],e.prototype,"eBodyViewport",void 0),__decorate([componentAnnotations_1.RefSelector("eCenterContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eCenterContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eCenterViewport"),__metadata("design:type",HTMLElement)],e.prototype,"eCenterViewport",void 0),__decorate([componentAnnotations_1.RefSelector("eLeftContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eLeftContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eRightContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eRightContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eCenterColsClipper"),__metadata("design:type",HTMLElement)],e.prototype,"eCenterColsClipper",void 0),__decorate([componentAnnotations_1.RefSelector("eHorizontalScrollBody"),__metadata("design:type",HTMLElement)],e.prototype,"eHorizontalScrollBody",void 0),__decorate([componentAnnotations_1.RefSelector("eHorizontalLeftSpacer"),__metadata("design:type",HTMLElement)],e.prototype,"eHorizontalLeftSpacer",void 0),__decorate([componentAnnotations_1.RefSelector("eHorizontalRightSpacer"),__metadata("design:type",HTMLElement)],e.prototype,"eHorizontalRightSpacer",void 0),__decorate([componentAnnotations_1.RefSelector("eBodyHorizontalScrollViewport"),__metadata("design:type",HTMLElement)],e.prototype,"eBodyHorizontalScrollViewport",void 0),__decorate([componentAnnotations_1.RefSelector("eBodyHorizontalScrollContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eBodyHorizontalScrollContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eFullWidthContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eFullWidthContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eTop"),__metadata("design:type",HTMLElement)],e.prototype,"eTop",void 0),__decorate([componentAnnotations_1.RefSelector("eLeftTop"),__metadata("design:type",HTMLElement)],e.prototype,"eLeftTop",void 0),__decorate([componentAnnotations_1.RefSelector("eRightTop"),__metadata("design:type",HTMLElement)],e.prototype,"eRightTop",void 0),__decorate([componentAnnotations_1.RefSelector("eTopContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eTopContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eTopViewport"),__metadata("design:type",HTMLElement)],e.prototype,"eTopViewport",void 0),__decorate([componentAnnotations_1.RefSelector("eTopFullWidthContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eTopFullWidthContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eBottom"),__metadata("design:type",HTMLElement)],e.prototype,"eBottom",void 0),__decorate([componentAnnotations_1.RefSelector("eLeftBottom"),__metadata("design:type",HTMLElement)],e.prototype,"eLeftBottom",void 0),__decorate([componentAnnotations_1.RefSelector("eRightBottom"),__metadata("design:type",HTMLElement)],e.prototype,"eRightBottom",void 0),__decorate([componentAnnotations_1.RefSelector("eBottomContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eBottomContainer",void 0),__decorate([componentAnnotations_1.RefSelector("eBottomViewport"),__metadata("design:type",HTMLElement)],e.prototype,"eBottomViewport",void 0),__decorate([componentAnnotations_1.RefSelector("eBottomFullWidthContainer"),__metadata("design:type",HTMLElement)],e.prototype,"eBottomFullWidthContainer",void 0),__decorate([componentAnnotations_1.RefSelector("headerRoot"),__metadata("design:type",headerRootComp_1.HeaderRootComp)],e.prototype,"headerRootComp",void 0),__decorate([componentAnnotations_1.RefSelector("overlayWrapper"),__metadata("design:type",overlayWrapperComponent_1.OverlayWrapperComponent)],e.prototype,"overlayWrapper",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"init",null),e}(component_1.Component);exports.GridPanel=GridPanel;