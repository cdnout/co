"use strict";var __decorate=this&&this.__decorate||function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var u=t.length-1;0<=u;u--)(n=t[u])&&(r=(s<3?n(r):3<s?n(e,i,r):n(e,i))||r);return 3<s&&r&&Object.defineProperty(e,i,r),r},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__param=this&&this.__param||function(i,o){return function(t,e){o(t,e,i)}};Object.defineProperty(exports,"__esModule",{value:!0});var columnGroup_1=require("../entities/columnGroup"),column_1=require("../entities/column"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),expressionService_1=require("../valueService/expressionService"),columnFactory_1=require("./columnFactory"),displayedGroupCreator_1=require("./displayedGroupCreator"),autoWidthCalculator_1=require("../rendering/autoWidthCalculator"),eventService_1=require("../eventService"),columnUtils_1=require("./columnUtils"),logger_1=require("../logger"),events_1=require("../events"),originalColumnGroup_1=require("../entities/originalColumnGroup"),groupInstanceIdCreator_1=require("./groupInstanceIdCreator"),context_1=require("../context/context"),columnAnimationService_1=require("../rendering/columnAnimationService"),autoGroupColService_1=require("./autoGroupColService"),valueCache_1=require("../valueService/valueCache"),gridApi_1=require("../gridApi"),columnApi_1=require("./columnApi"),utils_1=require("../utils"),ColumnController=function(){function t(){this.primaryHeaderRowCount=0,this.secondaryHeaderRowCount=0,this.secondaryColumnsPresent=!1,this.gridHeaderRowCount=0,this.displayedLeftColumns=[],this.displayedRightColumns=[],this.displayedCenterColumns=[],this.allDisplayedColumns=[],this.allDisplayedVirtualColumns=[],this.allDisplayedCenterVirtualColumns=[],this.rowGroupColumns=[],this.valueColumns=[],this.pivotColumns=[],this.ready=!1,this.autoGroupsNeedBuilding=!1,this.pivotMode=!1,this.bodyWidth=0,this.leftWidth=0,this.rightWidth=0,this.bodyWidthDirty=!0}return t.prototype.init=function(){var t=this.gridOptionsWrapper.isPivotMode();this.suppressColumnVirtualisation=this.gridOptionsWrapper.isSuppressColumnVirtualisation(),this.isPivotSettingAllowed(t)&&(this.pivotMode=t),this.usingTreeData=this.gridOptionsWrapper.isTreeData()},t.prototype.setColumnDefs=function(t,e){void 0===e&&(e="api");var i=!!this.columnDefs;this.columnDefs=t,this.valueCache.expire(),this.autoGroupsNeedBuilding=!0;var o=this.primaryColumns,t=this.columnFactory.createColumnTree(t,!0,o);this.primaryColumnTree=t.columnTree,this.primaryHeaderRowCount=t.treeDept+1,this.primaryColumns=this.getColumnsFromTree(this.primaryColumnTree),this.extractRowGroupColumns(e,o),this.extractPivotColumns(e,o),this.createValueColumns(e,o),this.ready=!0,this.updateGridColumns(),this.updateDisplayedColumns(e),this.checkDisplayedVirtualColumns(),this.gridOptionsWrapper.isDeltaColumnMode()&&i&&this.resetColumnState(!0,e);e={type:events_1.Events.EVENT_COLUMN_EVERYTHING_CHANGED,api:this.gridApi,columnApi:this.columnApi,source:e};this.eventService.dispatchEvent(e);e={type:events_1.Events.EVENT_NEW_COLUMNS_LOADED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(e)},t.prototype.isAutoRowHeightActive=function(){return this.autoRowHeightColumns&&0<this.autoRowHeightColumns.length},t.prototype.getAllAutoRowHeightCols=function(){return this.autoRowHeightColumns},t.prototype.setVirtualViewportLeftAndRight=function(){this.gridOptionsWrapper.isEnableRtl()?(this.viewportLeft=this.bodyWidth-this.scrollPosition-this.scrollWidth,this.viewportRight=this.bodyWidth-this.scrollPosition):(this.viewportLeft=this.scrollPosition,this.viewportRight=this.scrollWidth+this.scrollPosition)},t.prototype.getDisplayedColumnsStartingAt=function(t){for(var e=t,i=[];e&&utils_1._.exists(e);)i.push(e),e=this.getDisplayedColAfter(e);return i},t.prototype.checkDisplayedVirtualColumns=function(){var t;utils_1._.exists(this.displayedCenterColumns)&&(t=this.allDisplayedVirtualColumns.map(function(t){return t.getId()}).join("#"),this.updateVirtualSets(),t!==this.allDisplayedVirtualColumns.map(function(t){return t.getId()}).join("#")&&(t={type:events_1.Events.EVENT_VIRTUAL_COLUMNS_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(t)))},t.prototype.setVirtualViewportPosition=function(t,e){t===this.scrollWidth&&e===this.scrollPosition&&!this.bodyWidthDirty||(this.scrollWidth=t,this.scrollPosition=e,this.bodyWidthDirty=!0,this.setVirtualViewportLeftAndRight(),this.ready&&this.checkDisplayedVirtualColumns())},t.prototype.isPivotMode=function(){return this.pivotMode},t.prototype.isPivotSettingAllowed=function(t){return!t||(!this.gridOptionsWrapper.isTreeData()||(console.warn("ag-Grid: Pivot mode not available in conjunction Tree Data i.e. 'gridOptions.treeData: true'"),!1))},t.prototype.setPivotMode=function(t,e){void 0===e&&(e="api"),t!==this.pivotMode&&this.isPivotSettingAllowed(this.pivotMode)&&(this.pivotMode=t,this.autoGroupsNeedBuilding=!0,this.updateGridColumns(),this.updateDisplayedColumns(e),e={type:events_1.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(e))},t.prototype.getSecondaryPivotColumn=function(o,t){if(!this.secondaryColumnsPresent)return null;var n=this.getPrimaryColumn(t),s=null;return this.secondaryColumns&&this.secondaryColumns.forEach(function(t){var e=t.getColDef().pivotKeys,i=t.getColDef().pivotValueColumn;utils_1._.compareArrays(e,o)&&i===n&&(s=t)}),s},t.prototype.setBeans=function(t){this.logger=t.create("ColumnController")},t.prototype.setFirstRightAndLastLeftPinned=function(e){var i,o=this.gridOptionsWrapper.isEnableRtl()?(i=this.displayedLeftColumns?this.displayedLeftColumns[0]:null,this.displayedRightColumns?utils_1._.last(this.displayedRightColumns):null):(i=this.displayedLeftColumns?utils_1._.last(this.displayedLeftColumns):null,this.displayedRightColumns?this.displayedRightColumns[0]:null);this.gridColumns.forEach(function(t){t.setLastLeftPinned(t===i,e),t.setFirstRightPinned(t===o,e)})},t.prototype.autoSizeColumns=function(t,i){var o=this;void 0===i&&(i="api");for(var e,n=[],s=-1;0!==s;)s=0,this.actionOnGridColumns(t,function(t){if(0<=n.indexOf(t))return!1;var e=o.autoWidthCalculator.getPreferredWidthForColumn(t);return 0<e&&(e=o.normaliseColumnWidth(t,e),t.setActualWidth(e,i),n.push(t),s++),!0},i);0<n.length&&(e={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:n,column:1===n.length?n[0]:null,finished:!0,api:this.gridApi,columnApi:this.columnApi,source:"autosizeColumns"},this.eventService.dispatchEvent(e))},t.prototype.autoSizeColumn=function(t,e){void 0===e&&(e="api"),t&&this.autoSizeColumns([t],e)},t.prototype.autoSizeAllColumns=function(t){void 0===t&&(t="api");var e=this.getAllDisplayedColumns();this.autoSizeColumns(e,t)},t.prototype.getColumnsFromTree=function(t){var n=[];return function t(e){for(var i=0;i<e.length;i++){var o=e[i];o instanceof column_1.Column?n.push(o):o instanceof originalColumnGroup_1.OriginalColumnGroup&&t(o.getChildren())}}(t),n},t.prototype.getAllDisplayedColumnGroups=function(){return this.displayedLeftColumnTree&&this.displayedRightColumnTree&&this.displayedCentreColumnTree?this.displayedLeftColumnTree.concat(this.displayedCentreColumnTree).concat(this.displayedRightColumnTree):null},t.prototype.getPrimaryColumnTree=function(){return this.primaryColumnTree},t.prototype.getHeaderRowCount=function(){return this.gridHeaderRowCount},t.prototype.getLeftDisplayedColumnGroups=function(){return this.displayedLeftColumnTree},t.prototype.getRightDisplayedColumnGroups=function(){return this.displayedRightColumnTree},t.prototype.getCenterDisplayedColumnGroups=function(){return this.displayedCentreColumnTree},t.prototype.getDisplayedColumnGroups=function(t){switch(t){case column_1.Column.PINNED_LEFT:return this.getLeftDisplayedColumnGroups();case column_1.Column.PINNED_RIGHT:return this.getRightDisplayedColumnGroups();default:return this.getCenterDisplayedColumnGroups()}},t.prototype.isColumnDisplayed=function(t){return 0<=this.getAllDisplayedColumns().indexOf(t)},t.prototype.getAllDisplayedColumns=function(){return this.allDisplayedColumns},t.prototype.getAllDisplayedVirtualColumns=function(){return this.allDisplayedVirtualColumns},t.prototype.getDisplayedLeftColumnsForRow=function(t){return this.colSpanActive?this.getDisplayedColumnsForRow(t,this.displayedLeftColumns):this.displayedLeftColumns},t.prototype.getDisplayedRightColumnsForRow=function(t){return this.colSpanActive?this.getDisplayedColumnsForRow(t,this.displayedRightColumns):this.displayedRightColumns},t.prototype.getDisplayedColumnsForRow=function(u,l,a,p){for(var d,h=[],c=null,t=0;t<l.length;t++)!function(t){var e,i=l[t],o=l.length-t,o=Math.min(i.getColSpan(u),o),n=[i];if(1<o){for(var s=o-1,r=1;r<=s;r++)n.push(l[t+r]);t+=s}a?(e=!1,n.forEach(function(t){a(t)&&(e=!0)})):e=!0,e&&(0===h.length&&c&&!!p&&p(i)&&h.push(c),h.push(i)),c=i,d=t}(t),t=d;return h},t.prototype.getAllDisplayedCenterVirtualColumnsForRow=function(t){var e=this;if(!this.colSpanActive)return this.allDisplayedCenterVirtualColumns;var i=this.suppressColumnVirtualisation?null:this.isColumnInViewport.bind(this);return this.getDisplayedColumnsForRow(t,this.displayedCenterColumns,i,function(t){return t.getLeft()>e.viewportLeft})},t.prototype.isColumnInViewport=function(t){var e=t.getLeft(),i=t.getLeft()+t.getActualWidth(),o=this.viewportLeft-200,t=this.viewportRight+200;return!(e<o&&i<o)&&!(t<e&&t<i)},t.prototype.getPinnedLeftContainerWidth=function(){return this.getWidthOfColsInList(this.displayedLeftColumns)},t.prototype.getPinnedRightContainerWidth=function(){return this.getWidthOfColsInList(this.displayedRightColumns)},t.prototype.updatePrimaryColumnList=function(t,e,i,o,n,s){var r,u=this;void 0===s&&(s="api"),t&&!utils_1._.missingOrEmpty(t)&&(r=!1,t.forEach(function(t){t=u.getPrimaryColumn(t);if(t){if(i){if(0<=e.indexOf(t))return;e.push(t)}else{if(e.indexOf(t)<0)return;utils_1._.removeFromArray(e,t)}o(t),r=!0}}),r&&(this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(s),s={type:n,columns:e,column:1===e.length?e[0]:null,api:this.gridApi,columnApi:this.columnApi,source:s},this.eventService.dispatchEvent(s)))},t.prototype.setRowGroupColumns=function(t,e){void 0===e&&(e="api"),this.autoGroupsNeedBuilding=!0,this.setPrimaryColumnList(t,this.rowGroupColumns,events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.setRowGroupActive.bind(this),e)},t.prototype.setRowGroupActive=function(t,e,i){t!==e.isRowGroupActive()&&(e.setRowGroupActive(t,i),t||this.gridOptionsWrapper.isSuppressMakeColumnVisibleAfterUnGroup()||e.setVisible(!0,i))},t.prototype.addRowGroupColumn=function(t,e){void 0===e&&(e="api"),t&&this.addRowGroupColumns([t],e)},t.prototype.addRowGroupColumns=function(t,e){void 0===e&&(e="api"),this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(t,this.rowGroupColumns,!0,this.setRowGroupActive.bind(this,!0),events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e)},t.prototype.removeRowGroupColumns=function(t,e){void 0===e&&(e="api"),this.autoGroupsNeedBuilding=!0,this.updatePrimaryColumnList(t,this.rowGroupColumns,!1,this.setRowGroupActive.bind(this,!1),events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e)},t.prototype.removeRowGroupColumn=function(t,e){void 0===e&&(e="api"),t&&this.removeRowGroupColumns([t],e)},t.prototype.addPivotColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.pivotColumns,!0,function(t){return t.setPivotActive(!0,e)},events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,e)},t.prototype.setPivotColumns=function(t,i){void 0===i&&(i="api"),this.setPrimaryColumnList(t,this.pivotColumns,events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,function(t,e){e.setPivotActive(t,i)},i)},t.prototype.addPivotColumn=function(t,e){void 0===e&&(e="api"),this.addPivotColumns([t],e)},t.prototype.removePivotColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.pivotColumns,!1,function(t){return t.setPivotActive(!1,e)},events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,e)},t.prototype.removePivotColumn=function(t,e){void 0===e&&(e="api"),this.removePivotColumns([t],e)},t.prototype.setPrimaryColumnList=function(t,i,e,o,n){var s=this;i.length=0,utils_1._.exists(t)&&t.forEach(function(t){t=s.getPrimaryColumn(t);t&&i.push(t)}),this.primaryColumns.forEach(function(t){var e=0<=i.indexOf(t);o(e,t)}),this.autoGroupsNeedBuilding&&this.updateGridColumns(),this.updateDisplayedColumns(n);n={type:e,columns:i,column:1===i.length?i[0]:null,api:this.gridApi,columnApi:this.columnApi,source:n};this.eventService.dispatchEvent(n)},t.prototype.setValueColumns=function(t,e){void 0===e&&(e="api"),this.setPrimaryColumnList(t,this.valueColumns,events_1.Events.EVENT_COLUMN_VALUE_CHANGED,this.setValueActive.bind(this),e)},t.prototype.setValueActive=function(t,e,i){t!==e.isValueActive()&&(e.setValueActive(t,i),t&&!e.getAggFunc()&&(t=this.aggFuncService.getDefaultAggFunc(e),e.setAggFunc(t)))},t.prototype.addValueColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.valueColumns,!0,this.setValueActive.bind(this,!0),events_1.Events.EVENT_COLUMN_VALUE_CHANGED,e)},t.prototype.addValueColumn=function(t,e){void 0===e&&(e="api"),t&&this.addValueColumns([t],e)},t.prototype.removeValueColumn=function(t,e){void 0===e&&(e="api"),this.removeValueColumns([t],e)},t.prototype.removeValueColumns=function(t,e){void 0===e&&(e="api"),this.updatePrimaryColumnList(t,this.valueColumns,!1,this.setValueActive.bind(this,!1),events_1.Events.EVENT_COLUMN_VALUE_CHANGED,e)},t.prototype.normaliseColumnWidth=function(t,e){return e<t.getMinWidth()&&(e=t.getMinWidth()),t.isGreaterThanMax(e)&&(e=t.getMaxWidth()),e},t.prototype.getPrimaryOrGridColumn=function(t){var e=this.getPrimaryColumn(t);return e||this.getGridColumn(t)},t.prototype.setColumnWidth=function(t,e,i,o,n){void 0===n&&(n="api");var s=this.getPrimaryOrGridColumn(t);if(s){t=[];if(t.push({width:e,ratios:[1],columns:[s]}),"shift"===this.gridOptionsWrapper.getColResizeDefault()&&(i=!i),i){i=this.getDisplayedColAfter(s);if(!i)return;e=s.getActualWidth()-e,e=i.getActualWidth()+e;t.push({width:e,ratios:[1],columns:[i]})}this.resizeColumnSets(t,o,n)}},t.prototype.checkMinAndMaxWidthsForSet=function(t){var e=t.columns,t=t.width,i=0,o=0,n=!0;return e.forEach(function(t){i+=t.getMinWidth(),0<t.getMaxWidth()?o+=t.getMaxWidth():n=!1}),i<=t&&(!n||t<=o)},t.prototype.resizeColumnSets=function(t,e,i){var o,n,s;utils_1._.every(t,this.checkMinAndMaxWidthsForSet.bind(this))?(o=[],n=[],t.forEach(function(t){var u=t.width,e=t.columns,l=t.ratios,a={},p={};e.forEach(function(t){return n.push(t)});for(var d=!0,h=0;d;)if("break"===function(){if(1e3<++h)return console.error("ag-Grid: infinite loop in resizeColumnSets"),"break";d=!1;var o=[],i=[],n=0,s=u;e.forEach(function(t,e){p[t.getId()]?s-=a[t.getId()]:(o.push(t),e=l[e],n+=e,i.push(e))});var r=1/n;o.forEach(function(t,e){var i;e===o.length-1?i=s:(i=Math.round(l[e]*u*r),s-=i),i<t.getMinWidth()?(i=t.getMinWidth(),p[t.getId()]=!0,d=!0):0<t.getMaxWidth()&&i>t.getMaxWidth()&&(i=t.getMaxWidth(),p[t.getId()]=!0,d=!0),a[t.getId()]=i})}())break;e.forEach(function(t){var e=a[t.getId()];t.getActualWidth()!==e&&(t.setActualWidth(e),o.push(t))})}),(s=0<o.length)&&(this.setLeftValues(i),this.updateBodyWidths(),this.checkDisplayedVirtualColumns()),(s||e)&&(s={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:n,column:1===n.length?n[0]:null,finished:e,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(s))):e&&(t=t&&0<t.length?t[0].columns:null,i={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:t,column:t&&1===t.length?t[0]:null,finished:e,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(i))},t.prototype.setColumnAggFunc=function(t,e,i){void 0===i&&(i="api"),t&&(t.setAggFunc(e),i={type:events_1.Events.EVENT_COLUMN_VALUE_CHANGED,columns:[t],column:t,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(i))},t.prototype.moveRowGroupColumn=function(t,e,i){void 0===i&&(i="api");var o=this.rowGroupColumns[t];this.rowGroupColumns.splice(t,1),this.rowGroupColumns.splice(e,0,o);i={type:events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,columns:this.rowGroupColumns,column:1===this.rowGroupColumns.length?this.rowGroupColumns[0]:null,api:this.gridApi,columnApi:this.columnApi,source:i};this.eventService.dispatchEvent(i)},t.prototype.moveColumns=function(t,e,i){if(void 0===i&&(i="api"),this.columnAnimationService.start(),e>this.gridColumns.length-t.length)return console.warn("ag-Grid: tried to insert columns in invalid location, toIndex = "+e),void console.warn("ag-Grid: remember that you should not count the moving columns when calculating the new index");t=this.getGridColumns(t);this.doesMovePassRules(t,e)&&(utils_1._.moveInArray(this.gridColumns,t,e),this.updateDisplayedColumns(i),i={type:events_1.Events.EVENT_COLUMN_MOVED,columns:t,column:1===t.length?t[0]:null,toIndex:e,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(i),this.columnAnimationService.finish())},t.prototype.doesMovePassRules=function(t,e){var i=this.gridColumns.slice();return utils_1._.moveInArray(i,t,e),!!this.doesMovePassMarryChildren(i)&&!!this.doesMovePassLockedPositions(i)},t.prototype.doesMovePassLockedPositions=function(t){var e=!1,i=!0;return t.forEach(function(t){t.getColDef().lockPosition?e&&(i=!1):e=!0}),i},t.prototype.doesMovePassMarryChildren=function(o){var n=!0;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(t){var e,i;t instanceof originalColumnGroup_1.OriginalColumnGroup&&((e=t).getColGroupDef()&&e.getColGroupDef().marryChildren&&(i=[],e.getLeafColumns().forEach(function(t){t=o.indexOf(t);i.push(t)}),t=Math.max.apply(Math,i)-Math.min.apply(Math,i),e.getLeafColumns().length-1<t&&(n=!1)))}),n},t.prototype.moveColumn=function(t,e,i){void 0===i&&(i="api"),this.moveColumns([t],e,i)},t.prototype.moveColumnByIndex=function(t,e,i){void 0===i&&(i="api");t=this.gridColumns[t];this.moveColumn(t,e,i)},t.prototype.getBodyContainerWidth=function(){return this.bodyWidth},t.prototype.getContainerWidth=function(t){switch(t){case column_1.Column.PINNED_LEFT:return this.leftWidth;case column_1.Column.PINNED_RIGHT:return this.rightWidth;default:return this.bodyWidth}},t.prototype.updateBodyWidths=function(){var t=this.getWidthOfColsInList(this.displayedCenterColumns),e=this.getWidthOfColsInList(this.displayedLeftColumns),i=this.getWidthOfColsInList(this.displayedRightColumns);this.bodyWidthDirty=this.bodyWidth!==t,this.bodyWidth===t&&this.leftWidth===e&&this.rightWidth===i||(this.bodyWidth=t,this.leftWidth=e,this.rightWidth=i,i={type:events_1.Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(i))},t.prototype.getValueColumns=function(){return this.valueColumns||[]},t.prototype.getPivotColumns=function(){return this.pivotColumns||[]},t.prototype.isPivotActive=function(){return this.pivotColumns&&0<this.pivotColumns.length&&this.pivotMode},t.prototype.getRowGroupColumns=function(){return this.rowGroupColumns||[]},t.prototype.getDisplayedCenterColumns=function(){return this.displayedCenterColumns},t.prototype.getDisplayedLeftColumns=function(){return this.displayedLeftColumns},t.prototype.getDisplayedRightColumns=function(){return this.displayedRightColumns},t.prototype.getDisplayedColumns=function(t){switch(t){case column_1.Column.PINNED_LEFT:return this.getDisplayedLeftColumns();case column_1.Column.PINNED_RIGHT:return this.getDisplayedRightColumns();default:return this.getDisplayedCenterColumns()}},t.prototype.getAllPrimaryColumns=function(){return this.primaryColumns?this.primaryColumns.slice():null},t.prototype.getSecondaryColumns=function(){return this.secondaryColumns?this.secondaryColumns.slice():null},t.prototype.getAllColumnsForQuickFilter=function(){return this.columnsForQuickFilter},t.prototype.getAllGridColumns=function(){return this.gridColumns},t.prototype.isEmpty=function(){return utils_1._.missingOrEmpty(this.gridColumns)},t.prototype.isRowGroupEmpty=function(){return utils_1._.missingOrEmpty(this.rowGroupColumns)},t.prototype.setColumnVisible=function(t,e,i){void 0===i&&(i="api"),this.setColumnsVisible([t],e,i)},t.prototype.setColumnsVisible=function(t,e,i){var o=this;void 0===i&&(i="api"),this.columnAnimationService.start(),this.actionOnGridColumns(t,function(t){return t.isVisible()!==e&&(t.setVisible(e,i),!0)},i,function(){return{type:events_1.Events.EVENT_COLUMN_VISIBLE,visible:e,column:null,columns:null,api:o.gridApi,columnApi:o.columnApi,source:i}}),this.columnAnimationService.finish()},t.prototype.setColumnPinned=function(t,e,i){void 0===i&&(i="api"),t&&this.setColumnsPinned([t],e,i)},t.prototype.setColumnsPinned=function(t,e,i){var o,n=this;void 0===i&&(i="api"),"print"!==this.gridOptionsWrapper.getDomLayout()?(this.columnAnimationService.start(),o=!0===e||e===column_1.Column.PINNED_LEFT?column_1.Column.PINNED_LEFT:e===column_1.Column.PINNED_RIGHT?column_1.Column.PINNED_RIGHT:null,this.actionOnGridColumns(t,function(t){return t.getPinned()!==o&&(t.setPinned(o),!0)},i,function(){return{type:events_1.Events.EVENT_COLUMN_PINNED,pinned:o,column:null,columns:null,api:n.gridApi,columnApi:n.columnApi,source:i}}),this.columnAnimationService.finish()):console.warn("Changing the column pinning status is not allowed with domLayout='print'")},t.prototype.actionOnGridColumns=function(t,e,i,o){var n,s=this;utils_1._.missingOrEmpty(t)||(n=[],t.forEach(function(t){t=s.getGridColumn(t);t&&!1!==e(t)&&n.push(t)}),0!==n.length&&(this.updateDisplayedColumns(i),utils_1._.exists(o)&&o&&((o=o()).columns=n,o.column=1===n.length?n[0]:null,this.eventService.dispatchEvent(o))))},t.prototype.getDisplayedColBefore=function(t){var e=this.getAllDisplayedColumns(),t=e.indexOf(t);return 0<t?e[t-1]:null},t.prototype.getDisplayedColAfter=function(t){var e=this.getAllDisplayedColumns(),t=e.indexOf(t);return t<e.length-1?e[t+1]:null},t.prototype.getDisplayedGroupAfter=function(t){for(var e=t.getDisplayedLeafColumns()[0],i=t.getOriginalColumnGroup().getLevel();;){if(!(e=this.getDisplayedColAfter(e)))return null;for(var o=e.getParent();o.getOriginalColumnGroup().getLevel()!==i;)o=o.getParent();if(o!==t)return o}},t.prototype.isPinningLeft=function(){return 0<this.displayedLeftColumns.length},t.prototype.isPinningRight=function(){return 0<this.displayedRightColumns.length},t.prototype.getPrimaryAndSecondaryAndAutoColumns=function(){var e=this.primaryColumns?this.primaryColumns.slice(0):[];return this.groupAutoColumns&&utils_1._.exists(this.groupAutoColumns)&&this.groupAutoColumns.forEach(function(t){return e.push(t)}),this.secondaryColumnsPresent&&this.secondaryColumns&&this.secondaryColumns.forEach(function(t){return e.push(t)}),e},t.prototype.createStateItemFromColumn=function(t){var e=t.isRowGroupActive()?this.rowGroupColumns.indexOf(t):null,i=t.isPivotActive()?this.pivotColumns.indexOf(t):null,o=t.isValueActive()?t.getAggFunc():null;return{colId:t.getColId(),hide:!t.isVisible(),aggFunc:o,width:t.getActualWidth(),pivotIndex:i,pinned:t.getPinned(),rowGroupIndex:e}},t.prototype.getColumnState=function(){if(utils_1._.missing(this.primaryColumns))return[];var t=this.primaryColumns.map(this.createStateItemFromColumn.bind(this)),t=(this.groupAutoColumns?this.groupAutoColumns.map(this.createStateItemFromColumn.bind(this)):[]).concat(t);return this.pivotMode||this.orderColumnStateList(t),t},t.prototype.orderColumnStateList=function(t){var i=this.gridColumns.map(function(t){return t.getColId()});t.sort(function(t,e){return i.indexOf(t.colId)-i.indexOf(e.colId)})},t.prototype.resetColumnState=function(t,e){void 0===t&&(t=!1),void 0===e&&(e="api");var i=this.getColumnsFromTree(this.primaryColumnTree),s=[],r=1e3,u=1e3;i&&i.forEach(function(t){var e=t.getColDef().rowGroupIndex,i=t.getColDef().rowGroup,o=t.getColDef().pivotIndex,n=t.getColDef().pivot,t={colId:t.getColId(),aggFunc:t.getColDef().aggFunc,hide:t.getColDef().hide,pinned:t.getColDef().pinned,rowGroupIndex:e,pivotIndex:t.getColDef().pivotIndex,width:t.getColDef().width};utils_1._.missing(e)&&i&&(t.rowGroupIndex=r++),utils_1._.missing(o)&&n&&(t.pivotIndex=u++),s.push(t)}),this.setColumnState(s,t,e)},t.prototype.setColumnState=function(t,e,i){var o=this;if(void 0===e&&(e=!1),void 0===i&&(i="api"),utils_1._.missingOrEmpty(this.primaryColumns))return!1;var n=this.getColumnState();this.autoGroupsNeedBuilding=!0;var s=this.primaryColumns.slice();this.rowGroupColumns=[],this.valueColumns=[],this.pivotColumns=[];var r,u=!0,l={},a={},p=[];return t&&t.forEach(function(t){var e;utils_1._.exists(o.getAutoColumn(t.colId))?p.push(t):(e=o.getPrimaryColumn(t.colId))?(o.syncColumnWithStateItem(e,t,l,a,i),utils_1._.removeFromArray(s,e)):(console.warn("ag-grid: column "+t.colId+" not found"),u=!1)}),s.forEach(this.syncColumnWithNoState.bind(this)),this.rowGroupColumns.sort(this.sortColumnListUsingIndexes.bind(this,l)),this.pivotColumns.sort(this.sortColumnListUsingIndexes.bind(this,a)),this.updateGridColumns(),p.forEach(function(t){var e=o.getAutoColumn(t.colId);o.syncColumnWithStateItem(e,t,l,a,i)}),t&&(r=t.map(function(t){return t.colId}),this.gridColumns.sort(function(t,e){return r.indexOf(t.getId())-r.indexOf(e.getId())})),this.putFixedColumnsFirst(),this.updateDisplayedColumns(i),e||(e={type:events_1.Events.EVENT_COLUMN_EVERYTHING_CHANGED,api:this.gridApi,columnApi:this.columnApi,source:i},this.eventService.dispatchEvent(e)),this.raiseColumnEvents(n,i),u},t.prototype.raiseColumnEvents=function(s,o){var n,t,e,r=this;this.gridOptionsWrapper.isSuppressSetColumnStateEvents()||(n=this.getColumnState(),t=function(i){var o=[],n={};return s.forEach(function(t){n[t.colId]=t}),r.gridColumns.forEach(function(t){var e=n[t.getColId()];e&&!i(e,t)||o.push(t)}),o},(e=function(t,e,i){utils_1._.compareArrays(s.map(e).sort(),n.map(e).sort())||(i={type:t,columns:i,column:1===i.length?i[0]:null,api:r.gridApi,columnApi:r.columnApi,source:o},r.eventService.dispatchEvent(i))})(events_1.Events.EVENT_COLUMN_VALUE_CHANGED,function(t){return t.colId+"-"+t.aggFunc},this.valueColumns),e(events_1.Events.EVENT_COLUMN_PIVOT_CHANGED,function(t){return t.colId+"-"+t.pivotIndex},this.pivotColumns),e(events_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,function(t){return t.colId+"-"+t.rowGroupIndex},this.rowGroupColumns),this.raiseColumnPinnedEvent(t(function(t,e){return t.pinned!==e.getPinned()}),o),e=t(function(t,e){return t.hide===e.isVisible()}),this.raiseColumnVisibleEvent(e,o),this.raiseColumnResizeEvent(t(function(t,e){return t.width!==e.getActualWidth()}),o),this.raiseColumnMovedEvent(s,o))},t.prototype.raiseColumnPinnedEvent=function(t,e){0<t.length&&(e={type:events_1.Events.EVENT_COLUMN_PINNED,pinned:null,columns:t,column:null,api:this.gridApi,columnApi:this.columnApi,source:e},this.eventService.dispatchEvent(e))},t.prototype.raiseColumnVisibleEvent=function(t,e){0<t.length&&(e={type:events_1.Events.EVENT_COLUMN_VISIBLE,visible:void 0,columns:t,column:null,api:this.gridApi,columnApi:this.columnApi,source:e},this.eventService.dispatchEvent(e))},t.prototype.raiseColumnResizeEvent=function(t,e){0<t.length&&(e={type:events_1.Events.EVENT_COLUMN_RESIZED,columns:t,column:null,finished:!0,api:this.gridApi,columnApi:this.columnApi,source:e},this.eventService.dispatchEvent(e))},t.prototype.raiseColumnMovedEvent=function(o,t){for(var n=[],s=this.getColumnState(),e=function(t){var e=o[t],i=s[t];if(!e||i.hide)return"continue";e.colId!==i.colId&&(e=utils_1._.find(r.allDisplayedColumns,function(t){return t.getColId()===i.colId}),n.push(e))},r=this,i=0;i<s.length;i++)e(i);0<n.length&&(t={type:events_1.Events.EVENT_COLUMN_MOVED,columns:n,column:null,toIndex:void 0,api:this.gridApi,columnApi:this.columnApi,source:t},this.eventService.dispatchEvent(t))},t.prototype.sortColumnListUsingIndexes=function(t,e,i){return t[e.getId()]-t[i.getId()]},t.prototype.syncColumnWithNoState=function(t,e){t.setVisible(!1,e),t.setAggFunc(null),t.setPinned(null),t.setRowGroupActive(!1,e),t.setPivotActive(!1,e),t.setValueActive(!1,e)},t.prototype.syncColumnWithStateItem=function(t,e,i,o,n){var s;t&&(t.setVisible(!e.hide,n),t.setPinned(e.pinned),s=this.gridOptionsWrapper.getMinColWidth(),e.width&&s&&e.width>=s&&t.setActualWidth(e.width,n),"string"==typeof e.aggFunc?(t.setAggFunc(e.aggFunc),t.setValueActive(!0,n),this.valueColumns.push(t)):(utils_1._.exists(e.aggFunc)&&console.warn("ag-Grid: stateItem.aggFunc must be a string. if using your own aggregation functions, register the functions first before using them in get/set state. This is because it isintended for the column state to be stored and retrieved as simple JSON."),t.setAggFunc(null),t.setValueActive(!1,n)),"number"==typeof e.rowGroupIndex?(this.rowGroupColumns.push(t),t.setRowGroupActive(!0,n),i[t.getId()]=e.rowGroupIndex):t.setRowGroupActive(!1,n),"number"==typeof e.pivotIndex?(this.pivotColumns.push(t),t.setPivotActive(!0,n),o[t.getId()]=e.pivotIndex):t.setPivotActive(!1,n))},t.prototype.getGridColumns=function(t){return this.getColumns(t,this.getGridColumn.bind(this))},t.prototype.getColumns=function(t,e){var i=[];return t&&t.forEach(function(t){t=e(t);t&&i.push(t)}),i},t.prototype.getColumnWithValidation=function(t){if(null==t)return null;var e=this.getGridColumn(t);return e||console.warn("ag-Grid: could not find column "+t),e},t.prototype.getPrimaryColumn=function(t){return this.getColumn(t,this.primaryColumns)},t.prototype.getGridColumn=function(t){return this.getColumn(t,this.gridColumns)},t.prototype.getColumn=function(t,e){if(!t)return null;for(var i=0;i<e.length;i++)if(this.columnsMatch(e[i],t))return e[i];return this.getAutoColumn(t)},t.prototype.getAutoColumn=function(e){var i=this;return this.groupAutoColumns&&utils_1._.exists(this.groupAutoColumns)&&!utils_1._.missing(this.groupAutoColumns)?utils_1._.find(this.groupAutoColumns,function(t){return i.columnsMatch(t,e)}):null},t.prototype.columnsMatch=function(t,e){var i=t===e,o=t.getColDef()===e,e=t.getColId()==e;return i||o||e},t.prototype.getDisplayNameForColumn=function(t,e,i){if(void 0===i&&(i=!1),!t)return null;e=this.getHeaderName(t.getColDef(),t,null,null,e);return i?this.wrapHeaderNameWithAggFunc(t,e):e},t.prototype.getDisplayNameForOriginalColumnGroup=function(t,e,i){var o=e?e.getColGroupDef():null;return o?this.getHeaderName(o,null,t,e,i):null},t.prototype.getDisplayNameForColumnGroup=function(t,e){return this.getDisplayNameForOriginalColumnGroup(t,t.getOriginalColumnGroup(),e)},t.prototype.getHeaderName=function(t,e,i,o,n){var s=t.headerValueGetter;if(s){n={colDef:t,column:e,columnGroup:i,originalColumnGroup:o,location:n,api:this.gridOptionsWrapper.getApi(),context:this.gridOptionsWrapper.getContext()};return"function"==typeof s?s(n):"string"==typeof s?this.expressionService.evaluate(s,n):(console.warn("ag-grid: headerValueGetter must be a function or a string"),"")}return null!=t.headerName?t.headerName:t.field?utils_1._.camelCaseToHumanText(t.field):""},t.prototype.wrapHeaderNameWithAggFunc=function(t,e){if(this.gridOptionsWrapper.isSuppressAggFuncInHeader())return e;var i,o=t.getColDef().pivotValueColumn,n=null;if(utils_1._.exists(o)?(n=o?o.getAggFunc():null,!0):(i=t.isValueActive(),o=this.pivotMode||!this.isRowGroupEmpty(),!(!i||!o)&&(n=t.getAggFunc(),!0))){n="string"==typeof n?n:"func";return this.gridOptionsWrapper.getLocaleTextFunc()(n,n)+"("+e+")"}return e},t.prototype.getColumnGroup=function(e,i){if(!e)return null;if(e instanceof columnGroup_1.ColumnGroup)return e;var t=this.getAllDisplayedColumnGroups(),o="number"==typeof i,n=null;return this.columnUtils.depthFirstAllColumnTreeSearch(t,function(t){t instanceof columnGroup_1.ColumnGroup&&(t=t,(o?e===t.getGroupId()&&i===t.getInstanceId():e===t.getGroupId())&&(n=t))}),n},t.prototype.isReady=function(){return this.ready},t.prototype.createValueColumns=function(i,t){this.valueColumns=this.extractColumns(t,this.valueColumns,function(t,e){return t.setValueActive(e,i)},function(){return null},function(t){return!!t.aggFunc}),this.valueColumns.forEach(function(t){t.getAggFunc()||t.setAggFunc(t.getColDef().aggFunc)})},t.prototype.extractRowGroupColumns=function(i,t){this.rowGroupColumns=this.extractColumns(t,this.rowGroupColumns,function(t,e){return t.setRowGroupActive(e,i)},function(t){return t.rowGroupIndex},function(t){return t.rowGroup})},t.prototype.extractColumns=function(e,t,i,o,n){var s=this,r=(t=t||[]).filter(function(t){return s.primaryColumns.indexOf(t)<0}),u=t.filter(function(t){return 0<=s.primaryColumns.indexOf(t)}),t=this.primaryColumns.filter(function(t){return!e||e.indexOf(t)<0});r.forEach(function(t){return i(t,!1)});var l=[];return t.forEach(function(t){"number"==typeof o(t.getColDef())&&l.push(t)}),l.sort(function(t,e){t=o(t.getColDef()),e=o(e.getColDef());return t===e?0:t<e?-1:1}),t.forEach(function(t){n(t.getColDef())&&(0<=l.indexOf(t)||l.push(t))}),l.forEach(function(t){return i(t,!0)}),u.concat(l)},t.prototype.extractPivotColumns=function(i,t){this.pivotColumns=this.extractColumns(t,this.pivotColumns,function(t,e){return t.setPivotActive(e,i)},function(t){return t.pivotIndex},function(t){return t.pivot})},t.prototype.resetColumnGroupState=function(t){void 0===t&&(t="api");var e=[];this.columnUtils.depthFirstOriginalTreeSearch(null,this.primaryColumnTree,function(t){t instanceof originalColumnGroup_1.OriginalColumnGroup&&(t={groupId:t.getGroupId(),open:t.getColGroupDef().openByDefault},e.push(t))}),this.setColumnGroupState(e,t)},t.prototype.getColumnGroupState=function(){var e=[];return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(t){t instanceof originalColumnGroup_1.OriginalColumnGroup&&(t=t,e.push({groupId:t.getGroupId(),open:t.isExpanded()}))}),e},t.prototype.setColumnGroupState=function(t,e){var i=this;void 0===e&&(e="api"),this.columnAnimationService.start();var o=[];t.forEach(function(t){var e=t.groupId,t=t.open,e=i.getOriginalColumnGroup(e);e&&e.isExpanded()!==t&&(i.logger.log("columnGroupOpened("+e.getGroupId()+","+t+")"),e.setExpanded(t),o.push(e))}),this.updateGroupsAndDisplayedColumns(e),this.setFirstRightAndLastLeftPinned(e),o.forEach(function(t){t={type:events_1.Events.EVENT_COLUMN_GROUP_OPENED,columnGroup:t,api:i.gridApi,columnApi:i.columnApi};i.eventService.dispatchEvent(t)}),this.columnAnimationService.finish()},t.prototype.setColumnGroupOpened=function(t,e,i){void 0===i&&(i="api"),t=t instanceof originalColumnGroup_1.OriginalColumnGroup?t.getId():t,this.setColumnGroupState([{groupId:t,open:e}],i)},t.prototype.getOriginalColumnGroup=function(e){if(e instanceof originalColumnGroup_1.OriginalColumnGroup)return e;"string"!=typeof e&&console.error("ag-Grid: group key must be a string");var i=null;return this.columnUtils.depthFirstOriginalTreeSearch(null,this.gridBalancedTree,function(t){t instanceof originalColumnGroup_1.OriginalColumnGroup&&((t=t).getId()===e&&(i=t))}),i},t.prototype.calculateColumnsForDisplay=function(){var i=this,t=this.pivotMode&&!this.secondaryColumnsPresent?utils_1._.filter(this.gridColumns,function(t){var e=i.groupAutoColumns&&0<=i.groupAutoColumns.indexOf(t),t=i.valueColumns&&0<=i.valueColumns.indexOf(t);return e||t}):utils_1._.filter(this.gridColumns,function(t){return i.groupAutoColumns&&0<=i.groupAutoColumns.indexOf(t)||t.isVisible()});return t},t.prototype.checkColSpanActiveInCols=function(t){var e=!1;return t.forEach(function(t){utils_1._.exists(t.getColDef().colSpan)&&(e=!0)}),e},t.prototype.calculateColumnsForGroupDisplay=function(){var i=this;this.groupDisplayColumns=[];function t(t){var e=t.getColDef();e&&utils_1._.exists(e.showRowGroup)&&i.groupDisplayColumns.push(t)}this.gridColumns.forEach(t),this.groupAutoColumns&&this.groupAutoColumns.forEach(t)},t.prototype.getGroupDisplayColumns=function(){return this.groupDisplayColumns},t.prototype.updateDisplayedColumns=function(t){var e=this.calculateColumnsForDisplay();this.buildDisplayedTrees(e),this.calculateColumnsForGroupDisplay(),this.updateGroupsAndDisplayedColumns(t),this.setFirstRightAndLastLeftPinned(t)},t.prototype.isSecondaryColumnsPresent=function(){return this.secondaryColumnsPresent},t.prototype.setSecondaryColumns=function(t,e){void 0===e&&(e="api");var i=t&&0<t.length;(i||this.secondaryColumnsPresent)&&(i?(this.processSecondaryColumnDefinitions(t),t=this.columnFactory.createColumnTree(t,!1),this.secondaryBalancedTree=t.columnTree,this.secondaryHeaderRowCount=t.treeDept+1,this.secondaryColumns=this.getColumnsFromTree(this.secondaryBalancedTree),this.secondaryColumnsPresent=!0):(this.secondaryBalancedTree=null,this.secondaryHeaderRowCount=-1,this.secondaryColumns=null,this.secondaryColumnsPresent=!1),this.updateGridColumns(),this.updateDisplayedColumns(e))},t.prototype.processSecondaryColumnDefinitions=function(t){var o=this.gridOptionsWrapper.getProcessSecondaryColDefFunc(),n=this.gridOptionsWrapper.getProcessSecondaryColGroupDefFunc();(o||n)&&t&&!function i(t){t.forEach(function(t){var e=utils_1._.exists(t.children);e?(e=t,n&&n(e),i(e.children)):(t=t,o&&o(t))})}(t)},t.prototype.updateGridColumns=function(){this.gridColsArePrimary&&(this.lastPrimaryOrder=this.gridColumns),this.secondaryColumns&&this.secondaryBalancedTree?(this.gridBalancedTree=this.secondaryBalancedTree.slice(),this.gridHeaderRowCount=this.secondaryHeaderRowCount,this.gridColumns=this.secondaryColumns.slice(),this.gridColsArePrimary=!1):(this.gridBalancedTree=this.primaryColumnTree.slice(),this.gridHeaderRowCount=this.primaryHeaderRowCount,this.gridColumns=this.primaryColumns.slice(),this.gridColsArePrimary=!0,this.orderGridColsLikeLastPrimary()),this.addAutoGroupToGridColumns(),this.autoRowHeightColumns=this.gridColumns.filter(function(t){return t.getColDef().autoHeight}),this.putFixedColumnsFirst(),this.setupQuickFilterColumns(),this.clearDisplayedColumns(),this.colSpanActive=this.checkColSpanActiveInCols(this.gridColumns);var t={type:events_1.Events.EVENT_GRID_COLUMNS_CHANGED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(t)},t.prototype.orderGridColsLikeLastPrimary=function(){var e,i,t,n,o=this;utils_1._.missing(this.lastPrimaryOrder)||(e=!0,this.gridColumns.forEach(function(t){0<=o.lastPrimaryOrder.indexOf(t)&&(e=!1)}),e||(i=this.lastPrimaryOrder.filter(function(t){return 0<=o.gridColumns.indexOf(t)}),t=this.gridColumns.filter(function(t){return i.indexOf(t)<0}),n=i.slice(),t.forEach(function(t){var e=t.getOriginalParent();if(e){for(var i,o=[];!o.length&&e;)e.getLeafColumns().forEach(function(t){var e=0<=n.indexOf(t),i=o.indexOf(t)<0;e&&i&&o.push(t)}),e=e.getOriginalParent();o.length?(i=o.map(function(t){return n.indexOf(t)}),i=Math.max.apply(Math,i),utils_1._.insertIntoArray(n,t,i+1)):n.push(t)}else n.push(t)}),this.gridColumns=n))},t.prototype.isPrimaryColumnGroupsPresent=function(){return 1<this.primaryHeaderRowCount},t.prototype.setupQuickFilterColumns=function(){this.groupAutoColumns?this.columnsForQuickFilter=this.primaryColumns.concat(this.groupAutoColumns):this.columnsForQuickFilter=this.primaryColumns},t.prototype.putFixedColumnsFirst=function(){var t=this.gridColumns.filter(function(t){return t.getColDef().lockPosition}),e=this.gridColumns.filter(function(t){return!t.getColDef().lockPosition});this.gridColumns=t.concat(e)},t.prototype.addAutoGroupToGridColumns=function(){var t;this.createGroupAutoColumnsIfNeeded(),utils_1._.missing(this.groupAutoColumns)||(this.gridColumns=this.groupAutoColumns?this.groupAutoColumns.concat(this.gridColumns):this.gridColumns,t=this.columnFactory.createForAutoGroups(this.groupAutoColumns,this.gridBalancedTree),this.gridBalancedTree=t.concat(this.gridBalancedTree))},t.prototype.clearDisplayedColumns=function(){this.displayedLeftColumnTree=[],this.displayedRightColumnTree=[],this.displayedCentreColumnTree=[],this.displayedLeftHeaderRows={},this.displayedRightHeaderRows={},this.displayedCentreHeaderRows={},this.displayedLeftColumns=[],this.displayedRightColumns=[],this.displayedCenterColumns=[],this.allDisplayedColumns=[],this.allDisplayedVirtualColumns=[]},t.prototype.updateGroupsAndDisplayedColumns=function(t){this.updateOpenClosedVisibilityInColumnGroups(),this.updateDisplayedColumnsFromTrees(t),this.updateVirtualSets(),this.updateBodyWidths();t={type:events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(t)},t.prototype.updateDisplayedColumnsFromTrees=function(t){this.addToDisplayedColumns(this.displayedLeftColumnTree,this.displayedLeftColumns),this.addToDisplayedColumns(this.displayedCentreColumnTree,this.displayedCenterColumns),this.addToDisplayedColumns(this.displayedRightColumnTree,this.displayedRightColumns),this.setupAllDisplayedColumns(),this.setLeftValues(t)},t.prototype.setupAllDisplayedColumns=function(){this.gridOptionsWrapper.isEnableRtl()?this.allDisplayedColumns=this.displayedRightColumns.concat(this.displayedCenterColumns).concat(this.displayedLeftColumns):this.allDisplayedColumns=this.displayedLeftColumns.concat(this.displayedCenterColumns).concat(this.displayedRightColumns)},t.prototype.setLeftValues=function(t){this.setLeftValuesOfColumns(t),this.setLeftValuesOfGroups()},t.prototype.setLeftValuesOfColumns=function(o){var n=this,s=this.primaryColumns.slice(0),r=this.gridOptionsWrapper.isEnableRtl();[this.displayedLeftColumns,this.displayedRightColumns,this.displayedCenterColumns].forEach(function(t){var e,i;r?(e=n.getWidthOfColsInList(t),t.forEach(function(t){e-=t.getActualWidth(),t.setLeft(e,o)})):(i=0,t.forEach(function(t){t.setLeft(i,o),i+=t.getActualWidth()})),utils_1._.removeAllFromArray(s,t)}),s.forEach(function(t){t.setLeft(null,o)})},t.prototype.setLeftValuesOfGroups=function(){[this.displayedLeftColumnTree,this.displayedRightColumnTree,this.displayedCentreColumnTree].forEach(function(t){t.forEach(function(t){t instanceof columnGroup_1.ColumnGroup&&t.checkLeft()})})},t.prototype.addToDisplayedColumns=function(t,e){e.length=0,this.columnUtils.depthFirstDisplayedColumnTreeSearch(t,function(t){t instanceof column_1.Column&&e.push(t)})},t.prototype.updateDisplayedCenterVirtualColumns=function(){this.suppressColumnVirtualisation?this.allDisplayedCenterVirtualColumns=this.displayedCenterColumns:this.allDisplayedCenterVirtualColumns=this.filterOutColumnsWithinViewport(),this.allDisplayedVirtualColumns=this.allDisplayedCenterVirtualColumns.concat(this.displayedLeftColumns).concat(this.displayedRightColumns);var e={};return this.allDisplayedVirtualColumns.forEach(function(t){e[t.getId()]=!0}),e},t.prototype.getVirtualHeaderGroupRow=function(t,e){var i;switch(t){case column_1.Column.PINNED_LEFT:i=this.displayedLeftHeaderRows[e];break;case column_1.Column.PINNED_RIGHT:i=this.displayedRightHeaderRows[e];break;default:i=this.displayedCentreHeaderRows[e]}return utils_1._.missing(i)&&(i=[]),i},t.prototype.updateDisplayedVirtualGroups=function(r){function u(t,e,i){for(var o=!1,n=0;n<t.length;n++){var s=t[n];(s instanceof column_1.Column?!0===r[s.getId()]:u(s.getDisplayedChildren(),e,i+1))&&(o=!0,e[i]||(e[i]=[]),e[i].push(s))}return o}this.displayedLeftHeaderRows={},this.displayedRightHeaderRows={},this.displayedCentreHeaderRows={},u(this.displayedLeftColumnTree,this.displayedLeftHeaderRows,0),u(this.displayedRightColumnTree,this.displayedRightHeaderRows,0),u(this.displayedCentreColumnTree,this.displayedCentreHeaderRows,0)},t.prototype.updateVirtualSets=function(){var t=this.updateDisplayedCenterVirtualColumns();this.updateDisplayedVirtualGroups(t)},t.prototype.filterOutColumnsWithinViewport=function(){return utils_1._.filter(this.displayedCenterColumns,this.isColumnInViewport.bind(this))},t.prototype.sizeColumnsToFit=function(t,e){var i=this;void 0===e&&(e="api");var o=this.getAllDisplayedColumns();if(!(t<=0||0===o.length)){for(var n=utils_1._.filter(o,function(t){return!0===t.getColDef().suppressSizeToFit}),s=utils_1._.filter(o,function(t){return!0!==t.getColDef().suppressSizeToFit}),o=s.slice(0),r=!1;!r;){r=!0;var u=t-this.getWidthOfColsInList(n);if(u<=0)s.forEach(function(t){t.setMinimum(e)});else for(var l=u/this.getWidthOfColsInList(s),a=u,p=s.length-1;0<=p;p--){var d=s[p],h=Math.round(d.getActualWidth()*l);h<d.getMinWidth()?(d.setMinimum(e),c(d),r=!1):d.isGreaterThanMax(h)?(d.setActualWidth(d.getMaxWidth(),e),c(d),r=!1):0===p?d.setActualWidth(a,e):d.setActualWidth(h,e),a-=h}}this.setLeftValues(e),this.updateBodyWidths(),o.forEach(function(t){t={type:events_1.Events.EVENT_COLUMN_RESIZED,column:t,columns:[t],finished:!0,api:i.gridApi,columnApi:i.columnApi,source:"sizeColumnsToFit"};i.eventService.dispatchEvent(t)})}function c(t){utils_1._.removeFromArray(s,t),n.push(t)}},t.prototype.buildDisplayedTrees=function(t){var e=utils_1._.filter(t,function(t){return"left"===t.getPinned()}),i=utils_1._.filter(t,function(t){return"right"===t.getPinned()}),o=utils_1._.filter(t,function(t){return"left"!==t.getPinned()&&"right"!==t.getPinned()}),t=new groupInstanceIdCreator_1.GroupInstanceIdCreator;this.displayedLeftColumnTree=this.displayedGroupCreator.createDisplayedGroups(e,this.gridBalancedTree,t,column_1.Column.PINNED_LEFT,this.displayedLeftColumnTree),this.displayedRightColumnTree=this.displayedGroupCreator.createDisplayedGroups(i,this.gridBalancedTree,t,column_1.Column.PINNED_RIGHT,this.displayedRightColumnTree),this.displayedCentreColumnTree=this.displayedGroupCreator.createDisplayedGroups(o,this.gridBalancedTree,t,null,this.displayedCentreColumnTree)},t.prototype.updateOpenClosedVisibilityInColumnGroups=function(){var t=this.getAllDisplayedColumnGroups();this.columnUtils.depthFirstAllColumnTreeSearch(t,function(t){t instanceof columnGroup_1.ColumnGroup&&t.calculateDisplayedColumns()})},t.prototype.getGroupAutoColumns=function(){return this.groupAutoColumns},t.prototype.createGroupAutoColumnsIfNeeded=function(){var t,e,i;this.autoGroupsNeedBuilding&&(this.autoGroupsNeedBuilding=!1,t=this.gridOptionsWrapper.isGroupUseEntireRow(this.pivotMode),e=this.gridOptionsWrapper.isGroupSuppressAutoColumn()&&!this.pivotMode,i=this.gridOptionsWrapper.isGroupSuppressRow(),(0<this.rowGroupColumns.length||this.usingTreeData)&&!e&&!t&&!i?(i=this.autoGroupColService.createAutoGroupColumns(this.rowGroupColumns),this.autoColsEqual(i,this.groupAutoColumns)||(this.groupAutoColumns=i)):this.groupAutoColumns=null)},t.prototype.autoColsEqual=function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++){var o=t[i],n=e[i];if(o.getColId()!==n.getColId())return!1}return!0},t.prototype.getWidthOfColsInList=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i].getActualWidth();return e},t.prototype.getGridBalancedTree=function(){return this.gridBalancedTree},__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("expressionService"),__metadata("design:type",expressionService_1.ExpressionService)],t.prototype,"expressionService",void 0),__decorate([context_1.Autowired("columnFactory"),__metadata("design:type",columnFactory_1.ColumnFactory)],t.prototype,"columnFactory",void 0),__decorate([context_1.Autowired("displayedGroupCreator"),__metadata("design:type",displayedGroupCreator_1.DisplayedGroupCreator)],t.prototype,"displayedGroupCreator",void 0),__decorate([context_1.Autowired("autoWidthCalculator"),__metadata("design:type",autoWidthCalculator_1.AutoWidthCalculator)],t.prototype,"autoWidthCalculator",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],t.prototype,"eventService",void 0),__decorate([context_1.Autowired("columnUtils"),__metadata("design:type",columnUtils_1.ColumnUtils)],t.prototype,"columnUtils",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_1.Context)],t.prototype,"context",void 0),__decorate([context_1.Autowired("columnAnimationService"),__metadata("design:type",columnAnimationService_1.ColumnAnimationService)],t.prototype,"columnAnimationService",void 0),__decorate([context_1.Autowired("autoGroupColService"),__metadata("design:type",autoGroupColService_1.AutoGroupColService)],t.prototype,"autoGroupColService",void 0),__decorate([context_1.Optional("aggFuncService"),__metadata("design:type",Object)],t.prototype,"aggFuncService",void 0),__decorate([context_1.Optional("valueCache"),__metadata("design:type",valueCache_1.ValueCache)],t.prototype,"valueCache",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],t.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],t.prototype,"gridApi",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"init",null),__decorate([__param(0,context_1.Qualifier("loggerFactory")),__metadata("design:type",Function),__metadata("design:paramtypes",[logger_1.LoggerFactory]),__metadata("design:returntype",void 0)],t.prototype,"setBeans",null),__decorate([context_1.Bean("columnController")],t)}();exports.ColumnController=ColumnController;