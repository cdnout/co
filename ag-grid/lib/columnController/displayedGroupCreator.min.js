"use strict";var __decorate=this&&this.__decorate||function(t,e,o,n){var r,u=arguments.length,i=u<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;0<=l;l--)(r=t[l])&&(i=(u<3?r(i):3<u?r(e,o,i):r(e,o))||i);return 3<u&&i&&Object.defineProperty(e,o,i),i},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../context/context"),columnUtils_1=require("./columnUtils"),columnGroup_1=require("../entities/columnGroup"),originalColumnGroup_1=require("../entities/originalColumnGroup"),context_2=require("../context/context"),utils_1=require("../utils"),DisplayedGroupCreator=function(){function t(){}return t.prototype.createDisplayedGroups=function(t,i,l,a,e){var c,p,s=this,d=[],f=this.mapOldGroupsById(e);return t.forEach(function(t){for(var e,o=s.getOriginalPathForColumn(i,t),n=[],r=!p,u=0;u<o.length;u++)r||o[u]!==p[u]?(e=s.createColumnGroup(o[u],l,f,a),n[u]=e,0==u?d.push(e):n[u-1].addChild(e)):n[u]=c[u];0===n.length?d.push(t):utils_1._.last(n).addChild(t),c=n,p=o}),this.setupParentsIntoColumns(d,null),d},t.prototype.createColumnGroup=function(t,e,o,n){var r=t.getGroupId(),e=e.getInstanceIdForKey(r),o=o[columnGroup_1.ColumnGroup.createUniqueId(r,e)];return o&&o.getOriginalColumnGroup()!==t&&(o=null),utils_1._.exists(o)?o.reset():(o=new columnGroup_1.ColumnGroup(t,r,e,n),this.context.wireBean(o)),o},t.prototype.mapOldGroupsById=function(t){var e={},o=function(t){t.forEach(function(t){t instanceof columnGroup_1.ColumnGroup&&(e[(t=t).getUniqueId()]=t,o(t.getChildren()))})};return t&&o(t),e},t.prototype.setupParentsIntoColumns=function(t,e){var o=this;t.forEach(function(t){t.setParent(e),t instanceof columnGroup_1.ColumnGroup&&(t=t,o.setupParentsIntoColumns(t.getChildren(),t))})},t.prototype.getOriginalPathForColumn=function(t,u){var i=[],l=!1;return function t(e,o){for(var n=0;n<e.length;n++){if(l)return;var r=e[n];r instanceof originalColumnGroup_1.OriginalColumnGroup?(t(r.getChildren(),o+1),i[o]=r):r===u&&(l=!0)}}(t,0),l?i:(console.warn("could not get path"),null)},__decorate([context_1.Autowired("columnUtils"),__metadata("design:type",columnUtils_1.ColumnUtils)],t.prototype,"columnUtils",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_2.Context)],t.prototype,"context",void 0),__decorate([context_2.Bean("displayedGroupCreator")],t)}();exports.DisplayedGroupCreator=DisplayedGroupCreator;