"use strict";var __decorate=this&&this.__decorate||function(e,t,o,n){var r,p=arguments.length,i=p<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(i=(p<3?r(i):3<p?r(t,o,i):r(t,o))||i);return 3<p&&i&&Object.defineProperty(t,o,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var ComponentType,ComponentSource,context_1=require("../../context/context"),gridOptionsWrapper_1=require("../../gridOptionsWrapper"),componentProvider_1=require("./componentProvider"),agComponentUtils_1=require("./agComponentUtils"),componentMetadataProvider_1=require("./componentMetadataProvider"),utils_1=require("../../utils");!function(e){e[e.AG_GRID=0]="AG_GRID",e[e.FRAMEWORK=1]="FRAMEWORK"}(ComponentType=exports.ComponentType||(exports.ComponentType={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.REGISTERED_BY_NAME=1]="REGISTERED_BY_NAME",e[e.HARDCODED=2]="HARDCODED"}(ComponentSource=exports.ComponentSource||(exports.ComponentSource={}));var ComponentResolver=function(){function e(){}return e.prototype.getComponentToUse=function(e,t,o,n){var r=null,p=null,i=null,a=null;if(null!=e&&(null==(m=e[t])||!0===m||("string"==typeof m?r=m:"boolean"==typeof m||(this.agComponentUtils.doesImplementIComponent(m)?p=m:i=m)),a=e[t+"Framework"],m=e[t+"Selector"]),p&&a||r&&a||i&&a)throw Error("ag-grid: you are trying to specify: "+t+" twice as a component.");if(a&&!this.frameworkComponentWrapper)throw Error("ag-grid: you are specifying a framework component but you are not using a framework version of ag-grid for : "+t);if(m&&(r||p||i||a))throw Error("ag-grid: you can't specify both, the selector and the component of ag-grid for : "+t);if(a)return{type:ComponentType.FRAMEWORK,component:a,source:ComponentSource.HARDCODED,dynamicParams:null};if(p)return{type:ComponentType.AG_GRID,component:p,source:ComponentSource.HARDCODED,dynamicParams:null};if(i)return this.agComponentUtils.adaptFunction(t,i,ComponentType.AG_GRID,ComponentSource.HARDCODED);if(m){var m=m(o);if(null!=m){null==m.component&&(m.component=n);o=this.resolveByName(t,m.component);return utils_1._.assign(o,{dynamicParams:m.params})}}return null==(n=r||n)?null:this.resolveByName(t,n)},e.prototype.resolveByName=function(e,t){t=null!=t?t:e,t=this.componentProvider.retrieve(t);return null==t?null:t.type==ComponentType.FRAMEWORK?{component:t.component,type:ComponentType.FRAMEWORK,source:ComponentSource.REGISTERED_BY_NAME,dynamicParams:null}:this.agComponentUtils.doesImplementIComponent(t.component)?{component:t.component,type:ComponentType.AG_GRID,source:t.source==componentProvider_1.RegisteredComponentSource.REGISTERED?ComponentSource.REGISTERED_BY_NAME:ComponentSource.DEFAULT,dynamicParams:null}:this.agComponentUtils.adaptFunction(e,t.component,t.type,t.source==componentProvider_1.RegisteredComponentSource.REGISTERED?ComponentSource.REGISTERED_BY_NAME:ComponentSource.DEFAULT)},e.prototype.mergeParams=function(e,t,o,n,r){void 0===r&&(r=null);e=e?e[t+"Params"]:null,t={};return utils_1._.mergeDeep(t,o),null!=e&&(o=utils_1._.cloneObject(t),o="function"==typeof e?(utils_1._.mergeDeep(o,n),e(o)):e,utils_1._.mergeDeep(t,o)),utils_1._.mergeDeep(t,r),t.api||(t.api=this.gridOptions.api),t},e.prototype.createAgGridComponent=function(e,t,o,n,r,p,i){void 0===p&&(p=!0);var e=e||this.gridOptions,a=this.newAgGridComponent(e,o,n,r,p);if(!a)return null;n=this.mergeParams(e,o,t,n,a[1]);n.agGridReact=this.context.getBean("agGridReact")?utils_1._.cloneObject(this.context.getBean("agGridReact")):{},n.frameworkComponentWrapper=this.context.getBean("frameworkComponentWrapper")?this.context.getBean("frameworkComponentWrapper"):{};i=this.initialiseComponent(a[0],n,i);return null==i?utils_1.Promise.resolve(a[0]):i.map(function(e){return a[0]})},e.prototype.createInternalAgGridComponent=function(e,t,o){e=new e;return this.initialiseComponent(e,t,o),e},e.prototype.newAgGridComponent=function(e,t,o,n,r){void 0===r&&(r=!0);o=this.getComponentToUse(e,t,o,n);if(!o||!o.component)return r&&console.error("Error creating component "+t+"=>"+n),null;if(o.type===ComponentType.AG_GRID)return[new o.component,o.dynamicParams];r=o.component,t=this.componentMetadataProvider.retrieve(t);return[this.frameworkComponentWrapper.wrap(r,t.mandatoryMethodList,t.optionalMethodList,n),o.dynamicParams]},e.prototype.initialiseComponent=function(e,t,o){if(this.context.wireBean(e),null!=e.init)return null==o?e.init(t):e.init(o(t,e))},__decorate([context_1.Autowired("gridOptions"),__metadata("design:type",Object)],e.prototype,"gridOptions",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("context"),__metadata("design:type",context_1.Context)],e.prototype,"context",void 0),__decorate([context_1.Autowired("agComponentUtils"),__metadata("design:type",agComponentUtils_1.AgComponentUtils)],e.prototype,"agComponentUtils",void 0),__decorate([context_1.Autowired("componentMetadataProvider"),__metadata("design:type",componentMetadataProvider_1.ComponentMetadataProvider)],e.prototype,"componentMetadataProvider",void 0),__decorate([context_1.Autowired("componentProvider"),__metadata("design:type",componentProvider_1.ComponentProvider)],e.prototype,"componentProvider",void 0),__decorate([context_1.Optional("frameworkComponentWrapper"),__metadata("design:type",Object)],e.prototype,"frameworkComponentWrapper",void 0),__decorate([context_1.Bean("componentResolver")],e)}();exports.ComponentResolver=ComponentResolver;