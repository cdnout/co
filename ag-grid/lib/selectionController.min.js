"use strict";var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var d=e.length-1;0<=d;d--)(r=e[d])&&(s=(n<3?r(s):3<n?r(t,o,s):r(t,o))||s);return 3<n&&s&&Object.defineProperty(t,o,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(o,i){return function(e,t){i(e,t,o)}};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("./context/context"),context_2=require("./context/context"),logger_1=require("./logger"),eventService_1=require("./eventService"),events_1=require("./events"),context_3=require("./context/context"),gridOptionsWrapper_1=require("./gridOptionsWrapper"),context_4=require("./context/context"),constants_1=require("./constants"),columnApi_1=require("./columnController/columnApi"),gridApi_1=require("./gridApi"),utils_1=require("./utils"),changedPath_1=require("./rowModels/clientSide/changedPath"),SelectionController=function(){function e(){}return e.prototype.setBeans=function(e){this.logger=e.create("SelectionController"),this.reset(),this.gridOptionsWrapper.isRowModelDefault()?this.eventService.addEventListener(events_1.Events.EVENT_ROW_DATA_CHANGED,this.reset.bind(this)):this.logger.log("dont know what to do here")},e.prototype.init=function(){this.groupSelectsChildren=this.gridOptionsWrapper.isGroupSelectsChildren(),this.eventService.addEventListener(events_1.Events.EVENT_ROW_SELECTED,this.onRowSelected.bind(this))},e.prototype.setLastSelectedNode=function(e){this.lastSelectedNode=e},e.prototype.getLastSelectedNode=function(){return this.lastSelectedNode},e.prototype.getSelectedNodes=function(){var o=[];return utils_1._.iterateObject(this.selectedNodes,function(e,t){t&&o.push(t)}),o},e.prototype.getSelectedRows=function(){var o=[];return utils_1._.iterateObject(this.selectedNodes,function(e,t){t&&t.data&&o.push(t.data)}),o},e.prototype.removeGroupsFromSelection=function(){var o=this;utils_1._.iterateObject(this.selectedNodes,function(e,t){t&&t.group&&(o.selectedNodes[t.id]=void 0)})},e.prototype.updateGroupsFromChildrenSelections=function(e){var t;this.gridOptionsWrapper.isGroupSelectsChildren()&&this.rowModel.getType()===constants_1.Constants.ROW_MODEL_TYPE_CLIENT_SIDE&&(t=this.rowModel.getRootNode(),e||(e=new changedPath_1.ChangedPath(!0,t)).setInactive(),e.forEachChangedNodeDepthFirst(function(e){e!==t&&e.calculateSelectedFromChildren()}))},e.prototype.getNodeForIdIfSelected=function(e){return this.selectedNodes[e]},e.prototype.clearOtherNodes=function(i){var r=this,n={},s=0;return utils_1._.iterateObject(this.selectedNodes,function(e,t){var o;t&&t.id!==i.id&&(o=r.selectedNodes[t.id],s+=o.setSelectedParams({newValue:!1,clearSelection:!1,suppressFinishActions:!0}),r.groupSelectsChildren&&t.parent&&(n[t.parent.id]=t.parent))}),utils_1._.iterateObject(n,function(e,t){t.calculateSelectedFromChildren()}),s},e.prototype.onRowSelected=function(e){e=e.node;this.groupSelectsChildren&&e.group||(e.isSelected()?this.selectedNodes[e.id]=e:this.selectedNodes[e.id]=void 0)},e.prototype.syncInRowNode=function(e,t){this.syncInOldRowNode(e,t),this.syncInNewRowNode(e)},e.prototype.syncInOldRowNode=function(e,t){utils_1._.exists(t)&&e.id!==t.id&&utils_1._.exists(this.selectedNodes[t.id])&&(this.selectedNodes[t.id]=t)},e.prototype.syncInNewRowNode=function(e){utils_1._.exists(this.selectedNodes[e.id])?(e.setSelectedInitialValue(!0),this.selectedNodes[e.id]=e):e.setSelectedInitialValue(!1)},e.prototype.reset=function(){this.logger.log("reset"),this.selectedNodes={},this.lastSelectedNode=null},e.prototype.getBestCostNodeSelection=function(){this.rowModel.getType()!==constants_1.Constants.ROW_MODEL_TYPE_CLIENT_SIDE&&console.warn("getBestCostNodeSelection is only available when using normal row model");var e=this.rowModel.getTopLevelNodes();if(null!==e){var n=[];return function e(t){for(var o=0,i=t.length;o<i;o++){var r=t[o];r.isSelected()?n.push(r):r.group&&r.children&&e(r.children)}}(e),n}console.warn("selectAll not available doing rowModel=virtual")},e.prototype.setRowModel=function(e){this.rowModel=e},e.prototype.isEmpty=function(){var o=0;return utils_1._.iterateObject(this.selectedNodes,function(e,t){t&&o++}),0===o},e.prototype.deselectAllRowNodes=function(e){void 0===e&&(e=!1);function o(e){return e.selectThisNode(!1)}var t=this.rowModel.getType()===constants_1.Constants.ROW_MODEL_TYPE_CLIENT_SIDE;if(e){if(!t)return void console.error("ag-Grid: selecting just filtered only works with In Memory Row Model");this.rowModel.forEachNodeAfterFilter(o)}else utils_1._.iterateObject(this.selectedNodes,function(e,t){t&&o(t)}),this.reset();t&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections();t={type:events_1.Events.EVENT_SELECTION_CHANGED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(t)},e.prototype.selectAllRowNodes=function(e){if(void 0===e&&(e=!1),this.rowModel.getType()!==constants_1.Constants.ROW_MODEL_TYPE_CLIENT_SIDE)throw new Error("selectAll only available with normal row model, ie not "+this.rowModel.getType());var t=this.rowModel,o=function(e){return e.selectThisNode(!0)};e?t.forEachNodeAfterFilter(o):t.forEachNode(o),this.rowModel.getType()===constants_1.Constants.ROW_MODEL_TYPE_CLIENT_SIDE&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections();o={type:events_1.Events.EVENT_SELECTION_CHANGED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(o)},e.prototype.selectNode=function(e,t){e&&e.setSelectedParams({newValue:!0,clearSelection:!t})},e.prototype.deselectIndex=function(e){e=this.rowModel.getRow(e);this.deselectNode(e)},e.prototype.deselectNode=function(e){e&&e.setSelectedParams({newValue:!1,clearSelection:!1})},e.prototype.selectIndex=function(e,t){e=this.rowModel.getRow(e);this.selectNode(e,t)},__decorate([context_3.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],e.prototype,"eventService",void 0),__decorate([context_3.Autowired("rowModel"),__metadata("design:type",Object)],e.prototype,"rowModel",void 0),__decorate([context_3.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_3.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],e.prototype,"columnApi",void 0),__decorate([context_3.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],e.prototype,"gridApi",void 0),__decorate([__param(0,context_2.Qualifier("loggerFactory")),__metadata("design:type",Function),__metadata("design:paramtypes",[logger_1.LoggerFactory]),__metadata("design:returntype",void 0)],e.prototype,"setBeans",null),__decorate([context_4.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"init",null),__decorate([context_1.Bean("selectionController")],e)}();exports.SelectionController=SelectionController;