"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__decorate=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(r<3?n(s):3<r?n(e,o,s):n(e,o))||s);return 3<r&&s&&Object.defineProperty(e,o,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var beanStub_1=require("../context/beanStub"),eventService_1=require("../eventService"),events_1=require("../events"),context_1=require("../context/context"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),selectionController_1=require("../selectionController"),columnApi_1=require("../columnController/columnApi"),gridApi_1=require("../gridApi"),utils_1=require("../utils"),PaginationProxy=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentPage=0,t.topDisplayedRowIndex=0,t.bottomDisplayedRowIndex=0,t.pixelOffset=0,t.masterRowCount=0,t}return __extends(t,e),t.prototype.postConstruct=function(){this.active=this.gridOptionsWrapper.isPagination(),this.paginateChildRows=this.gridOptionsWrapper.isPaginateChildRows(),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_MODEL_UPDATED,this.onModelUpdated.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,"paginationPageSize",this.onModelUpdated.bind(this)),this.onModelUpdated()},t.prototype.ensureRowHeightsValid=function(t,e,o,i){e=this.rowModel.ensureRowHeightsValid(t,e,this.getPageFirstRow(),this.getPageLastRow());return e&&this.calculatePages(),e},t.prototype.onModelUpdated=function(t){this.calculatePages();t={type:events_1.Events.EVENT_PAGINATION_CHANGED,animate:!!t&&t.animate,newData:!!t&&t.newData,newPage:!!t&&t.newPage,keepRenderedRows:!!t&&t.keepRenderedRows,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(t)},t.prototype.goToPage=function(t){this.active&&this.currentPage!==t&&(this.currentPage=t,t={type:events_1.Events.EVENT_MODEL_UPDATED,animate:!1,keepRenderedRows:!1,newData:!1,newPage:!0,api:this.gridApi,columnApi:this.columnApi},this.onModelUpdated(t))},t.prototype.getPixelOffset=function(){return this.pixelOffset},t.prototype.getRow=function(t){return this.rowModel.getRow(t)},t.prototype.getRowNode=function(t){return this.rowModel.getRowNode(t)},t.prototype.getRowIndexAtPixel=function(t){return this.rowModel.getRowIndexAtPixel(t)},t.prototype.getCurrentPageHeight=function(){return utils_1._.missing(this.topRowBounds)||utils_1._.missing(this.bottomRowBounds)?0:Math.max(this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight-this.topRowBounds.rowTop,0)},t.prototype.isRowPresent=function(t){return!!this.rowModel.isRowPresent(t)&&(t.rowIndex>=this.topDisplayedRowIndex&&t.rowIndex<=this.bottomDisplayedRowIndex)},t.prototype.isEmpty=function(){return this.rowModel.isEmpty()},t.prototype.isRowsToRender=function(){return this.rowModel.isRowsToRender()},t.prototype.getNodesInRangeForSelection=function(t,e){return this.rowModel.getNodesInRangeForSelection(t,e)},t.prototype.forEachNode=function(t){return this.rowModel.forEachNode(t)},t.prototype.getType=function(){return this.rowModel.getType()},t.prototype.getRowBounds=function(t){var e=this.rowModel.getRowBounds(t);return e.rowIndex=t,e},t.prototype.getPageFirstRow=function(){return this.topRowBounds?this.topRowBounds.rowIndex:-1},t.prototype.getPageLastRow=function(){return this.bottomRowBounds?this.bottomRowBounds.rowIndex:-1},t.prototype.getRowCount=function(){return this.rowModel.getRowCount()},t.prototype.goToPageWithIndex=function(t){this.active&&(t=Math.floor(t/this.pageSize),this.goToPage(t))},t.prototype.isLastPageFound=function(){return this.rowModel.isLastRowFound()},t.prototype.getCurrentPage=function(){return this.currentPage},t.prototype.goToNextPage=function(){this.goToPage(this.currentPage+1)},t.prototype.goToPreviousPage=function(){this.goToPage(this.currentPage-1)},t.prototype.goToFirstPage=function(){this.goToPage(0)},t.prototype.goToLastPage=function(){var t=this.rowModel.getRowCount(),t=Math.floor(t/this.pageSize);this.goToPage(t)},t.prototype.getPageSize=function(){return this.pageSize},t.prototype.getTotalPages=function(){return this.totalPages},t.prototype.setPageSize=function(){this.pageSize=this.gridOptionsWrapper.getPaginationPageSize(),1<=this.pageSize||(this.pageSize=100)},t.prototype.calculatePages=function(){this.active?(this.setPageSize(),this.paginateChildRows?this.calculatePagesAllRows():this.calculatePagesMasterRowsOnly()):this.calculatedPagesNotActive(),this.topRowBounds=this.rowModel.getRowBounds(this.topDisplayedRowIndex),this.topRowBounds&&(this.topRowBounds.rowIndex=this.topDisplayedRowIndex),this.bottomRowBounds=this.rowModel.getRowBounds(this.bottomDisplayedRowIndex),this.bottomRowBounds&&(this.bottomRowBounds.rowIndex=this.bottomDisplayedRowIndex),this.pixelOffset=utils_1._.exists(this.topRowBounds)?this.topRowBounds.rowTop:0},t.prototype.setZeroRows=function(){this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=-1,this.currentPage=0,this.totalPages=0},t.prototype.calculatePagesMasterRowsOnly=function(){var t,e,o;this.masterRowCount=this.rowModel.getTopLevelRowCount(),0!==this.masterRowCount?(t=this.masterRowCount-1,this.totalPages=Math.floor(t/this.pageSize)+1,this.currentPage>=this.totalPages&&(this.currentPage=this.totalPages-1),(!utils_1._.isNumeric(this.currentPage)||this.currentPage<0)&&(this.currentPage=0),e=this.pageSize*this.currentPage,t<(o=this.pageSize*(this.currentPage+1)-1)&&(o=t),this.topDisplayedRowIndex=this.rowModel.getTopLevelRowDisplayedIndex(e),o===t?this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1:(o=this.rowModel.getTopLevelRowDisplayedIndex(o+1),this.bottomDisplayedRowIndex=o-1)):this.setZeroRows()},t.prototype.getMasterRowCount=function(){return this.masterRowCount},t.prototype.calculatePagesAllRows=function(){var t;this.masterRowCount=this.rowModel.getRowCount(),0!==this.masterRowCount?(t=this.masterRowCount-1,this.totalPages=Math.floor(t/this.pageSize)+1,this.currentPage>=this.totalPages&&(this.currentPage=this.totalPages-1),(!utils_1._.isNumeric(this.currentPage)||this.currentPage<0)&&(this.currentPage=0),this.topDisplayedRowIndex=this.pageSize*this.currentPage,this.bottomDisplayedRowIndex=this.pageSize*(this.currentPage+1)-1,this.bottomDisplayedRowIndex>t&&(this.bottomDisplayedRowIndex=t)):this.setZeroRows()},t.prototype.calculatedPagesNotActive=function(){this.pageSize=this.rowModel.getRowCount(),this.totalPages=1,this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1},__decorate([context_1.Autowired("rowModel"),__metadata("design:type",Object)],t.prototype,"rowModel",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],t.prototype,"eventService",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("selectionController"),__metadata("design:type",selectionController_1.SelectionController)],t.prototype,"selectionController",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],t.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],t.prototype,"gridApi",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"postConstruct",null),__decorate([context_1.Bean("paginationProxy")],t)}(beanStub_1.BeanStub);exports.PaginationProxy=PaginationProxy;