"use strict";var __extends=this&&this.__extends||function(){var r=function(t,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(t,o)};return function(t,o){function e(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("../../utils"),rowNode_1=require("../../entities/rowNode"),beanStub_1=require("../../context/beanStub"),RowNodeBlock=function(r){function n(t,o){var e=r.call(this)||this;return e.version=0,e.state=n.STATE_DIRTY,e.rowNodeCacheParams=o,e.blockNumber=t,e.startRow=t*o.blockSize,e.endRow=e.startRow+o.blockSize,e}return __extends(n,r),n.prototype.isAnyNodeOpen=function(t){var o=!1;return this.forEachNodeCallback(function(t){t.expanded&&(o=!0)},t),o},n.prototype.forEachNodeCallback=function(t,o){for(var e=this.startRow;e<this.endRow;e++)e<o&&t(this.getRowUsingLocalIndex(e),e)},n.prototype.forEachNode=function(o,e,t,r){this.forEachNodeCallback(function(t){o(t,e.next()),r&&t.childrenCache&&t.childrenCache.forEachNodeDeep(o,e)},t)},n.prototype.forEachNodeDeep=function(t,o,e){this.forEachNode(t,o,e,!0)},n.prototype.forEachNodeShallow=function(t,o,e){this.forEachNode(t,o,e,!1)},n.prototype.getVersion=function(){return this.version},n.prototype.getLastAccessed=function(){return this.lastAccessed},n.prototype.getRowUsingLocalIndex=function(t,o){void 0===o&&(o=!1),o||(this.lastAccessed=this.rowNodeCacheParams.lastAccessedSequence.next());t-=this.startRow;return this.rowNodes[t]},n.prototype.init=function(t){this.beans=t,this.createRowNodes()},n.prototype.getStartRow=function(){return this.startRow},n.prototype.getEndRow=function(){return this.endRow},n.prototype.getBlockNumber=function(){return this.blockNumber},n.prototype.setDirty=function(){this.version++,this.state=n.STATE_DIRTY},n.prototype.setDirtyAndPurge=function(){this.setDirty(),this.rowNodes.forEach(function(t){t.setData(null)})},n.prototype.getState=function(){return this.state},n.prototype.setRowNode=function(t,o){t-=this.startRow;this.rowNodes[t]=o},n.prototype.setBlankRowNode=function(t){var o=t-this.startRow,t=this.createBlankRowNode(t);return this.rowNodes[o]=t},n.prototype.setNewData=function(t,o){var e=this.setBlankRowNode(t);return this.setDataAndId(e,o,this.startRow+t),e},n.prototype.createBlankRowNode=function(t){var o=new rowNode_1.RowNode;return this.beans.context.wireBean(o),o.setRowHeight(this.rowNodeCacheParams.rowHeight),o},n.prototype.createRowNodes=function(){this.rowNodes=[];for(var t=0;t<this.rowNodeCacheParams.blockSize;t++){var o=this.startRow+t,o=this.createBlankRowNode(o);this.rowNodes.push(o)}},n.prototype.load=function(){this.state=n.STATE_LOADING,this.loadFromDatasource()},n.prototype.pageLoadFailed=function(){this.state=n.STATE_FAILED;var t={type:n.EVENT_LOAD_COMPLETE,success:!1,page:this,lastRow:null};this.dispatchEvent(t)},n.prototype.populateWithRowData=function(r){var n=this,s=[];this.rowNodes.forEach(function(t,o){var e=r[o];t.stub&&s.push(t),n.setDataAndId(t,e,n.startRow+o)}),0<s.length&&this.beans.rowRenderer.redrawRows(s)},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.rowNodes.forEach(function(t){t.childrenCache&&(t.childrenCache.destroy(),t.childrenCache=null),t.clearRowTop()})},n.prototype.pageLoaded=function(t,o,e){t===this.version&&(this.state=n.STATE_LOADED,this.populateWithRowData(o)),e=utils_1._.cleanNumber(e);e={type:n.EVENT_LOAD_COMPLETE,success:!0,page:this,lastRow:e};this.dispatchEvent(e)},n.EVENT_LOAD_COMPLETE="loadComplete",n.STATE_DIRTY="dirty",n.STATE_LOADING="loading",n.STATE_LOADED="loaded",n.STATE_FAILED="failed",n}(beanStub_1.BeanStub);exports.RowNodeBlock=RowNodeBlock;