"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__decorate=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,r);else for(var c=t.length-1;0<=c;c--)(n=t[c])&&(a=(i<3?n(a):3<i?n(e,o,a):n(e,o))||a);return 3<i&&a&&Object.defineProperty(e,o,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__param=this&&this.__param||function(o,r){return function(t,e){r(t,e,o)}};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../../context/context"),eventService_1=require("../../eventService"),events_1=require("../../events"),logger_1=require("../../logger"),infiniteBlock_1=require("./infiniteBlock"),rowNodeCache_1=require("../cache/rowNodeCache"),gridApi_1=require("../../gridApi"),columnApi_1=require("../../columnController/columnApi"),InfiniteCache=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.setBeans=function(t){this.logger=t.create("InfiniteCache")},t.prototype.init=function(){e.prototype.init.call(this),this.getRow(0)},t.prototype.moveItemsDown=function(t,e,o){for(var r,n=t.getStartRow(),i=e+o,a=t.getEndRow()-1;n<=a;a--)a<i||(r=a-o,(r=this.getRow(r,!0))?t.setRowNode(a,r):(t.setBlankRowNode(a),t.setDirty()))},t.prototype.insertItems=function(t,e,o){for(var r=t.getStartRow(),n=t.getEndRow(),i=[],a=0;a<o.length;a++){var c,s=e+a;r<=s&&s<n&&(c=o[a],c=t.setNewData(s,c),i.push(c))}return i},t.prototype.insertItemsAtIndex=function(e,o){var r=this,n=[];this.forEachBlockInReverseOrder(function(t){t.getEndRow()<=e||(r.moveItemsDown(t,e,o.length),r.insertItems(t,e,o).forEach(function(t){return n.push(t)}))}),this.isMaxRowFound()&&this.hack_setVirtualRowCount(this.getVirtualRowCount()+o.length),this.onCacheUpdated();var t={type:events_1.Events.EVENT_ROW_DATA_UPDATED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(t)},t.prototype.getRow=function(t,e){void 0===e&&(e=!1);var o=Math.floor(t/this.cacheParams.blockSize),r=this.getBlock(o);if(!r){if(e)return null;r=this.createBlock(o)}return r.getRow(t)},t.prototype.createBlock=function(t){t=new infiniteBlock_1.InfiniteBlock(t,this.cacheParams);return this.getContext().wireBean(t),this.postCreateBlock(t),t},t.prototype.refreshCache=function(){this.forEachBlockInOrder(function(t){return t.setDirty()}),this.checkBlockToLoad()},__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],t.prototype,"eventService",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],t.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],t.prototype,"gridApi",void 0),__decorate([__param(0,context_1.Qualifier("loggerFactory")),__metadata("design:type",Function),__metadata("design:paramtypes",[logger_1.LoggerFactory]),__metadata("design:returntype",void 0)],t.prototype,"setBeans",null),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"init",null),t}(rowNodeCache_1.RowNodeCache);exports.InfiniteCache=InfiniteCache;