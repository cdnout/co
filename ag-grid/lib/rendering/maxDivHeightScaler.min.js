"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,s=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(n<3?r(s):3<n?r(e,i,s):r(e,i))||s);return 3<n&&s&&Object.defineProperty(e,i,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var beanStub_1=require("../context/beanStub"),context_1=require("../context/context"),eventService_1=require("../eventService"),eventKeys_1=require("../eventKeys"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),utils_1=require("../utils"),MaxDivHeightScaler=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scrollY=0,t.uiBodyHeight=0,t}return __extends(t,e),t.prototype.postConstruct=function(){this.addDestroyableEventListener(this.eventService,eventKeys_1.Events.EVENT_BODY_HEIGHT_CHANGED,this.updateOffset.bind(this)),this.scrollBarWidth=this.gridOptionsWrapper.getScrollbarWidth(),this.maxDivHeight=utils_1._.getMaxDivHeight()},t.prototype.registerGridComp=function(t){this.gridPanel=t},t.prototype.isScaling=function(){return this.scaling},t.prototype.getOffset=function(){return this.offset},t.prototype.updateOffset=function(){var t,e;this.scaling&&(t=this.gridPanel.getVScrollPosition().top,e=this.getUiBodyHeight(),t===this.scrollY&&e===this.uiBodyHeight||(this.scrollY=t,this.uiBodyHeight=e,this.calculateOffset()))},t.prototype.calculateOffset=function(){this.uiContainerHeight=this.maxDivHeight,this.pixelsToShave=this.modelHeight-this.uiContainerHeight,this.maxScrollY=this.uiContainerHeight-this.uiBodyHeight;var t=this.scrollY/this.maxScrollY;this.setOffset(t*this.pixelsToShave)},t.prototype.clearOffset=function(){this.uiContainerHeight=this.modelHeight,this.pixelsToShave=0,this.setOffset(0)},t.prototype.setOffset=function(t){t="number"==typeof t?Math.floor(t):null;this.offset!==t&&(this.offset=t,this.eventService.dispatchEvent({type:eventKeys_1.Events.EVENT_HEIGHT_SCALE_CHANGED}))},t.prototype.setModelHeight=function(t){this.modelHeight=t,this.scaling=0<this.maxDivHeight&&t>this.maxDivHeight,this.scaling?this.calculateOffset():this.clearOffset()},t.prototype.getUiContainerHeight=function(){return this.uiContainerHeight},t.prototype.getRealPixelPosition=function(t){return t-this.offset},t.prototype.getUiBodyHeight=function(){var t=this.gridPanel.getVScrollPosition();return t.bottom-t.top},t.prototype.getScrollPositionForPixel=function(t){if(this.pixelsToShave<=0)return t;t/=this.modelHeight-this.getUiBodyHeight();return this.maxScrollY*t},__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],t.prototype,"eventService",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"postConstruct",null),__decorate([context_1.Bean("maxDivHeightScaler")],t)}(beanStub_1.BeanStub);exports.MaxDivHeightScaler=MaxDivHeightScaler;