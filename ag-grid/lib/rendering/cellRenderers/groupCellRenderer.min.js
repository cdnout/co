"use strict";var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(s=(i<3?r(s):3<i?r(t,n,s):r(t,n))||s);return 3<i&&s&&Object.defineProperty(t,n,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var gridOptionsWrapper_1=require("../../gridOptionsWrapper"),expressionService_1=require("../../valueService/expressionService"),eventService_1=require("../../eventService"),constants_1=require("../../constants"),context_1=require("../../context/context"),component_1=require("../../widgets/component"),rowNode_1=require("../../entities/rowNode"),valueFormatterService_1=require("../valueFormatterService"),checkboxSelectionComponent_1=require("../checkboxSelectionComponent"),columnController_1=require("../../columnController/columnController"),column_1=require("../../entities/column"),componentAnnotations_1=require("../../widgets/componentAnnotations"),mouseEventService_1=require("../../gridPanel/mouseEventService"),userComponentFactory_1=require("../../components/framework/userComponentFactory"),utils_1=require("../../utils"),GroupCellRenderer=function(e){function t(){return e.call(this,t.TEMPLATE)||this}return __extends(t,e),t.prototype.init=function(e){this.params=e,this.gridOptionsWrapper.isGroupIncludeTotalFooter()&&this.assignBlankValueToGroupFooterCell(e);var t=this.isEmbeddedRowMismatch(),e=null==e.value;this.cellIsBlank=t||e,this.cellIsBlank||(this.setupDragOpenParents(),this.addExpandAndContract(),this.addCheckboxIfNeeded(),this.addValueElement(),this.setupIndent())},t.prototype.assignBlankValueToGroupFooterCell=function(e){e.value||-1!=e.node.level||(e.value="")},t.prototype.isEmbeddedRowMismatch=function(){if(this.params.fullWidth&&this.gridOptionsWrapper.isEmbedFullWidthRows()){var e=this.params.pinned===column_1.Column.PINNED_LEFT,t=this.params.pinned===column_1.Column.PINNED_RIGHT,n=!e&&!t;return this.gridOptionsWrapper.isEnableRtl()?this.columnController.isPinningLeft()?!t:!n:this.columnController.isPinningLeft()?!e:!n}return!1},t.prototype.setIndent=function(){var e,t;this.gridOptionsWrapper.isGroupHideOpenParents()||(t=(e=this.params).node.uiLevel,0<=e.padding?this.setPaddingDeprecatedWay(t,e.padding):(this.indentClass&&this.removeCssClass(this.indentClass),this.indentClass="ag-row-group-indent-"+t,this.addCssClass(this.indentClass)))},t.prototype.setPaddingDeprecatedWay=function(e,t){utils_1._.doOnce(function(){return console.warn("ag-Grid: since v14.2, configuring padding for groupCellRenderer should be done with Sass variables and themes. Please see the ag-Grid documentation page for Themes, in particular the property $row-group-indent-size.")},"groupCellRenderer->doDeprecatedWay");t*=e;this.gridOptionsWrapper.isEnableRtl()?this.getGui().style.paddingRight=t+"px":this.getGui().style.paddingLeft=t+"px"},t.prototype.setupIndent=function(){var e=this.params.node;this.params.suppressPadding||(this.addDestroyableEventListener(e,rowNode_1.RowNode.EVENT_UI_LEVEL_CHANGED,this.setIndent.bind(this)),this.setIndent())},t.prototype.addValueElement=function(){var e=this.params,t=this.displayedGroup;t.footer?this.createFooterCell():t.hasChildren()||utils_1._.get(e.colDef,"cellRendererParams.innerRenderer",null)||utils_1._.get(e.colDef,"cellRendererParams.innerRendererFramework",null)?(this.createGroupCell(),t.hasChildren()&&this.addChildCount()):this.createLeafCell()},t.prototype.createFooterCell=function(){var e,t,n=this.params.footerValueGetter;n?((t=utils_1._.cloneObject(this.params)).value=this.params.value,"function"==typeof n?e=n(t):"string"==typeof n?e=this.expressionService.evaluate(n,t):console.warn("ag-Grid: footerValueGetter should be either a function or a string (expression)")):e="Total "+this.params.value,this.eValue.innerHTML=e},t.prototype.createGroupCell=function(){var t=this,e=this.params,n=this.displayedGroup.rowGroupColumn,o=n||e.column,n=this.params.value,n=o?this.valueFormatterService.formatValue(o,e.node,e.scope,n):null;e.valueFormatted=n,(e=1==e.fullWidth?this.useFullWidth(e):this.useInnerRenderer(this.params.colDef.cellRendererParams,o.getColDef(),e))&&e.then(function(e){t.innerCellRenderer=e})},t.prototype.useInnerRenderer=function(e,t,n){var o=this,r=null,i=this.userComponentFactory.lookupComponentClassDef(e,"innerRenderer");return null!=(r=i&&null!=i.component&&i.source!=userComponentFactory_1.ComponentSource.DEFAULT?this.userComponentFactory.newInnerCellRenderer(e,n):(e=this.userComponentFactory.lookupComponentClassDef(t,"cellRenderer"))&&e.source!=userComponentFactory_1.ComponentSource.DEFAULT?this.userComponentFactory.newCellRenderer(t,n):e&&e.source==userComponentFactory_1.ComponentSource.DEFAULT&&utils_1._.get(t,"cellRendererParams.innerRenderer",null)?this.userComponentFactory.newInnerCellRenderer(t.cellRendererParams,n):this.userComponentFactory.newCellRenderer({},n))?r.then(function(e){null!=e?utils_1._.bindCellRendererToHtmlElement(r,o.eValue):o.eValue.innerText=null!=n.valueFormatted?n.valueFormatted:n.value}):this.eValue.innerText=null!=n.valueFormatted?n.valueFormatted:n.value,r},t.prototype.useFullWidth=function(e){var t=this.userComponentFactory.newFullWidthGroupRowInnerCellRenderer(e);return null!=t?utils_1._.bindCellRendererToHtmlElement(t,this.eValue):this.eValue.innerText=null!=e.valueFormatted?e.valueFormatted:e.value,t},t.prototype.addChildCount=function(){this.params.suppressCount||(this.addDestroyableEventListener(this.displayedGroup,rowNode_1.RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED,this.updateChildCount.bind(this)),this.updateChildCount())},t.prototype.updateChildCount=function(){var e=this.displayedGroup.allChildrenCount;this.eChildCount.innerHTML=0<=e?"("+e+")":""},t.prototype.createLeafCell=function(){utils_1._.exists(this.params.value)&&(this.eValue.innerText=this.params.valueFormatted||this.params.value)},t.prototype.isUserWantsSelected=function(){var e=this.params.checkbox;return"function"==typeof e?e(this.params):!0===e},t.prototype.addCheckboxIfNeeded=function(){var e,t=this.displayedGroup,n=this.isUserWantsSelected()&&!t.footer&&!t.rowPinned&&!t.detail;n&&(e=new checkboxSelectionComponent_1.CheckboxSelectionComponent,this.getContext().wireBean(e),e.init({rowNode:t,column:this.params.column}),this.eCheckbox.appendChild(e.getGui()),this.addDestroyFunc(function(){return e.destroy()})),utils_1._.addOrRemoveCssClass(this.eCheckbox,"ag-invisible",!n)},t.prototype.addExpandAndContract=function(){var e=this.params,t=e.eGridCell,n=utils_1._.createIconNoSpan("groupExpanded",this.gridOptionsWrapper,null),o=utils_1._.createIconNoSpan("groupContracted",this.gridOptionsWrapper,null);this.eExpanded.appendChild(n),this.eContracted.appendChild(o),this.addDestroyableEventListener(this.eExpanded,"click",this.onExpandClicked.bind(this)),this.addDestroyableEventListener(this.eContracted,"click",this.onExpandClicked.bind(this)),this.addDestroyableEventListener(t,"keydown",this.onKeyDown.bind(this)),this.addDestroyableEventListener(e.node,rowNode_1.RowNode.EVENT_EXPANDED_CHANGED,this.showExpandAndContractIcons.bind(this)),this.showExpandAndContractIcons(),this.addDestroyableEventListener(this.displayedGroup,rowNode_1.RowNode.EVENT_ALL_CHILDREN_COUNT_CHANGED,this.onAllChildrenCountChanged.bind(this)),this.gridOptionsWrapper.isEnableGroupEdit()||!this.isExpandable()||e.suppressDoubleClickExpand||this.addDestroyableEventListener(t,"dblclick",this.onCellDblClicked.bind(this))},t.prototype.onAllChildrenCountChanged=function(){this.showExpandAndContractIcons(),this.setIndent()},t.prototype.onKeyDown=function(e){utils_1._.isKeyPressed(e,constants_1.Constants.KEY_ENTER)&&(this.params.suppressEnterExpand||this.params.column&&this.params.column.isCellEditable(this.params.node)||(e.preventDefault(),this.onExpandOrContract()))},t.prototype.setupDragOpenParents=function(){var e,t=this.params.column,n=this.params.node;if(this.gridOptionsWrapper.isGroupHideOpenParents()?n.hasChildren()?(e=n.rowGroupColumn,this.draggedFromHideOpenParents=!!e&&!t.isRowGroupDisplayed(e.getId())):this.draggedFromHideOpenParents=!0:this.draggedFromHideOpenParents=!1,this.draggedFromHideOpenParents)for(var o=n.parent;!utils_1._.missing(o);){if(o.rowGroupColumn&&t.isRowGroupDisplayed(o.rowGroupColumn.getId())){this.displayedGroup=o;break}o=o.parent}utils_1._.missing(this.displayedGroup)&&(this.displayedGroup=n)},t.prototype.onExpandClicked=function(e){utils_1._.isStopPropagationForAgGrid(e)||(utils_1._.stopPropagationForAgGrid(e),this.onExpandOrContract())},t.prototype.onCellDblClicked=function(e){utils_1._.isStopPropagationForAgGrid(e)||utils_1._.isElementInEventPath(this.eExpanded,e)||utils_1._.isElementInEventPath(this.eContracted,e)||this.onExpandOrContract()},t.prototype.onExpandOrContract=function(){var e=this.displayedGroup;e.setExpanded(!e.expanded)},t.prototype.isExpandable=function(){var e=this.params.node,t=this.columnController.isPivotMode()&&e.leafGroup;return this.draggedFromHideOpenParents||e.isExpandable()&&!e.footer&&!t},t.prototype.showExpandAndContractIcons=function(){var e=this.params.node;this.isExpandable()?(n=!!this.draggedFromHideOpenParents||e.expanded,utils_1._.setDisplayed(this.eContracted,!n),utils_1._.setDisplayed(this.eExpanded,n)):(utils_1._.setDisplayed(this.eExpanded,!1),utils_1._.setDisplayed(this.eContracted,!1));var t=this.displayedGroup,e=this.columnController.isPivotMode()&&t.leafGroup,n=!t.isExpandable(),e=t.footer||n||e;this.addOrRemoveCssClass("ag-row-group",!e),this.addOrRemoveCssClass("ag-row-group-leaf-indent",e)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.innerCellRenderer&&this.innerCellRenderer.destroy&&this.innerCellRenderer.destroy()},t.prototype.refresh=function(){return!1},t.TEMPLATE='<span class="ag-cell-wrapper"><span class="ag-group-expanded" ref="eExpanded"></span><span class="ag-group-contracted" ref="eContracted"></span><span class="ag-group-checkbox ag-invisible" ref="eCheckbox"></span><span class="ag-group-value" ref="eValue"></span><span class="ag-group-child-count" ref="eChildCount"></span></span>',__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("expressionService"),__metadata("design:type",expressionService_1.ExpressionService)],t.prototype,"expressionService",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],t.prototype,"eventService",void 0),__decorate([context_1.Autowired("valueFormatterService"),__metadata("design:type",valueFormatterService_1.ValueFormatterService)],t.prototype,"valueFormatterService",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],t.prototype,"columnController",void 0),__decorate([context_1.Autowired("mouseEventService"),__metadata("design:type",mouseEventService_1.MouseEventService)],t.prototype,"mouseEventService",void 0),__decorate([context_1.Autowired("userComponentFactory"),__metadata("design:type",userComponentFactory_1.UserComponentFactory)],t.prototype,"userComponentFactory",void 0),__decorate([componentAnnotations_1.RefSelector("eExpanded"),__metadata("design:type",HTMLElement)],t.prototype,"eExpanded",void 0),__decorate([componentAnnotations_1.RefSelector("eContracted"),__metadata("design:type",HTMLElement)],t.prototype,"eContracted",void 0),__decorate([componentAnnotations_1.RefSelector("eCheckbox"),__metadata("design:type",HTMLElement)],t.prototype,"eCheckbox",void 0),__decorate([componentAnnotations_1.RefSelector("eValue"),__metadata("design:type",HTMLElement)],t.prototype,"eValue",void 0),__decorate([componentAnnotations_1.RefSelector("eChildCount"),__metadata("design:type",HTMLElement)],t.prototype,"eChildCount",void 0),t}(component_1.Component);exports.GroupCellRenderer=GroupCellRenderer;