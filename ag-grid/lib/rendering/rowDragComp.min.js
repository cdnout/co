"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;0<=a;a--)(o=t[a])&&(s=(n<3?o(s):3<n?o(e,i,s):o(e,i))||s);return 3<n&&s&&Object.defineProperty(e,i,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../widgets/component"),context_1=require("../context/context"),rowNode_1=require("../entities/rowNode"),dragAndDropService_1=require("../dragAndDrop/dragAndDropService"),eventKeys_1=require("../eventKeys"),beanStub_1=require("../context/beanStub"),utils_1=require("../utils"),RowDragComp=function(n){function t(t,e,i,r){var o=n.call(this,'<div class="ag-row-drag"></div>')||this;return o.rowNode=t,o.column=e,o.cellValue=i,o.beans=r,o}return __extends(t,n),t.prototype.postConstruct=function(){this.getGui().appendChild(utils_1._.createIconNoSpan("rowDrag",this.beans.gridOptionsWrapper,null)),this.addDragSource(),this.checkCompatibility(),this.beans.gridOptionsWrapper.isRowDragManaged()?this.addFeature(this.beans.context,new ManagedVisibilityStrategy(this,this.beans,this.rowNode,this.column)):this.addFeature(this.beans.context,new NonManagedVisibilityStrategy(this,this.beans,this.rowNode,this.column))},t.prototype.checkCompatibility=function(){var t=this.beans.gridOptionsWrapper.isRowDragManaged();this.beans.gridOptionsWrapper.isTreeData()&&t&&utils_1._.doOnce(function(){return console.warn("ag-Grid: If using row drag with tree data, you cannot have rowDragManaged=true")},"RowDragComp.managedAndTreeData")},t.prototype.addDragSource=function(){var t=this,e={rowNode:this.rowNode},i={type:dragAndDropService_1.DragSourceType.RowDrag,eElement:this.getGui(),dragItemName:this.cellValue,dragItemCallback:function(){return e},dragStartPixels:0};this.beans.dragAndDropService.addDragSource(i,!0),this.addDestroyFunc(function(){return t.beans.dragAndDropService.removeDragSource(i)})},__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"postConstruct",null),t}(component_1.Component);exports.RowDragComp=RowDragComp;var VisibilityStrategy=function(o){function t(t,e,i){var r=o.call(this)||this;return r.parent=t,r.column=i,r.rowNode=e,r}return __extends(t,o),t.prototype.setDisplayedOrVisible=function(t){t?this.parent.setDisplayed(!1):(t=this.column.isRowDrag(this.rowNode),utils_1._.isFunction(this.column.getColDef().rowDrag)?this.parent.setVisible(t):this.parent.setDisplayed(t))},t}(beanStub_1.BeanStub),NonManagedVisibilityStrategy=function(o){function t(t,e,i,r){r=o.call(this,t,i,r)||this;return r.beans=e,r}return __extends(t,o),t.prototype.postConstruct=function(){this.addDestroyableEventListener(this.beans.gridOptionsWrapper,"suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_DATA_CHANGED,this.workOutVisibility.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.workOutVisibility()},t.prototype.onSuppressRowDrag=function(){this.workOutVisibility()},t.prototype.workOutVisibility=function(){var t=this.beans.gridOptionsWrapper.isSuppressRowDrag();this.setDisplayedOrVisible(t)},__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"postConstruct",null),t}(VisibilityStrategy),ManagedVisibilityStrategy=function(o){function t(t,e,i,r){r=o.call(this,t,i,r)||this;return r.beans=e,r}return __extends(t,o),t.prototype.postConstruct=function(){this.addDestroyableEventListener(this.beans.eventService,eventKeys_1.Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addDestroyableEventListener(this.beans.eventService,eventKeys_1.Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addDestroyableEventListener(this.beans.eventService,eventKeys_1.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.onRowGroupChanged.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_DATA_CHANGED,this.workOutVisibility.bind(this)),this.addDestroyableEventListener(this.rowNode,rowNode_1.RowNode.EVENT_CELL_CHANGED,this.workOutVisibility.bind(this)),this.addDestroyableEventListener(this.beans.gridOptionsWrapper,"suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.updateSortActive(),this.updateFilterActive(),this.updateRowGroupActive(),this.workOutVisibility()},t.prototype.updateRowGroupActive=function(){var t=this.beans.columnController.getRowGroupColumns();this.rowGroupActive=!utils_1._.missingOrEmpty(t)},t.prototype.onRowGroupChanged=function(){this.updateRowGroupActive(),this.workOutVisibility()},t.prototype.updateSortActive=function(){var t=this.beans.sortController.getSortModel();this.sortActive=!utils_1._.missingOrEmpty(t)},t.prototype.onSortChanged=function(){this.updateSortActive(),this.workOutVisibility()},t.prototype.updateFilterActive=function(){this.filterActive=this.beans.filterManager.isAnyFilterPresent()},t.prototype.onFilterChanged=function(){this.updateFilterActive(),this.workOutVisibility()},t.prototype.onSuppressRowDrag=function(){this.workOutVisibility()},t.prototype.workOutVisibility=function(){var t=this.sortActive||this.filterActive||this.rowGroupActive,e=this.beans.gridOptionsWrapper.isSuppressRowDrag(),e=t||e;this.setDisplayedOrVisible(e)},__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],t.prototype,"postConstruct",null),t}(VisibilityStrategy);