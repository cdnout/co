"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__decorate=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;0<=a;a--)(i=e[a])&&(s=(r<3?i(s):3<r?i(t,o,s):i(t,o))||s);return 3<r&&s&&Object.defineProperty(t,o,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(o,n){return function(e,t){n(e,t,o)}};Object.defineProperty(exports,"__esModule",{value:!0});var gridOptionsWrapper_1=require("../gridOptionsWrapper"),eventService_1=require("../eventService"),rowComp_1=require("./rowComp"),column_1=require("../entities/column"),events_1=require("../events"),constants_1=require("../constants"),cellComp_1=require("./cellComp"),context_1=require("../context/context"),columnApi_1=require("../columnController/columnApi"),columnController_1=require("../columnController/columnController"),logger_1=require("../logger"),focusedCellController_1=require("../focusedCellController"),cellNavigationService_1=require("../cellNavigationService"),beanStub_1=require("../context/beanStub"),paginationProxy_1=require("../rowModels/paginationProxy"),gridApi_1=require("../gridApi"),pinnedRowModel_1=require("../rowModels/pinnedRowModel"),beans_1=require("./beans"),animationFrameService_1=require("../misc/animationFrameService"),maxDivHeightScaler_1=require("./maxDivHeightScaler"),utils_1=require("../utils"),rowPosition_1=require("../entities/rowPosition"),RowRenderer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.destroyFuncsForColumnListeners=[],e.rowCompsByIndex={},e.floatingTopRowComps=[],e.floatingBottomRowComps=[],e.refreshInProgress=!1,e}return __extends(e,t),e.prototype.registerGridCore=function(e){this.gridCore=e},e.prototype.getGridCore=function(){return this.gridCore},e.prototype.agWire=function(e){this.logger=e.create("RowRenderer")},e.prototype.registerGridComp=function(e){this.gridPanel=e,this.rowContainers=this.gridPanel.getRowContainers(),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_PAGINATION_CHANGED,this.onPageLoaded.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_PINNED_ROW_DATA_CHANGED,this.onPinnedRowDataChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_BODY_SCROLL,this.redrawAfterScroll.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_BODY_HEIGHT_CHANGED,this.redrawAfterScroll.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_DOM_LAYOUT,this.onDomLayoutChanged.bind(this)),this.registerCellEventListeners(),this.printLayout=this.gridOptionsWrapper.getDomLayout()===constants_1.Constants.DOM_LAYOUT_PRINT,this.embedFullWidthRows=this.printLayout||this.gridOptionsWrapper.isEmbedFullWidthRows(),this.redrawAfterModelUpdate()},e.prototype.registerCellEventListeners=function(){var e=this;this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_CELL_FOCUSED,function(t){e.forEachCellComp(function(e){return e.onCellFocused(t)})}),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_FLASH_CELLS,function(t){e.forEachCellComp(function(e){return e.onFlashCells(t)})}),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_COLUMN_HOVER_CHANGED,function(){e.forEachCellComp(function(e){return e.onColumnHover()})}),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_DISPLAYED_COLUMNS_WIDTH_CHANGED,function(){e.printLayout&&e.forEachCellComp(function(e){return e.onLeftChanged()})}),this.gridOptionsWrapper.isEnableRangeSelection()&&(this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_RANGE_SELECTION_CHANGED,function(){e.forEachCellComp(function(e){return e.onRangeSelectionChanged()})}),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_COLUMN_MOVED,function(){e.forEachCellComp(function(e){return e.updateRangeBordersIfRangeCount()})}),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_COLUMN_PINNED,function(){e.forEachCellComp(function(e){return e.updateRangeBordersIfRangeCount()})}),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_COLUMN_VISIBLE,function(){e.forEachCellComp(function(e){return e.updateRangeBordersIfRangeCount()})})),this.refreshListenersToColumnsForCellComps(),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_GRID_COLUMNS_CHANGED,this.refreshListenersToColumnsForCellComps.bind(this)),this.addDestroyFunc(this.removeGridColumnListeners.bind(this))},e.prototype.removeGridColumnListeners=function(){this.destroyFuncsForColumnListeners.forEach(function(e){return e()}),this.destroyFuncsForColumnListeners.length=0},e.prototype.refreshListenersToColumnsForCellComps=function(){var s=this;this.removeGridColumnListeners();var e=this.columnController.getAllGridColumns();e&&e.forEach(function(o){function e(t){s.forEachCellComp(function(e){e.getColumn()===o&&t(e)})}function t(){e(function(e){return e.onLeftChanged()})}function n(){e(function(e){return e.onWidthChanged()})}function i(){e(function(e){return e.onFirstRightPinnedChanged()})}function r(){e(function(e){return e.onLastLeftPinnedChanged()})}o.addEventListener(column_1.Column.EVENT_LEFT_CHANGED,t),o.addEventListener(column_1.Column.EVENT_WIDTH_CHANGED,n),o.addEventListener(column_1.Column.EVENT_FIRST_RIGHT_PINNED_CHANGED,i),o.addEventListener(column_1.Column.EVENT_LAST_LEFT_PINNED_CHANGED,r),s.destroyFuncsForColumnListeners.push(function(){o.removeEventListener(column_1.Column.EVENT_LEFT_CHANGED,t),o.removeEventListener(column_1.Column.EVENT_WIDTH_CHANGED,n),o.removeEventListener(column_1.Column.EVENT_FIRST_RIGHT_PINNED_CHANGED,i),o.removeEventListener(column_1.Column.EVENT_LAST_LEFT_PINNED_CHANGED,r)})})},e.prototype.onDomLayoutChanged=function(){var e=this.gridOptionsWrapper.getDomLayout()===constants_1.Constants.DOM_LAYOUT_PRINT,t=e||this.gridOptionsWrapper.isEmbedFullWidthRows(),o=t!==this.embedFullWidthRows||this.printLayout!==e;this.printLayout=e,this.embedFullWidthRows=t,o&&this.redrawAfterModelUpdate()},e.prototype.datasourceChanged=function(){this.firstRenderedRow=0,this.lastRenderedRow=-1;var e=Object.keys(this.rowCompsByIndex);this.removeRowComps(e)},e.prototype.onPageLoaded=function(e){utils_1._.missing(e)&&(e={type:events_1.Events.EVENT_MODEL_UPDATED,api:this.gridApi,columnApi:this.columnApi,animate:!1,keepRenderedRows:!1,newData:!1,newPage:!1}),this.onModelUpdated(e)},e.prototype.getAllCellsForColumn=function(o){var n=[];function e(e,t){t=t.getCellForCol(o);t&&n.push(t)}return utils_1._.iterateObject(this.rowCompsByIndex,e),utils_1._.iterateObject(this.floatingBottomRowComps,e),utils_1._.iterateObject(this.floatingTopRowComps,e),n},e.prototype.refreshFloatingRowComps=function(){this.refreshFloatingRows(this.floatingTopRowComps,this.pinnedRowModel.getPinnedTopRowData(),this.rowContainers.floatingTopPinnedLeft,this.rowContainers.floatingTopPinnedRight,this.rowContainers.floatingTop,this.rowContainers.floatingTopFullWidth),this.refreshFloatingRows(this.floatingBottomRowComps,this.pinnedRowModel.getPinnedBottomRowData(),this.rowContainers.floatingBottomPinnedLeft,this.rowContainers.floatingBottomPinnedRight,this.rowContainers.floatingBottom,this.rowContainers.floatingBottomFullWith)},e.prototype.refreshFloatingRows=function(t,e,o,n,i,r){var s=this;t.forEach(function(e){e.destroy()}),t.length=0,e&&e.forEach(function(e){e=new rowComp_1.RowComp(s.$scope,i,o,n,r,e,s.beans,!1,!1,s.printLayout,s.embedFullWidthRows);e.init(),t.push(e)}),this.flushContainers(t)},e.prototype.onPinnedRowDataChanged=function(){this.redrawAfterModelUpdate({recycleRows:!0})},e.prototype.onModelUpdated=function(e){e={recycleRows:e.keepRenderedRows,animate:e.animate,newData:e.newData,newPage:e.newPage,onlyBody:!0};this.redrawAfterModelUpdate(e)},e.prototype.getRenderedIndexesForRowNodes=function(o){var n=[];return utils_1._.missing(o)||utils_1._.iterateObject(this.rowCompsByIndex,function(e,t){t=t.getRowNode();0<=o.indexOf(t)&&n.push(e)}),n},e.prototype.redrawRows=function(e){e&&0!=e.length&&(e=this.getRenderedIndexesForRowNodes(e),this.removeRowComps(e),this.redrawAfterModelUpdate({recycleRows:!0}))},e.prototype.getCellToRestoreFocusToAfterRefresh=function(e){var t=e.suppressKeepFocus?null:this.focusedCellController.getFocusCellToUseAfterRefresh();if(utils_1._.missing(t))return null;e=document.activeElement,e=this.gridOptionsWrapper.getDomData(e,cellComp_1.CellComp.DOM_DATA_KEY_CELL_COMP);return utils_1._.missing(e)?null:t},e.prototype.redrawAfterModelUpdate=function(e){void 0===e&&(e={}),this.getLockOnRefresh();var t=this.getCellToRestoreFocusToAfterRefresh(e);this.sizeContainerToPageHeight(),this.scrollToTopIfNewData(e);var o=!this.printLayout&&e.recycleRows,n=e.animate&&this.gridOptionsWrapper.isAnimateRows(),o=this.binRowComps(o);this.redraw(o,n),e.onlyBody||this.refreshFloatingRowComps(),this.restoreFocusedCell(t),this.releaseLockOnRefresh()},e.prototype.scrollToTopIfNewData=function(e){var t=e.newData||e.newPage,e=this.gridOptionsWrapper.isSuppressScrollOnNewData();t&&!e&&this.gridPanel.scrollToTop()},e.prototype.sizeContainerToPageHeight=function(){var e,t,o=[this.rowContainers.body,this.rowContainers.fullWidth,this.rowContainers.pinnedLeft,this.rowContainers.pinnedRight];this.printLayout?o.forEach(function(e){return e.setHeight(null)}):(0===(e=this.paginationProxy.getCurrentPageHeight())&&(e=1),this.maxDivHeightScaler.setModelHeight(e),t=this.maxDivHeightScaler.getUiContainerHeight(),o.forEach(function(e){return e.setHeight(t)}))},e.prototype.getLockOnRefresh=function(){if(this.refreshInProgress)throw new Error("ag-Grid: cannot get grid to draw rows when it is in the middle of drawing rows. Your code probably called a grid API method while the grid was in the render stage. To overcome this, put the API call into a timeout, eg instead of api.refreshView(), call setTimeout(function(){api.refreshView(),0}). To see what part of your code that caused the refresh check this stacktrace.");this.refreshInProgress=!0},e.prototype.releaseLockOnRefresh=function(){this.refreshInProgress=!1},e.prototype.restoreFocusedCell=function(e){e&&this.focusedCellController.setFocusedCell(e.rowIndex,e.column,e.rowPinned,!0)},e.prototype.stopEditing=function(o){void 0===o&&(o=!1),this.forEachRowComp(function(e,t){t.stopEditing(o)})},e.prototype.forEachCellComp=function(o){this.forEachRowComp(function(e,t){return t.forEachCellComp(o)})},e.prototype.forEachRowComp=function(e){utils_1._.iterateObject(this.rowCompsByIndex,e),utils_1._.iterateObject(this.floatingTopRowComps,e),utils_1._.iterateObject(this.floatingBottomRowComps,e)},e.prototype.addRenderedRowListener=function(e,t,o){t=this.rowCompsByIndex[t];t&&t.addEventListener(e,o)},e.prototype.flashCells=function(e){void 0===e&&(e={}),this.forEachCellCompFiltered(e.rowNodes,e.columns,function(e){return e.flashCell()})},e.prototype.refreshCells=function(e){void 0===e&&(e={});var t={forceRefresh:e.force,newData:!1};this.forEachCellCompFiltered(e.rowNodes,e.columns,function(e){return e.refreshCell(t)})},e.prototype.getCellRendererInstances=function(e){var t=[];return this.forEachCellCompFiltered(e.rowNodes,e.columns,function(e){e=e.getCellRenderer();e&&t.push(e)}),t},e.prototype.getCellEditorInstances=function(e){var t=[];return this.forEachCellCompFiltered(e.rowNodes,e.columns,function(e){e=e.getCellEditor();e&&t.push(e)}),t},e.prototype.getEditingCells=function(){var t=[];return this.forEachCellComp(function(e){e.isEditing()&&(e=e.getCellPosition(),t.push(e))}),t},e.prototype.forEachCellCompFiltered=function(e,t,n){var i,r,o=this;utils_1._.exists(e)&&(i={top:{},bottom:{},normal:{}},e.forEach(function(e){e.rowPinned===constants_1.Constants.PINNED_TOP?i.top[e.id]=!0:e.rowPinned===constants_1.Constants.PINNED_BOTTOM?i.bottom[e.id]=!0:i.normal[e.id]=!0})),utils_1._.exists(t)&&(r={},t.forEach(function(e){e=o.columnController.getGridColumn(e);utils_1._.exists(e)&&(r[e.getId()]=!0)}));function s(e){var t=(o=e.getRowNode()).id,o=o.rowPinned;if(utils_1._.exists(i))if(o===constants_1.Constants.PINNED_BOTTOM){if(!i.bottom[t])return}else if(o===constants_1.Constants.PINNED_TOP){if(!i.top[t])return}else if(!i.normal[t])return;e.forEachCellComp(function(e){var t=e.getColumn().getId();r&&!r[t]||n(e)})}utils_1._.iterateObject(this.rowCompsByIndex,function(e,t){s(t)}),this.floatingTopRowComps&&this.floatingTopRowComps.forEach(s),this.floatingBottomRowComps&&this.floatingBottomRowComps.forEach(s)},e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=Object.keys(this.rowCompsByIndex);this.removeRowComps(e)},e.prototype.binRowComps=function(e){var n,i=this,r={};return e?(n=[],utils_1._.iterateObject(this.rowCompsByIndex,function(e,t){var o=t.getRowNode();utils_1._.exists(o.id)?(r[o.id]=t,delete i.rowCompsByIndex[e]):n.push(e)})):n=Object.keys(this.rowCompsByIndex),this.removeRowComps(n),r},e.prototype.removeRowComps=function(e){var t=this;e.forEach(function(e){t.rowCompsByIndex[e].destroy(),delete t.rowCompsByIndex[e]})},e.prototype.redrawAfterScroll=function(){this.getLockOnRefresh(),this.redraw(null,!1,!0),this.releaseLockOnRefresh()},e.prototype.removeRowCompsNotToDraw=function(e){var t={};e.forEach(function(e){return t[e]=!0});e=Object.keys(this.rowCompsByIndex),e=utils_1._.filter(e,function(e){return!t[e]});this.removeRowComps(e)},e.prototype.calculateIndexesToDraw=function(){var o=this,n=utils_1._.createArrayOfNumbers(this.firstRenderedRow,this.lastRenderedRow);return utils_1._.iterateObject(this.rowCompsByIndex,function(e,t){e=Number(e);(e<o.firstRenderedRow||e>o.lastRenderedRow)&&o.doNotUnVirtualiseRow(t)&&n.push(e)}),n.sort(function(e,t){return e-t}),n},e.prototype.redraw=function(t,o,n){var i=this;void 0===o&&(o=!1),void 0===n&&(n=!1),this.maxDivHeightScaler.updateOffset(),this.workOutFirstAndLastRowsToRender();var e=this.calculateIndexesToDraw();this.removeRowCompsNotToDraw(e),this.printLayout&&(o=!1);var r=[],s=[];e.forEach(function(e){e=i.createOrUpdateRowComp(e,t,o,n);utils_1._.exists(e)&&(s.push(e),utils_1._.pushAll(r,e.getAndClearNextVMTurnFunctions()))}),this.flushContainers(s),utils_1._.executeNextVMTurn(r),n&&!this.gridOptionsWrapper.isSuppressAnimationFrame()&&!this.printLayout?this.beans.taskQueue.addP2Task(this.destroyRowComps.bind(this,t,o)):this.destroyRowComps(t,o),this.checkAngularCompile(),this.gridPanel.updateRowCount()},e.prototype.flushContainers=function(e){utils_1._.iterateObject(this.rowContainers,function(e,t){t&&t.flushRowTemplates()}),e.forEach(function(e){return e.afterFlush()})},e.prototype.onDisplayedColumnsChanged=function(){var e=this.columnController.isPinningLeft(),t=this.columnController.isPinningRight();this.pinningLeft===e&&t===this.pinningRight||(this.pinningLeft=e,this.pinningRight=t,this.embedFullWidthRows&&this.redrawFullWidthEmbeddedRows())},e.prototype.redrawFullWidthEmbeddedRows=function(){var o=[];utils_1._.iterateObject(this.rowCompsByIndex,function(e,t){t.isFullWidth()&&(t=t.getRowNode().rowIndex,o.push(t.toString()))}),this.refreshFloatingRowComps(),this.removeRowComps(o),this.redrawAfterScroll()},e.prototype.refreshFullWidthRows=function(){var o=[];utils_1._.iterateObject(this.rowCompsByIndex,function(e,t){t.isFullWidth()&&(t.refreshFullWidth()||(t=t.getRowNode().rowIndex,o.push(t.toString())))}),this.removeRowComps(o),this.redrawAfterScroll()},e.prototype.createOrUpdateRowComp=function(e,t,o,n){var i,r=this.rowCompsByIndex[e];if(r||(i=this.paginationProxy.getRow(e),utils_1._.exists(i)&&utils_1._.exists(t)&&t[i.id]&&i.alreadyRendered&&(r=t[i.id],t[i.id]=null)),!r){if(i=i||this.paginationProxy.getRow(e),!utils_1._.exists(i))return;r=this.createRowComp(i,o,n)}else r.ensureDomOrder();return i&&(i.alreadyRendered=!0),this.rowCompsByIndex[e]=r},e.prototype.destroyRowComps=function(e,o){var n=[];utils_1._.iterateObject(e,function(e,t){t&&(t.destroy(o),utils_1._.pushAll(n,t.getAndClearDelayedDestroyFunctions()))}),utils_1._.executeInAWhile(n)},e.prototype.checkAngularCompile=function(){var e=this;this.gridOptionsWrapper.isAngularCompileRows()&&window.setTimeout(function(){e.$scope.$apply()},0)},e.prototype.workOutFirstAndLastRowsToRender=function(){var e,t,o=this.paginationProxy.isRowsToRender()?this.printLayout?(e=this.paginationProxy.getPageFirstRow(),this.paginationProxy.getPageLastRow()):(n=this.paginationProxy.getPixelOffset(),i=this.maxDivHeightScaler.getOffset(),o=(r=this.gridPanel.getVScrollPosition()).top,t=r.bottom,o=o+n+i-(r=this.gridOptionsWrapper.getRowBufferInPixels()),n=t+n+i+r,this.ensureAllRowsInRangeHaveHeightsCalculated(o,n),i=this.paginationProxy.getRowIndexAtPixel(o),r=this.paginationProxy.getRowIndexAtPixel(n),i<(o=this.paginationProxy.getPageFirstRow())&&(i=o),(n=this.paginationProxy.getPageLastRow())<r&&(r=n),e=i,r):(e=0,-1),n=this.gridOptionsWrapper.getDomLayout()===constants_1.Constants.DOM_LAYOUT_NORMAL,i=this.gridOptionsWrapper.isSuppressMaxRenderedRowRestriction(),r=Math.max(this.gridOptionsWrapper.getRowBuffer(),500);n&&!i&&r<o-e&&(o=e+r);i=e!==this.firstRenderedRow,r=o!==this.lastRenderedRow;(i||r)&&(this.firstRenderedRow=e,this.lastRenderedRow=o,r={type:events_1.Events.EVENT_VIEWPORT_CHANGED,firstRow:e,lastRow:o,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEvent(r)),this.paginationProxy.isRowsToRender()&&(o={type:events_1.Events.EVENT_FIRST_DATA_RENDERED,firstRow:e,lastRow:o,api:this.gridApi,columnApi:this.columnApi},this.eventService.dispatchEventOnce(o))},e.prototype.ensureAllRowsInRangeHaveHeightsCalculated=function(e,t){this.paginationProxy.ensureRowHeightsValid(e,t,-1,-1)&&(this.sizeContainerToPageHeight(),this.maxDivHeightScaler.updateOffset())},e.prototype.getFirstVirtualRenderedRow=function(){return this.firstRenderedRow},e.prototype.getLastVirtualRenderedRow=function(){return this.lastRenderedRow},e.prototype.doNotUnVirtualiseRow=function(e){var t=e.getRowNode(),o=this.focusedCellController.isRowNodeFocused(t),n=e.isEditing(),e=t.detail;return!!(o||n||e)&&!!this.paginationProxy.isRowPresent(t)},e.prototype.createRowComp=function(e,t,o){var n=this.gridOptionsWrapper.isSuppressAnimationFrame(),n=o&&!n&&!this.printLayout,n=new rowComp_1.RowComp(this.$scope,this.rowContainers.body,this.rowContainers.pinnedLeft,this.rowContainers.pinnedRight,this.rowContainers.fullWidth,e,this.beans,t,n,this.printLayout,this.embedFullWidthRows);return n.init(),n},e.prototype.getRenderedNodes=function(){var t=this.rowCompsByIndex;return Object.keys(t).map(function(e){return t[e].getRowNode()})},e.prototype.navigateToNextCell=function(e,t,o,n){for(var i,r=o,s=!1;!s;)this.gridOptionsWrapper.isEnableRtl()?t===constants_1.Constants.KEY_LEFT&&(r=this.getLastCellOfColSpan(r)):t===constants_1.Constants.KEY_RIGHT&&(r=this.getLastCellOfColSpan(r)),r=this.cellNavigationService.getNextCellToFocus(t,r),utils_1._.missing(r)?s=!0:(i=this.rowPositionUtils.getRowNode(r)).detail||(i.group?(i=this.columnController.isPivotMode(),this.gridOptionsWrapper.isGroupUseEntireRow(i)||(s=!0)):s=!0);n&&(n=this.gridOptionsWrapper.getNavigateToNextCellFunc(),utils_1._.exists(n)&&(e=n({key:t,previousCellPosition:o,nextCellPosition:r||null,event:e}),r=utils_1._.exists(e)?(e.floating&&(utils_1._.doOnce(function(){console.warn("ag-Grid: tabToNextCellFunc return type should have attributes: rowIndex, rowPinned, column. However you had 'floating', maybe you meant 'rowPinned'?")},"no floating in userCell"),e.rowPinned=e.floating),{rowPinned:e.rowPinned,rowIndex:e.rowIndex,column:e.column}):null)),r&&(this.ensureCellVisible(r),r=this.getComponentForCell(r).getCellPosition(),this.ensureCellVisible(r),this.focusedCellController.setFocusedCell(r.rowIndex,r.column,r.rowPinned,!0),this.rangeController&&this.rangeController.setRangeToCell(r))},e.prototype.getLastCellOfColSpan=function(e){var t=this.getComponentForCell(e);if(!t)return e;t=t.getColSpanningList();return 1===t.length?e:{rowIndex:e.rowIndex,column:utils_1._.last(t),rowPinned:e.rowPinned}},e.prototype.ensureCellVisible=function(e){utils_1._.missing(e.rowPinned)&&this.gridPanel.ensureIndexVisible(e.rowIndex),e.column.isPinned()||this.gridPanel.ensureColumnVisible(e.column),this.gridPanel.horizontallyScrollHeaderCenterAndFloatingCenter(),this.animationFrameService.flushAllFrames()},e.prototype.startEditingCell=function(e,t,o){e=this.getComponentForCell(e);e&&e.startRowOrCellEdit(t,o)},e.prototype.getComponentForCell=function(e){var t;switch(e.rowPinned){case constants_1.Constants.PINNED_TOP:t=this.floatingTopRowComps[e.rowIndex];break;case constants_1.Constants.PINNED_BOTTOM:t=this.floatingBottomRowComps[e.rowIndex];break;default:t=this.rowCompsByIndex[e.rowIndex]}return t?t.getRenderedCellForColumn(e.column):null},e.prototype.getRowNode=function(e){switch(e.rowPinned){case constants_1.Constants.PINNED_TOP:return this.pinnedRowModel.getPinnedTopRowData()[e.rowIndex];case constants_1.Constants.PINNED_BOTTOM:return this.pinnedRowModel.getPinnedBottomRowData()[e.rowIndex];default:return this.rowModel.getRow(e.rowIndex)}},e.prototype.onTabKeyDown=function(e,t){var o=t.shiftKey;this.moveToCellAfter(e,o)&&t.preventDefault()},e.prototype.tabToNextCell=function(e){var t=this.focusedCellController.getFocusedCell();if(utils_1._.missing(t))return!1;t=this.getComponentForCell(t);return!utils_1._.missing(t)&&this.moveToCellAfter(t,e)},e.prototype.moveToCellAfter=function(e,t){t=e.isEditing()?this.gridOptionsWrapper.isFullRowEdit()?this.moveToNextEditingRow(e,t):this.moveToNextEditingCell(e,t):this.moveToNextCellNotEditing(e,t);return t},e.prototype.moveToNextEditingCell=function(e,t){var o=e.getCellPosition();e.stopEditing();o=this.findNextCellToFocusOn(o,t,!0),t=utils_1._.exists(o);return t&&(o.startEditingIfEnabled(null,null,!0),o.focusCell(!1)),t},e.prototype.moveToNextEditingRow=function(e,t){var o=e.getCellPosition(),o=this.findNextCellToFocusOn(o,t,!0),t=utils_1._.exists(o);return t&&this.moveEditToNextCellOrRow(e,o),t},e.prototype.moveToNextCellNotEditing=function(e,t){e=e.getCellPosition(),e=this.findNextCellToFocusOn(e,t,!1),t=utils_1._.exists(e);return t&&e.focusCell(!0),t},e.prototype.moveEditToNextCellOrRow=function(e,t){var o=e.getCellPosition(),n=t.getCellPosition();o.rowIndex===n.rowIndex&&o.rowPinned===n.rowPinned?e.setFocusOutOnEditor():(o=e.getRenderedRow(),n=t.getRenderedRow(),e.setFocusOutOnEditor(),o.stopEditing(),n.startRowEditing()),t.setFocusInOnEditor(),t.focusCell()},e.prototype.findNextCellToFocusOn=function(e,t,o){for(var n=e;;){t||(n=this.getLastCellOfColSpan(n)),n=this.cellNavigationService.getNextTabbedCell(n,t);var i=this.gridOptionsWrapper.getTabToNextCellFunc();if(utils_1._.exists(i)&&(i=i({backwards:t,editing:o,previousCellPosition:e,nextCellPosition:n||null}),n=utils_1._.exists(i)?(i.floating&&(utils_1._.doOnce(function(){console.warn("ag-Grid: tabToNextCellFunc return type should have attributes: rowIndex, rowPinned, column. However you had 'floating', maybe you meant 'rowPinned'?")},"no floating in userCell"),i.rowPinned=i.floating),{rowIndex:i.rowIndex,column:i.column,rowPinned:i.rowPinned}):null),!n)return null;if(o){var r=this.lookupRowNodeForCell(n);if(!n.column.isCellEditable(r))continue}utils_1._.missing(n.rowPinned)&&this.gridPanel.ensureIndexVisible(n.rowIndex),n.column.isPinned()||this.gridPanel.ensureColumnVisible(n.column),this.gridPanel.horizontallyScrollHeaderCenterAndFloatingCenter(),this.animationFrameService.flushAllFrames();r=this.getComponentForCell(n);if(!utils_1._.missing(r)&&!r.isSuppressNavigable())return this.rangeController&&this.rangeController.setRangeToCell(n),r}},e.prototype.lookupRowNodeForCell=function(e){return e.rowPinned===constants_1.Constants.PINNED_TOP?this.pinnedRowModel.getPinnedTopRow(e.rowIndex):e.rowPinned===constants_1.Constants.PINNED_BOTTOM?this.pinnedRowModel.getPinnedBottomRow(e.rowIndex):this.paginationProxy.getRow(e.rowIndex)},__decorate([context_1.Autowired("paginationProxy"),__metadata("design:type",paginationProxy_1.PaginationProxy)],e.prototype,"paginationProxy",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],e.prototype,"columnController",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("$scope"),__metadata("design:type",Object)],e.prototype,"$scope",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],e.prototype,"eventService",void 0),__decorate([context_1.Autowired("pinnedRowModel"),__metadata("design:type",pinnedRowModel_1.PinnedRowModel)],e.prototype,"pinnedRowModel",void 0),__decorate([context_1.Autowired("rowModel"),__metadata("design:type",Object)],e.prototype,"rowModel",void 0),__decorate([context_1.Autowired("loggerFactory"),__metadata("design:type",logger_1.LoggerFactory)],e.prototype,"loggerFactory",void 0),__decorate([context_1.Autowired("focusedCellController"),__metadata("design:type",focusedCellController_1.FocusedCellController)],e.prototype,"focusedCellController",void 0),__decorate([context_1.Autowired("cellNavigationService"),__metadata("design:type",cellNavigationService_1.CellNavigationService)],e.prototype,"cellNavigationService",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],e.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],e.prototype,"gridApi",void 0),__decorate([context_1.Autowired("beans"),__metadata("design:type",beans_1.Beans)],e.prototype,"beans",void 0),__decorate([context_1.Autowired("maxDivHeightScaler"),__metadata("design:type",maxDivHeightScaler_1.MaxDivHeightScaler)],e.prototype,"maxDivHeightScaler",void 0),__decorate([context_1.Autowired("animationFrameService"),__metadata("design:type",animationFrameService_1.AnimationFrameService)],e.prototype,"animationFrameService",void 0),__decorate([context_1.Autowired("rowPositionUtils"),__metadata("design:type",rowPosition_1.RowPositionUtils)],e.prototype,"rowPositionUtils",void 0),__decorate([context_1.Optional("rangeController"),__metadata("design:type",Object)],e.prototype,"rangeController",void 0),__decorate([__param(0,context_1.Qualifier("loggerFactory")),__metadata("design:type",Function),__metadata("design:paramtypes",[logger_1.LoggerFactory]),__metadata("design:returntype",void 0)],e.prototype,"agWire",null),__decorate([context_1.Bean("rowRenderer")],e)}(beanStub_1.BeanStub);exports.RowRenderer=RowRenderer;