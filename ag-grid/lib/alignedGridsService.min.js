"use strict";var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;0<=c;c--)(i=e[c])&&(s=(r<3?i(s):3<r?i(t,n,s):i(t,n))||s);return 3<r&&s&&Object.defineProperty(t,n,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(n,o){return function(e,t){o(e,t,n)}};Object.defineProperty(exports,"__esModule",{value:!0});var gridOptionsWrapper_1=require("./gridOptionsWrapper"),columnController_1=require("./columnController/columnController"),eventService_1=require("./eventService"),logger_1=require("./logger"),events_1=require("./events"),context_1=require("./context/context"),context_2=require("./context/context"),context_3=require("./context/context"),context_4=require("./context/context"),AlignedGridsService=function(){function e(){this.consuming=!1}return e.prototype.setBeans=function(e){this.logger=e.create("AlignedGridsService")},e.prototype.registerGridComp=function(e){this.gridPanel=e},e.prototype.init=function(){this.eventService.addEventListener(events_1.Events.EVENT_COLUMN_MOVED,this.fireColumnEvent.bind(this)),this.eventService.addEventListener(events_1.Events.EVENT_COLUMN_VISIBLE,this.fireColumnEvent.bind(this)),this.eventService.addEventListener(events_1.Events.EVENT_COLUMN_PINNED,this.fireColumnEvent.bind(this)),this.eventService.addEventListener(events_1.Events.EVENT_COLUMN_GROUP_OPENED,this.fireColumnEvent.bind(this)),this.eventService.addEventListener(events_1.Events.EVENT_COLUMN_RESIZED,this.fireColumnEvent.bind(this)),this.eventService.addEventListener(events_1.Events.EVENT_BODY_SCROLL,this.fireScrollEvent.bind(this))},e.prototype.fireEvent=function(t){var e;this.consuming||(e=this.gridOptionsWrapper.getAlignedGrids())&&e.forEach(function(e){e.api&&(e=e.api.__getAlignedGridService(),t(e))})},e.prototype.onEvent=function(e){this.consuming=!0,e(),this.consuming=!1},e.prototype.fireColumnEvent=function(t){this.fireEvent(function(e){e.onColumnEvent(t)})},e.prototype.fireScrollEvent=function(t){"horizontal"===t.direction&&this.fireEvent(function(e){e.onScrollEvent(t)})},e.prototype.onScrollEvent=function(e){var t=this;this.onEvent(function(){t.gridPanel.setHorizontalScrollPosition(e.left)})},e.prototype.getMasterColumns=function(e){var t=[];return e.columns?e.columns.forEach(function(e){t.push(e)}):e.column&&t.push(e.column),t},e.prototype.getColumnIds=function(e){var t=[];return e.columns?e.columns.forEach(function(e){t.push(e.getColId())}):e.column&&t.push(e.column.getColId()),t},e.prototype.onColumnEvent=function(e){var t=this;this.onEvent(function(){switch(e.type){case events_1.Events.EVENT_COLUMN_MOVED:case events_1.Events.EVENT_COLUMN_VISIBLE:case events_1.Events.EVENT_COLUMN_PINNED:case events_1.Events.EVENT_COLUMN_RESIZED:t.processColumnEvent(e);break;case events_1.Events.EVENT_COLUMN_GROUP_OPENED:t.processGroupOpenedEvent(e);break;case events_1.Events.EVENT_COLUMN_PIVOT_CHANGED:console.warn("ag-Grid: pivoting is not supported with aligned grids. You can only use one of these features at a time in a grid.")}})},e.prototype.processGroupOpenedEvent=function(e){var t,n=e.columnGroup;n&&(t=n.getGroupId(),t=this.columnController.getOriginalColumnGroup(t)),n&&!t||(this.logger.log("onColumnEvent-> processing "+e+" expanded = "+n.isExpanded()),this.columnController.setColumnGroupOpened(t,n.isExpanded(),"alignedGridChanged"))},e.prototype.processColumnEvent=function(t){var n=this,e=t.column;if(e&&(i=this.columnController.getPrimaryColumn(e.getColId())),!e||i){var o=this.getColumnIds(t),e=this.getMasterColumns(t);switch(t.type){case events_1.Events.EVENT_COLUMN_MOVED:var i=t;this.logger.log("onColumnEvent-> processing "+t.type+" toIndex = "+i.toIndex),this.columnController.moveColumns(o,i.toIndex,"alignedGridChanged");break;case events_1.Events.EVENT_COLUMN_VISIBLE:var r=t;this.logger.log("onColumnEvent-> processing "+t.type+" visible = "+r.visible),this.columnController.setColumnsVisible(o,r.visible,"alignedGridChanged");break;case events_1.Events.EVENT_COLUMN_PINNED:r=t;this.logger.log("onColumnEvent-> processing "+t.type+" pinned = "+r.pinned),this.columnController.setColumnsPinned(o,r.pinned,"alignedGridChanged");break;case events_1.Events.EVENT_COLUMN_RESIZED:var s=t;e.forEach(function(e){n.logger.log("onColumnEvent-> processing "+t.type+" actualWidth = "+e.getActualWidth()),n.columnController.setColumnWidth(e.getColId(),e.getActualWidth(),!1,s.finished,"alignedGridChanged")})}var c=this.gridPanel.isVerticalScrollShowing();this.gridOptionsWrapper.getAlignedGrids().forEach(function(e){e.api.setAlwaysShowVerticalScroll(c)})}},__decorate([context_3.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_3.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],e.prototype,"columnController",void 0),__decorate([context_3.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],e.prototype,"eventService",void 0),__decorate([__param(0,context_2.Qualifier("loggerFactory")),__metadata("design:type",Function),__metadata("design:paramtypes",[logger_1.LoggerFactory]),__metadata("design:returntype",void 0)],e.prototype,"setBeans",null),__decorate([context_4.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"init",null),__decorate([context_1.Bean("alignedGridsService")],e)}();exports.AlignedGridsService=AlignedGridsService;