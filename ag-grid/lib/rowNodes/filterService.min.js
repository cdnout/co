"use strict";var __decorate=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var l=e.length-1;0<=l;l--)(n=e[l])&&(a=(o<3?n(a):3<o?n(t,r,a):n(t,r))||a);return 3<o&&a&&Object.defineProperty(t,r,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../context/context"),filterManager_1=require("../filter/filterManager"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),FilterService=function(){function e(){}return e.prototype.postConstruct=function(){this.doingTreeData=this.gridOptionsWrapper.isTreeData()},e.prototype.filter=function(e){var t=this.filterManager.isAnyFilterPresent();this.filterNodes(t,e)},e.prototype.filterNodes=function(r,e){function o(e,t){e.hasChildren()?(e.childrenAfterFilter=r&&!t?e.childrenAfterGroup.filter(function(e){var t=e.childrenAfterFilter&&0<e.childrenAfterFilter.length,e=e.data&&l.filterManager.doesRowPassFilter(e);return t||e}):e.childrenAfterGroup,l.setAllChildrenCount(e)):(e.childrenAfterFilter=e.childrenAfterGroup,e.setAllChildrenCount(null))}var a,l=this;this.doingTreeDataFiltering()?(a=function(e,t){if(e.childrenAfterGroup)for(var r=0;r<e.childrenAfterGroup.length;r++){var i=e.childrenAfterGroup[r],n=t||l.filterManager.doesRowPassFilter(i);i.childrenAfterGroup?a(e.childrenAfterGroup[r],n):o(i,n)}o(e,t)},e.executeFromRootNode(function(e){return a(e,!1)})):e.forEachChangedNodeDepthFirst(function(e){return o(e,!1)},!0)},e.prototype.setAllChildrenCountTreeData=function(e){var t=0;e.childrenAfterFilter.forEach(function(e){t++,t+=e.allChildrenCount}),e.setAllChildrenCount(t)},e.prototype.setAllChildrenCountGridGrouping=function(e){var t=0;e.childrenAfterFilter.forEach(function(e){e.group?t+=e.allChildrenCount:t++}),e.setAllChildrenCount(t)},e.prototype.setAllChildrenCount=function(e){this.doingTreeData?this.setAllChildrenCountTreeData(e):this.setAllChildrenCountGridGrouping(e)},e.prototype.doingTreeDataFiltering=function(){return this.gridOptionsWrapper.isTreeData()&&!this.gridOptionsWrapper.isExcludeChildrenWhenTreeDataFiltering()},__decorate([context_1.Autowired("filterManager"),__metadata("design:type",filterManager_1.FilterManager)],e.prototype,"filterManager",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"postConstruct",null),__decorate([context_1.Bean("filterService")],e)}();exports.FilterService=FilterService;