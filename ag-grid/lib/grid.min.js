"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var gridOptionsWrapper_1=require("./gridOptionsWrapper"),selectionController_1=require("./selectionController"),columnApi_1=require("./columnController/columnApi"),columnController_1=require("./columnController/columnController"),rowRenderer_1=require("./rendering/rowRenderer"),headerRootComp_1=require("./headerRendering/headerRootComp"),filterManager_1=require("./filter/filterManager"),valueService_1=require("./valueService/valueService"),eventService_1=require("./eventService"),gridPanel_1=require("./gridPanel/gridPanel"),gridApi_1=require("./gridApi"),columnFactory_1=require("./columnController/columnFactory"),displayedGroupCreator_1=require("./columnController/displayedGroupCreator"),expressionService_1=require("./valueService/expressionService"),templateService_1=require("./templateService"),popupService_1=require("./widgets/popupService"),logger_1=require("./logger"),columnUtils_1=require("./columnController/columnUtils"),autoWidthCalculator_1=require("./rendering/autoWidthCalculator"),horizontalResizeService_1=require("./headerRendering/horizontalResizeService"),context_1=require("./context/context"),csvCreator_1=require("./exporter/csvCreator"),gridCore_1=require("./gridCore"),standardMenu_1=require("./headerRendering/standardMenu"),dragAndDropService_1=require("./dragAndDrop/dragAndDropService"),dragService_1=require("./dragAndDrop/dragService"),sortController_1=require("./sortController"),focusedCellController_1=require("./focusedCellController"),mouseEventService_1=require("./gridPanel/mouseEventService"),cellNavigationService_1=require("./cellNavigationService"),filterStage_1=require("./rowModels/clientSide/filterStage"),sortStage_1=require("./rowModels/clientSide/sortStage"),flattenStage_1=require("./rowModels/clientSide/flattenStage"),events_1=require("./events"),infiniteRowModel_1=require("./rowModels/infinite/infiniteRowModel"),clientSideRowModel_1=require("./rowModels/clientSide/clientSideRowModel"),cellRendererFactory_1=require("./rendering/cellRendererFactory"),valueFormatterService_1=require("./rendering/valueFormatterService"),agCheckbox_1=require("./widgets/agCheckbox"),agRadioButton_1=require("./widgets/agRadioButton"),vanillaFrameworkOverrides_1=require("./vanillaFrameworkOverrides"),scrollVisibleService_1=require("./gridPanel/scrollVisibleService"),downloader_1=require("./exporter/downloader"),xmlFactory_1=require("./exporter/xmlFactory"),gridSerializer_1=require("./exporter/gridSerializer"),stylingService_1=require("./styling/stylingService"),columnHoverService_1=require("./rendering/columnHoverService"),columnAnimationService_1=require("./rendering/columnAnimationService"),sortService_1=require("./rowNodes/sortService"),filterService_1=require("./rowNodes/filterService"),autoGroupColService_1=require("./columnController/autoGroupColService"),paginationProxy_1=require("./rowModels/paginationProxy"),paginationAutoPageSizeService_1=require("./rowModels/paginationAutoPageSizeService"),immutableService_1=require("./rowModels/clientSide/immutableService"),constants_1=require("./constants"),valueCache_1=require("./valueService/valueCache"),changeDetectionService_1=require("./valueService/changeDetectionService"),alignedGridsService_1=require("./alignedGridsService"),pinnedRowModel_1=require("./rowModels/pinnedRowModel"),userComponentFactory_1=require("./components/framework/userComponentFactory"),userComponentRegistry_1=require("./components/framework/userComponentRegistry"),agComponentUtils_1=require("./components/framework/agComponentUtils"),componentMetadataProvider_1=require("./components/framework/componentMetadataProvider"),beans_1=require("./rendering/beans"),environment_1=require("./environment"),animationFrameService_1=require("./misc/animationFrameService"),navigationService_1=require("./gridPanel/navigationService"),maxDivHeightScaler_1=require("./rendering/maxDivHeightScaler"),selectableService_1=require("./rowNodes/selectableService"),autoHeightCalculator_1=require("./rendering/autoHeightCalculator"),paginationComp_1=require("./rowModels/pagination/paginationComp"),resizeObserverService_1=require("./misc/resizeObserverService"),zipContainer_1=require("./exporter/files/zip/zipContainer"),tooltipManager_1=require("./widgets/tooltipManager"),overlayWrapperComponent_1=require("./rendering/overlays/overlayWrapperComponent"),agGroupComponent_1=require("./widgets/agGroupComponent"),agDialog_1=require("./widgets/agDialog"),agPanel_1=require("./widgets/agPanel"),agInputTextField_1=require("./widgets/agInputTextField"),agInputTextArea_1=require("./widgets/agInputTextArea"),agSlider_1=require("./widgets/agSlider"),utils_1=require("./utils"),agColorPicker_1=require("./widgets/agColorPicker"),agInputNumberField_1=require("./widgets/agInputNumberField"),agInputRange_1=require("./widgets/agInputRange"),agSelect_1=require("./widgets/agSelect"),agAngleSelect_1=require("./widgets/agAngleSelect"),agToggleButton_1=require("./widgets/agToggleButton"),detailRowCompCache_1=require("./rendering/detailRowCompCache"),rowPosition_1=require("./entities/rowPosition"),cellPosition_1=require("./entities/cellPosition"),Grid=function(){function g(e,r,o){e||console.error("ag-Grid: no div element provided to the grid"),r||console.error("ag-Grid: no gridOptions provided to the grid"),this.gridOptions=r;var i=this.getRowModelClass(r),t=!utils_1._.missingOrEmpty(g.enterpriseBeans),n=this.extractModuleEntity(g.modulesToInclude,function(e){return e.beans||[]}),a=this.extractModuleEntity(g.modulesToInclude,function(e){return e.enterpriseBeans||[]}),l=this.extractModuleEntity(g.modulesToInclude,function(e){return e.enterpriseComponents||[]}),s=this.extractModuleEntity(g.modulesToInclude,function(e){return e.enterpriseDefaultComponents||[]}),c=o?o.frameworkOverrides:null;utils_1._.missing(c)&&(c=new vanillaFrameworkOverrides_1.VanillaFrameworkOverrides);var u=[];g.enterpriseBeans&&(u=u.concat(g.enterpriseBeans).concat(a)),g.frameworkBeans&&(u=u.concat(g.frameworkBeans));c={enterprise:t,gridOptions:r,eGridDiv:e,$scope:o?o.$scope:null,$compile:o?o.$compile:null,quickFilterOnScope:o?o.quickFilterOnScope:null,globalEventListener:o?o.globalEventListener:null,frameworkOverrides:c};o&&o.seedBeanInstances&&utils_1._.assign(c,o.seedBeanInstances);o=[{componentName:"AgCheckbox",theClass:agCheckbox_1.AgCheckbox},{componentName:"AgRadioButton",theClass:agRadioButton_1.AgRadioButton},{componentName:"AgToggleButton",theClass:agToggleButton_1.AgToggleButton},{componentName:"AgInputTextField",theClass:agInputTextField_1.AgInputTextField},{componentName:"AgInputTextArea",theClass:agInputTextArea_1.AgInputTextArea},{componentName:"AgInputNumberField",theClass:agInputNumberField_1.AgInputNumberField},{componentName:"AgInputRange",theClass:agInputRange_1.AgInputRange},{componentName:"AgSelect",theClass:agSelect_1.AgSelect},{componentName:"AgSlider",theClass:agSlider_1.AgSlider},{componentName:"AgAngleSelect",theClass:agAngleSelect_1.AgAngleSelect},{componentName:"AgColorPicker",theClass:agColorPicker_1.AgColorPicker},{componentName:"AgGridComp",theClass:gridPanel_1.GridPanel},{componentName:"AgHeaderRoot",theClass:headerRootComp_1.HeaderRootComp},{componentName:"AgPagination",theClass:paginationComp_1.PaginationComp},{componentName:"AgOverlayWrapper",theClass:overlayWrapperComponent_1.OverlayWrapperComponent},{componentName:"AgGroupComponent",theClass:agGroupComponent_1.AgGroupComponent},{componentName:"AgPanel",theClass:agPanel_1.AgPanel},{componentName:"AgDialog",theClass:agDialog_1.AgDialog}];g.enterpriseComponents&&(o=o.concat(g.enterpriseComponents).concat(l));var d={overrideBeans:u,seed:c,beans:[i,beans_1.Beans,rowPosition_1.RowPositionUtils,cellPosition_1.CellPositionUtils,paginationAutoPageSizeService_1.PaginationAutoPageSizeService,gridApi_1.GridApi,userComponentRegistry_1.UserComponentRegistry,agComponentUtils_1.AgComponentUtils,componentMetadataProvider_1.ComponentMetadataProvider,resizeObserverService_1.ResizeObserverService,userComponentRegistry_1.UserComponentRegistry,userComponentFactory_1.UserComponentFactory,maxDivHeightScaler_1.MaxDivHeightScaler,autoHeightCalculator_1.AutoHeightCalculator,cellRendererFactory_1.CellRendererFactory,horizontalResizeService_1.HorizontalResizeService,pinnedRowModel_1.PinnedRowModel,dragService_1.DragService,displayedGroupCreator_1.DisplayedGroupCreator,eventService_1.EventService,gridOptionsWrapper_1.GridOptionsWrapper,popupService_1.PopupService,selectionController_1.SelectionController,filterManager_1.FilterManager,columnController_1.ColumnController,paginationProxy_1.PaginationProxy,rowRenderer_1.RowRenderer,expressionService_1.ExpressionService,columnFactory_1.ColumnFactory,csvCreator_1.CsvCreator,downloader_1.Downloader,xmlFactory_1.XmlFactory,gridSerializer_1.GridSerializer,templateService_1.TemplateService,alignedGridsService_1.AlignedGridsService,navigationService_1.NavigationService,popupService_1.PopupService,valueCache_1.ValueCache,valueService_1.ValueService,logger_1.LoggerFactory,columnUtils_1.ColumnUtils,autoWidthCalculator_1.AutoWidthCalculator,standardMenu_1.StandardMenuFactory,dragAndDropService_1.DragAndDropService,columnApi_1.ColumnApi,focusedCellController_1.FocusedCellController,mouseEventService_1.MouseEventService,environment_1.Environment,cellNavigationService_1.CellNavigationService,filterStage_1.FilterStage,sortStage_1.SortStage,flattenStage_1.FlattenStage,filterService_1.FilterService,valueFormatterService_1.ValueFormatterService,stylingService_1.StylingService,scrollVisibleService_1.ScrollVisibleService,sortController_1.SortController,columnHoverService_1.ColumnHoverService,columnAnimationService_1.ColumnAnimationService,sortService_1.SortService,selectableService_1.SelectableService,autoGroupColService_1.AutoGroupColService,immutableService_1.ImmutableService,changeDetectionService_1.ChangeDetectionService,animationFrameService_1.AnimationFrameService,tooltipManager_1.TooltipManager,zipContainer_1.ZipContainer,detailRowCompCache_1.DetailRowCompCache].concat(n),components:o,enterpriseDefaultComponents:g.enterpriseDefaultComponents.concat(s),registeredModules:g.modulesToInclude.map(function(e){return e.moduleName}),debug:!!r.debug};this.logger=new logger_1.Logger("ag-Grid",function(){return r.debug});s=new logger_1.Logger("Context",function(){return d.debug});this.context=new context_1.Context(d,s);s=new gridCore_1.GridCore;this.context.wireBean(s),this.setColumnsAndData(),this.dispatchGridReadyEvent(r),this.logger.log("initialised successfully, enterprise = "+t)}return g.setEnterpriseBeans=function(e,r){g.enterpriseBeans=e,utils_1._.iterateObject(r,function(e,r){return g.RowModelClasses[e]=r})},g.setEnterpriseComponents=function(e){g.enterpriseComponents=e},g.setFrameworkBeans=function(e){g.frameworkBeans=e},g.setEnterpriseDefaultComponents=function(e){g.enterpriseDefaultComponents=e},g.addModule=function(e){var r;(r=g.modulesToInclude).push.apply(r,e)},g.prototype.extractModuleEntity=function(e,r){return[].concat.apply([],e.map(r))},g.prototype.setColumnsAndData=function(){var e=this.context.getBean("gridOptionsWrapper"),r=this.context.getBean("columnController"),o=this.context.getBean("rowModel"),i=e.getColumnDefs(),e=e.getRowData();utils_1._.missing(i)&&utils_1._.missing(e)||(utils_1._.exists(i)&&r.setColumnDefs(i,"gridInitializing"),utils_1._.exists(e)&&o.getType()===constants_1.Constants.ROW_MODEL_TYPE_CLIENT_SIDE&&o.setRowData(e))},g.prototype.dispatchGridReadyEvent=function(e){var r=this.context.getBean("eventService"),e={type:events_1.Events.EVENT_GRID_READY,api:e.api,columnApi:e.columnApi};r.dispatchEvent(e)},g.prototype.getRowModelClass=function(e){var r="enterprise"===(r=e.rowModelType)?constants_1.Constants.ROW_MODEL_TYPE_SERVER_SIDE:r;if(utils_1._.exists(r)){e=g.RowModelClasses[r];if(utils_1._.exists(e))return e;if("normal"===r)return console.warn("ag-Grid: normal rowModel deprecated. Should now be called client side row model instead."),clientSideRowModel_1.ClientSideRowModel;console.error("ag-Grid: could not find matching row model for rowModelType "+r),r===constants_1.Constants.ROW_MODEL_TYPE_VIEWPORT&&console.error("ag-Grid: rowModelType viewport is only available in ag-Grid Enterprise"),r===constants_1.Constants.ROW_MODEL_TYPE_SERVER_SIDE&&console.error("ag-Grid: rowModelType server side is only available in ag-Grid Enterprise")}return clientSideRowModel_1.ClientSideRowModel},g.prototype.destroy=function(){this.gridOptions.api.destroy()},g.enterpriseBeans=[],g.enterpriseComponents=[],g.enterpriseDefaultComponents=[],g.modulesToInclude=[],g.RowModelClasses={infinite:infiniteRowModel_1.InfiniteRowModel,clientSide:clientSideRowModel_1.ClientSideRowModel},g}();exports.Grid=Grid;