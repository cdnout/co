"use strict";var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,p=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(p=(n<3?i(p):3<n?i(t,r,p):i(t,r))||p);return 3<n&&p&&Object.defineProperty(t,r,p),p},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var HeaderRowType,component_1=require("../widgets/component"),context_1=require("../context/context"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),columnController_1=require("../columnController/columnController"),column_1=require("../entities/column"),eventService_1=require("../eventService"),events_1=require("../events"),headerWrapperComp_1=require("./header/headerWrapperComp"),headerGroupWrapperComp_1=require("./headerGroup/headerGroupWrapperComp"),filterManager_1=require("../filter/filterManager"),gridApi_1=require("../gridApi"),constants_1=require("../constants"),utils_1=require("../utils"),floatingFilterWrapper_1=require("../filter/floating/floatingFilterWrapper");!function(e){e[e.COLUMN_GROUP=0]="COLUMN_GROUP",e[e.COLUMN=1]="COLUMN",e[e.FLOATING_FILTER=2]="FLOATING_FILTER"}(HeaderRowType=exports.HeaderRowType||(exports.HeaderRowType={}));var HeaderRowComp=function(n){function e(e,t,r,o){var i=n.call(this,'<div class="ag-header-row" role="row"/>')||this;return i.headerComps={},i.dept=e,i.type=t,i.pinned=r,i.dropTarget=o,i}return __extends(e,n),e.prototype.forEachHeaderElement=function(t){var r=this;Object.keys(this.headerComps).forEach(function(e){t(r.headerComps[e])})},e.prototype.destroy=function(){var e=Object.keys(this.headerComps);this.removeAndDestroyChildComponents(e),n.prototype.destroy.call(this)},e.prototype.removeAndDestroyChildComponents=function(e){var r=this;e.forEach(function(e){var t=r.headerComps[e];r.getGui().removeChild(t.getGui()),t.destroy(),delete r.headerComps[e]})},e.prototype.onRowHeightChanged=function(){for(var e,t=this.columnController.getHeaderRowCount(),r=[],o=0,i=this.columnController.isPivotMode()?(o=0,e=this.gridOptionsWrapper.getPivotGroupHeaderHeight(),this.gridOptionsWrapper.getPivotHeaderHeight()):(this.gridOptionsWrapper.isFloatingFilter()&&t++,o=this.gridOptionsWrapper.isFloatingFilter()?1:0,e=this.gridOptionsWrapper.getGroupHeaderHeight(),this.gridOptionsWrapper.getHeaderHeight()),n=t-(1+o),p=0;p<n;p++)r.push(e);r.push(i);for(p=0;p<o;p++)r.push(this.gridOptionsWrapper.getFloatingFiltersHeight());for(var s=0,p=0;p<this.dept;p++)s+=r[p];this.getGui().style.top=s+"px",this.getGui().style.height=r[this.dept]+"px"},e.prototype.init=function(){this.onRowHeightChanged(),this.onVirtualColumnsChanged(),this.setWidth(),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_HEADER_HEIGHT,this.onRowHeightChanged.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_PIVOT_HEADER_HEIGHT,this.onRowHeightChanged.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_GROUP_HEADER_HEIGHT,this.onRowHeightChanged.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_PIVOT_GROUP_HEADER_HEIGHT,this.onRowHeightChanged.bind(this)),this.addDestroyableEventListener(this.gridOptionsWrapper,gridOptionsWrapper_1.GridOptionsWrapper.PROP_FLOATING_FILTERS_HEIGHT,this.onRowHeightChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_VIRTUAL_COLUMNS_CHANGED,this.onVirtualColumnsChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED,this.onDisplayedColumnsChanged.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_COLUMN_RESIZED,this.onColumnResized.bind(this)),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_GRID_COLUMNS_CHANGED,this.onGridColumnsChanged.bind(this))},e.prototype.onColumnResized=function(){this.setWidth()},e.prototype.setWidth=function(){var e=this.getWidthForRow();this.getGui().style.width=e+"px"},e.prototype.getWidthForRow=function(){return this.gridOptionsWrapper.getDomLayout()===constants_1.Constants.DOM_LAYOUT_PRINT?utils_1._.missing(this.pinned)?this.columnController.getContainerWidth(column_1.Column.PINNED_RIGHT)+this.columnController.getContainerWidth(column_1.Column.PINNED_LEFT)+this.columnController.getContainerWidth(null):0:this.columnController.getContainerWidth(this.pinned)},e.prototype.onGridColumnsChanged=function(){this.removeAndDestroyAllChildComponents()},e.prototype.removeAndDestroyAllChildComponents=function(){var e=Object.keys(this.headerComps);this.removeAndDestroyChildComponents(e)},e.prototype.onDisplayedColumnsChanged=function(){this.onVirtualColumnsChanged(),this.setWidth()},e.prototype.getItemsAtDept=function(){var t=this;if(this.gridOptionsWrapper.getDomLayout()!==constants_1.Constants.DOM_LAYOUT_PRINT)return this.columnController.getVirtualHeaderGroupRow(this.pinned,this.type==HeaderRowType.FLOATING_FILTER?this.dept-1:this.dept);if(utils_1._.missing(this.pinned)){var r=[];return[column_1.Column.PINNED_LEFT,null,column_1.Column.PINNED_RIGHT].forEach(function(e){e=t.columnController.getVirtualHeaderGroupRow(e,t.type==HeaderRowType.FLOATING_FILTER?t.dept-1:t.dept);r=r.concat(e)}),r}return[]},e.prototype.onVirtualColumnsChanged=function(){var p,s=this,a=Object.keys(this.headerComps),e=this.getItemsAtDept(),d=this.gridOptionsWrapper.isEnsureDomOrder();e.forEach(function(e){var t,r,o,i,n;e.isEmptyGroup()||(t=e.getUniqueId(),r=s.getGui(),o=0<=a.indexOf(t),p=(o?(utils_1._.removeFromArray(a,t),n=(i=s.headerComps[t]).getGui(),d&&utils_1._.ensureDomOrder(r,n,p)):(i=s.createHeaderComp(e),n=(s.headerComps[t]=i).getGui(),d?utils_1._.insertWithDomOrder(r,n,p):r.appendChild(n)),n))}),this.removeAndDestroyChildComponents(a)},e.prototype.createHeaderComp=function(e){var t;switch(this.type){case HeaderRowType.COLUMN:t=new headerWrapperComp_1.HeaderWrapperComp(e,this.dropTarget,this.pinned);break;case HeaderRowType.COLUMN_GROUP:t=new headerGroupWrapperComp_1.HeaderGroupWrapperComp(e,this.dropTarget,this.pinned);break;case HeaderRowType.FLOATING_FILTER:t=new floatingFilterWrapper_1.FloatingFilterWrapper(e)}return this.getContext().wireBean(t),t},__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],e.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],e.prototype,"gridApi",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],e.prototype,"columnController",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],e.prototype,"eventService",void 0),__decorate([context_1.Autowired("filterManager"),__metadata("design:type",filterManager_1.FilterManager)],e.prototype,"filterManager",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"init",null),e}(component_1.Component);exports.HeaderRowComp=HeaderRowComp;