"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(s=(n<3?r(s):3<n?r(t,o,s):r(t,o))||s);return 3<n&&s&&Object.defineProperty(t,o,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../../widgets/component"),context_1=require("../../context/context"),column_1=require("../../entities/column"),dragAndDropService_1=require("../../dragAndDrop/dragAndDropService"),columnApi_1=require("../../columnController/columnApi"),columnController_1=require("../../columnController/columnController"),horizontalResizeService_1=require("../horizontalResizeService"),gridOptionsWrapper_1=require("../../gridOptionsWrapper"),cssClassApplier_1=require("../cssClassApplier"),setLeftFeature_1=require("../../rendering/features/setLeftFeature"),gridApi_1=require("../../gridApi"),sortController_1=require("../../sortController"),eventService_1=require("../../eventService"),userComponentFactory_1=require("../../components/framework/userComponentFactory"),agCheckbox_1=require("../../widgets/agCheckbox"),componentAnnotations_1=require("../../widgets/componentAnnotations"),selectAllFeature_1=require("./selectAllFeature"),events_1=require("../../events"),columnHoverService_1=require("../../rendering/columnHoverService"),beans_1=require("../../rendering/beans"),hoverFeature_1=require("../hoverFeature"),touchListener_1=require("../../widgets/touchListener"),utils_1=require("../../utils"),HeaderWrapperComp=function(r){function n(e,t,o){var i=r.call(this,n.TEMPLATE)||this;return i.column=e,i.dragSourceDropTarget=t,i.pinned=o,i}return __extends(n,r),n.prototype.getColumn=function(){return this.column},n.prototype.getComponentHolder=function(){return this.column.getColDef()},n.prototype.init=function(){var e=this.getComponentHolder(),t=this.columnController.getDisplayNameForColumn(this.column,"header",!0),o=e.sortable,i=this.menuFactory.isMenuEnabled(this.column)&&!e.suppressMenu;this.appendHeaderComp(t,o,i),this.setupWidth(),this.setupMovingCss(),this.setupTooltip(),this.setupResize(),this.setupMenuClass(),this.setupSortableClass(o),this.addColumnHoverListener(),this.addFeature(this.getContext(),new hoverFeature_1.HoverFeature([this.column],this.getGui())),this.addDestroyableEventListener(this.column,column_1.Column.EVENT_FILTER_ACTIVE_CHANGED,this.onFilterChanged.bind(this)),this.onFilterChanged(),this.addFeature(this.getContext(),new selectAllFeature_1.SelectAllFeature(this.cbSelectAll,this.column));o=new setLeftFeature_1.SetLeftFeature(this.column,this.getGui(),this.beans);o.init(),this.addDestroyFunc(o.destroy.bind(o)),this.addAttributes(),cssClassApplier_1.CssClassApplier.addHeaderClassesFromColDef(e,this.getGui(),this.gridOptionsWrapper,this.column,null)},n.prototype.addColumnHoverListener=function(){this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_COLUMN_HOVER_CHANGED,this.onColumnHover.bind(this)),this.onColumnHover()},n.prototype.onColumnHover=function(){var e=this.columnHoverService.isHovered(this.column);utils_1._.addOrRemoveCssClass(this.getGui(),"ag-column-hover",e)},n.prototype.setupSortableClass=function(e){e&&(e=this.getGui(),utils_1._.addCssClass(e,"ag-header-cell-sortable"))},n.prototype.onFilterChanged=function(){var e=this.column.isFilterActive();utils_1._.addOrRemoveCssClass(this.getGui(),"ag-header-cell-filtered",e)},n.prototype.appendHeaderComp=function(e,t,o){var i=this,o={column:this.column,displayName:e,enableSorting:t,enableMenu:o,showColumnMenu:function(e){i.gridApi.showColumnMenuAfterButtonClick(i.column,e)},progressSort:function(e){i.sortController.progressSort(i.column,!!e,"uiColumnSorted")},setSort:function(e,t){i.sortController.setSortForColumn(i.column,e,!!t,"uiColumnSorted")},api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsWrapper.getContext()},e=this.afterHeaderCompCreated.bind(this,e);this.userComponentFactory.newHeaderComponent(o).then(e)},n.prototype.afterHeaderCompCreated=function(e,t){this.appendChild(t),this.setupMove(t.getGui(),e)},n.prototype.onColumnMovingChanged=function(){this.column.isMoving()?utils_1._.addCssClass(this.getGui(),"ag-header-cell-moving"):utils_1._.removeCssClass(this.getGui(),"ag-header-cell-moving")},n.prototype.setupMove=function(e,t){var o,i=this;this.gridOptionsWrapper.isSuppressMovableColumns()||this.getComponentHolder().suppressMovable||this.column.getColDef().lockPosition||e&&(o={type:dragAndDropService_1.DragSourceType.HeaderCell,eElement:e,dragItemCallback:function(){return i.createDragItem()},dragItemName:t,dragSourceDropTarget:this.dragSourceDropTarget,dragStarted:function(){return i.column.setMoving(!0,"uiColumnMoved")},dragStopped:function(){return i.column.setMoving(!1,"uiColumnMoved")}},this.dragAndDropService.addDragSource(o,!0),this.addDestroyFunc(function(){return i.dragAndDropService.removeDragSource(o)}))},n.prototype.createDragItem=function(){var e={};return e[this.column.getId()]=this.column.isVisible(),{columns:[this.column],visibleState:e}},n.prototype.setupResize=function(){var e,t=this,o=this.getComponentHolder();this.eResize&&(this.column.isResizable()?(e=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)}),this.addDestroyFunc(e),this.gridOptionsWrapper.isSuppressAutoSize()||o.suppressAutoSize||(this.addDestroyableEventListener(this.eResize,"dblclick",function(){t.columnController.autoSizeColumn(t.column,"uiColumnResized")}),o=new touchListener_1.TouchListener(this.eResize),this.addDestroyableEventListener(o,touchListener_1.TouchListener.EVENT_DOUBLE_TAP,function(){t.columnController.autoSizeColumn(t.column,"uiColumnResized")}),this.addDestroyFunc(o.destroy.bind(o)))):utils_1._.removeFromParent(this.eResize))},n.prototype.onResizing=function(e,t){t=this.normaliseResizeAmount(t),t=this.resizeStartWidth+t;this.columnController.setColumnWidth(this.column,t,this.resizeWithShiftKey,e,"uiColumnDragged"),e&&utils_1._.removeCssClass(this.getGui(),"ag-column-resizing")},n.prototype.onResizeStart=function(e){this.resizeStartWidth=this.column.getActualWidth(),this.resizeWithShiftKey=e,utils_1._.addCssClass(this.getGui(),"ag-column-resizing")},n.prototype.getTooltipText=function(){return this.getComponentHolder().headerTooltip},n.prototype.setupTooltip=function(){var e=this.getTooltipText();null!=e&&(this.gridOptionsWrapper.isEnableBrowserTooltips()?this.getGui().setAttribute("title",e):this.beans.tooltipManager.registerTooltip(this))},n.prototype.setupMovingCss=function(){this.addDestroyableEventListener(this.column,column_1.Column.EVENT_MOVING_CHANGED,this.onColumnMovingChanged.bind(this)),this.onColumnMovingChanged()},n.prototype.addAttributes=function(){this.getGui().setAttribute("col-id",this.column.getColId())},n.prototype.setupWidth=function(){this.addDestroyableEventListener(this.column,column_1.Column.EVENT_WIDTH_CHANGED,this.onColumnWidthChanged.bind(this)),this.onColumnWidthChanged()},n.prototype.setupMenuClass=function(){this.addDestroyableEventListener(this.column,column_1.Column.EVENT_MENU_VISIBLE_CHANGED,this.onMenuVisible.bind(this)),this.onColumnWidthChanged()},n.prototype.onMenuVisible=function(){this.addOrRemoveCssClass("ag-column-menu-visible",this.column.isMenuVisible())},n.prototype.onColumnWidthChanged=function(){this.getGui().style.width=this.column.getActualWidth()+"px"},n.prototype.normaliseResizeAmount=function(e){return this.gridOptionsWrapper.isEnableRtl()?this.pinned!==column_1.Column.PINNED_LEFT&&(e*=-1):this.pinned===column_1.Column.PINNED_RIGHT&&(e*=-1),e},n.TEMPLATE='<div class="ag-header-cell" role="presentation" unselectable="on"><div ref="eResize" class="ag-header-cell-resize" role="presentation"></div><ag-checkbox ref="cbSelectAll" class="ag-header-select-all" role="presentation"></ag-checkbox></div>',__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],n.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("dragAndDropService"),__metadata("design:type",dragAndDropService_1.DragAndDropService)],n.prototype,"dragAndDropService",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],n.prototype,"columnController",void 0),__decorate([context_1.Autowired("horizontalResizeService"),__metadata("design:type",horizontalResizeService_1.HorizontalResizeService)],n.prototype,"horizontalResizeService",void 0),__decorate([context_1.Autowired("menuFactory"),__metadata("design:type",Object)],n.prototype,"menuFactory",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],n.prototype,"gridApi",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],n.prototype,"columnApi",void 0),__decorate([context_1.Autowired("sortController"),__metadata("design:type",sortController_1.SortController)],n.prototype,"sortController",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],n.prototype,"eventService",void 0),__decorate([context_1.Autowired("userComponentFactory"),__metadata("design:type",userComponentFactory_1.UserComponentFactory)],n.prototype,"userComponentFactory",void 0),__decorate([context_1.Autowired("columnHoverService"),__metadata("design:type",columnHoverService_1.ColumnHoverService)],n.prototype,"columnHoverService",void 0),__decorate([context_1.Autowired("beans"),__metadata("design:type",beans_1.Beans)],n.prototype,"beans",void 0),__decorate([componentAnnotations_1.RefSelector("eResize"),__metadata("design:type",HTMLElement)],n.prototype,"eResize",void 0),__decorate([componentAnnotations_1.RefSelector("cbSelectAll"),__metadata("design:type",agCheckbox_1.AgCheckbox)],n.prototype,"cbSelectAll",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],n.prototype,"init",null),n}(component_1.Component);exports.HeaderWrapperComp=HeaderWrapperComp;