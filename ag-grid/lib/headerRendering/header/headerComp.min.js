"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__decorate=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(i=(s<3?r(i):3<s?r(t,o,i):r(t,o))||i);return 3<s&&i&&Object.defineProperty(t,o,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../../widgets/component"),column_1=require("../../entities/column"),context_1=require("../../context/context"),gridOptionsWrapper_1=require("../../gridOptionsWrapper"),sortController_1=require("../../sortController"),touchListener_1=require("../../widgets/touchListener"),eventService_1=require("../../eventService"),componentAnnotations_1=require("../../widgets/componentAnnotations"),events_1=require("../../events"),utils_1=require("../../utils"),HeaderComp=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastMovingChanged=0,e}return __extends(o,t),o.prototype.init=function(e){var t=(t=utils_1._.firstExistingValue(e.template,o.TEMPLATE))&&t.trim?t.trim():t;this.setTemplate(t),this.params=e,this.setupTap(),this.setupIcons(e.column),this.setupMenu(),this.setupSort(),this.setupFilterIcon(),this.setupText(e.displayName)},o.prototype.setupText=function(e){e=utils_1._.escape(e);this.eText&&(this.eText.innerHTML=e)},o.prototype.setupIcons=function(e){this.addInIcon("sortAscending",this.eSortAsc,e),this.addInIcon("sortDescending",this.eSortDesc,e),this.addInIcon("sortUnSort",this.eSortNone,e),this.addInIcon("menu",this.eMenu,e),this.addInIcon("filter",this.eFilter,e)},o.prototype.addInIcon=function(e,t,o){null!=t&&(o=utils_1._.createIconNoSpan(e,this.gridOptionsWrapper,o),t.appendChild(o))},o.prototype.setupTap=function(){var e,t,o,n,r,s=this,i=this.gridOptionsWrapper;i.isSuppressTouch()||(e=new touchListener_1.TouchListener(this.getGui(),!0),o=(t=i.isSuppressMenuHide())&&utils_1._.exists(this.eMenu),n=o?new touchListener_1.TouchListener(this.eMenu,!0):e,this.params.enableMenu&&(r=o?"EVENT_TAP":"EVENT_LONG_TAP",this.addDestroyableEventListener(n,touchListener_1.TouchListener[r],function(e){i.getApi().showColumnMenuAfterMouseClick(s.params.column,e.touchStart)})),this.params.enableSorting&&this.addDestroyableEventListener(e,touchListener_1.TouchListener.EVENT_TAP,function(e){e=e.touchStart.target;t&&s.eMenu.contains(e)||s.sortController.progressSort(s.params.column,!1,"uiColumnSorted")}),this.addDestroyFunc(function(){return e.destroy()}),o&&this.addDestroyFunc(function(){return n.destroy()}))},o.prototype.setupMenu=function(){var e,t=this;this.eMenu&&(e=this.gridOptionsWrapper.isSuppressMenuHide(),!this.params.enableMenu||utils_1._.isUserAgentIPad()&&!e?utils_1._.removeFromParent(this.eMenu):(this.addDestroyableEventListener(this.eMenu,"click",function(){return t.showMenu(t.eMenu)}),e||(this.eMenu.style.opacity="0",this.addGuiEventListener("mouseover",function(){t.eMenu.style.opacity="1"}),this.addGuiEventListener("mouseout",function(){t.eMenu.style.opacity="0"})),(e=this.eMenu.style).transition="opacity 0.2s, border 0.2s",e["-webkit-transition"]="opacity 0.2s, border 0.2s"))},o.prototype.showMenu=function(e){this.menuFactory.showMenuAfterButtonClick(this.params.column,e)},o.prototype.removeSortIcons=function(){utils_1._.removeFromParent(this.eSortAsc),utils_1._.removeFromParent(this.eSortDesc),utils_1._.removeFromParent(this.eSortNone),utils_1._.removeFromParent(this.eSortOrder)},o.prototype.setupSort=function(){var n,r=this;this.params.enableSorting?(n=this.gridOptionsWrapper.isMultiSortKeyCtrl(),this.addDestroyableEventListener(this.params.column,column_1.Column.EVENT_MOVING_CHANGED,function(){r.lastMovingChanged=(new Date).getTime()}),this.eLabel&&this.addDestroyableEventListener(this.eLabel,"click",function(e){var t=r.params.column.isMoving(),o=(new Date).getTime()-r.lastMovingChanged<50;t||o||(e=n?e.ctrlKey||e.metaKey:e.shiftKey,r.params.progressSort(e))}),this.addDestroyableEventListener(this.params.column,column_1.Column.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.onSortChanged(),this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_SORT_CHANGED,this.setMultiSortOrder.bind(this)),this.setMultiSortOrder()):this.removeSortIcons()},o.prototype.onSortChanged=function(){var e;utils_1._.addOrRemoveCssClass(this.getGui(),"ag-header-cell-sorted-asc",this.params.column.isSortAscending()),utils_1._.addOrRemoveCssClass(this.getGui(),"ag-header-cell-sorted-desc",this.params.column.isSortDescending()),utils_1._.addOrRemoveCssClass(this.getGui(),"ag-header-cell-sorted-none",this.params.column.isSortNone()),this.eSortAsc&&utils_1._.addOrRemoveCssClass(this.eSortAsc,"ag-hidden",!this.params.column.isSortAscending()),this.eSortDesc&&utils_1._.addOrRemoveCssClass(this.eSortDesc,"ag-hidden",!this.params.column.isSortDescending()),this.eSortNone&&(e=!this.params.column.getColDef().unSortIcon&&!this.gridOptionsWrapper.isUnSortIcon(),utils_1._.addOrRemoveCssClass(this.eSortNone,"ag-hidden",e||!this.params.column.isSortNone()))},o.prototype.setMultiSortOrder=function(){var e,t,o;this.eSortOrder&&(e=this.params.column,t=(o=this.sortController.getColumnsWithSortingOrdered()).indexOf(e),o=1<o.length,o=e.isSorting()&&o,utils_1._.setDisplayed(this.eSortOrder,o),0<=t?this.eSortOrder.innerHTML=(t+1).toString():utils_1._.clearElement(this.eSortOrder))},o.prototype.setupFilterIcon=function(){this.eFilter&&(this.addDestroyableEventListener(this.params.column,column_1.Column.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.onFilterChanged())},o.prototype.onFilterChanged=function(){var e=this.params.column.isFilterActive();utils_1._.addOrRemoveCssClass(this.eFilter,"ag-hidden",!e)},o.TEMPLATE='<div class="ag-cell-label-container" role="presentation">  <span ref="eMenu" class="ag-header-icon ag-header-cell-menu-button" aria-hidden="true"></span>  <div ref="eLabel" class="ag-header-cell-label" role="presentation" unselectable="on">    <span ref="eText" class="ag-header-cell-text" role="columnheader" unselectable="on"></span>    <span ref="eFilter" class="ag-header-icon ag-filter-icon" aria-hidden="true"></span>    <span ref="eSortOrder" class="ag-header-icon ag-sort-order" aria-hidden="true"></span>    <span ref="eSortAsc" class="ag-header-icon ag-sort-ascending-icon" aria-hidden="true"></span>    <span ref="eSortDesc" class="ag-header-icon ag-sort-descending-icon" aria-hidden="true"></span>    <span ref="eSortNone" class="ag-header-icon ag-sort-none-icon" aria-hidden="true"></span>  </div></div>',__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],o.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("sortController"),__metadata("design:type",sortController_1.SortController)],o.prototype,"sortController",void 0),__decorate([context_1.Autowired("menuFactory"),__metadata("design:type",Object)],o.prototype,"menuFactory",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],o.prototype,"eventService",void 0),__decorate([componentAnnotations_1.RefSelector("eFilter"),__metadata("design:type",HTMLElement)],o.prototype,"eFilter",void 0),__decorate([componentAnnotations_1.RefSelector("eSortAsc"),__metadata("design:type",HTMLElement)],o.prototype,"eSortAsc",void 0),__decorate([componentAnnotations_1.RefSelector("eSortDesc"),__metadata("design:type",HTMLElement)],o.prototype,"eSortDesc",void 0),__decorate([componentAnnotations_1.RefSelector("eSortNone"),__metadata("design:type",HTMLElement)],o.prototype,"eSortNone",void 0),__decorate([componentAnnotations_1.RefSelector("eSortOrder"),__metadata("design:type",HTMLElement)],o.prototype,"eSortOrder",void 0),__decorate([componentAnnotations_1.RefSelector("eMenu"),__metadata("design:type",HTMLElement)],o.prototype,"eMenu",void 0),__decorate([componentAnnotations_1.RefSelector("eLabel"),__metadata("design:type",HTMLElement)],o.prototype,"eLabel",void 0),__decorate([componentAnnotations_1.RefSelector("eText"),__metadata("design:type",HTMLElement)],o.prototype,"eText",void 0),o}(component_1.Component);exports.HeaderComp=HeaderComp;