"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,r){var n,l=arguments.length,o=l<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;0<=s;s--)(n=t[s])&&(o=(l<3?n(o):3<l?n(e,i,o):n(e,i))||o);return 3<l&&o&&Object.defineProperty(e,i,o),o},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var baseFilter_1=require("./baseFilter"),componentAnnotations_1=require("../widgets/componentAnnotations"),utils_1=require("../utils"),TextFilter=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.getDefaultType=function(){return baseFilter_1.BaseFilter.CONTAINS},n.prototype.customInit=function(){this.comparator=this.filterParams.textCustomComparator||n.DEFAULT_COMPARATOR,this.formatter=this.filterParams.textFormatter||(1==this.filterParams.caseSensitive?n.DEFAULT_FORMATTER:n.DEFAULT_LOWERCASE_FORMATTER),e.prototype.customInit.call(this)},n.prototype.modelFromFloatingFilter=function(t){return{type:this.selectedFilter,filter:t,filterType:"text"}},n.prototype.getApplicableFilterTypes=function(){return[baseFilter_1.BaseFilter.EQUALS,baseFilter_1.BaseFilter.NOT_EQUAL,baseFilter_1.BaseFilter.STARTS_WITH,baseFilter_1.BaseFilter.ENDS_WITH,baseFilter_1.BaseFilter.CONTAINS,baseFilter_1.BaseFilter.NOT_CONTAINS]},n.prototype.bodyTemplate=function(t){var e=this.translate.bind(this);return'<div class="ag-filter-body">\n            <div class="ag-input-text-wrapper">\n                <input class="ag-filter-filter" id='+(t==baseFilter_1.FilterConditionType.MAIN?"filterText":"filterConditionText")+' type="text" placeholder="'+e("filterOoo","Filter...")+'"/>\n            </div>\n        </div>'},n.prototype.initialiseFilterBodyUi=function(t){e.prototype.initialiseFilterBodyUi.call(this,t),this.addFilterChangedListener(t),this.setFilter(this.filterConditionText,baseFilter_1.FilterConditionType.CONDITION),this.setFilterType(this.selectedFilterCondition,baseFilter_1.FilterConditionType.CONDITION)},n.prototype.addFilterChangedListener=function(t){var e=this,i=t===baseFilter_1.FilterConditionType.MAIN?this.eFilterTextField:this.eFilterConditionTextField,r=this.getDebounceMs(this.filterParams),r=utils_1._.debounce(function(){return e.onFilterTextFieldChanged(t)},r);this.addDestroyableEventListener(i,"input",r)},n.prototype.refreshFilterBodyUi=function(t){var e=t===baseFilter_1.FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition;this.eFilterConditionTextField&&this.addFilterChangedListener(baseFilter_1.FilterConditionType.CONDITION);t=t===baseFilter_1.FilterConditionType.MAIN?this.eFilterTextField:this.eFilterConditionTextField;t&&(e=!this.doesFilterHaveHiddenInput(e)&&e!==baseFilter_1.BaseFilter.EMPTY,utils_1._.setVisible(t,e))},n.prototype.afterGuiAttached=function(){this.eFilterTextField.focus()},n.prototype.filterValues=function(t){return t===baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText},n.prototype.individualFilterPasses=function(t,e){var i=e==baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText,r=e==baseFilter_1.FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition,n=this.customFilterOptions[r];if(!n||null==i&&!n.hideFilterInput)return i?this.checkIndividualFilter(t,r,i):e===baseFilter_1.FilterConditionType.MAIN||"AND"===this.conditionValue;t=this.filterParams.valueGetter(t.node),t=this.formatter(t);return n.test(i,t)},n.prototype.checkIndividualFilter=function(t,e,i){t=this.filterParams.valueGetter(t.node),i=this.formatter(i);if(null==t||void 0===t)return e===baseFilter_1.BaseFilter.NOT_EQUAL||e===baseFilter_1.BaseFilter.NOT_CONTAINS;t=this.formatter(t);return this.comparator(e,t,i)},n.prototype.onFilterTextFieldChanged=function(t){var e=(t===baseFilter_1.FilterConditionType.MAIN?this.eFilterTextField:this.eFilterConditionTextField).value,i=t===baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText,r=utils_1._.makeNull(e);r&&""===r.trim()&&(r=null),i!==r&&(e=r&&1!=this.filterParams.caseSensitive?r.toLowerCase():r,i=i&&1!=this.filterParams.caseSensitive?i.toLowerCase():i,t===baseFilter_1.FilterConditionType.MAIN?this.filterText=this.formatter(r):this.filterConditionText=this.formatter(r),i!==e&&this.onFilterChanged())},n.prototype.setFilter=function(t,e){t=utils_1._.makeNull(t),e===baseFilter_1.FilterConditionType.MAIN?t?(this.filterText=this.formatter(t),this.eFilterTextField&&(this.eFilterTextField.value=t)):(this.filterText=null,this.eFilterTextField&&(this.eFilterTextField.value=null)):t?(this.filterConditionText=this.formatter(t),this.eFilterConditionTextField&&(this.eFilterConditionTextField.value=t)):(this.filterConditionText=null,this.eFilterConditionTextField&&(this.eFilterConditionTextField.value=null))},n.prototype.getFilter=function(){return this.filterText},n.prototype.resetState=function(t){void 0===t&&(t=!1),t||(this.setFilterType(this.defaultFilter,baseFilter_1.FilterConditionType.MAIN),this.setFilter(null,baseFilter_1.FilterConditionType.MAIN)),this.setFilterType(this.defaultFilter,baseFilter_1.FilterConditionType.CONDITION),this.setFilter(null,baseFilter_1.FilterConditionType.CONDITION)},n.prototype.serialize=function(t){var e=t===baseFilter_1.FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition,t=t===baseFilter_1.FilterConditionType.MAIN?this.filterText:this.filterConditionText;return{type:e||this.defaultFilter,filter:t,filterType:"text"}},n.prototype.parse=function(t,e){this.setFilterType(t.type,e),this.setFilter(t.filter,e)},n.prototype.setType=function(t,e){this.setFilterType(t,e)},n.DEFAULT_FORMATTER=function(t){return t},n.DEFAULT_LOWERCASE_FORMATTER=function(t){return null==t?null:t.toString().toLowerCase()},n.DEFAULT_COMPARATOR=function(t,e,i){switch(t){case n.CONTAINS:return 0<=e.indexOf(i);case n.NOT_CONTAINS:return-1===e.indexOf(i);case n.EQUALS:return e===i;case n.NOT_EQUAL:return e!=i;case n.STARTS_WITH:return 0===e.indexOf(i);case n.ENDS_WITH:var r=e.lastIndexOf(i);return 0<=r&&r===e.length-i.length;default:return console.warn("invalid filter type "+t),!1}},__decorate([componentAnnotations_1.QuerySelector("#filterText"),__metadata("design:type",HTMLInputElement)],n.prototype,"eFilterTextField",void 0),__decorate([componentAnnotations_1.QuerySelector("#filterConditionText"),__metadata("design:type",HTMLInputElement)],n.prototype,"eFilterConditionTextField",void 0),n}(baseFilter_1.ComparableBaseFilter);exports.TextFilter=TextFilter;