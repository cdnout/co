"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__decorate=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var l=t.length-1;0<=l;l--)(i=t[l])&&(a=(r<3?i(a):3<r?i(e,o,a):i(e,o))||a);return 3<r&&a&&Object.defineProperty(e,o,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../../context/context"),column_1=require("../../entities/column"),setLeftFeature_1=require("../../rendering/features/setLeftFeature"),component_1=require("../../widgets/component"),componentAnnotations_1=require("../../widgets/componentAnnotations"),gridOptionsWrapper_1=require("../../gridOptionsWrapper"),beans_1=require("../../rendering/beans"),hoverFeature_1=require("../../headerRendering/hoverFeature"),events_1=require("../../events"),eventService_1=require("../../eventService"),columnHoverService_1=require("../../rendering/columnHoverService"),utils_1=require("../../utils"),userComponentFactory_1=require("../../components/framework/userComponentFactory"),gridApi_1=require("../../gridApi"),columnApi_1=require("../../columnController/columnApi"),filterManager_1=require("./../filterManager"),readOnlyFloatingFilter_1=require("./provided/readOnlyFloatingFilter"),FloatingFilterWrapper=function(o){function n(t){var e=o.call(this,n.TEMPLATE)||this;return e.column=t,e}return __extends(n,o),n.prototype.postConstruct=function(){this.setupFloatingFilter(),this.setupWidth(),this.setupLeftPositioning(),this.setupColumnHover(),this.addFeature(this.getContext(),new hoverFeature_1.HoverFeature([this.column],this.getGui())),this.addDestroyableEventListener(this.eButtonShowMainFilter,"click",this.showParentFilter.bind(this))},n.prototype.setupFloatingFilter=function(){var e=this;this.column.getColDef().filter?(this.floatingFilterCompPromise=this.getFloatingFilterInstance(),this.floatingFilterCompPromise?this.floatingFilterCompPromise.then(function(t){t?(e.setupWithFloatingFilter(t),e.setupSyncWithFilter()):e.setupEmpty()}):this.setupEmpty()):this.setupEmpty()},n.prototype.setupLeftPositioning=function(){var t=new setLeftFeature_1.SetLeftFeature(this.column,this.getGui(),this.beans);t.init(),this.addDestroyFunc(t.destroy.bind(t))},n.prototype.setupSyncWithFilter=function(){function t(t){var e=o.filterManager.getFilterComponent(o.column,"NO_UI").resolveNow(null,function(t){return t.getModel()});o.onParentModelChanged(e,t)}var o=this;this.addDestroyableEventListener(this.column,column_1.Column.EVENT_FILTER_CHANGED,t),this.filterManager.isFilterActive(this.column)&&t(null)},n.prototype.showParentFilter=function(){this.menuFactory.showMenuAfterButtonClick(this.column,this.eButtonShowMainFilter,"filterMenuTab",["filterMenuTab"])},n.prototype.setupColumnHover=function(){this.addDestroyableEventListener(this.eventService,events_1.Events.EVENT_COLUMN_HOVER_CHANGED,this.onColumnHover.bind(this)),this.onColumnHover()},n.prototype.onColumnHover=function(){var t=this.columnHoverService.isHovered(this.column);utils_1._.addOrRemoveCssClass(this.getGui(),"ag-column-hover",t)},n.prototype.setupWidth=function(){this.addDestroyableEventListener(this.column,column_1.Column.EVENT_WIDTH_CHANGED,this.onColumnWidthChanged.bind(this)),this.onColumnWidthChanged()},n.prototype.onColumnWidthChanged=function(){this.getGui().style.width=this.column.getActualWidth()+"px"},n.prototype.setupWithFloatingFilter=function(t){function e(){t.destroy&&t.destroy()}var o,n;this.isAlive()?(this.addDestroyFunc(e),o=t.getGui(),utils_1._.addOrRemoveCssClass(this.eFloatingFilterBody,"ag-floating-filter-body",!this.suppressFilterButton),utils_1._.addOrRemoveCssClass(this.eFloatingFilterBody,"ag-floating-filter-full-body",this.suppressFilterButton),utils_1._.setDisplayed(this.eButtonWrapper,!this.suppressFilterButton),n=utils_1._.createIconNoSpan("filter",this.gridOptionsWrapper,this.column),this.eButtonShowMainFilter.appendChild(n),this.eFloatingFilterBody.appendChild(o),t.afterGuiAttached&&t.afterGuiAttached()):e()},n.prototype.parentFilterInstance=function(t){this.filterManager.getFilterComponent(this.column,"NO_UI").then(t)},n.prototype.getFloatingFilterInstance=function(){var t=this.column.getColDef();"string"==typeof t.filter?o=n.filterToFloatingFilterNames[t.filter]:!0===t.filter&&(o=this.gridOptionsWrapper.isEnterprise()?"agSetColumnFloatingFilter":"agTextColumnFloatingFilter");var e=this.filterManager.createFilterParams(this.column,this.column.getColDef()),e=this.userComponentFactory.createFinalParams(t,"filter",e),e={api:this.gridApi,column:this.column,filterParams:e,currentParentModel:this.currentParentModel.bind(this),parentFilterInstance:this.parentFilterInstance.bind(this),onFloatingFilterChanged:this.onFloatingFilterChanged.bind(this),suppressFilterButton:!1};this.suppressFilterButton=!!t.floatingFilterComponentParams&&!!t.floatingFilterComponentParams.suppressFilterButton;var o=this.userComponentFactory.newFloatingFilterComponent(t,e,o);return o||(t=this.getFilterComponentPrototype(t))&&t.prototype&&t.prototype.getModelAsString&&(e=this.userComponentFactory.createUserComponentFromConcreteClass(readOnlyFloatingFilter_1.ReadOnlyFloatingFilter,e),o=utils_1.Promise.resolve(e)),o},n.prototype.createDynamicParams=function(){return{column:this.column,colDef:this.column.getColDef(),api:this.gridApi,columnApi:this.columnApi}},n.prototype.getFilterComponentPrototype=function(t){t=this.userComponentFactory.lookupComponentClassDef(t,"filter",this.createDynamicParams());return t?t.component:null},n.prototype.setupEmpty=function(){utils_1._.setDisplayed(this.eButtonWrapper,!1)},n.prototype.currentParentModel=function(){return this.filterManager.getFilterComponent(this.column,"NO_UI").resolveNow(null,function(t){return t.getModel()})},n.prototype.onParentModelChanged=function(e,o){this.floatingFilterCompPromise&&this.floatingFilterCompPromise.then(function(t){t.onParentModelChanged(e,o)})},n.prototype.onFloatingFilterChanged=function(){console.warn("ag-Grid: since version 21.x, how floating filters are implemented has changed. Instead of calling params.onFloatingFilterChanged(), get a reference to the main filter via params.parentFilterInstance() and then set a value on the parent filter directly.")},n.filterToFloatingFilterNames={set:"agSetColumnFloatingFilter",agSetColumnFilter:"agSetColumnFloatingFilter",number:"agNumberColumnFloatingFilter",agNumberColumnFilter:"agNumberColumnFloatingFilter",date:"agDateColumnFloatingFilter",agDateColumnFilter:"agDateColumnFloatingFilter",text:"agTextColumnFloatingFilter",agTextColumnFilter:"agTextColumnFloatingFilter"},n.TEMPLATE='<div class="ag-header-cell" role="presentation">\n            <div ref="eFloatingFilterBody" role="columnheader"></div>\n            <div class="ag-floating-filter-button" ref="eButtonWrapper" role="presentation">\n                <button type="button" ref="eButtonShowMainFilter"></button>\n            </div>\n        </div>',__decorate([context_1.Autowired("columnHoverService"),__metadata("design:type",columnHoverService_1.ColumnHoverService)],n.prototype,"columnHoverService",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],n.prototype,"eventService",void 0),__decorate([context_1.Autowired("beans"),__metadata("design:type",beans_1.Beans)],n.prototype,"beans",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],n.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("userComponentFactory"),__metadata("design:type",userComponentFactory_1.UserComponentFactory)],n.prototype,"userComponentFactory",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],n.prototype,"gridApi",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],n.prototype,"columnApi",void 0),__decorate([context_1.Autowired("filterManager"),__metadata("design:type",filterManager_1.FilterManager)],n.prototype,"filterManager",void 0),__decorate([context_1.Autowired("menuFactory"),__metadata("design:type",Object)],n.prototype,"menuFactory",void 0),__decorate([componentAnnotations_1.RefSelector("eFloatingFilterBody"),__metadata("design:type",HTMLElement)],n.prototype,"eFloatingFilterBody",void 0),__decorate([componentAnnotations_1.RefSelector("eButtonWrapper"),__metadata("design:type",HTMLElement)],n.prototype,"eButtonWrapper",void 0),__decorate([componentAnnotations_1.RefSelector("eButtonShowMainFilter"),__metadata("design:type",HTMLElement)],n.prototype,"eButtonShowMainFilter",void 0),__decorate([context_1.PostConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],n.prototype,"postConstruct",null),n}(component_1.Component);exports.FloatingFilterWrapper=FloatingFilterWrapper;