"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,n){var r,o=arguments.length,l=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(r=t[s])&&(l=(o<3?r(l):3<o?r(e,i,l):r(e,i))||l);return 3<o&&l&&Object.defineProperty(e,i,l),l},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var FilterConditionType,component_1=require("../widgets/component"),componentAnnotations_1=require("../widgets/componentAnnotations"),context_1=require("../context/context"),gridOptionsWrapper_1=require("../gridOptionsWrapper"),utils_1=require("../utils");!function(t){t[t.MAIN=0]="MAIN",t[t.CONDITION=1]="CONDITION"}(FilterConditionType=exports.FilterConditionType||(exports.FilterConditionType={}));var DEFAULT_TRANSLATIONS={loadingOoo:"Loading...",empty:"Choose One",equals:"Equals",notEqual:"Not equal",lessThan:"Less than",greaterThan:"Greater than",inRange:"In range",lessThanOrEqual:"Less than or equals",greaterThanOrEqual:"Greater than or equals",filterOoo:"Filter...",contains:"Contains",notContains:"Not contains",startsWith:"Starts with",endsWith:"Ends with",searchOoo:"Search...",selectAll:"Select All",applyFilter:"Apply Filter",clearFilter:"Clear Filter",andCondition:"AND",orCondition:"OR"},BaseFilter=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.customFilterOptions={},t}return __extends(t,e),t.prototype.init=function(t){var e,i=this;this.filterParams=t,this.defaultFilter=this.filterParams.defaultOption,t.filterOptions&&t.filterOptions.forEach(function(t){"string"!=typeof t&&(t.displayKey?t.displayName?t.test?i.customFilterOptions[t.displayKey]=t:console.warn("ag-Grid: ignoring FilterOptionDef as it doesn't contain a 'test'"):console.warn("ag-Grid: ignoring FilterOptionDef as it doesn't contain a 'displayName'"):console.warn("ag-Grid: ignoring FilterOptionDef as it doesn't contain a 'displayKey'"))}),this.filterParams.filterOptions&&!this.defaultFilter&&("string"==typeof(e=this.filterParams.filterOptions[0])?this.defaultFilter=e:e.displayKey?this.defaultFilter=e.displayKey:console.warn("ag-Grid: invalid FilterOptionDef supplied as it doesn't contain a 'displayKey'")),this.customInit(),this.selectedFilter=this.defaultFilter,this.selectedFilterCondition=this.defaultFilter,this.clearActive=!0===t.clearButton,this.applyActive=!0===t.applyButton||!0===t.apply,this.newRowsActionKeep="keep"===t.newRowsAction,this.setTemplate(this.generateTemplate()),utils_1._.setVisible(this.eApplyButton,this.applyActive),this.applyActive&&this.addDestroyableEventListener(this.eApplyButton,"click",this.filterParams.filterChangedCallback),utils_1._.setVisible(this.eClearButton,this.clearActive),this.clearActive&&this.addDestroyableEventListener(this.eClearButton,"click",this.onClearButton.bind(this));t=this.applyActive||this.clearActive;utils_1._.setVisible(this.eButtonsPanel,t),this.initialiseFilterBodyUi(FilterConditionType.MAIN),this.refreshFilterBodyUi(FilterConditionType.MAIN)},t.prototype.onClearButton=function(){this.setModel(null),this.onFilterChanged()},t.prototype.floatingFilter=function(t){""!==t?(t=this.modelFromFloatingFilter(t),this.setModel(t)):this.resetState(),this.onFilterChanged()},t.prototype.onNewRowsLoaded=function(){this.newRowsActionKeep||this.resetState()},t.prototype.getModel=function(){return this.isFilterActive()?this.isFilterConditionActive(FilterConditionType.CONDITION)?{condition1:this.serialize(FilterConditionType.MAIN),condition2:this.serialize(FilterConditionType.CONDITION),operator:this.conditionValue}:this.serialize(FilterConditionType.MAIN):null},t.prototype.getNullableModel=function(){return this.isFilterConditionActive(FilterConditionType.CONDITION)?{condition1:this.serialize(FilterConditionType.MAIN),condition2:this.serialize(FilterConditionType.CONDITION),operator:this.conditionValue}:this.serialize(FilterConditionType.MAIN)},t.prototype.setModel=function(t){var e;t?t.operator?(e=t,this.parse(e.condition1,FilterConditionType.MAIN),this.parse(e.condition2,FilterConditionType.CONDITION),this.conditionValue=e.operator):(this.resetState(),this.parse(t,FilterConditionType.MAIN)):this.resetState(),this.redrawCondition(),this.refreshFilterBodyUi(FilterConditionType.MAIN),this.refreshFilterBodyUi(FilterConditionType.CONDITION)},t.prototype.doOnFilterChanged=function(t){void 0===t&&(t=!1),this.filterParams.filterModifiedCallback();t=this.applyActive&&t,t=!this.applyActive||t;return t&&this.filterParams.filterChangedCallback(),this.refreshFilterBodyUi(FilterConditionType.MAIN),this.refreshFilterBodyUi(FilterConditionType.CONDITION),t},t.prototype.onFilterChanged=function(t){void 0===t&&(t=!1),this.doOnFilterChanged(t),this.redrawCondition(),this.refreshFilterBodyUi(FilterConditionType.MAIN),this.refreshFilterBodyUi(FilterConditionType.CONDITION)},t.prototype.redrawCondition=function(){var t,e,i=this,n=this.eFilterBodyWrapper.querySelector(".ag-filter-condition");!n&&this.isFilterActive()&&this.acceptsBooleanLogic()?(this.eConditionWrapper=utils_1._.loadTemplate(this.createConditionTemplate(FilterConditionType.CONDITION)),this.eFilterBodyWrapper.appendChild(this.eConditionWrapper),this.wireQuerySelectors(),t=(e=this.refreshOperatorUi()).andButton,e=e.orButton,this.addDestroyableEventListener(t,"change",function(){i.conditionValue="AND",i.onFilterChanged()}),this.addDestroyableEventListener(e,"change",function(){i.conditionValue="OR",i.onFilterChanged()}),this.initialiseFilterBodyUi(FilterConditionType.CONDITION)):n&&!this.isFilterActive()?(this.conditionValue="AND",this.resetState(!0),this.eFilterBodyWrapper.removeChild(this.eConditionWrapper),this.eConditionWrapper=null):(this.refreshFilterBodyUi(FilterConditionType.CONDITION),this.eConditionWrapper&&this.refreshOperatorUi())},t.prototype.refreshOperatorUi=function(){var t=this.eConditionWrapper.querySelector(".and"),e=this.eConditionWrapper.querySelector(".or");return this.conditionValue=null==this.conditionValue?"AND":this.conditionValue,t.checked="AND"===this.conditionValue,e.checked="OR"===this.conditionValue,{andButton:t,orButton:e}},t.prototype.onFloatingFilterChanged=function(t){var e=t;return null==e?this.setModel(null):this.isFilterConditionActive(FilterConditionType.CONDITION)?(t={condition1:e.model,condition2:this.serialize(FilterConditionType.CONDITION),operator:this.conditionValue},this.setModel(t)):this.setModel(e?e.model:null),this.doOnFilterChanged(!!e&&e.apply)},t.prototype.generateFilterHeader=function(t){return""},t.prototype.generateTemplate=function(){var t=this.translate.bind(this),e=this.createConditionBody(FilterConditionType.MAIN);return"<div>\n                    <div class='ag-filter-body-wrapper'>"+(this.acceptsBooleanLogic()?this.wrapCondition(e):e)+'</div>\n                    <div class="ag-filter-apply-panel" id="applyPanel">\n                        <button type="button" id="clearButton">'+t("clearFilter")+'</button>\n                        <button type="button" id="applyButton">'+t("applyFilter")+"</button>\n                    </div>\n                </div>"},t.prototype.acceptsBooleanLogic=function(){return!1},t.prototype.wrapCondition=function(t){return this.isFilterActive()?""+t+this.createConditionTemplate(FilterConditionType.CONDITION):t},t.prototype.createConditionTemplate=function(t){return'<div class="ag-filter-condition">\n            <input id="andId" type="radio" class="and" name="booleanLogic" value='+this.translate("AND")+'\n                   checked="checked" /><label style="display: inline" for="andId">'+this.translate("andCondition")+'</label>\n            <input id="orId" type="radio" class="or" name="booleanLogic" value="OR" /><label style="display: inline"\n                   for="orId">'+this.translate("orCondition")+"</label>\n            <div>"+this.createConditionBody(t)+"</div>\n        </div>"},t.prototype.createConditionBody=function(t){var e=this.bodyTemplate(t);return this.generateFilterHeader(t)+e},t.prototype.translate=function(t){var e=this.gridOptionsWrapper.getLocaleTextFunc(),i=DEFAULT_TRANSLATIONS[t];return!i&&this.customFilterOptions[t]&&(i=this.customFilterOptions[t].displayName),e(t,i)},t.prototype.getDebounceMs=function(t){return this.applyActive?(null!=t.debounceMs&&console.warn("ag-Grid: debounceMs is ignored when applyButton = true"),0):null!=t.debounceMs?t.debounceMs:500},t.prototype.doesFilterHaveHiddenInput=function(t){t=this.customFilterOptions[t];return t&&t.hideFilterInput},t.EMPTY="empty",t.EQUALS="equals",t.NOT_EQUAL="notEqual",t.LESS_THAN="lessThan",t.LESS_THAN_OR_EQUAL="lessThanOrEqual",t.GREATER_THAN="greaterThan",t.GREATER_THAN_OR_EQUAL="greaterThanOrEqual",t.IN_RANGE="inRange",t.CONTAINS="contains",t.NOT_CONTAINS="notContains",t.STARTS_WITH="startsWith",t.ENDS_WITH="endsWith",__decorate([componentAnnotations_1.QuerySelector("#applyPanel"),__metadata("design:type",HTMLElement)],t.prototype,"eButtonsPanel",void 0),__decorate([componentAnnotations_1.QuerySelector(".ag-filter-body-wrapper"),__metadata("design:type",HTMLElement)],t.prototype,"eFilterBodyWrapper",void 0),__decorate([componentAnnotations_1.QuerySelector("#applyButton"),__metadata("design:type",HTMLElement)],t.prototype,"eApplyButton",void 0),__decorate([componentAnnotations_1.QuerySelector("#clearButton"),__metadata("design:type",HTMLElement)],t.prototype,"eClearButton",void 0),__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),t}(component_1.Component),ComparableBaseFilter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.doesFilterPass=function(t){var e=this.individualFilterPasses(t,FilterConditionType.MAIN);if(null==this.eTypeConditionSelector)return e;t=this.individualFilterPasses(t,FilterConditionType.CONDITION);return"AND"===this.conditionValue?e&&t:e||t},t.prototype.init=function(t){e.prototype.init.call(this,t),this.suppressAndOrCondition=t.suppressAndOrCondition},t.prototype.customInit=function(){this.defaultFilter||(this.defaultFilter=this.getDefaultType())},t.prototype.acceptsBooleanLogic=function(){return!0!==this.suppressAndOrCondition},t.prototype.generateFilterHeader=function(t){var e=this,i=this.getApplicableFilterTypes(),n=this.filterParams.filterOptions,n=(n||i).map(function(t){t="string"==typeof t?t:t.displayKey;return'<option value="'+t+'">'+e.translate(t)+"</option>"}),i=1==n.length?"disabled":"",t=t==FilterConditionType.MAIN?"filterType":"filterConditionType";return n.length<=0?"":'<div>\n                <select class="ag-filter-select" id="'+t+'" '+i+">\n                    "+n.join("")+"\n                </select>\n            </div>"},t.prototype.initialiseFilterBodyUi=function(t){var e=this;t===FilterConditionType.MAIN?(this.setFilterType(this.selectedFilter,t),this.addDestroyableEventListener(this.eTypeSelector,"change",function(){return e.onFilterTypeChanged(t)})):(this.setFilterType(this.selectedFilterCondition,t),this.addDestroyableEventListener(this.eTypeConditionSelector,"change",function(){return e.onFilterTypeChanged(t)}))},t.prototype.onFilterTypeChanged=function(t){var e=this.selectedFilter;t===FilterConditionType.MAIN?this.selectedFilter=this.eTypeSelector.value:this.selectedFilterCondition=this.eTypeConditionSelector.value,this.refreshFilterBodyUi(t);e=this.doesFilterHaveHiddenInput(e);(this.isFilterActive()||e)&&(this.selectedFilter===BaseFilter.EMPTY&&this.resetState(),this.onFilterChanged())},t.prototype.isFilterActive=function(){if(this.doesFilterHaveHiddenInput(this.selectedFilter))return!0;var t=this.filterValues(FilterConditionType.MAIN);return t&&this.selectedFilter===BaseFilter.IN_RANGE?null!=t[0]&&null!=t[1]:null!=t},t.prototype.setFilterType=function(t,e){e===FilterConditionType.MAIN?(this.selectedFilter=t,this.eTypeSelector&&(this.eTypeSelector.value=t)):(this.selectedFilterCondition=t,this.eTypeConditionSelector&&(this.eTypeConditionSelector.value=t))},t.prototype.isFilterConditionActive=function(t){return null!=this.filterValues(t)},__decorate([componentAnnotations_1.QuerySelector("#filterType"),__metadata("design:type",HTMLSelectElement)],t.prototype,"eTypeSelector",void 0),__decorate([componentAnnotations_1.QuerySelector("#filterConditionType"),__metadata("design:type",HTMLSelectElement)],t.prototype,"eTypeConditionSelector",void 0),t}(exports.BaseFilter=BaseFilter),ScalarBaseFilter=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.nullComparator=function(n){var r=this;return function(t,e){if(null==e){var i=r.translateNull(n);if(r.selectedFilter===BaseFilter.EMPTY)return 0;if(r.selectedFilter===BaseFilter.EQUALS)return i?0:1;if(r.selectedFilter===BaseFilter.GREATER_THAN)return i?1:-1;if(r.selectedFilter===BaseFilter.GREATER_THAN_OR_EQUAL)return i?1:-1;if(r.selectedFilter===BaseFilter.LESS_THAN_OR_EQUAL)return i?-1:1;if(r.selectedFilter===BaseFilter.LESS_THAN)return i?-1:1;if(r.selectedFilter===BaseFilter.NOT_EQUAL)return i?1:0}return r.comparator()(t,e)}},e.prototype.getDefaultType=function(){return BaseFilter.EQUALS},e.prototype.translateNull=function(t){t=-1<t.indexOf("greater")?"greaterThan":-1<t.indexOf("lessThan")?"lessThan":"equals";return(this.filterParams.nullComparator&&this.filterParams.nullComparator[t]?this.filterParams.nullComparator:e.DEFAULT_NULL_COMPARATOR)[t]},e.prototype.individualFilterPasses=function(t,e){return this.doIndividualFilterPasses(t,e,e===FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition)},e.prototype.doIndividualFilterPasses=function(t,e,i){var n=this.filterParams.valueGetter(t.node),r=this.filterValues(e),o=Array.isArray(r)?r[0]:r,t=this.customFilterOptions[i];if(t&&(null!=o||t.hideFilterInput))return t.test(o,n);if(null==o)return e===FilterConditionType.MAIN||"AND"===this.conditionValue;e=this.nullComparator(i),o=e(o,n);if(i===BaseFilter.EMPTY)return!1;if(i===BaseFilter.EQUALS)return 0===o;if(i===BaseFilter.GREATER_THAN)return 0<o;if(i===BaseFilter.GREATER_THAN_OR_EQUAL)return 0<=o;if(i===BaseFilter.LESS_THAN_OR_EQUAL)return o<=0;if(i===BaseFilter.LESS_THAN)return o<0;if(i===BaseFilter.NOT_EQUAL)return 0!=o;n=e(r[1],n);if(i===BaseFilter.IN_RANGE)return this.filterParams.inRangeInclusive?0<=o&&n<=0:0<o&&n<0;throw new Error("Unexpected type of filter: "+i)},e.DEFAULT_NULL_COMPARATOR={equals:!1,lessThan:!1,greaterThan:!1},e}(exports.ComparableBaseFilter=ComparableBaseFilter);exports.ScalarBaseFilter=ScalarBaseFilter;