"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),__decorate=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,l=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;0<=a;a--)(i=t[a])&&(l=(r<3?i(l):3<r?i(e,n,l):i(e,n))||l);return 3<r&&l&&Object.defineProperty(e,n,l),l},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../context/context"),dateFilter_1=require("./dateFilter"),componentAnnotations_1=require("../widgets/componentAnnotations"),userComponentFactory_1=require("../components/framework/userComponentFactory"),component_1=require("../widgets/component"),constants_1=require("../constants"),utils_1=require("../utils"),InputTextFloatingFilterComp=function(e){function t(){var t=e.call(this,'<div class="ag-input-text-wrapper"><input ref="eColumnFloatingFilter" class="ag-floating-filter-input"></div>')||this;return t.lastKnownModel=null,t}return __extends(t,e),t.prototype.init=function(t){this.onFloatingFilterChanged=t.onFloatingFilterChanged,this.currentParentModel=t.currentParentModel;var e=null!=t.debounceMs?t.debounceMs:500,e=utils_1._.debounce(this.syncUpWithParentFilter.bind(this),e);this.addDestroyableEventListener(this.eColumnFloatingFilter,"input",e),this.addDestroyableEventListener(this.eColumnFloatingFilter,"keypress",e),this.addDestroyableEventListener(this.eColumnFloatingFilter,"keydown",e);t=t.column.getDefinition();t.filterParams&&t.filterParams.filterOptions&&1===t.filterParams.filterOptions.length&&"inRange"===t.filterParams.filterOptions[0]&&(this.eColumnFloatingFilter.disabled=!0)},t.prototype.onParentModelChanged=function(t,e){if(null!=e)return this.eColumnFloatingFilter.value=this.parseAsText(e.condition1)+" "+e.operator+" "+this.parseAsText(e.condition2),this.eColumnFloatingFilter.disabled=!0,this.lastKnownModel=null,this.eColumnFloatingFilter.title=this.eColumnFloatingFilter.value,void(this.eColumnFloatingFilter.style.cursor="default");this.eColumnFloatingFilter.disabled=!1,this.equalModels(this.lastKnownModel,t)?this.lastKnownModel||t||(this.eColumnFloatingFilter.value=""):(this.lastKnownModel=t,(t=this.asFloatingFilterText(t))!==this.eColumnFloatingFilter.value&&(this.eColumnFloatingFilter.value=t,this.eColumnFloatingFilter.title=""))},t.prototype.syncUpWithParentFilter=function(t){var e=this.asParentModel();this.equalModels(this.lastKnownModel,e)||(utils_1._.isKeyPressed(t,constants_1.Constants.KEY_ENTER)?this.onFloatingFilterChanged({model:e,apply:!0}):this.onFloatingFilterChanged({model:e,apply:!1}))&&(this.lastKnownModel=e)},t.prototype.equalModels=function(t,e){return!!utils_1._.referenceCompare(t,e)||!(!t||!e)&&(!Array.isArray(t)&&!Array.isArray(e)&&(utils_1._.referenceCompare(t.type,e.type)&&utils_1._.referenceCompare(t.filter,e.filter)&&utils_1._.referenceCompare(t.filterTo,e.filterTo)&&utils_1._.referenceCompare(t.filterType,e.filterType)))},__decorate([componentAnnotations_1.RefSelector("eColumnFloatingFilter"),__metadata("design:type",HTMLInputElement)],t.prototype,"eColumnFloatingFilter",void 0),t}(component_1.Component),TextFloatingFilterComp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.asFloatingFilterText=function(t){return t?t.filter:""},e.prototype.asParentModel=function(){return{type:this.currentParentModel().type,filter:this.eColumnFloatingFilter.value,filterType:"text"}},e.prototype.parseAsText=function(t){return this.asFloatingFilterText(t)},e}(exports.InputTextFloatingFilterComp=InputTextFloatingFilterComp);exports.TextFloatingFilterComp=TextFloatingFilterComp;var DateFloatingFilterComp=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastKnownModel=null,t}return __extends(t,e),t.prototype.init=function(n){this.onFloatingFilterChanged=n.onFloatingFilterChanged,this.currentParentModel=n.currentParentModel;var t=null!=n.debounceMs?n.debounceMs:500,t={onDateChanged:utils_1._.debounce(this.onDateChanged.bind(this),t),filterParams:n.column.getColDef().filterParams};this.dateComponentPromise=this.userComponentFactory.newDateComponent(t);var o=utils_1._.loadTemplate("<div></div>");this.dateComponentPromise.then(function(t){o.appendChild(t.getGui());var e=n.column.getDefinition(),e=e.filterParams&&e.filterParams.filterOptions&&1===e.filterParams.filterOptions.length&&"inRange"===e.filterParams.filterOptions[0];t.eDateInput&&(t.eDateInput.disabled=e)}),o.style.width="100%",o.style.height="100%",this.setTemplateFromElement(o)},t.prototype.onDateChanged=function(){var t=this.currentParentModel(),e=this.asParentModel();this.equalModels(t,e)||(this.onFloatingFilterChanged({model:e,apply:!0}),this.lastKnownModel=e)},t.prototype.equalModels=function(t,e){return!!utils_1._.referenceCompare(t,e)||!(!t||!e)&&(!Array.isArray(t)&&!Array.isArray(e)&&(utils_1._.referenceCompare(t.type,e.type)&&utils_1._.referenceCompare(t.dateFrom,e.dateFrom)&&utils_1._.referenceCompare(t.dateTo,e.dateTo)&&utils_1._.referenceCompare(t.filterType,e.filterType)))},t.prototype.asParentModel=function(){var t=this.currentParentModel(),e=this.dateComponentPromise.resolveNow(null,function(t){return t.getDate()}),e=utils_1._.serializeDateToYyyyMmDd(dateFilter_1.DateFilter.removeTimezone(e),"-");return{type:t.type,dateFrom:e,dateTo:t?t.dateTo:null,filterType:"date"}},t.prototype.onParentModelChanged=function(e){var n=this;this.lastKnownModel=e,this.dateComponentPromise.then(function(t){e&&e.dateFrom?(n.enrichDateInput(e.type,e.dateFrom,e.dateTo,t),t.setDate(utils_1._.parseYyyyMmDdToDate(e.dateFrom,"-"))):t.setDate(null)})},t.prototype.enrichDateInput=function(t,e,n,o){o.eDateInput&&("inRange"===t?(o.eDateInput.title=e+" to "+n,o.eDateInput.disabled=!0):(o.eDateInput.title="",o.eDateInput.disabled=!1))},__decorate([context_1.Autowired("userComponentFactory"),__metadata("design:type",userComponentFactory_1.UserComponentFactory)],t.prototype,"userComponentFactory",void 0),t}(component_1.Component);exports.DateFloatingFilterComp=DateFloatingFilterComp;var NumberFloatingFilterComp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.asFloatingFilterText=function(t){var e=this.currentParentModel();return null==t&&null==e?"":null==t&&null!=e&&"inRange"!==e.type?(this.eColumnFloatingFilter.disabled=!1,""):null!=e&&"inRange"===e.type?(this.eColumnFloatingFilter.disabled=!0,this.parseAsText(e)):(this.eColumnFloatingFilter.disabled=!1,this.parseAsText(t))},e.prototype.parseAsText=function(t){var e=this.asNumber(t.filter);if(t.type&&"inRange"===t.type){t=this.asNumber(t.filterTo);return(e?e+"":"")+"-"+(t?t+"":"")}return null!=e?e+"":""},e.prototype.asParentModel=function(){var t=this.currentParentModel(),e=this.asNumber(this.eColumnFloatingFilter.value),n=this.eColumnFloatingFilter.value,o=null,o=null==e&&""===n?null:null==e?t.filter:e;return{type:t.type,filter:o,filterTo:t?t.filterTo:null,filterType:"number"}},e.prototype.asNumber=function(t){if(null==t)return null;if(""===t)return null;t=Number(t);return!utils_1._.isNumeric(t)?null:t},e}(InputTextFloatingFilterComp);exports.NumberFloatingFilterComp=NumberFloatingFilterComp;var SetFloatingFilterComp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),this.eColumnFloatingFilter.disabled=!0},t.prototype.asFloatingFilterText=function(t){if(this.eColumnFloatingFilter.disabled=!0,!t)return"";var e=t instanceof Array?t:t.values;if(0===e.length)return"";t=10<e.length?e.slice(0,10).concat("..."):e;return"("+e.length+") "+t.join(",")},t.prototype.parseAsText=function(t){return this.asFloatingFilterText(t)},t.prototype.asParentModel=function(){return null==this.eColumnFloatingFilter.value||""===this.eColumnFloatingFilter.value?{values:[],filterType:"set"}:{values:this.eColumnFloatingFilter.value.split(","),filterType:"set"}},t.prototype.equalModels=function(t,e){return!1},t}(InputTextFloatingFilterComp);exports.SetFloatingFilterComp=SetFloatingFilterComp;var ReadModelAsStringFloatingFilterComp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t),this.eColumnFloatingFilter.disabled=!0},t.prototype.onParentModelChanged=function(t){this.eColumnFloatingFilter.value=this.asFloatingFilterText(this.currentParentModel())},t.prototype.asFloatingFilterText=function(t){return t},t.prototype.parseAsText=function(t){return t},t.prototype.asParentModel=function(){return null},t}(InputTextFloatingFilterComp);exports.ReadModelAsStringFloatingFilterComp=ReadModelAsStringFloatingFilterComp;