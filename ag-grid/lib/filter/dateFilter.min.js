"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__decorate=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;0<=s;s--)(n=t[s])&&(a=(r<3?n(a):3<r?n(e,o,a):n(e,o))||a);return 3<r&&a&&Object.defineProperty(e,o,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../widgets/component"),componentAnnotations_1=require("../widgets/componentAnnotations"),baseFilter_1=require("./baseFilter"),context_1=require("../context/context"),userComponentFactory_1=require("../components/framework/userComponentFactory"),utils_1=require("../utils"),DateFilter=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.modelFromFloatingFilter=function(t){return{dateFrom:t,dateTo:this.getDateTo(),type:this.selectedFilter,filterType:"date"}},o.prototype.getApplicableFilterTypes=function(){return[baseFilter_1.BaseFilter.EQUALS,baseFilter_1.BaseFilter.GREATER_THAN,baseFilter_1.BaseFilter.LESS_THAN,baseFilter_1.BaseFilter.NOT_EQUAL,baseFilter_1.BaseFilter.IN_RANGE]},o.prototype.bodyTemplate=function(t){return'<div class="ag-filter-body">\n                    <div class="ag-filter-date-from" id="'+(t==baseFilter_1.FilterConditionType.MAIN?"filterDateFromPanel":"filterDateFromConditionPanel")+'">\n                    </div>\n                    <div class="ag-filter-date-to" id="'+(t==baseFilter_1.FilterConditionType.MAIN?"filterDateToPanel":"filterDateToConditionPanel")+'">\n                    </div>\n                </div>'},o.prototype.initialiseFilterBodyUi=function(t){e.prototype.initialiseFilterBodyUi.call(this,t),this.createComponents(t),t===baseFilter_1.FilterConditionType.MAIN?(this.setDateFrom_date(this.dateFrom,baseFilter_1.FilterConditionType.MAIN),this.setDateTo_date(this.dateTo,baseFilter_1.FilterConditionType.MAIN),this.setFilterType(this.selectedFilter,baseFilter_1.FilterConditionType.MAIN)):(this.setDateFrom_date(this.dateFromCondition,baseFilter_1.FilterConditionType.CONDITION),this.setDateTo_date(this.dateToCondition,baseFilter_1.FilterConditionType.CONDITION),this.setFilterType(this.selectedFilterCondition,baseFilter_1.FilterConditionType.CONDITION))},o.prototype.createComponents=function(e){var o=this,t={onDateChanged:function(){o.onDateChanged(e)},filterParams:this.filterParams};this.userComponentFactory.newDateComponent(t).then(function(t){e===baseFilter_1.FilterConditionType.MAIN?o.dateToComponent=t:o.dateToConditionComponent=t;t=t.getGui();e===baseFilter_1.FilterConditionType.MAIN?(o.eDateToPanel.appendChild(t),o.dateToComponent.afterGuiAttached&&o.dateToComponent.afterGuiAttached()):(o.eDateToConditionPanel.appendChild(t),o.dateToConditionComponent.afterGuiAttached&&o.dateToConditionComponent.afterGuiAttached())}),this.userComponentFactory.newDateComponent(t).then(function(t){e===baseFilter_1.FilterConditionType.MAIN?o.dateFromComponent=t:o.dateFromConditionComponent=t;t=t.getGui();e===baseFilter_1.FilterConditionType.MAIN?(o.eDateFromPanel.appendChild(t),o.dateFromComponent.afterGuiAttached&&o.dateFromComponent.afterGuiAttached()):(o.eDateFromConditionPanel.appendChild(t),o.dateFromConditionComponent.afterGuiAttached&&o.dateFromConditionComponent.afterGuiAttached())})},o.prototype.onDateChanged=function(t){t===baseFilter_1.FilterConditionType.MAIN?(this.dateFrom=o.removeTimezone(this.dateFromComponent.getDate()),this.dateTo=o.removeTimezone(this.dateToComponent.getDate())):(this.dateFromCondition=o.removeTimezone(this.dateFromComponent.getDate()),this.dateToCondition=o.removeTimezone(this.dateToComponent.getDate())),this.onFilterChanged()},o.prototype.refreshFilterBodyUi=function(t){var e,o,i=t===baseFilter_1.FilterConditionType.MAIN?(e=this.eDateToPanel,this.selectedFilter):(e=this.eDateToConditionPanel,this.selectedFilterCondition);e&&(o=i===baseFilter_1.BaseFilter.IN_RANGE,utils_1._.setVisible(e,o));t=t===baseFilter_1.FilterConditionType.MAIN?this.eDateFromPanel:this.eDateFromConditionPanel;t&&(i=!this.doesFilterHaveHiddenInput(i)&&i!==baseFilter_1.BaseFilter.EMPTY,utils_1._.setVisible(t,i))},o.prototype.comparator=function(){return this.filterParams.comparator||this.defaultComparator.bind(this)},o.prototype.defaultComparator=function(t,e){return e<t?-1:t<e?1:null!=e?0:-1},o.prototype.serialize=function(t){var e=t===baseFilter_1.FilterConditionType.MAIN?this.dateToComponent:this.dateToConditionComponent,o=t===baseFilter_1.FilterConditionType.MAIN?this.dateFromComponent:this.dateFromConditionComponent,t=t===baseFilter_1.FilterConditionType.MAIN?this.selectedFilter:this.selectedFilterCondition;return{dateTo:utils_1._.serializeDateToYyyyMmDd(e.getDate(),"-"),dateFrom:utils_1._.serializeDateToYyyyMmDd(o.getDate(),"-"),type:t||this.defaultFilter,filterType:"date"}},o.prototype.filterValues=function(t){return t===baseFilter_1.FilterConditionType.MAIN?this.dateFromComponent?this.selectedFilter!==baseFilter_1.BaseFilter.IN_RANGE?this.dateFromComponent.getDate():[this.dateFromComponent.getDate(),this.dateToComponent.getDate()]:null:this.dateFromConditionComponent?this.selectedFilterCondition!==baseFilter_1.BaseFilter.IN_RANGE?this.dateFromConditionComponent.getDate():[this.dateFromConditionComponent.getDate(),this.dateToConditionComponent.getDate()]:null},o.prototype.getDateFrom=function(){return utils_1._.serializeDateToYyyyMmDd(this.dateFromComponent.getDate(),"-")},o.prototype.getDateTo=function(){return utils_1._.serializeDateToYyyyMmDd(this.dateToComponent.getDate(),"-")},o.prototype.getFilterType=function(){return this.selectedFilter},o.prototype.setDateFrom=function(t,e){t=utils_1._.parseYyyyMmDdToDate(t,"-");this.setDateFrom_date(t,e)},o.prototype.setDateFrom_date=function(t,e){e===baseFilter_1.FilterConditionType.MAIN?(this.dateFrom=t,this.dateFromComponent&&this.dateFromComponent.setDate(this.dateFrom)):(this.dateFromCondition=t,this.dateFromConditionComponent&&this.dateFromConditionComponent.setDate(this.dateFromCondition))},o.prototype.setDateTo=function(t,e){t=utils_1._.parseYyyyMmDdToDate(t,"-");this.setDateTo_date(t,e)},o.prototype.setDateTo_date=function(t,e){e===baseFilter_1.FilterConditionType.MAIN?(this.dateTo=t,this.dateToComponent&&this.dateToComponent.setDate(this.dateTo)):(this.dateToCondition=t,this.dateToConditionComponent&&this.dateToConditionComponent.setDate(this.dateToCondition))},o.prototype.resetState=function(t){void 0===t&&(t=!1),t||(this.setDateFrom(null,baseFilter_1.FilterConditionType.MAIN),this.setDateTo(null,baseFilter_1.FilterConditionType.MAIN),this.setFilterType(this.defaultFilter,baseFilter_1.FilterConditionType.MAIN)),this.setFilterType(this.defaultFilter,baseFilter_1.FilterConditionType.CONDITION),this.setDateFrom(null,baseFilter_1.FilterConditionType.CONDITION),this.setDateTo(null,baseFilter_1.FilterConditionType.CONDITION)},o.prototype.parse=function(t,e){this.setDateFrom(t.dateFrom,e),this.setDateTo(t.dateTo,e),this.setFilterType(t.type,e)},o.prototype.setType=function(t,e){this.setFilterType(t,e)},o.removeTimezone=function(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate()):null},__decorate([context_1.Autowired("userComponentFactory"),__metadata("design:type",userComponentFactory_1.UserComponentFactory)],o.prototype,"userComponentFactory",void 0),__decorate([componentAnnotations_1.QuerySelector("#filterDateFromPanel"),__metadata("design:type",HTMLElement)],o.prototype,"eDateFromPanel",void 0),__decorate([componentAnnotations_1.QuerySelector("#filterDateFromConditionPanel"),__metadata("design:type",HTMLElement)],o.prototype,"eDateFromConditionPanel",void 0),__decorate([componentAnnotations_1.QuerySelector("#filterDateToPanel"),__metadata("design:type",HTMLElement)],o.prototype,"eDateToPanel",void 0),__decorate([componentAnnotations_1.QuerySelector("#filterDateToConditionPanel"),__metadata("design:type",HTMLElement)],o.prototype,"eDateToConditionPanel",void 0),o}(baseFilter_1.ScalarBaseFilter);exports.DateFilter=DateFilter;var DefaultDateComponent=function(t){function e(){return t.call(this,'<div class="ag-input-text-wrapper"><input class="ag-filter-filter" type="text" placeholder="yyyy-mm-dd"></div>')||this}return __extends(e,t),e.prototype.init=function(t){this.eDateInput=this.getGui().querySelector("input"),(utils_1._.isBrowserChrome()||t.filterParams.browserDatePicker)&&(utils_1._.isBrowserIE()?console.warn("ag-grid: browserDatePicker is specified to true, but it is not supported in IE 11, reverting to plain text date picker"):this.eDateInput.type="date"),this.listener=t.onDateChanged,this.addGuiEventListener("input",this.listener)},e.prototype.getDate=function(){return utils_1._.parseYyyyMmDdToDate(this.eDateInput.value,"-")},e.prototype.setDate=function(t){this.eDateInput.value=utils_1._.serializeDateToYyyyMmDd(t,"-")},e}(component_1.Component);exports.DefaultDateComponent=DefaultDateComponent;