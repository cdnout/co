"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var eventService_1=require("../eventService"),utils_1=require("../utils"),TouchListener=function(){function o(t,e){var i=this;void 0===e&&(e=!1),this.destroyFuncs=[],this.touching=!1,this.eventService=new eventService_1.EventService,this.eElement=t,this.preventMouseClick=e;var n=this.onTouchStart.bind(this),o=this.onTouchMove.bind(this),s=this.onTouchEnd.bind(this);this.eElement.addEventListener("touchstart",n,{passive:!0}),this.eElement.addEventListener("touchmove",o,{passive:!0}),this.eElement.addEventListener("touchend",s,{passive:!1}),this.destroyFuncs.push(function(){i.eElement.removeEventListener("touchstart",n,{passive:!0}),i.eElement.removeEventListener("touchmove",o,{passive:!0}),i.eElement.removeEventListener("touchend",s,{passive:!1})})}return o.prototype.getActiveTouch=function(t){for(var e=0;e<t.length;e++)if(t[e].identifier===this.touchStart.identifier)return t[e];return null},o.prototype.addEventListener=function(t,e){this.eventService.addEventListener(t,e)},o.prototype.removeEventListener=function(t,e){this.eventService.removeEventListener(t,e)},o.prototype.onTouchStart=function(e){var i,n=this;this.touching||(this.touchStart=e.touches[0],this.touching=!0,this.moved=!1,i=this.touchStart,window.setTimeout(function(){var t=n.touchStart===i;n.touching&&t&&!n.moved&&(n.moved=!0,t={type:o.EVENT_LONG_TAP,touchStart:n.touchStart,touchEvent:e},n.eventService.dispatchEvent(t))},500))},o.prototype.onTouchMove=function(t){!this.touching||(t=this.getActiveTouch(t.touches))&&!utils_1._.areEventsNear(t,this.touchStart,4)&&(this.moved=!0)},o.prototype.onTouchEnd=function(t){var e;this.touching&&(this.moved||(e={type:o.EVENT_TAP,touchStart:this.touchStart},this.eventService.dispatchEvent(e),this.checkForDoubleTap()),this.preventMouseClick&&t.preventDefault(),this.touching=!1)},o.prototype.checkForDoubleTap=function(){var t,e=(new Date).getTime();this.lastTapTime&&0<this.lastTapTime?(t=e-this.lastTapTime,o.DOUBLE_TAP_MILLIS<t?(t={type:o.EVENT_DOUBLE_TAP,touchStart:this.touchStart},this.eventService.dispatchEvent(t),this.lastTapTime=null):this.lastTapTime=e):this.lastTapTime=e},o.prototype.destroy=function(){this.destroyFuncs.forEach(function(t){return t()})},o.EVENT_TAP="tap",o.EVENT_DOUBLE_TAP="doubleTap",o.EVENT_LONG_TAP="longTap",o.DOUBLE_TAP_MILLIS=500,o}();exports.TouchListener=TouchListener;