"use strict";var __extends=this&&this.__extends||function(){var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,i,s){var o,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(n=(r<3?o(n):3<r?o(t,i,n):o(t,i))||n);return 3<r&&n&&Object.defineProperty(t,i,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var dragService_1=require("../dragAndDrop/dragService"),context_1=require("../context/context"),agPanel_1=require("./agPanel"),component_1=require("./component"),utils_1=require("../utils"),AgDialog=function(r){function e(e){e=r.call(this,e)||this;return e.RESIZE_TEMPLATE='\n        <div class="ag-resizer-wrapper">\n            <div ref="eTopLeftResizer" class="ag-resizer ag-resizer-topLeft"></div>\n            <div ref="eTopResizer" class="ag-resizer ag-resizer-top"></div>\n            <div ref="eTopRightResizer" class="ag-resizer ag-resizer-topRight"></div>\n            <div ref="eRightResizer" class="ag-resizer ag-resizer-right"></div>\n            <div ref="eBottomRightResizer" class="ag-resizer ag-resizer-bottomRight"></div>\n            <div ref="eBottomResizer" class="ag-resizer ag-resizer-bottom"></div>\n            <div ref="eBottomLeftResizer" class="ag-resizer ag-resizer-bottomLeft"></div>\n            <div ref="eLeftResizer" class="ag-resizer ag-resizer-left"></div>\n        </div>\n    ',e.MAXIMIZE_BTN_TEMPLATE='<div class="ag-dialog-button"></span>',e.resizable={},e.isResizable=!1,e.movable=!1,e.isMoving=!1,e.isMaximizable=!1,e.isMaximized=!1,e.maximizeListeners=[],e.resizeListenerDestroy=null,e.isResizing=!1,e.lastPosition={x:0,y:0,width:0,height:0},e}return __extends(e,r),e.prototype.postConstruct=function(){var t=this,i=this.getGui(),e=this.config,s=e.movable,o=e.resizable,e=e.maximizable;utils_1._.addCssClass(i,"ag-dialog"),this.moveElement=this.eTitleBar,r.prototype.postConstruct.call(this),this.addDestroyableEventListener(i,"focusin",function(e){i.contains(e.relatedTarget)||t.popupService.bringPopupToFront(i)}),s&&this.setMovable(s),e&&this.setMaximizable(e),this.addResizers(),o&&this.setResizable(o)},e.prototype.renderComponent=function(){var e=this.getGui(),t=this.config,i=t.alwaysOnTop,t=t.modal;this.close=this.popupService.addPopup(t,e,!0,this.destroy.bind(this),void 0,i),e.focus()},e.prototype.addResizers=function(){var e,t=this.getGui();t&&(e=(new DOMParser).parseFromString(this.RESIZE_TEMPLATE,"text/html").body,t.appendChild(e.firstChild),this.createMap())},e.prototype.createMap=function(){var e=this.getGui();this.resizerMap={topLeft:{element:e.querySelector("[ref=eTopLeftResizer]")},top:{element:e.querySelector("[ref=eTopResizer]")},topRight:{element:e.querySelector("[ref=eTopRightResizer]")},right:{element:e.querySelector("[ref=eRightResizer]")},bottomRight:{element:e.querySelector("[ref=eBottomRightResizer]")},bottom:{element:e.querySelector("[ref=eBottomResizer]")},bottomLeft:{element:e.querySelector("[ref=eBottomLeftResizer]")},left:{element:e.querySelector("[ref=eLeftResizer]")}}},e.prototype.getResizerElement=function(e){return this.resizerMap[e].element},e.prototype.onResizeStart=function(e){this.isResizing=!0,this.updateDragStartPosition(e.clientX,e.clientY)},e.prototype.onResize=function(e,t){var i,s,o,r,n,a,h,l,c;this.isResizing&&(i=!!t.match(/left/i),o=!!t.match(/right/i),s=!!t.match(/top/i),r=!!t.match(/bottom/i),a=i||o,l=s||r,h=(n=this.calculateMouseMovement({e:e,isLeft:i,isTop:s})).movementX,t=n.movementY,r=o=0,a&&h&&(c=i?-1:1,a=(n=this.getWidth())+h*c,h=!1,i&&(o=n-a,(this.position.x+o<=0||a<=this.minWidth)&&(h=!0,o=0)),h||this.setWidth(a)),l&&t&&(c=s?-1:1,t=(l=this.getHeight())+t*c,c=!1,s&&(r=l-t,(this.position.y+r<=0||t<=this.minHeight)&&(c=!0,r=0)),c||this.setHeight(t)),this.updateDragStartPosition(e.clientX,e.clientY),(o||r)&&this.offsetElement(this.position.x+o,this.position.y+r))},e.prototype.onResizeEnd=function(){this.isResizing=!1;var e={type:"resize",api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi()};this.localEventService&&this.localEventService.dispatchEvent(e)},e.prototype.onMoveStart=function(e){this.isMoving=!0,this.updateDragStartPosition(e.clientX,e.clientY)},e.prototype.onMove=function(e){var t,i,s,o;this.isMoving&&(t=(s=this.position).x,i=s.y,s=(o=this.calculateMouseMovement({e:e,isTop:!0,anywhereWithin:!0,topBuffer:this.getHeight()-this.getBodyHeight()})).movementX,o=o.movementY,this.offsetElement(t+s,i+o),this.updateDragStartPosition(e.clientX,e.clientY))},e.prototype.onMoveEnd=function(){this.isMoving=!1},e.prototype.toggleMaximize=function(){var e,t,i,s;this.isMaximized?(e=(s=this.lastPosition).x,t=s.y,i=s.width,s=s.height,this.setWidth(i),this.setHeight(s),this.offsetElement(e,t)):(this.lastPosition.width=this.getWidth(),this.lastPosition.height=this.getHeight(),this.lastPosition.x=this.position.x,this.lastPosition.y=this.position.y,this.offsetElement(0,0),this.setHeight("100%"),this.setWidth("100%")),this.isMaximized=!this.isMaximized,this.refreshMaximizeIcon()},e.prototype.refreshMaximizeIcon=function(){utils_1._.addOrRemoveCssClass(this.maximizeIcon,"ag-hidden",this.isMaximized),utils_1._.addOrRemoveCssClass(this.minimizeIcon,"ag-hidden",!this.isMaximized)},e.prototype.clearMaximizebleListeners=function(){this.maximizeListeners.length&&(this.maximizeListeners.forEach(function(e){return e()}),this.maximizeListeners.length=0),this.resizeListenerDestroy&&(this.resizeListenerDestroy(),this.resizeListenerDestroy=null)},e.prototype.destroy=function(){r.prototype.destroy.call(this),this.setResizable(!1),this.setMovable(!1),this.maximizeButtonComp&&(this.maximizeButtonComp.destroy(),this.maximizeButtonComp=void 0),this.clearMaximizebleListeners()},e.prototype.setResizable=function(o){var r=this,n=!1;"boolean"==typeof o&&(o={topLeft:o,top:o,topRight:o,right:o,bottomRight:o,bottom:o,bottomLeft:o,left:o}),Object.keys(o).forEach(function(e){var t=e,i=!!o[t],s=r.getResizerElement(t),e=r.resizerMap[t].dragSource||{eElement:s,onDragStart:r.onResizeStart.bind(r),onDragging:function(e){return r.onResize(e,t)},onDragStop:r.onResizeEnd.bind(r)};!!r.resizable[t]==i&&(r.isAlive()||i)||(i?(r.dragService.addDragSource(e),s.style.pointerEvents="all",n=!0):(r.dragService.removeDragSource(e),s.style.pointerEvents="none"),r.resizerMap[t].dragSource=i?e:void 0)}),this.isResizable=n},e.prototype.setMovable=function(e){var t;e!==this.movable&&(this.movable=e,t=this.moveElementDragListener||{eElement:this.moveElement,onDragStart:this.onMoveStart.bind(this),onDragging:this.onMove.bind(this),onDragStop:this.onMoveEnd.bind(this)},e?(this.dragService.addDragSource(t),this.moveElementDragListener=t):(this.dragService.removeDragSource(t),this.moveElementDragListener=void 0))},e.prototype.setMaximizable=function(e){var t=this;if(!1===e)return this.clearMaximizebleListeners(),void(this.maximizeButtonComp&&(this.maximizeButtonComp.destroy(),this.maximizeButtonComp=this.maximizeIcon=this.minimizeIcon=void 0));var i,s=this.eTitleBar;s&&e!==this.isMaximizable&&(i=this.maximizeButtonComp=new component_1.Component(this.MAXIMIZE_BTN_TEMPLATE),this.getContext().wireBean(i),(e=i.getGui()).appendChild(this.maximizeIcon=utils_1._.createIconNoSpan("maximize",this.gridOptionsWrapper)),e.appendChild(this.minimizeIcon=utils_1._.createIconNoSpan("minimize",this.gridOptionsWrapper)),utils_1._.addCssClass(this.minimizeIcon,"ag-hidden"),i.addDestroyableEventListener(e,"click",this.toggleMaximize.bind(this)),this.addTitleBarButton(i,0),this.maximizeListeners.push(this.addDestroyableEventListener(s,"dblclick",this.toggleMaximize.bind(this))),this.resizeListenerDestroy=this.addDestroyableEventListener(this,"resize",function(){t.isMaximized=!1,t.refreshMaximizeIcon()}))},__decorate([context_1.Autowired("dragService"),__metadata("design:type",dragService_1.DragService)],e.prototype,"dragService",void 0),e}(agPanel_1.AgPanel);exports.AgDialog=AgDialog;