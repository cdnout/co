"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,r){var n,a=arguments.length,o=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;0<=s;s--)(n=t[s])&&(o=(a<3?n(o):3<a?n(e,i,o):n(e,i))||o);return 3<a&&o&&Object.defineProperty(e,i,o),o},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var agAbstractLabel_1=require("./agAbstractLabel"),componentAnnotations_1=require("./componentAnnotations"),context_1=require("../context/context"),dragService_1=require("../dragAndDrop/dragService"),agInputNumberField_1=require("./agInputNumberField"),agAbstractField_1=require("./agAbstractField"),utils_1=require("../utils"),AgAngleSelect=function(i){function e(){var t=i.call(this,e.TEMPLATE)||this;return t.radius=0,t.offsetX=0,t.offsetY=0,t}return __extends(e,i),e.prototype.postConstruct=function(){var e=this;i.prototype.postConstruct.call(this),this.dragListener={eElement:this.eParentCircle,dragStartPixels:0,onDragStart:function(t){e.parentCircleRect=e.eParentCircle.getBoundingClientRect()},onDragging:function(t){return e.calculateAngleDrag(t)},onDragStop:function(){}},this.dragService.addDragSource(this.dragListener),this.eAngleValue.setLabel("").setLabelWidth(5).setInputWidth(45).setMin(0).setMax(360).setValue(""+this.degrees).onValueChange(function(t){null!=t&&""!==t||(t="0"),t=e.eAngleValue.normalizeValue(t);t=parseFloat(t);180<t&&(t-=360),e.setValue(t)}),this.updateNumberInput(),utils_1._.exists(this.getValue())&&this.eAngleValue.setValue(this.normalizeNegativeValue(this.getValue()).toString()),this.addDestroyableEventListener(this,agAbstractField_1.AgAbstractField.EVENT_CHANGED,function(){e.eAngleValue.getInputElement().contains(document.activeElement)||e.updateNumberInput()})},e.prototype.updateNumberInput=function(){var t=this.normalizeNegativeValue(this.getValue());this.eAngleValue.setValue(t.toString())},e.prototype.positionChildCircle=function(t){var e=this.parentCircleRect||{width:24,height:24},i=this.eChildCircle,r=e.width/2,e=e.height/2;i.style.left=r+8*Math.cos(t)+"px",i.style.top=e+8*Math.sin(t)+"px"},e.prototype.calculatePolar=function(){var t=this.offsetX,e=this.offsetY,i=Math.atan2(e,t);this.degrees=this.toDegrees(i),this.radius=Math.sqrt(t*t+e*e),this.positionChildCircle(i)},e.prototype.calculateCartesian=function(){var t=this.toRadians(this.getValue()),e=this.getRadius();this.setOffsetX(Math.cos(t)*e).setOffsetY(Math.sin(t)*e)},e.prototype.setOffsetX=function(t){return this.offsetX!==t&&(this.offsetX=t,this.calculatePolar()),this},e.prototype.setOffsetY=function(t){return this.offsetY!==t&&(this.offsetY=t,this.calculatePolar()),this},e.prototype.calculateAngleDrag=function(t){var e=this.parentCircleRect,i=e.width/2,r=e.height/2,i=t.clientX-e.left-i,r=t.clientY-e.top-r,i=Math.atan2(r,i);this.setValue(i,!0)},e.prototype.toDegrees=function(t){return t/Math.PI*180},e.prototype.toRadians=function(t){return t/180*Math.PI},e.prototype.normalizeNegativeValue=function(t){return t<0?360+t:t},e.prototype.normalizeAngle180=function(t){return(t%=2*Math.PI)<-Math.PI?t+=2*Math.PI:t>=Math.PI&&(t-=2*Math.PI),t},e.prototype.getRadius=function(){return this.radius},e.prototype.setRadius=function(t){return this.radius===t||(this.radius=t,this.calculateCartesian()),this},e.prototype.onValueChange=function(t){var e=this;return this.addDestroyableEventListener(this,agAbstractField_1.AgAbstractField.EVENT_CHANGED,function(){t(e.degrees)}),this},e.prototype.getValue=function(t){return t?this.toRadians(this.degrees):this.degrees},e.prototype.setValue=function(t,e){e=e?t:this.normalizeAngle180(this.toRadians(t));return t=this.toDegrees(e),this.degrees!==t&&(this.degrees=Math.floor(t),this.calculateCartesian(),this.positionChildCircle(e),this.dispatchEvent({type:agAbstractField_1.AgAbstractField.EVENT_CHANGED})),this},e.prototype.setWidth=function(t){return utils_1._.setFixedWidth(this.getGui(),t),this},e.prototype.destroy=function(){i.prototype.destroy.call(this),this.dragService.removeDragSource(this.dragListener)},e.TEMPLATE='<div class="ag-angle-select">\n            <label ref="eLabel"></label>\n            <div class="ag-wrapper">\n                <div ref="eAngleSelectField" class="ag-angle-select-field">\n                    <div ref="eParentCircle" class="ag-parent-circle">\n                        <div ref="eChildCircle" class="ag-child-circle"></div>\n                    </div>\n                </div>\n                <ag-input-number-field ref="eAngleValue"></ag-input-number-field>\n            </div>\n        </div>',__decorate([componentAnnotations_1.RefSelector("eLabel"),__metadata("design:type",HTMLElement)],e.prototype,"eLabel",void 0),__decorate([componentAnnotations_1.RefSelector("eParentCircle"),__metadata("design:type",HTMLElement)],e.prototype,"eParentCircle",void 0),__decorate([componentAnnotations_1.RefSelector("eChildCircle"),__metadata("design:type",HTMLElement)],e.prototype,"eChildCircle",void 0),__decorate([componentAnnotations_1.RefSelector("eAngleValue"),__metadata("design:type",agInputNumberField_1.AgInputNumberField)],e.prototype,"eAngleValue",void 0),__decorate([context_1.Autowired("dragService"),__metadata("design:type",dragService_1.DragService)],e.prototype,"dragService",void 0),e}(agAbstractLabel_1.AgAbstractLabel);exports.AgAngleSelect=AgAngleSelect;