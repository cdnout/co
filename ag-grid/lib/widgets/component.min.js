"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__decorate=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(i<3?r(s):3<i?r(e,o,s):r(e,o))||s);return 3<i&&s&&Object.defineProperty(e,o,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var context_1=require("../context/context"),beanStub_1=require("../context/beanStub"),utils_1=require("../utils"),compIdSequence=new utils_1.NumberSequence,Component=function(o){function e(t){var e=o.call(this)||this;return e.childComponents=[],e.annotatedEventListeners=[],e.displayed=!0,e.visible=!0,e.compId=compIdSequence.next(),t&&e.setTemplate(t),e}return __extends(e,o),e.prototype.getCompId=function(){return this.compId},e.prototype.createChildComponentsFromTags=function(n){var r=this;utils_1._.copyNodeList(n.childNodes).forEach(function(e){var t,o=r.getContext().createComponentFromElement(e,function(t){r.copyAttributesFromNode(e,t.getGui())});o?(o.addItems&&e.children.length&&(r.createChildComponentsFromTags(e),t=Array.prototype.slice.call(e.children),o.addItems(t)),r.swapComponentForNode(o,n,e)):e.childNodes&&r.createChildComponentsFromTags(e)})},e.prototype.copyAttributesFromNode=function(t,o){utils_1._.iterateNamedNodeMap(t.attributes,function(t,e){o.setAttribute(t,e)})},e.prototype.swapComponentForNode=function(t,e,o){var n=t.getGui();e.replaceChild(n,o),e.insertBefore(document.createComment(o.nodeName),n),this.childComponents.push(t),this.swapInComponentForQuerySelectors(t,o)},e.prototype.swapInComponentForQuerySelectors=function(e,o){for(var t=Object.getPrototypeOf(this),n=this;null!=t;){var r=t.__agComponentMetaData,i=t.constructor.name;r&&r[i]&&r[i].querySelectors&&r[i].querySelectors.forEach(function(t){n[t.attributeName]===o&&(n[t.attributeName]=e)}),t=Object.getPrototypeOf(t)}},e.prototype.setTemplate=function(t){t=utils_1._.loadTemplate(t);this.setTemplateFromElement(t)},e.prototype.setTemplateFromElement=function(t){this.eGui=t,(this.eGui.__agComponent=this).addAnnotatedEventListeners(),this.wireQuerySelectors(),this.getContext()&&this.createChildComponentsFromTags(this.getGui())},e.prototype.createChildComponentsPreConstruct=function(){!this.getGui()||this.createChildComponentsFromTags(this.getGui())},e.prototype.wireQuerySelectors=function(){var r=this;if(this.eGui)for(var o=Object.getPrototypeOf(this),i=this;null!=o;)!function(){var n,t=o.__agComponentMetaData,e=o.constructor.name;t&&t[e]&&t[e].querySelectors&&(n=i,t[e].querySelectors.forEach(function(t){var e,o=r.eGui.querySelector(t.querySelector);o&&(e=o.__agComponent,n[t.attributeName]=e||o)})),o=Object.getPrototypeOf(o)}()},e.prototype.addAnnotatedEventListeners=function(){var t,o=this;this.removeAnnotatedEventListeners(),this.eGui&&(t=this.getAgComponentMetaData("listenerMethods"),utils_1._.missingOrEmpty(t)||(this.annotatedEventListeners||(this.annotatedEventListeners=[]),t.forEach(function(t){var e=o[t.methodName].bind(o);o.eGui.addEventListener(t.eventName,e),o.annotatedEventListeners.push({eventName:t.eventName,listener:e})})))},e.prototype.getAgComponentMetaData=function(t){for(var e=[],o=Object.getPrototypeOf(this);null!=o;){var n,r=o.__agComponentMetaData,i=o.constructor.name;void 0===i&&((n=/function\s([^(]{1,})\(/.exec(o.constructor.toString()))&&1<n.length&&(i=n[1].trim())),r&&r[i]&&r[i][t]&&(e=e.concat(r[i][t])),o=Object.getPrototypeOf(o)}return e},e.prototype.removeAnnotatedEventListeners=function(){var e=this;this.annotatedEventListeners&&this.eGui&&(this.annotatedEventListeners.forEach(function(t){e.eGui.removeEventListener(t.eventName,t.listener)}),this.annotatedEventListeners=[])},e.prototype.getGui=function(){return this.eGui},e.prototype.setParentComponent=function(t){this.parentComponent=t},e.prototype.getParentComponent=function(){return this.parentComponent},e.prototype.setGui=function(t){this.eGui=t},e.prototype.queryForHtmlElement=function(t){return this.eGui.querySelector(t)},e.prototype.queryForHtmlInputElement=function(t){return this.eGui.querySelector(t)},e.prototype.appendChild=function(t){utils_1._.isNodeOrElement(t)?this.eGui.appendChild(t):(t=t,this.eGui.appendChild(t.getGui()),this.childComponents.push(t))},e.prototype.addFeature=function(t,e){t.wireBean(e),e.destroy&&this.addDestroyFunc(e.destroy.bind(e))},e.prototype.isDisplayed=function(){return this.displayed},e.prototype.setVisible=function(t){t!==this.visible&&(this.visible=t,utils_1._.setVisible(this.eGui,t))},e.prototype.setDisplayed=function(t){t!==this.displayed&&(this.displayed=t,utils_1._.setDisplayed(this.eGui,t),t={type:e.EVENT_DISPLAYED_CHANGED,visible:this.displayed},this.dispatchEvent(t))},e.prototype.addOrRemoveCssClass=function(t,e){utils_1._.addOrRemoveCssClass(this.eGui,t,e)},e.prototype.destroy=function(){o.prototype.destroy.call(this),this.childComponents.forEach(function(t){t&&t.destroy&&t.destroy()}),this.childComponents.length=0,this.removeAnnotatedEventListeners()},e.prototype.addGuiEventListener=function(t,e){var o=this;this.getGui().addEventListener(t,e),this.addDestroyFunc(function(){return o.getGui().removeEventListener(t,e)})},e.prototype.addCssClass=function(t){utils_1._.addCssClass(this.getGui(),t)},e.prototype.removeCssClass=function(t){utils_1._.removeCssClass(this.getGui(),t)},e.prototype.getAttribute=function(t){var e=this.getGui();return e?e.getAttribute(t):null},e.prototype.getRefElement=function(t){return this.queryForHtmlElement('[ref="'+t+'"]')},e.EVENT_DISPLAYED_CHANGED="displayedChanged",__decorate([context_1.PreConstruct,__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"createChildComponentsPreConstruct",null),e}(beanStub_1.BeanStub);exports.Component=Component;