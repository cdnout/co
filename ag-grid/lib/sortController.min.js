"use strict";var __decorate=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,l=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,r,o);else for(var u=t.length-1;0<=u;u--)(n=t[u])&&(l=(i<3?n(l):3<i?n(e,r,l):n(e,r))||l);return 3<i&&l&&Object.defineProperty(e,r,l),l},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var column_1=require("./entities/column"),context_1=require("./context/context"),gridOptionsWrapper_1=require("./gridOptionsWrapper"),columnApi_1=require("./columnController/columnApi"),columnController_1=require("./columnController/columnController"),eventService_1=require("./eventService"),events_1=require("./events"),gridApi_1=require("./gridApi"),utils_1=require("./utils"),SortController=function(){function t(){}var n=t;return t.prototype.progressSort=function(t,e,r){void 0===r&&(r="api");var o=this.getNextSortDirection(t);this.setSortForColumn(t,o,e,r)},t.prototype.setSortForColumn=function(t,e,r,o){void 0===o&&(o="api"),e!==column_1.Column.SORT_ASC&&e!==column_1.Column.SORT_DESC&&(e=null),t.setSort(e,o),t.getSort()?(e=Number((new Date).valueOf()),t.setSortedAt(e)):t.setSortedAt(null),r&&!this.gridOptionsWrapper.isSuppressMultiSort()||this.clearSortBarThisColumn(t,o),this.dispatchSortChangedEvents()},t.prototype.onSortChanged=function(){this.dispatchSortChangedEvents()},t.prototype.dispatchSortChangedEvents=function(){var t={type:events_1.Events.EVENT_SORT_CHANGED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(t)},t.prototype.clearSortBarThisColumn=function(e,r){this.columnController.getPrimaryAndSecondaryAndAutoColumns().forEach(function(t){t!==e&&t.setSort(void 0,r)})},t.prototype.getNextSortDirection=function(t){var e=t.getColDef().sortingOrder?t.getColDef().sortingOrder:this.gridOptionsWrapper.getSortingOrder()?this.gridOptionsWrapper.getSortingOrder():n.DEFAULT_SORTING_ORDER;if(!Array.isArray(e)||e.length<=0)return console.warn("ag-grid: sortingOrder must be an array with at least one element, currently it's "+e),null;var r=e.indexOf(t.getSort()),o=r<0,t=r==e.length-1,r=o||t?e[0]:e[r+1];return n.DEFAULT_SORTING_ORDER.indexOf(r)<0?(console.warn("ag-grid: invalid sort type "+r),null):r},t.prototype.getSortModel=function(){var t=this.getColumnsWithSortingOrdered();return utils_1._.map(t,function(t){return{colId:t.getColId(),sort:t.getSort()}})},t.prototype.setSortModel=function(i,l){var u=this;void 0===l&&(l="api");var a=i&&0<i.length;this.columnController.getPrimaryAndSecondaryAndAutoColumns().forEach(function(t){var e=null,r=-1;if(a&&t.getColDef().sortable)for(var o=0;o<i.length;o++){var n=i[o];"string"==typeof n.colId&&"string"==typeof t.getColId()&&u.compareColIds(n,t)&&(e=n.sort,r=o)}e?(t.setSort(e,l),t.setSortedAt(r)):(t.setSort(null,l),t.setSortedAt(null))}),this.dispatchSortChangedEvents()},t.prototype.compareColIds=function(t,e){return t.colId===e.getColId()},t.prototype.getColumnsWithSortingOrdered=function(){var t=this.columnController.getPrimaryAndSecondaryAndAutoColumns(),t=utils_1._.filter(t,function(t){return!!t.getSort()});return t.sort(function(t,e){return t.sortedAt-e.sortedAt}),t},t.prototype.getSortForRowController=function(){var t=this.getColumnsWithSortingOrdered();return utils_1._.map(t,function(t){return{inverter:t.getSort()===column_1.Column.SORT_ASC?1:-1,column:t}})},t.DEFAULT_SORTING_ORDER=[column_1.Column.SORT_ASC,column_1.Column.SORT_DESC,null],__decorate([context_1.Autowired("gridOptionsWrapper"),__metadata("design:type",gridOptionsWrapper_1.GridOptionsWrapper)],t.prototype,"gridOptionsWrapper",void 0),__decorate([context_1.Autowired("columnController"),__metadata("design:type",columnController_1.ColumnController)],t.prototype,"columnController",void 0),__decorate([context_1.Autowired("eventService"),__metadata("design:type",eventService_1.EventService)],t.prototype,"eventService",void 0),__decorate([context_1.Autowired("columnApi"),__metadata("design:type",columnApi_1.ColumnApi)],t.prototype,"columnApi",void 0),__decorate([context_1.Autowired("gridApi"),__metadata("design:type",gridApi_1.GridApi)],t.prototype,"gridApi",void 0),n=__decorate([context_1.Bean("sortController")],t)}();exports.SortController=SortController;