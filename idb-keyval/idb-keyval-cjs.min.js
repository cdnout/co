"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Store{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((r,o)=>{const s=indexedDB.open(e,1);s.onerror=(()=>o(s.error)),s.onsuccess=(()=>r(s.result)),s.onupgradeneeded=(()=>{s.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(r=>new Promise((o,s)=>{const n=r.transaction(this.storeName,e);n.oncomplete=(()=>o()),n.onabort=n.onerror=(()=>s(n.error)),t(n.objectStore(this.storeName))}))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get(e,t=getDefaultStore()){let r;return t._withIDBStore("readonly",t=>{r=t.get(e)}).then(()=>r.result)}function set(e,t,r=getDefaultStore()){return r._withIDBStore("readwrite",r=>{r.put(t,e)})}function del(e,t=getDefaultStore()){return t._withIDBStore("readwrite",t=>{t.delete(e)})}function clear(e=getDefaultStore()){return e._withIDBStore("readwrite",e=>{e.clear()})}function keys(e=getDefaultStore()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}exports.Store=Store,exports.get=get,exports.set=set,exports.del=del,exports.clear=clear,exports.keys=keys;