!function(e,t){window.MockAjax=function(e,t){t().ajax=function(e){var t={};return t.RequestStub=e.AjaxRequestStub(),t.RequestTracker=e.AjaxRequestTracker(),t.StubTracker=e.AjaxStubTracker(),t.ParamParser=e.AjaxParamParser(),t.event=e.AjaxEvent(),t.eventBus=e.AjaxEventBus(t.event),t.fakeRequest=e.AjaxFakeRequest(t.eventBus),t.MockAjax=e.MockAjax(t),t.MockAjax},t().AjaxEvent=function(){function e(){}function s(e,t){this.type=t,this.bubbles=!1,this.cancelable=!1,this.timeStamp=(new Date).getTime(),this.isTrusted=!1,this.defaultPrevented=!1,this.eventPhase=2,this.target=e,this.currentTarget=e}function n(){s.apply(this,arguments),this.lengthComputable=!1,this.loaded=0,this.total=0}return s.prototype.preventDefault=e,s.prototype.stopPropagation=e,s.prototype.stopImmediatePropagation=e,n.prototype=s.prototype,{event:function(e,t){return new s(e,t)},progressEvent:function(e,t){return new n(e,t)}}},t().AjaxEventBus=function(r){function t(e){this.eventList={},this.source=e}return t.prototype.addEventListener=function(e,t){var s,n;(s=this.eventList,n=e,s[n]=s[n]||[],s[n]).push(t)},t.prototype.removeEventListener=function(e,t){var s=function(e,t){if(e.indexOf)return e.indexOf(t);for(var s=0;s<e.length;s++)if(t===e[s])return s;return-1}(this.eventList[e],t);0<=s&&this.eventList[e].splice(s,1)},t.prototype.trigger=function(e){var t;t="readystatechange"===e?r.event(this.source,e):r.progressEvent(this.source,e);var s=this.eventList[e];if(s)for(var n=0;n<s.length;n++)s[n].call(this.source,t)},function(e){return new t(e)}},t().AjaxFakeRequest=function(d){function c(e,t,s){for(var n in s=s||[],t)l(s,n)||(e[n]=t[n]);return e}function l(e,t){for(var s=0;s<e.length;s++)if(e[s]===t)return!0;return!1}function f(e,t){return function(){e[t]&&e[t].apply(e,arguments)}}function v(e){var t=["Can't build XHR.response for XHR.responseType of '",e,"'.","XHR.response must be explicitly stubbed"];return t.join(" ")}return function(n,t,s,e){function r(){var e;t.track(this),this.eventBus=d(this),(e=this).eventBus.addEventListener("readystatechange",f(e,"onreadystatechange")),e.eventBus.addEventListener("loadstart",f(e,"onloadstart")),e.eventBus.addEventListener("load",f(e,"onload")),e.eventBus.addEventListener("loadend",f(e,"onloadend")),e.eventBus.addEventListener("progress",f(e,"onprogress")),e.eventBus.addEventListener("error",f(e,"onerror")),e.eventBus.addEventListener("abort",f(e,"onabort")),e.eventBus.addEventListener("timeout",f(e,"ontimeout")),this.requestHeaders={},this.overriddenMimeType=null}function i(e,t){for(var s in e=e.toLowerCase(),t)if(s.toLowerCase()===e)return t[s]}function a(e,t){var s=[];if(e)if(e instanceof Array)s=e;else for(var n in e)e.hasOwnProperty(n)&&s.push({name:n,value:e[n]});else s.push({name:"Content-Type",value:t||"application/json"});return s}function o(e,t){if(n.DOMParser)return(new n.DOMParser).parseFromString(e,"text/xml");var s=new n.ActiveXObject("Microsoft.XMLDOM");return s.async="false",s.loadXML(e),s}var u=["text/xml","application/xml"];function h(e,t){return l(u,t.toLowerCase())?o(e,t):t.match(/\+xml$/)?o(e,"text/xml"):null}c(r,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});var p=["responseBody","responseText","responseXML","status","statusText","responseTimeout","responseURL"];return c(r.prototype,new n.XMLHttpRequest,p),c(r.prototype,{open:function(){this.method=arguments[0],this.url=arguments[1]+"",this.username=arguments[3],this.password=arguments[4],this.readyState=r.OPENED,this.requestHeaders={},this.eventBus.trigger("readystatechange")},setRequestHeader:function(e,t){if(0===this.readyState)throw new Error('DOMException: Failed to execute "setRequestHeader" on "XMLHttpRequest": The object\'s state must be OPENED.');this.requestHeaders.hasOwnProperty(e)?this.requestHeaders[e]=[this.requestHeaders[e],t].join(", "):this.requestHeaders[e]=t},overrideMimeType:function(e){this.overriddenMimeType=e},abort:function(){this.readyState=r.UNSENT,this.status=0,this.statusText="abort",this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("abort"),this.eventBus.trigger("loadend")},readyState:r.UNSENT,onloadstart:null,onprogress:null,onabort:null,onerror:null,onload:null,ontimeout:null,onloadend:null,onreadystatechange:null,addEventListener:function(){this.eventBus.addEventListener.apply(this.eventBus,arguments)},removeEventListener:function(e,t){this.eventBus.removeEventListener.apply(this.eventBus,arguments)},status:null,send:function(e){this.params=e,this.eventBus.trigger("loadstart");var t=s.findStub(this.url,e,this.method);t&&t.handleRequest(this)},contentType:function(){return i("content-type",this.requestHeaders)},data:function(){return this.params?e.findParser(this).parse(this.params):{}},getResponseHeader:function(e){var t=null;if(!this.responseHeaders)return t;e=e.toLowerCase();for(var s=0;s<this.responseHeaders.length;s++){var n=this.responseHeaders[s];e===n.name.toLowerCase()&&(t=t?[t,n.value].join(", "):n.value)}return t},getAllResponseHeaders:function(){if(!this.responseHeaders)return null;for(var e=[],t=0;t<this.responseHeaders.length;t++)e.push(this.responseHeaders[t].name+": "+this.responseHeaders[t].value);return e.join("\r\n")+"\r\n"},responseText:null,response:null,responseType:null,responseURL:null,responseValue:function(){switch(this.responseType){case null:case"":case"text":return this.readyState>=r.LOADING?this.responseText:"";case"json":return JSON.parse(this.responseText);case"arraybuffer":throw v("arraybuffer");case"blob":throw v("blob");case"document":return this.responseXML}},respondWith:function(e){if(this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");this.status=e.status,this.statusText=e.statusText||"",this.responseHeaders=a(e.responseHeaders,e.contentType),this.readyState=r.HEADERS_RECEIVED,this.eventBus.trigger("readystatechange"),this.responseText=e.responseText||"",this.responseType=e.responseType||"",this.responseURL=e.responseURL||null,this.readyState=r.DONE,this.responseXML=h(e.responseText,this.getResponseHeader("content-type")||""),this.responseXML&&(this.responseType="document"),e.responseJSON&&(this.responseText=JSON.stringify(e.responseJSON)),this.response="response"in e?e.response:this.responseValue(),this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("load"),this.eventBus.trigger("loadend")},responseTimeout:function(){if(this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");this.readyState=r.DONE,jasmine.clock().tick(3e4),this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("timeout"),this.eventBus.trigger("loadend")},responseError:function(e){if(e||(e={}),this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");this.status=e.status,this.statusText=e.statusText||"",this.readyState=r.DONE,this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("error"),this.eventBus.trigger("loadend")},startStream:function(e){if(e||(e={}),this.readyState>=r.LOADING)throw new Error("FakeXMLHttpRequest already loading or finished");this.status=200,this.responseText="",this.statusText="",this.responseHeaders=a(e.responseHeaders,e.contentType),this.readyState=r.HEADERS_RECEIVED,this.eventBus.trigger("readystatechange"),this.responseType=e.responseType||"",this.responseURL=e.responseURL||null,this.readyState=r.LOADING,this.eventBus.trigger("readystatechange")},streamData:function(e){if(this.readyState!==r.LOADING)throw new Error("FakeXMLHttpRequest is not loading yet");this.responseText+=e,this.responseXML=h(this.responseText,this.getResponseHeader("content-type")||""),this.responseXML&&(this.responseType="document"),this.response=this.responseValue(),this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress")},cancelStream:function(){if(this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");this.status=0,this.statusText="",this.readyState=r.DONE,this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("loadend")},completeStream:function(e){if(this.readyState===r.DONE)throw new Error("FakeXMLHttpRequest already completed");this.status=e||200,this.statusText="",this.readyState=r.DONE,this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("loadend")}}),r}},t().MockAjax=function(a){return function(e){var t=new a.RequestTracker,r=new a.StubTracker,s=new a.ParamParser,n=e.XMLHttpRequest,i=a.fakeRequest(e,t,r,s);this.install=function(){if(e.XMLHttpRequest!==n)throw new Error("Jasmine Ajax was unable to install over a custom XMLHttpRequest. Is Jasmine Ajax already installed?");e.XMLHttpRequest=i},this.uninstall=function(){if(e.XMLHttpRequest!==i)throw new Error("MockAjax not installed.");e.XMLHttpRequest=n,this.stubs.reset(),this.requests.reset(),s.reset()},this.stubRequest=function(e,t,s){var n=new a.RequestStub(e,t,s);return r.addStub(n),n},this.withMock=function(e){this.install();try{e()}finally{this.uninstall()}},this.addCustomParamParser=function(e){s.add(e)},this.requests=t,this.stubs=r}},t().AjaxParamParser=function(){return function(){var t=[{test:function(e){return/^application\/json/.test(e.contentType())},parse:function(e){return JSON.parse(e)}},{test:function(e){return!0},parse:function(e){for(var t={},s=e.split("&"),n=0;n<s.length;++n){var r=s[n].replace(/\+/g," ").split("="),i=decodeURIComponent(r[0]);t[i]=t[i]||[],t[i].push(decodeURIComponent(r[1]))}return t}}],n=[];this.add=function(e){n.unshift(e)},this.findParser=function(e){for(var t in n){var s=n[t];if(s.test(e))return s}},this.reset=function(){for(var e in n=[],t)n.push(t[e])},this.reset()}},t().AjaxRequestStub=function(){var u=function(e){return e?e.split("&").sort().join("&"):void 0},e=function(e){e.responseTimeout()};function t(e,t,s){if(e instanceof RegExp)this.url=e,this.query=void 0;else{var n=e.split("?");this.url=n[0],this.query=1<n.length?u(n[1]):void 0}this.data=t instanceof RegExp?t:u(t),this.method=s}return t.prototype={andReturn:function(t){t.status=void 0!==t.status?t.status:200,this.handleRequest=function(e){e.respondWith(t)}},andError:function(t){t||(t={}),t.status=t.status||500,this.handleRequest=function(e){e.responseError(t)}},andTimeout:function(){this.handleRequest=e},andCallFunction:function(t){this.handleRequest=function(e){t(e)}},matches:function(e,t,s){var n=!1;if(e=e.toString(),this.url instanceof RegExp)n=this.url.test(e);else{var r=e.split("?"),i=r[0],a=r[1];n=this.url===i&&this.query===u(a)}var o=!1;return o=this.data instanceof RegExp?this.data.test(t):!this.data||this.data===u(t),n&&o&&(!this.method||this.method===s)}},t},t().AjaxRequestTracker=function(){return function(){var n=[];this.track=function(e){n.push(e)},this.first=function(){return n[0]},this.count=function(){return n.length},this.reset=function(){n=[]},this.mostRecent=function(){return n[n.length-1]},this.at=function(e){return n[e]},this.filter=function(e){for(var t=[],s=0;s<n.length;s++)e instanceof RegExp&&e.test(n[s].url)?t.push(n[s]):e instanceof Function&&e(n[s])?t.push(n[s]):n[s].url===e&&t.push(n[s]);return t}}},t().AjaxStubTracker=function(){return function(){var i=[];this.addStub=function(e){i.push(e)},this.reset=function(){i=[]},this.findStub=function(e,t,s){for(var n=i.length-1;0<=n;n--){var r=i[n];if(r.matches(e,t,s))return r}}}};var s=t(),n=s.ajax(s);return jasmine.Ajax=new n(e),n}(e,getJasmineRequireObj)}("undefined"!=typeof window?window:global);