"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _createForOfIteratorHelperLoose(e,t){var r;if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator])return(r=e[Symbol.iterator]()).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,n={},o=Object.keys(e),i=0;i<o.length;i++)r=o[i],0<=t.indexOf(r)||(n[r]=e[r]);return n}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}import{keyExtractor as defaultKeyExtractor}from"../VirtualizeUtils";import View from"../../../exports/View";import VirtualizedList from"../VirtualizedList";import*as React from"react";import invariant from"fbjs/lib/invariant";var VirtualizedSectionList=function(n){function e(){for(var l,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(l=n.call.apply(n,[this].concat(t))||this)._keyExtractor=function(e,t){var r=l._subExtractor(t);return r&&r.key||String(t)},l._convertViewable=function(e){invariant(null!=e.index,"Received a broken ViewToken");var t=l._subExtractor(e.index);if(!t)return null;var r=t.section.keyExtractor,n=l.props.keyExtractor||defaultKeyExtractor,o=null!=r?r(e.item,t.index):n(e.item,null!==(o=t.index)&&void 0!==o?o:0);return _objectSpread(_objectSpread({},e),{},{index:t.index,key:o,section:t.section})},l._onViewableItemsChanged=function(e){var t=e.viewableItems,r=e.changed,e=l.props.onViewableItemsChanged;null!=e&&e({viewableItems:t.map(l._convertViewable,_assertThisInitialized(l)).filter(Boolean),changed:r.map(l._convertViewable,_assertThisInitialized(l)).filter(Boolean)})},l._renderItem=function(a){return function(e){var t=e.item,r=e.index,n=l._subExtractor(r);if(!n)return null;e=n.index;if(null==e){var o=n.section;if(!0===n.header){var i=l.props.renderSectionHeader;return i?i({section:o}):null}i=l.props.renderSectionFooter;return i?i({section:o}):null}i=n.section.renderItem||l.props.renderItem,o=l._getSeparatorComponent(r,n,a);return invariant(i,"no renderItem!"),React.createElement(ItemWithSeparator,{SeparatorComponent:o,LeadingSeparatorComponent:0===e?l.props.SectionSeparatorComponent:void 0,cellKey:n.key,index:e,item:t,leadingItem:n.leadingItem,leadingSection:n.leadingSection,prevCellKey:(l._subExtractor(r-1)||{}).key,setSelfHighlightCallback:l._setUpdateHighlightFor,setSelfUpdatePropsCallback:l._setUpdatePropsFor,updateHighlightFor:l._updateHighlightFor,updatePropsFor:l._updatePropsFor,renderItem:i,section:n.section,trailingItem:n.trailingItem,trailingSection:n.trailingSection,inverted:!!l.props.inverted})}},l._updatePropsFor=function(e,t){e=l._updatePropsMap[e];null!=e&&e(t)},l._updateHighlightFor=function(e,t){e=l._updateHighlightMap[e];null!=e&&e(t)},l._setUpdateHighlightFor=function(e,t){null!=t?l._updateHighlightMap[e]=t:delete l._updateHighlightFor[e]},l._setUpdatePropsFor=function(e,t){null!=t?l._updatePropsMap[e]=t:delete l._updatePropsMap[e]},l._updateHighlightMap={},l._updatePropsMap={},l._captureRef=function(e){l._listRef=e},l}_inheritsLoose(e,n);var t=e.prototype;return t.scrollToLocation=function(e){for(var t=e.itemIndex,r=0;r<e.sectionIndex;r++)t+=this.props.getItemCount(this.props.sections[r].data)+2;var n=e.viewOffset||0;null!=this._listRef&&(0<e.itemIndex&&this.props.stickySectionHeadersEnabled&&(n+=this._listRef._getFrameMetricsApprox(t-e.itemIndex).length),n=_objectSpread(_objectSpread({},e),{},{viewOffset:n,index:t}),this._listRef.scrollToIndex(n))},t.getListRef=function(){return this._listRef},t.render=function(){for(var r=this,e=this.props,t=(e.ItemSeparatorComponent,e.SectionSeparatorComponent,e.renderItem,e.renderSectionFooter,e.renderSectionHeader,e.sections,e.stickySectionHeadersEnabled,_objectWithoutPropertiesLoose(e,["ItemSeparatorComponent","SectionSeparatorComponent","renderItem","renderSectionFooter","renderSectionHeader","sections","stickySectionHeadersEnabled"])),n=this.props.ListHeaderComponent?1:0,o=this.props.stickySectionHeadersEnabled?[]:void 0,i=0,a=_createForOfIteratorHelperLoose(this.props.sections);!(l=a()).done;){var l=l.value;null!=o&&o.push(i+n),i+=2,i+=this.props.getItemCount(l.data)}e=this._renderItem(i);return React.createElement(VirtualizedList,_extends({},t,{keyExtractor:this._keyExtractor,stickyHeaderIndices:o,renderItem:e,data:this.props.sections,getItem:function(e,t){return r._getItem(r.props,e,t)},getItemCount:function(){return i},onViewableItemsChanged:this.props.onViewableItemsChanged?this._onViewableItemsChanged:void 0,ref:this._captureRef}))},t._getItem=function(e,t,r){if(!t)return null;for(var n=r-1,o=0;o<t.length;o++){var i=t[o],a=i.data,l=e.getItemCount(a);if(-1===n||n===l)return i;if(n<l)return e.getItem(a,n);n-=l+2}return null},t._subExtractor=function(e){for(var t=e,e=this.props,r=e.getItem,n=e.getItemCount,o=e.keyExtractor,i=e.sections,a=0;a<i.length;a++){var l=i[a],s=l.data,c=l.key||String(a);if(--t>=n(s)+1)t-=n(s)+1;else return-1===t?{section:l,key:c+":header",index:null,header:!0,trailingSection:i[a+1]}:t===n(s)?{section:l,key:c+":footer",index:null,header:!1,trailingSection:i[a+1]}:{section:l,key:c+":"+(l.keyExtractor||o||defaultKeyExtractor)(r(s,t),t),index:t,leadingItem:r(s,t-1),leadingSection:i[a-1],trailingItem:r(s,t+1),trailingSection:i[a+1]}}},t._getSeparatorComponent=function(e,t,r){if(!(t=t||this._subExtractor(e)))return null;var n=t.section.ItemSeparatorComponent||this.props.ItemSeparatorComponent,o=this.props.SectionSeparatorComponent,r=e===r-1,t=t.index===this.props.getItemCount(t.section.data)-1;return o&&t?o:!n||t||r?null:n},e}(React.PureComponent);function ItemWithSeparator(e){var r=e.LeadingSeparatorComponent,n=e.SeparatorComponent,t=e.cellKey,o=e.prevCellKey,i=e.setSelfHighlightCallback,a=e.updateHighlightFor,l=e.setSelfUpdatePropsCallback,s=e.updatePropsFor,c=e.item,p=e.index,u=e.section,d=e.inverted,f=React.useState(!1),g=f[0],m=f[1],h=React.useState(!1),f=h[0],y=h[1],h=React.useState({leadingItem:e.leadingItem,leadingSection:e.leadingSection,section:e.section,trailingItem:e.item,trailingSection:e.trailingSection}),_=h[0],b=h[1],h=React.useState({leadingItem:e.item,leadingSection:e.leadingSection,section:e.section,trailingItem:e.trailingItem,trailingSection:e.trailingSection}),S=h[0],I=h[1];React.useEffect(function(){return i(t,y),l(t,I),function(){l(t,null),i(t,null)}},[t,i,I,l]);h={highlight:function(){m(!0),y(!0),null!=o&&a(o,!0)},unhighlight:function(){m(!1),y(!1),null!=o&&a(o,!1)},updateProps:function(e,t){"leading"===e?null!=r?b(_objectSpread(_objectSpread({},_),t)):null!=o&&s(o,_objectSpread(_objectSpread({},_),t)):"trailing"===e&&null!=n&&I(_objectSpread(_objectSpread({},S),t))}},h=e.renderItem({item:c,index:p,section:u,separators:h}),g=null!=r&&React.createElement(r,_extends({highlighted:g},_)),f=null!=n&&React.createElement(n,_extends({highlighted:f},S));return g||f?React.createElement(View,null,!1===d?g:f,h,!1===d?f:g):h}export default VirtualizedSectionList;