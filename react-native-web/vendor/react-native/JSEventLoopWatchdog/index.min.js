"use strict";import infoLog from"../infoLog";import performanceNow from"fbjs/lib/performanceNow";var JSEventLoopWatchdog={getStats:function(){return{stallCount:stallCount,totalStallTime:totalStallTime,longestStall:longestStall,acceptableBusyTime:acceptableBusyTime}},reset:function(){infoLog("JSEventLoopWatchdog: reset"),longestStall=stallCount=totalStallTime=0,lastInterval=performanceNow()},addHandler:function(t){handlers.push(t)},install:function(t){var n=t.thresholdMS;acceptableBusyTime=n,installed||(installed=!0,lastInterval=performanceNow(),function t(){var l,a,e=performanceNow(),o=e-lastInterval;n<=o&&(stallCount++,totalStallTime+=l=o-n,longestStall=Math.max(longestStall,l),a="JSEventLoopWatchdog: JS thread busy for "+o+"ms. "+totalStallTime+"ms in "+stallCount+" stalls so far. ",handlers.forEach(function(t){a+=t.onStall({lastInterval:lastInterval,busyTime:o})||""}),infoLog(a)),handlers.forEach(function(t){t.onIterate&&t.onIterate()}),lastInterval=e,setTimeout(t,n/5)}())}},acceptableBusyTime=0,installed=!1,totalStallTime=0,stallCount=0,longestStall=0,lastInterval=0,handlers=[];export default JSEventLoopWatchdog;