"use strict";import infoLog from"../infoLog";import performanceNow from"fbjs/lib/performanceNow";var JSEventLoopWatchdog={getStats:function(){return{stallCount:stallCount,totalStallTime:totalStallTime,longestStall:longestStall,acceptableBusyTime:acceptableBusyTime}},reset:function(){infoLog("JSEventLoopWatchdog: reset"),totalStallTime=0,stallCount=0,longestStall=0,lastInterval=performanceNow()},addHandler:function(t){handlers.push(t)},install:function(t){var l=t.thresholdMS;acceptableBusyTime=l,installed||(installed=!0,lastInterval=performanceNow(),function t(){var a=performanceNow(),e=a-lastInterval;if(e>=l){var o=e-l;stallCount++,totalStallTime+=o,longestStall=Math.max(longestStall,o);var n="JSEventLoopWatchdog: JS thread busy for "+e+"ms. "+totalStallTime+"ms in "+stallCount+" stalls so far. ";handlers.forEach(function(t){n+=t.onStall({lastInterval:lastInterval,busyTime:e})||""}),infoLog(n)}handlers.forEach(function(t){t.onIterate&&t.onIterate()}),lastInterval=a,setTimeout(t,l/5)}())}},acceptableBusyTime=0,installed=!1,totalStallTime=0,stallCount=0,longestStall=0,lastInterval=0,handlers=[];export default JSEventLoopWatchdog;