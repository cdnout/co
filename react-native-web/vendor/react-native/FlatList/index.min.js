function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,n={},i=Object.keys(e),o=0;o<i.length;o++)r=i[o],0<=t.indexOf(r)||(n[r]=e[r]);return n}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}import Platform from"../../../exports/Platform";import deepDiffer from"../deepDiffer";import*as React from"react";import View from"../../../exports/View";import VirtualizedList from"../VirtualizedList";import StyleSheet from"../../../exports/StyleSheet";import invariant from"fbjs/lib/invariant";import{keyExtractor as defaultKeyExtractor}from"../VirtualizeUtils";function removeClippedSubviewsOrDefault(e){return null!=e?e:"android"===Platform.OS}function numColumnsOrDefault(e){return null!=e?e:1}var FlatList=function(t){_inheritsLoose(r,t);var e=r.prototype;function r(e){var a=t.call(this,e)||this;return a._virtualizedListPairs=[],a._captureRef=function(e){a._listRef=e},a._getItem=function(e,t){var r=numColumnsOrDefault(a.props.numColumns);if(1<r){for(var n=[],i=0;i<r;i++){var o=e[t*r+i];null!=o&&n.push(o)}return n}return e[t]},a._getItemCount=function(e){if(e){var t=numColumnsOrDefault(a.props.numColumns);return 1<t?Math.ceil(e.length/t):e.length}return 0},a._keyExtractor=function(e,r){var t,n=numColumnsOrDefault(a.props.numColumns),i=null!==(t=a.props.keyExtractor)&&void 0!==t?t:defaultKeyExtractor;return 1<n?Array.isArray(e)?e.map(function(e,t){return i(e,r*n+t)}).join(":"):void invariant(Array.isArray(e),"FlatList: Encountered internal consistency error, expected each item to consist of an array with 1-%s columns; instead, received a single item.",n):i(e,r)},a._renderer=function(){function i(e){return t?React.createElement(t,e):r?r(e):null}var e=a.props,t=e.ListItemComponent,r=e.renderItem,o=e.columnWrapperStyle,s=numColumnsOrDefault(a.props.numColumns),e={};return e[t?"ListItemComponent":"renderItem"]=function(r){if(1<s){var e=r.item,n=r.index;return invariant(Array.isArray(e),"Expected array of items with numColumns > 1"),React.createElement(View,{style:StyleSheet.compose(styles.row,o)},e.map(function(e,t){e=i({item:e,index:n*s+t,separators:r.separators});return null!=e?React.createElement(React.Fragment,{key:t},e):null}))}return i(r)},e},a._checkProps(a.props),a.props.viewabilityConfigCallbackPairs?a._virtualizedListPairs=a.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityConfig:e.viewabilityConfig,onViewableItemsChanged:a._createOnViewableItemsChanged(e.onViewableItemsChanged)}}):a.props.onViewableItemsChanged&&a._virtualizedListPairs.push({viewabilityConfig:a.props.viewabilityConfig,onViewableItemsChanged:a._createOnViewableItemsChanged(a.props.onViewableItemsChanged)}),a}return e.scrollToEnd=function(e){this._listRef&&this._listRef.scrollToEnd(e)},e.scrollToIndex=function(e){this._listRef&&this._listRef.scrollToIndex(e)},e.scrollToItem=function(e){this._listRef&&this._listRef.scrollToItem(e)},e.scrollToOffset=function(e){this._listRef&&this._listRef.scrollToOffset(e)},e.recordInteraction=function(){this._listRef&&this._listRef.recordInteraction()},e.flashScrollIndicators=function(){this._listRef&&this._listRef.flashScrollIndicators()},e.getScrollResponder=function(){if(this._listRef)return this._listRef.getScrollResponder()},e.getNativeScrollRef=function(){if(this._listRef)return this._listRef.getScrollRef()},e.getScrollableNode=function(){if(this._listRef)return this._listRef.getScrollableNode()},e.setNativeProps=function(e){this._listRef&&this._listRef.setNativeProps(e)},e.componentDidUpdate=function(e){invariant(e.numColumns===this.props.numColumns,"Changing numColumns on the fly is not supported. Change the key prop on FlatList when changing the number of columns to force a fresh render of the component."),invariant(e.onViewableItemsChanged===this.props.onViewableItemsChanged,"Changing onViewableItemsChanged on the fly is not supported"),invariant(!deepDiffer(e.viewabilityConfig,this.props.viewabilityConfig),"Changing viewabilityConfig on the fly is not supported"),invariant(e.viewabilityConfigCallbackPairs===this.props.viewabilityConfigCallbackPairs,"Changing viewabilityConfigCallbackPairs on the fly is not supported"),this._checkProps(this.props)},e._checkProps=function(e){var t=e.getItem,r=e.getItemCount,n=e.horizontal,i=e.columnWrapperStyle,o=e.onViewableItemsChanged,s=e.viewabilityConfigCallbackPairs,e=numColumnsOrDefault(this.props.numColumns);invariant(!t&&!r,"FlatList does not support custom data formats."),1<e?invariant(!n,"numColumns does not support horizontal."):invariant(!i,"columnWrapperStyle not supported for single column lists"),invariant(!(o&&s),"FlatList does not support setting both onViewableItemsChanged and viewabilityConfigCallbackPairs.")},e._pushMultiColumnViewable=function(r,n){var e,i=numColumnsOrDefault(this.props.numColumns),o=null!==(e=this.props.keyExtractor)&&void 0!==e?e:defaultKeyExtractor;n.item.forEach(function(e,t){invariant(null!=n.index,"Missing index!");t=n.index*i+t;r.push(_objectSpread(_objectSpread({},n),{},{item:e,key:o(e,t),index:t}))})},e._createOnViewableItemsChanged=function(i){var o=this;return function(e){var t,r,n=numColumnsOrDefault(o.props.numColumns);i&&(1<n?(t=[],r=[],e.viewableItems.forEach(function(e){return o._pushMultiColumnViewable(r,e)}),e.changed.forEach(function(e){return o._pushMultiColumnViewable(t,e)}),i({viewableItems:r,changed:t})):i(e))}},e.render=function(){var e=this.props,t=(e.numColumns,e.columnWrapperStyle,e.removeClippedSubviews),e=_objectWithoutPropertiesLoose(e,["numColumns","columnWrapperStyle","removeClippedSubviews"]);return React.createElement(VirtualizedList,_extends({},e,{getItem:this._getItem,getItemCount:this._getItemCount,keyExtractor:this._keyExtractor,ref:this._captureRef,viewabilityConfigCallbackPairs:this._virtualizedListPairs,removeClippedSubviews:removeClippedSubviewsOrDefault(t)},this._renderer()))},r}(React.PureComponent),styles=StyleSheet.create({row:{flexDirection:"row"}});export default FlatList;