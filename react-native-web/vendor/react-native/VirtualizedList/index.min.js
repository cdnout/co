function _createForOfIteratorHelperLoose(e,t){var r;if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator])return(r=e[Symbol.iterator]()).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,o=arguments[t];for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e}).apply(this,arguments)}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}import Batchinator from"../Batchinator";import FillRateHelper from"../FillRateHelper";import findNodeHandle from"../../../exports/findNodeHandle";import RefreshControl from"../../../exports/RefreshControl";import ScrollView from"../../../exports/ScrollView";import StyleSheet from"../../../exports/StyleSheet";import View from"../../../exports/View";import ViewabilityHelper from"../ViewabilityHelper";var flattenStyle=StyleSheet.flatten;import infoLog from"../infoLog";import invariant from"fbjs/lib/invariant";import{keyExtractor as defaultKeyExtractor,computeWindowedRenderLimits}from"../VirtualizeUtils";import*as React from"react";import{VirtualizedListCellContextProvider,VirtualizedListContext,VirtualizedListContextProvider}from"./VirtualizedListContext.js";var __DEV__="production"!==process.env.NODE_ENV,_usedIndexForKey=!1,_keylessItemComponentName="";function horizontalOrDefault(e){return null!=e&&e}function initialNumToRenderOrDefault(e){return null!=e?e:10}function maxToRenderPerBatchOrDefault(e){return null!=e?e:10}function onEndReachedThresholdOrDefault(e){return null!=e?e:2}function scrollEventThrottleOrDefault(e){return null!=e?e:50}function windowSizeOrDefault(e){return null!=e?e:21}var VirtualizedList=function(r){_inheritsLoose(t,r);var e=t.prototype;function t(e){var m=r.call(this,e)||this;m._getScrollMetrics=function(){return m._scrollMetrics},m._getOutermostParentListRef=function(){return m._isNestedWithSameOrientation()?m.context.getOutermostParentListRef():_assertThisInitialized(m)},m._getNestedChildState=function(e){e=m._nestedChildLists.get(e);return e&&e.state},m._registerAsNestedChild=function(e){var t=m._cellKeysToChildListKeys.get(e.cellKey)||new Set;t.add(e.key),m._cellKeysToChildListKeys.set(e.cellKey,t);t=m._nestedChildLists.get(e.key);t&&null!==t.ref&&console.error("A VirtualizedList contains a cell which itself contains more than one VirtualizedList of the same orientation as the parent list. You must pass a unique listKey prop to each sibling list.\n\n"+describeNestedLists(_objectSpread(_objectSpread({},e),{},{horizontal:!!e.ref.props.horizontal}))),m._nestedChildLists.set(e.key,{ref:e.ref,state:null}),m._hasInteracted&&e.ref.recordInteraction()},m._unregisterAsNestedChild=function(e){m._nestedChildLists.set(e.key,{ref:null,state:e.state})},m._onUpdateSeparators=function(e,t){e.forEach(function(e){e=null!=e&&m._cellRefs[e];e&&e.updateSeparatorProps(t)})},m._getSpacerKey=function(e){return e?"height":"width"},m._averageCellLength=0,m._cellKeysToChildListKeys=new Map,m._cellRefs={},m._frames={},m._footerLength=0,m._hasDoneInitialScroll=!1,m._hasInteracted=!1,m._hasMore=!1,m._hasWarned={},m._headerLength=0,m._hiPriInProgress=!1,m._highestMeasuredFrameIndex=0,m._indicesToKeys=new Map,m._nestedChildLists=new Map,m._offsetFromParentVirtualizedList=0,m._prevParentOffset=0,m._scrollMetrics={contentLength:0,dOffset:0,dt:10,offset:0,timestamp:0,velocity:0,visibleLength:0},m._scrollRef=null,m._sentEndForContentLength=0,m._totalCellLength=0,m._totalCellsMeasured=0,m._viewabilityTuples=[],m._captureScrollRef=function(e){m._scrollRef=e},m._defaultRenderScrollComponent=function(e){var t,r=e.onRefresh;return m._isNestedWithSameOrientation()?React.createElement(View,e):r?(invariant("boolean"==typeof e.refreshing,"`refreshing` prop must be set as a boolean in order to use `onRefresh`, but got `"+JSON.stringify(null!==(t=e.refreshing)&&void 0!==t?t:"undefined")+"`"),React.createElement(ScrollView,_extends({},e,{refreshControl:null==e.refreshControl?React.createElement(RefreshControl,{refreshing:e.refreshing,onRefresh:r,progressViewOffset:e.progressViewOffset}):e.refreshControl}))):React.createElement(ScrollView,e)},m._onCellUnmount=function(e){var t=m._frames[e];t&&(m._frames[e]=_objectSpread(_objectSpread({},t),{},{inLayout:!1}))},m._onLayout=function(e){m._isNestedWithSameOrientation()?m.measureLayoutRelativeToContainingList():m._scrollMetrics.visibleLength=m._selectLength(e.nativeEvent.layout),m.props.onLayout&&m.props.onLayout(e),m._scheduleCellsToRenderUpdate(),m._maybeCallOnEndReached()},m._onLayoutEmpty=function(e){m.props.onLayout&&m.props.onLayout(e)},m._onLayoutFooter=function(e){m._triggerRemeasureForChildListsInCell(m._getFooterCellKey()),m._footerLength=m._selectLength(e.nativeEvent.layout)},m._onLayoutHeader=function(e){m._headerLength=m._selectLength(e.nativeEvent.layout)},m._onContentSizeChange=function(e,t){0<e&&0<t&&null!=m.props.initialScrollIndex&&0<m.props.initialScrollIndex&&!m._hasDoneInitialScroll&&(null==m.props.contentOffset&&m.scrollToIndex({animated:!1,index:m.props.initialScrollIndex}),m._hasDoneInitialScroll=!0),m.props.onContentSizeChange&&m.props.onContentSizeChange(e,t),m._scrollMetrics.contentLength=m._selectLength({height:t,width:e}),m._scheduleCellsToRenderUpdate(),m._maybeCallOnEndReached()},m._convertParentScrollMetrics=function(e){var t=e.offset-m._offsetFromParentVirtualizedList,r=e.visibleLength,e=t-m._scrollMetrics.offset;return{visibleLength:r,contentLength:m._scrollMetrics.contentLength,offset:t,dOffset:e}},m._onScroll=function(t){m._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScroll(t)}),m.props.onScroll&&m.props.onScroll(t);var e=t.timeStamp,r=m._selectLength(t.nativeEvent.layoutMeasurement),o=m._selectLength(t.nativeEvent.contentSize),n=(s=m._selectOffset(t.nativeEvent.contentOffset))-m._scrollMetrics.offset;if(m._isNestedWithSameOrientation()){if(0===m._scrollMetrics.contentLength)return;var i=m._convertParentScrollMetrics({visibleLength:r,offset:s}),r=i.visibleLength,o=i.contentLength,s=i.offset,n=i.dOffset}var l=m._scrollMetrics.timestamp?Math.max(1,e-m._scrollMetrics.timestamp):1,i=n/l;500<l&&500<m._scrollMetrics.dt&&5*r<o&&!m._hasWarned.perf&&(infoLog("VirtualizedList: You have a large list that is slow to update - make sure your renderItem function renders components that follow React performance best practices like PureComponent, shouldComponentUpdate, etc.",{dt:l,prevDt:m._scrollMetrics.dt,contentLength:o}),m._hasWarned.perf=!0),m._scrollMetrics={contentLength:o,dt:l,dOffset:n,offset:s,timestamp:e,velocity:i,visibleLength:r},m._updateViewableItems(m.props.data),m.props&&(m._maybeCallOnEndReached(),0!=i&&m._fillRateHelper.activate(),m._computeBlankness(),m._scheduleCellsToRenderUpdate())},m._onScrollBeginDrag=function(t){m._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScrollBeginDrag(t)}),m._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),m._hasInteracted=!0,m.props.onScrollBeginDrag&&m.props.onScrollBeginDrag(t)},m._onScrollEndDrag=function(t){m._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScrollEndDrag(t)});var e=t.nativeEvent.velocity;e&&(m._scrollMetrics.velocity=m._selectOffset(e)),m._computeBlankness(),m.props.onScrollEndDrag&&m.props.onScrollEndDrag(t)},m._onMomentumScrollBegin=function(t){m._nestedChildLists.forEach(function(e){e.ref&&e.ref._onMomentumScrollBegin(t)}),m.props.onMomentumScrollBegin&&m.props.onMomentumScrollBegin(t)},m._onMomentumScrollEnd=function(t){m._nestedChildLists.forEach(function(e){e.ref&&e.ref._onMomentumScrollEnd(t)}),m._scrollMetrics.velocity=0,m._computeBlankness(),m.props.onMomentumScrollEnd&&m.props.onMomentumScrollEnd(t)},m._updateCellsToRender=function(){var e=m.props,p=e.data,d=e.getItemCount,u=onEndReachedThresholdOrDefault(e.onEndReachedThreshold),f=m._isVirtualizationDisabled();m._updateViewableItems(p),p&&m.setState(function(e){var t,r=m._scrollMetrics,o=r.contentLength,n=r.offset,r=r.visibleLength;if(f?(n=o-r-n<u*r?maxToRenderPerBatchOrDefault(m.props.maxToRenderPerBatch):0,t={first:0,last:Math.min(e.last+n,d(p)-1)}):0<r&&0<o&&(m.props.initialScrollIndex&&!m._scrollMetrics.offset||(t=computeWindowedRenderLimits(m.props.data,m.props.getItemCount,maxToRenderPerBatchOrDefault(m.props.maxToRenderPerBatch),windowSizeOrDefault(m.props.windowSize),e,m._getFrameMetricsApprox,m._scrollMetrics))),t&&0<m._nestedChildLists.size)for(var o=t.first,i=t.last,s=o;s<=i;s++){var l=m._indicesToKeys.get(s),l=l&&m._cellKeysToChildListKeys.get(l);if(l){for(var a=!1,c=_createForOfIteratorHelperLoose(l);!(h=c()).done;){var h=h.value,h=m._nestedChildLists.get(h);if(h&&h.ref&&h.ref.hasMore()){a=!0;break}}if(a){t.last=s;break}}}return t=null!=t&&t.first===e.first&&t.last===e.last?null:t})},m._createViewToken=function(e,t){var r=m.props,o=r.data,o=(0,r.getItem)(o,e);return{index:e,item:o,key:m._keyExtractor(o,e),isViewable:t}},m._getFrameMetricsApprox=function(e){var t=m._getFrameMetrics(e);if(t&&t.index===e)return t;t=m.props.getItemLayout;return invariant(!t,"Should not have to estimate frames when a measurement metrics function is provided"),{length:m._averageCellLength,offset:m._averageCellLength*e}},m._getFrameMetrics=function(e){var t=m.props,r=t.data,o=t.getItem,n=t.getItemCount,t=t.getItemLayout;invariant(n(r)>e,"Tried to get frame for out of range index "+e);o=o(r,e),o=o&&m._frames[m._keyExtractor(o,e)];return o&&o.index===e||t&&(o=t(r,e)),o},invariant(!e.onScroll||!e.onScroll.__isNative,"Components based on VirtualizedList must be wrapped with Animated.createAnimatedComponent to support native onScroll events with useNativeDriver"),invariant(0<windowSizeOrDefault(e.windowSize),"VirtualizedList: The windowSize prop must be present and set to a value greater than 0."),m._fillRateHelper=new FillRateHelper(m._getFrameMetrics),m._updateCellsToRenderBatcher=new Batchinator(m._updateCellsToRender,null!==(t=m.props.updateCellsBatchingPeriod)&&void 0!==t?t:50),m.props.viewabilityConfigCallbackPairs?m._viewabilityTuples=m.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityHelper:new ViewabilityHelper(e.viewabilityConfig),onViewableItemsChanged:e.onViewableItemsChanged}}):m.props.onViewableItemsChanged&&m._viewabilityTuples.push({viewabilityHelper:new ViewabilityHelper(m.props.viewabilityConfig),onViewableItemsChanged:m.props.onViewableItemsChanged});var t,e={first:m.props.initialScrollIndex||0,last:Math.min(m.props.getItemCount(m.props.data),(m.props.initialScrollIndex||0)+initialNumToRenderOrDefault(m.props.initialNumToRender))-1};return!m._isNestedWithSameOrientation()||(t=m.context.getNestedChildState(m._getListKey()))&&(m.state=e=t,m._frames=t.frames),m.invertedWheelEventHandler=function(e){var t;m.props.inverted&&m._scrollRef&&m._scrollRef.getScrollableNode&&(t=m._scrollRef.getScrollableNode(),m.props.horizontal?t.scrollLeft-=e.deltaX||e.wheelDeltaX:t.scrollTop-=e.deltaY||e.wheelDeltaY,e.preventDefault())},m.state=e,m}return e.scrollToEnd=function(e){var t=!e||e.animated,e=this.props.getItemCount(this.props.data)-1,e=this._getFrameMetricsApprox(e),e=Math.max(0,e.offset+e.length+this._footerLength-this._scrollMetrics.visibleLength);null!=this._scrollRef&&(null!=this._scrollRef.scrollTo?this._scrollRef.scrollTo(horizontalOrDefault(this.props.horizontal)?{x:e,animated:t}:{y:e,animated:t}):console.warn("No scrollTo method provided. This may be because you have two nested VirtualizedLists with the same orientation, or because you are using a custom component that does not implement scrollTo."))},e.scrollToIndex=function(e){var t=this.props,r=t.data,o=t.horizontal,n=t.getItemCount,i=t.getItemLayout,s=t.onScrollToIndexFailed,l=e.animated,a=e.index,t=e.viewOffset,e=e.viewPosition;if(invariant(0<=a,"scrollToIndex out of range: requested index "+a+" but minimum is 0"),invariant(1<=n(r),"scrollToIndex out of range: item length "+n(r)+" but minimum is 1"),invariant(a<n(r),"scrollToIndex out of range: requested index "+a+" is out of 0 to "+(n(r)-1)),!i&&a>this._highestMeasuredFrameIndex)return invariant(!!s,"scrollToIndex should be used in conjunction with getItemLayout or onScrollToIndexFailed, otherwise there is no way to know the location of offscreen indices or handle failures."),void s({averageItemLength:this._averageCellLength,highestMeasuredFrameIndex:this._highestMeasuredFrameIndex,index:a});a=this._getFrameMetricsApprox(a),t=Math.max(0,a.offset-(e||0)*(this._scrollMetrics.visibleLength-a.length))-(t||0);null!=this._scrollRef&&(null!=this._scrollRef.scrollTo?this._scrollRef.scrollTo(o?{x:t,animated:l}:{y:t,animated:l}):console.warn("No scrollTo method provided. This may be because you have two nested VirtualizedLists with the same orientation, or because you are using a custom component that does not implement scrollTo."))},e.scrollToItem=function(e){for(var t=e.item,r=this.props,o=r.data,n=r.getItem,i=(0,r.getItemCount)(o),s=0;s<i;s++)if(n(o,s)===t){this.scrollToIndex(_objectSpread(_objectSpread({},e),{},{index:s}));break}},e.scrollToOffset=function(e){var t=e.animated,e=e.offset;null!=this._scrollRef&&(null!=this._scrollRef.scrollTo?this._scrollRef.scrollTo(horizontalOrDefault(this.props.horizontal)?{x:e,animated:t}:{y:e,animated:t}):console.warn("No scrollTo method provided. This may be because you have two nested VirtualizedLists with the same orientation, or because you are using a custom component that does not implement scrollTo."))},e.recordInteraction=function(){this._nestedChildLists.forEach(function(e){e.ref&&e.ref.recordInteraction()}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),this._updateViewableItems(this.props.data)},e.flashScrollIndicators=function(){null!=this._scrollRef&&this._scrollRef.flashScrollIndicators()},e.getScrollResponder=function(){if(this._scrollRef&&this._scrollRef.getScrollResponder)return this._scrollRef.getScrollResponder()},e.getScrollableNode=function(){return this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode():findNodeHandle(this._scrollRef)},e.getScrollRef=function(){return this._scrollRef&&this._scrollRef.getScrollRef?this._scrollRef.getScrollRef():this._scrollRef},e.setNativeProps=function(e){this._scrollRef&&this._scrollRef.setNativeProps(e)},e._getCellKey=function(){var e;return(null==(e=this.context)?void 0:e.cellKey)||"rootList"},e._getListKey=function(){return this.props.listKey||this._getCellKey()},e._getDebugInfo=function(){var e;return{listKey:this._getListKey(),cellKey:this._getCellKey(),horizontal:horizontalOrDefault(this.props.horizontal),parent:null==(e=this.context)?void 0:e.debugInfo}},e.hasMore=function(){return this._hasMore},e.componentDidMount=function(){this._isNestedWithSameOrientation()&&this.context.registerAsNestedChild({cellKey:this._getCellKey(),key:this._getListKey(),ref:this,parentDebugInfo:this.context.debugInfo}),this.setupWebWheelHandler()},e.componentWillUnmount=function(){this._isNestedWithSameOrientation()&&this.context.unregisterAsNestedChild({key:this._getListKey(),state:{first:this.state.first,last:this.state.last,frames:this._frames}}),this._updateViewableItems(null),this._updateCellsToRenderBatcher.dispose({abort:!0}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.dispose()}),this._fillRateHelper.deactivateAndFlush(),this.teardownWebWheelHandler()},e.setupWebWheelHandler=function(){var e=this;this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode().addEventListener("wheel",this.invertedWheelEventHandler):setTimeout(function(){return e.setupWebWheelHandler()},50)},e.teardownWebWheelHandler=function(){this._scrollRef&&this._scrollRef.getScrollableNode&&this._scrollRef.getScrollableNode().removeEventListener("wheel",this.invertedWheelEventHandler)},t.getDerivedStateFromProps=function(e,t){var r=e.data,o=e.getItemCount,e=maxToRenderPerBatchOrDefault(e.maxToRenderPerBatch);return{first:Math.max(0,Math.min(t.first,o(r)-1-e)),last:Math.max(0,Math.min(t.last,o(r)-1))}},e._pushCells=function(o,n,i,e,t,s){var l,a=this,r=this.props,c=r.CellRendererComponent,h=r.ItemSeparatorComponent,p=r.data,d=r.getItem,u=r.getItemCount,f=r.horizontal,m=this.props.ListHeaderComponent?1:0,_=u(p)-1;t=Math.min(_,t);for(var g=e;g<=t;g++)!function(t){var e=d(p,t),r=a._keyExtractor(e,t);a._indicesToKeys.set(t,r),i.has(t+m)&&n.push(o.length),o.push(React.createElement(CellRenderer,{CellRendererComponent:c,ItemSeparatorComponent:t<_?h:void 0,cellKey:r,fillRateHelper:a._fillRateHelper,horizontal:f,index:t,inversionStyle:s,item:e,key:r,prevCellKey:l,onUpdateSeparators:a._onUpdateSeparators,onLayout:function(e){return a._onCellLayout(e,r,t)},onUnmount:a._onCellUnmount,parentProps:a.props,ref:function(e){a._cellRefs[r]=e}})),l=r}(g)},e._isVirtualizationDisabled=function(){return this.props.disableVirtualization||!1},e._isNestedWithSameOrientation=function(){var e=this.context;return!(!e||!!e.horizontal!==horizontalOrDefault(this.props.horizontal))},e._keyExtractor=function(e,t){if(null!=this.props.keyExtractor)return this.props.keyExtractor(e,t);var r=defaultKeyExtractor(e,t);return r===String(t)&&(_usedIndexForKey=!0,e.type&&e.type.displayName&&(_keylessItemComponentName=e.type.displayName)),r},e.render=function(){var t=this;!__DEV__||null!=(l=flattenStyle(this.props.contentContainerStyle))&&"wrap"===l.flexWrap&&console.warn("`flexWrap: `wrap`` is not supported with the `VirtualizedList` components.Consider using `numColumns` with `FlatList` instead.");var e=this.props,r=e.ListEmptyComponent,o=e.ListFooterComponent,n=e.ListHeaderComponent,i=this.props,s=i.data,l=i.horizontal,e=this._isVirtualizationDisabled(),a=this.props.inverted?horizontalOrDefault(this.props.horizontal)?styles.horizontallyInverted:styles.verticallyInverted:null,c=[],h=new Set(this.props.stickyHeaderIndices),p=[];n&&(h.has(0)&&p.push(0),m=React.isValidElement(n)?n:React.createElement(n,null),c.push(React.createElement(VirtualizedListCellContextProvider,{cellKey:this._getCellKey()+"-header",key:"$header"},React.createElement(View,{onLayout:this._onLayoutHeader,style:StyleSheet.compose(a,this.props.ListHeaderComponentStyle)},m))));var d,i=this.props.getItemCount(s);if(0<i){_usedIndexForKey=!1,_keylessItemComponentName="";var u=this._getSpacerKey(!l),f=this.props.initialScrollIndex?-1:initialNumToRenderOrDefault(this.props.initialNumToRender)-1,m=this.state,_=m.first,s=m.last;this._pushCells(c,p,h,0,f,a);l=Math.max(1+f,_);if(!e&&1+f<_){var g=!1;if(0<h.size)for(var y=n?1:0,v=l-1;f<v;v--)if(h.has(v+y)){var L=this._getFrameMetricsApprox(f),b=this._getFrameMetricsApprox(v),C=b.offset-L.offset-(this.props.initialScrollIndex?0:L.length);c.push(React.createElement(View,{key:"$sticky_lead",style:((L={})[u]=C,L)})),this._pushCells(c,p,h,v,v,a);L=this._getFrameMetricsApprox(_).offset-(b.offset+b.length);c.push(React.createElement(View,{key:"$sticky_trail",style:((b={})[u]=L,b)})),g=!0;break}g||(m=this._getFrameMetricsApprox(f),n=this._getFrameMetricsApprox(_).offset-(m.offset+m.length),c.push(React.createElement(View,{key:"$lead_spacer",style:((m={})[u]=n,m)})))}this._pushCells(c,p,h,l,s,a),!this._hasWarned.keys&&_usedIndexForKey&&(console.warn("VirtualizedList: missing keys for items, make sure to specify a key or id property on each item or provide a custom keyExtractor.",_keylessItemComponentName),this._hasWarned.keys=!0),!e&&s<i-1&&(s=this._getFrameMetricsApprox(s),i=this.props.getItemLayout?i-1:Math.min(i-1,this._highestMeasuredFrameIndex),i=(i=this._getFrameMetricsApprox(i)).offset+i.length-(s.offset+s.length),c.push(React.createElement(View,{key:"$tail_spacer",style:((s={})[u]=i,s)})))}else r&&(d=React.isValidElement(r)?r:React.createElement(r,null),c.push(React.cloneElement(d,{key:"$empty",onLayout:function(e){t._onLayoutEmpty(e),d.props.onLayout&&d.props.onLayout(e)},style:StyleSheet.compose(a,d.props.style)})));o&&(S=React.isValidElement(o)?o:React.createElement(o,null),c.push(React.createElement(VirtualizedListCellContextProvider,{cellKey:this._getFooterCellKey(),key:"$footer"},React.createElement(View,{onLayout:this._onLayoutFooter,style:StyleSheet.compose(a,this.props.ListFooterComponentStyle)},S))));var S=_objectSpread(_objectSpread({},this.props),{},{onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout,onScroll:this._onScroll,onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onMomentumScrollBegin:this._onMomentumScrollBegin,onMomentumScrollEnd:this._onMomentumScrollEnd,scrollEventThrottle:scrollEventThrottleOrDefault(this.props.scrollEventThrottle),invertStickyHeaders:void 0!==this.props.invertStickyHeaders?this.props.invertStickyHeaders:this.props.inverted,stickyHeaderIndices:p,style:a?[a,this.props.style]:this.props.style});this._hasMore=this.state.last<this.props.getItemCount(this.props.data)-1;S=React.createElement(VirtualizedListContextProvider,{value:{cellKey:null,getScrollMetrics:this._getScrollMetrics,horizontal:horizontalOrDefault(this.props.horizontal),getOutermostParentListRef:this._getOutermostParentListRef,getNestedChildState:this._getNestedChildState,registerAsNestedChild:this._registerAsNestedChild,unregisterAsNestedChild:this._unregisterAsNestedChild,debugInfo:this._getDebugInfo()}},React.cloneElement((this.props.renderScrollComponent||this._defaultRenderScrollComponent)(S),{ref:this._captureScrollRef},c));return this.props.debug?React.createElement(View,{style:styles.debug},S,this._renderDebugOverlay()):S},e.componentDidUpdate=function(e){var t=this.props,r=t.data,t=t.extraData;r===e.data&&t===e.extraData||this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.resetViewableIndices()});e=this._hiPriInProgress;this._scheduleCellsToRenderUpdate(),e&&(this._hiPriInProgress=!1)},e._computeBlankness=function(){this._fillRateHelper.computeBlankness(this.props,this.state,this._scrollMetrics)},e._onCellLayout=function(e,t,r){var o=e.nativeEvent.layout,e={offset:this._selectOffset(o),length:this._selectLength(o),index:r,inLayout:!0},o=this._frames[t];o&&e.offset===o.offset&&e.length===o.length&&r===o.index?this._frames[t].inLayout=!0:(this._totalCellLength+=e.length-(o?o.length:0),this._totalCellsMeasured+=o?0:1,this._averageCellLength=this._totalCellLength/this._totalCellsMeasured,this._frames[t]=e,this._highestMeasuredFrameIndex=Math.max(this._highestMeasuredFrameIndex,r),this._scheduleCellsToRenderUpdate()),this._triggerRemeasureForChildListsInCell(t),this._computeBlankness(),this._updateViewableItems(this.props.data)},e._triggerRemeasureForChildListsInCell=function(e){e=this._cellKeysToChildListKeys.get(e);if(e)for(var t=_createForOfIteratorHelperLoose(e);!(r=t()).done;){var r=r.value,r=this._nestedChildLists.get(r);r&&r.ref&&r.ref.measureLayoutRelativeToContainingList()}},e.measureLayoutRelativeToContainingList=function(){var n=this;try{if(!this._scrollRef)return;this._scrollRef.measureLayout(this.context.getOutermostParentListRef().getScrollRef(),function(e,t,r,o){n._offsetFromParentVirtualizedList=n._selectOffset({x:e,y:t}),n._scrollMetrics.contentLength=n._selectLength({width:r,height:o});o=n._convertParentScrollMetrics(n.context.getScrollMetrics());n._scrollMetrics.visibleLength===o.visibleLength&&n._scrollMetrics.offset===o.offset||(n._scrollMetrics.visibleLength=o.visibleLength,n._scrollMetrics.offset=o.offset,n._cellKeysToChildListKeys.forEach(function(e){if(e)for(var t=_createForOfIteratorHelperLoose(e);!(r=t()).done;){var r=r.value,r=n._nestedChildLists.get(r);r&&r.ref&&r.ref.measureLayoutRelativeToContainingList()}}))},function(e){console.warn("VirtualizedList: Encountered an error while measuring a list's offset from its containing VirtualizedList.")})}catch(e){console.warn("measureLayoutRelativeToContainingList threw an error",e.stack)}},e._getFooterCellKey=function(){return this._getCellKey()+"-footer"},e._renderDebugOverlay=function(){for(var r=this._scrollMetrics.visibleLength/(this._scrollMetrics.contentLength||1),e=[],t=this.props.getItemCount(this.props.data),o=0;o<t;o++){var n=this._getFrameMetricsApprox(o);n.inLayout&&e.push(n)}var i=this._getFrameMetricsApprox(this.state.first).offset,s=this._getFrameMetricsApprox(this.state.last),l=s.offset+s.length-i,a=this._scrollMetrics.offset,s=this._scrollMetrics.visibleLength;return React.createElement(View,{style:[styles.debugOverlayBase,styles.debugOverlay]},e.map(function(e,t){return React.createElement(View,{key:"f"+t,style:[styles.debugOverlayBase,styles.debugOverlayFrame,{top:e.offset*r,height:e.length*r}]})}),React.createElement(View,{style:[styles.debugOverlayBase,styles.debugOverlayFrameLast,{top:i*r,height:l*r}]}),React.createElement(View,{style:[styles.debugOverlayBase,styles.debugOverlayFrameVis,{top:a*r,height:s*r}]}))},e._selectLength=function(e){return horizontalOrDefault(this.props.horizontal)?e.width:e.height},e._selectOffset=function(e){return horizontalOrDefault(this.props.horizontal)?e.x:e.y},e._maybeCallOnEndReached=function(){var e=this.props,t=e.data,r=e.getItemCount,o=e.onEndReached,n=e.onEndReachedThreshold,i=this._scrollMetrics,s=i.contentLength,e=i.visibleLength,i=s-e-i.offset,e=null!=n?n*e:2;o&&this.state.last===r(t)-1&&i<e&&this._scrollMetrics.contentLength!==this._sentEndForContentLength?(this._sentEndForContentLength=this._scrollMetrics.contentLength,o({distanceFromEnd:i})):e<i&&(this._sentEndForContentLength=0)},e._scheduleCellsToRenderUpdate=function(){var e=this.state,t=e.first,r=e.last,o=this._scrollMetrics,n=o.offset,i=o.visibleLength,s=o.velocity,l=this.props.getItemCount(this.props.data),e=!1,o=onEndReachedThresholdOrDefault(this.props.onEndReachedThreshold)*i/2;0<t&&(t=n-this._getFrameMetricsApprox(t).offset,e=e||t<0||s<-2&&t<o),r<l-1&&(i=this._getFrameMetricsApprox(r).offset-(n+i),e=e||i<0||2<s&&i<o),e&&(this._averageCellLength||this.props.getItemLayout)&&!this._hiPriInProgress?(this._hiPriInProgress=!0,this._updateCellsToRenderBatcher.dispose({abort:!0}),this._updateCellsToRender()):this._updateCellsToRenderBatcher.schedule()},e._updateViewableItems=function(t){var r=this,o=this.props.getItemCount;this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.onUpdate(o(t),r._scrollMetrics.offset,r._scrollMetrics.visibleLength,r._getFrameMetrics,r._createViewToken,e.onViewableItemsChanged,r.state)})},t}(React.PureComponent);VirtualizedList.contextType=VirtualizedListContext;var CellRenderer=function(o){function e(){for(var n,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(n=o.call.apply(o,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:n.props.item}},n._separators={highlight:function(){var e=n.props,t=e.cellKey,e=e.prevCellKey;n.props.onUpdateSeparators([t,e],{highlighted:!0})},unhighlight:function(){var e=n.props,t=e.cellKey,e=e.prevCellKey;n.props.onUpdateSeparators([t,e],{highlighted:!1})},updateProps:function(e,t){var r=n.props,o=r.cellKey,r=r.prevCellKey;n.props.onUpdateSeparators(["leading"===e?r:o],t)}},n}_inheritsLoose(e,o),e.getDerivedStateFromProps=function(e,t){return{separatorProps:_objectSpread(_objectSpread({},t.separatorProps),{},{leadingItem:e.item})}};var t=e.prototype;return t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread(_objectSpread({},e.separatorProps),t)}})},t.componentWillUnmount=function(){this.props.onUnmount(this.props.cellKey)},t._renderElement=function(e,t,r,o){return e&&t&&console.warn("VirtualizedList: Both ListItemComponent and renderItem props are present. ListItemComponent will take precedence over renderItem."),t?React.createElement(t,{item:r,index:o,separators:this._separators}):e?e({item:r,index:o,separators:this._separators}):void invariant(!1,"VirtualizedList: Either ListItemComponent or renderItem props are required but none were found.")},t.render=function(){var e=this.props,t=e.CellRendererComponent,r=e.ItemSeparatorComponent,o=e.fillRateHelper,n=e.horizontal,i=e.item,s=e.index,l=e.inversionStyle,a=e.parentProps,c=a.renderItem,h=a.getItemLayout,e=a.ListItemComponent,s=this._renderElement(c,e,i,s),o=!h||a.debug||o.enabled()?this.props.onLayout:void 0,r=r&&React.createElement(r,this.state.separatorProps),l=l?n?[styles.rowReverse,l]:[styles.columnReverse,l]:n?[styles.row,l]:l,r=t?React.createElement(t,_extends({},this.props,{style:l,onLayout:o}),s,r):React.createElement(View,{style:l,onLayout:o},s,r);return React.createElement(VirtualizedListCellContextProvider,{cellKey:this.props.cellKey},r)},e}(React.Component);function describeNestedLists(e){for(var t="VirtualizedList trace:\n  Child ("+(e.horizontal?"horizontal":"vertical")+"):\n    listKey: "+e.key+"\n    cellKey: "+e.cellKey,r=e.parentDebugInfo;r;)t+="\n  Parent ("+(r.horizontal?"horizontal":"vertical")+"):\n    listKey: "+r.listKey+"\n    cellKey: "+r.cellKey,r=r.parent;return t}var styles=StyleSheet.create({verticallyInverted:{transform:[{scaleY:-1}]},horizontallyInverted:{transform:[{scaleX:-1}]},row:{flexDirection:"row"},rowReverse:{flexDirection:"row-reverse"},columnReverse:{flexDirection:"column-reverse"},debug:{flex:1},debugOverlayBase:{position:"absolute",top:0,right:0},debugOverlay:{bottom:0,width:20,borderColor:"blue",borderWidth:1},debugOverlayFrame:{left:0,backgroundColor:"orange"},debugOverlayFrameLast:{left:0,borderColor:"green",borderWidth:2},debugOverlayFrameVis:{left:0,borderColor:"red",borderWidth:2}});export default VirtualizedList;