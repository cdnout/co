"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}import Batchinator from"../Batchinator";import FillRateHelper from"../FillRateHelper";import PropTypes from"prop-types";import*as React from"react";import RefreshControl from"../../../exports/RefreshControl";import ScrollView from"../../../exports/ScrollView";import StyleSheet from"../../../exports/StyleSheet";import UIManager from"../../../exports/UIManager";import View from"../../../exports/View";import ViewabilityHelper from"../ViewabilityHelper";import findNodeHandle from"../../../exports/findNodeHandle";var flattenStyle=StyleSheet.flatten;import infoLog from"../infoLog";import invariant from"fbjs/lib/invariant";import warning from"fbjs/lib/warning";import{computeWindowedRenderLimits}from"../VirtualizeUtils";var __DEV__="production"!==process.env.NODE_ENV,_usedIndexForKey=!1,_keylessItemComponentName="",VirtualizedList=function(e){_inheritsLoose(r,e);var t=r.prototype;function r(t,r){var i;(i=e.call(this,t,r)||this)._getScrollMetrics=function(){return i._scrollMetrics},i._getOutermostParentListRef=function(){return i._isNestedWithSameOrientation()?i.context.virtualizedList.getOutermostParentListRef():_assertThisInitialized(i)},i._getNestedChildState=function(e){var t=i._nestedChildLists.get(e);return t&&t.state},i._registerAsNestedChild=function(e){var t=i._cellKeysToChildListKeys.get(e.cellKey)||new Set;t.add(e.key),i._cellKeysToChildListKeys.set(e.cellKey,t);var r=i._nestedChildLists.get(e.key);r&&null!==r.ref&&console.error("A VirtualizedList contains a cell which itself contains more than one VirtualizedList of the same orientation as the parent list. You must pass a unique listKey prop to each sibling list."),i._nestedChildLists.set(e.key,{ref:e.ref,state:null}),i._hasInteracted&&e.ref.recordInteraction()},i._unregisterAsNestedChild=function(e){i._nestedChildLists.set(e.key,{ref:null,state:e.state})},i._onUpdateSeparators=function(e,t){e.forEach(function(e){var r=null!=e&&i._cellRefs[e];r&&r.updateSeparatorProps(t)})},i._averageCellLength=0,i._cellKeysToChildListKeys=new Map,i._cellRefs={},i._frames={},i._footerLength=0,i._hasDataChangedSinceEndReached=!0,i._hasDoneInitialScroll=!1,i._hasInteracted=!1,i._hasMore=!1,i._hasWarned={},i._headerLength=0,i._hiPriInProgress=!1,i._highestMeasuredFrameIndex=0,i._indicesToKeys=new Map,i._nestedChildLists=new Map,i._offsetFromParentVirtualizedList=0,i._prevParentOffset=0,i._scrollMetrics={contentLength:0,dOffset:0,dt:10,offset:0,timestamp:0,velocity:0,visibleLength:0},i._scrollRef=null,i._sentEndForContentLength=0,i._totalCellLength=0,i._totalCellsMeasured=0,i._viewabilityTuples=[],i._captureScrollRef=function(e){i._scrollRef=e},i._defaultRenderScrollComponent=function(e){var t=e.onRefresh;return i._isNestedWithSameOrientation()?React.createElement(View,e):t?(invariant("boolean"==typeof e.refreshing,"`refreshing` prop must be set as a boolean in order to use `onRefresh`, but got `"+JSON.stringify(e.refreshing)+"`"),React.createElement(ScrollView,_extends({},e,{refreshControl:null==e.refreshControl?React.createElement(RefreshControl,{refreshing:e.refreshing,onRefresh:t,progressViewOffset:e.progressViewOffset}):e.refreshControl}))):React.createElement(ScrollView,e)},i._onCellUnmount=function(e){var t=i._frames[e];t&&(i._frames[e]=_objectSpread({},t,{inLayout:!1}))},i._onLayout=function(e){i._isNestedWithSameOrientation()?i.measureLayoutRelativeToContainingList():i._scrollMetrics.visibleLength=i._selectLength(e.nativeEvent.layout),i.props.onLayout&&i.props.onLayout(e),i._scheduleCellsToRenderUpdate(),i._maybeCallOnEndReached()},i._onLayoutEmpty=function(e){i.props.onLayout&&i.props.onLayout(e)},i._onLayoutFooter=function(e){i._footerLength=i._selectLength(e.nativeEvent.layout)},i._onLayoutHeader=function(e){i._headerLength=i._selectLength(e.nativeEvent.layout)},i._onContentSizeChange=function(e,t){e>0&&t>0&&null!=i.props.initialScrollIndex&&i.props.initialScrollIndex>0&&!i._hasDoneInitialScroll&&(i.scrollToIndex({animated:!1,index:i.props.initialScrollIndex}),i._hasDoneInitialScroll=!0),i.props.onContentSizeChange&&i.props.onContentSizeChange(e,t),i._scrollMetrics.contentLength=i._selectLength({height:t,width:e}),i._scheduleCellsToRenderUpdate(),i._maybeCallOnEndReached()},i._convertParentScrollMetrics=function(e){var t=e.offset-i._offsetFromParentVirtualizedList,r=e.visibleLength,s=t-i._scrollMetrics.offset;return{visibleLength:r,contentLength:i._scrollMetrics.contentLength,offset:t,dOffset:s}},i._onScroll=function(e){i._nestedChildLists.forEach(function(t){t.ref&&t.ref._onScroll(e)}),i.props.onScroll&&i.props.onScroll(e);var t=e.timeStamp,r=i._selectLength(e.nativeEvent.layoutMeasurement),s=i._selectLength(e.nativeEvent.contentSize),o=i._selectOffset(e.nativeEvent.contentOffset),n=o-i._scrollMetrics.offset;if(i._isNestedWithSameOrientation()){if(0===i._scrollMetrics.contentLength)return;var a=i._convertParentScrollMetrics({visibleLength:r,offset:o});r=a.visibleLength,s=a.contentLength,o=a.offset,n=a.dOffset}var l=i._scrollMetrics.timestamp?Math.max(1,t-i._scrollMetrics.timestamp):1,c=n/l;l>500&&i._scrollMetrics.dt>500&&s>5*r&&!i._hasWarned.perf&&(infoLog("VirtualizedList: You have a large list that is slow to update - make sure your renderItem function renders components that follow React performance best practices like PureComponent, shouldComponentUpdate, etc.",{dt:l,prevDt:i._scrollMetrics.dt,contentLength:s}),i._hasWarned.perf=!0),i._scrollMetrics={contentLength:s,dt:l,dOffset:n,offset:o,timestamp:t,velocity:c,visibleLength:r},i._updateViewableItems(i.props.data),i.props&&(i._maybeCallOnEndReached(),0!==c&&i._fillRateHelper.activate(),i._computeBlankness(),i._scheduleCellsToRenderUpdate())},i._onScrollBeginDrag=function(e){i._nestedChildLists.forEach(function(t){t.ref&&t.ref._onScrollBeginDrag(e)}),i._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),i._hasInteracted=!0,i.props.onScrollBeginDrag&&i.props.onScrollBeginDrag(e)},i._onScrollEndDrag=function(e){var t=e.nativeEvent.velocity;t&&(i._scrollMetrics.velocity=i._selectOffset(t)),i._computeBlankness(),i.props.onScrollEndDrag&&i.props.onScrollEndDrag(e)},i._onMomentumScrollEnd=function(e){i._scrollMetrics.velocity=0,i._computeBlankness(),i.props.onMomentumScrollEnd&&i.props.onMomentumScrollEnd(e)},i._updateCellsToRender=function(){var e=i.props,t=e.data,r=e.getItemCount,s=e.onEndReachedThreshold,o=i._isVirtualizationDisabled();i._updateViewableItems(t),t&&i.setState(function(e){var n;if(o){var a=i._scrollMetrics,l=a.contentLength,c=a.offset,p=a.visibleLength,h=l-p-c<s*p?i.props.maxToRenderPerBatch:0;n={first:0,last:Math.min(e.last+h,r(t)-1)}}else i._scrollMetrics.visibleLength&&(i.props.initialScrollIndex&&!i._scrollMetrics.offset||(n=computeWindowedRenderLimits(i.props,e,i._getFrameMetricsApprox,i._scrollMetrics)));if(n&&i._nestedChildLists.size>0)for(var d=n.first,u=n.last,f=d;f<=u;f++){var m=i._indicesToKeys.get(f),_=m&&i._cellKeysToChildListKeys.get(m);if(_){var g=!1,y=_,v=Array.isArray(y),C=0;for(y=v?y:y[Symbol.iterator]();;){var L;if(v){if(C>=y.length)break;L=y[C++]}else{if((C=y.next()).done)break;L=C.value}var b=L,S=i._nestedChildLists.get(b);if(S&&S.ref&&S.ref.hasMore()){g=!0;break}}if(g){n.last=f;break}}}return n})},i._createViewToken=function(e,t){var r=i.props,s=r.data,o=r.getItem,n=r.keyExtractor,a=o(s,e);return{index:e,item:a,key:n(a,e),isViewable:t}},i._getFrameMetricsApprox=function(e){var t=i._getFrameMetrics(e);if(t&&t.index===e)return t;var r=i.props.getItemLayout;return invariant(!r,"Should not have to estimate frames when a measurement metrics function is provided"),{length:i._averageCellLength,offset:i._averageCellLength*e}},i._getFrameMetrics=function(e){var t=i.props,r=t.data,s=t.getItem,o=t.getItemCount,n=t.getItemLayout,a=t.keyExtractor;invariant(o(r)>e,"Tried to get frame for out of range index "+e);var l=s(r,e),c=l&&i._frames[a(l,e)];if((!c||c.index!==e)&&n&&(c=n(r,e),__DEV__)){var p=PropTypes.shape({length:PropTypes.number.isRequired,offset:PropTypes.number.isRequired,index:PropTypes.number.isRequired}).isRequired;PropTypes.checkPropTypes({frame:p},{frame:c},"frame","VirtualizedList.getItemLayout")}return c},invariant(!t.onScroll||!t.onScroll.__isNative,"Components based on VirtualizedList must be wrapped with Animated.createAnimatedComponent to support native onScroll events with useNativeDriver"),invariant(t.windowSize>0,"VirtualizedList: The windowSize prop must be present and set to a value greater than 0."),i._fillRateHelper=new FillRateHelper(i._getFrameMetrics),i._updateCellsToRenderBatcher=new Batchinator(i._updateCellsToRender,i.props.updateCellsBatchingPeriod),i.props.viewabilityConfigCallbackPairs?i._viewabilityTuples=i.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityHelper:new ViewabilityHelper(e.viewabilityConfig),onViewableItemsChanged:e.onViewableItemsChanged}}):i.props.onViewableItemsChanged&&i._viewabilityTuples.push({viewabilityHelper:new ViewabilityHelper(i.props.viewabilityConfig),onViewableItemsChanged:i.props.onViewableItemsChanged});var s={first:i.props.initialScrollIndex||0,last:Math.min(i.props.getItemCount(i.props.data),(i.props.initialScrollIndex||0)+i.props.initialNumToRender)-1};if(i._isNestedWithSameOrientation()){var o=i.context.virtualizedList.getNestedChildState(i.props.listKey||i._getCellKey());o&&(s=o,i.state=o,i._frames=o.frames)}return i.state=s,i}return t.scrollToEnd=function(e){var t=!e||e.animated,r=this.props.getItemCount(this.props.data)-1,i=this._getFrameMetricsApprox(r),s=Math.max(0,i.offset+i.length+this._footerLength-this._scrollMetrics.visibleLength);this._scrollRef.scrollTo(this.props.horizontal?{x:s,animated:t}:{y:s,animated:t})},t.scrollToIndex=function(e){var t=this.props,r=t.data,i=t.horizontal,s=t.getItemCount,o=t.getItemLayout,n=t.onScrollToIndexFailed,a=e.animated,l=e.index,c=e.viewOffset,p=e.viewPosition;if(invariant(l>=0&&l<s(r),"scrollToIndex out of range: "+l+" vs "+(s(r)-1)),!o&&l>this._highestMeasuredFrameIndex)return invariant(!!n,"scrollToIndex should be used in conjunction with getItemLayout or onScrollToIndexFailed, otherwise there is no way to know the location of offscreen indices or handle failures."),void n({averageItemLength:this._averageCellLength,highestMeasuredFrameIndex:this._highestMeasuredFrameIndex,index:l});var h=this._getFrameMetricsApprox(l),d=Math.max(0,h.offset-(p||0)*(this._scrollMetrics.visibleLength-h.length))-(c||0);this._scrollRef.scrollTo(i?{x:d,animated:a}:{y:d,animated:a})},t.scrollToItem=function(e){for(var t=e.item,r=this.props,i=r.data,s=r.getItem,o=(0,r.getItemCount)(i),n=0;n<o;n++)if(s(i,n)===t){this.scrollToIndex(_objectSpread({},e,{index:n}));break}},t.scrollToOffset=function(e){var t=e.animated,r=e.offset;this._scrollRef.scrollTo(this.props.horizontal?{x:r,animated:t}:{y:r,animated:t})},t.recordInteraction=function(){this._nestedChildLists.forEach(function(e){e.ref&&e.ref.recordInteraction()}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),this._updateViewableItems(this.props.data)},t.flashScrollIndicators=function(){this._scrollRef.flashScrollIndicators()},t.getScrollResponder=function(){if(this._scrollRef&&this._scrollRef.getScrollResponder)return this._scrollRef.getScrollResponder()},t.getScrollableNode=function(){return this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode():findNodeHandle(this._scrollRef)},t.getScrollRef=function(){return this._scrollRef&&this._scrollRef.getScrollRef?this._scrollRef.getScrollRef():this._scrollRef},t.setNativeProps=function(e){this._scrollRef&&this._scrollRef.setNativeProps(e)},t.getChildContext=function(){return{virtualizedList:{getScrollMetrics:this._getScrollMetrics,horizontal:this.props.horizontal,getOutermostParentListRef:this._getOutermostParentListRef,getNestedChildState:this._getNestedChildState,registerAsNestedChild:this._registerAsNestedChild,unregisterAsNestedChild:this._unregisterAsNestedChild}}},t._getCellKey=function(){return this.context.virtualizedCell&&this.context.virtualizedCell.cellKey||"rootList"},t.hasMore=function(){return this._hasMore},t.componentDidMount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.registerAsNestedChild({cellKey:this._getCellKey(),key:this.props.listKey||this._getCellKey(),ref:this})},t.componentWillUnmount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.unregisterAsNestedChild({key:this.props.listKey||this._getCellKey(),state:{first:this.state.first,last:this.state.last,frames:this._frames}}),this._updateViewableItems(null),this._updateCellsToRenderBatcher.dispose({abort:!0}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.dispose()}),this._fillRateHelper.deactivateAndFlush()},r.getDerivedStateFromProps=function(e,t){var r=e.data,i=e.getItemCount,s=e.maxToRenderPerBatch;return{first:Math.max(0,Math.min(t.first,i(r)-1-s)),last:Math.max(0,Math.min(t.last,i(r)-1))}},t._pushCells=function(e,t,r,i,s,o){var n,a=this,l=this.props,c=l.CellRendererComponent,p=l.ItemSeparatorComponent,h=l.data,d=l.getItem,u=l.getItemCount,f=l.horizontal,m=l.keyExtractor,_=this.props.ListHeaderComponent?1:0,g=u(h)-1;s=Math.min(g,s);for(var y=function(i){var s=d(h,i),l=m(s,i);a._indicesToKeys.set(i,l),r.has(i+_)&&t.push(e.length),e.push(React.createElement(CellRenderer,{CellRendererComponent:c,ItemSeparatorComponent:i<g?p:void 0,cellKey:l,fillRateHelper:a._fillRateHelper,horizontal:f,index:i,inversionStyle:o,item:s,key:l,prevCellKey:n,onUpdateSeparators:a._onUpdateSeparators,onLayout:function(e){return a._onCellLayout(e,l,i)},onUnmount:a._onCellUnmount,parentProps:a.props,ref:function(e){a._cellRefs[l]=e}})),n=l},v=i;v<=s;v++)y(v)},t._isVirtualizationDisabled=function(){return this.props.disableVirtualization||!1},t._isNestedWithSameOrientation=function(){var e=this.context.virtualizedList;return!(!e||!!e.horizontal!=!!this.props.horizontal)},t.render=function(){var e=this;if(__DEV__){var t=flattenStyle(this.props.contentContainerStyle);warning(null==t||"wrap"!==t.flexWrap,"`flexWrap: `wrap`` is not supported with the `VirtualizedList` components.Consider using `numColumns` with `FlatList` instead.")}var r=this.props,i=r.ListEmptyComponent,s=r.ListFooterComponent,o=r.ListHeaderComponent,n=this.props,a=n.data,l=n.horizontal,c=this._isVirtualizationDisabled(),p=this.props.inverted?this.props.horizontal?styles.horizontallyInverted:styles.verticallyInverted:null,h=[],d=new Set(this.props.stickyHeaderIndices),u=[];if(o){d.has(0)&&u.push(0);var f=React.isValidElement(o)?o:React.createElement(o,null);h.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-header",key:"$header"},React.createElement(View,{onLayout:this._onLayoutHeader,style:StyleSheet.compose(p,this.props.ListHeaderComponentStyle)},f)))}var m=this.props.getItemCount(a);if(m>0){_usedIndexForKey=!1,_keylessItemComponentName="";var _=l?"width":"height",g=this.props.initialScrollIndex?-1:this.props.initialNumToRender-1,y=this.state,v=y.first,C=y.last;this._pushCells(h,u,d,0,g,p);var L=Math.max(g+1,v);if(!c&&v>g+1){var b=!1;if(d.size>0)for(var S=o?1:0,R=L-1;R>g;R--)if(d.has(R+S)){var w,x,I=this._getFrameMetricsApprox(g),M=this._getFrameMetricsApprox(R),T=M.offset-I.offset-(this.props.initialScrollIndex?0:I.length);h.push(React.createElement(View,{key:"$sticky_lead",style:(w={},w[_]=T,w)})),this._pushCells(h,u,d,R,R,p);var E=this._getFrameMetricsApprox(v).offset-(M.offset+M.length);h.push(React.createElement(View,{key:"$sticky_trail",style:(x={},x[_]=E,x)})),b=!0;break}if(!b){var P,V=this._getFrameMetricsApprox(g),z=this._getFrameMetricsApprox(v).offset-(V.offset+V.length);h.push(React.createElement(View,{key:"$lead_spacer",style:(P={},P[_]=z,P)}))}}if(this._pushCells(h,u,d,L,C,p),!this._hasWarned.keys&&_usedIndexForKey&&(console.warn("VirtualizedList: missing keys for items, make sure to specify a key or id property on each item or provide a custom keyExtractor.",_keylessItemComponentName),this._hasWarned.keys=!0),!c&&C<m-1){var O,k=this._getFrameMetricsApprox(C),F=this.props.getItemLayout?m-1:Math.min(m-1,this._highestMeasuredFrameIndex),K=this._getFrameMetricsApprox(F),N=K.offset+K.length-(k.offset+k.length);h.push(React.createElement(View,{key:"$tail_spacer",style:(O={},O[_]=N,O)}))}}else if(i){var D=React.isValidElement(i)?i:React.createElement(i,null);h.push(React.cloneElement(D,{key:"$empty",onLayout:function(t){e._onLayoutEmpty(t),D.props.onLayout&&D.props.onLayout(t)},style:StyleSheet.compose(p,D.props.style)}))}if(s){var A=React.isValidElement(s)?s:React.createElement(s,null);h.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-footer",key:"$footer"},React.createElement(View,{onLayout:this._onLayoutFooter,style:StyleSheet.compose(p,this.props.ListFooterComponentStyle)},A)))}var H=_objectSpread({},this.props,{onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout,onScroll:this._onScroll,onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onMomentumScrollEnd:this._onMomentumScrollEnd,scrollEventThrottle:this.props.scrollEventThrottle,invertStickyHeaders:void 0!==this.props.invertStickyHeaders?this.props.invertStickyHeaders:this.props.inverted,stickyHeaderIndices:u});p&&(H.style=[p,this.props.style]),this._hasMore=this.state.last<this.props.getItemCount(this.props.data)-1;var B=React.cloneElement((this.props.renderScrollComponent||this._defaultRenderScrollComponent)(H),{ref:this._captureScrollRef},h);return this.props.debug?React.createElement(View,{style:styles.debug},B,this._renderDebugOverlay()):B},t.componentDidUpdate=function(e){var t=this.props,r=t.data,i=t.extraData;r===e.data&&i===e.extraData||(this._hasDataChangedSinceEndReached=!0,this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.resetViewableIndices()}));var s=this._hiPriInProgress;this._scheduleCellsToRenderUpdate(),s&&(this._hiPriInProgress=!1)},t._computeBlankness=function(){this._fillRateHelper.computeBlankness(this.props,this.state,this._scrollMetrics)},t._onCellLayout=function(e,t,r){var i=e.nativeEvent.layout,s={offset:this._selectOffset(i),length:this._selectLength(i),index:r,inLayout:!0},o=this._frames[t];o&&s.offset===o.offset&&s.length===o.length&&r===o.index?this._frames[t].inLayout=!0:(this._totalCellLength+=s.length-(o?o.length:0),this._totalCellsMeasured+=o?0:1,this._averageCellLength=this._totalCellLength/this._totalCellsMeasured,this._frames[t]=s,this._highestMeasuredFrameIndex=Math.max(this._highestMeasuredFrameIndex,r),this._scheduleCellsToRenderUpdate());var n=this._cellKeysToChildListKeys.get(t);if(n){var a=n,l=Array.isArray(a),c=0;for(a=l?a:a[Symbol.iterator]();;){var p;if(l){if(c>=a.length)break;p=a[c++]}else{if((c=a.next()).done)break;p=c.value}var h=p,d=this._nestedChildLists.get(h);d&&d.ref&&d.ref.measureLayoutRelativeToContainingList()}}this._computeBlankness(),this._updateViewableItems(this.props.data)},t.measureLayoutRelativeToContainingList=function(){var e=this;try{if(!this._scrollRef)return;this._scrollRef.measureLayout(this.context.virtualizedList.getOutermostParentListRef().getScrollRef().getNativeScrollRef(),function(t,r,i,s){e._offsetFromParentVirtualizedList=e._selectOffset({x:t,y:r}),e._scrollMetrics.contentLength=e._selectLength({width:i,height:s});var o=e._convertParentScrollMetrics(e.context.virtualizedList.getScrollMetrics());e._scrollMetrics.visibleLength=o.visibleLength,e._scrollMetrics.offset=o.offset},function(e){console.warn("VirtualizedList: Encountered an error while measuring a list's offset from its containing VirtualizedList.")})}catch(e){console.warn("measureLayoutRelativeToContainingList threw an error",e.stack)}},t._renderDebugOverlay=function(){for(var e=this._scrollMetrics.visibleLength/(this._scrollMetrics.contentLength||1),t=[],r=this.props.getItemCount(this.props.data),i=0;i<r;i++){var s=this._getFrameMetricsApprox(i);s.inLayout&&t.push(s)}var o=this._getFrameMetricsApprox(this.state.first).offset,n=this._getFrameMetricsApprox(this.state.last),a=n.offset+n.length-o,l=this._scrollMetrics.offset,c=this._scrollMetrics.visibleLength;return React.createElement(View,{style:[styles.debugOverlayBase,styles.debugOverlay]},t.map(function(t,r){return React.createElement(View,{key:"f"+r,style:[styles.debugOverlayBase,styles.debugOverlayFrame,{top:t.offset*e,height:t.length*e}]})}),React.createElement(View,{style:[styles.debugOverlayBase,styles.debugOverlayFrameLast,{top:o*e,height:a*e}]}),React.createElement(View,{style:[styles.debugOverlayBase,styles.debugOverlayFrameVis,{top:l*e,height:c*e}]}))},t._selectLength=function(e){return this.props.horizontal?e.width:e.height},t._selectOffset=function(e){return this.props.horizontal?e.x:e.y},t._maybeCallOnEndReached=function(){var e=this.props,t=e.data,r=e.getItemCount,i=e.onEndReached,s=e.onEndReachedThreshold,o=this._scrollMetrics,n=o.contentLength,a=o.visibleLength,l=n-a-o.offset;i&&this.state.last===r(t)-1&&l<s*a&&(this._hasDataChangedSinceEndReached||this._scrollMetrics.contentLength!==this._sentEndForContentLength)&&(this._hasDataChangedSinceEndReached=!1,this._sentEndForContentLength=this._scrollMetrics.contentLength,i({distanceFromEnd:l}))},t._scheduleCellsToRenderUpdate=function(){var e=this.state,t=e.first,r=e.last,i=this._scrollMetrics,s=i.offset,o=i.visibleLength,n=i.velocity,a=this.props.getItemCount(this.props.data),l=!1,c=this.props.onEndReachedThreshold*o/2;if(t>0){var p=s-this._getFrameMetricsApprox(t).offset;l=l||p<0||n<-2&&p<c}if(r<a-1){var h=this._getFrameMetricsApprox(r).offset-(s+o);l=l||h<0||n>2&&h<c}if(l&&(this._averageCellLength||this.props.getItemLayout)&&!this._hiPriInProgress)return this._hiPriInProgress=!0,this._updateCellsToRenderBatcher.dispose({abort:!0}),void this._updateCellsToRender();this._updateCellsToRenderBatcher.schedule()},t._updateViewableItems=function(e){var t=this,r=this.props.getItemCount;this._viewabilityTuples.forEach(function(i){i.viewabilityHelper.onUpdate(r(e),t._scrollMetrics.offset,t._scrollMetrics.visibleLength,t._getFrameMetrics,t._createViewToken,i.onViewableItemsChanged,t.state)})},r}(React.PureComponent);VirtualizedList.defaultProps={disableVirtualization:!1,horizontal:!1,initialNumToRender:10,keyExtractor:function(e,t){return null!=e.key?e.key:null!=e.id?e.id:(_usedIndexForKey=!0,e.type&&e.type.displayName&&(_keylessItemComponentName=e.type.displayName),String(t))},maxToRenderPerBatch:10,onEndReachedThreshold:2,scrollEventThrottle:50,updateCellsBatchingPeriod:50,windowSize:21},VirtualizedList.contextTypes={virtualizedCell:PropTypes.shape({cellKey:PropTypes.string}),virtualizedList:PropTypes.shape({getScrollMetrics:PropTypes.func,horizontal:PropTypes.bool,getOutermostParentListRef:PropTypes.func,getNestedChildState:PropTypes.func,registerAsNestedChild:PropTypes.func,unregisterAsNestedChild:PropTypes.func})},VirtualizedList.childContextTypes={virtualizedList:PropTypes.shape({getScrollMetrics:PropTypes.func,horizontal:PropTypes.bool,getOutermostParentListRef:PropTypes.func,getNestedChildState:PropTypes.func,registerAsNestedChild:PropTypes.func,unregisterAsNestedChild:PropTypes.func})};var CellRenderer=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(t=e.call.apply(e,[this].concat(i))||this).state={separatorProps:{highlighted:!1,leadingItem:t.props.item}},t._separators={highlight:function(){var e=t.props,r=e.cellKey,i=e.prevCellKey;t.props.onUpdateSeparators([r,i],{highlighted:!0})},unhighlight:function(){var e=t.props,r=e.cellKey,i=e.prevCellKey;t.props.onUpdateSeparators([r,i],{highlighted:!1})},updateProps:function(e,r){var i=t.props,s=i.cellKey,o=i.prevCellKey;t.props.onUpdateSeparators(["leading"===e?o:s],r)}},t}_inheritsLoose(t,e);var r=t.prototype;return r.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},r.updateSeparatorProps=function(e){this.setState(function(t){return{separatorProps:_objectSpread({},t.separatorProps,{},e)}})},r.componentWillUnmount=function(){this.props.onUnmount(this.props.cellKey)},r.render=function(){var e=this.props,t=e.CellRendererComponent,r=e.ItemSeparatorComponent,i=e.fillRateHelper,s=e.horizontal,o=e.item,n=e.index,a=e.inversionStyle,l=e.parentProps,c=l.renderItem,p=l.getItemLayout;invariant(c,"no renderItem!");var h=c({item:o,index:n,separators:this._separators}),d=!p||l.debug||i.enabled()?this.props.onLayout:void 0,u=r&&React.createElement(r,this.state.separatorProps),f=a?s?[styles.rowReverse,a]:[styles.columnReverse,a]:s?[styles.row,a]:a;return t?React.createElement(t,_extends({},this.props,{style:f,onLayout:d}),h,u):React.createElement(View,{style:f,onLayout:d},h,u)},t}(React.Component);CellRenderer.childContextTypes={virtualizedCell:PropTypes.shape({cellKey:PropTypes.string})};var VirtualizedCellWrapper=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},r.render=function(){return this.props.children},t}(React.Component);VirtualizedCellWrapper.childContextTypes={virtualizedCell:PropTypes.shape({cellKey:PropTypes.string})};var styles=StyleSheet.create({verticallyInverted:{transform:[{scaleY:-1}]},horizontallyInverted:{transform:[{scaleX:-1}]},row:{flexDirection:"row"},rowReverse:{flexDirection:"row-reverse"},columnReverse:{flexDirection:"column-reverse"},debug:{flex:1},debugOverlayBase:{position:"absolute",top:0,right:0},debugOverlay:{bottom:0,width:20,borderColor:"blue",borderWidth:1},debugOverlayFrame:{left:0,backgroundColor:"orange"},debugOverlayFrameLast:{left:0,borderColor:"green",borderWidth:2},debugOverlayFrameVis:{left:0,borderColor:"red",borderWidth:2}});export default VirtualizedList;