"use strict";function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var n,o={},r=Object.keys(e),i=0;i<r.length;i++)n=r[i],0<=t.indexOf(n)||(o[n]=e[n]);return o}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}import View from"../../../exports/View";import{AnimatedEvent}from"./AnimatedEvent";import AnimatedProps from"./nodes/AnimatedProps";import*as React from"react";import NativeAnimatedHelper from"./NativeAnimatedHelper";import invariant from"fbjs/lib/invariant";import setAndForwardRef from"../Utilities/setAndForwardRef";var animatedComponentNextId=1;function createAnimatedComponent(r,e){invariant("function"!=typeof r||r.prototype&&r.prototype.isReactComponent,"`createAnimatedComponent` does not support stateless functional components; use a class component instead.");var n=function(o){function e(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(r=o.call.apply(o,[this].concat(t))||this)._invokeAnimatedPropsCallbackOnMount=!1,r._eventDetachers=[],r._animatedComponentId=animatedComponentNextId+++":animatedComponent",r._isFabric=function(){var e,t,n,o;return null!=r._component&&(null!=(null==(e=r._component._internalInstanceHandle)||null==(t=e.stateNode)?void 0:t.canonical)||null!=r._component.getNativeScrollRef&&null!=r._component.getNativeScrollRef()&&null!=(null==(t=r._component.getNativeScrollRef()._internalInstanceHandle)||null==(n=t.stateNode)?void 0:n.canonical)||null!=r._component.getScrollResponder&&null!=r._component.getScrollResponder()&&null!=r._component.getScrollResponder().getNativeScrollRef&&null!=r._component.getScrollResponder().getNativeScrollRef()&&null!=(null==(n=r._component.getScrollResponder().getNativeScrollRef()._internalInstanceHandle)||null==(o=n.stateNode)?void 0:o.canonical))},r._waitForUpdate=function(){r._isFabric()&&NativeAnimatedHelper.API.setWaitingForIdentifier(r._animatedComponentId)},r._markUpdateComplete=function(){r._isFabric()&&NativeAnimatedHelper.API.unsetWaitingForIdentifier(r._animatedComponentId)},r._animatedPropsCallback=function(){if(null==r._component)r._invokeAnimatedPropsCallbackOnMount=!0;else if("test"===process.env.NODE_ENV||"function"!=typeof r._component.setNativeProps||r._isFabric())r.forceUpdate();else{if(r._propsAnimated.__isNative)throw new Error('Attempting to run JS driven animation on animated node that has been moved to "native" earlier by starting an animation with `useNativeDriver: true`');r._component.setNativeProps(r._propsAnimated.__getAnimatedValue())}},r._setComponentRef=setAndForwardRef({getForwardedRef:function(){return r.props.forwardedRef},setLocalRef:function(t){r._prevComponent=r._component,null!=(r._component=t)&&null==t.getNode&&(t.getNode=function(){var e;return console.warn("%s: Calling `getNode()` on the ref of an Animated component is no longer necessary. You can now directly use the ref instead. This method will be removed in a future release.",null!==(e=t.constructor.name)&&void 0!==e?e:"<<anonymous>>"),t})}}),r}_inheritsLoose(e,o);var t=e.prototype;return t._attachNativeEvents=function(){var e,t,n=this,o=null!=(e=this._component)&&e.getScrollableNode?this._component.getScrollableNode():this._component;for(t in this.props)!function(e){var t=n.props[e];t instanceof AnimatedEvent&&t.__isNative&&(t.__attach(o,e),n._eventDetachers.push(function(){return t.__detach(o,e)}))}(t)},t._detachNativeEvents=function(){this._eventDetachers.forEach(function(e){return e()}),this._eventDetachers=[]},t._attachProps=function(e){var t=this._propsAnimated;e!==t&&(this._propsAnimated=new AnimatedProps(e,this._animatedPropsCallback),t&&(t.__restoreDefaultValues(),t.__detach()))},t.render=function(){var e=this._propsAnimated.__getValue()||{},t=e.style,n=void 0===t?{}:t,o=_objectWithoutPropertiesLoose(e,["style"]),t=this.props.passthroughAnimatedPropExplicitValues||{},e=t.style,e=void 0===e?{}:e,t=_objectWithoutPropertiesLoose(t,["style"]),e=_objectSpread(_objectSpread({},n),e);return React.createElement(r,_extends({},o,t,{style:e,ref:this._setComponentRef}))},t.UNSAFE_componentWillMount=function(){this._waitForUpdate(),this._attachProps(this.props)},t.componentDidMount=function(){this._invokeAnimatedPropsCallbackOnMount&&(this._invokeAnimatedPropsCallbackOnMount=!1,this._animatedPropsCallback()),this._propsAnimated.setNativeView(this._component),this._attachNativeEvents(),this._markUpdateComplete()},t.UNSAFE_componentWillReceiveProps=function(e){this._waitForUpdate(),this._attachProps(e)},t.componentDidUpdate=function(e){this._component!==this._prevComponent&&this._propsAnimated.setNativeView(this._component),this._component===this._prevComponent&&e===this.props||(this._detachNativeEvents(),this._attachNativeEvents()),this._markUpdateComplete()},t.componentWillUnmount=function(){this._propsAnimated&&this._propsAnimated.__detach(),this._detachNativeEvents(),this._markUpdateComplete(),this._component=null,this._prevComponent=null},e}(React.Component);return React.forwardRef(function(e,t){return React.createElement(n,_extends({},e,null==t?null:{forwardedRef:t}))})}export default createAnimatedComponent;