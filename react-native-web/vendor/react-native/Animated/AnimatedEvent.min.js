"use strict";import AnimatedValue from"./nodes/AnimatedValue";import NativeAnimatedHelper from"./NativeAnimatedHelper";import findNodeHandle from"../../../exports/findNodeHandle";import invariant from"fbjs/lib/invariant";var shouldUseNativeDriver=NativeAnimatedHelper.shouldUseNativeDriver;function attachNativeEvent(e,t,i){var n=[];invariant(i[0]&&i[0].nativeEvent,"Native driven events only support animated values contained inside `nativeEvent`."),function e(t,i){if(t instanceof AnimatedValue)t.__makeNative(),n.push({nativeEventPath:i,animatedValueTag:t.__getNativeTag()});else if("object"==typeof t)for(var a in t)e(t[a],i.concat(a))}(i[0].nativeEvent,[]);var a=findNodeHandle(e);return n.forEach(function(e){NativeAnimatedHelper.API.addAnimatedEventToView(a,t,e)}),{detach:function(){n.forEach(function(e){NativeAnimatedHelper.API.removeAnimatedEventFromView(a,t,e.animatedValueTag)})}}}var AnimatedEvent=function(){function e(e,t){void 0===t&&(t={}),this._listeners=[],this._argMapping=e,t.listener&&this.__addListener(t.listener),this._callListeners=this._callListeners.bind(this),this._attachedEvent=null,this.__isNative=shouldUseNativeDriver(t),"production"!==process.env.NODE_ENV&&this._validateMapping()}var t=e.prototype;return t.__addListener=function(e){this._listeners.push(e)},t.__removeListener=function(e){this._listeners=this._listeners.filter(function(t){return t!==e})},t.__attach=function(e,t){invariant(this.__isNative,"Only native driven events need to be attached."),this._attachedEvent=attachNativeEvent(e,t,this._argMapping)},t.__detach=function(e,t){invariant(this.__isNative,"Only native driven events need to be detached."),this._attachedEvent&&this._attachedEvent.detach()},t.__getHandler=function(){var e=this;return this.__isNative?this._callListeners:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];e.__isNative||e._argMapping.forEach(function(e,t){!function e(t,i,n){if("number"==typeof i&&t instanceof AnimatedValue)t.setValue(i);else if("object"==typeof t)for(var a in t)e(t[a],i[a])}(e,i[t])}),e._callListeners.apply(e,i)}},t._callListeners=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._listeners.forEach(function(e){return e.apply(void 0,t)})},t._validateMapping=function(){},e}();export{AnimatedEvent,attachNativeEvent};export default{AnimatedEvent:AnimatedEvent,attachNativeEvent:attachNativeEvent};