"use strict";import AnimatedValue from"./nodes/AnimatedValue";import NativeAnimatedHelper from"./NativeAnimatedHelper";import findNodeHandle from"../../../exports/findNodeHandle";import invariant from"fbjs/lib/invariant";import{shouldUseNativeDriver}from"./NativeAnimatedHelper";var __DEV__="production"!==process.env.NODE_ENV;function attachNativeEvent(e,t,n){function a(e,t){if(e instanceof AnimatedValue)e.__makeNative(),i.push({nativeEventPath:t,animatedValueTag:e.__getNativeTag()});else if("object"==typeof e)for(var n in e)a(e[n],t.concat(n))}var i=[];invariant(n[0]&&n[0].nativeEvent,"Native driven events only support animated values contained inside `nativeEvent`."),a(n[0].nativeEvent,[]);var r=findNodeHandle(e);return null!=r&&i.forEach(function(e){NativeAnimatedHelper.API.addAnimatedEventToView(r,t,e)}),{detach:function(){null!=r&&i.forEach(function(e){NativeAnimatedHelper.API.removeAnimatedEventFromView(r,t,e.animatedValueTag)})}}}function validateMapping(e,n){function i(e,t,n){if(e instanceof AnimatedValue)invariant("number"==typeof t,"Bad mapping of event key "+n+", should be number but got "+typeof t);else if("number"!=typeof t)for(var a in invariant("object"==typeof e,"Bad mapping of type "+typeof e+" for key "+n),invariant("object"==typeof t,"Bad event of type "+typeof t+" for key "+n),e)i(e[a],t[a],a);else invariant(e instanceof AnimatedValue,"Bad mapping of type "+typeof e+" for key "+n+", event value must map to AnimatedValue")}invariant(n.length>=e.length,"Event has less arguments than mapping"),e.forEach(function(e,t){i(e,n[t],"arg"+t)})}var AnimatedEvent=function(){function e(e,t){this._listeners=[],this._argMapping=e,null==t&&(console.warn("Animated.event now requires a second argument for options"),t={useNativeDriver:!1}),t.listener&&this.__addListener(t.listener),this._callListeners=this._callListeners.bind(this),this._attachedEvent=null,this.__isNative=shouldUseNativeDriver(t)}var t=e.prototype;return t.__addListener=function(e){this._listeners.push(e)},t.__removeListener=function(t){this._listeners=this._listeners.filter(function(e){return e!==t})},t.__attach=function(e,t){invariant(this.__isNative,"Only native driven events need to be attached."),this._attachedEvent=attachNativeEvent(e,t,this._argMapping)},t.__detach=function(e,t){invariant(this.__isNative,"Only native driven events need to be detached."),this._attachedEvent&&this._attachedEvent.detach()},t.__getHandler=function(){var a=this;if(this.__isNative){if(__DEV__){var i=!1;return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i||(validateMapping(a._argMapping,t),i=!0),a._callListeners.apply(a,t)}}return this._callListeners}var r=!1;return function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];__DEV__&&!r&&(validateMapping(a._argMapping,n),r=!0);function i(e,t,n){if(e instanceof AnimatedValue)"number"==typeof t&&e.setValue(t);else if("object"==typeof e)for(var a in e)i(e[a],t[a])}a._argMapping.forEach(function(e,t){i(e,n[t])}),a._callListeners.apply(a,n)}},t._callListeners=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._listeners.forEach(function(e){return e.apply(void 0,t)})},e}();export{attachNativeEvent,AnimatedEvent};