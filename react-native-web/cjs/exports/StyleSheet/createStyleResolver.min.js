"use strict";exports.__esModule=!0,exports.default=createStyleResolver;var _ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment"),_createCSSStyleSheet=_interopRequireDefault(require("./createCSSStyleSheet")),_createCompileableStyle=_interopRequireDefault(require("./createCompileableStyle")),_createOrderedCSSStyleSheet=_interopRequireDefault(require("./createOrderedCSSStyleSheet")),_flattenArray=_interopRequireDefault(require("../../modules/flattenArray")),_flattenStyle=_interopRequireDefault(require("./flattenStyle")),_I18nManager=_interopRequireDefault(require("../I18nManager")),_i18nStyle=_interopRequireDefault(require("./i18nStyle")),_compile=require("./compile"),_initialRules=_interopRequireDefault(require("./initialRules")),_modality=_interopRequireDefault(require("./modality")),_constants=require("./constants");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function createStyleResolver(){function t(){o={css:{},ltr:{},rtl:{},rtlNoSwap:{}},c=(0,_createOrderedCSSStyleSheet.default)((0,_createCSSStyleSheet.default)(_constants.STYLE_ELEMENT_ID)),s={},(0,_modality.default)(function(e){return c.insert(e,_constants.STYLE_GROUPS.modality)}),_initialRules.default.forEach(function(e){c.insert(e,_constants.STYLE_GROUPS.reset)})}var o,c,s,f={css:{},ltr:{},rtl:{},rtlNoSwap:{}};function S(e){var l,t=_I18nManager.default.getConstants(),r=t.doLeftAndRightSwapInRTL,t=t.isRTL?r?"rtl":"rtlNoSwap":"ltr";o[t][e]||(r=(0,_createCompileableStyle.default)((0,_i18nStyle.default)((0,_flattenStyle.default)(e))),l=(0,_compile.atomic)(r),Object.keys(l).forEach(function(e){var t=l[e],r=t.identifier,n=t.property,a=t.rules,e=t.value;t=r,r=e,s[e=n]||(s[e]={}),s[e][r]=t,a.forEach(function(e){var t=_constants.STYLE_GROUPS.custom[n]||_constants.STYLE_GROUPS.atomic;c.insert(e,t)})}),o[t][e]=!0)}function _(e,t){var r=_I18nManager.default.getConstants(),n=r.doLeftAndRightSwapInRTL,n=r.isRTL?n?"rtl":"rtlNoSwap":"ltr";if(null!=t&&null!=f[n][t])return f[n][t];var e=(0,_flattenStyle.default)(e),i=(0,_createCompileableStyle.default)((0,_i18nStyle.default)(e)),e=Object.keys(i).sort().reduce(function(r,e){var n,t,a,l=i[e];return null!=l&&(t=e,a=l,a=(0,_compile.stringifyValueWithProperty)(a,t),(a=s[t]&&s[t].hasOwnProperty(a)&&s[t][a])?r.classList.push(a):"animationKeyframes"===e||"placeholderTextColor"===e||"pointerEvents"===e||"scrollbarWidth"===e?(n=(0,_compile.atomic)(((a={})[e]=l,a)),Object.keys(n).forEach(function(e){var t=n[e],e=t.identifier,t=t.rules;r.classList.push(e),t.forEach(function(e){c.insert(e,_constants.STYLE_GROUPS.atomic)})})):(r.style||(r.style={}),r.style[e]=l)),r},{classList:[]});return e.style&&(e.style=(0,_compile.inline)(e.style)),null!=t&&(f[n][t]=e),e}return t(),{getStyleSheet:function(){var e=c.getTextContent();return _ExecutionEnvironment.canUseDOM||t(),{id:_constants.STYLE_ELEMENT_ID,textContent:e}},createCSS:function(t,a){var l={};return Object.keys(t).forEach(function(r){var e=t[r],n=(0,_compile.classic)(e,r);Object.keys(n).forEach(function(e){var t=n[e],e=t.identifier,t=t.rules;f.css[e]={group:a||_constants.STYLE_GROUPS.classic,rules:t},l[r]=e})}),l},resolve:function(e,t){var r=[],n={};if(!e&&!t)return n;if(Array.isArray(t)&&(0,_flattenArray.default)(t).forEach(function(e){var t;e&&(null==o.css[e]&&null!=f.css[e]&&((t=f.css[e]).rules.forEach(function(e){c.insert(e,t.group)}),o.css[e]=!0),r.push(e))}),"number"==typeof e){S(e);n=_(e,createCacheKey(e))}else if(Array.isArray(e)){for(var a=(0,_flattenArray.default)(e),l=!0,i="",s=0;s<a.length;s++){var u=a[s];"number"!=typeof u?l=!1:(l&&(i+=u+"-"),S(u))}n=_(a,l?createCacheKey(i):null)}else n=_(e);return r.push.apply(r,n.classList),e={className:classListToString(r),classList:r},n.style&&(e.style=n.style),e},get sheet(){return c}}}var createCacheKey=function(e){return"rn-"+e},classListToString=function(e){return e.join(" ").trim()};module.exports=exports.default;