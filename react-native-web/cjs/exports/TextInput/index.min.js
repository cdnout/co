"use strict";exports.__esModule=!0,exports.default=void 0;var React=_interopRequireWildcard(require("react")),_createElement=_interopRequireDefault(require("../createElement")),forwardedProps=_interopRequireWildcard(require("../../modules/forwardedProps")),_pick=_interopRequireDefault(require("../../modules/pick")),_useElementLayout=_interopRequireDefault(require("../../modules/useElementLayout")),_useLayoutEffect=_interopRequireDefault(require("../../modules/useLayoutEffect")),_useMergeRefs=_interopRequireDefault(require("../../modules/useMergeRefs")),_usePlatformMethods=_interopRequireDefault(require("../../modules/usePlatformMethods")),_useResponderEvents=_interopRequireDefault(require("../../modules/useResponderEvents")),_useLocale=require("../../modules/useLocale"),_StyleSheet=_interopRequireDefault(require("../StyleSheet")),_TextInputState=_interopRequireDefault(require("../../modules/TextInputState"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,o,n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&((o=u?Object.getOwnPropertyDescriptor(e,r):null)&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var isSelectionStale=function(e,t){var r=e.selectionEnd,o=e.selectionStart,e=t.start,t=t.end;return e!==o||t!==r},setSelection=function(e,t){if(isSelectionStale(e,t)){var r=t.start,t=t.end;try{e.setSelectionRange(r,t||r)}catch(e){}}},forwardPropsList=_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},forwardedProps.defaultProps),forwardedProps.accessibilityProps),forwardedProps.clickProps),forwardedProps.focusProps),forwardedProps.keyboardProps),forwardedProps.mouseProps),forwardedProps.touchProps),forwardedProps.styleProps),{},{autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,defaultValue:!0,disabled:!0,lang:!0,maxLength:!0,onChange:!0,onScroll:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,rows:!0,spellCheck:!0,value:!0,type:!0}),pickProps=function(e){return(0,_pick.default)(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var focusTimeout=null,TextInput=React.forwardRef(function(e,t){var r,o,n=e.autoCapitalize,u=void 0===n?"sentences":n,a=e.autoComplete,l=e.autoCompleteType,i=e.autoCorrect,s=void 0===i||i,d=e.blurOnSubmit,c=e.clearTextOnFocus,p=e.dir,f=e.editable,S=void 0===f||f,h=e.keyboardType,v=e.multiline,R=void 0!==v&&v,y=e.numberOfLines,_=void 0===y?1:y,b=e.onBlur,m=e.onChange,g=e.onChangeText,C=e.onContentSizeChange,P=e.onFocus,w=e.onKeyPress,x=e.onLayout,T=e.onMoveShouldSetResponder,E=e.onMoveShouldSetResponderCapture,O=e.onResponderEnd,j=e.onResponderGrant,q=e.onResponderMove,k=e.onResponderReject,D=e.onResponderRelease,M=e.onResponderStart,L=e.onResponderTerminate,I=e.onResponderTerminationRequest,F=e.onScrollShouldSetResponder,W=e.onScrollShouldSetResponderCapture,z=e.onSelectionChange,K=e.onSelectionChangeShouldSetResponder,N=e.onSelectionChangeShouldSetResponderCapture,A=e.onStartShouldSetResponder,n=e.onStartShouldSetResponderCapture,B=e.onSubmitEditing,i=e.placeholderTextColor,f=e.returnKeyType,v=e.secureTextEntry,y=void 0!==v&&v,G=e.selection,H=e.selectTextOnFocus,v=e.spellCheck;switch(void 0===h?"default":h){case"email-address":r="email";break;case"number-pad":case"numeric":o="numeric";break;case"decimal-pad":o="decimal";break;case"phone-pad":r="tel";break;case"search":case"web-search":r="search";break;case"url":r="url";break;default:r="text"}y&&(r="password");var $=React.useRef({height:null,width:null}),V=React.useRef(null),J=React.useCallback(function(e){var t;R&&C&&null!=e&&(t=e.scrollHeight,e=e.scrollWidth,t===$.current.height&&e===$.current.width||($.current.height=t,$.current.width=e,C({nativeEvent:{contentSize:{height:$.current.height,width:$.current.width}}})))},[R,C]),h=React.useMemo(function(){return function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&_TextInputState.default.currentlyFocusedField()===e},J(e))}},[J]);(0,_useLayoutEffect.default)(function(){var e=V.current;null!=e&&null!=G&&setSelection(e,G),document.activeElement===e&&(_TextInputState.default._currentlyFocusedNode=e)},[V,G]);y=R?"textarea":"input";(0,_useElementLayout.default)(V,x),(0,_useResponderEvents.default)(V,{onMoveShouldSetResponder:T,onMoveShouldSetResponderCapture:E,onResponderEnd:O,onResponderGrant:j,onResponderMove:q,onResponderReject:k,onResponderRelease:D,onResponderStart:M,onResponderTerminate:L,onResponderTerminationRequest:I,onScrollShouldSetResponder:F,onScrollShouldSetResponderCapture:W,onSelectionChangeShouldSetResponder:K,onSelectionChangeShouldSetResponderCapture:N,onStartShouldSetResponder:A,onStartShouldSetResponderCapture:n});A=(0,_useLocale.useLocaleContext)().direction,n=pickProps(e);n.autoCapitalize=u,n.autoComplete=a||l||"on",n.autoCorrect=s?"on":"off",n.dir=void 0!==p?p:"auto",n.enterKeyHint=f,n.inputMode=o,n.onBlur=function(e){_TextInputState.default._currentlyFocusedNode=null,b&&(e.nativeEvent.text=e.target.value,b(e))},n.onChange=function(e){var t=e.target,r=t.value;e.nativeEvent.text=r,J(t),m&&m(e),g&&g(r)},n.onFocus=function(e){var t=e.target;P&&(e.nativeEvent.text=t.value,P(e)),null!=t&&(_TextInputState.default._currentlyFocusedNode=t,c&&(t.value=""),H&&(null!=focusTimeout&&clearTimeout(focusTimeout),focusTimeout=setTimeout(function(){null!=t&&t.select()},0)))},n.onKeyDown=function(e){var t=e.target;e.stopPropagation();var r=null==d?!R:d,o=e.nativeEvent,n=isEventComposing(o);w&&w(e),"Enter"!==e.key||e.shiftKey||n||e.isDefaultPrevented()||(!d&&R||!B||(e.preventDefault(),o.text=e.target.value,B(e)),r&&null!=t&&t.blur())},n.onSelect=function(e){if(z)try{var t=e.target,r=t.selectionStart,o=t.selectionEnd;e.nativeEvent.selection={start:r,end:o},e.nativeEvent.text=e.target.value,z(e)}catch(e){}},n.readOnly=!S,n.rows=R?_:void 0,n.spellCheck=null!=v?v:s,n.style=[{"--placeholderTextColor":i},styles.textinput$raw,styles.placeholder,e.style],n.type=R?void 0:r;i=(0,_usePlatformMethods.default)(n),t=(0,_useMergeRefs.default)(V,i,h,t);n.ref=t;t=null!=e.lang?(0,_useLocale.getLocaleDirection)(e.lang):null,t=e.dir||t;return(0,_createElement.default)(y,n,{writingDirection:t||A})});TextInput.displayName="TextInput",TextInput.State=_TextInputState.default;var styles=_StyleSheet.default.create({textinput$raw:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"},placeholder:{placeholderTextColor:"var(--placeholderTextColor)"}}),_default=TextInput;exports.default=_default,module.exports=exports.default;