"use strict";exports.__esModule=!0,exports.default=void 0;var _react=require("react"),_createElement=_interopRequireDefault(require("../createElement")),_css=_interopRequireDefault(require("../StyleSheet/css")),_pick=_interopRequireDefault(require("../../modules/pick")),_useElementLayout=_interopRequireDefault(require("../../modules/useElementLayout")),_useLayoutEffect=_interopRequireDefault(require("../../modules/useLayoutEffect")),_useMergeRefs=_interopRequireDefault(require("../../modules/useMergeRefs")),_usePlatformMethods=_interopRequireDefault(require("../../modules/usePlatformMethods")),_useResponderEvents=_interopRequireDefault(require("../../modules/useResponderEvents")),_StyleSheet=_interopRequireDefault(require("../StyleSheet")),_TextInputState=_interopRequireDefault(require("../../modules/TextInputState"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var isSelectionStale=function(e,t){var n=e.selectionEnd,o=e.selectionStart,e=t.start,t=t.end;return e!==o||t!==n},setSelection=function(e,t){if(isSelectionStale(e,t)){var n=t.start,o=t.end;try{e.setSelectionRange(n,o||n)}catch(e){}}},forwardPropsList={accessibilityLabel:!0,accessibilityLiveRegion:!0,accessibilityRole:!0,accessibilityState:!0,accessibilityValue:!0,accessible:!0,autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,children:!0,classList:!0,defaultValue:!0,dir:!0,disabled:!0,importantForAccessibility:!0,maxLength:!0,nativeID:!0,onBlur:!0,onChange:!0,onClick:!0,onClickCapture:!0,onContextMenu:!0,onFocus:!0,onScroll:!0,onTouchCancel:!0,onTouchCancelCapture:!0,onTouchEnd:!0,onTouchEndCapture:!0,onTouchMove:!0,onTouchMoveCapture:!0,onTouchStart:!0,onTouchStartCapture:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,ref:!0,rows:!0,spellCheck:!0,style:!0,value:!0,testID:!0,type:!0,dataSet:!0,onMouseDown:!0,onMouseEnter:!0,onMouseLeave:!0,onMouseMove:!0,onMouseOver:!0,onMouseOut:!0,onMouseUp:!0},pickProps=function(e){return(0,_pick.default)(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var TextInput=(0,_react.forwardRef)(function(e,t){var n,o=e.autoCapitalize,r=void 0===o?"sentences":o,u=e.autoComplete,a=e.autoCompleteType,l=e.autoCorrect,s=void 0===l||l,i=e.blurOnSubmit,c=e.clearTextOnFocus,d=e.dir,p=e.editable,S=void 0===p||p,f=e.keyboardType,h=void 0===f?"default":f,v=e.multiline,R=void 0!==v&&v,C=e.numberOfLines,m=void 0===C?1:C,_=e.onBlur,y=e.onChange,x=e.onChangeText,g=e.onContentSizeChange,T=e.onFocus,b=e.onKeyPress,E=e.onLayout,M=e.onMoveShouldSetResponder,k=e.onMoveShouldSetResponderCapture,q=e.onResponderEnd,D=e.onResponderGrant,L=e.onResponderMove,w=e.onResponderReject,I=e.onResponderRelease,F=e.onResponderStart,P=e.onResponderTerminate,z=e.onResponderTerminationRequest,O=e.onScrollShouldSetResponder,K=e.onScrollShouldSetResponderCapture,N=e.onSelectionChange,A=e.onSelectionChangeShouldSetResponder,B=e.onSelectionChangeShouldSetResponderCapture,j=e.onStartShouldSetResponder,o=e.onStartShouldSetResponderCapture,G=e.onSubmitEditing,l=e.placeholderTextColor,p=e.returnKeyType,f=e.secureTextEntry,v=void 0!==f&&f,V=e.selection,W=e.selectTextOnFocus,C=e.spellCheck;switch(h){case"email-address":n="email";break;case"number-pad":case"numeric":Q="numeric";break;case"decimal-pad":Q="decimal";break;case"phone-pad":n="tel";break;case"search":case"web-search":n="search";break;case"url":n="url";break;default:n="text"}v&&(n="password");var H=(0,_react.useRef)({height:null,width:null}),U=(0,_react.useRef)(null),J=(0,_react.useCallback)(function(){var e,t=U.current;R&&g&&null!=t&&(e=t.scrollHeight,t=t.scrollWidth,e===H.current.height&&t===H.current.width||(H.current.height=e,H.current.width=t,g({nativeEvent:{contentSize:{height:H.current.height,width:H.current.width}}})))},[U,R,g]),f=(0,_react.useMemo)(function(){return function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&_TextInputState.default.currentlyFocusedField()===e},J())}},[J]);(0,_useLayoutEffect.default)(function(){var e=U.current;null!=e&&null!=V&&setSelection(e,V),document.activeElement===e&&(_TextInputState.default._currentlyFocusedNode=e)},[U,V]);h=R?"textarea":"input",v=[classes.textinput],l=_StyleSheet.default.compose(e.style,l&&{placeholderTextColor:l});(0,_useElementLayout.default)(U,E),(0,_useResponderEvents.default)(U,{onMoveShouldSetResponder:M,onMoveShouldSetResponderCapture:k,onResponderEnd:q,onResponderGrant:D,onResponderMove:L,onResponderReject:w,onResponderRelease:I,onResponderStart:F,onResponderTerminate:P,onResponderTerminationRequest:z,onScrollShouldSetResponder:O,onScrollShouldSetResponderCapture:K,onSelectionChangeShouldSetResponder:A,onSelectionChangeShouldSetResponderCapture:B,onStartShouldSetResponder:j,onStartShouldSetResponderCapture:o});e=pickProps(e);e.autoCapitalize=r,e.autoComplete=u||a||"on",e.autoCorrect=s?"on":"off",e.classList=v,e.dir=void 0!==d?d:"auto",e.enterkeyhint=p,e.onBlur=function(e){_TextInputState.default._currentlyFocusedNode=null,_&&(e.nativeEvent.text=e.target.value,_(e))},e.onChange=function(e){var t=e.target.value;e.nativeEvent.text=t,J(),y&&y(e),x&&x(t)},e.onFocus=function(e){var t=U.current;null!=t&&(_TextInputState.default._currentlyFocusedNode=t,T&&(e.nativeEvent.text=e.target.value,T(e)),c&&(t.value=""),W&&setTimeout(function(){t.select()},0))},e.onKeyDown=function(e){e.stopPropagation();var t=null==i?!R:i,n=e.nativeEvent,o=isEventComposing(n);b&&b(e),"Enter"!==e.key||e.shiftKey||o||e.isDefaultPrevented()||(!i&&R||!G||(e.preventDefault(),n.text=e.target.value,G(e)),t&&null!=U.current&&U.current.blur())},e.onSelect=function(e){if(N)try{var t=e.target,n=t.selectionStart,t=t.selectionEnd;e.nativeEvent.selection={start:n,end:t},e.nativeEvent.text=e.target.value,N(e)}catch(e){}},e.readOnly=!S,e.rows=R?m:void 0,e.spellCheck=null!=C?C:s,e.style=l,e.type=R?void 0:n,e.inputMode=Q;var Q=(0,_usePlatformMethods.default)(e),t=(0,_useMergeRefs.default)(U,Q,f,t);return e.ref=t,(0,_createElement.default)(h,e)});TextInput.displayName="TextInput",TextInput.State=_TextInputState.default;var classes=_css.default.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}}),_default=TextInput;exports.default=TextInput,module.exports=exports.default;