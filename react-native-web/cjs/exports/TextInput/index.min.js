"use strict";exports.__esModule=!0,exports.default=void 0;var _react=require("react"),_createElement=_interopRequireDefault(require("../createElement")),_css=_interopRequireDefault(require("../StyleSheet/css")),forwardedProps=_interopRequireWildcard(require("../../modules/forwardedProps")),_pick=_interopRequireDefault(require("../../modules/pick")),_useElementLayout=_interopRequireDefault(require("../../modules/useElementLayout")),_useLayoutEffect=_interopRequireDefault(require("../../modules/useLayoutEffect")),_useMergeRefs=_interopRequireDefault(require("../../modules/useMergeRefs")),_usePlatformMethods=_interopRequireDefault(require("../../modules/usePlatformMethods")),_useResponderEvents=_interopRequireDefault(require("../../modules/useResponderEvents")),_StyleSheet=_interopRequireDefault(require("../StyleSheet")),_TextInputState=_interopRequireDefault(require("../../modules/TextInputState"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,o,n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&((o=u?Object.getOwnPropertyDescriptor(e,r):null)&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var isSelectionStale=function(e,t){var r=e.selectionEnd,o=e.selectionStart,e=t.start,t=t.end;return e!==o||t!==r},setSelection=function(e,t){if(isSelectionStale(e,t)){var r=t.start,o=t.end;try{e.setSelectionRange(r,o||r)}catch(e){}}},forwardPropsList=_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},forwardedProps.defaultProps),forwardedProps.accessibilityProps),forwardedProps.clickProps),forwardedProps.focusProps),forwardedProps.keyboardProps),forwardedProps.mouseProps),forwardedProps.touchProps),forwardedProps.styleProps),{},{autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,defaultValue:!0,disabled:!0,lang:!0,maxLength:!0,onChange:!0,onScroll:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,rows:!0,spellCheck:!0,value:!0,type:!0}),pickProps=function(e){return(0,_pick.default)(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var TextInput=(0,_react.forwardRef)(function(e,t){var r,o=e.autoCapitalize,n=void 0===o?"sentences":o,u=e.autoComplete,a=e.autoCompleteType,l=e.autoCorrect,s=void 0===l||l,i=e.blurOnSubmit,d=e.clearTextOnFocus,c=e.dir,p=e.editable,f=void 0===p||p,S=e.keyboardType,h=void 0===S?"default":S,v=e.multiline,_=void 0!==v&&v,y=e.numberOfLines,R=void 0===y?1:y,b=e.onBlur,m=e.onChange,g=e.onChangeText,P=e.onContentSizeChange,C=e.onFocus,w=e.onKeyPress,x=e.onLayout,E=e.onMoveShouldSetResponder,O=e.onMoveShouldSetResponderCapture,j=e.onResponderEnd,q=e.onResponderGrant,T=e.onResponderMove,k=e.onResponderReject,D=e.onResponderRelease,M=e.onResponderStart,I=e.onResponderTerminate,L=e.onResponderTerminationRequest,F=e.onScrollShouldSetResponder,W=e.onScrollShouldSetResponderCapture,z=e.onSelectionChange,K=e.onSelectionChangeShouldSetResponder,N=e.onSelectionChangeShouldSetResponderCapture,A=e.onStartShouldSetResponder,o=e.onStartShouldSetResponderCapture,B=e.onSubmitEditing,l=e.placeholderTextColor,p=e.returnKeyType,S=e.secureTextEntry,v=void 0!==S&&S,G=e.selection,H=e.selectTextOnFocus,y=e.spellCheck;switch(h){case"email-address":r="email";break;case"number-pad":case"numeric":U="numeric";break;case"decimal-pad":U="decimal";break;case"phone-pad":r="tel";break;case"search":case"web-search":r="search";break;case"url":r="url";break;default:r="text"}v&&(r="password");var V=(0,_react.useRef)({height:null,width:null}),J=(0,_react.useRef)(null),Q=(0,_react.useCallback)(function(){var e,t=J.current;_&&P&&null!=t&&(e=t.scrollHeight,t=t.scrollWidth,e===V.current.height&&t===V.current.width||(V.current.height=e,V.current.width=t,P({nativeEvent:{contentSize:{height:V.current.height,width:V.current.width}}})))},[J,_,P]),S=(0,_react.useMemo)(function(){return function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&_TextInputState.default.currentlyFocusedField()===e},Q())}},[Q]);(0,_useLayoutEffect.default)(function(){var e=J.current;null!=e&&null!=G&&setSelection(e,G),document.activeElement===e&&(_TextInputState.default._currentlyFocusedNode=e)},[J,G]);h=_?"textarea":"input",v=[classes.textinput],l=_StyleSheet.default.compose(e.style,l&&{placeholderTextColor:l});(0,_useElementLayout.default)(J,x),(0,_useResponderEvents.default)(J,{onMoveShouldSetResponder:E,onMoveShouldSetResponderCapture:O,onResponderEnd:j,onResponderGrant:q,onResponderMove:T,onResponderReject:k,onResponderRelease:D,onResponderStart:M,onResponderTerminate:I,onResponderTerminationRequest:L,onScrollShouldSetResponder:F,onScrollShouldSetResponderCapture:W,onSelectionChangeShouldSetResponder:K,onSelectionChangeShouldSetResponderCapture:N,onStartShouldSetResponder:A,onStartShouldSetResponderCapture:o});e=pickProps(e);e.autoCapitalize=n,e.autoComplete=u||a||"on",e.autoCorrect=s?"on":"off",e.classList=v,e.dir=void 0!==c?c:"auto",e.enterKeyHint=p,e.onBlur=function(e){_TextInputState.default._currentlyFocusedNode=null,b&&(e.nativeEvent.text=e.target.value,b(e))},e.onChange=function(e){var t=e.target.value;e.nativeEvent.text=t,Q(),m&&m(e),g&&g(t)},e.onFocus=function(e){var t=J.current;null!=t&&(_TextInputState.default._currentlyFocusedNode=t,C&&(e.nativeEvent.text=e.target.value,C(e)),d&&(t.value=""),H&&setTimeout(function(){t.select()},0))},e.onKeyDown=function(e){e.stopPropagation();var t=null==i?!_:i,r=e.nativeEvent,o=isEventComposing(r);w&&w(e),"Enter"!==e.key||e.shiftKey||o||e.isDefaultPrevented()||(!i&&_||!B||(e.preventDefault(),r.text=e.target.value,B(e)),t&&null!=J.current&&J.current.blur())},e.onSelect=function(e){if(z)try{var t=e.target,r=t.selectionStart,t=t.selectionEnd;e.nativeEvent.selection={start:r,end:t},e.nativeEvent.text=e.target.value,z(e)}catch(e){}},e.readOnly=!f,e.rows=_?R:void 0,e.spellCheck=null!=y?y:s,e.style=l,e.type=_?void 0:r,e.inputMode=U;var U=(0,_usePlatformMethods.default)(e),t=(0,_useMergeRefs.default)(J,U,S,t);return e.ref=t,(0,_createElement.default)(h,e)});TextInput.displayName="TextInput",TextInput.State=_TextInputState.default;var classes=_css.default.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}}),_default=TextInput;exports.default=TextInput,module.exports=exports.default;