"use strict";exports.__esModule=!0,exports.default=void 0;var React=_interopRequireWildcard(require("react")),_createElement=_interopRequireDefault(require("../createElement")),_AssetRegistry=require("../../modules/AssetRegistry"),_preprocess=require("../StyleSheet/preprocess"),_ImageLoader=_interopRequireDefault(require("../../modules/ImageLoader")),_PixelRatio=_interopRequireDefault(require("../PixelRatio")),_StyleSheet=_interopRequireDefault(require("../StyleSheet")),_TextAncestorContext=_interopRequireDefault(require("../Text/TextAncestorContext")),_View=_interopRequireDefault(require("../View"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,n,o={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(o,r,n):o[r]=e[r]);return o.default=e,t&&t.set(e,o),o}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,n={},o=Object.keys(e),a=0;a<o.length;a++)r=o[a],0<=t.indexOf(r)||(n[r]=e[r]);return n}var ERRORED="ERRORED",LOADED="LOADED",LOADING="LOADING",IDLE="IDLE",_filterId=0,svgDataUriPattern=/^(data:image\/svg\+xml;utf8,)(.*)/;function createTintColorSVG(e,t){return e&&null!=t?React.createElement("svg",{style:{position:"absolute",height:0,visibility:"hidden",width:0}},React.createElement("defs",null,React.createElement("filter",{id:"tint-"+t,suppressHydrationWarning:!0},React.createElement("feFlood",{floodColor:""+e,key:e}),React.createElement("feComposite",{in2:"SourceAlpha",operator:"atop"})))):null}function getFlatStyle(e,t,r){var n=_StyleSheet.default.flatten(e),o=n.filter,a=n.resizeMode,i=n.shadowOffset,u=n.tintColor,l=[],e=null;return o&&l.push(o),t&&l.push("blur("+t+"px)"),!i||(i=(0,_preprocess.createBoxShadowValue)(n))&&l.push("drop-shadow("+i+")"),u&&null!=r&&l.push("url(#tint-"+r+")"),0<l.length&&(e=l.join(" ")),delete n.blurRadius,delete n.shadowColor,delete n.shadowOpacity,delete n.shadowOffset,delete n.shadowRadius,delete n.tintColor,delete n.overlayColor,delete n.resizeMode,[n,a,e,u]}function resolveAssetDimensions(e){if("number"==typeof e){var t=(0,_AssetRegistry.getAssetByID)(e);return{height:t.height,width:t.width}}if(null!=e&&!Array.isArray(e)&&"object"==typeof e)return{height:e.height,width:e.width}}function resolveAssetUri(e){var r,t,n=null;if("number"==typeof e?(t=(o=(0,_AssetRegistry.getAssetByID)(e)).scales[0],1<o.scales.length&&(r=_PixelRatio.default.get(),t=o.scales.reduce(function(e,t){return Math.abs(t-r)<Math.abs(e-r)?t:e})),n=o?o.httpServerLocation+"/"+o.name+(1!==t?"@"+t+"x":"")+"."+o.type:""):"string"==typeof e?n=e:e&&"string"==typeof e.uri&&(n=e.uri),n){var o=n.match(svgDataUriPattern);if(o){e=o[1],o=o[2];return""+e+encodeURIComponent(o)}}return n}var Image=React.forwardRef(function(e,t){var r=e.accessibilityLabel,n=e.blurRadius,o=e.defaultSource,a=e.draggable,i=e.onError,u=e.onLayout,l=e.onLoad,c=e.onLoadEnd,s=e.onLoadStart,d=e.pointerEvents,f=e.source,p=e.style,g=_objectWithoutPropertiesLoose(e,["accessibilityLabel","blurRadius","defaultSource","draggable","onError","onLayout","onLoad","onLoadEnd","onLoadStart","pointerEvents","source","style"]);if("production"!==process.env.NODE_ENV&&e.children)throw new Error("The <Image> component cannot contain children. If you want to render content on top of the image, consider using the <ImageBackground> component or absolute positioning.");var h=React.useState(function(){var e=resolveAssetUri(f);if(null!=e&&_ImageLoader.default.has(e))return LOADED;return IDLE}),y=h[0],b=h[1],_=React.useState({}),m=_[0],R=_[1],S=React.useContext(_TextAncestorContext.default),v=React.useRef(null),O=React.useRef(_filterId++),w=React.useRef(null),h=y===LOADED||y===LOADING&&null==o,_=getFlatStyle(p,n,O.current),y=_[0],p=_[1],n=_[2],_=_[3],D=e.resizeMode||p||"cover",e=h?f:o,p=resolveAssetUri(e),h=resolveAssetDimensions(e),o=p?'url("'+p+'")':null,e=function(){if(null!=v.current&&("center"===D||"repeat"===D)){var e=v.current,t=e.naturalHeight,r=e.naturalWidth,n=m.height,e=m.width;if(t&&r&&n&&e){n=Math.min(1,e/r,n/t),r=Math.ceil(n*r),t=Math.ceil(n*t);return r+"px "+t+"px"}}}(),p=p?(0,_createElement.default)("img",{alt:r||"",style:styles.accessibilityImage$raw,draggable:a||!1,ref:v,src:p}):null;var E=resolveAssetUri(f);return React.useEffect(function(){function e(){null!=w.current&&(_ImageLoader.default.abort(w.current),w.current=null)}return e(),null!=E&&(b(LOADING),s&&s(),w.current=_ImageLoader.default.load(E,function(e){b(LOADED),l&&l(e),c&&c()},function(){b(ERRORED),i&&i({nativeEvent:{error:"Failed to load resource "+E+" (404)"}}),c&&c()})),e},[E,w,b,i,l,c,s]),React.createElement(_View.default,_extends({},g,{accessibilityLabel:r,onLayout:function(e){var t;"center"!==D&&"repeat"!==D&&!u||(t=e.nativeEvent.layout,u&&u(e),R(t))},pointerEvents:d,ref:t,style:[styles.root,S&&styles.inline,h,y]}),React.createElement(_View.default,{style:[styles.image,resizeModeStyles[D],{backgroundImage:o,filter:n},null!=e&&{backgroundSize:e}],suppressHydrationWarning:!0}),p,createTintColorSVG(_,O.current))});Image.displayName="Image";var ImageWithStatics=Image;ImageWithStatics.getSize=function(e,t,r){_ImageLoader.default.getSize(e,t,r)},ImageWithStatics.prefetch=function(e){return _ImageLoader.default.prefetch(e)},ImageWithStatics.queryCache=function(e){return _ImageLoader.default.queryCache(e)};var styles=_StyleSheet.default.create({root:{flexBasis:"auto",overflow:"hidden",zIndex:0},inline:{display:"inline-flex"},image:_objectSpread(_objectSpread({},_StyleSheet.default.absoluteFillObject),{},{backgroundColor:"transparent",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",height:"100%",width:"100%",zIndex:-1}),accessibilityImage$raw:_objectSpread(_objectSpread({},_StyleSheet.default.absoluteFillObject),{},{height:"100%",opacity:0,width:"100%",zIndex:-1})}),resizeModeStyles=_StyleSheet.default.create({center:{backgroundSize:"auto"},contain:{backgroundSize:"contain"},cover:{backgroundSize:"cover"},none:{backgroundPosition:"0",backgroundSize:"auto"},repeat:{backgroundPosition:"0",backgroundRepeat:"repeat",backgroundSize:"auto"},stretch:{backgroundSize:"100% 100%"}}),_default=ImageWithStatics;exports.default=_default,module.exports=exports.default;