"use strict";exports.__esModule=!0,exports.getActiveModality=getActiveModality,exports.getModality=getModality,exports.addModalityListener=addModalityListener,exports.testOnly_resetActiveModality=testOnly_resetActiveModality;var _createEventHandle=_interopRequireDefault(require("../createEventHandle")),_ExecutionEnvironment=_interopRequireDefault(require("fbjs/lib/ExecutionEnvironment"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var previousModality,previousActiveModality,canUseDOM=_ExecutionEnvironment.default.canUseDOM,supportsPointerEvent=function(){return!("undefined"==typeof window||null==window.PointerEvent)},activeModality="keyboard",modality="keyboard",isEmulatingMouseEvents=!1,listeners=new Set,KEYBOARD="keyboard",MOUSE="mouse",TOUCH="touch",BLUR="blur",CONTEXTMENU="contextmenu",FOCUS="focus",KEYDOWN="keydown",MOUSEDOWN="mousedown",MOUSEMOVE="mousemove",MOUSEUP="mouseup",POINTERDOWN="pointerdown",POINTERMOVE="pointermove",SCROLL="scroll",SELECTIONCHANGE="selectionchange",TOUCHCANCEL="touchcancel",TOUCHMOVE="touchmove",TOUCHSTART="touchstart",VISIBILITYCHANGE="visibilitychange",bubbleOptions={passive:!0},captureOptions={capture:!0,passive:!0},addBlurListener=(0,_createEventHandle.default)(BLUR,bubbleOptions),addFocusListener=(0,_createEventHandle.default)(FOCUS,bubbleOptions),addVisibilityChangeListener=(0,_createEventHandle.default)(VISIBILITYCHANGE,captureOptions),addKeyDownListener=(0,_createEventHandle.default)(KEYDOWN,captureOptions),addPointerDownListener=(0,_createEventHandle.default)(POINTERDOWN,captureOptions),addPointerMoveListener=(0,_createEventHandle.default)(POINTERMOVE,captureOptions),addContextMenuListener=(0,_createEventHandle.default)(CONTEXTMENU,captureOptions),addMouseDownListener=(0,_createEventHandle.default)(MOUSEDOWN,captureOptions),addMouseMoveListener=(0,_createEventHandle.default)(MOUSEMOVE,captureOptions),addMouseUpListener=(0,_createEventHandle.default)(MOUSEUP,captureOptions),addScrollListener=(0,_createEventHandle.default)(SCROLL,captureOptions),addSelectiomChangeListener=(0,_createEventHandle.default)(SELECTIONCHANGE,captureOptions),addTouchCancelListener=(0,_createEventHandle.default)(TOUCHCANCEL,captureOptions),addTouchMoveListener=(0,_createEventHandle.default)(TOUCHMOVE,captureOptions),addTouchStartListener=(0,_createEventHandle.default)(TOUCHSTART,captureOptions);function restoreModality(){null==previousModality&&null==previousActiveModality||(null!=previousModality&&(modality=previousModality,previousModality=null),null!=previousActiveModality&&(activeModality=previousActiveModality,previousActiveModality=null),callListeners())}function onBlurWindow(){previousModality=modality,previousActiveModality=activeModality,modality=activeModality=KEYBOARD,callListeners(),isEmulatingMouseEvents=!1}function onFocusWindow(){restoreModality()}function onKeyDown(e){e.metaKey||e.altKey||e.ctrlKey||modality!==KEYBOARD&&(activeModality=modality=KEYBOARD,callListeners())}function onVisibilityChange(){"hidden"!==document.visibilityState&&restoreModality()}function onPointerish(e){var t=e.type;if(supportsPointerEvent())t!==POINTERDOWN?t===POINTERMOVE&&modality!==e.pointerType&&(modality=e.pointerType,callListeners()):activeModality!==e.pointerType&&(modality=e.pointerType,activeModality=e.pointerType,callListeners());else{if(isEmulatingMouseEvents||(t===MOUSEDOWN&&activeModality!==MOUSE&&(activeModality=modality=MOUSE,callListeners()),t===MOUSEMOVE&&modality!==MOUSE&&(modality=MOUSE,callListeners())),t===TOUCHSTART)return isEmulatingMouseEvents=!0,e.touches&&1<e.touches.length&&(isEmulatingMouseEvents=!1),void(activeModality!==TOUCH&&(activeModality=modality=TOUCH,callListeners()));t!==CONTEXTMENU&&t!==MOUSEUP&&t!==SELECTIONCHANGE&&t!==SCROLL&&t!==TOUCHCANCEL&&t!==TOUCHMOVE||(isEmulatingMouseEvents=!1)}}function callListeners(){var t={activeModality:activeModality,modality:modality};listeners.forEach(function(e){e(t)})}function getActiveModality(){return activeModality}function getModality(){return modality}function addModalityListener(e){return listeners.add(e),function(){listeners.delete(e)}}function testOnly_resetActiveModality(){isEmulatingMouseEvents=!1,modality=activeModality=KEYBOARD}canUseDOM&&(addBlurListener(window,onBlurWindow),addFocusListener(window,onFocusWindow),addKeyDownListener(document,onKeyDown),addPointerDownListener(document,onPointerish),addPointerMoveListener(document,onPointerish),addVisibilityChangeListener(document,onVisibilityChange),addContextMenuListener(document,onPointerish),addMouseDownListener(document,onPointerish),addMouseMoveListener(document,onPointerish),addMouseUpListener(document,onPointerish),addTouchCancelListener(document,onPointerish),addTouchMoveListener(document,onPointerish),addTouchStartListener(document,onPointerish),addSelectiomChangeListener(document,onPointerish),addScrollListener(document,onPointerish));