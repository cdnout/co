"use strict";exports.__esModule=!0,exports.default=void 0;var DELAY="DELAY",ERROR="ERROR",LONG_PRESS_DETECTED="LONG_PRESS_DETECTED",NOT_RESPONDER="NOT_RESPONDER",RESPONDER_ACTIVE_LONG_PRESS_START="RESPONDER_ACTIVE_LONG_PRESS_START",RESPONDER_ACTIVE_PRESS_START="RESPONDER_ACTIVE_PRESS_START",RESPONDER_INACTIVE_PRESS_START="RESPONDER_INACTIVE_PRESS_START",RESPONDER_GRANT="RESPONDER_GRANT",RESPONDER_RELEASE="RESPONDER_RELEASE",RESPONDER_TERMINATED="RESPONDER_TERMINATED",Transitions=Object.freeze({NOT_RESPONDER:{DELAY:ERROR,RESPONDER_GRANT:RESPONDER_INACTIVE_PRESS_START,RESPONDER_RELEASE:ERROR,RESPONDER_TERMINATED:ERROR,LONG_PRESS_DETECTED:ERROR},RESPONDER_INACTIVE_PRESS_START:{DELAY:RESPONDER_ACTIVE_PRESS_START,RESPONDER_GRANT:ERROR,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:ERROR},RESPONDER_ACTIVE_PRESS_START:{DELAY:ERROR,RESPONDER_GRANT:ERROR,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:RESPONDER_ACTIVE_LONG_PRESS_START},RESPONDER_ACTIVE_LONG_PRESS_START:{DELAY:ERROR,RESPONDER_GRANT:ERROR,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:RESPONDER_ACTIVE_LONG_PRESS_START},ERROR:{DELAY:NOT_RESPONDER,RESPONDER_GRANT:RESPONDER_INACTIVE_PRESS_START,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:NOT_RESPONDER}}),isActiveSignal=function(e){return e===RESPONDER_ACTIVE_PRESS_START||e===RESPONDER_ACTIVE_LONG_PRESS_START},isButtonRole=function(e){return"button"===e.getAttribute("role")},isPressStartSignal=function(e){return e===RESPONDER_INACTIVE_PRESS_START||e===RESPONDER_ACTIVE_PRESS_START||e===RESPONDER_ACTIVE_LONG_PRESS_START},isTerminalSignal=function(e){return e===RESPONDER_TERMINATED||e===RESPONDER_RELEASE},isValidKeyPress=function(e){var t=e.key,e=e.target.getAttribute("role");return"Enter"===t||(" "===t||"Spacebar"===t)&&"button"===e},DEFAULT_LONG_PRESS_DELAY_MS=450,DEFAULT_PRESS_DELAY_MS=50,PressResponder=function(){function e(e){this._eventHandlers=null,this._isPointerTouch=!1,this._longPressDelayTimeout=null,this._longPressDispatched=!1,this._pressDelayTimeout=null,this._pressOutDelayTimeout=null,this._touchState=NOT_RESPONDER,this.configure(e)}var t=e.prototype;return t.configure=function(e){this._config=e},t.reset=function(){this._cancelLongPressDelayTimeout(),this._cancelPressDelayTimeout(),this._cancelPressOutDelayTimeout()},t.getEventHandlers=function(){return null==this._eventHandlers&&(this._eventHandlers=this._createEventHandlers()),this._eventHandlers},t._createEventHandlers=function(){function R(e,t){e.persist(),s._cancelPressOutDelayTimeout(),s._longPressDispatched=!1,s._selectionTerminated=!1,s._touchState=NOT_RESPONDER,s._isPointerTouch="touchstart"===e.nativeEvent.type,s._receiveSignal(RESPONDER_GRANT,e);var n=normalizeDelay(s._config.delayPressStart,0,DEFAULT_PRESS_DELAY_MS);!1!==t&&0<n?s._pressDelayTimeout=setTimeout(function(){s._receiveSignal(DELAY,e)},n):s._receiveSignal(DELAY,e),t=normalizeDelay(s._config.delayLongPress,10,DEFAULT_LONG_PRESS_DELAY_MS),s._longPressDelayTimeout=setTimeout(function(){s._handleLongPress(e)},t+n)}function i(e){s._receiveSignal(RESPONDER_RELEASE,e)}function o(e){var t,n=s._config.onPress,E=e.target;s._touchState!==NOT_RESPONDER&&isValidKeyPress(e)&&(i(e),document.removeEventListener("keyup",o),t=E.getAttribute("role"),E=E.tagName.toLowerCase(),null==n||("link"===t||"a"===E||"button"===E||"input"===E||"select"===E||"textarea"===E)||n(e))}var s=this;return{onStartShouldSetResponder:function(e){var t=s._config.disabled;return t&&isButtonRole(e.currentTarget)&&e.stopPropagation(),null==t||!t},onKeyDown:function(e){var t=s._config.disabled,n=e.key,E=e.target;!t&&isValidKeyPress(e)&&(s._touchState===NOT_RESPONDER&&(R(e,!1),document.addEventListener("keyup",o)),E=E.getAttribute("role")," "!==n&&"Spacebar"!==n||"button"!==E&&"menuitem"!==E||e.preventDefault(),e.stopPropagation())},onResponderGrant:function(e){return R(e)},onResponderMove:function(e){null!=s._config.onPressMove&&s._config.onPressMove(e);var t=getTouchFromResponderEvent(e);null!=s._touchActivatePosition&&(e=s._touchActivatePosition.pageX-t.pageX,t=s._touchActivatePosition.pageY-t.pageY,10<Math.hypot(e,t)&&s._cancelLongPressDelayTimeout())},onResponderRelease:i,onResponderTerminate:function(e){"selectionchange"===e.nativeEvent.type&&(s._selectionTerminated=!0),s._receiveSignal(RESPONDER_TERMINATED,e)},onResponderTerminationRequest:function(e){var t=s._config,n=t.cancelable,E=t.disabled,t=t.onLongPress;return!(!E&&null!=t&&s._isPointerTouch&&"contextmenu"===e.nativeEvent.type)&&(null==n||n)},onClick:function(e){var t=s._config,n=t.disabled,t=t.onPress;n?isButtonRole(e.currentTarget)&&e.stopPropagation():(e.stopPropagation(),s._longPressDispatched||s._selectionTerminated?e.preventDefault():null!=t&&!1===e.altKey&&t(e))},onContextMenu:function(e){var t=s._config,n=t.disabled,t=t.onLongPress;n?isButtonRole(e.currentTarget)&&e.stopPropagation():null!=t&&s._isPointerTouch&&!e.defaultPrevented&&(e.preventDefault(),e.stopPropagation())}}},t._receiveSignal=function(e,t){var n=this._touchState,E=null;null!=Transitions[n]&&(E=Transitions[n][e]),this._touchState===NOT_RESPONDER&&e===RESPONDER_RELEASE||(null==E||E===ERROR?console.error("PressResponder: Invalid signal "+e+" for state "+n+" on responder"):n!==E&&(this._performTransitionSideEffects(n,E,e,t),this._touchState=E))},t._performTransitionSideEffects=function(e,t,n,E){isTerminalSignal(n)&&(this._isPointerTouch=!1,this._touchActivatePosition=null,this._cancelLongPressDelayTimeout()),!isPressStartSignal(e)||n!==LONG_PRESS_DETECTED||null!=(i=this._config.onLongPress)&&null==E.nativeEvent.key&&(i(E),this._longPressDispatched=!0);var R=isActiveSignal(e),i=isActiveSignal(t);!R&&i?this._activate(E):R&&!i&&this._deactivate(E),isPressStartSignal(e)&&n===RESPONDER_RELEASE&&(n=(t=this._config).onLongPress,null!=t.onPress&&(null!=n&&e===RESPONDER_ACTIVE_LONG_PRESS_START||i||R||(this._activate(E),this._deactivate(E)))),this._cancelPressDelayTimeout()},t._activate=function(e){var t=this._config,n=t.onPressChange,E=t.onPressStart,t=getTouchFromResponderEvent(e);this._touchActivatePosition={pageX:t.pageX,pageY:t.pageY},null!=E&&E(e),null!=n&&n(!0)},t._deactivate=function(e){var t=this._config,n=t.onPressChange,E=t.onPressEnd;function R(){null!=E&&E(e),null!=n&&n(!1)}t=normalizeDelay(this._config.delayPressEnd);0<t?this._pressOutDelayTimeout=setTimeout(function(){R()},t):R()},t._handleLongPress=function(e){this._touchState!==RESPONDER_ACTIVE_PRESS_START&&this._touchState!==RESPONDER_ACTIVE_LONG_PRESS_START||this._receiveSignal(LONG_PRESS_DETECTED,e)},t._cancelLongPressDelayTimeout=function(){null!=this._longPressDelayTimeout&&(clearTimeout(this._longPressDelayTimeout),this._longPressDelayTimeout=null)},t._cancelPressDelayTimeout=function(){null!=this._pressDelayTimeout&&(clearTimeout(this._pressDelayTimeout),this._pressDelayTimeout=null)},t._cancelPressOutDelayTimeout=function(){null!=this._pressOutDelayTimeout&&(clearTimeout(this._pressOutDelayTimeout),this._pressOutDelayTimeout=null)},e}();function normalizeDelay(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),Math.max(t,null!=e?e:n)}function getTouchFromResponderEvent(e){var t=e.nativeEvent,n=t.changedTouches,t=t.touches;return null!=t&&0<t.length?t[0]:null!=n&&0<n.length?n[0]:e.nativeEvent}exports.default=PressResponder,module.exports=exports.default;