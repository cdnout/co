"use strict";exports.__esModule=!0,exports.default=exports.ImageUriCache=void 0;var dataUriPattern=/^data:/,ImageUriCache=function(){function o(){}return o.has=function(e){var t=o._entries;return dataUriPattern.test(e)||Boolean(t[e])},o.add=function(e){var t=o._entries,a=Date.now();t[e]?(t[e].lastUsedTimestamp=a,t[e].refCount+=1):t[e]={lastUsedTimestamp:a,refCount:1}},o.remove=function(e){var t=o._entries;t[e]&&--t[e].refCount,o._cleanUpIfNeeded()},o._cleanUpIfNeeded=function(){var a,r,n=o._entries,e=Object.keys(n);e.length+1>o._maximumEntries&&(e.forEach(function(e){var t=n[e];(!r||t.lastUsedTimestamp<r.lastUsedTimestamp)&&0===t.refCount&&(a=e,r=t)}),a&&delete n[a])},o}();(exports.ImageUriCache=ImageUriCache)._maximumEntries=256,ImageUriCache._entries={};var id=0,requests={},ImageLoader={abort:function(e){var t=requests[""+e];t&&(t.onerror=null,t.onload=null,t=null,delete requests[""+e])},getSize:function(e,a,t){var r=!1,n=setInterval(i,16),o=ImageLoader.load(e,i,function(){"function"==typeof t&&t();ImageLoader.abort(o),clearInterval(n)});function i(){var e,t=requests[""+o];t&&(e=t.naturalHeight,t=t.naturalWidth,e&&t&&(a(t,e),r=!0)),r&&(ImageLoader.abort(o),clearInterval(n))}},has:function(e){return ImageUriCache.has(e)},load:function(e,a,t){id+=1;var r=new window.Image;return r.onerror=t,r.onload=function(e){function t(){return a({nativeEvent:e})}"function"==typeof r.decode?r.decode().then(t,t):setTimeout(t,0)},r.src=e,requests[""+id]=r,id},prefetch:function(a){return new Promise(function(e,t){ImageLoader.load(a,function(){ImageUriCache.add(a),ImageUriCache.remove(a),e()},t)})},queryCache:function(e){var t={};return e.forEach(function(e){ImageUriCache.has(e)&&(t[e]="disk/memory")}),Promise.resolve(t)}},_default=ImageLoader;exports.default=_default;