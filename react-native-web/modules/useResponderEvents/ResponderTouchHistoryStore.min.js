import{isStartish,isMoveish,isEndish}from"./ResponderEventTypes";var __DEV__="production"!==process.env.NODE_ENV,MAX_TOUCH_BANK=20,touchBank=[],touchHistory={touchBank:touchBank,numberActiveTouches:0,indexOfSingleActiveTouch:-1,mostRecentTimeStamp:0};function timestampForTouch(e){return e.timeStamp||e.timestamp}function createTouchRecord(e){return{touchActive:!0,startPageX:e.pageX,startPageY:e.pageY,startTimeStamp:timestampForTouch(e),currentPageX:e.pageX,currentPageY:e.pageY,currentTimeStamp:timestampForTouch(e),previousPageX:e.pageX,previousPageY:e.pageY,previousTimeStamp:timestampForTouch(e)}}function resetTouchRecord(e,t){e.touchActive=!0,e.startPageX=t.pageX,e.startPageY=t.pageY,e.startTimeStamp=timestampForTouch(t),e.currentPageX=t.pageX,e.currentPageY=t.pageY,e.currentTimeStamp=timestampForTouch(t),e.previousPageX=t.pageX,e.previousPageY=t.pageY,e.previousTimeStamp=timestampForTouch(t)}function getTouchIdentifier(e){var t=e.identifier;return null==t&&console.error("Touch object is missing identifier."),__DEV__&&t>MAX_TOUCH_BANK&&console.error("Touch identifier %s is greater than maximum supported %s which causes performance issues backfilling array locations for all of the indices.",t,MAX_TOUCH_BANK),t}function recordTouchStart(e){var t=getTouchIdentifier(e),o=touchBank[t];o?resetTouchRecord(o,e):touchBank[t]=createTouchRecord(e),touchHistory.mostRecentTimeStamp=timestampForTouch(e)}function recordTouchMove(e){var t=touchBank[getTouchIdentifier(e)];t?(t.touchActive=!0,t.previousPageX=t.currentPageX,t.previousPageY=t.currentPageY,t.previousTimeStamp=t.currentTimeStamp,t.currentPageX=e.pageX,t.currentPageY=e.pageY,t.currentTimeStamp=timestampForTouch(e),touchHistory.mostRecentTimeStamp=timestampForTouch(e)):console.warn("Cannot record touch move without a touch start.\n","Touch Move: "+printTouch(e)+"\n","Touch Bank: "+printTouchBank())}function recordTouchEnd(e){var t=touchBank[getTouchIdentifier(e)];t?(t.touchActive=!1,t.previousPageX=t.currentPageX,t.previousPageY=t.currentPageY,t.previousTimeStamp=t.currentTimeStamp,t.currentPageX=e.pageX,t.currentPageY=e.pageY,t.currentTimeStamp=timestampForTouch(e),touchHistory.mostRecentTimeStamp=timestampForTouch(e)):console.warn("Cannot record touch end without a touch start.\n","Touch End: "+printTouch(e)+"\n","Touch Bank: "+printTouchBank())}function printTouch(e){return JSON.stringify({identifier:e.identifier,pageX:e.pageX,pageY:e.pageY,timestamp:timestampForTouch(e)})}function printTouchBank(){var e=JSON.stringify(touchBank.slice(0,MAX_TOUCH_BANK));return touchBank.length>MAX_TOUCH_BANK&&(e+=" (original size: "+touchBank.length+")"),e}var ResponderTouchHistoryStore={recordTouchTrack:function(e,t){if(isMoveish(e))t.changedTouches.forEach(recordTouchMove);else if(isStartish(e))t.changedTouches.forEach(recordTouchStart),touchHistory.numberActiveTouches=t.touches.length,1===touchHistory.numberActiveTouches&&(touchHistory.indexOfSingleActiveTouch=t.touches[0].identifier);else if(isEndish(e)&&(t.changedTouches.forEach(recordTouchEnd),touchHistory.numberActiveTouches=t.touches.length,1===touchHistory.numberActiveTouches)){for(var o=0;o<touchBank.length;o++){var r=touchBank[o];if(null!=r&&r.touchActive){touchHistory.indexOfSingleActiveTouch=o;break}}if(__DEV__){var c=touchBank[touchHistory.indexOfSingleActiveTouch];null!=c&&c.touchActive||console.error("Cannot find single active touch.")}}},touchHistory:touchHistory};export default ResponderTouchHistoryStore;