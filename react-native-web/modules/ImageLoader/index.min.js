var dataUriPattern=/^data:/,ImageUriCache=function(){function o(){}return o.has=function(e){var a=o._entries;return dataUriPattern.test(e)||Boolean(a[e])},o.add=function(e){var a=o._entries,t=Date.now();a[e]?(a[e].lastUsedTimestamp=t,a[e].refCount+=1):a[e]={lastUsedTimestamp:t,refCount:1}},o.remove=function(e){var a=o._entries;a[e]&&--a[e].refCount,o._cleanUpIfNeeded()},o._cleanUpIfNeeded=function(){var t,r,n=o._entries,e=Object.keys(n);e.length+1>o._maximumEntries&&(e.forEach(function(e){var a=n[e];(!r||a.lastUsedTimestamp<r.lastUsedTimestamp)&&0===a.refCount&&(t=e,r=a)}),t&&delete n[t])},o}();ImageUriCache._maximumEntries=256,ImageUriCache._entries={};var id=0,requests={},ImageLoader={abort:function(e){var a=requests[""+e];a&&(a.onerror=null,a.onload=null,a=null,delete requests[""+e])},getSize:function(e,t,a){var r=!1,n=setInterval(i,16),o=ImageLoader.load(e,i,function(){"function"==typeof a&&a();ImageLoader.abort(o),clearInterval(n)});function i(){var e,a=requests[""+o];a&&(e=a.naturalHeight,a=a.naturalWidth,e&&a&&(t(a,e),r=!0)),r&&(ImageLoader.abort(o),clearInterval(n))}},has:function(e){return ImageUriCache.has(e)},load:function(e,t,a){id+=1;var r=new window.Image;return r.onerror=a,r.onload=function(e){function a(){return t({nativeEvent:e})}"function"==typeof r.decode?r.decode().then(a,a):setTimeout(a,0)},r.src=e,requests[""+id]=r,id},prefetch:function(t){return new Promise(function(e,a){ImageLoader.load(t,function(){ImageUriCache.add(t),ImageUriCache.remove(t),e()},a)})},queryCache:function(e){var a={};return e.forEach(function(e){ImageUriCache.has(e)&&(a[e]="disk/memory")}),Promise.resolve(a)}};export default ImageLoader;export{ImageUriCache};