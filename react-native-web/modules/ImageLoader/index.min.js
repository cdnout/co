var dataUriPattern=/^data:/;export var ImageUriCache=function(){function e(){}return e.has=function(a){var r=e._entries;return dataUriPattern.test(a)||Boolean(r[a])},e.add=function(a){var r=e._entries,t=Date.now();r[a]?(r[a].lastUsedTimestamp=t,r[a].refCount+=1):r[a]={lastUsedTimestamp:t,refCount:1}},e.remove=function(a){var r=e._entries;r[a]&&(r[a].refCount-=1),e._cleanUpIfNeeded()},e._cleanUpIfNeeded=function(){var a,r,t=e._entries,n=Object.keys(t);n.length+1>e._maximumEntries&&(n.forEach(function(e){var n=t[e];(!r||n.lastUsedTimestamp<r.lastUsedTimestamp)&&0===n.refCount&&(a=e,r=n)}),a&&delete t[a])},e}();ImageUriCache._maximumEntries=256,ImageUriCache._entries={};var id=0,requests={},ImageLoader={abort:function(e){var a=requests[""+e];a&&(a.onerror=null,a.onload=null,a=null,delete requests[""+e])},getSize:function(e,a,r){var t=!1,n=setInterval(i,16),o=ImageLoader.load(e,i,function(){"function"==typeof r&&r();ImageLoader.abort(o),clearInterval(n)});function i(){var e=requests[""+o];if(e){var r=e.naturalHeight,i=e.naturalWidth;r&&i&&(a(i,r),t=!0)}t&&(ImageLoader.abort(o),clearInterval(n))}},has:function(e){return ImageUriCache.has(e)},load:function(e,a,r){id+=1;var t=new window.Image;return t.onerror=r,t.onload=function(e){var r=function(){return a({nativeEvent:e})};"function"==typeof t.decode?t.decode().then(r,r):setTimeout(r,0)},t.src=e,requests[""+id]=t,id},prefetch:function(e){return new Promise(function(a,r){ImageLoader.load(e,function(){ImageUriCache.add(e),ImageUriCache.remove(e),a()},r)})},queryCache:function(e){var a={};return e.forEach(function(e){ImageUriCache.has(e)&&(a[e]="disk/memory")}),Promise.resolve(a)}};export default ImageLoader;