function ownKeys(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,o=arguments[t];for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e}).apply(this,arguments)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,o={},n=Object.keys(e),a=0;a<n.length;a++)r=n[a],0<=t.indexOf(r)||(o[r]=e[r]);return o}import*as React from"react";import createElement from"../createElement";import{getAssetByID}from"../../modules/AssetRegistry";import{createBoxShadowValue}from"../StyleSheet/preprocess";import ImageLoader from"../../modules/ImageLoader";import PixelRatio from"../PixelRatio";import StyleSheet from"../StyleSheet";import TextAncestorContext from"../Text/TextAncestorContext";import View from"../View";var ERRORED="ERRORED",LOADED="LOADED",LOADING="LOADING",IDLE="IDLE",_filterId=0,svgDataUriPattern=/^(data:image\/svg\+xml;utf8,)(.*)/;function createTintColorSVG(e,t){return e&&null!=t?React.createElement("svg",{style:{position:"absolute",height:0,visibility:"hidden",width:0}},React.createElement("defs",null,React.createElement("filter",{id:"tint-"+t,suppressHydrationWarning:!0},React.createElement("feFlood",{floodColor:""+e,key:e}),React.createElement("feComposite",{in2:"SourceAlpha",operator:"atop"})))):null}function getFlatStyle(e,t,r){var o=StyleSheet.flatten(e),n=o.filter,a=o.resizeMode,i=o.shadowOffset,l=o.tintColor,c=[],e=null;return n&&c.push(n),t&&c.push("blur("+t+"px)"),!i||(i=createBoxShadowValue(o))&&c.push("drop-shadow("+i+")"),l&&null!=r&&c.push("url(#tint-"+r+")"),0<c.length&&(e=c.join(" ")),delete o.blurRadius,delete o.shadowColor,delete o.shadowOpacity,delete o.shadowOffset,delete o.shadowRadius,delete o.tintColor,delete o.overlayColor,delete o.resizeMode,[o,a,e,l]}function resolveAssetDimensions(e){if("number"==typeof e){var t=getAssetByID(e);return{height:t.height,width:t.width}}if(null!=e&&!Array.isArray(e)&&"object"==typeof e)return{height:e.height,width:e.width}}function resolveAssetUri(e){var r,t,o=null;if("number"==typeof e?(t=(n=getAssetByID(e)).scales[0],1<n.scales.length&&(r=PixelRatio.get(),t=n.scales.reduce(function(e,t){return Math.abs(t-r)<Math.abs(e-r)?t:e})),o=n?n.httpServerLocation+"/"+n.name+(1!==t?"@"+t+"x":"")+"."+n.type:""):"string"==typeof e?o=e:e&&"string"==typeof e.uri&&(o=e.uri),o){var n=o.match(svgDataUriPattern);if(n){e=n[1],n=n[2];return""+e+encodeURIComponent(n)}}return o}var Image=React.forwardRef(function(e,t){var r=e.accessibilityLabel,o=e.blurRadius,n=e.defaultSource,a=e.draggable,i=e.onError,l=e.onLayout,c=e.onLoad,s=e.onLoadEnd,u=e.onLoadStart,d=e.pointerEvents,f=e.source,g=e.style,p=_objectWithoutPropertiesLoose(e,["accessibilityLabel","blurRadius","defaultSource","draggable","onError","onLayout","onLoad","onLoadEnd","onLoadStart","pointerEvents","source","style"]);if("production"!==process.env.NODE_ENV&&e.children)throw new Error("The <Image> component cannot contain children. If you want to render content on top of the image, consider using the <ImageBackground> component or absolute positioning.");var h=React.useState(function(){var e=resolveAssetUri(f);if(null!=e&&ImageLoader.has(e))return LOADED;return IDLE}),y=h[0],m=h[1],b=React.useState({}),S=b[0],v=b[1],O=React.useContext(TextAncestorContext),R=React.useRef(null),E=React.useRef(_filterId++),I=React.useRef(null),h=y===LOADED||y===LOADING&&null==n,b=getFlatStyle(g,o,E.current),y=b[0],g=b[1],o=b[2],b=b[3],w=e.resizeMode||g||"cover",e=h?f:n,g=resolveAssetUri(e),h=resolveAssetDimensions(e),n=g?'url("'+g+'")':null,e=function(){if(null!=R.current&&("center"===w||"repeat"===w)){var e=R.current,t=e.naturalHeight,r=e.naturalWidth,o=S.height,e=S.width;if(t&&r&&o&&e){o=Math.min(1,e/r,o/t),r=Math.ceil(o*r),t=Math.ceil(o*t);return r+"px "+t+"px"}}}(),g=g?createElement("img",{alt:r||"",style:styles.accessibilityImage$raw,draggable:a||!1,ref:R,src:g}):null;var L=resolveAssetUri(f);return React.useEffect(function(){function e(){null!=I.current&&(ImageLoader.abort(I.current),I.current=null)}return e(),null!=L&&(m(LOADING),u&&u(),I.current=ImageLoader.load(L,function(e){m(LOADED),c&&c(e),s&&s()},function(){m(ERRORED),i&&i({nativeEvent:{error:"Failed to load resource "+L+" (404)"}}),s&&s()})),e},[L,I,m,i,c,s,u]),React.createElement(View,_extends({},p,{accessibilityLabel:r,onLayout:function(e){var t;"center"!==w&&"repeat"!==w&&!l||(t=e.nativeEvent.layout,l&&l(e),v(t))},pointerEvents:d,ref:t,style:[styles.root,O&&styles.inline,h,y]}),React.createElement(View,{style:[styles.image,resizeModeStyles[w],{backgroundImage:n,filter:o},null!=e&&{backgroundSize:e}],suppressHydrationWarning:!0}),g,createTintColorSVG(b,E.current))});Image.displayName="Image";var ImageWithStatics=Image;ImageWithStatics.getSize=function(e,t,r){ImageLoader.getSize(e,t,r)},ImageWithStatics.prefetch=function(e){return ImageLoader.prefetch(e)},ImageWithStatics.queryCache=function(e){return ImageLoader.queryCache(e)};var styles=StyleSheet.create({root:{flexBasis:"auto",overflow:"hidden",zIndex:0},inline:{display:"inline-flex"},image:_objectSpread(_objectSpread({},StyleSheet.absoluteFillObject),{},{backgroundColor:"transparent",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",height:"100%",width:"100%",zIndex:-1}),accessibilityImage$raw:_objectSpread(_objectSpread({},StyleSheet.absoluteFillObject),{},{height:"100%",opacity:0,width:"100%",zIndex:-1})}),resizeModeStyles=StyleSheet.create({center:{backgroundSize:"auto"},contain:{backgroundSize:"contain"},cover:{backgroundSize:"cover"},none:{backgroundPosition:"0",backgroundSize:"auto"},repeat:{backgroundPosition:"0",backgroundRepeat:"repeat",backgroundSize:"auto"},stretch:{backgroundSize:"100% 100%"}});export default ImageWithStatics;