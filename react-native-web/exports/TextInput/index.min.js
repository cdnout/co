import{forwardRef,useCallback,useMemo,useRef}from"react";import createElement from"../createElement";import css from"../StyleSheet/css";import pick from"../../modules/pick";import useElementLayout from"../../modules/useElementLayout";import useLayoutEffect from"../../modules/useLayoutEffect";import useMergeRefs from"../../modules/useMergeRefs";import usePlatformMethods from"../../modules/usePlatformMethods";import useResponderEvents from"../../modules/useResponderEvents";import StyleSheet from"../StyleSheet";import TextInputState from"../../modules/TextInputState";var isSelectionStale=function(e,t){var o=e.selectionEnd,n=e.selectionStart,r=t.start,a=t.end;return r!==n||a!==o},setSelection=function(e,t){if(isSelectionStale(e,t)){var o=t.start,n=t.end;try{e.setSelectionRange(o,n||o)}catch(e){}}},forwardPropsList={accessibilityLabel:!0,accessibilityLiveRegion:!0,accessibilityRole:!0,accessibilityState:!0,accessibilityValue:!0,accessible:!0,autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,children:!0,classList:!0,defaultValue:!0,dir:!0,disabled:!0,importantForAccessibility:!0,maxLength:!0,nativeID:!0,onBlur:!0,onChange:!0,onClick:!0,onClickCapture:!0,onContextMenu:!0,onFocus:!0,onScroll:!0,onTouchCancel:!0,onTouchCancelCapture:!0,onTouchEnd:!0,onTouchEndCapture:!0,onTouchMove:!0,onTouchMoveCapture:!0,onTouchStart:!0,onTouchStartCapture:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,ref:!0,rows:!0,spellCheck:!0,style:!0,value:!0,testID:!0,type:!0,dataSet:!0,onMouseDown:!0,onMouseEnter:!0,onMouseLeave:!0,onMouseMove:!0,onMouseOver:!0,onMouseOut:!0,onMouseUp:!0},pickProps=function(e){return pick(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var TextInput=forwardRef(function(e,t){var o,n,r=e.autoCapitalize,a=void 0===r?"sentences":r,u=e.autoComplete,s=e.autoCompleteType,l=e.autoCorrect,i=void 0===l||l,c=e.blurOnSubmit,d=e.clearTextOnFocus,p=e.dir,S=e.editable,h=void 0===S||S,m=e.keyboardType,v=void 0===m?"default":m,f=e.multiline,R=void 0!==f&&f,C=e.numberOfLines,y=void 0===C?1:C,g=e.onBlur,b=e.onChange,x=e.onChangeText,T=e.onContentSizeChange,E=e.onFocus,M=e.onKeyPress,k=e.onLayout,w=e.onMoveShouldSetResponder,L=e.onMoveShouldSetResponderCapture,I=e.onResponderEnd,F=e.onResponderGrant,P=e.onResponderMove,z=e.onResponderReject,O=e.onResponderRelease,D=e.onResponderStart,K=e.onResponderTerminate,N=e.onResponderTerminationRequest,A=e.onScrollShouldSetResponder,B=e.onScrollShouldSetResponderCapture,_=e.onSelectionChange,j=e.onSelectionChangeShouldSetResponder,q=e.onSelectionChangeShouldSetResponderCapture,G=e.onStartShouldSetResponder,V=e.onStartShouldSetResponderCapture,W=e.onSubmitEditing,H=e.placeholderTextColor,U=e.returnKeyType,J=e.secureTextEntry,Q=void 0!==J&&J,X=e.selection,Y=e.selectTextOnFocus,Z=e.spellCheck;switch(v){case"email-address":o="email";break;case"number-pad":case"numeric":n="numeric";break;case"decimal-pad":n="decimal";break;case"phone-pad":o="tel";break;case"search":case"web-search":o="search";break;case"url":o="url";break;default:o="text"}Q&&(o="password");var $=useRef({height:null,width:null}),ee=useRef(null),te=useCallback(function(){var e=ee.current;if(R&&T&&null!=e){var t=e.scrollHeight,o=e.scrollWidth;t===$.current.height&&o===$.current.width||($.current.height=t,$.current.width=o,T({nativeEvent:{contentSize:{height:$.current.height,width:$.current.width}}}))}},[ee,R,T]),oe=useMemo(function(){return function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&TextInputState.currentlyFocusedField()===e},te())}},[te]);useLayoutEffect(function(){var e=ee.current;null!=e&&null!=X&&setSelection(e,X),document.activeElement===e&&(TextInputState._currentlyFocusedNode=e)},[ee,X]);var ne=R?"textarea":"input",re=[classes.textinput],ae=StyleSheet.compose(e.style,H&&{placeholderTextColor:H});useElementLayout(ee,k),useResponderEvents(ee,{onMoveShouldSetResponder:w,onMoveShouldSetResponderCapture:L,onResponderEnd:I,onResponderGrant:F,onResponderMove:P,onResponderReject:z,onResponderRelease:O,onResponderStart:D,onResponderTerminate:K,onResponderTerminationRequest:N,onScrollShouldSetResponder:A,onScrollShouldSetResponderCapture:B,onSelectionChangeShouldSetResponder:j,onSelectionChangeShouldSetResponderCapture:q,onStartShouldSetResponder:G,onStartShouldSetResponderCapture:V});var ue=pickProps(e);ue.autoCapitalize=a,ue.autoComplete=u||s||"on",ue.autoCorrect=i?"on":"off",ue.classList=re,ue.dir=void 0!==p?p:"auto",ue.enterkeyhint=U,ue.onBlur=function(e){TextInputState._currentlyFocusedNode=null,g&&(e.nativeEvent.text=e.target.value,g(e))},ue.onChange=function(e){var t=e.target.value;e.nativeEvent.text=t,te(),b&&b(e),x&&x(t)},ue.onFocus=function(e){var t=ee.current;null!=t&&(TextInputState._currentlyFocusedNode=t,E&&(e.nativeEvent.text=e.target.value,E(e)),d&&(t.value=""),Y&&setTimeout(function(){t.select()},0))},ue.onKeyDown=function(e){e.stopPropagation();var t=null==c?!R:c,o=e.nativeEvent,n=isEventComposing(o);M&&M(e),"Enter"!==e.key||e.shiftKey||n||e.isDefaultPrevented()||(!c&&R||!W||(e.preventDefault(),o.text=e.target.value,W(e)),t&&null!=ee.current&&ee.current.blur())},ue.onSelect=function(e){if(_)try{var t=e.target,o=t.selectionStart,n=t.selectionEnd;e.nativeEvent.selection={start:o,end:n},e.nativeEvent.text=e.target.value,_(e)}catch(e){}},ue.readOnly=!h,ue.rows=R?y:void 0,ue.spellCheck=null!=Z?Z:i,ue.style=ae,ue.type=R?void 0:o,ue.inputMode=n;var se=usePlatformMethods(ue),le=useMergeRefs(ee,se,oe,t);return ue.ref=le,createElement(ne,ue)});TextInput.displayName="TextInput",TextInput.State=TextInputState;var classes=css.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}});export default TextInput;