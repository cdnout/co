/*
Project: angular-gantt v1.3.3 - Gantt chart component for AngularJS
Authors: Marco Schweighauser, RÃ©mi Alvergnat
License: MIT
Homepage: https://www.angular-gantt.com
Github: https://github.com/angular-gantt/angular-gantt.git
*/

!function(){"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttSmartEvent","ganttMovableOptions","ganttUtils","ganttDom","$window","$document","$timeout",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(j,k,l,m){var n=m.gantt.api;if(j.options&&"object"==typeof j.options.movable)for(var o in j.options.movable)j[o]=j.options.movable[o];d.initialize(j),n.registerEvent("tasks","move"),n.registerEvent("tasks","moveBegin"),n.registerEvent("tasks","moveEnd"),n.registerEvent("tasks","resize"),n.registerEvent("tasks","resizeBegin"),n.registerEvent("tasks","resizeEnd"),n.registerEvent("tasks","change");var p,q,r="ontouchstart"in g||g.DocumentTouch&&h[0]instanceof g.DocumentTouch;n.directives.on.new(j,function(d,k,l){if("ganttTask"===d){var n,o=angular.element(g),s=k.row.rowsManager.gantt.body.$element,t=k.row.rowsManager.gantt.scroll.$element,u=!1,v=!1,w=k.task.getForegroundElement(),x=k.task.getContentElement(),y=function(c){c.preventDefault(),r&&(c=b.getTouch(c));var d=k.task.model.movable,f=k.task.row.model.movable;("boolean"==typeof d||angular.isFunction(d))&&(d={enabled:d}),("boolean"==typeof f||angular.isFunction(f))&&(f={enabled:f});var g=e.firstProperty([d,f],"enabled",j.enabled);if(angular.isFunction(g)?g(c,k.task):g){var h=b.getOffsetForElement(w[0],c).x,i=E(h);if(""!==i&&1===a.getButton(c)){var l=b.getOffsetForElement(s[0],c).x;H(i,l)}k.$digest()}};w.on("touchstart mousedown",y),x.on("touchstart mousedown",y);var z=function(a){var c=k.task.model.movable,d=k.task.row.model.movable;("boolean"==typeof c||angular.isFunction(c))&&(c={enabled:c}),("boolean"==typeof d||angular.isFunction(d))&&(d={enabled:d});var f=e.firstProperty([c,d],"enabled",j.enabled);if((angular.isFunction(f)?f(a,k.task):f)&&!k.task.isMoving){var g=b.getOffsetForElement(w[0],a).x,h=E(g);""!==h&&"M"!==h?(w.css("cursor",F(h)),x.css("cursor",F(h))):(w.css("cursor",""),x.css("cursor",""))}};w.on("mousemove",z),x.on("mousemove",z);var A=function(a){k.task.isMoving&&!k.destroyed&&(D(),B(a),C(a))},B=function(a){var c=u,d=b.getOffsetForElement(s[0],a),g=d.x;k.task.mouseOffsetX=g;var i=k.task.row.rowsManager.gantt.options.value("taskOutOfRange"),l=k.task.model.movable,n=k.task.row.model.movable;if(("boolean"==typeof l||angular.isFunction(l))&&(l={enabled:l}),("boolean"==typeof n||angular.isFunction(n))&&(n={enabled:n}),"M"===k.task.moveMode){var o=e.firstProperty([l,n],"allowRowSwitching",j.allowRowSwitching);if(o){var q=t[0].getBoundingClientRect(),r=q.left+q.width/2,w=angular.element(h[0].querySelectorAll(".gantt-body"));w.css("pointer-events","auto");var x=f.findElementFromPoint(r,a.clientY,function(a){return angular.element(a).hasClass("gantt-row")});w.css("pointer-events","");for(var y,z=m.gantt.rowsManager.rows,A=0,B=z.length;A<B;A++)if(x===z[A].$element[0]){y=z[A];break}var C=k.task.row;void 0!==y&&C!==y&&(angular.isFunction(o)&&!o(k.task,y)||(y.moveTaskToRow(k.task,!0),u=!0))}e.firstProperty([l,n],"allowMoving",j.allowMoving)&&(g-=p,"truncate"!==i&&(g<0?g=0:g+k.task.width>=k.gantt.width&&(g=k.gantt.width-k.task.width)),k.task.moveTo(g,!0),k.$digest(),u&&k.row.rowsManager.gantt.api.tasks.raise.move(k.task),u=!0)}else"E"===k.task.moveMode?(g<=k.task.left&&(g=k.task.left,k.task.moveMode="W",G(F(k.task.moveMode))),"truncate"!==i&&g>=k.gantt.width&&(g=k.gantt.width),k.task.setTo(g,!0),k.$digest(),u&&k.row.rowsManager.gantt.api.tasks.raise.resize(k.task),u=!0):(g>k.task.left+k.task.width&&(g=k.task.left+k.task.width,k.task.moveMode="E",G(F(k.task.moveMode))),"truncate"!==i&&g<0&&(g=0),k.task.setFrom(g,!0),k.$digest(),u&&k.row.rowsManager.gantt.api.tasks.raise.resize(k.task),u=!0);c||!u||v||("M"===k.task.moveMode?k.row.rowsManager.gantt.api.tasks.raise.moveBegin(k.task):k.row.rowsManager.gantt.api.tasks.raise.resizeBegin(k.task))},C=function(a){var c=b.getOffsetForElement(s[0],a),d=t[0].scrollLeft,e=t[0].offsetWidth,f=t[0].scrollWidth,g=d+e,h=!1;c.x<q?d>0&&c.x<=d+5&&(c.x-=15,h=!0,k.row.rowsManager.gantt.api.scroll.left(15)):g<f&&c.x>=g-5&&(c.x+=15,h=!0,k.row.rowsManager.gantt.api.scroll.right(15)),h&&(n=i(function(){A(a)},100,!0))},D=function(){void 0!==n&&(i.cancel(n),n=void 0)},E=function(a){var b=0,c=k.task.model.movable,d=k.task.row.model.movable;"boolean"==typeof c&&(c={enabled:c}),"boolean"==typeof d&&(d={enabled:d});var f=e.firstProperty([c,d],"allowResizing",j.allowResizing),g=e.firstProperty([c,d],"allowRowSwitching",j.allowRowSwitching),h=e.firstProperty([c,d],"allowMoving",j.allowMoving);return f&&(b=w[0].offsetWidth<15?3:5),f&&a>w[0].offsetWidth-b?"E":f&&a<b?"W":(h||g)&&a>=b&&a<=w[0].offsetWidth-b?"M":""},F=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},G=function(a){l.css("cursor",a),angular.element(h[0].body).css({"-moz-user-select":""===a?"":"-moz-none","-webkit-user-select":""===a?"":"none","-ms-user-select":""===a?"":"none","user-select":""===a?"":"none",cursor:a})},H=function(a,d){void 0===k.task.originalModel&&(k.task.originalRow=k.task.row,k.task.originalModel=k.task.model,k.task.model=angular.copy(k.task.originalModel)),v||(q=d,p=d-k.task.modelLeft),u=!1,k.task.moveMode=a,k.task.isMoving=!0,k.task.active=!0;var e=k.task.$element;"M"===k.task.moveMode?e.addClass("gantt-task-resizing"):e.addClass("gantt-task-moving");var f=function(a){a.stopImmediatePropagation(),r&&(a=b.getTouch(a)),A(a)},g=c(k,o,"touchmove mousemove",f);g.bind(),c(k,o,"touchend mouseup",function(a){r&&(a=b.getTouch(a)),g.unbind(),I(a),k.$digest()}).bindOnce(),G(F(a))},I=function(){if(void 0!==k.task.originalModel){if(k.task.originalModel.from=k.task.model.from,k.task.originalModel.to=k.task.model.to,k.task.originalModel.lct=k.task.model.lct,k.task.originalModel.est=k.task.model.est,k.task.model=k.task.originalModel,k.task.row.model.id!==k.task.originalRow.model.id){var a=k.task.row;a.removeTask(k.task.model.id,!1,!0),k.task.row=k.task.originalRow,a.moveTaskToRow(k.task,!1)}delete k.task.originalModel,delete k.task.originalRow,k.$apply()}v=!1,k.task.isMoving=!1,k.task.active=!1;var b=k.task.$element;b.removeClass("gantt-task-moving"),b.removeClass("gantt-task-resizing"),D(),G(""),!0===u&&("M"===k.task.moveMode?k.row.rowsManager.gantt.api.tasks.raise.moveEnd(k.task):k.row.rowsManager.gantt.api.tasks.raise.resizeEnd(k.task),u=!1,k.task.row.sortTasks(),k.row.rowsManager.gantt.api.tasks.raise.change(k.task)),k.task.moveMode=void 0};k.$on("$destroy",function(){k.destroyed=!0,D()}),k.task.isResizing?(v=!0,H("E",k.task.mouseOffsetX),delete k.task.isResizing):k.task.isMoving&&(v=!0,H("M",k.task.mouseOffsetX))}})}}}])}(),function(){"use strict";angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(a){return a.enabled=void 0===a.enabled||a.enabled,a.allowMoving=void 0===a.allowMoving||!!a.allowMoving,a.allowResizing=void 0===a.allowResizing||!!a.allowResizing,angular.isFunction(a.allowRowSwitching)||(a.allowRowSwitching=void 0===a.allowRowSwitching||!!a.allowRowSwitching),a}}}])}(),angular.module("gantt.movable.templates",[]).run(["$templateCache",function(a){}]);
//# sourceMappingURL=angular-gantt-movable-plugin.min.js.map