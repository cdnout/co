"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("./util");function getFilteredNodesXToY(r,t,e){for(var i={},a={},n=0;n<t.length;n++)i[t[n].id]=!0;for(n=0;n<r.length;n++){var o=(l=r[n]).inputs;for(var d in o){for(var u=o[d],p=!1,s=0;s<t.length;s++)if(i[u.id]){p=i[l.output.id]=!0,a[l.id]=!0;break}if(p)break}}var f={};f[e.id]=!0;for(var h={},n=r.length-1;0<=n;n--){var o=(l=r[n]).inputs,g=[];g.push(l.output);for(s=0;s<g.length;s++)if(f[g[s].id]){for(var d in o)f[o[d].id]=!0,h[l.id]=!0;break}}for(var l,v=[],n=0;n<r.length;n++){if(a[(l=r[n]).id]&&h[l.id]){var c={};for(var d in l.inputs){var b=l.inputs[d];i[b.id]&&(c[d]=b)}var k=Object.assign({},l);k.inputs=c,k.output=l.output,v.push(k)}}return v}function backpropagateGradients(r,t){for(var e=t.length-1;0<=e;e--){var i=t[e],a=r[i.output.id];if(null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.name+".");var n=i.gradient(a);for(var o in i.inputs){if(!(o in n))throw new Error("Cannot backprop through input "+o+". Available gradients found: "+Object.keys(n)+".");var d,u=n[o](),p=i.inputs[o];if(!util.arraysEqual(u.shape,p.shape))throw new Error("Error in gradient for op "+i.name+". The gradient of input '"+o+"' has shape '"+u.shape+"', which does not match the shape of the input '"+p.shape+"'");null==r[p.id]?r[p.id]=u:(d=r[p.id],r[p.id]=d.add(u),d.dispose())}}}exports.getFilteredNodesXToY=getFilteredNodesXToY,exports.backpropagateGradients=backpropagateGradients;