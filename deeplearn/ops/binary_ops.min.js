"use strict";var __decorate=this&&this.__decorate||function(e,t,r,n){var a,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;0<=u;u--)(a=e[u])&&(o=(i<3?a(o):3<i?a(t,r,o):a(t,r))||o);return 3<i&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),broadcast_util=require("./broadcast_util"),operation_1=require("./operation"),ops_1=require("./ops"),BinaryOps=function(){function e(){}return e.add=function(n,a){util.assertTypesMatch(n,a);var i=broadcast_util.assertAndGetBroadcastShape(n.shape,a.shape);return environment_1.ENV.engine.runKernel(function(e){return e.add(n,a)},{a:n,b:a},function(r){return{a:function(){var e=r,t=broadcast_util.getReductionAxes(n.shape,i);return 0<t.length&&(e=e.sum(t)),e.reshape(n.shape)},b:function(){var e=r,t=broadcast_util.getReductionAxes(a.shape,i);return 0<t.length&&(e=e.sum(t)),e.reshape(a.shape)}}})},e.addStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in addStrict: "),e.add(t)},e.sub=function(n,a){util.assertTypesMatch(n,a);var i=broadcast_util.assertAndGetBroadcastShape(n.shape,a.shape);return environment_1.ENV.engine.runKernel(function(e){return e.subtract(n,a)},{a:n,b:a},function(r){return{a:function(){var e=r,t=broadcast_util.getReductionAxes(n.shape,i);return 0<t.length&&(e=e.sum(t)),e.reshape(n.shape)},b:function(){var e=r,t=broadcast_util.getReductionAxes(a.shape,i);return 0<t.length&&(e=e.sum(t)),e.neg().reshape(a.shape)}}})},e.subStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in subStrict: "),e.sub(t)},e.pow=function(n,a){broadcast_util.assertAndGetBroadcastShape(n.shape,a.shape);return environment_1.ENV.engine.runKernel(function(e){return e.pow(n,a)},{base:n},function(r){if(!util.arraysEqual(n.shape,a.shape)&&!util.isScalarShape(a.shape))throw new Error("Gradient of pow not yet supported for broadcasted shapes.");return{base:function(){var e=a.toFloat(),t=e.mul(n.toFloat().pow(e.sub(ops_1.scalar(1))));return r.mulStrict(t)}}})},e.powStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),e.pow(t)},e.mul=function(n,a){util.assertTypesMatch(n,a);var i=broadcast_util.assertAndGetBroadcastShape(n.shape,a.shape);return environment_1.ENV.engine.runKernel(function(e){return e.multiply(n,a)},{a:n,b:a},function(r){return{a:function(){var e=r.mul(a.toFloat()),t=broadcast_util.getReductionAxes(n.shape,i);return 0<t.length?e.sum(t).reshape(n.shape):e},b:function(){var e=r.mul(n.toFloat()),t=broadcast_util.getReductionAxes(a.shape,i);return 0<t.length?e.sum(t).reshape(a.shape):e}}})},e.mulStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in multiplyStrict: "),e.mul(t)},e.div=function(a,i){var o=broadcast_util.assertAndGetBroadcastShape(a.shape,i.shape);return environment_1.ENV.engine.runKernel(function(e){return e.divide(a,i)},{a:a,b:i},function(n){return{a:function(){var e=n.div(i.toFloat()),t=broadcast_util.getReductionAxes(a.shape,o);return 0<t.length?e.sum(t).reshape(a.shape):e},b:function(){var e=n.mul(a.toFloat()),t=broadcast_util.getReductionAxes(i.shape,o);0<t.length&&(e=e.sum(t).reshape(i.shape));var r=i.square();return e.div(r.toFloat()).neg()}}})},e.divStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in divideStrict: "),e.div(t)},e.minimum=function(t,r){util.assertTypesMatch(t,r),broadcast_util.assertAndGetBroadcastShape(t.shape,r.shape);return environment_1.ENV.engine.runKernel(function(e){return e.minimum(t,r)},{a:t,b:r},function(e){return{a:function(){return e.mul(t.lessEqual(r).toFloat())},b:function(){return e.mul(t.greater(r).toFloat())}}})},e.minimumStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.minimum(t)},e.maximum=function(t,r){util.assertTypesMatch(t,r),broadcast_util.assertAndGetBroadcastShape(t.shape,r.shape);return environment_1.ENV.engine.runKernel(function(e){return e.maximum(t,r)},{a:t,b:r},function(e){return{a:function(){return e.mul(t.greaterEqual(r).toFloat())},b:function(){return e.mul(t.less(r).toFloat())}}})},e.maximumStrict=function(e,t){return util.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.maximum(t)},__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"add",null),__decorate([operation_1.operation],e,"addStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"sub",null),__decorate([operation_1.operation],e,"subStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"pow",null),__decorate([operation_1.operation],e,"powStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"mul",null),__decorate([operation_1.operation],e,"mulStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"div",null),__decorate([operation_1.operation],e,"divStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"minimum",null),__decorate([operation_1.operation],e,"minimumStrict",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Arithmetic"}),operation_1.operation],e,"maximum",null),__decorate([operation_1.operation],e,"maximumStrict",null),e}();exports.BinaryOps=BinaryOps;