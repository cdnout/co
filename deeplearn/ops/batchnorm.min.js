"use strict";var __decorate=this&&this.__decorate||function(r,a,n,t){var o,e=arguments.length,i=e<3?a:null===t?t=Object.getOwnPropertyDescriptor(a,n):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(r,a,n,t);else for(var k=r.length-1;0<=k;k--)(o=r[k])&&(i=(e<3?o(i):3<e?o(a,n,i):o(a,n))||i);return 3<e&&i&&Object.defineProperty(a,n,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var doc_1=require("../doc"),environment_1=require("../environment"),util=require("../util"),operation_1=require("./operation"),BatchNormOps=function(){function i(){}return i.batchNormalization2d=function(r,a,n,t,o,e){return void 0===t&&(t=.001),util.assert(2===r.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+r.rank+"."),util.assert(2===a.rank||1===a.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+a.rank+"."),util.assert(2===n.rank||1===n.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+n.rank+"."),null!=o&&util.assert(2===o.rank||1===o.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."),null!=e&&util.assert(2===e.rank||1===e.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+e.rank+"."),i.batchNormalization(r,a,n,t,o,e)},i.batchNormalization3d=function(r,a,n,t,o,e){return void 0===t&&(t=.001),util.assert(3===r.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+r.rank+"."),util.assert(3===a.rank||1===a.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+a.rank+"."),util.assert(3===n.rank||1===n.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+n.rank+"."),null!=o&&util.assert(3===o.rank||1===o.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."),null!=e&&util.assert(3===e.rank||1===e.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+e.rank+"."),i.batchNormalization(r,a,n,t,o,e)},i.batchNormalization4d=function(r,a,n,t,o,e){return void 0===t&&(t=.001),util.assert(4===r.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+r.rank+"."),util.assert(4===a.rank||1===a.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+a.rank+"."),util.assert(4===n.rank||1===n.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+n.rank+"."),null!=o&&util.assert(4===o.rank||1===o.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."),null!=e&&util.assert(4===e.rank||1===e.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+e.rank+"."),i.batchNormalization(r,a,n,t,o,e)},i.batchNormalization=function(r,a,n,t,o,e){var i;return void 0===t&&(t=.001),i=0===r.rank||1===r.rank?r.as4D(1,1,1,r.size):2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r,environment_1.ENV.engine.runKernel(function(r){return r.batchNormalization4D(i,batchnormReshape4D(a),batchnormReshape4D(n),t,batchnormReshape4D(o),batchnormReshape4D(e))},{x:r,mean:a,variance:n}).reshape(r.shape)},__decorate([operation_1.operation],i,"batchNormalization2d",null),__decorate([operation_1.operation],i,"batchNormalization3d",null),__decorate([operation_1.operation],i,"batchNormalization4d",null),__decorate([doc_1.doc({heading:"Operations",subheading:"Normalization"})],i,"batchNormalization",null),i}();function batchnormReshape4D(r){return null==r?null:0===r.rank?r.as1D():1===r.rank?r:2===r.rank?r.as4D(1,1,r.shape[0],r.shape[1]):3===r.rank?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}exports.BatchNormOps=BatchNormOps;