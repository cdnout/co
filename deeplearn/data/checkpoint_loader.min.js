"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("../tensor"),MANIFEST_FILE="manifest.json",CheckpointLoader=function(){function e(e){this.urlPath=e,"/"!==this.urlPath.charAt(this.urlPath.length-1)&&(this.urlPath+="/")}return e.prototype.loadManifest=function(){var o=this;return new Promise(function(e,n){var t=new XMLHttpRequest;t.open("GET",o.urlPath+MANIFEST_FILE),t.onload=function(){o.checkpointManifest=JSON.parse(t.responseText),e()},t.onerror=function(e){throw new Error(MANIFEST_FILE+" not found at "+o.urlPath+". "+e)},t.send()})},e.prototype.getCheckpointManifest=function(){var t=this;return null==this.checkpointManifest?new Promise(function(e,n){t.loadManifest().then(function(){e(t.checkpointManifest)})}):new Promise(function(e,n){e(t.checkpointManifest)})},e.prototype.getAllVariables=function(){var i=this;return null!=this.variables?new Promise(function(e,n){e(i.variables)}):new Promise(function(r,e){i.getCheckpointManifest().then(function(e){for(var t=Object.keys(i.checkpointManifest),n=[],o=0;o<t.length;o++)n.push(i.getVariable(t[o]));Promise.all(n).then(function(e){i.variables={};for(var n=0;n<e.length;n++)i.variables[t[n]]=e[n];r(i.variables)})})})},e.prototype.getVariable=function(r){var i=this;if(!(r in this.checkpointManifest))throw new Error("Cannot load non-existant variable "+r);function t(t,e){var o=new XMLHttpRequest;o.responseType="arraybuffer";var n=i.checkpointManifest[r].filename;o.open("GET",i.urlPath+n),o.onload=function(){if(404===o.status)throw new Error("Not found variable "+r);var e=new Float32Array(o.response),n=tensor_1.Tensor.make(i.checkpointManifest[r].shape,{values:e});t(n)},o.onerror=function(e){throw new Error("Could not fetch variable "+r+": "+e)},o.send()}return null==this.checkpointManifest?new Promise(function(e,n){i.loadManifest().then(function(){new Promise(t).then(e)})}):new Promise(t)},e}();exports.CheckpointLoader=CheckpointLoader;