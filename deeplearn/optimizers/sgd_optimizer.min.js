"use strict";var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_array_map_1=require("../graph/tensor_array_map"),ops_1=require("../ops/ops"),optimizer_1=require("./optimizer"),SGDOptimizer=function(i){function e(e,t){var r=i.call(this,e,t)||this;return r.learningRate=e,r.setLearningRate(e),r}return __extends(e,i),e.prototype.applyGradients=function(i){var o=this;Object.keys(i).forEach(function(e){var t=i[e],r=environment_1.ENV.engine.registeredVariables[e];globals_1.tidy(function(){var e=o.c.mul(t).add(r);r.assign(e)})})},e.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=environment_1.ENV.math.keep(ops_1.scalar(-e))},e.prototype.dispose=function(){this.c.dispose(),null!=this.one&&this.one.dispose(),i.prototype.dispose.call(this)},e.prototype.afterBatch=function(o,e,t,n,r){var s=this;null==this.one&&(this.one=globals_1.keep(ops_1.scalar(1))),globals_1.tidy(function(){s.variableNodes.forEach(function(e){var t=n.get(e.output),r=s.variableGradients.get(e.output),i=o.scaledArrayAdd(s.cGraph,r,s.one,t);n.set(e.output,globals_1.keep(i)),e.data=i,t.dispose()})}),this.variableGradients.dispose(),this.variableGradients=new tensor_array_map_1.TensorArrayMap},e}(optimizer_1.Optimizer);exports.SGDOptimizer=SGDOptimizer;