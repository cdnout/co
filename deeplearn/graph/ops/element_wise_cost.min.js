"use strict";var __extends=this&&this.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),globals_1=require("../../globals"),tensor_1=require("../../tensor"),util=require("../../util"),cost_functions_1=require("../cost_functions"),graph_util=require("../graph_util"),op_1=require("./op"),ElementWiseCost=function(s){function e(e,t,r,o){var n=s.call(this)||this;return n.x1Tensor=e,n.x2Tensor=t,n.yTensor=r,n.func=o,n.oneOverNScalar=environment_1.ENV.math.keep(tensor_1.Scalar.new(1/util.sizeFromShape(e.shape))),n}return __extends(e,s),e.prototype.feedForward=function(o,n){var s=this,i=n.get(this.x1Tensor),u=n.get(this.x2Tensor);globals_1.tidy(function(){var e=s.func.cost(i,u),t=o.sum(e),r=o.scalarTimesArray(s.oneOverNScalar,t);n.set(s.yTensor,globals_1.keep(r))})},e.prototype.backProp=function(e,t,r){var o=this,n=t.get(this.x1Tensor),s=t.get(this.x2Tensor);globals_1.tidy(function(){graph_util.shouldBackProp(o.x1Tensor)&&r.add(o.x1Tensor,o.func.der(n,s)),graph_util.shouldBackProp(o.x2Tensor)&&r.add(o.x2Tensor,o.func.der(s,n))})},e.prototype.dispose=function(){this.func.dispose(),this.oneOverNScalar.dispose()},e}(op_1.Operation),MeanSquaredCost=function(o){function e(e,t,r){return o.call(this,e,t,r,new cost_functions_1.SquareCostFunc)||this}return __extends(e,o),e}(exports.ElementWiseCost=ElementWiseCost);exports.MeanSquaredCost=MeanSquaredCost;