"use strict";var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(o,i,u,s){return new(u=u||Promise)(function(t,e){function r(t){try{a(s.next(t))}catch(t){e(t)}}function n(t){try{a(s.throw(t))}catch(t){e(t)}}function a(e){e.done?t(e.value):new u(function(t){t(e.value)}).then(r,n)}a((s=s.apply(o,i||[])).next())})},__generator=this&&this.__generator||function(r,n){var a,o,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,o&&(i=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(i=i.call(o,e[1])).done)return i;switch(o=0,i&&(e=[0,i.value]),e[0]){case 0:case 1:i=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){u.label=e[1];break}if(6===e[0]&&u.label<i[1]){u.label=i[1],i=e;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(e);break}i[2]&&u.ops.pop(),u.trys.pop();continue}e=n.call(r,u)}catch(t){e=[6,t],o=0}finally{a=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),globals_1=require("../../globals"),batch_dataset_1=require("./batch_dataset"),statistics_1=require("./statistics"),data_stream_1=require("./streams/data_stream"),data_stream_2=require("./streams/data_stream"),data_stream_3=require("./streams/data_stream"),Dataset=function(){function t(){}return t.prototype.computeStatistics=function(e,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,statistics_1.computeDatasetStatistics(this,e,r)]})})},t.prototype.filter=function(e){var t=this;return datasetFromStreamFn(function(){return t.getStream().filter(function(t){return globals_1.tidy(function(){return e(t)})})})},t.prototype.map=function(e){var t=this;return datasetFromStreamFn(function(){return t.getStream().map(function(t){return globals_1.tidy(function(){return e(t)})})})},t.prototype.batch=function(t,e){return void 0===e&&(e=!0),new batch_dataset_1.BatchDataset(this,t,e)},t.prototype.concatenate=function(t){var e=this;return datasetFromStreamFn(function(){return e.getStream().concatenate(t.getStream())})},t.prototype.repeat=function(e){var r=this;return datasetFromStreamFn(function(){var t=data_stream_1.streamFromFunction(function(){return{value:r.getStream(),done:!1}});return data_stream_2.streamFromConcatenated(t.take(e))})},t.prototype.take=function(t){var e=this;return datasetFromStreamFn(function(){return e.getStream().take(t)})},t.prototype.skip=function(t){var e=this;return datasetFromStreamFn(function(){return e.getStream().skip(t)})},t.prototype.shuffle=function(e,t,r){void 0===r&&(r=!0);var n=this,a=seedrandom(t);return datasetFromStreamFn(function(){var t=a.int32();return r&&(t+=a.int32()),n.getStream().shuffle(e,t.toString())})},t.prototype.prefetch=function(t){var e=this;return datasetFromStreamFn(function(){return e.getStream().prefetch(t)})},t.prototype.collectAll=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getStream().collectRemaining()]})})},t.prototype.forEach=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getStream().forEach(e)]})})},t}();function datasetFromStreamFn(t){return __extends(e,r=Dataset),e.prototype.getStream=function(){return t()},new e;function e(){return null!==r&&r.apply(this,arguments)||this}var r}function datasetFromElements(t){return datasetFromStreamFn(function(){return data_stream_3.streamFromItems(t)})}exports.Dataset=Dataset,exports.datasetFromStreamFn=datasetFromStreamFn,exports.datasetFromElements=datasetFromElements;