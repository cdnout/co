"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tex_util_1=require("./tex_util"),TextureManager=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.allocatedTextures=[],this.usedTextureCount={}}return e.prototype.acquireTexture=function(e,t){void 0===t&&(t=tex_util_1.TextureType.FLOAT);var u=getKeyFromTextureShape(e,t);if(u in this.freeTextures||(this.freeTextures[u]=[]),u in this.usedTextureCount||(this.usedTextureCount[u]=0),this.usedTextureCount[u]++,0<this.freeTextures[u].length)return this.numFreeTextures--,this.numUsedTextures++,this.log(),this.freeTextures[u].shift();this.numUsedTextures++,this.log();var r=this.gpgpu.createMatrixTexture(e[0],e[1]);return this.allocatedTextures.push(r),r},e.prototype.releaseTexture=function(e,t,u){void 0===u&&(u=tex_util_1.TextureType.FLOAT);var r=getKeyFromTextureShape(t,u);r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(e),this.numFreeTextures++,this.numUsedTextures--,this.usedTextureCount[r]--,this.log()},e.prototype.log=function(){var e;this.logEnabled&&(e=this.numFreeTextures+this.numUsedTextures,console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")"))},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;null!=this.allocatedTextures&&(this.allocatedTextures.forEach(function(e){t.gpgpu.deleteMatrixTexture(e)}),this.freeTextures=null,this.allocatedTextures=null,this.usedTextureCount=null,this.numUsedTextures=0,this.numFreeTextures=0)},e}();function getKeyFromTextureShape(e,t){return e[0]+"_"+e[1]+"_"+t}exports.TextureManager=TextureManager;