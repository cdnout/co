"use strict";var TextureType;function getUnpackedMatrixTextureShapeWidthHeight(e,r){return[r,e]}function getUnpackedArraySizeFromMatrixSize(e,r){return e*r}function getColorMatrixTextureShapeWidthHeight(e,r){return[4*r,e]}function getMatrixSizeFromUnpackedArraySize(e,r){if(e%r!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+r);return e/r}function encodeMatrixToUnpackedArray(e,r,t){var a=getUnpackedArraySizeFromMatrixSize(e.length,t);if(r.length<a)throw new Error("unpackedArray length ("+r.length+") must be >= "+a);for(var o=0,i=0;i<e.length;++i)r[o]=e[i],o+=t}Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.FLOAT=0]="FLOAT",e[e.UNSIGNED_BYTE=1]="UNSIGNED_BYTE"}(TextureType=exports.TextureType||(exports.TextureType={})),exports.getUnpackedMatrixTextureShapeWidthHeight=getUnpackedMatrixTextureShapeWidthHeight,exports.getUnpackedArraySizeFromMatrixSize=getUnpackedArraySizeFromMatrixSize,exports.getColorMatrixTextureShapeWidthHeight=getColorMatrixTextureShapeWidthHeight,exports.getMatrixSizeFromUnpackedArraySize=getMatrixSizeFromUnpackedArraySize,exports.encodeMatrixToUnpackedArray=encodeMatrixToUnpackedArray,exports.FLOAT_MAX=2e4,exports.FLOAT_MIN=-exports.FLOAT_MAX;var FLOAT_RANGE=(exports.FLOAT_MAX-exports.FLOAT_MIN)/255,FLOAT_DELTAS=[1,1/255,1/65025,1/16581375],FLOAT_POWERS=[1,255,65025];function encodeFloatArray(o){for(var i=new Uint8Array(4*o.length),e=function(e){var r=o[e/4];if(isNaN(r))return i[e]=exports.BYTE_NAN_VALUE,i[e+1]=exports.BYTE_NAN_VALUE,i[e+2]=exports.BYTE_NAN_VALUE,i[e+3]=exports.BYTE_NAN_VALUE,"continue";var t=(r-exports.FLOAT_MIN)/FLOAT_RANGE,a=FLOAT_POWERS.map(function(e){return e*t}).map(function(e){return Math.floor(e%1*255)});i[e]=Math.floor(t),i[e+1]=a[0],i[e+2]=a[1],i[e+3]=a[2]},r=0;r<i.length;r+=4)e(r);return i}function decodeToFloatArray(o){for(var r=new Float32Array(o.length/4),e=function(t){if(o[t]===exports.BYTE_NAN_VALUE&&o[t+1]===exports.BYTE_NAN_VALUE&&o[t+2]===exports.BYTE_NAN_VALUE&&o[t+3]===exports.BYTE_NAN_VALUE)return r[t/4]=NaN,"continue";var a=0;FLOAT_DELTAS.forEach(function(e,r){a+=e*o[t+r]});var e=a*FLOAT_RANGE+exports.FLOAT_MIN;r[t/4]=e},t=0;t<o.length;t+=4)e(t);return r}function decodeMatrixFromUnpackedArray(e,r,t){var a=getMatrixSizeFromUnpackedArraySize(e.length,t);if(r.length<a)throw new Error("matrix length ("+r.length+") must be >= "+a);for(var o=0,i=0;i<e.length;i+=t)r[o++]=e[i]}function decodeMatrixFromUnpackedColorRGBAArray(e,r,t){var a=e.length*t/4;if(r.length<a)throw new Error("matrix length ("+r.length+") must be >= "+a);for(var o=0,i=0;i<e.length;i+=4)for(var n=0;n<t;n++)r[o++]=e[i+n]}function getPackedMatrixTextureShapeWidthHeight(e,r){return[Math.ceil(r/2),Math.ceil(e/2)]}function getPackedRGBAArraySizeFromMatrixShape(e,r){var t=getPackedMatrixTextureShapeWidthHeight(e,r);return t[0]*t[1]*4}function encodeMatrixToPackedRGBA(e,r,t,a){var o=getPackedRGBAArraySizeFromMatrixShape(r,t);if(a.length<o)throw new Error("packedRGBA length ("+a.length+") must be >= "+o);for(var i=getPackedMatrixTextureShapeWidthHeight(r,t),n=i[0],x=i[1],c=t%2==1,d=r%2==1,A=Math.floor(t/2),h=Math.floor(r/2),p=c?4:0,g=t,u=0,T=0;T<h;++T){for(var M=2*T*t,f=0;f<A;++f){var l=M+2*f;a[u]=e[l],a[u+1]=e[l+1],a[u+2]=e[l+g],a[u+3]=e[l+g+1],u+=4}u+=p}if(c)for(var l=t-1,u=4*(n-1),F=2*t,p=4*n,T=0;T<h;++T)a[u]=e[l],a[u+2]=e[l+t],l+=F,u+=p;if(d)for(l=(r-1)*t,u=(x-1)*n*4,f=0;f<A;++f)a[u++]=e[l++],a[u++]=e[l++],u+=2;return c&&d&&(a[a.length-4]=e[e.length-1]),a}function decodeMatrixFromPackedRGBA(e,r,t,a){var o=r*t;if(o<a.length)throw new Error("matrix length ("+a.length+") must be >= "+o);for(var i=t%2==1,n=r%2==1,x=Math.floor(t/2),c=Math.floor(r/2),d=getPackedMatrixTextureShapeWidthHeight(r,t),A=d[0],h=d[1],p=i?4:0,g=t+(i?1:0),u=0,T=0,M=t,f=0;f<c;++f){for(var l=0;l<x;++l)a[T++]=e[u++],a[T++]=e[u++],a[M++]=e[u++],a[M++]=e[u++];u+=p,T+=g,M+=g}if(i)for(var u=4*(A-1),F=t-1,p=4*A,g=2*t,f=0;f<c;++f)a[F]=e[u],a[F+t]=e[u+2],u+=p,F+=g;if(n)for(u=(h-1)*A*4,F=(r-1)*t,l=0;l<x;++l)a[F++]=e[u++],a[F++]=e[u++],u+=2;return i&&n&&(a[a.length-1]=e[e.length-4]),a}exports.BYTE_NAN_VALUE=0,exports.encodeFloatArray=encodeFloatArray,exports.decodeToFloatArray=decodeToFloatArray,exports.decodeMatrixFromUnpackedArray=decodeMatrixFromUnpackedArray,exports.decodeMatrixFromUnpackedColorRGBAArray=decodeMatrixFromUnpackedColorRGBAArray,exports.getPackedMatrixTextureShapeWidthHeight=getPackedMatrixTextureShapeWidthHeight,exports.getPackedRGBAArraySizeFromMatrixShape=getPackedRGBAArraySizeFromMatrixShape,exports.encodeMatrixToPackedRGBA=encodeMatrixToPackedRGBA,exports.decodeMatrixFromPackedRGBA=decodeMatrixFromPackedRGBA;